const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LoginView-BYgse4pv.js","assets/LoginView-B1OTLpFm.css"])))=>i.map(i=>d[i]);
var nH=Object.defineProperty;var sH=(r,e,t)=>e in r?nH(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Ku=(r,e,t)=>sH(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const f of c)if(f.type==="childList")for(const y of f.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&o(y)}).observe(document,{childList:!0,subtree:!0});function t(c){const f={};return c.integrity&&(f.integrity=c.integrity),c.referrerPolicy&&(f.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?f.credentials="include":c.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function o(c){if(c.ep)return;c.ep=!0;const f=t(c);fetch(c.href,f)}})();/**
* @vue/shared v3.5.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function K4(r){const e=Object.create(null);for(const t of r.split(","))e[t]=1;return t=>t in e}const Ps={},Hg=[],lh=()=>{},zF=()=>!1,$T=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&(r.charCodeAt(2)>122||r.charCodeAt(2)<97),Y4=r=>r.startsWith("onUpdate:"),qa=Object.assign,J4=(r,e)=>{const t=r.indexOf(e);t>-1&&r.splice(t,1)},oH=Object.prototype.hasOwnProperty,fs=(r,e)=>oH.call(r,e),sn=Array.isArray,qg=r=>GT(r)==="[object Map]",NF=r=>GT(r)==="[object Set]",dn=r=>typeof r=="function",ko=r=>typeof r=="string",kd=r=>typeof r=="symbol",Js=r=>r!==null&&typeof r=="object",BF=r=>(Js(r)||dn(r))&&dn(r.then)&&dn(r.catch),VF=Object.prototype.toString,GT=r=>VF.call(r),aH=r=>GT(r).slice(8,-1),UF=r=>GT(r)==="[object Object]",Q4=r=>ko(r)&&r!=="NaN"&&r[0]!=="-"&&""+parseInt(r,10)===r,h1=K4(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),HT=r=>{const e=Object.create(null);return t=>e[t]||(e[t]=r(t))},lH=/-\w/g,ep=HT(r=>r.replace(lH,e=>e.slice(1).toUpperCase())),cH=/\B([A-Z])/g,Gm=HT(r=>r.replace(cH,"-$1").toLowerCase()),jF=HT(r=>r.charAt(0).toUpperCase()+r.slice(1)),$S=HT(r=>r?`on${jF(r)}`:""),Gf=(r,e)=>!Object.is(r,e),d2=(r,...e)=>{for(let t=0;t<r.length;t++)r[t](...e)},$F=(r,e,t,o=!1)=>{Object.defineProperty(r,e,{configurable:!0,enumerable:!1,writable:o,value:t})},JA=r=>{const e=parseFloat(r);return isNaN(e)?r:e};let y3;const qT=()=>y3||(y3=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function eC(r){if(sn(r)){const e={};for(let t=0;t<r.length;t++){const o=r[t],c=ko(o)?fH(o):eC(o);if(c)for(const f in c)e[f]=c[f]}return e}else if(ko(r)||Js(r))return r}const uH=/;(?![^(]*\))/g,hH=/:([^]+)/,dH=/\/\*[^]*?\*\//g;function fH(r){const e={};return r.replace(dH,"").split(uH).forEach(t=>{if(t){const o=t.split(hH);o.length>1&&(e[o[0].trim()]=o[1].trim())}}),e}function F0(r){let e="";if(ko(r))e=r;else if(sn(r))for(let t=0;t<r.length;t++){const o=F0(r[t]);o&&(e+=o+" ")}else if(Js(r))for(const t in r)r[t]&&(e+=t+" ");return e.trim()}const pH="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",mH=K4(pH);function GF(r){return!!r||r===""}const HF=r=>!!(r&&r.__v_isRef===!0),ms=r=>ko(r)?r:r==null?"":sn(r)||Js(r)&&(r.toString===VF||!dn(r.toString))?HF(r)?ms(r.value):JSON.stringify(r,qF,2):String(r),qF=(r,e)=>HF(e)?qF(r,e.value):qg(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[o,c],f)=>(t[GS(o,f)+" =>"]=c,t),{})}:NF(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>GS(t))}:kd(e)?GS(e):Js(e)&&!sn(e)&&!UF(e)?String(e):e,GS=(r,e="")=>{var t;return kd(r)?`Symbol(${(t=r.description)!=null?t:e})`:r};/**
* @vue/reactivity v3.5.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let La;class WF{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=La,!e&&La&&(this.index=(La.scopes||(La.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=La;try{return La=this,e()}finally{La=t}}}on(){++this._on===1&&(this.prevScope=La,La=this)}off(){this._on>0&&--this._on===0&&(La=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,o;for(t=0,o=this.effects.length;t<o;t++)this.effects[t].stop();for(this.effects.length=0,t=0,o=this.cleanups.length;t<o;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,o=this.scopes.length;t<o;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const c=this.parent.scopes.pop();c&&c!==this&&(this.parent.scopes[this.index]=c,c.index=this.index)}this.parent=void 0}}}function XF(r){return new WF(r)}function ZF(){return La}function _H(r,e=!1){La&&La.cleanups.push(r)}let Ns;const HS=new WeakSet;class KF{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,La&&La.active&&La.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,HS.has(this)&&(HS.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||JF(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,v3(this),QF(this);const e=Ns,t=fu;Ns=this,fu=!0;try{return this.fn()}finally{ez(this),Ns=e,fu=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)rC(e);this.deps=this.depsTail=void 0,v3(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?HS.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){QA(this)&&this.run()}get dirty(){return QA(this)}}let YF=0,d1,f1;function JF(r,e=!1){if(r.flags|=8,e){r.next=f1,f1=r;return}r.next=d1,d1=r}function tC(){YF++}function iC(){if(--YF>0)return;if(f1){let e=f1;for(f1=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let r;for(;d1;){let e=d1;for(d1=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(o){r||(r=o)}e=t}}if(r)throw r}function QF(r){for(let e=r.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function ez(r){let e,t=r.depsTail,o=t;for(;o;){const c=o.prevDep;o.version===-1?(o===t&&(t=c),rC(o),gH(o)):e=o,o.dep.activeLink=o.prevActiveLink,o.prevActiveLink=void 0,o=c}r.deps=e,r.depsTail=t}function QA(r){for(let e=r.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(tz(e.dep.computed)||e.dep.version!==e.version))return!0;return!!r._dirty}function tz(r){if(r.flags&4&&!(r.flags&16)||(r.flags&=-17,r.globalVersion===$1)||(r.globalVersion=$1,!r.isSSR&&r.flags&128&&(!r.deps&&!r._dirty||!QA(r))))return;r.flags|=2;const e=r.dep,t=Ns,o=fu;Ns=r,fu=!0;try{QF(r);const c=r.fn(r._value);(e.version===0||Gf(c,r._value))&&(r.flags|=128,r._value=c,e.version++)}catch(c){throw e.version++,c}finally{Ns=t,fu=o,ez(r),r.flags&=-3}}function rC(r,e=!1){const{dep:t,prevSub:o,nextSub:c}=r;if(o&&(o.nextSub=c,r.prevSub=void 0),c&&(c.prevSub=o,r.nextSub=void 0),t.subs===r&&(t.subs=o,!o&&t.computed)){t.computed.flags&=-5;for(let f=t.computed.deps;f;f=f.nextDep)rC(f,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function gH(r){const{prevDep:e,nextDep:t}=r;e&&(e.nextDep=t,r.prevDep=void 0),t&&(t.prevDep=e,r.nextDep=void 0)}let fu=!0;const iz=[];function Td(){iz.push(fu),fu=!1}function Ed(){const r=iz.pop();fu=r===void 0?!0:r}function v3(r){const{cleanup:e}=r;if(r.cleanup=void 0,e){const t=Ns;Ns=void 0;try{e()}finally{Ns=t}}}let $1=0;class yH{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class nC{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Ns||!fu||Ns===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Ns)t=this.activeLink=new yH(Ns,this),Ns.deps?(t.prevDep=Ns.depsTail,Ns.depsTail.nextDep=t,Ns.depsTail=t):Ns.deps=Ns.depsTail=t,rz(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const o=t.nextDep;o.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=o),t.prevDep=Ns.depsTail,t.nextDep=void 0,Ns.depsTail.nextDep=t,Ns.depsTail=t,Ns.deps===t&&(Ns.deps=o)}return t}trigger(e){this.version++,$1++,this.notify(e)}notify(e){tC();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{iC()}}}function rz(r){if(r.dep.sc++,r.sub.flags&4){const e=r.dep.computed;if(e&&!r.dep.subs){e.flags|=20;for(let o=e.deps;o;o=o.nextDep)rz(o)}const t=r.dep.subs;t!==r&&(r.prevSub=t,t&&(t.nextSub=r)),r.dep.subs=r}}const e5=new WeakMap,fm=Symbol(""),t5=Symbol(""),G1=Symbol("");function za(r,e,t){if(fu&&Ns){let o=e5.get(r);o||e5.set(r,o=new Map);let c=o.get(t);c||(o.set(t,c=new nC),c.map=o,c.key=t),c.track()}}function hd(r,e,t,o,c,f){const y=e5.get(r);if(!y){$1++;return}const s=E=>{E&&E.trigger()};if(tC(),e==="clear")y.forEach(s);else{const E=sn(r),R=E&&Q4(t);if(E&&t==="length"){const O=Number(o);y.forEach((A,U)=>{(U==="length"||U===G1||!kd(U)&&U>=O)&&s(A)})}else switch((t!==void 0||y.has(void 0))&&s(y.get(t)),R&&s(y.get(G1)),e){case"add":E?R&&s(y.get("length")):(s(y.get(fm)),qg(r)&&s(y.get(t5)));break;case"delete":E||(s(y.get(fm)),qg(r)&&s(y.get(t5)));break;case"set":qg(r)&&s(y.get(fm));break}}iC()}function gg(r){const e=ds(r);return e===r?e:(za(e,"iterate",G1),zc(r)?e:e.map(da))}function WT(r){return za(r=ds(r),"iterate",G1),r}const vH={__proto__:null,[Symbol.iterator](){return qS(this,Symbol.iterator,da)},concat(...r){return gg(this).concat(...r.map(e=>sn(e)?gg(e):e))},entries(){return qS(this,"entries",r=>(r[1]=da(r[1]),r))},every(r,e){return nd(this,"every",r,e,void 0,arguments)},filter(r,e){return nd(this,"filter",r,e,t=>t.map(da),arguments)},find(r,e){return nd(this,"find",r,e,da,arguments)},findIndex(r,e){return nd(this,"findIndex",r,e,void 0,arguments)},findLast(r,e){return nd(this,"findLast",r,e,da,arguments)},findLastIndex(r,e){return nd(this,"findLastIndex",r,e,void 0,arguments)},forEach(r,e){return nd(this,"forEach",r,e,void 0,arguments)},includes(...r){return WS(this,"includes",r)},indexOf(...r){return WS(this,"indexOf",r)},join(r){return gg(this).join(r)},lastIndexOf(...r){return WS(this,"lastIndexOf",r)},map(r,e){return nd(this,"map",r,e,void 0,arguments)},pop(){return Dv(this,"pop")},push(...r){return Dv(this,"push",r)},reduce(r,...e){return x3(this,"reduce",r,e)},reduceRight(r,...e){return x3(this,"reduceRight",r,e)},shift(){return Dv(this,"shift")},some(r,e){return nd(this,"some",r,e,void 0,arguments)},splice(...r){return Dv(this,"splice",r)},toReversed(){return gg(this).toReversed()},toSorted(r){return gg(this).toSorted(r)},toSpliced(...r){return gg(this).toSpliced(...r)},unshift(...r){return Dv(this,"unshift",r)},values(){return qS(this,"values",da)}};function qS(r,e,t){const o=WT(r),c=o[e]();return o!==r&&!zc(r)&&(c._next=c.next,c.next=()=>{const f=c._next();return f.value&&(f.value=t(f.value)),f}),c}const xH=Array.prototype;function nd(r,e,t,o,c,f){const y=WT(r),s=y!==r&&!zc(r),E=y[e];if(E!==xH[e]){const A=E.apply(r,f);return s?da(A):A}let R=t;y!==r&&(s?R=function(A,U){return t.call(this,da(A),U,r)}:t.length>2&&(R=function(A,U){return t.call(this,A,U,r)}));const O=E.call(y,R,o);return s&&c?c(O):O}function x3(r,e,t,o){const c=WT(r);let f=t;return c!==r&&(zc(r)?t.length>3&&(f=function(y,s,E){return t.call(this,y,s,E,r)}):f=function(y,s,E){return t.call(this,y,da(s),E,r)}),c[e](f,...o)}function WS(r,e,t){const o=ds(r);za(o,"iterate",G1);const c=o[e](...t);return(c===-1||c===!1)&&aC(t[0])?(t[0]=ds(t[0]),o[e](...t)):c}function Dv(r,e,t=[]){Td(),tC();const o=ds(r)[e].apply(r,t);return iC(),Ed(),o}const bH=K4("__proto__,__v_isRef,__isVue"),nz=new Set(Object.getOwnPropertyNames(Symbol).filter(r=>r!=="arguments"&&r!=="caller").map(r=>Symbol[r]).filter(kd));function wH(r){kd(r)||(r=String(r));const e=ds(this);return za(e,"has",r),e.hasOwnProperty(r)}class sz{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,o){if(t==="__v_skip")return e.__v_skip;const c=this._isReadonly,f=this._isShallow;if(t==="__v_isReactive")return!c;if(t==="__v_isReadonly")return c;if(t==="__v_isShallow")return f;if(t==="__v_raw")return o===(c?f?kH:cz:f?lz:az).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(o)?e:void 0;const y=sn(e);if(!c){let E;if(y&&(E=vH[t]))return E;if(t==="hasOwnProperty")return wH}const s=Reflect.get(e,t,ga(e)?e:o);return(kd(t)?nz.has(t):bH(t))||(c||za(e,"get",t),f)?s:ga(s)?y&&Q4(t)?s:s.value:Js(s)?c?hz(s):XT(s):s}}class oz extends sz{constructor(e=!1){super(!1,e)}set(e,t,o,c){let f=e[t];if(!this._isShallow){const E=tp(f);if(!zc(o)&&!tp(o)&&(f=ds(f),o=ds(o)),!sn(e)&&ga(f)&&!ga(o))return E||(f.value=o),!0}const y=sn(e)&&Q4(t)?Number(t)<e.length:fs(e,t),s=Reflect.set(e,t,o,ga(e)?e:c);return e===ds(c)&&(y?Gf(o,f)&&hd(e,"set",t,o):hd(e,"add",t,o)),s}deleteProperty(e,t){const o=fs(e,t);e[t];const c=Reflect.deleteProperty(e,t);return c&&o&&hd(e,"delete",t,void 0),c}has(e,t){const o=Reflect.has(e,t);return(!kd(t)||!nz.has(t))&&za(e,"has",t),o}ownKeys(e){return za(e,"iterate",sn(e)?"length":fm),Reflect.ownKeys(e)}}class TH extends sz{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const EH=new oz,IH=new TH,SH=new oz(!0);const i5=r=>r,kw=r=>Reflect.getPrototypeOf(r);function AH(r,e,t){return function(...o){const c=this.__v_raw,f=ds(c),y=qg(f),s=r==="entries"||r===Symbol.iterator&&y,E=r==="keys"&&y,R=c[r](...o),O=t?i5:e?z2:da;return!e&&za(f,"iterate",E?t5:fm),{next(){const{value:A,done:U}=R.next();return U?{value:A,done:U}:{value:s?[O(A[0]),O(A[1])]:O(A),done:U}},[Symbol.iterator](){return this}}}}function Dw(r){return function(...e){return r==="delete"?!1:r==="clear"?void 0:this}}function CH(r,e){const t={get(c){const f=this.__v_raw,y=ds(f),s=ds(c);r||(Gf(c,s)&&za(y,"get",c),za(y,"get",s));const{has:E}=kw(y),R=e?i5:r?z2:da;if(E.call(y,c))return R(f.get(c));if(E.call(y,s))return R(f.get(s));f!==y&&f.get(c)},get size(){const c=this.__v_raw;return!r&&za(ds(c),"iterate",fm),c.size},has(c){const f=this.__v_raw,y=ds(f),s=ds(c);return r||(Gf(c,s)&&za(y,"has",c),za(y,"has",s)),c===s?f.has(c):f.has(c)||f.has(s)},forEach(c,f){const y=this,s=y.__v_raw,E=ds(s),R=e?i5:r?z2:da;return!r&&za(E,"iterate",fm),s.forEach((O,A)=>c.call(f,R(O),R(A),y))}};return qa(t,r?{add:Dw("add"),set:Dw("set"),delete:Dw("delete"),clear:Dw("clear")}:{add(c){!e&&!zc(c)&&!tp(c)&&(c=ds(c));const f=ds(this);return kw(f).has.call(f,c)||(f.add(c),hd(f,"add",c,c)),this},set(c,f){!e&&!zc(f)&&!tp(f)&&(f=ds(f));const y=ds(this),{has:s,get:E}=kw(y);let R=s.call(y,c);R||(c=ds(c),R=s.call(y,c));const O=E.call(y,c);return y.set(c,f),R?Gf(f,O)&&hd(y,"set",c,f):hd(y,"add",c,f),this},delete(c){const f=ds(this),{has:y,get:s}=kw(f);let E=y.call(f,c);E||(c=ds(c),E=y.call(f,c)),s&&s.call(f,c);const R=f.delete(c);return E&&hd(f,"delete",c,void 0),R},clear(){const c=ds(this),f=c.size!==0,y=c.clear();return f&&hd(c,"clear",void 0,void 0),y}}),["keys","values","entries",Symbol.iterator].forEach(c=>{t[c]=AH(c,r,e)}),t}function sC(r,e){const t=CH(r,e);return(o,c,f)=>c==="__v_isReactive"?!r:c==="__v_isReadonly"?r:c==="__v_raw"?o:Reflect.get(fs(t,c)&&c in o?t:o,c,f)}const RH={get:sC(!1,!1)},PH={get:sC(!1,!0)},MH={get:sC(!0,!1)};const az=new WeakMap,lz=new WeakMap,cz=new WeakMap,kH=new WeakMap;function DH(r){switch(r){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function LH(r){return r.__v_skip||!Object.isExtensible(r)?0:DH(aH(r))}function XT(r){return tp(r)?r:oC(r,!1,EH,RH,az)}function uz(r){return oC(r,!1,SH,PH,lz)}function hz(r){return oC(r,!0,IH,MH,cz)}function oC(r,e,t,o,c){if(!Js(r)||r.__v_raw&&!(e&&r.__v_isReactive))return r;const f=LH(r);if(f===0)return r;const y=c.get(r);if(y)return y;const s=new Proxy(r,f===2?o:t);return c.set(r,s),s}function Wg(r){return tp(r)?Wg(r.__v_raw):!!(r&&r.__v_isReactive)}function tp(r){return!!(r&&r.__v_isReadonly)}function zc(r){return!!(r&&r.__v_isShallow)}function aC(r){return r?!!r.__v_raw:!1}function ds(r){const e=r&&r.__v_raw;return e?ds(e):r}function dz(r){return!fs(r,"__v_skip")&&Object.isExtensible(r)&&$F(r,"__v_skip",!0),r}const da=r=>Js(r)?XT(r):r,z2=r=>Js(r)?hz(r):r;function ga(r){return r?r.__v_isRef===!0:!1}function Qn(r){return pz(r,!1)}function fz(r){return pz(r,!0)}function pz(r,e){return ga(r)?r:new OH(r,e)}class OH{constructor(e,t){this.dep=new nC,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:ds(e),this._value=t?e:da(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,o=this.__v_isShallow||zc(e)||tp(e);e=o?e:ds(e),Gf(e,t)&&(this._rawValue=e,this._value=o?e:da(e),this.dep.trigger())}}function Rn(r){return ga(r)?r.value:r}function ad(r){return dn(r)?r():Rn(r)}const FH={get:(r,e,t)=>e==="__v_raw"?r:Rn(Reflect.get(r,e,t)),set:(r,e,t,o)=>{const c=r[e];return ga(c)&&!ga(t)?(c.value=t,!0):Reflect.set(r,e,t,o)}};function mz(r){return Wg(r)?r:new Proxy(r,FH)}class zH{constructor(e,t,o){this.fn=e,this.setter=t,this._value=void 0,this.dep=new nC(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=$1-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=o}notify(){if(this.flags|=16,!(this.flags&8)&&Ns!==this)return JF(this,!0),!0}get value(){const e=this.dep.track();return tz(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function NH(r,e,t=!1){let o,c;return dn(r)?o=r:(o=r.get,c=r.set),new zH(o,c,t)}const Lw={},N2=new WeakMap;let em;function BH(r,e=!1,t=em){if(t){let o=N2.get(t);o||N2.set(t,o=[]),o.push(r)}}function VH(r,e,t=Ps){const{immediate:o,deep:c,once:f,scheduler:y,augmentJob:s,call:E}=t,R=Me=>c?Me:zc(Me)||c===!1||c===0?dd(Me,1):dd(Me);let O,A,U,$,te=!1,Q=!1;if(ga(r)?(A=()=>r.value,te=zc(r)):Wg(r)?(A=()=>R(r),te=!0):sn(r)?(Q=!0,te=r.some(Me=>Wg(Me)||zc(Me)),A=()=>r.map(Me=>{if(ga(Me))return Me.value;if(Wg(Me))return R(Me);if(dn(Me))return E?E(Me,2):Me()})):dn(r)?e?A=E?()=>E(r,2):r:A=()=>{if(U){Td();try{U()}finally{Ed()}}const Me=em;em=O;try{return E?E(r,3,[$]):r($)}finally{em=Me}}:A=lh,e&&c){const Me=A,at=c===!0?1/0:c;A=()=>dd(Me(),at)}const de=ZF(),Ce=()=>{O.stop(),de&&de.active&&J4(de.effects,O)};if(f&&e){const Me=e;e=(...at)=>{Me(...at),Ce()}}let Fe=Q?new Array(r.length).fill(Lw):Lw;const Le=Me=>{if(!(!(O.flags&1)||!O.dirty&&!Me))if(e){const at=O.run();if(c||te||(Q?at.some((pt,me)=>Gf(pt,Fe[me])):Gf(at,Fe))){U&&U();const pt=em;em=O;try{const me=[at,Fe===Lw?void 0:Q&&Fe[0]===Lw?[]:Fe,$];Fe=at,E?E(e,3,me):e(...me)}finally{em=pt}}}else O.run()};return s&&s(Le),O=new KF(A),O.scheduler=y?()=>y(Le,!1):Le,$=Me=>BH(Me,!1,O),U=O.onStop=()=>{const Me=N2.get(O);if(Me){if(E)E(Me,4);else for(const at of Me)at();N2.delete(O)}},e?o?Le(!0):Fe=O.run():y?y(Le.bind(null,!0),!0):O.run(),Ce.pause=O.pause.bind(O),Ce.resume=O.resume.bind(O),Ce.stop=Ce,Ce}function dd(r,e=1/0,t){if(e<=0||!Js(r)||r.__v_skip||(t=t||new Map,(t.get(r)||0)>=e))return r;if(t.set(r,e),e--,ga(r))dd(r.value,e,t);else if(sn(r))for(let o=0;o<r.length;o++)dd(r[o],e,t);else if(NF(r)||qg(r))r.forEach(o=>{dd(o,e,t)});else if(UF(r)){for(const o in r)dd(r[o],e,t);for(const o of Object.getOwnPropertySymbols(r))Object.prototype.propertyIsEnumerable.call(r,o)&&dd(r[o],e,t)}return r}/**
* @vue/runtime-core v3.5.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Sx(r,e,t,o){try{return o?r(...o):r()}catch(c){ZT(c,e,t)}}function gh(r,e,t,o){if(dn(r)){const c=Sx(r,e,t,o);return c&&BF(c)&&c.catch(f=>{ZT(f,e,t)}),c}if(sn(r)){const c=[];for(let f=0;f<r.length;f++)c.push(gh(r[f],e,t,o));return c}}function ZT(r,e,t,o=!0){const c=e?e.vnode:null,{errorHandler:f,throwUnhandledErrorInProduction:y}=e&&e.appContext.config||Ps;if(e){let s=e.parent;const E=e.proxy,R=`https://vuejs.org/error-reference/#runtime-${t}`;for(;s;){const O=s.ec;if(O){for(let A=0;A<O.length;A++)if(O[A](r,E,R)===!1)return}s=s.parent}if(f){Td(),Sx(f,null,10,[r,E,R]),Ed();return}}UH(r,t,c,o,y)}function UH(r,e,t,o=!0,c=!1){if(c)throw r;console.error(r)}const fl=[];let Ju=-1;const Xg=[];let Pf=null,Ig=0;const _z=Promise.resolve();let B2=null;function lC(r){const e=B2||_z;return r?e.then(this?r.bind(this):r):e}function jH(r){let e=Ju+1,t=fl.length;for(;e<t;){const o=e+t>>>1,c=fl[o],f=H1(c);f<r||f===r&&c.flags&2?e=o+1:t=o}return e}function cC(r){if(!(r.flags&1)){const e=H1(r),t=fl[fl.length-1];!t||!(r.flags&2)&&e>=H1(t)?fl.push(r):fl.splice(jH(e),0,r),r.flags|=1,gz()}}function gz(){B2||(B2=_z.then(vz))}function $H(r){sn(r)?Xg.push(...r):Pf&&r.id===-1?Pf.splice(Ig+1,0,r):r.flags&1||(Xg.push(r),r.flags|=1),gz()}function b3(r,e,t=Ju+1){for(;t<fl.length;t++){const o=fl[t];if(o&&o.flags&2){if(r&&o.id!==r.uid)continue;fl.splice(t,1),t--,o.flags&4&&(o.flags&=-2),o(),o.flags&4||(o.flags&=-2)}}}function yz(r){if(Xg.length){const e=[...new Set(Xg)].sort((t,o)=>H1(t)-H1(o));if(Xg.length=0,Pf){Pf.push(...e);return}for(Pf=e,Ig=0;Ig<Pf.length;Ig++){const t=Pf[Ig];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Pf=null,Ig=0}}const H1=r=>r.id==null?r.flags&2?-1:1/0:r.id;function vz(r){try{for(Ju=0;Ju<fl.length;Ju++){const e=fl[Ju];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),Sx(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;Ju<fl.length;Ju++){const e=fl[Ju];e&&(e.flags&=-2)}Ju=-1,fl.length=0,yz(),B2=null,(fl.length||Xg.length)&&vz()}}let $a=null,xz=null;function V2(r){const e=$a;return $a=r,xz=r&&r.type.__scopeId||null,e}function c0(r,e=$a,t){if(!e||r._n)return r;const o=(...c)=>{o._d&&$2(-1);const f=V2(e);let y;try{y=r(...c)}finally{V2(f),o._d&&$2(1)}return y};return o._n=!0,o._c=!0,o._d=!0,o}function u0(r,e){if($a===null)return r;const t=QT($a),o=r.dirs||(r.dirs=[]);for(let c=0;c<e.length;c++){let[f,y,s,E=Ps]=e[c];f&&(dn(f)&&(f={mounted:f,updated:f}),f.deep&&dd(y),o.push({dir:f,instance:t,value:y,oldValue:void 0,arg:s,modifiers:E}))}return r}function Zp(r,e,t,o){const c=r.dirs,f=e&&e.dirs;for(let y=0;y<c.length;y++){const s=c[y];f&&(s.oldValue=f[y].value);let E=s.dir[o];E&&(Td(),gh(E,t,8,[r.el,s,r,e]),Ed())}}const GH=Symbol("_vte"),HH=r=>r.__isTeleport,qH=Symbol("_leaveCb");function uC(r,e){r.shapeFlag&6&&r.component?(r.transition=e,uC(r.component.subTree,e)):r.shapeFlag&128?(r.ssContent.transition=e.clone(r.ssContent),r.ssFallback.transition=e.clone(r.ssFallback)):r.transition=e}function wa(r,e){return dn(r)?qa({name:r.name},e,{setup:r}):r}function bz(r){r.ids=[r.ids[0]+r.ids[2]+++"-",0,0]}const U2=new WeakMap;function p1(r,e,t,o,c=!1){if(sn(r)){r.forEach((te,Q)=>p1(te,e&&(sn(e)?e[Q]:e),t,o,c));return}if(Zg(o)&&!c){o.shapeFlag&512&&o.type.__asyncResolved&&o.component.subTree.component&&p1(r,e,t,o.component.subTree);return}const f=o.shapeFlag&4?QT(o.component):o.el,y=c?null:f,{i:s,r:E}=r,R=e&&e.r,O=s.refs===Ps?s.refs={}:s.refs,A=s.setupState,U=ds(A),$=A===Ps?zF:te=>fs(U,te);if(R!=null&&R!==E){if(w3(e),ko(R))O[R]=null,$(R)&&(A[R]=null);else if(ga(R)){R.value=null;const te=e;te.k&&(O[te.k]=null)}}if(dn(E))Sx(E,s,12,[y,O]);else{const te=ko(E),Q=ga(E);if(te||Q){const de=()=>{if(r.f){const Ce=te?$(E)?A[E]:O[E]:E.value;if(c)sn(Ce)&&J4(Ce,f);else if(sn(Ce))Ce.includes(f)||Ce.push(f);else if(te)O[E]=[f],$(E)&&(A[E]=O[E]);else{const Fe=[f];E.value=Fe,r.k&&(O[r.k]=Fe)}}else te?(O[E]=y,$(E)&&(A[E]=y)):Q&&(E.value=y,r.k&&(O[r.k]=y))};if(y){const Ce=()=>{de(),U2.delete(r)};Ce.id=-1,U2.set(r,Ce),Xl(Ce,t)}else w3(r),de()}}}function w3(r){const e=U2.get(r);e&&(e.flags|=8,U2.delete(r))}qT().requestIdleCallback;qT().cancelIdleCallback;const Zg=r=>!!r.type.__asyncLoader,wz=r=>r.type.__isKeepAlive;function WH(r,e){Tz(r,"a",e)}function XH(r,e){Tz(r,"da",e)}function Tz(r,e,t=ml){const o=r.__wdc||(r.__wdc=()=>{let c=t;for(;c;){if(c.isDeactivated)return;c=c.parent}return r()});if(KT(e,o,t),t){let c=t.parent;for(;c&&c.parent;)wz(c.parent.vnode)&&ZH(o,e,t,c),c=c.parent}}function ZH(r,e,t,o){const c=KT(e,r,o,!0);Ez(()=>{J4(o[e],c)},t)}function KT(r,e,t=ml,o=!1){if(t){const c=t[r]||(t[r]=[]),f=e.__weh||(e.__weh=(...y)=>{Td();const s=Ax(t),E=gh(e,t,r,y);return s(),Ed(),E});return o?c.unshift(f):c.push(f),f}}const Dd=r=>(e,t=ml)=>{(!X1||r==="sp")&&KT(r,(...o)=>e(...o),t)},KH=Dd("bm"),hC=Dd("m"),YH=Dd("bu"),JH=Dd("u"),QH=Dd("bum"),Ez=Dd("um"),Iz=Dd("sp"),eq=Dd("rtg"),tq=Dd("rtc");function iq(r,e=ml){KT("ec",r,e)}const rq=Symbol.for("v-ndc");function Em(r,e,t,o){let c;const f=t,y=sn(r);if(y||ko(r)){const s=y&&Wg(r);let E=!1,R=!1;s&&(E=!zc(r),R=tp(r),r=WT(r)),c=new Array(r.length);for(let O=0,A=r.length;O<A;O++)c[O]=e(E?R?z2(da(r[O])):da(r[O]):r[O],O,void 0,f)}else if(typeof r=="number"){c=new Array(r);for(let s=0;s<r;s++)c[s]=e(s+1,s,void 0,f)}else if(Js(r))if(r[Symbol.iterator])c=Array.from(r,(s,E)=>e(s,E,void 0,f));else{const s=Object.keys(r);c=new Array(s.length);for(let E=0,R=s.length;E<R;E++){const O=s[E];c[E]=e(r[O],O,E,f)}}else c=[];return c}function nq(r,e,t={},o,c){if($a.ce||$a.parent&&Zg($a.parent)&&$a.parent.ce)return Pr(),Im(Po,null,[Bs("slot",t,o)],64);let f=r[e];f&&f._c&&(f._d=!1),Pr();const y=f&&Sz(f(t)),s=t.key||y&&y.key,E=Im(Po,{key:(s&&!kd(s)?s:`_${e}`)+(!y&&o?"_fb":"")},y||[],y&&r._===1?64:-2);return f&&f._c&&(f._d=!0),E}function Sz(r){return r.some(e=>W1(e)?!(e.type===Id||e.type===Po&&!Sz(e.children)):!0)?r:null}const r5=r=>r?qz(r)?QT(r):r5(r.parent):null,m1=qa(Object.create(null),{$:r=>r,$el:r=>r.vnode.el,$data:r=>r.data,$props:r=>r.props,$attrs:r=>r.attrs,$slots:r=>r.slots,$refs:r=>r.refs,$parent:r=>r5(r.parent),$root:r=>r5(r.root),$host:r=>r.ce,$emit:r=>r.emit,$options:r=>Cz(r),$forceUpdate:r=>r.f||(r.f=()=>{cC(r.update)}),$nextTick:r=>r.n||(r.n=lC.bind(r.proxy)),$watch:r=>Iq.bind(r)}),XS=(r,e)=>r!==Ps&&!r.__isScriptSetup&&fs(r,e),sq={get({_:r},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:o,data:c,props:f,accessCache:y,type:s,appContext:E}=r;let R;if(e[0]!=="$"){const $=y[e];if($!==void 0)switch($){case 1:return o[e];case 2:return c[e];case 4:return t[e];case 3:return f[e]}else{if(XS(o,e))return y[e]=1,o[e];if(c!==Ps&&fs(c,e))return y[e]=2,c[e];if((R=r.propsOptions[0])&&fs(R,e))return y[e]=3,f[e];if(t!==Ps&&fs(t,e))return y[e]=4,t[e];n5&&(y[e]=0)}}const O=m1[e];let A,U;if(O)return e==="$attrs"&&za(r.attrs,"get",""),O(r);if((A=s.__cssModules)&&(A=A[e]))return A;if(t!==Ps&&fs(t,e))return y[e]=4,t[e];if(U=E.config.globalProperties,fs(U,e))return U[e]},set({_:r},e,t){const{data:o,setupState:c,ctx:f}=r;return XS(c,e)?(c[e]=t,!0):o!==Ps&&fs(o,e)?(o[e]=t,!0):fs(r.props,e)||e[0]==="$"&&e.slice(1)in r?!1:(f[e]=t,!0)},has({_:{data:r,setupState:e,accessCache:t,ctx:o,appContext:c,propsOptions:f,type:y}},s){let E,R;return!!(t[s]||r!==Ps&&s[0]!=="$"&&fs(r,s)||XS(e,s)||(E=f[0])&&fs(E,s)||fs(o,s)||fs(m1,s)||fs(c.config.globalProperties,s)||(R=y.__cssModules)&&R[s])},defineProperty(r,e,t){return t.get!=null?r._.accessCache[e]=0:fs(t,"value")&&this.set(r,e,t.value,null),Reflect.defineProperty(r,e,t)}};function T3(r){return sn(r)?r.reduce((e,t)=>(e[t]=null,e),{}):r}let n5=!0;function oq(r){const e=Cz(r),t=r.proxy,o=r.ctx;n5=!1,e.beforeCreate&&E3(e.beforeCreate,r,"bc");const{data:c,computed:f,methods:y,watch:s,provide:E,inject:R,created:O,beforeMount:A,mounted:U,beforeUpdate:$,updated:te,activated:Q,deactivated:de,beforeDestroy:Ce,beforeUnmount:Fe,destroyed:Le,unmounted:Me,render:at,renderTracked:pt,renderTriggered:me,errorCaptured:ye,serverPrefetch:Se,expose:ke,inheritAttrs:Ve,components:He,directives:Oe,filters:xi}=e;if(R&&aq(R,o,null),y)for(const ri in y){const Si=y[ri];dn(Si)&&(o[ri]=Si.bind(t))}if(c){const ri=c.call(t,t);Js(ri)&&(r.data=XT(ri))}if(n5=!0,f)for(const ri in f){const Si=f[ri],ir=dn(Si)?Si.bind(t,t):dn(Si.get)?Si.get.bind(t,t):lh,st=!dn(Si)&&dn(Si.set)?Si.set.bind(t):lh,wi=fa({get:ir,set:st});Object.defineProperty(o,ri,{enumerable:!0,configurable:!0,get:()=>wi.value,set:ji=>wi.value=ji})}if(s)for(const ri in s)Az(s[ri],o,t,ri);if(E){const ri=dn(E)?E.call(t):E;Reflect.ownKeys(ri).forEach(Si=>{f2(Si,ri[Si])})}O&&E3(O,r,"c");function ti(ri,Si){sn(Si)?Si.forEach(ir=>ri(ir.bind(t))):Si&&ri(Si.bind(t))}if(ti(KH,A),ti(hC,U),ti(YH,$),ti(JH,te),ti(WH,Q),ti(XH,de),ti(iq,ye),ti(tq,pt),ti(eq,me),ti(QH,Fe),ti(Ez,Me),ti(Iz,Se),sn(ke))if(ke.length){const ri=r.exposed||(r.exposed={});ke.forEach(Si=>{Object.defineProperty(ri,Si,{get:()=>t[Si],set:ir=>t[Si]=ir,enumerable:!0})})}else r.exposed||(r.exposed={});at&&r.render===lh&&(r.render=at),Ve!=null&&(r.inheritAttrs=Ve),He&&(r.components=He),Oe&&(r.directives=Oe),Se&&bz(r)}function aq(r,e,t=lh){sn(r)&&(r=s5(r));for(const o in r){const c=r[o];let f;Js(c)?"default"in c?f=Al(c.from||o,c.default,!0):f=Al(c.from||o):f=Al(c),ga(f)?Object.defineProperty(e,o,{enumerable:!0,configurable:!0,get:()=>f.value,set:y=>f.value=y}):e[o]=f}}function E3(r,e,t){gh(sn(r)?r.map(o=>o.bind(e.proxy)):r.bind(e.proxy),e,t)}function Az(r,e,t,o){let c=o.includes(".")?Uz(t,o):()=>t[o];if(ko(r)){const f=e[r];dn(f)&&Hf(c,f)}else if(dn(r))Hf(c,r.bind(t));else if(Js(r))if(sn(r))r.forEach(f=>Az(f,e,t,o));else{const f=dn(r.handler)?r.handler.bind(t):e[r.handler];dn(f)&&Hf(c,f,r)}}function Cz(r){const e=r.type,{mixins:t,extends:o}=e,{mixins:c,optionsCache:f,config:{optionMergeStrategies:y}}=r.appContext,s=f.get(e);let E;return s?E=s:!c.length&&!t&&!o?E=e:(E={},c.length&&c.forEach(R=>j2(E,R,y,!0)),j2(E,e,y)),Js(e)&&f.set(e,E),E}function j2(r,e,t,o=!1){const{mixins:c,extends:f}=e;f&&j2(r,f,t,!0),c&&c.forEach(y=>j2(r,y,t,!0));for(const y in e)if(!(o&&y==="expose")){const s=lq[y]||t&&t[y];r[y]=s?s(r[y],e[y]):e[y]}return r}const lq={data:I3,props:S3,emits:S3,methods:Zv,computed:Zv,beforeCreate:al,created:al,beforeMount:al,mounted:al,beforeUpdate:al,updated:al,beforeDestroy:al,beforeUnmount:al,destroyed:al,unmounted:al,activated:al,deactivated:al,errorCaptured:al,serverPrefetch:al,components:Zv,directives:Zv,watch:uq,provide:I3,inject:cq};function I3(r,e){return e?r?function(){return qa(dn(r)?r.call(this,this):r,dn(e)?e.call(this,this):e)}:e:r}function cq(r,e){return Zv(s5(r),s5(e))}function s5(r){if(sn(r)){const e={};for(let t=0;t<r.length;t++)e[r[t]]=r[t];return e}return r}function al(r,e){return r?[...new Set([].concat(r,e))]:e}function Zv(r,e){return r?qa(Object.create(null),r,e):e}function S3(r,e){return r?sn(r)&&sn(e)?[...new Set([...r,...e])]:qa(Object.create(null),T3(r),T3(e??{})):e}function uq(r,e){if(!r)return e;if(!e)return r;const t=qa(Object.create(null),r);for(const o in e)t[o]=al(r[o],e[o]);return t}function Rz(){return{app:null,config:{isNativeTag:zF,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let hq=0;function dq(r,e){return function(o,c=null){dn(o)||(o=qa({},o)),c!=null&&!Js(c)&&(c=null);const f=Rz(),y=new WeakSet,s=[];let E=!1;const R=f.app={_uid:hq++,_component:o,_props:c,_container:null,_context:f,_instance:null,version:qq,get config(){return f.config},set config(O){},use(O,...A){return y.has(O)||(O&&dn(O.install)?(y.add(O),O.install(R,...A)):dn(O)&&(y.add(O),O(R,...A))),R},mixin(O){return f.mixins.includes(O)||f.mixins.push(O),R},component(O,A){return A?(f.components[O]=A,R):f.components[O]},directive(O,A){return A?(f.directives[O]=A,R):f.directives[O]},mount(O,A,U){if(!E){const $=R._ceVNode||Bs(o,c);return $.appContext=f,U===!0?U="svg":U===!1&&(U=void 0),r($,O,U),E=!0,R._container=O,O.__vue_app__=R,QT($.component)}},onUnmount(O){s.push(O)},unmount(){E&&(gh(s,R._instance,16),r(null,R._container),delete R._container.__vue_app__)},provide(O,A){return f.provides[O]=A,R},runWithContext(O){const A=Kg;Kg=R;try{return O()}finally{Kg=A}}};return R}}let Kg=null;function f2(r,e){if(ml){let t=ml.provides;const o=ml.parent&&ml.parent.provides;o===t&&(t=ml.provides=Object.create(o)),t[r]=e}}function Al(r,e,t=!1){const o=mC();if(o||Kg){let c=Kg?Kg._context.provides:o?o.parent==null||o.ce?o.vnode.appContext&&o.vnode.appContext.provides:o.parent.provides:void 0;if(c&&r in c)return c[r];if(arguments.length>1)return t&&dn(e)?e.call(o&&o.proxy):e}}const Pz={},Mz=()=>Object.create(Pz),kz=r=>Object.getPrototypeOf(r)===Pz;function fq(r,e,t,o=!1){const c={},f=Mz();r.propsDefaults=Object.create(null),Dz(r,e,c,f);for(const y in r.propsOptions[0])y in c||(c[y]=void 0);t?r.props=o?c:uz(c):r.type.props?r.props=c:r.props=f,r.attrs=f}function pq(r,e,t,o){const{props:c,attrs:f,vnode:{patchFlag:y}}=r,s=ds(c),[E]=r.propsOptions;let R=!1;if((o||y>0)&&!(y&16)){if(y&8){const O=r.vnode.dynamicProps;for(let A=0;A<O.length;A++){let U=O[A];if(YT(r.emitsOptions,U))continue;const $=e[U];if(E)if(fs(f,U))$!==f[U]&&(f[U]=$,R=!0);else{const te=ep(U);c[te]=o5(E,s,te,$,r,!1)}else $!==f[U]&&(f[U]=$,R=!0)}}}else{Dz(r,e,c,f)&&(R=!0);let O;for(const A in s)(!e||!fs(e,A)&&((O=Gm(A))===A||!fs(e,O)))&&(E?t&&(t[A]!==void 0||t[O]!==void 0)&&(c[A]=o5(E,s,A,void 0,r,!0)):delete c[A]);if(f!==s)for(const A in f)(!e||!fs(e,A))&&(delete f[A],R=!0)}R&&hd(r.attrs,"set","")}function Dz(r,e,t,o){const[c,f]=r.propsOptions;let y=!1,s;if(e)for(let E in e){if(h1(E))continue;const R=e[E];let O;c&&fs(c,O=ep(E))?!f||!f.includes(O)?t[O]=R:(s||(s={}))[O]=R:YT(r.emitsOptions,E)||(!(E in o)||R!==o[E])&&(o[E]=R,y=!0)}if(f){const E=ds(t),R=s||Ps;for(let O=0;O<f.length;O++){const A=f[O];t[A]=o5(c,E,A,R[A],r,!fs(R,A))}}return y}function o5(r,e,t,o,c,f){const y=r[t];if(y!=null){const s=fs(y,"default");if(s&&o===void 0){const E=y.default;if(y.type!==Function&&!y.skipFactory&&dn(E)){const{propsDefaults:R}=c;if(t in R)o=R[t];else{const O=Ax(c);o=R[t]=E.call(null,e),O()}}else o=E;c.ce&&c.ce._setProp(t,o)}y[0]&&(f&&!s?o=!1:y[1]&&(o===""||o===Gm(t))&&(o=!0))}return o}const mq=new WeakMap;function Lz(r,e,t=!1){const o=t?mq:e.propsCache,c=o.get(r);if(c)return c;const f=r.props,y={},s=[];let E=!1;if(!dn(r)){const O=A=>{E=!0;const[U,$]=Lz(A,e,!0);qa(y,U),$&&s.push(...$)};!t&&e.mixins.length&&e.mixins.forEach(O),r.extends&&O(r.extends),r.mixins&&r.mixins.forEach(O)}if(!f&&!E)return Js(r)&&o.set(r,Hg),Hg;if(sn(f))for(let O=0;O<f.length;O++){const A=ep(f[O]);A3(A)&&(y[A]=Ps)}else if(f)for(const O in f){const A=ep(O);if(A3(A)){const U=f[O],$=y[A]=sn(U)||dn(U)?{type:U}:qa({},U),te=$.type;let Q=!1,de=!0;if(sn(te))for(let Ce=0;Ce<te.length;++Ce){const Fe=te[Ce],Le=dn(Fe)&&Fe.name;if(Le==="Boolean"){Q=!0;break}else Le==="String"&&(de=!1)}else Q=dn(te)&&te.name==="Boolean";$[0]=Q,$[1]=de,(Q||fs($,"default"))&&s.push(A)}}const R=[y,s];return Js(r)&&o.set(r,R),R}function A3(r){return r[0]!=="$"&&!h1(r)}const dC=r=>r==="_"||r==="_ctx"||r==="$stable",fC=r=>sn(r)?r.map(th):[th(r)],_q=(r,e,t)=>{if(e._n)return e;const o=c0((...c)=>fC(e(...c)),t);return o._c=!1,o},Oz=(r,e,t)=>{const o=r._ctx;for(const c in r){if(dC(c))continue;const f=r[c];if(dn(f))e[c]=_q(c,f,o);else if(f!=null){const y=fC(f);e[c]=()=>y}}},Fz=(r,e)=>{const t=fC(e);r.slots.default=()=>t},zz=(r,e,t)=>{for(const o in e)(t||!dC(o))&&(r[o]=e[o])},gq=(r,e,t)=>{const o=r.slots=Mz();if(r.vnode.shapeFlag&32){const c=e._;c?(zz(o,e,t),t&&$F(o,"_",c,!0)):Oz(e,o)}else e&&Fz(r,e)},yq=(r,e,t)=>{const{vnode:o,slots:c}=r;let f=!0,y=Ps;if(o.shapeFlag&32){const s=e._;s?t&&s===1?f=!1:zz(c,e,t):(f=!e.$stable,Oz(e,c)),y=e}else e&&(Fz(r,e),y={default:1});if(f)for(const s in c)!dC(s)&&y[s]==null&&delete c[s]},Xl=Dq;function vq(r){return xq(r)}function xq(r,e){const t=qT();t.__VUE__=!0;const{insert:o,remove:c,patchProp:f,createElement:y,createText:s,createComment:E,setText:R,setElementText:O,parentNode:A,nextSibling:U,setScopeId:$=lh,insertStaticContent:te}=r,Q=(Be,Ge,Qe,ht=null,Et=null,Ue=null,ii=void 0,Ht=null,Jt=!!Ge.dynamicChildren)=>{if(Be===Ge)return;Be&&!Lv(Be,Ge)&&(ht=vt(Be),ji(Be,Et,Ue,!0),Be=null),Ge.patchFlag===-2&&(Jt=!1,Ge.dynamicChildren=null);const{type:Lt,ref:Ai,shapeFlag:ni}=Ge;switch(Lt){case JT:de(Be,Ge,Qe,ht);break;case Id:Ce(Be,Ge,Qe,ht);break;case KS:Be==null&&Fe(Ge,Qe,ht,ii);break;case Po:He(Be,Ge,Qe,ht,Et,Ue,ii,Ht,Jt);break;default:ni&1?at(Be,Ge,Qe,ht,Et,Ue,ii,Ht,Jt):ni&6?Oe(Be,Ge,Qe,ht,Et,Ue,ii,Ht,Jt):(ni&64||ni&128)&&Lt.process(Be,Ge,Qe,ht,Et,Ue,ii,Ht,Jt,ai)}Ai!=null&&Et?p1(Ai,Be&&Be.ref,Ue,Ge||Be,!Ge):Ai==null&&Be&&Be.ref!=null&&p1(Be.ref,null,Ue,Be,!0)},de=(Be,Ge,Qe,ht)=>{if(Be==null)o(Ge.el=s(Ge.children),Qe,ht);else{const Et=Ge.el=Be.el;Ge.children!==Be.children&&R(Et,Ge.children)}},Ce=(Be,Ge,Qe,ht)=>{Be==null?o(Ge.el=E(Ge.children||""),Qe,ht):Ge.el=Be.el},Fe=(Be,Ge,Qe,ht)=>{[Be.el,Be.anchor]=te(Be.children,Ge,Qe,ht,Be.el,Be.anchor)},Le=({el:Be,anchor:Ge},Qe,ht)=>{let Et;for(;Be&&Be!==Ge;)Et=U(Be),o(Be,Qe,ht),Be=Et;o(Ge,Qe,ht)},Me=({el:Be,anchor:Ge})=>{let Qe;for(;Be&&Be!==Ge;)Qe=U(Be),c(Be),Be=Qe;c(Ge)},at=(Be,Ge,Qe,ht,Et,Ue,ii,Ht,Jt)=>{Ge.type==="svg"?ii="svg":Ge.type==="math"&&(ii="mathml"),Be==null?pt(Ge,Qe,ht,Et,Ue,ii,Ht,Jt):Se(Be,Ge,Et,Ue,ii,Ht,Jt)},pt=(Be,Ge,Qe,ht,Et,Ue,ii,Ht)=>{let Jt,Lt;const{props:Ai,shapeFlag:ni,transition:bi,dirs:Ci}=Be;if(Jt=Be.el=y(Be.type,Ue,Ai&&Ai.is,Ai),ni&8?O(Jt,Be.children):ni&16&&ye(Be.children,Jt,null,ht,Et,ZS(Be,Ue),ii,Ht),Ci&&Zp(Be,null,ht,"created"),me(Jt,Be,Be.scopeId,ii,ht),Ai){for(const Ei in Ai)Ei!=="value"&&!h1(Ei)&&f(Jt,Ei,null,Ai[Ei],Ue,ht);"value"in Ai&&f(Jt,"value",null,Ai.value,Ue),(Lt=Ai.onVnodeBeforeMount)&&Yu(Lt,ht,Be)}Ci&&Zp(Be,null,ht,"beforeMount");const Ti=bq(Et,bi);Ti&&bi.beforeEnter(Jt),o(Jt,Ge,Qe),((Lt=Ai&&Ai.onVnodeMounted)||Ti||Ci)&&Xl(()=>{Lt&&Yu(Lt,ht,Be),Ti&&bi.enter(Jt),Ci&&Zp(Be,null,ht,"mounted")},Et)},me=(Be,Ge,Qe,ht,Et)=>{if(Qe&&$(Be,Qe),ht)for(let Ue=0;Ue<ht.length;Ue++)$(Be,ht[Ue]);if(Et){let Ue=Et.subTree;if(Ge===Ue||$z(Ue.type)&&(Ue.ssContent===Ge||Ue.ssFallback===Ge)){const ii=Et.vnode;me(Be,ii,ii.scopeId,ii.slotScopeIds,Et.parent)}}},ye=(Be,Ge,Qe,ht,Et,Ue,ii,Ht,Jt=0)=>{for(let Lt=Jt;Lt<Be.length;Lt++){const Ai=Be[Lt]=Ht?Mf(Be[Lt]):th(Be[Lt]);Q(null,Ai,Ge,Qe,ht,Et,Ue,ii,Ht)}},Se=(Be,Ge,Qe,ht,Et,Ue,ii)=>{const Ht=Ge.el=Be.el;let{patchFlag:Jt,dynamicChildren:Lt,dirs:Ai}=Ge;Jt|=Be.patchFlag&16;const ni=Be.props||Ps,bi=Ge.props||Ps;let Ci;if(Qe&&Kp(Qe,!1),(Ci=bi.onVnodeBeforeUpdate)&&Yu(Ci,Qe,Ge,Be),Ai&&Zp(Ge,Be,Qe,"beforeUpdate"),Qe&&Kp(Qe,!0),(ni.innerHTML&&bi.innerHTML==null||ni.textContent&&bi.textContent==null)&&O(Ht,""),Lt?ke(Be.dynamicChildren,Lt,Ht,Qe,ht,ZS(Ge,Et),Ue):ii||Si(Be,Ge,Ht,null,Qe,ht,ZS(Ge,Et),Ue,!1),Jt>0){if(Jt&16)Ve(Ht,ni,bi,Qe,Et);else if(Jt&2&&ni.class!==bi.class&&f(Ht,"class",null,bi.class,Et),Jt&4&&f(Ht,"style",ni.style,bi.style,Et),Jt&8){const Ti=Ge.dynamicProps;for(let Ei=0;Ei<Ti.length;Ei++){const hr=Ti[Ei],wr=ni[hr],on=bi[hr];(on!==wr||hr==="value")&&f(Ht,hr,wr,on,Et,Qe)}}Jt&1&&Be.children!==Ge.children&&O(Ht,Ge.children)}else!ii&&Lt==null&&Ve(Ht,ni,bi,Qe,Et);((Ci=bi.onVnodeUpdated)||Ai)&&Xl(()=>{Ci&&Yu(Ci,Qe,Ge,Be),Ai&&Zp(Ge,Be,Qe,"updated")},ht)},ke=(Be,Ge,Qe,ht,Et,Ue,ii)=>{for(let Ht=0;Ht<Ge.length;Ht++){const Jt=Be[Ht],Lt=Ge[Ht],Ai=Jt.el&&(Jt.type===Po||!Lv(Jt,Lt)||Jt.shapeFlag&198)?A(Jt.el):Qe;Q(Jt,Lt,Ai,null,ht,Et,Ue,ii,!0)}},Ve=(Be,Ge,Qe,ht,Et)=>{if(Ge!==Qe){if(Ge!==Ps)for(const Ue in Ge)!h1(Ue)&&!(Ue in Qe)&&f(Be,Ue,Ge[Ue],null,Et,ht);for(const Ue in Qe){if(h1(Ue))continue;const ii=Qe[Ue],Ht=Ge[Ue];ii!==Ht&&Ue!=="value"&&f(Be,Ue,Ht,ii,Et,ht)}"value"in Qe&&f(Be,"value",Ge.value,Qe.value,Et)}},He=(Be,Ge,Qe,ht,Et,Ue,ii,Ht,Jt)=>{const Lt=Ge.el=Be?Be.el:s(""),Ai=Ge.anchor=Be?Be.anchor:s("");let{patchFlag:ni,dynamicChildren:bi,slotScopeIds:Ci}=Ge;Ci&&(Ht=Ht?Ht.concat(Ci):Ci),Be==null?(o(Lt,Qe,ht),o(Ai,Qe,ht),ye(Ge.children||[],Qe,Ai,Et,Ue,ii,Ht,Jt)):ni>0&&ni&64&&bi&&Be.dynamicChildren?(ke(Be.dynamicChildren,bi,Qe,Et,Ue,ii,Ht),(Ge.key!=null||Et&&Ge===Et.subTree)&&Nz(Be,Ge,!0)):Si(Be,Ge,Qe,Ai,Et,Ue,ii,Ht,Jt)},Oe=(Be,Ge,Qe,ht,Et,Ue,ii,Ht,Jt)=>{Ge.slotScopeIds=Ht,Be==null?Ge.shapeFlag&512?Et.ctx.activate(Ge,Qe,ht,ii,Jt):xi(Ge,Qe,ht,Et,Ue,ii,Jt):ui(Be,Ge,Jt)},xi=(Be,Ge,Qe,ht,Et,Ue,ii)=>{const Ht=Be.component=Vq(Be,ht,Et);if(wz(Be)&&(Ht.ctx.renderer=ai),Uq(Ht,!1,ii),Ht.asyncDep){if(Et&&Et.registerDep(Ht,ti,ii),!Be.el){const Jt=Ht.subTree=Bs(Id);Ce(null,Jt,Ge,Qe),Be.placeholder=Jt.el}}else ti(Ht,Be,Ge,Qe,Et,Ue,ii)},ui=(Be,Ge,Qe)=>{const ht=Ge.component=Be.component;if(Mq(Be,Ge,Qe))if(ht.asyncDep&&!ht.asyncResolved){ri(ht,Ge,Qe);return}else ht.next=Ge,ht.update();else Ge.el=Be.el,ht.vnode=Ge},ti=(Be,Ge,Qe,ht,Et,Ue,ii)=>{const Ht=()=>{if(Be.isMounted){let{next:ni,bu:bi,u:Ci,parent:Ti,vnode:Ei}=Be;{const _r=Bz(Be);if(_r){ni&&(ni.el=Ei.el,ri(Be,ni,ii)),_r.asyncDep.then(()=>{Be.isUnmounted||Ht()});return}}let hr=ni,wr;Kp(Be,!1),ni?(ni.el=Ei.el,ri(Be,ni,ii)):ni=Ei,bi&&d2(bi),(wr=ni.props&&ni.props.onVnodeBeforeUpdate)&&Yu(wr,Ti,ni,Ei),Kp(Be,!0);const on=R3(Be),Jr=Be.subTree;Be.subTree=on,Q(Jr,on,A(Jr.el),vt(Jr),Be,Et,Ue),ni.el=on.el,hr===null&&kq(Be,on.el),Ci&&Xl(Ci,Et),(wr=ni.props&&ni.props.onVnodeUpdated)&&Xl(()=>Yu(wr,Ti,ni,Ei),Et)}else{let ni;const{el:bi,props:Ci}=Ge,{bm:Ti,m:Ei,parent:hr,root:wr,type:on}=Be,Jr=Zg(Ge);Kp(Be,!1),Ti&&d2(Ti),!Jr&&(ni=Ci&&Ci.onVnodeBeforeMount)&&Yu(ni,hr,Ge),Kp(Be,!0);{wr.ce&&wr.ce._def.shadowRoot!==!1&&wr.ce._injectChildStyle(on);const _r=Be.subTree=R3(Be);Q(null,_r,Qe,ht,Be,Et,Ue),Ge.el=_r.el}if(Ei&&Xl(Ei,Et),!Jr&&(ni=Ci&&Ci.onVnodeMounted)){const _r=Ge;Xl(()=>Yu(ni,hr,_r),Et)}(Ge.shapeFlag&256||hr&&Zg(hr.vnode)&&hr.vnode.shapeFlag&256)&&Be.a&&Xl(Be.a,Et),Be.isMounted=!0,Ge=Qe=ht=null}};Be.scope.on();const Jt=Be.effect=new KF(Ht);Be.scope.off();const Lt=Be.update=Jt.run.bind(Jt),Ai=Be.job=Jt.runIfDirty.bind(Jt);Ai.i=Be,Ai.id=Be.uid,Jt.scheduler=()=>cC(Ai),Kp(Be,!0),Lt()},ri=(Be,Ge,Qe)=>{Ge.component=Be;const ht=Be.vnode.props;Be.vnode=Ge,Be.next=null,pq(Be,Ge.props,ht,Qe),yq(Be,Ge.children,Qe),Td(),b3(Be),Ed()},Si=(Be,Ge,Qe,ht,Et,Ue,ii,Ht,Jt=!1)=>{const Lt=Be&&Be.children,Ai=Be?Be.shapeFlag:0,ni=Ge.children,{patchFlag:bi,shapeFlag:Ci}=Ge;if(bi>0){if(bi&128){st(Lt,ni,Qe,ht,Et,Ue,ii,Ht,Jt);return}else if(bi&256){ir(Lt,ni,Qe,ht,Et,Ue,ii,Ht,Jt);return}}Ci&8?(Ai&16&&Ni(Lt,Et,Ue),ni!==Lt&&O(Qe,ni)):Ai&16?Ci&16?st(Lt,ni,Qe,ht,Et,Ue,ii,Ht,Jt):Ni(Lt,Et,Ue,!0):(Ai&8&&O(Qe,""),Ci&16&&ye(ni,Qe,ht,Et,Ue,ii,Ht,Jt))},ir=(Be,Ge,Qe,ht,Et,Ue,ii,Ht,Jt)=>{Be=Be||Hg,Ge=Ge||Hg;const Lt=Be.length,Ai=Ge.length,ni=Math.min(Lt,Ai);let bi;for(bi=0;bi<ni;bi++){const Ci=Ge[bi]=Jt?Mf(Ge[bi]):th(Ge[bi]);Q(Be[bi],Ci,Qe,null,Et,Ue,ii,Ht,Jt)}Lt>Ai?Ni(Be,Et,Ue,!0,!1,ni):ye(Ge,Qe,ht,Et,Ue,ii,Ht,Jt,ni)},st=(Be,Ge,Qe,ht,Et,Ue,ii,Ht,Jt)=>{let Lt=0;const Ai=Ge.length;let ni=Be.length-1,bi=Ai-1;for(;Lt<=ni&&Lt<=bi;){const Ci=Be[Lt],Ti=Ge[Lt]=Jt?Mf(Ge[Lt]):th(Ge[Lt]);if(Lv(Ci,Ti))Q(Ci,Ti,Qe,null,Et,Ue,ii,Ht,Jt);else break;Lt++}for(;Lt<=ni&&Lt<=bi;){const Ci=Be[ni],Ti=Ge[bi]=Jt?Mf(Ge[bi]):th(Ge[bi]);if(Lv(Ci,Ti))Q(Ci,Ti,Qe,null,Et,Ue,ii,Ht,Jt);else break;ni--,bi--}if(Lt>ni){if(Lt<=bi){const Ci=bi+1,Ti=Ci<Ai?Ge[Ci].el:ht;for(;Lt<=bi;)Q(null,Ge[Lt]=Jt?Mf(Ge[Lt]):th(Ge[Lt]),Qe,Ti,Et,Ue,ii,Ht,Jt),Lt++}}else if(Lt>bi)for(;Lt<=ni;)ji(Be[Lt],Et,Ue,!0),Lt++;else{const Ci=Lt,Ti=Lt,Ei=new Map;for(Lt=Ti;Lt<=bi;Lt++){const xn=Ge[Lt]=Jt?Mf(Ge[Lt]):th(Ge[Lt]);xn.key!=null&&Ei.set(xn.key,Lt)}let hr,wr=0;const on=bi-Ti+1;let Jr=!1,_r=0;const Es=new Array(on);for(Lt=0;Lt<on;Lt++)Es[Lt]=0;for(Lt=Ci;Lt<=ni;Lt++){const xn=Be[Lt];if(wr>=on){ji(xn,Et,Ue,!0);continue}let ss;if(xn.key!=null)ss=Ei.get(xn.key);else for(hr=Ti;hr<=bi;hr++)if(Es[hr-Ti]===0&&Lv(xn,Ge[hr])){ss=hr;break}ss===void 0?ji(xn,Et,Ue,!0):(Es[ss-Ti]=Lt+1,ss>=_r?_r=ss:Jr=!0,Q(xn,Ge[ss],Qe,null,Et,Ue,ii,Ht,Jt),wr++)}const es=Jr?wq(Es):Hg;for(hr=es.length-1,Lt=on-1;Lt>=0;Lt--){const xn=Ti+Lt,ss=Ge[xn],Qs=Ge[xn+1],jr=xn+1<Ai?Qs.el||Qs.placeholder:ht;Es[Lt]===0?Q(null,ss,Qe,jr,Et,Ue,ii,Ht,Jt):Jr&&(hr<0||Lt!==es[hr]?wi(ss,Qe,jr,2):hr--)}}},wi=(Be,Ge,Qe,ht,Et=null)=>{const{el:Ue,type:ii,transition:Ht,children:Jt,shapeFlag:Lt}=Be;if(Lt&6){wi(Be.component.subTree,Ge,Qe,ht);return}if(Lt&128){Be.suspense.move(Ge,Qe,ht);return}if(Lt&64){ii.move(Be,Ge,Qe,ai);return}if(ii===Po){o(Ue,Ge,Qe);for(let ni=0;ni<Jt.length;ni++)wi(Jt[ni],Ge,Qe,ht);o(Be.anchor,Ge,Qe);return}if(ii===KS){Le(Be,Ge,Qe);return}if(ht!==2&&Lt&1&&Ht)if(ht===0)Ht.beforeEnter(Ue),o(Ue,Ge,Qe),Xl(()=>Ht.enter(Ue),Et);else{const{leave:ni,delayLeave:bi,afterLeave:Ci}=Ht,Ti=()=>{Be.ctx.isUnmounted?c(Ue):o(Ue,Ge,Qe)},Ei=()=>{Ue._isLeaving&&Ue[qH](!0),ni(Ue,()=>{Ti(),Ci&&Ci()})};bi?bi(Ue,Ti,Ei):Ei()}else o(Ue,Ge,Qe)},ji=(Be,Ge,Qe,ht=!1,Et=!1)=>{const{type:Ue,props:ii,ref:Ht,children:Jt,dynamicChildren:Lt,shapeFlag:Ai,patchFlag:ni,dirs:bi,cacheIndex:Ci}=Be;if(ni===-2&&(Et=!1),Ht!=null&&(Td(),p1(Ht,null,Qe,Be,!0),Ed()),Ci!=null&&(Ge.renderCache[Ci]=void 0),Ai&256){Ge.ctx.deactivate(Be);return}const Ti=Ai&1&&bi,Ei=!Zg(Be);let hr;if(Ei&&(hr=ii&&ii.onVnodeBeforeUnmount)&&Yu(hr,Ge,Be),Ai&6)Vr(Be.component,Qe,ht);else{if(Ai&128){Be.suspense.unmount(Qe,ht);return}Ti&&Zp(Be,null,Ge,"beforeUnmount"),Ai&64?Be.type.remove(Be,Ge,Qe,ai,ht):Lt&&!Lt.hasOnce&&(Ue!==Po||ni>0&&ni&64)?Ni(Lt,Ge,Qe,!1,!0):(Ue===Po&&ni&384||!Et&&Ai&16)&&Ni(Jt,Ge,Qe),ht&&Ar(Be)}(Ei&&(hr=ii&&ii.onVnodeUnmounted)||Ti)&&Xl(()=>{hr&&Yu(hr,Ge,Be),Ti&&Zp(Be,null,Ge,"unmounted")},Qe)},Ar=Be=>{const{type:Ge,el:Qe,anchor:ht,transition:Et}=Be;if(Ge===Po){Br(Qe,ht);return}if(Ge===KS){Me(Be);return}const Ue=()=>{c(Qe),Et&&!Et.persisted&&Et.afterLeave&&Et.afterLeave()};if(Be.shapeFlag&1&&Et&&!Et.persisted){const{leave:ii,delayLeave:Ht}=Et,Jt=()=>ii(Qe,Ue);Ht?Ht(Be.el,Ue,Jt):Jt()}else Ue()},Br=(Be,Ge)=>{let Qe;for(;Be!==Ge;)Qe=U(Be),c(Be),Be=Qe;c(Ge)},Vr=(Be,Ge,Qe)=>{const{bum:ht,scope:Et,job:Ue,subTree:ii,um:Ht,m:Jt,a:Lt}=Be;C3(Jt),C3(Lt),ht&&d2(ht),Et.stop(),Ue&&(Ue.flags|=8,ji(ii,Be,Ge,Qe)),Ht&&Xl(Ht,Ge),Xl(()=>{Be.isUnmounted=!0},Ge)},Ni=(Be,Ge,Qe,ht=!1,Et=!1,Ue=0)=>{for(let ii=Ue;ii<Be.length;ii++)ji(Be[ii],Ge,Qe,ht,Et)},vt=Be=>{if(Be.shapeFlag&6)return vt(Be.component.subTree);if(Be.shapeFlag&128)return Be.suspense.next();const Ge=U(Be.anchor||Be.el),Qe=Ge&&Ge[GH];return Qe?U(Qe):Ge};let Wt=!1;const Xt=(Be,Ge,Qe)=>{Be==null?Ge._vnode&&ji(Ge._vnode,null,null,!0):Q(Ge._vnode||null,Be,Ge,null,null,null,Qe),Ge._vnode=Be,Wt||(Wt=!0,b3(),yz(),Wt=!1)},ai={p:Q,um:ji,m:wi,r:Ar,mt:xi,mc:ye,pc:Si,pbc:ke,n:vt,o:r};return{render:Xt,hydrate:void 0,createApp:dq(Xt)}}function ZS({type:r,props:e},t){return t==="svg"&&r==="foreignObject"||t==="mathml"&&r==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Kp({effect:r,job:e},t){t?(r.flags|=32,e.flags|=4):(r.flags&=-33,e.flags&=-5)}function bq(r,e){return(!r||r&&!r.pendingBranch)&&e&&!e.persisted}function Nz(r,e,t=!1){const o=r.children,c=e.children;if(sn(o)&&sn(c))for(let f=0;f<o.length;f++){const y=o[f];let s=c[f];s.shapeFlag&1&&!s.dynamicChildren&&((s.patchFlag<=0||s.patchFlag===32)&&(s=c[f]=Mf(c[f]),s.el=y.el),!t&&s.patchFlag!==-2&&Nz(y,s)),s.type===JT&&s.patchFlag!==-1&&(s.el=y.el),s.type===Id&&!s.el&&(s.el=y.el)}}function wq(r){const e=r.slice(),t=[0];let o,c,f,y,s;const E=r.length;for(o=0;o<E;o++){const R=r[o];if(R!==0){if(c=t[t.length-1],r[c]<R){e[o]=c,t.push(o);continue}for(f=0,y=t.length-1;f<y;)s=f+y>>1,r[t[s]]<R?f=s+1:y=s;R<r[t[f]]&&(f>0&&(e[o]=t[f-1]),t[f]=o)}}for(f=t.length,y=t[f-1];f-- >0;)t[f]=y,y=e[y];return t}function Bz(r){const e=r.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Bz(e)}function C3(r){if(r)for(let e=0;e<r.length;e++)r[e].flags|=8}const Tq=Symbol.for("v-scx"),Eq=()=>Al(Tq);function Hf(r,e,t){return Vz(r,e,t)}function Vz(r,e,t=Ps){const{immediate:o,deep:c,flush:f,once:y}=t,s=qa({},t),E=e&&o||!e&&f!=="post";let R;if(X1){if(f==="sync"){const $=Eq();R=$.__watcherHandles||($.__watcherHandles=[])}else if(!E){const $=()=>{};return $.stop=lh,$.resume=lh,$.pause=lh,$}}const O=ml;s.call=($,te,Q)=>gh($,O,te,Q);let A=!1;f==="post"?s.scheduler=$=>{Xl($,O&&O.suspense)}:f!=="sync"&&(A=!0,s.scheduler=($,te)=>{te?$():cC($)}),s.augmentJob=$=>{e&&($.flags|=4),A&&($.flags|=2,O&&($.id=O.uid,$.i=O))};const U=VH(r,e,s);return X1&&(R?R.push(U):E&&U()),U}function Iq(r,e,t){const o=this.proxy,c=ko(r)?r.includes(".")?Uz(o,r):()=>o[r]:r.bind(o,o);let f;dn(e)?f=e:(f=e.handler,t=e);const y=Ax(this),s=Vz(c,f.bind(o),t);return y(),s}function Uz(r,e){const t=e.split(".");return()=>{let o=r;for(let c=0;c<t.length&&o;c++)o=o[t[c]];return o}}const Sq=(r,e)=>e==="modelValue"||e==="model-value"?r.modelModifiers:r[`${e}Modifiers`]||r[`${ep(e)}Modifiers`]||r[`${Gm(e)}Modifiers`];function Aq(r,e,...t){if(r.isUnmounted)return;const o=r.vnode.props||Ps;let c=t;const f=e.startsWith("update:"),y=f&&Sq(o,e.slice(7));y&&(y.trim&&(c=t.map(O=>ko(O)?O.trim():O)),y.number&&(c=t.map(JA)));let s,E=o[s=$S(e)]||o[s=$S(ep(e))];!E&&f&&(E=o[s=$S(Gm(e))]),E&&gh(E,r,6,c);const R=o[s+"Once"];if(R){if(!r.emitted)r.emitted={};else if(r.emitted[s])return;r.emitted[s]=!0,gh(R,r,6,c)}}const Cq=new WeakMap;function jz(r,e,t=!1){const o=t?Cq:e.emitsCache,c=o.get(r);if(c!==void 0)return c;const f=r.emits;let y={},s=!1;if(!dn(r)){const E=R=>{const O=jz(R,e,!0);O&&(s=!0,qa(y,O))};!t&&e.mixins.length&&e.mixins.forEach(E),r.extends&&E(r.extends),r.mixins&&r.mixins.forEach(E)}return!f&&!s?(Js(r)&&o.set(r,null),null):(sn(f)?f.forEach(E=>y[E]=null):qa(y,f),Js(r)&&o.set(r,y),y)}function YT(r,e){return!r||!$T(e)?!1:(e=e.slice(2).replace(/Once$/,""),fs(r,e[0].toLowerCase()+e.slice(1))||fs(r,Gm(e))||fs(r,e))}function R3(r){const{type:e,vnode:t,proxy:o,withProxy:c,propsOptions:[f],slots:y,attrs:s,emit:E,render:R,renderCache:O,props:A,data:U,setupState:$,ctx:te,inheritAttrs:Q}=r,de=V2(r);let Ce,Fe;try{if(t.shapeFlag&4){const Me=c||o,at=Me;Ce=th(R.call(at,Me,O,A,$,U,te)),Fe=s}else{const Me=e;Ce=th(Me.length>1?Me(A,{attrs:s,slots:y,emit:E}):Me(A,null)),Fe=e.props?s:Rq(s)}}catch(Me){_1.length=0,ZT(Me,r,1),Ce=Bs(Id)}let Le=Ce;if(Fe&&Q!==!1){const Me=Object.keys(Fe),{shapeFlag:at}=Le;Me.length&&at&7&&(f&&Me.some(Y4)&&(Fe=Pq(Fe,f)),Le=h0(Le,Fe,!1,!0))}return t.dirs&&(Le=h0(Le,null,!1,!0),Le.dirs=Le.dirs?Le.dirs.concat(t.dirs):t.dirs),t.transition&&uC(Le,t.transition),Ce=Le,V2(de),Ce}const Rq=r=>{let e;for(const t in r)(t==="class"||t==="style"||$T(t))&&((e||(e={}))[t]=r[t]);return e},Pq=(r,e)=>{const t={};for(const o in r)(!Y4(o)||!(o.slice(9)in e))&&(t[o]=r[o]);return t};function Mq(r,e,t){const{props:o,children:c,component:f}=r,{props:y,children:s,patchFlag:E}=e,R=f.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&E>=0){if(E&1024)return!0;if(E&16)return o?P3(o,y,R):!!y;if(E&8){const O=e.dynamicProps;for(let A=0;A<O.length;A++){const U=O[A];if(y[U]!==o[U]&&!YT(R,U))return!0}}}else return(c||s)&&(!s||!s.$stable)?!0:o===y?!1:o?y?P3(o,y,R):!0:!!y;return!1}function P3(r,e,t){const o=Object.keys(e);if(o.length!==Object.keys(r).length)return!0;for(let c=0;c<o.length;c++){const f=o[c];if(e[f]!==r[f]&&!YT(t,f))return!0}return!1}function kq({vnode:r,parent:e},t){for(;e;){const o=e.subTree;if(o.suspense&&o.suspense.activeBranch===r&&(o.el=r.el),o===r)(r=e.vnode).el=t,e=e.parent;else break}}const $z=r=>r.__isSuspense;function Dq(r,e){e&&e.pendingBranch?sn(r)?e.effects.push(...r):e.effects.push(r):$H(r)}const Po=Symbol.for("v-fgt"),JT=Symbol.for("v-txt"),Id=Symbol.for("v-cmt"),KS=Symbol.for("v-stc"),_1=[];let ic=null;function Pr(r=!1){_1.push(ic=r?null:[])}function Lq(){_1.pop(),ic=_1[_1.length-1]||null}let q1=1;function $2(r,e=!1){q1+=r,r<0&&ic&&e&&(ic.hasOnce=!0)}function Gz(r){return r.dynamicChildren=q1>0?ic||Hg:null,Lq(),q1>0&&ic&&ic.push(r),r}function Qr(r,e,t,o,c,f){return Gz(mr(r,e,t,o,c,f,!0))}function Im(r,e,t,o,c){return Gz(Bs(r,e,t,o,c,!0))}function W1(r){return r?r.__v_isVNode===!0:!1}function Lv(r,e){return r.type===e.type&&r.key===e.key}const Hz=({key:r})=>r??null,p2=({ref:r,ref_key:e,ref_for:t})=>(typeof r=="number"&&(r=""+r),r!=null?ko(r)||ga(r)||dn(r)?{i:$a,r,k:e,f:!!t}:r:null);function mr(r,e=null,t=null,o=0,c=null,f=r===Po?0:1,y=!1,s=!1){const E={__v_isVNode:!0,__v_skip:!0,type:r,props:e,key:e&&Hz(e),ref:e&&p2(e),scopeId:xz,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:f,patchFlag:o,dynamicProps:c,dynamicChildren:null,appContext:null,ctx:$a};return s?(pC(E,t),f&128&&r.normalize(E)):t&&(E.shapeFlag|=ko(t)?8:16),q1>0&&!y&&ic&&(E.patchFlag>0||f&6)&&E.patchFlag!==32&&ic.push(E),E}const Bs=Oq;function Oq(r,e=null,t=null,o=0,c=null,f=!1){if((!r||r===rq)&&(r=Id),W1(r)){const s=h0(r,e,!0);return t&&pC(s,t),q1>0&&!f&&ic&&(s.shapeFlag&6?ic[ic.indexOf(r)]=s:ic.push(s)),s.patchFlag=-2,s}if(Hq(r)&&(r=r.__vccOpts),e){e=Fq(e);let{class:s,style:E}=e;s&&!ko(s)&&(e.class=F0(s)),Js(E)&&(aC(E)&&!sn(E)&&(E=qa({},E)),e.style=eC(E))}const y=ko(r)?1:$z(r)?128:HH(r)?64:Js(r)?4:dn(r)?2:0;return mr(r,e,t,o,c,y,f,!0)}function Fq(r){return r?aC(r)||kz(r)?qa({},r):r:null}function h0(r,e,t=!1,o=!1){const{props:c,ref:f,patchFlag:y,children:s,transition:E}=r,R=e?zq(c||{},e):c,O={__v_isVNode:!0,__v_skip:!0,type:r.type,props:R,key:R&&Hz(R),ref:e&&e.ref?t&&f?sn(f)?f.concat(p2(e)):[f,p2(e)]:p2(e):f,scopeId:r.scopeId,slotScopeIds:r.slotScopeIds,children:s,target:r.target,targetStart:r.targetStart,targetAnchor:r.targetAnchor,staticCount:r.staticCount,shapeFlag:r.shapeFlag,patchFlag:e&&r.type!==Po?y===-1?16:y|16:y,dynamicProps:r.dynamicProps,dynamicChildren:r.dynamicChildren,appContext:r.appContext,dirs:r.dirs,transition:E,component:r.component,suspense:r.suspense,ssContent:r.ssContent&&h0(r.ssContent),ssFallback:r.ssFallback&&h0(r.ssFallback),placeholder:r.placeholder,el:r.el,anchor:r.anchor,ctx:r.ctx,ce:r.ce};return E&&o&&uC(O,E.clone(O)),O}function ch(r=" ",e=0){return Bs(JT,null,r,e)}function pu(r="",e=!1){return e?(Pr(),Im(Id,null,r)):Bs(Id,null,r)}function th(r){return r==null||typeof r=="boolean"?Bs(Id):sn(r)?Bs(Po,null,r.slice()):W1(r)?Mf(r):Bs(JT,null,String(r))}function Mf(r){return r.el===null&&r.patchFlag!==-1||r.memo?r:h0(r)}function pC(r,e){let t=0;const{shapeFlag:o}=r;if(e==null)e=null;else if(sn(e))t=16;else if(typeof e=="object")if(o&65){const c=e.default;c&&(c._c&&(c._d=!1),pC(r,c()),c._c&&(c._d=!0));return}else{t=32;const c=e._;!c&&!kz(e)?e._ctx=$a:c===3&&$a&&($a.slots._===1?e._=1:(e._=2,r.patchFlag|=1024))}else dn(e)?(e={default:e,_ctx:$a},t=32):(e=String(e),o&64?(t=16,e=[ch(e)]):t=8);r.children=e,r.shapeFlag|=t}function zq(...r){const e={};for(let t=0;t<r.length;t++){const o=r[t];for(const c in o)if(c==="class")e.class!==o.class&&(e.class=F0([e.class,o.class]));else if(c==="style")e.style=eC([e.style,o.style]);else if($T(c)){const f=e[c],y=o[c];y&&f!==y&&!(sn(f)&&f.includes(y))&&(e[c]=f?[].concat(f,y):y)}else c!==""&&(e[c]=o[c])}return e}function Yu(r,e,t,o=null){gh(r,e,7,[t,o])}const Nq=Rz();let Bq=0;function Vq(r,e,t){const o=r.type,c=(e?e.appContext:r.appContext)||Nq,f={uid:Bq++,vnode:r,type:o,parent:e,appContext:c,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new WF(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(c.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Lz(o,c),emitsOptions:jz(o,c),emit:null,emitted:null,propsDefaults:Ps,inheritAttrs:o.inheritAttrs,ctx:Ps,data:Ps,props:Ps,attrs:Ps,slots:Ps,refs:Ps,setupState:Ps,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return f.ctx={_:f},f.root=e?e.root:f,f.emit=Aq.bind(null,f),r.ce&&r.ce(f),f}let ml=null;const mC=()=>ml||$a;let G2,a5;{const r=qT(),e=(t,o)=>{let c;return(c=r[t])||(c=r[t]=[]),c.push(o),f=>{c.length>1?c.forEach(y=>y(f)):c[0](f)}};G2=e("__VUE_INSTANCE_SETTERS__",t=>ml=t),a5=e("__VUE_SSR_SETTERS__",t=>X1=t)}const Ax=r=>{const e=ml;return G2(r),r.scope.on(),()=>{r.scope.off(),G2(e)}},M3=()=>{ml&&ml.scope.off(),G2(null)};function qz(r){return r.vnode.shapeFlag&4}let X1=!1;function Uq(r,e=!1,t=!1){e&&a5(e);const{props:o,children:c}=r.vnode,f=qz(r);fq(r,o,f,e),gq(r,c,t||e);const y=f?jq(r,e):void 0;return e&&a5(!1),y}function jq(r,e){const t=r.type;r.accessCache=Object.create(null),r.proxy=new Proxy(r.ctx,sq);const{setup:o}=t;if(o){Td();const c=r.setupContext=o.length>1?Gq(r):null,f=Ax(r),y=Sx(o,r,0,[r.props,c]),s=BF(y);if(Ed(),f(),(s||r.sp)&&!Zg(r)&&bz(r),s){if(y.then(M3,M3),e)return y.then(E=>{k3(r,E)}).catch(E=>{ZT(E,r,0)});r.asyncDep=y}else k3(r,y)}else Wz(r)}function k3(r,e,t){dn(e)?r.type.__ssrInlineRender?r.ssrRender=e:r.render=e:Js(e)&&(r.setupState=mz(e)),Wz(r)}function Wz(r,e,t){const o=r.type;r.render||(r.render=o.render||lh);{const c=Ax(r);Td();try{oq(r)}finally{Ed(),c()}}}const $q={get(r,e){return za(r,"get",""),r[e]}};function Gq(r){const e=t=>{r.exposed=t||{}};return{attrs:new Proxy(r.attrs,$q),slots:r.slots,emit:r.emit,expose:e}}function QT(r){return r.exposed?r.exposeProxy||(r.exposeProxy=new Proxy(mz(dz(r.exposed)),{get(e,t){if(t in e)return e[t];if(t in m1)return m1[t](r)},has(e,t){return t in e||t in m1}})):r.proxy}function Hq(r){return dn(r)&&"__vccOpts"in r}const fa=(r,e)=>NH(r,e,X1);function Xz(r,e,t){const o=(f,y,s)=>{$2(-1);try{return Bs(f,y,s)}finally{$2(1)}},c=arguments.length;return c===2?Js(e)&&!sn(e)?W1(e)?o(r,null,[e]):o(r,e):o(r,null,e):(c>3?t=Array.prototype.slice.call(arguments,2):c===3&&W1(t)&&(t=[t]),o(r,e,t))}const qq="3.5.21";/**
* @vue/runtime-dom v3.5.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let l5;const D3=typeof window<"u"&&window.trustedTypes;if(D3)try{l5=D3.createPolicy("vue",{createHTML:r=>r})}catch{}const Zz=l5?r=>l5.createHTML(r):r=>r,Wq="http://www.w3.org/2000/svg",Xq="http://www.w3.org/1998/Math/MathML",ld=typeof document<"u"?document:null,L3=ld&&ld.createElement("template"),Zq={insert:(r,e,t)=>{e.insertBefore(r,t||null)},remove:r=>{const e=r.parentNode;e&&e.removeChild(r)},createElement:(r,e,t,o)=>{const c=e==="svg"?ld.createElementNS(Wq,r):e==="mathml"?ld.createElementNS(Xq,r):t?ld.createElement(r,{is:t}):ld.createElement(r);return r==="select"&&o&&o.multiple!=null&&c.setAttribute("multiple",o.multiple),c},createText:r=>ld.createTextNode(r),createComment:r=>ld.createComment(r),setText:(r,e)=>{r.nodeValue=e},setElementText:(r,e)=>{r.textContent=e},parentNode:r=>r.parentNode,nextSibling:r=>r.nextSibling,querySelector:r=>ld.querySelector(r),setScopeId(r,e){r.setAttribute(e,"")},insertStaticContent(r,e,t,o,c,f){const y=t?t.previousSibling:e.lastChild;if(c&&(c===f||c.nextSibling))for(;e.insertBefore(c.cloneNode(!0),t),!(c===f||!(c=c.nextSibling)););else{L3.innerHTML=Zz(o==="svg"?`<svg>${r}</svg>`:o==="mathml"?`<math>${r}</math>`:r);const s=L3.content;if(o==="svg"||o==="mathml"){const E=s.firstChild;for(;E.firstChild;)s.appendChild(E.firstChild);s.removeChild(E)}e.insertBefore(s,t)}return[y?y.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Kq=Symbol("_vtc");function Yq(r,e,t){const o=r[Kq];o&&(e=(e?[e,...o]:[...o]).join(" ")),e==null?r.removeAttribute("class"):t?r.setAttribute("class",e):r.className=e}const O3=Symbol("_vod"),Jq=Symbol("_vsh"),Qq=Symbol(""),eW=/(?:^|;)\s*display\s*:/;function tW(r,e,t){const o=r.style,c=ko(t);let f=!1;if(t&&!c){if(e)if(ko(e))for(const y of e.split(";")){const s=y.slice(0,y.indexOf(":")).trim();t[s]==null&&m2(o,s,"")}else for(const y in e)t[y]==null&&m2(o,y,"");for(const y in t)y==="display"&&(f=!0),m2(o,y,t[y])}else if(c){if(e!==t){const y=o[Qq];y&&(t+=";"+y),o.cssText=t,f=eW.test(t)}}else e&&r.removeAttribute("style");O3 in r&&(r[O3]=f?o.display:"",r[Jq]&&(o.display="none"))}const F3=/\s*!important$/;function m2(r,e,t){if(sn(t))t.forEach(o=>m2(r,e,o));else if(t==null&&(t=""),e.startsWith("--"))r.setProperty(e,t);else{const o=iW(r,e);F3.test(t)?r.setProperty(Gm(o),t.replace(F3,""),"important"):r[o]=t}}const z3=["Webkit","Moz","ms"],YS={};function iW(r,e){const t=YS[e];if(t)return t;let o=ep(e);if(o!=="filter"&&o in r)return YS[e]=o;o=jF(o);for(let c=0;c<z3.length;c++){const f=z3[c]+o;if(f in r)return YS[e]=f}return e}const N3="http://www.w3.org/1999/xlink";function B3(r,e,t,o,c,f=mH(e)){o&&e.startsWith("xlink:")?t==null?r.removeAttributeNS(N3,e.slice(6,e.length)):r.setAttributeNS(N3,e,t):t==null||f&&!GF(t)?r.removeAttribute(e):r.setAttribute(e,f?"":kd(t)?String(t):t)}function V3(r,e,t,o,c){if(e==="innerHTML"||e==="textContent"){t!=null&&(r[e]=e==="innerHTML"?Zz(t):t);return}const f=r.tagName;if(e==="value"&&f!=="PROGRESS"&&!f.includes("-")){const s=f==="OPTION"?r.getAttribute("value")||"":r.value,E=t==null?r.type==="checkbox"?"on":"":String(t);(s!==E||!("_value"in r))&&(r.value=E),t==null&&r.removeAttribute(e),r._value=t;return}let y=!1;if(t===""||t==null){const s=typeof r[e];s==="boolean"?t=GF(t):t==null&&s==="string"?(t="",y=!0):s==="number"&&(t=0,y=!0)}try{r[e]=t}catch{}y&&r.removeAttribute(c||e)}function Sg(r,e,t,o){r.addEventListener(e,t,o)}function rW(r,e,t,o){r.removeEventListener(e,t,o)}const U3=Symbol("_vei");function nW(r,e,t,o,c=null){const f=r[U3]||(r[U3]={}),y=f[e];if(o&&y)y.value=o;else{const[s,E]=sW(e);if(o){const R=f[e]=lW(o,c);Sg(r,s,R,E)}else y&&(rW(r,s,y,E),f[e]=void 0)}}const j3=/(?:Once|Passive|Capture)$/;function sW(r){let e;if(j3.test(r)){e={};let o;for(;o=r.match(j3);)r=r.slice(0,r.length-o[0].length),e[o[0].toLowerCase()]=!0}return[r[2]===":"?r.slice(3):Gm(r.slice(2)),e]}let JS=0;const oW=Promise.resolve(),aW=()=>JS||(oW.then(()=>JS=0),JS=Date.now());function lW(r,e){const t=o=>{if(!o._vts)o._vts=Date.now();else if(o._vts<=t.attached)return;gh(cW(o,t.value),e,5,[o])};return t.value=r,t.attached=aW(),t}function cW(r,e){if(sn(e)){const t=r.stopImmediatePropagation;return r.stopImmediatePropagation=()=>{t.call(r),r._stopped=!0},e.map(o=>c=>!c._stopped&&o&&o(c))}else return e}const $3=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&r.charCodeAt(2)>96&&r.charCodeAt(2)<123,uW=(r,e,t,o,c,f)=>{const y=c==="svg";e==="class"?Yq(r,o,y):e==="style"?tW(r,t,o):$T(e)?Y4(e)||nW(r,e,t,o,f):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):hW(r,e,o,y))?(V3(r,e,o),!r.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&B3(r,e,o,y,f,e!=="value")):r._isVueCE&&(/[A-Z]/.test(e)||!ko(o))?V3(r,ep(e),o,f,e):(e==="true-value"?r._trueValue=o:e==="false-value"&&(r._falseValue=o),B3(r,e,o,y))};function hW(r,e,t,o){if(o)return!!(e==="innerHTML"||e==="textContent"||e in r&&$3(e)&&dn(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&r.tagName==="INPUT"||e==="type"&&r.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const c=r.tagName;if(c==="IMG"||c==="VIDEO"||c==="CANVAS"||c==="SOURCE")return!1}return $3(e)&&ko(t)?!1:e in r}const G3=r=>{const e=r.props["onUpdate:modelValue"]||!1;return sn(e)?t=>d2(e,t):e};function dW(r){r.target.composing=!0}function H3(r){const e=r.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const QS=Symbol("_assign"),d0={created(r,{modifiers:{lazy:e,trim:t,number:o}},c){r[QS]=G3(c);const f=o||c.props&&c.props.type==="number";Sg(r,e?"change":"input",y=>{if(y.target.composing)return;let s=r.value;t&&(s=s.trim()),f&&(s=JA(s)),r[QS](s)}),t&&Sg(r,"change",()=>{r.value=r.value.trim()}),e||(Sg(r,"compositionstart",dW),Sg(r,"compositionend",H3),Sg(r,"change",H3))},mounted(r,{value:e}){r.value=e??""},beforeUpdate(r,{value:e,oldValue:t,modifiers:{lazy:o,trim:c,number:f}},y){if(r[QS]=G3(y),r.composing)return;const s=(f||r.type==="number")&&!/^0\d/.test(r.value)?JA(r.value):r.value,E=e??"";s!==E&&(document.activeElement===r&&r.type!=="range"&&(o&&e===t||c&&r.value.trim()===E)||(r.value=E))}},fW=["ctrl","shift","alt","meta"],pW={stop:r=>r.stopPropagation(),prevent:r=>r.preventDefault(),self:r=>r.target!==r.currentTarget,ctrl:r=>!r.ctrlKey,shift:r=>!r.shiftKey,alt:r=>!r.altKey,meta:r=>!r.metaKey,left:r=>"button"in r&&r.button!==0,middle:r=>"button"in r&&r.button!==1,right:r=>"button"in r&&r.button!==2,exact:(r,e)=>fW.some(t=>r[`${t}Key`]&&!e.includes(t))},ode=(r,e)=>{const t=r._withMods||(r._withMods={}),o=e.join(".");return t[o]||(t[o]=(c,...f)=>{for(let y=0;y<e.length;y++){const s=pW[e[y]];if(s&&s(c,e))return}return r(c,...f)})},mW=qa({patchProp:uW},Zq);let q3;function _W(){return q3||(q3=vq(mW))}const gW=(...r)=>{const e=_W().createApp(...r),{mount:t}=e;return e.mount=o=>{const c=vW(o);if(!c)return;const f=e._component;!dn(f)&&!f.render&&!f.template&&(f.template=c.innerHTML),c.nodeType===1&&(c.textContent="");const y=t(c,!1,yW(c));return c instanceof Element&&(c.removeAttribute("v-cloak"),c.setAttribute("data-v-app","")),y},e};function yW(r){if(r instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&r instanceof MathMLElement)return"mathml"}function vW(r){return ko(r)?document.querySelector(r):r}/*!
 * pinia v2.3.1
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */const xW=Symbol();var W3;(function(r){r.direct="direct",r.patchObject="patch object",r.patchFunction="patch function"})(W3||(W3={}));function bW(){const r=XF(!0),e=r.run(()=>Qn({}));let t=[],o=[];const c=dz({install(f){c._a=f,f.provide(xW,c),f.config.globalProperties.$pinia=c,o.forEach(y=>t.push(y)),o=[]},use(f){return this._a?t.push(f):o.push(f),this},_p:t,_a:null,_e:r,_s:new Map,state:e});return c}/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const Ag=typeof document<"u";function Kz(r){return typeof r=="object"||"displayName"in r||"props"in r||"__vccOpts"in r}function wW(r){return r.__esModule||r[Symbol.toStringTag]==="Module"||r.default&&Kz(r.default)}const us=Object.assign;function eA(r,e){const t={};for(const o in e){const c=e[o];t[o]=yu(c)?c.map(r):r(c)}return t}const g1=()=>{},yu=Array.isArray,Yz=/#/g,TW=/&/g,EW=/\//g,IW=/=/g,SW=/\?/g,Jz=/\+/g,AW=/%5B/g,CW=/%5D/g,Qz=/%5E/g,RW=/%60/g,eN=/%7B/g,PW=/%7C/g,tN=/%7D/g,MW=/%20/g;function _C(r){return encodeURI(""+r).replace(PW,"|").replace(AW,"[").replace(CW,"]")}function kW(r){return _C(r).replace(eN,"{").replace(tN,"}").replace(Qz,"^")}function c5(r){return _C(r).replace(Jz,"%2B").replace(MW,"+").replace(Yz,"%23").replace(TW,"%26").replace(RW,"`").replace(eN,"{").replace(tN,"}").replace(Qz,"^")}function DW(r){return c5(r).replace(IW,"%3D")}function LW(r){return _C(r).replace(Yz,"%23").replace(SW,"%3F")}function OW(r){return r==null?"":LW(r).replace(EW,"%2F")}function Z1(r){try{return decodeURIComponent(""+r)}catch{}return""+r}const FW=/\/$/,zW=r=>r.replace(FW,"");function tA(r,e,t="/"){let o,c={},f="",y="";const s=e.indexOf("#");let E=e.indexOf("?");return s<E&&s>=0&&(E=-1),E>-1&&(o=e.slice(0,E),f=e.slice(E+1,s>-1?s:e.length),c=r(f)),s>-1&&(o=o||e.slice(0,s),y=e.slice(s,e.length)),o=UW(o??e,t),{fullPath:o+(f&&"?")+f+y,path:o,query:c,hash:Z1(y)}}function NW(r,e){const t=e.query?r(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function X3(r,e){return!e||!r.toLowerCase().startsWith(e.toLowerCase())?r:r.slice(e.length)||"/"}function BW(r,e,t){const o=e.matched.length-1,c=t.matched.length-1;return o>-1&&o===c&&f0(e.matched[o],t.matched[c])&&iN(e.params,t.params)&&r(e.query)===r(t.query)&&e.hash===t.hash}function f0(r,e){return(r.aliasOf||r)===(e.aliasOf||e)}function iN(r,e){if(Object.keys(r).length!==Object.keys(e).length)return!1;for(const t in r)if(!VW(r[t],e[t]))return!1;return!0}function VW(r,e){return yu(r)?Z3(r,e):yu(e)?Z3(e,r):r===e}function Z3(r,e){return yu(e)?r.length===e.length&&r.every((t,o)=>t===e[o]):r.length===1&&r[0]===e}function UW(r,e){if(r.startsWith("/"))return r;if(!r)return e;const t=e.split("/"),o=r.split("/"),c=o[o.length-1];(c===".."||c===".")&&o.push("");let f=t.length-1,y,s;for(y=0;y<o.length;y++)if(s=o[y],s!==".")if(s==="..")f>1&&f--;else break;return t.slice(0,f).join("/")+"/"+o.slice(y).join("/")}const Sf={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var K1;(function(r){r.pop="pop",r.push="push"})(K1||(K1={}));var y1;(function(r){r.back="back",r.forward="forward",r.unknown=""})(y1||(y1={}));function jW(r){if(!r)if(Ag){const e=document.querySelector("base");r=e&&e.getAttribute("href")||"/",r=r.replace(/^\w+:\/\/[^\/]+/,"")}else r="/";return r[0]!=="/"&&r[0]!=="#"&&(r="/"+r),zW(r)}const $W=/^[^#]+#/;function GW(r,e){return r.replace($W,"#")+e}function HW(r,e){const t=document.documentElement.getBoundingClientRect(),o=r.getBoundingClientRect();return{behavior:e.behavior,left:o.left-t.left-(e.left||0),top:o.top-t.top-(e.top||0)}}const eE=()=>({left:window.scrollX,top:window.scrollY});function qW(r){let e;if("el"in r){const t=r.el,o=typeof t=="string"&&t.startsWith("#"),c=typeof t=="string"?o?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!c)return;e=HW(c,r)}else e=r;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function K3(r,e){return(history.state?history.state.position-e:-1)+r}const u5=new Map;function WW(r,e){u5.set(r,e)}function XW(r){const e=u5.get(r);return u5.delete(r),e}let ZW=()=>location.protocol+"//"+location.host;function rN(r,e){const{pathname:t,search:o,hash:c}=e,f=r.indexOf("#");if(f>-1){let s=c.includes(r.slice(f))?r.slice(f).length:1,E=c.slice(s);return E[0]!=="/"&&(E="/"+E),X3(E,"")}return X3(t,r)+o+c}function KW(r,e,t,o){let c=[],f=[],y=null;const s=({state:U})=>{const $=rN(r,location),te=t.value,Q=e.value;let de=0;if(U){if(t.value=$,e.value=U,y&&y===te){y=null;return}de=Q?U.position-Q.position:0}else o($);c.forEach(Ce=>{Ce(t.value,te,{delta:de,type:K1.pop,direction:de?de>0?y1.forward:y1.back:y1.unknown})})};function E(){y=t.value}function R(U){c.push(U);const $=()=>{const te=c.indexOf(U);te>-1&&c.splice(te,1)};return f.push($),$}function O(){const{history:U}=window;U.state&&U.replaceState(us({},U.state,{scroll:eE()}),"")}function A(){for(const U of f)U();f=[],window.removeEventListener("popstate",s),window.removeEventListener("beforeunload",O)}return window.addEventListener("popstate",s),window.addEventListener("beforeunload",O,{passive:!0}),{pauseListeners:E,listen:R,destroy:A}}function Y3(r,e,t,o=!1,c=!1){return{back:r,current:e,forward:t,replaced:o,position:window.history.length,scroll:c?eE():null}}function YW(r){const{history:e,location:t}=window,o={value:rN(r,t)},c={value:e.state};c.value||f(o.value,{back:null,current:o.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function f(E,R,O){const A=r.indexOf("#"),U=A>-1?(t.host&&document.querySelector("base")?r:r.slice(A))+E:ZW()+r+E;try{e[O?"replaceState":"pushState"](R,"",U),c.value=R}catch($){console.error($),t[O?"replace":"assign"](U)}}function y(E,R){const O=us({},e.state,Y3(c.value.back,E,c.value.forward,!0),R,{position:c.value.position});f(E,O,!0),o.value=E}function s(E,R){const O=us({},c.value,e.state,{forward:E,scroll:eE()});f(O.current,O,!0);const A=us({},Y3(o.value,E,null),{position:O.position+1},R);f(E,A,!1),o.value=E}return{location:o,state:c,push:s,replace:y}}function JW(r){r=jW(r);const e=YW(r),t=KW(r,e.state,e.location,e.replace);function o(f,y=!0){y||t.pauseListeners(),history.go(f)}const c=us({location:"",base:r,go:o,createHref:GW.bind(null,r)},e,t);return Object.defineProperty(c,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(c,"state",{enumerable:!0,get:()=>e.state.value}),c}function QW(r){return r=location.host?r||location.pathname+location.search:"",r.includes("#")||(r+="#"),JW(r)}function eX(r){return typeof r=="string"||r&&typeof r=="object"}function nN(r){return typeof r=="string"||typeof r=="symbol"}const sN=Symbol("");var J3;(function(r){r[r.aborted=4]="aborted",r[r.cancelled=8]="cancelled",r[r.duplicated=16]="duplicated"})(J3||(J3={}));function p0(r,e){return us(new Error,{type:r,[sN]:!0},e)}function sd(r,e){return r instanceof Error&&sN in r&&(e==null||!!(r.type&e))}const Q3="[^/]+?",tX={sensitive:!1,strict:!1,start:!0,end:!0},iX=/[.+*?^${}()[\]/\\]/g;function rX(r,e){const t=us({},tX,e),o=[];let c=t.start?"^":"";const f=[];for(const R of r){const O=R.length?[]:[90];t.strict&&!R.length&&(c+="/");for(let A=0;A<R.length;A++){const U=R[A];let $=40+(t.sensitive?.25:0);if(U.type===0)A||(c+="/"),c+=U.value.replace(iX,"\\$&"),$+=40;else if(U.type===1){const{value:te,repeatable:Q,optional:de,regexp:Ce}=U;f.push({name:te,repeatable:Q,optional:de});const Fe=Ce||Q3;if(Fe!==Q3){$+=10;try{new RegExp(`(${Fe})`)}catch(Me){throw new Error(`Invalid custom RegExp for param "${te}" (${Fe}): `+Me.message)}}let Le=Q?`((?:${Fe})(?:/(?:${Fe}))*)`:`(${Fe})`;A||(Le=de&&R.length<2?`(?:/${Le})`:"/"+Le),de&&(Le+="?"),c+=Le,$+=20,de&&($+=-8),Q&&($+=-20),Fe===".*"&&($+=-50)}O.push($)}o.push(O)}if(t.strict&&t.end){const R=o.length-1;o[R][o[R].length-1]+=.7000000000000001}t.strict||(c+="/?"),t.end?c+="$":t.strict&&!c.endsWith("/")&&(c+="(?:/|$)");const y=new RegExp(c,t.sensitive?"":"i");function s(R){const O=R.match(y),A={};if(!O)return null;for(let U=1;U<O.length;U++){const $=O[U]||"",te=f[U-1];A[te.name]=$&&te.repeatable?$.split("/"):$}return A}function E(R){let O="",A=!1;for(const U of r){(!A||!O.endsWith("/"))&&(O+="/"),A=!1;for(const $ of U)if($.type===0)O+=$.value;else if($.type===1){const{value:te,repeatable:Q,optional:de}=$,Ce=te in R?R[te]:"";if(yu(Ce)&&!Q)throw new Error(`Provided param "${te}" is an array but it is not repeatable (* or + modifiers)`);const Fe=yu(Ce)?Ce.join("/"):Ce;if(!Fe)if(de)U.length<2&&(O.endsWith("/")?O=O.slice(0,-1):A=!0);else throw new Error(`Missing required param "${te}"`);O+=Fe}}return O||"/"}return{re:y,score:o,keys:f,parse:s,stringify:E}}function nX(r,e){let t=0;for(;t<r.length&&t<e.length;){const o=e[t]-r[t];if(o)return o;t++}return r.length<e.length?r.length===1&&r[0]===80?-1:1:r.length>e.length?e.length===1&&e[0]===80?1:-1:0}function oN(r,e){let t=0;const o=r.score,c=e.score;for(;t<o.length&&t<c.length;){const f=nX(o[t],c[t]);if(f)return f;t++}if(Math.abs(c.length-o.length)===1){if(eD(o))return 1;if(eD(c))return-1}return c.length-o.length}function eD(r){const e=r[r.length-1];return r.length>0&&e[e.length-1]<0}const sX={type:0,value:""},oX=/[a-zA-Z0-9_]/;function aX(r){if(!r)return[[]];if(r==="/")return[[sX]];if(!r.startsWith("/"))throw new Error(`Invalid path "${r}"`);function e($){throw new Error(`ERR (${t})/"${R}": ${$}`)}let t=0,o=t;const c=[];let f;function y(){f&&c.push(f),f=[]}let s=0,E,R="",O="";function A(){R&&(t===0?f.push({type:0,value:R}):t===1||t===2||t===3?(f.length>1&&(E==="*"||E==="+")&&e(`A repeatable param (${R}) must be alone in its segment. eg: '/:ids+.`),f.push({type:1,value:R,regexp:O,repeatable:E==="*"||E==="+",optional:E==="*"||E==="?"})):e("Invalid state to consume buffer"),R="")}function U(){R+=E}for(;s<r.length;){if(E=r[s++],E==="\\"&&t!==2){o=t,t=4;continue}switch(t){case 0:E==="/"?(R&&A(),y()):E===":"?(A(),t=1):U();break;case 4:U(),t=o;break;case 1:E==="("?t=2:oX.test(E)?U():(A(),t=0,E!=="*"&&E!=="?"&&E!=="+"&&s--);break;case 2:E===")"?O[O.length-1]=="\\"?O=O.slice(0,-1)+E:t=3:O+=E;break;case 3:A(),t=0,E!=="*"&&E!=="?"&&E!=="+"&&s--,O="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${R}"`),A(),y(),c}function lX(r,e,t){const o=rX(aX(r.path),t),c=us(o,{record:r,parent:e,children:[],alias:[]});return e&&!c.record.aliasOf==!e.record.aliasOf&&e.children.push(c),c}function cX(r,e){const t=[],o=new Map;e=nD({strict:!1,end:!0,sensitive:!1},e);function c(A){return o.get(A)}function f(A,U,$){const te=!$,Q=iD(A);Q.aliasOf=$&&$.record;const de=nD(e,A),Ce=[Q];if("alias"in A){const Me=typeof A.alias=="string"?[A.alias]:A.alias;for(const at of Me)Ce.push(iD(us({},Q,{components:$?$.record.components:Q.components,path:at,aliasOf:$?$.record:Q})))}let Fe,Le;for(const Me of Ce){const{path:at}=Me;if(U&&at[0]!=="/"){const pt=U.record.path,me=pt[pt.length-1]==="/"?"":"/";Me.path=U.record.path+(at&&me+at)}if(Fe=lX(Me,U,de),$?$.alias.push(Fe):(Le=Le||Fe,Le!==Fe&&Le.alias.push(Fe),te&&A.name&&!rD(Fe)&&y(A.name)),aN(Fe)&&E(Fe),Q.children){const pt=Q.children;for(let me=0;me<pt.length;me++)f(pt[me],Fe,$&&$.children[me])}$=$||Fe}return Le?()=>{y(Le)}:g1}function y(A){if(nN(A)){const U=o.get(A);U&&(o.delete(A),t.splice(t.indexOf(U),1),U.children.forEach(y),U.alias.forEach(y))}else{const U=t.indexOf(A);U>-1&&(t.splice(U,1),A.record.name&&o.delete(A.record.name),A.children.forEach(y),A.alias.forEach(y))}}function s(){return t}function E(A){const U=dX(A,t);t.splice(U,0,A),A.record.name&&!rD(A)&&o.set(A.record.name,A)}function R(A,U){let $,te={},Q,de;if("name"in A&&A.name){if($=o.get(A.name),!$)throw p0(1,{location:A});de=$.record.name,te=us(tD(U.params,$.keys.filter(Le=>!Le.optional).concat($.parent?$.parent.keys.filter(Le=>Le.optional):[]).map(Le=>Le.name)),A.params&&tD(A.params,$.keys.map(Le=>Le.name))),Q=$.stringify(te)}else if(A.path!=null)Q=A.path,$=t.find(Le=>Le.re.test(Q)),$&&(te=$.parse(Q),de=$.record.name);else{if($=U.name?o.get(U.name):t.find(Le=>Le.re.test(U.path)),!$)throw p0(1,{location:A,currentLocation:U});de=$.record.name,te=us({},U.params,A.params),Q=$.stringify(te)}const Ce=[];let Fe=$;for(;Fe;)Ce.unshift(Fe.record),Fe=Fe.parent;return{name:de,path:Q,params:te,matched:Ce,meta:hX(Ce)}}r.forEach(A=>f(A));function O(){t.length=0,o.clear()}return{addRoute:f,resolve:R,removeRoute:y,clearRoutes:O,getRoutes:s,getRecordMatcher:c}}function tD(r,e){const t={};for(const o of e)o in r&&(t[o]=r[o]);return t}function iD(r){const e={path:r.path,redirect:r.redirect,name:r.name,meta:r.meta||{},aliasOf:r.aliasOf,beforeEnter:r.beforeEnter,props:uX(r),children:r.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in r?r.components||null:r.component&&{default:r.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function uX(r){const e={},t=r.props||!1;if("component"in r)e.default=t;else for(const o in r.components)e[o]=typeof t=="object"?t[o]:t;return e}function rD(r){for(;r;){if(r.record.aliasOf)return!0;r=r.parent}return!1}function hX(r){return r.reduce((e,t)=>us(e,t.meta),{})}function nD(r,e){const t={};for(const o in r)t[o]=o in e?e[o]:r[o];return t}function dX(r,e){let t=0,o=e.length;for(;t!==o;){const f=t+o>>1;oN(r,e[f])<0?o=f:t=f+1}const c=fX(r);return c&&(o=e.lastIndexOf(c,o-1)),o}function fX(r){let e=r;for(;e=e.parent;)if(aN(e)&&oN(r,e)===0)return e}function aN({record:r}){return!!(r.name||r.components&&Object.keys(r.components).length||r.redirect)}function pX(r){const e={};if(r===""||r==="?")return e;const o=(r[0]==="?"?r.slice(1):r).split("&");for(let c=0;c<o.length;++c){const f=o[c].replace(Jz," "),y=f.indexOf("="),s=Z1(y<0?f:f.slice(0,y)),E=y<0?null:Z1(f.slice(y+1));if(s in e){let R=e[s];yu(R)||(R=e[s]=[R]),R.push(E)}else e[s]=E}return e}function sD(r){let e="";for(let t in r){const o=r[t];if(t=DW(t),o==null){o!==void 0&&(e+=(e.length?"&":"")+t);continue}(yu(o)?o.map(f=>f&&c5(f)):[o&&c5(o)]).forEach(f=>{f!==void 0&&(e+=(e.length?"&":"")+t,f!=null&&(e+="="+f))})}return e}function mX(r){const e={};for(const t in r){const o=r[t];o!==void 0&&(e[t]=yu(o)?o.map(c=>c==null?null:""+c):o==null?o:""+o)}return e}const _X=Symbol(""),oD=Symbol(""),tE=Symbol(""),gC=Symbol(""),h5=Symbol("");function Ov(){let r=[];function e(o){return r.push(o),()=>{const c=r.indexOf(o);c>-1&&r.splice(c,1)}}function t(){r=[]}return{add:e,list:()=>r.slice(),reset:t}}function kf(r,e,t,o,c,f=y=>y()){const y=o&&(o.enterCallbacks[c]=o.enterCallbacks[c]||[]);return()=>new Promise((s,E)=>{const R=U=>{U===!1?E(p0(4,{from:t,to:e})):U instanceof Error?E(U):eX(U)?E(p0(2,{from:e,to:U})):(y&&o.enterCallbacks[c]===y&&typeof U=="function"&&y.push(U),s())},O=f(()=>r.call(o&&o.instances[c],e,t,R));let A=Promise.resolve(O);r.length<3&&(A=A.then(R)),A.catch(U=>E(U))})}function iA(r,e,t,o,c=f=>f()){const f=[];for(const y of r)for(const s in y.components){let E=y.components[s];if(!(e!=="beforeRouteEnter"&&!y.instances[s]))if(Kz(E)){const O=(E.__vccOpts||E)[e];O&&f.push(kf(O,t,o,y,s,c))}else{let R=E();f.push(()=>R.then(O=>{if(!O)throw new Error(`Couldn't resolve component "${s}" at "${y.path}"`);const A=wW(O)?O.default:O;y.mods[s]=O,y.components[s]=A;const $=(A.__vccOpts||A)[e];return $&&kf($,t,o,y,s,c)()}))}}return f}function aD(r){const e=Al(tE),t=Al(gC),o=fa(()=>{const E=Rn(r.to);return e.resolve(E)}),c=fa(()=>{const{matched:E}=o.value,{length:R}=E,O=E[R-1],A=t.matched;if(!O||!A.length)return-1;const U=A.findIndex(f0.bind(null,O));if(U>-1)return U;const $=lD(E[R-2]);return R>1&&lD(O)===$&&A[A.length-1].path!==$?A.findIndex(f0.bind(null,E[R-2])):U}),f=fa(()=>c.value>-1&&xX(t.params,o.value.params)),y=fa(()=>c.value>-1&&c.value===t.matched.length-1&&iN(t.params,o.value.params));function s(E={}){if(vX(E)){const R=e[Rn(r.replace)?"replace":"push"](Rn(r.to)).catch(g1);return r.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>R),R}return Promise.resolve()}return{route:o,href:fa(()=>o.value.href),isActive:f,isExactActive:y,navigate:s}}function gX(r){return r.length===1?r[0]:r}const yX=wa({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:aD,setup(r,{slots:e}){const t=XT(aD(r)),{options:o}=Al(tE),c=fa(()=>({[cD(r.activeClass,o.linkActiveClass,"router-link-active")]:t.isActive,[cD(r.exactActiveClass,o.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const f=e.default&&gX(e.default(t));return r.custom?f:Xz("a",{"aria-current":t.isExactActive?r.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:c.value},f)}}}),lN=yX;function vX(r){if(!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)&&!r.defaultPrevented&&!(r.button!==void 0&&r.button!==0)){if(r.currentTarget&&r.currentTarget.getAttribute){const e=r.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return r.preventDefault&&r.preventDefault(),!0}}function xX(r,e){for(const t in e){const o=e[t],c=r[t];if(typeof o=="string"){if(o!==c)return!1}else if(!yu(c)||c.length!==o.length||o.some((f,y)=>f!==c[y]))return!1}return!0}function lD(r){return r?r.aliasOf?r.aliasOf.path:r.path:""}const cD=(r,e,t)=>r??e??t,bX=wa({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(r,{attrs:e,slots:t}){const o=Al(h5),c=fa(()=>r.route||o.value),f=Al(oD,0),y=fa(()=>{let R=Rn(f);const{matched:O}=c.value;let A;for(;(A=O[R])&&!A.components;)R++;return R}),s=fa(()=>c.value.matched[y.value]);f2(oD,fa(()=>y.value+1)),f2(_X,s),f2(h5,c);const E=Qn();return Hf(()=>[E.value,s.value,r.name],([R,O,A],[U,$,te])=>{O&&(O.instances[A]=R,$&&$!==O&&R&&R===U&&(O.leaveGuards.size||(O.leaveGuards=$.leaveGuards),O.updateGuards.size||(O.updateGuards=$.updateGuards))),R&&O&&(!$||!f0(O,$)||!U)&&(O.enterCallbacks[A]||[]).forEach(Q=>Q(R))},{flush:"post"}),()=>{const R=c.value,O=r.name,A=s.value,U=A&&A.components[O];if(!U)return uD(t.default,{Component:U,route:R});const $=A.props[O],te=$?$===!0?R.params:typeof $=="function"?$(R):$:null,de=Xz(U,us({},te,e,{onVnodeUnmounted:Ce=>{Ce.component.isUnmounted&&(A.instances[O]=null)},ref:E}));return uD(t.default,{Component:de,route:R})||de}}});function uD(r,e){if(!r)return null;const t=r(e);return t.length===1?t[0]:t}const cN=bX;function wX(r){const e=cX(r.routes,r),t=r.parseQuery||pX,o=r.stringifyQuery||sD,c=r.history,f=Ov(),y=Ov(),s=Ov(),E=fz(Sf);let R=Sf;Ag&&r.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const O=eA.bind(null,vt=>""+vt),A=eA.bind(null,OW),U=eA.bind(null,Z1);function $(vt,Wt){let Xt,ai;return nN(vt)?(Xt=e.getRecordMatcher(vt),ai=Wt):ai=vt,e.addRoute(ai,Xt)}function te(vt){const Wt=e.getRecordMatcher(vt);Wt&&e.removeRoute(Wt)}function Q(){return e.getRoutes().map(vt=>vt.record)}function de(vt){return!!e.getRecordMatcher(vt)}function Ce(vt,Wt){if(Wt=us({},Wt||E.value),typeof vt=="string"){const Qe=tA(t,vt,Wt.path),ht=e.resolve({path:Qe.path},Wt),Et=c.createHref(Qe.fullPath);return us(Qe,ht,{params:U(ht.params),hash:Z1(Qe.hash),redirectedFrom:void 0,href:Et})}let Xt;if(vt.path!=null)Xt=us({},vt,{path:tA(t,vt.path,Wt.path).path});else{const Qe=us({},vt.params);for(const ht in Qe)Qe[ht]==null&&delete Qe[ht];Xt=us({},vt,{params:A(Qe)}),Wt.params=A(Wt.params)}const ai=e.resolve(Xt,Wt),nr=vt.hash||"";ai.params=O(U(ai.params));const Be=NW(o,us({},vt,{hash:kW(nr),path:ai.path})),Ge=c.createHref(Be);return us({fullPath:Be,hash:nr,query:o===sD?mX(vt.query):vt.query||{}},ai,{redirectedFrom:void 0,href:Ge})}function Fe(vt){return typeof vt=="string"?tA(t,vt,E.value.path):us({},vt)}function Le(vt,Wt){if(R!==vt)return p0(8,{from:Wt,to:vt})}function Me(vt){return me(vt)}function at(vt){return Me(us(Fe(vt),{replace:!0}))}function pt(vt){const Wt=vt.matched[vt.matched.length-1];if(Wt&&Wt.redirect){const{redirect:Xt}=Wt;let ai=typeof Xt=="function"?Xt(vt):Xt;return typeof ai=="string"&&(ai=ai.includes("?")||ai.includes("#")?ai=Fe(ai):{path:ai},ai.params={}),us({query:vt.query,hash:vt.hash,params:ai.path!=null?{}:vt.params},ai)}}function me(vt,Wt){const Xt=R=Ce(vt),ai=E.value,nr=vt.state,Be=vt.force,Ge=vt.replace===!0,Qe=pt(Xt);if(Qe)return me(us(Fe(Qe),{state:typeof Qe=="object"?us({},nr,Qe.state):nr,force:Be,replace:Ge}),Wt||Xt);const ht=Xt;ht.redirectedFrom=Wt;let Et;return!Be&&BW(o,ai,Xt)&&(Et=p0(16,{to:ht,from:ai}),wi(ai,ai,!0,!1)),(Et?Promise.resolve(Et):ke(ht,ai)).catch(Ue=>sd(Ue)?sd(Ue,2)?Ue:st(Ue):Si(Ue,ht,ai)).then(Ue=>{if(Ue){if(sd(Ue,2))return me(us({replace:Ge},Fe(Ue.to),{state:typeof Ue.to=="object"?us({},nr,Ue.to.state):nr,force:Be}),Wt||ht)}else Ue=He(ht,ai,!0,Ge,nr);return Ve(ht,ai,Ue),Ue})}function ye(vt,Wt){const Xt=Le(vt,Wt);return Xt?Promise.reject(Xt):Promise.resolve()}function Se(vt){const Wt=Br.values().next().value;return Wt&&typeof Wt.runWithContext=="function"?Wt.runWithContext(vt):vt()}function ke(vt,Wt){let Xt;const[ai,nr,Be]=TX(vt,Wt);Xt=iA(ai.reverse(),"beforeRouteLeave",vt,Wt);for(const Qe of ai)Qe.leaveGuards.forEach(ht=>{Xt.push(kf(ht,vt,Wt))});const Ge=ye.bind(null,vt,Wt);return Xt.push(Ge),Ni(Xt).then(()=>{Xt=[];for(const Qe of f.list())Xt.push(kf(Qe,vt,Wt));return Xt.push(Ge),Ni(Xt)}).then(()=>{Xt=iA(nr,"beforeRouteUpdate",vt,Wt);for(const Qe of nr)Qe.updateGuards.forEach(ht=>{Xt.push(kf(ht,vt,Wt))});return Xt.push(Ge),Ni(Xt)}).then(()=>{Xt=[];for(const Qe of Be)if(Qe.beforeEnter)if(yu(Qe.beforeEnter))for(const ht of Qe.beforeEnter)Xt.push(kf(ht,vt,Wt));else Xt.push(kf(Qe.beforeEnter,vt,Wt));return Xt.push(Ge),Ni(Xt)}).then(()=>(vt.matched.forEach(Qe=>Qe.enterCallbacks={}),Xt=iA(Be,"beforeRouteEnter",vt,Wt,Se),Xt.push(Ge),Ni(Xt))).then(()=>{Xt=[];for(const Qe of y.list())Xt.push(kf(Qe,vt,Wt));return Xt.push(Ge),Ni(Xt)}).catch(Qe=>sd(Qe,8)?Qe:Promise.reject(Qe))}function Ve(vt,Wt,Xt){s.list().forEach(ai=>Se(()=>ai(vt,Wt,Xt)))}function He(vt,Wt,Xt,ai,nr){const Be=Le(vt,Wt);if(Be)return Be;const Ge=Wt===Sf,Qe=Ag?history.state:{};Xt&&(ai||Ge?c.replace(vt.fullPath,us({scroll:Ge&&Qe&&Qe.scroll},nr)):c.push(vt.fullPath,nr)),E.value=vt,wi(vt,Wt,Xt,Ge),st()}let Oe;function xi(){Oe||(Oe=c.listen((vt,Wt,Xt)=>{if(!Vr.listening)return;const ai=Ce(vt),nr=pt(ai);if(nr){me(us(nr,{replace:!0,force:!0}),ai).catch(g1);return}R=ai;const Be=E.value;Ag&&WW(K3(Be.fullPath,Xt.delta),eE()),ke(ai,Be).catch(Ge=>sd(Ge,12)?Ge:sd(Ge,2)?(me(us(Fe(Ge.to),{force:!0}),ai).then(Qe=>{sd(Qe,20)&&!Xt.delta&&Xt.type===K1.pop&&c.go(-1,!1)}).catch(g1),Promise.reject()):(Xt.delta&&c.go(-Xt.delta,!1),Si(Ge,ai,Be))).then(Ge=>{Ge=Ge||He(ai,Be,!1),Ge&&(Xt.delta&&!sd(Ge,8)?c.go(-Xt.delta,!1):Xt.type===K1.pop&&sd(Ge,20)&&c.go(-1,!1)),Ve(ai,Be,Ge)}).catch(g1)}))}let ui=Ov(),ti=Ov(),ri;function Si(vt,Wt,Xt){st(vt);const ai=ti.list();return ai.length?ai.forEach(nr=>nr(vt,Wt,Xt)):console.error(vt),Promise.reject(vt)}function ir(){return ri&&E.value!==Sf?Promise.resolve():new Promise((vt,Wt)=>{ui.add([vt,Wt])})}function st(vt){return ri||(ri=!vt,xi(),ui.list().forEach(([Wt,Xt])=>vt?Xt(vt):Wt()),ui.reset()),vt}function wi(vt,Wt,Xt,ai){const{scrollBehavior:nr}=r;if(!Ag||!nr)return Promise.resolve();const Be=!Xt&&XW(K3(vt.fullPath,0))||(ai||!Xt)&&history.state&&history.state.scroll||null;return lC().then(()=>nr(vt,Wt,Be)).then(Ge=>Ge&&qW(Ge)).catch(Ge=>Si(Ge,vt,Wt))}const ji=vt=>c.go(vt);let Ar;const Br=new Set,Vr={currentRoute:E,listening:!0,addRoute:$,removeRoute:te,clearRoutes:e.clearRoutes,hasRoute:de,getRoutes:Q,resolve:Ce,options:r,push:Me,replace:at,go:ji,back:()=>ji(-1),forward:()=>ji(1),beforeEach:f.add,beforeResolve:y.add,afterEach:s.add,onError:ti.add,isReady:ir,install(vt){const Wt=this;vt.component("RouterLink",lN),vt.component("RouterView",cN),vt.config.globalProperties.$router=Wt,Object.defineProperty(vt.config.globalProperties,"$route",{enumerable:!0,get:()=>Rn(E)}),Ag&&!Ar&&E.value===Sf&&(Ar=!0,Me(c.location).catch(nr=>{}));const Xt={};for(const nr in Sf)Object.defineProperty(Xt,nr,{get:()=>E.value[nr],enumerable:!0});vt.provide(tE,Wt),vt.provide(gC,uz(Xt)),vt.provide(h5,E);const ai=vt.unmount;Br.add(vt),vt.unmount=function(){Br.delete(vt),Br.size<1&&(R=Sf,Oe&&Oe(),Oe=null,E.value=Sf,Ar=!1,ri=!1),ai()}}};function Ni(vt){return vt.reduce((Wt,Xt)=>Wt.then(()=>Se(Xt)),Promise.resolve())}return Vr}function TX(r,e){const t=[],o=[],c=[],f=Math.max(e.matched.length,r.matched.length);for(let y=0;y<f;y++){const s=e.matched[y];s&&(r.matched.find(R=>f0(R,s))?o.push(s):t.push(s));const E=r.matched[y];E&&(e.matched.find(R=>f0(R,E))||c.push(E))}return[t,o,c]}function EX(){return Al(tE)}function uN(r){return Al(gC)}var hD={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hN={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wi=function(r,e){if(!r)throw z0(e)},z0=function(r){return new Error("Firebase Database ("+hN.SDK_VERSION+") INTERNAL ASSERT FAILED: "+r)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dN=function(r){const e=[];let t=0;for(let o=0;o<r.length;o++){let c=r.charCodeAt(o);c<128?e[t++]=c:c<2048?(e[t++]=c>>6|192,e[t++]=c&63|128):(c&64512)===55296&&o+1<r.length&&(r.charCodeAt(o+1)&64512)===56320?(c=65536+((c&1023)<<10)+(r.charCodeAt(++o)&1023),e[t++]=c>>18|240,e[t++]=c>>12&63|128,e[t++]=c>>6&63|128,e[t++]=c&63|128):(e[t++]=c>>12|224,e[t++]=c>>6&63|128,e[t++]=c&63|128)}return e},IX=function(r){const e=[];let t=0,o=0;for(;t<r.length;){const c=r[t++];if(c<128)e[o++]=String.fromCharCode(c);else if(c>191&&c<224){const f=r[t++];e[o++]=String.fromCharCode((c&31)<<6|f&63)}else if(c>239&&c<365){const f=r[t++],y=r[t++],s=r[t++],E=((c&7)<<18|(f&63)<<12|(y&63)<<6|s&63)-65536;e[o++]=String.fromCharCode(55296+(E>>10)),e[o++]=String.fromCharCode(56320+(E&1023))}else{const f=r[t++],y=r[t++];e[o++]=String.fromCharCode((c&15)<<12|(f&63)<<6|y&63)}}return e.join("")},iE={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let c=0;c<r.length;c+=3){const f=r[c],y=c+1<r.length,s=y?r[c+1]:0,E=c+2<r.length,R=E?r[c+2]:0,O=f>>2,A=(f&3)<<4|s>>4;let U=(s&15)<<2|R>>6,$=R&63;E||($=64,y||(U=64)),o.push(t[O],t[A],t[U],t[$])}return o.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(dN(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):IX(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let c=0;c<r.length;){const f=t[r.charAt(c++)],s=c<r.length?t[r.charAt(c)]:0;++c;const R=c<r.length?t[r.charAt(c)]:64;++c;const A=c<r.length?t[r.charAt(c)]:64;if(++c,f==null||s==null||R==null||A==null)throw new SX;const U=f<<2|s>>4;if(o.push(U),R!==64){const $=s<<4&240|R>>2;if(o.push($),A!==64){const te=R<<6&192|A;o.push(te)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class SX extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const fN=function(r){const e=dN(r);return iE.encodeByteArray(e,!0)},H2=function(r){return fN(r).replace(/\./g,"")},q2=function(r){try{return iE.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AX(r){return pN(void 0,r)}function pN(r,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:r===void 0&&(r={});break;case Array:r=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!CX(t)||(r[t]=pN(r[t],e[t]));return r}function CX(r){return r!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RX(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PX=()=>RX().__FIREBASE_DEFAULTS__,MX=()=>{if(typeof process>"u"||typeof hD>"u")return;const r=hD.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},kX=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&q2(r[1]);return e&&JSON.parse(e)},rE=()=>{try{return PX()||MX()||kX()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},DX=r=>{var e,t;return(t=(e=rE())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[r]},LX=r=>{const e=DX(r);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),o]:[e.substring(0,t),o]},mN=()=>{var r;return(r=rE())===null||r===void 0?void 0:r.config},OX=r=>{var e;return(e=rE())===null||e===void 0?void 0:e[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y1{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,o)=>{t?this.reject(t):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,o))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FX(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},o=e||"demo-project",c=r.iat||0,f=r.sub||r.user_id;if(!f)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const y=Object.assign({iss:`https://securetoken.google.com/${o}`,aud:o,iat:c,exp:c+3600,auth_time:c,sub:f,user_id:f,firebase:{sign_in_provider:"custom",identities:{}}},r);return[H2(JSON.stringify(t)),H2(JSON.stringify(y)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wa(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function yC(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Wa())}function zX(){var r;const e=(r=rE())===null||r===void 0?void 0:r.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function NX(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function _N(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function gN(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function BX(){const r=Wa();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function VX(){return hN.NODE_ADMIN===!0}function UX(){return!zX()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function vC(){try{return typeof indexedDB=="object"}catch{return!1}}function yN(){return new Promise((r,e)=>{try{let t=!0;const o="validate-browser-context-for-indexeddb-analytics-module",c=self.indexedDB.open(o);c.onsuccess=()=>{c.result.close(),t||self.indexedDB.deleteDatabase(o),r(!0)},c.onupgradeneeded=()=>{t=!1},c.onerror=()=>{var f;e(((f=c.error)===null||f===void 0?void 0:f.message)||"")}}catch(t){e(t)}})}function jX(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $X="FirebaseError";class jc extends Error{constructor(e,t,o){super(t),this.code=e,this.customData=o,this.name=$X,Object.setPrototypeOf(this,jc.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,cp.prototype.create)}}class cp{constructor(e,t,o){this.service=e,this.serviceName=t,this.errors=o}create(e,...t){const o=t[0]||{},c=`${this.service}/${e}`,f=this.errors[e],y=f?GX(f,o):"Error",s=`${this.serviceName}: ${y} (${c}).`;return new jc(c,s,o)}}function GX(r,e){return r.replace(HX,(t,o)=>{const c=e[o];return c!=null?String(c):`<${o}?>`})}const HX=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J1(r){return JSON.parse(r)}function pa(r){return JSON.stringify(r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vN=function(r){let e={},t={},o={},c="";try{const f=r.split(".");e=J1(q2(f[0])||""),t=J1(q2(f[1])||""),c=f[2],o=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:o,signature:c}},qX=function(r){const e=vN(r),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},WX=function(r){const e=vN(r).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ld(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function m0(r,e){if(Object.prototype.hasOwnProperty.call(r,e))return r[e]}function d5(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function W2(r,e,t){const o={};for(const c in r)Object.prototype.hasOwnProperty.call(r,c)&&(o[c]=e.call(t,r[c],c,r));return o}function Q1(r,e){if(r===e)return!0;const t=Object.keys(r),o=Object.keys(e);for(const c of t){if(!o.includes(c))return!1;const f=r[c],y=e[c];if(dD(f)&&dD(y)){if(!Q1(f,y))return!1}else if(f!==y)return!1}for(const c of o)if(!t.includes(c))return!1;return!0}function dD(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N0(r){const e=[];for(const[t,o]of Object.entries(r))Array.isArray(o)?o.forEach(c=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(c))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function Kv(r){const e={};return r.replace(/^\?/,"").split("&").forEach(o=>{if(o){const[c,f]=o.split("=");e[decodeURIComponent(c)]=decodeURIComponent(f)}}),e}function Yv(r){const e=r.indexOf("?");if(!e)return"";const t=r.indexOf("#",e);return r.substring(e,t>0?t:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XX{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const o=this.W_;if(typeof e=="string")for(let A=0;A<16;A++)o[A]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let A=0;A<16;A++)o[A]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let A=16;A<80;A++){const U=o[A-3]^o[A-8]^o[A-14]^o[A-16];o[A]=(U<<1|U>>>31)&4294967295}let c=this.chain_[0],f=this.chain_[1],y=this.chain_[2],s=this.chain_[3],E=this.chain_[4],R,O;for(let A=0;A<80;A++){A<40?A<20?(R=s^f&(y^s),O=1518500249):(R=f^y^s,O=1859775393):A<60?(R=f&y|s&(f|y),O=2400959708):(R=f^y^s,O=3395469782);const U=(c<<5|c>>>27)+R+E+O+o[A]&4294967295;E=s,s=y,y=(f<<30|f>>>2)&4294967295,f=c,c=U}this.chain_[0]=this.chain_[0]+c&4294967295,this.chain_[1]=this.chain_[1]+f&4294967295,this.chain_[2]=this.chain_[2]+y&4294967295,this.chain_[3]=this.chain_[3]+s&4294967295,this.chain_[4]=this.chain_[4]+E&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const o=t-this.blockSize;let c=0;const f=this.buf_;let y=this.inbuf_;for(;c<t;){if(y===0)for(;c<=o;)this.compress_(e,c),c+=this.blockSize;if(typeof e=="string"){for(;c<t;)if(f[y]=e.charCodeAt(c),++y,++c,y===this.blockSize){this.compress_(f),y=0;break}}else for(;c<t;)if(f[y]=e[c],++y,++c,y===this.blockSize){this.compress_(f),y=0;break}}this.inbuf_=y,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let c=this.blockSize-1;c>=56;c--)this.buf_[c]=t&255,t/=256;this.compress_(this.buf_);let o=0;for(let c=0;c<5;c++)for(let f=24;f>=0;f-=8)e[o]=this.chain_[c]>>f&255,++o;return e}}function ZX(r,e){const t=new KX(r,e);return t.subscribe.bind(t)}class KX{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(o=>{this.error(o)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,o){let c;if(e===void 0&&t===void 0&&o===void 0)throw new Error("Missing Observer.");YX(e,["next","error","complete"])?c=e:c={next:e,error:t,complete:o},c.next===void 0&&(c.next=rA),c.error===void 0&&(c.error=rA),c.complete===void 0&&(c.complete=rA);const f=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?c.error(this.finalError):c.complete()}catch{}}),this.observers.push(c),f}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(o){typeof console<"u"&&console.error&&console.error(o)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function YX(r,e){if(typeof r!="object"||r===null)return!1;for(const t of e)if(t in r&&typeof r[t]=="function")return!0;return!1}function rA(){}function JX(r,e){return`${r} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QX=function(r){const e=[];let t=0;for(let o=0;o<r.length;o++){let c=r.charCodeAt(o);if(c>=55296&&c<=56319){const f=c-55296;o++,Wi(o<r.length,"Surrogate pair missing trail surrogate.");const y=r.charCodeAt(o)-56320;c=65536+(f<<10)+y}c<128?e[t++]=c:c<2048?(e[t++]=c>>6|192,e[t++]=c&63|128):c<65536?(e[t++]=c>>12|224,e[t++]=c>>6&63|128,e[t++]=c&63|128):(e[t++]=c>>18|240,e[t++]=c>>12&63|128,e[t++]=c>>6&63|128,e[t++]=c&63|128)}return e},nE=function(r){let e=0;for(let t=0;t<r.length;t++){const o=r.charCodeAt(t);o<128?e++:o<2048?e+=2:o>=55296&&o<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eZ=1e3,tZ=2,iZ=4*60*60*1e3,rZ=.5;function fD(r,e=eZ,t=tZ){const o=e*Math.pow(t,r),c=Math.round(rZ*o*(Math.random()-.5)*2);return Math.min(iZ,o+c)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yl(r){return r&&r._delegate?r._delegate:r}class vl{constructor(e,t,o){this.name=e,this.instanceFactory=t,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tm="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nZ{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const o=new Y1;if(this.instancesDeferred.set(t,o),this.isInitialized(t)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:t});c&&o.resolve(c)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const o=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),c=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(f){if(c)return null;throw f}else{if(c)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(oZ(e))try{this.getOrInitializeService({instanceIdentifier:tm})}catch{}for(const[t,o]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(t);try{const f=this.getOrInitializeService({instanceIdentifier:c});o.resolve(f)}catch{}}}}clearInstance(e=tm){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=tm){return this.instances.has(e)}getOptions(e=tm){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:o,options:t});for(const[f,y]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(f);o===s&&y.resolve(c)}return c}onInit(e,t){var o;const c=this.normalizeInstanceIdentifier(t),f=(o=this.onInitCallbacks.get(c))!==null&&o!==void 0?o:new Set;f.add(e),this.onInitCallbacks.set(c,f);const y=this.instances.get(c);return y&&e(y,c),()=>{f.delete(e)}}invokeOnInitCallbacks(e,t){const o=this.onInitCallbacks.get(t);if(o)for(const c of o)try{c(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:sZ(e),options:t}),this.instances.set(e,o),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=tm){return this.component?this.component.multipleInstances?e:tm:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function sZ(r){return r===tm?void 0:r}function oZ(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aZ{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new nZ(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bn;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(Bn||(Bn={}));const lZ={debug:Bn.DEBUG,verbose:Bn.VERBOSE,info:Bn.INFO,warn:Bn.WARN,error:Bn.ERROR,silent:Bn.SILENT},cZ=Bn.INFO,uZ={[Bn.DEBUG]:"log",[Bn.VERBOSE]:"log",[Bn.INFO]:"info",[Bn.WARN]:"warn",[Bn.ERROR]:"error"},hZ=(r,e,...t)=>{if(e<r.logLevel)return;const o=new Date().toISOString(),c=uZ[e];if(c)console[c](`[${o}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class B0{constructor(e){this.name=e,this._logLevel=cZ,this._logHandler=hZ,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Bn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?lZ[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Bn.DEBUG,...e),this._logHandler(this,Bn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Bn.VERBOSE,...e),this._logHandler(this,Bn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Bn.INFO,...e),this._logHandler(this,Bn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Bn.WARN,...e),this._logHandler(this,Bn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Bn.ERROR,...e),this._logHandler(this,Bn.ERROR,...e)}}const dZ=(r,e)=>e.some(t=>r instanceof t);let pD,mD;function fZ(){return pD||(pD=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function pZ(){return mD||(mD=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const xN=new WeakMap,f5=new WeakMap,bN=new WeakMap,nA=new WeakMap,xC=new WeakMap;function mZ(r){const e=new Promise((t,o)=>{const c=()=>{r.removeEventListener("success",f),r.removeEventListener("error",y)},f=()=>{t(qf(r.result)),c()},y=()=>{o(r.error),c()};r.addEventListener("success",f),r.addEventListener("error",y)});return e.then(t=>{t instanceof IDBCursor&&xN.set(t,r)}).catch(()=>{}),xC.set(e,r),e}function _Z(r){if(f5.has(r))return;const e=new Promise((t,o)=>{const c=()=>{r.removeEventListener("complete",f),r.removeEventListener("error",y),r.removeEventListener("abort",y)},f=()=>{t(),c()},y=()=>{o(r.error||new DOMException("AbortError","AbortError")),c()};r.addEventListener("complete",f),r.addEventListener("error",y),r.addEventListener("abort",y)});f5.set(r,e)}let p5={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return f5.get(r);if(e==="objectStoreNames")return r.objectStoreNames||bN.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return qf(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function gZ(r){p5=r(p5)}function yZ(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const o=r.call(sA(this),e,...t);return bN.set(o,e.sort?e.sort():[e]),qf(o)}:pZ().includes(r)?function(...e){return r.apply(sA(this),e),qf(xN.get(this))}:function(...e){return qf(r.apply(sA(this),e))}}function vZ(r){return typeof r=="function"?yZ(r):(r instanceof IDBTransaction&&_Z(r),dZ(r,fZ())?new Proxy(r,p5):r)}function qf(r){if(r instanceof IDBRequest)return mZ(r);if(nA.has(r))return nA.get(r);const e=vZ(r);return e!==r&&(nA.set(r,e),xC.set(e,r)),e}const sA=r=>xC.get(r);function wN(r,e,{blocked:t,upgrade:o,blocking:c,terminated:f}={}){const y=indexedDB.open(r,e),s=qf(y);return o&&y.addEventListener("upgradeneeded",E=>{o(qf(y.result),E.oldVersion,E.newVersion,qf(y.transaction),E)}),t&&y.addEventListener("blocked",E=>t(E.oldVersion,E.newVersion,E)),s.then(E=>{f&&E.addEventListener("close",()=>f()),c&&E.addEventListener("versionchange",R=>c(R.oldVersion,R.newVersion,R))}).catch(()=>{}),s}const xZ=["get","getKey","getAll","getAllKeys","count"],bZ=["put","add","delete","clear"],oA=new Map;function _D(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(oA.get(e))return oA.get(e);const t=e.replace(/FromIndex$/,""),o=e!==t,c=bZ.includes(t);if(!(t in(o?IDBIndex:IDBObjectStore).prototype)||!(c||xZ.includes(t)))return;const f=async function(y,...s){const E=this.transaction(y,c?"readwrite":"readonly");let R=E.store;return o&&(R=R.index(s.shift())),(await Promise.all([R[t](...s),c&&E.done]))[0]};return oA.set(e,f),f}gZ(r=>({...r,get:(e,t,o)=>_D(e,t)||r.get(e,t,o),has:(e,t)=>!!_D(e,t)||r.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wZ{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(TZ(t)){const o=t.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(t=>t).join(" ")}}function TZ(r){const e=r.getComponent();return(e==null?void 0:e.type)==="VERSION"}const m5="@firebase/app",gD="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sd=new B0("@firebase/app"),EZ="@firebase/app-compat",IZ="@firebase/analytics-compat",SZ="@firebase/analytics",AZ="@firebase/app-check-compat",CZ="@firebase/app-check",RZ="@firebase/auth",PZ="@firebase/auth-compat",MZ="@firebase/database",kZ="@firebase/data-connect",DZ="@firebase/database-compat",LZ="@firebase/functions",OZ="@firebase/functions-compat",FZ="@firebase/installations",zZ="@firebase/installations-compat",NZ="@firebase/messaging",BZ="@firebase/messaging-compat",VZ="@firebase/performance",UZ="@firebase/performance-compat",jZ="@firebase/remote-config",$Z="@firebase/remote-config-compat",GZ="@firebase/storage",HZ="@firebase/storage-compat",qZ="@firebase/firestore",WZ="@firebase/vertexai-preview",XZ="@firebase/firestore-compat",ZZ="firebase",KZ="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _5="[DEFAULT]",YZ={[m5]:"fire-core",[EZ]:"fire-core-compat",[SZ]:"fire-analytics",[IZ]:"fire-analytics-compat",[CZ]:"fire-app-check",[AZ]:"fire-app-check-compat",[RZ]:"fire-auth",[PZ]:"fire-auth-compat",[MZ]:"fire-rtdb",[kZ]:"fire-data-connect",[DZ]:"fire-rtdb-compat",[LZ]:"fire-fn",[OZ]:"fire-fn-compat",[FZ]:"fire-iid",[zZ]:"fire-iid-compat",[NZ]:"fire-fcm",[BZ]:"fire-fcm-compat",[VZ]:"fire-perf",[UZ]:"fire-perf-compat",[jZ]:"fire-rc",[$Z]:"fire-rc-compat",[GZ]:"fire-gcs",[HZ]:"fire-gcs-compat",[qZ]:"fire-fst",[XZ]:"fire-fst-compat",[WZ]:"fire-vertex","fire-js":"fire-js",[ZZ]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X2=new Map,JZ=new Map,g5=new Map;function yD(r,e){try{r.container.addComponent(e)}catch(t){Sd.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function Ll(r){const e=r.name;if(g5.has(e))return Sd.debug(`There were multiple attempts to register component ${e}.`),!1;g5.set(e,r);for(const t of X2.values())yD(t,r);for(const t of JZ.values())yD(t,r);return!0}function sE(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function Mc(r){return r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QZ={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Wf=new cp("app","Firebase",QZ);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eK{constructor(e,t,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new vl("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Wf.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const up=KZ;function TN(r,e={}){let t=r;typeof e!="object"&&(e={name:e});const o=Object.assign({name:_5,automaticDataCollectionEnabled:!1},e),c=o.name;if(typeof c!="string"||!c)throw Wf.create("bad-app-name",{appName:String(c)});if(t||(t=mN()),!t)throw Wf.create("no-options");const f=X2.get(c);if(f){if(Q1(t,f.options)&&Q1(o,f.config))return f;throw Wf.create("duplicate-app",{appName:c})}const y=new aZ(c);for(const E of g5.values())y.addComponent(E);const s=new eK(t,o,y);return X2.set(c,s),s}function EN(r=_5){const e=X2.get(r);if(!e&&r===_5&&mN())return TN();if(!e)throw Wf.create("no-app",{appName:r});return e}function ya(r,e,t){var o;let c=(o=YZ[r])!==null&&o!==void 0?o:r;t&&(c+=`-${t}`);const f=c.match(/\s|\//),y=e.match(/\s|\//);if(f||y){const s=[`Unable to register library "${c}" with version "${e}":`];f&&s.push(`library name "${c}" contains illegal characters (whitespace or "/")`),f&&y&&s.push("and"),y&&s.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Sd.warn(s.join(" "));return}Ll(new vl(`${c}-version`,()=>({library:c,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tK="firebase-heartbeat-database",iK=1,ex="firebase-heartbeat-store";let aA=null;function IN(){return aA||(aA=wN(tK,iK,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(ex)}catch(t){console.warn(t)}}}}).catch(r=>{throw Wf.create("idb-open",{originalErrorMessage:r.message})})),aA}async function rK(r){try{const t=(await IN()).transaction(ex),o=await t.objectStore(ex).get(SN(r));return await t.done,o}catch(e){if(e instanceof jc)Sd.warn(e.message);else{const t=Wf.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Sd.warn(t.message)}}}async function vD(r,e){try{const o=(await IN()).transaction(ex,"readwrite");await o.objectStore(ex).put(e,SN(r)),await o.done}catch(t){if(t instanceof jc)Sd.warn(t.message);else{const o=Wf.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Sd.warn(o.message)}}}function SN(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nK=1024,sK=30*24*60*60*1e3;class oK{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new lK(t),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){var e,t;try{const c=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),f=xD();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===f||this._heartbeatsCache.heartbeats.some(y=>y.date===f)?void 0:(this._heartbeatsCache.heartbeats.push({date:f,agent:c}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(y=>{const s=new Date(y.date).valueOf();return Date.now()-s<=sK}),this._storage.overwrite(this._heartbeatsCache))}catch(o){Sd.warn(o)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=xD(),{heartbeatsToSend:o,unsentEntries:c}=aK(this._heartbeatsCache.heartbeats),f=H2(JSON.stringify({version:2,heartbeats:o}));return this._heartbeatsCache.lastSentHeartbeatDate=t,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),f}catch(t){return Sd.warn(t),""}}}function xD(){return new Date().toISOString().substring(0,10)}function aK(r,e=nK){const t=[];let o=r.slice();for(const c of r){const f=t.find(y=>y.agent===c.agent);if(f){if(f.dates.push(c.date),bD(t)>e){f.dates.pop();break}}else if(t.push({agent:c.agent,dates:[c.date]}),bD(t)>e){t.pop();break}o=o.slice(1)}return{heartbeatsToSend:t,unsentEntries:o}}class lK{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return vC()?yN().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await rK(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const c=await this.read();return vD(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:c.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const c=await this.read();return vD(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:c.lastSentHeartbeatDate,heartbeats:[...c.heartbeats,...e.heartbeats]})}else return}}function bD(r){return H2(JSON.stringify({version:2,heartbeats:r})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cK(r){Ll(new vl("platform-logger",e=>new wZ(e),"PRIVATE")),Ll(new vl("heartbeat",e=>new oK(e),"PRIVATE")),ya(m5,gD,r),ya(m5,gD,"esm2017"),ya("fire-js","")}cK("");function bC(r,e){var t={};for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&e.indexOf(o)<0&&(t[o]=r[o]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,o=Object.getOwnPropertySymbols(r);c<o.length;c++)e.indexOf(o[c])<0&&Object.prototype.propertyIsEnumerable.call(r,o[c])&&(t[o[c]]=r[o[c]]);return t}function Nt(r,e,t,o){var c=arguments.length,f=c<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,t):o,y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(r,e,t,o);else for(var s=r.length-1;s>=0;s--)(y=r[s])&&(f=(c<3?y(f):c>3?y(e,t,f):y(e,t))||f);return c>3&&f&&Object.defineProperty(e,t,f),f}function AN(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const uK=AN,CN=new cp("auth","Firebase",AN());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z2=new B0("@firebase/auth");function hK(r,...e){Z2.logLevel<=Bn.WARN&&Z2.warn(`Auth (${up}): ${r}`,...e)}function _2(r,...e){Z2.logLevel<=Bn.ERROR&&Z2.error(`Auth (${up}): ${r}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vc(r,...e){throw TC(r,...e)}function mu(r,...e){return TC(r,...e)}function wC(r,e,t){const o=Object.assign(Object.assign({},uK()),{[e]:t});return new cp("auth","Firebase",o).create(e,{appName:r.name})}function uh(r){return wC(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function RN(r,e,t){const o=t;if(!(e instanceof o))throw o.name!==e.constructor.name&&Vc(r,"argument-error"),wC(r,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function TC(r,...e){if(typeof r!="string"){const t=e[0],o=[...e.slice(1)];return o[0]&&(o[0].appName=r.name),r._errorFactory.create(t,...o)}return CN.create(r,...e)}function en(r,e,...t){if(!r)throw TC(e,...t)}function md(r){const e="INTERNAL ASSERTION FAILED: "+r;throw _2(e),new Error(e)}function Ad(r,e){r||md(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y5(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function dK(){return wD()==="http:"||wD()==="https:"}function wD(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fK(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(dK()||_N()||"connection"in navigator)?navigator.onLine:!0}function pK(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cx{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ad(t>e,"Short delay should be less than long delay!"),this.isMobile=yC()||gN()}get(){return fK()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EC(r,e){Ad(r.emulator,"Emulator should always be set here");const{url:t}=r.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PN{static initialize(e,t,o){this.fetchImpl=e,t&&(this.headersImpl=t),o&&(this.responseImpl=o)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;md("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;md("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;md("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mK={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _K=new Cx(3e4,6e4);function hp(r,e){return r.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:r.tenantId}):e}async function Od(r,e,t,o,c={}){return MN(r,c,async()=>{let f={},y={};o&&(e==="GET"?y=o:f={body:JSON.stringify(o)});const s=N0(Object.assign({key:r.config.apiKey},y)).slice(1),E=await r._getAdditionalHeaders();E["Content-Type"]="application/json",r.languageCode&&(E["X-Firebase-Locale"]=r.languageCode);const R=Object.assign({method:e,headers:E},f);return NX()||(R.referrerPolicy="no-referrer"),PN.fetch()(kN(r,r.config.apiHost,t,s),R)})}async function MN(r,e,t){r._canInitEmulator=!1;const o=Object.assign(Object.assign({},mK),e);try{const c=new yK(r),f=await Promise.race([t(),c.promise]);c.clearNetworkTimeout();const y=await f.json();if("needConfirmation"in y)throw Ow(r,"account-exists-with-different-credential",y);if(f.ok&&!("errorMessage"in y))return y;{const s=f.ok?y.errorMessage:y.error.message,[E,R]=s.split(" : ");if(E==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ow(r,"credential-already-in-use",y);if(E==="EMAIL_EXISTS")throw Ow(r,"email-already-in-use",y);if(E==="USER_DISABLED")throw Ow(r,"user-disabled",y);const O=o[E]||E.toLowerCase().replace(/[_\s]+/g,"-");if(R)throw wC(r,O,R);Vc(r,O)}}catch(c){if(c instanceof jc)throw c;Vc(r,"network-request-failed",{message:String(c)})}}async function Rx(r,e,t,o,c={}){const f=await Od(r,e,t,o,c);return"mfaPendingCredential"in f&&Vc(r,"multi-factor-auth-required",{_serverResponse:f}),f}function kN(r,e,t,o){const c=`${e}${t}?${o}`;return r.config.emulator?EC(r.config,c):`${r.config.apiScheme}://${c}`}function gK(r){switch(r){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class yK{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,o)=>{this.timer=setTimeout(()=>o(mu(this.auth,"network-request-failed")),_K.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ow(r,e,t){const o={appName:r.name};t.email&&(o.email=t.email),t.phoneNumber&&(o.phoneNumber=t.phoneNumber);const c=mu(r,e,o);return c.customData._tokenResponse=t,c}function TD(r){return r!==void 0&&r.enterprise!==void 0}class vK{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return gK(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function xK(r,e){return Od(r,"GET","/v2/recaptchaConfig",hp(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bK(r,e){return Od(r,"POST","/v1/accounts:delete",e)}async function DN(r,e){return Od(r,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v1(r){if(r)try{const e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function wK(r,e=!1){const t=yl(r),o=await t.getIdToken(e),c=IC(o);en(c&&c.exp&&c.auth_time&&c.iat,t.auth,"internal-error");const f=typeof c.firebase=="object"?c.firebase:void 0,y=f==null?void 0:f.sign_in_provider;return{claims:c,token:o,authTime:v1(lA(c.auth_time)),issuedAtTime:v1(lA(c.iat)),expirationTime:v1(lA(c.exp)),signInProvider:y||null,signInSecondFactor:(f==null?void 0:f.sign_in_second_factor)||null}}function lA(r){return Number(r)*1e3}function IC(r){const[e,t,o]=r.split(".");if(e===void 0||t===void 0||o===void 0)return _2("JWT malformed, contained fewer than 3 sections"),null;try{const c=q2(t);return c?JSON.parse(c):(_2("Failed to decode base64 JWT payload"),null)}catch(c){return _2("Caught error parsing JWT payload as JSON",c==null?void 0:c.toString()),null}}function ED(r){const e=IC(r);return en(e,"internal-error"),en(typeof e.exp<"u","internal-error"),en(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _0(r,e,t=!1){if(t)return e;try{return await e}catch(o){throw o instanceof jc&&TK(o)&&r.auth.currentUser===r&&await r.auth.signOut(),o}}function TK({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EK{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const c=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,c)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v5{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=v1(this.lastLoginAt),this.creationTime=v1(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function K2(r){var e;const t=r.auth,o=await r.getIdToken(),c=await _0(r,DN(t,{idToken:o}));en(c==null?void 0:c.users.length,t,"internal-error");const f=c.users[0];r._notifyReloadListener(f);const y=!((e=f.providerUserInfo)===null||e===void 0)&&e.length?LN(f.providerUserInfo):[],s=SK(r.providerData,y),E=r.isAnonymous,R=!(r.email&&f.passwordHash)&&!(s!=null&&s.length),O=E?R:!1,A={uid:f.localId,displayName:f.displayName||null,photoURL:f.photoUrl||null,email:f.email||null,emailVerified:f.emailVerified||!1,phoneNumber:f.phoneNumber||null,tenantId:f.tenantId||null,providerData:s,metadata:new v5(f.createdAt,f.lastLoginAt),isAnonymous:O};Object.assign(r,A)}async function IK(r){const e=yl(r);await K2(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function SK(r,e){return[...r.filter(o=>!e.some(c=>c.providerId===o.providerId)),...e]}function LN(r){return r.map(e=>{var{providerId:t}=e,o=bC(e,["providerId"]);return{providerId:t,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AK(r,e){const t=await MN(r,{},async()=>{const o=N0({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:c,apiKey:f}=r.config,y=kN(r,c,"/v1/token",`key=${f}`),s=await r._getAdditionalHeaders();return s["Content-Type"]="application/x-www-form-urlencoded",PN.fetch()(y,{method:"POST",headers:s,body:o})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function CK(r,e){return Od(r,"POST","/v2/accounts:revokeToken",hp(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yg{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){en(e.idToken,"internal-error"),en(typeof e.idToken<"u","internal-error"),en(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ED(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){en(e.length!==0,"internal-error");const t=ED(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(en(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:o,refreshToken:c,expiresIn:f}=await AK(e,t);this.updateTokensAndExpiration(o,c,Number(f))}updateTokensAndExpiration(e,t,o){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+o*1e3}static fromJSON(e,t){const{refreshToken:o,accessToken:c,expirationTime:f}=t,y=new Yg;return o&&(en(typeof o=="string","internal-error",{appName:e}),y.refreshToken=o),c&&(en(typeof c=="string","internal-error",{appName:e}),y.accessToken=c),f&&(en(typeof f=="number","internal-error",{appName:e}),y.expirationTime=f),y}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Yg,this.toJSON())}_performRefresh(){return md("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Af(r,e){en(typeof r=="string"||typeof r>"u","internal-error",{appName:e})}class _d{constructor(e){var{uid:t,auth:o,stsTokenManager:c}=e,f=bC(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new EK(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=o,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=f.displayName||null,this.email=f.email||null,this.emailVerified=f.emailVerified||!1,this.phoneNumber=f.phoneNumber||null,this.photoURL=f.photoURL||null,this.isAnonymous=f.isAnonymous||!1,this.tenantId=f.tenantId||null,this.providerData=f.providerData?[...f.providerData]:[],this.metadata=new v5(f.createdAt||void 0,f.lastLoginAt||void 0)}async getIdToken(e){const t=await _0(this,this.stsTokenManager.getToken(this.auth,e));return en(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return wK(this,e)}reload(){return IK(this)}_assign(e){this!==e&&(en(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new _d(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){en(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let o=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),o=!0),t&&await K2(this),await this.auth._persistUserIfCurrent(this),o&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Mc(this.auth.app))return Promise.reject(uh(this.auth));const e=await this.getIdToken();return await _0(this,bK(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var o,c,f,y,s,E,R,O;const A=(o=t.displayName)!==null&&o!==void 0?o:void 0,U=(c=t.email)!==null&&c!==void 0?c:void 0,$=(f=t.phoneNumber)!==null&&f!==void 0?f:void 0,te=(y=t.photoURL)!==null&&y!==void 0?y:void 0,Q=(s=t.tenantId)!==null&&s!==void 0?s:void 0,de=(E=t._redirectEventId)!==null&&E!==void 0?E:void 0,Ce=(R=t.createdAt)!==null&&R!==void 0?R:void 0,Fe=(O=t.lastLoginAt)!==null&&O!==void 0?O:void 0,{uid:Le,emailVerified:Me,isAnonymous:at,providerData:pt,stsTokenManager:me}=t;en(Le&&me,e,"internal-error");const ye=Yg.fromJSON(this.name,me);en(typeof Le=="string",e,"internal-error"),Af(A,e.name),Af(U,e.name),en(typeof Me=="boolean",e,"internal-error"),en(typeof at=="boolean",e,"internal-error"),Af($,e.name),Af(te,e.name),Af(Q,e.name),Af(de,e.name),Af(Ce,e.name),Af(Fe,e.name);const Se=new _d({uid:Le,auth:e,email:U,emailVerified:Me,displayName:A,isAnonymous:at,photoURL:te,phoneNumber:$,tenantId:Q,stsTokenManager:ye,createdAt:Ce,lastLoginAt:Fe});return pt&&Array.isArray(pt)&&(Se.providerData=pt.map(ke=>Object.assign({},ke))),de&&(Se._redirectEventId=de),Se}static async _fromIdTokenResponse(e,t,o=!1){const c=new Yg;c.updateFromServerResponse(t);const f=new _d({uid:t.localId,auth:e,stsTokenManager:c,isAnonymous:o});return await K2(f),f}static async _fromGetAccountInfoResponse(e,t,o){const c=t.users[0];en(c.localId!==void 0,"internal-error");const f=c.providerUserInfo!==void 0?LN(c.providerUserInfo):[],y=!(c.email&&c.passwordHash)&&!(f!=null&&f.length),s=new Yg;s.updateFromIdToken(o);const E=new _d({uid:c.localId,auth:e,stsTokenManager:s,isAnonymous:y}),R={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:f,metadata:new v5(c.createdAt,c.lastLoginAt),isAnonymous:!(c.email&&c.passwordHash)&&!(f!=null&&f.length)};return Object.assign(E,R),E}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ID=new Map;function gd(r){Ad(r instanceof Function,"Expected a class definition");let e=ID.get(r);return e?(Ad(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,ID.set(r,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ON{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ON.type="NONE";const SD=ON;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g2(r,e,t){return`firebase:${r}:${e}:${t}`}class Jg{constructor(e,t,o){this.persistence=e,this.auth=t,this.userKey=o;const{config:c,name:f}=this.auth;this.fullUserKey=g2(this.userKey,c.apiKey,f),this.fullPersistenceKey=g2("persistence",c.apiKey,f),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?_d._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,o="authUser"){if(!t.length)return new Jg(gd(SD),e,o);const c=(await Promise.all(t.map(async R=>{if(await R._isAvailable())return R}))).filter(R=>R);let f=c[0]||gd(SD);const y=g2(o,e.config.apiKey,e.name);let s=null;for(const R of t)try{const O=await R._get(y);if(O){const A=_d._fromJSON(e,O);R!==f&&(s=A),f=R;break}}catch{}const E=c.filter(R=>R._shouldAllowMigration);return!f._shouldAllowMigration||!E.length?new Jg(f,e,o):(f=E[0],s&&await f._set(y,s.toJSON()),await Promise.all(t.map(async R=>{if(R!==f)try{await R._remove(y)}catch{}})),new Jg(f,e,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AD(r){const e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(BN(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(FN(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(UN(e))return"Blackberry";if(jN(e))return"Webos";if(zN(e))return"Safari";if((e.includes("chrome/")||NN(e))&&!e.includes("edge/"))return"Chrome";if(VN(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,o=r.match(t);if((o==null?void 0:o.length)===2)return o[1]}return"Other"}function FN(r=Wa()){return/firefox\//i.test(r)}function zN(r=Wa()){const e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function NN(r=Wa()){return/crios\//i.test(r)}function BN(r=Wa()){return/iemobile/i.test(r)}function VN(r=Wa()){return/android/i.test(r)}function UN(r=Wa()){return/blackberry/i.test(r)}function jN(r=Wa()){return/webos/i.test(r)}function SC(r=Wa()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function RK(r=Wa()){var e;return SC(r)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function PK(){return BX()&&document.documentMode===10}function $N(r=Wa()){return SC(r)||VN(r)||jN(r)||UN(r)||/windows phone/i.test(r)||BN(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GN(r,e=[]){let t;switch(r){case"Browser":t=AD(Wa());break;case"Worker":t=`${AD(Wa())}-${r}`;break;default:t=r}const o=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${up}/${o}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MK{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const o=f=>new Promise((y,s)=>{try{const E=e(f);y(E)}catch(E){s(E)}});o.onAbort=t,this.queue.push(o);const c=this.queue.length-1;return()=>{this.queue[c]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const o of this.queue)await o(e),o.onAbort&&t.push(o.onAbort)}catch(o){t.reverse();for(const c of t)try{c()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:o==null?void 0:o.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kK(r,e={}){return Od(r,"GET","/v2/passwordPolicy",hp(r,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DK=6;class LK{constructor(e){var t,o,c,f;const y=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=y.minPasswordLength)!==null&&t!==void 0?t:DK,y.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=y.maxPasswordLength),y.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=y.containsLowercaseCharacter),y.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=y.containsUppercaseCharacter),y.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=y.containsNumericCharacter),y.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=y.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(c=(o=e.allowedNonAlphanumericCharacters)===null||o===void 0?void 0:o.join(""))!==null&&c!==void 0?c:"",this.forceUpgradeOnSignin=(f=e.forceUpgradeOnSignin)!==null&&f!==void 0?f:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,o,c,f,y,s;const E={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,E),this.validatePasswordCharacterOptions(e,E),E.isValid&&(E.isValid=(t=E.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),E.isValid&&(E.isValid=(o=E.meetsMaxPasswordLength)!==null&&o!==void 0?o:!0),E.isValid&&(E.isValid=(c=E.containsLowercaseLetter)!==null&&c!==void 0?c:!0),E.isValid&&(E.isValid=(f=E.containsUppercaseLetter)!==null&&f!==void 0?f:!0),E.isValid&&(E.isValid=(y=E.containsNumericCharacter)!==null&&y!==void 0?y:!0),E.isValid&&(E.isValid=(s=E.containsNonAlphanumericCharacter)!==null&&s!==void 0?s:!0),E}validatePasswordLengthOptions(e,t){const o=this.customStrengthOptions.minPasswordLength,c=this.customStrengthOptions.maxPasswordLength;o&&(t.meetsMinPasswordLength=e.length>=o),c&&(t.meetsMaxPasswordLength=e.length<=c)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let o;for(let c=0;c<e.length;c++)o=e.charAt(c),this.updatePasswordCharacterOptionsStatuses(t,o>="a"&&o<="z",o>="A"&&o<="Z",o>="0"&&o<="9",this.allowedNonAlphanumericCharacters.includes(o))}updatePasswordCharacterOptionsStatuses(e,t,o,c,f){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=o)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=c)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OK{constructor(e,t,o,c){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=o,this.config=c,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new CD(this),this.idTokenSubscription=new CD(this),this.beforeStateQueue=new MK(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=CN,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=c.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=gd(t)),this._initializationPromise=this.queue(async()=>{var o,c;if(!this._deleted&&(this.persistenceManager=await Jg.create(this,e),!this._deleted)){if(!((o=this._popupRedirectResolver)===null||o===void 0)&&o._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((c=this.currentUser)===null||c===void 0?void 0:c.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await DN(this,{idToken:e}),o=await _d._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(o)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Mc(this.app)){const y=this.app.settings.authIdToken;return y?new Promise(s=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(y).then(s,s))}):this.directlySetCurrentUser(null)}const o=await this.assertedPersistence.getCurrentUser();let c=o,f=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const y=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,s=c==null?void 0:c._redirectEventId,E=await this.tryRedirectSignIn(e);(!y||y===s)&&(E!=null&&E.user)&&(c=E.user,f=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(f)try{await this.beforeStateQueue.runMiddleware(c)}catch(y){c=o,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(y))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return en(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await K2(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=pK()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Mc(this.app))return Promise.reject(uh(this));const t=e?yl(e):null;return t&&en(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&en(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Mc(this.app)?Promise.reject(uh(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Mc(this.app)?Promise.reject(uh(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(gd(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await kK(this),t=new LK(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new cp("auth","Firebase",e())}onAuthStateChanged(e,t,o){return this.registerStateListener(this.authStateSubscription,e,t,o)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,o){return this.registerStateListener(this.idTokenSubscription,e,t,o)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const o=this.onAuthStateChanged(()=>{o(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),o={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(o.tenantId=this.tenantId),await CK(this,o)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const o=await this.getOrInitRedirectPersistenceManager(t);return e===null?o.removeCurrentUser():o.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&gd(e)||this._popupRedirectResolver;en(t,this,"argument-error"),this.redirectPersistenceManager=await Jg.create(this,[gd(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,o;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const o=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==o&&(this.lastNotifiedUid=o,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,o,c){if(this._deleted)return()=>{};const f=typeof t=="function"?t:t.next.bind(t);let y=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(en(s,this,"internal-error"),s.then(()=>{y||f(this.currentUser)}),typeof t=="function"){const E=e.addObserver(t,o,c);return()=>{y=!0,E()}}else{const E=e.addObserver(t);return()=>{y=!0,E()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return en(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=GN(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const o=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());o&&(t["X-Firebase-Client"]=o);const c=await this._getAppCheckToken();return c&&(t["X-Firebase-AppCheck"]=c),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&hK(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Fd(r){return yl(r)}class CD{constructor(e){this.auth=e,this.observer=null,this.addObserver=ZX(t=>this.observer=t)}get next(){return en(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oE={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function FK(r){oE=r}function HN(r){return oE.loadJS(r)}function zK(){return oE.recaptchaEnterpriseScript}function NK(){return oE.gapiScript}function BK(r){return`__${r}${Math.floor(Math.random()*1e6)}`}const VK="recaptcha-enterprise",UK="NO_RECAPTCHA";class jK{constructor(e){this.type=VK,this.auth=Fd(e)}async verify(e="verify",t=!1){async function o(f){if(!t){if(f.tenantId==null&&f._agentRecaptchaConfig!=null)return f._agentRecaptchaConfig.siteKey;if(f.tenantId!=null&&f._tenantRecaptchaConfigs[f.tenantId]!==void 0)return f._tenantRecaptchaConfigs[f.tenantId].siteKey}return new Promise(async(y,s)=>{xK(f,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(E=>{if(E.recaptchaKey===void 0)s(new Error("recaptcha Enterprise site key undefined"));else{const R=new vK(E);return f.tenantId==null?f._agentRecaptchaConfig=R:f._tenantRecaptchaConfigs[f.tenantId]=R,y(R.siteKey)}}).catch(E=>{s(E)})})}function c(f,y,s){const E=window.grecaptcha;TD(E)?E.enterprise.ready(()=>{E.enterprise.execute(f,{action:e}).then(R=>{y(R)}).catch(()=>{y(UK)})}):s(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((f,y)=>{o(this.auth).then(s=>{if(!t&&TD(window.grecaptcha))c(s,f,y);else{if(typeof window>"u"){y(new Error("RecaptchaVerifier is only supported in browser"));return}let E=zK();E.length!==0&&(E+=s),HN(E).then(()=>{c(s,f,y)}).catch(R=>{y(R)})}}).catch(s=>{y(s)})})}}async function RD(r,e,t,o=!1){const c=new jK(r);let f;try{f=await c.verify(t)}catch{f=await c.verify(t,!0)}const y=Object.assign({},e);return o?Object.assign(y,{captchaResp:f}):Object.assign(y,{captchaResponse:f}),Object.assign(y,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(y,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),y}async function x5(r,e,t,o){var c;if(!((c=r._getRecaptchaConfig())===null||c===void 0)&&c.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await RD(r,e,t,t==="getOobCode");return o(r,f)}else return o(r,e).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const y=await RD(r,e,t,t==="getOobCode");return o(r,y)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $K(r,e){const t=sE(r,"auth");if(t.isInitialized()){const c=t.getImmediate(),f=t.getOptions();if(Q1(f,e??{}))return c;Vc(c,"already-initialized")}return t.initialize({options:e})}function GK(r,e){const t=(e==null?void 0:e.persistence)||[],o=(Array.isArray(t)?t:[t]).map(gd);e!=null&&e.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(o,e==null?void 0:e.popupRedirectResolver)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AC{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return md("not implemented")}_getIdTokenResponse(e){return md("not implemented")}_linkToIdToken(e,t){return md("not implemented")}_getReauthenticationResolver(e){return md("not implemented")}}async function HK(r,e){return Od(r,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qK(r,e){return Rx(r,"POST","/v1/accounts:signInWithPassword",hp(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WK(r,e){return Rx(r,"POST","/v1/accounts:signInWithEmailLink",hp(r,e))}async function XK(r,e){return Rx(r,"POST","/v1/accounts:signInWithEmailLink",hp(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tx extends AC{constructor(e,t,o,c=null){super("password",o),this._email=e,this._password=t,this._tenantId=c}static _fromEmailAndPassword(e,t){return new tx(e,t,"password")}static _fromEmailAndCode(e,t,o=null){return new tx(e,t,"emailLink",o)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return x5(e,t,"signInWithPassword",qK);case"emailLink":return WK(e,{email:this._email,oobCode:this._password});default:Vc(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const o={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return x5(e,o,"signUpPassword",HK);case"emailLink":return XK(e,{idToken:t,email:this._email,oobCode:this._password});default:Vc(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qg(r,e){return Rx(r,"POST","/v1/accounts:signInWithIdp",hp(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZK="http://localhost";class Sm extends AC{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Sm(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Vc("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:o,signInMethod:c}=t,f=bC(t,["providerId","signInMethod"]);if(!o||!c)return null;const y=new Sm(o,c);return y.idToken=f.idToken||void 0,y.accessToken=f.accessToken||void 0,y.secret=f.secret,y.nonce=f.nonce,y.pendingToken=f.pendingToken||null,y}_getIdTokenResponse(e){const t=this.buildRequest();return Qg(e,t)}_linkToIdToken(e,t){const o=this.buildRequest();return o.idToken=t,Qg(e,o)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Qg(e,t)}buildRequest(){const e={requestUri:ZK,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=N0(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KK(r){switch(r){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function YK(r){const e=Kv(Yv(r)).link,t=e?Kv(Yv(e)).deep_link_id:null,o=Kv(Yv(r)).deep_link_id;return(o?Kv(Yv(o)).link:null)||o||t||e||r}class CC{constructor(e){var t,o,c,f,y,s;const E=Kv(Yv(e)),R=(t=E.apiKey)!==null&&t!==void 0?t:null,O=(o=E.oobCode)!==null&&o!==void 0?o:null,A=KK((c=E.mode)!==null&&c!==void 0?c:null);en(R&&O&&A,"argument-error"),this.apiKey=R,this.operation=A,this.code=O,this.continueUrl=(f=E.continueUrl)!==null&&f!==void 0?f:null,this.languageCode=(y=E.languageCode)!==null&&y!==void 0?y:null,this.tenantId=(s=E.tenantId)!==null&&s!==void 0?s:null}static parseLink(e){const t=YK(e);try{return new CC(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V0{constructor(){this.providerId=V0.PROVIDER_ID}static credential(e,t){return tx._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const o=CC.parseLink(t);return en(o,"argument-error"),tx._fromEmailAndCode(e,o.code,o.tenantId)}}V0.PROVIDER_ID="password";V0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";V0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Px extends aE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lf extends Px{constructor(){super("facebook.com")}static credential(e){return Sm._fromParams({providerId:Lf.PROVIDER_ID,signInMethod:Lf.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Lf.credentialFromTaggedObject(e)}static credentialFromError(e){return Lf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Lf.credential(e.oauthAccessToken)}catch{return null}}}Lf.FACEBOOK_SIGN_IN_METHOD="facebook.com";Lf.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fd extends Px{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Sm._fromParams({providerId:fd.PROVIDER_ID,signInMethod:fd.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return fd.credentialFromTaggedObject(e)}static credentialFromError(e){return fd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:o}=e;if(!t&&!o)return null;try{return fd.credential(t,o)}catch{return null}}}fd.GOOGLE_SIGN_IN_METHOD="google.com";fd.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Of extends Px{constructor(){super("github.com")}static credential(e){return Sm._fromParams({providerId:Of.PROVIDER_ID,signInMethod:Of.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Of.credentialFromTaggedObject(e)}static credentialFromError(e){return Of.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Of.credential(e.oauthAccessToken)}catch{return null}}}Of.GITHUB_SIGN_IN_METHOD="github.com";Of.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff extends Px{constructor(){super("twitter.com")}static credential(e,t){return Sm._fromParams({providerId:Ff.PROVIDER_ID,signInMethod:Ff.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ff.credentialFromTaggedObject(e)}static credentialFromError(e){return Ff.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:o}=e;if(!t||!o)return null;try{return Ff.credential(t,o)}catch{return null}}}Ff.TWITTER_SIGN_IN_METHOD="twitter.com";Ff.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JK(r,e){return Rx(r,"POST","/v1/accounts:signUp",hp(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Am{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,o,c=!1){const f=await _d._fromIdTokenResponse(e,o,c),y=PD(o);return new Am({user:f,providerId:y,_tokenResponse:o,operationType:t})}static async _forOperation(e,t,o){await e._updateTokensIfNecessary(o,!0);const c=PD(o);return new Am({user:e,providerId:c,_tokenResponse:o,operationType:t})}}function PD(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y2 extends jc{constructor(e,t,o,c){var f;super(t.code,t.message),this.operationType=o,this.user=c,Object.setPrototypeOf(this,Y2.prototype),this.customData={appName:e.name,tenantId:(f=e.tenantId)!==null&&f!==void 0?f:void 0,_serverResponse:t.customData._serverResponse,operationType:o}}static _fromErrorAndOperation(e,t,o,c){return new Y2(e,t,o,c)}}function qN(r,e,t,o){return(e==="reauthenticate"?t._getReauthenticationResolver(r):t._getIdTokenResponse(r)).catch(f=>{throw f.code==="auth/multi-factor-auth-required"?Y2._fromErrorAndOperation(r,f,e,o):f})}async function QK(r,e,t=!1){const o=await _0(r,e._linkToIdToken(r.auth,await r.getIdToken()),t);return Am._forOperation(r,"link",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eY(r,e,t=!1){const{auth:o}=r;if(Mc(o.app))return Promise.reject(uh(o));const c="reauthenticate";try{const f=await _0(r,qN(o,c,e,r),t);en(f.idToken,o,"internal-error");const y=IC(f.idToken);en(y,o,"internal-error");const{sub:s}=y;return en(r.uid===s,o,"user-mismatch"),Am._forOperation(r,c,f)}catch(f){throw(f==null?void 0:f.code)==="auth/user-not-found"&&Vc(o,"user-mismatch"),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WN(r,e,t=!1){if(Mc(r.app))return Promise.reject(uh(r));const o="signIn",c=await qN(r,o,e),f=await Am._fromIdTokenResponse(r,o,c);return t||await r._updateCurrentUser(f.user),f}async function tY(r,e){return WN(Fd(r),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XN(r){const e=Fd(r);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function ade(r,e,t){if(Mc(r.app))return Promise.reject(uh(r));const o=Fd(r),y=await x5(o,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",JK).catch(E=>{throw E.code==="auth/password-does-not-meet-requirements"&&XN(r),E}),s=await Am._fromIdTokenResponse(o,"signIn",y);return await o._updateCurrentUser(s.user),s}function lde(r,e,t){return Mc(r.app)?Promise.reject(uh(r)):tY(yl(r),V0.credential(e,t)).catch(async o=>{throw o.code==="auth/password-does-not-meet-requirements"&&XN(r),o})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iY(r,e){return Od(r,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cde(r,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const o=yl(r),f={idToken:await o.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},y=await _0(o,iY(o.auth,f));o.displayName=y.displayName||null,o.photoURL=y.photoUrl||null;const s=o.providerData.find(({providerId:E})=>E==="password");s&&(s.displayName=o.displayName,s.photoURL=o.photoURL),await o._updateTokensIfNecessary(y)}function rY(r,e,t,o){return yl(r).onIdTokenChanged(e,t,o)}const J2="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZN{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(J2,"1"),this.storage.removeItem(J2),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nY=1e3,sY=10;class KN extends ZN{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=$N(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const o=this.storage.getItem(t),c=this.localCache[t];o!==c&&e(t,c,o)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((y,s,E)=>{this.notifyListeners(y,E)});return}const o=e.key;t?this.detachListener():this.stopPolling();const c=()=>{const y=this.storage.getItem(o);!t&&this.localCache[o]===y||this.notifyListeners(o,y)},f=this.storage.getItem(o);PK()&&f!==e.newValue&&e.newValue!==e.oldValue?setTimeout(c,sY):c()}notifyListeners(e,t){this.localCache[e]=t;const o=this.listeners[e];if(o)for(const c of Array.from(o))c(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,o)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:o}),!0)})},nY)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}KN.type="LOCAL";const oY=KN;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YN extends ZN{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}YN.type="SESSION";const JN=YN;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aY(r){return Promise.all(r.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lE{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(c=>c.isListeningto(e));if(t)return t;const o=new lE(e);return this.receivers.push(o),o}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:o,eventType:c,data:f}=t.data,y=this.handlersMap[c];if(!(y!=null&&y.size))return;t.ports[0].postMessage({status:"ack",eventId:o,eventType:c});const s=Array.from(y).map(async R=>R(t.origin,f)),E=await aY(s);t.ports[0].postMessage({status:"done",eventId:o,eventType:c,response:E})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}lE.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RC(r="",e=10){let t="";for(let o=0;o<e;o++)t+=Math.floor(Math.random()*10);return r+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lY{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,o=50){const c=typeof MessageChannel<"u"?new MessageChannel:null;if(!c)throw new Error("connection_unavailable");let f,y;return new Promise((s,E)=>{const R=RC("",20);c.port1.start();const O=setTimeout(()=>{E(new Error("unsupported_event"))},o);y={messageChannel:c,onMessage(A){const U=A;if(U.data.eventId===R)switch(U.data.status){case"ack":clearTimeout(O),f=setTimeout(()=>{E(new Error("timeout"))},3e3);break;case"done":clearTimeout(f),s(U.data.response);break;default:clearTimeout(O),clearTimeout(f),E(new Error("invalid_response"));break}}},this.handlers.add(y),c.port1.addEventListener("message",y.onMessage),this.target.postMessage({eventType:e,eventId:R,data:t},[c.port2])}).finally(()=>{y&&this.removeMessageHandler(y)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hh(){return window}function cY(r){hh().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QN(){return typeof hh().WorkerGlobalScope<"u"&&typeof hh().importScripts=="function"}async function uY(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function hY(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function dY(){return QN()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eB="firebaseLocalStorageDb",fY=1,Q2="firebaseLocalStorage",tB="fbase_key";class Mx{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function cE(r,e){return r.transaction([Q2],e?"readwrite":"readonly").objectStore(Q2)}function pY(){const r=indexedDB.deleteDatabase(eB);return new Mx(r).toPromise()}function b5(){const r=indexedDB.open(eB,fY);return new Promise((e,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const o=r.result;try{o.createObjectStore(Q2,{keyPath:tB})}catch(c){t(c)}}),r.addEventListener("success",async()=>{const o=r.result;o.objectStoreNames.contains(Q2)?e(o):(o.close(),await pY(),e(await b5()))})})}async function MD(r,e,t){const o=cE(r,!0).put({[tB]:e,value:t});return new Mx(o).toPromise()}async function mY(r,e){const t=cE(r,!1).get(e),o=await new Mx(t).toPromise();return o===void 0?null:o.value}function kD(r,e){const t=cE(r,!0).delete(e);return new Mx(t).toPromise()}const _Y=800,gY=3;class iB{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await b5(),this.db)}async _withRetries(e){let t=0;for(;;)try{const o=await this._openDb();return await e(o)}catch(o){if(t++>gY)throw o;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return QN()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=lE._getInstance(dY()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await uY(),!this.activeServiceWorker)return;this.sender=new lY(this.activeServiceWorker);const o=await this.sender._send("ping",{},800);o&&!((e=o[0])===null||e===void 0)&&e.fulfilled&&!((t=o[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||hY()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await b5();return await MD(e,J2,"1"),await kD(e,J2),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(o=>MD(o,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(o=>mY(o,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>kD(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(c=>{const f=cE(c,!1).getAll();return new Mx(f).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],o=new Set;if(e.length!==0)for(const{fbase_key:c,value:f}of e)o.add(c),JSON.stringify(this.localCache[c])!==JSON.stringify(f)&&(this.notifyListeners(c,f),t.push(c));for(const c of Object.keys(this.localCache))this.localCache[c]&&!o.has(c)&&(this.notifyListeners(c,null),t.push(c));return t}notifyListeners(e,t){this.localCache[e]=t;const o=this.listeners[e];if(o)for(const c of Array.from(o))c(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),_Y)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}iB.type="LOCAL";const yY=iB;new Cx(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PC(r,e){return e?gd(e):(en(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MC extends AC{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Qg(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Qg(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Qg(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function vY(r){return WN(r.auth,new MC(r),r.bypassAuthState)}function xY(r){const{auth:e,user:t}=r;return en(t,e,"internal-error"),eY(t,new MC(r),r.bypassAuthState)}async function bY(r){const{auth:e,user:t}=r;return en(t,e,"internal-error"),QK(t,new MC(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rB{constructor(e,t,o,c,f=!1){this.auth=e,this.resolver=o,this.user=c,this.bypassAuthState=f,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(o){this.reject(o)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:o,postBody:c,tenantId:f,error:y,type:s}=e;if(y){this.reject(y);return}const E={auth:this.auth,requestUri:t,sessionId:o,tenantId:f||void 0,postBody:c||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(E))}catch(R){this.reject(R)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return vY;case"linkViaPopup":case"linkViaRedirect":return bY;case"reauthViaPopup":case"reauthViaRedirect":return xY;default:Vc(this.auth,"internal-error")}}resolve(e){Ad(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ad(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wY=new Cx(2e3,1e4);async function TY(r,e,t){if(Mc(r.app))return Promise.reject(mu(r,"operation-not-supported-in-this-environment"));const o=Fd(r);RN(r,e,aE);const c=PC(o,t);return new om(o,"signInViaPopup",e,c).executeNotNull()}class om extends rB{constructor(e,t,o,c,f){super(e,t,c,f),this.provider=o,this.authWindow=null,this.pollId=null,om.currentPopupAction&&om.currentPopupAction.cancel(),om.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return en(e,this.auth,"internal-error"),e}async onExecution(){Ad(this.filter.length===1,"Popup operations only handle one event");const e=RC();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(mu(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(mu(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,om.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,o;if(!((o=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||o===void 0)&&o.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(mu(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,wY.get())};e()}}om.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EY="pendingRedirect",y2=new Map;class IY extends rB{constructor(e,t,o=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,o),this.eventId=null}async execute(){let e=y2.get(this.auth._key());if(!e){try{const o=await SY(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(o)}catch(t){e=()=>Promise.reject(t)}y2.set(this.auth._key(),e)}return this.bypassAuthState||y2.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function SY(r,e){const t=sB(e),o=nB(r);if(!await o._isAvailable())return!1;const c=await o._get(t)==="true";return await o._remove(t),c}async function AY(r,e){return nB(r)._set(sB(e),"true")}function CY(r,e){y2.set(r._key(),e)}function nB(r){return gd(r._redirectPersistence)}function sB(r){return g2(EY,r.config.apiKey,r.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RY(r,e,t){return PY(r,e,t)}async function PY(r,e,t){if(Mc(r.app))return Promise.reject(uh(r));const o=Fd(r);RN(r,e,aE),await o._initializationPromise;const c=PC(o,t);return await AY(c,o),c._openRedirect(o,e,"signInViaRedirect")}async function MY(r,e){return await Fd(r)._initializationPromise,oB(r,e,!1)}async function oB(r,e,t=!1){if(Mc(r.app))return Promise.reject(uh(r));const o=Fd(r),c=PC(o,e),y=await new IY(o,c,t).execute();return y&&!t&&(delete y.user._redirectEventId,await o._persistUserIfCurrent(y.user),await o._setRedirectUser(null,e)),y}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kY=10*60*1e3;class DY{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(o=>{this.isEventForConsumer(e,o)&&(t=!0,this.sendToConsumer(e,o),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!LY(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var o;if(e.error&&!aB(e)){const c=((o=e.error.code)===null||o===void 0?void 0:o.split("auth/")[1])||"internal-error";t.onError(mu(this.auth,c))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const o=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&o}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=kY&&this.cachedEventUids.clear(),this.cachedEventUids.has(DD(e))}saveEventToCache(e){this.cachedEventUids.add(DD(e)),this.lastProcessedEventTime=Date.now()}}function DD(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function aB({type:r,error:e}){return r==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function LY(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return aB(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OY(r,e={}){return Od(r,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FY=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,zY=/^https?/;async function NY(r){if(r.config.emulator)return;const{authorizedDomains:e}=await OY(r);for(const t of e)try{if(BY(t))return}catch{}Vc(r,"unauthorized-domain")}function BY(r){const e=y5(),{protocol:t,hostname:o}=new URL(e);if(r.startsWith("chrome-extension://")){const y=new URL(r);return y.hostname===""&&o===""?t==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&y.hostname===o}if(!zY.test(t))return!1;if(FY.test(r))return o===r;const c=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+c+"|"+c+")$","i").test(o)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VY=new Cx(3e4,6e4);function LD(){const r=hh().___jsl;if(r!=null&&r.H){for(const e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let t=0;t<r.CP.length;t++)r.CP[t]=null}}function UY(r){return new Promise((e,t)=>{var o,c,f;function y(){LD(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{LD(),t(mu(r,"network-request-failed"))},timeout:VY.get()})}if(!((c=(o=hh().gapi)===null||o===void 0?void 0:o.iframes)===null||c===void 0)&&c.Iframe)e(gapi.iframes.getContext());else if(!((f=hh().gapi)===null||f===void 0)&&f.load)y();else{const s=BK("iframefcb");return hh()[s]=()=>{gapi.load?y():t(mu(r,"network-request-failed"))},HN(`${NK()}?onload=${s}`).catch(E=>t(E))}}).catch(e=>{throw v2=null,e})}let v2=null;function jY(r){return v2=v2||UY(r),v2}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $Y=new Cx(5e3,15e3),GY="__/auth/iframe",HY="emulator/auth/iframe",qY={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},WY=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function XY(r){const e=r.config;en(e.authDomain,r,"auth-domain-config-required");const t=e.emulator?EC(e,HY):`https://${r.config.authDomain}/${GY}`,o={apiKey:e.apiKey,appName:r.name,v:up},c=WY.get(r.config.apiHost);c&&(o.eid=c);const f=r._getFrameworks();return f.length&&(o.fw=f.join(",")),`${t}?${N0(o).slice(1)}`}async function ZY(r){const e=await jY(r),t=hh().gapi;return en(t,r,"internal-error"),e.open({where:document.body,url:XY(r),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:qY,dontclear:!0},o=>new Promise(async(c,f)=>{await o.restyle({setHideOnLeave:!1});const y=mu(r,"network-request-failed"),s=hh().setTimeout(()=>{f(y)},$Y.get());function E(){hh().clearTimeout(s),c(o)}o.ping(E).then(E,()=>{f(y)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KY={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},YY=500,JY=600,QY="_blank",eJ="http://localhost";class OD{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function tJ(r,e,t,o=YY,c=JY){const f=Math.max((window.screen.availHeight-c)/2,0).toString(),y=Math.max((window.screen.availWidth-o)/2,0).toString();let s="";const E=Object.assign(Object.assign({},KY),{width:o.toString(),height:c.toString(),top:f,left:y}),R=Wa().toLowerCase();t&&(s=NN(R)?QY:t),FN(R)&&(e=e||eJ,E.scrollbars="yes");const O=Object.entries(E).reduce((U,[$,te])=>`${U}${$}=${te},`,"");if(RK(R)&&s!=="_self")return iJ(e||"",s),new OD(null);const A=window.open(e||"",s,O);en(A,r,"popup-blocked");try{A.focus()}catch{}return new OD(A)}function iJ(r,e){const t=document.createElement("a");t.href=r,t.target=e;const o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rJ="__/auth/handler",nJ="emulator/auth/handler",sJ=encodeURIComponent("fac");async function FD(r,e,t,o,c,f){en(r.config.authDomain,r,"auth-domain-config-required"),en(r.config.apiKey,r,"invalid-api-key");const y={apiKey:r.config.apiKey,appName:r.name,authType:t,redirectUrl:o,v:up,eventId:c};if(e instanceof aE){e.setDefaultLanguage(r.languageCode),y.providerId=e.providerId||"",d5(e.getCustomParameters())||(y.customParameters=JSON.stringify(e.getCustomParameters()));for(const[O,A]of Object.entries({}))y[O]=A}if(e instanceof Px){const O=e.getScopes().filter(A=>A!=="");O.length>0&&(y.scopes=O.join(","))}r.tenantId&&(y.tid=r.tenantId);const s=y;for(const O of Object.keys(s))s[O]===void 0&&delete s[O];const E=await r._getAppCheckToken(),R=E?`#${sJ}=${encodeURIComponent(E)}`:"";return`${oJ(r)}?${N0(s).slice(1)}${R}`}function oJ({config:r}){return r.emulator?EC(r,nJ):`https://${r.authDomain}/${rJ}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cA="webStorageSupport";class aJ{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=JN,this._completeRedirectFn=oB,this._overrideRedirectResult=CY}async _openPopup(e,t,o,c){var f;Ad((f=this.eventManagers[e._key()])===null||f===void 0?void 0:f.manager,"_initialize() not called before _openPopup()");const y=await FD(e,t,o,y5(),c);return tJ(e,y,RC())}async _openRedirect(e,t,o,c){await this._originValidation(e);const f=await FD(e,t,o,y5(),c);return cY(f),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:c,promise:f}=this.eventManagers[t];return c?Promise.resolve(c):(Ad(f,"If manager is not set, promise should be"),f)}const o=this.initAndGetManager(e);return this.eventManagers[t]={promise:o},o.catch(()=>{delete this.eventManagers[t]}),o}async initAndGetManager(e){const t=await ZY(e),o=new DY(e);return t.register("authEvent",c=>(en(c==null?void 0:c.authEvent,e,"invalid-auth-event"),{status:o.onEvent(c.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:o},this.iframes[e._key()]=t,o}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(cA,{type:cA},c=>{var f;const y=(f=c==null?void 0:c[0])===null||f===void 0?void 0:f[cA];y!==void 0&&t(!!y),Vc(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=NY(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return $N()||zN()||SC()}}const lJ=aJ;var zD="@firebase/auth",ND="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cJ{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(o=>{e((o==null?void 0:o.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){en(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uJ(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function hJ(r){Ll(new vl("auth",(e,{options:t})=>{const o=e.getProvider("app").getImmediate(),c=e.getProvider("heartbeat"),f=e.getProvider("app-check-internal"),{apiKey:y,authDomain:s}=o.options;en(y&&!y.includes(":"),"invalid-api-key",{appName:o.name});const E={apiKey:y,authDomain:s,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:GN(r)},R=new OK(o,c,f,E);return GK(R,t),R},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,o)=>{e.getProvider("auth-internal").initialize()})),Ll(new vl("auth-internal",e=>{const t=Fd(e.getProvider("auth").getImmediate());return(o=>new cJ(o))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ya(zD,ND,uJ(r)),ya(zD,ND,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dJ=5*60;OX("authIdTokenMaxAge");function fJ(){var r,e;return(e=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&e!==void 0?e:document}FK({loadJS(r){return new Promise((e,t)=>{const o=document.createElement("script");o.setAttribute("src",r),o.onload=e,o.onerror=c=>{const f=mu("internal-error");f.customData=c,t(f)},o.type="text/javascript",o.charset="UTF-8",fJ().appendChild(o)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});hJ("Browser");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pJ=new Map,mJ={activated:!1,tokenObservers:[]};function vu(r){return pJ.get(r)||Object.assign({},mJ)}const BD={RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _J{constructor(e,t,o,c,f){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=o,this.lowerBound=c,this.upperBound=f,this.pending=null,this.nextErrorWaitInterval=c,c>f)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new Y1,this.pending.promise.catch(t=>{}),await gJ(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new Y1,this.pending.promise.catch(t=>{}),await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}function gJ(r){return new Promise(e=>{setTimeout(e,r)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yJ={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},eT=new cp("appCheck","AppCheck",yJ);function lB(r){if(!vu(r).activated)throw eT.create("use-before-activation",{appName:r.name})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vJ="firebase-app-check-database",xJ=1,w5="firebase-app-check-store";let Fw=null;function bJ(){return Fw||(Fw=new Promise((r,e)=>{try{const t=indexedDB.open(vJ,xJ);t.onsuccess=o=>{r(o.target.result)},t.onerror=o=>{var c;e(eT.create("storage-open",{originalErrorMessage:(c=o.target.error)===null||c===void 0?void 0:c.message}))},t.onupgradeneeded=o=>{const c=o.target.result;switch(o.oldVersion){case 0:c.createObjectStore(w5,{keyPath:"compositeKey"})}}}catch(t){e(eT.create("storage-open",{originalErrorMessage:t==null?void 0:t.message}))}}),Fw)}function wJ(r,e){return TJ(EJ(r),e)}async function TJ(r,e){const o=(await bJ()).transaction(w5,"readwrite"),f=o.objectStore(w5).put({compositeKey:r,value:e});return new Promise((y,s)=>{f.onsuccess=E=>{y()},o.onerror=E=>{var R;s(eT.create("storage-set",{originalErrorMessage:(R=E.target.error)===null||R===void 0?void 0:R.message}))}})}function EJ(r){return`${r.options.appId}-${r.name}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T5=new B0("@firebase/app-check");function VD(r,e){return vC()?wJ(r,e).catch(t=>{T5.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IJ={error:"UNKNOWN_ERROR"};function SJ(r){return iE.encodeString(JSON.stringify(r),!1)}async function E5(r,e=!1){const t=r.app;lB(t);const o=vu(t);let c=o.token,f;if(c&&!Jv(c)&&(o.token=void 0,c=void 0),!c){const E=await o.cachedTokenPromise;E&&(Jv(E)?c=E:await VD(t,void 0))}if(!e&&c&&Jv(c))return{token:c.token};let y=!1;try{o.exchangeTokenPromise||(o.exchangeTokenPromise=o.provider.getToken().finally(()=>{o.exchangeTokenPromise=void 0}),y=!0),c=await vu(t).exchangeTokenPromise}catch(E){E.code==="appCheck/throttled"?T5.warn(E.message):T5.error(E),f=E}let s;return c?f?Jv(c)?s={token:c.token,internalError:f}:s=jD(f):(s={token:c.token},o.token=c,await VD(t,c)):s=jD(f),y&&PJ(t,s),s}async function AJ(r){const e=r.app;lB(e);const{provider:t}=vu(e);{const{token:o}=await t.getToken();return{token:o}}}function CJ(r,e,t,o){const{app:c}=r,f=vu(c),y={next:t,error:o,type:e};if(f.tokenObservers=[...f.tokenObservers,y],f.token&&Jv(f.token)){const s=f.token;Promise.resolve().then(()=>{t({token:s.token}),UD(r)}).catch(()=>{})}f.cachedTokenPromise.then(()=>UD(r))}function cB(r,e){const t=vu(r),o=t.tokenObservers.filter(c=>c.next!==e);o.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=o}function UD(r){const{app:e}=r,t=vu(e);let o=t.tokenRefresher;o||(o=RJ(r),t.tokenRefresher=o),!o.isRunning()&&t.isTokenAutoRefreshEnabled&&o.start()}function RJ(r){const{app:e}=r;return new _J(async()=>{const t=vu(e);let o;if(t.token?o=await E5(r,!0):o=await E5(r),o.error)throw o.error;if(o.internalError)throw o.internalError},()=>!0,()=>{const t=vu(e);if(t.token){let o=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5;const c=t.token.expireTimeMillis-5*60*1e3;return o=Math.min(o,c),Math.max(0,o-Date.now())}else return 0},BD.RETRIAL_MIN_WAIT,BD.RETRIAL_MAX_WAIT)}function PJ(r,e){const t=vu(r).tokenObservers;for(const o of t)try{o.type==="EXTERNAL"&&e.error!=null?o.error(e.error):o.next(e)}catch{}}function Jv(r){return r.expireTimeMillis-Date.now()>0}function jD(r){return{token:SJ(IJ),error:r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MJ{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=vu(this.app);for(const t of e)cB(this.app,t.next);return Promise.resolve()}}function kJ(r,e){return new MJ(r,e)}function DJ(r){return{getToken:e=>E5(r,e),getLimitedUseToken:()=>AJ(r),addTokenListener:e=>CJ(r,"INTERNAL",e),removeTokenListener:e=>cB(r.app,e)}}const LJ="@firebase/app-check",OJ="0.8.8",FJ="app-check",$D="app-check-internal";function zJ(){Ll(new vl(FJ,r=>{const e=r.getProvider("app").getImmediate(),t=r.getProvider("heartbeat");return kJ(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((r,e,t)=>{r.getProvider($D).initialize()})),Ll(new vl($D,r=>{const e=r.getProvider("app-check").getImmediate();return DJ(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),ya(LJ,OJ)}zJ();var NJ="firebase",BJ="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ya(NJ,BJ,"app");const uB=Symbol("firebaseApp");function uE(r){return mC()&&Al(uB,null)||EN(r)}const rh=()=>{},VJ=typeof window<"u";function kC(r,e){return e.split(".").reduce((t,o)=>t&&t[o],r)}function UJ(r,e,t){const o=(""+e).split("."),c=o.pop(),f=o.reduce((y,s)=>y&&y[s],r);if(f!=null)return Array.isArray(f)?f.splice(Number(c),1,t):f[c]=t}function Hm(r){return!!r&&typeof r=="object"}const jJ=Object.prototype;function $J(r){return Hm(r)&&Object.getPrototypeOf(r)===jJ}function DC(r){return Hm(r)&&r.type==="document"}function GJ(r){return Hm(r)&&r.type==="collection"}function HJ(r){return DC(r)||GJ(r)}function qJ(r){return Hm(r)&&r.type==="query"}function WJ(r){return Hm(r)&&"ref"in r}function XJ(r){return Hm(r)&&typeof r.bucket=="string"}function ZJ(r,e){let t;return()=>{if(!t)return t=!0,r(e())}}const KJ=Symbol.for("v-scx");function YJ(){return!!Al(KJ,0)}const zw=new WeakMap;function JJ(r,e){if(!zw.has(r)){const t=XF(!0);zw.set(r,t);const{unmount:o}=e;e.unmount=()=>{o.call(e),t.stop(),zw.delete(r)}}return zw.get(r)}const hB=new WeakMap;function LC(r){return hB.get(uE(r))}const Nw=new WeakMap;function dB(r){const e=uE(r);if(!Nw.has(e)){let t;const c=[new Promise(f=>{t=f}),f=>{Nw.set(e,f),t(f.value)}];Nw.set(e,c)}return Nw.get(e)}function QJ(r){const e=dB(r);return Array.isArray(e)?e[0]:Promise.resolve(e.value)}function eQ(r,e){rY(e,t=>{const o=dB();r.value=t,Array.isArray(o)&&o[1](r)})}var GD={};const HD="@firebase/database",qD="1.0.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fB="";function tQ(r){fB=r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iQ{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),pa(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:J1(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rQ{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Ld(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pB=function(r){try{if(typeof window<"u"&&typeof window[r]<"u"){const e=window[r];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new iQ(e)}}catch{}return new rQ},am=pB("localStorage"),nQ=pB("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e0=new B0("@firebase/database"),sQ=function(){let r=1;return function(){return r++}}(),mB=function(r){const e=QX(r),t=new XX;t.update(e);const o=t.digest();return iE.encodeByteArray(o)},kx=function(...r){let e="";for(let t=0;t<r.length;t++){const o=r[t];Array.isArray(o)||o&&typeof o=="object"&&typeof o.length=="number"?e+=kx.apply(null,o):typeof o=="object"?e+=pa(o):e+=o,e+=" "}return e};let x1=null,WD=!0;const oQ=function(r,e){Wi(!0,"Can't turn on custom loggers persistently."),e0.logLevel=Bn.VERBOSE,x1=e0.log.bind(e0)},Na=function(...r){if(WD===!0&&(WD=!1,x1===null&&nQ.get("logging_enabled")===!0&&oQ()),x1){const e=kx.apply(null,r);x1(e)}},Dx=function(r){return function(...e){Na(r,...e)}},I5=function(...r){const e="FIREBASE INTERNAL ERROR: "+kx(...r);e0.error(e)},Cm=function(...r){const e=`FIREBASE FATAL ERROR: ${kx(...r)}`;throw e0.error(e),new Error(e)},nc=function(...r){const e="FIREBASE WARNING: "+kx(...r);e0.warn(e)},aQ=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&nc("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},_B=function(r){return typeof r=="number"&&(r!==r||r===Number.POSITIVE_INFINITY||r===Number.NEGATIVE_INFINITY)},lQ=function(r){if(document.readyState==="complete")r();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,r())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},g0="[MIN_NAME]",Rm="[MAX_NAME]",U0=function(r,e){if(r===e)return 0;if(r===g0||e===Rm)return-1;if(e===g0||r===Rm)return 1;{const t=XD(r),o=XD(e);return t!==null?o!==null?t-o===0?r.length-e.length:t-o:-1:o!==null?1:r<e?-1:1}},cQ=function(r,e){return r===e?0:r<e?-1:1},Fv=function(r,e){if(e&&r in e)return e[r];throw new Error("Missing required key ("+r+") in object: "+pa(e))},OC=function(r){if(typeof r!="object"||r===null)return pa(r);const e=[];for(const o in r)e.push(o);e.sort();let t="{";for(let o=0;o<e.length;o++)o!==0&&(t+=","),t+=pa(e[o]),t+=":",t+=OC(r[e[o]]);return t+="}",t},gB=function(r,e){const t=r.length;if(t<=e)return[r];const o=[];for(let c=0;c<t;c+=e)c+e>t?o.push(r.substring(c,t)):o.push(r.substring(c,c+e));return o};function Uc(r,e){for(const t in r)r.hasOwnProperty(t)&&e(t,r[t])}const yB=function(r){Wi(!_B(r),"Invalid JSON number");const e=11,t=52,o=(1<<e-1)-1;let c,f,y,s,E;r===0?(f=0,y=0,c=1/r===-1/0?1:0):(c=r<0,r=Math.abs(r),r>=Math.pow(2,1-o)?(s=Math.min(Math.floor(Math.log(r)/Math.LN2),o),f=s+o,y=Math.round(r*Math.pow(2,t-s)-Math.pow(2,t))):(f=0,y=Math.round(r/Math.pow(2,1-o-t))));const R=[];for(E=t;E;E-=1)R.push(y%2?1:0),y=Math.floor(y/2);for(E=e;E;E-=1)R.push(f%2?1:0),f=Math.floor(f/2);R.push(c?1:0),R.reverse();const O=R.join("");let A="";for(E=0;E<64;E+=8){let U=parseInt(O.substr(E,8),2).toString(16);U.length===1&&(U="0"+U),A=A+U}return A.toLowerCase()},uQ=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},hQ=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"},dQ=new RegExp("^-?(0*)\\d{1,10}$"),fQ=-2147483648,pQ=2147483647,XD=function(r){if(dQ.test(r)){const e=Number(r);if(e>=fQ&&e<=pQ)return e}return null},Lx=function(r){try{r()}catch(e){setTimeout(()=>{const t=e.stack||"";throw nc("Exception was thrown by user callback.",t),e},Math.floor(0))}},mQ=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},b1=function(r,e){const t=setTimeout(r,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _Q{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(o=>this.appCheck=o)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,o)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,o):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(o=>o.addTokenListener(e))}notifyForInvalidToken(){nc(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gQ{constructor(e,t,o){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=o,this.auth_=null,this.auth_=o.getImmediate({optional:!0}),this.auth_||o.onInit(c=>this.auth_=c)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Na("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,o)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,o):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',nc(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FC="5",vB="v",xB="s",bB="r",wB="f",TB=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,EB="ls",IB="p",S5="ac",SB="websocket",AB="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yQ{constructor(e,t,o,c,f=!1,y="",s=!1,E=!1){this.secure=t,this.namespace=o,this.webSocketOnly=c,this.nodeAdmin=f,this.persistenceKey=y,this.includeNamespaceInQueryParams=s,this.isUsingEmulator=E,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=am.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&am.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function vQ(r){return r.host!==r.internalHost||r.isCustomHost()||r.includeNamespaceInQueryParams}function CB(r,e,t){Wi(typeof e=="string","typeof type must == string"),Wi(typeof t=="object","typeof params must == object");let o;if(e===SB)o=(r.secure?"wss://":"ws://")+r.internalHost+"/.ws?";else if(e===AB)o=(r.secure?"https://":"http://")+r.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);vQ(r)&&(t.ns=r.namespace);const c=[];return Uc(t,(f,y)=>{c.push(f+"="+y)}),o+c.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xQ{constructor(){this.counters_={}}incrementCounter(e,t=1){Ld(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return AX(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uA={},hA={};function zC(r){const e=r.toString();return uA[e]||(uA[e]=new xQ),uA[e]}function bQ(r,e){const t=r.toString();return hA[t]||(hA[t]=e()),hA[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wQ{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const o=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let c=0;c<o.length;++c)o[c]&&Lx(()=>{this.onMessage_(o[c])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZD="start",TQ="close",EQ="pLPCommand",IQ="pRTLPCB",RB="id",PB="pw",MB="ser",SQ="cb",AQ="seg",CQ="ts",RQ="d",PQ="dframe",kB=1870,DB=30,MQ=kB-DB,kQ=25e3,DQ=3e4;class Fg{constructor(e,t,o,c,f,y,s){this.connId=e,this.repoInfo=t,this.applicationId=o,this.appCheckToken=c,this.authToken=f,this.transportSessionId=y,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Dx(e),this.stats_=zC(t),this.urlFn=E=>(this.appCheckToken&&(E[S5]=this.appCheckToken),CB(t,AB,E))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new wQ(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(DQ)),lQ(()=>{if(this.isClosed_)return;this.scriptTagHolder=new NC((...f)=>{const[y,s,E,R,O]=f;if(this.incrementIncomingBytes_(f),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,y===ZD)this.id=s,this.password=E;else if(y===TQ)s?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(s,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+y)},(...f)=>{const[y,s]=f;this.incrementIncomingBytes_(f),this.myPacketOrderer.handleResponse(y,s)},()=>{this.onClosed_()},this.urlFn);const o={};o[ZD]="t",o[MB]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(o[SQ]=this.scriptTagHolder.uniqueCallbackIdentifier),o[vB]=FC,this.transportSessionId&&(o[xB]=this.transportSessionId),this.lastSessionId&&(o[EB]=this.lastSessionId),this.applicationId&&(o[IB]=this.applicationId),this.appCheckToken&&(o[S5]=this.appCheckToken),typeof location<"u"&&location.hostname&&TB.test(location.hostname)&&(o[bB]=wB);const c=this.urlFn(o);this.log_("Connecting via long-poll to "+c),this.scriptTagHolder.addTag(c,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Fg.forceAllow_=!0}static forceDisallow(){Fg.forceDisallow_=!0}static isAvailable(){return Fg.forceAllow_?!0:!Fg.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!uQ()&&!hQ()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=pa(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const o=fN(t),c=gB(o,MQ);for(let f=0;f<c.length;f++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,c.length,c[f]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const o={};o[PQ]="t",o[RB]=e,o[PB]=t,this.myDisconnFrame.src=this.urlFn(o),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=pa(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class NC{constructor(e,t,o,c){this.onDisconnect=o,this.urlFn=c,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=sQ(),window[EQ+this.uniqueCallbackIdentifier]=e,window[IQ+this.uniqueCallbackIdentifier]=t,this.myIFrame=NC.createIFrame_();let f="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(f='<script>document.domain="'+document.domain+'";<\/script>');const y="<html><body>"+f+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(y),this.myIFrame.doc.close()}catch(s){Na("frame writing exception"),s.stack&&Na(s.stack),Na(s)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Na("No IE domain setting required")}catch{const o=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+o+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[RB]=this.myID,e[PB]=this.myPW,e[MB]=this.currentSerial;let t=this.urlFn(e),o="",c=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+DB+o.length<=kB;){const y=this.pendingSegs.shift();o=o+"&"+AQ+c+"="+y.seg+"&"+CQ+c+"="+y.ts+"&"+RQ+c+"="+y.d,c++}return t=t+o,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,o){this.pendingSegs.push({seg:e,ts:t,d:o}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const o=()=>{this.outstandingRequests.delete(t),this.newRequest_()},c=setTimeout(o,Math.floor(kQ)),f=()=>{clearTimeout(c),o()};this.addTag(e,f)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const o=this.myIFrame.doc.createElement("script");o.type="text/javascript",o.async=!0,o.src=e,o.onload=o.onreadystatechange=function(){const c=o.readyState;(!c||c==="loaded"||c==="complete")&&(o.onload=o.onreadystatechange=null,o.parentNode&&o.parentNode.removeChild(o),t())},o.onerror=()=>{Na("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(o)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LQ=16384,OQ=45e3;let tT=null;typeof MozWebSocket<"u"?tT=MozWebSocket:typeof WebSocket<"u"&&(tT=WebSocket);class lu{constructor(e,t,o,c,f,y,s){this.connId=e,this.applicationId=o,this.appCheckToken=c,this.authToken=f,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Dx(this.connId),this.stats_=zC(t),this.connURL=lu.connectionURL_(t,y,s,c,o),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,o,c,f){const y={};return y[vB]=FC,typeof location<"u"&&location.hostname&&TB.test(location.hostname)&&(y[bB]=wB),t&&(y[xB]=t),o&&(y[EB]=o),c&&(y[S5]=c),f&&(y[IB]=f),CB(e,SB,y)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,am.set("previous_websocket_failure",!0);try{let o;VX(),this.mySock=new tT(this.connURL,[],o)}catch(o){this.log_("Error instantiating WebSocket.");const c=o.message||o.data;c&&this.log_(c),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=o=>{this.handleIncomingFrame(o)},this.mySock.onerror=o=>{this.log_("WebSocket error.  Closing connection.");const c=o.message||o.data;c&&this.log_(c),this.onClosed_()}}start(){}static forceDisallow(){lu.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,o=navigator.userAgent.match(t);o&&o.length>1&&parseFloat(o[1])<4.4&&(e=!0)}return!e&&tT!==null&&!lu.forceDisallow_}static previouslyFailed(){return am.isInMemoryStorage||am.get("previous_websocket_failure")===!0}markConnectionHealthy(){am.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const o=J1(t);this.onMessage(o)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Wi(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const o=this.extractFrameCount_(t);o!==null&&this.appendFrame_(o)}}send(e){this.resetKeepAlive();const t=pa(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const o=gB(t,LQ);o.length>1&&this.sendString_(String(o.length));for(let c=0;c<o.length;c++)this.sendString_(o[c])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(OQ))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}lu.responsesRequiredToBeHealthy=2;lu.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ix{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Fg,lu]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=lu&&lu.isAvailable();let o=t&&!lu.previouslyFailed();if(e.webSocketOnly&&(t||nc("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[lu];else{const c=this.transports_=[];for(const f of ix.ALL_TRANSPORTS)f&&f.isAvailable()&&c.push(f);ix.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ix.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FQ=6e4,zQ=5e3,NQ=10*1024,BQ=100*1024,dA="t",KD="d",VQ="s",YD="r",UQ="e",JD="o",QD="a",eL="n",tL="p",jQ="h";class $Q{constructor(e,t,o,c,f,y,s,E,R,O){this.id=e,this.repoInfo_=t,this.applicationId_=o,this.appCheckToken_=c,this.authToken_=f,this.onMessage_=y,this.onReady_=s,this.onDisconnect_=E,this.onKill_=R,this.lastSessionId=O,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Dx("c:"+this.id+":"),this.transportManager_=new ix(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),o=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,o)},Math.floor(0));const c=e.healthyTimeout||0;c>0&&(this.healthyTimeout_=b1(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>BQ?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>NQ?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(c)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(dA in e){const t=e[dA];t===QD?this.upgradeIfSecondaryHealthy_():t===YD?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===JD&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Fv("t",e),o=Fv("d",e);if(t==="c")this.onSecondaryControl_(o);else if(t==="d")this.pendingDataMessages.push(o);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:tL,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:QD,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:eL,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Fv("t",e),o=Fv("d",e);t==="c"?this.onControl_(o):t==="d"&&this.onDataMessage_(o)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Fv(dA,e);if(KD in e){const o=e[KD];if(t===jQ){const c=Object.assign({},o);this.repoInfo_.isUsingEmulator&&(c.h=this.repoInfo_.host),this.onHandshake_(c)}else if(t===eL){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let c=0;c<this.pendingDataMessages.length;++c)this.onDataMessage_(this.pendingDataMessages[c]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===VQ?this.onConnectionShutdown_(o):t===YD?this.onReset_(o):t===UQ?I5("Server Error: "+o):t===JD?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):I5("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,o=e.v,c=e.h;this.sessionId=e.s,this.repoInfo_.host=c,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),FC!==o&&nc("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),o=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,o),b1(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(FQ))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):b1(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(zQ))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:tL,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(am.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LB{put(e,t,o,c){}merge(e,t,o,c){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,o){}onDisconnectMerge(e,t,o){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OB{constructor(e){this.allowedEvents_=e,this.listeners_={},Wi(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const o=[...this.listeners_[e]];for(let c=0;c<o.length;c++)o[c].callback.apply(o[c].context,t)}}on(e,t,o){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:o});const c=this.getInitialEvent(e);c&&t.apply(o,c)}off(e,t,o){this.validateEventType_(e);const c=this.listeners_[e]||[];for(let f=0;f<c.length;f++)if(c[f].callback===t&&(!o||o===c[f].context)){c.splice(f,1);return}}validateEventType_(e){Wi(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iT extends OB{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!yC()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new iT}getInitialEvent(e){return Wi(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iL=32,rL=768;class Hs{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let o=0;for(let c=0;c<this.pieces_.length;c++)this.pieces_[c].length>0&&(this.pieces_[o]=this.pieces_[c],o++);this.pieces_.length=o,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function Ts(){return new Hs("")}function Xn(r){return r.pieceNum_>=r.pieces_.length?null:r.pieces_[r.pieceNum_]}function ip(r){return r.pieces_.length-r.pieceNum_}function Gs(r){let e=r.pieceNum_;return e<r.pieces_.length&&e++,new Hs(r.pieces_,e)}function FB(r){return r.pieceNum_<r.pieces_.length?r.pieces_[r.pieces_.length-1]:null}function GQ(r){let e="";for(let t=r.pieceNum_;t<r.pieces_.length;t++)r.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(r.pieces_[t])));return e||"/"}function zB(r,e=0){return r.pieces_.slice(r.pieceNum_+e)}function NB(r){if(r.pieceNum_>=r.pieces_.length)return null;const e=[];for(let t=r.pieceNum_;t<r.pieces_.length-1;t++)e.push(r.pieces_[t]);return new Hs(e,0)}function ia(r,e){const t=[];for(let o=r.pieceNum_;o<r.pieces_.length;o++)t.push(r.pieces_[o]);if(e instanceof Hs)for(let o=e.pieceNum_;o<e.pieces_.length;o++)t.push(e.pieces_[o]);else{const o=e.split("/");for(let c=0;c<o.length;c++)o[c].length>0&&t.push(o[c])}return new Hs(t,0)}function Gn(r){return r.pieceNum_>=r.pieces_.length}function kc(r,e){const t=Xn(r),o=Xn(e);if(t===null)return e;if(t===o)return kc(Gs(r),Gs(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+r+")")}function BB(r,e){if(ip(r)!==ip(e))return!1;for(let t=r.pieceNum_,o=e.pieceNum_;t<=r.pieces_.length;t++,o++)if(r.pieces_[t]!==e.pieces_[o])return!1;return!0}function cu(r,e){let t=r.pieceNum_,o=e.pieceNum_;if(ip(r)>ip(e))return!1;for(;t<r.pieces_.length;){if(r.pieces_[t]!==e.pieces_[o])return!1;++t,++o}return!0}class HQ{constructor(e,t){this.errorPrefix_=t,this.parts_=zB(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let o=0;o<this.parts_.length;o++)this.byteLength_+=nE(this.parts_[o]);VB(this)}}function qQ(r,e){r.parts_.length>0&&(r.byteLength_+=1),r.parts_.push(e),r.byteLength_+=nE(e),VB(r)}function WQ(r){const e=r.parts_.pop();r.byteLength_-=nE(e),r.parts_.length>0&&(r.byteLength_-=1)}function VB(r){if(r.byteLength_>rL)throw new Error(r.errorPrefix_+"has a key path longer than "+rL+" bytes ("+r.byteLength_+").");if(r.parts_.length>iL)throw new Error(r.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+iL+") or object contains a cycle "+im(r))}function im(r){return r.parts_.length===0?"":"in property '"+r.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BC extends OB{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const o=!document[e];o!==this.visible_&&(this.visible_=o,this.trigger("visible",o))},!1)}static getInstance(){return new BC}getInitialEvent(e){return Wi(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zv=1e3,XQ=60*5*1e3,nL=30*1e3,ZQ=1.3,KQ=3e4,YQ="server_kill",sL=3;class xd extends LB{constructor(e,t,o,c,f,y,s,E){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=o,this.onConnectStatus_=c,this.onServerInfoUpdate_=f,this.authTokenProvider_=y,this.appCheckTokenProvider_=s,this.authOverride_=E,this.id=xd.nextPersistentConnectionId_++,this.log_=Dx("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=zv,this.maxReconnectDelay_=XQ,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,E)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");BC.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&iT.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,o){const c=++this.requestNumber_,f={r:c,a:e,b:t};this.log_(pa(f)),Wi(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(f),o&&(this.requestCBHash_[c]=o)}get(e){this.initConnection_();const t=new Y1,c={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:y=>{const s=y.d;y.s==="ok"?t.resolve(s):t.reject(s)}};this.outstandingGets_.push(c),this.outstandingGetCount_++;const f=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(f),t.promise}listen(e,t,o,c){this.initConnection_();const f=e._queryIdentifier,y=e._path.toString();this.log_("Listen called for "+y+" "+f),this.listens.has(y)||this.listens.set(y,new Map),Wi(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Wi(!this.listens.get(y).has(f),"listen() called twice for same path/queryId.");const s={onComplete:c,hashFn:t,query:e,tag:o};this.listens.get(y).set(f,s),this.connected_&&this.sendListen_(s)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,o=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(o)})}sendListen_(e){const t=e.query,o=t._path.toString(),c=t._queryIdentifier;this.log_("Listen on "+o+" for "+c);const f={p:o},y="q";e.tag&&(f.q=t._queryObject,f.t=e.tag),f.h=e.hashFn(),this.sendRequest(y,f,s=>{const E=s.d,R=s.s;xd.warnOnListenWarnings_(E,t),(this.listens.get(o)&&this.listens.get(o).get(c))===e&&(this.log_("listen response",s),R!=="ok"&&this.removeListen_(o,c),e.onComplete&&e.onComplete(R,E))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Ld(e,"w")){const o=m0(e,"w");if(Array.isArray(o)&&~o.indexOf("no_index")){const c='".indexOn": "'+t._queryParams.getIndex().toString()+'"',f=t._path.toString();nc(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${c} at ${f} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||WX(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=nL)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=qX(e)?"auth":"gauth",o={cred:e};this.authOverride_===null?o.noauth=!0:typeof this.authOverride_=="object"&&(o.authvar=this.authOverride_),this.sendRequest(t,o,c=>{const f=c.s,y=c.d||"error";this.authToken_===e&&(f==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(f,y))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,o=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,o)})}unlisten(e,t){const o=e._path.toString(),c=e._queryIdentifier;this.log_("Unlisten called for "+o+" "+c),Wi(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(o,c)&&this.connected_&&this.sendUnlisten_(o,c,e._queryObject,t)}sendUnlisten_(e,t,o,c){this.log_("Unlisten on "+e+" for "+t);const f={p:e},y="n";c&&(f.q=o,f.t=c),this.sendRequest(y,f)}onDisconnectPut(e,t,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,o):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:o})}onDisconnectMerge(e,t,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,o):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:o})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,o,c){const f={p:t,d:o};this.log_("onDisconnect "+e,f),this.sendRequest(e,f,y=>{c&&setTimeout(()=>{c(y.s,y.d)},Math.floor(0))})}put(e,t,o,c){this.putInternal("p",e,t,o,c)}merge(e,t,o,c){this.putInternal("m",e,t,o,c)}putInternal(e,t,o,c,f){this.initConnection_();const y={p:t,d:o};f!==void 0&&(y.h=f),this.outstandingPuts_.push({action:e,request:y,onComplete:c}),this.outstandingPutCount_++;const s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,o=this.outstandingPuts_[e].request,c=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,o,f=>{this.log_(t+" response",f),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),c&&c(f.s,f.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,o=>{if(o.s!=="ok"){const f=o.d;this.log_("reportStats","Error sending stats: "+f)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+pa(e));const t=e.r,o=this.requestCBHash_[t];o&&(delete this.requestCBHash_[t],o(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):I5("Unrecognized action received from server: "+pa(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Wi(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=zv,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=zv,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>KQ&&(this.reconnectDelay_=zv),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*ZQ)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),o=this.onRealtimeDisconnect_.bind(this),c=this.id+":"+xd.nextConnectionId_++,f=this.lastSessionId;let y=!1,s=null;const E=function(){s?s.close():(y=!0,o())},R=function(A){Wi(s,"sendRequest call when we're not connected not allowed."),s.sendRequest(A)};this.realtime_={close:E,sendRequest:R};const O=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[A,U]=await Promise.all([this.authTokenProvider_.getToken(O),this.appCheckTokenProvider_.getToken(O)]);y?Na("getToken() completed but was canceled"):(Na("getToken() completed. Creating connection."),this.authToken_=A&&A.accessToken,this.appCheckToken_=U&&U.token,s=new $Q(c,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,o,$=>{nc($+" ("+this.repoInfo_.toString()+")"),this.interrupt(YQ)},f))}catch(A){this.log_("Failed to get token: "+A),y||(this.repoInfo_.nodeAdmin&&nc(A),E())}}}interrupt(e){Na("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Na("Resuming connection for reason: "+e),delete this.interruptReasons_[e],d5(this.interruptReasons_)&&(this.reconnectDelay_=zv,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let o;t?o=t.map(f=>OC(f)).join("$"):o="default";const c=this.removeListen_(e,o);c&&c.onComplete&&c.onComplete("permission_denied")}removeListen_(e,t){const o=new Hs(e).toString();let c;if(this.listens.has(o)){const f=this.listens.get(o);c=f.get(t),f.delete(t),f.size===0&&this.listens.delete(o)}else c=void 0;return c}onAuthRevoked_(e,t){Na("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=sL&&(this.reconnectDelay_=nL,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Na("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=sL&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+fB.replace(/\./g,"-")]=1,yC()?e["framework.cordova"]=1:gN()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=iT.getInstance().currentlyOnline();return d5(this.interruptReasons_)&&e}}xd.nextPersistentConnectionId_=0;xd.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zn{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Zn(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hE{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const o=new Zn(g0,e),c=new Zn(g0,t);return this.compare(o,c)!==0}minPost(){return Zn.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bw;class UB extends hE{static get __EMPTY_NODE(){return Bw}static set __EMPTY_NODE(e){Bw=e}compare(e,t){return U0(e.name,t.name)}isDefinedOn(e){throw z0("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Zn.MIN}maxPost(){return new Zn(Rm,Bw)}makePost(e,t){return Wi(typeof e=="string","KeyIndex indexValue must always be a string."),new Zn(e,Bw)}toString(){return".key"}}const t0=new UB;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vw=class{constructor(e,t,o,c,f=null){this.isReverse_=c,this.resultGenerator_=f,this.nodeStack_=[];let y=1;for(;!e.isEmpty();)if(e=e,y=t?o(e.key,t):1,c&&(y*=-1),y<0)this.isReverse_?e=e.left:e=e.right;else if(y===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Kl=class Qv{constructor(e,t,o,c,f){this.key=e,this.value=t,this.color=o??Qv.RED,this.left=c??nh.EMPTY_NODE,this.right=f??nh.EMPTY_NODE}copy(e,t,o,c,f){return new Qv(e??this.key,t??this.value,o??this.color,c??this.left,f??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,o){let c=this;const f=o(e,c.key);return f<0?c=c.copy(null,null,null,c.left.insert(e,t,o),null):f===0?c=c.copy(null,t,null,null,null):c=c.copy(null,null,null,null,c.right.insert(e,t,o)),c.fixUp_()}removeMin_(){if(this.left.isEmpty())return nh.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let o,c;if(o=this,t(e,o.key)<0)!o.left.isEmpty()&&!o.left.isRed_()&&!o.left.left.isRed_()&&(o=o.moveRedLeft_()),o=o.copy(null,null,null,o.left.remove(e,t),null);else{if(o.left.isRed_()&&(o=o.rotateRight_()),!o.right.isEmpty()&&!o.right.isRed_()&&!o.right.left.isRed_()&&(o=o.moveRedRight_()),t(e,o.key)===0){if(o.right.isEmpty())return nh.EMPTY_NODE;c=o.right.min_(),o=o.copy(c.key,c.value,null,null,o.right.removeMin_())}o=o.copy(null,null,null,null,o.right.remove(e,t))}return o.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Qv.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Qv.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};Kl.RED=!0;Kl.BLACK=!1;class JQ{copy(e,t,o,c,f){return this}insert(e,t,o){return new Kl(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let nh=class x2{constructor(e,t=x2.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new x2(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Kl.BLACK,null,null))}remove(e){return new x2(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Kl.BLACK,null,null))}get(e){let t,o=this.root_;for(;!o.isEmpty();){if(t=this.comparator_(e,o.key),t===0)return o.value;t<0?o=o.left:t>0&&(o=o.right)}return null}getPredecessorKey(e){let t,o=this.root_,c=null;for(;!o.isEmpty();)if(t=this.comparator_(e,o.key),t===0){if(o.left.isEmpty())return c?c.key:null;for(o=o.left;!o.right.isEmpty();)o=o.right;return o.key}else t<0?o=o.left:t>0&&(c=o,o=o.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Vw(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Vw(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Vw(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Vw(this.root_,null,this.comparator_,!0,e)}};nh.EMPTY_NODE=new JQ;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QQ(r,e){return U0(r.name,e.name)}function VC(r,e){return U0(r,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let A5;function eee(r){A5=r}const jB=function(r){return typeof r=="number"?"number:"+yB(r):"string:"+r},$B=function(r){if(r.isLeafNode()){const e=r.val();Wi(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ld(e,".sv"),"Priority must be a string or number.")}else Wi(r===A5||r.isEmpty(),"priority of unexpected type.");Wi(r===A5||r.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oL;class ea{constructor(e,t=ea.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Wi(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),$B(this.priorityNode_)}static set __childrenNodeConstructor(e){oL=e}static get __childrenNodeConstructor(){return oL}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ea(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:ea.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Gn(e)?this:Xn(e)===".priority"?this.priorityNode_:ea.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:ea.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const o=Xn(e);return o===null?t:t.isEmpty()&&o!==".priority"?this:(Wi(o!==".priority"||ip(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(o,ea.__childrenNodeConstructor.EMPTY_NODE.updateChild(Gs(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+jB(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=yB(this.value_):e+=this.value_,this.lazyHash_=mB(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ea.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ea.__childrenNodeConstructor?-1:(Wi(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,o=typeof this.value_,c=ea.VALUE_TYPE_ORDER.indexOf(t),f=ea.VALUE_TYPE_ORDER.indexOf(o);return Wi(c>=0,"Unknown leaf type: "+t),Wi(f>=0,"Unknown leaf type: "+o),c===f?o==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:f-c}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}ea.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let GB,HB;function tee(r){GB=r}function iee(r){HB=r}class ree extends hE{compare(e,t){const o=e.node.getPriority(),c=t.node.getPriority(),f=o.compareTo(c);return f===0?U0(e.name,t.name):f}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Zn.MIN}maxPost(){return new Zn(Rm,new ea("[PRIORITY-POST]",HB))}makePost(e,t){const o=GB(e);return new Zn(t,new ea("[PRIORITY-POST]",o))}toString(){return".priority"}}const Ga=new ree;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nee=Math.log(2);class see{constructor(e){const t=f=>parseInt(Math.log(f)/nee,10),o=f=>parseInt(Array(f+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const c=o(this.count);this.bits_=e+1&c}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const rT=function(r,e,t,o){r.sort(e);const c=function(E,R){const O=R-E;let A,U;if(O===0)return null;if(O===1)return A=r[E],U=t?t(A):A,new Kl(U,A.node,Kl.BLACK,null,null);{const $=parseInt(O/2,10)+E,te=c(E,$),Q=c($+1,R);return A=r[$],U=t?t(A):A,new Kl(U,A.node,Kl.BLACK,te,Q)}},f=function(E){let R=null,O=null,A=r.length;const U=function(te,Q){const de=A-te,Ce=A;A-=te;const Fe=c(de+1,Ce),Le=r[de],Me=t?t(Le):Le;$(new Kl(Me,Le.node,Q,null,Fe))},$=function(te){R?(R.left=te,R=te):(O=te,R=te)};for(let te=0;te<E.count;++te){const Q=E.nextBitIsOne(),de=Math.pow(2,E.count-(te+1));Q?U(de,Kl.BLACK):(U(de,Kl.BLACK),U(de,Kl.RED))}return O},y=new see(r.length),s=f(y);return new nh(o||e,s)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fA;const yg={};class yd{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return Wi(yg&&Ga,"ChildrenNode.ts has not been loaded"),fA=fA||new yd({".priority":yg},{".priority":Ga}),fA}get(e){const t=m0(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof nh?t:null}hasIndex(e){return Ld(this.indexSet_,e.toString())}addIndex(e,t){Wi(e!==t0,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const o=[];let c=!1;const f=t.getIterator(Zn.Wrap);let y=f.getNext();for(;y;)c=c||e.isDefinedOn(y.node),o.push(y),y=f.getNext();let s;c?s=rT(o,e.getCompare()):s=yg;const E=e.toString(),R=Object.assign({},this.indexSet_);R[E]=e;const O=Object.assign({},this.indexes_);return O[E]=s,new yd(O,R)}addToIndexes(e,t){const o=W2(this.indexes_,(c,f)=>{const y=m0(this.indexSet_,f);if(Wi(y,"Missing index implementation for "+f),c===yg)if(y.isDefinedOn(e.node)){const s=[],E=t.getIterator(Zn.Wrap);let R=E.getNext();for(;R;)R.name!==e.name&&s.push(R),R=E.getNext();return s.push(e),rT(s,y.getCompare())}else return yg;else{const s=t.get(e.name);let E=c;return s&&(E=E.remove(new Zn(e.name,s))),E.insert(e,e.node)}});return new yd(o,this.indexSet_)}removeFromIndexes(e,t){const o=W2(this.indexes_,c=>{if(c===yg)return c;{const f=t.get(e.name);return f?c.remove(new Zn(e.name,f)):c}});return new yd(o,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nv;class _s{constructor(e,t,o){this.children_=e,this.priorityNode_=t,this.indexMap_=o,this.lazyHash_=null,this.priorityNode_&&$B(this.priorityNode_),this.children_.isEmpty()&&Wi(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Nv||(Nv=new _s(new nh(VC),null,yd.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Nv}updatePriority(e){return this.children_.isEmpty()?this:new _s(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Nv:t}}getChild(e){const t=Xn(e);return t===null?this:this.getImmediateChild(t).getChild(Gs(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(Wi(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const o=new Zn(e,t);let c,f;t.isEmpty()?(c=this.children_.remove(e),f=this.indexMap_.removeFromIndexes(o,this.children_)):(c=this.children_.insert(e,t),f=this.indexMap_.addToIndexes(o,this.children_));const y=c.isEmpty()?Nv:this.priorityNode_;return new _s(c,y,f)}}updateChild(e,t){const o=Xn(e);if(o===null)return t;{Wi(Xn(e)!==".priority"||ip(e)===1,".priority must be the last token in a path");const c=this.getImmediateChild(o).updateChild(Gs(e),t);return this.updateImmediateChild(o,c)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let o=0,c=0,f=!0;if(this.forEachChild(Ga,(y,s)=>{t[y]=s.val(e),o++,f&&_s.INTEGER_REGEXP_.test(y)?c=Math.max(c,Number(y)):f=!1}),!e&&f&&c<2*o){const y=[];for(const s in t)y[s]=t[s];return y}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+jB(this.getPriority().val())+":"),this.forEachChild(Ga,(t,o)=>{const c=o.hash();c!==""&&(e+=":"+t+":"+c)}),this.lazyHash_=e===""?"":mB(e)}return this.lazyHash_}getPredecessorChildName(e,t,o){const c=this.resolveIndex_(o);if(c){const f=c.getPredecessorKey(new Zn(e,t));return f?f.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const o=t.minKey();return o&&o.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Zn(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const o=t.maxKey();return o&&o.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Zn(t,this.children_.get(t)):null}forEachChild(e,t){const o=this.resolveIndex_(e);return o?o.inorderTraversal(c=>t(c.name,c.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const o=this.resolveIndex_(t);if(o)return o.getIteratorFrom(e,c=>c);{const c=this.children_.getIteratorFrom(e.name,Zn.Wrap);let f=c.peek();for(;f!=null&&t.compare(f,e)<0;)c.getNext(),f=c.peek();return c}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const o=this.resolveIndex_(t);if(o)return o.getReverseIteratorFrom(e,c=>c);{const c=this.children_.getReverseIteratorFrom(e.name,Zn.Wrap);let f=c.peek();for(;f!=null&&t.compare(f,e)>0;)c.getNext(),f=c.peek();return c}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Ox?-1:0}withIndex(e){if(e===t0||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new _s(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===t0||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const o=this.getIterator(Ga),c=t.getIterator(Ga);let f=o.getNext(),y=c.getNext();for(;f&&y;){if(f.name!==y.name||!f.node.equals(y.node))return!1;f=o.getNext(),y=c.getNext()}return f===null&&y===null}else return!1;else return!1}}resolveIndex_(e){return e===t0?null:this.indexMap_.get(e.toString())}}_s.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class oee extends _s{constructor(){super(new nh(VC),_s.EMPTY_NODE,yd.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return _s.EMPTY_NODE}isEmpty(){return!1}}const Ox=new oee;Object.defineProperties(Zn,{MIN:{value:new Zn(g0,_s.EMPTY_NODE)},MAX:{value:new Zn(Rm,Ox)}});UB.__EMPTY_NODE=_s.EMPTY_NODE;ea.__childrenNodeConstructor=_s;eee(Ox);iee(Ox);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aee=!0;function Ba(r,e=null){if(r===null)return _s.EMPTY_NODE;if(typeof r=="object"&&".priority"in r&&(e=r[".priority"]),Wi(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof r=="object"&&".value"in r&&r[".value"]!==null&&(r=r[".value"]),typeof r!="object"||".sv"in r){const t=r;return new ea(t,Ba(e))}if(!(r instanceof Array)&&aee){const t=[];let o=!1;if(Uc(r,(y,s)=>{if(y.substring(0,1)!=="."){const E=Ba(s);E.isEmpty()||(o=o||!E.getPriority().isEmpty(),t.push(new Zn(y,E)))}}),t.length===0)return _s.EMPTY_NODE;const f=rT(t,QQ,y=>y.name,VC);if(o){const y=rT(t,Ga.getCompare());return new _s(f,Ba(e),new yd({".priority":y},{".priority":Ga}))}else return new _s(f,Ba(e),yd.Default)}else{let t=_s.EMPTY_NODE;return Uc(r,(o,c)=>{if(Ld(r,o)&&o.substring(0,1)!=="."){const f=Ba(c);(f.isLeafNode()||!f.isEmpty())&&(t=t.updateImmediateChild(o,f))}}),t.updatePriority(Ba(e))}}tee(Ba);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lee extends hE{constructor(e){super(),this.indexPath_=e,Wi(!Gn(e)&&Xn(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const o=this.extractChild(e.node),c=this.extractChild(t.node),f=o.compareTo(c);return f===0?U0(e.name,t.name):f}makePost(e,t){const o=Ba(e),c=_s.EMPTY_NODE.updateChild(this.indexPath_,o);return new Zn(t,c)}maxPost(){const e=_s.EMPTY_NODE.updateChild(this.indexPath_,Ox);return new Zn(Rm,e)}toString(){return zB(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cee extends hE{compare(e,t){const o=e.node.compareTo(t.node);return o===0?U0(e.name,t.name):o}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Zn.MIN}maxPost(){return Zn.MAX}makePost(e,t){const o=Ba(e);return new Zn(t,o)}toString(){return".value"}}const uee=new cee;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hee(r){return{type:"value",snapshotNode:r}}function dee(r,e){return{type:"child_added",snapshotNode:e,childName:r}}function fee(r,e){return{type:"child_removed",snapshotNode:e,childName:r}}function aL(r,e,t){return{type:"child_changed",snapshotNode:e,childName:r,oldSnap:t}}function pee(r,e){return{type:"child_moved",snapshotNode:e,childName:r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UC{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ga}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Wi(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Wi(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:g0}hasEnd(){return this.endSet_}getIndexEndValue(){return Wi(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Wi(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Rm}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Wi(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ga}copy(){const e=new UC;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function lL(r){const e={};if(r.isDefault())return e;let t;if(r.index_===Ga?t="$priority":r.index_===uee?t="$value":r.index_===t0?t="$key":(Wi(r.index_ instanceof lee,"Unrecognized index type!"),t=r.index_.toString()),e.orderBy=pa(t),r.startSet_){const o=r.startAfterSet_?"startAfter":"startAt";e[o]=pa(r.indexStartValue_),r.startNameSet_&&(e[o]+=","+pa(r.indexStartName_))}if(r.endSet_){const o=r.endBeforeSet_?"endBefore":"endAt";e[o]=pa(r.indexEndValue_),r.endNameSet_&&(e[o]+=","+pa(r.indexEndName_))}return r.limitSet_&&(r.isViewFromLeft()?e.limitToFirst=r.limit_:e.limitToLast=r.limit_),e}function cL(r){const e={};if(r.startSet_&&(e.sp=r.indexStartValue_,r.startNameSet_&&(e.sn=r.indexStartName_),e.sin=!r.startAfterSet_),r.endSet_&&(e.ep=r.indexEndValue_,r.endNameSet_&&(e.en=r.indexEndName_),e.ein=!r.endBeforeSet_),r.limitSet_){e.l=r.limit_;let t=r.viewFrom_;t===""&&(r.isViewFromLeft()?t="l":t="r"),e.vf=t}return r.index_!==Ga&&(e.i=r.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nT extends LB{constructor(e,t,o,c){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=o,this.appCheckTokenProvider_=c,this.log_=Dx("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(Wi(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,o,c){const f=e._path.toString();this.log_("Listen called for "+f+" "+e._queryIdentifier);const y=nT.getListenId_(e,o),s={};this.listens_[y]=s;const E=lL(e._queryParams);this.restRequest_(f+".json",E,(R,O)=>{let A=O;if(R===404&&(A=null,R=null),R===null&&this.onDataUpdate_(f,A,!1,o),m0(this.listens_,y)===s){let U;R?R===401?U="permission_denied":U="rest_error:"+R:U="ok",c(U,null)}})}unlisten(e,t){const o=nT.getListenId_(e,t);delete this.listens_[o]}get(e){const t=lL(e._queryParams),o=e._path.toString(),c=new Y1;return this.restRequest_(o+".json",t,(f,y)=>{let s=y;f===404&&(s=null,f=null),f===null?(this.onDataUpdate_(o,s,!1,null),c.resolve(s)):c.reject(new Error(s))}),c.promise}refreshAuthToken(e){}restRequest_(e,t={},o){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([c,f])=>{c&&c.accessToken&&(t.auth=c.accessToken),f&&f.token&&(t.ac=f.token);const y=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+N0(t);this.log_("Sending REST request for "+y);const s=new XMLHttpRequest;s.onreadystatechange=()=>{if(o&&s.readyState===4){this.log_("REST Response for "+y+" received. status:",s.status,"response:",s.responseText);let E=null;if(s.status>=200&&s.status<300){try{E=J1(s.responseText)}catch{nc("Failed to parse JSON response for "+y+": "+s.responseText)}o(null,E)}else s.status!==401&&s.status!==404&&nc("Got unsuccessful REST response for "+y+" Status: "+s.status),o(s.status);o=null}},s.open("GET",y,!0),s.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mee{constructor(){this.rootNode_=_s.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sT(){return{value:null,children:new Map}}function qB(r,e,t){if(Gn(e))r.value=t,r.children.clear();else if(r.value!==null)r.value=r.value.updateChild(e,t);else{const o=Xn(e);r.children.has(o)||r.children.set(o,sT());const c=r.children.get(o);e=Gs(e),qB(c,e,t)}}function C5(r,e,t){r.value!==null?t(e,r.value):_ee(r,(o,c)=>{const f=new Hs(e.toString()+"/"+o);C5(c,f,t)})}function _ee(r,e){r.children.forEach((t,o)=>{e(o,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gee{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Uc(this.last_,(o,c)=>{t[o]=t[o]-c}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uL=10*1e3,yee=30*1e3,vee=5*60*1e3;class xee{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new gee(e);const o=uL+(yee-uL)*Math.random();b1(this.reportStats_.bind(this),Math.floor(o))}reportStats_(){const e=this.statsListener_.get(),t={};let o=!1;Uc(e,(c,f)=>{f>0&&Ld(this.statsToReport_,c)&&(t[c]=f,o=!0)}),o&&this.server_.reportStats(t),b1(this.reportStats_.bind(this),Math.floor(Math.random()*2*vee))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sh;(function(r){r[r.OVERWRITE=0]="OVERWRITE",r[r.MERGE=1]="MERGE",r[r.ACK_USER_WRITE=2]="ACK_USER_WRITE",r[r.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(sh||(sh={}));function WB(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function XB(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function ZB(r){return{fromUser:!1,fromServer:!0,queryId:r,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oT{constructor(e,t,o){this.path=e,this.affectedTree=t,this.revert=o,this.type=sh.ACK_USER_WRITE,this.source=WB()}operationForChild(e){if(Gn(this.path)){if(this.affectedTree.value!=null)return Wi(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Hs(e));return new oT(Ts(),t,this.revert)}}else return Wi(Xn(this.path)===e,"operationForChild called for unrelated child."),new oT(Gs(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pm{constructor(e,t,o){this.source=e,this.path=t,this.snap=o,this.type=sh.OVERWRITE}operationForChild(e){return Gn(this.path)?new Pm(this.source,Ts(),this.snap.getImmediateChild(e)):new Pm(this.source,Gs(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rx{constructor(e,t,o){this.source=e,this.path=t,this.children=o,this.type=sh.MERGE}operationForChild(e){if(Gn(this.path)){const t=this.children.subtree(new Hs(e));return t.isEmpty()?null:t.value?new Pm(this.source,Ts(),t.value):new rx(this.source,Ts(),t)}else return Wi(Xn(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new rx(this.source,Gs(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jC{constructor(e,t,o){this.node_=e,this.fullyInitialized_=t,this.filtered_=o}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Gn(e))return this.isFullyInitialized()&&!this.filtered_;const t=Xn(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function bee(r,e,t,o){const c=[],f=[];return e.forEach(y=>{y.type==="child_changed"&&r.index_.indexedValueChanged(y.oldSnap,y.snapshotNode)&&f.push(pee(y.childName,y.snapshotNode))}),Bv(r,c,"child_removed",e,o,t),Bv(r,c,"child_added",e,o,t),Bv(r,c,"child_moved",f,o,t),Bv(r,c,"child_changed",e,o,t),Bv(r,c,"value",e,o,t),c}function Bv(r,e,t,o,c,f){const y=o.filter(s=>s.type===t);y.sort((s,E)=>Tee(r,s,E)),y.forEach(s=>{const E=wee(r,s,f);c.forEach(R=>{R.respondsTo(s.type)&&e.push(R.createEvent(E,r.query_))})})}function wee(r,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,r.index_)),e}function Tee(r,e,t){if(e.childName==null||t.childName==null)throw z0("Should only compare child_ events.");const o=new Zn(e.childName,e.snapshotNode),c=new Zn(t.childName,t.snapshotNode);return r.index_.compare(o,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KB(r,e){return{eventCache:r,serverCache:e}}function w1(r,e,t,o){return KB(new jC(e,t,o),r.serverCache)}function YB(r,e,t,o){return KB(r.eventCache,new jC(e,t,o))}function R5(r){return r.eventCache.isFullyInitialized()?r.eventCache.getNode():null}function Mm(r){return r.serverCache.isFullyInitialized()?r.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pA;const Eee=()=>(pA||(pA=new nh(cQ)),pA);class $s{constructor(e,t=Eee()){this.value=e,this.children=t}static fromObject(e){let t=new $s(null);return Uc(e,(o,c)=>{t=t.set(new Hs(o),c)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Ts(),value:this.value};if(Gn(e))return null;{const o=Xn(e),c=this.children.get(o);if(c!==null){const f=c.findRootMostMatchingPathAndValue(Gs(e),t);return f!=null?{path:ia(new Hs(o),f.path),value:f.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Gn(e))return this;{const t=Xn(e),o=this.children.get(t);return o!==null?o.subtree(Gs(e)):new $s(null)}}set(e,t){if(Gn(e))return new $s(t,this.children);{const o=Xn(e),f=(this.children.get(o)||new $s(null)).set(Gs(e),t),y=this.children.insert(o,f);return new $s(this.value,y)}}remove(e){if(Gn(e))return this.children.isEmpty()?new $s(null):new $s(null,this.children);{const t=Xn(e),o=this.children.get(t);if(o){const c=o.remove(Gs(e));let f;return c.isEmpty()?f=this.children.remove(t):f=this.children.insert(t,c),this.value===null&&f.isEmpty()?new $s(null):new $s(this.value,f)}else return this}}get(e){if(Gn(e))return this.value;{const t=Xn(e),o=this.children.get(t);return o?o.get(Gs(e)):null}}setTree(e,t){if(Gn(e))return t;{const o=Xn(e),f=(this.children.get(o)||new $s(null)).setTree(Gs(e),t);let y;return f.isEmpty()?y=this.children.remove(o):y=this.children.insert(o,f),new $s(this.value,y)}}fold(e){return this.fold_(Ts(),e)}fold_(e,t){const o={};return this.children.inorderTraversal((c,f)=>{o[c]=f.fold_(ia(e,c),t)}),t(e,this.value,o)}findOnPath(e,t){return this.findOnPath_(e,Ts(),t)}findOnPath_(e,t,o){const c=this.value?o(t,this.value):!1;if(c)return c;if(Gn(e))return null;{const f=Xn(e),y=this.children.get(f);return y?y.findOnPath_(Gs(e),ia(t,f),o):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ts(),t)}foreachOnPath_(e,t,o){if(Gn(e))return this;{this.value&&o(t,this.value);const c=Xn(e),f=this.children.get(c);return f?f.foreachOnPath_(Gs(e),ia(t,c),o):new $s(null)}}foreach(e){this.foreach_(Ts(),e)}foreach_(e,t){this.children.inorderTraversal((o,c)=>{c.foreach_(ia(e,o),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,o)=>{o.value&&e(t,o.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _u{constructor(e){this.writeTree_=e}static empty(){return new _u(new $s(null))}}function T1(r,e,t){if(Gn(e))return new _u(new $s(t));{const o=r.writeTree_.findRootMostValueAndPath(e);if(o!=null){const c=o.path;let f=o.value;const y=kc(c,e);return f=f.updateChild(y,t),new _u(r.writeTree_.set(c,f))}else{const c=new $s(t),f=r.writeTree_.setTree(e,c);return new _u(f)}}}function hL(r,e,t){let o=r;return Uc(t,(c,f)=>{o=T1(o,ia(e,c),f)}),o}function dL(r,e){if(Gn(e))return _u.empty();{const t=r.writeTree_.setTree(e,new $s(null));return new _u(t)}}function P5(r,e){return qm(r,e)!=null}function qm(r,e){const t=r.writeTree_.findRootMostValueAndPath(e);return t!=null?r.writeTree_.get(t.path).getChild(kc(t.path,e)):null}function fL(r){const e=[],t=r.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Ga,(o,c)=>{e.push(new Zn(o,c))}):r.writeTree_.children.inorderTraversal((o,c)=>{c.value!=null&&e.push(new Zn(o,c.value))}),e}function Xf(r,e){if(Gn(e))return r;{const t=qm(r,e);return t!=null?new _u(new $s(t)):new _u(r.writeTree_.subtree(e))}}function M5(r){return r.writeTree_.isEmpty()}function y0(r,e){return JB(Ts(),r.writeTree_,e)}function JB(r,e,t){if(e.value!=null)return t.updateChild(r,e.value);{let o=null;return e.children.inorderTraversal((c,f)=>{c===".priority"?(Wi(f.value!==null,"Priority writes must always be leaf nodes"),o=f.value):t=JB(ia(r,c),f,t)}),!t.getChild(r).isEmpty()&&o!==null&&(t=t.updateChild(ia(r,".priority"),o)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QB(r,e){return nV(e,r)}function Iee(r,e,t,o,c){Wi(o>r.lastWriteId,"Stacking an older write on top of newer ones"),c===void 0&&(c=!0),r.allWrites.push({path:e,snap:t,writeId:o,visible:c}),c&&(r.visibleWrites=T1(r.visibleWrites,e,t)),r.lastWriteId=o}function See(r,e){for(let t=0;t<r.allWrites.length;t++){const o=r.allWrites[t];if(o.writeId===e)return o}return null}function Aee(r,e){const t=r.allWrites.findIndex(s=>s.writeId===e);Wi(t>=0,"removeWrite called with nonexistent writeId.");const o=r.allWrites[t];r.allWrites.splice(t,1);let c=o.visible,f=!1,y=r.allWrites.length-1;for(;c&&y>=0;){const s=r.allWrites[y];s.visible&&(y>=t&&Cee(s,o.path)?c=!1:cu(o.path,s.path)&&(f=!0)),y--}if(c){if(f)return Ree(r),!0;if(o.snap)r.visibleWrites=dL(r.visibleWrites,o.path);else{const s=o.children;Uc(s,E=>{r.visibleWrites=dL(r.visibleWrites,ia(o.path,E))})}return!0}else return!1}function Cee(r,e){if(r.snap)return cu(r.path,e);for(const t in r.children)if(r.children.hasOwnProperty(t)&&cu(ia(r.path,t),e))return!0;return!1}function Ree(r){r.visibleWrites=eV(r.allWrites,Pee,Ts()),r.allWrites.length>0?r.lastWriteId=r.allWrites[r.allWrites.length-1].writeId:r.lastWriteId=-1}function Pee(r){return r.visible}function eV(r,e,t){let o=_u.empty();for(let c=0;c<r.length;++c){const f=r[c];if(e(f)){const y=f.path;let s;if(f.snap)cu(t,y)?(s=kc(t,y),o=T1(o,s,f.snap)):cu(y,t)&&(s=kc(y,t),o=T1(o,Ts(),f.snap.getChild(s)));else if(f.children){if(cu(t,y))s=kc(t,y),o=hL(o,s,f.children);else if(cu(y,t))if(s=kc(y,t),Gn(s))o=hL(o,Ts(),f.children);else{const E=m0(f.children,Xn(s));if(E){const R=E.getChild(Gs(s));o=T1(o,Ts(),R)}}}else throw z0("WriteRecord should have .snap or .children")}}return o}function tV(r,e,t,o,c){if(!o&&!c){const f=qm(r.visibleWrites,e);if(f!=null)return f;{const y=Xf(r.visibleWrites,e);if(M5(y))return t;if(t==null&&!P5(y,Ts()))return null;{const s=t||_s.EMPTY_NODE;return y0(y,s)}}}else{const f=Xf(r.visibleWrites,e);if(!c&&M5(f))return t;if(!c&&t==null&&!P5(f,Ts()))return null;{const y=function(R){return(R.visible||c)&&(!o||!~o.indexOf(R.writeId))&&(cu(R.path,e)||cu(e,R.path))},s=eV(r.allWrites,y,e),E=t||_s.EMPTY_NODE;return y0(s,E)}}}function Mee(r,e,t){let o=_s.EMPTY_NODE;const c=qm(r.visibleWrites,e);if(c)return c.isLeafNode()||c.forEachChild(Ga,(f,y)=>{o=o.updateImmediateChild(f,y)}),o;if(t){const f=Xf(r.visibleWrites,e);return t.forEachChild(Ga,(y,s)=>{const E=y0(Xf(f,new Hs(y)),s);o=o.updateImmediateChild(y,E)}),fL(f).forEach(y=>{o=o.updateImmediateChild(y.name,y.node)}),o}else{const f=Xf(r.visibleWrites,e);return fL(f).forEach(y=>{o=o.updateImmediateChild(y.name,y.node)}),o}}function kee(r,e,t,o,c){Wi(o||c,"Either existingEventSnap or existingServerSnap must exist");const f=ia(e,t);if(P5(r.visibleWrites,f))return null;{const y=Xf(r.visibleWrites,f);return M5(y)?c.getChild(t):y0(y,c.getChild(t))}}function Dee(r,e,t,o){const c=ia(e,t),f=qm(r.visibleWrites,c);if(f!=null)return f;if(o.isCompleteForChild(t)){const y=Xf(r.visibleWrites,c);return y0(y,o.getNode().getImmediateChild(t))}else return null}function Lee(r,e){return qm(r.visibleWrites,e)}function Oee(r,e,t,o,c,f,y){let s;const E=Xf(r.visibleWrites,e),R=qm(E,Ts());if(R!=null)s=R;else if(t!=null)s=y0(E,t);else return[];if(s=s.withIndex(y),!s.isEmpty()&&!s.isLeafNode()){const O=[],A=y.getCompare(),U=f?s.getReverseIteratorFrom(o,y):s.getIteratorFrom(o,y);let $=U.getNext();for(;$&&O.length<c;)A($,o)!==0&&O.push($),$=U.getNext();return O}else return[]}function Fee(){return{visibleWrites:_u.empty(),allWrites:[],lastWriteId:-1}}function k5(r,e,t,o){return tV(r.writeTree,r.treePath,e,t,o)}function iV(r,e){return Mee(r.writeTree,r.treePath,e)}function pL(r,e,t,o){return kee(r.writeTree,r.treePath,e,t,o)}function aT(r,e){return Lee(r.writeTree,ia(r.treePath,e))}function zee(r,e,t,o,c,f){return Oee(r.writeTree,r.treePath,e,t,o,c,f)}function $C(r,e,t){return Dee(r.writeTree,r.treePath,e,t)}function rV(r,e){return nV(ia(r.treePath,e),r.writeTree)}function nV(r,e){return{treePath:r,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nee{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,o=e.childName;Wi(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),Wi(o!==".priority","Only non-priority child changes can be tracked.");const c=this.changeMap.get(o);if(c){const f=c.type;if(t==="child_added"&&f==="child_removed")this.changeMap.set(o,aL(o,e.snapshotNode,c.snapshotNode));else if(t==="child_removed"&&f==="child_added")this.changeMap.delete(o);else if(t==="child_removed"&&f==="child_changed")this.changeMap.set(o,fee(o,c.oldSnap));else if(t==="child_changed"&&f==="child_added")this.changeMap.set(o,dee(o,e.snapshotNode));else if(t==="child_changed"&&f==="child_changed")this.changeMap.set(o,aL(o,e.snapshotNode,c.oldSnap));else throw z0("Illegal combination of changes: "+e+" occurred after "+c)}else this.changeMap.set(o,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bee{getCompleteChild(e){return null}getChildAfterChild(e,t,o){return null}}const sV=new Bee;class GC{constructor(e,t,o=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=o}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const o=this.optCompleteServerCache_!=null?new jC(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return $C(this.writes_,e,o)}}getChildAfterChild(e,t,o){const c=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Mm(this.viewCache_),f=zee(this.writes_,c,t,1,o,e);return f.length===0?null:f[0]}}function Vee(r,e){Wi(e.eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),Wi(e.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed")}function Uee(r,e,t,o,c){const f=new Nee;let y,s;if(t.type===sh.OVERWRITE){const R=t;R.source.fromUser?y=D5(r,e,R.path,R.snap,o,c,f):(Wi(R.source.fromServer,"Unknown source."),s=R.source.tagged||e.serverCache.isFiltered()&&!Gn(R.path),y=lT(r,e,R.path,R.snap,o,c,s,f))}else if(t.type===sh.MERGE){const R=t;R.source.fromUser?y=$ee(r,e,R.path,R.children,o,c,f):(Wi(R.source.fromServer,"Unknown source."),s=R.source.tagged||e.serverCache.isFiltered(),y=L5(r,e,R.path,R.children,o,c,s,f))}else if(t.type===sh.ACK_USER_WRITE){const R=t;R.revert?y=qee(r,e,R.path,o,c,f):y=Gee(r,e,R.path,R.affectedTree,o,c,f)}else if(t.type===sh.LISTEN_COMPLETE)y=Hee(r,e,t.path,o,f);else throw z0("Unknown operation type: "+t.type);const E=f.getChanges();return jee(e,y,E),{viewCache:y,changes:E}}function jee(r,e,t){const o=e.eventCache;if(o.isFullyInitialized()){const c=o.getNode().isLeafNode()||o.getNode().isEmpty(),f=R5(r);(t.length>0||!r.eventCache.isFullyInitialized()||c&&!o.getNode().equals(f)||!o.getNode().getPriority().equals(f.getPriority()))&&t.push(hee(R5(e)))}}function oV(r,e,t,o,c,f){const y=e.eventCache;if(aT(o,t)!=null)return e;{let s,E;if(Gn(t))if(Wi(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const R=Mm(e),O=R instanceof _s?R:_s.EMPTY_NODE,A=iV(o,O);s=r.filter.updateFullNode(e.eventCache.getNode(),A,f)}else{const R=k5(o,Mm(e));s=r.filter.updateFullNode(e.eventCache.getNode(),R,f)}else{const R=Xn(t);if(R===".priority"){Wi(ip(t)===1,"Can't have a priority with additional path components");const O=y.getNode();E=e.serverCache.getNode();const A=pL(o,t,O,E);A!=null?s=r.filter.updatePriority(O,A):s=y.getNode()}else{const O=Gs(t);let A;if(y.isCompleteForChild(R)){E=e.serverCache.getNode();const U=pL(o,t,y.getNode(),E);U!=null?A=y.getNode().getImmediateChild(R).updateChild(O,U):A=y.getNode().getImmediateChild(R)}else A=$C(o,R,e.serverCache);A!=null?s=r.filter.updateChild(y.getNode(),R,A,O,c,f):s=y.getNode()}}return w1(e,s,y.isFullyInitialized()||Gn(t),r.filter.filtersNodes())}}function lT(r,e,t,o,c,f,y,s){const E=e.serverCache;let R;const O=y?r.filter:r.filter.getIndexedFilter();if(Gn(t))R=O.updateFullNode(E.getNode(),o,null);else if(O.filtersNodes()&&!E.isFiltered()){const $=E.getNode().updateChild(t,o);R=O.updateFullNode(E.getNode(),$,null)}else{const $=Xn(t);if(!E.isCompleteForPath(t)&&ip(t)>1)return e;const te=Gs(t),de=E.getNode().getImmediateChild($).updateChild(te,o);$===".priority"?R=O.updatePriority(E.getNode(),de):R=O.updateChild(E.getNode(),$,de,te,sV,null)}const A=YB(e,R,E.isFullyInitialized()||Gn(t),O.filtersNodes()),U=new GC(c,A,f);return oV(r,A,t,c,U,s)}function D5(r,e,t,o,c,f,y){const s=e.eventCache;let E,R;const O=new GC(c,e,f);if(Gn(t))R=r.filter.updateFullNode(e.eventCache.getNode(),o,y),E=w1(e,R,!0,r.filter.filtersNodes());else{const A=Xn(t);if(A===".priority")R=r.filter.updatePriority(e.eventCache.getNode(),o),E=w1(e,R,s.isFullyInitialized(),s.isFiltered());else{const U=Gs(t),$=s.getNode().getImmediateChild(A);let te;if(Gn(U))te=o;else{const Q=O.getCompleteChild(A);Q!=null?FB(U)===".priority"&&Q.getChild(NB(U)).isEmpty()?te=Q:te=Q.updateChild(U,o):te=_s.EMPTY_NODE}if($.equals(te))E=e;else{const Q=r.filter.updateChild(s.getNode(),A,te,U,O,y);E=w1(e,Q,s.isFullyInitialized(),r.filter.filtersNodes())}}}return E}function mL(r,e){return r.eventCache.isCompleteForChild(e)}function $ee(r,e,t,o,c,f,y){let s=e;return o.foreach((E,R)=>{const O=ia(t,E);mL(e,Xn(O))&&(s=D5(r,s,O,R,c,f,y))}),o.foreach((E,R)=>{const O=ia(t,E);mL(e,Xn(O))||(s=D5(r,s,O,R,c,f,y))}),s}function _L(r,e,t){return t.foreach((o,c)=>{e=e.updateChild(o,c)}),e}function L5(r,e,t,o,c,f,y,s){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let E=e,R;Gn(t)?R=o:R=new $s(null).setTree(t,o);const O=e.serverCache.getNode();return R.children.inorderTraversal((A,U)=>{if(O.hasChild(A)){const $=e.serverCache.getNode().getImmediateChild(A),te=_L(r,$,U);E=lT(r,E,new Hs(A),te,c,f,y,s)}}),R.children.inorderTraversal((A,U)=>{const $=!e.serverCache.isCompleteForChild(A)&&U.value===null;if(!O.hasChild(A)&&!$){const te=e.serverCache.getNode().getImmediateChild(A),Q=_L(r,te,U);E=lT(r,E,new Hs(A),Q,c,f,y,s)}}),E}function Gee(r,e,t,o,c,f,y){if(aT(c,t)!=null)return e;const s=e.serverCache.isFiltered(),E=e.serverCache;if(o.value!=null){if(Gn(t)&&E.isFullyInitialized()||E.isCompleteForPath(t))return lT(r,e,t,E.getNode().getChild(t),c,f,s,y);if(Gn(t)){let R=new $s(null);return E.getNode().forEachChild(t0,(O,A)=>{R=R.set(new Hs(O),A)}),L5(r,e,t,R,c,f,s,y)}else return e}else{let R=new $s(null);return o.foreach((O,A)=>{const U=ia(t,O);E.isCompleteForPath(U)&&(R=R.set(O,E.getNode().getChild(U)))}),L5(r,e,t,R,c,f,s,y)}}function Hee(r,e,t,o,c){const f=e.serverCache,y=YB(e,f.getNode(),f.isFullyInitialized()||Gn(t),f.isFiltered());return oV(r,y,t,o,sV,c)}function qee(r,e,t,o,c,f){let y;if(aT(o,t)!=null)return e;{const s=new GC(o,e,c),E=e.eventCache.getNode();let R;if(Gn(t)||Xn(t)===".priority"){let O;if(e.serverCache.isFullyInitialized())O=k5(o,Mm(e));else{const A=e.serverCache.getNode();Wi(A instanceof _s,"serverChildren would be complete if leaf node"),O=iV(o,A)}O=O,R=r.filter.updateFullNode(E,O,f)}else{const O=Xn(t);let A=$C(o,O,e.serverCache);A==null&&e.serverCache.isCompleteForChild(O)&&(A=E.getImmediateChild(O)),A!=null?R=r.filter.updateChild(E,O,A,Gs(t),s,f):e.eventCache.getNode().hasChild(O)?R=r.filter.updateChild(E,O,_s.EMPTY_NODE,Gs(t),s,f):R=E,R.isEmpty()&&e.serverCache.isFullyInitialized()&&(y=k5(o,Mm(e)),y.isLeafNode()&&(R=r.filter.updateFullNode(R,y,f)))}return y=e.serverCache.isFullyInitialized()||aT(o,Ts())!=null,w1(e,R,y,r.filter.filtersNodes())}}function Wee(r,e){const t=Mm(r.viewCache_);return t&&(r.query._queryParams.loadsAllData()||!Gn(e)&&!t.getImmediateChild(Xn(e)).isEmpty())?t.getChild(e):null}function gL(r,e,t,o){e.type===sh.MERGE&&e.source.queryId!==null&&(Wi(Mm(r.viewCache_),"We should always have a full cache before handling merges"),Wi(R5(r.viewCache_),"Missing event cache, even though we have a server cache"));const c=r.viewCache_,f=Uee(r.processor_,c,e,t,o);return Vee(r.processor_,f.viewCache),Wi(f.viewCache.serverCache.isFullyInitialized()||!c.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),r.viewCache_=f.viewCache,Xee(r,f.changes,f.viewCache.eventCache.getNode())}function Xee(r,e,t,o){const c=r.eventRegistrations_;return bee(r.eventGenerator_,e,t,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yL;function Zee(r){Wi(!yL,"__referenceConstructor has already been defined"),yL=r}function HC(r,e,t,o){const c=e.source.queryId;if(c!==null){const f=r.views.get(c);return Wi(f!=null,"SyncTree gave us an op for an invalid query."),gL(f,e,t,o)}else{let f=[];for(const y of r.views.values())f=f.concat(gL(y,e,t,o));return f}}function qC(r,e){let t=null;for(const o of r.views.values())t=t||Wee(o,e);return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vL;function Kee(r){Wi(!vL,"__referenceConstructor has already been defined"),vL=r}class xL{constructor(e){this.listenProvider_=e,this.syncPointTree_=new $s(null),this.pendingWriteTree_=Fee(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Yee(r,e,t,o,c){return Iee(r.pendingWriteTree_,e,t,o,c),c?fE(r,new Pm(WB(),e,t)):[]}function zg(r,e,t=!1){const o=See(r.pendingWriteTree_,e);if(Aee(r.pendingWriteTree_,e)){let f=new $s(null);return o.snap!=null?f=f.set(Ts(),!0):Uc(o.children,y=>{f=f.set(new Hs(y),!0)}),fE(r,new oT(o.path,f,t))}else return[]}function dE(r,e,t){return fE(r,new Pm(XB(),e,t))}function Jee(r,e,t){const o=$s.fromObject(t);return fE(r,new rx(XB(),e,o))}function Qee(r,e,t,o){const c=uV(r,o);if(c!=null){const f=hV(c),y=f.path,s=f.queryId,E=kc(y,e),R=new Pm(ZB(s),E,t);return dV(r,y,R)}else return[]}function ete(r,e,t,o){const c=uV(r,o);if(c){const f=hV(c),y=f.path,s=f.queryId,E=kc(y,e),R=$s.fromObject(t),O=new rx(ZB(s),E,R);return dV(r,y,O)}else return[]}function aV(r,e,t){const c=r.pendingWriteTree_,f=r.syncPointTree_.findOnPath(e,(y,s)=>{const E=kc(y,e),R=qC(s,E);if(R)return R});return tV(c,e,f,t,!0)}function fE(r,e){return lV(e,r.syncPointTree_,null,QB(r.pendingWriteTree_,Ts()))}function lV(r,e,t,o){if(Gn(r.path))return cV(r,e,t,o);{const c=e.get(Ts());t==null&&c!=null&&(t=qC(c,Ts()));let f=[];const y=Xn(r.path),s=r.operationForChild(y),E=e.children.get(y);if(E&&s){const R=t?t.getImmediateChild(y):null,O=rV(o,y);f=f.concat(lV(s,E,R,O))}return c&&(f=f.concat(HC(c,r,o,t))),f}}function cV(r,e,t,o){const c=e.get(Ts());t==null&&c!=null&&(t=qC(c,Ts()));let f=[];return e.children.inorderTraversal((y,s)=>{const E=t?t.getImmediateChild(y):null,R=rV(o,y),O=r.operationForChild(y);O&&(f=f.concat(cV(O,s,E,R)))}),c&&(f=f.concat(HC(c,r,o,t))),f}function uV(r,e){return r.tagToQueryMap.get(e)}function hV(r){const e=r.indexOf("$");return Wi(e!==-1&&e<r.length-1,"Bad queryKey."),{queryId:r.substr(e+1),path:new Hs(r.substr(0,e))}}function dV(r,e,t){const o=r.syncPointTree_.get(e);Wi(o,"Missing sync point for query tag that we're tracking");const c=QB(r.pendingWriteTree_,e);return HC(o,t,c,null)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WC{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new WC(t)}node(){return this.node_}}class XC{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=ia(this.path_,e);return new XC(this.syncTree_,t)}node(){return aV(this.syncTree_,this.path_)}}const tte=function(r){return r=r||{},r.timestamp=r.timestamp||new Date().getTime(),r},bL=function(r,e,t){if(!r||typeof r!="object")return r;if(Wi(".sv"in r,"Unexpected leaf node or priority contents"),typeof r[".sv"]=="string")return ite(r[".sv"],e,t);if(typeof r[".sv"]=="object")return rte(r[".sv"],e);Wi(!1,"Unexpected server value: "+JSON.stringify(r,null,2))},ite=function(r,e,t){switch(r){case"timestamp":return t.timestamp;default:Wi(!1,"Unexpected server value: "+r)}},rte=function(r,e,t){r.hasOwnProperty("increment")||Wi(!1,"Unexpected server value: "+JSON.stringify(r,null,2));const o=r.increment;typeof o!="number"&&Wi(!1,"Unexpected increment value: "+o);const c=e.node();if(Wi(c!==null&&typeof c<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!c.isLeafNode())return o;const y=c.getValue();return typeof y!="number"?o:y+o},nte=function(r,e,t,o){return ZC(e,new XC(t,r),o)},ste=function(r,e,t){return ZC(r,new WC(e),t)};function ZC(r,e,t){const o=r.getPriority().val(),c=bL(o,e.getImmediateChild(".priority"),t);let f;if(r.isLeafNode()){const y=r,s=bL(y.getValue(),e,t);return s!==y.getValue()||c!==y.getPriority().val()?new ea(s,Ba(c)):r}else{const y=r;return f=y,c!==y.getPriority().val()&&(f=f.updatePriority(new ea(c))),y.forEachChild(Ga,(s,E)=>{const R=ZC(E,e.getImmediateChild(s),t);R!==E&&(f=f.updateImmediateChild(s,R))}),f}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KC{constructor(e="",t=null,o={children:{},childCount:0}){this.name=e,this.parent=t,this.node=o}}function YC(r,e){let t=e instanceof Hs?e:new Hs(e),o=r,c=Xn(t);for(;c!==null;){const f=m0(o.node.children,c)||{children:{},childCount:0};o=new KC(c,o,f),t=Gs(t),c=Xn(t)}return o}function j0(r){return r.node.value}function fV(r,e){r.node.value=e,O5(r)}function pV(r){return r.node.childCount>0}function ote(r){return j0(r)===void 0&&!pV(r)}function pE(r,e){Uc(r.node.children,(t,o)=>{e(new KC(t,r,o))})}function mV(r,e,t,o){t&&e(r),pE(r,c=>{mV(c,e,!0)})}function ate(r,e,t){let o=r.parent;for(;o!==null;){if(e(o))return!0;o=o.parent}return!1}function Fx(r){return new Hs(r.parent===null?r.name:Fx(r.parent)+"/"+r.name)}function O5(r){r.parent!==null&&lte(r.parent,r.name,r)}function lte(r,e,t){const o=ote(t),c=Ld(r.node.children,e);o&&c?(delete r.node.children[e],r.node.childCount--,O5(r)):!o&&!c&&(r.node.children[e]=t.node,r.node.childCount++,O5(r))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cte=/[\[\].#$\/\u0000-\u001F\u007F]/,ute=/[\[\].#$\u0000-\u001F\u007F]/,mA=10*1024*1024,_V=function(r){return typeof r=="string"&&r.length!==0&&!cte.test(r)},hte=function(r){return typeof r=="string"&&r.length!==0&&!ute.test(r)},dte=function(r){return r&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),hte(r)},gV=function(r,e,t){const o=t instanceof Hs?new HQ(t,r):t;if(e===void 0)throw new Error(r+"contains undefined "+im(o));if(typeof e=="function")throw new Error(r+"contains a function "+im(o)+" with contents = "+e.toString());if(_B(e))throw new Error(r+"contains "+e.toString()+" "+im(o));if(typeof e=="string"&&e.length>mA/3&&nE(e)>mA)throw new Error(r+"contains a string greater than "+mA+" utf8 bytes "+im(o)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let c=!1,f=!1;if(Uc(e,(y,s)=>{if(y===".value")c=!0;else if(y!==".priority"&&y!==".sv"&&(f=!0,!_V(y)))throw new Error(r+" contains an invalid key ("+y+") "+im(o)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);qQ(o,y),gV(r,s,o),WQ(o)}),c&&f)throw new Error(r+' contains ".value" child '+im(o)+" in addition to actual children.")}},fte=function(r,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!_V(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!dte(t))throw new Error(JX(r,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pte{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function mte(r,e){let t=null;for(let o=0;o<e.length;o++){const c=e[o],f=c.getPath();t!==null&&!BB(f,t.path)&&(r.eventLists_.push(t),t=null),t===null&&(t={events:[],path:f}),t.events.push(c)}t&&r.eventLists_.push(t)}function Wm(r,e,t){mte(r,t),_te(r,o=>cu(o,e)||cu(e,o))}function _te(r,e){r.recursionDepth_++;let t=!0;for(let o=0;o<r.eventLists_.length;o++){const c=r.eventLists_[o];if(c){const f=c.path;e(f)?(gte(r.eventLists_[o]),r.eventLists_[o]=null):t=!1}}t&&(r.eventLists_=[]),r.recursionDepth_--}function gte(r){for(let e=0;e<r.events.length;e++){const t=r.events[e];if(t!==null){r.events[e]=null;const o=t.getEventRunner();x1&&Na("event: "+t.toString()),Lx(o)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yte="repo_interrupt",vte=25;class xte{constructor(e,t,o,c){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=o,this.appCheckProvider_=c,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new pte,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=sT(),this.transactionQueueTree_=new KC,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function bte(r,e,t){if(r.stats_=zC(r.repoInfo_),r.forceRestClient_||mQ())r.server_=new nT(r.repoInfo_,(o,c,f,y)=>{wL(r,o,c,f,y)},r.authTokenProvider_,r.appCheckProvider_),setTimeout(()=>TL(r,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{pa(t)}catch(o){throw new Error("Invalid authOverride provided: "+o)}}r.persistentConnection_=new xd(r.repoInfo_,e,(o,c,f,y)=>{wL(r,o,c,f,y)},o=>{TL(r,o)},o=>{Tte(r,o)},r.authTokenProvider_,r.appCheckProvider_,t),r.server_=r.persistentConnection_}r.authTokenProvider_.addTokenChangeListener(o=>{r.server_.refreshAuthToken(o)}),r.appCheckProvider_.addTokenChangeListener(o=>{r.server_.refreshAppCheckToken(o.token)}),r.statsReporter_=bQ(r.repoInfo_,()=>new xee(r.stats_,r.server_)),r.infoData_=new mee,r.infoSyncTree_=new xL({startListening:(o,c,f,y)=>{let s=[];const E=r.infoData_.getNode(o._path);return E.isEmpty()||(s=dE(r.infoSyncTree_,o._path,E),setTimeout(()=>{y("ok")},0)),s},stopListening:()=>{}}),JC(r,"connected",!1),r.serverSyncTree_=new xL({startListening:(o,c,f,y)=>(r.server_.listen(o,f,c,(s,E)=>{const R=y(s,E);Wm(r.eventQueue_,o._path,R)}),[]),stopListening:(o,c)=>{r.server_.unlisten(o,c)}})}function wte(r){const t=r.infoData_.getNode(new Hs(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function yV(r){return tte({timestamp:wte(r)})}function wL(r,e,t,o,c){r.dataUpdateCount++;const f=new Hs(e);t=r.interceptServerDataCallback_?r.interceptServerDataCallback_(e,t):t;let y=[];if(c)if(o){const E=W2(t,R=>Ba(R));y=ete(r.serverSyncTree_,f,E,c)}else{const E=Ba(t);y=Qee(r.serverSyncTree_,f,E,c)}else if(o){const E=W2(t,R=>Ba(R));y=Jee(r.serverSyncTree_,f,E)}else{const E=Ba(t);y=dE(r.serverSyncTree_,f,E)}let s=f;y.length>0&&(s=eR(r,f)),Wm(r.eventQueue_,s,y)}function TL(r,e){JC(r,"connected",e),e===!1&&Ite(r)}function Tte(r,e){Uc(e,(t,o)=>{JC(r,t,o)})}function JC(r,e,t){const o=new Hs("/.info/"+e),c=Ba(t);r.infoData_.updateSnapshot(o,c);const f=dE(r.infoSyncTree_,o,c);Wm(r.eventQueue_,o,f)}function Ete(r){return r.nextWriteId_++}function Ite(r){vV(r,"onDisconnectEvents");const e=yV(r),t=sT();C5(r.onDisconnect_,Ts(),(c,f)=>{const y=nte(c,f,r.serverSyncTree_,e);qB(t,c,y)});let o=[];C5(t,Ts(),(c,f)=>{o=o.concat(dE(r.serverSyncTree_,c,f));const y=Rte(r,c);eR(r,y)}),r.onDisconnect_=sT(),Wm(r.eventQueue_,Ts(),o)}function Ste(r){r.persistentConnection_&&r.persistentConnection_.interrupt(yte)}function vV(r,...e){let t="";r.persistentConnection_&&(t=r.persistentConnection_.id+":"),Na(t,...e)}function xV(r,e,t){return aV(r.serverSyncTree_,e,t)||_s.EMPTY_NODE}function QC(r,e=r.transactionQueueTree_){if(e||mE(r,e),j0(e)){const t=wV(r,e);Wi(t.length>0,"Sending zero length transaction queue"),t.every(c=>c.status===0)&&Ate(r,Fx(e),t)}else pV(e)&&pE(e,t=>{QC(r,t)})}function Ate(r,e,t){const o=t.map(R=>R.currentWriteId),c=xV(r,e,o);let f=c;const y=c.hash();for(let R=0;R<t.length;R++){const O=t[R];Wi(O.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),O.status=1,O.retryCount++;const A=kc(e,O.path);f=f.updateChild(A,O.currentOutputSnapshotRaw)}const s=f.val(!0),E=e;r.server_.put(E.toString(),s,R=>{vV(r,"transaction put response",{path:E.toString(),status:R});let O=[];if(R==="ok"){const A=[];for(let U=0;U<t.length;U++)t[U].status=2,O=O.concat(zg(r.serverSyncTree_,t[U].currentWriteId)),t[U].onComplete&&A.push(()=>t[U].onComplete(null,!0,t[U].currentOutputSnapshotResolved)),t[U].unwatcher();mE(r,YC(r.transactionQueueTree_,e)),QC(r,r.transactionQueueTree_),Wm(r.eventQueue_,e,O);for(let U=0;U<A.length;U++)Lx(A[U])}else{if(R==="datastale")for(let A=0;A<t.length;A++)t[A].status===3?t[A].status=4:t[A].status=0;else{nc("transaction at "+E.toString()+" failed: "+R);for(let A=0;A<t.length;A++)t[A].status=4,t[A].abortReason=R}eR(r,e)}},y)}function eR(r,e){const t=bV(r,e),o=Fx(t),c=wV(r,t);return Cte(r,c,o),o}function Cte(r,e,t){if(e.length===0)return;const o=[];let c=[];const y=e.filter(s=>s.status===0).map(s=>s.currentWriteId);for(let s=0;s<e.length;s++){const E=e[s],R=kc(t,E.path);let O=!1,A;if(Wi(R!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),E.status===4)O=!0,A=E.abortReason,c=c.concat(zg(r.serverSyncTree_,E.currentWriteId,!0));else if(E.status===0)if(E.retryCount>=vte)O=!0,A="maxretry",c=c.concat(zg(r.serverSyncTree_,E.currentWriteId,!0));else{const U=xV(r,E.path,y);E.currentInputSnapshot=U;const $=e[s].update(U.val());if($!==void 0){gV("transaction failed: Data returned ",$,E.path);let te=Ba($);typeof $=="object"&&$!=null&&Ld($,".priority")||(te=te.updatePriority(U.getPriority()));const de=E.currentWriteId,Ce=yV(r),Fe=ste(te,U,Ce);E.currentOutputSnapshotRaw=te,E.currentOutputSnapshotResolved=Fe,E.currentWriteId=Ete(r),y.splice(y.indexOf(de),1),c=c.concat(Yee(r.serverSyncTree_,E.path,Fe,E.currentWriteId,E.applyLocally)),c=c.concat(zg(r.serverSyncTree_,de,!0))}else O=!0,A="nodata",c=c.concat(zg(r.serverSyncTree_,E.currentWriteId,!0))}Wm(r.eventQueue_,t,c),c=[],O&&(e[s].status=2,function(U){setTimeout(U,Math.floor(0))}(e[s].unwatcher),e[s].onComplete&&(A==="nodata"?o.push(()=>e[s].onComplete(null,!1,e[s].currentInputSnapshot)):o.push(()=>e[s].onComplete(new Error(A),!1,null))))}mE(r,r.transactionQueueTree_);for(let s=0;s<o.length;s++)Lx(o[s]);QC(r,r.transactionQueueTree_)}function bV(r,e){let t,o=r.transactionQueueTree_;for(t=Xn(e);t!==null&&j0(o)===void 0;)o=YC(o,t),e=Gs(e),t=Xn(e);return o}function wV(r,e){const t=[];return TV(r,e,t),t.sort((o,c)=>o.order-c.order),t}function TV(r,e,t){const o=j0(e);if(o)for(let c=0;c<o.length;c++)t.push(o[c]);pE(e,c=>{TV(r,c,t)})}function mE(r,e){const t=j0(e);if(t){let o=0;for(let c=0;c<t.length;c++)t[c].status!==2&&(t[o]=t[c],o++);t.length=o,fV(e,t.length>0?t:void 0)}pE(e,o=>{mE(r,o)})}function Rte(r,e){const t=Fx(bV(r,e)),o=YC(r.transactionQueueTree_,e);return ate(o,c=>{_A(r,c)}),_A(r,o),mV(o,c=>{_A(r,c)}),t}function _A(r,e){const t=j0(e);if(t){const o=[];let c=[],f=-1;for(let y=0;y<t.length;y++)t[y].status===3||(t[y].status===1?(Wi(f===y-1,"All SENT items should be at beginning of queue."),f=y,t[y].status=3,t[y].abortReason="set"):(Wi(t[y].status===0,"Unexpected transaction status in abort"),t[y].unwatcher(),c=c.concat(zg(r.serverSyncTree_,t[y].currentWriteId,!0)),t[y].onComplete&&o.push(t[y].onComplete.bind(null,new Error("set"),!1,null))));f===-1?fV(e,void 0):t.length=f+1,Wm(r.eventQueue_,Fx(e),c);for(let y=0;y<o.length;y++)Lx(o[y])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pte(r){let e="";const t=r.split("/");for(let o=0;o<t.length;o++)if(t[o].length>0){let c=t[o];try{c=decodeURIComponent(c.replace(/\+/g," "))}catch{}e+="/"+c}return e}function Mte(r){const e={};r.charAt(0)==="?"&&(r=r.substring(1));for(const t of r.split("&")){if(t.length===0)continue;const o=t.split("=");o.length===2?e[decodeURIComponent(o[0])]=decodeURIComponent(o[1]):nc(`Invalid query segment '${t}' in query '${r}'`)}return e}const EL=function(r,e){const t=kte(r),o=t.namespace;t.domain==="firebase.com"&&Cm(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!o||o==="undefined")&&t.domain!=="localhost"&&Cm("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||aQ();const c=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new yQ(t.host,t.secure,o,c,e,"",o!==t.subdomain),path:new Hs(t.pathString)}},kte=function(r){let e="",t="",o="",c="",f="",y=!0,s="https",E=443;if(typeof r=="string"){let R=r.indexOf("//");R>=0&&(s=r.substring(0,R-1),r=r.substring(R+2));let O=r.indexOf("/");O===-1&&(O=r.length);let A=r.indexOf("?");A===-1&&(A=r.length),e=r.substring(0,Math.min(O,A)),O<A&&(c=Pte(r.substring(O,A)));const U=Mte(r.substring(Math.min(r.length,A)));R=e.indexOf(":"),R>=0?(y=s==="https"||s==="wss",E=parseInt(e.substring(R+1),10)):R=e.length;const $=e.slice(0,R);if($.toLowerCase()==="localhost")t="localhost";else if($.split(".").length<=2)t=$;else{const te=e.indexOf(".");o=e.substring(0,te).toLowerCase(),t=e.substring(te+1),f=o}"ns"in U&&(f=U.ns)}return{host:e,port:E,domain:t,subdomain:o,secure:y,scheme:s,pathString:c,namespace:f}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tR{constructor(e,t,o,c){this._repo=e,this._path=t,this._queryParams=o,this._orderByCalled=c}get key(){return Gn(this._path)?null:FB(this._path)}get ref(){return new $0(this._repo,this._path)}get _queryIdentifier(){const e=cL(this._queryParams),t=OC(e);return t==="{}"?"default":t}get _queryObject(){return cL(this._queryParams)}isEqual(e){if(e=yl(e),!(e instanceof tR))return!1;const t=this._repo===e._repo,o=BB(this._path,e._path),c=this._queryIdentifier===e._queryIdentifier;return t&&o&&c}toJSON(){return this.toString()}toString(){return this._repo.toString()+GQ(this._path)}}class $0 extends tR{constructor(e,t){super(e,t,new UC,!1)}get parent(){const e=NB(this._path);return e===null?null:new $0(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}Zee($0);Kee($0);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dte="FIREBASE_DATABASE_EMULATOR_HOST",F5={};let Lte=!1;function Ote(r,e,t,o,c){let f=o||r.options.databaseURL;f===void 0&&(r.options.projectId||Cm("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Na("Using default host for project ",r.options.projectId),f=`${r.options.projectId}-default-rtdb.firebaseio.com`);let y=EL(f,c),s=y.repoInfo,E;typeof process<"u"&&GD&&(E=GD[Dte]),E?(f=`http://${E}?ns=${s.namespace}`,y=EL(f,c),s=y.repoInfo):y.repoInfo.secure;const R=new gQ(r.name,r.options,e);fte("Invalid Firebase Database URL",y),Gn(y.path)||Cm("Database URL must point to the root of a Firebase Database (not including a child path).");const O=zte(s,r,R,new _Q(r.name,t));return new Nte(O,r)}function Fte(r,e){const t=F5[e];(!t||t[r.key]!==r)&&Cm(`Database ${e}(${r.repoInfo_}) has already been deleted.`),Ste(r),delete t[r.key]}function zte(r,e,t,o){let c=F5[e.name];c||(c={},F5[e.name]=c);let f=c[r.toURLString()];return f&&Cm("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),f=new xte(r,Lte,t,o),c[r.toURLString()]=f,f}class Nte{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(bte(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new $0(this._repo,Ts())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Fte(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Cm("Cannot call "+e+" on a deleted database.")}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bte(r){tQ(up),Ll(new vl("database",(e,{instanceIdentifier:t})=>{const o=e.getProvider("app").getImmediate(),c=e.getProvider("auth-internal"),f=e.getProvider("app-check-internal");return Ote(o,c,f,t)},"PUBLIC").setMultipleInstances(!0)),ya(HD,qD,r),ya(HD,qD,"esm2017")}xd.prototype.simpleListen=function(r,e){this.sendRequest("q",{p:r},e)};xd.prototype.echo=function(r,e){this.sendRequest("echo",{d:r},e)};Bte();var IL=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var pm,EV;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(me,ye){function Se(){}Se.prototype=ye.prototype,me.D=ye.prototype,me.prototype=new Se,me.prototype.constructor=me,me.C=function(ke,Ve,He){for(var Oe=Array(arguments.length-2),xi=2;xi<arguments.length;xi++)Oe[xi-2]=arguments[xi];return ye.prototype[Ve].apply(ke,Oe)}}function t(){this.blockSize=-1}function o(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(o,t),o.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function c(me,ye,Se){Se||(Se=0);var ke=Array(16);if(typeof ye=="string")for(var Ve=0;16>Ve;++Ve)ke[Ve]=ye.charCodeAt(Se++)|ye.charCodeAt(Se++)<<8|ye.charCodeAt(Se++)<<16|ye.charCodeAt(Se++)<<24;else for(Ve=0;16>Ve;++Ve)ke[Ve]=ye[Se++]|ye[Se++]<<8|ye[Se++]<<16|ye[Se++]<<24;ye=me.g[0],Se=me.g[1],Ve=me.g[2];var He=me.g[3],Oe=ye+(He^Se&(Ve^He))+ke[0]+3614090360&4294967295;ye=Se+(Oe<<7&4294967295|Oe>>>25),Oe=He+(Ve^ye&(Se^Ve))+ke[1]+3905402710&4294967295,He=ye+(Oe<<12&4294967295|Oe>>>20),Oe=Ve+(Se^He&(ye^Se))+ke[2]+606105819&4294967295,Ve=He+(Oe<<17&4294967295|Oe>>>15),Oe=Se+(ye^Ve&(He^ye))+ke[3]+3250441966&4294967295,Se=Ve+(Oe<<22&4294967295|Oe>>>10),Oe=ye+(He^Se&(Ve^He))+ke[4]+4118548399&4294967295,ye=Se+(Oe<<7&4294967295|Oe>>>25),Oe=He+(Ve^ye&(Se^Ve))+ke[5]+1200080426&4294967295,He=ye+(Oe<<12&4294967295|Oe>>>20),Oe=Ve+(Se^He&(ye^Se))+ke[6]+2821735955&4294967295,Ve=He+(Oe<<17&4294967295|Oe>>>15),Oe=Se+(ye^Ve&(He^ye))+ke[7]+4249261313&4294967295,Se=Ve+(Oe<<22&4294967295|Oe>>>10),Oe=ye+(He^Se&(Ve^He))+ke[8]+1770035416&4294967295,ye=Se+(Oe<<7&4294967295|Oe>>>25),Oe=He+(Ve^ye&(Se^Ve))+ke[9]+2336552879&4294967295,He=ye+(Oe<<12&4294967295|Oe>>>20),Oe=Ve+(Se^He&(ye^Se))+ke[10]+4294925233&4294967295,Ve=He+(Oe<<17&4294967295|Oe>>>15),Oe=Se+(ye^Ve&(He^ye))+ke[11]+2304563134&4294967295,Se=Ve+(Oe<<22&4294967295|Oe>>>10),Oe=ye+(He^Se&(Ve^He))+ke[12]+1804603682&4294967295,ye=Se+(Oe<<7&4294967295|Oe>>>25),Oe=He+(Ve^ye&(Se^Ve))+ke[13]+4254626195&4294967295,He=ye+(Oe<<12&4294967295|Oe>>>20),Oe=Ve+(Se^He&(ye^Se))+ke[14]+2792965006&4294967295,Ve=He+(Oe<<17&4294967295|Oe>>>15),Oe=Se+(ye^Ve&(He^ye))+ke[15]+1236535329&4294967295,Se=Ve+(Oe<<22&4294967295|Oe>>>10),Oe=ye+(Ve^He&(Se^Ve))+ke[1]+4129170786&4294967295,ye=Se+(Oe<<5&4294967295|Oe>>>27),Oe=He+(Se^Ve&(ye^Se))+ke[6]+3225465664&4294967295,He=ye+(Oe<<9&4294967295|Oe>>>23),Oe=Ve+(ye^Se&(He^ye))+ke[11]+643717713&4294967295,Ve=He+(Oe<<14&4294967295|Oe>>>18),Oe=Se+(He^ye&(Ve^He))+ke[0]+3921069994&4294967295,Se=Ve+(Oe<<20&4294967295|Oe>>>12),Oe=ye+(Ve^He&(Se^Ve))+ke[5]+3593408605&4294967295,ye=Se+(Oe<<5&4294967295|Oe>>>27),Oe=He+(Se^Ve&(ye^Se))+ke[10]+38016083&4294967295,He=ye+(Oe<<9&4294967295|Oe>>>23),Oe=Ve+(ye^Se&(He^ye))+ke[15]+3634488961&4294967295,Ve=He+(Oe<<14&4294967295|Oe>>>18),Oe=Se+(He^ye&(Ve^He))+ke[4]+3889429448&4294967295,Se=Ve+(Oe<<20&4294967295|Oe>>>12),Oe=ye+(Ve^He&(Se^Ve))+ke[9]+568446438&4294967295,ye=Se+(Oe<<5&4294967295|Oe>>>27),Oe=He+(Se^Ve&(ye^Se))+ke[14]+3275163606&4294967295,He=ye+(Oe<<9&4294967295|Oe>>>23),Oe=Ve+(ye^Se&(He^ye))+ke[3]+4107603335&4294967295,Ve=He+(Oe<<14&4294967295|Oe>>>18),Oe=Se+(He^ye&(Ve^He))+ke[8]+1163531501&4294967295,Se=Ve+(Oe<<20&4294967295|Oe>>>12),Oe=ye+(Ve^He&(Se^Ve))+ke[13]+2850285829&4294967295,ye=Se+(Oe<<5&4294967295|Oe>>>27),Oe=He+(Se^Ve&(ye^Se))+ke[2]+4243563512&4294967295,He=ye+(Oe<<9&4294967295|Oe>>>23),Oe=Ve+(ye^Se&(He^ye))+ke[7]+1735328473&4294967295,Ve=He+(Oe<<14&4294967295|Oe>>>18),Oe=Se+(He^ye&(Ve^He))+ke[12]+2368359562&4294967295,Se=Ve+(Oe<<20&4294967295|Oe>>>12),Oe=ye+(Se^Ve^He)+ke[5]+4294588738&4294967295,ye=Se+(Oe<<4&4294967295|Oe>>>28),Oe=He+(ye^Se^Ve)+ke[8]+2272392833&4294967295,He=ye+(Oe<<11&4294967295|Oe>>>21),Oe=Ve+(He^ye^Se)+ke[11]+1839030562&4294967295,Ve=He+(Oe<<16&4294967295|Oe>>>16),Oe=Se+(Ve^He^ye)+ke[14]+4259657740&4294967295,Se=Ve+(Oe<<23&4294967295|Oe>>>9),Oe=ye+(Se^Ve^He)+ke[1]+2763975236&4294967295,ye=Se+(Oe<<4&4294967295|Oe>>>28),Oe=He+(ye^Se^Ve)+ke[4]+1272893353&4294967295,He=ye+(Oe<<11&4294967295|Oe>>>21),Oe=Ve+(He^ye^Se)+ke[7]+4139469664&4294967295,Ve=He+(Oe<<16&4294967295|Oe>>>16),Oe=Se+(Ve^He^ye)+ke[10]+3200236656&4294967295,Se=Ve+(Oe<<23&4294967295|Oe>>>9),Oe=ye+(Se^Ve^He)+ke[13]+681279174&4294967295,ye=Se+(Oe<<4&4294967295|Oe>>>28),Oe=He+(ye^Se^Ve)+ke[0]+3936430074&4294967295,He=ye+(Oe<<11&4294967295|Oe>>>21),Oe=Ve+(He^ye^Se)+ke[3]+3572445317&4294967295,Ve=He+(Oe<<16&4294967295|Oe>>>16),Oe=Se+(Ve^He^ye)+ke[6]+76029189&4294967295,Se=Ve+(Oe<<23&4294967295|Oe>>>9),Oe=ye+(Se^Ve^He)+ke[9]+3654602809&4294967295,ye=Se+(Oe<<4&4294967295|Oe>>>28),Oe=He+(ye^Se^Ve)+ke[12]+3873151461&4294967295,He=ye+(Oe<<11&4294967295|Oe>>>21),Oe=Ve+(He^ye^Se)+ke[15]+530742520&4294967295,Ve=He+(Oe<<16&4294967295|Oe>>>16),Oe=Se+(Ve^He^ye)+ke[2]+3299628645&4294967295,Se=Ve+(Oe<<23&4294967295|Oe>>>9),Oe=ye+(Ve^(Se|~He))+ke[0]+4096336452&4294967295,ye=Se+(Oe<<6&4294967295|Oe>>>26),Oe=He+(Se^(ye|~Ve))+ke[7]+1126891415&4294967295,He=ye+(Oe<<10&4294967295|Oe>>>22),Oe=Ve+(ye^(He|~Se))+ke[14]+2878612391&4294967295,Ve=He+(Oe<<15&4294967295|Oe>>>17),Oe=Se+(He^(Ve|~ye))+ke[5]+4237533241&4294967295,Se=Ve+(Oe<<21&4294967295|Oe>>>11),Oe=ye+(Ve^(Se|~He))+ke[12]+1700485571&4294967295,ye=Se+(Oe<<6&4294967295|Oe>>>26),Oe=He+(Se^(ye|~Ve))+ke[3]+2399980690&4294967295,He=ye+(Oe<<10&4294967295|Oe>>>22),Oe=Ve+(ye^(He|~Se))+ke[10]+4293915773&4294967295,Ve=He+(Oe<<15&4294967295|Oe>>>17),Oe=Se+(He^(Ve|~ye))+ke[1]+2240044497&4294967295,Se=Ve+(Oe<<21&4294967295|Oe>>>11),Oe=ye+(Ve^(Se|~He))+ke[8]+1873313359&4294967295,ye=Se+(Oe<<6&4294967295|Oe>>>26),Oe=He+(Se^(ye|~Ve))+ke[15]+4264355552&4294967295,He=ye+(Oe<<10&4294967295|Oe>>>22),Oe=Ve+(ye^(He|~Se))+ke[6]+2734768916&4294967295,Ve=He+(Oe<<15&4294967295|Oe>>>17),Oe=Se+(He^(Ve|~ye))+ke[13]+1309151649&4294967295,Se=Ve+(Oe<<21&4294967295|Oe>>>11),Oe=ye+(Ve^(Se|~He))+ke[4]+4149444226&4294967295,ye=Se+(Oe<<6&4294967295|Oe>>>26),Oe=He+(Se^(ye|~Ve))+ke[11]+3174756917&4294967295,He=ye+(Oe<<10&4294967295|Oe>>>22),Oe=Ve+(ye^(He|~Se))+ke[2]+718787259&4294967295,Ve=He+(Oe<<15&4294967295|Oe>>>17),Oe=Se+(He^(Ve|~ye))+ke[9]+3951481745&4294967295,me.g[0]=me.g[0]+ye&4294967295,me.g[1]=me.g[1]+(Ve+(Oe<<21&4294967295|Oe>>>11))&4294967295,me.g[2]=me.g[2]+Ve&4294967295,me.g[3]=me.g[3]+He&4294967295}o.prototype.u=function(me,ye){ye===void 0&&(ye=me.length);for(var Se=ye-this.blockSize,ke=this.B,Ve=this.h,He=0;He<ye;){if(Ve==0)for(;He<=Se;)c(this,me,He),He+=this.blockSize;if(typeof me=="string"){for(;He<ye;)if(ke[Ve++]=me.charCodeAt(He++),Ve==this.blockSize){c(this,ke),Ve=0;break}}else for(;He<ye;)if(ke[Ve++]=me[He++],Ve==this.blockSize){c(this,ke),Ve=0;break}}this.h=Ve,this.o+=ye},o.prototype.v=function(){var me=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);me[0]=128;for(var ye=1;ye<me.length-8;++ye)me[ye]=0;var Se=8*this.o;for(ye=me.length-8;ye<me.length;++ye)me[ye]=Se&255,Se/=256;for(this.u(me),me=Array(16),ye=Se=0;4>ye;++ye)for(var ke=0;32>ke;ke+=8)me[Se++]=this.g[ye]>>>ke&255;return me};function f(me,ye){var Se=s;return Object.prototype.hasOwnProperty.call(Se,me)?Se[me]:Se[me]=ye(me)}function y(me,ye){this.h=ye;for(var Se=[],ke=!0,Ve=me.length-1;0<=Ve;Ve--){var He=me[Ve]|0;ke&&He==ye||(Se[Ve]=He,ke=!1)}this.g=Se}var s={};function E(me){return-128<=me&&128>me?f(me,function(ye){return new y([ye|0],0>ye?-1:0)}):new y([me|0],0>me?-1:0)}function R(me){if(isNaN(me)||!isFinite(me))return A;if(0>me)return de(R(-me));for(var ye=[],Se=1,ke=0;me>=Se;ke++)ye[ke]=me/Se|0,Se*=4294967296;return new y(ye,0)}function O(me,ye){if(me.length==0)throw Error("number format error: empty string");if(ye=ye||10,2>ye||36<ye)throw Error("radix out of range: "+ye);if(me.charAt(0)=="-")return de(O(me.substring(1),ye));if(0<=me.indexOf("-"))throw Error('number format error: interior "-" character');for(var Se=R(Math.pow(ye,8)),ke=A,Ve=0;Ve<me.length;Ve+=8){var He=Math.min(8,me.length-Ve),Oe=parseInt(me.substring(Ve,Ve+He),ye);8>He?(He=R(Math.pow(ye,He)),ke=ke.j(He).add(R(Oe))):(ke=ke.j(Se),ke=ke.add(R(Oe)))}return ke}var A=E(0),U=E(1),$=E(16777216);r=y.prototype,r.m=function(){if(Q(this))return-de(this).m();for(var me=0,ye=1,Se=0;Se<this.g.length;Se++){var ke=this.i(Se);me+=(0<=ke?ke:4294967296+ke)*ye,ye*=4294967296}return me},r.toString=function(me){if(me=me||10,2>me||36<me)throw Error("radix out of range: "+me);if(te(this))return"0";if(Q(this))return"-"+de(this).toString(me);for(var ye=R(Math.pow(me,6)),Se=this,ke="";;){var Ve=Me(Se,ye).g;Se=Ce(Se,Ve.j(ye));var He=((0<Se.g.length?Se.g[0]:Se.h)>>>0).toString(me);if(Se=Ve,te(Se))return He+ke;for(;6>He.length;)He="0"+He;ke=He+ke}},r.i=function(me){return 0>me?0:me<this.g.length?this.g[me]:this.h};function te(me){if(me.h!=0)return!1;for(var ye=0;ye<me.g.length;ye++)if(me.g[ye]!=0)return!1;return!0}function Q(me){return me.h==-1}r.l=function(me){return me=Ce(this,me),Q(me)?-1:te(me)?0:1};function de(me){for(var ye=me.g.length,Se=[],ke=0;ke<ye;ke++)Se[ke]=~me.g[ke];return new y(Se,~me.h).add(U)}r.abs=function(){return Q(this)?de(this):this},r.add=function(me){for(var ye=Math.max(this.g.length,me.g.length),Se=[],ke=0,Ve=0;Ve<=ye;Ve++){var He=ke+(this.i(Ve)&65535)+(me.i(Ve)&65535),Oe=(He>>>16)+(this.i(Ve)>>>16)+(me.i(Ve)>>>16);ke=Oe>>>16,He&=65535,Oe&=65535,Se[Ve]=Oe<<16|He}return new y(Se,Se[Se.length-1]&-2147483648?-1:0)};function Ce(me,ye){return me.add(de(ye))}r.j=function(me){if(te(this)||te(me))return A;if(Q(this))return Q(me)?de(this).j(de(me)):de(de(this).j(me));if(Q(me))return de(this.j(de(me)));if(0>this.l($)&&0>me.l($))return R(this.m()*me.m());for(var ye=this.g.length+me.g.length,Se=[],ke=0;ke<2*ye;ke++)Se[ke]=0;for(ke=0;ke<this.g.length;ke++)for(var Ve=0;Ve<me.g.length;Ve++){var He=this.i(ke)>>>16,Oe=this.i(ke)&65535,xi=me.i(Ve)>>>16,ui=me.i(Ve)&65535;Se[2*ke+2*Ve]+=Oe*ui,Fe(Se,2*ke+2*Ve),Se[2*ke+2*Ve+1]+=He*ui,Fe(Se,2*ke+2*Ve+1),Se[2*ke+2*Ve+1]+=Oe*xi,Fe(Se,2*ke+2*Ve+1),Se[2*ke+2*Ve+2]+=He*xi,Fe(Se,2*ke+2*Ve+2)}for(ke=0;ke<ye;ke++)Se[ke]=Se[2*ke+1]<<16|Se[2*ke];for(ke=ye;ke<2*ye;ke++)Se[ke]=0;return new y(Se,0)};function Fe(me,ye){for(;(me[ye]&65535)!=me[ye];)me[ye+1]+=me[ye]>>>16,me[ye]&=65535,ye++}function Le(me,ye){this.g=me,this.h=ye}function Me(me,ye){if(te(ye))throw Error("division by zero");if(te(me))return new Le(A,A);if(Q(me))return ye=Me(de(me),ye),new Le(de(ye.g),de(ye.h));if(Q(ye))return ye=Me(me,de(ye)),new Le(de(ye.g),ye.h);if(30<me.g.length){if(Q(me)||Q(ye))throw Error("slowDivide_ only works with positive integers.");for(var Se=U,ke=ye;0>=ke.l(me);)Se=at(Se),ke=at(ke);var Ve=pt(Se,1),He=pt(ke,1);for(ke=pt(ke,2),Se=pt(Se,2);!te(ke);){var Oe=He.add(ke);0>=Oe.l(me)&&(Ve=Ve.add(Se),He=Oe),ke=pt(ke,1),Se=pt(Se,1)}return ye=Ce(me,Ve.j(ye)),new Le(Ve,ye)}for(Ve=A;0<=me.l(ye);){for(Se=Math.max(1,Math.floor(me.m()/ye.m())),ke=Math.ceil(Math.log(Se)/Math.LN2),ke=48>=ke?1:Math.pow(2,ke-48),He=R(Se),Oe=He.j(ye);Q(Oe)||0<Oe.l(me);)Se-=ke,He=R(Se),Oe=He.j(ye);te(He)&&(He=U),Ve=Ve.add(He),me=Ce(me,Oe)}return new Le(Ve,me)}r.A=function(me){return Me(this,me).h},r.and=function(me){for(var ye=Math.max(this.g.length,me.g.length),Se=[],ke=0;ke<ye;ke++)Se[ke]=this.i(ke)&me.i(ke);return new y(Se,this.h&me.h)},r.or=function(me){for(var ye=Math.max(this.g.length,me.g.length),Se=[],ke=0;ke<ye;ke++)Se[ke]=this.i(ke)|me.i(ke);return new y(Se,this.h|me.h)},r.xor=function(me){for(var ye=Math.max(this.g.length,me.g.length),Se=[],ke=0;ke<ye;ke++)Se[ke]=this.i(ke)^me.i(ke);return new y(Se,this.h^me.h)};function at(me){for(var ye=me.g.length+1,Se=[],ke=0;ke<ye;ke++)Se[ke]=me.i(ke)<<1|me.i(ke-1)>>>31;return new y(Se,me.h)}function pt(me,ye){var Se=ye>>5;ye%=32;for(var ke=me.g.length-Se,Ve=[],He=0;He<ke;He++)Ve[He]=0<ye?me.i(He+Se)>>>ye|me.i(He+Se+1)<<32-ye:me.i(He+Se);return new y(Ve,me.h)}o.prototype.digest=o.prototype.v,o.prototype.reset=o.prototype.s,o.prototype.update=o.prototype.u,EV=o,y.prototype.add=y.prototype.add,y.prototype.multiply=y.prototype.j,y.prototype.modulo=y.prototype.A,y.prototype.compare=y.prototype.l,y.prototype.toNumber=y.prototype.m,y.prototype.toString=y.prototype.toString,y.prototype.getBits=y.prototype.i,y.fromNumber=R,y.fromString=O,pm=y}).apply(typeof IL<"u"?IL:typeof self<"u"?self:typeof window<"u"?window:{});var Uw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var IV,e1,SV,b2,z5,AV,CV,RV;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(k,Y,re){return k==Array.prototype||k==Object.prototype||(k[Y]=re.value),k};function t(k){k=[typeof globalThis=="object"&&globalThis,k,typeof window=="object"&&window,typeof self=="object"&&self,typeof Uw=="object"&&Uw];for(var Y=0;Y<k.length;++Y){var re=k[Y];if(re&&re.Math==Math)return re}throw Error("Cannot find global object")}var o=t(this);function c(k,Y){if(Y)e:{var re=o;k=k.split(".");for(var Ae=0;Ae<k.length-1;Ae++){var _t=k[Ae];if(!(_t in re))break e;re=re[_t]}k=k[k.length-1],Ae=re[k],Y=Y(Ae),Y!=Ae&&Y!=null&&e(re,k,{configurable:!0,writable:!0,value:Y})}}function f(k,Y){k instanceof String&&(k+="");var re=0,Ae=!1,_t={next:function(){if(!Ae&&re<k.length){var zt=re++;return{value:Y(zt,k[zt]),done:!1}}return Ae=!0,{done:!0,value:void 0}}};return _t[Symbol.iterator]=function(){return _t},_t}c("Array.prototype.values",function(k){return k||function(){return f(this,function(Y,re){return re})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var y=y||{},s=this||self;function E(k){var Y=typeof k;return Y=Y!="object"?Y:k?Array.isArray(k)?"array":Y:"null",Y=="array"||Y=="object"&&typeof k.length=="number"}function R(k){var Y=typeof k;return Y=="object"&&k!=null||Y=="function"}function O(k,Y,re){return k.call.apply(k.bind,arguments)}function A(k,Y,re){if(!k)throw Error();if(2<arguments.length){var Ae=Array.prototype.slice.call(arguments,2);return function(){var _t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(_t,Ae),k.apply(Y,_t)}}return function(){return k.apply(Y,arguments)}}function U(k,Y,re){return U=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?O:A,U.apply(null,arguments)}function $(k,Y){var re=Array.prototype.slice.call(arguments,1);return function(){var Ae=re.slice();return Ae.push.apply(Ae,arguments),k.apply(this,Ae)}}function te(k,Y){function re(){}re.prototype=Y.prototype,k.aa=Y.prototype,k.prototype=new re,k.prototype.constructor=k,k.Qb=function(Ae,_t,zt){for(var _i=Array(arguments.length-2),is=2;is<arguments.length;is++)_i[is-2]=arguments[is];return Y.prototype[_t].apply(Ae,_i)}}function Q(k){const Y=k.length;if(0<Y){const re=Array(Y);for(let Ae=0;Ae<Y;Ae++)re[Ae]=k[Ae];return re}return[]}function de(k,Y){for(let re=1;re<arguments.length;re++){const Ae=arguments[re];if(E(Ae)){const _t=k.length||0,zt=Ae.length||0;k.length=_t+zt;for(let _i=0;_i<zt;_i++)k[_t+_i]=Ae[_i]}else k.push(Ae)}}class Ce{constructor(Y,re){this.i=Y,this.j=re,this.h=0,this.g=null}get(){let Y;return 0<this.h?(this.h--,Y=this.g,this.g=Y.next,Y.next=null):Y=this.i(),Y}}function Fe(k){return/^[\s\xa0]*$/.test(k)}function Le(){var k=s.navigator;return k&&(k=k.userAgent)?k:""}function Me(k){return Me[" "](k),k}Me[" "]=function(){};var at=Le().indexOf("Gecko")!=-1&&!(Le().toLowerCase().indexOf("webkit")!=-1&&Le().indexOf("Edge")==-1)&&!(Le().indexOf("Trident")!=-1||Le().indexOf("MSIE")!=-1)&&Le().indexOf("Edge")==-1;function pt(k,Y,re){for(const Ae in k)Y.call(re,k[Ae],Ae,k)}function me(k,Y){for(const re in k)Y.call(void 0,k[re],re,k)}function ye(k){const Y={};for(const re in k)Y[re]=k[re];return Y}const Se="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ke(k,Y){let re,Ae;for(let _t=1;_t<arguments.length;_t++){Ae=arguments[_t];for(re in Ae)k[re]=Ae[re];for(let zt=0;zt<Se.length;zt++)re=Se[zt],Object.prototype.hasOwnProperty.call(Ae,re)&&(k[re]=Ae[re])}}function Ve(k){var Y=1;k=k.split(":");const re=[];for(;0<Y&&k.length;)re.push(k.shift()),Y--;return k.length&&re.push(k.join(":")),re}function He(k){s.setTimeout(()=>{throw k},0)}function Oe(){var k=ir;let Y=null;return k.g&&(Y=k.g,k.g=k.g.next,k.g||(k.h=null),Y.next=null),Y}class xi{constructor(){this.h=this.g=null}add(Y,re){const Ae=ui.get();Ae.set(Y,re),this.h?this.h.next=Ae:this.g=Ae,this.h=Ae}}var ui=new Ce(()=>new ti,k=>k.reset());class ti{constructor(){this.next=this.g=this.h=null}set(Y,re){this.h=Y,this.g=re,this.next=null}reset(){this.next=this.g=this.h=null}}let ri,Si=!1,ir=new xi,st=()=>{const k=s.Promise.resolve(void 0);ri=()=>{k.then(wi)}};var wi=()=>{for(var k;k=Oe();){try{k.h.call(k.g)}catch(re){He(re)}var Y=ui;Y.j(k),100>Y.h&&(Y.h++,k.next=Y.g,Y.g=k)}Si=!1};function ji(){this.s=this.s,this.C=this.C}ji.prototype.s=!1,ji.prototype.ma=function(){this.s||(this.s=!0,this.N())},ji.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ar(k,Y){this.type=k,this.g=this.target=Y,this.defaultPrevented=!1}Ar.prototype.h=function(){this.defaultPrevented=!0};var Br=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var k=!1,Y=Object.defineProperty({},"passive",{get:function(){k=!0}});try{const re=()=>{};s.addEventListener("test",re,Y),s.removeEventListener("test",re,Y)}catch{}return k}();function Vr(k,Y){if(Ar.call(this,k?k.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,k){var re=this.type=k.type,Ae=k.changedTouches&&k.changedTouches.length?k.changedTouches[0]:null;if(this.target=k.target||k.srcElement,this.g=Y,Y=k.relatedTarget){if(at){e:{try{Me(Y.nodeName);var _t=!0;break e}catch{}_t=!1}_t||(Y=null)}}else re=="mouseover"?Y=k.fromElement:re=="mouseout"&&(Y=k.toElement);this.relatedTarget=Y,Ae?(this.clientX=Ae.clientX!==void 0?Ae.clientX:Ae.pageX,this.clientY=Ae.clientY!==void 0?Ae.clientY:Ae.pageY,this.screenX=Ae.screenX||0,this.screenY=Ae.screenY||0):(this.clientX=k.clientX!==void 0?k.clientX:k.pageX,this.clientY=k.clientY!==void 0?k.clientY:k.pageY,this.screenX=k.screenX||0,this.screenY=k.screenY||0),this.button=k.button,this.key=k.key||"",this.ctrlKey=k.ctrlKey,this.altKey=k.altKey,this.shiftKey=k.shiftKey,this.metaKey=k.metaKey,this.pointerId=k.pointerId||0,this.pointerType=typeof k.pointerType=="string"?k.pointerType:Ni[k.pointerType]||"",this.state=k.state,this.i=k,k.defaultPrevented&&Vr.aa.h.call(this)}}te(Vr,Ar);var Ni={2:"touch",3:"pen",4:"mouse"};Vr.prototype.h=function(){Vr.aa.h.call(this);var k=this.i;k.preventDefault?k.preventDefault():k.returnValue=!1};var vt="closure_listenable_"+(1e6*Math.random()|0),Wt=0;function Xt(k,Y,re,Ae,_t){this.listener=k,this.proxy=null,this.src=Y,this.type=re,this.capture=!!Ae,this.ha=_t,this.key=++Wt,this.da=this.fa=!1}function ai(k){k.da=!0,k.listener=null,k.proxy=null,k.src=null,k.ha=null}function nr(k){this.src=k,this.g={},this.h=0}nr.prototype.add=function(k,Y,re,Ae,_t){var zt=k.toString();k=this.g[zt],k||(k=this.g[zt]=[],this.h++);var _i=Ge(k,Y,Ae,_t);return-1<_i?(Y=k[_i],re||(Y.fa=!1)):(Y=new Xt(Y,this.src,zt,!!Ae,_t),Y.fa=re,k.push(Y)),Y};function Be(k,Y){var re=Y.type;if(re in k.g){var Ae=k.g[re],_t=Array.prototype.indexOf.call(Ae,Y,void 0),zt;(zt=0<=_t)&&Array.prototype.splice.call(Ae,_t,1),zt&&(ai(Y),k.g[re].length==0&&(delete k.g[re],k.h--))}}function Ge(k,Y,re,Ae){for(var _t=0;_t<k.length;++_t){var zt=k[_t];if(!zt.da&&zt.listener==Y&&zt.capture==!!re&&zt.ha==Ae)return _t}return-1}var Qe="closure_lm_"+(1e6*Math.random()|0),ht={};function Et(k,Y,re,Ae,_t){if(Array.isArray(Y)){for(var zt=0;zt<Y.length;zt++)Et(k,Y[zt],re,Ae,_t);return null}return re=Ci(re),k&&k[vt]?k.K(Y,re,R(Ae)?!!Ae.capture:!1,_t):Ue(k,Y,re,!1,Ae,_t)}function Ue(k,Y,re,Ae,_t,zt){if(!Y)throw Error("Invalid event type");var _i=R(_t)?!!_t.capture:!!_t,is=ni(k);if(is||(k[Qe]=is=new nr(k)),re=is.add(Y,re,Ae,_i,zt),re.proxy)return re;if(Ae=ii(),re.proxy=Ae,Ae.src=k,Ae.listener=re,k.addEventListener)Br||(_t=_i),_t===void 0&&(_t=!1),k.addEventListener(Y.toString(),Ae,_t);else if(k.attachEvent)k.attachEvent(Lt(Y.toString()),Ae);else if(k.addListener&&k.removeListener)k.addListener(Ae);else throw Error("addEventListener and attachEvent are unavailable.");return re}function ii(){function k(re){return Y.call(k.src,k.listener,re)}const Y=Ai;return k}function Ht(k,Y,re,Ae,_t){if(Array.isArray(Y))for(var zt=0;zt<Y.length;zt++)Ht(k,Y[zt],re,Ae,_t);else Ae=R(Ae)?!!Ae.capture:!!Ae,re=Ci(re),k&&k[vt]?(k=k.i,Y=String(Y).toString(),Y in k.g&&(zt=k.g[Y],re=Ge(zt,re,Ae,_t),-1<re&&(ai(zt[re]),Array.prototype.splice.call(zt,re,1),zt.length==0&&(delete k.g[Y],k.h--)))):k&&(k=ni(k))&&(Y=k.g[Y.toString()],k=-1,Y&&(k=Ge(Y,re,Ae,_t)),(re=-1<k?Y[k]:null)&&Jt(re))}function Jt(k){if(typeof k!="number"&&k&&!k.da){var Y=k.src;if(Y&&Y[vt])Be(Y.i,k);else{var re=k.type,Ae=k.proxy;Y.removeEventListener?Y.removeEventListener(re,Ae,k.capture):Y.detachEvent?Y.detachEvent(Lt(re),Ae):Y.addListener&&Y.removeListener&&Y.removeListener(Ae),(re=ni(Y))?(Be(re,k),re.h==0&&(re.src=null,Y[Qe]=null)):ai(k)}}}function Lt(k){return k in ht?ht[k]:ht[k]="on"+k}function Ai(k,Y){if(k.da)k=!0;else{Y=new Vr(Y,this);var re=k.listener,Ae=k.ha||k.src;k.fa&&Jt(k),k=re.call(Ae,Y)}return k}function ni(k){return k=k[Qe],k instanceof nr?k:null}var bi="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ci(k){return typeof k=="function"?k:(k[bi]||(k[bi]=function(Y){return k.handleEvent(Y)}),k[bi])}function Ti(){ji.call(this),this.i=new nr(this),this.M=this,this.F=null}te(Ti,ji),Ti.prototype[vt]=!0,Ti.prototype.removeEventListener=function(k,Y,re,Ae){Ht(this,k,Y,re,Ae)};function Ei(k,Y){var re,Ae=k.F;if(Ae)for(re=[];Ae;Ae=Ae.F)re.push(Ae);if(k=k.M,Ae=Y.type||Y,typeof Y=="string")Y=new Ar(Y,k);else if(Y instanceof Ar)Y.target=Y.target||k;else{var _t=Y;Y=new Ar(Ae,k),ke(Y,_t)}if(_t=!0,re)for(var zt=re.length-1;0<=zt;zt--){var _i=Y.g=re[zt];_t=hr(_i,Ae,!0,Y)&&_t}if(_i=Y.g=k,_t=hr(_i,Ae,!0,Y)&&_t,_t=hr(_i,Ae,!1,Y)&&_t,re)for(zt=0;zt<re.length;zt++)_i=Y.g=re[zt],_t=hr(_i,Ae,!1,Y)&&_t}Ti.prototype.N=function(){if(Ti.aa.N.call(this),this.i){var k=this.i,Y;for(Y in k.g){for(var re=k.g[Y],Ae=0;Ae<re.length;Ae++)ai(re[Ae]);delete k.g[Y],k.h--}}this.F=null},Ti.prototype.K=function(k,Y,re,Ae){return this.i.add(String(k),Y,!1,re,Ae)},Ti.prototype.L=function(k,Y,re,Ae){return this.i.add(String(k),Y,!0,re,Ae)};function hr(k,Y,re,Ae){if(Y=k.i.g[String(Y)],!Y)return!0;Y=Y.concat();for(var _t=!0,zt=0;zt<Y.length;++zt){var _i=Y[zt];if(_i&&!_i.da&&_i.capture==re){var is=_i.listener,ks=_i.ha||_i.src;_i.fa&&Be(k.i,_i),_t=is.call(ks,Ae)!==!1&&_t}}return _t&&!Ae.defaultPrevented}function wr(k,Y,re){if(typeof k=="function")re&&(k=U(k,re));else if(k&&typeof k.handleEvent=="function")k=U(k.handleEvent,k);else throw Error("Invalid listener argument");return 2147483647<Number(Y)?-1:s.setTimeout(k,Y||0)}function on(k){k.g=wr(()=>{k.g=null,k.i&&(k.i=!1,on(k))},k.l);const Y=k.h;k.h=null,k.m.apply(null,Y)}class Jr extends ji{constructor(Y,re){super(),this.m=Y,this.l=re,this.h=null,this.i=!1,this.g=null}j(Y){this.h=arguments,this.g?this.i=!0:on(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function _r(k){ji.call(this),this.h=k,this.g={}}te(_r,ji);var Es=[];function es(k){pt(k.g,function(Y,re){this.g.hasOwnProperty(re)&&Jt(Y)},k),k.g={}}_r.prototype.N=function(){_r.aa.N.call(this),es(this)},_r.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var xn=s.JSON.stringify,ss=s.JSON.parse,Qs=class{stringify(k){return s.JSON.stringify(k,void 0)}parse(k){return s.JSON.parse(k,void 0)}};function jr(){}jr.prototype.h=null;function dr(k){return k.h||(k.h=k.i())}function $o(){}var Is={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function gs(){Ar.call(this,"d")}te(gs,Ar);function eo(){Ar.call(this,"c")}te(eo,Ar);var to={},Ta=null;function xt(){return Ta=Ta||new Ti}to.La="serverreachability";function xo(k){Ar.call(this,to.La,k)}te(xo,Ar);function Cr(k){const Y=xt();Ei(Y,new xo(Y))}to.STAT_EVENT="statevent";function gr(k,Y){Ar.call(this,to.STAT_EVENT,k),this.stat=Y}te(gr,Ar);function Pe(k){const Y=xt();Ei(Y,new gr(Y,k))}to.Ma="timingevent";function q(k,Y){Ar.call(this,to.Ma,k),this.size=Y}te(q,Ar);function J(k,Y){if(typeof k!="function")throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){k()},Y)}function oe(){this.g=!0}oe.prototype.xa=function(){this.g=!1};function Te(k,Y,re,Ae,_t,zt){k.info(function(){if(k.g)if(zt)for(var _i="",is=zt.split("&"),ks=0;ks<is.length;ks++){var Er=is[ks].split("=");if(1<Er.length){var qn=Er[0];Er=Er[1];var Di=qn.split("_");_i=2<=Di.length&&Di[1]=="type"?_i+(qn+"="+Er+"&"):_i+(qn+"=redacted&")}}else _i=null;else _i=zt;return"XMLHTTP REQ ("+Ae+") [attempt "+_t+"]: "+Y+`
`+re+`
`+_i})}function be(k,Y,re,Ae,_t,zt,_i){k.info(function(){return"XMLHTTP RESP ("+Ae+") [ attempt "+_t+"]: "+Y+`
`+re+`
`+zt+" "+_i})}function fe(k,Y,re,Ae){k.info(function(){return"XMLHTTP TEXT ("+Y+"): "+ze(k,re)+(Ae?" "+Ae:"")})}function Ke(k,Y){k.info(function(){return"TIMEOUT: "+Y})}oe.prototype.info=function(){};function ze(k,Y){if(!k.g)return Y;if(!Y)return null;try{var re=JSON.parse(Y);if(re){for(k=0;k<re.length;k++)if(Array.isArray(re[k])){var Ae=re[k];if(!(2>Ae.length)){var _t=Ae[1];if(Array.isArray(_t)&&!(1>_t.length)){var zt=_t[0];if(zt!="noop"&&zt!="stop"&&zt!="close")for(var _i=1;_i<_t.length;_i++)_t[_i]=""}}}}return xn(re)}catch{return Y}}var Ze={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},yt={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},lt;function Kt(){}te(Kt,jr),Kt.prototype.g=function(){return new XMLHttpRequest},Kt.prototype.i=function(){return{}},lt=new Kt;function Qt(k,Y,re,Ae){this.j=k,this.i=Y,this.l=re,this.R=Ae||1,this.U=new _r(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ii}function Ii(){this.i=null,this.g="",this.h=!1}var Xi={},Oi={};function $i(k,Y,re){k.L=1,k.v=Go(Ya(Y)),k.m=re,k.P=!0,yr(k,null)}function yr(k,Y){k.F=Date.now(),qr(k),k.A=Ya(k.v);var re=k.A,Ae=k.R;Array.isArray(Ae)||(Ae=[String(Ae)]),Sh(re.i,"t",Ae),k.C=0,re=k.j.J,k.h=new Ii,k.g=Bl(k.j,re?Y:null,!k.m),0<k.O&&(k.M=new Jr(U(k.Y,k,k.g),k.O)),Y=k.U,re=k.g,Ae=k.ca;var _t="readystatechange";Array.isArray(_t)||(_t&&(Es[0]=_t.toString()),_t=Es);for(var zt=0;zt<_t.length;zt++){var _i=Et(re,_t[zt],Ae||Y.handleEvent,!1,Y.h||Y);if(!_i)break;Y.g[_i.key]=_i}Y=k.H?ye(k.H):{},k.m?(k.u||(k.u="POST"),Y["Content-Type"]="application/x-www-form-urlencoded",k.g.ea(k.A,k.u,k.m,Y)):(k.u="GET",k.g.ea(k.A,k.u,null,Y)),Cr(),Te(k.i,k.u,k.A,k.l,k.R,k.m)}Qt.prototype.ca=function(k){k=k.target;const Y=this.M;Y&&Vs(k)==3?Y.j():this.Y(k)},Qt.prototype.Y=function(k){try{if(k==this.g)e:{const Di=Vs(this.g);var Y=this.g.Ba();const Gt=this.g.Z();if(!(3>Di)&&(Di!=3||this.g&&(this.h.h||this.g.oa()||mc(this.g)))){this.J||Di!=4||Y==7||(Y==8||0>=Gt?Cr(3):Cr(2)),Tr(this);var re=this.g.Z();this.X=re;t:if(Ji(this)){var Ae=mc(this.g);k="";var _t=Ae.length,zt=Vs(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){un(this),br(this);var _i="";break t}this.h.i=new s.TextDecoder}for(Y=0;Y<_t;Y++)this.h.h=!0,k+=this.h.i.decode(Ae[Y],{stream:!(zt&&Y==_t-1)});Ae.length=0,this.h.g+=k,this.C=0,_i=this.h.g}else _i=this.g.oa();if(this.o=re==200,be(this.i,this.u,this.A,this.l,this.R,Di,re),this.o){if(this.T&&!this.K){t:{if(this.g){var is,ks=this.g;if((is=ks.g?ks.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Fe(is)){var Er=is;break t}}Er=null}if(re=Er)fe(this.i,this.l,re,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,fn(this,re);else{this.o=!1,this.s=3,Pe(12),un(this),br(this);break e}}if(this.P){re=!0;let Oo;for(;!this.J&&this.C<_i.length;)if(Oo=In(this,_i),Oo==Oi){Di==4&&(this.s=4,Pe(14),re=!1),fe(this.i,this.l,null,"[Incomplete Response]");break}else if(Oo==Xi){this.s=4,Pe(15),fe(this.i,this.l,_i,"[Invalid Chunk]"),re=!1;break}else fe(this.i,this.l,Oo,null),fn(this,Oo);if(Ji(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Di!=4||_i.length!=0||this.h.h||(this.s=1,Pe(16),re=!1),this.o=this.o&&re,!re)fe(this.i,this.l,_i,"[Invalid Chunked Response]"),un(this),br(this);else if(0<_i.length&&!this.W){this.W=!0;var qn=this.j;qn.g==this&&qn.ba&&!qn.M&&(qn.j.info("Great, no buffering proxy detected. Bytes received: "+_i.length),Sa(qn),qn.M=!0,Pe(11))}}else fe(this.i,this.l,_i,null),fn(this,_i);Di==4&&un(this),this.o&&!this.J&&(Di==4?Gr(this.j,this):(this.o=!1,qr(this)))}else la(this.g),re==400&&0<_i.indexOf("Unknown SID")?(this.s=3,Pe(12)):(this.s=0,Pe(13)),un(this),br(this)}}}catch{}finally{}};function Ji(k){return k.g?k.u=="GET"&&k.L!=2&&k.j.Ca:!1}function In(k,Y){var re=k.C,Ae=Y.indexOf(`
`,re);return Ae==-1?Oi:(re=Number(Y.substring(re,Ae)),isNaN(re)?Xi:(Ae+=1,Ae+re>Y.length?Oi:(Y=Y.slice(Ae,Ae+re),k.C=Ae+re,Y)))}Qt.prototype.cancel=function(){this.J=!0,un(this)};function qr(k){k.S=Date.now()+k.I,$r(k,k.I)}function $r(k,Y){if(k.B!=null)throw Error("WatchDog timer not null");k.B=J(U(k.ba,k),Y)}function Tr(k){k.B&&(s.clearTimeout(k.B),k.B=null)}Qt.prototype.ba=function(){this.B=null;const k=Date.now();0<=k-this.S?(Ke(this.i,this.A),this.L!=2&&(Cr(),Pe(17)),un(this),this.s=2,br(this)):$r(this,this.S-k)};function br(k){k.j.G==0||k.J||Gr(k.j,k)}function un(k){Tr(k);var Y=k.M;Y&&typeof Y.ma=="function"&&Y.ma(),k.M=null,es(k.U),k.g&&(Y=k.g,k.g=null,Y.abort(),Y.ma())}function fn(k,Y){try{var re=k.j;if(re.G!=0&&(re.g==k||Za(re.h,k))){if(!k.K&&Za(re.h,k)&&re.G==3){try{var Ae=re.Da.g.parse(Y)}catch{Ae=null}if(Array.isArray(Ae)&&Ae.length==3){var _t=Ae;if(_t[0]==0){e:if(!re.u){if(re.g)if(re.g.F+3e3<k.F)kr(re),Mr(re);else break e;Su(re),Pe(18)}}else re.za=_t[1],0<re.za-re.T&&37500>_t[2]&&re.F&&re.v==0&&!re.C&&(re.C=J(U(re.Za,re),6e3));if(1>=Ss(re.h)&&re.ca){try{re.ca()}catch{}re.ca=void 0}}else ca(re,11)}else if((k.K||re.g==k)&&kr(re),!Fe(Y))for(_t=re.Da.g.parse(Y),Y=0;Y<_t.length;Y++){let Er=_t[Y];if(re.T=Er[0],Er=Er[1],re.G==2)if(Er[0]=="c"){re.K=Er[1],re.ia=Er[2];const qn=Er[3];qn!=null&&(re.la=qn,re.j.info("VER="+re.la));const Di=Er[4];Di!=null&&(re.Aa=Di,re.j.info("SVER="+re.Aa));const Gt=Er[5];Gt!=null&&typeof Gt=="number"&&0<Gt&&(Ae=1.5*Gt,re.L=Ae,re.j.info("backChannelRequestTimeoutMs_="+Ae)),Ae=re;const Oo=k.g;if(Oo){const Pi=Oo.g?Oo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Pi){var zt=Ae.h;zt.g||Pi.indexOf("spdy")==-1&&Pi.indexOf("quic")==-1&&Pi.indexOf("h2")==-1||(zt.j=zt.l,zt.g=new Set,zt.h&&(io(zt,zt.h),zt.h=null))}if(Ae.D){const Vl=Oo.g?Oo.g.getResponseHeader("X-HTTP-Session-Id"):null;Vl&&(Ae.ya=Vl,pn(Ae.I,Ae.D,Vl))}}re.G=3,re.l&&re.l.ua(),re.ba&&(re.R=Date.now()-k.F,re.j.info("Handshake RTT: "+re.R+"ms")),Ae=re;var _i=k;if(Ae.qa=Lh(Ae,Ae.J?Ae.ia:null,Ae.W),_i.K){$c(Ae.h,_i);var is=_i,ks=Ae.L;ks&&(is.I=ks),is.B&&(Tr(is),qr(is)),Ae.g=_i}else Ia(Ae);0<re.i.length&&Dh(re)}else Er[0]!="stop"&&Er[0]!="close"||ca(re,7);else re.G==3&&(Er[0]=="stop"||Er[0]=="close"?Er[0]=="stop"?ca(re,7):kh(re):Er[0]!="noop"&&re.l&&re.l.ta(Er),re.v=0)}}Cr(4)}catch{}}var Fr=class{constructor(k,Y){this.g=k,this.map=Y}};function cs(k){this.l=k||10,s.PerformanceNavigationTiming?(k=s.performance.getEntriesByType("navigation"),k=0<k.length&&(k[0].nextHopProtocol=="hq"||k[0].nextHopProtocol=="h2")):k=!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=k?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ms(k){return k.h?!0:k.g?k.g.size>=k.j:!1}function Ss(k){return k.h?1:k.g?k.g.size:0}function Za(k,Y){return k.h?k.h==Y:k.g?k.g.has(Y):!1}function io(k,Y){k.g?k.g.add(Y):k.h=Y}function $c(k,Y){k.h&&k.h==Y?k.h=null:k.g&&k.g.has(Y)&&k.g.delete(Y)}cs.prototype.cancel=function(){if(this.i=fp(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const k of this.g.values())k.cancel();this.g.clear()}};function fp(k){if(k.h!=null)return k.i.concat(k.h.D);if(k.g!=null&&k.g.size!==0){let Y=k.i;for(const re of k.g.values())Y=Y.concat(re.D);return Y}return Q(k.i)}function uc(k){if(k.V&&typeof k.V=="function")return k.V();if(typeof Map<"u"&&k instanceof Map||typeof Set<"u"&&k instanceof Set)return Array.from(k.values());if(typeof k=="string")return k.split("");if(E(k)){for(var Y=[],re=k.length,Ae=0;Ae<re;Ae++)Y.push(k[Ae]);return Y}Y=[],re=0;for(Ae in k)Y[re++]=k[Ae];return Y}function bu(k){if(k.na&&typeof k.na=="function")return k.na();if(!k.V||typeof k.V!="function"){if(typeof Map<"u"&&k instanceof Map)return Array.from(k.keys());if(!(typeof Set<"u"&&k instanceof Set)){if(E(k)||typeof k=="string"){var Y=[];k=k.length;for(var re=0;re<k;re++)Y.push(re);return Y}Y=[],re=0;for(const Ae in k)Y[re++]=Ae;return Y}}}function wu(k,Y){if(k.forEach&&typeof k.forEach=="function")k.forEach(Y,void 0);else if(E(k)||typeof k=="string")Array.prototype.forEach.call(k,Y,void 0);else for(var re=bu(k),Ae=uc(k),_t=Ae.length,zt=0;zt<_t;zt++)Y.call(void 0,Ae[zt],re&&re[zt],k)}var Tu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function hc(k,Y){if(k){k=k.split("&");for(var re=0;re<k.length;re++){var Ae=k[re].indexOf("="),_t=null;if(0<=Ae){var zt=k[re].substring(0,Ae);_t=k[re].substring(Ae+1)}else zt=k[re];Y(zt,_t?decodeURIComponent(_t.replace(/\+/g," ")):"")}}}function Ka(k){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,k instanceof Ka){this.h=k.h,sa(this,k.j),this.o=k.o,this.g=k.g,Eu(this,k.s),this.l=k.l;var Y=k.i,re=new Fl;re.i=Y.i,Y.g&&(re.g=new Map(Y.g),re.h=Y.h),Th(this,re),this.m=k.m}else k&&(Y=String(k).match(Tu))?(this.h=!1,sa(this,Y[1]||"",!0),this.o=oa(Y[2]||""),this.g=oa(Y[3]||"",!0),Eu(this,Y[4]),this.l=oa(Y[5]||"",!0),Th(this,Y[6]||"",!0),this.m=oa(Y[7]||"")):(this.h=!1,this.i=new Fl(null,this.h))}Ka.prototype.toString=function(){var k=[],Y=this.j;Y&&k.push(Do(Y,dc,!0),":");var re=this.g;return(re||Y=="file")&&(k.push("//"),(Y=this.o)&&k.push(Do(Y,dc,!0),"@"),k.push(encodeURIComponent(String(re)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),re=this.s,re!=null&&k.push(":",String(re))),(re=this.l)&&(this.g&&re.charAt(0)!="/"&&k.push("/"),k.push(Do(re,re.charAt(0)=="/"?Eh:pp,!0))),(re=this.i.toString())&&k.push("?",re),(re=this.m)&&k.push("#",Do(re,Ih)),k.join("")};function Ya(k){return new Ka(k)}function sa(k,Y,re){k.j=re?oa(Y,!0):Y,k.j&&(k.j=k.j.replace(/:$/,""))}function Eu(k,Y){if(Y){if(Y=Number(Y),isNaN(Y)||0>Y)throw Error("Bad port number "+Y);k.s=Y}else k.s=null}function Th(k,Y,re){Y instanceof Fl?(k.i=Y,Bd(k.i,k.h)):(re||(Y=Do(Y,fc)),k.i=new Fl(Y,k.h))}function pn(k,Y,re){k.i.set(Y,re)}function Go(k){return pn(k,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),k}function oa(k,Y){return k?Y?decodeURI(k.replace(/%25/g,"%2525")):decodeURIComponent(k):""}function Do(k,Y,re){return typeof k=="string"?(k=encodeURI(k).replace(Y,bo),re&&(k=k.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),k):null}function bo(k){return k=k.charCodeAt(0),"%"+(k>>4&15).toString(16)+(k&15).toString(16)}var dc=/[#\/\?@]/g,pp=/[#\?:]/g,Eh=/[#\?]/g,fc=/[#\?@]/g,Ih=/#/g;function Fl(k,Y){this.h=this.g=null,this.i=k||null,this.j=!!Y}function aa(k){k.g||(k.g=new Map,k.h=0,k.i&&hc(k.i,function(Y,re){k.add(decodeURIComponent(Y.replace(/\+/g," ")),re)}))}r=Fl.prototype,r.add=function(k,Y){aa(this),this.i=null,k=Ja(this,k);var re=this.g.get(k);return re||this.g.set(k,re=[]),re.push(Y),this.h+=1,this};function Ho(k,Y){aa(k),Y=Ja(k,Y),k.g.has(Y)&&(k.i=null,k.h-=k.g.get(Y).length,k.g.delete(Y))}function Nd(k,Y){return aa(k),Y=Ja(k,Y),k.g.has(Y)}r.forEach=function(k,Y){aa(this),this.g.forEach(function(re,Ae){re.forEach(function(_t){k.call(Y,_t,Ae,this)},this)},this)},r.na=function(){aa(this);const k=Array.from(this.g.values()),Y=Array.from(this.g.keys()),re=[];for(let Ae=0;Ae<Y.length;Ae++){const _t=k[Ae];for(let zt=0;zt<_t.length;zt++)re.push(Y[Ae])}return re},r.V=function(k){aa(this);let Y=[];if(typeof k=="string")Nd(this,k)&&(Y=Y.concat(this.g.get(Ja(this,k))));else{k=Array.from(this.g.values());for(let re=0;re<k.length;re++)Y=Y.concat(k[re])}return Y},r.set=function(k,Y){return aa(this),this.i=null,k=Ja(this,k),Nd(this,k)&&(this.h-=this.g.get(k).length),this.g.set(k,[Y]),this.h+=1,this},r.get=function(k,Y){return k?(k=this.V(k),0<k.length?String(k[0]):Y):Y};function Sh(k,Y,re){Ho(k,Y),0<re.length&&(k.i=null,k.g.set(Ja(k,Y),Q(re)),k.h+=re.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const k=[],Y=Array.from(this.g.keys());for(var re=0;re<Y.length;re++){var Ae=Y[re];const zt=encodeURIComponent(String(Ae)),_i=this.V(Ae);for(Ae=0;Ae<_i.length;Ae++){var _t=zt;_i[Ae]!==""&&(_t+="="+encodeURIComponent(String(_i[Ae]))),k.push(_t)}}return this.i=k.join("&")};function Ja(k,Y){return Y=String(Y),k.j&&(Y=Y.toLowerCase()),Y}function Bd(k,Y){Y&&!k.j&&(aa(k),k.i=null,k.g.forEach(function(re,Ae){var _t=Ae.toLowerCase();Ae!=_t&&(Ho(this,Ae),Sh(this,_t,re))},k)),k.j=Y}function mp(k,Y){const re=new oe;if(s.Image){const Ae=new Image;Ae.onload=$(fr,re,"TestLoadImage: loaded",!0,Y,Ae),Ae.onerror=$(fr,re,"TestLoadImage: error",!1,Y,Ae),Ae.onabort=$(fr,re,"TestLoadImage: abort",!1,Y,Ae),Ae.ontimeout=$(fr,re,"TestLoadImage: timeout",!1,Y,Ae),s.setTimeout(function(){Ae.ontimeout&&Ae.ontimeout()},1e4),Ae.src=k}else Y(!1)}function Vd(k,Y){const re=new oe,Ae=new AbortController,_t=setTimeout(()=>{Ae.abort(),fr(re,"TestPingServer: timeout",!1,Y)},1e4);fetch(k,{signal:Ae.signal}).then(zt=>{clearTimeout(_t),zt.ok?fr(re,"TestPingServer: ok",!0,Y):fr(re,"TestPingServer: server error",!1,Y)}).catch(()=>{clearTimeout(_t),fr(re,"TestPingServer: error",!1,Y)})}function fr(k,Y,re,Ae,_t){try{_t&&(_t.onload=null,_t.onerror=null,_t.onabort=null,_t.ontimeout=null),Ae(re)}catch{}}function Iu(){this.g=new Qs}function Jm(k,Y,re){const Ae=re||"";try{wu(k,function(_t,zt){let _i=_t;R(_t)&&(_i=xn(_t)),Y.push(Ae+zt+"="+encodeURIComponent(_i))})}catch(_t){throw Y.push(Ae+"type="+encodeURIComponent("_badmap")),_t}}function Ah(k){this.l=k.Ub||null,this.j=k.eb||!1}te(Ah,jr),Ah.prototype.g=function(){return new Gc(this.l,this.j)},Ah.prototype.i=function(k){return function(){return k}}({});function Gc(k,Y){Ti.call(this),this.D=k,this.o=Y,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}te(Gc,Ti),r=Gc.prototype,r.open=function(k,Y){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=k,this.A=Y,this.readyState=1,Nl(this)},r.send=function(k){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const Y={headers:this.u,method:this.B,credentials:this.m,cache:void 0};k&&(Y.body=k),(this.D||s).fetch(new Request(this.A,Y)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,bl(this)),this.readyState=0},r.Sa=function(k){if(this.g&&(this.l=k,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=k.headers,this.readyState=2,Nl(this)),this.g&&(this.readyState=3,Nl(this),this.g)))if(this.responseType==="arraybuffer")k.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof s.ReadableStream<"u"&&"body"in k){if(this.j=k.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;zl(this)}else k.text().then(this.Ra.bind(this),this.ga.bind(this))};function zl(k){k.j.read().then(k.Pa.bind(k)).catch(k.ga.bind(k))}r.Pa=function(k){if(this.g){if(this.o&&k.value)this.response.push(k.value);else if(!this.o){var Y=k.value?k.value:new Uint8Array(0);(Y=this.v.decode(Y,{stream:!k.done}))&&(this.response=this.responseText+=Y)}k.done?bl(this):Nl(this),this.readyState==3&&zl(this)}},r.Ra=function(k){this.g&&(this.response=this.responseText=k,bl(this))},r.Qa=function(k){this.g&&(this.response=k,bl(this))},r.ga=function(){this.g&&bl(this)};function bl(k){k.readyState=4,k.l=null,k.j=null,k.v=null,Nl(k)}r.setRequestHeader=function(k,Y){this.u.append(k,Y)},r.getResponseHeader=function(k){return this.h&&this.h.get(k.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const k=[],Y=this.h.entries();for(var re=Y.next();!re.done;)re=re.value,k.push(re[0]+": "+re[1]),re=Y.next();return k.join(`\r
`)};function Nl(k){k.onreadystatechange&&k.onreadystatechange.call(k)}Object.defineProperty(Gc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(k){this.m=k?"include":"same-origin"}});function Ch(k){let Y="";return pt(k,function(re,Ae){Y+=Ae,Y+=":",Y+=re,Y+=`\r
`}),Y}function Ud(k,Y,re){e:{for(Ae in re){var Ae=!1;break e}Ae=!0}Ae||(re=Ch(re),typeof k=="string"?re!=null&&encodeURIComponent(String(re)):pn(k,Y,re))}function ts(k){Ti.call(this),this.headers=new Map,this.o=k||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}te(ts,Ti);var Qm=/^https?$/i,_p=["POST","PUT"];r=ts.prototype,r.Ha=function(k){this.J=k},r.ea=function(k,Y,re,Ae){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+k);Y=Y?Y.toUpperCase():"GET",this.D=k,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():lt.g(),this.v=this.o?dr(this.o):dr(lt),this.g.onreadystatechange=U(this.Ea,this);try{this.B=!0,this.g.open(Y,String(k),!0),this.B=!1}catch(zt){Hc(this,zt);return}if(k=re||"",re=new Map(this.headers),Ae)if(Object.getPrototypeOf(Ae)===Object.prototype)for(var _t in Ae)re.set(_t,Ae[_t]);else if(typeof Ae.keys=="function"&&typeof Ae.get=="function")for(const zt of Ae.keys())re.set(zt,Ae.get(zt));else throw Error("Unknown input type for opt_headers: "+String(Ae));Ae=Array.from(re.keys()).find(zt=>zt.toLowerCase()=="content-type"),_t=s.FormData&&k instanceof s.FormData,!(0<=Array.prototype.indexOf.call(_p,Y,void 0))||Ae||_t||re.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[zt,_i]of re)this.g.setRequestHeader(zt,_i);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ph(this),this.u=!0,this.g.send(k),this.u=!1}catch(zt){Hc(this,zt)}};function Hc(k,Y){k.h=!1,k.g&&(k.j=!0,k.g.abort(),k.j=!1),k.l=Y,k.m=5,Rh(k),pc(k)}function Rh(k){k.A||(k.A=!0,Ei(k,"complete"),Ei(k,"error"))}r.abort=function(k){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=k||7,Ei(this,"complete"),Ei(this,"abort"),pc(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),pc(this,!0)),ts.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Ea(this):this.bb())},r.bb=function(){Ea(this)};function Ea(k){if(k.h&&typeof y<"u"&&(!k.v[1]||Vs(k)!=4||k.Z()!=2)){if(k.u&&Vs(k)==4)wr(k.Ea,0,k);else if(Ei(k,"readystatechange"),Vs(k)==4){k.h=!1;try{const _i=k.Z();e:switch(_i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var Y=!0;break e;default:Y=!1}var re;if(!(re=Y)){var Ae;if(Ae=_i===0){var _t=String(k.D).match(Tu)[1]||null;!_t&&s.self&&s.self.location&&(_t=s.self.location.protocol.slice(0,-1)),Ae=!Qm.test(_t?_t.toLowerCase():"")}re=Ae}if(re)Ei(k,"complete"),Ei(k,"success");else{k.m=6;try{var zt=2<Vs(k)?k.g.statusText:""}catch{zt=""}k.l=zt+" ["+k.Z()+"]",Rh(k)}}finally{pc(k)}}}}function pc(k,Y){if(k.g){Ph(k);const re=k.g,Ae=k.v[0]?()=>{}:null;k.g=null,k.v=null,Y||Ei(k,"ready");try{re.onreadystatechange=Ae}catch{}}}function Ph(k){k.I&&(s.clearTimeout(k.I),k.I=null)}r.isActive=function(){return!!this.g};function Vs(k){return k.g?k.g.readyState:0}r.Z=function(){try{return 2<Vs(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(k){if(this.g){var Y=this.g.responseText;return k&&Y.indexOf(k)==0&&(Y=Y.substring(k.length)),ss(Y)}};function mc(k){try{if(!k.g)return null;if("response"in k.g)return k.g.response;switch(k.H){case"":case"text":return k.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in k.g)return k.g.mozResponseArrayBuffer}return null}catch{return null}}function la(k){const Y={};k=(k.g&&2<=Vs(k)&&k.g.getAllResponseHeaders()||"").split(`\r
`);for(let Ae=0;Ae<k.length;Ae++){if(Fe(k[Ae]))continue;var re=Ve(k[Ae]);const _t=re[0];if(re=re[1],typeof re!="string")continue;re=re.trim();const zt=Y[_t]||[];Y[_t]=zt,zt.push(re)}me(Y,function(Ae){return Ae.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function qc(k,Y,re){return re&&re.internalChannelParams&&re.internalChannelParams[k]||Y}function Mh(k){this.Aa=0,this.i=[],this.j=new oe,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=qc("failFast",!1,k),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=qc("baseRetryDelayMs",5e3,k),this.cb=qc("retryDelaySeedMs",1e4,k),this.Wa=qc("forwardChannelMaxRetries",2,k),this.wa=qc("forwardChannelRequestTimeoutMs",2e4,k),this.pa=k&&k.xmlHttpFactory||void 0,this.Xa=k&&k.Tb||void 0,this.Ca=k&&k.useFetchStreams||!1,this.L=void 0,this.J=k&&k.supportsCrossDomainXhr||!1,this.K="",this.h=new cs(k&&k.concurrentRequestLimit),this.Da=new Iu,this.P=k&&k.fastHandshake||!1,this.O=k&&k.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=k&&k.Rb||!1,k&&k.xa&&this.j.xa(),k&&k.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&k&&k.detectBufferingProxy||!1,this.ja=void 0,k&&k.longPollingTimeout&&0<k.longPollingTimeout&&(this.ja=k.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Mh.prototype,r.la=8,r.G=1,r.connect=function(k,Y,re,Ae){Pe(0),this.W=k,this.H=Y||{},re&&Ae!==void 0&&(this.H.OSID=re,this.H.OAID=Ae),this.F=this.X,this.I=Lh(this,null,this.W),Dh(this)};function kh(k){if(jd(k),k.G==3){var Y=k.U++,re=Ya(k.I);if(pn(re,"SID",k.K),pn(re,"RID",Y),pn(re,"TYPE","terminate"),Wc(k,re),Y=new Qt(k,k.j,Y),Y.L=2,Y.v=Go(Ya(re)),re=!1,s.navigator&&s.navigator.sendBeacon)try{re=s.navigator.sendBeacon(Y.v.toString(),"")}catch{}!re&&s.Image&&(new Image().src=Y.v,re=!0),re||(Y.g=Bl(Y.j,null),Y.g.ea(Y.v)),Y.F=Date.now(),qr(Y)}Dr(k)}function Mr(k){k.g&&(Sa(k),k.g.cancel(),k.g=null)}function jd(k){Mr(k),k.u&&(s.clearTimeout(k.u),k.u=null),kr(k),k.h.cancel(),k.s&&(typeof k.s=="number"&&s.clearTimeout(k.s),k.s=null)}function Dh(k){if(!Ms(k.h)&&!k.s){k.s=!0;var Y=k.Ga;ri||st(),Si||(ri(),Si=!0),ir.add(Y,k),k.B=0}}function $d(k,Y){return Ss(k.h)>=k.h.j-(k.s?1:0)?!1:k.s?(k.i=Y.D.concat(k.i),!0):k.G==1||k.G==2||k.B>=(k.Va?0:k.Wa)?!1:(k.s=J(U(k.Ga,k,Y),Lo(k,k.B)),k.B++,!0)}r.Ga=function(k){if(this.s)if(this.s=null,this.G==1){if(!k){this.U=Math.floor(1e5*Math.random()),k=this.U++;const _t=new Qt(this,this.j,k);let zt=this.o;if(this.S&&(zt?(zt=ye(zt),ke(zt,this.S)):zt=this.S),this.m!==null||this.O||(_t.H=zt,zt=null),this.P)e:{for(var Y=0,re=0;re<this.i.length;re++){t:{var Ae=this.i[re];if("__data__"in Ae.map&&(Ae=Ae.map.__data__,typeof Ae=="string")){Ae=Ae.length;break t}Ae=void 0}if(Ae===void 0)break;if(Y+=Ae,4096<Y){Y=re;break e}if(Y===4096||re===this.i.length-1){Y=re+1;break e}}Y=1e3}else Y=1e3;Y=qo(this,_t,Y),re=Ya(this.I),pn(re,"RID",k),pn(re,"CVER",22),this.D&&pn(re,"X-HTTP-Session-Id",this.D),Wc(this,re),zt&&(this.O?Y="headers="+encodeURIComponent(String(Ch(zt)))+"&"+Y:this.m&&Ud(re,this.m,zt)),io(this.h,_t),this.Ua&&pn(re,"TYPE","init"),this.P?(pn(re,"$req",Y),pn(re,"SID","null"),_t.T=!0,$i(_t,re,null)):$i(_t,re,Y),this.G=2}}else this.G==3&&(k?Ri(this,k):this.i.length==0||Ms(this.h)||Ri(this))};function Ri(k,Y){var re;Y?re=Y.l:re=k.U++;const Ae=Ya(k.I);pn(Ae,"SID",k.K),pn(Ae,"RID",re),pn(Ae,"AID",k.T),Wc(k,Ae),k.m&&k.o&&Ud(Ae,k.m,k.o),re=new Qt(k,k.j,re,k.B+1),k.m===null&&(re.H=k.o),Y&&(k.i=Y.D.concat(k.i)),Y=qo(k,re,1e3),re.I=Math.round(.5*k.wa)+Math.round(.5*k.wa*Math.random()),io(k.h,re),$i(re,Ae,Y)}function Wc(k,Y){k.H&&pt(k.H,function(re,Ae){pn(Y,Ae,re)}),k.l&&wu({},function(re,Ae){pn(Y,Ae,re)})}function qo(k,Y,re){re=Math.min(k.i.length,re);var Ae=k.l?U(k.l.Na,k.l,k):null;e:{var _t=k.i;let zt=-1;for(;;){const _i=["count="+re];zt==-1?0<re?(zt=_t[0].g,_i.push("ofs="+zt)):zt=0:_i.push("ofs="+zt);let is=!0;for(let ks=0;ks<re;ks++){let Er=_t[ks].g;const qn=_t[ks].map;if(Er-=zt,0>Er)zt=Math.max(0,_t[ks].g-100),is=!1;else try{Jm(qn,_i,"req"+Er+"_")}catch{Ae&&Ae(qn)}}if(is){Ae=_i.join("&");break e}}}return k=k.i.splice(0,re),Y.D=k,Ae}function Ia(k){if(!k.g&&!k.u){k.Y=1;var Y=k.Fa;ri||st(),Si||(ri(),Si=!0),ir.add(Y,k),k.v=0}}function Su(k){return k.g||k.u||3<=k.v?!1:(k.Y++,k.u=J(U(k.Fa,k),Lo(k,k.v)),k.v++,!0)}r.Fa=function(){if(this.u=null,hi(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var k=2*this.R;this.j.info("BP detection timer enabled: "+k),this.A=J(U(this.ab,this),k)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Pe(10),Mr(this),hi(this))};function Sa(k){k.A!=null&&(s.clearTimeout(k.A),k.A=null)}function hi(k){k.g=new Qt(k,k.j,"rpc",k.Y),k.m===null&&(k.g.H=k.o),k.g.O=0;var Y=Ya(k.qa);pn(Y,"RID","rpc"),pn(Y,"SID",k.K),pn(Y,"AID",k.T),pn(Y,"CI",k.F?"0":"1"),!k.F&&k.ja&&pn(Y,"TO",k.ja),pn(Y,"TYPE","xmlhttp"),Wc(k,Y),k.m&&k.o&&Ud(Y,k.m,k.o),k.L&&(k.g.I=k.L);var re=k.g;k=k.ia,re.L=1,re.v=Go(Ya(Y)),re.m=null,re.P=!0,yr(re,k)}r.Za=function(){this.C!=null&&(this.C=null,Mr(this),Su(this),Pe(19))};function kr(k){k.C!=null&&(s.clearTimeout(k.C),k.C=null)}function Gr(k,Y){var re=null;if(k.g==Y){kr(k),Sa(k),k.g=null;var Ae=2}else if(Za(k.h,Y))re=Y.D,$c(k.h,Y),Ae=1;else return;if(k.G!=0){if(Y.o)if(Ae==1){re=Y.m?Y.m.length:0,Y=Date.now()-Y.F;var _t=k.B;Ae=xt(),Ei(Ae,new q(Ae,re)),Dh(k)}else Ia(k);else if(_t=Y.s,_t==3||_t==0&&0<Y.X||!(Ae==1&&$d(k,Y)||Ae==2&&Su(k)))switch(re&&0<re.length&&(Y=k.h,Y.i=Y.i.concat(re)),_t){case 1:ca(k,5);break;case 4:ca(k,10);break;case 3:ca(k,6);break;default:ca(k,2)}}}function Lo(k,Y){let re=k.Ta+Math.floor(Math.random()*k.cb);return k.isActive()||(re*=2),re*Y}function ca(k,Y){if(k.j.info("Error code "+Y),Y==2){var re=U(k.fb,k),Ae=k.Xa;const _t=!Ae;Ae=new Ka(Ae||"//www.google.com/images/cleardot.gif"),s.location&&s.location.protocol=="http"||sa(Ae,"https"),Go(Ae),_t?mp(Ae.toString(),re):Vd(Ae.toString(),re)}else Pe(2);k.G=0,k.l&&k.l.sa(Y),Dr(k),jd(k)}r.fb=function(k){k?(this.j.info("Successfully pinged google.com"),Pe(2)):(this.j.info("Failed to ping google.com"),Pe(1))};function Dr(k){if(k.G=0,k.ka=[],k.l){const Y=fp(k.h);(Y.length!=0||k.i.length!=0)&&(de(k.ka,Y),de(k.ka,k.i),k.h.i.length=0,Q(k.i),k.i.length=0),k.l.ra()}}function Lh(k,Y,re){var Ae=re instanceof Ka?Ya(re):new Ka(re);if(Ae.g!="")Y&&(Ae.g=Y+"."+Ae.g),Eu(Ae,Ae.s);else{var _t=s.location;Ae=_t.protocol,Y=Y?Y+"."+_t.hostname:_t.hostname,_t=+_t.port;var zt=new Ka(null);Ae&&sa(zt,Ae),Y&&(zt.g=Y),_t&&Eu(zt,_t),re&&(zt.l=re),Ae=zt}return re=k.D,Y=k.ya,re&&Y&&pn(Ae,re,Y),pn(Ae,"VER",k.la),Wc(k,Ae),Ae}function Bl(k,Y,re){if(Y&&!k.J)throw Error("Can't create secondary domain capable XhrIo object.");return Y=k.Ca&&!k.pa?new ts(new Ah({eb:re})):new ts(k.pa),Y.Ha(k.J),Y}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Au(){}r=Au.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function qs(){}qs.prototype.g=function(k,Y){return new _n(k,Y)};function _n(k,Y){Ti.call(this),this.g=new Mh(Y),this.l=k,this.h=Y&&Y.messageUrlParams||null,k=Y&&Y.messageHeaders||null,Y&&Y.clientProtocolHeaderRequired&&(k?k["X-Client-Protocol"]="webchannel":k={"X-Client-Protocol":"webchannel"}),this.g.o=k,k=Y&&Y.initMessageHeaders||null,Y&&Y.messageContentType&&(k?k["X-WebChannel-Content-Type"]=Y.messageContentType:k={"X-WebChannel-Content-Type":Y.messageContentType}),Y&&Y.va&&(k?k["X-WebChannel-Client-Profile"]=Y.va:k={"X-WebChannel-Client-Profile":Y.va}),this.g.S=k,(k=Y&&Y.Sb)&&!Fe(k)&&(this.g.m=k),this.v=Y&&Y.supportsCrossDomainXhr||!1,this.u=Y&&Y.sendRawJson||!1,(Y=Y&&Y.httpSessionIdParam)&&!Fe(Y)&&(this.g.D=Y,k=this.h,k!==null&&Y in k&&(k=this.h,Y in k&&delete k[Y])),this.j=new _c(this)}te(_n,Ti),_n.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},_n.prototype.close=function(){kh(this.g)},_n.prototype.o=function(k){var Y=this.g;if(typeof k=="string"){var re={};re.__data__=k,k=re}else this.u&&(re={},re.__data__=xn(k),k=re);Y.i.push(new Fr(Y.Ya++,k)),Y.G==3&&Dh(Y)},_n.prototype.N=function(){this.g.l=null,delete this.j,kh(this.g),delete this.g,_n.aa.N.call(this)};function e_(k){gs.call(this),k.__headers__&&(this.headers=k.__headers__,this.statusCode=k.__status__,delete k.__headers__,delete k.__status__);var Y=k.__sm__;if(Y){e:{for(const re in Y){k=re;break e}k=void 0}(this.i=k)&&(k=this.i,Y=Y!==null&&k in Y?Y[k]:void 0),this.data=Y}else this.data=k}te(e_,gs);function Cu(){eo.call(this),this.status=1}te(Cu,eo);function _c(k){this.g=k}te(_c,Au),_c.prototype.ua=function(){Ei(this.g,"a")},_c.prototype.ta=function(k){Ei(this.g,new e_(k))},_c.prototype.sa=function(k){Ei(this.g,new Cu)},_c.prototype.ra=function(){Ei(this.g,"b")},qs.prototype.createWebChannel=qs.prototype.g,_n.prototype.send=_n.prototype.o,_n.prototype.open=_n.prototype.m,_n.prototype.close=_n.prototype.close,RV=function(){return new qs},CV=function(){return xt()},AV=to,z5={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ze.NO_ERROR=0,Ze.TIMEOUT=8,Ze.HTTP_ERROR=6,b2=Ze,yt.COMPLETE="complete",SV=yt,$o.EventType=Is,Is.OPEN="a",Is.CLOSE="b",Is.ERROR="c",Is.MESSAGE="d",Ti.prototype.listen=Ti.prototype.K,e1=$o,ts.prototype.listenOnce=ts.prototype.L,ts.prototype.getLastError=ts.prototype.Ka,ts.prototype.getLastErrorCode=ts.prototype.Ba,ts.prototype.getStatus=ts.prototype.Z,ts.prototype.getResponseJson=ts.prototype.Oa,ts.prototype.getResponseText=ts.prototype.oa,ts.prototype.send=ts.prototype.ea,ts.prototype.setWithCredentials=ts.prototype.Ha,IV=ts}).apply(typeof Uw<"u"?Uw:typeof self<"u"?self:typeof window<"u"?window:{});const SL="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oa{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Oa.UNAUTHENTICATED=new Oa(null),Oa.GOOGLE_CREDENTIALS=new Oa("google-credentials-uid"),Oa.FIRST_PARTY=new Oa("first-party-uid"),Oa.MOCK_USER=new Oa("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let G0="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const km=new B0("@firebase/firestore");function Vv(){return km.logLevel}function pr(r,...e){if(km.logLevel<=Bn.DEBUG){const t=e.map(iR);km.debug(`Firestore (${G0}): ${r}`,...t)}}function Cd(r,...e){if(km.logLevel<=Bn.ERROR){const t=e.map(iR);km.error(`Firestore (${G0}): ${r}`,...t)}}function v0(r,...e){if(km.logLevel<=Bn.WARN){const t=e.map(iR);km.warn(`Firestore (${G0}): ${r}`,...t)}}function iR(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tn(r="Unexpected state"){const e=`FIRESTORE (${G0}) INTERNAL ASSERTION FAILED: `+r;throw Cd(e),new Error(e)}function xs(r,e){r||tn()}function cn(r,e){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Sr extends jc{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bd{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PV{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Vte{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Oa.UNAUTHENTICATED))}shutdown(){}}class Ute{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class jte{constructor(e){this.t=e,this.currentUser=Oa.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){xs(this.o===void 0);let o=this.i;const c=E=>this.i!==o?(o=this.i,t(E)):Promise.resolve();let f=new bd;this.o=()=>{this.i++,this.currentUser=this.u(),f.resolve(),f=new bd,e.enqueueRetryable(()=>c(this.currentUser))};const y=()=>{const E=f;e.enqueueRetryable(async()=>{await E.promise,await c(this.currentUser)})},s=E=>{pr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=E,this.o&&(this.auth.addAuthTokenListener(this.o),y())};this.t.onInit(E=>s(E)),setTimeout(()=>{if(!this.auth){const E=this.t.getImmediate({optional:!0});E?s(E):(pr("FirebaseAuthCredentialsProvider","Auth not yet detected"),f.resolve(),f=new bd)}},0),y()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(o=>this.i!==e?(pr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(xs(typeof o.accessToken=="string"),new PV(o.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return xs(e===null||typeof e=="string"),new Oa(e)}}class $te{constructor(e,t,o){this.l=e,this.h=t,this.P=o,this.type="FirstParty",this.user=Oa.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Gte{constructor(e,t,o){this.l=e,this.h=t,this.P=o}getToken(){return Promise.resolve(new $te(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Oa.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Hte{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class qte{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){xs(this.o===void 0);const o=f=>{f.error!=null&&pr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${f.error.message}`);const y=f.token!==this.R;return this.R=f.token,pr("FirebaseAppCheckTokenProvider",`Received ${y?"new":"existing"} token.`),y?t(f.token):Promise.resolve()};this.o=f=>{e.enqueueRetryable(()=>o(f))};const c=f=>{pr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=f,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(f=>c(f)),setTimeout(()=>{if(!this.appCheck){const f=this.A.getImmediate({optional:!0});f?c(f):pr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(xs(typeof t.token=="string"),this.R=t.token,new Hte(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wte(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let o=0;o<r;o++)t[o]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MV{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let o="";for(;o.length<20;){const c=Wte(40);for(let f=0;f<c.length;++f)o.length<20&&c[f]<t&&(o+=e.charAt(c[f]%e.length))}return o}}function ns(r,e){return r<e?-1:r>e?1:0}function x0(r,e,t){return r.length===e.length&&r.every((o,c)=>t(o,e[c]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mo{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Sr(yi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Sr(yi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Sr(yi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Sr(yi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Mo.fromMillis(Date.now())}static fromDate(e){return Mo.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),o=Math.floor(1e6*(e-1e3*t));return new Mo(t,o)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ns(this.nanoseconds,e.nanoseconds):ns(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ln(e)}static min(){return new ln(new Mo(0,0))}static max(){return new ln(new Mo(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nx{constructor(e,t,o){t===void 0?t=0:t>e.length&&tn(),o===void 0?o=e.length-t:o>e.length-t&&tn(),this.segments=e,this.offset=t,this.len=o}get length(){return this.len}isEqual(e){return nx.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof nx?e.forEach(o=>{t.push(o)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,o=this.limit();t<o;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const o=Math.min(e.length,t.length);for(let c=0;c<o;c++){const f=e.get(c),y=t.get(c);if(f<y)return-1;if(f>y)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ks extends nx{construct(e,t,o){return new Ks(e,t,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const o of e){if(o.indexOf("//")>=0)throw new Sr(yi.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);t.push(...o.split("/").filter(c=>c.length>0))}return new Ks(t)}static emptyPath(){return new Ks([])}}const Xte=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ma extends nx{construct(e,t,o){return new ma(e,t,o)}static isValidIdentifier(e){return Xte.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ma.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new ma(["__name__"])}static fromServerFormat(e){const t=[];let o="",c=0;const f=()=>{if(o.length===0)throw new Sr(yi.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(o),o=""};let y=!1;for(;c<e.length;){const s=e[c];if(s==="\\"){if(c+1===e.length)throw new Sr(yi.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const E=e[c+1];if(E!=="\\"&&E!=="."&&E!=="`")throw new Sr(yi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=E,c+=2}else s==="`"?(y=!y,c++):s!=="."||y?(o+=s,c++):(f(),c++)}if(f(),y)throw new Sr(yi.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ma(t)}static emptyPath(){return new ma([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Or{constructor(e){this.path=e}static fromPath(e){return new Or(Ks.fromString(e))}static fromName(e){return new Or(Ks.fromString(e).popFirst(5))}static empty(){return new Or(Ks.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ks.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ks.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Or(new Ks(e.slice()))}}function Zte(r,e){const t=r.toTimestamp().seconds,o=r.toTimestamp().nanoseconds+1,c=ln.fromTimestamp(o===1e9?new Mo(t+1,0):new Mo(t,o));return new rp(c,Or.empty(),e)}function Kte(r){return new rp(r.readTime,r.key,-1)}class rp{constructor(e,t,o){this.readTime=e,this.documentKey=t,this.largestBatchId=o}static min(){return new rp(ln.min(),Or.empty(),-1)}static max(){return new rp(ln.max(),Or.empty(),-1)}}function Yte(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=Or.comparator(r.documentKey,e.documentKey),t!==0?t:ns(r.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jte="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Qte{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zx(r){if(r.code!==yi.FAILED_PRECONDITION||r.message!==Jte)throw r;pr("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&tn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new vi((o,c)=>{this.nextCallback=f=>{this.wrapSuccess(e,f).next(o,c)},this.catchCallback=f=>{this.wrapFailure(t,f).next(o,c)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof vi?t:vi.resolve(t)}catch(t){return vi.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):vi.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):vi.reject(t)}static resolve(e){return new vi((t,o)=>{t(e)})}static reject(e){return new vi((t,o)=>{o(e)})}static waitFor(e){return new vi((t,o)=>{let c=0,f=0,y=!1;e.forEach(s=>{++c,s.next(()=>{++f,y&&f===c&&t()},E=>o(E))}),y=!0,f===c&&t()})}static or(e){let t=vi.resolve(!1);for(const o of e)t=t.next(c=>c?vi.resolve(c):o());return t}static forEach(e,t){const o=[];return e.forEach((c,f)=>{o.push(t.call(this,c,f))}),this.waitFor(o)}static mapArray(e,t){return new vi((o,c)=>{const f=e.length,y=new Array(f);let s=0;for(let E=0;E<f;E++){const R=E;t(e[R]).next(O=>{y[R]=O,++s,s===f&&o(y)},O=>c(O))}})}static doWhile(e,t){return new vi((o,c)=>{const f=()=>{e()===!0?t().next(()=>{f()},c):o()};f()})}}function eie(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Nx(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rR{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=o=>this.ie(o),this.se=o=>t.writeSequenceNumber(o))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}rR.oe=-1;function _E(r){return r==null}function cT(r){return r===0&&1/r==-1/0}function tie(r){return typeof r=="number"&&Number.isInteger(r)&&!cT(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AL(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function H0(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function kV(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(e,t){this.comparator=e,this.root=t||ha.EMPTY}insert(e,t){return new ao(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ha.BLACK,null,null))}remove(e){return new ao(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ha.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const o=this.comparator(e,t.key);if(o===0)return t.value;o<0?t=t.left:o>0&&(t=t.right)}return null}indexOf(e){let t=0,o=this.root;for(;!o.isEmpty();){const c=this.comparator(e,o.key);if(c===0)return t+o.left.size;c<0?o=o.left:(t+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,o)=>(e(t,o),!1))}toString(){const e=[];return this.inorderTraversal((t,o)=>(e.push(`${t}:${o}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new jw(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new jw(this.root,e,this.comparator,!1)}getReverseIterator(){return new jw(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new jw(this.root,e,this.comparator,!0)}}class jw{constructor(e,t,o,c){this.isReverse=c,this.nodeStack=[];let f=1;for(;!e.isEmpty();)if(f=t?o(e.key,t):1,t&&c&&(f*=-1),f<0)e=this.isReverse?e.left:e.right;else{if(f===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ha{constructor(e,t,o,c,f){this.key=e,this.value=t,this.color=o??ha.RED,this.left=c??ha.EMPTY,this.right=f??ha.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,o,c,f){return new ha(e??this.key,t??this.value,o??this.color,c??this.left,f??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,o){let c=this;const f=o(e,c.key);return c=f<0?c.copy(null,null,null,c.left.insert(e,t,o),null):f===0?c.copy(null,t,null,null,null):c.copy(null,null,null,null,c.right.insert(e,t,o)),c.fixUp()}removeMin(){if(this.left.isEmpty())return ha.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let o,c=this;if(t(e,c.key)<0)c.left.isEmpty()||c.left.isRed()||c.left.left.isRed()||(c=c.moveRedLeft()),c=c.copy(null,null,null,c.left.remove(e,t),null);else{if(c.left.isRed()&&(c=c.rotateRight()),c.right.isEmpty()||c.right.isRed()||c.right.left.isRed()||(c=c.moveRedRight()),t(e,c.key)===0){if(c.right.isEmpty())return ha.EMPTY;o=c.right.min(),c=c.copy(o.key,o.value,null,null,c.right.removeMin())}c=c.copy(null,null,null,null,c.right.remove(e,t))}return c.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ha.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ha.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw tn();const e=this.left.check();if(e!==this.right.check())throw tn();return e+(this.isRed()?0:1)}}ha.EMPTY=null,ha.RED=!0,ha.BLACK=!1;ha.EMPTY=new class{constructor(){this.size=0}get key(){throw tn()}get value(){throw tn()}get color(){throw tn()}get left(){throw tn()}get right(){throw tn()}copy(e,t,o,c,f){return this}insert(e,t,o){return new ha(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(e){this.comparator=e,this.data=new ao(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,o)=>(e(t),!1))}forEachInRange(e,t){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const c=o.getNext();if(this.comparator(c.key,e[1])>=0)return;t(c.key)}}forEachWhile(e,t){let o;for(o=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new CL(this.data.getIterator())}getIteratorFrom(e){return new CL(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(o=>{t=t.add(o)}),t}isEqual(e){if(!(e instanceof va)||this.size!==e.size)return!1;const t=this.data.getIterator(),o=e.data.getIterator();for(;t.hasNext();){const c=t.getNext().key,f=o.getNext().key;if(this.comparator(c,f)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new va(this.comparator);return t.data=e,t}}class CL{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uu{constructor(e){this.fields=e,e.sort(ma.comparator)}static empty(){return new uu([])}unionWith(e){let t=new va(ma.comparator);for(const o of this.fields)t=t.add(o);for(const o of e)t=t.add(o);return new uu(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return x0(this.fields,e.fields,(t,o)=>t.isEqual(o))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DV extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ba{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(c){try{return atob(c)}catch(f){throw typeof DOMException<"u"&&f instanceof DOMException?new DV("Invalid base64 string: "+f):f}}(e);return new ba(t)}static fromUint8Array(e){const t=function(c){let f="";for(let y=0;y<c.length;++y)f+=String.fromCharCode(c[y]);return f}(e);return new ba(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const o=new Uint8Array(t.length);for(let c=0;c<t.length;c++)o[c]=t.charCodeAt(c);return o}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ns(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ba.EMPTY_BYTE_STRING=new ba("");const iie=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function np(r){if(xs(!!r),typeof r=="string"){let e=0;const t=iie.exec(r);if(xs(!!t),t[1]){let c=t[1];c=(c+"000000000").substr(0,9),e=Number(c)}const o=new Date(r);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:go(r.seconds),nanos:go(r.nanos)}}function go(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Dm(r){return typeof r=="string"?ba.fromBase64String(r):ba.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nR(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function sR(r){const e=r.mapValue.fields.__previous_value__;return nR(e)?sR(e):e}function sx(r){const e=np(r.mapValue.fields.__local_write_time__.timestampValue);return new Mo(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rie{constructor(e,t,o,c,f,y,s,E,R){this.databaseId=e,this.appId=t,this.persistenceKey=o,this.host=c,this.ssl=f,this.forceLongPolling=y,this.autoDetectLongPolling=s,this.longPollingOptions=E,this.useFetchStreams=R}}class ox{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ox("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ox&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $w={mapValue:{}};function Lm(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?nR(r)?4:sie(r)?9007199254740991:nie(r)?10:11:tn()}function yh(r,e){if(r===e)return!0;const t=Lm(r);if(t!==Lm(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return sx(r).isEqual(sx(e));case 3:return function(c,f){if(typeof c.timestampValue=="string"&&typeof f.timestampValue=="string"&&c.timestampValue.length===f.timestampValue.length)return c.timestampValue===f.timestampValue;const y=np(c.timestampValue),s=np(f.timestampValue);return y.seconds===s.seconds&&y.nanos===s.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(c,f){return Dm(c.bytesValue).isEqual(Dm(f.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(c,f){return go(c.geoPointValue.latitude)===go(f.geoPointValue.latitude)&&go(c.geoPointValue.longitude)===go(f.geoPointValue.longitude)}(r,e);case 2:return function(c,f){if("integerValue"in c&&"integerValue"in f)return go(c.integerValue)===go(f.integerValue);if("doubleValue"in c&&"doubleValue"in f){const y=go(c.doubleValue),s=go(f.doubleValue);return y===s?cT(y)===cT(s):isNaN(y)&&isNaN(s)}return!1}(r,e);case 9:return x0(r.arrayValue.values||[],e.arrayValue.values||[],yh);case 10:case 11:return function(c,f){const y=c.mapValue.fields||{},s=f.mapValue.fields||{};if(AL(y)!==AL(s))return!1;for(const E in y)if(y.hasOwnProperty(E)&&(s[E]===void 0||!yh(y[E],s[E])))return!1;return!0}(r,e);default:return tn()}}function ax(r,e){return(r.values||[]).find(t=>yh(t,e))!==void 0}function b0(r,e){if(r===e)return 0;const t=Lm(r),o=Lm(e);if(t!==o)return ns(t,o);switch(t){case 0:case 9007199254740991:return 0;case 1:return ns(r.booleanValue,e.booleanValue);case 2:return function(f,y){const s=go(f.integerValue||f.doubleValue),E=go(y.integerValue||y.doubleValue);return s<E?-1:s>E?1:s===E?0:isNaN(s)?isNaN(E)?0:-1:1}(r,e);case 3:return RL(r.timestampValue,e.timestampValue);case 4:return RL(sx(r),sx(e));case 5:return ns(r.stringValue,e.stringValue);case 6:return function(f,y){const s=Dm(f),E=Dm(y);return s.compareTo(E)}(r.bytesValue,e.bytesValue);case 7:return function(f,y){const s=f.split("/"),E=y.split("/");for(let R=0;R<s.length&&R<E.length;R++){const O=ns(s[R],E[R]);if(O!==0)return O}return ns(s.length,E.length)}(r.referenceValue,e.referenceValue);case 8:return function(f,y){const s=ns(go(f.latitude),go(y.latitude));return s!==0?s:ns(go(f.longitude),go(y.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return PL(r.arrayValue,e.arrayValue);case 10:return function(f,y){var s,E,R,O;const A=f.fields||{},U=y.fields||{},$=(s=A.value)===null||s===void 0?void 0:s.arrayValue,te=(E=U.value)===null||E===void 0?void 0:E.arrayValue,Q=ns(((R=$==null?void 0:$.values)===null||R===void 0?void 0:R.length)||0,((O=te==null?void 0:te.values)===null||O===void 0?void 0:O.length)||0);return Q!==0?Q:PL($,te)}(r.mapValue,e.mapValue);case 11:return function(f,y){if(f===$w.mapValue&&y===$w.mapValue)return 0;if(f===$w.mapValue)return 1;if(y===$w.mapValue)return-1;const s=f.fields||{},E=Object.keys(s),R=y.fields||{},O=Object.keys(R);E.sort(),O.sort();for(let A=0;A<E.length&&A<O.length;++A){const U=ns(E[A],O[A]);if(U!==0)return U;const $=b0(s[E[A]],R[O[A]]);if($!==0)return $}return ns(E.length,O.length)}(r.mapValue,e.mapValue);default:throw tn()}}function RL(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return ns(r,e);const t=np(r),o=np(e),c=ns(t.seconds,o.seconds);return c!==0?c:ns(t.nanos,o.nanos)}function PL(r,e){const t=r.values||[],o=e.values||[];for(let c=0;c<t.length&&c<o.length;++c){const f=b0(t[c],o[c]);if(f)return f}return ns(t.length,o.length)}function w0(r){return N5(r)}function N5(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const o=np(t);return`time(${o.seconds},${o.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return Dm(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return Or.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let o="[",c=!0;for(const f of t.values||[])c?c=!1:o+=",",o+=N5(f);return o+"]"}(r.arrayValue):"mapValue"in r?function(t){const o=Object.keys(t.fields||{}).sort();let c="{",f=!0;for(const y of o)f?f=!1:c+=",",c+=`${y}:${N5(t.fields[y])}`;return c+"}"}(r.mapValue):tn()}function B5(r){return!!r&&"integerValue"in r}function oR(r){return!!r&&"arrayValue"in r}function ML(r){return!!r&&"nullValue"in r}function kL(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function w2(r){return!!r&&"mapValue"in r}function nie(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function E1(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return H0(r.mapValue.fields,(t,o)=>e.mapValue.fields[t]=E1(o)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=E1(r.arrayValue.values[t]);return e}return Object.assign({},r)}function sie(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pc{constructor(e){this.value=e}static empty(){return new Pc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let o=0;o<e.length-1;++o)if(t=(t.mapValue.fields||{})[e.get(o)],!w2(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=E1(t)}setAll(e){let t=ma.emptyPath(),o={},c=[];e.forEach((y,s)=>{if(!t.isImmediateParentOf(s)){const E=this.getFieldsMap(t);this.applyChanges(E,o,c),o={},c=[],t=s.popLast()}y?o[s.lastSegment()]=E1(y):c.push(s.lastSegment())});const f=this.getFieldsMap(t);this.applyChanges(f,o,c)}delete(e){const t=this.field(e.popLast());w2(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return yh(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let o=0;o<e.length;++o){let c=t.mapValue.fields[e.get(o)];w2(c)&&c.mapValue.fields||(c={mapValue:{fields:{}}},t.mapValue.fields[e.get(o)]=c),t=c}return t.mapValue.fields}applyChanges(e,t,o){H0(t,(c,f)=>e[c]=f);for(const c of o)delete e[c]}clone(){return new Pc(E1(this.value))}}function LV(r){const e=[];return H0(r.fields,(t,o)=>{const c=new ma([t]);if(w2(o)){const f=LV(o.mapValue).fields;if(f.length===0)e.push(c);else for(const y of f)e.push(c.child(y))}else e.push(c)}),new uu(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Va{constructor(e,t,o,c,f,y,s){this.key=e,this.documentType=t,this.version=o,this.readTime=c,this.createTime=f,this.data=y,this.documentState=s}static newInvalidDocument(e){return new Va(e,0,ln.min(),ln.min(),ln.min(),Pc.empty(),0)}static newFoundDocument(e,t,o,c){return new Va(e,1,t,ln.min(),o,c,0)}static newNoDocument(e,t){return new Va(e,2,t,ln.min(),ln.min(),Pc.empty(),0)}static newUnknownDocument(e,t){return new Va(e,3,t,ln.min(),ln.min(),Pc.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ln.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ln.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Va&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Va(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uT{constructor(e,t){this.position=e,this.inclusive=t}}function DL(r,e,t){let o=0;for(let c=0;c<r.position.length;c++){const f=e[c],y=r.position[c];if(f.field.isKeyField()?o=Or.comparator(Or.fromName(y.referenceValue),t.key):o=b0(y,t.data.field(f.field)),f.dir==="desc"&&(o*=-1),o!==0)break}return o}function LL(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!yh(r.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hT{constructor(e,t="asc"){this.field=e,this.dir=t}}function oie(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OV{}class Vo extends OV{constructor(e,t,o){super(),this.field=e,this.op=t,this.value=o}static create(e,t,o){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,o):new lie(e,t,o):t==="array-contains"?new hie(e,o):t==="in"?new die(e,o):t==="not-in"?new fie(e,o):t==="array-contains-any"?new pie(e,o):new Vo(e,t,o)}static createKeyFieldInFilter(e,t,o){return t==="in"?new cie(e,o):new uie(e,o)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(b0(t,this.value)):t!==null&&Lm(this.value)===Lm(t)&&this.matchesComparison(b0(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return tn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class vh extends OV{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new vh(e,t)}matches(e){return FV(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function FV(r){return r.op==="and"}function zV(r){return aie(r)&&FV(r)}function aie(r){for(const e of r.filters)if(e instanceof vh)return!1;return!0}function V5(r){if(r instanceof Vo)return r.field.canonicalString()+r.op.toString()+w0(r.value);if(zV(r))return r.filters.map(e=>V5(e)).join(",");{const e=r.filters.map(t=>V5(t)).join(",");return`${r.op}(${e})`}}function NV(r,e){return r instanceof Vo?function(o,c){return c instanceof Vo&&o.op===c.op&&o.field.isEqual(c.field)&&yh(o.value,c.value)}(r,e):r instanceof vh?function(o,c){return c instanceof vh&&o.op===c.op&&o.filters.length===c.filters.length?o.filters.reduce((f,y,s)=>f&&NV(y,c.filters[s]),!0):!1}(r,e):void tn()}function BV(r){return r instanceof Vo?function(t){return`${t.field.canonicalString()} ${t.op} ${w0(t.value)}`}(r):r instanceof vh?function(t){return t.op.toString()+" {"+t.getFilters().map(BV).join(" ,")+"}"}(r):"Filter"}class lie extends Vo{constructor(e,t,o){super(e,t,o),this.key=Or.fromName(o.referenceValue)}matches(e){const t=Or.comparator(e.key,this.key);return this.matchesComparison(t)}}class cie extends Vo{constructor(e,t){super(e,"in",t),this.keys=VV("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class uie extends Vo{constructor(e,t){super(e,"not-in",t),this.keys=VV("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function VV(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(o=>Or.fromName(o.referenceValue))}class hie extends Vo{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return oR(t)&&ax(t.arrayValue,this.value)}}class die extends Vo{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&ax(this.value.arrayValue,t)}}class fie extends Vo{constructor(e,t){super(e,"not-in",t)}matches(e){if(ax(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!ax(this.value.arrayValue,t)}}class pie extends Vo{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!oR(t)||!t.arrayValue.values)&&t.arrayValue.values.some(o=>ax(this.value.arrayValue,o))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mie{constructor(e,t=null,o=[],c=[],f=null,y=null,s=null){this.path=e,this.collectionGroup=t,this.orderBy=o,this.filters=c,this.limit=f,this.startAt=y,this.endAt=s,this.ue=null}}function OL(r,e=null,t=[],o=[],c=null,f=null,y=null){return new mie(r,e,t,o,c,f,y)}function aR(r){const e=cn(r);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(o=>V5(o)).join(","),t+="|ob:",t+=e.orderBy.map(o=>function(f){return f.field.canonicalString()+f.dir}(o)).join(","),_E(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(o=>w0(o)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(o=>w0(o)).join(",")),e.ue=t}return e.ue}function lR(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!oie(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!NV(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!LL(r.startAt,e.startAt)&&LL(r.endAt,e.endAt)}function U5(r){return Or.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gE{constructor(e,t=null,o=[],c=[],f=null,y="F",s=null,E=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=o,this.filters=c,this.limit=f,this.limitType=y,this.startAt=s,this.endAt=E,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function _ie(r,e,t,o,c,f,y,s){return new gE(r,e,t,o,c,f,y,s)}function yE(r){return new gE(r)}function FL(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function gie(r){return r.collectionGroup!==null}function I1(r){const e=cn(r);if(e.ce===null){e.ce=[];const t=new Set;for(const f of e.explicitOrderBy)e.ce.push(f),t.add(f.field.canonicalString());const o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(y){let s=new va(ma.comparator);return y.filters.forEach(E=>{E.getFlattenedFilters().forEach(R=>{R.isInequality()&&(s=s.add(R.field))})}),s})(e).forEach(f=>{t.has(f.canonicalString())||f.isKeyField()||e.ce.push(new hT(f,o))}),t.has(ma.keyField().canonicalString())||e.ce.push(new hT(ma.keyField(),o))}return e.ce}function dh(r){const e=cn(r);return e.le||(e.le=yie(e,I1(r))),e.le}function yie(r,e){if(r.limitType==="F")return OL(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(c=>{const f=c.dir==="desc"?"asc":"desc";return new hT(c.field,f)});const t=r.endAt?new uT(r.endAt.position,r.endAt.inclusive):null,o=r.startAt?new uT(r.startAt.position,r.startAt.inclusive):null;return OL(r.path,r.collectionGroup,e,r.filters,r.limit,t,o)}}function j5(r,e,t){return new gE(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function vE(r,e){return lR(dh(r),dh(e))&&r.limitType===e.limitType}function UV(r){return`${aR(dh(r))}|lt:${r.limitType}`}function Cg(r){return`Query(target=${function(t){let o=t.path.canonicalString();return t.collectionGroup!==null&&(o+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(o+=`, filters: [${t.filters.map(c=>BV(c)).join(", ")}]`),_E(t.limit)||(o+=", limit: "+t.limit),t.orderBy.length>0&&(o+=`, orderBy: [${t.orderBy.map(c=>function(y){return`${y.field.canonicalString()} (${y.dir})`}(c)).join(", ")}]`),t.startAt&&(o+=", startAt: ",o+=t.startAt.inclusive?"b:":"a:",o+=t.startAt.position.map(c=>w0(c)).join(",")),t.endAt&&(o+=", endAt: ",o+=t.endAt.inclusive?"a:":"b:",o+=t.endAt.position.map(c=>w0(c)).join(",")),`Target(${o})`}(dh(r))}; limitType=${r.limitType})`}function xE(r,e){return e.isFoundDocument()&&function(o,c){const f=c.key.path;return o.collectionGroup!==null?c.key.hasCollectionId(o.collectionGroup)&&o.path.isPrefixOf(f):Or.isDocumentKey(o.path)?o.path.isEqual(f):o.path.isImmediateParentOf(f)}(r,e)&&function(o,c){for(const f of I1(o))if(!f.field.isKeyField()&&c.data.field(f.field)===null)return!1;return!0}(r,e)&&function(o,c){for(const f of o.filters)if(!f.matches(c))return!1;return!0}(r,e)&&function(o,c){return!(o.startAt&&!function(y,s,E){const R=DL(y,s,E);return y.inclusive?R<=0:R<0}(o.startAt,I1(o),c)||o.endAt&&!function(y,s,E){const R=DL(y,s,E);return y.inclusive?R>=0:R>0}(o.endAt,I1(o),c))}(r,e)}function vie(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function jV(r){return(e,t)=>{let o=!1;for(const c of I1(r)){const f=xie(c,e,t);if(f!==0)return f;o=o||c.field.isKeyField()}return 0}}function xie(r,e,t){const o=r.field.isKeyField()?Or.comparator(e.key,t.key):function(f,y,s){const E=y.data.field(f),R=s.data.field(f);return E!==null&&R!==null?b0(E,R):tn()}(r.field,e,t);switch(r.dir){case"asc":return o;case"desc":return-1*o;default:return tn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q0{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),o=this.inner[t];if(o!==void 0){for(const[c,f]of o)if(this.equalsFn(c,e))return f}}has(e){return this.get(e)!==void 0}set(e,t){const o=this.mapKeyFn(e),c=this.inner[o];if(c===void 0)return this.inner[o]=[[e,t]],void this.innerSize++;for(let f=0;f<c.length;f++)if(this.equalsFn(c[f][0],e))return void(c[f]=[e,t]);c.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),o=this.inner[t];if(o===void 0)return!1;for(let c=0;c<o.length;c++)if(this.equalsFn(o[c][0],e))return o.length===1?delete this.inner[t]:o.splice(c,1),this.innerSize--,!0;return!1}forEach(e){H0(this.inner,(t,o)=>{for(const[c,f]of o)e(c,f)})}isEmpty(){return kV(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bie=new ao(Or.comparator);function Rd(){return bie}const $V=new ao(Or.comparator);function t1(...r){let e=$V;for(const t of r)e=e.insert(t.key,t);return e}function GV(r){let e=$V;return r.forEach((t,o)=>e=e.insert(t,o.overlayedDocument)),e}function lm(){return S1()}function HV(){return S1()}function S1(){return new q0(r=>r.toString(),(r,e)=>r.isEqual(e))}const wie=new ao(Or.comparator),Tie=new va(Or.comparator);function Vn(...r){let e=Tie;for(const t of r)e=e.add(t);return e}const Eie=new va(ns);function Iie(){return Eie}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cR(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:cT(e)?"-0":e}}function qV(r){return{integerValue:""+r}}function Sie(r,e){return tie(e)?qV(e):cR(r,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bE{constructor(){this._=void 0}}function Aie(r,e,t){return r instanceof dT?function(c,f){const y={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:c.seconds,nanos:c.nanoseconds}}}};return f&&nR(f)&&(f=sR(f)),f&&(y.fields.__previous_value__=f),{mapValue:y}}(t,e):r instanceof T0?XV(r,e):r instanceof lx?ZV(r,e):function(c,f){const y=WV(c,f),s=zL(y)+zL(c.Pe);return B5(y)&&B5(c.Pe)?qV(s):cR(c.serializer,s)}(r,e)}function Cie(r,e,t){return r instanceof T0?XV(r,e):r instanceof lx?ZV(r,e):t}function WV(r,e){return r instanceof fT?function(o){return B5(o)||function(f){return!!f&&"doubleValue"in f}(o)}(e)?e:{integerValue:0}:null}class dT extends bE{}class T0 extends bE{constructor(e){super(),this.elements=e}}function XV(r,e){const t=KV(e);for(const o of r.elements)t.some(c=>yh(c,o))||t.push(o);return{arrayValue:{values:t}}}class lx extends bE{constructor(e){super(),this.elements=e}}function ZV(r,e){let t=KV(e);for(const o of r.elements)t=t.filter(c=>!yh(c,o));return{arrayValue:{values:t}}}class fT extends bE{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function zL(r){return go(r.integerValue||r.doubleValue)}function KV(r){return oR(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rie{constructor(e,t){this.field=e,this.transform=t}}function Pie(r,e){return r.field.isEqual(e.field)&&function(o,c){return o instanceof T0&&c instanceof T0||o instanceof lx&&c instanceof lx?x0(o.elements,c.elements,yh):o instanceof fT&&c instanceof fT?yh(o.Pe,c.Pe):o instanceof dT&&c instanceof dT}(r.transform,e.transform)}class Mie{constructor(e,t){this.version=e,this.transformResults=t}}class fh{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new fh}static exists(e){return new fh(void 0,e)}static updateTime(e){return new fh(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function T2(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class wE{}function YV(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new QV(r.key,fh.none()):new Bx(r.key,r.data,fh.none());{const t=r.data,o=Pc.empty();let c=new va(ma.comparator);for(let f of e.fields)if(!c.has(f)){let y=t.field(f);y===null&&f.length>1&&(f=f.popLast(),y=t.field(f)),y===null?o.delete(f):o.set(f,y),c=c.add(f)}return new Xm(r.key,o,new uu(c.toArray()),fh.none())}}function kie(r,e,t){r instanceof Bx?function(c,f,y){const s=c.value.clone(),E=BL(c.fieldTransforms,f,y.transformResults);s.setAll(E),f.convertToFoundDocument(y.version,s).setHasCommittedMutations()}(r,e,t):r instanceof Xm?function(c,f,y){if(!T2(c.precondition,f))return void f.convertToUnknownDocument(y.version);const s=BL(c.fieldTransforms,f,y.transformResults),E=f.data;E.setAll(JV(c)),E.setAll(s),f.convertToFoundDocument(y.version,E).setHasCommittedMutations()}(r,e,t):function(c,f,y){f.convertToNoDocument(y.version).setHasCommittedMutations()}(0,e,t)}function A1(r,e,t,o){return r instanceof Bx?function(f,y,s,E){if(!T2(f.precondition,y))return s;const R=f.value.clone(),O=VL(f.fieldTransforms,E,y);return R.setAll(O),y.convertToFoundDocument(y.version,R).setHasLocalMutations(),null}(r,e,t,o):r instanceof Xm?function(f,y,s,E){if(!T2(f.precondition,y))return s;const R=VL(f.fieldTransforms,E,y),O=y.data;return O.setAll(JV(f)),O.setAll(R),y.convertToFoundDocument(y.version,O).setHasLocalMutations(),s===null?null:s.unionWith(f.fieldMask.fields).unionWith(f.fieldTransforms.map(A=>A.field))}(r,e,t,o):function(f,y,s){return T2(f.precondition,y)?(y.convertToNoDocument(y.version).setHasLocalMutations(),null):s}(r,e,t)}function Die(r,e){let t=null;for(const o of r.fieldTransforms){const c=e.data.field(o.field),f=WV(o.transform,c||null);f!=null&&(t===null&&(t=Pc.empty()),t.set(o.field,f))}return t||null}function NL(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(o,c){return o===void 0&&c===void 0||!(!o||!c)&&x0(o,c,(f,y)=>Pie(f,y))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}class Bx extends wE{constructor(e,t,o,c=[]){super(),this.key=e,this.value=t,this.precondition=o,this.fieldTransforms=c,this.type=0}getFieldMask(){return null}}class Xm extends wE{constructor(e,t,o,c,f=[]){super(),this.key=e,this.data=t,this.fieldMask=o,this.precondition=c,this.fieldTransforms=f,this.type=1}getFieldMask(){return this.fieldMask}}function JV(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const o=r.data.field(t);e.set(t,o)}}),e}function BL(r,e,t){const o=new Map;xs(r.length===t.length);for(let c=0;c<t.length;c++){const f=r[c],y=f.transform,s=e.data.field(f.field);o.set(f.field,Cie(y,s,t[c]))}return o}function VL(r,e,t){const o=new Map;for(const c of r){const f=c.transform,y=t.data.field(c.field);o.set(c.field,Aie(f,y,e))}return o}class QV extends wE{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Lie extends wE{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oie{constructor(e,t,o,c){this.batchId=e,this.localWriteTime=t,this.baseMutations=o,this.mutations=c}applyToRemoteDocument(e,t){const o=t.mutationResults;for(let c=0;c<this.mutations.length;c++){const f=this.mutations[c];f.key.isEqual(e.key)&&kie(f,e,o[c])}}applyToLocalView(e,t){for(const o of this.baseMutations)o.key.isEqual(e.key)&&(t=A1(o,e,t,this.localWriteTime));for(const o of this.mutations)o.key.isEqual(e.key)&&(t=A1(o,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const o=HV();return this.mutations.forEach(c=>{const f=e.get(c.key),y=f.overlayedDocument;let s=this.applyToLocalView(y,f.mutatedFields);s=t.has(c.key)?null:s;const E=YV(y,s);E!==null&&o.set(c.key,E),y.isValidDocument()||y.convertToNoDocument(ln.min())}),o}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Vn())}isEqual(e){return this.batchId===e.batchId&&x0(this.mutations,e.mutations,(t,o)=>NL(t,o))&&x0(this.baseMutations,e.baseMutations,(t,o)=>NL(t,o))}}class uR{constructor(e,t,o,c){this.batch=e,this.commitVersion=t,this.mutationResults=o,this.docVersions=c}static from(e,t,o){xs(e.mutations.length===o.length);let c=function(){return wie}();const f=e.mutations;for(let y=0;y<f.length;y++)c=c.insert(f[y].key,o[y].version);return new uR(e,t,o,c)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fie{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zie{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var So,Wn;function Nie(r){switch(r){default:return tn();case yi.CANCELLED:case yi.UNKNOWN:case yi.DEADLINE_EXCEEDED:case yi.RESOURCE_EXHAUSTED:case yi.INTERNAL:case yi.UNAVAILABLE:case yi.UNAUTHENTICATED:return!1;case yi.INVALID_ARGUMENT:case yi.NOT_FOUND:case yi.ALREADY_EXISTS:case yi.PERMISSION_DENIED:case yi.FAILED_PRECONDITION:case yi.ABORTED:case yi.OUT_OF_RANGE:case yi.UNIMPLEMENTED:case yi.DATA_LOSS:return!0}}function e8(r){if(r===void 0)return Cd("GRPC error has no .code"),yi.UNKNOWN;switch(r){case So.OK:return yi.OK;case So.CANCELLED:return yi.CANCELLED;case So.UNKNOWN:return yi.UNKNOWN;case So.DEADLINE_EXCEEDED:return yi.DEADLINE_EXCEEDED;case So.RESOURCE_EXHAUSTED:return yi.RESOURCE_EXHAUSTED;case So.INTERNAL:return yi.INTERNAL;case So.UNAVAILABLE:return yi.UNAVAILABLE;case So.UNAUTHENTICATED:return yi.UNAUTHENTICATED;case So.INVALID_ARGUMENT:return yi.INVALID_ARGUMENT;case So.NOT_FOUND:return yi.NOT_FOUND;case So.ALREADY_EXISTS:return yi.ALREADY_EXISTS;case So.PERMISSION_DENIED:return yi.PERMISSION_DENIED;case So.FAILED_PRECONDITION:return yi.FAILED_PRECONDITION;case So.ABORTED:return yi.ABORTED;case So.OUT_OF_RANGE:return yi.OUT_OF_RANGE;case So.UNIMPLEMENTED:return yi.UNIMPLEMENTED;case So.DATA_LOSS:return yi.DATA_LOSS;default:return tn()}}(Wn=So||(So={}))[Wn.OK=0]="OK",Wn[Wn.CANCELLED=1]="CANCELLED",Wn[Wn.UNKNOWN=2]="UNKNOWN",Wn[Wn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Wn[Wn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Wn[Wn.NOT_FOUND=5]="NOT_FOUND",Wn[Wn.ALREADY_EXISTS=6]="ALREADY_EXISTS",Wn[Wn.PERMISSION_DENIED=7]="PERMISSION_DENIED",Wn[Wn.UNAUTHENTICATED=16]="UNAUTHENTICATED",Wn[Wn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Wn[Wn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Wn[Wn.ABORTED=10]="ABORTED",Wn[Wn.OUT_OF_RANGE=11]="OUT_OF_RANGE",Wn[Wn.UNIMPLEMENTED=12]="UNIMPLEMENTED",Wn[Wn.INTERNAL=13]="INTERNAL",Wn[Wn.UNAVAILABLE=14]="UNAVAILABLE",Wn[Wn.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bie(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vie=new pm([4294967295,4294967295],0);function UL(r){const e=Bie().encode(r),t=new EV;return t.update(e),new Uint8Array(t.digest())}function jL(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),o=e.getUint32(4,!0),c=e.getUint32(8,!0),f=e.getUint32(12,!0);return[new pm([t,o],0),new pm([c,f],0)]}class hR{constructor(e,t,o){if(this.bitmap=e,this.padding=t,this.hashCount=o,t<0||t>=8)throw new i1(`Invalid padding: ${t}`);if(o<0)throw new i1(`Invalid hash count: ${o}`);if(e.length>0&&this.hashCount===0)throw new i1(`Invalid hash count: ${o}`);if(e.length===0&&t!==0)throw new i1(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=pm.fromNumber(this.Ie)}Ee(e,t,o){let c=e.add(t.multiply(pm.fromNumber(o)));return c.compare(Vie)===1&&(c=new pm([c.getBits(0),c.getBits(1)],0)),c.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=UL(e),[o,c]=jL(t);for(let f=0;f<this.hashCount;f++){const y=this.Ee(o,c,f);if(!this.de(y))return!1}return!0}static create(e,t,o){const c=e%8==0?0:8-e%8,f=new Uint8Array(Math.ceil(e/8)),y=new hR(f,c,t);return o.forEach(s=>y.insert(s)),y}insert(e){if(this.Ie===0)return;const t=UL(e),[o,c]=jL(t);for(let f=0;f<this.hashCount;f++){const y=this.Ee(o,c,f);this.Ae(y)}}Ae(e){const t=Math.floor(e/8),o=e%8;this.bitmap[t]|=1<<o}}class i1 extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TE{constructor(e,t,o,c,f){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=o,this.documentUpdates=c,this.resolvedLimboDocuments=f}static createSynthesizedRemoteEventForCurrentChange(e,t,o){const c=new Map;return c.set(e,Vx.createSynthesizedTargetChangeForCurrentChange(e,t,o)),new TE(ln.min(),c,new ao(ns),Rd(),Vn())}}class Vx{constructor(e,t,o,c,f){this.resumeToken=e,this.current=t,this.addedDocuments=o,this.modifiedDocuments=c,this.removedDocuments=f}static createSynthesizedTargetChangeForCurrentChange(e,t,o){return new Vx(o,t,Vn(),Vn(),Vn())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E2{constructor(e,t,o,c){this.Re=e,this.removedTargetIds=t,this.key=o,this.Ve=c}}class t8{constructor(e,t){this.targetId=e,this.me=t}}class i8{constructor(e,t,o=ba.EMPTY_BYTE_STRING,c=null){this.state=e,this.targetIds=t,this.resumeToken=o,this.cause=c}}class $L{constructor(){this.fe=0,this.ge=HL(),this.pe=ba.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Vn(),t=Vn(),o=Vn();return this.ge.forEach((c,f)=>{switch(f){case 0:e=e.add(c);break;case 2:t=t.add(c);break;case 1:o=o.add(c);break;default:tn()}}),new Vx(this.pe,this.ye,e,t,o)}Ce(){this.we=!1,this.ge=HL()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,xs(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Uie{constructor(e){this.Le=e,this.Be=new Map,this.ke=Rd(),this.qe=GL(),this.Qe=new ao(ns)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const o=this.Ge(t);switch(e.state){case 0:this.ze(t)&&o.De(e.resumeToken);break;case 1:o.Oe(),o.Se||o.Ce(),o.De(e.resumeToken);break;case 2:o.Oe(),o.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(o.Ne(),o.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),o.De(e.resumeToken));break;default:tn()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((o,c)=>{this.ze(c)&&t(c)})}He(e){const t=e.targetId,o=e.me.count,c=this.Je(t);if(c){const f=c.target;if(U5(f))if(o===0){const y=new Or(f.path);this.Ue(t,y,Va.newNoDocument(y,ln.min()))}else xs(o===1);else{const y=this.Ye(t);if(y!==o){const s=this.Ze(e),E=s?this.Xe(s,e,y):1;if(E!==0){this.je(t);const R=E===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,R)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:o="",padding:c=0},hashCount:f=0}=t;let y,s;try{y=Dm(o).toUint8Array()}catch(E){if(E instanceof DV)return v0("Decoding the base64 bloom filter in existence filter failed ("+E.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw E}try{s=new hR(y,c,f)}catch(E){return v0(E instanceof i1?"BloomFilter error: ":"Applying bloom filter failed: ",E),null}return s.Ie===0?null:s}Xe(e,t,o){return t.me.count===o-this.nt(e,t.targetId)?0:2}nt(e,t){const o=this.Le.getRemoteKeysForTarget(t);let c=0;return o.forEach(f=>{const y=this.Le.tt(),s=`projects/${y.projectId}/databases/${y.database}/documents/${f.path.canonicalString()}`;e.mightContain(s)||(this.Ue(t,f,null),c++)}),c}rt(e){const t=new Map;this.Be.forEach((f,y)=>{const s=this.Je(y);if(s){if(f.current&&U5(s.target)){const E=new Or(s.target.path);this.ke.get(E)!==null||this.it(y,E)||this.Ue(y,E,Va.newNoDocument(E,e))}f.be&&(t.set(y,f.ve()),f.Ce())}});let o=Vn();this.qe.forEach((f,y)=>{let s=!0;y.forEachWhile(E=>{const R=this.Je(E);return!R||R.purpose==="TargetPurposeLimboResolution"||(s=!1,!1)}),s&&(o=o.add(f))}),this.ke.forEach((f,y)=>y.setReadTime(e));const c=new TE(e,t,this.Qe,this.ke,o);return this.ke=Rd(),this.qe=GL(),this.Qe=new ao(ns),c}$e(e,t){if(!this.ze(e))return;const o=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,o),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,o){if(!this.ze(e))return;const c=this.Ge(e);this.it(e,t)?c.Fe(t,1):c.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),o&&(this.ke=this.ke.insert(t,o))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new $L,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new va(ns),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||pr("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new $L),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function GL(){return new ao(Or.comparator)}function HL(){return new ao(Or.comparator)}const jie={asc:"ASCENDING",desc:"DESCENDING"},$ie={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Gie={and:"AND",or:"OR"};class Hie{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function $5(r,e){return r.useProto3Json||_E(e)?e:{value:e}}function pT(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function r8(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function qie(r,e){return pT(r,e.toTimestamp())}function ph(r){return xs(!!r),ln.fromTimestamp(function(t){const o=np(t);return new Mo(o.seconds,o.nanos)}(r))}function dR(r,e){return G5(r,e).canonicalString()}function G5(r,e){const t=function(c){return new Ks(["projects",c.projectId,"databases",c.database])}(r).child("documents");return e===void 0?t:t.child(e)}function n8(r){const e=Ks.fromString(r);return xs(c8(e)),e}function H5(r,e){return dR(r.databaseId,e.path)}function gA(r,e){const t=n8(e);if(t.get(1)!==r.databaseId.projectId)throw new Sr(yi.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new Sr(yi.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new Or(o8(t))}function s8(r,e){return dR(r.databaseId,e)}function Wie(r){const e=n8(r);return e.length===4?Ks.emptyPath():o8(e)}function q5(r){return new Ks(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function o8(r){return xs(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function qL(r,e,t){return{name:H5(r,e),fields:t.value.mapValue.fields}}function Xie(r,e){let t;if("targetChange"in e){e.targetChange;const o=function(R){return R==="NO_CHANGE"?0:R==="ADD"?1:R==="REMOVE"?2:R==="CURRENT"?3:R==="RESET"?4:tn()}(e.targetChange.targetChangeType||"NO_CHANGE"),c=e.targetChange.targetIds||[],f=function(R,O){return R.useProto3Json?(xs(O===void 0||typeof O=="string"),ba.fromBase64String(O||"")):(xs(O===void 0||O instanceof Buffer||O instanceof Uint8Array),ba.fromUint8Array(O||new Uint8Array))}(r,e.targetChange.resumeToken),y=e.targetChange.cause,s=y&&function(R){const O=R.code===void 0?yi.UNKNOWN:e8(R.code);return new Sr(O,R.message||"")}(y);t=new i8(o,c,f,s||null)}else if("documentChange"in e){e.documentChange;const o=e.documentChange;o.document,o.document.name,o.document.updateTime;const c=gA(r,o.document.name),f=ph(o.document.updateTime),y=o.document.createTime?ph(o.document.createTime):ln.min(),s=new Pc({mapValue:{fields:o.document.fields}}),E=Va.newFoundDocument(c,f,y,s),R=o.targetIds||[],O=o.removedTargetIds||[];t=new E2(R,O,E.key,E)}else if("documentDelete"in e){e.documentDelete;const o=e.documentDelete;o.document;const c=gA(r,o.document),f=o.readTime?ph(o.readTime):ln.min(),y=Va.newNoDocument(c,f),s=o.removedTargetIds||[];t=new E2([],s,y.key,y)}else if("documentRemove"in e){e.documentRemove;const o=e.documentRemove;o.document;const c=gA(r,o.document),f=o.removedTargetIds||[];t=new E2([],f,c,null)}else{if(!("filter"in e))return tn();{e.filter;const o=e.filter;o.targetId;const{count:c=0,unchangedNames:f}=o,y=new zie(c,f),s=o.targetId;t=new t8(s,y)}}return t}function Zie(r,e){let t;if(e instanceof Bx)t={update:qL(r,e.key,e.value)};else if(e instanceof QV)t={delete:H5(r,e.key)};else if(e instanceof Xm)t={update:qL(r,e.key,e.data),updateMask:nre(e.fieldMask)};else{if(!(e instanceof Lie))return tn();t={verify:H5(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(o=>function(f,y){const s=y.transform;if(s instanceof dT)return{fieldPath:y.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof T0)return{fieldPath:y.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof lx)return{fieldPath:y.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof fT)return{fieldPath:y.field.canonicalString(),increment:s.Pe};throw tn()}(0,o))),e.precondition.isNone||(t.currentDocument=function(c,f){return f.updateTime!==void 0?{updateTime:qie(c,f.updateTime)}:f.exists!==void 0?{exists:f.exists}:tn()}(r,e.precondition)),t}function Kie(r,e){return r&&r.length>0?(xs(e!==void 0),r.map(t=>function(c,f){let y=c.updateTime?ph(c.updateTime):ph(f);return y.isEqual(ln.min())&&(y=ph(f)),new Mie(y,c.transformResults||[])}(t,e))):[]}function Yie(r,e){return{documents:[s8(r,e.path)]}}function Jie(r,e){const t={structuredQuery:{}},o=e.path;let c;e.collectionGroup!==null?(c=o,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(c=o.popLast(),t.structuredQuery.from=[{collectionId:o.lastSegment()}]),t.parent=s8(r,c);const f=function(R){if(R.length!==0)return l8(vh.create(R,"and"))}(e.filters);f&&(t.structuredQuery.where=f);const y=function(R){if(R.length!==0)return R.map(O=>function(U){return{field:Rg(U.field),direction:tre(U.dir)}}(O))}(e.orderBy);y&&(t.structuredQuery.orderBy=y);const s=$5(r,e.limit);return s!==null&&(t.structuredQuery.limit=s),e.startAt&&(t.structuredQuery.startAt=function(R){return{before:R.inclusive,values:R.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(R){return{before:!R.inclusive,values:R.position}}(e.endAt)),{_t:t,parent:c}}function Qie(r){let e=Wie(r.parent);const t=r.structuredQuery,o=t.from?t.from.length:0;let c=null;if(o>0){xs(o===1);const O=t.from[0];O.allDescendants?c=O.collectionId:e=e.child(O.collectionId)}let f=[];t.where&&(f=function(A){const U=a8(A);return U instanceof vh&&zV(U)?U.getFilters():[U]}(t.where));let y=[];t.orderBy&&(y=function(A){return A.map(U=>function(te){return new hT(Pg(te.field),function(de){switch(de){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(te.direction))}(U))}(t.orderBy));let s=null;t.limit&&(s=function(A){let U;return U=typeof A=="object"?A.value:A,_E(U)?null:U}(t.limit));let E=null;t.startAt&&(E=function(A){const U=!!A.before,$=A.values||[];return new uT($,U)}(t.startAt));let R=null;return t.endAt&&(R=function(A){const U=!A.before,$=A.values||[];return new uT($,U)}(t.endAt)),_ie(e,c,y,f,s,"F",E,R)}function ere(r,e){const t=function(c){switch(c){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return tn()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function a8(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const o=Pg(t.unaryFilter.field);return Vo.create(o,"==",{doubleValue:NaN});case"IS_NULL":const c=Pg(t.unaryFilter.field);return Vo.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const f=Pg(t.unaryFilter.field);return Vo.create(f,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const y=Pg(t.unaryFilter.field);return Vo.create(y,"!=",{nullValue:"NULL_VALUE"});default:return tn()}}(r):r.fieldFilter!==void 0?function(t){return Vo.create(Pg(t.fieldFilter.field),function(c){switch(c){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return tn()}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return vh.create(t.compositeFilter.filters.map(o=>a8(o)),function(c){switch(c){case"AND":return"and";case"OR":return"or";default:return tn()}}(t.compositeFilter.op))}(r):tn()}function tre(r){return jie[r]}function ire(r){return $ie[r]}function rre(r){return Gie[r]}function Rg(r){return{fieldPath:r.canonicalString()}}function Pg(r){return ma.fromServerFormat(r.fieldPath)}function l8(r){return r instanceof Vo?function(t){if(t.op==="=="){if(kL(t.value))return{unaryFilter:{field:Rg(t.field),op:"IS_NAN"}};if(ML(t.value))return{unaryFilter:{field:Rg(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(kL(t.value))return{unaryFilter:{field:Rg(t.field),op:"IS_NOT_NAN"}};if(ML(t.value))return{unaryFilter:{field:Rg(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Rg(t.field),op:ire(t.op),value:t.value}}}(r):r instanceof vh?function(t){const o=t.getFilters().map(c=>l8(c));return o.length===1?o[0]:{compositeFilter:{op:rre(t.op),filters:o}}}(r):tn()}function nre(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function c8(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nf{constructor(e,t,o,c,f=ln.min(),y=ln.min(),s=ba.EMPTY_BYTE_STRING,E=null){this.target=e,this.targetId=t,this.purpose=o,this.sequenceNumber=c,this.snapshotVersion=f,this.lastLimboFreeSnapshotVersion=y,this.resumeToken=s,this.expectedCount=E}withSequenceNumber(e){return new Nf(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Nf(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Nf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Nf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sre{constructor(e){this.ct=e}}function ore(r){const e=Qie({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?j5(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class are{constructor(){this.un=new lre}addToCollectionParentIndex(e,t){return this.un.add(t),vi.resolve()}getCollectionParents(e,t){return vi.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return vi.resolve()}deleteFieldIndex(e,t){return vi.resolve()}deleteAllFieldIndexes(e){return vi.resolve()}createTargetIndexes(e,t){return vi.resolve()}getDocumentsMatchingTarget(e,t){return vi.resolve(null)}getIndexType(e,t){return vi.resolve(0)}getFieldIndexes(e,t){return vi.resolve([])}getNextCollectionGroupToUpdate(e){return vi.resolve(null)}getMinOffset(e,t){return vi.resolve(rp.min())}getMinOffsetFromCollectionGroup(e,t){return vi.resolve(rp.min())}updateCollectionGroup(e,t,o){return vi.resolve()}updateIndexEntries(e,t){return vi.resolve()}}class lre{constructor(){this.index={}}add(e){const t=e.lastSegment(),o=e.popLast(),c=this.index[t]||new va(Ks.comparator),f=!c.has(o);return this.index[t]=c.add(o),f}has(e){const t=e.lastSegment(),o=e.popLast(),c=this.index[t];return c&&c.has(o)}getEntries(e){return(this.index[e]||new va(Ks.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E0{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new E0(0)}static kn(){return new E0(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cre{constructor(){this.changes=new q0(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Va.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const o=this.changes.get(t);return o!==void 0?vi.resolve(o):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ure{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hre{constructor(e,t,o,c){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=o,this.indexManager=c}getDocument(e,t){let o=null;return this.documentOverlayCache.getOverlay(e,t).next(c=>(o=c,this.remoteDocumentCache.getEntry(e,t))).next(c=>(o!==null&&A1(o.mutation,c,uu.empty(),Mo.now()),c))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(o=>this.getLocalViewOfDocuments(e,o,Vn()).next(()=>o))}getLocalViewOfDocuments(e,t,o=Vn()){const c=lm();return this.populateOverlays(e,c,t).next(()=>this.computeViews(e,t,c,o).next(f=>{let y=t1();return f.forEach((s,E)=>{y=y.insert(s,E.overlayedDocument)}),y}))}getOverlayedDocuments(e,t){const o=lm();return this.populateOverlays(e,o,t).next(()=>this.computeViews(e,t,o,Vn()))}populateOverlays(e,t,o){const c=[];return o.forEach(f=>{t.has(f)||c.push(f)}),this.documentOverlayCache.getOverlays(e,c).next(f=>{f.forEach((y,s)=>{t.set(y,s)})})}computeViews(e,t,o,c){let f=Rd();const y=S1(),s=function(){return S1()}();return t.forEach((E,R)=>{const O=o.get(R.key);c.has(R.key)&&(O===void 0||O.mutation instanceof Xm)?f=f.insert(R.key,R):O!==void 0?(y.set(R.key,O.mutation.getFieldMask()),A1(O.mutation,R,O.mutation.getFieldMask(),Mo.now())):y.set(R.key,uu.empty())}),this.recalculateAndSaveOverlays(e,f).next(E=>(E.forEach((R,O)=>y.set(R,O)),t.forEach((R,O)=>{var A;return s.set(R,new ure(O,(A=y.get(R))!==null&&A!==void 0?A:null))}),s))}recalculateAndSaveOverlays(e,t){const o=S1();let c=new ao((y,s)=>y-s),f=Vn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(y=>{for(const s of y)s.keys().forEach(E=>{const R=t.get(E);if(R===null)return;let O=o.get(E)||uu.empty();O=s.applyToLocalView(R,O),o.set(E,O);const A=(c.get(s.batchId)||Vn()).add(E);c=c.insert(s.batchId,A)})}).next(()=>{const y=[],s=c.getReverseIterator();for(;s.hasNext();){const E=s.getNext(),R=E.key,O=E.value,A=HV();O.forEach(U=>{if(!f.has(U)){const $=YV(t.get(U),o.get(U));$!==null&&A.set(U,$),f=f.add(U)}}),y.push(this.documentOverlayCache.saveOverlays(e,R,A))}return vi.waitFor(y)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(o=>this.recalculateAndSaveOverlays(e,o))}getDocumentsMatchingQuery(e,t,o,c){return function(y){return Or.isDocumentKey(y.path)&&y.collectionGroup===null&&y.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):gie(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,o,c):this.getDocumentsMatchingCollectionQuery(e,t,o,c)}getNextDocuments(e,t,o,c){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,o,c).next(f=>{const y=c-f.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,o.largestBatchId,c-f.size):vi.resolve(lm());let s=-1,E=f;return y.next(R=>vi.forEach(R,(O,A)=>(s<A.largestBatchId&&(s=A.largestBatchId),f.get(O)?vi.resolve():this.remoteDocumentCache.getEntry(e,O).next(U=>{E=E.insert(O,U)}))).next(()=>this.populateOverlays(e,R,f)).next(()=>this.computeViews(e,E,R,Vn())).next(O=>({batchId:s,changes:GV(O)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Or(t)).next(o=>{let c=t1();return o.isFoundDocument()&&(c=c.insert(o.key,o)),c})}getDocumentsMatchingCollectionGroupQuery(e,t,o,c){const f=t.collectionGroup;let y=t1();return this.indexManager.getCollectionParents(e,f).next(s=>vi.forEach(s,E=>{const R=function(A,U){return new gE(U,null,A.explicitOrderBy.slice(),A.filters.slice(),A.limit,A.limitType,A.startAt,A.endAt)}(t,E.child(f));return this.getDocumentsMatchingCollectionQuery(e,R,o,c).next(O=>{O.forEach((A,U)=>{y=y.insert(A,U)})})}).next(()=>y))}getDocumentsMatchingCollectionQuery(e,t,o,c){let f;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,o.largestBatchId).next(y=>(f=y,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,o,f,c))).next(y=>{f.forEach((E,R)=>{const O=R.getKey();y.get(O)===null&&(y=y.insert(O,Va.newInvalidDocument(O)))});let s=t1();return y.forEach((E,R)=>{const O=f.get(E);O!==void 0&&A1(O.mutation,R,uu.empty(),Mo.now()),xE(t,R)&&(s=s.insert(E,R))}),s})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dre{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return vi.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(c){return{id:c.id,version:c.version,createTime:ph(c.createTime)}}(t)),vi.resolve()}getNamedQuery(e,t){return vi.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(c){return{name:c.name,query:ore(c.bundledQuery),readTime:ph(c.readTime)}}(t)),vi.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fre{constructor(){this.overlays=new ao(Or.comparator),this.Ir=new Map}getOverlay(e,t){return vi.resolve(this.overlays.get(t))}getOverlays(e,t){const o=lm();return vi.forEach(t,c=>this.getOverlay(e,c).next(f=>{f!==null&&o.set(c,f)})).next(()=>o)}saveOverlays(e,t,o){return o.forEach((c,f)=>{this.ht(e,t,f)}),vi.resolve()}removeOverlaysForBatchId(e,t,o){const c=this.Ir.get(o);return c!==void 0&&(c.forEach(f=>this.overlays=this.overlays.remove(f)),this.Ir.delete(o)),vi.resolve()}getOverlaysForCollection(e,t,o){const c=lm(),f=t.length+1,y=new Or(t.child("")),s=this.overlays.getIteratorFrom(y);for(;s.hasNext();){const E=s.getNext().value,R=E.getKey();if(!t.isPrefixOf(R.path))break;R.path.length===f&&E.largestBatchId>o&&c.set(E.getKey(),E)}return vi.resolve(c)}getOverlaysForCollectionGroup(e,t,o,c){let f=new ao((R,O)=>R-O);const y=this.overlays.getIterator();for(;y.hasNext();){const R=y.getNext().value;if(R.getKey().getCollectionGroup()===t&&R.largestBatchId>o){let O=f.get(R.largestBatchId);O===null&&(O=lm(),f=f.insert(R.largestBatchId,O)),O.set(R.getKey(),R)}}const s=lm(),E=f.getIterator();for(;E.hasNext()&&(E.getNext().value.forEach((R,O)=>s.set(R,O)),!(s.size()>=c)););return vi.resolve(s)}ht(e,t,o){const c=this.overlays.get(o.key);if(c!==null){const y=this.Ir.get(c.largestBatchId).delete(o.key);this.Ir.set(c.largestBatchId,y)}this.overlays=this.overlays.insert(o.key,new Fie(t,o));let f=this.Ir.get(t);f===void 0&&(f=Vn(),this.Ir.set(t,f)),this.Ir.set(t,f.add(o.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pre{constructor(){this.sessionToken=ba.EMPTY_BYTE_STRING}getSessionToken(e){return vi.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,vi.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fR{constructor(){this.Tr=new va(ta.Er),this.dr=new va(ta.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const o=new ta(e,t);this.Tr=this.Tr.add(o),this.dr=this.dr.add(o)}Rr(e,t){e.forEach(o=>this.addReference(o,t))}removeReference(e,t){this.Vr(new ta(e,t))}mr(e,t){e.forEach(o=>this.removeReference(o,t))}gr(e){const t=new Or(new Ks([])),o=new ta(t,e),c=new ta(t,e+1),f=[];return this.dr.forEachInRange([o,c],y=>{this.Vr(y),f.push(y.key)}),f}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Or(new Ks([])),o=new ta(t,e),c=new ta(t,e+1);let f=Vn();return this.dr.forEachInRange([o,c],y=>{f=f.add(y.key)}),f}containsKey(e){const t=new ta(e,0),o=this.Tr.firstAfterOrEqual(t);return o!==null&&e.isEqual(o.key)}}class ta{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Or.comparator(e.key,t.key)||ns(e.wr,t.wr)}static Ar(e,t){return ns(e.wr,t.wr)||Or.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mre{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new va(ta.Er)}checkEmpty(e){return vi.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,o,c){const f=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const y=new Oie(f,t,o,c);this.mutationQueue.push(y);for(const s of c)this.br=this.br.add(new ta(s.key,f)),this.indexManager.addToCollectionParentIndex(e,s.key.path.popLast());return vi.resolve(y)}lookupMutationBatch(e,t){return vi.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const o=t+1,c=this.vr(o),f=c<0?0:c;return vi.resolve(this.mutationQueue.length>f?this.mutationQueue[f]:null)}getHighestUnacknowledgedBatchId(){return vi.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return vi.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const o=new ta(t,0),c=new ta(t,Number.POSITIVE_INFINITY),f=[];return this.br.forEachInRange([o,c],y=>{const s=this.Dr(y.wr);f.push(s)}),vi.resolve(f)}getAllMutationBatchesAffectingDocumentKeys(e,t){let o=new va(ns);return t.forEach(c=>{const f=new ta(c,0),y=new ta(c,Number.POSITIVE_INFINITY);this.br.forEachInRange([f,y],s=>{o=o.add(s.wr)})}),vi.resolve(this.Cr(o))}getAllMutationBatchesAffectingQuery(e,t){const o=t.path,c=o.length+1;let f=o;Or.isDocumentKey(f)||(f=f.child(""));const y=new ta(new Or(f),0);let s=new va(ns);return this.br.forEachWhile(E=>{const R=E.key.path;return!!o.isPrefixOf(R)&&(R.length===c&&(s=s.add(E.wr)),!0)},y),vi.resolve(this.Cr(s))}Cr(e){const t=[];return e.forEach(o=>{const c=this.Dr(o);c!==null&&t.push(c)}),t}removeMutationBatch(e,t){xs(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let o=this.br;return vi.forEach(t.mutations,c=>{const f=new ta(c.key,t.batchId);return o=o.delete(f),this.referenceDelegate.markPotentiallyOrphaned(e,c.key)}).next(()=>{this.br=o})}On(e){}containsKey(e,t){const o=new ta(t,0),c=this.br.firstAfterOrEqual(o);return vi.resolve(t.isEqual(c&&c.key))}performConsistencyCheck(e){return this.mutationQueue.length,vi.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _re{constructor(e){this.Mr=e,this.docs=function(){return new ao(Or.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const o=t.key,c=this.docs.get(o),f=c?c.size:0,y=this.Mr(t);return this.docs=this.docs.insert(o,{document:t.mutableCopy(),size:y}),this.size+=y-f,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const o=this.docs.get(t);return vi.resolve(o?o.document.mutableCopy():Va.newInvalidDocument(t))}getEntries(e,t){let o=Rd();return t.forEach(c=>{const f=this.docs.get(c);o=o.insert(c,f?f.document.mutableCopy():Va.newInvalidDocument(c))}),vi.resolve(o)}getDocumentsMatchingQuery(e,t,o,c){let f=Rd();const y=t.path,s=new Or(y.child("")),E=this.docs.getIteratorFrom(s);for(;E.hasNext();){const{key:R,value:{document:O}}=E.getNext();if(!y.isPrefixOf(R.path))break;R.path.length>y.length+1||Yte(Kte(O),o)<=0||(c.has(O.key)||xE(t,O))&&(f=f.insert(O.key,O.mutableCopy()))}return vi.resolve(f)}getAllFromCollectionGroup(e,t,o,c){tn()}Or(e,t){return vi.forEach(this.docs,o=>t(o))}newChangeBuffer(e){return new gre(this)}getSize(e){return vi.resolve(this.size)}}class gre extends cre{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((o,c)=>{c.isValidDocument()?t.push(this.cr.addEntry(e,c)):this.cr.removeEntry(o)}),vi.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yre{constructor(e){this.persistence=e,this.Nr=new q0(t=>aR(t),lR),this.lastRemoteSnapshotVersion=ln.min(),this.highestTargetId=0,this.Lr=0,this.Br=new fR,this.targetCount=0,this.kr=E0.Bn()}forEachTarget(e,t){return this.Nr.forEach((o,c)=>t(c)),vi.resolve()}getLastRemoteSnapshotVersion(e){return vi.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return vi.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),vi.resolve(this.highestTargetId)}setTargetsMetadata(e,t,o){return o&&(this.lastRemoteSnapshotVersion=o),t>this.Lr&&(this.Lr=t),vi.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new E0(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,vi.resolve()}updateTargetData(e,t){return this.Kn(t),vi.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,vi.resolve()}removeTargets(e,t,o){let c=0;const f=[];return this.Nr.forEach((y,s)=>{s.sequenceNumber<=t&&o.get(s.targetId)===null&&(this.Nr.delete(y),f.push(this.removeMatchingKeysForTargetId(e,s.targetId)),c++)}),vi.waitFor(f).next(()=>c)}getTargetCount(e){return vi.resolve(this.targetCount)}getTargetData(e,t){const o=this.Nr.get(t)||null;return vi.resolve(o)}addMatchingKeys(e,t,o){return this.Br.Rr(t,o),vi.resolve()}removeMatchingKeys(e,t,o){this.Br.mr(t,o);const c=this.persistence.referenceDelegate,f=[];return c&&t.forEach(y=>{f.push(c.markPotentiallyOrphaned(e,y))}),vi.waitFor(f)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),vi.resolve()}getMatchingKeysForTargetId(e,t){const o=this.Br.yr(t);return vi.resolve(o)}containsKey(e,t){return vi.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vre{constructor(e,t){this.qr={},this.overlays={},this.Qr=new rR(0),this.Kr=!1,this.Kr=!0,this.$r=new pre,this.referenceDelegate=e(this),this.Ur=new yre(this),this.indexManager=new are,this.remoteDocumentCache=function(c){return new _re(c)}(o=>this.referenceDelegate.Wr(o)),this.serializer=new sre(t),this.Gr=new dre(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new fre,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let o=this.qr[e.toKey()];return o||(o=new mre(t,this.referenceDelegate),this.qr[e.toKey()]=o),o}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,o){pr("MemoryPersistence","Starting transaction:",e);const c=new xre(this.Qr.next());return this.referenceDelegate.zr(),o(c).next(f=>this.referenceDelegate.jr(c).next(()=>f)).toPromise().then(f=>(c.raiseOnCommittedEvent(),f))}Hr(e,t){return vi.or(Object.values(this.qr).map(o=>()=>o.containsKey(e,t)))}}class xre extends Qte{constructor(e){super(),this.currentSequenceNumber=e}}class pR{constructor(e){this.persistence=e,this.Jr=new fR,this.Yr=null}static Zr(e){return new pR(e)}get Xr(){if(this.Yr)return this.Yr;throw tn()}addReference(e,t,o){return this.Jr.addReference(o,t),this.Xr.delete(o.toString()),vi.resolve()}removeReference(e,t,o){return this.Jr.removeReference(o,t),this.Xr.add(o.toString()),vi.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),vi.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(c=>this.Xr.add(c.toString()));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,t.targetId).next(c=>{c.forEach(f=>this.Xr.add(f.toString()))}).next(()=>o.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return vi.forEach(this.Xr,o=>{const c=Or.fromPath(o);return this.ei(e,c).next(f=>{f||t.removeEntry(c,ln.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(o=>{o?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return vi.or([()=>vi.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mR{constructor(e,t,o,c){this.targetId=e,this.fromCache=t,this.$i=o,this.Ui=c}static Wi(e,t){let o=Vn(),c=Vn();for(const f of t.docChanges)switch(f.type){case 0:o=o.add(f.doc.key);break;case 1:c=c.add(f.doc.key)}return new mR(e,t.fromCache,o,c)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bre{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wre{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return UX()?8:eie(Wa())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,o,c){const f={result:null};return this.Yi(e,t).next(y=>{f.result=y}).next(()=>{if(!f.result)return this.Zi(e,t,c,o).next(y=>{f.result=y})}).next(()=>{if(f.result)return;const y=new bre;return this.Xi(e,t,y).next(s=>{if(f.result=s,this.zi)return this.es(e,t,y,s.size)})}).next(()=>f.result)}es(e,t,o,c){return o.documentReadCount<this.ji?(Vv()<=Bn.DEBUG&&pr("QueryEngine","SDK will not create cache indexes for query:",Cg(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),vi.resolve()):(Vv()<=Bn.DEBUG&&pr("QueryEngine","Query:",Cg(t),"scans",o.documentReadCount,"local documents and returns",c,"documents as results."),o.documentReadCount>this.Hi*c?(Vv()<=Bn.DEBUG&&pr("QueryEngine","The SDK decides to create cache indexes for query:",Cg(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,dh(t))):vi.resolve())}Yi(e,t){if(FL(t))return vi.resolve(null);let o=dh(t);return this.indexManager.getIndexType(e,o).next(c=>c===0?null:(t.limit!==null&&c===1&&(t=j5(t,null,"F"),o=dh(t)),this.indexManager.getDocumentsMatchingTarget(e,o).next(f=>{const y=Vn(...f);return this.Ji.getDocuments(e,y).next(s=>this.indexManager.getMinOffset(e,o).next(E=>{const R=this.ts(t,s);return this.ns(t,R,y,E.readTime)?this.Yi(e,j5(t,null,"F")):this.rs(e,R,t,E)}))})))}Zi(e,t,o,c){return FL(t)||c.isEqual(ln.min())?vi.resolve(null):this.Ji.getDocuments(e,o).next(f=>{const y=this.ts(t,f);return this.ns(t,y,o,c)?vi.resolve(null):(Vv()<=Bn.DEBUG&&pr("QueryEngine","Re-using previous result from %s to execute query: %s",c.toString(),Cg(t)),this.rs(e,y,t,Zte(c,-1)).next(s=>s))})}ts(e,t){let o=new va(jV(e));return t.forEach((c,f)=>{xE(e,f)&&(o=o.add(f))}),o}ns(e,t,o,c){if(e.limit===null)return!1;if(o.size!==t.size)return!0;const f=e.limitType==="F"?t.last():t.first();return!!f&&(f.hasPendingWrites||f.version.compareTo(c)>0)}Xi(e,t,o){return Vv()<=Bn.DEBUG&&pr("QueryEngine","Using full collection scan to execute query:",Cg(t)),this.Ji.getDocumentsMatchingQuery(e,t,rp.min(),o)}rs(e,t,o,c){return this.Ji.getDocumentsMatchingQuery(e,o,c).next(f=>(t.forEach(y=>{f=f.insert(y.key,y)}),f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tre{constructor(e,t,o,c){this.persistence=e,this.ss=t,this.serializer=c,this.os=new ao(ns),this._s=new q0(f=>aR(f),lR),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(o)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new hre(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function Ere(r,e,t,o){return new Tre(r,e,t,o)}async function u8(r,e){const t=cn(r);return await t.persistence.runTransaction("Handle user change","readonly",o=>{let c;return t.mutationQueue.getAllMutationBatches(o).next(f=>(c=f,t.ls(e),t.mutationQueue.getAllMutationBatches(o))).next(f=>{const y=[],s=[];let E=Vn();for(const R of c){y.push(R.batchId);for(const O of R.mutations)E=E.add(O.key)}for(const R of f){s.push(R.batchId);for(const O of R.mutations)E=E.add(O.key)}return t.localDocuments.getDocuments(o,E).next(R=>({hs:R,removedBatchIds:y,addedBatchIds:s}))})})}function Ire(r,e){const t=cn(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",o=>{const c=e.batch.keys(),f=t.cs.newChangeBuffer({trackRemovals:!0});return function(s,E,R,O){const A=R.batch,U=A.keys();let $=vi.resolve();return U.forEach(te=>{$=$.next(()=>O.getEntry(E,te)).next(Q=>{const de=R.docVersions.get(te);xs(de!==null),Q.version.compareTo(de)<0&&(A.applyToRemoteDocument(Q,R),Q.isValidDocument()&&(Q.setReadTime(R.commitVersion),O.addEntry(Q)))})}),$.next(()=>s.mutationQueue.removeMutationBatch(E,A))}(t,o,e,f).next(()=>f.apply(o)).next(()=>t.mutationQueue.performConsistencyCheck(o)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(o,c,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,function(s){let E=Vn();for(let R=0;R<s.mutationResults.length;++R)s.mutationResults[R].transformResults.length>0&&(E=E.add(s.batch.mutations[R].key));return E}(e))).next(()=>t.localDocuments.getDocuments(o,c))})}function h8(r){const e=cn(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function Sre(r,e){const t=cn(r),o=e.snapshotVersion;let c=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",f=>{const y=t.cs.newChangeBuffer({trackRemovals:!0});c=t.os;const s=[];e.targetChanges.forEach((O,A)=>{const U=c.get(A);if(!U)return;s.push(t.Ur.removeMatchingKeys(f,O.removedDocuments,A).next(()=>t.Ur.addMatchingKeys(f,O.addedDocuments,A)));let $=U.withSequenceNumber(f.currentSequenceNumber);e.targetMismatches.get(A)!==null?$=$.withResumeToken(ba.EMPTY_BYTE_STRING,ln.min()).withLastLimboFreeSnapshotVersion(ln.min()):O.resumeToken.approximateByteSize()>0&&($=$.withResumeToken(O.resumeToken,o)),c=c.insert(A,$),function(Q,de,Ce){return Q.resumeToken.approximateByteSize()===0||de.snapshotVersion.toMicroseconds()-Q.snapshotVersion.toMicroseconds()>=3e8?!0:Ce.addedDocuments.size+Ce.modifiedDocuments.size+Ce.removedDocuments.size>0}(U,$,O)&&s.push(t.Ur.updateTargetData(f,$))});let E=Rd(),R=Vn();if(e.documentUpdates.forEach(O=>{e.resolvedLimboDocuments.has(O)&&s.push(t.persistence.referenceDelegate.updateLimboDocument(f,O))}),s.push(Are(f,y,e.documentUpdates).next(O=>{E=O.Ps,R=O.Is})),!o.isEqual(ln.min())){const O=t.Ur.getLastRemoteSnapshotVersion(f).next(A=>t.Ur.setTargetsMetadata(f,f.currentSequenceNumber,o));s.push(O)}return vi.waitFor(s).next(()=>y.apply(f)).next(()=>t.localDocuments.getLocalViewOfDocuments(f,E,R)).next(()=>E)}).then(f=>(t.os=c,f))}function Are(r,e,t){let o=Vn(),c=Vn();return t.forEach(f=>o=o.add(f)),e.getEntries(r,o).next(f=>{let y=Rd();return t.forEach((s,E)=>{const R=f.get(s);E.isFoundDocument()!==R.isFoundDocument()&&(c=c.add(s)),E.isNoDocument()&&E.version.isEqual(ln.min())?(e.removeEntry(s,E.readTime),y=y.insert(s,E)):!R.isValidDocument()||E.version.compareTo(R.version)>0||E.version.compareTo(R.version)===0&&R.hasPendingWrites?(e.addEntry(E),y=y.insert(s,E)):pr("LocalStore","Ignoring outdated watch update for ",s,". Current version:",R.version," Watch version:",E.version)}),{Ps:y,Is:c}})}function Cre(r,e){const t=cn(r);return t.persistence.runTransaction("Get next mutation batch","readonly",o=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(o,e)))}function Rre(r,e){const t=cn(r);return t.persistence.runTransaction("Allocate target","readwrite",o=>{let c;return t.Ur.getTargetData(o,e).next(f=>f?(c=f,vi.resolve(c)):t.Ur.allocateTargetId(o).next(y=>(c=new Nf(e,y,"TargetPurposeListen",o.currentSequenceNumber),t.Ur.addTargetData(o,c).next(()=>c))))}).then(o=>{const c=t.os.get(o.targetId);return(c===null||o.snapshotVersion.compareTo(c.snapshotVersion)>0)&&(t.os=t.os.insert(o.targetId,o),t._s.set(e,o.targetId)),o})}async function W5(r,e,t){const o=cn(r),c=o.os.get(e),f=t?"readwrite":"readwrite-primary";try{t||await o.persistence.runTransaction("Release target",f,y=>o.persistence.referenceDelegate.removeTarget(y,c))}catch(y){if(!Nx(y))throw y;pr("LocalStore",`Failed to update sequence numbers for target ${e}: ${y}`)}o.os=o.os.remove(e),o._s.delete(c.target)}function WL(r,e,t){const o=cn(r);let c=ln.min(),f=Vn();return o.persistence.runTransaction("Execute query","readwrite",y=>function(E,R,O){const A=cn(E),U=A._s.get(O);return U!==void 0?vi.resolve(A.os.get(U)):A.Ur.getTargetData(R,O)}(o,y,dh(e)).next(s=>{if(s)return c=s.lastLimboFreeSnapshotVersion,o.Ur.getMatchingKeysForTargetId(y,s.targetId).next(E=>{f=E})}).next(()=>o.ss.getDocumentsMatchingQuery(y,e,t?c:ln.min(),t?f:Vn())).next(s=>(Pre(o,vie(e),s),{documents:s,Ts:f})))}function Pre(r,e,t){let o=r.us.get(e)||ln.min();t.forEach((c,f)=>{f.readTime.compareTo(o)>0&&(o=f.readTime)}),r.us.set(e,o)}class XL{constructor(){this.activeTargetIds=Iie()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Mre{constructor(){this.so=new XL,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,o){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,o){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new XL,Promise.resolve()}handleUserChange(e,t,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kre{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZL{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){pr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){pr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gw=null;function yA(){return Gw===null?Gw=function(){return 268435456+Math.round(2147483648*Math.random())}():Gw++,"0x"+Gw.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dre={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lre{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ka="WebChannelConnection";class Ore extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const o=t.ssl?"https":"http",c=encodeURIComponent(this.databaseId.projectId),f=encodeURIComponent(this.databaseId.database);this.Do=o+"://"+t.host,this.vo=`projects/${c}/databases/${f}`,this.Co=this.databaseId.database==="(default)"?`project_id=${c}`:`project_id=${c}&database_id=${f}`}get Fo(){return!1}Mo(t,o,c,f,y){const s=yA(),E=this.xo(t,o.toUriEncodedString());pr("RestConnection",`Sending RPC '${t}' ${s}:`,E,c);const R={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(R,f,y),this.No(t,E,R,c).then(O=>(pr("RestConnection",`Received RPC '${t}' ${s}: `,O),O),O=>{throw v0("RestConnection",`RPC '${t}' ${s} failed with error: `,O,"url: ",E,"request:",c),O})}Lo(t,o,c,f,y,s){return this.Mo(t,o,c,f,y)}Oo(t,o,c){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+G0}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),o&&o.headers.forEach((f,y)=>t[y]=f),c&&c.headers.forEach((f,y)=>t[y]=f)}xo(t,o){const c=Dre[t];return`${this.Do}/v1/${o}:${c}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,o,c){const f=yA();return new Promise((y,s)=>{const E=new IV;E.setWithCredentials(!0),E.listenOnce(SV.COMPLETE,()=>{try{switch(E.getLastErrorCode()){case b2.NO_ERROR:const O=E.getResponseJson();pr(ka,`XHR for RPC '${e}' ${f} received:`,JSON.stringify(O)),y(O);break;case b2.TIMEOUT:pr(ka,`RPC '${e}' ${f} timed out`),s(new Sr(yi.DEADLINE_EXCEEDED,"Request time out"));break;case b2.HTTP_ERROR:const A=E.getStatus();if(pr(ka,`RPC '${e}' ${f} failed with status:`,A,"response text:",E.getResponseText()),A>0){let U=E.getResponseJson();Array.isArray(U)&&(U=U[0]);const $=U==null?void 0:U.error;if($&&$.status&&$.message){const te=function(de){const Ce=de.toLowerCase().replace(/_/g,"-");return Object.values(yi).indexOf(Ce)>=0?Ce:yi.UNKNOWN}($.status);s(new Sr(te,$.message))}else s(new Sr(yi.UNKNOWN,"Server responded with status "+E.getStatus()))}else s(new Sr(yi.UNAVAILABLE,"Connection failed."));break;default:tn()}}finally{pr(ka,`RPC '${e}' ${f} completed.`)}});const R=JSON.stringify(c);pr(ka,`RPC '${e}' ${f} sending request:`,c),E.send(t,"POST",R,o,15)})}Bo(e,t,o){const c=yA(),f=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],y=RV(),s=CV(),E={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},R=this.longPollingOptions.timeoutSeconds;R!==void 0&&(E.longPollingTimeout=Math.round(1e3*R)),this.useFetchStreams&&(E.useFetchStreams=!0),this.Oo(E.initMessageHeaders,t,o),E.encodeInitMessageHeaders=!0;const O=f.join("");pr(ka,`Creating RPC '${e}' stream ${c}: ${O}`,E);const A=y.createWebChannel(O,E);let U=!1,$=!1;const te=new Lre({Io:de=>{$?pr(ka,`Not sending because RPC '${e}' stream ${c} is closed:`,de):(U||(pr(ka,`Opening RPC '${e}' stream ${c} transport.`),A.open(),U=!0),pr(ka,`RPC '${e}' stream ${c} sending:`,de),A.send(de))},To:()=>A.close()}),Q=(de,Ce,Fe)=>{de.listen(Ce,Le=>{try{Fe(Le)}catch(Me){setTimeout(()=>{throw Me},0)}})};return Q(A,e1.EventType.OPEN,()=>{$||(pr(ka,`RPC '${e}' stream ${c} transport opened.`),te.yo())}),Q(A,e1.EventType.CLOSE,()=>{$||($=!0,pr(ka,`RPC '${e}' stream ${c} transport closed`),te.So())}),Q(A,e1.EventType.ERROR,de=>{$||($=!0,v0(ka,`RPC '${e}' stream ${c} transport errored:`,de),te.So(new Sr(yi.UNAVAILABLE,"The operation could not be completed")))}),Q(A,e1.EventType.MESSAGE,de=>{var Ce;if(!$){const Fe=de.data[0];xs(!!Fe);const Le=Fe,Me=Le.error||((Ce=Le[0])===null||Ce===void 0?void 0:Ce.error);if(Me){pr(ka,`RPC '${e}' stream ${c} received error:`,Me);const at=Me.status;let pt=function(Se){const ke=So[Se];if(ke!==void 0)return e8(ke)}(at),me=Me.message;pt===void 0&&(pt=yi.INTERNAL,me="Unknown error status: "+at+" with message "+Me.message),$=!0,te.So(new Sr(pt,me)),A.close()}else pr(ka,`RPC '${e}' stream ${c} received:`,Fe),te.bo(Fe)}}),Q(s,AV.STAT_EVENT,de=>{de.stat===z5.PROXY?pr(ka,`RPC '${e}' stream ${c} detected buffering proxy`):de.stat===z5.NOPROXY&&pr(ka,`RPC '${e}' stream ${c} detected no buffering proxy`)}),setTimeout(()=>{te.wo()},0),te}}function vA(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EE(r){return new Hie(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d8{constructor(e,t,o=1e3,c=1.5,f=6e4){this.ui=e,this.timerId=t,this.ko=o,this.qo=c,this.Qo=f,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),o=Math.max(0,Date.now()-this.Uo),c=Math.max(0,t-o);c>0&&pr("ExponentialBackoff",`Backing off for ${c} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${o} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,c,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f8{constructor(e,t,o,c,f,y,s,E){this.ui=e,this.Ho=o,this.Jo=c,this.connection=f,this.authCredentialsProvider=y,this.appCheckCredentialsProvider=s,this.listener=E,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new d8(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===yi.RESOURCE_EXHAUSTED?(Cd(t.toString()),Cd("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===yi.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([o,c])=>{this.Yo===t&&this.P_(o,c)},o=>{e(()=>{const c=new Sr(yi.UNKNOWN,"Fetching auth token failed: "+o.message);return this.I_(c)})})}P_(e,t){const o=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{o(()=>this.listener.Eo())}),this.stream.Ro(()=>{o(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(c=>{o(()=>this.I_(c))}),this.stream.onMessage(c=>{o(()=>++this.e_==1?this.E_(c):this.onNext(c))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return pr("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(pr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Fre extends f8{constructor(e,t,o,c,f,y){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,o,c,y),this.serializer=f}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=Xie(this.serializer,e),o=function(f){if(!("targetChange"in f))return ln.min();const y=f.targetChange;return y.targetIds&&y.targetIds.length?ln.min():y.readTime?ph(y.readTime):ln.min()}(e);return this.listener.d_(t,o)}A_(e){const t={};t.database=q5(this.serializer),t.addTarget=function(f,y){let s;const E=y.target;if(s=U5(E)?{documents:Yie(f,E)}:{query:Jie(f,E)._t},s.targetId=y.targetId,y.resumeToken.approximateByteSize()>0){s.resumeToken=r8(f,y.resumeToken);const R=$5(f,y.expectedCount);R!==null&&(s.expectedCount=R)}else if(y.snapshotVersion.compareTo(ln.min())>0){s.readTime=pT(f,y.snapshotVersion.toTimestamp());const R=$5(f,y.expectedCount);R!==null&&(s.expectedCount=R)}return s}(this.serializer,e);const o=ere(this.serializer,e);o&&(t.labels=o),this.a_(t)}R_(e){const t={};t.database=q5(this.serializer),t.removeTarget=e,this.a_(t)}}class zre extends f8{constructor(e,t,o,c,f,y){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,o,c,y),this.serializer=f}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return xs(!!e.streamToken),this.lastStreamToken=e.streamToken,xs(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){xs(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=Kie(e.writeResults,e.commitTime),o=ph(e.commitTime);return this.listener.g_(o,t)}p_(){const e={};e.database=q5(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(o=>Zie(this.serializer,o))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nre extends class{}{constructor(e,t,o,c){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=o,this.serializer=c,this.y_=!1}w_(){if(this.y_)throw new Sr(yi.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,o,c){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,y])=>this.connection.Mo(e,G5(t,o),c,f,y)).catch(f=>{throw f.name==="FirebaseError"?(f.code===yi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new Sr(yi.UNKNOWN,f.toString())})}Lo(e,t,o,c,f){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([y,s])=>this.connection.Lo(e,G5(t,o),c,y,s,f)).catch(y=>{throw y.name==="FirebaseError"?(y.code===yi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),y):new Sr(yi.UNKNOWN,y.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Bre{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Cd(t),this.D_=!1):pr("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vre{constructor(e,t,o,c,f){this.localStore=e,this.datastore=t,this.asyncQueue=o,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=f,this.k_._o(y=>{o.enqueueAndForget(async()=>{Zm(this)&&(pr("RemoteStore","Restarting streams for network reachability change."),await async function(E){const R=cn(E);R.L_.add(4),await Ux(R),R.q_.set("Unknown"),R.L_.delete(4),await IE(R)}(this))})}),this.q_=new Bre(o,c)}}async function IE(r){if(Zm(r))for(const e of r.B_)await e(!0)}async function Ux(r){for(const e of r.B_)await e(!1)}function p8(r,e){const t=cn(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),vR(t)?yR(t):W0(t).r_()&&gR(t,e))}function _R(r,e){const t=cn(r),o=W0(t);t.N_.delete(e),o.r_()&&m8(t,e),t.N_.size===0&&(o.r_()?o.o_():Zm(t)&&t.q_.set("Unknown"))}function gR(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ln.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}W0(r).A_(e)}function m8(r,e){r.Q_.xe(e),W0(r).R_(e)}function yR(r){r.Q_=new Uie({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),W0(r).start(),r.q_.v_()}function vR(r){return Zm(r)&&!W0(r).n_()&&r.N_.size>0}function Zm(r){return cn(r).L_.size===0}function _8(r){r.Q_=void 0}async function Ure(r){r.q_.set("Online")}async function jre(r){r.N_.forEach((e,t)=>{gR(r,e)})}async function $re(r,e){_8(r),vR(r)?(r.q_.M_(e),yR(r)):r.q_.set("Unknown")}async function Gre(r,e,t){if(r.q_.set("Online"),e instanceof i8&&e.state===2&&e.cause)try{await async function(c,f){const y=f.cause;for(const s of f.targetIds)c.N_.has(s)&&(await c.remoteSyncer.rejectListen(s,y),c.N_.delete(s),c.Q_.removeTarget(s))}(r,e)}catch(o){pr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),o),await mT(r,o)}else if(e instanceof E2?r.Q_.Ke(e):e instanceof t8?r.Q_.He(e):r.Q_.We(e),!t.isEqual(ln.min()))try{const o=await h8(r.localStore);t.compareTo(o)>=0&&await function(f,y){const s=f.Q_.rt(y);return s.targetChanges.forEach((E,R)=>{if(E.resumeToken.approximateByteSize()>0){const O=f.N_.get(R);O&&f.N_.set(R,O.withResumeToken(E.resumeToken,y))}}),s.targetMismatches.forEach((E,R)=>{const O=f.N_.get(E);if(!O)return;f.N_.set(E,O.withResumeToken(ba.EMPTY_BYTE_STRING,O.snapshotVersion)),m8(f,E);const A=new Nf(O.target,E,R,O.sequenceNumber);gR(f,A)}),f.remoteSyncer.applyRemoteEvent(s)}(r,t)}catch(o){pr("RemoteStore","Failed to raise snapshot:",o),await mT(r,o)}}async function mT(r,e,t){if(!Nx(e))throw e;r.L_.add(1),await Ux(r),r.q_.set("Offline"),t||(t=()=>h8(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{pr("RemoteStore","Retrying IndexedDB access"),await t(),r.L_.delete(1),await IE(r)})}function g8(r,e){return e().catch(t=>mT(r,t,e))}async function SE(r){const e=cn(r),t=sp(e);let o=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;Hre(e);)try{const c=await Cre(e.localStore,o);if(c===null){e.O_.length===0&&t.o_();break}o=c.batchId,qre(e,c)}catch(c){await mT(e,c)}y8(e)&&v8(e)}function Hre(r){return Zm(r)&&r.O_.length<10}function qre(r,e){r.O_.push(e);const t=sp(r);t.r_()&&t.V_&&t.m_(e.mutations)}function y8(r){return Zm(r)&&!sp(r).n_()&&r.O_.length>0}function v8(r){sp(r).start()}async function Wre(r){sp(r).p_()}async function Xre(r){const e=sp(r);for(const t of r.O_)e.m_(t.mutations)}async function Zre(r,e,t){const o=r.O_.shift(),c=uR.from(o,e,t);await g8(r,()=>r.remoteSyncer.applySuccessfulWrite(c)),await SE(r)}async function Kre(r,e){e&&sp(r).V_&&await async function(o,c){if(function(y){return Nie(y)&&y!==yi.ABORTED}(c.code)){const f=o.O_.shift();sp(o).s_(),await g8(o,()=>o.remoteSyncer.rejectFailedWrite(f.batchId,c)),await SE(o)}}(r,e),y8(r)&&v8(r)}async function KL(r,e){const t=cn(r);t.asyncQueue.verifyOperationInProgress(),pr("RemoteStore","RemoteStore received new credentials");const o=Zm(t);t.L_.add(3),await Ux(t),o&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await IE(t)}async function Yre(r,e){const t=cn(r);e?(t.L_.delete(2),await IE(t)):e||(t.L_.add(2),await Ux(t),t.q_.set("Unknown"))}function W0(r){return r.K_||(r.K_=function(t,o,c){const f=cn(t);return f.w_(),new Fre(o,f.connection,f.authCredentials,f.appCheckCredentials,f.serializer,c)}(r.datastore,r.asyncQueue,{Eo:Ure.bind(null,r),Ro:jre.bind(null,r),mo:$re.bind(null,r),d_:Gre.bind(null,r)}),r.B_.push(async e=>{e?(r.K_.s_(),vR(r)?yR(r):r.q_.set("Unknown")):(await r.K_.stop(),_8(r))})),r.K_}function sp(r){return r.U_||(r.U_=function(t,o,c){const f=cn(t);return f.w_(),new zre(o,f.connection,f.authCredentials,f.appCheckCredentials,f.serializer,c)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Wre.bind(null,r),mo:Kre.bind(null,r),f_:Xre.bind(null,r),g_:Zre.bind(null,r)}),r.B_.push(async e=>{e?(r.U_.s_(),await SE(r)):(await r.U_.stop(),r.O_.length>0&&(pr("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))})),r.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xR{constructor(e,t,o,c,f){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=o,this.op=c,this.removalCallback=f,this.deferred=new bd,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(y=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,o,c,f){const y=Date.now()+o,s=new xR(e,t,y,c,f);return s.start(o),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Sr(yi.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function bR(r,e){if(Cd("AsyncQueue",`${e}: ${r}`),Nx(r))return new Sr(yi.UNAVAILABLE,`${e}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0{constructor(e){this.comparator=e?(t,o)=>e(t,o)||Or.comparator(t.key,o.key):(t,o)=>Or.comparator(t.key,o.key),this.keyedMap=t1(),this.sortedSet=new ao(this.comparator)}static emptySet(e){return new i0(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,o)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof i0)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;t.hasNext();){const c=t.getNext().key,f=o.getNext().key;if(!c.isEqual(f))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const o=new i0;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=t,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YL{constructor(){this.W_=new ao(Or.comparator)}track(e){const t=e.doc.key,o=this.W_.get(t);o?e.type!==0&&o.type===3?this.W_=this.W_.insert(t,e):e.type===3&&o.type!==1?this.W_=this.W_.insert(t,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.W_=this.W_.remove(t):e.type===1&&o.type===2?this.W_=this.W_.insert(t,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):tn():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,o)=>{e.push(o)}),e}}class I0{constructor(e,t,o,c,f,y,s,E,R){this.query=e,this.docs=t,this.oldDocs=o,this.docChanges=c,this.mutatedKeys=f,this.fromCache=y,this.syncStateChanged=s,this.excludesMetadataChanges=E,this.hasCachedResults=R}static fromInitialDocuments(e,t,o,c,f){const y=[];return t.forEach(s=>{y.push({type:0,doc:s})}),new I0(e,t,i0.emptySet(t),y,o,c,!0,!1,f)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&vE(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,o=e.docChanges;if(t.length!==o.length)return!1;for(let c=0;c<t.length;c++)if(t[c].type!==o[c].type||!t[c].doc.isEqual(o[c].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jre{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class Qre{constructor(){this.queries=JL(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,o){const c=cn(t),f=c.queries;c.queries=JL(),f.forEach((y,s)=>{for(const E of s.j_)E.onError(o)})})(this,new Sr(yi.ABORTED,"Firestore shutting down"))}}function JL(){return new q0(r=>UV(r),vE)}async function wR(r,e){const t=cn(r);let o=3;const c=e.query;let f=t.queries.get(c);f?!f.H_()&&e.J_()&&(o=2):(f=new Jre,o=e.J_()?0:1);try{switch(o){case 0:f.z_=await t.onListen(c,!0);break;case 1:f.z_=await t.onListen(c,!1);break;case 2:await t.onFirstRemoteStoreListen(c)}}catch(y){const s=bR(y,`Initialization of query '${Cg(e.query)}' failed`);return void e.onError(s)}t.queries.set(c,f),f.j_.push(e),e.Z_(t.onlineState),f.z_&&e.X_(f.z_)&&ER(t)}async function TR(r,e){const t=cn(r),o=e.query;let c=3;const f=t.queries.get(o);if(f){const y=f.j_.indexOf(e);y>=0&&(f.j_.splice(y,1),f.j_.length===0?c=e.J_()?0:1:!f.H_()&&e.J_()&&(c=2))}switch(c){case 0:return t.queries.delete(o),t.onUnlisten(o,!0);case 1:return t.queries.delete(o),t.onUnlisten(o,!1);case 2:return t.onLastRemoteStoreUnlisten(o);default:return}}function ene(r,e){const t=cn(r);let o=!1;for(const c of e){const f=c.query,y=t.queries.get(f);if(y){for(const s of y.j_)s.X_(c)&&(o=!0);y.z_=c}}o&&ER(t)}function tne(r,e,t){const o=cn(r),c=o.queries.get(e);if(c)for(const f of c.j_)f.onError(t);o.queries.delete(e)}function ER(r){r.Y_.forEach(e=>{e.next()})}var X5,QL;(QL=X5||(X5={})).ea="default",QL.Cache="cache";class IR{constructor(e,t,o){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=o||{}}X_(e){if(!this.options.includeMetadataChanges){const o=[];for(const c of e.docChanges)c.type!==3&&o.push(c);e=new I0(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const o=t!=="Offline";return(!this.options._a||!o)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=I0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==X5.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x8{constructor(e){this.key=e}}class b8{constructor(e){this.key=e}}class ine{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Vn(),this.mutatedKeys=Vn(),this.Aa=jV(e),this.Ra=new i0(this.Aa)}get Va(){return this.Ta}ma(e,t){const o=t?t.fa:new YL,c=t?t.Ra:this.Ra;let f=t?t.mutatedKeys:this.mutatedKeys,y=c,s=!1;const E=this.query.limitType==="F"&&c.size===this.query.limit?c.last():null,R=this.query.limitType==="L"&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((O,A)=>{const U=c.get(O),$=xE(this.query,A)?A:null,te=!!U&&this.mutatedKeys.has(U.key),Q=!!$&&($.hasLocalMutations||this.mutatedKeys.has($.key)&&$.hasCommittedMutations);let de=!1;U&&$?U.data.isEqual($.data)?te!==Q&&(o.track({type:3,doc:$}),de=!0):this.ga(U,$)||(o.track({type:2,doc:$}),de=!0,(E&&this.Aa($,E)>0||R&&this.Aa($,R)<0)&&(s=!0)):!U&&$?(o.track({type:0,doc:$}),de=!0):U&&!$&&(o.track({type:1,doc:U}),de=!0,(E||R)&&(s=!0)),de&&($?(y=y.add($),f=Q?f.add(O):f.delete(O)):(y=y.delete(O),f=f.delete(O)))}),this.query.limit!==null)for(;y.size>this.query.limit;){const O=this.query.limitType==="F"?y.last():y.first();y=y.delete(O.key),f=f.delete(O.key),o.track({type:1,doc:O})}return{Ra:y,fa:o,ns:s,mutatedKeys:f}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,o,c){const f=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const y=e.fa.G_();y.sort((O,A)=>function($,te){const Q=de=>{switch(de){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return tn()}};return Q($)-Q(te)}(O.type,A.type)||this.Aa(O.doc,A.doc)),this.pa(o),c=c!=null&&c;const s=t&&!c?this.ya():[],E=this.da.size===0&&this.current&&!c?1:0,R=E!==this.Ea;return this.Ea=E,y.length!==0||R?{snapshot:new I0(this.query,e.Ra,f,y,e.mutatedKeys,E===0,R,!1,!!o&&o.resumeToken.approximateByteSize()>0),wa:s}:{wa:s}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new YL,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Vn(),this.Ra.forEach(o=>{this.Sa(o.key)&&(this.da=this.da.add(o.key))});const t=[];return e.forEach(o=>{this.da.has(o)||t.push(new b8(o))}),this.da.forEach(o=>{e.has(o)||t.push(new x8(o))}),t}ba(e){this.Ta=e.Ts,this.da=Vn();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return I0.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class rne{constructor(e,t,o){this.query=e,this.targetId=t,this.view=o}}class nne{constructor(e){this.key=e,this.va=!1}}class sne{constructor(e,t,o,c,f,y){this.localStore=e,this.remoteStore=t,this.eventManager=o,this.sharedClientState=c,this.currentUser=f,this.maxConcurrentLimboResolutions=y,this.Ca={},this.Fa=new q0(s=>UV(s),vE),this.Ma=new Map,this.xa=new Set,this.Oa=new ao(Or.comparator),this.Na=new Map,this.La=new fR,this.Ba={},this.ka=new Map,this.qa=E0.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function one(r,e,t=!0){const o=A8(r);let c;const f=o.Fa.get(e);return f?(o.sharedClientState.addLocalQueryTarget(f.targetId),c=f.view.Da()):c=await w8(o,e,t,!0),c}async function ane(r,e){const t=A8(r);await w8(t,e,!0,!1)}async function w8(r,e,t,o){const c=await Rre(r.localStore,dh(e)),f=c.targetId,y=r.sharedClientState.addLocalQueryTarget(f,t);let s;return o&&(s=await lne(r,e,f,y==="current",c.resumeToken)),r.isPrimaryClient&&t&&p8(r.remoteStore,c),s}async function lne(r,e,t,o,c){r.Ka=(A,U,$)=>async function(Q,de,Ce,Fe){let Le=de.view.ma(Ce);Le.ns&&(Le=await WL(Q.localStore,de.query,!1).then(({documents:me})=>de.view.ma(me,Le)));const Me=Fe&&Fe.targetChanges.get(de.targetId),at=Fe&&Fe.targetMismatches.get(de.targetId)!=null,pt=de.view.applyChanges(Le,Q.isPrimaryClient,Me,at);return tO(Q,de.targetId,pt.wa),pt.snapshot}(r,A,U,$);const f=await WL(r.localStore,e,!0),y=new ine(e,f.Ts),s=y.ma(f.documents),E=Vx.createSynthesizedTargetChangeForCurrentChange(t,o&&r.onlineState!=="Offline",c),R=y.applyChanges(s,r.isPrimaryClient,E);tO(r,t,R.wa);const O=new rne(e,t,y);return r.Fa.set(e,O),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),R.snapshot}async function cne(r,e,t){const o=cn(r),c=o.Fa.get(e),f=o.Ma.get(c.targetId);if(f.length>1)return o.Ma.set(c.targetId,f.filter(y=>!vE(y,e))),void o.Fa.delete(e);o.isPrimaryClient?(o.sharedClientState.removeLocalQueryTarget(c.targetId),o.sharedClientState.isActiveQueryTarget(c.targetId)||await W5(o.localStore,c.targetId,!1).then(()=>{o.sharedClientState.clearQueryState(c.targetId),t&&_R(o.remoteStore,c.targetId),Z5(o,c.targetId)}).catch(zx)):(Z5(o,c.targetId),await W5(o.localStore,c.targetId,!0))}async function une(r,e){const t=cn(r),o=t.Fa.get(e),c=t.Ma.get(o.targetId);t.isPrimaryClient&&c.length===1&&(t.sharedClientState.removeLocalQueryTarget(o.targetId),_R(t.remoteStore,o.targetId))}async function hne(r,e,t){const o=yne(r);try{const c=await function(y,s){const E=cn(y),R=Mo.now(),O=s.reduce(($,te)=>$.add(te.key),Vn());let A,U;return E.persistence.runTransaction("Locally write mutations","readwrite",$=>{let te=Rd(),Q=Vn();return E.cs.getEntries($,O).next(de=>{te=de,te.forEach((Ce,Fe)=>{Fe.isValidDocument()||(Q=Q.add(Ce))})}).next(()=>E.localDocuments.getOverlayedDocuments($,te)).next(de=>{A=de;const Ce=[];for(const Fe of s){const Le=Die(Fe,A.get(Fe.key).overlayedDocument);Le!=null&&Ce.push(new Xm(Fe.key,Le,LV(Le.value.mapValue),fh.exists(!0)))}return E.mutationQueue.addMutationBatch($,R,Ce,s)}).next(de=>{U=de;const Ce=de.applyToLocalDocumentSet(A,Q);return E.documentOverlayCache.saveOverlays($,de.batchId,Ce)})}).then(()=>({batchId:U.batchId,changes:GV(A)}))}(o.localStore,e);o.sharedClientState.addPendingMutation(c.batchId),function(y,s,E){let R=y.Ba[y.currentUser.toKey()];R||(R=new ao(ns)),R=R.insert(s,E),y.Ba[y.currentUser.toKey()]=R}(o,c.batchId,t),await jx(o,c.changes),await SE(o.remoteStore)}catch(c){const f=bR(c,"Failed to persist write");t.reject(f)}}async function T8(r,e){const t=cn(r);try{const o=await Sre(t.localStore,e);e.targetChanges.forEach((c,f)=>{const y=t.Na.get(f);y&&(xs(c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size<=1),c.addedDocuments.size>0?y.va=!0:c.modifiedDocuments.size>0?xs(y.va):c.removedDocuments.size>0&&(xs(y.va),y.va=!1))}),await jx(t,o,e)}catch(o){await zx(o)}}function eO(r,e,t){const o=cn(r);if(o.isPrimaryClient&&t===0||!o.isPrimaryClient&&t===1){const c=[];o.Fa.forEach((f,y)=>{const s=y.view.Z_(e);s.snapshot&&c.push(s.snapshot)}),function(y,s){const E=cn(y);E.onlineState=s;let R=!1;E.queries.forEach((O,A)=>{for(const U of A.j_)U.Z_(s)&&(R=!0)}),R&&ER(E)}(o.eventManager,e),c.length&&o.Ca.d_(c),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function dne(r,e,t){const o=cn(r);o.sharedClientState.updateQueryState(e,"rejected",t);const c=o.Na.get(e),f=c&&c.key;if(f){let y=new ao(Or.comparator);y=y.insert(f,Va.newNoDocument(f,ln.min()));const s=Vn().add(f),E=new TE(ln.min(),new Map,new ao(ns),y,s);await T8(o,E),o.Oa=o.Oa.remove(f),o.Na.delete(e),SR(o)}else await W5(o.localStore,e,!1).then(()=>Z5(o,e,t)).catch(zx)}async function fne(r,e){const t=cn(r),o=e.batch.batchId;try{const c=await Ire(t.localStore,e);I8(t,o,null),E8(t,o),t.sharedClientState.updateMutationState(o,"acknowledged"),await jx(t,c)}catch(c){await zx(c)}}async function pne(r,e,t){const o=cn(r);try{const c=await function(y,s){const E=cn(y);return E.persistence.runTransaction("Reject batch","readwrite-primary",R=>{let O;return E.mutationQueue.lookupMutationBatch(R,s).next(A=>(xs(A!==null),O=A.keys(),E.mutationQueue.removeMutationBatch(R,A))).next(()=>E.mutationQueue.performConsistencyCheck(R)).next(()=>E.documentOverlayCache.removeOverlaysForBatchId(R,O,s)).next(()=>E.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(R,O)).next(()=>E.localDocuments.getDocuments(R,O))})}(o.localStore,e);I8(o,e,t),E8(o,e),o.sharedClientState.updateMutationState(e,"rejected",t),await jx(o,c)}catch(c){await zx(c)}}function E8(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function I8(r,e,t){const o=cn(r);let c=o.Ba[o.currentUser.toKey()];if(c){const f=c.get(e);f&&(t?f.reject(t):f.resolve(),c=c.remove(e)),o.Ba[o.currentUser.toKey()]=c}}function Z5(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const o of r.Ma.get(e))r.Fa.delete(o),t&&r.Ca.$a(o,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(o=>{r.La.containsKey(o)||S8(r,o)})}function S8(r,e){r.xa.delete(e.path.canonicalString());const t=r.Oa.get(e);t!==null&&(_R(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),SR(r))}function tO(r,e,t){for(const o of t)o instanceof x8?(r.La.addReference(o.key,e),mne(r,o)):o instanceof b8?(pr("SyncEngine","Document no longer in limbo: "+o.key),r.La.removeReference(o.key,e),r.La.containsKey(o.key)||S8(r,o.key)):tn()}function mne(r,e){const t=e.key,o=t.path.canonicalString();r.Oa.get(t)||r.xa.has(o)||(pr("SyncEngine","New document in limbo: "+t),r.xa.add(o),SR(r))}function SR(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const e=r.xa.values().next().value;r.xa.delete(e);const t=new Or(Ks.fromString(e)),o=r.qa.next();r.Na.set(o,new nne(t)),r.Oa=r.Oa.insert(t,o),p8(r.remoteStore,new Nf(dh(yE(t.path)),o,"TargetPurposeLimboResolution",rR.oe))}}async function jx(r,e,t){const o=cn(r),c=[],f=[],y=[];o.Fa.isEmpty()||(o.Fa.forEach((s,E)=>{y.push(o.Ka(E,e,t).then(R=>{var O;if((R||t)&&o.isPrimaryClient){const A=R?!R.fromCache:(O=t==null?void 0:t.targetChanges.get(E.targetId))===null||O===void 0?void 0:O.current;o.sharedClientState.updateQueryState(E.targetId,A?"current":"not-current")}if(R){c.push(R);const A=mR.Wi(E.targetId,R);f.push(A)}}))}),await Promise.all(y),o.Ca.d_(c),await async function(E,R){const O=cn(E);try{await O.persistence.runTransaction("notifyLocalViewChanges","readwrite",A=>vi.forEach(R,U=>vi.forEach(U.$i,$=>O.persistence.referenceDelegate.addReference(A,U.targetId,$)).next(()=>vi.forEach(U.Ui,$=>O.persistence.referenceDelegate.removeReference(A,U.targetId,$)))))}catch(A){if(!Nx(A))throw A;pr("LocalStore","Failed to update sequence numbers: "+A)}for(const A of R){const U=A.targetId;if(!A.fromCache){const $=O.os.get(U),te=$.snapshotVersion,Q=$.withLastLimboFreeSnapshotVersion(te);O.os=O.os.insert(U,Q)}}}(o.localStore,f))}async function _ne(r,e){const t=cn(r);if(!t.currentUser.isEqual(e)){pr("SyncEngine","User change. New user:",e.toKey());const o=await u8(t.localStore,e);t.currentUser=e,function(f,y){f.ka.forEach(s=>{s.forEach(E=>{E.reject(new Sr(yi.CANCELLED,y))})}),f.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await jx(t,o.hs)}}function gne(r,e){const t=cn(r),o=t.Na.get(e);if(o&&o.va)return Vn().add(o.key);{let c=Vn();const f=t.Ma.get(e);if(!f)return c;for(const y of f){const s=t.Fa.get(y);c=c.unionWith(s.view.Va)}return c}}function A8(r){const e=cn(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=T8.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=gne.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=dne.bind(null,e),e.Ca.d_=ene.bind(null,e.eventManager),e.Ca.$a=tne.bind(null,e.eventManager),e}function yne(r){const e=cn(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=fne.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=pne.bind(null,e),e}class _T{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=EE(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return Ere(this.persistence,new wre,e.initialUser,this.serializer)}Ga(e){return new vre(pR.Zr,this.serializer)}Wa(e){return new Mre}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}_T.provider={build:()=>new _T};class K5{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>eO(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=_ne.bind(null,this.syncEngine),await Yre(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Qre}()}createDatastore(e){const t=EE(e.databaseInfo.databaseId),o=function(f){return new Ore(f)}(e.databaseInfo);return function(f,y,s,E){return new Nre(f,y,s,E)}(e.authCredentials,e.appCheckCredentials,o,t)}createRemoteStore(e){return function(o,c,f,y,s){return new Vre(o,c,f,y,s)}(this.localStore,this.datastore,e.asyncQueue,t=>eO(this.syncEngine,t,0),function(){return ZL.D()?new ZL:new kre}())}createSyncEngine(e,t){return function(c,f,y,s,E,R,O){const A=new sne(c,f,y,s,E,R);return O&&(A.Qa=!0),A}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(c){const f=cn(c);pr("RemoteStore","RemoteStore shutting down."),f.L_.add(5),await Ux(f),f.k_.shutdown(),f.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}K5.provider={build:()=>new K5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AR{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Cd("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vne{constructor(e,t,o,c,f){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=o,this.databaseInfo=c,this.user=Oa.UNAUTHENTICATED,this.clientId=MV.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=f,this.authCredentials.start(o,async y=>{pr("FirestoreClient","Received user=",y.uid),await this.authCredentialListener(y),this.user=y}),this.appCheckCredentials.start(o,y=>(pr("FirestoreClient","Received new app check token=",y),this.appCheckCredentialListener(y,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new bd;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const o=bR(t,"Failed to shutdown persistence");e.reject(o)}}),e.promise}}async function xA(r,e){r.asyncQueue.verifyOperationInProgress(),pr("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;await e.initialize(t);let o=t.initialUser;r.setCredentialChangeListener(async c=>{o.isEqual(c)||(await u8(e.localStore,c),o=c)}),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}async function iO(r,e){r.asyncQueue.verifyOperationInProgress();const t=await xne(r);pr("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,r.configuration),r.setCredentialChangeListener(o=>KL(e.remoteStore,o)),r.setAppCheckTokenChangeListener((o,c)=>KL(e.remoteStore,c)),r._onlineComponents=e}async function xne(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){pr("FirestoreClient","Using user provided OfflineComponentProvider");try{await xA(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(c){return c.name==="FirebaseError"?c.code===yi.FAILED_PRECONDITION||c.code===yi.UNIMPLEMENTED:!(typeof DOMException<"u"&&c instanceof DOMException)||c.code===22||c.code===20||c.code===11}(t))throw t;v0("Error using user provided cache. Falling back to memory cache: "+t),await xA(r,new _T)}}else pr("FirestoreClient","Using default OfflineComponentProvider"),await xA(r,new _T);return r._offlineComponents}async function C8(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(pr("FirestoreClient","Using user provided OnlineComponentProvider"),await iO(r,r._uninitializedComponentsProvider._online)):(pr("FirestoreClient","Using default OnlineComponentProvider"),await iO(r,new K5))),r._onlineComponents}function bne(r){return C8(r).then(e=>e.syncEngine)}async function gT(r){const e=await C8(r),t=e.eventManager;return t.onListen=one.bind(null,e.syncEngine),t.onUnlisten=cne.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=ane.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=une.bind(null,e.syncEngine),t}function wne(r,e,t={}){const o=new bd;return r.asyncQueue.enqueueAndForget(async()=>function(f,y,s,E,R){const O=new AR({next:U=>{O.Za(),y.enqueueAndForget(()=>TR(f,A));const $=U.docs.has(s);!$&&U.fromCache?R.reject(new Sr(yi.UNAVAILABLE,"Failed to get document because the client is offline.")):$&&U.fromCache&&E&&E.source==="server"?R.reject(new Sr(yi.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):R.resolve(U)},error:U=>R.reject(U)}),A=new IR(yE(s.path),O,{includeMetadataChanges:!0,_a:!0});return wR(f,A)}(await gT(r),r.asyncQueue,e,t,o)),o.promise}function Tne(r,e,t={}){const o=new bd;return r.asyncQueue.enqueueAndForget(async()=>function(f,y,s,E,R){const O=new AR({next:U=>{O.Za(),y.enqueueAndForget(()=>TR(f,A)),U.fromCache&&E.source==="server"?R.reject(new Sr(yi.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):R.resolve(U)},error:U=>R.reject(U)}),A=new IR(s,O,{includeMetadataChanges:!0,_a:!0});return wR(f,A)}(await gT(r),r.asyncQueue,e,t,o)),o.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R8(r){const e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rO=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P8(r,e,t){if(!t)throw new Sr(yi.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function Ene(r,e,t,o){if(e===!0&&o===!0)throw new Sr(yi.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function nO(r){if(!Or.isDocumentKey(r))throw new Sr(yi.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function sO(r){if(Or.isDocumentKey(r))throw new Sr(yi.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function CR(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const e=function(o){return o.constructor?o.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":tn()}function gu(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new Sr(yi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=CR(r);throw new Sr(yi.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oO{constructor(e){var t,o;if(e.host===void 0){if(e.ssl!==void 0)throw new Sr(yi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Sr(yi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Ene("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=R8((o=e.experimentalLongPollingOptions)!==null&&o!==void 0?o:{}),function(f){if(f.timeoutSeconds!==void 0){if(isNaN(f.timeoutSeconds))throw new Sr(yi.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (must not be NaN)`);if(f.timeoutSeconds<5)throw new Sr(yi.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (minimum allowed value is 5)`);if(f.timeoutSeconds>30)throw new Sr(yi.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(o,c){return o.timeoutSeconds===c.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class AE{constructor(e,t,o,c){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=o,this._app=c,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new oO({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Sr(yi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Sr(yi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new oO(e),e.credentials!==void 0&&(this._authCredentials=function(o){if(!o)return new Vte;switch(o.type){case"firstParty":return new Gte(o.sessionIndex||"0",o.iamToken||null,o.authTokenFactory||null);case"provider":return o.client;default:throw new Sr(yi.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const o=rO.get(t);o&&(pr("ComponentProvider","Removing Datastore"),rO.delete(t),o.terminate())}(this),Promise.resolve()}}function Ine(r,e,t,o={}){var c;const f=(r=gu(r,AE))._getSettings(),y=`${e}:${t}`;if(f.host!=="firestore.googleapis.com"&&f.host!==y&&v0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},f),{host:y,ssl:!1})),o.mockUserToken){let s,E;if(typeof o.mockUserToken=="string")s=o.mockUserToken,E=Oa.MOCK_USER;else{s=FX(o.mockUserToken,(c=r._app)===null||c===void 0?void 0:c.options.projectId);const R=o.mockUserToken.sub||o.mockUserToken.user_id;if(!R)throw new Sr(yi.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");E=new Oa(R)}r._authCredentials=new Ute(new PV(s,E))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $x{constructor(e,t,o){this.converter=t,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new $x(this.firestore,e,this._query)}}class Cl{constructor(e,t,o){this.converter=t,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Zf(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Cl(this.firestore,e,this._key)}}class Zf extends $x{constructor(e,t,o){super(e,t,yE(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Cl(this.firestore,null,new Or(e))}withConverter(e){return new Zf(this.firestore,e,this._path)}}function M8(r,e,...t){if(r=yl(r),P8("collection","path",e),r instanceof AE){const o=Ks.fromString(e,...t);return sO(o),new Zf(r,null,o)}{if(!(r instanceof Cl||r instanceof Zf))throw new Sr(yi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=r._path.child(Ks.fromString(e,...t));return sO(o),new Zf(r.firestore,null,o)}}function k8(r,e,...t){if(r=yl(r),arguments.length===1&&(e=MV.newId()),P8("doc","path",e),r instanceof AE){const o=Ks.fromString(e,...t);return nO(o),new Cl(r,null,new Or(o))}{if(!(r instanceof Cl||r instanceof Zf))throw new Sr(yi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=r._path.child(Ks.fromString(e,...t));return nO(o),new Cl(r.firestore,r instanceof Zf?r.converter:null,new Or(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aO{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new d8(this,"async_queue_retry"),this.Vu=()=>{const o=vA();o&&pr("AsyncQueue","Visibility state changed to "+o.visibilityState),this.t_.jo()},this.mu=e;const t=vA();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=vA();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new bd;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Nx(e))throw e;pr("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(o=>{this.Eu=o,this.du=!1;const c=function(y){let s=y.message||"";return y.stack&&(s=y.stack.includes(y.message)?y.stack:y.message+`
`+y.stack),s}(o);throw Cd("INTERNAL UNHANDLED ERROR: ",c),o}).then(o=>(this.du=!1,o))));return this.mu=t,t}enqueueAfterDelay(e,t,o){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const c=xR.createAndSchedule(this,e,t,o,f=>this.yu(f));return this.Tu.push(c),c}fu(){this.Eu&&tn()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,o)=>t.targetTimeMs-o.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function lO(r){return function(t,o){if(typeof t!="object"||t===null)return!1;const c=t;for(const f of o)if(f in c&&typeof c[f]=="function")return!0;return!1}(r,["next","error","complete"])}class Om extends AE{constructor(e,t,o,c){super(e,t,o,c),this.type="firestore",this._queue=new aO,this._persistenceKey=(c==null?void 0:c.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new aO(e),this._firestoreClient=void 0,await e}}}function Sne(r,e){const t=typeof r=="object"?r:EN(),o=typeof r=="string"?r:"(default)",c=sE(t,"firestore").getImmediate({identifier:o});if(!c._initialized){const f=LX("firestore");f&&Ine(c,...f)}return c}function CE(r){if(r._terminated)throw new Sr(yi.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||Ane(r),r._firestoreClient}function Ane(r){var e,t,o;const c=r._freezeSettings(),f=function(s,E,R,O){return new rie(s,E,R,O.host,O.ssl,O.experimentalForceLongPolling,O.experimentalAutoDetectLongPolling,R8(O.experimentalLongPollingOptions),O.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,c);r._componentsProvider||!((t=c.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((o=c.localCache)===null||o===void 0)&&o._onlineComponentProvider)&&(r._componentsProvider={_offline:c.localCache._offlineComponentProvider,_online:c.localCache._onlineComponentProvider}),r._firestoreClient=new vne(r._authCredentials,r._appCheckCredentials,r._queue,f,r._componentsProvider&&function(s){const E=s==null?void 0:s._online.build();return{_offline:s==null?void 0:s._offline.build(E),_online:E}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new S0(ba.fromBase64String(e))}catch(t){throw new Sr(yi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new S0(ba.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RR{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Sr(yi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ma(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PR{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RE{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Sr(yi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Sr(yi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ns(this._lat,e._lat)||ns(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MR{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(o,c){if(o.length!==c.length)return!1;for(let f=0;f<o.length;++f)if(o[f]!==c[f])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cne=/^__.*__$/;class Rne{constructor(e,t,o){this.data=e,this.fieldMask=t,this.fieldTransforms=o}toMutation(e,t){return this.fieldMask!==null?new Xm(e,this.data,this.fieldMask,t,this.fieldTransforms):new Bx(e,this.data,t,this.fieldTransforms)}}function D8(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw tn()}}class PE{constructor(e,t,o,c,f,y){this.settings=e,this.databaseId=t,this.serializer=o,this.ignoreUndefinedProperties=c,f===void 0&&this.vu(),this.fieldTransforms=f||[],this.fieldMask=y||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new PE(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const o=(t=this.path)===null||t===void 0?void 0:t.child(e),c=this.Fu({path:o,xu:!1});return c.Ou(e),c}Nu(e){var t;const o=(t=this.path)===null||t===void 0?void 0:t.child(e),c=this.Fu({path:o,xu:!1});return c.vu(),c}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return yT(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(D8(this.Cu)&&Cne.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class Pne{constructor(e,t,o){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=o||EE(e)}Qu(e,t,o,c=!1){return new PE({Cu:e,methodName:t,qu:o,path:ma.emptyPath(),xu:!1,ku:c},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function L8(r){const e=r._freezeSettings(),t=EE(r._databaseId);return new Pne(r._databaseId,!!e.ignoreUndefinedProperties,t)}function O8(r,e,t,o,c,f={}){const y=r.Qu(f.merge||f.mergeFields?2:0,e,t,c);N8("Data must be an object, but it was:",y,o);const s=F8(o,y);let E,R;if(f.merge)E=new uu(y.fieldMask),R=y.fieldTransforms;else if(f.mergeFields){const O=[];for(const A of f.mergeFields){const U=kne(e,A,t);if(!y.contains(U))throw new Sr(yi.INVALID_ARGUMENT,`Field '${U}' is specified in your field mask but missing from your input data.`);Lne(O,U)||O.push(U)}E=new uu(O),R=y.fieldTransforms.filter(A=>E.covers(A.field))}else E=null,R=y.fieldTransforms;return new Rne(new Pc(s),E,R)}function Mne(r,e,t){return new PE({Cu:3,qu:e.settings.qu,methodName:r._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class kR extends PR{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=Mne(this,e,!0),o=this.Ku.map(f=>DR(f,t)),c=new T0(o);return new Rie(e.path,c)}isEqual(e){return e instanceof kR&&Q1(this.Ku,e.Ku)}}function DR(r,e){if(z8(r=yl(r)))return N8("Unsupported field value:",e,r),F8(r,e);if(r instanceof PR)return function(o,c){if(!D8(c.Cu))throw c.Bu(`${o._methodName}() can only be used with update() and set()`);if(!c.path)throw c.Bu(`${o._methodName}() is not currently supported inside arrays`);const f=o._toFieldTransform(c);f&&c.fieldTransforms.push(f)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(o,c){const f=[];let y=0;for(const s of o){let E=DR(s,c.Lu(y));E==null&&(E={nullValue:"NULL_VALUE"}),f.push(E),y++}return{arrayValue:{values:f}}}(r,e)}return function(o,c){if((o=yl(o))===null)return{nullValue:"NULL_VALUE"};if(typeof o=="number")return Sie(c.serializer,o);if(typeof o=="boolean")return{booleanValue:o};if(typeof o=="string")return{stringValue:o};if(o instanceof Date){const f=Mo.fromDate(o);return{timestampValue:pT(c.serializer,f)}}if(o instanceof Mo){const f=new Mo(o.seconds,1e3*Math.floor(o.nanoseconds/1e3));return{timestampValue:pT(c.serializer,f)}}if(o instanceof RE)return{geoPointValue:{latitude:o.latitude,longitude:o.longitude}};if(o instanceof S0)return{bytesValue:r8(c.serializer,o._byteString)};if(o instanceof Cl){const f=c.databaseId,y=o.firestore._databaseId;if(!y.isEqual(f))throw c.Bu(`Document reference is for database ${y.projectId}/${y.database} but should be for database ${f.projectId}/${f.database}`);return{referenceValue:dR(o.firestore._databaseId||c.databaseId,o._key.path)}}if(o instanceof MR)return function(y,s){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:y.toArray().map(E=>{if(typeof E!="number")throw s.Bu("VectorValues must only contain numeric values.");return cR(s.serializer,E)})}}}}}}(o,c);throw c.Bu(`Unsupported field value: ${CR(o)}`)}(r,e)}function F8(r,e){const t={};return kV(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):H0(r,(o,c)=>{const f=DR(c,e.Mu(o));f!=null&&(t[o]=f)}),{mapValue:{fields:t}}}function z8(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof Mo||r instanceof RE||r instanceof S0||r instanceof Cl||r instanceof PR||r instanceof MR)}function N8(r,e,t){if(!z8(t)||!function(c){return typeof c=="object"&&c!==null&&(Object.getPrototypeOf(c)===Object.prototype||Object.getPrototypeOf(c)===null)}(t)){const o=CR(t);throw o==="an object"?e.Bu(r+" a custom object"):e.Bu(r+" "+o)}}function kne(r,e,t){if((e=yl(e))instanceof RR)return e._internalPath;if(typeof e=="string")return B8(r,e);throw yT("Field path arguments must be of type string or ",r,!1,void 0,t)}const Dne=new RegExp("[~\\*/\\[\\]]");function B8(r,e,t){if(e.search(Dne)>=0)throw yT(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new RR(...e.split("."))._internalPath}catch{throw yT(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function yT(r,e,t,o,c){const f=o&&!o.isEmpty(),y=c!==void 0;let s=`Function ${e}() called with invalid data`;t&&(s+=" (via `toFirestore()`)"),s+=". ";let E="";return(f||y)&&(E+=" (found",f&&(E+=` in field ${o}`),y&&(E+=` in document ${c}`),E+=")"),new Sr(yi.INVALID_ARGUMENT,s+r+E)}function Lne(r,e){return r.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V8{constructor(e,t,o,c,f){this._firestore=e,this._userDataWriter=t,this._key=o,this._document=c,this._converter=f}get id(){return this._key.path.lastSegment()}get ref(){return new Cl(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new One(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(U8("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class One extends V8{data(){return super.data()}}function U8(r,e){return typeof e=="string"?B8(r,e):e instanceof RR?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j8(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new Sr(yi.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Fne{convertValue(e,t="none"){switch(Lm(e)){case 0:return null;case 1:return e.booleanValue;case 2:return go(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Dm(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw tn()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const o={};return H0(e,(c,f)=>{o[c]=this.convertValue(f,t)}),o}convertVectorValue(e){var t,o,c;const f=(c=(o=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||o===void 0?void 0:o.values)===null||c===void 0?void 0:c.map(y=>go(y.doubleValue));return new MR(f)}convertGeoPoint(e){return new RE(go(e.latitude),go(e.longitude))}convertArray(e,t){return(e.values||[]).map(o=>this.convertValue(o,t))}convertServerTimestamp(e,t){switch(t){case"previous":const o=sR(e);return o==null?null:this.convertValue(o,t);case"estimate":return this.convertTimestamp(sx(e));default:return null}}convertTimestamp(e){const t=np(e);return new Mo(t.seconds,t.nanos)}convertDocumentKey(e,t){const o=Ks.fromString(e);xs(c8(o));const c=new ox(o.get(1),o.get(3)),f=new Or(o.popFirst(5));return c.isEqual(t)||Cd(`Document ${f} contains a document reference within a different database (${c.projectId}/${c.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $8(r,e,t){let o;return o=r?r.toFirestore(e):e,o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r1{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class G8 extends V8{constructor(e,t,o,c,f,y){super(e,t,o,c,y),this._firestore=e,this._firestoreImpl=e,this.metadata=f}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new I2(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const o=this._document.data.field(U8("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,t.serverTimestamps)}}}class I2 extends G8{data(e={}){return super.data(e)}}class H8{constructor(e,t,o,c){this._firestore=e,this._userDataWriter=t,this._snapshot=c,this.metadata=new r1(c.hasPendingWrites,c.fromCache),this.query=o}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(o=>{e.call(t,new I2(this._firestore,this._userDataWriter,o.key,o,new r1(this._snapshot.mutatedKeys.has(o.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Sr(yi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(c,f){if(c._snapshot.oldDocs.isEmpty()){let y=0;return c._snapshot.docChanges.map(s=>{const E=new I2(c._firestore,c._userDataWriter,s.doc.key,s.doc,new r1(c._snapshot.mutatedKeys.has(s.doc.key),c._snapshot.fromCache),c.query.converter);return s.doc,{type:"added",doc:E,oldIndex:-1,newIndex:y++}})}{let y=c._snapshot.oldDocs;return c._snapshot.docChanges.filter(s=>f||s.type!==3).map(s=>{const E=new I2(c._firestore,c._userDataWriter,s.doc.key,s.doc,new r1(c._snapshot.mutatedKeys.has(s.doc.key),c._snapshot.fromCache),c.query.converter);let R=-1,O=-1;return s.type!==0&&(R=y.indexOf(s.doc.key),y=y.delete(s.doc.key)),s.type!==1&&(y=y.add(s.doc),O=y.indexOf(s.doc.key)),{type:zne(s.type),doc:E,oldIndex:R,newIndex:O}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function zne(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return tn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q8(r){r=gu(r,Cl);const e=gu(r.firestore,Om);return wne(CE(e),r._key).then(t=>X8(e,r,t))}class LR extends Fne{constructor(e){super(),this.firestore=e}convertBytes(e){return new S0(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Cl(this.firestore,null,t)}}function Nne(r){r=gu(r,$x);const e=gu(r.firestore,Om),t=CE(e),o=new LR(e);return j8(r._query),Tne(t,r._query).then(c=>new H8(e,o,r,c))}function Bne(r,e,t){r=gu(r,Cl);const o=gu(r.firestore,Om),c=$8(r.converter,e);return W8(o,[O8(L8(o),"setDoc",r._key,c,r.converter!==null,t).toMutation(r._key,fh.none())])}function Vne(r,e){const t=gu(r.firestore,Om),o=k8(r),c=$8(r.converter,e);return W8(t,[O8(L8(r.firestore),"addDoc",o._key,c,r.converter!==null,{}).toMutation(o._key,fh.exists(!1))]).then(()=>o)}function OR(r,...e){var t,o,c;r=yl(r);let f={includeMetadataChanges:!1,source:"default"},y=0;typeof e[y]!="object"||lO(e[y])||(f=e[y],y++);const s={includeMetadataChanges:f.includeMetadataChanges,source:f.source};if(lO(e[y])){const A=e[y];e[y]=(t=A.next)===null||t===void 0?void 0:t.bind(A),e[y+1]=(o=A.error)===null||o===void 0?void 0:o.bind(A),e[y+2]=(c=A.complete)===null||c===void 0?void 0:c.bind(A)}let E,R,O;if(r instanceof Cl)R=gu(r.firestore,Om),O=yE(r._key.path),E={next:A=>{e[y]&&e[y](X8(R,r,A))},error:e[y+1],complete:e[y+2]};else{const A=gu(r,$x);R=gu(A.firestore,Om),O=A._query;const U=new LR(R);E={next:$=>{e[y]&&e[y](new H8(R,U,A,$))},error:e[y+1],complete:e[y+2]},j8(r._query)}return function(U,$,te,Q){const de=new AR(Q),Ce=new IR($,de,te);return U.asyncQueue.enqueueAndForget(async()=>wR(await gT(U),Ce)),()=>{de.Za(),U.asyncQueue.enqueueAndForget(async()=>TR(await gT(U),Ce))}}(CE(R),O,s,E)}function W8(r,e){return function(o,c){const f=new bd;return o.asyncQueue.enqueueAndForget(async()=>hne(await bne(o),c,f)),f.promise}(CE(r),e)}function X8(r,e,t){const o=t.docs.get(e._key),c=new LR(r);return new G8(r,c,e._key,o,new r1(t.hasPendingWrites,t.fromCache),e.converter)}function Une(...r){return new kR("arrayUnion",r)}(function(e,t=!0){(function(c){G0=c})(up),Ll(new vl("firestore",(o,{instanceIdentifier:c,options:f})=>{const y=o.getProvider("app").getImmediate(),s=new Om(new jte(o.getProvider("auth-internal")),new qte(o.getProvider("app-check-internal")),function(R,O){if(!Object.prototype.hasOwnProperty.apply(R.options,["projectId"]))throw new Sr(yi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ox(R.options.projectId,O)}(y,c),y);return f=Object.assign({useFetchStreams:t},f),s._setSettings(f),s},"PUBLIC").setMultipleInstances(!0)),ya(SL,"4.7.3",e),ya(SL,"4.7.3","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z8="firebasestorage.googleapis.com",jne="storageBucket",$ne=2*60*1e3,Gne=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wh extends jc{constructor(e,t,o=0){super(bA(e),`Firebase Storage: ${t} (${bA(e)})`),this.status_=o,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,wh.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return bA(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var xh;(function(r){r.UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(xh||(xh={}));function bA(r){return"storage/"+r}function Hne(){const r="An unknown error occurred, please check the error payload for server response.";return new wh(xh.UNKNOWN,r)}function qne(){return new wh(xh.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Wne(){return new wh(xh.CANCELED,"User canceled the upload/download.")}function Xne(r){return new wh(xh.INVALID_URL,"Invalid URL '"+r+"'.")}function Zne(r){return new wh(xh.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")}function cO(r){return new wh(xh.INVALID_ARGUMENT,r)}function K8(){return new wh(xh.APP_DELETED,"The Firebase app was deleted.")}function Kne(r){return new wh(xh.INVALID_ROOT_OPERATION,"The operation '"+r+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let o;try{o=hu.makeFromUrl(e,t)}catch{return new hu(e,"")}if(o.path==="")return o;throw Zne(e)}static makeFromUrl(e,t){let o=null;const c="([A-Za-z0-9.\\-_]+)";function f(Me){Me.path.charAt(Me.path.length-1)==="/"&&(Me.path_=Me.path_.slice(0,-1))}const y="(/(.*))?$",s=new RegExp("^gs://"+c+y,"i"),E={bucket:1,path:3};function R(Me){Me.path_=decodeURIComponent(Me.path)}const O="v[A-Za-z0-9_]+",A=t.replace(/[.]/g,"\\."),U="(/([^?#]*).*)?$",$=new RegExp(`^https?://${A}/${O}/b/${c}/o${U}`,"i"),te={bucket:1,path:3},Q=t===Z8?"(?:storage.googleapis.com|storage.cloud.google.com)":t,de="([^?#]*)",Ce=new RegExp(`^https?://${Q}/${c}/${de}`,"i"),Le=[{regex:s,indices:E,postModify:f},{regex:$,indices:te,postModify:R},{regex:Ce,indices:{bucket:1,path:2},postModify:R}];for(let Me=0;Me<Le.length;Me++){const at=Le[Me],pt=at.regex.exec(e);if(pt){const me=pt[at.indices.bucket];let ye=pt[at.indices.path];ye||(ye=""),o=new hu(me,ye),at.postModify(o);break}}if(o==null)throw Xne(e);return o}}class Yne{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jne(r,e,t){let o=1,c=null,f=null,y=!1,s=0;function E(){return s===2}let R=!1;function O(...de){R||(R=!0,e.apply(null,de))}function A(de){c=setTimeout(()=>{c=null,r($,E())},de)}function U(){f&&clearTimeout(f)}function $(de,...Ce){if(R){U();return}if(de){U(),O.call(null,de,...Ce);return}if(E()||y){U(),O.call(null,de,...Ce);return}o<64&&(o*=2);let Le;s===1?(s=2,Le=0):Le=(o+Math.random())*1e3,A(Le)}let te=!1;function Q(de){te||(te=!0,U(),!R&&(c!==null?(de||(s=2),clearTimeout(c),A(0)):de||(s=1)))}return A(0),f=setTimeout(()=>{y=!0,Q(!0)},t),Q}function Qne(r){r(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ese(r){return r!==void 0}function uO(r,e,t,o){if(o<e)throw cO(`Invalid value for '${r}'. Expected ${e} or greater.`);if(o>t)throw cO(`Invalid value for '${r}'. Expected ${t} or less.`)}function tse(r){const e=encodeURIComponent;let t="?";for(const o in r)if(r.hasOwnProperty(o)){const c=e(o)+"="+e(r[o]);t=t+c+"&"}return t=t.slice(0,-1),t}var vT;(function(r){r[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT"})(vT||(vT={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ise(r,e){const t=r>=500&&r<600,c=[408,429].indexOf(r)!==-1,f=e.indexOf(r)!==-1;return t||c||f}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rse{constructor(e,t,o,c,f,y,s,E,R,O,A,U=!0){this.url_=e,this.method_=t,this.headers_=o,this.body_=c,this.successCodes_=f,this.additionalRetryCodes_=y,this.callback_=s,this.errorCallback_=E,this.timeout_=R,this.progressCallback_=O,this.connectionFactory_=A,this.retry=U,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(($,te)=>{this.resolve_=$,this.reject_=te,this.start_()})}start_(){const e=(o,c)=>{if(c){o(!1,new Hw(!1,null,!0));return}const f=this.connectionFactory_();this.pendingConnection_=f;const y=s=>{const E=s.loaded,R=s.lengthComputable?s.total:-1;this.progressCallback_!==null&&this.progressCallback_(E,R)};this.progressCallback_!==null&&f.addUploadProgressListener(y),f.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&f.removeUploadProgressListener(y),this.pendingConnection_=null;const s=f.getErrorCode()===vT.NO_ERROR,E=f.getStatus();if(!s||ise(E,this.additionalRetryCodes_)&&this.retry){const O=f.getErrorCode()===vT.ABORT;o(!1,new Hw(!1,null,O));return}const R=this.successCodes_.indexOf(E)!==-1;o(!0,new Hw(R,f))})},t=(o,c)=>{const f=this.resolve_,y=this.reject_,s=c.connection;if(c.wasSuccessCode)try{const E=this.callback_(s,s.getResponse());ese(E)?f(E):f()}catch(E){y(E)}else if(s!==null){const E=Hne();E.serverResponse=s.getErrorText(),this.errorCallback_?y(this.errorCallback_(s,E)):y(E)}else if(c.canceled){const E=this.appDelete_?K8():Wne();y(E)}else{const E=qne();y(E)}};this.canceled_?t(!1,new Hw(!1,null,!0)):this.backoffId_=Jne(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Qne(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Hw{constructor(e,t,o){this.wasSuccessCode=e,this.connection=t,this.canceled=!!o}}function nse(r,e){e!==null&&e.length>0&&(r.Authorization="Firebase "+e)}function sse(r,e){r["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function ose(r,e){e&&(r["X-Firebase-GMPID"]=e)}function ase(r,e){e!==null&&(r["X-Firebase-AppCheck"]=e)}function lse(r,e,t,o,c,f,y=!0){const s=tse(r.urlParams),E=r.url+s,R=Object.assign({},r.headers);return ose(R,e),nse(R,t),sse(R,f),ase(R,o),new rse(E,r.method,R,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,c,y)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cse(r){if(r.length===0)return null;const e=r.lastIndexOf("/");return e===-1?"":r.slice(0,e)}function use(r){const e=r.lastIndexOf("/",r.length-2);return e===-1?r:r.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xT{constructor(e,t){this._service=e,t instanceof hu?this._location=t:this._location=hu.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new xT(e,t)}get root(){const e=new hu(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return use(this._location.path)}get storage(){return this._service}get parent(){const e=cse(this._location.path);if(e===null)return null;const t=new hu(this._location.bucket,e);return new xT(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw Kne(e)}}function hO(r,e){const t=e==null?void 0:e[jne];return t==null?null:hu.makeFromBucketSpec(t,r)}class hse{constructor(e,t,o,c,f){this.app=e,this._authProvider=t,this._appCheckProvider=o,this._url=c,this._firebaseVersion=f,this._bucket=null,this._host=Z8,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=$ne,this._maxUploadRetryTime=Gne,this._requests=new Set,c!=null?this._bucket=hu.makeFromBucketSpec(c,this._host):this._bucket=hO(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=hu.makeFromBucketSpec(this._url,e):this._bucket=hO(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){uO("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){uO("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new xT(this,e)}_makeRequest(e,t,o,c,f=!0){if(this._deleted)return new Yne(K8());{const y=lse(e,this._appId,o,c,t,this._firebaseVersion,f);return this._requests.add(y),y.getPromise().then(()=>this._requests.delete(y),()=>this._requests.delete(y)),y}}async makeRequestWithTokens(e,t){const[o,c]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,o,c).getPromise()}}const dO="@firebase/storage",fO="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dse="storage";function fse(r,{instanceIdentifier:e}){const t=r.getProvider("app").getImmediate(),o=r.getProvider("auth-internal"),c=r.getProvider("app-check-internal");return new hse(t,o,c,e,up)}function pse(){Ll(new vl(dse,fse,"PUBLIC").setMultipleInstances(!0)),ya(dO,fO,""),ya(dO,fO,"esm2017")}pse();const wA=new WeakMap;function Y8(r,e){return wA.has(e)||wA.set(e,{f:{},r:{},s:{},u:{}}),wA.get(e)}function mse(r,e,t,o){if(!r)return t;const[c,f]=J8(r);if(!c)return t;const y=Y8(void 0,o)[c]||{},s=e||f;return s&&s in y?y[s]:t}function _se(r,e,t,o){if(!r)return;const[c,f]=J8(r);if(!c)return;const y=Y8(void 0,o)[c],s=e||f;if(s)return t.then(E=>{y[s]=E}).catch(rh),s}function J8(r){return HJ(r)||qJ(r)?["f",r.path]:WJ(r)?["r",r.toString()]:XJ(r)?["s",r.toString()]:[]}const TA=new WeakMap;function gse(r,e,t){const o=uE();TA.has(o)||TA.set(o,new Map);const c=TA.get(o),f=_se(e,t,r,o);return f&&c.set(f,r),f?()=>c.delete(f):rh}const yse={toFirestore(r){return r},fromFirestore(r,e){return r.exists()?Object.defineProperties(r.data(e),{id:{value:r.id}}):null}};function Y5(r,e,t,o){if(!$J(r))return[r,{}];const c=[{},{}],f=Object.keys(t).reduce((s,E)=>{const R=t[E];return s[R.path]=R.data(),s},{});function y(s,E,R,O){E=E||{};const[A,U]=O;Object.getOwnPropertyNames(s).forEach($=>{const te=Object.getOwnPropertyDescriptor(s,$);te&&!te.enumerable&&Object.defineProperty(A,$,te)});for(const $ in s){const te=s[$];if(te==null||te instanceof Date||te instanceof Mo||te instanceof RE)A[$]=te;else if(DC(te)){const Q=R+$;A[$]=Q in t?E[$]:te.path,U[Q]=te.converter?te:te.withConverter(o.converter)}else if(Array.isArray(te)){A[$]=Array(te.length);for(let Q=0;Q<te.length;Q++){const de=te[Q];de&&de.path in f&&(A[$][Q]=f[de.path])}y(te,E[$]||A[$],R+$+".",[A[$],U])}else Hm(te)?(A[$]={},y(te,E[$],R+$+".",[A[$],U])):A[$]=te}}return y(r,e,"",c),c}const FR={reset:!1,wait:!0,maxRefDepth:2,converter:yse,snapshotOptions:{serverTimestamps:"estimate"}};function bT(r){for(const e in r)r[e].unsub()}function J5(r,e,t,o,c,f,y,s,E){const[R,O]=Y5(o.data(r.snapshotOptions),kC(e,t),c,r);f.set(e,t,R),Q5(r,e,t,c,O,f,y,s,E)}function vse({ref:r,target:e,path:t,depth:o,resolve:c,reject:f,ops:y},s){const E=Object.create(null);let R=rh;return s.once?q8(r).then(O=>{O.exists()?J5(s,e,t,O,E,y,o,c,f):(y.set(e,t,null),c())}).catch(f):R=OR(r,O=>{O.exists()?J5(s,e,t,O,E,y,o,c,f):(y.set(e,t,null),c())},f),()=>{R(),bT(E)}}function Q5(r,e,t,o,c,f,y,s,E){const R=Object.keys(c);if(Object.keys(o).filter(Q=>R.indexOf(Q)<0).forEach(Q=>{o[Q].unsub(),delete o[Q]}),!R.length||++y>r.maxRefDepth)return s(t);let A=0;const U=R.length,$=Object.create(null);function te(Q){Q in $&&++A>=U&&s(t)}R.forEach(Q=>{const de=o[Q],Ce=c[Q],Fe=`${t}.${Q}`;if($[Fe]=!0,de)if(de.path!==Ce.path)de.unsub();else return;o[Q]={data:()=>kC(e,Fe),unsub:vse({ref:Ce,target:e,path:Fe,depth:y,ops:f,resolve:te.bind(null,Fe),reject:E},r),path:Ce.path}})}function xse(r,e,t,o,c,f){const y=Object.assign({},FR,f),{snapshotListenOptions:s,snapshotOptions:E,wait:R,once:O}=y,A="value";let U=Qn(R?[]:r.value);R||t.set(r,A,[]);const $=o;let te,Q=rh;const de=[],Ce={added:({newIndex:Le,doc:Me})=>{de.splice(Le,0,Object.create(null));const at=de[Le],[pt,me]=Y5(Me.data(E),void 0,at,y);t.add(ad(U),Le,pt),Q5(y,U,`${A}.${Le}`,at,me,t,0,o.bind(null,Me),c)},modified:({oldIndex:Le,newIndex:Me,doc:at})=>{const pt=ad(U),me=de[Le],ye=pt[Le],[Se,ke]=Y5(at.data(E),ye,me,y);de.splice(Me,0,me),t.remove(pt,Le),t.add(pt,Me,Se),Q5(y,U,`${A}.${Me}`,me,ke,t,0,o,c)},removed:({oldIndex:Le})=>{const Me=ad(U);t.remove(Me,Le),bT(de.splice(Le,1)[0])}};function Fe(Le){const Me=Le.docChanges(s);if(!te&&Me.length){te=!0;let at=0;const pt=Me.length,me=Object.create(null);for(let ye=0;ye<pt;ye++)me[Me[ye].doc.id]=!0;o=ye=>{ye&&ye.id in me&&++at>=pt&&(R&&(t.set(r,A,ad(U)),U=r),$(ad(U)),o=rh)}}Me.forEach(at=>{Ce[at.type](at)}),Me.length||(R&&(t.set(r,A,ad(U)),U=r),o(ad(U)))}return O?Nne(e).then(Fe).catch(c):Q=OR(e,Fe,c),Le=>{if(Q(),Le){const Me=typeof Le=="function"?Le():[];t.set(r,A,Me)}de.forEach(bT)}}function bse(r,e,t,o,c,f){const y=Object.assign({},FR,f),s="value",E=Object.create(null);o=ZJ(o,()=>kC(r,s));let R=rh;function O(A){A.exists()?J5(y,r,s,A,E,t,0,o,c):(t.set(r,s,null),o(null))}return y.once?q8(e).then(O).catch(c):R=OR(e,O,c),A=>{if(R(),A){const U=typeof A=="function"?A():null;t.set(r,s,U)}bT(E)}}const pO=Symbol();function Q8(r,e){let t=rh;const o=Object.assign({},FR,e),c=ad(r),f=o.target||Qn();YJ()&&(o.once=!0);const y=mse(c,o.ssrKey,pO,uE()),s=y!==pO;s&&(f.value=y);let E=!s;const R=Qn(!1),O=Qn(),A=fz(),U=ZF();let $=rh;function te(){let Ce=ad(r);const Fe=new Promise((Le,Me)=>{if(t(o.reset),!Ce)return t=rh,Le(null);R.value=E,E=!0,Ce.converter||(Ce=Ce.withConverter(o.converter)),t=(DC(Ce)?bse:xse)(f,Ce,wse,Le,Me,o)}).catch(Le=>(A.value===Fe&&(O.value=Le),Promise.reject(Le))).finally(()=>{A.value===Fe&&(R.value=!1)});A.value=Fe}let Q=rh;(ga(r)||typeof r=="function")&&(Q=Hf(r,te)),te(),c&&($=gse(A.value,c,o.ssrKey)),mC()&&Iz(()=>A.value),U&&_H(de);function de(Ce=o.reset){Q(),$(),t(Ce)}return Object.defineProperties(f,{error:{get:()=>O},data:{get:()=>f},pending:{get:()=>R},promise:{get:()=>A},stop:{get:()=>de}})}const wse={set:(r,e,t)=>UJ(r,e,t),add:(r,e,t)=>r.splice(e,0,t),remove:(r,e)=>r.splice(e,1)};function Tse(r,e){return Q8(r,{target:Qn([]),...e})}function Ese(r,e){return Q8(r,e)}function Ise(r){return Sse({initialUser:r,dependencies:{popupRedirectResolver:lJ,persistence:[yY,oY,JN]}})}const e9=Symbol("VueFireAuth");function Sse({dependencies:r,initialUser:e}){return(t,o)=>{const[c,f]=Ase(t,o,e,r);eQ(c,f)}}function Ase(r,e,t,o,c=$K(r,o)){const f=JJ(r,e).run(()=>Qn(t));return hB.set(r,f),e.provide(e9,c),[f,c]}function Cse(r){return VJ?Al(e9):null}function Rse(r,{firebaseApp:e,modules:t=[]}){r.provide(uB,e);for(const o of t)o(e,r)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Xa=r=>(e,t)=>{t!==void 0?t.addInitializer(()=>{customElements.define(r,e)}):customElements.define(r,e)};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const S2=globalThis,zR=S2.ShadowRoot&&(S2.ShadyCSS===void 0||S2.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,NR=Symbol(),mO=new WeakMap;let t9=class{constructor(e,t,o){if(this._$cssResult$=!0,o!==NR)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(zR&&e===void 0){const o=t!==void 0&&t.length===1;o&&(e=mO.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),o&&mO.set(t,e))}return e}toString(){return this.cssText}};const Pse=r=>new t9(typeof r=="string"?r:r+"",void 0,NR),ho=(r,...e)=>{const t=r.length===1?r[0]:e.reduce((o,c,f)=>o+(y=>{if(y._$cssResult$===!0)return y.cssText;if(typeof y=="number")return y;throw Error("Value passed to 'css' function must be a 'css' function result: "+y+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(c)+r[f+1],r[0]);return new t9(t,r,NR)},Mse=(r,e)=>{if(zR)r.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const t of e){const o=document.createElement("style"),c=S2.litNonce;c!==void 0&&o.setAttribute("nonce",c),o.textContent=t.cssText,r.appendChild(o)}},_O=zR?r=>r:r=>r instanceof CSSStyleSheet?(e=>{let t="";for(const o of e.cssRules)t+=o.cssText;return Pse(t)})(r):r;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:kse,defineProperty:Dse,getOwnPropertyDescriptor:Lse,getOwnPropertyNames:Ose,getOwnPropertySymbols:Fse,getPrototypeOf:zse}=Object,Kf=globalThis,gO=Kf.trustedTypes,Nse=gO?gO.emptyScript:"",EA=Kf.reactiveElementPolyfillSupport,C1=(r,e)=>r,wT={toAttribute(r,e){switch(e){case Boolean:r=r?Nse:null;break;case Object:case Array:r=r==null?r:JSON.stringify(r)}return r},fromAttribute(r,e){let t=r;switch(e){case Boolean:t=r!==null;break;case Number:t=r===null?null:Number(r);break;case Object:case Array:try{t=JSON.parse(r)}catch{t=null}}return t}},BR=(r,e)=>!kse(r,e),yO={attribute:!0,type:String,converter:wT,reflect:!1,useDefault:!1,hasChanged:BR};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Kf.litPropertyMetadata??(Kf.litPropertyMetadata=new WeakMap);let Mg=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=yO){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const o=Symbol(),c=this.getPropertyDescriptor(e,o,t);c!==void 0&&Dse(this.prototype,e,c)}}static getPropertyDescriptor(e,t,o){const{get:c,set:f}=Lse(this.prototype,e)??{get(){return this[t]},set(y){this[t]=y}};return{get:c,set(y){const s=c==null?void 0:c.call(this);f==null||f.call(this,y),this.requestUpdate(e,s,o)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??yO}static _$Ei(){if(this.hasOwnProperty(C1("elementProperties")))return;const e=zse(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(C1("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(C1("properties"))){const t=this.properties,o=[...Ose(t),...Fse(t)];for(const c of o)this.createProperty(c,t[c])}const e=this[Symbol.metadata];if(e!==null){const t=litPropertyMetadata.get(e);if(t!==void 0)for(const[o,c]of t)this.elementProperties.set(o,c)}this._$Eh=new Map;for(const[t,o]of this.elementProperties){const c=this._$Eu(t,o);c!==void 0&&this._$Eh.set(c,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const o=new Set(e.flat(1/0).reverse());for(const c of o)t.unshift(_O(c))}else e!==void 0&&t.push(_O(e));return t}static _$Eu(e,t){const o=t.attribute;return o===!1?void 0:typeof o=="string"?o:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(t=>t(this))}addController(e){var t;(this._$EO??(this._$EO=new Set)).add(e),this.renderRoot!==void 0&&this.isConnected&&((t=e.hostConnected)==null||t.call(e))}removeController(e){var t;(t=this._$EO)==null||t.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const o of t.keys())this.hasOwnProperty(o)&&(e.set(o,this[o]),delete this[o]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Mse(e,this.constructor.elementStyles),e}connectedCallback(){var e;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$EO)==null||e.forEach(t=>{var o;return(o=t.hostConnected)==null?void 0:o.call(t)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$EO)==null||e.forEach(t=>{var o;return(o=t.hostDisconnected)==null?void 0:o.call(t)})}attributeChangedCallback(e,t,o){this._$AK(e,o)}_$ET(e,t){var f;const o=this.constructor.elementProperties.get(e),c=this.constructor._$Eu(e,o);if(c!==void 0&&o.reflect===!0){const y=(((f=o.converter)==null?void 0:f.toAttribute)!==void 0?o.converter:wT).toAttribute(t,o.type);this._$Em=e,y==null?this.removeAttribute(c):this.setAttribute(c,y),this._$Em=null}}_$AK(e,t){var f,y;const o=this.constructor,c=o._$Eh.get(e);if(c!==void 0&&this._$Em!==c){const s=o.getPropertyOptions(c),E=typeof s.converter=="function"?{fromAttribute:s.converter}:((f=s.converter)==null?void 0:f.fromAttribute)!==void 0?s.converter:wT;this._$Em=c;const R=E.fromAttribute(t,s.type);this[c]=R??((y=this._$Ej)==null?void 0:y.get(c))??R,this._$Em=null}}requestUpdate(e,t,o){var c;if(e!==void 0){const f=this.constructor,y=this[e];if(o??(o=f.getPropertyOptions(e)),!((o.hasChanged??BR)(y,t)||o.useDefault&&o.reflect&&y===((c=this._$Ej)==null?void 0:c.get(e))&&!this.hasAttribute(f._$Eu(e,o))))return;this.C(e,t,o)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,t,{useDefault:o,reflect:c,wrapped:f},y){o&&!(this._$Ej??(this._$Ej=new Map)).has(e)&&(this._$Ej.set(e,y??t??this[e]),f!==!0||y!==void 0)||(this._$AL.has(e)||(this.hasUpdated||o||(t=void 0),this._$AL.set(e,t)),c===!0&&this._$Em!==e&&(this._$Eq??(this._$Eq=new Set)).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var o;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[f,y]of this._$Ep)this[f]=y;this._$Ep=void 0}const c=this.constructor.elementProperties;if(c.size>0)for(const[f,y]of c){const{wrapped:s}=y,E=this[f];s!==!0||this._$AL.has(f)||E===void 0||this.C(f,void 0,y,E)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),(o=this._$EO)==null||o.forEach(c=>{var f;return(f=c.hostUpdate)==null?void 0:f.call(c)}),this.update(t)):this._$EM()}catch(c){throw e=!1,this._$EM(),c}e&&this._$AE(t)}willUpdate(e){}_$AE(e){var t;(t=this._$EO)==null||t.forEach(o=>{var c;return(c=o.hostUpdated)==null?void 0:c.call(o)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&(this._$Eq=this._$Eq.forEach(t=>this._$ET(t,this[t]))),this._$EM()}updated(e){}firstUpdated(e){}};Mg.elementStyles=[],Mg.shadowRootOptions={mode:"open"},Mg[C1("elementProperties")]=new Map,Mg[C1("finalized")]=new Map,EA==null||EA({ReactiveElement:Mg}),(Kf.reactiveElementVersions??(Kf.reactiveElementVersions=[])).push("2.1.1");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Bse={attribute:!0,type:String,converter:wT,reflect:!1,hasChanged:BR},Vse=(r=Bse,e,t)=>{const{kind:o,metadata:c}=t;let f=globalThis.litPropertyMetadata.get(c);if(f===void 0&&globalThis.litPropertyMetadata.set(c,f=new Map),o==="setter"&&((r=Object.create(r)).wrapped=!0),f.set(t.name,r),o==="accessor"){const{name:y}=t;return{set(s){const E=e.get.call(this);e.set.call(this,s),this.requestUpdate(y,E,r)},init(s){return s!==void 0&&this.C(y,void 0,r,s),s}}}if(o==="setter"){const{name:y}=t;return function(s){const E=this[y];e.call(this,s),this.requestUpdate(y,E,r)}}throw Error("Unsupported decorator location: "+o)};function Mi(r){return(e,t)=>typeof t=="object"?Vse(r,e,t):((o,c,f)=>{const y=c.hasOwnProperty(f);return c.constructor.createProperty(f,o),y?Object.getOwnPropertyDescriptor(c,f):void 0})(r,e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function jo(r){return Mi({...r,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const VR=(r,e,t)=>(t.configurable=!0,t.enumerable=!0,Reflect.decorate&&typeof e!="object"&&Object.defineProperty(r,e,t),t);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function lc(r,e){return(t,o,c)=>{const f=y=>{var s;return((s=y.renderRoot)==null?void 0:s.querySelector(r))??null};return VR(t,o,{get(){return f(this)}})}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function i9(r){return(e,t)=>VR(e,t,{async get(){var o;return await this.updateComplete,((o=this.renderRoot)==null?void 0:o.querySelector(r))??null}})}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function ME(r){return(e,t)=>{const{slot:o,selector:c}=r??{},f="slot"+(o?`[name=${o}]`:":not([name])");return VR(e,t,{get(){var E;const y=(E=this.renderRoot)==null?void 0:E.querySelector(f),s=(y==null?void 0:y.assignedElements(r))??[];return c===void 0?s:s.filter(R=>R.matches(c))}})}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const R1=globalThis,TT=R1.trustedTypes,vO=TT?TT.createPolicy("lit-html",{createHTML:r=>r}):void 0,r9="$lit$",zf=`lit$${Math.random().toFixed(9).slice(2)}$`,n9="?"+zf,Use=`<${n9}>`,Fm=document,cx=()=>Fm.createComment(""),ux=r=>r===null||typeof r!="object"&&typeof r!="function",UR=Array.isArray,jse=r=>UR(r)||typeof(r==null?void 0:r[Symbol.iterator])=="function",IA=`[ 	
\f\r]`,Uv=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,xO=/-->/g,bO=/>/g,Yp=RegExp(`>|${IA}(?:([^\\s"'>=/]+)(${IA}*=${IA}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),wO=/'/g,TO=/"/g,s9=/^(?:script|style|textarea|title)$/i,$se=r=>(e,...t)=>({_$litType$:r,strings:e,values:t}),Xr=$se(1),Dc=Symbol.for("lit-noChange"),sr=Symbol.for("lit-nothing"),EO=new WeakMap,cm=Fm.createTreeWalker(Fm,129);function o9(r,e){if(!UR(r)||!r.hasOwnProperty("raw"))throw Error("invalid template strings array");return vO!==void 0?vO.createHTML(e):e}const Gse=(r,e)=>{const t=r.length-1,o=[];let c,f=e===2?"<svg>":e===3?"<math>":"",y=Uv;for(let s=0;s<t;s++){const E=r[s];let R,O,A=-1,U=0;for(;U<E.length&&(y.lastIndex=U,O=y.exec(E),O!==null);)U=y.lastIndex,y===Uv?O[1]==="!--"?y=xO:O[1]!==void 0?y=bO:O[2]!==void 0?(s9.test(O[2])&&(c=RegExp("</"+O[2],"g")),y=Yp):O[3]!==void 0&&(y=Yp):y===Yp?O[0]===">"?(y=c??Uv,A=-1):O[1]===void 0?A=-2:(A=y.lastIndex-O[2].length,R=O[1],y=O[3]===void 0?Yp:O[3]==='"'?TO:wO):y===TO||y===wO?y=Yp:y===xO||y===bO?y=Uv:(y=Yp,c=void 0);const $=y===Yp&&r[s+1].startsWith("/>")?" ":"";f+=y===Uv?E+Use:A>=0?(o.push(R),E.slice(0,A)+r9+E.slice(A)+zf+$):E+zf+(A===-2?s:$)}return[o9(r,f+(r[t]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),o]};let e4=class a9{constructor({strings:e,_$litType$:t},o){let c;this.parts=[];let f=0,y=0;const s=e.length-1,E=this.parts,[R,O]=Gse(e,t);if(this.el=a9.createElement(R,o),cm.currentNode=this.el.content,t===2||t===3){const A=this.el.content.firstChild;A.replaceWith(...A.childNodes)}for(;(c=cm.nextNode())!==null&&E.length<s;){if(c.nodeType===1){if(c.hasAttributes())for(const A of c.getAttributeNames())if(A.endsWith(r9)){const U=O[y++],$=c.getAttribute(A).split(zf),te=/([.?@])?(.*)/.exec(U);E.push({type:1,index:f,name:te[2],strings:$,ctor:te[1]==="."?qse:te[1]==="?"?Wse:te[1]==="@"?Xse:kE}),c.removeAttribute(A)}else A.startsWith(zf)&&(E.push({type:6,index:f}),c.removeAttribute(A));if(s9.test(c.tagName)){const A=c.textContent.split(zf),U=A.length-1;if(U>0){c.textContent=TT?TT.emptyScript:"";for(let $=0;$<U;$++)c.append(A[$],cx()),cm.nextNode(),E.push({type:2,index:++f});c.append(A[U],cx())}}}else if(c.nodeType===8)if(c.data===n9)E.push({type:2,index:f});else{let A=-1;for(;(A=c.data.indexOf(zf,A+1))!==-1;)E.push({type:7,index:f}),A+=zf.length-1}f++}}static createElement(e,t){const o=Fm.createElement("template");return o.innerHTML=e,o}};function A0(r,e,t=r,o){var y,s;if(e===Dc)return e;let c=o!==void 0?(y=t._$Co)==null?void 0:y[o]:t._$Cl;const f=ux(e)?void 0:e._$litDirective$;return(c==null?void 0:c.constructor)!==f&&((s=c==null?void 0:c._$AO)==null||s.call(c,!1),f===void 0?c=void 0:(c=new f(r),c._$AT(r,t,o)),o!==void 0?(t._$Co??(t._$Co=[]))[o]=c:t._$Cl=c),c!==void 0&&(e=A0(r,c._$AS(r,e.values),c,o)),e}let Hse=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:o}=this._$AD,c=((e==null?void 0:e.creationScope)??Fm).importNode(t,!0);cm.currentNode=c;let f=cm.nextNode(),y=0,s=0,E=o[0];for(;E!==void 0;){if(y===E.index){let R;E.type===2?R=new jR(f,f.nextSibling,this,e):E.type===1?R=new E.ctor(f,E.name,E.strings,this,e):E.type===6&&(R=new Zse(f,this,e)),this._$AV.push(R),E=o[++s]}y!==(E==null?void 0:E.index)&&(f=cm.nextNode(),y++)}return cm.currentNode=Fm,c}p(e){let t=0;for(const o of this._$AV)o!==void 0&&(o.strings!==void 0?(o._$AI(e,o,t),t+=o.strings.length-2):o._$AI(e[t])),t++}},jR=class l9{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this._$Cv}constructor(e,t,o,c){this.type=2,this._$AH=sr,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=o,this.options=c,this._$Cv=(c==null?void 0:c.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=A0(this,e,t),ux(e)?e===sr||e==null||e===""?(this._$AH!==sr&&this._$AR(),this._$AH=sr):e!==this._$AH&&e!==Dc&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):jse(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==sr&&ux(this._$AH)?this._$AA.nextSibling.data=e:this.T(Fm.createTextNode(e)),this._$AH=e}$(e){var f;const{values:t,_$litType$:o}=e,c=typeof o=="number"?this._$AC(e):(o.el===void 0&&(o.el=e4.createElement(o9(o.h,o.h[0]),this.options)),o);if(((f=this._$AH)==null?void 0:f._$AD)===c)this._$AH.p(t);else{const y=new Hse(c,this),s=y.u(this.options);y.p(t),this.T(s),this._$AH=y}}_$AC(e){let t=EO.get(e.strings);return t===void 0&&EO.set(e.strings,t=new e4(e)),t}k(e){UR(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let o,c=0;for(const f of e)c===t.length?t.push(o=new l9(this.O(cx()),this.O(cx()),this,this.options)):o=t[c],o._$AI(f),c++;c<t.length&&(this._$AR(o&&o._$AB.nextSibling,c),t.length=c)}_$AR(e=this._$AA.nextSibling,t){var o;for((o=this._$AP)==null?void 0:o.call(this,!1,!0,t);e!==this._$AB;){const c=e.nextSibling;e.remove(),e=c}}setConnected(e){var t;this._$AM===void 0&&(this._$Cv=e,(t=this._$AP)==null||t.call(this,e))}},kE=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,o,c,f){this.type=1,this._$AH=sr,this._$AN=void 0,this.element=e,this.name=t,this._$AM=c,this.options=f,o.length>2||o[0]!==""||o[1]!==""?(this._$AH=Array(o.length-1).fill(new String),this.strings=o):this._$AH=sr}_$AI(e,t=this,o,c){const f=this.strings;let y=!1;if(f===void 0)e=A0(this,e,t,0),y=!ux(e)||e!==this._$AH&&e!==Dc,y&&(this._$AH=e);else{const s=e;let E,R;for(e=f[0],E=0;E<f.length-1;E++)R=A0(this,s[o+E],t,E),R===Dc&&(R=this._$AH[E]),y||(y=!ux(R)||R!==this._$AH[E]),R===sr?e=sr:e!==sr&&(e+=(R??"")+f[E+1]),this._$AH[E]=R}y&&!c&&this.j(e)}j(e){e===sr?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}},qse=class extends kE{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===sr?void 0:e}},Wse=class extends kE{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==sr)}},Xse=class extends kE{constructor(e,t,o,c,f){super(e,t,o,c,f),this.type=5}_$AI(e,t=this){if((e=A0(this,e,t,0)??sr)===Dc)return;const o=this._$AH,c=e===sr&&o!==sr||e.capture!==o.capture||e.once!==o.once||e.passive!==o.passive,f=e!==sr&&(o===sr||c);c&&this.element.removeEventListener(this.name,this,o),f&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t;typeof this._$AH=="function"?this._$AH.call(((t=this.options)==null?void 0:t.host)??this.element,e):this._$AH.handleEvent(e)}},Zse=class{constructor(e,t,o){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=o}get _$AU(){return this._$AM._$AU}_$AI(e){A0(this,e)}};const SA=R1.litHtmlPolyfillSupport;SA==null||SA(e4,jR),(R1.litHtmlVersions??(R1.litHtmlVersions=[])).push("3.3.1");const c9=(r,e,t)=>{const o=(t==null?void 0:t.renderBefore)??e;let c=o._$litPart$;if(c===void 0){const f=(t==null?void 0:t.renderBefore)??null;o._$litPart$=c=new jR(e.insertBefore(cx(),f),f,void 0,t??{})}return c._$AI(r),c};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const mm=globalThis;let Uo=class extends Mg{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t;const e=super.createRenderRoot();return(t=this.renderOptions).renderBefore??(t.renderBefore=e.firstChild),e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=c9(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return Dc}};var FF;Uo._$litElement$=!0,Uo.finalized=!0,(FF=mm.litElementHydrateSupport)==null||FF.call(mm,{LitElement:Uo});const AA=mm.litElementPolyfillSupport;AA==null||AA({LitElement:Uo});(mm.litElementVersions??(mm.litElementVersions=[])).push("4.2.1");/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const u9=Symbol("attachableController");let A2;A2=new MutationObserver(r=>{var e;for(const t of r)(e=t.target[u9])==null||e.hostConnected()});class h9{get htmlFor(){return this.host.getAttribute("for")}set htmlFor(e){e===null?this.host.removeAttribute("for"):this.host.setAttribute("for",e)}get control(){return this.host.hasAttribute("for")?!this.htmlFor||!this.host.isConnected?null:this.host.getRootNode().querySelector(`#${this.htmlFor}`):this.currentControl||this.host.parentElement}set control(e){e?this.attach(e):this.detach()}constructor(e,t){this.host=e,this.onControlChange=t,this.currentControl=null,e.addController(this),e[u9]=this,A2==null||A2.observe(e,{attributeFilter:["for"]})}attach(e){e!==this.currentControl&&(this.setCurrentControl(e),this.host.removeAttribute("for"))}detach(){this.setCurrentControl(null),this.host.setAttribute("for","")}hostConnected(){this.setCurrentControl(this.control)}hostDisconnected(){this.setCurrentControl(null)}setCurrentControl(e){this.onControlChange(this.currentControl,e),this.currentControl=e}}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Kse=["focusin","focusout","pointerdown"];class $R extends Uo{constructor(){super(...arguments),this.visible=!1,this.inward=!1,this.attachableController=new h9(this,this.onControlChange.bind(this))}get htmlFor(){return this.attachableController.htmlFor}set htmlFor(e){this.attachableController.htmlFor=e}get control(){return this.attachableController.control}set control(e){this.attachableController.control=e}attach(e){this.attachableController.attach(e)}detach(){this.attachableController.detach()}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-hidden","true")}handleEvent(e){var t;if(!e[IO]){switch(e.type){default:return;case"focusin":this.visible=((t=this.control)==null?void 0:t.matches(":focus-visible"))??!1;break;case"focusout":case"pointerdown":this.visible=!1;break}e[IO]=!0}}onControlChange(e,t){for(const o of Kse)e==null||e.removeEventListener(o,this),t==null||t.addEventListener(o,this)}update(e){e.has("visible")&&this.dispatchEvent(new Event("visibility-changed")),super.update(e)}}Nt([Mi({type:Boolean,reflect:!0})],$R.prototype,"visible",void 0);Nt([Mi({type:Boolean,reflect:!0})],$R.prototype,"inward",void 0);const IO=Symbol("handledByFocusRing");/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Yse=ho`:host{animation-delay:0s,calc(var(--md-focus-ring-duration, 600ms)*.25);animation-duration:calc(var(--md-focus-ring-duration, 600ms)*.25),calc(var(--md-focus-ring-duration, 600ms)*.75);animation-timing-function:cubic-bezier(0.2, 0, 0, 1);box-sizing:border-box;color:var(--md-focus-ring-color, var(--md-sys-color-secondary, #625b71));display:none;pointer-events:none;position:absolute}:host([visible]){display:flex}:host(:not([inward])){animation-name:outward-grow,outward-shrink;border-end-end-radius:calc(var(--md-focus-ring-shape-end-end, var(--md-focus-ring-shape, var(--md-sys-shape-corner-full, 9999px))) + var(--md-focus-ring-outward-offset, 2px));border-end-start-radius:calc(var(--md-focus-ring-shape-end-start, var(--md-focus-ring-shape, var(--md-sys-shape-corner-full, 9999px))) + var(--md-focus-ring-outward-offset, 2px));border-start-end-radius:calc(var(--md-focus-ring-shape-start-end, var(--md-focus-ring-shape, var(--md-sys-shape-corner-full, 9999px))) + var(--md-focus-ring-outward-offset, 2px));border-start-start-radius:calc(var(--md-focus-ring-shape-start-start, var(--md-focus-ring-shape, var(--md-sys-shape-corner-full, 9999px))) + var(--md-focus-ring-outward-offset, 2px));inset:calc(-1*var(--md-focus-ring-outward-offset, 2px));outline:var(--md-focus-ring-width, 3px) solid currentColor}:host([inward]){animation-name:inward-grow,inward-shrink;border-end-end-radius:calc(var(--md-focus-ring-shape-end-end, var(--md-focus-ring-shape, var(--md-sys-shape-corner-full, 9999px))) - var(--md-focus-ring-inward-offset, 0px));border-end-start-radius:calc(var(--md-focus-ring-shape-end-start, var(--md-focus-ring-shape, var(--md-sys-shape-corner-full, 9999px))) - var(--md-focus-ring-inward-offset, 0px));border-start-end-radius:calc(var(--md-focus-ring-shape-start-end, var(--md-focus-ring-shape, var(--md-sys-shape-corner-full, 9999px))) - var(--md-focus-ring-inward-offset, 0px));border-start-start-radius:calc(var(--md-focus-ring-shape-start-start, var(--md-focus-ring-shape, var(--md-sys-shape-corner-full, 9999px))) - var(--md-focus-ring-inward-offset, 0px));border:var(--md-focus-ring-width, 3px) solid currentColor;inset:var(--md-focus-ring-inward-offset, 0px)}@keyframes outward-grow{from{outline-width:0}to{outline-width:var(--md-focus-ring-active-width, 8px)}}@keyframes outward-shrink{from{outline-width:var(--md-focus-ring-active-width, 8px)}}@keyframes inward-grow{from{border-width:0}to{border-width:var(--md-focus-ring-active-width, 8px)}}@keyframes inward-shrink{from{border-width:var(--md-focus-ring-active-width, 8px)}}@media(prefers-reduced-motion){:host{animation:none}}
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let t4=class extends $R{};t4.styles=[Yse];t4=Nt([Xa("md-focus-ring")],t4);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Df={ATTRIBUTE:1,PROPERTY:3,BOOLEAN_ATTRIBUTE:4},GR=r=>(...e)=>({_$litDirective$:r,values:e});let HR=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,o){this._$Ct=e,this._$AM=t,this._$Ci=o}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Sl=GR(class extends HR{constructor(r){var e;if(super(r),r.type!==Df.ATTRIBUTE||r.name!=="class"||((e=r.strings)==null?void 0:e.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(r){return" "+Object.keys(r).filter(e=>r[e]).join(" ")+" "}update(r,[e]){var o,c;if(this.st===void 0){this.st=new Set,r.strings!==void 0&&(this.nt=new Set(r.strings.join(" ").split(/\s/).filter(f=>f!=="")));for(const f in e)e[f]&&!((o=this.nt)!=null&&o.has(f))&&this.st.add(f);return this.render(e)}const t=r.element.classList;for(const f of this.st)f in e||(t.remove(f),this.st.delete(f));for(const f in e){const y=!!e[f];y===this.st.has(f)||(c=this.nt)!=null&&c.has(f)||(y?(t.add(f),this.st.add(f)):(t.remove(f),this.st.delete(f)))}return Dc}});/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const d9={STANDARD:"cubic-bezier(0.2, 0, 0, 1)"};/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Jse=450,SO=225,Qse=.2,eoe=10,toe=75,ioe=.35,roe="::after",noe="forwards";var cl;(function(r){r[r.INACTIVE=0]="INACTIVE",r[r.TOUCH_DELAY=1]="TOUCH_DELAY",r[r.HOLDING=2]="HOLDING",r[r.WAITING_FOR_CLICK=3]="WAITING_FOR_CLICK"})(cl||(cl={}));const soe=["click","contextmenu","pointercancel","pointerdown","pointerenter","pointerleave","pointerup"],ooe=150,CA=window.matchMedia("(forced-colors: active)");class Gx extends Uo{constructor(){super(...arguments),this.disabled=!1,this.hovered=!1,this.pressed=!1,this.rippleSize="",this.rippleScale="",this.initialSize=0,this.state=cl.INACTIVE,this.checkBoundsAfterContextMenu=!1,this.attachableController=new h9(this,this.onControlChange.bind(this))}get htmlFor(){return this.attachableController.htmlFor}set htmlFor(e){this.attachableController.htmlFor=e}get control(){return this.attachableController.control}set control(e){this.attachableController.control=e}attach(e){this.attachableController.attach(e)}detach(){this.attachableController.detach()}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-hidden","true")}render(){const e={hovered:this.hovered,pressed:this.pressed};return Xr`<div class="surface ${Sl(e)}"></div>`}update(e){e.has("disabled")&&this.disabled&&(this.hovered=!1,this.pressed=!1),super.update(e)}handlePointerenter(e){this.shouldReactToEvent(e)&&(this.hovered=!0)}handlePointerleave(e){this.shouldReactToEvent(e)&&(this.hovered=!1,this.state!==cl.INACTIVE&&this.endPressAnimation())}handlePointerup(e){if(this.shouldReactToEvent(e)){if(this.state===cl.HOLDING){this.state=cl.WAITING_FOR_CLICK;return}if(this.state===cl.TOUCH_DELAY){this.state=cl.WAITING_FOR_CLICK,this.startPressAnimation(this.rippleStartEvent);return}}}async handlePointerdown(e){if(this.shouldReactToEvent(e)){if(this.rippleStartEvent=e,!this.isTouch(e)){this.state=cl.WAITING_FOR_CLICK,this.startPressAnimation(e);return}this.checkBoundsAfterContextMenu&&!this.inBounds(e)||(this.checkBoundsAfterContextMenu=!1,this.state=cl.TOUCH_DELAY,await new Promise(t=>{setTimeout(t,ooe)}),this.state===cl.TOUCH_DELAY&&(this.state=cl.HOLDING,this.startPressAnimation(e)))}}handleClick(){if(!this.disabled){if(this.state===cl.WAITING_FOR_CLICK){this.endPressAnimation();return}this.state===cl.INACTIVE&&(this.startPressAnimation(),this.endPressAnimation())}}handlePointercancel(e){this.shouldReactToEvent(e)&&this.endPressAnimation()}handleContextmenu(){this.disabled||(this.checkBoundsAfterContextMenu=!0,this.endPressAnimation())}determineRippleSize(){const{height:e,width:t}=this.getBoundingClientRect(),o=Math.max(e,t),c=Math.max(ioe*o,toe),f=Math.floor(o*Qse),s=Math.sqrt(t**2+e**2)+eoe;this.initialSize=f,this.rippleScale=`${(s+c)/f}`,this.rippleSize=`${f}px`}getNormalizedPointerEventCoords(e){const{scrollX:t,scrollY:o}=window,{left:c,top:f}=this.getBoundingClientRect(),y=t+c,s=o+f,{pageX:E,pageY:R}=e;return{x:E-y,y:R-s}}getTranslationCoordinates(e){const{height:t,width:o}=this.getBoundingClientRect(),c={x:(o-this.initialSize)/2,y:(t-this.initialSize)/2};let f;return e instanceof PointerEvent?f=this.getNormalizedPointerEventCoords(e):f={x:o/2,y:t/2},f={x:f.x-this.initialSize/2,y:f.y-this.initialSize/2},{startPoint:f,endPoint:c}}startPressAnimation(e){var y;if(!this.mdRoot)return;this.pressed=!0,(y=this.growAnimation)==null||y.cancel(),this.determineRippleSize();const{startPoint:t,endPoint:o}=this.getTranslationCoordinates(e),c=`${t.x}px, ${t.y}px`,f=`${o.x}px, ${o.y}px`;this.growAnimation=this.mdRoot.animate({top:[0,0],left:[0,0],height:[this.rippleSize,this.rippleSize],width:[this.rippleSize,this.rippleSize],transform:[`translate(${c}) scale(1)`,`translate(${f}) scale(${this.rippleScale})`]},{pseudoElement:roe,duration:Jse,easing:d9.STANDARD,fill:noe})}async endPressAnimation(){this.rippleStartEvent=void 0,this.state=cl.INACTIVE;const e=this.growAnimation;let t=1/0;if(typeof(e==null?void 0:e.currentTime)=="number"?t=e.currentTime:e!=null&&e.currentTime&&(t=e.currentTime.to("ms").value),t>=SO){this.pressed=!1;return}await new Promise(o=>{setTimeout(o,SO-t)}),this.growAnimation===e&&(this.pressed=!1)}shouldReactToEvent(e){if(this.disabled||!e.isPrimary||this.rippleStartEvent&&this.rippleStartEvent.pointerId!==e.pointerId)return!1;if(e.type==="pointerenter"||e.type==="pointerleave")return!this.isTouch(e);const t=e.buttons===1;return this.isTouch(e)||t}inBounds({x:e,y:t}){const{top:o,left:c,bottom:f,right:y}=this.getBoundingClientRect();return e>=c&&e<=y&&t>=o&&t<=f}isTouch({pointerType:e}){return e==="touch"}async handleEvent(e){if(!(CA!=null&&CA.matches))switch(e.type){case"click":this.handleClick();break;case"contextmenu":this.handleContextmenu();break;case"pointercancel":this.handlePointercancel(e);break;case"pointerdown":await this.handlePointerdown(e);break;case"pointerenter":this.handlePointerenter(e);break;case"pointerleave":this.handlePointerleave(e);break;case"pointerup":this.handlePointerup(e);break}}onControlChange(e,t){for(const o of soe)e==null||e.removeEventListener(o,this),t==null||t.addEventListener(o,this)}}Nt([Mi({type:Boolean,reflect:!0})],Gx.prototype,"disabled",void 0);Nt([jo()],Gx.prototype,"hovered",void 0);Nt([jo()],Gx.prototype,"pressed",void 0);Nt([lc(".surface")],Gx.prototype,"mdRoot",void 0);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const aoe=ho`:host{display:flex;margin:auto;pointer-events:none}:host([disabled]){display:none}@media(forced-colors: active){:host{display:none}}:host,.surface{border-radius:inherit;position:absolute;inset:0;overflow:hidden}.surface{-webkit-tap-highlight-color:rgba(0,0,0,0)}.surface::before,.surface::after{content:"";opacity:0;position:absolute}.surface::before{background-color:var(--md-ripple-hover-color, var(--md-sys-color-on-surface, #1d1b20));inset:0;transition:opacity 15ms linear,background-color 15ms linear}.surface::after{background:radial-gradient(closest-side, var(--md-ripple-pressed-color, var(--md-sys-color-on-surface, #1d1b20)) max(100% - 70px, 65%), transparent 100%);transform-origin:center center;transition:opacity 375ms linear}.hovered::before{background-color:var(--md-ripple-hover-color, var(--md-sys-color-on-surface, #1d1b20));opacity:var(--md-ripple-hover-opacity, 0.08)}.pressed::after{opacity:var(--md-ripple-pressed-opacity, 0.12);transition-duration:105ms}
`;/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let i4=class extends Gx{};i4.styles=[aoe];i4=Nt([Xa("md-ripple")],i4);/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const f9=Symbol.for(""),loe=r=>{if((r==null?void 0:r.r)===f9)return r==null?void 0:r._$litStatic$},ET=(r,...e)=>({_$litStatic$:e.reduce((t,o,c)=>t+(f=>{if(f._$litStatic$!==void 0)return f._$litStatic$;throw Error(`Value passed to 'literal' function must be a 'literal' result: ${f}. Use 'unsafeStatic' to pass non-literal values, but
            take care to ensure page security.`)})(o)+r[c+1],r[0]),r:f9}),AO=new Map,coe=r=>(e,...t)=>{const o=t.length;let c,f;const y=[],s=[];let E,R=0,O=!1;for(;R<o;){for(E=e[R];R<o&&(f=t[R],(c=loe(f))!==void 0);)E+=c+e[++R],O=!0;R!==o&&s.push(f),y.push(E),R++}if(R===o&&y.push(e[o]),O){const A=y.join("$$lit$$");(e=AO.get(A))===void 0&&(y.raw=y,AO.set(A,e=y)),t=s}return r(e,...t)},p9=coe(Xr);/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const m9=["role","ariaAtomic","ariaAutoComplete","ariaBusy","ariaChecked","ariaColCount","ariaColIndex","ariaColSpan","ariaCurrent","ariaDisabled","ariaExpanded","ariaHasPopup","ariaHidden","ariaInvalid","ariaKeyShortcuts","ariaLabel","ariaLevel","ariaLive","ariaModal","ariaMultiLine","ariaMultiSelectable","ariaOrientation","ariaPlaceholder","ariaPosInSet","ariaPressed","ariaReadOnly","ariaRequired","ariaRoleDescription","ariaRowCount","ariaRowIndex","ariaRowSpan","ariaSelected","ariaSetSize","ariaSort","ariaValueMax","ariaValueMin","ariaValueNow","ariaValueText"];m9.map(_9);function _9(r){return r.replace("aria","aria-").replace(/Elements?/g,"").toLowerCase()}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Km(r){for(const e of m9)r.createProperty(e,{attribute:_9(e),reflect:!0});r.addInitializer(e=>{const t={hostConnected(){e.setAttribute("role","presentation")}};e.addController(t)})}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const pl=Symbol("internals"),RA=Symbol("privateInternals");function X0(r){class e extends r{get[pl](){return this[RA]||(this[RA]=this.attachInternals()),this[RA]}}return e}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function g9(r){r.addInitializer(e=>{const t=e;t.addEventListener("click",async o=>{const{type:c,[pl]:f}=t,{form:y}=f;if(!(!y||c==="button")&&(await new Promise(s=>{setTimeout(s)}),!o.defaultPrevented)){if(c==="reset"){y.reset();return}y.addEventListener("submit",s=>{Object.defineProperty(s,"submitter",{configurable:!0,enumerable:!0,get:()=>t})},{capture:!0,once:!0}),f.setFormValue(t.value),y.requestSubmit()}})})}/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function CO(r,e=!0){return e&&getComputedStyle(r).getPropertyValue("direction").trim()==="rtl"}/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const uoe=X0(Uo);class ra extends uoe{constructor(){super(...arguments),this.disabled=!1,this.flipIconInRtl=!1,this.href="",this.target="",this.ariaLabelSelected="",this.toggle=!1,this.selected=!1,this.type="submit",this.value="",this.flipIcon=CO(this,this.flipIconInRtl)}get name(){return this.getAttribute("name")??""}set name(e){this.setAttribute("name",e)}get form(){return this[pl].form}get labels(){return this[pl].labels}willUpdate(){this.href&&(this.disabled=!1)}render(){const e=this.href?ET`div`:ET`button`,{ariaLabel:t,ariaHasPopup:o,ariaExpanded:c}=this,f=t&&this.ariaLabelSelected,y=this.toggle?this.selected:sr;let s=sr;return this.href||(s=f&&this.selected?this.ariaLabelSelected:t),p9`<${e}
        class="icon-button ${Sl(this.getRenderClasses())}"
        id="button"
        aria-label="${s||sr}"
        aria-haspopup="${!this.href&&o||sr}"
        aria-expanded="${!this.href&&c||sr}"
        aria-pressed="${y}"
        ?disabled="${!this.href&&this.disabled}"
        @click="${this.handleClick}">
        ${this.renderFocusRing()}
        ${this.renderRipple()}
        ${this.selected?sr:this.renderIcon()}
        ${this.selected?this.renderSelectedIcon():sr}
        ${this.renderTouchTarget()}
        ${this.href&&this.renderLink()}
  </${e}>`}renderLink(){const{ariaLabel:e}=this;return Xr`
      <a
        class="link"
        id="link"
        href="${this.href}"
        target="${this.target||sr}"
        aria-label="${e||sr}"></a>
    `}getRenderClasses(){return{"flip-icon":this.flipIcon,selected:this.toggle&&this.selected}}renderIcon(){return Xr`<span class="icon"><slot></slot></span>`}renderSelectedIcon(){return Xr`<span class="icon icon--selected"
      ><slot name="selected"><slot></slot></slot
    ></span>`}renderTouchTarget(){return Xr`<span class="touch"></span>`}renderFocusRing(){return Xr`<md-focus-ring
      part="focus-ring"
      for=${this.href?"link":"button"}></md-focus-ring>`}renderRipple(){return Xr`<md-ripple
      for=${this.href?"link":sr}
      ?disabled="${!this.href&&this.disabled}"></md-ripple>`}connectedCallback(){this.flipIcon=CO(this,this.flipIconInRtl),super.connectedCallback()}async handleClick(e){await 0,!(!this.toggle||this.disabled||e.defaultPrevented)&&(this.selected=!this.selected,this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0})))}}Km(ra),g9(ra);ra.formAssociated=!0;ra.shadowRootOptions={mode:"open",delegatesFocus:!0};Nt([Mi({type:Boolean,reflect:!0})],ra.prototype,"disabled",void 0);Nt([Mi({type:Boolean,attribute:"flip-icon-in-rtl"})],ra.prototype,"flipIconInRtl",void 0);Nt([Mi()],ra.prototype,"href",void 0);Nt([Mi()],ra.prototype,"target",void 0);Nt([Mi({attribute:"aria-label-selected"})],ra.prototype,"ariaLabelSelected",void 0);Nt([Mi({type:Boolean})],ra.prototype,"toggle",void 0);Nt([Mi({type:Boolean,reflect:!0})],ra.prototype,"selected",void 0);Nt([Mi()],ra.prototype,"type",void 0);Nt([Mi({reflect:!0})],ra.prototype,"value",void 0);Nt([jo()],ra.prototype,"flipIcon",void 0);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const DE=ho`:host{display:inline-flex;outline:none;-webkit-tap-highlight-color:rgba(0,0,0,0);height:var(--_container-height);width:var(--_container-width);justify-content:center}:host([touch-target=wrapper]){margin:max(0px,(48px - var(--_container-height))/2) max(0px,(48px - var(--_container-width))/2)}md-focus-ring{--md-focus-ring-shape-start-start: var(--_container-shape-start-start);--md-focus-ring-shape-start-end: var(--_container-shape-start-end);--md-focus-ring-shape-end-end: var(--_container-shape-end-end);--md-focus-ring-shape-end-start: var(--_container-shape-end-start)}:host([disabled]){pointer-events:none}.icon-button{place-items:center;background:none;border:none;box-sizing:border-box;cursor:pointer;display:flex;place-content:center;outline:none;padding:0;position:relative;text-decoration:none;user-select:none;z-index:0;flex:1;border-start-start-radius:var(--_container-shape-start-start);border-start-end-radius:var(--_container-shape-start-end);border-end-start-radius:var(--_container-shape-end-start);border-end-end-radius:var(--_container-shape-end-end)}.icon ::slotted(*){font-size:var(--_icon-size);height:var(--_icon-size);width:var(--_icon-size);font-weight:inherit}md-ripple{z-index:-1;border-start-start-radius:var(--_container-shape-start-start);border-start-end-radius:var(--_container-shape-start-end);border-end-start-radius:var(--_container-shape-end-start);border-end-end-radius:var(--_container-shape-end-end)}.flip-icon .icon{transform:scaleX(-1)}.icon{display:inline-flex}.link{height:100%;outline:none;position:absolute;width:100%}.touch{position:absolute;height:max(48px,100%);width:max(48px,100%)}:host([touch-target=none]) .touch{display:none}@media(forced-colors: active){:host([disabled]){--_disabled-icon-opacity: 1}}
`;/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const hoe=ho`:host{--_disabled-icon-color: var(--md-icon-button-disabled-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-icon-opacity: var(--md-icon-button-disabled-icon-opacity, 0.38);--_icon-size: var(--md-icon-button-icon-size, 24px);--_selected-focus-icon-color: var(--md-icon-button-selected-focus-icon-color, var(--md-sys-color-primary, #6750a4));--_selected-hover-icon-color: var(--md-icon-button-selected-hover-icon-color, var(--md-sys-color-primary, #6750a4));--_selected-hover-state-layer-color: var(--md-icon-button-selected-hover-state-layer-color, var(--md-sys-color-primary, #6750a4));--_selected-hover-state-layer-opacity: var(--md-icon-button-selected-hover-state-layer-opacity, 0.08);--_selected-icon-color: var(--md-icon-button-selected-icon-color, var(--md-sys-color-primary, #6750a4));--_selected-pressed-icon-color: var(--md-icon-button-selected-pressed-icon-color, var(--md-sys-color-primary, #6750a4));--_selected-pressed-state-layer-color: var(--md-icon-button-selected-pressed-state-layer-color, var(--md-sys-color-primary, #6750a4));--_selected-pressed-state-layer-opacity: var(--md-icon-button-selected-pressed-state-layer-opacity, 0.12);--_state-layer-height: var(--md-icon-button-state-layer-height, 40px);--_state-layer-shape: var(--md-icon-button-state-layer-shape, var(--md-sys-shape-corner-full, 9999px));--_state-layer-width: var(--md-icon-button-state-layer-width, 40px);--_focus-icon-color: var(--md-icon-button-focus-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-icon-color: var(--md-icon-button-hover-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-state-layer-color: var(--md-icon-button-hover-state-layer-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-state-layer-opacity: var(--md-icon-button-hover-state-layer-opacity, 0.08);--_icon-color: var(--md-icon-button-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_pressed-icon-color: var(--md-icon-button-pressed-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_pressed-state-layer-color: var(--md-icon-button-pressed-state-layer-color, var(--md-sys-color-on-surface-variant, #49454f));--_pressed-state-layer-opacity: var(--md-icon-button-pressed-state-layer-opacity, 0.12);--_container-shape-start-start: 0;--_container-shape-start-end: 0;--_container-shape-end-end: 0;--_container-shape-end-start: 0;--_container-height: 0;--_container-width: 0;height:var(--_state-layer-height);width:var(--_state-layer-width)}:host([touch-target=wrapper]){margin:max(0px,(48px - var(--_state-layer-height))/2) max(0px,(48px - var(--_state-layer-width))/2)}md-focus-ring{--md-focus-ring-shape-start-start: var(--_state-layer-shape);--md-focus-ring-shape-start-end: var(--_state-layer-shape);--md-focus-ring-shape-end-end: var(--_state-layer-shape);--md-focus-ring-shape-end-start: var(--_state-layer-shape)}.standard{background-color:rgba(0,0,0,0);color:var(--_icon-color);--md-ripple-hover-color: var(--_hover-state-layer-color);--md-ripple-hover-opacity: var(--_hover-state-layer-opacity);--md-ripple-pressed-color: var(--_pressed-state-layer-color);--md-ripple-pressed-opacity: var(--_pressed-state-layer-opacity)}.standard:hover{color:var(--_hover-icon-color)}.standard:focus{color:var(--_focus-icon-color)}.standard:active{color:var(--_pressed-icon-color)}.standard:disabled{color:var(--_disabled-icon-color)}md-ripple{border-radius:var(--_state-layer-shape)}.standard:disabled .icon{opacity:var(--_disabled-icon-opacity)}.selected{--md-ripple-hover-color: var(--_selected-hover-state-layer-color);--md-ripple-hover-opacity: var(--_selected-hover-state-layer-opacity);--md-ripple-pressed-color: var(--_selected-pressed-state-layer-color);--md-ripple-pressed-opacity: var(--_selected-pressed-state-layer-opacity)}.selected:not(:disabled){color:var(--_selected-icon-color)}.selected:not(:disabled):hover{color:var(--_selected-hover-icon-color)}.selected:not(:disabled):focus{color:var(--_selected-focus-icon-color)}.selected:not(:disabled):active{color:var(--_selected-pressed-icon-color)}
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let r4=class extends ra{getRenderClasses(){return{...super.getRenderClasses(),standard:!0}}};r4.styles=[DE,hoe];r4=Nt([Xa("md-icon-button")],r4);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const doe=ho`:host{--_container-color: var(--md-filled-tonal-icon-button-container-color, var(--md-sys-color-secondary-container, #e8def8));--_container-height: var(--md-filled-tonal-icon-button-container-height, 40px);--_container-width: var(--md-filled-tonal-icon-button-container-width, 40px);--_disabled-container-color: var(--md-filled-tonal-icon-button-disabled-container-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-container-opacity: var(--md-filled-tonal-icon-button-disabled-container-opacity, 0.12);--_disabled-icon-color: var(--md-filled-tonal-icon-button-disabled-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-icon-opacity: var(--md-filled-tonal-icon-button-disabled-icon-opacity, 0.38);--_focus-icon-color: var(--md-filled-tonal-icon-button-focus-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_hover-icon-color: var(--md-filled-tonal-icon-button-hover-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_hover-state-layer-color: var(--md-filled-tonal-icon-button-hover-state-layer-color, var(--md-sys-color-on-secondary-container, #1d192b));--_hover-state-layer-opacity: var(--md-filled-tonal-icon-button-hover-state-layer-opacity, 0.08);--_icon-color: var(--md-filled-tonal-icon-button-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_icon-size: var(--md-filled-tonal-icon-button-icon-size, 24px);--_pressed-icon-color: var(--md-filled-tonal-icon-button-pressed-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_pressed-state-layer-color: var(--md-filled-tonal-icon-button-pressed-state-layer-color, var(--md-sys-color-on-secondary-container, #1d192b));--_pressed-state-layer-opacity: var(--md-filled-tonal-icon-button-pressed-state-layer-opacity, 0.12);--_selected-container-color: var(--md-filled-tonal-icon-button-selected-container-color, var(--md-sys-color-secondary-container, #e8def8));--_toggle-selected-focus-icon-color: var(--md-filled-tonal-icon-button-toggle-selected-focus-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_toggle-selected-hover-icon-color: var(--md-filled-tonal-icon-button-toggle-selected-hover-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_toggle-selected-hover-state-layer-color: var(--md-filled-tonal-icon-button-toggle-selected-hover-state-layer-color, var(--md-sys-color-on-secondary-container, #1d192b));--_toggle-selected-icon-color: var(--md-filled-tonal-icon-button-toggle-selected-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_toggle-selected-pressed-icon-color: var(--md-filled-tonal-icon-button-toggle-selected-pressed-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_toggle-selected-pressed-state-layer-color: var(--md-filled-tonal-icon-button-toggle-selected-pressed-state-layer-color, var(--md-sys-color-on-secondary-container, #1d192b));--_unselected-container-color: var(--md-filled-tonal-icon-button-unselected-container-color, var(--md-sys-color-surface-container-highest, #e6e0e9));--_toggle-focus-icon-color: var(--md-filled-tonal-icon-button-toggle-focus-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_toggle-hover-icon-color: var(--md-filled-tonal-icon-button-toggle-hover-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_toggle-hover-state-layer-color: var(--md-filled-tonal-icon-button-toggle-hover-state-layer-color, var(--md-sys-color-on-surface-variant, #49454f));--_toggle-icon-color: var(--md-filled-tonal-icon-button-toggle-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_toggle-pressed-icon-color: var(--md-filled-tonal-icon-button-toggle-pressed-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_toggle-pressed-state-layer-color: var(--md-filled-tonal-icon-button-toggle-pressed-state-layer-color, var(--md-sys-color-on-surface-variant, #49454f));--_container-shape-start-start: var(--md-filled-tonal-icon-button-container-shape-start-start, var(--md-filled-tonal-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-start-end: var(--md-filled-tonal-icon-button-container-shape-start-end, var(--md-filled-tonal-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-end: var(--md-filled-tonal-icon-button-container-shape-end-end, var(--md-filled-tonal-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-start: var(--md-filled-tonal-icon-button-container-shape-end-start, var(--md-filled-tonal-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)))}.icon-button{color:var(--_icon-color);--md-ripple-hover-color: var(--_hover-state-layer-color);--md-ripple-hover-opacity: var(--_hover-state-layer-opacity);--md-ripple-pressed-color: var(--_pressed-state-layer-color);--md-ripple-pressed-opacity: var(--_pressed-state-layer-opacity)}.icon-button:hover{color:var(--_hover-icon-color)}.icon-button:focus{color:var(--_focus-icon-color)}.icon-button:active{color:var(--_pressed-icon-color)}.icon-button:disabled{color:var(--_disabled-icon-color)}.icon-button::before{background-color:var(--_container-color);border-radius:inherit;content:"";inset:0;position:absolute;z-index:-1}.icon-button:disabled::before{background-color:var(--_disabled-container-color);opacity:var(--_disabled-container-opacity)}.icon-button:disabled .icon{opacity:var(--_disabled-icon-opacity)}.toggle-filled-tonal{--md-ripple-hover-color: var(--_toggle-hover-state-layer-color);--md-ripple-pressed-color: var(--_toggle-pressed-state-layer-color)}.toggle-filled-tonal:not(:disabled){color:var(--_toggle-icon-color)}.toggle-filled-tonal:not(:disabled):hover{color:var(--_toggle-hover-icon-color)}.toggle-filled-tonal:not(:disabled):focus{color:var(--_toggle-focus-icon-color)}.toggle-filled-tonal:not(:disabled):active{color:var(--_toggle-pressed-icon-color)}.toggle-filled-tonal:not(:disabled)::before{background-color:var(--_unselected-container-color)}.selected{--md-ripple-hover-color: var(--_toggle-selected-hover-state-layer-color);--md-ripple-pressed-color: var(--_toggle-selected-pressed-state-layer-color)}.selected:not(:disabled){color:var(--_toggle-selected-icon-color)}.selected:not(:disabled):hover{color:var(--_toggle-selected-hover-icon-color)}.selected:not(:disabled):focus{color:var(--_toggle-selected-focus-icon-color)}.selected:not(:disabled):active{color:var(--_toggle-selected-pressed-icon-color)}.selected:not(:disabled)::before{background-color:var(--_selected-container-color)}
`;/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let n4=class extends ra{getRenderClasses(){return{...super.getRenderClasses(),"filled-tonal":!0,"toggle-filled-tonal":this.toggle}}};n4.styles=[DE,doe];n4=Nt([Xa("md-filled-tonal-icon-button")],n4);/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class foe extends Uo{render(){return Xr`<slot></slot>`}connectedCallback(){if(super.connectedCallback(),this.getAttribute("aria-hidden")==="false"){this.removeAttribute("aria-hidden");return}this.setAttribute("aria-hidden","true")}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const poe=ho`:host{font-size:var(--md-icon-size, 24px);width:var(--md-icon-size, 24px);height:var(--md-icon-size, 24px);color:inherit;font-variation-settings:inherit;font-weight:400;font-family:var(--md-icon-font, Material Symbols Outlined);display:inline-flex;font-style:normal;place-items:center;place-content:center;line-height:1;overflow:hidden;letter-spacing:normal;text-transform:none;user-select:none;white-space:nowrap;word-wrap:normal;flex-shrink:0;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;-moz-osx-font-smoothing:grayscale}::slotted(svg){fill:currentColor}::slotted(*){height:100%;width:100%}
`;/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let s4=class extends foe{};s4.styles=[poe];s4=Nt([Xa("md-icon")],s4);const cc=(r,e)=>{const t=r.__vccOpts||r;for(const[o,c]of e)t[o]=c;return t};/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class moe extends Uo{connectedCallback(){super.connectedCallback(),this.setAttribute("aria-hidden","true")}render(){return Xr`<span class="shadow"></span>`}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const _oe=ho`:host,.shadow,.shadow::before,.shadow::after{border-radius:inherit;inset:0;position:absolute;transition-duration:inherit;transition-property:inherit;transition-timing-function:inherit}:host{display:flex;pointer-events:none;transition-property:box-shadow,opacity}.shadow::before,.shadow::after{content:"";transition-property:box-shadow,opacity;--_level: var(--md-elevation-level, 0);--_shadow-color: var(--md-elevation-shadow-color, var(--md-sys-color-shadow, #000))}.shadow::before{box-shadow:0px calc(1px*(clamp(0,var(--_level),1) + clamp(0,var(--_level) - 3,1) + 2*clamp(0,var(--_level) - 4,1))) calc(1px*(2*clamp(0,var(--_level),1) + clamp(0,var(--_level) - 2,1) + clamp(0,var(--_level) - 4,1))) 0px var(--_shadow-color);opacity:.3}.shadow::after{box-shadow:0px calc(1px*(clamp(0,var(--_level),1) + clamp(0,var(--_level) - 1,1) + 2*clamp(0,var(--_level) - 2,3))) calc(1px*(3*clamp(0,var(--_level),2) + 2*clamp(0,var(--_level) - 2,3))) calc(1px*(clamp(0,var(--_level),4) + 2*clamp(0,var(--_level) - 4,1))) var(--_shadow-color);opacity:.15}
`;/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let o4=class extends moe{};o4.styles=[_oe];o4=Nt([Xa("md-elevation")],o4);const goe=wa({__name:"App",setup(r){const e=EX(),t=uN(),o=LC();return Hf(o,async(c,f)=>{if(!c&&f&&t.meta.requiresAuth)return e.push({name:"login"});if(c&&typeof t.query.redirect=="string")return e.push(t.query.redirect)}),(c,f)=>(Pr(),Qr("main",null,[(Pr(),Im(Rn(cN),{key:c.$route.fullPath}))]))}}),yoe="modulepreload",voe=function(r){return"/"+r},RO={},xoe=function(e,t,o){let c=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const y=document.querySelector("meta[property=csp-nonce]"),s=(y==null?void 0:y.nonce)||(y==null?void 0:y.getAttribute("nonce"));c=Promise.allSettled(t.map(E=>{if(E=voe(E),E in RO)return;RO[E]=!0;const R=E.endsWith(".css"),O=R?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${E}"]${O}`))return;const A=document.createElement("link");if(A.rel=R?"stylesheet":yoe,R||(A.as="script"),A.crossOrigin="",A.href=E,s&&A.setAttribute("nonce",s),document.head.appendChild(A),R)return new Promise((U,$)=>{A.addEventListener("load",U),A.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${E}`)))})}))}function f(y){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=y,window.dispatchEvent(s),!s.defaultPrevented)throw y}return c.then(y=>{for(const s of y||[])s.status==="rejected"&&f(s.reason);return e().catch(f)})};class vg{constructor({name:e,date:t,time:o,description:c,imageUrl:f,id:y,mapData:s,position:E,maxParticipants:R}){Ku(this,"_id");Ku(this,"_name");Ku(this,"_date");Ku(this,"_description");Ku(this,"_imageUrl");Ku(this,"_time");Ku(this,"_mapData");Ku(this,"_position");Ku(this,"_maxParticipants");this._id=y||boe(12),this._name=e,this._date=t,this._description=c,this._imageUrl=f,this._time=o||[],this._mapData=s||null,this._position=E,this._maxParticipants=R||null}get id(){return this._id}set id(e){this._id=e}get name(){return this._name}set name(e){this._name=e}get date(){return this._date}set date(e){this._date=e}get description(){return this._description}set description(e){this._description=e}get imageUrl(){return this._imageUrl}set imageUrl(e){this._imageUrl=e}get time(){return this._time}set time(e){this._time=e}get mapData(){return this._mapData}set mapData(e){this._mapData=e}get position(){return this._position}set position(e){this._position=e}get maxParticipants(){return this._maxParticipants}set maxParticipants(e){this._maxParticipants=e}}function boe(r){let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=t.length;for(let c=0;c<r;c++)e+=t.charAt(Math.floor(Math.random()*o));return e}const y9=[new vg({position:{lat:40.524368,lon:16.062254},id:"viaferrata_16-06",name:"Via ferrata Pietrapertosa e Castelmezzano",description:`<p>
                    Via ferrata a Pietrapertosa e Castelmezzano, domenica 16 Giugno 2024.
                </p>
                <p>
                    Programma:
                <ul>
                    <li>08:00 - Partenza da Tricarico</li>
                    <li>08:30 - Arrivo a Pietrapertosa e noleggio attrezzatura</li>
                    <li>09:00 - Percorso delle 7 pietre</li>
                    <li>10:00 - Partenza Salemm</li>
                    <li>13:30 - Pranzo a Castelmezzano</li>
                    <li>15:30 - Avvicinamento Marcirosa</li>
                    <li>16:00 - Partenza Marcirosa</li>
                    <li>19:00 - Arrivo a Pietrapertosa</li>
                    <li>19:30 - Rientro a Tricarico</li>
                </ul>

                </p>

                <p> 
                La via ferrata Salemm ha una lunghezza di circa 1.731 metri ed un dislivello di circa 249 metri.
                <br/>
                La via ferrata Marcirosa ha una lunghezza di 1.778 metri ed un dislivello di circa 331 metri
                </p>

                <p>
                    Sarà necessario noleggiare l'attrezzatura per la via ferrata. Il costo è di 20€ a persona.
                </p>`,imageUrl:"https://i0.wp.com/cyclinginlove.com/wp-content/uploads/2019/09/da-pietrapetosa-a-castelmezzano_vie-ferrate-in-basilicata_piccole-dolomiti-lucane_volo-angelo-castelmezzano_cammino-delle-delle-sette-pietre.jpg?fit=1280%2C570&ssl=1",date:new Date("2025-06-16"),mapData:{type:"FeatureCollection",features:[{type:"Feature",properties:{name:"Piccole Dolomiti Lucane. Ferrate Marcirosa e Salemm"},geometry:{type:"MultiLineString",coordinates:[[[16.046383,40.52455],[16.046322,40.524551],[16.04636,40.524515],[16.046382,40.524465],[16.046415,40.524416],[16.046471,40.524393],[16.04649,40.524345],[16.046452,40.524388],[16.046408,40.524429],[16.046461,40.524396],[16.046514,40.52437],[16.046572,40.524359],[16.046616,40.524324],[16.046576,40.524286],[16.046537,40.52425],[16.046554,40.524201],[16.046601,40.524159],[16.04666,40.524127],[16.046726,40.524109],[16.046787,40.524108],[16.046856,40.524113],[16.046919,40.524124],[16.046988,40.524138],[16.047051,40.524148],[16.04712,40.524148],[16.04718,40.524144],[16.047243,40.524153],[16.047334,40.524131],[16.047373,40.524085],[16.047401,40.524043],[16.047422,40.523996],[16.047429,40.523938],[16.047402,40.523883],[16.04738,40.52384],[16.047365,40.523792],[16.047353,40.523741],[16.04735,40.523688],[16.047372,40.523645],[16.047385,40.523592],[16.047416,40.523539],[16.047402,40.523479],[16.04737,40.52344],[16.04735,40.523392],[16.047338,40.523342],[16.047338,40.523296],[16.047282,40.523272],[16.047233,40.523211],[16.047216,40.523157],[16.047204,40.52311],[16.047197,40.52306],[16.047181,40.523013],[16.047208,40.522969],[16.047222,40.522922],[16.047248,40.522878],[16.047264,40.522835],[16.047287,40.522794],[16.047299,40.522747],[16.047297,40.5227],[16.047237,40.52267],[16.047261,40.522621],[16.047274,40.522575],[16.047298,40.522523],[16.047312,40.522478],[16.047334,40.522429],[16.047369,40.52239],[16.047387,40.522341],[16.047321,40.522355],[16.047285,40.522392],[16.047242,40.522425],[16.047238,40.522471],[16.047184,40.522502],[16.047125,40.522483],[16.047117,40.522434],[16.047127,40.52239],[16.047112,40.522342],[16.047114,40.522296],[16.047147,40.522254],[16.047195,40.522216],[16.047255,40.522208],[16.047314,40.522198],[16.047339,40.522157],[16.047381,40.522123],[16.04742,40.522084],[16.04748,40.522069],[16.047529,40.522037],[16.04758,40.522002],[16.04763,40.521971],[16.047674,40.521929],[16.04773,40.521911],[16.047763,40.521862],[16.047703,40.521872],[16.047649,40.521844],[16.047675,40.521803],[16.047718,40.521769],[16.047764,40.521735],[16.047813,40.521704],[16.04787,40.521666],[16.047916,40.521617],[16.04795,40.521562],[16.047973,40.52152],[16.047915,40.521491],[16.047855,40.521528],[16.047886,40.521567],[16.047955,40.521581],[16.048025,40.521603],[16.048086,40.521629],[16.048141,40.521659],[16.048192,40.521699],[16.048251,40.521725],[16.048299,40.521759],[16.048343,40.521795],[16.048405,40.521814],[16.048448,40.521861],[16.048445,40.521912],[16.048438,40.521959],[16.048405,40.521998],[16.048411,40.522047],[16.048427,40.522092],[16.04843,40.522141],[16.048356,40.52215],[16.048331,40.522191],[16.048341,40.522242],[16.048368,40.522288],[16.048381,40.522334],[16.048405,40.522376],[16.04845,40.522408],[16.048492,40.522442],[16.048558,40.522458],[16.0486,40.522426],[16.048613,40.522372],[16.048599,40.52232],[16.048573,40.522276],[16.048576,40.522229],[16.048594,40.522183],[16.048603,40.522136],[16.048631,40.522177],[16.048664,40.522225],[16.048696,40.522288],[16.048703,40.522341],[16.04873,40.522384],[16.048753,40.522433],[16.048762,40.522488],[16.048806,40.522529],[16.048762,40.52256],[16.04875,40.522605],[16.048749,40.522652],[16.048791,40.522696],[16.048852,40.522713],[16.048914,40.522691],[16.048958,40.522643],[16.048983,40.522594],[16.049008,40.522552],[16.049038,40.522496],[16.049091,40.522452],[16.049158,40.522428],[16.049214,40.522387],[16.049262,40.52242],[16.04929,40.522476],[16.049302,40.52252],[16.049354,40.522548],[16.049384,40.522592],[16.049441,40.522613],[16.049475,40.522654],[16.049519,40.522691],[16.04955,40.522737],[16.049565,40.522788],[16.049561,40.522835],[16.049539,40.522884],[16.049524,40.522935],[16.049531,40.522991],[16.049541,40.523037],[16.049544,40.523089],[16.049534,40.523138],[16.049512,40.523182],[16.049493,40.523229],[16.04947,40.523273],[16.049477,40.523332],[16.049502,40.523381],[16.049536,40.523429],[16.04954,40.523482],[16.049492,40.523517],[16.049431,40.523557],[16.049375,40.523595],[16.049324,40.523624],[16.049281,40.523666],[16.049259,40.523708],[16.049272,40.523753],[16.049234,40.523806],[16.049288,40.523833],[16.04936,40.523854],[16.049419,40.52387],[16.049481,40.523884],[16.04951,40.523931],[16.049562,40.523954],[16.049615,40.523979],[16.049641,40.524021],[16.049662,40.524072],[16.049671,40.524124],[16.049687,40.524171],[16.049704,40.52422],[16.049713,40.524276],[16.049734,40.524321],[16.049791,40.524345],[16.04983,40.524383],[16.049838,40.524435],[16.049804,40.524478],[16.04983,40.524525],[16.049869,40.524562],[16.049905,40.524602],[16.04995,40.524636],[16.049995,40.524673],[16.050003,40.524722],[16.05003,40.524767],[16.050089,40.52479],[16.050153,40.524801],[16.050228,40.524841],[16.050258,40.524881],[16.050282,40.524924],[16.050304,40.524967],[16.050311,40.525019],[16.050307,40.525079],[16.050303,40.525129],[16.050244,40.525137],[16.050302,40.525148],[16.050357,40.525191],[16.050358,40.525238],[16.050333,40.525303],[16.050302,40.525345],[16.050243,40.525344],[16.050236,40.525396],[16.050247,40.525441],[16.050266,40.525486],[16.050289,40.525532],[16.05033,40.525566],[16.050365,40.525605],[16.050335,40.525552],[16.050393,40.525566],[16.050331,40.525561],[16.050291,40.525524],[16.050313,40.525473],[16.050362,40.525448],[16.050417,40.525425],[16.050473,40.525444],[16.050524,40.525467],[16.050584,40.525456],[16.050648,40.525451],[16.050713,40.525436],[16.050757,40.525402],[16.050814,40.525387],[16.050847,40.525427],[16.050838,40.525472],[16.05088,40.525506],[16.050947,40.525523],[16.051016,40.525506],[16.051073,40.525483],[16.05112,40.525443],[16.051166,40.525413],[16.05123,40.525415],[16.051278,40.525442],[16.051328,40.525415],[16.051389,40.525412],[16.051424,40.525375],[16.051483,40.525361],[16.051545,40.525355],[16.051605,40.525345],[16.051651,40.525313],[16.051694,40.525345],[16.05174,40.525395],[16.051701,40.525432],[16.05164,40.525443],[16.051692,40.525417],[16.051643,40.52539],[16.051658,40.525344],[16.051694,40.525304],[16.051725,40.525264],[16.051675,40.525301],[16.051733,40.525279],[16.051786,40.525258],[16.051846,40.525259],[16.051901,40.52528],[16.051961,40.525292],[16.052014,40.525313],[16.052067,40.525334],[16.052124,40.525351],[16.052155,40.52531],[16.05222,40.525303],[16.052266,40.525275],[16.052326,40.525258],[16.052364,40.525222],[16.052424,40.525225],[16.052479,40.525204],[16.052522,40.525171],[16.052581,40.525155],[16.052583,40.52511],[16.052597,40.525063],[16.052588,40.525006],[16.052588,40.524961],[16.052615,40.524915],[16.052654,40.524877],[16.052717,40.524856],[16.052773,40.524836],[16.052845,40.524837],[16.052904,40.524856],[16.05295,40.524886],[16.053017,40.524888],[16.05308,40.52488],[16.053119,40.524844],[16.05318,40.524858],[16.053235,40.524834],[16.053287,40.524859],[16.053284,40.524918],[16.053337,40.524944],[16.053381,40.524977],[16.053443,40.524953],[16.053505,40.524958],[16.053443,40.524944],[16.053502,40.524938],[16.05355,40.524911],[16.053609,40.524917],[16.053658,40.524948],[16.053718,40.524959],[16.053746,40.525004],[16.053804,40.524993],[16.053858,40.525013],[16.053918,40.525008],[16.053976,40.525028],[16.054039,40.525012],[16.054103,40.525025],[16.054152,40.524997],[16.054212,40.525005],[16.054275,40.525005],[16.054316,40.524972],[16.05437,40.524999],[16.054429,40.524992],[16.054491,40.524995],[16.054546,40.525013],[16.054607,40.525004],[16.054669,40.525002],[16.05472,40.525045],[16.054724,40.525093],[16.054755,40.525054],[16.054822,40.525036],[16.054875,40.525074],[16.054924,40.5251],[16.054943,40.525146],[16.054991,40.525177],[16.055025,40.525139],[16.055053,40.525099],[16.055055,40.525053],[16.05505,40.525007],[16.055011,40.524971],[16.054966,40.524935],[16.054941,40.524892],[16.054943,40.524837],[16.05494,40.52478],[16.05492,40.524735],[16.054871,40.524709],[16.054862,40.524656],[16.054823,40.524621],[16.054768,40.524599],[16.054709,40.524587],[16.054671,40.524539],[16.054624,40.524511],[16.054622,40.524452],[16.054621,40.524403],[16.054631,40.524352],[16.054637,40.524305],[16.05468,40.524257],[16.054731,40.524229],[16.054778,40.524191],[16.054825,40.524153],[16.054855,40.524199],[16.054843,40.524249],[16.054841,40.524307],[16.0549,40.524287],[16.054961,40.524302],[16.055019,40.524329],[16.055079,40.52434],[16.055127,40.524308],[16.055188,40.524312],[16.055192,40.524264],[16.055244,40.524228],[16.055302,40.524245],[16.055248,40.524266],[16.055211,40.524223],[16.055269,40.52424],[16.055327,40.524252],[16.055369,40.524285],[16.055397,40.524326],[16.055422,40.52437],[16.05547,40.524344],[16.05541,40.524339],[16.055394,40.524383],[16.055455,40.524383],[16.05542,40.524346],[16.055457,40.524384],[16.055507,40.52436],[16.055549,40.524326],[16.055591,40.524291],[16.055596,40.524238],[16.055607,40.524193],[16.055624,40.52415],[16.055661,40.524113],[16.055638,40.52407],[16.055703,40.524056],[16.055756,40.524086],[16.055797,40.524124],[16.055848,40.524153],[16.055911,40.524168],[16.055965,40.524145],[16.055989,40.524087],[16.055997,40.524038],[16.055932,40.524036],[16.055985,40.524016],[16.056004,40.523971],[16.056022,40.523928],[16.055989,40.523887],[16.055984,40.523838],[16.055929,40.523811],[16.055912,40.523764],[16.055912,40.523718],[16.055972,40.523694],[16.056029,40.523678],[16.056013,40.523633],[16.056025,40.523583],[16.056025,40.523531],[16.056045,40.523483],[16.056096,40.523448],[16.056158,40.523426],[16.056213,40.523405],[16.056259,40.523373],[16.056297,40.523335],[16.056343,40.523304],[16.05639,40.523266],[16.056443,40.523239],[16.056491,40.523209],[16.056552,40.523178],[16.056598,40.523134],[16.056649,40.523109],[16.056719,40.523102],[16.056779,40.523082],[16.056846,40.523081],[16.056895,40.523043],[16.056937,40.523005],[16.056986,40.522966],[16.05704,40.522941],[16.057089,40.522913],[16.057135,40.522879],[16.057189,40.522852],[16.057225,40.522809],[16.057289,40.522806],[16.057303,40.522758],[16.05736,40.522716],[16.057413,40.522677],[16.057463,40.522648],[16.057514,40.522615],[16.057576,40.522581],[16.057609,40.522534],[16.057645,40.522492],[16.057675,40.522451],[16.05772,40.522422],[16.057781,40.522397],[16.057823,40.522359],[16.057868,40.522328],[16.057913,40.522278],[16.057932,40.522209],[16.05796,40.522164],[16.058009,40.522139],[16.058067,40.522098],[16.058126,40.522081],[16.058188,40.522076],[16.058171,40.522023],[16.058169,40.521978],[16.058227,40.52194],[16.058282,40.521915],[16.05835,40.521907],[16.058394,40.521873],[16.058445,40.521846],[16.058493,40.521817],[16.058535,40.52178],[16.058583,40.52174],[16.058644,40.521737],[16.058709,40.521734],[16.058775,40.521732],[16.058837,40.521731],[16.058901,40.521724],[16.058956,40.521699],[16.058982,40.521657],[16.059023,40.521615],[16.059038,40.521661],[16.059098,40.52167],[16.059158,40.521654],[16.059176,40.52161],[16.059222,40.521565],[16.059255,40.521522],[16.059291,40.521476],[16.059352,40.521435],[16.059413,40.521421],[16.059468,40.521399],[16.05953,40.521386],[16.05958,40.521354],[16.059645,40.521364],[16.0597,40.521345],[16.059735,40.521308],[16.059765,40.521348],[16.059811,40.521381],[16.05987,40.521398],[16.059867,40.521443],[16.059922,40.521482],[16.059983,40.521483],[16.060048,40.52148],[16.060107,40.5215],[16.060107,40.521452],[16.060155,40.521402],[16.060214,40.521368],[16.060258,40.521334],[16.06032,40.521294],[16.060373,40.521319],[16.060391,40.521369],[16.060401,40.52142],[16.060451,40.521394],[16.060469,40.521348],[16.060468,40.521303],[16.060512,40.521339],[16.060517,40.521394],[16.060574,40.521382],[16.060628,40.521354],[16.060629,40.521308],[16.06059,40.521268],[16.060635,40.521239],[16.060661,40.521281],[16.060703,40.521317],[16.060754,40.521341],[16.060814,40.521352],[16.060879,40.521367],[16.06094,40.521371],[16.060984,40.521338],[16.060997,40.521293],[16.060964,40.521253],[16.060975,40.521208],[16.061039,40.521197],[16.06109,40.52117],[16.061113,40.521127],[16.061177,40.521123],[16.061238,40.52112],[16.061278,40.521161],[16.061251,40.521205],[16.061235,40.521251],[16.061177,40.521262],[16.061133,40.521231],[16.061134,40.521281],[16.061105,40.521234],[16.061117,40.521188],[16.061058,40.521196],[16.061013,40.521225],[16.060953,40.521247],[16.060891,40.521257],[16.060928,40.521297],[16.060974,40.521334],[16.061012,40.521299],[16.060995,40.52135],[16.060963,40.521388],[16.060903,40.521375],[16.060834,40.521365],[16.060773,40.521366],[16.060714,40.521349],[16.060658,40.521323],[16.060595,40.52128],[16.060613,40.521331],[16.060621,40.521378],[16.060561,40.521383],[16.060516,40.521351],[16.060469,40.521321],[16.060411,40.521333],[16.060436,40.52138],[16.060434,40.521426],[16.060385,40.521384],[16.060332,40.521356],[16.060286,40.521397],[16.060249,40.521439],[16.060207,40.521478],[16.060161,40.521515],[16.06015,40.521564],[16.060094,40.521594],[16.060037,40.521573],[16.05998,40.521556],[16.059938,40.521521],[16.059883,40.521492],[16.059844,40.521455],[16.05982,40.521413],[16.059775,40.521379],[16.059728,40.521345],[16.059672,40.521316],[16.059644,40.521266],[16.059668,40.521215],[16.05963,40.521172],[16.059591,40.52113],[16.059562,40.521087],[16.059528,40.521047],[16.059492,40.521007],[16.05952,40.520964],[16.059521,40.520917],[16.05951,40.520866],[16.0595,40.52082],[16.059519,40.520775],[16.05956,40.520737],[16.059571,40.520686],[16.059573,40.520634],[16.059612,40.520595],[16.059604,40.520547],[16.059607,40.520502],[16.05963,40.520457],[16.059655,40.520416],[16.059685,40.520373],[16.059726,40.52034],[16.059766,40.520303],[16.059805,40.520261],[16.059843,40.520223],[16.05988,40.520177],[16.059918,40.520142],[16.059965,40.5201],[16.059996,40.520055],[16.060008,40.519996],[16.059998,40.51994],[16.060002,40.519893],[16.060015,40.519848],[16.060024,40.519801],[16.060041,40.519747],[16.060038,40.519695],[16.060057,40.51965],[16.060104,40.519619],[16.060167,40.51964],[16.060224,40.519618],[16.060289,40.51959],[16.060334,40.519556],[16.060342,40.519511],[16.060373,40.519468],[16.060409,40.519431],[16.060468,40.519405],[16.060505,40.519366],[16.060564,40.51934],[16.060625,40.519344],[16.060682,40.519363],[16.060743,40.519351],[16.060792,40.519315],[16.060851,40.519295],[16.06091,40.519283],[16.060974,40.519285],[16.061026,40.51926],[16.061089,40.519285],[16.061148,40.51927],[16.06122,40.519272],[16.061276,40.519235],[16.06132,40.519191],[16.061349,40.51913],[16.061392,40.519085],[16.061442,40.519044],[16.061497,40.519026],[16.061534,40.518986],[16.061558,40.518939],[16.061629,40.518933],[16.061691,40.518919],[16.061737,40.51889],[16.06179,40.518866],[16.061846,40.518844],[16.061899,40.518818],[16.061946,40.518784],[16.062004,40.518795],[16.062066,40.51879],[16.062131,40.518784],[16.062176,40.518741],[16.062216,40.518704],[16.062262,40.518668],[16.062303,40.518626],[16.062334,40.518587],[16.062365,40.518541],[16.062395,40.518493],[16.062441,40.518462],[16.062496,40.518436],[16.062556,40.518421],[16.06263,40.518407],[16.062694,40.518393],[16.062749,40.518412],[16.062738,40.518363],[16.062775,40.518322],[16.062808,40.518284],[16.06286,40.518243],[16.062915,40.51822],[16.062958,40.518186],[16.062995,40.51815],[16.063046,40.518124],[16.063116,40.5181],[16.063172,40.518068],[16.063224,40.518043],[16.063294,40.518024],[16.063322,40.517984],[16.063342,40.517937],[16.063375,40.517894],[16.063394,40.517849],[16.06339,40.517802],[16.063369,40.517756],[16.063336,40.517713],[16.063327,40.517663],[16.0633,40.517616],[16.063284,40.517567],[16.06327,40.51752],[16.063245,40.517562],[16.06321,40.517523],[16.063218,40.517478],[16.06319,40.517434],[16.063159,40.517385],[16.063137,40.517336],[16.063105,40.517283],[16.063065,40.517235],[16.063038,40.517193],[16.06301,40.517149],[16.062984,40.517106],[16.062945,40.517071],[16.06291,40.517031],[16.062853,40.517016],[16.062904,40.516985],[16.062901,40.516937],[16.062898,40.516891],[16.06289,40.516829],[16.062896,40.516779],[16.062914,40.516732],[16.062923,40.516685],[16.062863,40.51668],[16.062885,40.516727],[16.062922,40.516767],[16.06296,40.516804],[16.062979,40.516851],[16.062973,40.516904],[16.062949,40.516955],[16.062899,40.516927],[16.062881,40.516883],[16.06288,40.516827],[16.062897,40.51678],[16.062896,40.516723],[16.062881,40.516666],[16.06287,40.516713],[16.062887,40.516763],[16.062884,40.516814],[16.062913,40.516857],[16.062936,40.516902],[16.062951,40.516947],[16.062957,40.516992],[16.06293,40.517032],[16.062972,40.517071],[16.062999,40.517111],[16.063014,40.517168],[16.063027,40.517218],[16.063044,40.517267],[16.063074,40.517308],[16.063108,40.517346],[16.063146,40.517386],[16.063194,40.51742],[16.063233,40.517456],[16.063251,40.517507],[16.063286,40.517553],[16.06331,40.517597],[16.063336,40.517644],[16.063373,40.517689],[16.063387,40.517737],[16.063398,40.517783],[16.063401,40.517834],[16.063391,40.517883],[16.063383,40.517931],[16.063367,40.517979],[16.063335,40.518031],[16.063274,40.518053],[16.063212,40.51805],[16.063152,40.518061],[16.063106,40.518096],[16.063084,40.518144],[16.063055,40.518188],[16.063003,40.518217],[16.062956,40.518254],[16.06291,40.518285],[16.062854,40.518302],[16.062792,40.518316],[16.062743,40.518349],[16.062694,40.518378],[16.06264,40.5184],[16.062579,40.51841],[16.062518,40.518428],[16.062466,40.518459],[16.062416,40.518489],[16.062365,40.51852],[16.062316,40.518546],[16.062262,40.518575],[16.062207,40.518596],[16.062154,40.518623],[16.062091,40.518632],[16.062036,40.518658],[16.061997,40.518699],[16.061953,40.518732],[16.061901,40.518768],[16.061865,40.518804],[16.061828,40.518844],[16.061779,40.518881],[16.06177,40.518834],[16.061806,40.518794],[16.061828,40.518749],[16.061882,40.518728],[16.061937,40.518699],[16.061995,40.518685],[16.062041,40.518649],[16.062106,40.518636],[16.062169,40.518603],[16.062199,40.518557],[16.062147,40.518534],[16.062092,40.518555],[16.062127,40.518592],[16.06215,40.518549],[16.062198,40.518516],[16.062217,40.51847],[16.062262,40.518425],[16.062291,40.518385],[16.062329,40.518339],[16.062358,40.518291],[16.0624,40.518256],[16.062454,40.518231],[16.062509,40.518204],[16.06256,40.518161],[16.062596,40.51812],[16.062643,40.518081],[16.062648,40.518034],[16.062638,40.517989],[16.06259,40.517958],[16.06254,40.517924],[16.06247,40.517905],[16.062431,40.517866],[16.062408,40.517824],[16.062386,40.517781],[16.062364,40.517731],[16.062342,40.517688],[16.062314,40.517648],[16.062258,40.517621],[16.062196,40.517634],[16.062135,40.51764],[16.062082,40.517616],[16.062041,40.517581],[16.061986,40.51756],[16.061935,40.517528],[16.061907,40.517483],[16.061846,40.517463],[16.061793,40.51744],[16.061787,40.517488],[16.061776,40.517533],[16.061765,40.51758],[16.06173,40.517617],[16.061729,40.517677],[16.061751,40.517719],[16.061754,40.517765],[16.061757,40.517812],[16.061769,40.517859],[16.061776,40.51791],[16.061761,40.517957],[16.061703,40.517987],[16.061645,40.518],[16.061595,40.518031],[16.06154,40.518064],[16.061485,40.518082],[16.061408,40.518102],[16.061342,40.518106],[16.061276,40.518095],[16.061216,40.518092],[16.061153,40.51811],[16.061096,40.518136],[16.061064,40.518183],[16.061091,40.518227],[16.061026,40.518214],[16.061,40.518263],[16.061046,40.518313],[16.061111,40.518297],[16.061055,40.518269],[16.060996,40.51828],[16.060927,40.518283],[16.060859,40.518283],[16.060793,40.518293],[16.060744,40.518319],[16.060692,40.518353],[16.060638,40.518392],[16.060592,40.518424],[16.060536,40.518451],[16.06047,40.518464],[16.060424,40.518495],[16.060388,40.518535],[16.060338,40.518565],[16.060285,40.518587],[16.060235,40.518614],[16.060184,40.518645],[16.060123,40.518672],[16.060069,40.5187],[16.059997,40.518731],[16.059943,40.518757],[16.059884,40.518783],[16.059825,40.5188],[16.059756,40.518798],[16.059681,40.518784],[16.059621,40.51877],[16.059563,40.518759],[16.059498,40.518743],[16.059421,40.518725],[16.059356,40.518711],[16.059294,40.518704],[16.059226,40.518679],[16.059169,40.518666],[16.0591,40.518651],[16.059051,40.518626],[16.058995,40.518602],[16.058939,40.518576],[16.058892,40.518546],[16.058826,40.518516],[16.058767,40.518493],[16.058704,40.518473],[16.058616,40.518451],[16.058543,40.518438],[16.058484,40.518424],[16.058417,40.518414],[16.058352,40.518419],[16.058286,40.518451],[16.058247,40.518487],[16.058203,40.518521],[16.058148,40.518548],[16.058083,40.518573],[16.058006,40.518605],[16.057955,40.518632],[16.0579,40.518656],[16.057848,40.518678],[16.057791,40.518705],[16.05773,40.518738],[16.057673,40.518757],[16.057622,40.518783],[16.057569,40.518807],[16.057517,40.518833],[16.057455,40.518842],[16.057403,40.518872],[16.057336,40.518903],[16.057283,40.518933],[16.057234,40.518967],[16.057171,40.518967],[16.057158,40.518921],[16.0571,40.51891],[16.057046,40.518878],[16.057077,40.518835],[16.05706,40.518786],[16.057009,40.518757],[16.056946,40.518729],[16.056887,40.518712],[16.056827,40.518697],[16.056769,40.518685],[16.056697,40.518666],[16.056643,40.518646],[16.056583,40.518648],[16.056521,40.518649],[16.056461,40.518656],[16.056402,40.518657],[16.056338,40.518669],[16.056279,40.518675],[16.056218,40.518681],[16.056158,40.51869],[16.056098,40.518708],[16.056052,40.518742],[16.056016,40.51878],[16.056,40.518823],[16.056005,40.518879],[16.056015,40.518924],[16.056013,40.518979],[16.056024,40.519042],[16.056028,40.5191],[16.056006,40.519143],[16.055983,40.519193],[16.055982,40.519242],[16.055961,40.519287],[16.055906,40.519319],[16.055859,40.519363],[16.055838,40.519412],[16.055805,40.519452],[16.055758,40.519484],[16.055711,40.519512],[16.05566,40.519546],[16.055594,40.519582],[16.055541,40.519603],[16.055486,40.519631],[16.05542,40.519657],[16.055362,40.519672],[16.055298,40.519682],[16.055229,40.519691],[16.055177,40.519713],[16.055125,40.519736],[16.055069,40.51977],[16.055009,40.519774],[16.054937,40.519759],[16.054877,40.519728],[16.054865,40.519774],[16.054878,40.519827],[16.054842,40.519872],[16.054848,40.51992],[16.054897,40.519948],[16.054835,40.519948],[16.054821,40.519904],[16.054756,40.519893],[16.054697,40.519878],[16.054639,40.519857],[16.054591,40.519829],[16.05453,40.519811],[16.054467,40.519797],[16.054398,40.519776],[16.054347,40.519745],[16.054269,40.519713],[16.054212,40.519685],[16.054155,40.519661],[16.054096,40.519635],[16.054036,40.519615],[16.053979,40.519595],[16.053925,40.519553],[16.053879,40.519518],[16.053824,40.519498],[16.053756,40.519481],[16.053688,40.519487],[16.053624,40.519505],[16.053533,40.519517],[16.053471,40.519508],[16.053408,40.519501],[16.05333,40.519495],[16.053256,40.519517],[16.053176,40.519545],[16.053108,40.519542],[16.053053,40.519519],[16.052982,40.519514],[16.052929,40.519539],[16.052885,40.519573],[16.052819,40.519611],[16.052755,40.519634],[16.0527,40.519661],[16.052649,40.519693],[16.052598,40.519726],[16.052555,40.51976],[16.052524,40.519805],[16.052484,40.519855],[16.052424,40.519888],[16.052387,40.519926],[16.052365,40.51997],[16.052339,40.520012],[16.05229,40.520039],[16.052235,40.520075],[16.052209,40.520122],[16.052162,40.520163],[16.052108,40.520189],[16.052055,40.52021],[16.052002,40.520235],[16.051981,40.52028],[16.051937,40.520324],[16.051885,40.520357],[16.051834,40.520389],[16.05177,40.520415],[16.051715,40.520446],[16.051662,40.520476],[16.051624,40.520519],[16.051579,40.520557],[16.051533,40.520587],[16.051484,40.520614],[16.051425,40.520644],[16.051364,40.520662],[16.0513,40.520663],[16.051241,40.52066],[16.051181,40.520663],[16.05113,40.520688],[16.051068,40.520699],[16.050996,40.520718],[16.050941,40.520739],[16.050882,40.520736],[16.050816,40.520744],[16.050728,40.520747],[16.050686,40.520784],[16.050636,40.520813],[16.050582,40.520838],[16.050535,40.520873],[16.050487,40.520906],[16.05042,40.520931],[16.050364,40.520956],[16.050311,40.520987],[16.050265,40.521022],[16.050227,40.52106],[16.050174,40.521103],[16.050123,40.52113],[16.050067,40.521148],[16.049983,40.521168],[16.049919,40.521189],[16.049858,40.521206],[16.049772,40.521215],[16.049707,40.521243],[16.049695,40.521288],[16.049689,40.521335],[16.049681,40.521383],[16.049651,40.521423],[16.049613,40.521468],[16.049589,40.521509],[16.049527,40.521534],[16.049476,40.521565],[16.049459,40.521619],[16.049448,40.521667],[16.049411,40.521703],[16.049351,40.521708],[16.049277,40.52168],[16.049226,40.521651],[16.049163,40.521634],[16.049184,40.521678],[16.049213,40.521724],[16.049199,40.521779],[16.049177,40.521825],[16.049162,40.521879],[16.04912,40.521928],[16.049118,40.521974],[16.049141,40.52202],[16.04911,40.52207],[16.049083,40.52211],[16.049049,40.522149],[16.049019,40.52219],[16.048991,40.522231],[16.04897,40.522273],[16.048964,40.522321],[16.048961,40.522373],[16.049,40.522443],[16.049058,40.522429],[16.049116,40.522412],[16.04916,40.522378],[16.049209,40.522423],[16.049244,40.522471],[16.049297,40.522508],[16.049328,40.522548],[16.049384,40.522591],[16.04944,40.522615],[16.049463,40.522662],[16.049499,40.522714],[16.049536,40.522772],[16.049562,40.522814],[16.049546,40.522867],[16.04953,40.522916],[16.049536,40.522962],[16.04955,40.523011],[16.049566,40.523075],[16.049572,40.523129],[16.049585,40.523174],[16.049569,40.523224],[16.049552,40.523268],[16.049583,40.523319],[16.049606,40.523362],[16.049606,40.523412],[16.0496,40.523463],[16.049568,40.523515],[16.049533,40.523565],[16.04951,40.523607],[16.049481,40.523646],[16.049437,40.523689],[16.04938,40.523736],[16.049327,40.523759],[16.049351,40.523801],[16.049363,40.523852],[16.049377,40.523896],[16.049417,40.523931],[16.049451,40.523974],[16.049483,40.524021],[16.049504,40.524071],[16.049569,40.524079],[16.049607,40.524132],[16.049625,40.524179],[16.04965,40.524232],[16.049668,40.524279],[16.049693,40.524321],[16.049743,40.524348],[16.049792,40.524374],[16.049848,40.524396],[16.04988,40.524437],[16.049898,40.524486],[16.049881,40.524534],[16.049933,40.524568],[16.049963,40.524614],[16.049974,40.524665],[16.049998,40.524711],[16.05004,40.524763],[16.050091,40.524791],[16.050146,40.52483],[16.050188,40.52488],[16.050206,40.52493],[16.050203,40.524982],[16.050214,40.52503],[16.050221,40.5251],[16.050232,40.525157],[16.050241,40.525225],[16.050235,40.525272],[16.050218,40.52534],[16.050206,40.525387],[16.050222,40.525433],[16.050252,40.525484],[16.05032,40.525515],[16.050363,40.525551],[16.05042,40.52552],[16.050481,40.525534],[16.050549,40.525528],[16.050613,40.525531],[16.050667,40.525509],[16.050722,40.525485],[16.0508,40.52551],[16.050876,40.52552],[16.050937,40.525536],[16.050993,40.525553],[16.051029,40.525594],[16.051072,40.525632],[16.051131,40.525649],[16.051214,40.525654],[16.051273,40.525673],[16.051277,40.525721],[16.051297,40.525662],[16.051209,40.525502],[16.051236,40.525582],[16.051264,40.525647],[16.051313,40.525673],[16.051383,40.525679],[16.051342,40.525752],[16.051279,40.525773],[16.051339,40.52578],[16.051283,40.525797],[16.051215,40.525818],[16.051191,40.52587],[16.051163,40.525915],[16.051128,40.525954],[16.051104,40.525996],[16.051094,40.526049],[16.051059,40.526091],[16.051015,40.526137],[16.050976,40.526183],[16.050969,40.526231],[16.050929,40.526266],[16.050974,40.526227],[16.050932,40.526278],[16.050879,40.526301],[16.050938,40.526292],[16.050953,40.526336],[16.050969,40.526384],[16.050976,40.526429],[16.051004,40.526469],[16.051012,40.526519],[16.051037,40.526561],[16.051024,40.526608],[16.050961,40.526618],[16.050968,40.526665],[16.050984,40.52671],[16.050938,40.526744],[16.050944,40.526796],[16.050964,40.526842],[16.050951,40.526888],[16.050919,40.526929],[16.050882,40.526971],[16.05083,40.526997],[16.050771,40.527015],[16.050719,40.527043],[16.050668,40.527071],[16.050617,40.52711],[16.050678,40.527107],[16.05066,40.52715],[16.05071,40.527181],[16.050751,40.527145],[16.050811,40.527158],[16.050821,40.527207],[16.050821,40.527256],[16.050793,40.527303],[16.050765,40.527348],[16.050754,40.527394],[16.05072,40.527432],[16.050661,40.527423],[16.050596,40.52743],[16.050528,40.527419],[16.050468,40.527434],[16.050458,40.527479],[16.050513,40.52746],[16.050566,40.527489],[16.050572,40.527534],[16.050565,40.527585],[16.050573,40.527639],[16.050635,40.527656],[16.050694,40.527674],[16.050745,40.527696],[16.050764,40.527741],[16.050809,40.527771],[16.050802,40.527816],[16.050802,40.527864],[16.050788,40.52791],[16.050779,40.527961],[16.050747,40.527999],[16.050722,40.528054],[16.050664,40.528068],[16.050609,40.528049],[16.050589,40.528006],[16.050538,40.528035],[16.050502,40.528073],[16.050475,40.528113],[16.050445,40.528158],[16.050451,40.528206],[16.050431,40.528253],[16.050483,40.528281],[16.050528,40.528313],[16.050592,40.528331],[16.050581,40.528377],[16.050553,40.528419],[16.0505,40.528439],[16.05046,40.528481],[16.050434,40.528522],[16.050489,40.528549],[16.050551,40.528552],[16.050624,40.528542],[16.050693,40.528533],[16.050749,40.528518],[16.050815,40.528521],[16.050876,40.528531],[16.050911,40.528579],[16.050947,40.528622],[16.051046,40.528631],[16.051255,40.528645],[16.051373,40.528642],[16.051565,40.528613],[16.051636,40.528592],[16.051698,40.528568],[16.051142,40.528574],[16.051064,40.528595],[16.05096,40.528604],[16.051016,40.52863],[16.05109,40.528643],[16.051178,40.528641],[16.051447,40.528635],[16.051515,40.52857],[16.05152,40.52852],[16.051317,40.528537],[16.051244,40.528551],[16.051339,40.528584],[16.051291,40.52855],[16.051252,40.528502],[16.051182,40.528486],[16.051112,40.528485],[16.05105,40.528465],[16.050971,40.528461],[16.050917,40.52848],[16.050853,40.528506],[16.050803,40.528531],[16.050777,40.528584],[16.050786,40.528634],[16.050806,40.528678],[16.050736,40.528677],[16.050684,40.528705],[16.050745,40.5287],[16.050706,40.528735],[16.050722,40.528784],[16.050662,40.52879],[16.050726,40.528789],[16.050767,40.528824],[16.050811,40.528855],[16.050761,40.528893],[16.050731,40.528946],[16.050735,40.528999],[16.050674,40.529033],[16.050606,40.529032],[16.050602,40.529078],[16.050582,40.529016],[16.05058,40.528955],[16.050616,40.528992],[16.050641,40.529035],[16.050594,40.529068],[16.050562,40.529027],[16.050616,40.529045],[16.050619,40.528999],[16.050625,40.529046],[16.050693,40.529064],[16.050754,40.529086],[16.050816,40.529102],[16.050877,40.529111],[16.050938,40.529102],[16.05092,40.529148],[16.050847,40.529212],[16.0509,40.529238],[16.050952,40.529266],[16.050908,40.529296],[16.050935,40.529337],[16.050939,40.529383],[16.05096,40.529426],[16.050989,40.529465],[16.051044,40.529487],[16.051092,40.529515],[16.051149,40.529528],[16.051199,40.52956],[16.05124,40.529595],[16.051243,40.52964],[16.051264,40.529684],[16.051292,40.529726],[16.051261,40.529768],[16.051264,40.529813],[16.051273,40.529861],[16.051265,40.529906],[16.051269,40.529957],[16.051338,40.529943],[16.051369,40.529904],[16.05142,40.529928],[16.051424,40.529976],[16.05143,40.530025],[16.051445,40.530071],[16.051448,40.530119],[16.051422,40.530162],[16.051425,40.53021],[16.051343,40.530222],[16.051263,40.530211],[16.051211,40.530239],[16.051168,40.530276],[16.051134,40.530332],[16.051123,40.530378],[16.051152,40.530426],[16.051153,40.530471],[16.051102,40.530497],[16.051026,40.530486],[16.050966,40.530467],[16.050906,40.53047],[16.05085,40.530499],[16.05079,40.530516],[16.05083,40.530552],[16.050771,40.530544],[16.050735,40.530581],[16.050694,40.530614],[16.050661,40.530659],[16.050594,40.53066],[16.050533,40.530671],[16.050495,40.530707],[16.050432,40.5307],[16.050373,40.530711],[16.050376,40.530759],[16.050399,40.530802],[16.050358,40.530839],[16.050407,40.530866],[16.050468,40.530855],[16.05053,40.53087],[16.050556,40.530915],[16.050598,40.530948],[16.050657,40.530986],[16.05064,40.531031],[16.050694,40.531062],[16.050677,40.531109],[16.050678,40.531155],[16.050727,40.531185],[16.050689,40.531221],[16.050645,40.531253],[16.050585,40.531268],[16.050523,40.531263],[16.050453,40.531255],[16.050404,40.531228],[16.050464,40.531213],[16.050515,40.531238],[16.050455,40.531232],[16.050505,40.53126],[16.050526,40.531209],[16.050467,40.531208],[16.050527,40.531214],[16.050489,40.531248],[16.050445,40.531207],[16.0505,40.531239],[16.050442,40.531248],[16.050389,40.531225],[16.050356,40.531187],[16.050346,40.53114],[16.050289,40.531118],[16.050241,40.531152],[16.050191,40.531127],[16.050129,40.531131],[16.050077,40.531108],[16.050015,40.531126],[16.049952,40.531134],[16.049897,40.531159],[16.049872,40.531208],[16.049854,40.531254],[16.049828,40.531299],[16.049826,40.531344],[16.049806,40.531387],[16.049801,40.531435],[16.049793,40.53148],[16.049773,40.531525],[16.049778,40.531571],[16.049789,40.531616],[16.049804,40.531663],[16.049844,40.531704],[16.049834,40.531749],[16.049773,40.531777],[16.049714,40.531785],[16.049656,40.531761],[16.049614,40.5318],[16.049544,40.531786],[16.049488,40.531801],[16.049432,40.531817],[16.049372,40.531835],[16.049297,40.531837],[16.049237,40.53183],[16.049172,40.531817],[16.049108,40.531815],[16.049043,40.531818],[16.048978,40.53181],[16.048918,40.531815],[16.048859,40.531825],[16.048805,40.531849],[16.048757,40.531889],[16.048697,40.531904],[16.048663,40.531943],[16.048621,40.531982],[16.048572,40.532013],[16.048503,40.532051],[16.048453,40.532078],[16.048405,40.532108],[16.048379,40.532152],[16.048344,40.532191],[16.048286,40.532212],[16.048218,40.532215],[16.048153,40.532221],[16.048086,40.532234],[16.048023,40.532256],[16.047958,40.532268],[16.047896,40.532293],[16.047853,40.532325],[16.047882,40.532284],[16.047893,40.532239],[16.047916,40.532189],[16.047969,40.532165],[16.048034,40.53215],[16.048097,40.532143],[16.048151,40.532123],[16.048224,40.532084],[16.048276,40.532059],[16.04829,40.532008],[16.048244,40.531976],[16.048311,40.531969],[16.04837,40.531951],[16.048408,40.531897],[16.048393,40.531847],[16.048414,40.531801],[16.048426,40.531753],[16.048448,40.53171],[16.048472,40.531664],[16.04849,40.531615],[16.048498,40.53157],[16.048515,40.531524],[16.048585,40.531537],[16.048656,40.531525],[16.048679,40.531472],[16.048693,40.531424],[16.048679,40.531378],[16.048712,40.531339],[16.04876,40.531367],[16.04881,40.531337],[16.048866,40.53132],[16.048933,40.531312],[16.048998,40.531308],[16.048978,40.531265],[16.048914,40.531277],[16.048867,40.531244],[16.048813,40.531214],[16.048762,40.531185],[16.048702,40.531161],[16.048638,40.531164],[16.048576,40.531162],[16.048524,40.531137],[16.048504,40.531089],[16.048443,40.531103],[16.048401,40.53107],[16.048356,40.531033],[16.048357,40.531083],[16.048298,40.531108],[16.048236,40.531117],[16.048236,40.531071],[16.048175,40.531063],[16.048121,40.531039],[16.04808,40.531072],[16.048035,40.531103],[16.047976,40.531093],[16.047928,40.531066],[16.047863,40.531059],[16.047855,40.531014],[16.047797,40.531041],[16.04776,40.531083],[16.047691,40.531094],[16.047634,40.531129],[16.047577,40.531142],[16.047518,40.531115],[16.047472,40.531081],[16.047426,40.531051],[16.047361,40.531048],[16.047301,40.531068],[16.047244,40.531084],[16.047175,40.531106],[16.0471,40.531119],[16.047036,40.531109],[16.046966,40.531096],[16.04691,40.531072],[16.046868,40.531024],[16.046865,40.530978],[16.04682,40.530948],[16.046787,40.530908],[16.046723,40.530899],[16.046663,40.530869],[16.046598,40.530841],[16.046558,40.530801],[16.046525,40.53076],[16.046585,40.530754],[16.046561,40.530806],[16.046512,40.530772],[16.04645,40.530744],[16.046406,40.530776],[16.046465,40.530774],[16.046469,40.530729],[16.046431,40.530803],[16.046339,40.530884],[16.046241,40.531019],[16.046191,40.531372],[16.046206,40.531435],[16.046255,40.531332],[16.046302,40.531202],[16.04634,40.531048],[16.046388,40.531002],[16.046411,40.530948],[16.046435,40.530893],[16.046456,40.530835],[16.046525,40.530638],[16.046469,40.530597],[16.046465,40.530544],[16.046471,40.530496],[16.046487,40.530446],[16.046513,40.53039],[16.046532,40.530343],[16.04659,40.530329],[16.046651,40.530339],[16.046713,40.530336],[16.046694,40.530381],[16.046653,40.530344],[16.046602,40.530315],[16.046585,40.530268],[16.046632,40.53024],[16.046644,40.530196],[16.046612,40.530152],[16.046547,40.530121],[16.046471,40.5301],[16.046407,40.530082],[16.046348,40.530064],[16.046283,40.530052],[16.046226,40.530014],[16.046163,40.530002],[16.046091,40.530021],[16.046026,40.530028],[16.045966,40.53001],[16.045903,40.529999],[16.045824,40.529986],[16.045797,40.529931],[16.045774,40.529887],[16.045706,40.529892],[16.045642,40.529898],[16.045593,40.529862],[16.045543,40.529834],[16.045484,40.52983],[16.045414,40.529824],[16.045352,40.529831],[16.045289,40.529824],[16.04523,40.529803],[16.045184,40.529763],[16.045133,40.529738],[16.045116,40.52969],[16.045099,40.529645],[16.045085,40.529591],[16.045083,40.529536],[16.045098,40.529485],[16.045105,40.529437],[16.045091,40.529389],[16.045081,40.529329],[16.045082,40.529284],[16.045087,40.529238],[16.045105,40.529182],[16.045145,40.529145],[16.045198,40.529113],[16.045189,40.529066],[16.045252,40.529045],[16.045297,40.529014],[16.045337,40.528977],[16.045385,40.528937],[16.045438,40.528903],[16.045486,40.528876],[16.045529,40.528843],[16.045597,40.528819],[16.045656,40.528801],[16.04571,40.528781],[16.045757,40.528741],[16.045799,40.528704],[16.045844,40.528669],[16.045887,40.528624],[16.045919,40.528585],[16.045956,40.528547],[16.046018,40.528515],[16.046078,40.528492],[16.046147,40.52848],[16.046211,40.52847],[16.046272,40.528454],[16.046342,40.528439],[16.046408,40.528436],[16.046477,40.528419],[16.04653,40.528395],[16.046585,40.528368],[16.046634,40.528335],[16.046678,40.528299],[16.046721,40.528262],[16.046778,40.528216],[16.046825,40.528181],[16.046871,40.528151],[16.046875,40.528098],[16.046906,40.528047],[16.046921,40.528004],[16.046925,40.527955],[16.046927,40.5279],[16.046916,40.527852],[16.046903,40.5278],[16.046903,40.527755],[16.04691,40.527707],[16.046923,40.527656],[16.046936,40.5276],[16.046966,40.52756],[16.047008,40.527524],[16.04706,40.527492],[16.04711,40.527467],[16.047148,40.527429],[16.047157,40.527384],[16.047171,40.527338],[16.047218,40.527307],[16.047275,40.52729],[16.047344,40.527255],[16.047401,40.527223],[16.04744,40.527188],[16.04747,40.527137],[16.0475,40.527088],[16.047508,40.527035],[16.047518,40.526986],[16.047536,40.526934],[16.047541,40.526888],[16.047576,40.526831],[16.04761,40.526782],[16.047628,40.526736],[16.047647,40.526688],[16.04767,40.526641],[16.047689,40.526596],[16.047701,40.526543],[16.047684,40.526496],[16.047651,40.526454],[16.047602,40.52642],[16.047523,40.526403],[16.047461,40.526394],[16.047398,40.526373],[16.04735,40.526339],[16.047271,40.526318],[16.047206,40.526295],[16.047137,40.52628],[16.047081,40.526254],[16.047025,40.526238],[16.046952,40.526219],[16.046894,40.526202],[16.046806,40.526175],[16.046734,40.526135],[16.046677,40.526104],[16.046625,40.526082],[16.046543,40.526048],[16.046481,40.526023],[16.046419,40.526008],[16.046366,40.525978],[16.046311,40.525953],[16.046261,40.525925],[16.046226,40.525879],[16.046207,40.52583],[16.04618,40.525787],[16.046144,40.525751],[16.04609,40.525723],[16.046034,40.525693],[16.046002,40.52565],[16.045945,40.525607],[16.045917,40.525556],[16.04589,40.525505],[16.045892,40.525445],[16.045907,40.525383],[16.045923,40.525333],[16.045946,40.525289],[16.04596,40.525218],[16.045984,40.52517],[16.046018,40.525132],[16.046058,40.52509],[16.04608,40.525044],[16.046112,40.525],[16.046141,40.52495],[16.046171,40.524893],[16.04621,40.524855],[16.046231,40.52481],[16.04622,40.524751],[16.046207,40.524705],[16.046221,40.524651],[16.046258,40.52461],[16.046298,40.52457],[16.046314,40.524509],[16.046284,40.524467],[16.046271,40.524419],[16.04623,40.524386]]]}}]}}),new vg({position:{lat:40.416466,lon:15.820195},id:"volturino_23-06",name:"Escursione Monte Volturino",description:`<p>
                    Escursione sul monte Volturino, domenica 16 Giugno 2024.
                </p>
                <p>
                    Programma:
                <ul>
                    <li>09:00 - Partenza da Tricarico</li>
                    <li>10:15 - Arrivo al Piano dell’Imperatore</li>
                    <li>10:30 - Inizio salita</li>
                    <li>12:30 - Arrivo in vetta</li>
                    <li>13:00 - Pranzo</li>
                    <li>15:00 - Inizio discesa</li>
                    <li>17:00 - Arrivo al Piano dell’Imperatore</li>
                    <li>18:00 - Rientro a Tricarico</li>
                </ul>

                </p>

                <p>
                    Altre informazioni utili:
                    <br>
                    L'altitudine in vetta è di 1835 m, l'altitudine nel punto di partenza è di 1560 m. Gli orari -
                    soprattutto quelli che riguardano la durata di salita, discesa e pranzo - sono una stima e perciò
                    potrebbero variare.
                </p>`,imageUrl:"/img/volturino.jpg",date:new Date("2024-06-23"),mapData:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[[15.820195,40.406247,1563.647],[15.819528,40.406275,1566.695],[15.819461,40.406559,1566.094],[15.819525,40.406562,1566.696],[15.819327,40.406447,1569.134],[15.818799,40.406278,1572.742],[15.818256,40.406375,1582.526],[15.818162,40.406308,1585.826],[15.818183,40.406178,1588.647],[15.818048,40.406062,1591.911],[15.817741,40.405858,1598.308],[15.817385,40.405728,1605.034],[15.817184,40.405725,1608.444],[15.816699,40.405921,1615.192],[15.816533,40.406015,1618.411],[15.816415,40.406306,1625.193],[15.816129,40.406688,1638.641],[15.816068,40.406902,1640.799],[15.815846,40.40707,1645.043],[15.815634,40.407538,1649.236],[15.815206,40.40804,1658.417],[15.815106,40.408459,1668.118],[15.814998,40.408365,1671.508],[15.8149,40.408361,1674.285],[15.814695,40.408773,1686.195],[15.814387,40.409024,1693.183],[15.814387,40.409102,1695.972],[15.814048,40.409362,1707.714],[15.813754,40.409444,1711.172],[15.813484,40.409718,1716.91],[15.813139,40.410238,1730.084],[15.812845,40.410437,1739.178],[15.812722,40.4106,1748.633],[15.812669,40.410761,1751.926],[15.812696,40.410836,1755.608],[15.812425,40.410926,1764.499],[15.812313,40.411211,1774.239],[15.812138,40.411333,1784.257],[15.811948,40.411653,1793.466],[15.811683,40.411711,1800.188],[15.811552,40.411643,1799.216],[15.811483,40.411718,1800.134],[15.811091,40.411842,1815.998],[15.810854,40.412135,1826.951],[15.810681,40.412255,1834.201],[15.810207,40.412294,1844.911],[15.809882,40.412253,1846.408],[15.809565,40.412255,1854.077],[15.809577,40.412244,1850.167],[15.809573,40.412242,1855.945],[15.809553,40.412243,1844.384],[15.809521,40.412315,1854.096],[15.809595,40.412254,1848.354],[15.809595,40.412254,1852.562],[15.809596,40.412254,1844.386],[15.809596,40.412254,1854.422],[15.809595,40.412254,1846.762],[15.809595,40.412255,1851.908],[15.81003,40.411861,1835.208],[15.810233,40.411551,1828.434],[15.810518,40.410887,1826.084],[15.810905,40.410549,1807.782],[15.811202,40.410224,1797.791],[15.811401,40.409951,1792.513],[15.811474,40.409682,1787.311],[15.811992,40.409132,1781.599],[15.812078,40.408953,1779.183],[15.812137,40.408447,1776.016],[15.812261,40.408187,1770.276],[15.812223,40.408164,1771.413],[15.812402,40.407841,1762.308],[15.812823,40.407403,1755.043],[15.813072,40.407429,1748.673],[15.813054,40.407392,1747.751],[15.81321,40.407499,1743.42],[15.813808,40.407284,1728.552],[15.813802,40.407455,1724.84],[15.813981,40.407593,1714.198],[15.814292,40.407336,1707.712],[15.814288,40.407176,1707.748],[15.814637,40.406865,1698.661],[15.814674,40.406994,1695.917],[15.814954,40.406863,1687.308],[15.815113,40.406885,1681.866],[15.815097,40.407006,1675.786],[15.815547,40.406579,1670.984],[15.815661,40.406364,1669.073],[15.815772,40.406236,1662.375],[15.815862,40.40594,1658.413],[15.8158,40.40553,1654.421],[15.81646,40.404835,1622.725],[15.816724,40.404717,1615.157],[15.817368,40.40476,1600.8],[15.818006,40.405181,1595.02],[15.818632,40.405504,1592.508],[15.818992,40.405799,1581.627],[15.819086,40.405916,1580.067],[15.819087,40.406059,1578.575],[15.819445,40.406011,1575.234],[15.819857,40.406108,1568.136],[15.82014,40.406239,1566.914],[15.820184,40.406211,1565.162],[15.820225,40.406284,1568.576]]},properties:{}}]}}),new vg({position:{lat:40.64801,lon:16.059105},id:"paintball_20-06",name:"Partita a Paintball",description:`<p>
                    Partita a paintball, 4 giocatori.
                </p>
                <p>
                    20 Giugno
                    <br/>
                    Orario: 19:00 - 20:30
                </p>

                <p>
                    <b>Nota</b>:
                    <br>
                    <ul>
                        <li>L'orario non è modificabile (non è possibile giocare dopo il tramonto)</li>
                        <li>Verrà fornita l'attrezzatura minima (casco, fucile e paintballs). Sono consigliati pantaloni lunghi.</li>
                        <li>Il costo delle paintballs è di 5 €/200 paintballs. Non ci sono altri costi.</li>
                    </ul>
                </p>`,imageUrl:"/img/paintball.jpg",date:new Date("2024-06-20"),time:["19:00"],maxParticipants:4}),new vg({position:{lat:40.671264,lon:16.596083},id:"matera_14-07",name:"A matera col piumino",description:`<p>
                    Giornata a matera e giro col piumino
                </p>
                <p>
                    Il prossimo dovrebbe essere un fine settimana particolarmente caldo e le previsioni segnalano massime a Matera di 38 gradi. Essendo la temperatura esterna maggiore di quella corporea, potrebbe essere una buona occasione per testare la tenuta dei nostri piumini utilizzati finora solo nel periodo invernale.
                    <br/>
                    Orario: 11:00 - 16:30
                </p>

                <p>
                    <b>Programma</b>:
                    <br>
                    <ul>
                        <li><b>12:00</b> - Arrivo a Matera</li>
                        <li><b>13:00</b> - Pranzo da qualche parte</li>
                        <li><b>14:00</b> - Giro con i piumini</li>
                    </ul>
                </p>`,imageUrl:"/img/matera_piumini.webp",date:new Date("2024-07-14")}),new vg({position:{lat:40.64801,lon:16.059105},id:"paintball_13-07",name:"Partita a Paintball",description:`<p>
                    Partita a paintball, 4 giocatori.
                </p>
                <p>
                    20 Giugno
                    <br/>
                    Orario: slot di 2 ore tra le 10:00 e le 20:30
                </p>

                <p>
                    <b>Nota</b>:
                    <br>
                    <ul>
                        <li>L'orario non è modificabile (non è possibile giocare dopo il tramonto)</li>
                        <li>Verrà fornita l'attrezzatura minima (casco, fucile e paintballs). Sono consigliati pantaloni lunghi.</li>
                        <li>Il costo delle paintballs è di 5 €/200 paintballs. Non ci sono altri costi.</li>
                    </ul>
                </p>`,imageUrl:"/img/paintball.jpg",date:new Date("2024-07-13"),time:["10:00","11:00","16:00","17:00","18:00"],maxParticipants:4}),new vg({position:{lat:40.64801,lon:16.059105},id:"paintball_day_13-07",name:"Giornata Paintball",description:`<p>
                    Intera giornata a tema paintball. Partite a paintball mattina e pomeriggio e pausa pranzo con carne arrosto.
                </p>
                <p>
                    13 Luglio
                    <br/>
                    Orario: 10:00 - 20:00
                </p>

                <p>
                    <b>Programma</b>:
                    <br>
                    <ul>
                        <li>Partita a paintball in mattinata</li>
                        <li>Pranzo con carne arrosto e riposo nelle ore più calde</li>
                        <li>Partita nel pomeriggio</li>
                    </ul>
                </p>`,imageUrl:"/img/paintball_day.webp",date:new Date("2024-07-14"),maxParticipants:4})],woe={class:"events-list"},Toe={key:0,class:"no-events"},Eoe={class:"event-card"},Ioe={class:"name"},Soe={class:"date"},Aoe={key:0,class:"max-participants"},Coe={key:1,class:"times"},Roe={class:"time"},Poe=wa({__name:"EventsList",setup(r){const e=new Date,t=y9.filter(o=>o.date>e);return(o,c)=>(Pr(),Qr("div",woe,[Rn(t).length===0?(Pr(),Qr("div",Toe," Non ci sono eventi al momento ")):pu("",!0),(Pr(!0),Qr(Po,null,Em(Rn(t),f=>(Pr(),Im(Rn(lN),{to:`/event/${f.id}`,key:f.id},{default:c0(()=>[mr("div",Eoe,[mr("div",Ioe,ms(f.name),1),mr("div",Soe,ms(f.date.toLocaleDateString()),1),f.maxParticipants?(Pr(),Qr("div",Aoe,ms(f.maxParticipants),1)):pu("",!0),f.time&&f.time.length>0?(Pr(),Qr("div",Coe,[(Pr(!0),Qr(Po,null,Em(f.time,y=>(Pr(),Qr("div",Roe,ms(y),1))),256))])):pu("",!0)])]),_:2},1032,["to"]))),128))]))}}),Moe=cc(Poe,[["__scopeId","data-v-6863a988"]]),koe={class:"home"},Doe=wa({__name:"HomeView",setup(r){return(e,t)=>(Pr(),Qr("div",koe,[t[0]||(t[0]=mr("div",{class:"title"}," Prossimi eventi ",-1)),Bs(Moe,{class:"event-list"})]))}}),Loe=cc(Doe,[["__scopeId","data-v-db6797bd"]]);var Ooe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Foe(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var v9={exports:{}};(function(r,e){(function(t,o){r.exports=o()})(Ooe,function(){var t,o,c;function f(s,E){if(!t)t=E;else if(!o)o=E;else{var R="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+o+")(sharedChunk); self.onerror = null;",O={};t(O),c=E(O),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(c.workerUrl=window.URL.createObjectURL(new Blob([R],{type:"text/javascript"})))}}f(["exports"],function(s){var E=1e-6,R=typeof Float32Array<"u"?Float32Array:Array;function O(l,i){var a=i[0],h=i[1],d=i[2],_=i[3],g=a*_-d*h;return g?(l[0]=_*(g=1/g),l[1]=-h*g,l[2]=-d*g,l[3]=a*g,l):null}function A(){var l=new R(9);return R!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function U(l,i){var a=i[0],h=i[1],d=i[2],_=i[3],g=i[4],b=i[5],T=i[6],S=i[7],P=i[8];return l[0]=g*P-b*S,l[1]=d*S-h*P,l[2]=h*b-d*g,l[3]=b*T-_*P,l[4]=a*P-d*T,l[5]=d*_-a*b,l[6]=_*S-g*T,l[7]=h*T-a*S,l[8]=a*g-h*_,l}function $(l,i,a){var h=i[0],d=i[1],_=i[2],g=i[3],b=i[4],T=i[5],S=i[6],P=i[7],M=i[8],L=a[0],N=a[1],B=a[2],W=a[3],X=a[4],Z=a[5],ne=a[6],se=a[7],le=a[8];return l[0]=L*h+N*g+B*S,l[1]=L*d+N*b+B*P,l[2]=L*_+N*T+B*M,l[3]=W*h+X*g+Z*S,l[4]=W*d+X*b+Z*P,l[5]=W*_+X*T+Z*M,l[6]=ne*h+se*g+le*S,l[7]=ne*d+se*b+le*P,l[8]=ne*_+se*T+le*M,l}function te(){var l=new R(16);return R!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l}function Q(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function de(l,i){var a=i[0],h=i[1],d=i[2],_=i[3],g=i[4],b=i[5],T=i[6],S=i[7],P=i[8],M=i[9],L=i[10],N=i[11],B=i[12],W=i[13],X=i[14],Z=i[15],ne=a*b-h*g,se=a*T-d*g,le=a*S-_*g,Ee=h*T-d*b,Ie=h*S-_*b,Re=d*S-_*T,Ne=P*W-M*B,je=P*X-L*B,ft=P*Z-N*B,We=M*X-L*W,mt=M*Z-N*W,St=L*Z-N*X,gt=ne*St-se*mt+le*We+Ee*ft-Ie*je+Re*Ne;return gt?(l[0]=(b*St-T*mt+S*We)*(gt=1/gt),l[1]=(d*mt-h*St-_*We)*gt,l[2]=(W*Re-X*Ie+Z*Ee)*gt,l[3]=(L*Ie-M*Re-N*Ee)*gt,l[4]=(T*ft-g*St-S*je)*gt,l[5]=(a*St-d*ft+_*je)*gt,l[6]=(X*le-B*Re-Z*se)*gt,l[7]=(P*Re-L*le+N*se)*gt,l[8]=(g*mt-b*ft+S*Ne)*gt,l[9]=(h*ft-a*mt-_*Ne)*gt,l[10]=(B*Ie-W*le+Z*ne)*gt,l[11]=(M*le-P*Ie-N*ne)*gt,l[12]=(b*je-g*We-T*Ne)*gt,l[13]=(a*We-h*je+d*Ne)*gt,l[14]=(W*se-B*Ee-X*ne)*gt,l[15]=(P*Ee-M*se+L*ne)*gt,l):null}function Ce(l,i,a){var h=i[0],d=i[1],_=i[2],g=i[3],b=i[4],T=i[5],S=i[6],P=i[7],M=i[8],L=i[9],N=i[10],B=i[11],W=i[12],X=i[13],Z=i[14],ne=i[15],se=a[0],le=a[1],Ee=a[2],Ie=a[3];return l[0]=se*h+le*b+Ee*M+Ie*W,l[1]=se*d+le*T+Ee*L+Ie*X,l[2]=se*_+le*S+Ee*N+Ie*Z,l[3]=se*g+le*P+Ee*B+Ie*ne,l[4]=(se=a[4])*h+(le=a[5])*b+(Ee=a[6])*M+(Ie=a[7])*W,l[5]=se*d+le*T+Ee*L+Ie*X,l[6]=se*_+le*S+Ee*N+Ie*Z,l[7]=se*g+le*P+Ee*B+Ie*ne,l[8]=(se=a[8])*h+(le=a[9])*b+(Ee=a[10])*M+(Ie=a[11])*W,l[9]=se*d+le*T+Ee*L+Ie*X,l[10]=se*_+le*S+Ee*N+Ie*Z,l[11]=se*g+le*P+Ee*B+Ie*ne,l[12]=(se=a[12])*h+(le=a[13])*b+(Ee=a[14])*M+(Ie=a[15])*W,l[13]=se*d+le*T+Ee*L+Ie*X,l[14]=se*_+le*S+Ee*N+Ie*Z,l[15]=se*g+le*P+Ee*B+Ie*ne,l}function Fe(l,i,a){var h,d,_,g,b,T,S,P,M,L,N,B,W=a[0],X=a[1],Z=a[2];return i===l?(l[12]=i[0]*W+i[4]*X+i[8]*Z+i[12],l[13]=i[1]*W+i[5]*X+i[9]*Z+i[13],l[14]=i[2]*W+i[6]*X+i[10]*Z+i[14],l[15]=i[3]*W+i[7]*X+i[11]*Z+i[15]):(d=i[1],_=i[2],g=i[3],b=i[4],T=i[5],S=i[6],P=i[7],M=i[8],L=i[9],N=i[10],B=i[11],l[0]=h=i[0],l[1]=d,l[2]=_,l[3]=g,l[4]=b,l[5]=T,l[6]=S,l[7]=P,l[8]=M,l[9]=L,l[10]=N,l[11]=B,l[12]=h*W+b*X+M*Z+i[12],l[13]=d*W+T*X+L*Z+i[13],l[14]=_*W+S*X+N*Z+i[14],l[15]=g*W+P*X+B*Z+i[15]),l}function Le(l,i,a){var h=a[0],d=a[1],_=a[2];return l[0]=i[0]*h,l[1]=i[1]*h,l[2]=i[2]*h,l[3]=i[3]*h,l[4]=i[4]*d,l[5]=i[5]*d,l[6]=i[6]*d,l[7]=i[7]*d,l[8]=i[8]*_,l[9]=i[9]*_,l[10]=i[10]*_,l[11]=i[11]*_,l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15],l}function Me(l,i,a){var h=Math.sin(a),d=Math.cos(a),_=i[4],g=i[5],b=i[6],T=i[7],S=i[8],P=i[9],M=i[10],L=i[11];return i!==l&&(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[4]=_*d+S*h,l[5]=g*d+P*h,l[6]=b*d+M*h,l[7]=T*d+L*h,l[8]=S*d-_*h,l[9]=P*d-g*h,l[10]=M*d-b*h,l[11]=L*d-T*h,l}function at(l,i,a){var h=Math.sin(a),d=Math.cos(a),_=i[0],g=i[1],b=i[2],T=i[3],S=i[8],P=i[9],M=i[10],L=i[11];return i!==l&&(l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=_*d-S*h,l[1]=g*d-P*h,l[2]=b*d-M*h,l[3]=T*d-L*h,l[8]=_*h+S*d,l[9]=g*h+P*d,l[10]=b*h+M*d,l[11]=T*h+L*d,l}function pt(l,i,a){var h=Math.sin(a),d=Math.cos(a),_=i[0],g=i[1],b=i[2],T=i[3],S=i[4],P=i[5],M=i[6],L=i[7];return i!==l&&(l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=_*d+S*h,l[1]=g*d+P*h,l[2]=b*d+M*h,l[3]=T*d+L*h,l[4]=S*d-_*h,l[5]=P*d-g*h,l[6]=M*d-b*h,l[7]=L*d-T*h,l}function me(l,i){return l[0]=i[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=i[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=i[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function ye(l,i,a){var h,d,_,g=a[0],b=a[1],T=a[2],S=Math.sqrt(g*g+b*b+T*T);return S<E?null:(g*=S=1/S,b*=S,T*=S,h=Math.sin(i),d=Math.cos(i),l[0]=g*g*(_=1-d)+d,l[1]=b*g*_+T*h,l[2]=T*g*_-b*h,l[3]=0,l[4]=g*b*_-T*h,l[5]=b*b*_+d,l[6]=T*b*_+g*h,l[7]=0,l[8]=g*T*_+b*h,l[9]=b*T*_-g*h,l[10]=T*T*_+d,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l)}function Se(l,i){var a=i[0],h=i[1],d=i[2],_=i[3],g=a+a,b=h+h,T=d+d,S=a*g,P=h*g,M=h*b,L=d*g,N=d*b,B=d*T,W=_*g,X=_*b,Z=_*T;return l[0]=1-M-B,l[1]=P+Z,l[2]=L-X,l[3]=0,l[4]=P-Z,l[5]=1-S-B,l[6]=N+W,l[7]=0,l[8]=L+X,l[9]=N-W,l[10]=1-S-M,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}var ke=Ce;function Ve(){var l=new R(3);return R!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function He(l){var i=new R(3);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i}function Oe(l){var i=l[0],a=l[1],h=l[2];return Math.sqrt(i*i+a*a+h*h)}function xi(l,i,a){var h=new R(3);return h[0]=l,h[1]=i,h[2]=a,h}function ui(l,i,a,h){return l[0]=i,l[1]=a,l[2]=h,l}function ti(l,i,a){return l[0]=i[0]+a[0],l[1]=i[1]+a[1],l[2]=i[2]+a[2],l}function ri(l,i,a){return l[0]=i[0]-a[0],l[1]=i[1]-a[1],l[2]=i[2]-a[2],l}function Si(l,i,a){return l[0]=i[0]*a[0],l[1]=i[1]*a[1],l[2]=i[2]*a[2],l}function ir(l,i,a){return l[0]=Math.min(i[0],a[0]),l[1]=Math.min(i[1],a[1]),l[2]=Math.min(i[2],a[2]),l}function st(l,i,a){return l[0]=Math.max(i[0],a[0]),l[1]=Math.max(i[1],a[1]),l[2]=Math.max(i[2],a[2]),l}function wi(l,i,a){return l[0]=i[0]*a,l[1]=i[1]*a,l[2]=i[2]*a,l}function ji(l,i,a,h){return l[0]=i[0]+a[0]*h,l[1]=i[1]+a[1]*h,l[2]=i[2]+a[2]*h,l}function Ar(l,i){var a=i[0]-l[0],h=i[1]-l[1],d=i[2]-l[2];return a*a+h*h+d*d}function Br(l){var i=l[0],a=l[1],h=l[2];return i*i+a*a+h*h}function Vr(l,i){return l[0]=-i[0],l[1]=-i[1],l[2]=-i[2],l}function Ni(l,i){var a=i[0],h=i[1],d=i[2],_=a*a+h*h+d*d;return _>0&&(_=1/Math.sqrt(_)),l[0]=i[0]*_,l[1]=i[1]*_,l[2]=i[2]*_,l}function vt(l,i){return l[0]*i[0]+l[1]*i[1]+l[2]*i[2]}function Wt(l,i,a){var h=i[0],d=i[1],_=i[2],g=a[0],b=a[1],T=a[2];return l[0]=d*T-_*b,l[1]=_*g-h*T,l[2]=h*b-d*g,l}function Xt(l,i,a,h){var d=i[0],_=i[1],g=i[2];return l[0]=d+h*(a[0]-d),l[1]=_+h*(a[1]-_),l[2]=g+h*(a[2]-g),l}function ai(l,i,a){var h=i[0],d=i[1],_=i[2],g=a[3]*h+a[7]*d+a[11]*_+a[15];return l[0]=(a[0]*h+a[4]*d+a[8]*_+a[12])/(g=g||1),l[1]=(a[1]*h+a[5]*d+a[9]*_+a[13])/g,l[2]=(a[2]*h+a[6]*d+a[10]*_+a[14])/g,l}function nr(l,i,a){var h=i[0],d=i[1],_=i[2];return l[0]=h*a[0]+d*a[3]+_*a[6],l[1]=h*a[1]+d*a[4]+_*a[7],l[2]=h*a[2]+d*a[5]+_*a[8],l}function Be(l,i,a){var h=a[0],d=a[1],_=a[2],g=a[3],b=i[0],T=i[1],S=i[2],P=d*S-_*T,M=_*b-h*S,L=h*T-d*b;return l[0]=b+g*(P+=P)+d*(L+=L)-_*(M+=M),l[1]=T+g*M+_*P-h*L,l[2]=S+g*L+h*M-d*P,l}function Ge(l){return l[0]=0,l[1]=0,l[2]=0,l}function Qe(l,i){return l[0]===i[0]&&l[1]===i[1]&&l[2]===i[2]}var ht=ri,Et=Si,Ue=Oe;function ii(){var l=new R(4);return R!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function Ht(l,i,a){return l[0]=i[0]*a,l[1]=i[1]*a,l[2]=i[2]*a,l[3]=i[3]*a,l}function Jt(l,i){var a=i[0],h=i[1],d=i[2],_=i[3],g=a*a+h*h+d*d+_*_;return g>0&&(g=1/Math.sqrt(g)),l[0]=a*g,l[1]=h*g,l[2]=d*g,l[3]=_*g,l}function Lt(l,i,a){var h=i[0],d=i[1],_=i[2],g=i[3];return l[0]=a[0]*h+a[4]*d+a[8]*_+a[12]*g,l[1]=a[1]*h+a[5]*d+a[9]*_+a[13]*g,l[2]=a[2]*h+a[6]*d+a[10]*_+a[14]*g,l[3]=a[3]*h+a[7]*d+a[11]*_+a[15]*g,l}function Ai(){var l=new R(4);return R!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function ni(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l}function bi(l,i,a){a*=.5;var h=i[0],d=i[1],_=i[2],g=i[3],b=Math.sin(a),T=Math.cos(a);return l[0]=h*T+g*b,l[1]=d*T+_*b,l[2]=_*T-d*b,l[3]=g*T-h*b,l}function Ci(l,i,a){a*=.5;var h=i[0],d=i[1],_=i[2],g=i[3],b=Math.sin(a),T=Math.cos(a);return l[0]=h*T-_*b,l[1]=d*T+g*b,l[2]=_*T+h*b,l[3]=g*T-d*b,l}Ve(),ii();var Ti,Ei,hr,wr=Jt,on=(Ti=Ve(),Ei=xi(1,0,0),hr=xi(0,1,0),function(l,i,a){var h=vt(i,a);return h<-.999999?(Wt(Ti,Ei,i),Ue(Ti)<1e-6&&Wt(Ti,hr,i),Ni(Ti,Ti),function(d,_,g){g*=.5;var b=Math.sin(g);d[0]=b*_[0],d[1]=b*_[1],d[2]=b*_[2],d[3]=Math.cos(g)}(l,Ti,Math.PI),l):h>.999999?(l[0]=0,l[1]=0,l[2]=0,l[3]=1,l):(Wt(Ti,i,a),l[0]=Ti[0],l[1]=Ti[1],l[2]=Ti[2],l[3]=1+h,wr(l,l))});function Jr(){var l=new R(2);return R!=Float32Array&&(l[0]=0,l[1]=0),l}function _r(l,i){var a=new R(2);return a[0]=l,a[1]=i,a}function Es(l,i,a){return l[0]=i,l[1]=a,l}function es(l,i,a){return l[0]=i[0]+a[0],l[1]=i[1]+a[1],l}function xn(l,i,a){return l[0]=i[0]-a[0],l[1]=i[1]-a[1],l}function ss(l,i,a){return l[0]=i[0]*a,l[1]=i[1]*a,l}function Qs(l){var i=l[0],a=l[1];return Math.sqrt(i*i+a*a)}function jr(l,i){var a=i[0],h=i[1],d=a*a+h*h;return d>0&&(d=1/Math.sqrt(d)),l[0]=i[0]*d,l[1]=i[1]*d,l}function dr(l,i){return l[0]*i[0]+l[1]*i[1]}Ai(),Ai(),A();var $o,Is,gs=xn;function eo(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}Jr();var to=function(){if(Is)return $o;function l(i,a,h,d){this.cx=3*i,this.bx=3*(h-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(d-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=a,this.p2x=h,this.p2y=d}return Is=1,$o=l,l.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,a){if(a===void 0&&(a=1e-6),i<0)return 0;if(i>1)return 1;for(var h=i,d=0;d<8;d++){var _=this.sampleCurveX(h)-i;if(Math.abs(_)<a)return h;var g=this.sampleCurveDerivativeX(h);if(Math.abs(g)<1e-6)break;h-=_/g}var b=0,T=1;for(h=i,d=0;d<20&&(_=this.sampleCurveX(h),!(Math.abs(_-i)<a));d++)i>_?b=h:T=h,h=.5*(T-b)+b;return h},solve:function(i,a){return this.sampleCurveY(this.solveCurveX(i,a))}},$o}(),Ta=eo(to);function xt(l,i){this.x=l,this.y=i}function xo(l,i){if(Array.isArray(l)){if(!Array.isArray(i)||l.length!==i.length)return!1;for(let a=0;a<l.length;a++)if(!xo(l[a],i[a]))return!1;return!0}if(typeof l=="object"&&l!==null&&i!==null){if(typeof i!="object"||Object.keys(l).length!==Object.keys(i).length)return!1;for(const a in l)if(!xo(l[a],i[a]))return!1;return!0}return l===i}xt.prototype={clone(){return new xt(this.x,this.y)},add(l){return this.clone()._add(l)},sub(l){return this.clone()._sub(l)},multByPoint(l){return this.clone()._multByPoint(l)},divByPoint(l){return this.clone()._divByPoint(l)},mult(l){return this.clone()._mult(l)},div(l){return this.clone()._div(l)},rotate(l){return this.clone()._rotate(l)},rotateAround(l,i){return this.clone()._rotateAround(l,i)},matMult(l){return this.clone()._matMult(l)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(l){return this.x===l.x&&this.y===l.y},dist(l){return Math.sqrt(this.distSqr(l))},distSqr(l){const i=l.x-this.x,a=l.y-this.y;return i*i+a*a},angle(){return Math.atan2(this.y,this.x)},angleTo(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith(l){return this.angleWithSep(l.x,l.y)},angleWithSep(l,i){return Math.atan2(this.x*i-this.y*l,this.x*l+this.y*i)},_matMult(l){const i=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=i,this},_add(l){return this.x+=l.x,this.y+=l.y,this},_sub(l){return this.x-=l.x,this.y-=l.y,this},_mult(l){return this.x*=l,this.y*=l,this},_div(l){return this.x/=l,this.y/=l,this},_multByPoint(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint(l){return this.x/=l.x,this.y/=l.y,this},_unit(){return this._div(this.mag()),this},_perp(){const l=this.y;return this.y=this.x,this.x=-l,this},_rotate(l){const i=Math.cos(l),a=Math.sin(l),h=a*this.x+i*this.y;return this.x=i*this.x-a*this.y,this.y=h,this},_rotateAround(l,i){const a=Math.cos(l),h=Math.sin(l),d=i.y+h*(this.x-i.x)+a*(this.y-i.y);return this.x=i.x+a*(this.x-i.x)-h*(this.y-i.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:xt},xt.convert=function(l){if(l instanceof xt)return l;if(Array.isArray(l))return new xt(+l[0],+l[1]);if(l.x!==void 0&&l.y!==void 0)return new xt(+l.x,+l.y);throw new Error("Expected [x, y] or {x, y} point format")};const Cr=Math.PI/180,gr=180/Math.PI;function Pe(l){return l*Cr}function q(l){return l*gr}const J=[[0,0],[1,0],[1,1],[0,1]];function oe(l){if(l<=0)return 0;if(l>=1)return 1;const i=l*l,a=i*l;return 4*(l<.5?a:3*(l-i)+a-.75)}function Te(l,i,a,h){const d=new Ta(l,i,a,h);return function(_){return d.solve(_)}}const be=Te(.25,.1,.25,1);function fe(l,i,a){return Math.min(a,Math.max(i,l))}function Ke(l,i,a){return(a=fe((a-l)/(i-l),0,1))*a*(3-2*a)}function ze(l,i,a){const h=a-i,d=((l-i)%h+h)%h+i;return d===i?a:d}function Ze(l,i,a){if(!l.length)return a(null,[]);let h=l.length;const d=new Array(l.length);let _=null;l.forEach((g,b)=>{i(g,(T,S)=>{T&&(_=T),d[b]=S,--h==0&&a(_,d)})})}let yt=1;function lt(){return yt++}function Kt(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log2(l)))}function Qt(l,i){l.forEach(a=>{i[a]&&(i[a]=i[a].bind(i))})}function Ii(l,i,a){const h={};for(const d in l)h[d]=i.call(this,l[d],d,l);return h}function Xi(l,i,a){const h={};for(const d in l)i.call(this,l[d],d,l)&&(h[d]=l[d]);return h}function Oi(l){return Array.isArray(l)?l.map(Oi):typeof l=="object"&&l?Ii(l,Oi):l}function $i(l,i){for(let a=0;a<l.length;a++)if(i.indexOf(l[a])>=0)return!0;return!1}const yr={};function Ji(l){yr[l]||(typeof console<"u"&&console.warn(l),yr[l]=!0)}function In(l,i,a){return(a.y-l.y)*(i.x-l.x)>(i.y-l.y)*(a.x-l.x)}function qr(l){let i=0;for(let a,h,d=0,_=l.length,g=_-1;d<_;g=d++)a=l[d],h=l[g],i+=(h.x-a.x)*(a.y+h.y);return i}function $r([l,i,a]){const h=Pe(i+90),d=Pe(a);return{x:l*Math.cos(h)*Math.sin(d),y:l*Math.sin(h)*Math.sin(d),z:l*Math.cos(d),azimuthal:i,polar:a}}function Tr(l){return(typeof self<"u"||l!==void 0)&&typeof WorkerGlobalScope<"u"&&(l!==void 0?l:self)instanceof WorkerGlobalScope}function br(l){const i={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,h,d,_)=>{const g=d||_;return i[h]=!g||g.toLowerCase(),""}),i["max-age"]){const a=parseInt(i["max-age"],10);isNaN(a)?delete i["max-age"]:i["max-age"]=a}return i}let un=null;function fn(l,i){return[l[4*i],l[4*i+1],l[4*i+2],l[4*i+3]]}function Fr(l,i,a,h){for(;i<a;){const d=i+a>>1;l[d]<h?i=d+1:a=d}return i}function cs(l,i,a,h){for(;i<a;){const d=i+a>>1;l[d]<=h?i=d+1:a=d}return i}function Ms(l){return l>0?1/(1.001-l):1+l}function Ss(l){return l>0?1-1/(1.001-l):-l}function Za(l,i,a){return(l-i.min)*(a.max-a.min)/(i.max-i.min)+a.min}const io={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!io.API_URL)return null;try{const l=new URL(io.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function $c(l){return io.API_URL_REGEX.test(l)}function fp(l){return io.API_SPRITE_REGEX.test(l)}let uc,bu,wu,Tu,hc,Ka;function Ya(){return uc==null&&(uc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),uc}const sa={now:()=>Tu!==void 0?Tu:performance.now(),setNow(l){Tu=l},restoreNow(){Tu=void 0},frame(l){const i=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(l,i=0){const{width:a,height:h}=l;hc||(hc=document.createElement("canvas"));const d=hc.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(a>hc.width||h>hc.height)&&(hc.width=a,hc.height=h),d.clearRect(-i,-i,a+2*i,h+2*i),d.drawImage(l,0,0,a,h),d.getImageData(-i,-i,a+2*i,h+2*i)},resolveURL:l=>(bu||(bu=document.createElement("a")),bu.href=l,bu.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(wu==null&&(wu=window.matchMedia("(prefers-reduced-motion: reduce)")),wu.matches)},hasCanvasFingerprintNoise(){if(Ka!==void 0)return Ka;if(!Ya())return Ka=!1,!1;const l=new OffscreenCanvas(85,1),i=l.getContext("2d",{willReadFrequently:!0});let a=0;for(let d=0;d<l.width;++d)i.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,i.fillRect(d,0,1,1);const h=i.getImageData(0,0,l.width,l.height);a=0;for(let d=0;d<h.data.length;++d)if(d%4!=3&&a++!==h.data[d])return Ka=!0,!0;return Ka=!1,!1}};function Eu(l,i){const a=l.indexOf("?");if(a<0)return`${l}?${new URLSearchParams(i).toString()}`;const h=new URLSearchParams(l.slice(a));for(const d in i)h.set(d,i[d]);return`${l.slice(0,a)}?${h.toString()}`}function Th(l,i={persistentParams:[]}){const a=l.indexOf("?");if(a<0)return l;const h=new URLSearchParams,d=new URLSearchParams(l.slice(a));for(const g of i.persistentParams){const b=d.get(g);b&&h.set(g,b)}const _=h.toString();return`${l.slice(0,a)}${_.length>0?`?${_}`:""}`}const pn="mapbox-tiles";let Go=500,oa=50;const Do=["language","worldview","jobid"];let bo,dc;function pp(){try{return caches}catch{}}function Eh(){const l=pp();l&&bo==null&&(bo=l.open(pn))}let fc=1/0;const Ih={supported:!1,testSupport:function(l){!Ho&&aa&&(Nd?Ja(l):Fl=l)}};let Fl,aa,Ho=!1,Nd=!1;const Sh=typeof self<"u"?self:{};function Ja(l){const i=l.createTexture();l.bindTexture(l.TEXTURE_2D,i);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,aa),l.isContextLost())return;Ih.supported=!0}catch{}l.deleteTexture(i),Ho=!0}Sh.document&&(aa=Sh.document.createElement("img"),aa.onload=function(){Fl&&Ja(Fl),Fl=null,Nd=!0},aa.onerror=function(){Ho=!0,Fl=null},aa.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Bd={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Bd);class mp extends Error{constructor(i,a,h){a===401&&$c(h)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=a,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Vd=Tr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,fr=function(l,i){if(!(/^file:/.test(a=l.url)||/^file:/.test(Vd())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(h,d){const _=new AbortController,g=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Vd(),referrerPolicy:h.referrerPolicy,signal:_.signal});let b=!1,T=!1;const S=(P=g.url).indexOf("sku=")>0&&$c(P);var P;h.type==="json"&&g.headers.set("Accept","application/json");const M=(N,B,W)=>{if(T)return;if(N&&N.message!=="SecurityError"&&Ji(N.toString()),B&&W)return L(B);const X=Date.now();fetch(g).then(Z=>{if(Z.ok){const ne=S?Z.clone():null;return L(Z,ne,X)}return d(new mp(Z.statusText,Z.status,h.url))}).catch(Z=>{Z.name!=="AbortError"&&d(new Error(`${Z.message} ${h.url}`))})},L=(N,B,W)=>{(h.type==="arrayBuffer"?N.arrayBuffer():h.type==="json"?N.json():N.text()).then(X=>{T||(B&&W&&function(Z,ne,se){if(Eh(),bo==null)return;const le=br(ne.headers.get("Cache-Control")||"");if(le["no-store"])return;const Ee={status:ne.status,statusText:ne.statusText,headers:new Headers};ne.headers.forEach((Ne,je)=>Ee.headers.set(je,Ne)),le["max-age"]&&Ee.headers.set("Expires",new Date(se+1e3*le["max-age"]).toUTCString());const Ie=Ee.headers.get("Expires");if(!Ie||new Date(Ie).getTime()-se<42e4)return;let Re=Th(Z.url,{persistentParams:Do});if(ne.status===206){const Ne=Z.headers.get("Range");if(!Ne)return;Ee.status=200,Re=Eu(Re,{range:Ne})}(function(Ne,je){if(dc===void 0)try{new Response(new ReadableStream),dc=!0}catch{dc=!1}dc?je(Ne.body):Ne.blob().then(je).catch(ft=>Ji(ft.message))})(ne,Ne=>{const je=new Response((ft=ne.status)!==200&&ft!==404&&[101,103,204,205,304].includes(ft)?null:Ne,Ee);var ft;Eh(),bo!=null&&bo.then(We=>We.put(Re,je)).catch(We=>Ji(We.message))})}(g,B,W),b=!0,d(null,X,N.headers.get("Cache-Control"),N.headers.get("Expires")))}).catch(X=>{T||d(new Error(X.message))})};return S?function(N,B){if(Eh(),bo==null)return B(null);bo.then(W=>{let X=Th(N.url,{persistentParams:Do});const Z=N.headers.get("Range");Z&&(X=Eu(X,{range:Z})),W.match(X).then(ne=>{const se=function(le){if(!le)return!1;const Ee=new Date(le.headers.get("Expires")||0),Ie=br(le.headers.get("Cache-Control")||"");return Number(Ee)>Date.now()&&!Ie["no-cache"]}(ne);W.delete(X).catch(B),se&&W.put(X,ne.clone()).catch(B),B(null,ne,se)}).catch(B)}).catch(B)}(g,M):M(null,null),{cancel:()=>{T=!0,b||_.abort()}}}(l,i);if(Tr(self)&&self.worker.actor)return self.worker.actor.send("getResource",l,i,void 0,!0)}var a;return function(h,d){const _=new XMLHttpRequest;_.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(_.responseType="arraybuffer");for(const g in h.headers)_.setRequestHeader(g,h.headers[g]);return h.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=h.credentials==="include",_.onerror=()=>{d(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let g=_.response;if(h.type==="json")try{g=JSON.parse(_.response)}catch(b){return d(b)}d(null,g,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else d(new mp(_.statusText,_.status,h.url))},_.send(h.body),{cancel:()=>_.abort()}}(l,i)},Iu=function(l,i){return fr(Object.assign(l,{type:"arrayBuffer"}),i)};function Jm(l){const i=document.createElement("a");return i.href=l,i.protocol===location.protocol&&i.host===location.host}const Ah="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Gc,zl;Gc=[],zl=0;const bl=function(l,i){if(Ih.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),zl>=io.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:l,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Gc.push(_),_}zl++;let a=!1;const h=()=>{if(!a)for(a=!0,zl--;Gc.length&&zl<io.MAX_PARALLEL_IMAGE_REQUESTS;){const _=Gc.shift(),{requestParameters:g,callback:b,cancelled:T}=_;T||(_.cancel=bl(g,b).cancel)}},d=Iu(l,(_,g,b,T)=>{h(),_?i(_):g&&(self.createImageBitmap?function(S,P){const M=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(M).then(L=>{P(null,L)}).catch(L=>{P(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(S,P)=>i(S,P,b,T)):function(S,P){const M=new Image;M.onload=()=>{P(null,M),URL.revokeObjectURL(M.src),M.onload=null,requestAnimationFrame(()=>{M.src=Ah})},M.onerror=()=>P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new Blob([new Uint8Array(S)],{type:"image/png"});M.src=S.byteLength?URL.createObjectURL(L):Ah}(g,(S,P)=>i(S,P,b,T)))});return{cancel:()=>{d.cancel(),h()}}};var Nl,Ch,Ud,ts={exports:{}},Qm={exports:{}},_p={exports:{}},Hc=function(){if(Ud)return ts.exports;Ud=1;var l=(Nl||(Nl=1,Qm.exports=function(a,h){var d,_,g,b,T,S,P,M;for(_=a.length-(d=3&a.length),g=h,T=3432918353,S=461845907,M=0;M<_;)P=255&a.charCodeAt(M)|(255&a.charCodeAt(++M))<<8|(255&a.charCodeAt(++M))<<16|(255&a.charCodeAt(++M))<<24,++M,g=27492+(65535&(b=5*(65535&(g=(g^=P=(65535&(P=(P=(65535&P)*T+(((P>>>16)*T&65535)<<16)&4294967295)<<15|P>>>17))*S+(((P>>>16)*S&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(P=0,d){case 3:P^=(255&a.charCodeAt(M+2))<<16;case 2:P^=(255&a.charCodeAt(M+1))<<8;case 1:g^=P=(65535&(P=(P=(65535&(P^=255&a.charCodeAt(M)))*T+(((P>>>16)*T&65535)<<16)&4294967295)<<15|P>>>17))*S+(((P>>>16)*S&65535)<<16)&4294967295}return g^=a.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),Qm.exports),i=(Ch||(Ch=1,_p.exports=function(a,h){for(var d,_=a.length,g=h^_,b=0;_>=4;)d=1540483477*(65535&(d=255&a.charCodeAt(b)|(255&a.charCodeAt(++b))<<8|(255&a.charCodeAt(++b))<<16|(255&a.charCodeAt(++b))<<24))+((1540483477*(d>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),_-=4,++b;switch(_){case 3:g^=(255&a.charCodeAt(b+2))<<16;case 2:g^=(255&a.charCodeAt(b+1))<<8;case 1:g=1540483477*(65535&(g^=255&a.charCodeAt(b)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),_p.exports);return ts.exports=l,ts.exports.murmur3=l,ts.exports.murmur2=i,ts.exports}(),Rh=eo(Hc);class Ea{constructor(i,...a){Object.assign(this,a[0]||{}),this.type=i}}class pc extends Ea{constructor(i,a={}){super("error",Object.assign({error:i},a))}}function Ph(l,i,a){a[l]&&a[l].indexOf(i)!==-1||(a[l]=a[l]||[],a[l].push(i))}function Vs(l,i,a){if(a&&a[l]){const h=a[l].indexOf(i);h!==-1&&a[l].splice(h,1)}}class mc{on(i,a){return this._listeners=this._listeners||{},Ph(i,a,this._listeners),this}off(i,a){return Vs(i,a,this._listeners),Vs(i,a,this._oneTimeListeners),this}once(i,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Ph(i,a,this._oneTimeListeners),this):new Promise(h=>{this.once(i,h)})}fire(i,a){const h=typeof i=="string"?new Ea(i,a):i,d=h.type;if(this.listens(d)){h.target=this;const _=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const T of _)T.call(this,h);const g=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const T of g)Vs(d,T,this._oneTimeListeners),T.call(this,h);const b=this._eventedParent;if(b){const T=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(h,T),b.fire(h)}}else h instanceof pc&&console.error(h.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,a){return this._eventedParent=i,this._eventedParentData=a,this}}class la{constructor(i){typeof i=="string"?this.name=i:(this.name=i.name,this.iconsetId=i.iconsetId)}static from(i){return new la(i)}static toString(i){return i.iconsetId?`${i.name}${i.iconsetId}`:i.name}static parse(i){const[a,h]=i.split("");return new la({name:a,iconsetId:h})}static isEqual(i,a){return i.name===a.name&&i.iconsetId===a.iconsetId}toString(){return la.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var qc,Mh={},kh=function(){if(qc)return Mh;qc=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(_){return(_=Math.round(_))<0?0:_>255?255:_}function a(_){return i(_[_.length-1]==="%"?parseFloat(_)/100*255:parseInt(_))}function h(_){return(g=_[_.length-1]==="%"?parseFloat(_)/100:parseFloat(_))<0?0:g>1?1:g;var g}function d(_,g,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?_+(g-_)*b*6:2*b<1?g:3*b<2?_+(g-_)*(2/3-b)*6:_}try{Mh.parseCSSColor=function(_){var g,b=_.replace(/ /g,"").toLowerCase();if(b in l)return l[b].slice();if(b[0]==="#")return b.length===4?(g=parseInt(b.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:b.length===7&&(g=parseInt(b.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var T=b.indexOf("("),S=b.indexOf(")");if(T!==-1&&S+1===b.length){var P=b.substr(0,T),M=b.substr(T+1,S-(T+1)).split(","),L=1;switch(P){case"rgba":if(M.length!==4)return null;L=h(M.pop());case"rgb":return M.length!==3?null:[a(M[0]),a(M[1]),a(M[2]),L];case"hsla":if(M.length!==4)return null;L=h(M.pop());case"hsl":if(M.length!==3)return null;var N=(parseFloat(M[0])%360+360)%360/360,B=h(M[1]),W=h(M[2]),X=W<=.5?W*(B+1):W+B-W*B,Z=2*W-X;return[i(255*d(Z,X,N+1/3)),i(255*d(Z,X,N)),i(255*d(Z,X,N-1/3)),L];default:return null}}return null}}catch{}return Mh}();class Mr{constructor(i,a,h,d=1){this.r=i,this.g=a,this.b=h,this.a=d}static parse(i){if(!i)return;if(i instanceof Mr)return i;if(typeof i!="string")return;const a=kh.parseCSSColor(i);return a?new Mr(a[0]/255,a[1]/255,a[2]/255,a[3]):void 0}toString(){const[i,a,h,d]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*i)},${Math.round(255*a)},${Math.round(255*h)},${d})`}toNonPremultipliedRenderColor(i){const{r:a,g:h,b:d,a:_}=this;return new Dh(i,a,h,d,_)}toPremultipliedRenderColor(i){const{r:a,g:h,b:d,a:_}=this;return new $d(i,a*_,h*_,d*_,_)}clone(){return new Mr(this.r,this.g,this.b,this.a)}}class jd{constructor(i,a,h,d,_,g=!1){if(this.premultiplied=!1,this.premultiplied=g,i){const b=i.image.height,T=b*b;this.premultiplied?(a=_===0?0:a/_*(b-1),h=_===0?0:h/_*(b-1),d=_===0?0:d/_*(b-1)):(a*=b-1,h*=b-1,d*=b-1);const S=Math.floor(a),P=Math.floor(h),M=Math.floor(d),L=Math.ceil(a),N=Math.ceil(h),B=Math.ceil(d),W=a-S,X=h-P,Z=d-M,ne=i.image.data,se=4*(S+P*T+M*b),le=4*(S+P*T+B*b),Ee=4*(S+N*T+M*b),Ie=4*(S+N*T+B*b),Re=4*(L+P*T+M*b),Ne=4*(L+P*T+B*b),je=4*(L+N*T+M*b),ft=4*(L+N*T+B*b);if(se<0||ft>=ne.length)throw new Error("out of range");this.r=Ri(Ri(Ri(ne[se],ne[le],Z),Ri(ne[Ee],ne[Ie],Z),X),Ri(Ri(ne[Re],ne[Ne],Z),Ri(ne[je],ne[ft],Z),X),W)/255*(this.premultiplied?_:1),this.g=Ri(Ri(Ri(ne[se+1],ne[le+1],Z),Ri(ne[Ee+1],ne[Ie+1],Z),X),Ri(Ri(ne[Re+1],ne[Ne+1],Z),Ri(ne[je+1],ne[ft+1],Z),X),W)/255*(this.premultiplied?_:1),this.b=Ri(Ri(Ri(ne[se+2],ne[le+2],Z),Ri(ne[Ee+2],ne[Ie+2],Z),X),Ri(Ri(ne[Re+2],ne[Ne+2],Z),Ri(ne[je+2],ne[ft+2],Z),X),W)/255*(this.premultiplied?_:1),this.a=_}else this.r=a,this.g=h,this.b=d,this.a=_}toArray(){const{r:i,g:a,b:h,a:d}=this;return[255*i,255*a,255*h,d]}toHslaArray(){let{r:i,g:a,b:h,a:d}=this;if(this.premultiplied){if(d===0)return[0,0,0,0];const B=1/d;i*=B,a*=B,h*=B}const _=Math.min(Math.max(i,0),1),g=Math.min(Math.max(a,0),1),b=Math.min(Math.max(h,0),1),T=Math.min(_,g,b),S=Math.max(_,g,b),P=S-T,M=.5*(T+S);if(P===0)return[0,0,100*M,d];const L=M>.5?P/(2-S-T):P/(S+T);let N;switch(S){case _:N=60*((g-b)/P+(g<b?6:0));break;case g:N=60*((b-_)/P+2);break;default:N=60*((_-g)/P+4)}return[N,100*L,100*M,d]}toArray01(){const{r:i,g:a,b:h,a:d}=this;return[i,a,h,d]}toArray01Scaled(i){const{r:a,g:h,b:d}=this;return[a*i,h*i,d*i]}toArray01Linear(){const{r:i,g:a,b:h,a:d}=this;return[Math.pow(i,2.2),Math.pow(a,2.2),Math.pow(h,2.2),d]}}class Dh extends jd{constructor(i,a,h,d,_){super(i,a,h,d,_,!1)}}class $d extends jd{constructor(i,a,h,d,_){super(i,a,h,d,_,!0)}}function Ri(l,i,a){return l*(1-a)+i*a}function Wc(l,i,a){return l.map((h,d)=>Ri(h,i[d],a))}Mr.black=new Mr(0,0,0,1),Mr.white=new Mr(1,1,1,1),Mr.transparent=new Mr(0,0,0,0),Mr.red=new Mr(1,0,0,1),Mr.blue=new Mr(0,0,1,1);var qo=Object.freeze({__proto__:null,array:Wc,color:function(l,i,a){return new Mr(Ri(l.r,i.r,a),Ri(l.g,i.g,a),Ri(l.b,i.b,a),Ri(l.a,i.a,a))},number:Ri});class Ia extends Error{constructor(i,a){super(a),this.message=a,this.key=i}}class Su{constructor(i,a=[]){this.parent=i,this.bindings={};for(const[h,d]of a)this.bindings[h]=d}concat(i){return new Su(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Sa={kind:"null"},hi={kind:"number"},kr={kind:"string"},Gr={kind:"boolean"},Lo={kind:"color"},ca={kind:"object"},Dr={kind:"value"},Lh={kind:"collator"},Bl={kind:"formatted"},Au={kind:"resolvedImage"};function qs(l,i){return{kind:"array",itemType:l,N:i}}function _n(l){if(l.kind==="array"){const i=_n(l.itemType);return typeof l.N=="number"?`array<${i}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${i}>`}return l.kind}const e_=[Sa,hi,kr,Gr,Lo,Bl,ca,qs(Dr),Au];function Cu(l,i){if(i.kind==="error")return null;if(l.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Cu(l.itemType,i.itemType))&&(typeof l.N!="number"||l.N===i.N))return null}else{if(l.kind===i.kind)return null;if(l.kind==="value"){for(const a of e_)if(!Cu(a,i))return null}}return`Expected ${_n(l)} but found ${_n(i)} instead.`}function _c(l,i){return i.some(a=>a.kind===l.kind)}function k(l,i){return i.some(a=>a==="null"?l===null:a==="array"?Array.isArray(l):a==="object"?l&&!Array.isArray(l)&&typeof l=="object":a===typeof l)}function Y(l,i){return l.kind==="array"&&i.kind==="array"?l.N===i.N&&Y(l.itemType,i.itemType):l.kind===i.kind}class re{constructor(i,a,h){this.sensitivity=i?a?"variant":"case":a?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,a){return this.collator.compare(i,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ae{constructor(i,a,h,d,_){this.text=i.normalize?i.normalize():i,this.image=a,this.scale=h,this.fontStack=d,this.textColor=_}}class _t{constructor(i){this.sections=i}static fromString(i){return new _t([new Ae(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||!!i.image&&i.image.hasPrimary())}static factory(i){return i instanceof _t?i:_t.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const a of this.sections){if(a.image){const d=a.image.getPrimary().id.toString();i.push(["image",d]);continue}i.push(a.text);const h={};a.fontStack&&(h["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(h["font-scale"]=a.scale),a.textColor&&(h["text-color"]=["rgba"].concat(a.textColor.toNonPremultipliedRenderColor(null).toArray())),i.push(h)}return i}}class zt{constructor(i,a={}){if(this.id=la.from(i),this.options=Object.assign({},a),a.transform){const{a:h,b:d,c:_,d:g,e:b,f:T}=a.transform;this.options.transform=new DOMMatrix([h,d,_,g,b,T])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:i,b:a,c:h,d,e:_,f:g}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:i,b:a,c:h,d,e:_,f:g}})}static parse(i){let a,h,d,_;try{({name:a,iconsetId:h,params:d,transform:_}=JSON.parse(i)||{})}catch{return null}if(!a)return null;const{a:g,b,c:T,d:S,e:P,f:M}=_||{};return new zt({name:a,iconsetId:h},{params:d,transform:new DOMMatrix([g,b,T,S,P,M])})}scaleSelf(i,a){return this.options.transform.scaleSelf(i,a),this}}class _i{constructor(i,a,h,d,_=!1){this.primaryId=la.from(i),this.primaryOptions=a,h&&(this.secondaryId=la.from(h)),this.secondaryOptions=d,this.available=_}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new zt(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new zt(this.secondaryId,this.secondaryOptions):null}static from(i){return typeof i=="string"?_i.build({name:i}):i}static build(i,a,h,d){return!i||typeof i=="object"&&!("name"in i)?null:new _i(i,h,a,d)}}function is(l,i,a,h){return typeof l=="number"&&l>=0&&l<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof a=="number"&&a>=0&&a<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[l,i,a,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[l,i,a,h]:[l,i,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ks(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Mr||l instanceof re||l instanceof _t||l instanceof _i)return!0;if(Array.isArray(l)){for(const i of l)if(!ks(i))return!1;return!0}if(typeof l=="object"){for(const i in l)if(!ks(l[i]))return!1;return!0}return!1}function Er(l){if(l===null)return Sa;if(typeof l=="string")return kr;if(typeof l=="boolean")return Gr;if(typeof l=="number")return hi;if(l instanceof Mr)return Lo;if(l instanceof re)return Lh;if(l instanceof _t)return Bl;if(l instanceof _i)return Au;if(Array.isArray(l)){const i=l.length;let a;for(const h of l){const d=Er(h);if(a){if(a===d)continue;a=Dr;break}a=d}return qs(a||Dr,i)}return ca}function qn(l){const i=typeof l;return l===null?"":i==="string"||i==="number"||i==="boolean"?String(l):l instanceof _t||l instanceof _i||l instanceof Mr?l.toString():JSON.stringify(l)}class Di{constructor(i,a){this.type=i,this.value=a}static parse(i,a){if(i.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!ks(i[1]))return a.error("invalid value");const h=i[1];let d=Er(h);const _=a.expectedType;return d.kind!=="array"||d.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(d=_),new Di(d,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Mr?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof _t?this.value.serialize():this.value}}class Gt{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const Oo={string:kr,number:hi,boolean:Gr,object:ca};class Pi{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");let h,d=1;const _=i[0];if(_==="array"){let b,T;if(i.length>2){const S=i[1];if(typeof S!="string"||!(S in Oo)||S==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);b=Oo[S],d++}else b=Dr;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return a.error('The length argument to "array" must be a positive integer literal',2);T=i[2],d++}h=qs(b,T)}else h=Oo[_];const g=[];for(;d<i.length;d++){const b=a.parse(i[d],d,Dr);if(!b)return null;g.push(b)}return new Pi(h,g)}evaluate(i){for(let a=0;a<this.args.length;a++){const h=this.args[a].evaluate(i);if(!Cu(this.type,Er(h)))return h;if(a===this.args.length-1)throw new Gt(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${_n(Er(h))} but was expected to be of type ${_n(this.type)}.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,a=[i.kind];if(i.kind==="array"){const h=i.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){a.push(h.kind);const d=i.N;(typeof d=="number"||this.args.length>1)&&a.push(d)}}return a.concat(this.args.map(h=>h.serialize()))}}class Vl{constructor(i){this.type=Bl,this.sections=i}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const h=i[1];if(!Array.isArray(h)&&typeof h=="object")return a.error("First argument must be an image or text section.");const d=[];let _=!1;for(let g=1;g<=i.length-1;++g){const b=i[g];if(_&&typeof b=="object"&&!Array.isArray(b)){_=!1;let T=null;if(b["font-scale"]&&(T=a.parseObjectValue(b["font-scale"],g,"font-scale",hi),!T))return null;let S=null;if(b["text-font"]&&(S=a.parseObjectValue(b["text-font"],g,"text-font",qs(kr)),!S))return null;let P=null;if(b["text-color"]&&(P=a.parseObjectValue(b["text-color"],g,"text-color",Lo),!P))return null;const M=d[d.length-1];M.scale=T,M.font=S,M.textColor=P}else{const T=a.parse(i[g],g,Dr);if(!T)return null;const S=T.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,d.push({content:T,scale:null,font:null,textColor:null})}}return new Vl(d)}evaluate(i){return new _t(this.sections.map(a=>{const h=a.content.evaluate(i);return Y(Er(h),Au)?new Ae("",h,null,null,null):new Ae(qn(h),null,a.scale?a.scale.evaluate(i):null,a.font?a.font.evaluate(i).join(","):null,a.textColor?a.textColor.evaluate(i):null)}))}eachChild(i){for(const a of this.sections)i(a.content),a.scale&&i(a.scale),a.font&&i(a.font),a.textColor&&i(a.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const a of this.sections){i.push(a.content.serialize());const h={};a.scale&&(h["font-scale"]=a.scale.serialize()),a.font&&(h["text-font"]=a.font.serialize()),a.textColor&&(h["text-color"]=a.textColor.serialize()),i.push(h)}return i}}class Gd{constructor(i,a,h,d){this._imageWarnHistory={},this.type=Au,this.namePrimary=i,this.nameSecondary=a,h&&(this.paramsPrimary=h.params,this.iconsetIdPrimary=h.iconset?h.iconset.id:void 0),d&&(this.paramsSecondary=d.params,this.iconsetIdSecondary=d.iconset?d.iconset.id:void 0)}static parse(i,a){if(i.length<2)return a.error("Expected two or more arguments.");let h=1;const d=[];function _(){if(h<i.length){const b=a.parse(i[h],h++,kr);return b?(d.push({image:b,options:{}}),!0):(a.error(d.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(h<i.length){const T=i[h];if((b=T)===null||typeof b!="object"||Array.isArray(b))return!0;const S=T.params,P=T.iconset,M=a.concat(h);if(!S&&!P)return h++,!0;if(S){if(typeof S!="object"||S.constructor!==Object)return M.error('Image options "params" should be an object'),!1;const L={},N=M.concat(void 0,"params");for(const B in S){if(!B)return N.error("Image parameter name should be non-empty"),!1;const W=N.concat(void 0,B).parse(S[B],void 0,Lo,void 0,{typeAnnotation:"coerce"});if(!W)return!1;L[B]=W}d[d.length-1].options.params=L}if(P){if(typeof P!="object"||P.constructor!==Object)return M.error('Image options "iconset" should be an object'),!1;if(!P.id)return M.error('Image options "iconset" should have an "id" property'),!1;d[d.length-1].options.iconset=P}return h++,!0}var b;return!0}for(let b=0;b<2;b++)if(!_()||!g())return;return new Gd(d[0].image,d[1]?d[1].image:void 0,d[0].options,d[1]?d[1].options:void 0)}evaluateParams(i,a){const h={};if(a){for(const d in a)if(a[d])try{h[d]=a[d].evaluate(i)}catch{continue}if(Object.keys(h).length!==0)return{params:h}}}evaluate(i){const a={name:this.namePrimary.evaluate(i),iconsetId:this.iconsetIdPrimary},h=this.nameSecondary?{name:this.nameSecondary.evaluate(i),iconsetId:this.iconsetIdSecondary}:void 0,d=_i.build(a,h,this.paramsPrimary?this.evaluateParams(i,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(i,this.paramsSecondary):void 0);if(d&&i.availableImages){const _=d.getPrimary().id;if(d.available=i.availableImages.some(g=>la.isEqual(g,_)),d.available){const g=d.getSecondary()?d.getSecondary().id:null;g&&(d.available=i.availableImages.some(b=>la.isEqual(b,g)))}}return d}eachChild(i){if(i(this.namePrimary),this.paramsPrimary)for(const a in this.paramsPrimary)this.paramsPrimary[a]&&i(this.paramsPrimary[a]);if(this.nameSecondary&&(i(this.nameSecondary),this.paramsSecondary))for(const a in this.paramsSecondary)this.paramsSecondary[a]&&i(this.paramsSecondary[a])}outputDefined(){return!1}serializeOptions(i,a){const h={};if(a&&(h.iconset={id:a}),i){h.params={};for(const d in i)i[d]&&(h.params[d]=i[d].serialize())}return Object.keys(h).length>0?h:void 0}serialize(){const i=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const a=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);a&&i.push(a)}if(this.nameSecondary&&(i.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const a=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);a&&i.push(a)}return i}}function Bi(l){return gp(l)?"string":yp(l)?"number":Y0(l)?"boolean":Array.isArray(l)?"array":l===null?"null":K0(l)?"object":typeof l}function K0(l){return l!=null&&!Array.isArray(l)&&typeof l!="function"&&!(l instanceof String||l instanceof Number||l instanceof Boolean)&&typeof l=="object"}function gp(l){return typeof l=="string"||l instanceof String}function yp(l){return typeof l=="number"||l instanceof Number}function Y0(l){return typeof l=="boolean"||l instanceof Boolean}const t_={"to-boolean":Gr,"to-color":Lo,"to-number":hi,"to-string":kr};class bs{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const h=i[0],d=[];let _=Sa;if(h==="to-array"){if(!Array.isArray(i[1]))return null;const g=i[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);_=qs(a.expectedType.itemType,g)}else{if(!(g>0&&ks(i[1][0])))return null;_=qs(Er(i[1][0]),g)}for(let b=0;b<g;b++){const T=i[1][b];let S;if(Array.isArray(T))S=a.parse(T,void 0,_.itemType);else{const P=Bi(T);if(P!==_.itemType.kind)return a.error(`Expected ${_.itemType.kind} but found ${P}.`);S=a.registry.literal.parse(["literal",T===void 0?null:T],a)}if(!S)return null;d.push(S)}}else{if((h==="to-boolean"||h==="to-string")&&i.length!==2)return a.error("Expected one argument.");_=t_[h];for(let g=1;g<i.length;g++){const b=a.parse(i[g],g,Dr);if(!b)return null;d.push(b)}}return new bs(_,d)}evaluate(i){if(this.type.kind==="boolean")return!!this.args[0].evaluate(i);if(this.type.kind==="color"){let a,h;for(const d of this.args){if(a=d.evaluate(i),h=null,a instanceof Mr)return a;if(typeof a=="string"){const _=i.parseColor(a);if(_)return _}else if(Array.isArray(a)&&(h=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:is(a[0],a[1],a[2],a[3]),!h))return new Mr(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Gt(h||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const h of this.args){if(a=h.evaluate(i),a===null)return 0;const d=Number(a);if(!isNaN(d))return d}throw new Gt(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?_t.fromString(qn(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?_i.build(qn(this.args[0].evaluate(i))):this.type.kind==="array"?this.args.map(a=>a.evaluate(i)):qn(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Vl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Gd(this.args[0]).serialize();const i=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{i.push(a.serialize())}),i}}const J0=["Unknown","Point","LineString","Polygon"];class Xc{constructor(i,a,h){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=i,this.options=a,this.iconImageUseTheme=h}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?J0[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(i){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:h,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(h*a-i[0])+this.featureDistanceData.bearing[1]*(d*a-i[1])}return 0}parseColor(i){let a=this._parseColorCache[i];return a||(a=this._parseColorCache[i]=Mr.parse(i)),a}getConfig(i){return this.options?this.options.get(i):null}}class Wo{constructor(i,a,h,d,_){this.name=i,this.type=a,this._evaluate=h,this.args=d,this._overloadIndex=_}evaluate(i){if(!this._evaluate){const a=Wo.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,a){const h=i[0],d=Wo.definitions[h];if(!d)return a.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(d)?d[0]:d.type,g=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,b=[];let T=null,S=-1;for(const[P,M]of g){if(Array.isArray(P)&&P.length!==i.length-1)continue;b.push(P),S++,T=new __(a.registry,a.path,null,a.scope,void 0,a._scope,a.options,a.iconImageUseTheme);const L=[];let N=!1;for(let B=1;B<i.length;B++){const W=i[B],X=Array.isArray(P)?P[B-1]:P.type,Z=T.parse(W,1+L.length,X);if(!Z){N=!0;break}L.push(Z)}if(!N)if(Array.isArray(P)&&P.length!==L.length)T.error(`Expected ${P.length} arguments, but found ${L.length} instead.`);else{for(let B=0;B<L.length;B++){const W=Array.isArray(P)?P[B]:P.type,X=L[B];T.concat(B+1).checkSubtype(W,X.type)}if(T.errors.length===0)return new Wo(h,_,M,L,S)}}if(b.length===1)a.errors.push(...T.errors);else{const P=(b.length?b:g.map(([L])=>L)).map(Ru).join(" | "),M=[];for(let L=1;L<i.length;L++){const N=a.parse(i[L],1+M.length);if(!N)return null;M.push(_n(N.type))}a.error(`Expected arguments of type ${P}, but found (${M.join(", ")}) instead.`)}return null}static register(i,a){Wo.definitions=a;for(const h in a)i[h]=Wo}}function Ru(l){return Array.isArray(l)?`(${l.map(_n).join(", ")})`:`(${_n(l.type)}...)`}class po{constructor(i,a,h){this.type=Lh,this.locale=h,this.caseSensitive=i,this.diacriticSensitive=a}static parse(i,a){if(i.length!==2)return a.error("Expected one argument.");const h=i[1];if(typeof h!="object"||Array.isArray(h))return a.error("Collator options argument must be an object.");const d=h["case-sensitive"]===void 0?a.parse(!1,1,Gr):a.parseObjectValue(h["case-sensitive"],1,"case-sensitive",Gr);if(!d)return null;const _=h["diacritic-sensitive"]===void 0?a.parse(!1,1,Gr):a.parseObjectValue(h["diacritic-sensitive"],1,"diacritic-sensitive",Gr);if(!_)return null;let g=null;return h.locale&&(g=a.parseObjectValue(h.locale,1,"locale",kr),!g)?null:new po(d,_,g)}evaluate(i){return new re(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}function qx(l,i,a=0,h=l.length-1,d=HE){for(;h>a;){if(h-a>600){const T=h-a+1,S=i-a+1,P=Math.log(T),M=.5*Math.exp(2*P/3),L=.5*Math.sqrt(P*M*(T-M)/T)*(S-T/2<0?-1:1);qx(l,i,Math.max(a,Math.floor(i-S*M/T+L)),Math.min(h,Math.floor(i+(T-S)*M/T+L)),d)}const _=l[i];let g=a,b=h;for(vp(l,a,i),d(l[h],_)>0&&vp(l,a,h);g<b;){for(vp(l,g,b),g++,b--;d(l[g],_)<0;)g++;for(;d(l[b],_)>0;)b--}d(l[a],_)===0?vp(l,a,b):(b++,vp(l,b,h)),b<=i&&(a=b+1),i<=b&&(h=b-1)}}function vp(l,i,a){const h=l[i];l[i]=l[a],l[a]=h}function HE(l,i){return l<i?-1:l>i?1:0}function i_(l){let i=0;for(let a,h,d=0,_=l.length,g=_-1;d<_;g=d++)a=l[d],h=l[g],i+=(h.x-a.x)*(a.y+h.y);return i}function Hd(l,i){l[0]=Math.min(l[0],i[0]),l[1]=Math.min(l[1],i[1]),l[2]=Math.max(l[2],i[0]),l[3]=Math.max(l[3],i[1])}function Ul(l,i){return!(l[0]<=i[0]||l[2]>=i[2]||l[1]<=i[1]||l[3]>=i[3])}function qE(l,i,a){const h=l[0]-i[0],d=l[1]-i[1],_=l[0]-a[0],g=l[1]-a[1];return h*g-_*d==0&&h*_<=0&&d*g<=0}function qd(l,i,a=!1){let h=!1;for(let b=0,T=i.length;b<T;b++){const S=i[b];for(let P=0,M=S.length,L=M-1;P<M;L=P++){const N=S[L],B=S[P];if(qE(l,N,B))return a;(_=N)[1]>(d=l)[1]!=(g=B)[1]>d[1]&&d[0]<(g[0]-_[0])*(d[1]-_[1])/(g[1]-_[1])+_[0]&&(h=!h)}}var d,_,g;return h}function Wx(l,i,a,h){const d=h[0]-a[0],_=h[1]-a[1],g=(l[0]-a[0])*_-d*(l[1]-a[1]),b=(i[0]-a[0])*_-d*(i[1]-a[1]);return g>0&&b<0||g<0&&b>0}function r_(l,i,a,h){return(d=[h[0]-a[0],h[1]-a[1]])[0]*(_=[i[0]-l[0],i[1]-l[1]])[1]-d[1]*_[0]!=0&&!(!Wx(l,i,a,h)||!Wx(a,h,l,i));var d,_}function n_(l){const i=new xt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new xt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const h of l[0])i.x>h.x&&(i.x=h.x),i.y>h.y&&(i.y=h.y),a.x<h.x&&(a.x=h.x),a.y<h.y&&(a.y=h.y);return{min:i,max:a}}const Pu=8192;function Oh(l,i){const a=(180+l[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,d=Math.pow(2,i.z);return[Math.round(a*d*Pu),Math.round(h*d*Pu)]}function WE(l,i){for(let a=0;a<i.length;a++)if(qd(l,i[a]))return!0;return!1}function XE(l,i,a){for(const h of a)for(let d=0,_=h.length,g=_-1;d<_;g=d++)if(r_(l,i,h[g],h[d]))return!0;return!1}function s_(l,i){for(let a=0;a<l.length;++a)if(!qd(l[a],i))return!1;for(let a=0;a<l.length-1;++a)if(XE(l[a],l[a+1],i))return!1;return!0}function Xx(l,i){for(let a=0;a<i.length;a++)if(s_(l,i[a]))return!0;return!1}function o_(l,i,a){const h=[];for(let d=0;d<l.length;d++){const _=[];for(let g=0;g<l[d].length;g++){const b=Oh(l[d][g],a);Hd(i,b),_.push(b)}h.push(_)}return h}function wl(l,i,a){const h=[];for(let d=0;d<l.length;d++){const _=o_(l[d],i,a);h.push(_)}return h}function Zx(l,i,a,h){if(l[0]<a[0]||l[0]>a[2]){const d=.5*h;let _=l[0]-a[0]>d?-h:a[0]-l[0]>d?h:0;_===0&&(_=l[0]-a[2]>d?-h:a[2]-l[0]>d?h:0),l[0]+=_}Hd(i,l)}function Kx(l,i,a,h){const d=Math.pow(2,h.z)*Pu,_=[h.x*Pu,h.y*Pu],g=[];if(!l)return g;for(const b of l)for(const T of b){const S=[T.x+_[0],T.y+_[1]];Zx(S,i,a,d),g.push(S)}return g}function Yx(l,i,a,h){const d=Math.pow(2,h.z)*Pu,_=[h.x*Pu,h.y*Pu],g=[];if(!l)return g;for(const T of l){const S=[];for(const P of T){const M=[P.x+_[0],P.y+_[1]];Hd(i,M),S.push(M)}g.push(S)}if(i[2]-i[0]<=d/2){(b=i)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const T of g)for(const S of T)Zx(S,i,a,d)}var b;return g}class Fh{constructor(i,a){this.type=Gr,this.geojson=i,this.geometries=a}static parse(i,a){if(i.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(ks(i[1])){const h=i[1];if(h.type==="FeatureCollection")for(let d=0;d<h.features.length;++d){const _=h.features[d].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Fh(h,h.features[d].geometry)}else if(h.type==="Feature"){const d=h.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Fh(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Fh(h,h)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(a,h){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],g=a.canonicalID();if(!g)return!1;if(h.type==="Polygon"){const b=o_(h.coordinates,_,g),T=Kx(a.geometry(),d,_,g);if(!Ul(d,_))return!1;for(const S of T)if(!qd(S,b))return!1}if(h.type==="MultiPolygon"){const b=wl(h.coordinates,_,g),T=Kx(a.geometry(),d,_,g);if(!Ul(d,_))return!1;for(const S of T)if(!WE(S,b))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(a,h){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],g=a.canonicalID();if(!g)return!1;if(h.type==="Polygon"){const b=o_(h.coordinates,_,g),T=Yx(a.geometry(),d,_,g);if(!Ul(d,_))return!1;for(const S of T)if(!s_(S,b))return!1}if(h.type==="MultiPolygon"){const b=wl(h.coordinates,_,g),T=Yx(a.geometry(),d,_,g);if(!Ul(d,_))return!1;for(const S of T)if(!Xx(S,b))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const xp={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Q0=1/298.257223563,ey=Q0*(2-Q0),Wd=Math.PI/180;class Xd{static fromTile(i,a,h){const d=Math.PI*(1-2*(i+.5)/Math.pow(2,a)),_=Math.atan(.5*(Math.exp(d)-Math.exp(-d)))/Wd;return new Xd(_,h)}static get units(){return xp}constructor(i,a){if(i===void 0)throw new Error("No latitude given.");if(a&&!xp[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(xp).join(", ")}`);const h=6378.137*Wd*(a?xp[a]:1),d=Math.cos(i*Wd),_=1/(1-ey*(1-d*d)),g=Math.sqrt(_);this.kx=h*g*d,this.ky=h*g*_*(1-ey)}distance(i,a){const h=Qa(i[0]-a[0])*this.kx,d=(i[1]-a[1])*this.ky;return Math.sqrt(h*h+d*d)}bearing(i,a){const h=Qa(a[0]-i[0])*this.kx;return Math.atan2(h,(a[1]-i[1])*this.ky)/Wd}destination(i,a,h){const d=h*Wd;return this.offset(i,Math.sin(d)*a,Math.cos(d)*a)}offset(i,a,h){return[i[0]+a/this.kx,i[1]+h/this.ky]}lineDistance(i){let a=0;for(let h=0;h<i.length-1;h++)a+=this.distance(i[h],i[h+1]);return a}area(i){let a=0;for(let h=0;h<i.length;h++){const d=i[h];for(let _=0,g=d.length,b=g-1;_<g;b=_++)a+=Qa(d[_][0]-d[b][0])*(d[_][1]+d[b][1])*(h?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(i,a){let h=0;if(a<=0)return i[0];for(let d=0;d<i.length-1;d++){const _=i[d],g=i[d+1],b=this.distance(_,g);if(h+=b,h>a)return a_(_,g,(a-(h-b))/b)}return i[i.length-1]}pointToSegmentDistance(i,a,h){let[d,_]=a,g=Qa(h[0]-d)*this.kx,b=(h[1]-_)*this.ky;if(g!==0||b!==0){const T=(Qa(i[0]-d)*this.kx*g+(i[1]-_)*this.ky*b)/(g*g+b*b);T>1?(d=h[0],_=h[1]):T>0&&(d+=g/this.kx*T,_+=b/this.ky*T)}return g=Qa(i[0]-d)*this.kx,b=(i[1]-_)*this.ky,Math.sqrt(g*g+b*b)}pointOnLine(i,a){let h=1/0,d=i[0][0],_=i[0][1],g=0,b=0;for(let T=0;T<i.length-1;T++){let S=i[T][0],P=i[T][1],M=Qa(i[T+1][0]-S)*this.kx,L=(i[T+1][1]-P)*this.ky,N=0;M===0&&L===0||(N=(Qa(a[0]-S)*this.kx*M+(a[1]-P)*this.ky*L)/(M*M+L*L),N>1?(S=i[T+1][0],P=i[T+1][1]):N>0&&(S+=M/this.kx*N,P+=L/this.ky*N)),M=Qa(a[0]-S)*this.kx,L=(a[1]-P)*this.ky;const B=M*M+L*L;B<h&&(h=B,d=S,_=P,g=T,b=N)}return{point:[d,_],index:g,t:Math.max(0,Math.min(1,b))}}lineSlice(i,a,h){let d=this.pointOnLine(h,i),_=this.pointOnLine(h,a);if(d.index>_.index||d.index===_.index&&d.t>_.t){const S=d;d=_,_=S}const g=[d.point],b=d.index+1,T=_.index;!ty(h[b],g[0])&&b<=T&&g.push(h[b]);for(let S=b+1;S<=T;S++)g.push(h[S]);return ty(h[T],_.point)||g.push(_.point),g}lineSliceAlong(i,a,h){let d=0;const _=[];for(let g=0;g<h.length-1;g++){const b=h[g],T=h[g+1],S=this.distance(b,T);if(d+=S,d>i&&_.length===0&&_.push(a_(b,T,(i-(d-S))/S)),d>=a)return _.push(a_(b,T,(a-(d-S))/S)),_;d>i&&_.push(T)}return _}bufferPoint(i,a){const h=a/this.ky,d=a/this.kx;return[i[0]-d,i[1]-h,i[0]+d,i[1]+h]}bufferBBox(i,a){const h=a/this.ky,d=a/this.kx;return[i[0]-d,i[1]-h,i[2]+d,i[3]+h]}insideBBox(i,a){return Qa(i[0]-a[0])>=0&&Qa(i[0]-a[2])<=0&&i[1]>=a[1]&&i[1]<=a[3]}}function ty(l,i){return l[0]===i[0]&&l[1]===i[1]}function a_(l,i,a){const h=Qa(i[0]-l[0]);return[l[0]+h*a,l[1]+(i[1]-l[1])*a]}function Qa(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class l_{constructor(i=[],a=(h,d)=>h<d?-1:h>d?1:0){if(this.data=i,this.length=this.data.length,this.compare=a,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:a,compare:h}=this,d=a[i];for(;i>0;){const _=i-1>>1,g=a[_];if(h(d,g)>=0)break;a[i]=g,i=_}a[i]=d}_down(i){const{data:a,compare:h}=this,d=this.length>>1,_=a[i];for(;i<d;){let g=1+(i<<1);const b=g+1;if(b<this.length&&h(a[b],a[g])<0&&(g=b),h(a[g],_)>=0)break;a[i]=a[g],i=g}a[i]=_}}var Ft=8192;function iy(l,i){return i.dist-l.dist}const Zd=100,Kd=50;function bp(l){const i=[1/0,1/0,-1/0,-1/0];if(i.length!==l.length)return!1;for(let a=0;a<i.length;a++)if(i[a]!==l[a])return!1;return!0}function wp(l){return l[1]-l[0]+1}function gc(l,i){const a=l[1]>=l[0]&&l[1]<i;return a||console.warn("Distance Expression: Index is out of range"),a}function c_(l,i){if(l[0]>l[1])return[null,null];const a=wp(l);if(i){if(a===2)return[l,null];const h=Math.floor(a/2);return[[l[0],l[0]+h],[l[0]+h,l[1]]]}{if(a===1)return[l,null];const h=Math.floor(a/2)-1;return[[l[0],l[0]+h],[l[0]+h+1,l[1]]]}}function Tl(l,i){const a=[1/0,1/0,-1/0,-1/0];if(!gc(i,l.length))return a;for(let h=i[0];h<=i[1];++h)Hd(a,l[h]);return a}function vr(l){const i=[1/0,1/0,-1/0,-1/0];for(let a=0;a<l.length;++a)for(let h=0;h<l[a].length;++h)Hd(i,l[a][h]);return i}function Yd(l,i,a){if(bp(l)||bp(i))return NaN;let h=0,d=0;return l[2]<i[0]&&(h=i[0]-l[2]),l[0]>i[2]&&(h=l[0]-i[2]),l[1]>i[3]&&(d=l[1]-i[3]),l[3]<i[1]&&(d=i[1]-l[3]),a.distance([0,0],[h,d])}function ZE(l){return 360*l-180}function KE(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function u_(l,i){const a=Math.pow(2,i.z),h=(l.y/Ft+i.y)/a;return[ZE((l.x/Ft+i.x)/a),KE(h)]}function YE(l,i){const a=[];for(let h=0;h<l.length;++h)a.push(u_(l[h],i));return a}function Un(l,i,a){const h=a.pointOnLine(i,l).point;return a.distance(l,h)}function Jx(l,i,a,h,d){const _=a.slice(h[0],h[1]+1);let g=1/0;for(let b=i[0];b<=i[1];++b)if((g=Math.min(g,Un(l[b],_,d)))===0)return 0;return g}function ry(l,i,a,h,d){const _=Math.min(d.pointToSegmentDistance(l,a,h),d.pointToSegmentDistance(i,a,h)),g=Math.min(d.pointToSegmentDistance(a,l,i),d.pointToSegmentDistance(h,l,i));return Math.min(_,g)}function JE(l,i,a,h,d){if(!gc(i,l.length)||!gc(h,a.length))return NaN;let _=1/0;for(let g=i[0];g<i[1];++g)for(let b=h[0];b<h[1];++b){if(r_(l[g],l[g+1],a[b],a[b+1]))return 0;_=Math.min(_,ry(l[g],l[g+1],a[b],a[b+1],d))}return _}function QE(l,i,a,h,d){if(!gc(i,l.length)||!gc(h,a.length))return NaN;let _=1/0;for(let g=i[0];g<=i[1];++g)for(let b=h[0];b<=h[1];++b)if((_=Math.min(_,d.distance(l[g],a[b])))===0)return _;return _}function eI(l,i,a){if(qd(l,i,!0))return 0;let h=1/0;for(const d of i){const _=d.length;if(_<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(d[0]!==d[_-1]&&(h=Math.min(h,a.pointToSegmentDistance(l,d[_-1],d[0])))===0||(h=Math.min(h,Un(l,d,a)))===0)return h}return h}function tI(l,i,a,h){if(!gc(i,l.length))return NaN;for(let _=i[0];_<=i[1];++_)if(qd(l[_],a,!0))return 0;let d=1/0;for(let _=i[0];_<i[1];++_)for(const g of a)for(let b=0,T=g.length,S=T-1;b<T;S=b++){if(r_(l[_],l[_+1],g[S],g[b]))return 0;d=Math.min(d,ry(l[_],l[_+1],g[S],g[b],h))}return d}function Qx(l,i){for(const a of l)for(let h=0;h<=a.length-1;++h)if(qd(a[h],i,!0))return!0;return!1}function iI(l,i,a,h=1/0){const d=vr(l),_=vr(i);if(h!==1/0&&Yd(d,_,a)>=h)return h;if(Ul(d,_)){if(Qx(l,i))return 0}else if(Qx(i,l))return 0;let g=h;for(const b of l)for(let T=0,S=b.length,P=S-1;T<S;P=T++)for(const M of i)for(let L=0,N=M.length,B=N-1;L<N;B=L++){if(r_(b[P],b[T],M[B],M[L]))return 0;g=Math.min(g,ry(b[P],b[T],M[B],M[L],a))}return g}function h_(l,i,a,h,d,_,g){if(_===null||g===null)return;const b=Yd(Tl(h,_),Tl(d,g),a);b<i&&l.push({dist:b,range1:_,range2:g})}function rI(l,i,a,h,d=1/0){let _=Math.min(h.distance(l[0],a[0][0]),d);if(_===0)return _;const g=new l_([{dist:0,range1:[0,l.length-1],range2:[0,0]}],iy),b=i?Kd:Zd,T=vr(a);for(;g.length;){const S=g.pop();if(S.dist>=_)continue;const P=S.range1;if(wp(P)<=b){if(!gc(P,l.length))return NaN;if(i){const M=tI(l,P,a,h);if((_=Math.min(_,M))===0)return _}else for(let M=P[0];M<=P[1];++M){const L=eI(l[M],a,h);if((_=Math.min(_,L))===0)return _}}else{const M=c_(P,i);if(M[0]!==null){const L=Yd(Tl(l,M[0]),T,h);L<_&&g.push({dist:L,range1:M[0],range2:[0,0]})}if(M[1]!==null){const L=Yd(Tl(l,M[1]),T,h);L<_&&g.push({dist:L,range1:M[1],range2:[0,0]})}}}return _}function eb(l,i,a,h,d,_=1/0){let g=Math.min(_,d.distance(l[0],a[0]));if(g===0)return g;const b=new l_([{dist:0,range1:[0,l.length-1],range2:[0,a.length-1]}],iy),T=i?Kd:Zd,S=h?Kd:Zd;for(;b.length;){const P=b.pop();if(P.dist>=g)continue;const M=P.range1,L=P.range2;if(wp(M)<=T&&wp(L)<=S){if(!gc(M,l.length)||!gc(L,a.length))return NaN;if(i&&h?g=Math.min(g,JE(l,M,a,L,d)):i||h?i&&!h?g=Math.min(g,Jx(a,L,l,M,d)):!i&&h&&(g=Math.min(g,Jx(l,M,a,L,d))):g=Math.min(g,QE(l,M,a,L,d)),g===0)return g}else{const N=c_(M,i),B=c_(L,h);h_(b,g,d,l,a,N[0],B[0]),h_(b,g,d,l,a,N[0],B[1]),h_(b,g,d,l,a,N[1],B[0]),h_(b,g,d,l,a,N[1],B[1])}}return g}function ny(l,i,a,h,d=1/0){let _=d;const g=Tl(l,[0,l.length-1]);for(const b of a)if(!(_!==1/0&&Yd(g,Tl(b,[0,b.length-1]),h)>=_)&&(_=Math.min(_,eb(l,i,b,!0,h,_)),_===0))return _;return _}function d_(l,i,a,h,d=1/0){let _=d;const g=Tl(l,[0,l.length-1]);for(const b of a){if(_!==1/0&&Yd(g,vr(b),h)>=_)continue;const T=rI(l,i,b,h,_);if(isNaN(T))return T;if((_=Math.min(_,T))===0)return _}return _}function sy(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class zh{constructor(i,a){this.type=hi,this.geojson=i,this.geometries=a}static parse(i,a){if(i.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${i.length-1} instead.`);if(ks(i[1])){const h=i[1];if(h.type==="FeatureCollection"){for(let d=0;d<h.features.length;++d)if(sy(h.features[d].geometry.type))return new zh(h,h.features[d].geometry)}else if(h.type==="Feature"){if(sy(h.geometry.type))return new zh(h,h.geometry)}else if(sy(h.type))return new zh(h,h)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(i){const a=i.geometry(),h=i.canonicalID();if(a!=null&&h!=null){if(i.geometryType()==="Point")return function(d,_,g){const b=[];for(const S of d)for(const P of S)b.push(u_(P,_));const T=new Xd(b[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?eb(b,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",T):g.type==="MultiLineString"?ny(b,!1,g.coordinates,T):g.type==="Polygon"||g.type==="MultiPolygon"?d_(b,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,T):null}(a,h,this.geometries);if(i.geometryType()==="LineString")return function(d,_,g){const b=[];for(const S of d){const P=[];for(const M of S)P.push(u_(M,_));b.push(P)}const T=new Xd(b[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return ny(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b,T);if(g.type==="MultiLineString"){let S=1/0;for(let P=0;P<g.coordinates.length;P++){const M=ny(g.coordinates[P],!0,b,T,S);if(isNaN(M))return M;if((S=Math.min(S,M))===0)return S}return S}if(g.type==="Polygon"||g.type==="MultiPolygon"){let S=1/0;for(let P=0;P<b.length;P++){const M=d_(b[P],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,T,S);if(isNaN(M))return M;if((S=Math.min(S,M))===0)return S}return S}return null}(a,h,this.geometries);if(i.geometryType()==="Polygon")return function(d,_,g){const b=[];for(const S of function(P,M){const L=P.length;if(L<=1)return[P];const N=[];let B,W;for(let X=0;X<L;X++){const Z=i_(P[X]);Z!==0&&(P[X].area=Math.abs(Z),W===void 0&&(W=Z<0),W===Z<0?(B&&N.push(B),B=[P[X]]):B.push(P[X]))}return B&&N.push(B),N}(d)){const P=[];for(let M=0;M<S.length;++M)P.push(YE(S[M],_));b.push(P)}const T=new Xd(b[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return d_(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b,T);if(g.type==="MultiLineString"){let S=1/0;for(let P=0;P<g.coordinates.length;P++){const M=d_(g.coordinates[P],!0,b,T,S);if(isNaN(M))return M;if((S=Math.min(S,M))===0)return S}return S}return g.type==="Polygon"||g.type==="MultiPolygon"?function(S,P,M){let L=1/0;for(const N of S)for(const B of P){const W=iI(N,B,M,L);if(isNaN(W))return W;if((L=Math.min(L,W))===0)return L}return L}(g.type==="Polygon"?[g.coordinates]:g.coordinates,b,T):null}(a,h,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Jd(l){if(l instanceof Wo&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Fh||l instanceof zh)return!1;if(l instanceof ef)return l.featureConstant;let i=!0;return l.eachChild(a=>{i&&!Jd(a)&&(i=!1)}),i}function f_(l){if(l instanceof Wo&&l.name==="feature-state")return!1;let i=!0;return l.eachChild(a=>{i&&!f_(a)&&(i=!1)}),i}function p_(l){if(l instanceof ef)return new Set([l.key]);let i=new Set;return l.eachChild(a=>{i=new Set([...i,...p_(a)])}),i}function Qd(l,i){if(l instanceof Wo&&i.indexOf(l.name)>=0)return!1;let a=!0;return l.eachChild(h=>{a&&!Qd(h,i)&&(a=!1)}),a}function tb(l,i,a){return[l,i,a].filter(Boolean).join("")}function oy(l,i){switch(l){case"string":return qn(i);case"number":return+i;case"boolean":return!!i;case"color":return Mr.parse(i);case"formatted":return _t.fromString(qn(i));case"resolvedImage":return _i.build(qn(i))}return i}function ib(l,i,a,h){return h!==void 0&&(l=h*Math.round(l/h)),i!==void 0&&l<i&&(l=i),a!==void 0&&l>a&&(l=a),l}class ef{constructor(i,a,h,d=!1){this.type=i,this.key=a,this.scope=h,this.featureConstant=d}static parse(i,a){let h=a.expectedType;if(h==null&&(h=Dr),i.length<2||i.length>3)return a.error("Invalid number of arguments for 'config' expression.");const d=a.parse(i[1],1);if(!(d instanceof Di))return a.error("Key name of 'config' expression must be a string literal.");let _,g=!0;const b=qn(d.value);if(i.length>=3){const T=a.parse(i[2],2);if(!(T instanceof Di))return a.error("Scope of 'config' expression must be a string literal.");_=qn(T.value)}if(a.options){const T=tb(b,_,a._scope),S=a.options.get(T);S&&(g=Jd(S.value||S.default))}return new ef(h,b,_,g)}evaluate(i){const a=tb(this.key,this.scope,i.scope),h=i.getConfig(a);if(!h)return null;const{type:d,value:_,values:g,minValue:b,maxValue:T,stepValue:S}=h,P=h.default.evaluate(i);let M=P;if(_){const L=i.scope;i.scope=(L||"").split("").slice(1).join(""),M=_.evaluate(i),i.scope=L}return d&&(M=oy(d,M)),M===void 0||b===void 0&&T===void 0&&S===void 0||(typeof M=="number"?M=ib(M,b,T,S):Array.isArray(M)&&(M=M.map(L=>typeof L=="number"?ib(L,b,T,S):L))),_!==void 0&&M!==void 0&&g&&!g.includes(M)&&(M=P,d&&(M=oy(d,M))),(d&&d!==this.type||M!==void 0&&!Y(Er(M),this.type))&&(M=oy(this.type.kind,M)),M}eachChild(){}outputDefined(){return!1}serialize(){const i=["config",this.key];return this.scope&&i.concat(this.scope),i}}class m_{constructor(i,a){this.type=a.type,this.name=i,this.boundExpression=a}static parse(i,a){if(i.length!==2||typeof i[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const h=i[1];return a.scope.has(h)?new m_(h,a.scope.get(h)):a.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class __{constructor(i,a=[],h,d=new Su,_=[],g,b,T){this.registry=i,this.path=a,this.key=a.map(S=>typeof S=="string"?`['${S}']`:`[${S}]`).join(""),this.scope=d,this.errors=_,this.expectedType=h,this._scope=g,this.options=b,this.iconImageUseTheme=T}parse(i,a,h,d,_={}){return a||h?this.concat(a,null,h,d)._parse(i,_):this._parse(i,_)}parseObjectValue(i,a,h,d,_,g={}){return this.concat(a,h,d,_)._parse(i,g)}_parse(i,a){function h(d,_,g){return g==="assert"?new Pi(_,[d]):g==="coerce"?new bs(_,[d]):d}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=typeof i[0]=="string"?this.registry[i[0]]:void 0;if(d){let _=d.parse(i,this);if(!_)return null;if(this.expectedType){const g=this.expectedType,b=_.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||b.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(g,b))return null}else _=h(_,g,a.typeAnnotation||"coerce");else _=h(_,g,a.typeAnnotation||"assert")}if(!(_ instanceof Di)&&_.type.kind!=="resolvedImage"&&ay(_)){const g=new Xc(this._scope,this.options,this.iconImageUseTheme);try{_=new Di(_.type,_.evaluate(g))}catch(b){return this.error(b.message),null}}return _}return bs.parse(["to-array",i],this)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,a,h,d){let _=typeof i=="number"?this.path.concat(i):this.path;_=typeof a=="string"?_.concat(a):_;const g=d?this.scope.concat(d):this.scope;return new __(this.registry,_,h||null,g,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(i,...a){const h=`${this.key}${a.map(d=>`[${d}]`).join("")}`;this.errors.push(new Ia(h,i))}checkSubtype(i,a){const h=Cu(i,a);return h&&this.error(h),h}}function ay(l){if(l instanceof m_)return ay(l.boundExpression);if(l instanceof Wo&&l.name==="error"||l instanceof po||l instanceof Fh||l instanceof zh||l instanceof ef)return!1;const i=l instanceof bs||l instanceof Pi;let a=!0;return l.eachChild(h=>{a=i?a&&ay(h):a&&h instanceof Di}),!!a&&Jd(l)&&Qd(l,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function g_(l,i){const a=l.length-1;let h,d,_=0,g=a,b=0;for(;_<=g;)if(b=Math.floor((_+g)/2),h=l[b],d=l[b+1],h<=i){if(b===a||i<d)return b;_=b+1}else{if(!(h>i))throw new Gt("Input is not a number.");g=b-1}return 0}class Tp{constructor(i,a,h){this.type=i,this.input=a,this.labels=[],this.outputs=[];for(const[d,_]of h)this.labels.push(d),this.outputs.push(_)}static parse(i,a){if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");const h=a.parse(i[1],1,hi);if(!h)return null;const d=[];let _=null;a.expectedType&&a.expectedType.kind!=="value"&&(_=a.expectedType);for(let g=1;g<i.length;g+=2){const b=g===1?-1/0:i[g],T=i[g+1],S=g,P=g+1;if(typeof b!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(d.length&&d[d.length-1][0]>=b)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const M=a.parse(T,P,_);if(!M)return null;_=_||M.type,d.push([b,M])}return new Tp(_,h,d)}evaluate(i){const a=this.labels,h=this.outputs;if(a.length===1)return h[0].evaluate(i);const d=this.input.evaluate(i);if(d<=a[0])return h[0].evaluate(i);const _=a.length;return d>=a[_-1]?h[_-1].evaluate(i):h[g_(a,d)].evaluate(i)}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&i.push(this.labels[a]),i.push(this.outputs[a].serialize());return i}}const rb=.95047,nb=1.08883,sb=4/29,Mu=6/29,ob=3*Mu*Mu,ab=Mu*Mu*Mu,nI=Math.PI/180,sI=180/Math.PI;function ly(l){return l>ab?Math.pow(l,1/3):l/ob+sb}function y_(l){return l>Mu?l*l*l:ob*(l-sb)}function v_(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function ku(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function cy(l){const i=ku(l.r),a=ku(l.g),h=ku(l.b),d=ly((.4124564*i+.3575761*a+.1804375*h)/rb),_=ly((.2126729*i+.7151522*a+.072175*h)/1);return{l:116*_-16,a:500*(d-_),b:200*(_-ly((.0193339*i+.119192*a+.9503041*h)/nb)),alpha:l.a}}function uy(l){let i=(l.l+16)/116,a=isNaN(l.a)?i:i+l.a/500,h=isNaN(l.b)?i:i-l.b/200;return i=1*y_(i),a=rb*y_(a),h=nb*y_(h),new Mr(v_(3.2404542*a-1.5371385*i-.4985314*h),v_(-.969266*a+1.8760108*i+.041556*h),v_(.0556434*a-.2040259*i+1.0572252*h),l.alpha)}function oI(l,i,a){const h=i-l;return l+a*(h>180||h<-180?h-360*Math.round(h/360):h)}const Nh={forward:cy,reverse:uy,interpolate:function(l,i,a){return{l:Ri(l.l,i.l,a),a:Ri(l.a,i.a,a),b:Ri(l.b,i.b,a),alpha:Ri(l.alpha,i.alpha,a)}}},Bh={forward:function(l){const{l:i,a,b:h}=cy(l),d=Math.atan2(h,a)*sI;return{h:d<0?d+360:d,c:Math.sqrt(a*a+h*h),l:i,alpha:l.a}},reverse:function(l){const i=l.h*nI,a=l.c;return uy({l:l.l,a:Math.cos(i)*a,b:Math.sin(i)*a,alpha:l.alpha})},interpolate:function(l,i,a){return{h:oI(l.h,i.h,a),c:Ri(l.c,i.c,a),l:Ri(l.l,i.l,a),alpha:Ri(l.alpha,i.alpha,a)}}};var lb=Object.freeze({__proto__:null,hcl:Bh,lab:Nh});class el{constructor(i,a,h,d,_){this.type=i,this.operator=a,this.interpolation=h,this.input=d,this.labels=[],this.outputs=[];for(const[g,b]of _)this.labels.push(g),this.outputs.push(b)}static interpolationFactor(i,a,h,d){let _=0;if(i.name==="exponential")_=x_(a,i.base,h,d);else if(i.name==="linear")_=x_(a,1,h,d);else if(i.name==="cubic-bezier"){const g=i.controlPoints;_=new Ta(g[0],g[1],g[2],g[3]).solve(x_(a,1,h,d))}return _}static parse(i,a){let[h,d,_,...g]=i;if(!Array.isArray(d)||d.length===0)return a.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const S=d[1];if(typeof S!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:S}}else{if(d[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const S=d.slice(1);if(S.length!==4||S.some(P=>typeof P!="number"||P<0||P>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:S}}}if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length-1>3&&(i.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(_=a.parse(_,2,hi),!_)return null;const b=[];let T=null;h==="interpolate-hcl"||h==="interpolate-lab"?T=Lo:a.expectedType&&a.expectedType.kind!=="value"&&(T=a.expectedType);for(let S=0;S<g.length;S+=2){const P=g[S],M=g[S+1],L=S+3,N=S+4;if(typeof P!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(b.length&&b[b.length-1][0]>=P)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const B=a.parse(M,N,T);if(!B)return null;T=T||B.type,b.push([P,B])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new el(T,h,d,_,b):a.error(`Type ${_n(T)} is not interpolatable.`)}evaluate(i){const a=this.labels,h=this.outputs;if(a.length===1)return h[0].evaluate(i);const d=this.input.evaluate(i);if(d<=a[0])return h[0].evaluate(i);const _=a.length;if(d>=a[_-1])return h[_-1].evaluate(i);const g=g_(a,d),b=el.interpolationFactor(this.interpolation,d,a[g],a[g+1]),T=h[g].evaluate(i),S=h[g+1].evaluate(i);return this.operator==="interpolate"?qo[this.type.kind.toLowerCase()](T,S,b):this.operator==="interpolate-hcl"?Bh.reverse(Bh.interpolate(Bh.forward(T),Bh.forward(S),b)):Nh.reverse(Nh.interpolate(Nh.forward(T),Nh.forward(S),b))}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const a=[this.operator,i,this.input.serialize()];for(let h=0;h<this.labels.length;h++)a.push(this.labels[h],this.outputs[h].serialize());return a}}function x_(l,i,a,h){const d=h-a,_=l-a;return d===0?0:i===1?_/d:(Math.pow(i,_)-1)/(Math.pow(i,d)-1)}class Ep{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expectected at least one argument.");let h=null;const d=a.expectedType;d&&d.kind!=="value"&&(h=d);const _=[];for(const b of i.slice(1)){const T=a.parse(b,1+_.length,h,void 0,{typeAnnotation:"omit"});if(!T)return null;h=h||T.type,_.push(T)}const g=d&&_.some(b=>Cu(d,b.type));return new Ep(g?Dr:h,_)}evaluate(i){let a,h=null,d=0;for(const _ of this.args){if(d++,h=_.evaluate(i),h&&h instanceof _i&&!h.available&&(a||(a=h),h=null,d===this.args.length))return a;if(h!==null)break}return h}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(a=>{i.push(a.serialize())}),i}}class b_{constructor(i,a){this.type=a.type,this.bindings=[].concat(i),this.result=a}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const a of this.bindings)i(a[1]);i(this.result)}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const h=[];for(let _=1;_<i.length-1;_+=2){const g=i[_];if(typeof g!="string")return a.error(`Expected string, but found ${typeof g} instead.`,_);if(/[^a-zA-Z0-9_]/.test(g))return a.error("Variable names must contain only alphanumeric characters or '_'.",_);const b=a.parse(i[_+1],_+1);if(!b)return null;h.push([g,b])}const d=a.parse(i[i.length-1],i.length-1,a.expectedType,h);return d?new b_(h,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[a,h]of this.bindings)i.push(a,h.serialize());return i.push(this.result.serialize()),i}}class hy{constructor(i,a,h){this.type=i,this.index=a,this.input=h}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=a.parse(i[1],1,hi),d=a.parse(i[2],2,qs(a.expectedType||Dr));return h&&d?new hy(d.type.itemType,h,d):null}evaluate(i){const a=this.index.evaluate(i),h=this.input.evaluate(i);if(a<0)throw new Gt("Array index out of bounds: negative index");if(a>=h.length)throw new Gt("Array index out of bounds: index exceeds array size");if(a!==Math.floor(a))throw new Gt("Array index must be an integer. Use at-interpolated for fractional indices");return h[a]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class dy{constructor(i,a,h){this.type=i,this.index=a,this.input=h}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=a.parse(i[1],1,hi),d=a.parse(i[2],2,qs(a.expectedType||Dr));return h&&d?new dy(d.type.itemType,h,d):null}evaluate(i){const a=this.index.evaluate(i),h=this.input.evaluate(i);if(a<0)throw new Gt(`Array index out of bounds: ${a} < 0.`);if(a>h.length-1)throw new Gt(`Array index out of bounds: ${a} > ${h.length-1}.`);if(a===Math.floor(a))return h[a];const d=Math.floor(a),_=Math.ceil(a),g=h[d],b=h[_];if(typeof g!="number"||typeof b!="number")throw new Gt(`Cannot interpolate between non-number values at index ${a}.`);const T=a-d;return g*(1-T)+b*T}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class w_{constructor(i,a){this.type=Gr,this.needle=i,this.haystack=a}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=a.parse(i[1],1,Dr),d=a.parse(i[2],2,Dr);return h&&d?_c(h.type,[Gr,kr,hi,Sa,Dr])?new w_(h,d):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${_n(h.type)} instead`):null}evaluate(i){const a=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(h==null)return!1;if(!k(a,["boolean","string","number","null"]))throw new Gt(`Expected first argument to be of type boolean, string, number or null, but found ${_n(Er(a))} instead.`);if(!k(h,["string","array"]))throw new Gt(`Expected second argument to be of type array or string, but found ${_n(Er(h))} instead.`);return h.indexOf(a)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ip{constructor(i,a,h){this.type=hi,this.needle=i,this.haystack=a,this.fromIndex=h}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=a.parse(i[1],1,Dr),d=a.parse(i[2],2,Dr);if(!h||!d)return null;if(!_c(h.type,[Gr,kr,hi,Sa,Dr]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${_n(h.type)} instead`);if(i.length===4){const _=a.parse(i[3],3,hi);return _?new Ip(h,d,_):null}return new Ip(h,d)}evaluate(i){const a=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!k(a,["boolean","string","number","null"]))throw new Gt(`Expected first argument to be of type boolean, string, number or null, but found ${_n(Er(a))} instead.`);if(!k(h,["string","array"]))throw new Gt(`Expected second argument to be of type array or string, but found ${_n(Er(h))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(i);return h.indexOf(a,d)}return h.indexOf(a)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class tf{constructor(i,a,h,d,_,g){this.inputType=i,this.type=a,this.input=h,this.cases=d,this.outputs=_,this.otherwise=g}static parse(i,a){if(i.length<5)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return a.error("Expected an even number of arguments.");let h,d;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);const _={},g=[];for(let S=2;S<i.length-1;S+=2){let P=i[S];const M=i[S+1];Array.isArray(P)||(P=[P]);const L=a.concat(S);if(P.length===0)return L.error("Expected at least one branch label.");for(const B of P){if(typeof B!="number"&&typeof B!="string")return L.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return L.error("Numeric branch labels must be integer values.");if(h){if(L.checkSubtype(h,Er(B)))return null}else h=Er(B);if(_[String(B)]!==void 0)return L.error("Branch labels must be unique.");_[String(B)]=g.length}const N=a.parse(M,S,d);if(!N)return null;d=d||N.type,g.push(N)}const b=a.parse(i[1],1,Dr);if(!b)return null;const T=a.parse(i[i.length-1],i.length-1,d);return T?b.type.kind!=="value"&&a.concat(1).checkSubtype(h,b.type)?null:new tf(h,d,b,_,g,T):null}evaluate(i){const a=this.input.evaluate(i);return(Y(Er(a),this.inputType)&&this.outputs[this.cases[a]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),h=[],d={};for(const g of a){const b=d[this.cases[g]];b===void 0?(d[this.cases[g]]=h.length,h.push([this.cases[g],[g]])):h[b][1].push(g)}const _=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,b]of h)i.push(b.length===1?_(b[0]):b.map(_)),i.push(this.outputs[g].serialize());return i.push(this.otherwise.serialize()),i}}class fy{constructor(i,a,h){this.type=i,this.branches=a,this.otherwise=h}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return a.error("Expected an odd number of arguments.");let h;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);const d=[];for(let g=1;g<i.length-1;g+=2){const b=a.parse(i[g],g,Gr);if(!b)return null;const T=a.parse(i[g+1],g+1,h);if(!T)return null;d.push([b,T]),h=h||T.type}const _=a.parse(i[i.length-1],i.length-1,h);return _?new fy(h,d,_):null}evaluate(i){for(const[a,h]of this.branches)if(a.evaluate(i))return h.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[a,h]of this.branches)i(a),i(h);i(this.otherwise)}outputDefined(){return this.branches.every(([i,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(a=>{i.push(a.serialize())}),i}}class Sp{constructor(i,a,h,d){this.type=i,this.input=a,this.beginIndex=h,this.endIndex=d}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=a.parse(i[1],1,Dr),d=a.parse(i[2],2,hi);if(!h||!d)return null;if(!_c(h.type,[qs(Dr),kr,Dr]))return a.error(`Expected first argument to be of type array or string, but found ${_n(h.type)} instead`);if(i.length===4){const _=a.parse(i[3],3,hi);return _?new Sp(h.type,h,d,_):null}return new Sp(h.type,h,d)}evaluate(i){const a=this.input.evaluate(i),h=this.beginIndex.evaluate(i);if(!k(a,["string","array"]))throw new Gt(`Expected first argument to be of type array or string, but found ${_n(Er(a))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(i);return a.slice(h,d)}return a.slice(h)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class py{constructor(i,a){this.type=qs(kr),this.str=i,this.delimiter=a}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=a.parse(i[1],1,kr),d=a.parse(i[2],2,kr);return h&&d?new py(h,d):void 0}evaluate(i){const a=this.str.evaluate(i),h=this.delimiter.evaluate(i);return a.split(h)}eachChild(i){i(this.str),i(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function cb(l,i){return l==="=="||l==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function my(l,i,a,h){return h.compare(i,a)===0}function Vh(l,i,a){const h=l!=="=="&&l!=="!=";return class x9{constructor(_,g,b){this.type=Gr,this.lhs=_,this.rhs=g,this.collator=b,this.hasUntypedArgument=_.type.kind==="value"||g.type.kind==="value"}static parse(_,g){if(_.length!==3&&_.length!==4)return g.error("Expected two or three arguments.");const b=_[0];let T=g.parse(_[1],1,Dr);if(!T)return null;if(!cb(b,T.type))return g.concat(1).error(`"${b}" comparisons are not supported for type '${_n(T.type)}'.`);let S=g.parse(_[2],2,Dr);if(!S)return null;if(!cb(b,S.type))return g.concat(2).error(`"${b}" comparisons are not supported for type '${_n(S.type)}'.`);if(T.type.kind!==S.type.kind&&T.type.kind!=="value"&&S.type.kind!=="value")return g.error(`Cannot compare types '${_n(T.type)}' and '${_n(S.type)}'.`);h&&(T.type.kind==="value"&&S.type.kind!=="value"?T=new Pi(S.type,[T]):T.type.kind!=="value"&&S.type.kind==="value"&&(S=new Pi(T.type,[S])));let P=null;if(_.length===4){if(T.type.kind!=="string"&&S.type.kind!=="string"&&T.type.kind!=="value"&&S.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(P=g.parse(_[3],3,Lh),!P)return null}return new x9(T,S,P)}evaluate(_){const g=this.lhs.evaluate(_),b=this.rhs.evaluate(_);if(h&&this.hasUntypedArgument){const T=Er(g),S=Er(b);if(T.kind!==S.kind||T.kind!=="string"&&T.kind!=="number")throw new Gt(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${T.kind}, ${S.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const T=Er(g),S=Er(b);if(T.kind!=="string"||S.kind!=="string")return i(_,g,b)}return this.collator?a(_,g,b,this.collator.evaluate(_)):i(_,g,b)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[l];return this.eachChild(g=>{_.push(g.serialize())}),_}}}const aI=Vh("==",function(l,i,a){return i===a},my),lI=Vh("!=",function(l,i,a){return i!==a},function(l,i,a,h){return!my(0,i,a,h)}),cI=Vh("<",function(l,i,a){return i<a},function(l,i,a,h){return h.compare(i,a)<0}),T_=Vh(">",function(l,i,a){return i>a},function(l,i,a,h){return h.compare(i,a)>0}),uI=Vh("<=",function(l,i,a){return i<=a},function(l,i,a,h){return h.compare(i,a)<=0}),hI=Vh(">=",function(l,i,a){return i>=a},function(l,i,a,h){return h.compare(i,a)>=0});class _y{constructor(i,a,h,d,_,g){this.type=kr,this.number=i,this.locale=a,this.currency=h,this.unit=d,this.minFractionDigits=_,this.maxFractionDigits=g}static parse(i,a){if(i.length!==3)return a.error("Expected two arguments.");const h=a.parse(i[1],1,hi);if(!h)return null;const d=i[2];if(typeof d!="object"||Array.isArray(d))return a.error("NumberFormat options argument must be an object.");let _=null;if(d.locale&&(_=a.parseObjectValue(d.locale,2,"locale",kr),!_))return null;let g=null;if(d.currency&&(g=a.parseObjectValue(d.currency,2,"currency",kr),!g))return null;let b=null;if(d.unit&&(b=a.parseObjectValue(d.unit,2,"unit",kr),!b))return null;let T=null;if(d["min-fraction-digits"]&&(T=a.parseObjectValue(d["min-fraction-digits"],2,"min-fraction-digits",hi),!T))return null;let S=null;return d["max-fraction-digits"]&&(S=a.parseObjectValue(d["max-fraction-digits"],2,"max-fraction-digits",hi),!S)?null:new _y(h,_,g,b,T,S)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class gy{constructor(i){this.type=hi,this.input=i}static parse(i,a){if(i.length!==2)return a.error(`Expected 1 argument, but found ${i.length-1} instead.`);const h=a.parse(i[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${_n(h.type)} instead.`):new gy(h):null}evaluate(i){const a=this.input.evaluate(i);if(typeof a=="string"||Array.isArray(a))return a.length;throw new Gt(`Expected value to be of type string or array, but found ${_n(Er(a))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(a=>{i.push(a.serialize())}),i}}function yy(l){return function(){l=1831565813+(l|=0)|0;let i=Math.imul(l^l>>>15,1|l);return i=i+Math.imul(i^i>>>7,61|i)^i,((i^i>>>14)>>>0)/4294967296}}const rf={"==":aI,"!=":lI,">":T_,"<":cI,">=":hI,"<=":uI,array:Pi,at:hy,"at-interpolated":dy,boolean:Pi,case:fy,coalesce:Ep,collator:po,format:Vl,image:Gd,in:w_,"index-of":Ip,interpolate:el,"interpolate-hcl":el,"interpolate-lab":el,length:gy,let:b_,literal:Di,match:tf,number:Pi,"number-format":_y,object:Pi,slice:Sp,step:Tp,string:Pi,"to-boolean":bs,"to-color":bs,"to-number":bs,"to-string":bs,var:m_,within:Fh,distance:zh,config:ef,split:py};function ub(l,[i,a,h,d]){i=i.evaluate(l),a=a.evaluate(l),h=h.evaluate(l);const _=d?d.evaluate(l):1,g=is(i,a,h,_);if(g)throw new Gt(g);return new Mr(i/255,a/255,h/255,_)}function vy(l,[i,a,h,d]){i=i.evaluate(l),a=a.evaluate(l),h=h.evaluate(l);const _=d?d.evaluate(l):1,g=function(S,P,M,L){return typeof S=="number"&&S>=0&&S<=360?typeof P=="number"&&P>=0&&P<=100&&typeof M=="number"&&M>=0&&M<=100?L===void 0||typeof L=="number"&&L>=0&&L<=1?null:`Invalid hsla value [${[S,P,M,L].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof L=="number"?[S,P,M,L]:[S,P,M]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof L=="number"?[S,P,M,L]:[S,P,M]).join(", ")}]: 'h' must be between 0 and 360.`}(i,a,h,_);if(g)throw new Gt(g);const b=`hsla(${i}, ${a}%, ${h}%, ${_})`,T=Mr.parse(b);if(!T)throw new Gt(`Failed to parse HSLA color: ${b}`);return T}function xy(l,i){return l in i}function E_(l,i){const a=i[l];return a===void 0?null:a}function Uh(l){return{type:l}}function jh(l){return{result:"success",value:l}}function Du(l){return{result:"error",value:l}}function by(l,i){return!!l&&!!l.parameters&&l.parameters.indexOf(i)>-1}function I_(l){return l["property-type"]==="data-driven"}function wy(l){return by(l.expression,"measure-light")}function Ty(l){return by(l.expression,"zoom")}function S_(l){return!!l.expression&&l.expression.interpolated}function A_(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function Ey(l){return l}function C_(l,i){const a=i.type==="color",h=l.stops&&typeof l.stops[0][0]=="object",d=h||!(h||l.property!==void 0),_=l.type||(S_(i)?"exponential":"interval");if(a&&((l=Object.assign({},l)).stops&&(l.stops=l.stops.map(S=>[S[0],Mr.parse(S[1])])),l.default=Mr.parse(l.default?l.default:i.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!lb[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let g,b,T;if(_==="exponential")g=hb;else if(_==="interval")g=Lu;else if(_==="categorical"){g=dI,b=Object.create(null);for(const S of l.stops)b[S[0]]=S[1];T=typeof l.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);g=fI}if(h){const S={},P=[];for(let N=0;N<l.stops.length;N++){const B=l.stops[N],W=B[0].zoom;S[W]===void 0&&(S[W]={zoom:W,type:l.type,property:l.property,default:l.default,stops:[]},P.push(W)),S[W].stops.push([B[0].value,B[1]])}const M=[];for(const N of P)M.push([S[N].zoom,C_(S[N],i)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:el.interpolationFactor.bind(void 0,L),zoomStops:M.map(N=>N[0]),evaluate:({zoom:N},B)=>hb({stops:M,base:l.base},i,N).evaluate(N,B)}}if(d){const S=_==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:el.interpolationFactor.bind(void 0,S),zoomStops:l.stops.map(P=>P[0]),evaluate:({zoom:P})=>g(l,i,P,b,T)}}return{kind:"source",evaluate(S,P){const M=P&&P.properties?P.properties[l.property]:void 0;return M===void 0?nf(l.default,i.default):g(l,i,M,b,T)}}}function nf(l,i,a){return l!==void 0?l:i!==void 0?i:a!==void 0?a:void 0}function dI(l,i,a,h,d){return nf(typeof a===d?h[a]:void 0,l.default,i.default)}function Lu(l,i,a){if(!yp(a))return nf(l.default,i.default);const h=l.stops.length;if(h===1||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[h-1][0])return l.stops[h-1][1];const d=g_(l.stops.map(_=>_[0]),a);return l.stops[d][1]}function hb(l,i,a){const h=l.base!==void 0?l.base:1;if(!yp(a))return nf(l.default,i.default);const d=l.stops.length;if(d===1||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[d-1][0])return l.stops[d-1][1];const _=g_(l.stops.map(P=>P[0]),a),g=function(P,M,L,N){const B=N-L,W=P-L;return B===0?0:M===1?W/B:(Math.pow(M,W)-1)/(Math.pow(M,B)-1)}(a,h,l.stops[_][0],l.stops[_+1][0]),b=l.stops[_][1],T=l.stops[_+1][1];let S=qo[i.type]||Ey;if(l.colorSpace&&l.colorSpace!=="rgb"){const P=lb[l.colorSpace];S=(M,L)=>P.reverse(P.interpolate(P.forward(M),P.forward(L),g))}return typeof b.evaluate=="function"?{evaluate(...P){const M=b.evaluate.apply(void 0,P),L=T.evaluate.apply(void 0,P);if(M!==void 0&&L!==void 0)return S(M,L,g)}}:S(b,T,g)}function fI(l,i,a){return i.type==="color"?a=Mr.parse(a):i.type==="formatted"?a=_t.fromString(a.toString()):i.type==="resolvedImage"?a=_i.build(a.toString()):Bi(a)===i.type||i.type==="enum"&&i.values[a]||(a=void 0),nf(a,l.default,i.default)}Wo.register(rf,{error:[{kind:"error"},[kr],(l,[i])=>{throw new Gt(i.evaluate(l))}],typeof:[kr,[Dr],(l,[i])=>_n(Er(i.evaluate(l)))],"to-rgba":[qs(hi,4),[Lo],(l,[i])=>i.evaluate(l).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[qs(hi,4),[Lo],(l,[i])=>i.evaluate(l).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Lo,[hi,hi,hi],ub],rgba:[Lo,[hi,hi,hi,hi],ub],hsl:[Lo,[hi,hi,hi],vy],hsla:[Lo,[hi,hi,hi,hi],vy],has:{type:Gr,overloads:[[[kr],(l,[i])=>xy(i.evaluate(l),l.properties())],[[kr,ca],(l,[i,a])=>xy(i.evaluate(l),a.evaluate(l))]]},get:{type:Dr,overloads:[[[kr],(l,[i])=>E_(i.evaluate(l),l.properties())],[[kr,ca],(l,[i,a])=>E_(i.evaluate(l),a.evaluate(l))]]},"feature-state":[Dr,[kr],(l,[i])=>E_(i.evaluate(l),l.featureState||{})],properties:[ca,[],l=>l.properties()],"geometry-type":[kr,[],l=>l.geometryType()],worldview:[kr,[],l=>l.globals.worldview||""],id:[Dr,[],l=>l.id()],zoom:[hi,[],l=>l.globals.zoom],pitch:[hi,[],l=>l.globals.pitch||0],"distance-from-center":[hi,[],l=>l.distanceFromCenter()],"measure-light":[hi,[kr],(l,[i])=>l.measureLight(i.evaluate(l))],"heatmap-density":[hi,[],l=>l.globals.heatmapDensity||0],"line-progress":[hi,[],l=>l.globals.lineProgress||0],"raster-value":[hi,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[hi,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[hi,[],l=>l.globals.skyRadialProgress||0],accumulated:[Dr,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[hi,Uh(hi),(l,i)=>{let a=0;for(const h of i)a+=h.evaluate(l);return a}],"*":[hi,Uh(hi),(l,i)=>{let a=1;for(const h of i)a*=h.evaluate(l);return a}],"-":{type:hi,overloads:[[[hi,hi],(l,[i,a])=>i.evaluate(l)-a.evaluate(l)],[[hi],(l,[i])=>-i.evaluate(l)]]},"/":[hi,[hi,hi],(l,[i,a])=>i.evaluate(l)/a.evaluate(l)],"%":[hi,[hi,hi],(l,[i,a])=>i.evaluate(l)%a.evaluate(l)],ln2:[hi,[],()=>Math.LN2],pi:[hi,[],()=>Math.PI],e:[hi,[],()=>Math.E],"^":[hi,[hi,hi],(l,[i,a])=>Math.pow(i.evaluate(l),a.evaluate(l))],sqrt:[hi,[hi],(l,[i])=>Math.sqrt(i.evaluate(l))],log10:[hi,[hi],(l,[i])=>Math.log(i.evaluate(l))/Math.LN10],ln:[hi,[hi],(l,[i])=>Math.log(i.evaluate(l))],log2:[hi,[hi],(l,[i])=>Math.log2(i.evaluate(l))],sin:[hi,[hi],(l,[i])=>Math.sin(i.evaluate(l))],cos:[hi,[hi],(l,[i])=>Math.cos(i.evaluate(l))],tan:[hi,[hi],(l,[i])=>Math.tan(i.evaluate(l))],asin:[hi,[hi],(l,[i])=>Math.asin(i.evaluate(l))],acos:[hi,[hi],(l,[i])=>Math.acos(i.evaluate(l))],atan:[hi,[hi],(l,[i])=>Math.atan(i.evaluate(l))],min:[hi,Uh(hi),(l,i)=>Math.min(...i.map(a=>a.evaluate(l)))],max:[hi,Uh(hi),(l,i)=>Math.max(...i.map(a=>a.evaluate(l)))],abs:[hi,[hi],(l,[i])=>Math.abs(i.evaluate(l))],round:[hi,[hi],(l,[i])=>{const a=i.evaluate(l);return a<0?-Math.round(-a):Math.round(a)}],floor:[hi,[hi],(l,[i])=>Math.floor(i.evaluate(l))],ceil:[hi,[hi],(l,[i])=>Math.ceil(i.evaluate(l))],"filter-==":[Gr,[kr,Dr],(l,[i,a])=>l.properties()[i.value]===a.value],"filter-id-==":[Gr,[Dr],(l,[i])=>l.id()===i.value],"filter-type-==":[Gr,[kr],(l,[i])=>l.geometryType()===i.value],"filter-<":[Gr,[kr,Dr],(l,[i,a])=>{const h=l.properties()[i.value],d=a.value;return typeof h==typeof d&&h<d}],"filter-id-<":[Gr,[Dr],(l,[i])=>{const a=l.id(),h=i.value;return typeof a==typeof h&&a<h}],"filter->":[Gr,[kr,Dr],(l,[i,a])=>{const h=l.properties()[i.value],d=a.value;return typeof h==typeof d&&h>d}],"filter-id->":[Gr,[Dr],(l,[i])=>{const a=l.id(),h=i.value;return typeof a==typeof h&&a>h}],"filter-<=":[Gr,[kr,Dr],(l,[i,a])=>{const h=l.properties()[i.value],d=a.value;return typeof h==typeof d&&h<=d}],"filter-id-<=":[Gr,[Dr],(l,[i])=>{const a=l.id(),h=i.value;return typeof a==typeof h&&a<=h}],"filter->=":[Gr,[kr,Dr],(l,[i,a])=>{const h=l.properties()[i.value],d=a.value;return typeof h==typeof d&&h>=d}],"filter-id->=":[Gr,[Dr],(l,[i])=>{const a=l.id(),h=i.value;return typeof a==typeof h&&a>=h}],"filter-has":[Gr,[Dr],(l,[i])=>i.value in l.properties()],"filter-has-id":[Gr,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[Gr,[qs(kr)],(l,[i])=>i.value.indexOf(l.geometryType())>=0],"filter-id-in":[Gr,[qs(Dr)],(l,[i])=>i.value.indexOf(l.id())>=0],"filter-in-small":[Gr,[kr,qs(Dr)],(l,[i,a])=>a.value.indexOf(l.properties()[i.value])>=0],"filter-in-large":[Gr,[kr,qs(Dr)],(l,[i,a])=>function(h,d,_,g){for(;_<=g;){const b=_+g>>1;if(d[b]===h)return!0;d[b]>h?g=b-1:_=b+1}return!1}(l.properties()[i.value],a.value,0,a.value.length-1)],all:{type:Gr,overloads:[[[Gr,Gr],(l,[i,a])=>i.evaluate(l)&&a.evaluate(l)],[Uh(Gr),(l,i)=>{for(const a of i)if(!a.evaluate(l))return!1;return!0}]]},any:{type:Gr,overloads:[[[Gr,Gr],(l,[i,a])=>i.evaluate(l)||a.evaluate(l)],[Uh(Gr),(l,i)=>{for(const a of i)if(a.evaluate(l))return!0;return!1}]]},"!":[Gr,[Gr],(l,[i])=>!i.evaluate(l)],"is-supported-script":[Gr,[kr],(l,[i])=>{const a=l.globals&&l.globals.isSupportedScript;return!a||a(i.evaluate(l))}],upcase:[kr,[kr],(l,[i])=>i.evaluate(l).toUpperCase()],downcase:[kr,[kr],(l,[i])=>i.evaluate(l).toLowerCase()],concat:[kr,Uh(Dr),(l,i)=>i.map(a=>qn(a.evaluate(l))).join("")],"resolved-locale":[kr,[Lh],(l,[i])=>i.evaluate(l).resolvedLocale()],random:[hi,[hi,hi,Dr],(l,i)=>{const[a,h,d]=i.map(g=>g.evaluate(l));if(a>h||a===h)return a;let _;if(typeof d=="string")_=function(g){let b=0;if(g.length===0)return b;for(let T=0;T<g.length;T++)b=(b<<5)-b+g.charCodeAt(T),b|=0;return b}(d);else{if(typeof d!="number")throw new Gt(`Invalid seed input: ${d}`);_=d}return a+yy(_)()*(h-a)}]});class R_{constructor(i,a,h,d,_){this.expression=i,this._warningHistory={},this._evaluator=new Xc(h,d,_),this._defaultValue=a?function(g){return g.type==="color"&&(A_(g.default)||Array.isArray(g.default))?new Mr(0,0,0,0):g.type==="color"?Mr.parse(g.default)||null:g.default===void 0?null:g.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this.configDependencies=p_(i)}evaluateWithoutErrorHandling(i,a,h,d,_,g,b,T){return this._evaluator.globals=i,this._evaluator.feature=a,this._evaluator.featureState=h,this._evaluator.canonical=d||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(i,a,h,d,_,g,b,T,S){this._evaluator.globals=i,this._evaluator.feature=a||null,this._evaluator.featureState=h||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null,this._evaluator.iconImageUseTheme=S||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new Gt(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${P.message}`)),this._defaultValue}}}function Iy(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in rf}function yc(l,i,a,h,d){const _=new __(rf,[],i?function(b){const T={color:Lo,string:kr,number:hi,enum:kr,boolean:Gr,formatted:Bl,resolvedImage:Au};return b.type==="array"?qs(T[b.value]||Dr,b.length):T[b.type]}(i):void 0,void 0,void 0,a,h,d),g=_.parse(l,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?jh(new R_(g,i,a,h,d)):Du(_.errors)}class Ap{constructor(i,a,h,d){this.kind=i,this._styleExpression=a,this.isLightConstant=h,this.isLineProgressConstant=d,this.isStateDependent=i!=="constant"&&!f_(a.expression),this.configDependencies=p_(a.expression)}evaluateWithoutErrorHandling(i,a,h,d,_,g){return this._styleExpression.evaluateWithoutErrorHandling(i,a,h,d,_,g)}evaluate(i,a,h,d,_,g,b){return this._styleExpression.evaluate(i,a,h,d,_,g,void 0,void 0,b)}}class Ou{constructor(i,a,h,d,_,g){this.kind=i,this.zoomStops=h,this._styleExpression=a,this.isStateDependent=i!=="camera"&&!f_(a.expression),this.isLightConstant=_,this.isLineProgressConstant=g,this.configDependencies=p_(a.expression),this.interpolationType=d}evaluateWithoutErrorHandling(i,a,h,d,_,g){return this._styleExpression.evaluateWithoutErrorHandling(i,a,h,d,_,g)}evaluate(i,a,h,d,_,g){return this._styleExpression.evaluate(i,a,h,d,_,g)}interpolationFactor(i,a,h){return this.interpolationType?el.interpolationFactor(this.interpolationType,i,a,h):0}}function Sy(l,i,a,h,d){if((l=yc(l,i,a,h,d)).result==="error")return l;const _=l.value.expression,g=Jd(_);if(!g&&!I_(i))return Du([new Ia("","data expressions not supported")]);const b=Qd(_,["zoom","pitch","distance-from-center"]);if(!b&&!Ty(i))return Du([new Ia("","zoom expressions not supported")]);const T=Qd(_,["measure-light"]);if(!T&&!wy(i))return Du([new Ia("","measure-light expression not supported")]);const S=Qd(_,["line-progress"]);if(!S&&!function(L){return by(L.expression,"line-progress")}(i))return Du([new Ia("","line-progress expression not supported")]);const P=i.expression&&i.expression.relaxZoomRestriction,M=M_(_);return M||b||P?M instanceof Ia?Du([M]):M instanceof el&&!S_(i)?Du([new Ia("",'"interpolate" expressions cannot be used with this property')]):jh(M?new Ou(g&&S?"camera":"composite",l.value,M.labels,M instanceof el?M.interpolation:void 0,T,S):new Ap(g&&S?"constant":"source",l.value,T,S)):Du([new Ia("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class P_{constructor(i,a){this._parameters=i,this._specification=a,Object.assign(this,C_(this._parameters,this._specification))}static deserialize(i){return new P_(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function M_(l){let i=null;if(l instanceof b_)i=M_(l.result);else if(l instanceof Ep){for(const a of l.args)if(i=M_(a),i)break}else(l instanceof Tp||l instanceof el)&&l.input instanceof Wo&&l.input.name==="zoom"&&(i=l);return i instanceof Ia||l.eachChild(a=>{const h=M_(a);h instanceof Ia?i=h:i&&h&&i!==h&&(i=new Ia("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}var Cp,k_,db=function(){if(k_)return Cp;k_=1,Cp=i;var l=3;function i(a,h,d){var _=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var g=new Int32Array(this.arrayBuffer);a=g[0],this.d=(h=g[1])+2*(d=g[2]);for(var b=0;b<this.d*this.d;b++){var T=g[l+b],S=g[l+b+1];_.push(T===S?null:g.subarray(T,S))}var P=g[l+_.length+1];this.keys=g.subarray(g[l+_.length],P),this.bboxes=g.subarray(P),this.insert=this._insertReadonly}else{this.d=h+2*d;for(var M=0;M<this.d*this.d;M++)_.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=a,this.padding=d,this.scale=h/a,this.uid=0;var L=d/h*a;this.min=-L,this.max=a+L}return i.prototype.insert=function(a,h,d,_,g){this._forEachCell(h,d,_,g,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(h),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(g)},i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},i.prototype._insertCell=function(a,h,d,_,g,b){this.cells[g].push(b)},i.prototype.query=function(a,h,d,_,g){var b=this.min,T=this.max;if(a<=b&&h<=b&&T<=d&&T<=_&&!g)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(a,h,d,_,this._queryCell,S,{},g),S},i.prototype._queryCell=function(a,h,d,_,g,b,T,S){var P=this.cells[g];if(P!==null)for(var M=this.keys,L=this.bboxes,N=0;N<P.length;N++){var B=P[N];if(T[B]===void 0){var W=4*B;(S?S(L[W+0],L[W+1],L[W+2],L[W+3]):a<=L[W+2]&&h<=L[W+3]&&d>=L[W+0]&&_>=L[W+1])?(T[B]=!0,b.push(M[B])):T[B]=!1}}},i.prototype._forEachCell=function(a,h,d,_,g,b,T,S){for(var P=this._convertToCellCoord(a),M=this._convertToCellCoord(h),L=this._convertToCellCoord(d),N=this._convertToCellCoord(_),B=P;B<=L;B++)for(var W=M;W<=N;W++){var X=this.d*W+B;if((!S||S(this._convertFromCellCoord(B),this._convertFromCellCoord(W),this._convertFromCellCoord(B+1),this._convertFromCellCoord(W+1)))&&g.call(this,a,h,d,_,X,b,T,S))return}},i.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},i.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,h=l+this.cells.length+1+1,d=0,_=0;_<this.cells.length;_++)d+=this.cells[_].length;var g=new Int32Array(h+d+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var b=h,T=0;T<a.length;T++){var S=a[T];g[l+T]=b,g.set(S,b),b+=S.length}return g[l+a.length]=b,g.set(this.keys,b),g[l+a.length+1]=b+=this.keys.length,g.set(this.bboxes,b),b+=this.bboxes.length,g.buffer},Cp}(),$h=eo(db);const sf={};function Zt(l,i,a={}){Object.defineProperty(l,"_classRegistryKey",{value:i,writable:!1}),sf[i]={klass:l,omit:a.omit||[]}}Zt(Object,"Object"),$h.serialize=function(l,i){const a=l.toArrayBuffer();return i&&i.add(a),{buffer:a}},$h.deserialize=function(l){return new $h(l.buffer)},Object.defineProperty($h,"name",{value:"Grid"}),Zt($h,"Grid"),delete xt.prototype.constructor,typeof DOMMatrix<"u"&&Zt(DOMMatrix,"DOMMatrix"),Zt(Mr,"Color"),Zt(Error,"Error"),Zt(_t,"Formatted"),Zt(Ae,"FormattedSection"),Zt(mp,"AJAXError"),Zt(_i,"ResolvedImage"),Zt(P_,"StylePropertyFunction"),Zt(R_,"StyleExpression",{omit:["_evaluator"]}),Zt(la,"ImageId"),Zt(zt,"ImageVariant"),Zt(Ou,"ZoomDependentExpression"),Zt(Ap,"ZoomConstantExpression"),Zt(Wo,"CompoundExpression",{omit:["_evaluate"]});for(const l in rf)sf[rf[l]._classRegistryKey]||Zt(rf[l],`Expression${l}`);function Ay(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function Zc(l){return self.ImageBitmap&&l instanceof ImageBitmap}function Fu(l,i){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(Ay(l)||Zc(l))return i&&i.add(l),l;if(ArrayBuffer.isView(l))return i&&i.add(l.buffer),l;if(l instanceof ImageData)return i&&i.add(l.data.buffer),l;if(Array.isArray(l)){const a=[];for(const h of l)a.push(Fu(h,i));return a}if(l instanceof Map){const a={$name:"Map",entries:[]};for(const[h,d]of l.entries())a.entries.push(Fu(h),Fu(d,i));return a}if(l instanceof Set){const a={$name:"Set"};let h=0;for(const d of l.values())a[++h]=Fu(d);return a}if(l instanceof DOMMatrix){const a={$name:"DOMMatrix"},h=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const d of h)a[d]=l[d];return a}if(typeof l=="bigint")return{$name:"BigInt",value:l.toString()};if(typeof l=="object"){const a=l.constructor,h=a._classRegistryKey;if(!h)throw new Error(`Can't serialize object of unregistered class "${a.name}".`);const d=a.serialize?a.serialize(l,i):{};if(!a.serialize){for(const _ in l)l.hasOwnProperty(_)&&(sf[h].omit.indexOf(_)>=0||(d[_]=Fu(l[_],i)));l instanceof Error&&(d.message=l.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(d.$name=h),d}throw new Error("can't serialize object of type "+typeof l)}function zu(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||Ay(l)||Zc(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(zu);if(typeof l=="object"){const i=l.$name||"Object";if(i==="Map"){const d=l.entries||[],_=new Map;for(let g=0;g<d.length;g+=2)_.set(zu(d[g]),zu(d[g+1]));return _}if(i==="Set"){const d=new Set;for(const _ of Object.keys(l))_!=="$name"&&d.add(zu(l[_]));return d}if(i==="DOMMatrix"){let d;return d=l.is2D?[l.a,l.b,l.c,l.d,l.e,l.f]:[l.m11,l.m12,l.m13,l.m14,l.m21,l.m22,l.m23,l.m24,l.m31,l.m32,l.m33,l.m34,l.m41,l.m42,l.m43,l.m44],new DOMMatrix(d)}if(i==="BigInt")return BigInt(l.value);const{klass:a}=sf[i];if(!a)throw new Error(`Can't deserialize unregistered class "${i}".`);if(a.deserialize)return a.deserialize(l);const h=Object.create(a.prototype);for(const d of Object.keys(l))d!=="$name"&&(h[d]=zu(l[d]));return h}throw new Error("can't deserialize object of type "+typeof l)}const ki={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,Osage:l=>l>=66736&&l<=66815,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function Cy(l){for(const i of l)if(L_(i.charCodeAt(0)))return!0;return!1}function fb(l){for(const i of l)if(!D_(i.charCodeAt(0)))return!1;return!0}function D_(l){return!(ki.Arabic(l)||ki["Arabic Supplement"](l)||ki["Arabic Extended-A"](l)||ki["Arabic Presentation Forms-A"](l)||ki["Arabic Presentation Forms-B"](l))}function L_(l){return!(l!==746&&l!==747&&(l<4352||!(ki["Bopomofo Extended"](l)||ki.Bopomofo(l)||ki["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||ki["CJK Compatibility Ideographs"](l)||ki["CJK Compatibility"](l)||ki["CJK Radicals Supplement"](l)||ki["CJK Strokes"](l)||!(!ki["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||ki["CJK Unified Ideographs Extension A"](l)||ki["CJK Unified Ideographs"](l)||ki["Enclosed CJK Letters and Months"](l)||ki["Hangul Compatibility Jamo"](l)||ki["Hangul Jamo Extended-A"](l)||ki["Hangul Jamo Extended-B"](l)||ki["Hangul Jamo"](l)||ki["Hangul Syllables"](l)||ki.Hiragana(l)||ki["Ideographic Description Characters"](l)||ki.Kanbun(l)||ki["Kangxi Radicals"](l)||ki["Katakana Phonetic Extensions"](l)||ki.Katakana(l)&&l!==12540||!(!ki["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!ki["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||ki["Unified Canadian Aboriginal Syllabics"](l)||ki["Unified Canadian Aboriginal Syllabics Extended"](l)||ki["Vertical Forms"](l)||ki["Yijing Hexagram Symbols"](l)||ki["Yi Syllables"](l)||ki["Yi Radicals"](l))))}function O_(l){return!(L_(l)||function(i){return!!(ki["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||ki["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||ki["Letterlike Symbols"](i)||ki["Number Forms"](i)||ki["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||ki["Control Pictures"](i)&&i!==9251||ki["Optical Character Recognition"](i)||ki["Enclosed Alphanumerics"](i)||ki["Geometric Shapes"](i)||ki["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||ki["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||ki["CJK Symbols and Punctuation"](i)||ki.Katakana(i)||ki["Private Use Area"](i)||ki["CJK Compatibility Forms"](i)||ki["Small Form Variants"](i)||ki["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(l))}function pI(l){return ki.Arabic(l)||ki["Arabic Supplement"](l)||ki["Arabic Extended-A"](l)||ki["Arabic Presentation Forms-A"](l)||ki["Arabic Presentation Forms-B"](l)}function pb(l){return l>=1424&&l<=2303||ki["Arabic Presentation Forms-A"](l)||ki["Arabic Presentation Forms-B"](l)}function mI(l,i){return!(!i&&pb(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||ki.Khmer(l))}function _I(l){for(const i of l)if(pb(i.charCodeAt(0)))return!0;return!1}const Aa={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Ry=null,Xo=Aa.unavailable,Nu=null;const mb=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(Xo=Aa.error),Ry&&Ry(l)};function Py(){My.fire(new Ea("pluginStateChange",{pluginStatus:Xo,pluginURL:Nu}))}const My=new mc,F_=function(){return Xo},Gh=function(){if(Xo!==Aa.deferred||!Nu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Xo=Aa.loading,Py(),Nu&&Iu({url:Nu},l=>{l?mb(l):(Xo=Aa.loaded,Py())})},vc={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Xo===Aa.loaded||vc.applyArabicShaping!=null,isLoading:()=>Xo===Aa.loading,setState(l){Xo=l.pluginStatus,Nu=l.pluginURL},isParsing:()=>Xo===Aa.parsing,isParsed:()=>Xo===Aa.parsed,getPluginURL:()=>Nu};class gn{constructor(i,a){this.zoom=i,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness,this.worldview=a.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(i){return function(a,h){for(const d of a)if(!mI(d.charCodeAt(0),h))return!1;return!0}(i,vc.isLoaded())}}class Hh{constructor(i,a,h,d,_){this.property=i,this.value=a,this.expression=function(g,b,T,S,P){if(A_(g))return new P_(g,b);if(Iy(g)||Array.isArray(g)&&g.length>0){const M=Sy(g,b,T,S,P);if(M.result==="error")throw new Error(M.value.map(L=>`${L.key}: ${L.message}`).join(", "));return M.value}{let M=g;return typeof g=="string"&&b.type==="color"&&(M=Mr.parse(g)),{kind:"constant",configDependencies:new Set,evaluate:()=>M}}}(a===void 0?i.specification.default:a,i.specification,h,d,_)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,a,h,d){return this.property.possiblyEvaluate(this,i,a,h,d)}}class ky{constructor(i,a,h,d){this.property=i,this.value=new Hh(i,void 0,a,h,d)}transitioned(i,a){return new Kc(this.property,this.value,a,Object.assign({},i.transition,this.transition),i.now)}untransitioned(){return new Kc(this.property,this.value,null,{},0)}}class _b{constructor(i,a,h,d){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._scope=a,this._options=h,this._iconImageUseTheme=d,this.configDependencies=new Set}getValue(i){return Oi(this._values[i].value.value)}setValue(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new ky(this._values[i].property,this._scope,this._options,this._iconImageUseTheme)),this._values[i].value=new Hh(this._values[i].property,a===null?void 0:Oi(a),this._scope,this._options,this._iconImageUseTheme),this._values[i].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].value.expression.configDependencies]))}setTransitionOrValue(i,a){a&&(this._options=a);const h=this._properties.properties;if(i)for(const d in i){const _=i[d];if(d.endsWith("-transition")){const g=d.slice(0,-11);h[g]&&this.setTransition(g,_)}else h.hasOwnProperty(d)&&this.setValue(d,_)}}getTransition(i){return Oi(this._values[i].transition)}setTransition(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new ky(this._values[i].property)),this._values[i].transition=Oi(a)||void 0}serialize(){const i={};for(const a of Object.keys(this._values)){const h=this.getValue(a);h!==void 0&&(i[a]=h);const d=this.getTransition(a);d!==void 0&&(i[`${a}-transition`]=d)}return i}transitioned(i,a){const h=new Dy(this._properties);for(const d of Object.keys(this._values))h._values[d]=this._values[d].transitioned(i,a._values[d]);return h}untransitioned(){const i=new Dy(this._properties);for(const a of Object.keys(this._values))i._values[a]=this._values[a].untransitioned();return i}}class Kc{constructor(i,a,h,d,_){const g=d.delay||0,b=d.duration||0;_=_||0,this.property=i,this.value=a,this.begin=_+g,this.end=this.begin+b,i.specification.transition&&(d.delay||d.duration)&&(this.prior=h)}possiblyEvaluate(i,a,h){const d=i.now||0,_=this.value.possiblyEvaluate(i,a,h),g=this.prior;if(g){if(d>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(d<this.begin)return g.possiblyEvaluate(i,a,h);{const b=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(i,a,h),_,oe(b))}}return _}}class Dy{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,a,h){const d=new Xh(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(i,a,h);return d}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class qh{constructor(i,a,h,d){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._scope=a,this._options=h,this._iconImageUseTheme=d,this.configDependencies=new Set}getValue(i){return Oi(this._values[i].value)}setValue(i,a){this._values[i]=new Hh(this._values[i].property,a===null?void 0:Oi(a),this._scope,this._options,this._iconImageUseTheme),this._values[i].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].expression.configDependencies]))}serialize(){const i={};for(const a of Object.keys(this._values)){const h=this.getValue(a);h!==void 0&&(i[a]=h)}return i}possiblyEvaluate(i,a,h,d){const _=new Xh(this._properties);for(const g of Object.keys(this._values))_._values[g]=this._values[g].possiblyEvaluate(i,a,h,d);return _}}class Wh{constructor(i,a,h,d){this.property=i,this.value=a,this.parameters=h,this.iconImageUseTheme=d}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,a,h,d){return this.property.evaluate(this.value,this.parameters,i,a,h,d,this.iconImageUseTheme)}}class Xh{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Mt{constructor(i){this.specification=i}possiblyEvaluate(i,a){return i.expression.evaluate(a)}interpolate(i,a,h){const d=qo[this.specification.type];return d?d(i,a,h):i}}class jt{constructor(i,a){this.specification=i,this.overrides=a}possiblyEvaluate(i,a,h,d,_){return i.expression.kind==="constant"||i.expression.kind==="camera"?new Wh(this,{kind:"constant",value:i.expression.evaluate(a,null,{},h,d,void 0,_)},a):new Wh(this,i.expression,a,_)}interpolate(i,a,h){if(i.value.kind!=="constant"||a.value.kind!=="constant")return i;if(i.value.value===void 0||a.value.value===void 0)return new Wh(this,{kind:"constant",value:void 0},i.parameters);const d=qo[this.specification.type];return d?new Wh(this,{kind:"constant",value:d(i.value.value,a.value.value,h)},i.parameters):i}evaluate(i,a,h,d,_,g,b){return i.kind==="constant"?i.value:i.evaluate(a,h,d,_,g,void 0,b)}}class of{constructor(i){this.specification=i}possiblyEvaluate(i,a,h,d){return!!i.expression.evaluate(a,null,{},h,d)}interpolate(){return!1}}class Kn{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new gn(0,{});for(const h in i){const d=i[h];d.specification.overridable&&this.overridableProperties.push(h);const _=this.defaultPropertyValues[h]=new Hh(d,void 0),g=this.defaultTransitionablePropertyValues[h]=new ky(d);this.defaultTransitioningPropertyValues[h]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=_.possiblyEvaluate(a)}}}Zt(jt,"DataDrivenProperty"),Zt(Mt,"DataConstantProperty"),Zt(of,"ColorRampProperty");var qe=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function z_(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Zh(l){if(Array.isArray(l))return l.map(Zh);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const i={};for(const a in l)i[a]=Zh(l[a]);return i}return z_(l)}function N_(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const i of l.slice(1))if(!N_(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function Rp(l,i="",a=null,h="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};N_(l)||(l=B_(l));const d=l;let _=!0;try{_=function(P){if(!af(P))return P;let M=Zh(P);return jl(M),M=gb(M),M}(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}let g=null,b=null;if(h!=="background"&&h!=="sky"&&h!=="slot"){b=qe[`filter_${h}`];const P=yc(_,b,i,a);if(P.result==="error")throw new Error(P.value.map(M=>`${M.key}: ${M.message}`).join(", "));g=(M,L,N)=>P.value.evaluate(M,L,{},N)}let T=null,S=null;if(_!==d){const P=yc(d,b,i,a);if(P.result==="error")throw new Error(P.value.map(M=>`${M.key}: ${M.message}`).join(", "));T=(M,L,N,B,W)=>P.value.evaluate(M,L,{},N,void 0,void 0,B,W),S=!Jd(P.value.expression)}return{filter:g,dynamicFilter:T||void 0,needGeometry:vb(_),needFeature:!!S}}function gb(l){if(!Array.isArray(l))return l;const i=function(a){if(yb.has(a[0])){for(let h=1;h<a.length;h++)if(af(a[h]))return!0}return a}(l);return i===!0?i:i.map(a=>gb(a))}function jl(l){let i=!1;const a=[];if(l[0]==="case"){for(let h=1;h<l.length-1;h+=2)i=i||af(l[h]),a.push(l[h+1]);a.push(l[l.length-1])}else if(l[0]==="match"){i=i||af(l[1]);for(let h=2;h<l.length-1;h+=2)a.push(l[h+1]);a.push(l[l.length-1])}else if(l[0]==="step"){i=i||af(l[1]);for(let h=1;h<l.length-1;h+=2)a.push(l[h+1])}i&&(l.length=0,l.push("any",...a));for(let h=1;h<l.length;h++)jl(l[h])}function af(l){if(!Array.isArray(l))return!1;if((i=l[0])==="pitch"||i==="distance-from-center")return!0;var i;for(let a=1;a<l.length;a++)if(af(l[a]))return!0;return!1}const yb=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function gI(l,i){return l<i?-1:l>i?1:0}function vb(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let i=1;i<l.length;i++)if(vb(l[i]))return!0;return!1}function B_(l){if(!l)return!0;const i=l[0];return l.length<=1?i!=="any":i==="=="?Ly(l[1],l[2],"=="):i==="!="?V_(Ly(l[1],l[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Ly(l[1],l[2],i):i==="any"?(a=l.slice(1),["any"].concat(a.map(B_))):i==="all"?["all"].concat(l.slice(1).map(B_)):i==="none"?["all"].concat(l.slice(1).map(B_).map(V_)):i==="in"?xb(l[1],l.slice(2)):i==="!in"?V_(xb(l[1],l.slice(2))):i==="has"?bb(l[1]):i!=="!has"||V_(bb(l[1]));var a}function Ly(l,i,a){switch(l){case"$type":return[`filter-type-${a}`,i];case"$id":return[`filter-id-${a}`,i];default:return[`filter-${a}`,l,i]}}function xb(l,i){if(i.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(a=>typeof a!=typeof i[0])?["filter-in-large",l,["literal",i.sort(gI)]]:["filter-in-small",l,["literal",i]]}}function bb(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function V_(l){return["!",l]}const Pp="";function lf(l,i){return i?`${l}${Pp}${i}`:l}let Oy;const wb=()=>Oy||(Oy=new Kn({"icon-size":new jt(qe.layout_symbol["icon-size"]),"icon-image":new jt(qe.layout_symbol["icon-image"]),"icon-rotate":new jt(qe.layout_symbol["icon-rotate"]),"icon-offset":new jt(qe.layout_symbol["icon-offset"])}));class yI{constructor(i,a,h,d,_,g){const b=yc(i,qe.appearance.condition);if(b.result==="success"&&(this.condition=b.value),this.name=a,h){this.properties=new Xh(wb()),this.unevaluatedLayout=new qh(wb(),d,_,g);for(const T in h)this.unevaluatedLayout.setValue(T,h[T])}}isActive(i){return!(this.condition||!i.isHidden||this.name!=="hidden")||this.condition.evaluate(i.globals,i.feature,i.featureState,i.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(i){return this.properties.get(i)}getUnevaluatedProperties(){return this.unevaluatedLayout}serialize(){const i={};return i.condition=this.condition.expression.serialize(),this.name&&(i.name=this.name),this.properties&&(i.properties=this.properties),i}}const Tb="-transition",Eb=new Set(["fill","line","background","hillshade","raster"]);class Fo extends mc{constructor(i,a,h,d,_,g){if(super(),this.id=i.id,this.fqid=lf(this.id,h),this.type=i.type,this.scope=h,this.lut=d,this.options=_,this.iconImageUseTheme=g,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,i.type!=="custom"){if(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type&&i.type!=="background"&&i.type!=="sky"&&i.type!=="slot"){this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter;const b=yc(this.filter,qe[`filter_${i.type}`]);b.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...b.value.configDependencies]))}if(i.slot&&(this.slot=i.slot),i.appearances&&i.appearances.forEach(b=>{this.appearances.push(new yI(b.condition,b.name,b.properties,this.scope,_,this.iconImageUseTheme))}),a.layout&&(this._unevaluatedLayout=new qh(a.layout,this.scope,_,this.iconImageUseTheme),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),a.paint){this._transitionablePaint=new _b(a.paint,this.scope,_);for(const b in i.paint)this.setPaintProperty(b,i.paint[b]);for(const b in i.layout)this.setLayoutProperty(b,i.layout[b]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Xh(a.paint)}}}onAdd(i){}onRemove(i){}isDraped(i){return!this.is3D(!0)&&Eb.has(this.type)}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,a){if(this.type==="custom"&&i==="visibility")return void(this.visibility=a);const h=this._unevaluatedLayout;h._properties.properties[i]&&(h.setValue(i,a),this.configDependencies=new Set([...this.configDependencies,...h.configDependencies]),i==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(i){return i.endsWith(Tb)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,a){const h=this._transitionablePaint,d=h._properties.properties;if(i.endsWith(Tb)){const M=i.slice(0,-11);return d[M]&&h.setTransition(M,a||void 0),!1}if(!d[i])return!1;const _=h._values[i],g=_.value.isDataDriven(),b=_.value;h.setValue(i,a),this.configDependencies=new Set([...this.configDependencies,...h.configDependencies]),this._handleSpecialPaintPropertyUpdate(i);const T=h._values[i].value,S=T.isDataDriven(),P=i.endsWith("pattern")||i==="line-dasharray";return S||g||P||this._handleOverridablePaintPropertyUpdate(i,b,T)}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getDefaultProgramParams(i,a,h){return null}_handleOverridablePaintPropertyUpdate(i,a,h){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,a,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,a)}serialize(){const i={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(i.appearances=this.appearances.map(a=>a.serialize())),Xi(i,(a,h)=>!(a===void 0||h==="layout"&&!Object.keys(a).length||h==="paint"&&!Object.keys(a).length))}is3D(i){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const i in this.paint._values){const a=this.paint.get(i);if(a instanceof Wh&&I_(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}compileFilter(i){this._filterCompiled||(this._featureFilter=Rp(this.filter,this.scope,i),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(i){this._stats&&(i.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRadius(i){}queryIntersectsFeature(i,a,h,d,_,g,b,T,S){}}const Bu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class cf{constructor(i,a){this._structArray=i,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Sn{constructor(){this.capacity=-1,this.resize(0)}static serialize(i,a){return i._trim(),a&&a.add(i.arrayBuffer),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const a=Object.create(this.prototype);return a.arrayBuffer=i.arrayBuffer,a.length=i.length,a.capacity=i.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...i){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...i){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function xr(l,i=1){let a=0,h=0;return{members:l.map(d=>{const _=Bu[d.type].BYTES_PER_ELEMENT,g=a=Ib(a,Math.max(i,_)),b=d.components||1;return h=Math.max(h,_),a+=_*b,{name:d.name,type:d.type,components:b,offset:g}}),size:Ib(a,Math.max(h,i)),alignment:i}}function Ib(l,i){return Math.ceil(l/i)*i}class Vu extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a){const h=this.length;return this.resize(h+1),this.emplace(h,i,a)}emplace(i,a,h){const d=2*i;return this.int16[d+0]=a,this.int16[d+1]=h,i}}Vu.prototype.bytesPerElement=4,Zt(Vu,"StructArrayLayout2i4");class Kh extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,h){const d=this.length;return this.resize(d+1),this.emplace(d,i,a,h)}emplace(i,a,h,d){const _=3*i;return this.int16[_+0]=a,this.int16[_+1]=h,this.int16[_+2]=d,i}}Kh.prototype.bytesPerElement=6,Zt(Kh,"StructArrayLayout3i6");class Yh extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,h,d){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,h,d)}emplace(i,a,h,d,_){const g=4*i;return this.int16[g+0]=a,this.int16[g+1]=h,this.int16[g+2]=d,this.int16[g+3]=_,i}}Yh.prototype.bytesPerElement=8,Zt(Yh,"StructArrayLayout4i8");class Uu extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.float32[1*i+0]=a,i}}Uu.prototype.bytesPerElement=4,Zt(Uu,"StructArrayLayout1f4");class Fy extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h){const d=this.length;return this.resize(d+1),this.emplace(d,i,a,h)}emplace(i,a,h,d){const _=4*i,g=2*i;return this.int16[_+0]=a,this.int16[_+1]=h,this.float32[g+1]=d,i}}Fy.prototype.bytesPerElement=8,Zt(Fy,"StructArrayLayout2i1f8");class U_ extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,h){const d=this.length;return this.resize(d+1),this.emplace(d,i,a,h)}emplace(i,a,h,d){const _=4*i;return this.int16[_+0]=a,this.int16[_+1]=h,this.int16[_+2]=d,i}}U_.prototype.bytesPerElement=8,Zt(U_,"StructArrayLayout3i8");class zy extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_){const g=this.length;return this.resize(g+1),this.emplace(g,i,a,h,d,_)}emplace(i,a,h,d,_,g){const b=5*i;return this.int16[b+0]=a,this.int16[b+1]=h,this.int16[b+2]=d,this.int16[b+3]=_,this.int16[b+4]=g,i}}zy.prototype.bytesPerElement=10,Zt(zy,"StructArrayLayout5i10");class j_ extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_,g,b){const T=this.length;return this.resize(T+1),this.emplace(T,i,a,h,d,_,g,b)}emplace(i,a,h,d,_,g,b,T){const S=6*i,P=12*i,M=3*i;return this.int16[S+0]=a,this.int16[S+1]=h,this.uint8[P+4]=d,this.uint8[P+5]=_,this.uint8[P+6]=g,this.uint8[P+7]=b,this.float32[M+2]=T,i}}j_.prototype.bytesPerElement=12,Zt(j_,"StructArrayLayout2i4ub1f12");class ua extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h){const d=this.length;return this.resize(d+1),this.emplace(d,i,a,h)}emplace(i,a,h,d){const _=3*i;return this.float32[_+0]=a,this.float32[_+1]=h,this.float32[_+2]=d,i}}ua.prototype.bytesPerElement=12,Zt(ua,"StructArrayLayout3f12");class ju extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_){const g=this.length;return this.resize(g+1),this.emplace(g,i,a,h,d,_)}emplace(i,a,h,d,_,g){const b=6*i,T=3*i;return this.uint16[b+0]=a,this.uint16[b+1]=h,this.uint16[b+2]=d,this.uint16[b+3]=_,this.float32[T+2]=g,i}}ju.prototype.bytesPerElement=12,Zt(ju,"StructArrayLayout4ui1f12");class uf extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,h,d){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,h,d)}emplace(i,a,h,d,_){const g=4*i;return this.uint16[g+0]=a,this.uint16[g+1]=h,this.uint16[g+2]=d,this.uint16[g+3]=_,i}}uf.prototype.bytesPerElement=8,Zt(uf,"StructArrayLayout4ui8");class $_ extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,a,h,d,_,g)}emplace(i,a,h,d,_,g,b){const T=6*i;return this.int16[T+0]=a,this.int16[T+1]=h,this.int16[T+2]=d,this.int16[T+3]=_,this.int16[T+4]=g,this.int16[T+5]=b,i}}$_.prototype.bytesPerElement=12,Zt($_,"StructArrayLayout6i12");class Ny extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_,g,b,T,S,P,M,L){const N=this.length;return this.resize(N+1),this.emplace(N,i,a,h,d,_,g,b,T,S,P,M,L)}emplace(i,a,h,d,_,g,b,T,S,P,M,L,N){const B=12*i;return this.int16[B+0]=a,this.int16[B+1]=h,this.int16[B+2]=d,this.int16[B+3]=_,this.uint16[B+4]=g,this.uint16[B+5]=b,this.uint16[B+6]=T,this.uint16[B+7]=S,this.int16[B+8]=P,this.int16[B+9]=M,this.int16[B+10]=L,this.int16[B+11]=N,i}}Ny.prototype.bytesPerElement=24,Zt(Ny,"StructArrayLayout4i4ui4i24");class By extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,a,h,d,_,g)}emplace(i,a,h,d,_,g,b){const T=10*i,S=5*i;return this.int16[T+0]=a,this.int16[T+1]=h,this.int16[T+2]=d,this.float32[S+2]=_,this.float32[S+3]=g,this.float32[S+4]=b,i}}By.prototype.bytesPerElement=20,Zt(By,"StructArrayLayout3i3f20");class $l extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,d){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,h,d)}emplace(i,a,h,d,_){const g=4*i;return this.float32[g+0]=a,this.float32[g+1]=h,this.float32[g+2]=d,this.float32[g+3]=_,i}}$l.prototype.bytesPerElement=16,Zt($l,"StructArrayLayout4f16");class hf extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint32[1*i+0]=a,i}}hf.prototype.bytesPerElement=4,Zt(hf,"StructArrayLayout1ul4");class Ds extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a){const h=this.length;return this.resize(h+1),this.emplace(h,i,a)}emplace(i,a,h){const d=2*i;return this.uint16[d+0]=a,this.uint16[d+1]=h,i}}Ds.prototype.bytesPerElement=4,Zt(Ds,"StructArrayLayout2ui4");class df extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_,g,b,T,S,P,M,L,N){const B=this.length;return this.resize(B+1),this.emplace(B,i,a,h,d,_,g,b,T,S,P,M,L,N)}emplace(i,a,h,d,_,g,b,T,S,P,M,L,N,B){const W=20*i,X=10*i;return this.int16[W+0]=a,this.int16[W+1]=h,this.int16[W+2]=d,this.int16[W+3]=_,this.int16[W+4]=g,this.float32[X+3]=b,this.float32[X+4]=T,this.float32[X+5]=S,this.float32[X+6]=P,this.int16[W+14]=M,this.uint32[X+8]=L,this.uint16[W+18]=N,this.uint16[W+19]=B,i}}df.prototype.bytesPerElement=40,Zt(df,"StructArrayLayout5i4f1i1ul2ui40");class G_ extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_,g,b){const T=this.length;return this.resize(T+1),this.emplace(T,i,a,h,d,_,g,b)}emplace(i,a,h,d,_,g,b,T){const S=8*i;return this.int16[S+0]=a,this.int16[S+1]=h,this.int16[S+2]=d,this.int16[S+4]=_,this.int16[S+5]=g,this.int16[S+6]=b,this.int16[S+7]=T,i}}G_.prototype.bytesPerElement=16,Zt(G_,"StructArrayLayout3i2i2i16");class Vy extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_){const g=this.length;return this.resize(g+1),this.emplace(g,i,a,h,d,_)}emplace(i,a,h,d,_,g){const b=4*i,T=8*i;return this.float32[b+0]=a,this.float32[b+1]=h,this.float32[b+2]=d,this.int16[T+6]=_,this.int16[T+7]=g,i}}Vy.prototype.bytesPerElement=16,Zt(Vy,"StructArrayLayout2f1f2i16");class Uy extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,a,h,d,_,g)}emplace(i,a,h,d,_,g,b){const T=20*i,S=5*i;return this.uint8[T+0]=a,this.uint8[T+1]=h,this.float32[S+1]=d,this.float32[S+2]=_,this.float32[S+3]=g,this.float32[S+4]=b,i}}Uy.prototype.bytesPerElement=20,Zt(Uy,"StructArrayLayout2ub4f20");class Us extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,h){const d=this.length;return this.resize(d+1),this.emplace(d,i,a,h)}emplace(i,a,h,d){const _=3*i;return this.uint16[_+0]=a,this.uint16[_+1]=h,this.uint16[_+2]=d,i}}Us.prototype.bytesPerElement=6,Zt(Us,"StructArrayLayout3ui6");class Mp extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_,g,b,T,S,P,M,L,N,B,W,X,Z,ne,se,le,Ee){const Ie=this.length;return this.resize(Ie+1),this.emplace(Ie,i,a,h,d,_,g,b,T,S,P,M,L,N,B,W,X,Z,ne,se,le,Ee)}emplace(i,a,h,d,_,g,b,T,S,P,M,L,N,B,W,X,Z,ne,se,le,Ee,Ie){const Re=30*i,Ne=15*i,je=60*i;return this.int16[Re+0]=a,this.int16[Re+1]=h,this.int16[Re+2]=d,this.float32[Ne+2]=_,this.float32[Ne+3]=g,this.uint16[Re+8]=b,this.uint16[Re+9]=T,this.uint32[Ne+5]=S,this.uint32[Ne+6]=P,this.uint32[Ne+7]=M,this.uint16[Re+16]=L,this.uint16[Re+17]=N,this.uint16[Re+18]=B,this.float32[Ne+10]=W,this.float32[Ne+11]=X,this.uint8[je+48]=Z,this.uint8[je+49]=ne,this.uint8[je+50]=se,this.uint32[Ne+13]=le,this.int16[Re+28]=Ee,this.uint8[je+58]=Ie,i}}Mp.prototype.bytesPerElement=60,Zt(Mp,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class jy extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_,g,b,T,S,P,M,L,N,B,W,X,Z,ne,se,le,Ee,Ie,Re,Ne,je,ft,We,mt,St,gt,wt,Rt,ut){const Tt=this.length;return this.resize(Tt+1),this.emplace(Tt,i,a,h,d,_,g,b,T,S,P,M,L,N,B,W,X,Z,ne,se,le,Ee,Ie,Re,Ne,je,ft,We,mt,St,gt,wt,Rt,ut)}emplace(i,a,h,d,_,g,b,T,S,P,M,L,N,B,W,X,Z,ne,se,le,Ee,Ie,Re,Ne,je,ft,We,mt,St,gt,wt,Rt,ut,Tt){const rt=20*i,et=40*i,Pt=80*i;return this.float32[rt+0]=a,this.float32[rt+1]=h,this.int16[et+4]=d,this.int16[et+5]=_,this.int16[et+6]=g,this.int16[et+7]=b,this.int16[et+8]=T,this.int16[et+9]=S,this.int16[et+10]=P,this.int16[et+11]=M,this.int16[et+12]=L,this.uint16[et+13]=N,this.uint16[et+14]=B,this.uint16[et+15]=W,this.uint16[et+16]=X,this.uint16[et+17]=Z,this.uint16[et+18]=ne,this.uint16[et+19]=se,this.uint16[et+20]=le,this.uint16[et+21]=Ee,this.uint16[et+22]=Ie,this.uint16[et+23]=Re,this.uint16[et+24]=Ne,this.uint16[et+25]=je,this.uint16[et+26]=ft,this.uint16[et+27]=We,this.uint32[rt+14]=mt,this.float32[rt+15]=St,this.float32[rt+16]=gt,this.float32[rt+17]=wt,this.float32[rt+18]=Rt,this.uint8[Pt+76]=ut,this.uint16[et+39]=Tt,i}}jy.prototype.bytesPerElement=80,Zt(jy,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class kp extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,a,h,d,_,g)}emplace(i,a,h,d,_,g,b){const T=6*i;return this.float32[T+0]=a,this.float32[T+1]=h,this.float32[T+2]=d,this.float32[T+3]=_,this.float32[T+4]=g,this.float32[T+5]=b,i}}kp.prototype.bytesPerElement=24,Zt(kp,"StructArrayLayout6f24");class Jh extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_){const g=this.length;return this.resize(g+1),this.emplace(g,i,a,h,d,_)}emplace(i,a,h,d,_,g){const b=5*i;return this.float32[b+0]=a,this.float32[b+1]=h,this.float32[b+2]=d,this.float32[b+3]=_,this.float32[b+4]=g,i}}Jh.prototype.bytesPerElement=20,Zt(Jh,"StructArrayLayout5f20");class $y extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_,g,b){const T=this.length;return this.resize(T+1),this.emplace(T,i,a,h,d,_,g,b)}emplace(i,a,h,d,_,g,b,T){const S=7*i;return this.float32[S+0]=a,this.float32[S+1]=h,this.float32[S+2]=d,this.float32[S+3]=_,this.float32[S+4]=g,this.float32[S+5]=b,this.float32[S+6]=T,i}}$y.prototype.bytesPerElement=28,Zt($y,"StructArrayLayout7f28");class H_ extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_,g,b,T,S,P,M){const L=this.length;return this.resize(L+1),this.emplace(L,i,a,h,d,_,g,b,T,S,P,M)}emplace(i,a,h,d,_,g,b,T,S,P,M,L){const N=11*i;return this.float32[N+0]=a,this.float32[N+1]=h,this.float32[N+2]=d,this.float32[N+3]=_,this.float32[N+4]=g,this.float32[N+5]=b,this.float32[N+6]=T,this.float32[N+7]=S,this.float32[N+8]=P,this.float32[N+9]=M,this.float32[N+10]=L,i}}H_.prototype.bytesPerElement=44,Zt(H_,"StructArrayLayout11f44");class Dp extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_,g,b,T,S){const P=this.length;return this.resize(P+1),this.emplace(P,i,a,h,d,_,g,b,T,S)}emplace(i,a,h,d,_,g,b,T,S,P){const M=9*i;return this.float32[M+0]=a,this.float32[M+1]=h,this.float32[M+2]=d,this.float32[M+3]=_,this.float32[M+4]=g,this.float32[M+5]=b,this.float32[M+6]=T,this.float32[M+7]=S,this.float32[M+8]=P,i}}Dp.prototype.bytesPerElement=36,Zt(Dp,"StructArrayLayout9f36");class ff extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a){const h=this.length;return this.resize(h+1),this.emplace(h,i,a)}emplace(i,a,h){const d=2*i;return this.float32[d+0]=a,this.float32[d+1]=h,i}}ff.prototype.bytesPerElement=8,Zt(ff,"StructArrayLayout2f8");class q_ extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,h,d){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,h,d)}emplace(i,a,h,d,_){const g=6*i;return this.uint32[3*i+0]=a,this.uint16[g+2]=h,this.uint16[g+3]=d,this.uint16[g+4]=_,i}}q_.prototype.bytesPerElement=12,Zt(q_,"StructArrayLayout1ul3ui12");class W_ extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint16[1*i+0]=a,i}}W_.prototype.bytesPerElement=2,Zt(W_,"StructArrayLayout1ui2");class Gy extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_,g,b,T,S,P,M,L,N,B,W,X){const Z=this.length;return this.resize(Z+1),this.emplace(Z,i,a,h,d,_,g,b,T,S,P,M,L,N,B,W,X)}emplace(i,a,h,d,_,g,b,T,S,P,M,L,N,B,W,X,Z){const ne=16*i;return this.float32[ne+0]=a,this.float32[ne+1]=h,this.float32[ne+2]=d,this.float32[ne+3]=_,this.float32[ne+4]=g,this.float32[ne+5]=b,this.float32[ne+6]=T,this.float32[ne+7]=S,this.float32[ne+8]=P,this.float32[ne+9]=M,this.float32[ne+10]=L,this.float32[ne+11]=N,this.float32[ne+12]=B,this.float32[ne+13]=W,this.float32[ne+14]=X,this.float32[ne+15]=Z,i}}Gy.prototype.bytesPerElement=64,Zt(Gy,"StructArrayLayout16f64");class pf extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,h,d,_,g,b){const T=this.length;return this.resize(T+1),this.emplace(T,i,a,h,d,_,g,b)}emplace(i,a,h,d,_,g,b,T){const S=10*i,P=5*i;return this.uint16[S+0]=a,this.uint16[S+1]=h,this.uint16[S+2]=d,this.uint16[S+3]=_,this.float32[P+2]=g,this.float32[P+3]=b,this.float32[P+4]=T,i}}pf.prototype.bytesPerElement=20,Zt(pf,"StructArrayLayout4ui3f20");class mf extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.int16[1*i+0]=a,i}}mf.prototype.bytesPerElement=2,Zt(mf,"StructArrayLayout1i2");class X_ extends Sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint8[1*i+0]=a,i}}X_.prototype.bytesPerElement=1,Zt(X_,"StructArrayLayout1ub1");class Sb extends cf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Sb.prototype.size=40;class Hy extends df{get(i){return new Sb(this,i)}}Zt(Hy,"CollisionBoxArray");class Ab extends cf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}Ab.prototype.size=60;class Z_ extends Mp{get(i){return new Ab(this,i)}}Zt(Z_,"PlacedSymbolArray");class Cb extends cf{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(i){this._structArray.uint32[this._pos4+14]=i}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(i){this._structArray.float32[this._pos4+18]=i}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Cb.prototype.size=80;class Rb extends jy{get(i){return new Cb(this,i)}}Zt(Rb,"SymbolInstanceArray");class Pb extends Uu{getoffsetX(i){return this.float32[1*i+0]}}Zt(Pb,"GlyphOffsetArray");class Mb extends Vu{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Zt(Mb,"SymbolLineVertexArray");class qy extends cf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}qy.prototype.size=12;class kb extends q_{get(i){return new qy(this,i)}}Zt(kb,"FeatureIndexArray");class Db extends Ds{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Zt(Db,"FillExtrusionCentroidArray");class Lb extends cf{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Lb.prototype.size=6;class Ob extends Kh{get(i){return new Lb(this,i)}}Zt(Ob,"FillExtrusionWallArray");const vI=xr([{name:"a_pos",components:2,type:"Int16"}],4),xI=xr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),bI=xr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class jn{constructor(i=[]){this.segments=i}_prepareSegment(i,a,h,d){let _=this.segments[this.segments.length-1];return i>jn.MAX_VERTEX_ARRAY_LENGTH&&Ji(`Max vertices per segment is ${jn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!_||_.vertexLength+i>jn.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==d)&&(_={vertexOffset:a,primitiveOffset:h,vertexLength:0,primitiveLength:0},d!==void 0&&(_.sortKey=d),this.segments.push(_)),_}prepareSegment(i,a,h,d){return this._prepareSegment(i,a.length,h.length,d)}get(){return this.segments}destroy(){for(const i of this.segments)for(const a in i.vaos)i.vaos[a].destroy()}static simpleSegment(i,a,h,d){return new jn([{vertexOffset:i,primitiveOffset:a,vertexLength:h,primitiveLength:d,vaos:{},sortKey:0}])}}function Lp(l,i){return 256*(l=fe(Math.floor(l),0,255))+fe(Math.floor(i),0,255)}jn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt(jn,"SegmentVector");const wI=xr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),TI=xr([{name:"a_pattern_b",components:4,type:"Uint16"}]),K_=xr([{name:"a_dash",components:4,type:"Uint16"}]);class Op{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(i,a,h,d){this.ids.push(Wy(i)),this.positions.push(a,h,d)}eachPosition(i,a){const h=Wy(i);let d=0,_=this.ids.length-1;for(;d<_;){const g=d+_>>1;this.ids[g]>=h?_=g:d=g+1}for(;this.ids[d]===h;)a(this.positions[3*d],this.positions[3*d+1],this.positions[3*d+2]),d++}static serialize(i,a){const h=new Float64Array(i.ids),d=new Uint32Array(i.positions);return Xy(h,d,0,h.length-1),a&&(a.add(h.buffer),a.add(d.buffer)),{ids:h,positions:d}}static deserialize(i){const a=new Op;let h;a.ids=i.ids,a.positions=i.positions;for(const d of a.ids)d!==h&&a.uniqueIds.push(d),h=d;return a.indexed=!0,a}}function Wy(l){const i=+l;return Number.isSafeInteger(i)?i:Rh(String(l))}function Xy(l,i,a,h){for(;a<h;){const d=l[a+h>>1];let _=a-1,g=h+1;for(;;){do _++;while(l[_]<d);do g--;while(l[g]>d);if(_>=g)break;Fp(l,_,g),Fp(i,3*_,3*g),Fp(i,3*_+1,3*g+1),Fp(i,3*_+2,3*g+2)}g-a<h-g?(Xy(l,i,a,g),a=g+1):(Xy(l,i,g+1,h),h=g)}}function Fp(l,i,a){const h=l[i];l[i]=l[a],l[a]=h}Zt(Op,"FeaturePositionMap");class xc{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,a),this.initialized=!0),!!this.location}set(i,a,h){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class zp extends xc{constructor(i){super(i),this.current=0}set(i,a,h){this.fetchUniformLocation(i,a)&&this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}}class ys extends xc{constructor(i){super(i),this.current=0}set(i,a,h){this.fetchUniformLocation(i,a)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class bc extends xc{constructor(i){super(i),this.current=[0,0]}set(i,a,h){this.fetchUniformLocation(i,a)&&(h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1])))}}class Np extends xc{constructor(i){super(i),this.current=[0,0,0]}set(i,a,h){this.fetchUniformLocation(i,a)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2])))}}class Bp extends xc{constructor(i){super(i),this.current=[0,0,0,0]}set(i,a,h){this.fetchUniformLocation(i,a)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class Fb extends xc{constructor(i){super(i),this.current=Mr.transparent.toPremultipliedRenderColor(null)}set(i,a,h){this.fetchUniformLocation(i,a)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const EI=new Float32Array(16);class Vp extends xc{constructor(i){super(i),this.current=EI}set(i,a,h){if(this.fetchUniformLocation(i,a)){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let d=1;d<16;d++)if(h[d]!==this.current[d]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}}}const II=new Float32Array(9),SI=new Float32Array(4);class Y_ extends xc{constructor(i){super(i),this.current=SI}set(i,a,h){if(this.fetchUniformLocation(i,a)){for(let d=0;d<4;d++)if(h[d]!==this.current[d]){this.current=h,this.gl.uniformMatrix2fv(this.location,!1,h);break}}}}function Up(l){return[Lp(255*l.r,255*l.g),Lp(255*l.b,255*l.a)]}class tl{constructor(i,a,h,d){this.value=i,this.uniformNames=a.map(_=>`u_${_}`),this.type=h,this.context=d}setUniform(i,a,h,d,_){const g=d.constantOr(this.value);a.set(i,_,g instanceof Mr?g.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):g)}getBinding(i,a){return this.type==="color"?new Fb(i):new ys(i)}}class Qh{constructor(i,a){this.uniformNames=a.map(h=>`u_${h}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(i,a){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br),this.patternTransition=a?a.tl.concat(a.br):this.pattern}setUniform(i,a,h,d,_){let g=null;_!=="u_pattern"&&_!=="u_dash"||(g=this.pattern),_==="u_pattern_b"&&(g=this.patternTransition),_==="u_pixel_ratio"&&(g=this.pixelRatio),g&&a.set(i,_,g)}getBinding(i,a){return a==="u_pattern"||a==="u_pattern_b"||a==="u_dash"?new Bp(i):new ys(i)}}class $u{constructor(i,a,h,d){this.expression=i,this.type=h,this.maxValue=0,this.paintVertexAttributes=a.map(_=>({name:`a_${_}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(i,a,h,d,_,g,b,T){const S=this.paintVertexArray.length,P=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new gn(0,{brightness:g,worldview:T}),a,{},_,d,b):this.expression.kind==="constant"&&this.expression.value,M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new gn(0,{brightness:g,worldview:T}),a,{},_,d,b):this.lutExpression.value)==="none";this.paintVertexArray.resize(i),this._setPaintValue(S,i,P,M?null:this.context.lut)}updatePaintArray(i,a,h,d,_,g,b,T){const S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:b,worldview:T},h,d,void 0,_):this.expression.kind==="constant"&&this.expression.value,P=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new gn(0,{brightness:b,worldview:T}),h,d,void 0,_):this.lutExpression.value)==="none";this._setPaintValue(i,a,S,P?null:this.context.lut)}_setPaintValue(i,a,h,d){if(this.type==="color"){const _=Up(h.toPremultipliedRenderColor(d));for(let g=i;g<a;g++)this.paintVertexArray.emplace(g,_[0],_[1])}else{for(let _=i;_<a;_++)this.paintVertexArray.emplace(_,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Yc{constructor(i,a,h,d,_,g){this.expression=i,this.uniformNames=a.map(b=>`u_${b}_t`),this.type=h,this.useIntegerZoom=d,this.context=_,this.maxValue=0,this.paintVertexAttributes=a.map(b=>({name:`a_${b}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,a,h,d,_,g,b,T){const S=this.expression.evaluate(new gn(this.context.zoom,{brightness:g,worldview:T}),a,{},_,d,b),P=this.expression.evaluate(new gn(this.context.zoom+1,{brightness:g,worldview:T}),a,{},_,d,b),M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new gn(0,{brightness:g,worldview:T}),a,{},_,d,b):this.lutExpression.value)==="none",L=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(L,i,S,P,M?null:this.context.lut)}updatePaintArray(i,a,h,d,_,g,b,T){const S=this.expression.evaluate({zoom:this.context.zoom,brightness:b,worldview:T},h,d,void 0,_),P=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b,worldview:T},h,d,void 0,_),M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new gn(0,{brightness:b,worldview:T}),h,d,void 0,_):this.lutExpression.value)==="none";this._setPaintValue(i,a,S,P,M?null:this.context.lut)}_setPaintValue(i,a,h,d,_){if(this.type==="color"){const g=Up(h.toPremultipliedRenderColor(_)),b=Up(h.toPremultipliedRenderColor(_));for(let T=i;T<a;T++)this.paintVertexArray.emplace(T,g[0],g[1],b[0],b[1])}else{for(let g=i;g<a;g++)this.paintVertexArray.emplace(g,h,d);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(d))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,a,h,d,_){const g=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,b=fe(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);a.set(i,_,b)}getBinding(i,a){return new ys(i)}}class Jc{constructor(i,a,h,d,_){this.expression=i,this.layerId=_,this.paintVertexAttributes=(h==="array"?K_:wI).members;for(let g=0;g<a.length;++g);this.paintVertexArray=new d,this.paintTransitionVertexArray=new uf}populatePaintArray(i,a,h,d){const _=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(_,i,a.patterns&&a.patterns[this.layerId],h)}updatePaintArray(i,a,h,d,_,g,b){this._setPaintValues(i,a,h.patterns&&h.patterns[this.layerId],g)}_setPaintValues(i,a,h,d){if(!d||!h)return;const _=d[h[0]],g=d[h[1]];if(_){if(_){const{tl:b,br:T,pixelRatio:S}=_;for(let P=i;P<a;P++)this.paintVertexArray.emplace(P,b[0],b[1],T[0],T[1],S)}if(g){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:b,br:T}=g;for(let S=i;S<a;S++)this.paintTransitionVertexArray.emplace(S,b[0],b[1],T[0],T[1])}}}upload(i){const a=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,a)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=i.createVertexBuffer(this.paintTransitionVertexArray,TI.members,a))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class ed{constructor(i,a,h=()=>!0){this.binders={},this._buffers=[],this.context=a;const d=[];for(const _ in i.paint._values){const g=i.paint.get(_);if(_.endsWith("-use-theme")||!h(_)||!(g instanceof Wh&&I_(g.property.specification)))continue;const b=SP(_,i.type),T=g.value,S=g.property.specification.type,P=!!g.property.useIntegerZoom,M=_==="line-dasharray"||_.endsWith("pattern"),L=i.paint.get(`${_}-use-theme`),N=_==="line-dasharray"&&i.layout.get("line-cap").value.kind!=="constant"||L&&L.value.kind!=="constant";if(T.kind!=="constant"||N)if(T.kind==="source"||N||M){const B=u(_,S,"source");this.binders[_]=M?new Jc(T,b,S,B,i.id):new $u(T,b,S,B),d.push(`/a_${_}`)}else{const B=u(_,S,"composite");this.binders[_]=new Yc(T,b,S,P,a,B),d.push(`/z_${_}`)}else this.binders[_]=M?new Qh(T.value,b):new tl(T.value,b,S,a),d.push(`/u_${_}`);L&&(this.binders[_].lutExpression=L.value)}this.cacheKey=d.sort().join("")}getMaxValue(i){const a=this.binders[i];return a instanceof $u||a instanceof Yc?a.maxValue:0}populatePaintArrays(i,a,h,d,_,g,b,T){for(const S in this.binders){const P=this.binders[S];P.context=this.context,(P instanceof $u||P instanceof Yc||P instanceof Jc)&&P.populatePaintArray(i,a,h,d,_,g,b,T)}}setConstantPatternPositions(i,a){for(const h in this.binders){const d=this.binders[h];d instanceof Qh&&d.setConstantPatternPositions(i,a)}}getPatternTransitionVertexBuffer(i){const a=this.binders[i];return a instanceof Jc?a.paintTransitionVertexBuffer:null}updatePaintArrays(i,a,h,d,_,g,b,T,S,P){let M=!1;const L=Object.keys(i),N=L.length!==0&&!T,B=N?L:a.uniqueIds;this.context.lut=_.lut;for(const W in this.binders){const X=this.binders[W];if(X.context=this.context,(X instanceof $u||X instanceof Yc||X instanceof Jc)&&X.expression&&X.expression.kind&&X.expression.kind!=="constant"&&(X.expression.isStateDependent===!0||X.expression.isLightConstant===!1)){const Z=_.paint.get(W);X.expression=Z.value;for(const ne of B){const se=i[ne.toString()];a.eachPosition(ne,(le,Ee,Ie)=>{const Re=d.feature(le);X.updatePaintArray(Ee,Ie,Re,se,g,b,S,P)})}if(!N)for(const ne of h.uniqueIds){const se=i[ne.toString()];h.eachPosition(ne,(le,Ee,Ie)=>{const Re=d.feature(le);X.updatePaintArray(Ee,Ie,Re,se,g,b,S,P)})}M=!0}}return M}defines(){const i=[];for(const a in this.binders){const h=this.binders[a];(h instanceof tl||h instanceof Qh)&&i.push(...h.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const a=[];for(const h in this.binders){const d=this.binders[h];if(d instanceof tl||d instanceof Qh||d instanceof Yc)for(const _ of d.uniformNames)a.push({name:_,property:h,binding:d.getBinding(i,_)})}return a}setUniforms(i,a,h,d,_){for(const{name:g,property:b,binding:T}of h)this.binders[b].setUniform(i,T,_,d.get(b),g)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const a=this.binders[i];(a instanceof $u||a instanceof Yc||a instanceof Jc)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer),a instanceof Jc&&a.paintTransitionVertexBuffer&&this._buffers.push(a.paintTransitionVertexBuffer)}}upload(i){for(const a in this.binders){const h=this.binders[a];(h instanceof $u||h instanceof Yc||h instanceof Jc)&&h.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const a=this.binders[i];(a instanceof $u||a instanceof Yc||a instanceof Jc)&&a.destroy()}}}class Gl{constructor(i,a,h=()=>!0){this.programConfigurations={};for(const d of i)this.programConfigurations[d.id]=new ed(d,a,h);this.needsUpload=!1,this._featureMap=new Op,this._featureMapWithoutIds=new Op,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(i,a,h,d,_,g,b,T,S){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(i,a,d,_,g,b,T,S);a.id!==void 0?this._featureMap.add(a.id,h,this._bufferOffset,i):(this._featureMapWithoutIds.add(this._idlessCounter,h,this._bufferOffset,i),this._idlessCounter+=1),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,a,h,d,_,g,b,T){for(const S of h)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(i,this._featureMap,this._featureMapWithoutIds,a,S,d,_,g,b||0,T)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const zb={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function SP(l,i){return zb[l]||[l.replace(`${i}-`,"").replace(/-/g,"_")]}const m={"line-pattern":{source:ju,composite:ju},"fill-pattern":{source:ju,composite:ju},"fill-extrusion-pattern":{source:ju,composite:ju},"line-dasharray":{source:uf,composite:uf}},n={color:{source:ff,composite:$l},number:{source:Uu,composite:ff}};function u(l,i,a){const h=m[l];return h&&h[a]||n[i][a]}Zt(tl,"ConstantBinder"),Zt(Qh,"PatternConstantBinder"),Zt($u,"SourceExpressionBinder"),Zt(Jc,"PatternCompositeBinder"),Zt(Yc,"CompositeExpressionBinder"),Zt(ed,"ProgramConfiguration",{omit:["_buffers"]}),Zt(Gl,"ProgramConfigurationSet");const p=Ft/Math.PI/2,v=5,x=6,w=16383,I=64,C=[I,32,16],D=-p,F=p;function V(l,i,a,h=p){return a=Pe(a),[l*Math.sin(a)*h,-i*h,l*Math.cos(a)*h]}function z(l,i,a){return V(Math.cos(Pe(l)),Math.sin(Pe(l)),i,a)}const j=63710088e-1,G=2*Math.PI*j;class H{constructor(i,a){if(isNaN(i)||isNaN(a))throw new Error(`Invalid LngLat object: (${i}, ${a})`);if(this.lng=+i,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new H(ze(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const a=Math.PI/180,h=this.lat*a,d=i.lat*a,_=Math.sin(h)*Math.sin(d)+Math.cos(h)*Math.cos(d)*Math.cos((i.lng-this.lng)*a);return j*Math.acos(Math.min(_,1))}toBounds(i=0){const a=360*i/40075017,h=a/Math.cos(Math.PI/180*this.lat);return new ee({lng:this.lng-h,lat:this.lat-a},{lng:this.lng+h,lat:this.lat+a})}toEcef(i){return z(this.lat,this.lng,p+i*p/j)}static convert(i){if(i instanceof H)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new H(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new H(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ee{constructor(i,a){i&&(a?this.setSouthWest(i).setNorthEast(a):Array.isArray(i)&&i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof H?new H(i.lng,i.lat):H.convert(i),this}setSouthWest(i){return this._sw=i instanceof H?new H(i.lng,i.lat):H.convert(i),this}extend(i){const a=this._sw,h=this._ne;let d,_;if(i instanceof H)d=i,_=i;else{if(!(i instanceof ee))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(ee.convert(i)):this.extend(H.convert(i)):typeof i=="object"&&i!==null&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(H.convert(i)):this;if(d=i._sw,_=i._ne,!d||!_)return this}return a||h?(a.lng=Math.min(d.lng,a.lng),a.lat=Math.min(d.lat,a.lat),h.lng=Math.max(_.lng,h.lng),h.lat=Math.max(_.lat,h.lat)):(this._sw=new H(d.lng,d.lat),this._ne=new H(_.lng,_.lat)),this}getCenter(){return new H((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new H(this.getWest(),this.getNorth())}getSouthEast(){return new H(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:a,lat:h}=H.convert(i);let d=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&d}static convert(i){if(i)return i instanceof ee?i:new ee(i)}}const K=0,ie=25.5;function ae(l){return G*Math.cos(l*Math.PI/180)}function ce(l){return(180+l)/360}function ve(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function _e(l,i){return l/ae(i)}function xe(l){return 360*l-180}function ge(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function pe(l,i){return l*ae(ge(i))}const we=85.051129;function Je(l){return Math.cos(Pe(fe(l,-we,we)))}function $e(l,i){const a=fe(i,K,ie),h=Math.pow(2,a);return Je(l)*G/(512*h)}function ot(l){return 1/Math.cos(l*Math.PI/180)}function Xe(l,i=0){const a=Math.exp(Math.PI*(1-(l.y+i/Ft)/(1<<l.z)*2));return 80150034*a/(a*a+1)/Ft/(1<<l.z)}class nt{constructor(i,a,h=0){this.x=+i,this.y=+a,this.z=+h}static fromLngLat(i,a=0){const h=H.convert(i);return new nt(ce(h.lng),ve(h.lat),_e(a,h.lat))}toLngLat(){return new H(xe(this.x),ge(this.y))}toAltitude(){return pe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/G*ot(ge(this.y))}}function Dt(l,i,a,h,d,_,g,b,T){const S=(i+h)/2,P=(a+d)/2,M=new xt(S,P);b(M),function(L,N,B,W,X,Z){const ne=B-X,se=W-Z;return Math.abs((W-N)*ne-(B-L)*se)/Math.hypot(ne,se)}(M.x,M.y,_.x,_.y,g.x,g.y)>=T?(Dt(l,i,a,S,P,_,M,b,T),Dt(l,S,P,h,d,M,g,b,T)):l.push(g)}function Ye(l,i,a){let h=l[0],d=h.x,_=h.y;i(h);const g=[h];for(let b=1;b<l.length;b++){const T=l[b],{x:S,y:P}=T;i(T),Dt(g,d,_,S,P,h,T,i,a),d=S,_=P,h=T}return g}function De(l,i,a,h){if(h(i,a)){const d=i.add(a)._mult(.5);De(l,i,d,h),De(l,d,a,h)}else l.push(a)}function ct(l,i){let a=l[0];const h=[a];for(let d=1;d<l.length;d++){const _=l[d];De(h,a,_,i),a=_}return h}const tt=Math.pow(2,14)-1,bt=-tt-1;function kt(l,i){const a=Math.round(l.x*i),h=Math.round(l.y*i);return l.x=fe(a,bt,tt),l.y=fe(h,bt,tt),(a<l.x||a>l.x+1||h<l.y||h>l.y+1)&&Ji("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function $t(l,i,a){const h=l.loadGeometry(),d=l.extent,_=Ft/d;if(i&&a&&a.projection.isReprojectedInTileSpace){const g=1<<i.z,{scale:b,x:T,y:S,projection:P}=a,M=L=>{const N=xe((i.x+L.x/d)/g),B=ge((i.y+L.y/d)/g),W=P.project(N,B);L.x=(W.x*b-T)*d,L.y=(W.y*b-S)*d};for(let L=0;L<h.length;L++)if(l.type!==1)h[L]=Ye(h[L],M,1);else{const N=[];for(const B of h[L])B.x<0||B.x>=d||B.y<0||B.y>=d||(M(B),N.push(B));h[L]=N}}for(const g of h)for(const b of g)kt(b,_);return h}function Ct(l,i){return{type:l.type,id:l.id,properties:l.properties,geometry:i?$t(l):[]}}class It{constructor(i,a,h,d,_){this.properties={},this.extent=h,this.type=0,this.id=void 0,this._pbf=i,this._geometry=-1,this._keys=d,this._values=_,i.readFields(fi,this,a)}loadGeometry(){const i=this._pbf;i.pos=this._geometry;const a=i.readVarint()+i.pos,h=[];let d,_=1,g=0,b=0,T=0;for(;i.pos<a;){if(g<=0){const S=i.readVarint();_=7&S,g=S>>3}if(g--,_===1||_===2)b+=i.readSVarint(),T+=i.readSVarint(),_===1&&(d&&h.push(d),d=[]),d&&d.push(new xt(b,T));else{if(_!==7)throw new Error(`unknown command ${_}`);d&&d.push(d[0].clone())}}return d&&h.push(d),h}bbox(){const i=this._pbf;i.pos=this._geometry;const a=i.readVarint()+i.pos;let h=1,d=0,_=0,g=0,b=1/0,T=-1/0,S=1/0,P=-1/0;for(;i.pos<a;){if(d<=0){const M=i.readVarint();h=7&M,d=M>>3}if(d--,h===1||h===2)_+=i.readSVarint(),g+=i.readSVarint(),_<b&&(b=_),_>T&&(T=_),g<S&&(S=g),g>P&&(P=g);else if(h!==7)throw new Error(`unknown command ${h}`)}return[b,S,T,P]}toGeoJSON(i,a,h){const d=this.extent*Math.pow(2,h),_=this.extent*i,g=this.extent*a,b=this.loadGeometry();function T(L){return[360*(L.x+_)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(L.y+g)/d)*Math.PI))-90]}function S(L){return L.map(T)}let P;if(this.type===1){const L=[];for(const B of b)L.push(B[0]);const N=S(L);P=L.length===1?{type:"Point",coordinates:N[0]}:{type:"MultiPoint",coordinates:N}}else if(this.type===2){const L=b.map(S);P=L.length===1?{type:"LineString",coordinates:L[0]}:{type:"MultiLineString",coordinates:L}}else{if(this.type!==3)throw new Error("unknown feature type");{const L=function(B){const W=B.length;if(W<=1)return[B];const X=[];let Z,ne;for(let se=0;se<W;se++){const le=li(B[se]);le!==0&&(ne===void 0&&(ne=le<0),ne===le<0?(Z&&X.push(Z),Z=[B[se]]):Z&&Z.push(B[se]))}return Z&&X.push(Z),X}(b),N=[];for(const B of L)N.push(B.map(S));P=N.length===1?{type:"Polygon",coordinates:N[0]}:{type:"MultiPolygon",coordinates:N}}}const M={type:"Feature",geometry:P,properties:this.properties};return this.id!=null&&(M.id=this.id),M}}function fi(l,i,a){l===1?i.id=a.readVarint():l===2?function(h,d){const _=h.readVarint()+h.pos;for(;h.pos<_;){const g=d._keys[h.readVarint()],b=d._values[h.readVarint()];d.properties[g]=b}}(a,i):l===3?i.type=a.readVarint():l===4&&(i._geometry=a.pos)}function li(l){let i=0;for(let a,h,d=0,_=l.length,g=_-1;d<_;g=d++)a=l[d],h=l[g],i+=(h.x-a.x)*(a.y+h.y);return i}It.types=["Unknown","Point","LineString","Polygon"];class di{constructor(i,a){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(oi,this,a),this.length=this._features.length}feature(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];const a=this._pbf.readVarint()+this._pbf.pos;return new It(this._pbf,a,this.extent,this._keys,this._values)}}function oi(l,i,a){l===15?i.version=a.readVarint():l===1?i.name=a.readString():l===5?i.extent=a.readVarint():l===2?i._features.push(a.pos):l===3?i._keys.push(a.readString()):l===4&&i._values.push(function(h){let d=null;const _=h.readVarint()+h.pos;for(;h.pos<_;){const g=h.readVarint()>>3;d=g===1?h.readString():g===2?h.readFloat():g===3?h.readDouble():g===4?h.readVarint64():g===5?h.readVarint():g===6?h.readSVarint():g===7?h.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d}(a))}class Vi{constructor(i,a){this.layers=i.readFields(Ki,{},a)}}function Ki(l,i,a){if(l===3){const h=new di(a,a.readVarint()+a.pos);h.length&&(i[h.name]=h)}}const Qi="3d_elevation_id",Zr="level";class Gi{constructor(){this._valid=!1}reset(i){return this.feature=i,this._valid=!0,this._geometry=i.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(i,a){return this._valid&&i(a(this._geometry)),this}require(i,a,h){return this.get(i,!0,a,h)}optional(i,a,h){return this.get(i,!1,a,h)}success(){return this._valid}get(i,a,h,d){const _=this.feature.properties.hasOwnProperty(i)?+this.feature.properties[i]:void 0;return this._valid&&_!==void 0&&!Number.isNaN(_)?h(d?d(_):_):a&&(this._valid=!1),this}}class Lr{constructor(i,a){this.featureFunc=i,this.vertexFunc=a}parseFeature(i,a,h){return this.featureFunc(i,a,h)}parseVertex(i,a,h){return this.vertexFunc(i,a,h)}}const Wr=new Lr((l,i,a)=>l.reset(i).require(Qi,h=>{a.id=h}).optional("fixed_height_relative",h=>{a.constantHeight=h},Yi.decodeRelativeHeight).geometry(h=>{a.bounds=h},n_).success(),(l,i,a)=>l.reset(i).require(Qi,h=>{a.id=h}).require("elevation_idx",h=>{a.idx=h}).require("extent",h=>{a.extent=h}).require("height_relative",h=>{a.height=h},Yi.decodeRelativeHeight).geometry(h=>{a.position=h},Yi.getPoint).success()),An=new Lr((l,i,a)=>l.reset(i).require(Qi,h=>{a.id=h}).optional("fixed_height",h=>{a.constantHeight=h},Yi.decodeMetricHeight).geometry(h=>{a.bounds=h},n_).success(),(l,i,a)=>l.reset(i).require(Qi,h=>{a.id=h}).require("elevation_idx",h=>{a.idx=h}).require("extent",h=>{a.extent=h}).require("height",h=>{a.height=h},Yi.decodeMetricHeight).geometry(h=>{a.position=h},Yi.getPoint).success());class Yi{static getPoint(i){return _r(i[0][0].x,i[0][0].y)}static decodeRelativeHeight(i){return 1e-4*i*5}static decodeMetricHeight(i){return 1e-4*i}static getVersionSchema(i){return i?i==="1.0.1"?An:void 0:Wr}static parse(i){const a=[],h=[],d=i.length,_=new Gi;for(let g=0;g<d;g++){const b=i.feature(g),T=b.properties.version,S=Yi.getVersionSchema(T);if(S===void 0){Ji(`Unknown elevation feature version number ${T||"(unknown)"}`);continue}const P=b.properties.type;if(!P)continue;const M=It.types[b.type];if(M==="Point"&&P==="curve_point"){const L={};S.parseVertex(_,b,L)&&a.push(L)}else if(M==="Polygon"&&P==="curve_meta"){const L={};S.parseFeature(_,b,L)&&h.push(L)}}return{vertices:a,features:h}}}class Ur{constructor(i,a){this.pos=i,this.dir=a}intersectsPlane(i,a,h){const d=dr(a,this.dir);if(Math.abs(d)<1e-6)return!1;const _=((i[0]-this.pos[0])*a[0]+(i[1]-this.pos[1])*a[1])/d;return h[0]=this.pos[0]+this.dir[0]*_,h[1]=this.pos[1]+this.dir[1]*_,!0}}class zr{constructor(i,a){this.pos=i,this.dir=a}intersectsPlane(i,a,h){const d=vt(a,this.dir);if(Math.abs(d)<1e-6)return!1;const _=((i[0]-this.pos[0])*a[0]+(i[1]-this.pos[1])*a[1]+(i[2]-this.pos[2])*a[2])/d;return h[0]=this.pos[0]+this.dir[0]*_,h[1]=this.pos[1]+this.dir[1]*_,h[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(i,a,h){if(function(N,B){var W=N[0],X=N[1],Z=N[2],ne=B[0],se=B[1],le=B[2];return Math.abs(W-ne)<=E*Math.max(1,Math.abs(W),Math.abs(ne))&&Math.abs(X-se)<=E*Math.max(1,Math.abs(X),Math.abs(se))&&Math.abs(Z-le)<=E*Math.max(1,Math.abs(Z),Math.abs(le))}(this.pos,i)||a===0)return h[0]=h[1]=h[2]=0,!1;const[d,_,g]=this.dir,b=this.pos[0]-i[0],T=this.pos[1]-i[1],S=this.pos[2]-i[2],P=d*d+_*_+g*g,M=2*(b*d+T*_+S*g),L=M*M-4*P*(b*b+T*T+S*S-a*a);if(L<0){const N=Math.max(-M/2,0),B=b+d*N,W=T+_*N,X=S+g*N,Z=Math.hypot(B,W,X);return h[0]=B*a/Z,h[1]=W*a/Z,h[2]=X*a/Z,!1}{const N=(-M-Math.sqrt(L))/(2*P);if(N<0){const B=Math.hypot(b,T,S);return h[0]=b*a/B,h[1]=T*a/B,h[2]=S*a/B,!1}return h[0]=b+d*N,h[1]=T+_*N,h[2]=S+g*N,!0}}}class Hr{constructor(i,a,h,d,_){this.TL=i,this.TR=a,this.BR=h,this.BL=d,this.horizon=_}static fromInvProjectionMatrix(i,a,h){const d=[-1,1,1],_=[1,1,1],g=[1,-1,1],b=[-1,-1,1],T=ai(d,d,i),S=ai(_,_,i),P=ai(g,g,i),M=ai(b,b,i);return new Hr(T,S,P,M,a/h)}}function Dn(l,i,a){let h=1/0,d=-1/0;const _=[];for(const g of l){ht(_,g,i);const b=vt(_,a);h=Math.min(h,b),d=Math.max(d,b)}return[h,d]}function os(l,i){let a=!0;for(let h=0;h<l.planes.length;h++){const d=l.planes[h];let _=0;for(let g=0;g<i.length;g++)_+=+(vt(d,i[g])+d[3]>=0);if(_===0)return 0;_!==i.length&&(a=!1)}return a?2:1}function Ws(l,i){for(const a of l.projections){const h=Dn(i,l.points[0],a.axis);if(a.projection[1]<h[0]||a.projection[0]>h[1])return 0}return 1}function Ln(l,i){let a=0;const h=[0,0,0,0];for(let g=0;g<l.length;g++)h[0]=l[g][0],h[1]=l[g][1],h[2]=l[g][2],h[3]=1,(d=h)[0]*(_=i)[0]+d[1]*_[1]+d[2]*_[2]+d[3]*_[3]>=0&&a++;var d,_;return a}class er{constructor(i,a){this.points=i||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=Fi.fromPoints(this.points),this.projections=[],this.frustumEdges=[ht([],this.points[2],this.points[3]),ht([],this.points[0],this.points[3]),ht([],this.points[4],this.points[0]),ht([],this.points[5],this.points[1]),ht([],this.points[6],this.points[2]),ht([],this.points[7],this.points[3])];for(const h of this.frustumEdges){const d=[0,-h[2],h[1]],_=[h[2],0,-h[0]];this.projections.push({axis:d,projection:Dn(this.points,this.points[0],d)}),this.projections.push({axis:_,projection:Dn(this.points,this.points[0],_)})}}static fromInvProjectionMatrix(i,a,h,d){const _=Math.pow(2,h),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const P=Lt([],S,i),M=1/P[3]/a*_;return(L=P)[0]=(N=P)[0]*(B=[M,M,d?1/P[3]:M,M])[0],L[1]=N[1]*B[1],L[2]=N[2]*B[2],L[3]=N[3]*B[3],L;var L,N,B}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const P=Ni([],Wt([],ht([],g[S[0]],g[S[1]]),ht([],g[S[2]],g[S[1]]))),M=-vt(P,g[S[1]]);return P.concat(M)}),T=[];for(let S=0;S<g.length;S++)T.push([g[S][0],g[S][1],g[S][2]]);return new er(T,b)}intersectsPrecise(i,a,h){for(let d=0;d<a.length;d++)if(!Ln(i,a[d]))return 0;for(let d=0;d<this.planes.length;d++)if(!Ln(i,this.planes[d]))return 0;for(const d of h)for(const _ of this.frustumEdges){const g=Wt([],d,_),b=Oe(g);if(b===0)continue;wi(g,g,1/b);const T=Dn(this.points,this.points[0],g),S=Dn(i,this.points[0],g);if(T[0]>S[1]||S[0]>T[1])return 0}return 1}containsPoint(i){for(const a of this.planes){const h=a[3];if(vt([a[0],a[1],a[2]],i)+h<0)return!1}return!0}}class Fi{static fromPoints(i){const a=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const d of i)ir(a,a,d),st(h,h,d);return new Fi(a,h)}static fromTileIdAndHeight(i,a,h){const d=1<<i.canonical.z,_=i.canonical.x,g=i.canonical.y;return new Fi([_/d,g/d,a],[(_+1)/d,(g+1)/d,h])}static applyTransform(i,a){const h=i.getCorners();for(let d=0;d<h.length;++d)ai(h[d],h[d],a);return Fi.fromPoints(h)}static applyTransformFast(i,a){const h=[a[12],a[13],a[14]],d=[...h];for(let _=0;_<3;_++)for(let g=0;g<3;g++){const b=a[4*g+_],T=b*i.min[g],S=b*i.max[g];h[_]+=Math.min(T,S),d[_]+=Math.max(T,S)}return new Fi(h,d)}static projectAabbCorners(i,a){const h=i.getCorners();for(let d=0;d<h.length;++d)ai(h[d],h[d],a);return h}constructor(i,a){this.min=i,this.max=a,this.center=wi([],ti([],this.min,this.max),.5)}quadrant(i){const a=[i%2==0,i<2],h=He(this.min),d=He(this.max);for(let _=0;_<a.length;_++)h[_]=a[_]?this.min[_]:this.center[_],d[_]=a[_]?this.center[_]:this.max[_];return d[2]=this.max[2],new Fi(h,d)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,a=this.max;return[[i[0],i[1],i[2]],[a[0],i[1],i[2]],[a[0],a[1],i[2]],[i[0],a[1],i[2]],[i[0],i[1],a[2]],[a[0],i[1],a[2]],[a[0],a[1],a[2]],[i[0],a[1],a[2]]]}intersects(i){return this.intersectsAabb(i.bounds)?os(i,this.getCorners()):0}intersectsFlat(i){return this.intersectsAabb(i.bounds)?os(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(i,a){return a||this.intersects(i)?Ws(i,this.getCorners()):0}intersectsPreciseFlat(i,a){return a||this.intersectsFlat(i)?Ws(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(i){for(let a=0;a<3;++a)if(this.min[a]>i.max[a]||i.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(i){return!(this.min[0]>i.max[0]||i.min[0]>this.max[0]||this.min[1]>i.max[1]||i.min[1]>this.max[1])}encapsulate(i){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],i.min[a]),this.max[a]=Math.max(this.max[a],i.max[a])}encapsulatePoint(i){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],i[a]),this.max[a]=Math.max(this.max[a],i[a])}closestPoint(i){return[Math.max(Math.min(this.max[0],i[0]),this.min[0]),Math.max(Math.min(this.max[1],i[1]),this.min[1]),Math.max(Math.min(this.max[2],i[2]),this.min[2])]}}Zt(Fi,"Aabb");class Kr{constructor(i,a){this.feature=i,this.metersToTile=a,this.index=0}get(){const i=this.feature.vertices[this.index],a=this.feature.vertexProps[this.index].dir,h=a[1],d=-a[0],_=(i.extent+1)*this.metersToTile;return[new xt(Math.trunc(i.position[0]+h*_),Math.trunc(i.position[1]+d*_)),new xt(Math.trunc(i.position[0]-h*_),Math.trunc(i.position[1]-d*_))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Yn{constructor(i,a,h,d,_,g){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Jr(),Jr(),Jr(),Jr(),Jr(),Jr(),Jr()],this.id=i,this.heightRange={min:h,max:h},this.safeArea=a,this.constantHeight=h,this.constantHeight==null&&(this.constantHeight!=null||d.length!==0)){this.vertices=d,this.edges=_,this.edges=this.edges.filter(b=>{return b.a<this.vertices.length&&b.b<this.vertices.length&&!((T=this.vertices[b.a].position)[0]===(S=this.vertices[b.b].position)[0]&&T[1]===S[1]);var T,S}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const b of this.vertices)this.vertexProps.push({dir:_r(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,b.height),this.heightRange.max=Math.max(this.heightRange.max,b.height);for(const b of this.edges){const T=this.vertices[b.a].position,S=this.vertices[b.b].position,P=xn(Jr(),S,T),M=Qs(P),L=ss(Jr(),P,1/M);this.edgeProps.push({vec:P,dir:L,len:M});const N=this.vertexProps[b.a].dir,B=this.vertexProps[b.b].dir;es(N,N,L),es(B,B,L)}for(const b of this.vertexProps)b.dir[0]===0&&b.dir[1]===0||jr(b.dir,b.dir);this.tessellate(g)}}pointElevation(i){if(this.constantHeight!=null)return this.constantHeight;const a=this.getClosestEdge(i);if(a==null)return 0;const[h,d]=a;return Ri(this.vertices[this.edges[h].a].height,this.vertices[this.edges[h].b].height,d)}computeSlopeNormal(i,a){const h=this.getClosestEdge(i);if(!h)return xi(0,0,1);const d=h[0],_=this.edges[d],g=this.edgeProps[d].vec,b=xi(g[0],g[1],(this.vertices[_.b].height-this.vertices[_.a].height)*a),T=xi(b[1],-b[0],0);Wt(T,T,b);const S=Oe(T);return S>0?wi(T,T,1/S):ui(T,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(i){if(this.edges.length===0)return;let a=0,h=Number.POSITIVE_INFINITY,d=0;const[_,g,b,T,S,P,M]=this._tmpVec2;Es(M,i.x,i.y);const L=new Ur(M,null);for(let N=0;N<this.edges.length;N++){const B=this.edges[N],W=this.edgeProps[N].dir;L.dir=W;const X=this.vertices[B.a].position,Z=this.vertices[B.b].position,ne=L.intersectsPlane(X,this.vertexProps[B.a].dir,_),se=L.intersectsPlane(Z,this.vertexProps[B.b].dir,g);if(!ne||!se)continue;xn(b,g,_),xn(T,M,_);const le=dr(b,b),Ee=le>0?dr(T,b)/le:0,Ie=fe(Ee,0,1),Re=Math.abs((Ee-Ie)*this.edgeProps[N].len);xn(S,M,X),Es(P,W[1],-W[0]);const Ne=Re+Math.abs(dr(S,P));Ne<h&&(a=N,h=Ne,d=Ie)}return[a,d]}tessellate(i){const a=Ve(),h=Ve(),d=Ve(),_=Ve();for(let g=this.edges.length-1;g>=0;--g){const b=this.edges[g].a,T=this.edges[g].b,{position:S,height:P,extent:M}=this.vertices[b],{position:L,height:N,extent:B}=this.vertices[T],W=this.vertexProps[b].dir,X=this.vertexProps[T].dir;if(ui(a,S[0]/i,S[1]/i,P),ui(h,L[0]/i,L[1]/i,N),ui(d,W[1],-W[0],0),wi(d,d,M),ui(_,X[1],-X[0],0),wi(_,_,B),this.distSqLines(xi(a[0]+.5*d[0],a[1]+.5*d[1],a[2]+.5*d[2]),xi(h[0]-.5*_[0],h[1]-.5*_[1],h[2]-.5*_[2]),xi(a[0]-.5*d[0],a[1]-.5*d[1],a[2]-.5*d[2]),xi(h[0]+.5*_[0],h[1]+.5*_[1],h[2]+.5*_[2]))<=.0025000000000000005)continue;const Z=this.vertices.length,ne=es(Jr(),S,L);this.vertices.push({position:ss(ne,ne,.5),height:.5*(P+N),extent:.5*(M+B)});const se=es(Jr(),W,X);this.vertexProps.push({dir:jr(se,se)}),this.edges.splice(g,1),this.edgeProps.splice(g,1),this.edges.push({a:b,b:Z}),this.edges.push({a:Z,b:T});const le=xn(Jr(),this.vertices[Z].position,S),Ee=Qs(le),Ie={vec:le,dir:ss(Jr(),le,1/Ee),len:Ee};this.edgeProps.push(Ie),this.edgeProps.push(Ie)}}distSqLines(i,a,h,d){const _=ri(Ve(),a,i),g=ri(Ve(),d,h),b=ri(Ve(),i,h),T=vt(_,_),S=vt(_,g),P=vt(_,b),M=vt(g,g),L=vt(g,b),N=T*M-S*S;if(N===0)return Ar(Xt(_,h,d,vt(b,g)/vt(g,g)),i);const B=(T*L-S*P)/N;return Ar(Xt(_,i,a,(S*L-P*M)/N),Xt(g,h,d,B))}}class zn{static parseFrom(i,a){const h=Yi.parse(i);if(!h)return[];let{vertices:d,features:_}=h;const g=1/Xe(a);_.sort((P,M)=>P.id-M.id),d.sort((P,M)=>P.id-M.id||P.idx-M.idx),d=d.filter((P,M,L)=>M===L.findIndex(N=>N.id===P.id&&N.idx===P.idx));const b=new Array;let T=0;const S=d.length;for(const P of _){if(P.constantHeight){b.push(new Yn(P.id,P.bounds,P.constantHeight));continue}for(;T!==S&&d[T].id<P.id;)T++;if(T===S||d[T].id!==P.id)continue;const M=new Array,L=new Array,N=T;for(;T!==S&&d[T].id===P.id;){const B=d[T];if(M.push({position:B.position,height:B.height,extent:B.extent}),T!==N&&d[T-1].idx===B.idx-1){const W=T-N;L.push({a:W-1,b:W})}T++}b.push(new Yn(P.id,P.bounds,void 0,M,L,g))}return b}static getElevationFeature(i,a){if(!a)return;const h=+i.properties[Qi];return Number.isNaN(h)?void 0:a.find(d=>d.id===h)}}class ws{constructor(i,a){this.zScale=1,this.xOffset=0,this.yOffset=0,i.equals(a)||(this.zScale=Math.pow(2,a.z-i.z),this.xOffset=(i.x*this.zScale-a.x)*Ft,this.yOffset=(i.y*this.zScale-a.y)*Ft)}constantElevation(i,a){if(i.constantHeight!=null)return this.computeBiasedHeight(i.constantHeight,a)}pointElevation(i,a,h){const d=this.constantElevation(a,h);return d??(i.x=i.x*this.zScale+this.xOffset,i.y=i.y*this.zScale+this.yOffset,this.computeBiasedHeight(a.pointElevation(i),h))}computeBiasedHeight(i,a){return a<=0?i:i+a*Ke(0,a,i>=0?i:Math.abs(.5*i))}}Zt(Yn,"ElevationFeature");class lo{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new Vu,this.indexArray=new Us,this.segments=new jn,this.programConfigurations=new Gl(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Uu),this.worldview=i.worldview}updateFootprints(i,a){}populate(i,a,h,d){const _=this.layers[0],g=[];let b=null;_.type==="circle"&&(b=_.layout.get("circle-sort-key"));for(const{feature:S,id:P,index:M,sourceLayerIndex:L}of i){const N=this.layers[0]._featureFilter.needGeometry,B=Ct(S,N);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom,{worldview:this.worldview}),B,h))continue;const W=b?b.evaluate(B,{},h):void 0,X={id:P,properties:S.properties,type:S.type,sourceLayerIndex:L,index:M,geometry:N?B.geometry:$t(S,h,d),patterns:{},sortKey:W};g.push(X)}b&&g.sort((S,P)=>S.sortKey-P.sortKey);let T=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new $_,T=d.projection);for(const S of g){const{geometry:P,index:M,sourceLayerIndex:L}=S,N=i[M].feature;this.addFeature(S,P,M,a.availableImages,h,T,a.brightness,a.elevationFeatures),a.featureIndex.insert(N,P,M,L,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(i,a,h,d,_,g,b){this.programConfigurations.updatePaintArrays(i,a,_,h,d,g,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,vI.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,bI.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,xI.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(i,a,h,d,_,g,b,T){let S;this.elevationMode!=="none"&&(S=zn.getElevationFeature(i,T));for(const P of a)for(const M of P){const L=M.x,N=M.y;if(L<0||L>=Ft||N<0||N>=Ft)continue;if(g){const X=g.projectTilePoint(L,N,_),Z=g.upVector(_,L,N);this.addGlobeExtVertex(X,Z),this.addGlobeExtVertex(X,Z),this.addGlobeExtVertex(X,Z),this.addGlobeExtVertex(X,Z)}const B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),W=B.vertexLength;if(this.addCircleVertex(L,N,-1,-1),this.addCircleVertex(L,N,1,-1),this.addCircleVertex(L,N,1,1),this.addCircleVertex(L,N,-1,1),this.elevationMode!=="none"){const X=S?S.pointElevation(new xt(L,N)):0;this.hasElevation=this.hasElevation||X!==0;for(let Z=0;Z<4;Z++)this.elevatedLayoutVertexArray.emplaceBack(X)}this.indexArray.emplaceBack(W,W+1,W+2),this.indexArray.emplaceBack(W,W+2,W+3),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{},d,_,b,void 0,this.worldview)}addCircleVertex(i,a,h,d){this.layoutVertexArray.emplaceBack(2*i+(h+1)/2,2*a+(d+1)/2)}addGlobeExtVertex(i,a){this.globeExtVertexArray.emplaceBack(i.x,i.y,i.z,a[0]*16384,a[1]*16384,a[2]*16384)}}function il(l,i){for(let a=0;a<l.length;a++)if(Xs(i,l[a]))return!0;for(let a=0;a<i.length;a++)if(Xs(l,i[a]))return!0;return!!Zo(l,i)}function rl(l,i,a){return!!Xs(l,i)||!!as(i,l,a)}function Ca(l,i){if(l.length===1)return Ls(i,l[0]);for(let a=0;a<i.length;a++){const h=i[a];for(let d=0;d<h.length;d++)if(Xs(l,h[d]))return!0}for(let a=0;a<l.length;a++)if(Ls(i,l[a]))return!0;for(let a=0;a<i.length;a++)if(Zo(l,i[a]))return!0;return!1}function Ra(l,i,a){if(l.length>1){if(Zo(l,i))return!0;for(let h=0;h<i.length;h++)if(as(i[h],l,a))return!0}for(let h=0;h<l.length;h++)if(as(l[h],i,a))return!0;return!1}function Zo(l,i){if(l.length===0||i.length===0)return!1;for(let a=0;a<l.length-1;a++){const h=l[a],d=l[a+1];for(let _=0;_<i.length-1;_++)if(El(h,d,i[_],i[_+1]))return!0}return!1}function El(l,i,a,h){return In(l,a,h)!==In(i,a,h)&&In(l,i,a)!==In(l,i,h)}function Hl(l,i,a){return(l.x-a.x)*(i.y-a.y)-(l.y-a.y)*(i.x-a.x)}function rs(l,i,a,h){const d=Hl(l,i,h),_=Hl(l,i,a);if(Math.sign(d)===Math.sign(_))return;const g=Hl(a,h,l),b=g+_-d;return Math.sign(g)!==Math.sign(b)?[g/(g-b),_/(_-d)]:void 0}function as(l,i,a){const h=a*a;if(i.length===1)return l.distSqr(i[0])<h;for(let d=1;d<i.length;d++)if(Nn(l,i[d-1],i[d])<h)return!0;return!1}function Nn(l,i,a){const h=i.distSqr(a);if(h===0)return l.distSqr(i);const d=((l.x-i.x)*(a.x-i.x)+(l.y-i.y)*(a.y-i.y))/h;return l.distSqr(d<0?i:d>1?a:a.sub(i)._mult(d)._add(i))}function Ls(l,i){let a,h,d,_=!1;for(let g=0;g<l.length;g++){a=l[g];for(let b=0,T=a.length-1;b<a.length;T=b++)h=a[b],d=a[T],h.y>i.y!=d.y>i.y&&i.x<(d.x-h.x)*(i.y-h.y)/(d.y-h.y)+h.x&&(_=!_)}return _}function Xs(l,i){let a=!1;for(let h=0,d=l.length-1;h<l.length;d=h++){const _=l[h],g=l[d];_.y>i.y!=g.y>i.y&&i.x<(g.x-_.x)*(i.y-_.y)/(g.y-_.y)+_.x&&(a=!a)}return a}function vs(l,i,a,h,d){for(const g of l)if(i<=g.x&&a<=g.y&&h>=g.x&&d>=g.y)return!0;const _=[new xt(i,a),new xt(i,d),new xt(h,d),new xt(h,a)];if(l.length>2){for(const g of _)if(Xs(l,g))return!0}for(let g=0;g<l.length-1;g++)if(wo(l[g],l[g+1],_))return!0;return!1}function wo(l,i,a){const h=a[0],d=a[2];if(l.x<h.x&&i.x<h.x||l.x>d.x&&i.x>d.x||l.y<h.y&&i.y<h.y||l.y>d.y&&i.y>d.y)return!1;const _=In(l,i,a[0]);return _!==In(l,i,a[1])||_!==In(l,i,a[2])||_!==In(l,i,a[3])}function wc(l,i,a,h,d,_){let g=i.y-l.y,b=l.x-i.x;if(_=_||0){const T=g*g+b*b;if(T===0)return!0;const S=Math.sqrt(T);g/=S,b/=S}return!((a.x-l.x)*g+(a.y-l.y)*b-_<0||(h.x-l.x)*g+(h.y-l.y)*b-_<0||(d.x-l.x)*g+(d.y-l.y)*b-_<0)}function Qc(l,i,a,h,d,_,g){return!(wc(l,i,h,d,_,g)||wc(i,a,h,d,_,g)||wc(a,l,h,d,_,g)||wc(h,d,l,i,a,g)||wc(d,_,l,i,a,g)||wc(_,h,l,i,a,g))}function ql(l,i,a){const h=i.paint.get(l).value;return h.kind==="constant"?h.value:a.programConfigurations.get(i.id).getMaxValue(l)}function Gu(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function Hu(l,i,a,h,d){if(!i[0]&&!i[1])return l;const _=xt.convert(i)._mult(d);a==="viewport"&&_._rotate(-h);const g=[];for(let b=0;b<l.length;b++)g.push(l[b].sub(_));return g}function Tc(l,i,a,h){const d=xt.convert(l)._mult(h);return i==="viewport"&&d._rotate(-a),d}let _f,eu;function Ec(l,i,a){var h=2*Math.PI*6378137/256/Math.pow(2,a);return[l*h-2*Math.PI*6378137/2,i*h-2*Math.PI*6378137/2]}Zt(lo,"CircleBucket",{omit:["layers"]});class tu{constructor(i,a,h){this.z=i,this.x=a,this.y=h,this.key=Q_(0,i,i,a,h)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}isChildOf(i){const a=this.z-i.z;return i.z===0||i.z<this.z&&i.x===this.x>>a&&i.y===this.y>>a}url(i,a){const h=function(_,g,b){var T=Ec(256*_,256*(g=Math.pow(2,b)-g-1),b),S=Ec(256*(_+1),256*(g+1),b);return T[0]+","+T[1]+","+S[0]+","+S[1]}(this.x,this.y,this.z),d=function(_,g,b){let T,S="";for(let P=_;P>0;P--)T=1<<P-1,S+=(g&T?1:0)+(b&T?2:0);return S}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class J_{constructor(i,a){this.wrap=i,this.canonical=a,this.key=Q_(i,a.z,a.z,a.x,a.y)}}class Ko{constructor(i,a,h,d,_){this.overscaledZ=i,this.wrap=a,this.canonical=new tu(h,+d,+_),this.key=a===0&&i===h?this.canonical.key:Q_(a,i,h,d,_)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const a=this.canonical.z-i;return i>this.canonical.z?new Ko(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ko(i,this.wrap,i,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(i,a=!0){if(this.overscaledZ===i&&a)return this.key;if(i>this.canonical.z)return Q_(this.wrap*+a,i,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-i;return Q_(this.wrap*+a,i,i,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const a=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.z<this.canonical.z&&i.canonical.x===this.canonical.x>>a&&i.canonical.y===this.canonical.y>>a}children(i){if(this.overscaledZ>=i)return[new Ko(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,h=2*this.canonical.x,d=2*this.canonical.y;return[new Ko(a,this.wrap,a,h,d),new Ko(a,this.wrap,a,h+1,d),new Ko(a,this.wrap,a,h,d+1),new Ko(a,this.wrap,a,h+1,d+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Ko(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Ko(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new J_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Q_(l,i,a,h,d){const _=1<<Math.min(a,22);let g=_*(d%_)+h%_;return l&&a<22&&(g+=_*_*((l<0?-2*l-1:2*l)%(1<<2*(22-a)))),16*(32*g+a)+(i-a)}const S7=[l=>{let i=l.canonical.x-1,a=l.wrap;return i<0&&(i=(1<<l.canonical.z)-1,a--),new Ko(l.overscaledZ,a,l.canonical.z,i,l.canonical.y)},l=>{let i=l.canonical.x+1,a=l.wrap;return i===1<<l.canonical.z&&(i=0,a++),new Ko(l.overscaledZ,a,l.canonical.z,i,l.canonical.y)},l=>new Ko(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new Ko(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];Zt(tu,"CanonicalTileID"),Zt(Ko,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const A7=xr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Nb}=A7,C7=xr([{name:"a_pos_3",components:3,type:"Int16"}]);var AP=xr([{name:"a_pos",type:"Int16",components:2}]);function Bb(l){return l*p/j}const R7=[new Fi([D,D,D],[F,F,F]),new Fi([D,D,D],[0,0,F]),new Fi([0,D,D],[F,0,F]),new Fi([D,0,D],[0,F,F]),new Fi([0,0,D],[F,F,F])];function CP(l,i,a,h=!0){const d=wi([],l._camera.position,l.worldSize),_=[i,a,1,1];Lt(_,_,l.pixelMatrixInverse),Ht(_,_,1/_[3]);const g=Ni([],ht([],_,d)),b=l.globeMatrix,T=[b[12],b[13],b[14]],S=ht([],T,d),P=Oe(S),M=Ni([],S),L=l.worldSize/(2*Math.PI),N=vt(M,g),B=Math.asin(L/P);if(B<Math.acos(N)){if(!h)return null;const ft=[],We=[];wi(ft,g,P/N),Ni(We,ht(We,ft,S)),Ni(g,ti(g,S,wi(g,We,Math.tan(B)*P)))}const W=[];new zr(d,g).closestPointOnSphere(T,L,W);const X=Ni([],fn(b,0)),Z=Ni([],fn(b,1)),ne=Ni([],fn(b,2)),se=vt(X,W),le=vt(Z,W),Ee=vt(ne,W),Ie=q(Math.asin(-le/L));let Re=q(Math.atan2(se,Ee));Re=l.center.lng+function(ft,We){const mt=(We-ft+180)%360-180;return mt<-180?mt+360:mt}(l.center.lng,Re);const Ne=ce(Re),je=fe(ve(Ie),0,1);return new nt(Ne,je)}class P7{constructor(i,a,h){this.a=ht([],i,h),this.b=ht([],a,h),this.center=h;const d=Ni([],this.a),_=Ni([],this.b);this.angle=Math.acos(vt(d,_))}}function AI(l,i){if(l.angle===0)return null;let a;return a=l.a[i]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[i]/l.a[i]/Math.sin(l.angle)-1/Math.tan(l.angle)),a<0||a>1?null:function(h,d,_,g){const b=Math.sin(_);return h*(Math.sin((1-g)*_)/b)+d*(Math.sin(g*_)/b)}(l.a[i],l.b[i],l.angle,fe(a,0,1))+l.center[i]}function qu(l){if(l.z<=1)return R7[l.z+2*l.y+l.x];const i=CI(Vb(l));return Fi.fromPoints(i)}function td(l,i,a){return wi(l,l,1-a),ji(l,l,i,a)}function RP(l,i,a){for(const h of l)ai(h,h,i),wi(h,h,a)}function PP(l,i,a,h){const d=i/l.worldSize,_=l.globeMatrix;if(a.z<=1){const je=qu(a).getCorners();return RP(je,_,d),Fi.fromPoints(je)}const g=Vb(a,h),b=CI(g,p+Bb(l._tileCoverLift));RP(b,_,d);const T=Number.MAX_VALUE,S=[-T,-T,-T],P=[T,T,T];if(g.contains(l.center)){for(const We of b)ir(P,P,We),st(S,S,We);S[2]=0;const je=l.point,ft=[je.x*d,je.y*d,0];return ir(P,P,ft),st(S,S,ft),new Fi(P,S)}if(l._tileCoverLift>0){for(const je of b)ir(P,P,je),st(S,S,je);return new Fi(P,S)}const M=[_[12]*d,_[13]*d,_[14]*d],L=g.getCenter(),N=fe(l.center.lat,-we,we),B=fe(L.lat,-we,we),W=ce(l.center.lng),X=ve(N);let Z=W-ce(L.lng);const ne=X-ve(B);Z>.5?Z-=1:Z<-.5&&(Z+=1);let se=0;Math.abs(Z)>Math.abs(ne)?se=Z>=0?1:3:(se=ne>=0?0:2,ji(M,M,[_[4]*d,_[5]*d,_[6]*d],-Math.sin(Pe(ne>=0?g.getSouth():g.getNorth()))*p));const le=b[se],Ee=b[(se+1)%4],Ie=new P7(le,Ee,M),Re=[AI(Ie,0)||le[0],AI(Ie,1)||le[1],AI(Ie,2)||le[2]],Ne=gf(l.zoom);if(Ne>0){const je=function({x:We,y:mt,z:St},gt,wt,Rt,ut){const Tt=1/(1<<St);let rt=We*Tt,et=rt+Tt,Pt=mt*Tt,At=Pt+Tt,mi=0;const qt=(rt+et)/2-Rt;return qt>.5?mi=-1:qt<-.5&&(mi=1),rt=((rt+mi)*gt-(Rt*=gt))*wt+Rt,et=((et+mi)*gt-Rt)*wt+Rt,Pt=(Pt*gt-(ut*=gt))*wt+ut,At=(At*gt-ut)*wt+ut,[[rt,At,0],[et,At,0],[et,Pt,0],[rt,Pt,0]]}(a,i,l._pixelsPerMercatorPixel,W,X);for(let We=0;We<b.length;We++)td(b[We],je[We],Ne);const ft=ti([],je[se],je[(se+1)%4]);wi(ft,ft,.5),td(Re,ft,Ne)}for(const je of b)ir(P,P,je),st(S,S,je);return P[2]=Math.min(le[2],Ee[2]),ir(P,P,Re),st(S,S,Re),new Fi(P,S)}function Vb({x:l,y:i,z:a},h=!1){const d=1/(1<<a),_=new H(xe(l*d),i===(1<<a)-1&&h?-90:ge((i+1)*d)),g=new H(xe((l+1)*d),i===0&&h?90:ge(i*d));return new ee(_,g)}function CI(l,i=p){const a=Pe(l.getNorth()),h=Pe(l.getSouth()),d=Math.cos(a),_=Math.cos(h),g=Math.sin(a),b=Math.sin(h),T=l.getWest(),S=l.getEast();return[V(_,b,T,i),V(_,b,S,i),V(d,g,S,i),V(d,g,T,i)]}function Zy(l,i,a,h){const d=1<<a.z,_=(l/Ft+a.x)/d;return z(ge((i/Ft+a.y)/d),xe(_),h)}function Ub({min:l,max:i}){return w/Math.max(i[0]-l[0],i[1]-l[1],i[2]-l[2])}const MP=new Float64Array(16);function jb(l){const i=Ub(l),a=me(MP,[i,i,i]);return Fe(a,a,Vr([],l.min))}function RI(l){const i=(h=l.min,(a=MP)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=h[0],a[13]=h[1],a[14]=h[2],a[15]=1,a);var a,h;const d=1/Ub(l);return Le(i,i,[d,d,d])}function PI(l){const i=Ft/(2*Math.PI);return l/(2*Math.PI)/i}function kP(l,i){return Ft/(512*Math.pow(2,l))*Ub(qu(i))}function DP(l,i,a,h,d){const _=PI(a),g=[l,i,-a/(2*Math.PI)],b=Q(new Float64Array(16));return Fe(b,b,g),Le(b,b,[_,_,_]),Me(b,b,Pe(-d)),at(b,b,Pe(-h)),b}function gf(l){return Ke(v,x,l)}function LP(l,i){const a=z(i.lat,i.lng),h=function(B){const W=z(B._center.lat,B._center.lng);let X=Wt([],xi(0,1,0),W);const Z=ye([],-B.angle,W);X=ai(X,X,Z),ye(Z,-B._pitch,X);const ne=Ni([],W);return wi(ne,ne,Bb(B.cameraToCenterDistance/B.pixelsPerMeter)),ai(ne,ne,Z),ti([],W,ne)}(l);return g=(d=ri([],h,a))[0],b=d[1],T=d[2],S=(_=a)[0],P=_[1],M=_[2],N=(L=Math.sqrt((g*g+b*b+T*T)*(S*S+P*P+M*M)))&&vt(d,_)/L,Math.acos(Math.min(Math.max(N,-1),1));var d,_,g,b,T,S,P,M,L,N}function MI(l,i){return LP(l,i)>Math.PI/2*1.01}const OP=Pe(85),M7=Math.cos(OP),k7=Math.sin(OP),D7=te(),FP=l=>{const i=[];return l.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i};function zP(l,i,a,h,d,_,g,b,T){if(_&&l.queryGeometry.isAboveHorizon)return!1;_&&(T*=l.pixelToTileUnitsFactor);const S=l.tileID.canonical,P=a.projection.upVectorScale(S,a.center.lat,a.worldSize).metersToTile;for(const M of i)for(const L of M){const N=L.add(b),B=d&&a.elevation?a.elevation.exaggeration()*d.getElevationAt(N.x,N.y,!0):0,W=a.projection.projectTilePoint(N.x,N.y,S);if(B>0){const se=a.projection.upVector(S,N.x,N.y);W.x+=se[0]*P*B,W.y+=se[1]*P*B,W.z+=se[2]*P*B}const X=_?N:L7(W.x,W.y,W.z,h),Z=_?l.tilespaceRays.map(se=>F7(se,B)):l.queryGeometry.screenGeometry,ne=Lt([],[W.x,W.y,W.z,1],h);if(!g&&_?T*=ne[3]/a.cameraToCenterDistance:g&&!_&&(T*=a.cameraToCenterDistance/ne[3]),_){const se=ge((L.y/Ft+S.y)/(1<<S.z));T/=a.projection.pixelsPerMeter(se,1)/_e(1,se)}if(rl(Z,X,T))return!0}return!1}function L7(l,i,a,h){const d=Lt([],[l,i,a,1],h);return new xt(d[0]/d[3],d[1]/d[3])}const NP=xi(0,0,0),O7=xi(0,0,1);function F7(l,i){const a=Ve();return NP[2]=i,l.intersectsPlane(NP,O7,a),new xt(a[0],a[1])}class BP extends lo{}let VP,UP,jP,$P;function GP(l,{width:i,height:a},h,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==i*a*h)throw new RangeError("mismatched image size")}else d=new Uint8Array(i*a*h);return l.width=i,l.height=a,l.data=d,l}function HP(l,i,a){const{width:h,height:d}=i;h===l.width&&d===l.height||(kI(l,i,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,h),height:Math.min(l.height,d)},a,null),l.width=h,l.height=d,l.data=i.data)}function kI(l,i,a,h,d,_,g,b){if(d.width===0||d.height===0)return i;if(d.width>l.width||d.height>l.height||a.x>l.width-d.width||a.y>l.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>i.width||d.height>i.height||h.x>i.width-d.width||h.y>i.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const T=l.data,S=i.data,P=_===4&&b;for(let M=0;M<d.height;M++){const L=((a.y+M)*l.width+a.x)*_,N=((h.y+M)*i.width+h.x)*_;if(P)for(let B=0;B<d.width;B++){const W=L+B*_+3,X=N+B*_;S[X+0]=255,S[X+1]=255,S[X+2]=255,S[X+3]=T[W]}else if(g)for(let B=0;B<d.width;B++){const W=L+B*_,X=N+B*_,Z=new Mr(T[W+0]/255,T[W+1]/255,T[W+2]/255,T[W+3]).toNonPremultipliedRenderColor(g).toArray();S[X+0]=Z[0],S[X+1]=Z[1],S[X+2]=Z[2],S[X+3]=Z[3]}else for(let B=0;B<d.width*_;B++)S[N+B]=T[L+B]}return i}Zt(BP,"HeatmapBucket",{omit:["layers"]});class yf{constructor(i,a){GP(this,i,1,a)}resize(i){HP(this,new yf(i),1)}clone(){return new yf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,h,d,_){kI(i,a,h,d,_,1,null)}}class To{constructor(i,a){GP(this,i,4,a)}resize(i){HP(this,new To(i),4)}replace(i,a){a?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new To({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,h,d,_,g,b){kI(i,a,h,d,_,4,g,b)}}class qP{constructor(i,a){this.width=i.width,this.height=i.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function Ky(l){const i={},a=l.resolution||256,h=l.clips?l.clips.length:1,d=l.image||new To({width:a,height:h}),_=(g,b,T)=>{i[l.evaluationKey]=T;const S=l.expression.evaluate(i),P=S?S.toNonPremultipliedRenderColor(null):null;P&&(d.data[g+b+0]=Math.floor(255*P.r),d.data[g+b+1]=Math.floor(255*P.g),d.data[g+b+2]=Math.floor(255*P.b),d.data[g+b+3]=Math.floor(255*P.a))};if(l.clips)for(let g=0,b=0;g<h;++g,b+=4*a)for(let T=0,S=0;T<a;T++,S+=4){const P=T/(a-1),{start:M,end:L}=l.clips[g];_(b,S,M*(1-P)+L*P)}else for(let g=0,b=0;g<a;g++,b+=4)_(0,b,g/(a-1));return d}Zt(yf,"AlphaImage"),Zt(To,"RGBAImage");const z7=xr([{name:"a_pos",components:2,type:"Int16"}],4),N7=xr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),B7=xr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),V7=xr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function eg(l,i,a=2){const h=i&&i.length,d=h?i[0]*a:l.length;let _=WP(l,0,d,a,!0);const g=[];if(!_||_.next===_.prev)return g;let b,T,S;if(h&&(_=function(P,M,L,N){const B=[];for(let W=0,X=M.length;W<X;W++){const Z=WP(P,M[W]*N,W<X-1?M[W+1]*N:P.length,N,!1);Z===Z.next&&(Z.steiner=!0),B.push(X7(Z))}B.sort(H7);for(let W=0;W<B.length;W++)L=q7(B[W],L);return L}(l,i,_,a)),l.length>80*a){b=l[0],T=l[1];let P=b,M=T;for(let L=a;L<d;L+=a){const N=l[L],B=l[L+1];N<b&&(b=N),B<T&&(T=B),N>P&&(P=N),B>M&&(M=B)}S=Math.max(P-b,M-T),S=S!==0?32767/S:0}return Yy(_,g,a,b,T,S,0),g}function WP(l,i,a,h,d){let _;if(d===function(g,b,T,S){let P=0;for(let M=b,L=T-S;M<T;M+=S)P+=(g[L]-g[M])*(g[M+1]+g[L+1]),L=M;return P}(l,i,a,h)>0)for(let g=i;g<a;g+=h)_=YP(g/h|0,l[g],l[g+1],_);else for(let g=a-h;g>=i;g-=h)_=YP(g/h|0,l[g],l[g+1],_);return _&&tg(_,_.next)&&(ev(_),_=_.next),_}function jp(l,i){if(!l)return l;i||(i=l);let a,h=l;do if(a=!1,h.steiner||!tg(h,h.next)&&ro(h.prev,h,h.next)!==0)h=h.next;else{if(ev(h),h=i=h.prev,h===h.next)break;a=!0}while(a||h!==i);return i}function Yy(l,i,a,h,d,_,g){if(!l)return;!g&&_&&function(T,S,P,M){let L=T;do L.z===0&&(L.z=DI(L.x,L.y,S,P,M)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==T);L.prevZ.nextZ=null,L.prevZ=null,function(N){let B,W=1;do{let X,Z=N;N=null;let ne=null;for(B=0;Z;){B++;let se=Z,le=0;for(let Ie=0;Ie<W&&(le++,se=se.nextZ,se);Ie++);let Ee=W;for(;le>0||Ee>0&&se;)le!==0&&(Ee===0||!se||Z.z<=se.z)?(X=Z,Z=Z.nextZ,le--):(X=se,se=se.nextZ,Ee--),ne?ne.nextZ=X:N=X,X.prevZ=ne,ne=X;Z=se}ne.nextZ=null,W*=2}while(B>1)}(L)}(l,h,d,_);let b=l;for(;l.prev!==l.next;){const T=l.prev,S=l.next;if(_?j7(l,h,d,_):U7(l))i.push(T.i,l.i,S.i),ev(l),l=S.next,b=S.next;else if((l=S)===b){g?g===1?Yy(l=$7(jp(l),i),i,a,h,d,_,2):g===2&&G7(l,i,a,h,d,_):Yy(jp(l),i,a,h,d,_,1);break}}}function U7(l){const i=l.prev,a=l,h=l.next;if(ro(i,a,h)>=0)return!1;const d=i.x,_=a.x,g=h.x,b=i.y,T=a.y,S=h.y,P=Math.min(d,_,g),M=Math.min(b,T,S),L=Math.max(d,_,g),N=Math.max(b,T,S);let B=h.next;for(;B!==i;){if(B.x>=P&&B.x<=L&&B.y>=M&&B.y<=N&&Jy(d,b,_,T,g,S,B.x,B.y)&&ro(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function j7(l,i,a,h){const d=l.prev,_=l,g=l.next;if(ro(d,_,g)>=0)return!1;const b=d.x,T=_.x,S=g.x,P=d.y,M=_.y,L=g.y,N=Math.min(b,T,S),B=Math.min(P,M,L),W=Math.max(b,T,S),X=Math.max(P,M,L),Z=DI(N,B,i,a,h),ne=DI(W,X,i,a,h);let se=l.prevZ,le=l.nextZ;for(;se&&se.z>=Z&&le&&le.z<=ne;){if(se.x>=N&&se.x<=W&&se.y>=B&&se.y<=X&&se!==d&&se!==g&&Jy(b,P,T,M,S,L,se.x,se.y)&&ro(se.prev,se,se.next)>=0||(se=se.prevZ,le.x>=N&&le.x<=W&&le.y>=B&&le.y<=X&&le!==d&&le!==g&&Jy(b,P,T,M,S,L,le.x,le.y)&&ro(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;se&&se.z>=Z;){if(se.x>=N&&se.x<=W&&se.y>=B&&se.y<=X&&se!==d&&se!==g&&Jy(b,P,T,M,S,L,se.x,se.y)&&ro(se.prev,se,se.next)>=0)return!1;se=se.prevZ}for(;le&&le.z<=ne;){if(le.x>=N&&le.x<=W&&le.y>=B&&le.y<=X&&le!==d&&le!==g&&Jy(b,P,T,M,S,L,le.x,le.y)&&ro(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function $7(l,i){let a=l;do{const h=a.prev,d=a.next.next;!tg(h,d)&&ZP(h,a,a.next,d)&&Qy(h,d)&&Qy(d,h)&&(i.push(h.i,a.i,d.i),ev(a),ev(a.next),a=l=d),a=a.next}while(a!==l);return jp(a)}function G7(l,i,a,h,d,_){let g=l;do{let b=g.next.next;for(;b!==g.prev;){if(g.i!==b.i&&Z7(g,b)){let T=KP(g,b);return g=jp(g,g.next),T=jp(T,T.next),Yy(g,i,a,h,d,_,0),void Yy(T,i,a,h,d,_,0)}b=b.next}g=g.next}while(g!==l)}function H7(l,i){let a=l.x-i.x;return a===0&&(a=l.y-i.y,a===0)&&(a=(l.next.y-l.y)/(l.next.x-l.x)-(i.next.y-i.y)/(i.next.x-i.x)),a}function q7(l,i){const a=function(d,_){let g=_;const b=d.x,T=d.y;let S,P=-1/0;if(tg(d,g))return g;do{if(tg(d,g.next))return g.next;if(T<=g.y&&T>=g.next.y&&g.next.y!==g.y){const W=g.x+(T-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(W<=b&&W>P&&(P=W,S=g.x<g.next.x?g:g.next,W===b))return S}g=g.next}while(g!==_);if(!S)return null;const M=S,L=S.x,N=S.y;let B=1/0;g=S;do{if(b>=g.x&&g.x>=L&&b!==g.x&&XP(T<N?b:P,T,L,N,T<N?P:b,T,g.x,g.y)){const W=Math.abs(T-g.y)/(b-g.x);Qy(g,d)&&(W<B||W===B&&(g.x>S.x||g.x===S.x&&W7(S,g)))&&(S=g,B=W)}g=g.next}while(g!==M);return S}(l,i);if(!a)return i;const h=KP(a,l);return jp(h,h.next),jp(a,a.next)}function W7(l,i){return ro(l.prev,l,i.prev)<0&&ro(i.next,l,l.next)<0}function DI(l,i,a,h,d){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-a)*d|0)|l<<8))|l<<4))|l<<2))|l<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-h)*d|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function X7(l){let i=l,a=l;do(i.x<a.x||i.x===a.x&&i.y<a.y)&&(a=i),i=i.next;while(i!==l);return a}function XP(l,i,a,h,d,_,g,b){return(d-g)*(i-b)>=(l-g)*(_-b)&&(l-g)*(h-b)>=(a-g)*(i-b)&&(a-g)*(_-b)>=(d-g)*(h-b)}function Jy(l,i,a,h,d,_,g,b){return!(l===g&&i===b)&&XP(l,i,a,h,d,_,g,b)}function Z7(l,i){return l.next.i!==i.i&&l.prev.i!==i.i&&!function(a,h){let d=a;do{if(d.i!==a.i&&d.next.i!==a.i&&d.i!==h.i&&d.next.i!==h.i&&ZP(d,d.next,a,h))return!0;d=d.next}while(d!==a);return!1}(l,i)&&(Qy(l,i)&&Qy(i,l)&&function(a,h){let d=a,_=!1;const g=(a.x+h.x)/2,b=(a.y+h.y)/2;do d.y>b!=d.next.y>b&&d.next.y!==d.y&&g<(d.next.x-d.x)*(b-d.y)/(d.next.y-d.y)+d.x&&(_=!_),d=d.next;while(d!==a);return _}(l,i)&&(ro(l.prev,l,i.prev)||ro(l,i.prev,i))||tg(l,i)&&ro(l.prev,l,l.next)>0&&ro(i.prev,i,i.next)>0)}function ro(l,i,a){return(i.y-l.y)*(a.x-i.x)-(i.x-l.x)*(a.y-i.y)}function tg(l,i){return l.x===i.x&&l.y===i.y}function ZP(l,i,a,h){const d=Gb(ro(l,i,a)),_=Gb(ro(l,i,h)),g=Gb(ro(a,h,l)),b=Gb(ro(a,h,i));return d!==_&&g!==b||!(d!==0||!$b(l,a,i))||!(_!==0||!$b(l,h,i))||!(g!==0||!$b(a,l,h))||!(b!==0||!$b(a,i,h))}function $b(l,i,a){return i.x<=Math.max(l.x,a.x)&&i.x>=Math.min(l.x,a.x)&&i.y<=Math.max(l.y,a.y)&&i.y>=Math.min(l.y,a.y)}function Gb(l){return l>0?1:l<0?-1:0}function Qy(l,i){return ro(l.prev,l,l.next)<0?ro(l,i,l.next)>=0&&ro(l,l.prev,i)>=0:ro(l,i,l.prev)<0||ro(l,l.next,i)<0}function KP(l,i){const a=LI(l.i,l.x,l.y),h=LI(i.i,i.x,i.y),d=l.next,_=i.prev;return l.next=i,i.prev=l,a.next=d,d.prev=a,h.next=a,a.prev=h,_.next=h,h.prev=_,h}function YP(l,i,a,h){const d=LI(l,i,a);return h?(d.next=h.next,d.prev=h,h.next.prev=d,h.next=d):(d.prev=d,d.next=d),d}function ev(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function LI(l,i,a){return{i:l,x:i,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function tv(l,i){const a=l.length;if(a<=1)return[l];const h=[];let d,_;for(let g=0;g<a;g++){const b=qr(l[g]);b!==0&&(l[g].area=Math.abs(b),_===void 0&&(_=b<0),_===b<0?(d&&h.push(d),d=[l[g]]):d.push(l[g]))}if(d&&h.push(d),i>1)for(let g=0;g<h.length;g++)h[g].length<=i||(qx(h[g],i,1,h[g].length-1,K7),h[g]=h[g].slice(0,i));return h}function K7(l,i){return i.area-l.area}function JP(l,i,a=1){if(!l)return null;const h=typeof l=="string"?_i.from(l).getPrimary():l.getPrimary(),d=typeof l=="string"?null:l.getSecondary();for(const _ of[h,d]){if(!_)continue;const g=_.id.toString();i.has(g)||i.set(g,[]),_.scaleSelf(a),i.get(g).push(_)}return{primary:h.toString(),secondary:d?d.toString():null}}function OI(l,i,a,h){const d=h.patternDependencies;let _=!1;for(const g of i){const b=g.paint.get(`${l}-pattern`);b.isConstant()||(_=!0),JP(b.constantOr(null),d,a)&&(_=!0)}return _}function FI(l,i,a,h,d,_){const g=_.patternDependencies;for(const b of i){const T=b.paint.get(`${l}-pattern`).value;if(T.kind!=="constant"){let S=T.evaluate({zoom:h},a,{},_.availableImages);S=S&&S.name?S.name:S;const P=JP(S,g,d);if(!P)continue;const{primary:M,secondary:L}=P;M&&(a.patterns[b.id]=[M,L].filter(Boolean))}}return a}class QP{constructor(){this.polygons=new Map}add(i,...a){const h=this.polygons.get(i);h?h.push(...a):this.polygons.set(i,a)}merge(i){for(const[a,h]of i.polygons)this.add(a,...h)}}class id{constructor(){this.portals=[]}static isOnBorder(i,a){return i<=0&&a<=0||i>=Ft&&a>=Ft}static evaluate(i){if(i.length===0)return new id;let a=[];for(const T of i)a.push(...T.portals);if(a.length===0)return new id;for(const T of a){const S=T.va,P=T.vb;(id.isOnBorder(S.x,P.x)||id.isOnBorder(S.y,P.y))&&(T.type="border")}const h=a.filter(T=>T.type!=="unevaluated"),d=a.filter(T=>T.type==="unevaluated");if(d.length===0)return new id;d.sort((T,S)=>T.hash===S.hash?T.isTunnel===S.isTunnel?0:T.isTunnel?-1:1:T.hash<S.hash?1:-1),a=h.concat(d);let _=h.length,g=_,b=_;do if(g++,g===a.length||a[_].hash!==a[g].hash){if(g-_==2){b<_&&(a[b]=a[_],a[_]=null);const T=a[b],S=a[g-1];T.type=T.isTunnel!==S.isTunnel?"tunnel":"polygon",T.connection={a:T.connection.a,b:S.connection.a},b++}_=g}while(_!==a.length);return a.splice(b),a.sort((T,S)=>T.hash<S.hash?1:-1),{portals:a}}}Zt(id,"ElevationPortalGraph"),Zt(QP,"ElevationPolygons");class Y7{constructor(i,a,h){this.outPositions=i,this.outNormals=a,this.outIndices=h,this.vertexLookup=new Map}addVertex(i,a,h){let d=i[2];h!=null&&(d*=h);const _=`${i[0]},${i[1]},${i[2]},${a[0]},${a[1]},${a[2]}`,g=this.vertexLookup.get(_);if(g!=null)return g;const b=this.outPositions.length;this.vertexLookup.set(_,b);const T=Math.trunc(16384*a[0]),S=Math.trunc(16384*a[1]),P=Math.trunc(16384*a[2]);return this.outPositions.emplaceBack(i[0],i[1],d),this.outNormals.emplaceBack(T,S,P),b}addTriangle(i,a,h){this.outIndices.emplaceBack(i,a,h)}addTriangles(i,a,h){if(i.length===0)return;const d=h.length===1,_=Ve(),g=Ve();for(let b=0;b<i.length;b+=3){const T=a[i[b+0]],S=a[i[b+1]],P=a[i[b+2]],M=d?h[0]:h[i[b+1]],L=d?h[0]:h[i[b+2]];ui(_,T.x,T.y,d?h[0]:h[i[b+0]]);const N=this.addVertex(_,g);ui(_,S.x,S.y,M);const B=this.addVertex(_,g);ui(_,P.x,P.y,L);const W=this.addVertex(_,g);this.outIndices.emplaceBack(N,B,W)}}addQuad(i,a,h,d,_,g){const b=this.addVertex(i,_,g),T=this.addVertex(a,_,g),S=this.addVertex(h,_,g),P=this.addVertex(d,_,g);this.addTriangle(b,T,S),this.addTriangle(S,P,b)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class nl{constructor(i,a,h,d){this.unevaluatedPortals=new id,this.portalPolygons=new QP,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Fy,this.vertexNormals=new U_,this.indexArray=new Us,this.tileToMeters=Xe(i),this.bridgeProgramConfigurations=new Gl(a,{zoom:h,lut:d},_=>_!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Gl(a,{zoom:h,lut:d},_=>_!=="fill-bridge-guard-rail-color")}addVertices(i,a){const h=this.unevalVertices.length;for(let d=0;d<i.length;d++)this.unevalVertices.push(i[d]),this.unevalHeights.push(a[d]);return h}addTriangles(i,a,h){const d=h?this.unevalTunnelTriangles:this.unevalTriangles;for(const _ of i)d.push(_+a)}addRenderableRing(i,a,h,d,_,g){const b=[new xt(_.min.x,_.min.y),new xt(_.max.x,_.min.y),new xt(_.max.x,_.max.y),new xt(_.min.x,_.max.y)];for(let T=0;T<h-1;T++){const S=a+T,P=S+1,M=this.unevalVertices[S],L=this.unevalVertices[P];if(!(M.x>=_.min.x&&M.x<=_.max.x&&M.y>=_.min.y&&M.y<=_.max.y||L.x>=_.min.x&&L.x<=_.max.x&&L.y>=_.min.y&&L.y<=_.max.y||wo(M,L,b))||this.isOnBorder(M.x,L.x)||this.isOnBorder(M.y,L.y))continue;const N=nl.computeEdgeHash(this.unevalVertices[S],this.unevalVertices[P]);let B,W=this.vertexHashLookup.get(nl.computePosHash(M));W!=null?B=W.next:(W=this.vertexHashLookup.get(nl.computePosHash(L)),B=W!=null?W.prev:N),this.unevalEdges.push({polygonIdx:i,a:S,b:P,hash:N,portalHash:B,isTunnel:d,type:"unevaluated",featureInfo:g})}}addPortalCandidates(i,a,h,d,_){if(a.length===0)return;this.portalPolygons.add(i,{geometry:a,zLevel:_});const g=a[0];this.vertexHashLookup.clear();let b=nl.computeEdgeHash(g[g.length-2],g[g.length-1]);for(let T=0;T<g.length-1;T++){const S=g[T+0],P=g[T+1],M=_r(P.x-S.x,P.y-S.y),L=Qs(M);if(L===0)continue;let N="unevaluated";const B=d.pointElevation(S),W=d.pointElevation(P);Math.abs(B)<.01&&Math.abs(W)<.01?N="entrance":(this.isOnBorder(S.x,P.x)||this.isOnBorder(S.y,P.y))&&(N="border");const X=nl.computeEdgeHash(S,P);this.unevaluatedPortals.portals.push({connection:{a:i,b:void 0},va:S,vb:P,vab:M,length:L,hash:X,isTunnel:h,type:N});const Z=nl.computePosHash(S);this.vertexHashLookup.set(Z,{prev:b,next:X}),b=X}}construct(i){if(this.unevalVertices.length===0)return;const a=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),h=L=>{L.primitiveLength=this.indexArray.length-L.primitiveOffset},d=new Y7(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(i.portals,this.unevalEdges);const _=a(),g=a(),b=a(),T=(L,N)=>{L.sort((W,X)=>W.type===N&&X.type!==N?-1:W.type!==N&&X.type===N?1:0);const B=L.findIndex(W=>W.type!==N);return B>=0?B:L.length};let S=0;this.unevalEdges.length>0&&(S=T(this.unevalEdges,"none"),this.constructBridgeStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},this.tileToMeters)),h(b);const P=a(),M=a();if(this.unevalEdges.length>0){const L=this.unevalEdges.splice(S),N=T(L,"tunnel")+S;this.unevalEdges.push(...L),this.constructTunnelStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},{min:S,max:N})}h(P),d.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),h(M),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),h(g),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),h(_),this.maskSegments=jn.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.depthSegments=jn.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableBridgeSegments=jn.simpleSegment(0,b.primitiveOffset,0,b.primitiveLength),this.renderableTunnelSegments=jn.simpleSegment(0,P.primitiveOffset,0,P.primitiveLength),this.shadowCasterSegments=jn.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength)}update(i,a,h,d,_,g,b,T){this.bridgeProgramConfigurations.updatePaintArrays(i,a,_,h,d,g,b,T),this.tunnelProgramConfigurations.updatePaintArrays(i,a,_,h,d,g,b,T)}upload(i){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=i.createVertexBuffer(this.vertexPositions,B7.members),this.vertexBufferNormal=i.createVertexBuffer(this.vertexNormals,V7.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(i),this.tunnelProgramConfigurations.upload(i))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(i,a,h,d,_){const g=(b,T)=>{for(let S=0;S<T.length-1;S++){const P=T[S].featureIndex,M=T[S+1].vertexStart,L=i.feature(P);b.populatePaintArrays(M,L,P,{},h,a,d,void 0,_)}};g(this.bridgeProgramConfigurations,this.bridgeFeatureSections),g(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(i,a,h,d,_){const g=new Map;for(let b=d;b<_;b++){const T=h[b],S=T.a,P=T.b,M=nl.computePosHash(i[S]),L=nl.computePosHash(i[P]);let N=g.get(M);N||(N={},g.set(M,N));let B=g.get(L);B||(B={},g.set(L,B)),a[S]<=0&&a[P]<=0||(N.to=P,B.from=S)}return g}isTerminalVertex(i,a){const h=nl.computePosHash(this.unevalVertices[i]),d=a.get(h);return!d||!d.from||!d.to}constructBridgeStructures(i,a,h,d,_,g){i.clearVertexLookup();const b=this.computeVertexConnections(a,h,d,_.min,_.max),T=1/g,S=.5*T,P=(wt,Rt)=>ui(wt,a[Rt].x,a[Rt].y,h[Rt]*T),M=Ve(),L=Ve(),N=Ve(),B=Ve(),W=Ve(),X=(wt,Rt)=>{const ut=b.get(nl.computePosHash(a[Rt])),Tt=ut.from,rt=ut.to;if(!Tt||!rt)return;P(M,Tt),P(L,Rt),P(N,rt),Ge(B),Qe(M,L)||(ht(W,L,M),Ni(B,W)),Qe(N,L)||(ht(W,N,L),ti(B,B,Ni(W,W)));const et=Ue(B);return et>0?wi(wt,B,1/et):void 0};let Z=Number.POSITIVE_INFINITY;this.sortSubarray(d,_.min,_.max,(wt,Rt)=>wt.featureInfo.featureIndex-Rt.featureInfo.featureIndex);const ne=Ve(),se=Ve(),le=Ve(),Ee=Ve(),Ie=Ve(),Re=Ve(),Ne=Ve(),je=Ve(),ft=Ve(),We=[Ve(),Ve(),Ve(),Ve()],mt=[Ve(),Ve(),Ve(),Ve()],St=[{coord:new xt(0,0),height:0},{coord:new xt(0,0),height:0}],gt=(wt,Rt)=>wt>Rt;for(let wt=_.min;wt<_.max;wt++){const Rt=d[wt];if(!Rt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(St,a,h,Rt,gt))continue;const[ut,Tt]=St;if(ui(ne,ut.coord.x,ut.coord.y,T*ut.height),ui(se,Tt.coord.x,Tt.coord.y,T*Tt.height),Qe(ne,se))continue;ht(le,se,ne),Ni(le,le);const rt=X(je,Rt.a)||le,et=X(ft,Rt.b)||le;ui(Ee,rt[1],-rt[0],0),Ni(Ee,Ee),ui(Ie,et[1],-et[0],0),Ni(Ie,Ie),Wt(je,Ee,rt),Ni(Re,je),Wt(je,Ie,et),Ni(Ne,je),ti(We[0],ne,wi(je,ht(je,Ee,Re),S)),ti(We[1],ne,wi(je,ti(je,Ee,Re),S)),ti(We[2],ne,wi(je,Re,S)),We[3]=ne,ti(mt[0],se,wi(je,ht(je,Ie,Ne),S)),ti(mt[1],se,wi(je,ti(je,Ie,Ne),S)),ti(mt[2],se,wi(je,Ne,S)),mt[3]=se,Z=this.addFeatureSection(Rt.featureInfo.featureIndex,Z,this.bridgeFeatureSections,i);const Pt=i.addVertex(We[0],Ee,g),At=i.addVertex(We[1],Ee,g),mi=i.addVertex(mt[0],Ie,g),qt=i.addVertex(mt[1],Ie,g);i.addTriangle(Pt,At,mi),i.addTriangle(At,qt,mi);const si=i.addVertex(We[1],Re,g),Ot=i.addVertex(We[2],Re,g),pi=i.addVertex(mt[1],Ne,g),Ui=i.addVertex(mt[2],Ne,g);i.addTriangle(si,Ot,pi),i.addTriangle(Ot,Ui,pi),Vr(Ee,Ee),Vr(Ie,Ie);const Ut=i.addVertex(We[2],Ee,g),ci=i.addVertex(We[3],Ee,g),Li=i.addVertex(mt[2],Ie,g),Hi=i.addVertex(mt[3],Ie,g);i.addTriangle(Ut,ci,Li),i.addTriangle(ci,Hi,Li);const or=this.isTerminalVertex(Rt.a,b),Zi=this.isTerminalVertex(Rt.b,b);ut.height<.01&&or&&i.addQuad(We[3],We[2],We[1],We[0],Vr(rt,rt),g),Tt.height<.01&&Zi&&i.addQuad(mt[0],mt[1],mt[2],mt[3],et,g)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}constructTunnelStructures(i,a,h,d,_,g){i.clearVertexLookup();let b=Number.POSITIVE_INFINITY;const T=(Z,ne)=>Z.featureInfo.featureIndex-ne.featureInfo.featureIndex;this.sortSubarray(d,_.min,_.max,T),this.sortSubarray(d,g.min,g.max,T);const S=Z=>Ni(Z,Z),P=[{coord:new xt(0,0),height:0},{coord:new xt(0,0),height:0}],M=(Z,ne)=>Z<ne,L=Ve(),N=Ve(),B=Ve(),W=Ve(),X=Ve();for(let Z=_.min;Z<_.max;Z++){if(!this.prepareEdgePoints(P,a,h,d[Z],M))continue;const[ne,se]=P,le=S(ui(X,-(se.coord.y-ne.coord.y),se.coord.x-ne.coord.x,0));b=this.addFeatureSection(d[Z].featureInfo.featureIndex,b,this.tunnelFeatureSections,i),i.addQuad(ui(L,ne.coord.x,ne.coord.y,ne.height),ui(N,se.coord.x,se.coord.y,se.height),ui(B,se.coord.x,se.coord.y,d[Z].isTunnel?-.1:0),ui(W,ne.coord.x,ne.coord.y,d[Z].isTunnel?-.1:0),le)}for(let Z=g.min;Z<g.max;Z++){const ne=d[Z];ne.isTunnel&&([ne.a,ne.b]=[ne.b,ne.a]);const se=a[ne.a],le=a[ne.b],Ee=S(ui(X,-(le.y-se.y),le.x-se.x,0));b=this.addFeatureSection(ne.featureInfo.featureIndex,b,this.tunnelFeatureSections,i),i.addQuad(ui(L,le.x,le.y,0),ui(N,se.x,se.y,0),ui(B,se.x,se.y,h[ne.a]+4),ui(W,le.x,le.y,h[ne.b]+4),Ee),i.addQuad(ui(L,se.x,se.y,0),ui(N,le.x,le.y,0),ui(B,le.x,le.y,h[ne.b]+4),ui(W,se.x,se.y,h[ne.a]+4),Ee)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}setElevatedPoint(i,a,h,d){i.coord.x=a,i.coord.y=h,i.height=d}prepareEdgePoints(i,a,h,d,_){let g=a[d.a].x,b=a[d.a].y,T=a[d.b].x,S=a[d.b].y,P=h[d.a],M=h[d.b];const L=_(P,0),N=_(M,0);if(L&&N)return this.setElevatedPoint(i[0],g,b,P),this.setElevatedPoint(i[1],T,S,M),!0;if(!L&&!N)return!1;if(L){if(!N){const B=M/(M-P);T=Ri(T,g,B),S=Ri(S,b,B),M=Ri(M,P,B)}}else{const B=P/(P-M);g=Ri(g,T,B),b=Ri(b,S,B),P=Ri(P,M,B)}return this.setElevatedPoint(i[0],g,b,P),this.setElevatedPoint(i[1],T,S,M),!0}prepareEdges(i,a){if(a.length===0)return;a.sort((b,T)=>b.hash===T.hash?T.polygonIdx-b.polygonIdx:T.hash>b.hash?1:-1);let h=0,d=0,_=0,g=a[h].polygonIdx;do d++,(d===a.length||a[h].hash!==a[d].hash)&&((d-h==1||a[d-1].polygonIdx!==g)&&(_<h&&(a[_]=a[h],a[h]=null),a[_].type="none",_++),h=d,h!==a.length&&(g=a[h].polygonIdx));while(h!==a.length);if(a.splice(_),a.length!==0&&i.length!==0){a.sort((S,P)=>S.portalHash<P.portalHash?1:-1);let b=0,T=0;for(;b!==a.length&&T!==i.length;){const S=a[b],P=i[T];S.portalHash>P.hash?b++:P.hash>S.portalHash?T++:(S.type=P.type,b++)}}}isOnBorder(i,a){return i<=0&&a<=0||i>=Ft&&a>=Ft}addFeatureSection(i,a,h,d){return i!==a&&(a=i,h.push({featureIndex:i,vertexStart:d.getVertexCount()}),d.clearVertexLookup()),a}sortSubarray(i,a,h,d){const _=i.slice(a,h);_.sort(d),i.splice(a,_.length,..._)}static computeEdgeHash(i,a){return(i.y===a.y&&i.x>a.x||i.y>a.y)&&([i,a]=[a,i]),BigInt(nl.computePosHash(i))<<32n|BigInt(nl.computePosHash(a))}static computePosHash(i){return((65535&i.x)<<16|65535&i.y)>>>0}}var eM,tM={exports:{}},iM=(eM||(eM=1,function(l,i){(function(a){function h(ue,he){return ue>he?1:ue<he?-1:0}var d=function(ue,he){ue===void 0&&(ue=h),he===void 0&&(he=!1),this._compare=ue,this._root=null,this._size=0,this._noDuplicates=!!he},_={size:{configurable:!0}};function g(ue,he,it,dt,Vt){var Bt=Vt-dt;if(Bt>0){var Yt=dt+Math.floor(Bt/2),gi={key:he[Yt],data:it[Yt],parent:ue};return gi.left=g(gi,he,it,dt,Yt),gi.right=g(gi,he,it,Yt+1,Vt),gi}return null}function b(ue,he,it,dt,Vt){if(!(it>=dt)){for(var Bt=ue[it+dt>>1],Yt=it-1,gi=dt+1;;){do Yt++;while(Vt(ue[Yt],Bt)<0);do gi--;while(Vt(ue[gi],Bt)>0);if(Yt>=gi)break;var ar=ue[Yt];ue[Yt]=ue[gi],ue[gi]=ar,ar=he[Yt],he[Yt]=he[gi],he[gi]=ar}b(ue,he,it,gi,Vt),b(ue,he,gi+1,dt,Vt)}}d.prototype.rotateLeft=function(ue){var he=ue.right;he&&(ue.right=he.left,he.left&&(he.left.parent=ue),he.parent=ue.parent),ue.parent?ue===ue.parent.left?ue.parent.left=he:ue.parent.right=he:this._root=he,he&&(he.left=ue),ue.parent=he},d.prototype.rotateRight=function(ue){var he=ue.left;he&&(ue.left=he.right,he.right&&(he.right.parent=ue),he.parent=ue.parent),ue.parent?ue===ue.parent.left?ue.parent.left=he:ue.parent.right=he:this._root=he,he&&(he.right=ue),ue.parent=he},d.prototype._splay=function(ue){for(;ue.parent;){var he=ue.parent;he.parent?he.left===ue&&he.parent.left===he?(this.rotateRight(he.parent),this.rotateRight(he)):he.right===ue&&he.parent.right===he?(this.rotateLeft(he.parent),this.rotateLeft(he)):he.left===ue&&he.parent.right===he?(this.rotateRight(he),this.rotateLeft(he)):(this.rotateLeft(he),this.rotateRight(he)):he.left===ue?this.rotateRight(he):this.rotateLeft(he)}},d.prototype.splay=function(ue){for(var he,it,dt,Vt,Bt;ue.parent;)(it=(he=ue.parent).parent)&&it.parent?((dt=it.parent).left===it?dt.left=ue:dt.right=ue,ue.parent=dt):(ue.parent=null,this._root=ue),Vt=ue.left,Bt=ue.right,ue===he.left?(it&&(it.left===he?(he.right?(it.left=he.right,it.left.parent=it):it.left=null,he.right=it,it.parent=he):(Vt?(it.right=Vt,Vt.parent=it):it.right=null,ue.left=it,it.parent=ue)),Bt?(he.left=Bt,Bt.parent=he):he.left=null,ue.right=he,he.parent=ue):(it&&(it.right===he?(he.left?(it.right=he.left,it.right.parent=it):it.right=null,he.left=it,it.parent=he):(Bt?(it.left=Bt,Bt.parent=it):it.left=null,ue.right=it,it.parent=ue)),Vt?(he.right=Vt,Vt.parent=he):he.right=null,ue.left=he,he.parent=ue)},d.prototype.replace=function(ue,he){ue.parent?ue===ue.parent.left?ue.parent.left=he:ue.parent.right=he:this._root=he,he&&(he.parent=ue.parent)},d.prototype.minNode=function(ue){if(ue===void 0&&(ue=this._root),ue)for(;ue.left;)ue=ue.left;return ue},d.prototype.maxNode=function(ue){if(ue===void 0&&(ue=this._root),ue)for(;ue.right;)ue=ue.right;return ue},d.prototype.insert=function(ue,he){var it=this._root,dt=null,Vt=this._compare;if(this._noDuplicates)for(;it;){if(dt=it,Vt(it.key,ue)===0)return;it=Vt(it.key,ue)<0?it.right:it.left}else for(;it;)dt=it,it=Vt(it.key,ue)<0?it.right:it.left;return it={key:ue,data:he,left:null,right:null,parent:dt},dt?Vt(dt.key,it.key)<0?dt.right=it:dt.left=it:this._root=it,this.splay(it),this._size++,it},d.prototype.find=function(ue){for(var he=this._root,it=this._compare;he;){var dt=it(he.key,ue);if(dt<0)he=he.right;else{if(!(dt>0))return he;he=he.left}}return null},d.prototype.contains=function(ue){for(var he=this._root,it=this._compare;he;){var dt=it(ue,he.key);if(dt===0)return!0;he=dt<0?he.left:he.right}return!1},d.prototype.remove=function(ue){var he=this.find(ue);if(!he)return!1;if(this.splay(he),he.left)if(he.right){var it=this.minNode(he.right);it.parent!==he&&(this.replace(it,it.right),it.right=he.right,it.right.parent=it),this.replace(he,it),it.left=he.left,it.left.parent=it}else this.replace(he,he.left);else this.replace(he,he.right);return this._size--,!0},d.prototype.removeNode=function(ue){if(!ue)return!1;if(this.splay(ue),ue.left)if(ue.right){var he=this.minNode(ue.right);he.parent!==ue&&(this.replace(he,he.right),he.right=ue.right,he.right.parent=he),this.replace(ue,he),he.left=ue.left,he.left.parent=he}else this.replace(ue,ue.left);else this.replace(ue,ue.right);return this._size--,!0},d.prototype.erase=function(ue){var he=this.find(ue);if(he){this.splay(he);var it=he.left,dt=he.right,Vt=null;it&&(it.parent=null,Vt=this.maxNode(it),this.splay(Vt),this._root=Vt),dt&&(it?Vt.right=dt:this._root=dt,dt.parent=Vt),this._size--}},d.prototype.pop=function(){var ue=this._root,he=null;if(ue){for(;ue.left;)ue=ue.left;he={key:ue.key,data:ue.data},this.remove(ue.key)}return he},d.prototype.next=function(ue){var he=ue;if(he)if(he.right)for(he=he.right;he&&he.left;)he=he.left;else for(he=ue.parent;he&&he.right===ue;)ue=he,he=he.parent;return he},d.prototype.prev=function(ue){var he=ue;if(he)if(he.left)for(he=he.left;he&&he.right;)he=he.right;else for(he=ue.parent;he&&he.left===ue;)ue=he,he=he.parent;return he},d.prototype.forEach=function(ue){for(var he=this._root,it=[],dt=!1,Vt=0;!dt;)he?(it.push(he),he=he.left):it.length>0?(ue(he=it.pop(),Vt++),he=he.right):dt=!0;return this},d.prototype.range=function(ue,he,it,dt){for(var Vt=[],Bt=this._compare,Yt=this._root;Vt.length!==0||Yt;)if(Yt)Vt.push(Yt),Yt=Yt.left;else{if(Bt((Yt=Vt.pop()).key,he)>0)break;if(Bt(Yt.key,ue)>=0&&it.call(dt,Yt))return this;Yt=Yt.right}return this},d.prototype.keys=function(){for(var ue=this._root,he=[],it=[],dt=!1;!dt;)ue?(he.push(ue),ue=ue.left):he.length>0?(ue=he.pop(),it.push(ue.key),ue=ue.right):dt=!0;return it},d.prototype.values=function(){for(var ue=this._root,he=[],it=[],dt=!1;!dt;)ue?(he.push(ue),ue=ue.left):he.length>0?(ue=he.pop(),it.push(ue.data),ue=ue.right):dt=!0;return it},d.prototype.at=function(ue){for(var he=this._root,it=[],dt=!1,Vt=0;!dt;)if(he)it.push(he),he=he.left;else if(it.length>0){if(he=it.pop(),Vt===ue)return he;Vt++,he=he.right}else dt=!0;return null},d.prototype.load=function(ue,he,it){if(ue===void 0&&(ue=[]),he===void 0&&(he=[]),it===void 0&&(it=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var dt=ue.length;return it&&b(ue,he,0,dt-1,this._compare),this._root=g(null,ue,he,0,dt),this._size=dt,this},d.prototype.min=function(){var ue=this.minNode(this._root);return ue?ue.key:null},d.prototype.max=function(){var ue=this.maxNode(this._root);return ue?ue.key:null},d.prototype.isEmpty=function(){return this._root===null},_.size.get=function(){return this._size},d.createTree=function(ue,he,it,dt,Vt){return new d(it,Vt).load(ue,he,dt)},Object.defineProperties(d.prototype,_);var T=0,S=1,P=2,M=3,L=0,N=1,B=2,W=3;function X(ue,he,it){he===null?(ue.inOut=!1,ue.otherInOut=!0):(ue.isSubject===he.isSubject?(ue.inOut=!he.inOut,ue.otherInOut=he.otherInOut):(ue.inOut=!he.otherInOut,ue.otherInOut=he.isVertical()?!he.inOut:he.inOut),he&&(ue.prevInResult=!Z(he,it)||he.isVertical()?he.prevInResult:he));var dt=Z(ue,it);ue.resultTransition=dt?function(Vt,Bt){var Yt,gi=!Vt.inOut,ar=!Vt.otherInOut;switch(Bt){case L:Yt=gi&&ar;break;case N:Yt=gi||ar;break;case W:Yt=gi^ar;break;case B:Yt=Vt.isSubject?gi&&!ar:ar&&!gi}return Yt?1:-1}(ue,it):0}function Z(ue,he){switch(ue.type){case T:switch(he){case L:return!ue.otherInOut;case N:return ue.otherInOut;case B:return ue.isSubject&&ue.otherInOut||!ue.isSubject&&!ue.otherInOut;case W:return!0}break;case P:return he===L||he===N;case M:return he===B;case S:return!1}return!1}var ne=function(ue,he,it,dt,Vt){this.left=he,this.point=ue,this.otherEvent=it,this.isSubject=dt,this.type=Vt||T,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},se={inResult:{configurable:!0}};function le(ue,he){return ue[0]===he[0]&&ue[1]===he[1]}ne.prototype.isBelow=function(ue){var he=this.point,it=this.otherEvent.point;return this.left?(he[0]-ue[0])*(it[1]-ue[1])-(it[0]-ue[0])*(he[1]-ue[1])>0:(it[0]-ue[0])*(he[1]-ue[1])-(he[0]-ue[0])*(it[1]-ue[1])>0},ne.prototype.isAbove=function(ue){return!this.isBelow(ue)},ne.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},se.inResult.get=function(){return this.resultTransition!==0},ne.prototype.clone=function(){var ue=new ne(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ue.contourId=this.contourId,ue.resultTransition=this.resultTransition,ue.prevInResult=this.prevInResult,ue.isExteriorRing=this.isExteriorRing,ue.inOut=this.inOut,ue.otherInOut=this.otherInOut,ue},Object.defineProperties(ne.prototype,se);var Ee=11102230246251565e-32,Ie=134217729,Re=(3+8*Ee)*Ee;function Ne(ue,he,it,dt,Vt){var Bt,Yt,gi,ar,lr=he[0],rr=dt[0],Yr=0,On=0;rr>lr==rr>-lr?(Bt=lr,lr=he[++Yr]):(Bt=rr,rr=dt[++On]);var tr=0;if(Yr<ue&&On<it)for(rr>lr==rr>-lr?(gi=Bt-((Yt=lr+Bt)-lr),lr=he[++Yr]):(gi=Bt-((Yt=rr+Bt)-rr),rr=dt[++On]),Bt=Yt,gi!==0&&(Vt[tr++]=gi);Yr<ue&&On<it;)rr>lr==rr>-lr?(gi=Bt-((Yt=Bt+lr)-(ar=Yt-Bt))+(lr-ar),lr=he[++Yr]):(gi=Bt-((Yt=Bt+rr)-(ar=Yt-Bt))+(rr-ar),rr=dt[++On]),Bt=Yt,gi!==0&&(Vt[tr++]=gi);for(;Yr<ue;)gi=Bt-((Yt=Bt+lr)-(ar=Yt-Bt))+(lr-ar),lr=he[++Yr],Bt=Yt,gi!==0&&(Vt[tr++]=gi);for(;On<it;)gi=Bt-((Yt=Bt+rr)-(ar=Yt-Bt))+(rr-ar),rr=dt[++On],Bt=Yt,gi!==0&&(Vt[tr++]=gi);return Bt===0&&tr!==0||(Vt[tr++]=Bt),tr}function je(ue){return new Float64Array(ue)}var ft=33306690738754716e-32,We=22204460492503146e-32,mt=11093356479670487e-47,St=je(4),gt=je(8),wt=je(12),Rt=je(16),ut=je(4);function Tt(ue,he,it){var dt=function(Vt,Bt,Yt,gi,ar,lr){var rr=(Bt-lr)*(Yt-ar),Yr=(Vt-ar)*(gi-lr),On=rr-Yr;if(rr===0||Yr===0||rr>0!=Yr>0)return On;var tr=Math.abs(rr+Yr);return Math.abs(On)>=ft*tr?On:-function(yn,rn,Nr,bn,wn,mn,vn){var nn,cr,an,$n,zi,Rr,Tn,Jn,Cn,Os,hn,As,Pa,Eo,mo,Ma,Zu,Fs,Zs=yn-wn,Io=Nr-wn,Yo=rn-mn,zo=bn-mn;St[0]=(mo=(Jn=Zs-(Tn=(Rr=Ie*Zs)-(Rr-Zs)))*(Os=zo-(Cn=(Rr=Ie*zo)-(Rr-zo)))-((Eo=Zs*zo)-Tn*Cn-Jn*Cn-Tn*Os))-((hn=mo-(Zu=(Jn=Yo-(Tn=(Rr=Ie*Yo)-(Rr-Yo)))*(Os=Io-(Cn=(Rr=Ie*Io)-(Rr-Io)))-((Ma=Yo*Io)-Tn*Cn-Jn*Cn-Tn*Os)))+(zi=mo-hn))+(zi-Zu),St[1]=(Pa=Eo-((As=Eo+hn)-(zi=As-Eo))+(hn-zi))-((hn=Pa-Ma)+(zi=Pa-hn))+(zi-Ma),St[2]=As-((Fs=As+hn)-(zi=Fs-As))+(hn-zi),St[3]=Fs;var If=function(nde,_3){for(var g3=_3[0],jS=1;jS<4;jS++)g3+=_3[jS];return g3}(0,St),kv=We*vn;if(If>=kv||-If>=kv||(nn=yn-(Zs+(zi=yn-Zs))+(zi-wn),an=Nr-(Io+(zi=Nr-Io))+(zi-wn),cr=rn-(Yo+(zi=rn-Yo))+(zi-mn),$n=bn-(zo+(zi=bn-zo))+(zi-mn),nn===0&&cr===0&&an===0&&$n===0)||(kv=mt*vn+Re*Math.abs(If),(If+=Zs*$n+zo*nn-(Yo*an+Io*cr))>=kv||-If>=kv))return If;ut[0]=(mo=(Jn=nn-(Tn=(Rr=Ie*nn)-(Rr-nn)))*(Os=zo-(Cn=(Rr=Ie*zo)-(Rr-zo)))-((Eo=nn*zo)-Tn*Cn-Jn*Cn-Tn*Os))-((hn=mo-(Zu=(Jn=cr-(Tn=(Rr=Ie*cr)-(Rr-cr)))*(Os=Io-(Cn=(Rr=Ie*Io)-(Rr-Io)))-((Ma=cr*Io)-Tn*Cn-Jn*Cn-Tn*Os)))+(zi=mo-hn))+(zi-Zu),ut[1]=(Pa=Eo-((As=Eo+hn)-(zi=As-Eo))+(hn-zi))-((hn=Pa-Ma)+(zi=Pa-hn))+(zi-Ma),ut[2]=As-((Fs=As+hn)-(zi=Fs-As))+(hn-zi),ut[3]=Fs;var tH=Ne(4,St,4,ut,gt);ut[0]=(mo=(Jn=Zs-(Tn=(Rr=Ie*Zs)-(Rr-Zs)))*(Os=$n-(Cn=(Rr=Ie*$n)-(Rr-$n)))-((Eo=Zs*$n)-Tn*Cn-Jn*Cn-Tn*Os))-((hn=mo-(Zu=(Jn=Yo-(Tn=(Rr=Ie*Yo)-(Rr-Yo)))*(Os=an-(Cn=(Rr=Ie*an)-(Rr-an)))-((Ma=Yo*an)-Tn*Cn-Jn*Cn-Tn*Os)))+(zi=mo-hn))+(zi-Zu),ut[1]=(Pa=Eo-((As=Eo+hn)-(zi=As-Eo))+(hn-zi))-((hn=Pa-Ma)+(zi=Pa-hn))+(zi-Ma),ut[2]=As-((Fs=As+hn)-(zi=Fs-As))+(hn-zi),ut[3]=Fs;var iH=Ne(tH,gt,4,ut,wt);ut[0]=(mo=(Jn=nn-(Tn=(Rr=Ie*nn)-(Rr-nn)))*(Os=$n-(Cn=(Rr=Ie*$n)-(Rr-$n)))-((Eo=nn*$n)-Tn*Cn-Jn*Cn-Tn*Os))-((hn=mo-(Zu=(Jn=cr-(Tn=(Rr=Ie*cr)-(Rr-cr)))*(Os=an-(Cn=(Rr=Ie*an)-(Rr-an)))-((Ma=cr*an)-Tn*Cn-Jn*Cn-Tn*Os)))+(zi=mo-hn))+(zi-Zu),ut[1]=(Pa=Eo-((As=Eo+hn)-(zi=As-Eo))+(hn-zi))-((hn=Pa-Ma)+(zi=Pa-hn))+(zi-Ma),ut[2]=As-((Fs=As+hn)-(zi=Fs-As))+(hn-zi),ut[3]=Fs;var rH=Ne(iH,wt,4,ut,Rt);return Rt[rH-1]}(Vt,Bt,Yt,gi,ar,lr,tr)}(ue[0],ue[1],he[0],he[1],it[0],it[1]);return dt>0?-1:dt<0?1:0}function rt(ue,he){var it=ue.point,dt=he.point;return it[0]>dt[0]?1:it[0]<dt[0]?-1:it[1]!==dt[1]?it[1]>dt[1]?1:-1:function(Vt,Bt,Yt,gi){return Vt.left!==Bt.left?Vt.left?1:-1:Tt(Yt,Vt.otherEvent.point,Bt.otherEvent.point)!==0?Vt.isBelow(Bt.otherEvent.point)?-1:1:!Vt.isSubject&&Bt.isSubject?1:-1}(ue,he,it)}function et(ue,he,it){var dt=new ne(he,!1,ue,ue.isSubject),Vt=new ne(he,!0,ue.otherEvent,ue.isSubject);return le(ue.point,ue.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ue),dt.contourId=Vt.contourId=ue.contourId,rt(Vt,ue.otherEvent)>0&&(ue.otherEvent.left=!0,Vt.left=!1),ue.otherEvent.otherEvent=Vt,ue.otherEvent=dt,it.push(Vt),it.push(dt),it}function Pt(ue,he){return ue[0]*he[1]-ue[1]*he[0]}function At(ue,he){return ue[0]*he[0]+ue[1]*he[1]}function mi(ue,he,it){var dt=function(ar,lr,rr,Yr,On){var tr=[lr[0]-ar[0],lr[1]-ar[1]],yn=[Yr[0]-rr[0],Yr[1]-rr[1]];function rn(Rr,Tn,Jn){return[Rr[0]+Tn*Jn[0],Rr[1]+Tn*Jn[1]]}var Nr=[rr[0]-ar[0],rr[1]-ar[1]],bn=Pt(tr,yn),wn=bn*bn,mn=At(tr,tr);if(wn>0){var vn=Pt(Nr,yn)/bn;if(vn<0||vn>1)return null;var nn=Pt(Nr,tr)/bn;return nn<0||nn>1?null:vn===0||vn===1?[rn(ar,vn,tr)]:nn===0||nn===1?[rn(rr,nn,yn)]:[rn(ar,vn,tr)]}if((wn=(bn=Pt(Nr,tr))*bn)>0)return null;var cr=At(tr,Nr)/mn,an=cr+At(tr,yn)/mn,$n=Math.min(cr,an),zi=Math.max(cr,an);return $n<=1&&zi>=0?$n===1?[rn(ar,$n>0?$n:0,tr)]:zi===0?[rn(ar,zi<1?zi:1,tr)]:[rn(ar,$n>0?$n:0,tr),rn(ar,zi<1?zi:1,tr)]:null}(ue.point,ue.otherEvent.point,he.point,he.otherEvent.point),Vt=dt?dt.length:0;if(Vt===0||Vt===1&&(le(ue.point,he.point)||le(ue.otherEvent.point,he.otherEvent.point))||Vt===2&&ue.isSubject===he.isSubject)return 0;if(Vt===1)return le(ue.point,dt[0])||le(ue.otherEvent.point,dt[0])||et(ue,dt[0],it),le(he.point,dt[0])||le(he.otherEvent.point,dt[0])||et(he,dt[0],it),1;var Bt=[],Yt=!1,gi=!1;return le(ue.point,he.point)?Yt=!0:rt(ue,he)===1?Bt.push(he,ue):Bt.push(ue,he),le(ue.otherEvent.point,he.otherEvent.point)?gi=!0:rt(ue.otherEvent,he.otherEvent)===1?Bt.push(he.otherEvent,ue.otherEvent):Bt.push(ue.otherEvent,he.otherEvent),Yt&&gi||Yt?(he.type=S,ue.type=he.inOut===ue.inOut?P:M,Yt&&!gi&&et(Bt[1].otherEvent,Bt[0].point,it),2):gi?(et(Bt[0],Bt[1].point,it),3):Bt[0]!==Bt[3].otherEvent?(et(Bt[0],Bt[1].point,it),et(Bt[1],Bt[2].point,it),3):(et(Bt[0],Bt[1].point,it),et(Bt[3].otherEvent,Bt[2].point,it),3)}function qt(ue,he){if(ue===he)return 0;if(Tt(ue.point,ue.otherEvent.point,he.point)!==0||Tt(ue.point,ue.otherEvent.point,he.otherEvent.point)!==0)return le(ue.point,he.point)?ue.isBelow(he.otherEvent.point)?-1:1:ue.point[0]===he.point[0]?ue.point[1]<he.point[1]?-1:1:rt(ue,he)===1?he.isAbove(ue.point)?-1:1:ue.isBelow(he.point)?-1:1;if(ue.isSubject!==he.isSubject)return ue.isSubject?-1:1;var it=ue.point,dt=he.point;return it[0]===dt[0]&&it[1]===dt[1]?(it=ue.otherEvent.point)[0]===(dt=he.otherEvent.point)[0]&&it[1]===dt[1]?0:ue.contourId>he.contourId?1:-1:rt(ue,he)===1?1:-1}var si=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Ot(ue,he,it,dt){var Vt,Bt=ue+1,Yt=he[ue].point,gi=he.length;for(Bt<gi&&(Vt=he[Bt].point);Bt<gi&&Vt[0]===Yt[0]&&Vt[1]===Yt[1];){if(!it[Bt])return Bt;++Bt<gi&&(Vt=he[Bt].point)}for(Bt=ue-1;it[Bt]&&Bt>dt;)Bt--;return Bt}si.prototype.isExterior=function(){return this.holeOf==null};var pi=Ut,Ui=Ut;function Ut(ue,he){if(!(this instanceof Ut))return new Ut(ue,he);if(this.data=ue||[],this.length=this.data.length,this.compare=he||ci,this.length>0)for(var it=(this.length>>1)-1;it>=0;it--)this._down(it)}function ci(ue,he){return ue<he?-1:ue>he?1:0}Ut.prototype={push:function(ue){this.data.push(ue),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ue=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ue}},peek:function(){return this.data[0]},_up:function(ue){for(var he=this.data,it=this.compare,dt=he[ue];ue>0;){var Vt=ue-1>>1,Bt=he[Vt];if(it(dt,Bt)>=0)break;he[ue]=Bt,ue=Vt}he[ue]=dt},_down:function(ue){for(var he=this.data,it=this.compare,dt=this.length>>1,Vt=he[ue];ue<dt;){var Bt=1+(ue<<1),Yt=Bt+1,gi=he[Bt];if(Yt<this.length&&it(he[Yt],gi)<0&&(Bt=Yt,gi=he[Yt]),it(gi,Vt)>=0)break;he[ue]=gi,ue=Bt}he[ue]=Vt}},pi.default=Ui;var Li=Math.max,Hi=Math.min,or=0;function Zi(ue,he,it,dt,Vt,Bt){var Yt,gi,ar,lr,rr,Yr;for(Yt=0,gi=ue.length-1;Yt<gi;Yt++)if(lr=ue[Yt+1],rr=new ne(ar=ue[Yt],!1,void 0,he),Yr=new ne(lr,!1,rr,he),rr.otherEvent=Yr,ar[0]!==lr[0]||ar[1]!==lr[1]){rr.contourId=Yr.contourId=it,Bt||(rr.isExteriorRing=!1,Yr.isExteriorRing=!1),rt(rr,Yr)>0?Yr.left=!0:rr.left=!0;var On=ar[0],tr=ar[1];Vt[0]=Hi(Vt[0],On),Vt[1]=Hi(Vt[1],tr),Vt[2]=Li(Vt[2],On),Vt[3]=Li(Vt[3],tr),dt.push(rr),dt.push(Yr)}}var ei=[];function qi(ue,he,it){typeof ue[0][0][0]=="number"&&(ue=[ue]),typeof he[0][0][0]=="number"&&(he=[he]);var dt=function(tr,yn,rn){var Nr=null;return tr.length*yn.length==0&&(rn===L?Nr=ei:rn===B?Nr=tr:rn!==N&&rn!==W||(Nr=tr.length===0?yn:tr)),Nr}(ue,he,it);if(dt)return dt===ei?null:dt;var Vt=[1/0,1/0,-1/0,-1/0],Bt=[1/0,1/0,-1/0,-1/0],Yt=function(tr,yn,rn,Nr,bn){var wn,mn,vn,nn,cr,an,$n=new pi(null,rt);for(vn=0,nn=tr.length;vn<nn;vn++)for(cr=0,an=(wn=tr[vn]).length;cr<an;cr++)(mn=cr===0)&&or++,Zi(wn[cr],!0,or,$n,rn,mn);for(vn=0,nn=yn.length;vn<nn;vn++)for(cr=0,an=(wn=yn[vn]).length;cr<an;cr++)mn=cr===0,bn===B&&(mn=!1),mn&&or++,Zi(wn[cr],!1,or,$n,Nr,mn);return $n}(ue,he,Vt,Bt,it);if(dt=function(tr,yn,rn,Nr,bn){var wn=null;return(rn[0]>Nr[2]||Nr[0]>rn[2]||rn[1]>Nr[3]||Nr[1]>rn[3])&&(bn===L?wn=ei:bn===B?wn=tr:bn!==N&&bn!==W||(wn=tr.concat(yn))),wn}(ue,he,Vt,Bt,it))return dt===ei?null:dt;for(var gi=function(tr){var yn,rn,Nr=function(vn){var nn,cr,an,$n,zi=[];for(cr=0,an=vn.length;cr<an;cr++)((nn=vn[cr]).left&&nn.inResult||!nn.left&&nn.otherEvent.inResult)&&zi.push(nn);for(var Rr=!1;!Rr;)for(Rr=!0,cr=0,an=zi.length;cr<an;cr++)cr+1<an&&rt(zi[cr],zi[cr+1])===1&&($n=zi[cr],zi[cr]=zi[cr+1],zi[cr+1]=$n,Rr=!1);for(cr=0,an=zi.length;cr<an;cr++)(nn=zi[cr]).otherPos=cr;for(cr=0,an=zi.length;cr<an;cr++)(nn=zi[cr]).left||($n=nn.otherPos,nn.otherPos=nn.otherEvent.otherPos,nn.otherEvent.otherPos=$n);return zi}(tr),bn={},wn=[],mn=function(){if(!bn[yn]){var vn=wn.length,nn=function(zi,Rr,Tn){var Jn=new si;if(zi.prevInResult!=null){var Cn=zi.prevInResult,Os=Cn.outputContourId;if(Cn.resultTransition>0){var hn=Rr[Os];if(hn.holeOf!=null){var As=hn.holeOf;Rr[As].holeIds.push(Tn),Jn.holeOf=As,Jn.depth=Rr[Os].depth}else Rr[Os].holeIds.push(Tn),Jn.holeOf=Os,Jn.depth=Rr[Os].depth+1}else Jn.holeOf=null,Jn.depth=Rr[Os].depth}else Jn.holeOf=null,Jn.depth=0;return Jn}(Nr[yn],wn,vn),cr=function(zi){bn[zi]=!0,zi<Nr.length&&Nr[zi]&&(Nr[zi].outputContourId=vn)},an=yn,$n=yn;for(nn.points.push(Nr[yn].point);cr(an),cr(an=Nr[an].otherPos),nn.points.push(Nr[an].point),!((an=Ot(an,Nr,bn,$n))==$n||an>=Nr.length)&&Nr[an];);wn.push(nn)}};for(yn=0,rn=Nr.length;yn<rn;yn++)mn();return wn}(function(tr,yn,rn,Nr,bn,wn){for(var mn,vn,nn,cr=new d(qt),an=[],$n=Math.min(Nr[2],bn[2]);tr.length!==0;){var zi=tr.pop();if(an.push(zi),wn===L&&zi.point[0]>$n||wn===B&&zi.point[0]>Nr[2])break;if(zi.left){vn=mn=cr.insert(zi),mn=mn!==(nn=cr.minNode())?cr.prev(mn):null,vn=cr.next(vn);var Rr=mn?mn.key:null;if(X(zi,Rr,wn),vn&&mi(zi,vn.key,tr)===2&&(X(zi,Rr,wn),X(vn.key,zi,wn)),mn&&mi(mn.key,zi,tr)===2){var Tn=mn;X(Rr,(Tn=Tn!==nn?cr.prev(Tn):null)?Tn.key:null,wn),X(zi,Rr,wn)}}else vn=mn=cr.find(zi=zi.otherEvent),mn&&vn&&(mn=mn!==nn?cr.prev(mn):null,vn=cr.next(vn),cr.remove(zi),vn&&mn&&mi(mn.key,vn.key,tr))}return an}(Yt,0,0,Vt,Bt,it)),ar=[],lr=0;lr<gi.length;lr++){var rr=gi[lr];if(rr.isExterior()){for(var Yr=[rr.points],On=0;On<rr.holeIds.length;On++)Yr.push(gi[rr.holeIds[On]].points);ar.push(Yr)}}return ar}var Ir={UNION:N,DIFFERENCE:B,INTERSECTION:L,XOR:W};a.diff=function(ue,he){return qi(ue,he,B)},a.intersection=function(ue,he){return qi(ue,he,L)},a.operations=Ir,a.union=function(ue,he){return qi(ue,he,N)},a.xor=function(ue,he){return qi(ue,he,W)},Object.defineProperty(a,"__esModule",{value:!0})})(i)}(0,tM.exports)),tM.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Hb(l,i,a,h){const d=[],_=h===0?(g,b,T,S,P,M)=>{g.push(new xt(M,T+(M-b)/(S-b)*(P-T)))}:(g,b,T,S,P,M)=>{g.push(new xt(b+(M-T)/(P-T)*(S-b),M))};for(const g of l){const b=[];for(const T of g){if(T.length<=2)continue;const S=[];for(let L=0;L<T.length-1;L++){const N=T[L].x,B=T[L].y,W=T[L+1].x,X=T[L+1].y,Z=h===0?N:B,ne=h===0?W:X;Z<i?ne>i&&_(S,N,B,W,X,i):Z>a?ne<a&&_(S,N,B,W,X,a):S.push(T[L]),ne<i&&Z>=i&&_(S,N,B,W,X,i),ne>a&&Z<=a&&_(S,N,B,W,X,a)}let P=T[T.length-1];const M=h===0?P.x:P.y;M>=i&&M<=a&&S.push(P),S.length&&(P=S[S.length-1],S[0].x===P.x&&S[0].y===P.y||S.push(S[0]),b.push(S))}b.length&&d.push(b)}return d}function J7(l,i){const a=zI(l),h=zI([i]),d=iM.intersection(a,h);return d==null?[]:rM(d)}function Q7(l,i){let h=zI(l,65536);const d=[];for(;i.valid();i.next()){const[_,g]=i.get(),b=_.x*65536,T=_.y*65536,S=g.x*65536,P=g.y*65536,M=S-b,L=P-T,N=Math.hypot(M,L);if(N===0)continue;const B=Math.trunc(L/N*3),W=-Math.trunc(M/N*3);d.push([[[b,T],[S,P],[S+B,P+W],[b+B,T+W],[b,T]]])}return d.length>0&&(h=iM.diff(h,d)),rM(h,1/65536)}function zI(l,i=1){return[l.map(a=>a.map(h=>[h.x*i,h.y*i]))]}function rM(l,i=1){return l.map(a=>a.map((h,d)=>{const _=h.map(g=>new xt(g[0]*i,g[1]*i).round());return d>0&&_.reverse(),_}))}class NI{constructor(i,a){this.layoutVertexArray=new Vu,this.indexArray=new Us,this.lineIndexArray=new Ds,this.triangleSegments=new jn,this.lineSegments=new jn,this.programConfigurations=new Gl(i.layers,{zoom:i.zoom,lut:i.lut}),this.uploaded=!1,a&&(this.elevatedLayoutVertexArray=new Uu)}update(i,a,h,d,_,g,b,T){this.programConfigurations.updatePaintArrays(i,a,_,h,d,g,b,T)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,z7.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.lineIndexBuffer=i.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,N7.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(i,a,h,d,_,g,b){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,a,h,d,_,g,void 0,b)}}class BI{constructor(i){this.zoom=i.zoom,this.pixelRatio=i.pixelRatio,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=i.lut,this.bufferData=new NI(i,!1),this.elevationBufferData=new NI(i,!0),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=i.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=i.sourceLayerIndex,this.worldview=i.worldview}updateFootprints(i,a){}populate(i,a,h,d){this.hasPattern=OI("fill",this.layers,this.pixelRatio,a);const _=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:b,id:T,index:S,sourceLayerIndex:P}of i){const M=this.layers[0]._featureFilter.needGeometry,L=Ct(b,M);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom,{worldview:this.worldview}),L,h))continue;const N=_?_.evaluate(L,{},h,a.availableImages):void 0,B={id:T,properties:b.properties,type:b.type,sourceLayerIndex:P,index:S,geometry:M?L.geometry:$t(b,h,d),patterns:{},sortKey:N};g.push(B)}_&&g.sort((b,T)=>b.sortKey-T.sortKey);for(const b of g){const{geometry:T,index:S,sourceLayerIndex:P}=b;if(this.hasPattern){const M=FI("fill",this.layers,b,this.zoom,this.pixelRatio,a);this.patternFeatures.push(M)}else this.addFeature(b,T,S,h,{},a.availableImages,a.brightness,a.elevationFeatures);a.featureIndex.insert(i[S].feature,T,S,P,this.index)}}update(i,a,h,d,_,g,b){this.bufferData.update(i,a,h,d,_,g,b,this.worldview),this.elevationBufferData.update(i,a,h,d,_,g,b,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(i,a,h,d,_,g,b,this.worldview)}addFeatures(i,a,h,d,_,g){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,a,h,d,g,i.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(i){this.bufferData.upload(i),this.elevationBufferData.upload(i),this.elevatedStructures&&this.elevatedStructures.upload(i)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(i,a,h,d,_,g=[],b,T){const S=tv(a,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(i,S,d,h,T):this.addGeometry(S,this.bufferData),this.bufferData.populatePaintArrays(i,h,_,g,d,b,this.worldview),this.elevationBufferData.populatePaintArrays(i,h,_,g,d,b,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(i,a,h,d,_){this.elevatedStructures&&(this.elevatedStructures.construct(i),this.elevatedStructures.populatePaintArrays(a,h,d,_,this.worldview))}addElevatedRoadFeature(i,a,h,d,_){const g=new Array,b=zn.getElevationFeature(i,_);if(!b)return void this.addGeometry(a,this.bufferData);{const S=this.clipPolygonsToTile(a,1);S.length>0&&g.push({polygons:S,elevationFeature:b,elevationTileID:h})}const T={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(i,{},h),featureIndex:d};for(const S of g)if(S.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new nl(S.elevationTileID,this.layers,this.zoom,this.lut));const M=S.elevationFeature.isTunnel();let L=0;i.properties.hasOwnProperty(Zr)&&(L=+i.properties[Zr]);for(const N of S.polygons)this.elevatedStructures.addPortalCandidates(S.elevationFeature.id,N,M,S.elevationFeature,L)}S.elevationFeature.constantHeight==null&&(S.polygons=this.prepareElevatedPolygons(S.polygons,S.elevationFeature,S.elevationTileID));const P=new ws(h,S.elevationTileID);this.addElevatedGeometry(S.polygons,P,S.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,d,T)}}addElevatedGeometry(i,a,h,d,_,g){const b={elevation:h,elevationSampler:a,bias:d,index:_,featureInfo:g},[T,S]=this.addGeometry(i,this.elevationBufferData,b);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:T,max:S}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,T),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,S))}addGeometry(i,a,h){let d=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,g=null;h&&(g=h.elevationSampler.constantElevation(h.elevation,h.bias),g!=null&&(d=g,_=g));const b=(T,S,P)=>{if(h!=null)if(S.push(T),g!=null)a.elevatedLayoutVertexArray.emplaceBack(g),P.push(g);else{const M=h.elevationSampler.pointElevation(T,h.elevation,h.bias);a.elevatedLayoutVertexArray.emplaceBack(M),P.push(M),d=Math.min(d,M),_=Math.max(_,M)}};for(const T of i){let S=0;for(const se of T)S+=se.length;const P=a.triangleSegments.prepareSegment(S,a.layoutVertexArray,a.indexArray),M=P.vertexLength,L=[],N=[],B=[],W=[],X=[],Z=a.layoutVertexArray.length;for(const se of T){if(se.length===0)continue;se!==T[0]&&N.push(L.length/2);const le=a.lineSegments.prepareSegment(se.length,a.layoutVertexArray,a.lineIndexArray),Ee=le.vertexLength;h&&X.push(a.layoutVertexArray.length-Z),b(se[0],B,W),a.layoutVertexArray.emplaceBack(se[0].x,se[0].y),a.lineIndexArray.emplaceBack(Ee+se.length-1,Ee),L.push(se[0].x),L.push(se[0].y);for(let Ie=1;Ie<se.length;Ie++)b(se[Ie],B,W),a.layoutVertexArray.emplaceBack(se[Ie].x,se[Ie].y),a.lineIndexArray.emplaceBack(Ee+Ie-1,Ee+Ie),L.push(se[Ie].x),L.push(se[Ie].y);le.vertexLength+=se.length,le.primitiveLength+=se.length}const ne=eg(L,N);for(let se=0;se<ne.length;se+=3)a.indexArray.emplaceBack(M+ne[se],M+ne[se+1],M+ne[se+2]);if(ne.length>0&&h&&this.elevationMode==="hd-road-base"){const se=h.elevation.isTunnel(),le=h.elevation.safeArea,Ee=this.elevatedStructures.addVertices(B,W);this.elevatedStructures.addTriangles(ne,Ee,se);const Ie=X.length;if(Ie>0){for(let Re=0;Re<Ie-1;Re++)this.elevatedStructures.addRenderableRing(h.index,X[Re]+Ee,X[Re+1]-X[Re],se,le,h.featureInfo);this.elevatedStructures.addRenderableRing(h.index,X[Ie-1]+Ee,B.length-X[Ie-1],se,le,h.featureInfo)}}P.vertexLength+=S,P.primitiveLength+=ne.length/3}return[d,_]}prepareElevatedPolygons(i,a,h){const d=1/Xe(h),_=[];for(const g of i){const b=Q7(g,new Kr(a,d));_.push(...b)}return _}clipPolygonsToTile(i,a){const h=-a,d=-a,_=Ft+a,g=Ft+a;let b=0;const T=[],S=[];for(;b<i.length;b++){const L=i[b],N=n_(L);(N.min.x>=h&&N.max.x<=_&&N.min.y>=d&&N.max.y<=g?T:S).push(L)}if(T.length===i.length)return i;const P=[new xt(h,d),new xt(_,d),new xt(_,g),new xt(h,g),new xt(h,d)],M=T;for(const L of S)M.push(...J7(L,P));return M}}let nM,sM,oM,aM;Zt(BI,"FillBucket",{omit:["layers","patternFeatures"]}),Zt(NI,"FillBufferData"),Zt(nl,"ElevatedStructures");class qb{constructor(i,a,h,d){if(this.triangleCount=a.length/3,this.min=new xt(0,0),this.max=new xt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||i.length===0)return;const[_,g]=[i[0].clone(),i[0].clone()];for(let M=1;M<i.length;++M){const L=i[M];_.x=Math.min(_.x,L.x),_.y=Math.min(_.y,L.y),g.x=Math.max(g.x,L.x),g.y=Math.max(g.y,L.y)}if(d){const M=Math.ceil(Math.max(g.x-_.x,g.y-_.y)/d);h=Math.max(h,M)}if(h===0)return;this.min=_,this.max=g;const b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);const T=Math.max(b.x,b.y)/h;this.cellsX=Math.max(1,Math.ceil(b.x/T)),this.cellsY=Math.max(1,Math.ceil(b.y/T)),this.xScale=1/T,this.yScale=1/T;const S=[];for(let M=0;M<this.triangleCount;M++){const L=i[a[3*M+0]].sub(this.min),N=i[a[3*M+1]].sub(this.min),B=i[a[3*M+2]].sub(this.min),W=Wu(Math.floor(Math.min(L.x,N.x,B.x)),this.xScale,this.cellsX),X=Wu(Math.floor(Math.max(L.x,N.x,B.x)),this.xScale,this.cellsX),Z=Wu(Math.floor(Math.min(L.y,N.y,B.y)),this.yScale,this.cellsY),ne=Wu(Math.floor(Math.max(L.y,N.y,B.y)),this.yScale,this.cellsY),se=new xt(0,0),le=new xt(0,0),Ee=new xt(0,0),Ie=new xt(0,0);for(let Re=Z;Re<=ne;++Re){se.y=le.y=Re*T,Ee.y=Ie.y=(Re+1)*T;for(let Ne=W;Ne<=X;++Ne)se.x=Ee.x=Ne*T,le.x=Ie.x=(Ne+1)*T,(Qc(L,N,B,se,le,Ie)||Qc(L,N,B,se,Ie,Ee))&&S.push({cellIdx:Re*this.cellsX+Ne,triIdx:M})}}if(S.length===0)return;S.sort((M,L)=>M.cellIdx-L.cellIdx||M.triIdx-L.triIdx);let P=0;for(;P<S.length;){const M=S[P].cellIdx,L={start:this.payload.length,len:0};for(;P<S.length&&S[P].cellIdx===M;)++L.len,this.payload.push(S[P++].triIdx);this.cells[M]=L}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(i,a){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>i.x||i.y>this.max.y||this.min.y>i.y)return;const h=Wu(i.x-this.min.x,this.xScale,this.cellsX),d=Wu(i.y-this.min.y,this.yScale,this.cellsY),_=this.cells[d*this.cellsX+h];if(_){this._lazyInitLookup();for(let g=0;g<_.len;g++){const b=this.payload[_.start+g],T=Math.floor(b/8),S=1<<b%8;if(!(this.lookup[T]&S)&&(this.lookup[T]|=S,a.push(b),a.length===this.triangleCount))return}}}query(i,a,h){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>a.x||i.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const d=Wu(i.x-this.min.x,this.xScale,this.cellsX),_=Wu(a.x-this.min.x,this.xScale,this.cellsX),g=Wu(i.y-this.min.y,this.yScale,this.cellsY),b=Wu(a.y-this.min.y,this.yScale,this.cellsY);for(let T=g;T<=b;T++)for(let S=d;S<=_;S++){const P=this.cells[T*this.cellsX+S];if(P)for(let M=0;M<P.len;M++){const L=this.payload[P.start+M],N=Math.floor(L/8),B=1<<L%8;if(!(this.lookup[N]&B)&&(this.lookup[N]|=B,h.push(L),h.length===this.triangleCount))return}}}}function Wu(l,i,a){return Math.max(0,Math.min(a-1,Math.floor(l*i)))}Zt(qb,"TriangleGridIndex");class lM{constructor(i){this.zoom=i.zoom,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[],this.worldview=i.worldview}updateFootprints(i,a){for(const h of this.footprints)a.push({footprint:h,id:i})}populate(i,a,h,d){const _=[];for(const{feature:g,id:b,index:T,sourceLayerIndex:S}of i){const P=this.layers[0]._featureFilter.needGeometry,M=Ct(g,P);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom,{worldview:this.worldview}),M,h))continue;const L={id:b,properties:g.properties,type:g.type,sourceLayerIndex:S,index:T,geometry:P?M.geometry:$t(g,h,d),patterns:{}};_.push(L)}for(const g of _){const{geometry:b,index:T,sourceLayerIndex:S}=g;this.addFeature(g,b,T,h,{},a.availableImages,a.brightness),a.featureIndex.insert(i[T].feature,b,T,S,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(i){}update(i,a,h,d,_,g,b){}destroy(){}addFeature(i,a,h,d,_,g=[],b){for(const T of tv(a,2)){const S=[],P=[],M=[],L=new xt(1/0,1/0),N=new xt(-1/0,-1/0);for(const X of T)if(X.length!==0){X!==T[0]&&M.push(P.length/2);for(let Z=0;Z<X.length;Z++)P.push(X[Z].x),P.push(X[Z].y),S.push(X[Z]),L.x=Math.min(L.x,X[Z].x),L.y=Math.min(L.y,X[Z].y),N.x=Math.max(N.x,X[Z].x),N.y=Math.max(N.y,X[Z].y)}const B=eg(P,M),W=new qb(S,B,8,256);this.footprints.push({vertices:S,indices:B,grid:W,min:L,max:N})}}}Zt(lM,"ClipBucket",{omit:["layers"]});const ej=xr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),tj=xr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),ij=xr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),rj=xr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),nj=xr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),sj=xr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:oj}=ej,iv=Number.MAX_SAFE_INTEGER,cM=iv-1;function uM(l,i,a,h){return l.order<i||l.order===iv||!(l.clipMask&a)||function(d,_){return _.length!==0&&_.find(g=>g===d)===void 0}(h,l.clipScope)}function Wb(l,i){return l.x-i.x||l.y-i.y}function hM(l,i){return Wb(l.min,i.min)===0&&Wb(l.max,i.max)===0}function VI(l,i){return!(l.min.x>i.max.x||l.max.x<i.min.x||l.min.y>i.max.y||l.max.y<i.min.y)}function Xb(l,i){if(l.length!==i.length)return!1;for(let a=0;a<l.length;a++)if(l[a].sourceId!==i[a].sourceId||!hM(l[a],i[a])||l[a].order!==i[a].order||l[a].clipMask!==i[a].clipMask||!xo(l[a].clipScope,i[a].clipScope))return!1;return!0}function dM(l,i,a){const h=1/Ft,d=1/(1<<a.canonical.z),_=(i.x*h+a.canonical.x)*d+a.wrap,g=(i.y*h+a.canonical.y)*d;return{min:new xt((l.x*h+a.canonical.x)*d+a.wrap,(l.y*h+a.canonical.y)*d),max:new xt(_,g)}}function aj(l,i,a){const h=1<<a.canonical.z,d=((i.x-a.wrap)*h-a.canonical.x)*Ft,_=(i.y*h-a.canonical.y)*Ft;return{min:new xt(((l.x-a.wrap)*h-a.canonical.x)*Ft,(l.y*h-a.canonical.y)*Ft),max:new xt(d,_)}}function UI(l,i,a,h,d,_,g){const b=l.indices,T=l.vertices,S=[];for(let P=h;P<h+d;P+=3){const M=i[a[P+0]+_],L=i[a[P+1]+_],N=i[a[P+2]+_],B=Math.min(M.x,L.x,N.x),W=Math.max(M.x,L.x,N.x),X=Math.min(M.y,L.y,N.y),Z=Math.max(M.y,L.y,N.y);S.length=0,l.grid.query(new xt(B,X),new xt(W,Z),S);for(let ne=0;ne<S.length;ne++){const se=S[ne];if(Qc(T[b[3*se+0]],T[b[3*se+1]],T[b[3*se+2]],M,L,N,g))return!0}}return!1}function fM(l,i,a,h){if(!l||!a)return!1;let d=l.vertices;if(!i.canonical.equals(h.canonical)||i.wrap!==h.wrap){if(a.vertices.length<l.vertices.length)return fM(a,h,l,i);const _=i.canonical,g=h.canonical,b=Math.pow(2,g.z-_.z);d=l.vertices.map(T=>new xt((T.x+_.x*Ft)*b-g.x*Ft,(T.y+_.y*Ft)*b-g.y*Ft))}return UI(a,d,l.indices,0,l.indices.length,0,0)}function pM(l,i,a,h){const d=Math.pow(2,h.z-a.z);return new xt((l+a.x*Ft)*d-h.x*Ft,(i+a.y*Ft)*d-h.y*Ft)}function jI(l,i){const a=[];i.grid.queryPoint(l,a);const h=i.indices,d=i.vertices;for(let _=0;_<a.length;_++){const g=a[_];if(Xs([d[h[3*g+0]],d[h[3*g+1]],d[h[3*g+2]]],l))return!0}return!1}const $I=[new xt(0,0),new xt(Ft,0),new xt(Ft,Ft),new xt(0,Ft)];function mM(l,i){const a=[];let h=[];if(!i||l.length<2)return[l];if(l.length===2)return wo(l[0],l[1],$I)?[l]:[];for(let d=0;d<l.length+2;d++){const _=l[d%l.length],g=l[(d+1)%l.length],b=wo(d===0?l[l.length-1]:l[(d-1)%l.length],_,$I),T=wo(_,g,$I),S=b||T;S&&h.push(_),S&&T||h.length>0&&(h.length>1&&a.push(h),h=[])}return h.length>1&&a.push(h),a}const GI=It.types,lj=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],cj=["fill-extrusion-flood-light-ground-radius"],uj=Math.pow(2,13),hj=Math.pow(2,15)-1,_M=new xt(0,1),vf=2147483648;function rv(l,i,a,h,d,_,g,b){l.emplaceBack((i<<1)+g,(a<<1)+_,(Math.floor(h*uj)<<1)+d,Math.round(b))}function nv(l,i,a){l.emplaceBack(i.x*Ft,i.y*Ft,a?1:0)}function Zb(l,i,a,h,d,_){l.emplaceBack(i.x,i.y,(a.x<<1)+h,(a.y<<1)+d,_)}function sv(l,i,a){l.emplaceBack(i.x,i.y,i.z,a[0]*16384,a[1]*16384,a[2]*16384)}class gM{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class yM{constructor(){this.centroidXY=new xt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new xt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new xt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new xt(this.max.x-this.min.x,this.max.y-this.min.y)}}class vM{constructor(){this.acc=new xt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(i,a){i.min.x===Number.MAX_VALUE&&(i.min.x=i.max.x=a.x,i.min.y=i.max.y=a.y)}appendEdge(i,a,h){this.accCount++,this.acc._add(a);let d=!!this.borders;a.x<i.min.x?(i.min.x=a.x,d=!0):a.x>i.max.x&&(i.max.x=a.x,d=!0),a.y<i.min.y?(i.min.y=a.y,d=!0):a.y>i.max.y&&(i.max.y=a.y,d=!0),((a.x===0||a.x===Ft)&&a.x===h.x)!=((a.y===0||a.y===Ft)&&a.y===h.y)&&this.processBorderOverlap(a,h),d&&this.checkBorderIntersection(a,h)}checkBorderIntersection(i,a){a.x<0!=i.x<0&&this.addBorderIntersection(0,Ri(a.y,i.y,(0-a.x)/(i.x-a.x))),a.x>Ft!=i.x>Ft&&this.addBorderIntersection(1,Ri(a.y,i.y,(Ft-a.x)/(i.x-a.x))),a.y<0!=i.y<0&&this.addBorderIntersection(2,Ri(a.x,i.x,(0-a.y)/(i.y-a.y))),a.y>Ft!=i.y>Ft&&this.addBorderIntersection(3,Ri(a.x,i.x,(Ft-a.y)/(i.y-a.y)))}addBorderIntersection(i,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[i];a<h[0]&&(h[0]=a),a>h[1]&&(h[1]=a)}processBorderOverlap(i,a){if(i.x===a.x){if(i.y===a.y)return;const h=i.x===0?0:1;this.addBorderIntersection(h,a.y),this.addBorderIntersection(h,i.y)}else{const h=i.y===0?2:3;this.addBorderIntersection(h,a.x),this.addBorderIntersection(h,i.x)}}centroid(){return this.accCount===0?new xt(0,0):new xt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((i,a)=>i+ +(a[0]!==Number.MAX_VALUE),0):0}}function xM(l,i){const a=l.add(i)._unit(),h=fe(l.x*a.x+l.y*a.y,-1,1);var d,_,g;return d=Math.acos(h),Math.min(4,Math.max(-4,Math.tan(d)))/4*hj*((_=l).x*(g=i).y-_.y*g.x<0?-1:1)}const dj=[l=>l.x<0,l=>l.x>Ft,l=>l.y<0,l=>l.y>Ft];function fj(l,i,a,h){const d=[4];if(h===0)return d;a._mult(h);const _=l.sub(a),g=i.sub(a),b=[l,i,_,g];for(let T=0;T<4;T++)for(const S of b)if(dj[T](S)){d.push(T);break}return d}class HI{constructor(i){this.vertexArray=new zy,this.indexArray=new Us,this.programConfigurations=new Gl(i.layers,{zoom:i.zoom,lut:i.lut},a=>cj.includes(a)),this._segments=new jn,this.hiddenByLandmarkVertexArray=new X_,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new jn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(i,a,h,d=!1){const _=i.length;if(_>2){let g=Math.max(0,this._segments.get().length-1);const b=this._segments._prepareSegment(4*_,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let T;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const S=i[0],P=i[1];T=xM(S.sub(i[_-1])._perp()._unit(),P.sub(S)._perp()._unit())}for(let S=0;S<_;S++){const P=S===_-1?0:S+1,M=i[S],L=i[P],N=i[P===_-1?0:P+1],B=L.sub(M)._perp()._unit(),W=xM(B,N.sub(L)._perp()._unit()),X=T,Z=W;if(qI(M,L,a)||d&&TM(M,a)&&TM(L,a)){T=W;continue}const ne=b.vertexLength;Zb(this.vertexArray,M,L,1,1,X),Zb(this.vertexArray,M,L,1,0,X),Zb(this.vertexArray,M,L,0,1,Z),Zb(this.vertexArray,M,L,0,0,Z),b.vertexLength+=4;const se=fj(M,L,B,h);for(const le of se)this._segmentToGroundQuads[g].push({id:ne,region:le}),this._segmentToRegionTriCounts[g][le]+=2,b.primitiveLength+=2;T=W}}}prepareBorderSegments(){if(!this.hasData())return;const i=this._segments.get(),a=i.length;for(let h=0;h<a;h++)this._segmentToGroundQuads[h].sort((d,_)=>d.region-_.region);for(let h=0;h<a;h++){const d=this._segmentToGroundQuads[h],_=i[h],g=this._segmentToRegionTriCounts[h];g.reduce((T,S)=>T+S,0);let b=0;for(let T=0;T<=4;T++){const S=g[T];if(S!==0){let P=this.regionSegments[T];P||(P=this.regionSegments[T]=new jn);const M={vertexOffset:_.vertexOffset,primitiveOffset:_.primitiveOffset+b,vertexLength:_.vertexLength,primitiveLength:S};P.get().push(M)}b+=S}for(let T=0;T<d.length;T++){const S=d[T].id;this.indexArray.emplaceBack(S,S+1,S+3),this.indexArray.emplaceBack(S,S+3,S+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(i,a,h,d,_,g,b){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,i,a,h,d,_,g,void 0,b)}upload(i){this.hasData()&&(this.vertexBuffer=i.createVertexBuffer(this.vertexArray,tj.members),this.indexBuffer=i.createIndexBuffer(this.indexArray))}uploadPaintProperties(i){this.hasData()&&this.programConfigurations.upload(i)}update(i,a,h,d,_,g,b,T){this.hasData()&&this.programConfigurations.updatePaintArrays(i,a,h,d,_,g,b,T)}updateHiddenByLandmark(i){this.updateHiddenByLandmarkRange(i.groundVertexArrayOffset,i.groundVertexCount,!!(i.flags&vf))}updateHiddenByLandmarkRange(i,a,h){if(!this.hasData())return;const d=a+i;if(a!==0){for(let _=i;_<d;++_)this.hiddenByLandmarkVertexArray.emplace(_,h?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(i){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=i.createVertexBuffer(this.hiddenByLandmarkVertexArray,nj.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let i=0;i<=4;i++){const a=this.regionSegments[i];a&&a.destroy()}}}}class Kb{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.pixelRatio=i.pixelRatio,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Us,this.footprintVertices=new Vu,this.footprintSegments=[],this.layoutVertexArray=new Yh,this.centroidVertexArray=new Db,this.wallVertexArray=new Ob,this.indexArray=new Us,this.programConfigurations=new Gl(i.layers,{zoom:i.zoom,lut:i.lut},a=>lj.includes(a)),this.segments=new jn,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new HI(i),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=i.worldview}updateFootprints(i,a){}populate(i,a,h,d){this.features=[],this.hasPattern=OI("fill-extrusion",this.layers,this.pixelRatio,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Xe(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:_,id:g,index:b,sourceLayerIndex:T}of i){const S=this.layers[0]._featureFilter.needGeometry,P=Ct(_,S);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom,{worldview:this.worldview}),P,h))continue;const M={id:g,sourceLayerIndex:T,index:b,geometry:S?P.geometry:$t(_,h,d),properties:_.properties,type:_.type,patterns:{}},L=this.layoutVertexArray.length,N=GI[M.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:_.id,feature:FI("fill-extrusion",this.layers,M,this.zoom,this.pixelRatio,a)});else if(this.wallMode)for(const B of M.geometry)for(const W of mM(B,N))this.addFeature(_.id,M,[W],b,h,{},a.availableImages,d,a.brightness);else this.addFeature(_.id,M,M.geometry,b,h,{},a.availableImages,d,a.brightness);a.featureIndex.insert(_,M.geometry,b,T,this.index,L)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(i,a,h,d,_,g){for(const{featureId:b,feature:T}of this.features){const S=GI[T.type]==="Polygon",{geometry:P}=T;if(this.wallMode)for(const M of P)for(const L of mM(M,S))this.addFeature(b,T,[L],T.index,a,h,d,_,g);else this.addFeature(b,T,P,T.index,a,h,d,_,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(i,a,h,d,_,g,b){this.programConfigurations.updatePaintArrays(i,a,_,h,d,g,b,this.worldview),this.groundEffect.update(i,a,_,h,d,g,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,oj),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.wallVertexBuffer=i.createVertexBuffer(this.wallVertexArray,rj.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,sj.members,!0)),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.groundEffect.uploadHiddenByLandmark(i),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,ij.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,a,h,d,_,g,b,T,S){const P=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(a,{})/this.tileToMeter,M=[new xt(0,0),new xt(Ft,Ft)],L=T.projection,N=L.name==="globe",B=this.wallMode||GI[a.type]==="Polygon",W=new vM;W.centroidDataIndex=this.centroidData.length;const X=new yM;X.buildingId=i,a.properties&&a.properties.hasOwnProperty("building_id")&&(X.buildingId=a.properties.building_id);const Z=this.layers[0].paint.get("fill-extrusion-base").evaluate(a,{},_)<=0,ne=this.layers[0].paint.get("fill-extrusion-height").evaluate(a,{},_);let se;if(X.height=ne,X.vertexArrayOffset=this.layoutVertexArray.length,X.groundVertexArrayOffset=this.groundEffect.vertexArray.length,N&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new $_),this.wallMode){if(N)return void Ji("Non zero fill-extrusion-line-width is not yet supported on globe.");if(h.length!==1)return;se=function(We){const mt=We[0].x===We[We.length-1].x&&We[0].y===We[We.length-1].y;(function(Ot){let pi=0;const Ui=Ot.length;for(let Ut=0;Ut<Ui;Ut++)pi+=(Ot[(Ut+1)%Ui].x-Ot[Ut].x)*(Ot[(Ut+1)%Ui].y+Ot[Ut].y);return pi>=0})(We)||(We=We.reverse());const gt={geometry:[],joinNormals:[],indices:[]},wt=[],Rt=[],ut=[];let Tt=We.length;for(;Tt>=2&&We[Tt-1].equals(We[Tt-2]);)Tt--;if(Tt<(mt?3:2))return gt;let rt,et,Pt,At,mi,qt=0;for(;qt<Tt-1&&We[qt].equals(We[qt+1]);)qt++;mt&&(rt=We[Tt-2],mi=We[qt].sub(rt)._unit()._perp());for(let Ot=qt;Ot<Tt;Ot++){if(Pt=Ot===Tt-1?mt?We[qt+1]:void 0:We[Ot+1],Pt&&We[Ot].equals(Pt))continue;mi&&(At=mi),rt&&(et=rt),rt=We[Ot],mi=Pt?Pt.sub(rt)._unit()._perp():At,At=At||mi;let pi=At.add(mi);pi.x===0&&pi.y===0||pi._unit();const Ui=pi.x*mi.x+pi.y*mi.y,Ut=Ui!==0?1/Ui:1/0,ci=At.x*mi.y-At.y*mi.x>0;let Li="miter";const Hi=2;Li==="miter"&&Ut>Hi&&(Li="bevel"),Li==="bevel"&&(Ut>100&&(Li="flipbevel"),Ut<Hi&&(Li="miter"));const or=(Zi,ei,qi,Ir)=>{const ue=new xt(Zi.x,Zi.y),he=new xt(Zi.x,Zi.y);ue.x+=ei.x*Ir,ue.y+=ei.y*Ir,he.x-=ei.x*Math.max(qi,1),he.y-=ei.y*Math.max(qi,1),ut.push(ei),wt.push(ue),Rt.push(he)};if(Li==="miter")pi._mult(Ut),or(rt,pi,0,0);else if(Li==="flipbevel")pi=mi.mult(-1),or(rt,pi,0,0),or(rt,pi.mult(-1),0,0);else{const Zi=-Math.sqrt(Ut*Ut-1),ei=ci?Zi:0,qi=ci?0:Zi;et&&or(rt,At,ei,qi),Pt&&or(rt,mi,ei,qi)}}gt.geometry=[...wt,...Rt.reverse(),wt[0]],gt.joinNormals=[...ut,...ut.reverse(),ut[ut.length-1]];const si=gt.geometry.length-1;for(let Ot=0;Ot<si/2;Ot++)if(Ot+1<si/2){let pi=Ot,Ui=Ot+1,Ut=si-1-Ot,ci=si-2-Ot;pi=pi===0?si-1:pi-1,Ui=Ui===0?si-1:Ui-1,Ut=Ut===0?si-1:Ut-1,ci=ci===0?si-1:ci-1,gt.indices.push(Ut),gt.indices.push(Ui),gt.indices.push(pi),gt.indices.push(Ut),gt.indices.push(ci),gt.indices.push(Ui)}return gt}(h[0]),h=[se.geometry]}const le=(We,mt)=>We<(mt.length-1)/2||We===mt.length-1,Ee=this.wallMode?[h]:tv(h,500);for(let We=Ee.length-1;We>=0;We--){const mt=Ee[We];(mt.length===0||(Ie=mt[0]).every(St=>St.x<=0)||Ie.every(St=>St.x>=Ft)||Ie.every(St=>St.y<=0)||Ie.every(St=>St.y>=Ft))&&Ee.splice(We,1)}var Ie;let Re;if(N)Re=AM(Ee,M,_);else{Re=[];for(const We of Ee)Re.push({polygon:We,bounds:M})}const Ne=B?this.edgeRadius:0,je=Ne>0&&this.zoom<17,ft=(We,mt)=>{if(We.length===0)return!1;const St=We[We.length-1];return mt.x===St.x&&mt.y===St.y};for(const{polygon:We,bounds:mt}of Re){let St=0,gt=0;for(const Tt of We)B&&!Tt[0].equals(Tt[Tt.length-1])&&Tt.push(Tt[0]),gt+=B?Tt.length-1:Tt.length;const wt=this.segments.prepareSegment((B?5:4)*gt,this.layoutVertexArray,this.indexArray);X.footprintSegIdx<0&&(X.footprintSegIdx=this.footprintSegments.length),X.polygonSegIdx<0&&(X.polygonSegIdx=this.polygonSegments.length);const Rt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ut=new gM;if(ut.vertexOffset=this.footprintVertices.length,ut.indexOffset=3*this.footprintIndices.length,ut.ringIndices=[],B){const Tt=[],rt=[];St=wt.vertexLength;for(let Pt=0;Pt<We.length;Pt++){const At=We[Pt];At.length&&Pt!==0&&rt.push(Tt.length/2);const mi=[];let qt,si;qt=At[1].sub(At[0])._perp()._unit(),ut.ringIndices.push(At.length-1);for(let Ot=1;Ot<At.length;Ot++){const pi=At[Ot],Ui=At[Ot===At.length-1?1:Ot+1],Ut=pi.clone();if(Ne){si=Ui.sub(pi)._perp()._unit();const ci=qt.add(si)._unit(),Li=Ne*Math.min(4,1/(qt.x*ci.x+qt.y*ci.y));Ut.x+=Li*ci.x,Ut.y+=Li*ci.y,Ut.x=Math.round(Ut.x),Ut.y=Math.round(Ut.y),qt=si}if(!Z||Ne!==0&&!je||ft(mi,Ut)||mi.push(Ut),rv(this.layoutVertexArray,Ut.x,Ut.y,0,0,1,1,0),this.wallMode){const ci=le(Ot,At);nv(this.wallVertexArray,se.joinNormals[Ot],!ci)}wt.vertexLength++,this.footprintVertices.emplaceBack(pi.x,pi.y),Tt.push(pi.x,pi.y),N&&sv(this.layoutVertexExtArray,L.projectTilePoint(Ut.x,Ut.y,_),L.upVector(_,Ut.x,Ut.y))}Z&&(Ne===0||je)&&(mi.length!==0&&ft(mi,mi[0])&&mi.pop(),this.groundEffect.addData(mi,mt,P))}const et=this.wallMode?se.indices:eg(Tt,rt);for(let Pt=0;Pt<et.length;Pt+=3)this.footprintIndices.emplaceBack(ut.vertexOffset+et[Pt+0],ut.vertexOffset+et[Pt+1],ut.vertexOffset+et[Pt+2]),this.indexArray.emplaceBack(St+et[Pt],St+et[Pt+2],St+et[Pt+1]),wt.primitiveLength++;ut.indexCount+=et.length,ut.vertexCount+=this.footprintVertices.length-ut.vertexOffset}for(let Tt=0;Tt<We.length;Tt++){const rt=We[Tt];W.startRing(X,rt[0]);let et=rt.length>4&&EM(rt[rt.length-2],rt[0],rt[1]),Pt=Ne?pj(rt[rt.length-2],rt[0],rt[1],Ne):0;const At=[];let mi,qt,si;qt=rt[1].sub(rt[0])._perp()._unit();let Ot=!0;for(let pi=1,Ui=0;pi<rt.length;pi++){let Ut=rt[pi-1],ci=rt[pi];const Li=rt[pi===rt.length-1?1:pi+1];if(W.appendEdge(X,ci,Ut),qI(ci,Ut,mt)){Ne&&(qt=Li.sub(ci)._perp()._unit(),Ot=!Ot);continue}const Hi=ci.sub(Ut)._perp(),or=Hi.x/(Math.abs(Hi.x)+Math.abs(Hi.y)),Zi=Hi.y>0?1:0,ei=Ut.dist(ci);if(Ui+ei>32768&&(Ui=0),Ne){si=Li.sub(ci)._perp()._unit();let he=wM(Ut,ci,Li,bM(qt,si),Ne);isNaN(he)&&(he=0);const it=ci.sub(Ut)._unit();Ut=Ut.add(it.mult(Pt))._round(),ci=ci.add(it.mult(-he))._round(),Pt=he,qt=si,Z&&this.zoom>=17&&(ft(At,Ut)||At.push(Ut),ft(At,ci)||At.push(ci))}const qi=wt.vertexLength,Ir=rt.length>4&&EM(Ut,ci,Li);let ue=IM(Ui,et,Ot);if(rv(this.layoutVertexArray,Ut.x,Ut.y,or,Zi,0,0,ue),rv(this.layoutVertexArray,Ut.x,Ut.y,or,Zi,0,1,ue),this.wallMode){const he=le(pi-1,rt),it=se.joinNormals[pi-1];nv(this.wallVertexArray,it,he),nv(this.wallVertexArray,it,he)}if(Ui+=ei,ue=IM(Ui,Ir,!Ot),et=Ir,rv(this.layoutVertexArray,ci.x,ci.y,or,Zi,0,0,ue),rv(this.layoutVertexArray,ci.x,ci.y,or,Zi,0,1,ue),this.wallMode){const he=le(pi,rt),it=se.joinNormals[pi];nv(this.wallVertexArray,it,he),nv(this.wallVertexArray,it,he)}if(wt.vertexLength+=4,this.indexArray.emplaceBack(qi+0,qi+1,qi+2),this.indexArray.emplaceBack(qi+1,qi+3,qi+2),wt.primitiveLength+=2,Ne){const he=St+(pi===1?rt.length-2:pi-2),it=pi===1?St:he+1;if(this.indexArray.emplaceBack(qi+1,he,qi+3),this.indexArray.emplaceBack(he,it,qi+3),wt.primitiveLength+=2,mi===void 0&&(mi=qi),!qI(Li,rt[pi],mt)){const dt=pi===rt.length-1?mi:wt.vertexLength;this.indexArray.emplaceBack(qi+2,qi+3,dt),this.indexArray.emplaceBack(qi+3,dt+1,dt),this.indexArray.emplaceBack(qi+3,it,dt+1),wt.primitiveLength+=3}Ot=!Ot}if(N){const he=this.layoutVertexExtArray,it=L.projectTilePoint(Ut.x,Ut.y,_),dt=L.projectTilePoint(ci.x,ci.y,_),Vt=L.upVector(_,Ut.x,Ut.y),Bt=L.upVector(_,ci.x,ci.y);sv(he,it,Vt),sv(he,it,Vt),sv(he,dt,Bt),sv(he,dt,Bt)}}B&&(St+=rt.length-1),Z&&Ne&&this.zoom>=17&&(At.length!==0&&ft(At,At[0])&&At.pop(),this.groundEffect.addData(At,mt,P,Ne>0))}this.footprintSegments.push(ut),Rt.triangleCount=this.indexArray.length-Rt.triangleArrayOffset,this.polygonSegments.push(Rt),++X.footprintSegLen,++X.polygonSegLen}if(X.vertexCount=this.layoutVertexArray.length-X.vertexArrayOffset,X.groundVertexCount=this.groundEffect.vertexArray.length-X.groundVertexArrayOffset,X.vertexCount!==0){if(X.centroidXY=W.borders?_M:this.encodeCentroid(W,X),this.centroidData.push(X),W.borders){this.featuresOnBorder.push(W);const We=this.featuresOnBorder.length-1;for(let mt=0;mt<W.borders.length;mt++)W.borders[mt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[mt].push(We)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,d,g,b,_,S,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(a,d,g,b,_,S,this.worldview),this.maxHeight=Math.max(this.maxHeight,ne)}}sortBorders(){for(let i=0;i<this.borderFeatureIndices.length;i++)this.borderFeatureIndices[i].sort((a,h)=>this.featuresOnBorder[a].borders[i][0]-this.featuresOnBorder[h].borders[i][0])}splitToSubtiles(){const i=[];for(let b=0;b<this.centroidData.length;b++){const T=this.centroidData[b],S=+(T.min.y+T.max.y>Ft),P=2*S+(+(T.min.x+T.max.x>Ft)^S);for(let M=0;M<T.polygonSegLen;M++){const L=T.polygonSegIdx+M;i.push({centroidIdx:b,subtile:P,polygonSegmentIdx:L,triangleSegmentIdx:this.polygonSegments[L].triangleSegIdx})}}const a=new Us;i.sort((b,T)=>b.triangleSegmentIdx===T.triangleSegmentIdx?b.subtile-T.subtile:b.triangleSegmentIdx-T.triangleSegmentIdx);let h=0,d=0,_=0;for(const b of i){if(b.triangleSegmentIdx!==h)break;_++}const g=i.length;for(;d!==i.length;){h=i[d].triangleSegmentIdx;let b=0,T=d,S=d;for(let P=T;P<_&&i[P].subtile===b;P++)S++;for(;T!==_;){const P=i[T];b=P.subtile;const M=this.centroidData[P.centroidIdx].min.clone(),L=this.centroidData[P.centroidIdx].max.clone(),N={vertexOffset:this.segments.segments[h].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[h].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let B=T;B<S;B++){const W=i[B],X=this.polygonSegments[W.polygonSegmentIdx],Z=this.centroidData[W.centroidIdx].min,ne=this.centroidData[W.centroidIdx].max,se=this.indexArray.uint16;for(let le=X.triangleArrayOffset;le<X.triangleArrayOffset+X.triangleCount;le++)a.emplaceBack(se[3*le],se[3*le+1],se[3*le+2]);N.primitiveLength+=X.triangleCount,M.x=Math.min(M.x,Z.x),M.y=Math.min(M.y,Z.y),L.x=Math.max(L.x,ne.x),L.y=Math.max(L.y,ne.y)}N.primitiveLength>0&&this.triangleSubSegments.push({segment:N,min:M,max:L}),T=S;for(let B=T;B<_&&i[B].subtile===i[T].subtile;B++)S++}d=_;for(let P=d;P<g&&i[P].triangleSegmentIdx===i[d].triangleSegmentIdx;P++)_++}a._trim(),this.indexArray=a}getVisibleSegments(i,a,h){const d=new jn;if(this.wallMode){for(const W of this.triangleSubSegments)d.segments.push(W.segment);return d}let _=0,g=0;const b=1<<i.canonical.z;if(a){const W=a.getMinMaxForTile(i);W&&(_=W.min,g=W.max)}g+=this.maxHeight;const T=i.toUnwrapped();let S;const P=[T.canonical.x/b+T.wrap,T.canonical.y/b],M=[(T.canonical.x+1)/b+T.wrap,(T.canonical.y+1)/b],L=(W,X,Z)=>[W[0]*(1-Z[0])+X[0]*Z[0],W[1]*(1-Z[1])+X[1]*Z[1]],N=[],B=[];for(const W of this.triangleSubSegments){N[0]=W.min.x/Ft,N[1]=W.min.y/Ft,B[0]=W.max.x/Ft,B[1]=W.max.y/Ft;const X=L(P,M,N),Z=L(P,M,B);if(new Fi([X[0],X[1],_],[Z[0],Z[1],g]).intersectsPrecise(h)===0){S&&(d.segments.push(S),S=void 0);continue}const ne=W.segment;S&&S.vertexOffset!==ne.vertexOffset&&(d.segments.push(S),S=void 0),S?(S.vertexLength+=ne.vertexLength,S.primitiveLength+=ne.primitiveLength):S={vertexOffset:ne.vertexOffset,primitiveLength:ne.primitiveLength,vertexLength:ne.vertexLength,primitiveOffset:ne.primitiveOffset,sortKey:void 0,vaos:{}}}return S&&d.segments.push(S),d}encodeCentroid(i,a){const h=i.centroid(),d=a.span(),_=Math.min(7,Math.round(d.x*this.tileToMeter/10)),g=Math.min(7,Math.round(d.y*this.tileToMeter/10));return new xt(fe(h.x,1,Ft-1)<<3|_,fe(h.y,1,Ft-1)<<3|g)}encodeBorderCentroid(i){if(!i.borders)return new xt(0,0);const a=i.borders,h=Number.MAX_VALUE;if(a[0][0]!==h||a[1][0]!==h){const d=a[0][0]!==h?0:1;return new xt(6|(a[0][0]!==h?0:65528),(a[d][0]+a[d][1])/2<<3|6)}{const d=a[2][0]!==h?2:3;return new xt((a[d][0]+a[d][1])/2<<3|6,6|(a[2][0]!==h?0:65528))}}showCentroid(i){const a=this.centroidData[i.centroidDataIndex];a.flags&=2147483647,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(i){this.groundEffect.updateHiddenByLandmark(i);const a=i.vertexArrayOffset,h=i.vertexCount+i.vertexArrayOffset,d=i.flags&vf?_M:i.centroidXY,_=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==d.y||_!==d.x){for(let g=a;g<h;++g)this.centroidVertexArray.emplace(g,d.x,d.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const i of this.centroidData)this.writeCentroidToBuffer(i)}updateReplacement(i,a,h){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(i.toUnwrapped());if(Xb(this.activeReplacements,d))return;if(this.activeReplacements=d,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const g of this.centroidData)g.flags&=2147483647;const _=[];for(const g of this.activeReplacements){if(g.order<h)continue;const b=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-i.canonical.z));if(g.footprint.buildingId){const T=g.footprint.buildingId;for(const S of this.centroidData)S.buildingId===T&&(S.flags|=vf)}else for(const T of this.centroidData)if(!(T.flags&vf||g.min.x>T.max.x||T.min.x>g.max.x||g.min.y>T.max.y||T.min.y>g.max.y))for(let S=0;S<T.footprintSegLen;S++){const P=this.footprintSegments[T.footprintSegIdx+S];if(_.length=0,mj(this.footprintVertices,P.vertexOffset,P.vertexCount,g.footprintTileId.canonical,i.canonical,_),UI(g.footprint,_,this.footprintIndices.uint16,P.indexOffset,P.indexCount,-P.vertexOffset,-b)){T.flags|=vf;break}}}for(const g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(i,a,h){let d=!1;for(let _=0;_<h.footprintSegLen;_++){const g=this.footprintSegments[h.footprintSegIdx+_];let b=0;for(const T of g.ringIndices){for(let S=b,P=T+b-1;S<T+b;P=S++){const M=this.footprintVertices.int16[2*(S+g.vertexOffset)+0],L=this.footprintVertices.int16[2*(S+g.vertexOffset)+1],N=this.footprintVertices.int16[2*(P+g.vertexOffset)+1];L>a!=N>a&&i<(this.footprintVertices.int16[2*(P+g.vertexOffset)+0]-M)*(a-L)/(N-L)+M&&(d=!d)}b=T}}return d}getHeightAtTileCoord(i,a){let h=Number.NEGATIVE_INFINITY,d=!0;const _=4*(i+Ft)*Ft+(a+Ft);if(this.partLookup.hasOwnProperty(_)){const g=this.partLookup[_];return g?{height:g.height,hidden:!!(g.flags&vf)}:void 0}for(const g of this.centroidData)i>g.max.x||g.min.x>i||a>g.max.y||g.min.y>a||g.height<=h||this.footprintContainsPoint(i,a,g)&&(h=g.height,this.partLookup[_]=g,d=!!(g.flags&vf));if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:d};this.partLookup[_]=void 0}}function bM(l,i){const a=l.add(i)._unit();return l.x*a.x+l.y*a.y}function pj(l,i,a,h){const d=i.sub(l)._perp()._unit(),_=a.sub(i)._perp()._unit();return wM(l,i,a,bM(d,_),h)}function wM(l,i,a,h,d){const _=Math.sqrt(1-h*h);return Math.min(l.dist(i)/3,i.dist(a)/3,d*_/h)}function qI(l,i,a){return l.x<a[0].x&&i.x<a[0].x||l.x>a[1].x&&i.x>a[1].x||l.y<a[0].y&&i.y<a[0].y||l.y>a[1].y&&i.y>a[1].y}function TM(l,i){return l.x<i[0].x||l.x>i[1].x||l.y<i[0].y||l.y>i[1].y}function EM(l,i,a){if(l.x<0||l.x>=Ft||i.x<0||i.x>=Ft||a.x<0||a.x>=Ft)return!1;const h=a.sub(i),d=h.perp(),_=l.sub(i);return(h.x*_.x+h.y*_.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(_.x*_.x+_.y*_.y))>-.866&&d.x*_.x+d.y*_.y<0}function IM(l,i,a){const h=i?2|l:-3&l;return a?1|h:-2&h}function SM(){const l=Math.PI/32,i=Math.tan(l),a=j;return a*Math.sqrt(1+2*i*i)-a}function AM(l,i,a){const h=1<<a.z,d=xe(a.x/h),_=xe((a.x+1)/h),g=ge(a.y/h),b=ge((a.y+1)/h);return function(T,S,P,M,L=0,N){const B=[];if(!T.length||!P||!M)return B;const W=(Ie,Re)=>{for(const Ne of Ie)B.push({polygon:Ne,bounds:Re})},X=Math.ceil(Math.log2(P)),Z=Math.ceil(Math.log2(M)),ne=X-Z,se=[];for(let Ie=0;Ie<Math.abs(ne);Ie++)se.push(ne>0?0:1);for(let Ie=0;Ie<Math.min(X,Z);Ie++)se.push(0),se.push(1);let le=T;if(le=Hb(le,S[0].y-L,S[1].y+L,1),le=Hb(le,S[0].x-L,S[1].x+L,0),!le.length)return B;const Ee=[];for(se.length?Ee.push({polygons:le,bounds:S,depth:0}):W(le,S);Ee.length;){const Ie=Ee.pop(),Re=Ie.depth,Ne=se[Re],je=Ie.bounds[0],ft=Ie.bounds[1],We=Ne===0?je.x:je.y,mt=Ne===0?ft.x:ft.y,St=N?N(Ne,We,mt):.5*(We+mt),gt=Hb(Ie.polygons,We-L,St+L,Ne),wt=Hb(Ie.polygons,St-L,mt+L,Ne);if(gt.length){const Rt=[je,new xt(Ne===0?St:ft.x,Ne===1?St:ft.y)];se.length>Re+1?Ee.push({polygons:gt,bounds:Rt,depth:Re+1}):W(gt,Rt)}if(wt.length){const Rt=[new xt(Ne===0?St:je.x,Ne===1?St:je.y),ft];se.length>Re+1?Ee.push({polygons:wt,bounds:Rt,depth:Re+1}):W(wt,Rt)}}return B}(l,i,Math.ceil((_-d)/11.25),Math.ceil((g-b)/11.25),1,(T,S,P)=>{if(T===0)return .5*(S+P);{const M=ge((a.y+S/Ft)/h);return(ve(.5*(ge((a.y+P/Ft)/h)+M))*h-a.y)*Ft}})}function mj(l,i,a,h,d,_){const g=Math.pow(2,h.z-d.z);for(let b=0;b<a;b++){let T=l.int16[2*(b+i)+0],S=l.int16[2*(b+i)+1];T=(T+d.x*Ft)*g-h.x*Ft,S=(S+d.y*Ft)*g-h.y*Ft,_.push(new xt(T,S))}}let CM,RM;Zt(Kb,"FillExtrusionBucket",{omit:["layers","features"]}),Zt(yM,"PartData"),Zt(gM,"FootprintSegment"),Zt(vM,"BorderCentroidData"),Zt(HI,"GroundEffect");class $p extends xt{constructor(i,a,h){super(i,a),this.z=h}}class PM extends $p{constructor(i,a,h,d){super(i,a,h),this.w=d}}function MM(l,i,a,h){const d=a==="x"?"y":"x",_=(h-l[a])/(i[a]-l[a]);l[d]=Math.round(l[d]+(i[d]-l[d])*_),l[a]=h,l.hasOwnProperty("z")&&(l.z=Ri(l.z,i.z,_)),l.hasOwnProperty("w")&&(l.w=Ri(l.w,i.w,_))}function kM(l,i,a,h){const d=a,_=h;for(const g of["x","y"]){let b=l,T=i;b[g]>=T[g]&&(b=i,T=l),b[g]<d&&T[g]>d&&MM(b,T,g,d),b[g]<_&&T[g]>_&&MM(T,b,g,_)}}function Yb(l,i,a,h,d,_){const g=[];for(let b=0;b<l.length;b++){const T=l[b];let S;const P=g.length;let M=0;for(let L=0;L<T.length-1;L++){let N=T[L],B=T[L+1],W=0;const X=M;let Z,ne;_&&(W=Math.hypot(B.x-N.x,B.y-N.y),M+=W,Z=N,ne=B),N.x<i&&B.x<i||(N.x<i?N=new xt(i,N.y+(i-N.x)/(B.x-N.x)*(B.y-N.y))._round():B.x<i&&(B=new xt(i,N.y+(i-N.x)/(B.x-N.x)*(B.y-N.y))._round()),N.y<a&&B.y<a||(N.y<a?N=new xt(N.x+(a-N.y)/(B.y-N.y)*(B.x-N.x),a)._round():B.y<a&&(B=new xt(N.x+(a-N.y)/(B.y-N.y)*(B.x-N.x),a)._round()),N.x>=h&&B.x>=h||(N.x>=h?N=new xt(h,N.y+(h-N.x)/(B.x-N.x)*(B.y-N.y))._round():B.x>=h&&(B=new xt(h,N.y+(h-N.x)/(B.x-N.x)*(B.y-N.y))._round()),N.y>=d&&B.y>=d||(N.y>=d?N=new xt(N.x+(d-N.y)/(B.y-N.y)*(B.x-N.x),d)._round():B.y>=d&&(B=new xt(N.x+(d-N.y)/(B.y-N.y)*(B.x-N.x),d)._round()),S&&N.equals(S[S.length-1])||(S=[N],g.push(S),_&&_.push({progress:{min:X+DM(Z,ne,N)*W,max:1},parentIndex:b,prevPoint:Z,nextPoint:ne})),S.push(B),_&&(_[_.length-1].progress.max=X+DM(Z,ne,B)*W,_[_.length-1].nextPoint=ne)))))}if(_&&M>0)for(let L=P;L<g.length;L++)_[L].progress.min/=M,_[L].progress.max/=M}return g}function _j(l,i,a,h,d){if(l.length<2)return void h.push(l);const _=[];for(;i.valid();){const[S,P]=i.get();for(let M=0;M<l.length-1;M++){const L=l[M],N=l[M+1],B=rs(L,N,S,P);if(B){const[W]=B,X=new xt(Ri(L.x,N.x,W),Ri(L.y,N.y,W));_.push({t:M+W,distance:0,point:X})}}i.next()}if(_.length===0)return void h.push(l);_.sort((S,P)=>S.t-P.t);let g=0,b=0,T=[];for(h.push(T);g!==l.length;){if(b===_.length){for(;g!==l.length;)T.length!==0&&T[T.length-1].equals(l[g])||T.push(l[g]),g++;break}_[b].t<=g?(T.length!==0&&T[T.length-1].equals(_[b].point)||T.push(_[b].point),Math.trunc(_[b].t),b++):(T.length!==0&&T[T.length-1].equals(l[g])||T.push(l[g]),g++)}}function DM(l,i,a){return l.x!==i.x?(a.x-l.x)/(i.x-l.x):l.y!==i.y?(a.y-l.y)/(i.y-l.y):0}function ov(l,i){return l.x*i.x+l.y*i.y}function LM(l,i){if(l.length===1){let a=0;const h=i[a++];let d;for(;!d||h.equals(d);)if(d=i[a++],!d)return 1/0;for(;a<i.length;a++){const _=i[a],g=l[0],b=d.sub(h),T=_.sub(h),S=g.sub(h),P=ov(b,b),M=ov(b,T),L=ov(T,T),N=ov(S,b),B=ov(S,T),W=P*L-M*M,X=(L*N-M*B)/W,Z=(P*B-M*N)/W,ne=h.z*(1-X-Z)+d.z*X+_.z*Z;if(isFinite(ne))return ne}return 1/0}{let a=1/0;for(const h of i)a=Math.min(a,h.z);return a}}function OM(l,i,a,h,d,_,g,b){const T=g*d.getElevationAt(l,i,!0,!0),S=_[0]!==0,P=S?_[1]===0?g*(_[0]/7-450):g*function(M,L,N){const B=Math.floor(L[0]/8),W=Math.floor(L[1]/8),X=10*(L[0]-8*B),Z=10*(L[1]-8*W),ne=M.getElevationAt(B,W,!0,!0),se=M.getMeterToDEM(N),le=Math.floor(.5*(X*se-1)),Ee=Math.floor(.5*(Z*se-1)),Ie=M.tileCoordToPixel(B,W),Re=2*le+1,Ne=2*Ee+1,je=function(wt,Rt,ut,Tt,rt){return[wt.getElevationAtPixel(Rt,ut,!0),wt.getElevationAtPixel(Rt+rt,ut,!0),wt.getElevationAtPixel(Rt,ut+rt,!0),wt.getElevationAtPixel(Rt+Tt,ut+rt,!0)]}(M,Ie.x-le,Ie.y-Ee,Re,Ne),ft=Math.abs(je[0]-je[1]),We=Math.abs(je[2]-je[3]),mt=Math.abs(je[0]-je[2])+Math.abs(je[1]-je[3]),St=Math.min(.25,.5*se*(ft+We)/Re),gt=Math.min(.25,.5*se*mt/Ne);return ne+Math.max(St*X,gt*Z)}(d,_,b):T;return{base:T+(a===0?-1:a),top:S?Math.max(P+h,T+a+2):T+h}}class gj{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class yj{constructor(){this.tasks={},this.taskQueue=[],Qt(["process"],this),this.invoker=new gj(this.process),this.nextId=0}add(i,a){const h=this.nextId++,d=function({type:_,isSymbolTile:g,zoom:b}){return b=b||0,_==="message"?0:_!=="maybePrepare"||g?_!=="parseTile"||g?_==="parseTile"&&g?300-b:_==="maybePrepare"&&g?400-b:500:200-b:100-b}(a);if(d===0){try{i()}finally{}return null}return this.tasks[h]={fn:i,metadata:a,priority:d,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const i=this.pick();if(i===null)return;const a=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let i=null,a=1/0;for(let d=0;d<this.taskQueue.length;d++){const _=this.tasks[this.taskQueue[d]];_.priority<a&&(a=_.priority,i=d)}if(i===null)return null;const h=this.taskQueue[i];return this.taskQueue.splice(i,1),h}remove(){this.invoker.remove()}}class FM{constructor(i,a,h){this.target=i,this.parent=a,this.mapId=h,this.callbacks={},this.cancelCallbacks={},Qt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new yj}send(i,a,h,d,_=!1,g){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(h.metadata=g,this.callbacks[b]=h);const T=new Set;return this.target.postMessage({id:b,type:i,hasCallback:!!h,targetMapId:d,mustQueue:_,sourceMapId:this.mapId,data:Fu(a,T)},T),{cancel:()=>{h&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(i){const a=i.data;if(!a)return;const h=a.id;if(h&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const d=this.cancelCallbacks[h];delete this.cancelCallbacks[h],d&&d.cancel()}else if(a.mustQueue||Tr(self)){const d=this.callbacks[h],_=this.scheduler.add(()=>this.processTask(h,a),d&&d.metadata||{type:"message"});_&&(this.cancelCallbacks[h]=_)}else this.processTask(h,a)}processTask(i,a){if(delete this.cancelCallbacks[i],a.type==="<response>"){const h=this.callbacks[i];delete this.callbacks[i],h&&(a.error?h(zu(a.error)):h(null,zu(a.data)))}else{const h=new Set,d=a.hasCallback?(g,b)=>{this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:g?Fu(g):null,data:Fu(b,h)},h)}:()=>{},_=zu(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,_,d);else if(this.parent.getWorkerSource){const g=a.type.split("."),{source:b,scope:T}=_;this.parent.getWorkerSource(a.sourceMapId,g[0],b,T)[g[1]](_,d)}else d(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var av={workerUrl:"",workerClass:null,workerParams:void 0};const WI="mapboxgl_preloaded_worker_pool";class Gp{constructor(){this.active={}}acquire(i,a=Gp.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<a;)this.workers.push(av.workerClass!=null?new av.workerClass:new self.Worker(av.workerUrl,av.workerParams));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.workers&&this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[WI]}numActive(){return Object.keys(this.active).length}}Gp.workerCount=2;class ig{constructor(i,a,h="Worker",d=Gp.workerCount){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=lt();const _=this.workerPool.acquire(this.id,d);for(let g=0;g<_.length;g++){const b=new ig.Actor(_[g],a,this.id);b.name=`${h} ${g}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,a,h){Ze(this.actors,(d,_)=>{d.send(i,a,_)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}let lv,XI;function Jb(){return lv||(lv=new Gp),lv}ig.Actor=FM;class vj{constructor(i){this.module=i}createIntArray(i){const a=new Int32Array(i),h=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heap32.set(a,h/a.BYTES_PER_ELEMENT),h}createFloatArray(i){const a=new Float32Array(i),h=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heapF32.set(a,h/a.BYTES_PER_ELEMENT),h}createStringBuffer(i){const a=this.module.malloc(i.length+1);for(let h=0;h<i.length;++h)this.module.heapU8[a+h]=i.charCodeAt(h);return this.module.heapU8[a+i.length]=0,a}readStringBuffer(i){let a="";for(;this.module.heapU8[i]!==0;)a+=String.fromCharCode(this.module.heapU8[i]),++i;return a}setStyle(i){const a=i.entranceColorRgb,h=i.facadeGlazingColorRgb,d=i.roofColorRgb,_=i.wallColorRgb,g=i.normalScale;this.module.setStyle(a[0],a[1],a[2],h[0],h[1],h[2],d[0],d[1],d[2],_[0],_[1],_[2],g[0],g[1],g[2],i.tileToMeters)}setAOOptions(i,a){this.module.setAOOptions(i?1:0,a)}setMetricOptions(i,a){this.module.setMetricOptions(i?1:0,a)}setStructuralOptions(i){this.module.setStructuralOptions(i?1:0)}setFacadeOptions(i,a){this.module.setFacadeOptions(i,a?1:0)}setFauxFacadeOptions(i,a,h){this.module.setFauxFacadeOptions(i?1:0,a?1:0,h)}setFacadeClassifierOptions(i){this.module.setFacadeClassifierOptions(i)}generateMesh(i,a){for(const b of i){const T=this.createStringBuffer(b.roofType),S=[0],P=[];for(const N of b.coordinates)if(Array.isArray(N)){for(const B of N)P.push(B.x),P.push(B.y);S.push(P.length)}const M=this.createIntArray(S),L=this.createFloatArray(P);this.module.addFeature(b.id,b.sourceId,b.minHeight,b.height,T,b.roofType.length,L,M,S.length-1),this.module.free(T),this.module.free(M),this.module.free(L)}for(const b of a){let T;T=b.entrances?JSON.parse(b.entrances):[];const S=this.createFloatArray(T),P=[];for(const L of b.coordinates)P.push(L.x),P.push(L.y);const M=this.createFloatArray(P);this.module.addFacade(b.sourceId,b.crossPerc,b.distanceToRoad,S,T.length,M,P.length),this.module.free(S),this.module.free(M)}if(!this.module.generateMesh()){const b=this.module.getLastError();return this.readStringBuffer(b)}const h=this.module.getMeshCount(),d=new Array(h);for(let b=0;b<h;b++){const T=this.module.getPositionsPtr(b),S=this.module.getPositionsLength(b),P=new Float32Array(this.module.heapF32.buffer,T,S),M=this.module.getNormalsPtr(b),L=this.module.getNormalsLength(b),N=new Float32Array(this.module.heapF32.buffer,M,L),B=this.module.getColorsPtr(b),W=this.module.getColorsLength(b),X=new Uint8Array(this.module.heapU8.buffer,B,W),Z=this.module.getAOPtr(b),ne=this.module.getAOLength(b),se=new Float32Array(this.module.heapF32.buffer,Z,ne),le=this.module.getUVPtr(b),Ee=this.module.getUVLength(b),Ie=new Float32Array(this.module.heapF32.buffer,le,Ee),Re=this.module.getFauxFacadePtr(b),Ne=this.module.getFauxFacadeLength(b),je=new Uint8Array(this.module.heapU8.buffer,Re,Ne),ft=this.module.getIndicesPtr(b),We=this.module.getIndicesLength(b),mt=new Int32Array(this.module.heap32.buffer,ft,We),St=this.module.getBuildingPart(b),gt=this.readStringBuffer(St);d[b]={positions:P,normals:N,colors:X,ao:se,uv:Ie,isFauxFacade:je,indices:mt,buildingPart:gt}}const _=this.module.getRingCount(),g=[];for(let b=0;b<_;b++){const T=this.module.getRingPtr(b),S=this.module.getRingLength(b),P=new Float32Array(this.module.heapF32.buffer,T,S);g.push(P)}return{meshes:d,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:g}}}let cv,ZI,iu,rg,KI,ng=null,sg=null,zM=null,Qb=null;function NM(){return Tr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:ZI||io.DRACO_URL}function BM(){if(Tr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(rg)return rg;const l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return rg=WebAssembly.validate(l)?io.MESHOPT_SIMD_URL:io.MESHOPT_URL,rg}function xj(){return Qb}const ew={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},bj={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},uv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function VM(l,i,a){const h=a.json.bufferViews.length,d=a.buffers.length;i.bufferView=h,a.json.bufferViews[h]={buffer:d,byteLength:l.byteLength},a.buffers[d]=l}const YI="KHR_draco_mesh_compression";function wj(l,i){const a=l.extensions&&l.extensions[YI];if(!a)return;const h=new iu.Decoder,d=GM(i,a.bufferView),_=new iu.Mesh;if(!h.DecodeArrayToMesh(d,d.byteLength,_))throw new Error("Failed to decode Draco mesh");const g=i.json.accessors[l.indices],b=ew[g.componentType],T=g.count*b.BYTES_PER_ELEMENT,S=iu._malloc(T);b===Uint16Array?h.GetTrianglesUInt16Array(_,T,S):h.GetTrianglesUInt32Array(_,T,S),VM(iu.memory.buffer.slice(S,S+T),g,i),iu._free(S);for(const P of Object.keys(a.attributes)){const M=h.GetAttributeByUniqueId(_,a.attributes[P]),L=i.json.accessors[l.attributes[P]],N=bj[L.componentType],B=L.count*uv[L.type]*ew[L.componentType].BYTES_PER_ELEMENT,W=iu._malloc(B);h.GetAttributeDataArrayForAllPoints(_,M,iu[N],B,W),VM(iu.memory.buffer.slice(W,W+B),L,i),iu._free(W)}h.destroy(),_.destroy(),delete l.extensions[YI]}const tw="EXT_meshopt_compression";function Tj(l,i){if(!l.extensions||!l.extensions[tw])return;const a=l.extensions[tw],h=new Uint8Array(i.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),d=new Uint8Array(a.count*a.byteStride);KI.decodeGltfBuffer(d,a.count,a.byteStride,h,a.mode,a.filter),l.buffer=i.buffers.length,l.byteOffset=0,i.buffers[l.buffer]=d.buffer,delete l.extensions[tw]}const UM=1179937895,jM=new TextDecoder("utf8");function $M(l,i){return new URL(l,i).href}function Ej(l,i,a,h){return fetch($M(l.uri,h)).then(d=>d.arrayBuffer()).then(d=>{i.buffers[a]=d})}function GM(l,i){const a=l.json.bufferViews[i];return new Uint8Array(l.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function Ij(l,i,a,h){if(l.uri){const d=$M(l.uri,h);return fetch(d).then(_=>_.blob()).then(_=>createImageBitmap(_)).then(_=>{i.images[a]=_})}if(l.bufferView!==void 0){const d=GM(i,l.bufferView),_=new Blob([d],{type:l.mimeType});return createImageBitmap(_).then(g=>{i.images[a]=g})}}function HM(l,i=0,a){const h={json:null,images:[],buffers:[]};if(new Uint32Array(l,i,1)[0]===UM){const P=new Uint32Array(l,i);let M=2;const L=(P[M++]>>2)-3,N=P[M++]>>2;if(M++,h.json=JSON.parse(jM.decode(P.subarray(M,M+N))),M+=N,M<L){const B=P[M++];M++;const W=i+(M<<2);h.buffers[0]=l.slice(W,W+B)}}else h.json=JSON.parse(jM.decode(new Uint8Array(l,i)));const{buffers:d,images:_,meshes:g,extensionsUsed:b,bufferViews:T}=h.json;let S=Promise.resolve();if(d){const P=[];for(let M=0;M<d.length;M++){const L=d[M];L.uri?P.push(Ej(L,h,M,a)):h.buffers[M]||(h.buffers[M]=null)}S=Promise.all(P)}return S.then(()=>{const P=[],M=b&&b.includes(YI),L=b&&b.includes(tw);if(M&&P.push(function(){if(!iu)return cv??(cv=function(N){let B,W=null;function X(){B=new Uint8Array(W.buffer)}function Z(){throw new Error("Unexpected Draco error.")}const ne={a:{a:Z,d:function(se,le,Ee){return B.copyWithin(se,le,le+Ee)},c:function(se){const le=B.length,Ee=Math.max(se>>>0,Math.ceil(1.2*le)),Ie=Math.ceil((Ee-le)/65536);try{return W.grow(Ie),X(),!0}catch{return!1}},b:Z}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(N,ne):N.then(se=>se.arrayBuffer()).then(se=>WebAssembly.instantiate(se,ne))).then(se=>{const{Rb:le,Qb:Ee,P:Ie,T:Re,X:Ne,Ja:je,La:ft,Qa:We,Va:mt,Wa:St,eb:gt,jb:wt,f:Rt,e:ut,yb:Tt,zb:rt,Ab:et,Bb:Pt,Db:At,Gb:mi}=se.instance.exports;W=ut;const qt=(()=>{let si=0,Ot=0,pi=0,Ui=0;return Ut=>{pi&&(le(Ui),le(si),Ot+=pi,pi=si=0),si||(Ot+=128,si=Ee(Ot));const ci=Ut.length+7&-8;let Li=si;ci>=Ot&&(pi=ci,Li=Ui=Ee(ci));for(let Hi=0;Hi<Ut.length;Hi++)B[Li+Hi]=Ut[Hi];return Li}})();return X(),Rt(),{memory:ut,_free:le,_malloc:Ee,Mesh:class{constructor(){this.ptr=Ie()}destroy(){Re(this.ptr)}},Decoder:class{constructor(){this.ptr=je()}destroy(){wt(this.ptr)}DecodeArrayToMesh(si,Ot,pi){const Ui=qt(si),Ut=ft(this.ptr,Ui,Ot,pi.ptr);return!!Ne(Ut)}GetAttributeByUniqueId(si,Ot){return{ptr:We(this.ptr,si.ptr,Ot)}}GetTrianglesUInt16Array(si,Ot,pi){mt(this.ptr,si.ptr,Ot,pi)}GetTrianglesUInt32Array(si,Ot,pi){St(this.ptr,si.ptr,Ot,pi)}GetAttributeDataArrayForAllPoints(si,Ot,pi,Ui,Ut){gt(this.ptr,si.ptr,Ot.ptr,pi,Ui,Ut)}},DT_INT8:Tt(),DT_UINT8:rt(),DT_INT16:et(),DT_UINT16:Pt(),DT_UINT32:At(),DT_FLOAT32:mi()}})}(fetch(NM())),cv.then(N=>{iu=N,cv=void 0}))}()),L&&P.push(function(){if(KI)return;const N=function(B){let W;const X=WebAssembly.instantiateStreaming(B,{}).then(se=>{W=se.instance,W.exports.__wasm_call_ctors()}),Z={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ne={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:X,supported:!0,decodeGltfBuffer(se,le,Ee,Ie,Re,Ne){(function(je,ft,We,mt,St,gt,wt){const Rt=je.exports.sbrk,ut=mt+3&-4,Tt=Rt(ut*St),rt=Rt(gt.length),et=new Uint8Array(je.exports.memory.buffer);et.set(gt,rt);const Pt=ft(Tt,mt,St,rt,gt.length);if(Pt===0&&wt&&wt(Tt,ut,St),We.set(et.subarray(Tt,Tt+mt*St)),Rt(Tt-Rt(0)),Pt!==0)throw new Error(`Malformed buffer data: ${Pt}`)})(W,W.exports[ne[Re]],se,le,Ee,Ie,W.exports[Z[Ne]])}}}(fetch(BM()));return N.ready.then(()=>{KI=N})}()),_)for(let N=0;N<_.length;N++)P.push(Ij(_[N],h,N,a));return(P.length?Promise.all(P):Promise.resolve()).then(()=>{if(M&&g)for(const{primitives:N}of g)for(const B of N)wj(B,h);if(L&&g&&T)for(const N of T)Tj(N,h);return h})})}function JI(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function QI(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class eS{constructor(i,a,h,d){this.context=i,this.format=h,this.useMipmap=d&&d.useMipmap,this.texture=i.gl.createTexture(),this.update(a,{premultiply:d&&d.premultiply})}update(i,a){const h=i&&i instanceof HTMLVideoElement&&i.width===0?i.videoWidth:i.width,d=i&&i instanceof HTMLVideoElement&&i.height===0?i.videoHeight:i.height,{context:_}=this,{gl:g}=_,{x:b,y:T}=a&&a.position?a.position:{x:0,y:0},S=b+h,P=T+d;!this.size||this.size[0]===S&&this.size[1]===P||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!a||a.premultiply!==!1));const M=i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ImageBitmap&&i instanceof ImageBitmap;if(!this.size&&S>0&&P>0){const L=this.useMipmap?Math.floor(Math.log2(Math.max(S,P)))+1:1;g.texStorage2D(g.TEXTURE_2D,L,this.format,S,P),this.size=[S,P]}this.size&&(M?g.texSubImage2D(g.TEXTURE_2D,0,b,T,JI(this.format),QI(this.format),i):"data"in i&&i.data&&g.texSubImage2D(g.TEXTURE_2D,0,b,T,h,d,JI(this.format),QI(this.format),i.data)),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(i,a,h=!1){const{context:d}=this,{gl:_}=d;_.bindTexture(_.TEXTURE_2D,this.texture),i!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,i),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap&&!h?i===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),a!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,a),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(i,a,h,d,_){const{context:g}=this,{gl:b}=g;b.bindTexture(b.TEXTURE_2D,this.texture),a!==this.magFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a),this.magFilter=a),i!==this.minFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,this.useMipmap?i===b.NEAREST?b.NEAREST_MIPMAP_NEAREST:b.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),h!==this.wrapS&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,h),this.wrapS=h),d!==this.wrapT&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,d),this.wrapT=d),_!==this.compareMode&&(_?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.COMPARE_REF_TO_TEXTURE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_FUNC,_)):b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.NONE),this.compareMode=_)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class hv{constructor(i,a){this.context=i,this.texture=a}bind(i,a){const{context:h}=this,{gl:d}=h;d.bindTexture(d.TEXTURE_2D,this.texture),i!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,i),this.minFilter=i),a!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,a),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,a),this.wrapS=a)}}const Sj=xr([{name:"a_pos_3f",components:3,type:"Float32"}]),Aj=xr([{name:"a_color_3f",components:3,type:"Float32"}]),Cj=xr([{name:"a_color_4f",components:4,type:"Float32"}]),Rj=xr([{name:"a_uv_2f",components:2,type:"Float32"}]),Pj=xr([{name:"a_normal_3f",components:3,type:"Float32"}]),Mj=xr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),kj=xr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function qM(l,i){const a=iw(l.projection,l.zoom,l.width,l.height),h=function(_,g,b,T,S){const P=new H(b.lng-180*xf,b.lat),M=new H(b.lng+180*xf,b.lat),L=_.project(P.lng,P.lat),N=_.project(M.lng,M.lat),B=-Math.atan2(N.y-L.y,N.x-L.x),W=nt.fromLngLat(b);W.y=fe(W.y,-1+xf,1-xf);const X=W.toLngLat(),Z=_.project(X.lng,X.lat),ne=nt.fromLngLat(X);ne.x+=xf;const se=ne.toLngLat(),le=_.project(se.lng,se.lat),Ee=XM(le.x-Z.x,le.y-Z.y,B),Ie=nt.fromLngLat(X);Ie.y+=xf;const Re=Ie.toLngLat(),Ne=_.project(Re.lng,Re.lat),je=XM(Ne.x-Z.x,Ne.y-Z.y,B),ft=Math.abs(Ee.x)/Math.abs(je.y),We=Q([]);pt(We,We,-B*(1-(S?0:T)));const mt=Q([]);return Le(mt,mt,[1,1-(1-ft)*T,1]),mt[4]=-je.x/je.y*T,pt(mt,mt,B),Ce(mt,We,mt),mt}(l.projection,0,l.center,a,i),d=WM(l);return Le(h,h,[d,d,1]),h}function WM(l){const i=l.projection,a=iw(l.projection,l.zoom,l.width,l.height),h=tS(i,l.center),d=tS(i,H.convert(i.center));return Math.pow(2,h*a+(1-a)*d)}function iw(l,i,a,h,d=1/0){const _=l.range;if(!_)return 0;const g=Math.min(d,Math.max(a,h)),b=Math.log2(g/1024);return Ke(_[0]+b,_[1]+b,i)}const xf=1/4e4;function tS(l,i){const a=fe(i.lat,-we,we),h=new H(i.lng-180*xf,a),d=new H(i.lng+180*xf,a),_=l.project(h.lng,a),g=l.project(d.lng,a),b=nt.fromLngLat(h),T=nt.fromLngLat(d),S=g.x-_.x,P=g.y-_.y,M=T.x-b.x,L=T.y-b.y,N=Math.sqrt((M*M+L*L)/(S*S+P*P));return Math.log2(N)}function XM(l,i,a){const h=Math.cos(a),d=Math.sin(a);return{x:l*h-i*d,y:l*d+i*h}}function ZM(l,i,a){Q(l),pt(l,l,Pe(i[2])),Me(l,l,Pe(i[0])),at(l,l,Pe(i[1])),Le(l,l,a),Ce(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function rw(l,i,a,h,d,_,g,b){const T=[a[0]-i[0],a[1]-i[1],0],S=[h[0]-i[0],h[1]-i[1],0];if(Oe(T)<1e-12||Oe(S)<1e-12)return ni(l);const P=Wt([],T,S);Ni(P,P),ri(S,h,i),T[2]=(_-d)*b,S[2]=(g-d)*b;const M=T;return Wt(M,T,S),Ni(M,M),on(l,P,M)}function iS(l,i,a=!1){const h=gf(i.zoom),d=function(_,g,b){const T=g.worldSize,S=[_[12],_[13],_[14]],P=ge(S[1]/T),M=xe(S[0]/T),L=Q([]),N=_e(1,P)*T,B=_e(1,0)*T*$e(P,g.zoom),W=1/PI(T);let X=B*W;if(b){const le=iw(g.projection,g.zoom,g.width,g.height,1024);X=W*g.projection.pixelSpaceConversion(g.center.lat,T,le)}const Z=z(P,M);ti(Z,Z,wi([],Ni([],Z),N*X*S[2]));const ne=function(le){const Ee=[le[0],le[1],le[2]];let Ie=[0,1,0];const Re=Wt([],Ie,Ee);return Wt(Ie,Ee,Re),Br(Ie)===0&&(Ie=[0,1,0],Wt(Re,Ee,Ie)),Ni(Re,Re),Ni(Ie,Ie),Ni(Ee,Ee),[Re[0],Re[1],Re[2],0,Ie[0],Ie[1],Ie[2],0,Ee[0],Ee[1],Ee[2],0,le[0],le[1],le[2],1]}(Z);Le(L,L,[X,X,X*N]),Fe(L,L,[-S[0],-S[1],-S[2]]);const se=Ce([],g.globeMatrix,ne);return Ce(se,se,L),Ce(se,se,_),se}(l,i,a);if(h>0){const _=function(g,b){const T=b.worldSize,S=_e(1,0)*T*$e(b.center.lat,b.zoom)/PI(T),P=_e(1,b.center.lat)*T,M=Q([]);at(M,M,Pe(b.center.lng)),Me(M,M,Pe(b.center.lat)),Fe(M,M,[0,0,p]),Le(M,M,[S,S,S*P]);const L=b.point;return Fe(M,M,[-L.x,-L.y,0]),Ce(M,M,g),Ce(M,b.globeMatrix,M)}(l,i);return function(g,b,T){const S=(B,W,X)=>{const Z=Oe(B),ne=Oe(W),se=td(B,W,X);return wi(se,se,1/Oe(se)*Ri(Z,ne,X))},P=S([g[0],g[1],g[2]],[b[0],b[1],b[2]],T),M=S([g[4],g[5],g[6]],[b[4],b[5],b[6]],T),L=S([g[8],g[9],g[10]],[b[8],b[9],b[10]],T),N=td([g[12],g[13],g[14]],[b[12],b[13],b[14]],T);return[P[0],P[1],P[2],0,M[0],M[1],M[2],0,L[0],L[1],L[2],0,N[0],N[1],N[2],1]}(d,_,h)}return d}function KM(l,i,a,h){const d=Fi.projectAabbCorners(h,a);let _=Number.MAX_VALUE,g=-1;for(let S=0;S<d.length;++S){const P=d[S];P[0]=(.5*P[0]+.5)*i.width,P[1]=(.5-.5*P[1])*i.height,P[2]<_&&(g=S,_=P[2])}const b=S=>new xt(d[S][0],d[S][1]);let T;switch(g){case 0:case 6:T=[b(1),b(5),b(4),b(7),b(3),b(2),b(1)];break;case 1:case 7:T=[b(0),b(4),b(5),b(6),b(2),b(3),b(0)];break;case 3:case 5:T=[b(1),b(0),b(4),b(7),b(6),b(2),b(1)];break;default:T=[b(1),b(5),b(6),b(7),b(3),b(0),b(1)]}if(il(l,T))return _}const Hp=64,og={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function YM(l,i,a,h,d,_,g,b,T,S=!1){const P=a.zoom,M=a.project(h),L=$e(h.lat,P),N=1/L;Q(l),Fe(l,l,[M.x+g[0]*N,M.y+g[1]*N,g[2]]);let B=1,W=1;const X=a.worldSize;if(S){if(a.projection.name==="mercator"){let le=0;a.elevation&&(le=a.elevation.getAtPointOrZero(new nt(M.x/X,M.y/X),0));const Ee=Lt([],[M.x,M.y,le,1],a.projMatrix)[3]/a.cameraToCenterDistance;B=Ee,W=Ee*$e(a.center.lat,P)}else if(a.projection.name==="globe"){const le=iS(l,a),Ee=[0,0,0,1];Lt(Ee,Ee,Ce([],a.projMatrix,le));const Ie=Ee[3]/a.cameraToCenterDistance,Re=gf(P),Ne=a.projection.pixelsPerMeter(h.lat,X)*$e(h.lat,P),je=a.projection.pixelsPerMeter(a.center.lat,X)*$e(a.center.lat,P);B=Ie/Ri(Ne,Je(a.center.lat),Re),W=Ie*L/Ne,B*=je,W*=je}}else B=N;Le(l,l,[B,B,W]);const Z=[...l],ne=i.orientation,se=[];if(ZM(se,[ne[0]+d[0],ne[1]+d[1],ne[2]+d[2]],_),Ce(l,Z,se),b&&a.elevation){let le=0;const Ee=[];if(T&&a.elevation){le=function(Re,Ne,je,ft,We){const mt=Ne.elevation;if(!mt)return 0;const St=Fi.projectAabbCorners(je,ft),gt=_e(1,We.lat)*Ne.worldSize,wt=function(Ot,pi){const Ui=[0,0,1],Ut=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const ci of Ut){const Li=Ot[ci.corners[0]],Hi=Ot[ci.corners[1]],or=Ot[ci.corners[2]],Zi=[Hi[0]-Li[0],Hi[1]-Li[1],pi*(Hi[2]-Li[2])],ei=Wt(Zi,Zi,[or[0]-Li[0],or[1]-Li[1],pi*(or[2]-Li[2])]);Ni(ei,ei),ci.dotProductWithUp=vt(ei,Ui)}return Ut.sort((ci,Li)=>ci.dotProductWithUp-Li.dotProductWithUp),Ut[0].corners}(St,gt),Rt=St[wt[0]],ut=St[wt[1]],Tt=St[wt[2]],rt=St[wt[3]],et=mt.getAtPointOrZero(new nt(Rt[0]/Ne.worldSize,Rt[1]/Ne.worldSize),0),Pt=mt.getAtPointOrZero(new nt(ut[0]/Ne.worldSize,ut[1]/Ne.worldSize),0),At=mt.getAtPointOrZero(new nt(Tt[0]/Ne.worldSize,Tt[1]/Ne.worldSize),0),mi=mt.getAtPointOrZero(new nt(rt[0]/Ne.worldSize,rt[1]/Ne.worldSize),0),qt=(et+mi)/2,si=(Pt+At)/2;return qt>si?Pt<At?rw(Re,ut,rt,Rt,Pt,mi,et,gt):rw(Re,Tt,Rt,rt,At,et,mi,gt):et<mi?rw(Re,Rt,ut,Tt,et,Pt,At,gt):rw(Re,rt,Tt,ut,mi,At,Pt,gt),Math.max(qt,si)}(Ee,a,i.aabb,l,h);const Ie=Ce([],Se([],Ee),se);Ce(l,Z,Ie)}else le=a.elevation.getAtPointOrZero(new nt(M.x/X,M.y/X),0);le!==0&&(l[14]+=le)}}function dv(l,i,a=!1){l.uploaded||(l.gfxTexture=new eS(i,l.image,a?i.gl.R8:i.gl.RGBA8,{useMipmap:l.sampler.minFilter>=i.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function Dj(l,i,a){l.indexBuffer=i.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=i.createVertexBuffer(l.vertexArray,Sj.members,!1,!0),l.normalArray&&(l.normalBuffer=i.createVertexBuffer(l.normalArray,Pj.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=i.createVertexBuffer(l.texcoordArray,Rj.members,!1,!0)),l.colorArray&&(l.colorBuffer=i.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?Aj:Cj).members,!1,!0)),l.featureArray&&(l.pbrBuffer=i.createVertexBuffer(l.featureArray,kj.members,!0)),l.segments=jn.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);const h=l.material;h.pbrMetallicRoughness.baseColorTexture&&dv(h.pbrMetallicRoughness.baseColorTexture,i),h.pbrMetallicRoughness.metallicRoughnessTexture&&dv(h.pbrMetallicRoughness.metallicRoughnessTexture,i),h.normalTexture&&dv(h.normalTexture,i),h.occlusionTexture&&dv(h.occlusionTexture,i,a),h.emissionTexture&&dv(h.emissionTexture,i)}function rS(l,i,a){if(l.meshes)for(const h of l.meshes)Dj(h,i,a);if(l.children)for(const h of l.children)rS(h,i,a)}function nw(l){if(l.meshes)for(const i of l.meshes)i.indexArray.destroy(),i.vertexArray.destroy(),i.colorArray&&i.colorArray.destroy(),i.normalArray&&i.normalArray.destroy(),i.texcoordArray&&i.texcoordArray.destroy(),i.featureArray&&i.featureArray.destroy();if(l.children)for(const i of l.children)nw(i)}function nS(l){if(l.meshes)for(const a of l.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((i=a.material).pbrMetallicRoughness.baseColorTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),i.pbrMetallicRoughness.metallicRoughnessTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),i.normalTexture&&i.normalTexture.gfxTexture&&i.normalTexture.gfxTexture.destroy(),i.emissionTexture&&i.emissionTexture.gfxTexture&&i.emissionTexture.gfxTexture.destroy(),i.occlusionTexture&&i.occlusionTexture.gfxTexture&&i.occlusionTexture.gfxTexture.destroy()));var i;if(l.children)for(const a of l.children)nS(a)}function qp(l,i){const a=l.json.bufferViews[i.bufferView],h=ew[i.componentType];return new h(l.buffers[a.buffer],(i.byteOffset||0)+(a.byteOffset||0),i.count*(a.byteStride&&a.byteStride!==uv[i.type]*h.BYTES_PER_ELEMENT?a.byteStride/h.BYTES_PER_ELEMENT:uv[i.type]))}function sS(l,i,a,h){const d=ew[i.componentType],_=function(P){switch(P){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(d),g=l.json.bufferViews[i.bufferView],b=g.byteStride?g.byteStride/d.BYTES_PER_ELEMENT:uv[i.type],T=a.float32,S=T.length/a.capacity;for(let P=0,M=0;P<i.count*b;P+=b,M+=S)for(let L=0;L<S;L++)T[M+L]=h[P+L]*_;a._trim()}function Lj(l,i,a){const h=l.indices,d=l.attributes,_={};_.indexArray=new Us;const g=i.json.accessors[h],b=g.count/3;_.indexArray.reserve(b);const T=qp(i,g);for(let L=0;L<b;L++)_.indexArray.emplaceBack(T[3*L],T[3*L+1],T[3*L+2]);_.indexArray._trim(),_.vertexArray=new ua;const S=i.json.accessors[d.POSITION];_.vertexArray.reserve(S.count);const P=qp(i,S);for(let L=0;L<S.count;L++)_.vertexArray.emplaceBack(P[3*L],P[3*L+1],P[3*L+2]);if(_.vertexArray._trim(),_.aabb=new Fi(S.min,S.max),_.centroid=function(L,N){const B=[0,0,0],W=L.length;if(W>0){for(let X=0;X<W;X++){const Z=3*L[X];B[0]+=N[Z],B[1]+=N[Z+1],B[2]+=N[Z+2]}B[0]/=W,B[1]/=W,B[2]/=W}return B}(T,P),d.COLOR_0!==void 0){const L=i.json.accessors[d.COLOR_0],N=uv[L.type],B=qp(i,L);_.colorArray=N===3?new ua:new $l,_.colorArray.resize(L.count),sS(i,L,_.colorArray,B)}if(d.NORMAL!==void 0){_.normalArray=new ua;const L=i.json.accessors[d.NORMAL];_.normalArray.resize(L.count);const N=qp(i,L);sS(i,L,_.normalArray,N)}if(d.TEXCOORD_0!==void 0&&a.length>0){_.texcoordArray=new ff;const L=i.json.accessors[d.TEXCOORD_0];_.texcoordArray.resize(L.count);const N=qp(i,L);sS(i,L,_.texcoordArray,N)}if(d._FEATURE_ID_RGBA4444!==void 0){const L=i.json.accessors[d._FEATURE_ID_RGBA4444];i.json.extensionsUsed&&i.json.extensionsUsed.includes("EXT_meshopt_compression")&&(_.featureData=qp(i,L))}d._FEATURE_RGBA4444!==void 0&&(_.featureData=new Uint32Array(qp(i,i.json.accessors[d._FEATURE_RGBA4444]).buffer));const M=l.material;return _.material=function(L,N){const{emissiveFactor:B=[0,0,0],alphaMode:W="OPAQUE",alphaCutoff:X=.5,normalTexture:Z,occlusionTexture:ne,emissiveTexture:se,doubleSided:le}=L,{baseColorFactor:Ee=[1,1,1,1],metallicFactor:Ie=1,roughnessFactor:Re=1,baseColorTexture:Ne,metallicRoughnessTexture:je}=L.pbrMetallicRoughness||{},ft=ne?N[ne.index]:void 0;if(ne&&ne.extensions&&ne.extensions.KHR_texture_transform&&ft){const We=ne.extensions.KHR_texture_transform;ft.offsetScale=[We.offset[0],We.offset[1],We.scale[0],We.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Mr(...Ee),metallicFactor:Ie,roughnessFactor:Re,baseColorTexture:Ne?N[Ne.index]:void 0,metallicRoughnessTexture:je?N[je.index]:void 0},doubleSided:le,emissiveFactor:new Mr(...B),alphaMode:W,alphaCutoff:X,normalTexture:Z?N[Z.index]:void 0,occlusionTexture:ft,emissionTexture:se?N[se.index]:void 0,defined:L.defined===void 0}}(M!==void 0?i.json.materials[M]:{defined:!1},a),_}function JM(l,i,a){const{matrix:h,rotation:d,translation:_,scale:g,mesh:b,extras:T,children:S}=l,P={};if(P.matrix=h||function(M,L,N,B){var W=L[0],X=L[1],Z=L[2],ne=L[3],se=W+W,le=X+X,Ee=Z+Z,Ie=W*se,Re=W*le,Ne=W*Ee,je=X*le,ft=X*Ee,We=Z*Ee,mt=ne*se,St=ne*le,gt=ne*Ee,wt=B[0],Rt=B[1],ut=B[2];return M[0]=(1-(je+We))*wt,M[1]=(Re+gt)*wt,M[2]=(Ne-St)*wt,M[3]=0,M[4]=(Re-gt)*Rt,M[5]=(1-(Ie+We))*Rt,M[6]=(ft+mt)*Rt,M[7]=0,M[8]=(Ne+St)*ut,M[9]=(ft-mt)*ut,M[10]=(1-(Ie+je))*ut,M[11]=0,M[12]=N[0],M[13]=N[1],M[14]=N[2],M[15]=1,M}([],d||[0,0,0,1],_||[0,0,0],g||[1,1,1]),b!==void 0){P.meshes=a[b];const M=P.anchor=[0,0];for(const L of P.meshes){const{min:N,max:B}=L.aabb;M[0]+=N[0]+B[0],M[1]+=N[1]+B[1]}M[0]=Math.floor(M[0]/P.meshes.length/2),M[1]=Math.floor(M[1]/P.meshes.length/2)}if(T&&(T.id&&(P.id=T.id),T.lights&&(P.lights=function(M){if(!M.length)return[];const L=function(Z){const ne=atob(Z),se=new Uint8Array(ne.length);for(let le=0;le<ne.length;le++)se[le]=ne.codePointAt(le);return se}(M),N=[],B=L.length/24,W=new Uint16Array(L.buffer),X=new Float32Array(L.buffer);for(let Z=0;Z<B;Z++){const ne=W[2*Z*6]/30,se=W[2*Z*6+1]/30,le=W[2*Z*6+10]/100,Ee=X[6*Z+1],Ie=X[6*Z+2],Re=X[6*Z+3],Ne=X[6*Z+4],je=Re-Ee,ft=Ne-Ie,We=Math.hypot(je,ft);N.push({pos:[Ee+.5*je,Ie+.5*ft,se],normal:[ft/We,-je/We,0],width:We,height:ne,depth:le,points:[Ee,Ie,Re,Ne]})}return N}(T.lights))),S){const M=[];for(const L of S)M.push(JM(i.json.nodes[L],i,a));P.children=M}return P}function Oj(l){if(l.vertices.length===0||l.indices.length===0)return null;const i=new qb(l.vertices,l.indices,8,256),[a,h]=[i.min.clone(),i.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:i,min:a,max:h}}function Fj(l){if(!l.extras||!l.extras.ground)return null;const i=l.extras.ground;if(!i||!Array.isArray(i)||i.length===0)return null;const a=i[0];if(!a||!Array.isArray(a)||a.length===0)return null;const h=[];for(const g of a){if(!Array.isArray(g)||g.length!==2)continue;const b=g[0],T=g[1];typeof b=="number"&&typeof T=="number"&&h.push(new xt(b,T))}if(h.length<3)return null;h.length>1&&h[h.length-1].equals(h[0])&&h.pop();let d=0;for(let g=0;g<h.length;g++){const b=h[g],T=h[(g+1)%h.length],S=h[(g+2)%h.length];d+=(b.x-T.x)*(S.y-T.y)-(S.x-T.x)*(b.y-T.y)}d>0&&h.reverse();const _=eg(h.flatMap(g=>[g.x,g.y]),[]);return _.length===0?null:{vertices:h,indices:_}}function zj(l,i){const a=[],h=[];let d=0;const _=[];for(const g of l){d=a.length;const b=g.vertexArray.float32,T=g.indexArray.uint16;for(let S=0;S<g.vertexArray.length;S++)_[0]=b[3*S+0],_[1]=b[3*S+1],_[2]=b[3*S+2],ai(_,_,i),a.push(new xt(_[0],_[1]));for(let S=0;S<3*g.indexArray.length;S++)h.push(T[S]+d)}if(h.length%3!=0)return null;for(let g=0;g<h.length;g+=3){const b=a[h[g+0]],T=a[h[g+1]],S=a[h[g+2]];(b.x-T.x)*(S.y-T.y)-(S.x-T.x)*(b.y-T.y)>0&&([h[g+1],h[g+2]]=[h[g+2],h[g+1]])}return{vertices:a,indices:h}}function QM(l){const i=function(T,S){const P=[],M=WebGL2RenderingContext;if(T.json.textures)for(const L of T.json.textures){const N={magFilter:M.LINEAR,minFilter:M.NEAREST,wrapS:M.REPEAT,wrapT:M.REPEAT};L.sampler!==void 0&&Object.assign(N,T.json.samplers[L.sampler]),P.push({image:S[L.source],sampler:N,uploaded:!1})}return P}(l,l.images),a=function(T,S){const P=[];for(const M of T.json.meshes){const L=[];for(const N of M.primitives)L.push(Lj(N,T,S));P.push(L)}return P}(l,i),{scenes:h,scene:d,nodes:_}=l.json,g=h?h[d||0].nodes:[..._.keys()],b=[];for(const T of g)b.push(JM(_[T],l,a));return function(T,S,P){const M={},L=new Set;for(let N=0;N<T.length;N++){const B=P[S[N]];if(!B.extras)continue;const W=B.extras["mapbox:footprint:version"],X=B.extras["mapbox:footprint:id"];(W||X)&&L.add(N),W==="1.0.0"&&X&&(M[X]=N)}for(let N=0;N<T.length;N++){if(L.has(N))continue;const B=T[N],W=P[S[N]];if(!W.extras)continue;let X=null;B.id in M&&(X=zj(T[M[B.id]].meshes,B.matrix)),X||(X=Fj(W)),X&&(B.footprint=Oj(X))}if(L.size>0){const N=Array.from(L.values()).sort((B,W)=>B-W);for(let B=N.length-1;B>=0;B--)T.splice(N[B],1)}}(b,g,l.json.nodes),b}function Nj(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);const i=l.vertexArray.float32,a=l.aabb.min[0]-1,h=l.aabb.min[1]-1,d=Hp/(l.aabb.max[0]-a+2),_=Hp/(l.aabb.max[1]-h+2);for(let g=0;g<i.length;g+=3){const b=i[g+2],T=(i[g+0]-a)*d|0,S=(i[g+1]-h)*_|0;b>l.heightmap[S*Hp+T]&&(l.heightmap[S*Hp+T]=b)}}function e6(l,i,a,h,d){a.reserve(a.length+4*l.length),h.reserve(h.length+10*l.length),d.reserve(d.length+10*l.length);let _=h.length;for(const g of l){const b=Math.min(10,Math.max(4,1.3*g.height))*i,T=[-g.normal[1],g.normal[0],0],S=Math.min(.29,.1*g.width/g.depth),P=g.width-2*g.depth*i*(S+.01),M=ji([],g.pos,T,P/2),L=ji([],g.pos,T,-P/2),N=[M[0],M[1],M[2]+g.height],B=[L[0],L[1],L[2]+g.height],W=ji([],g.normal,T,S);wi(W,W,b);const X=ji([],g.normal,T,-S);wi(X,X,b),ti(W,M,W),ti(X,L,X),M[2]+=.1,L[2]+=.1,h.emplaceBack(W[0],W[1],W[2]),h.emplaceBack(X[0],X[1],X[2]),h.emplaceBack(M[0],M[1],M[2]),h.emplaceBack(L[0],L[1],L[2]),h.emplaceBack(N[0],N[1],N[2]),h.emplaceBack(B[0],B[1],B[2]),h.emplaceBack(M[0],M[1],M[2]),h.emplaceBack(L[0],L[1],L[2]),h.emplaceBack(W[0],W[1],W[2]),h.emplaceBack(X[0],X[1],X[2]);const Z=P/b/2;d.emplaceBack(-Z-S,-1,Z,.8),d.emplaceBack(Z+S,-1,Z,.8),d.emplaceBack(-Z,0,Z,1.3),d.emplaceBack(Z,0,Z,1.3),d.emplaceBack(Z+S,-.8,Z,.7),d.emplaceBack(Z+S,-.8,Z,.7),d.emplaceBack(0,0,Z,1.3),d.emplaceBack(0,0,Z,1.3),d.emplaceBack(Z+S,-1.2,Z,.8),d.emplaceBack(Z+S,-1.2,Z,.8),a.emplaceBack(6+_,4+_,8+_),a.emplaceBack(7+_,9+_,5+_),a.emplaceBack(0+_,1+_,2+_),a.emplaceBack(1+_,3+_,2+_),_+=10}}function Bj(l,i){const a={};a.indexArray=new Us,a.vertexArray=new ua,a.colorArray=new $l,e6(l,i,a.indexArray,a.vertexArray,a.colorArray);const h={defined:!0};h.emissiveFactor=Mr.black;const d={};return d.baseColorFactor=Mr.white,h.pbrMetallicRoughness=d,a.material=h,a.aabb=new Fi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}const t6=xr([{name:"a_pos_3f",components:3,type:"Float32"}]),Vj=xr([{name:"a_normal_3",components:3,type:"Int16"}]),Uj=xr([{name:"a_centroid_3",components:3,type:"Int16"}]),i6=xr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),jj=xr([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),$j=xr([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),Gj=xr([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),Hj=xr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),r6=It.types,oS=32767;function qj(l,i){const a=Ft+i;for(const h of l)for(const d of h)if(d.x<-i||d.x>a||d.y<-i||d.y>a)return!1;return!0}class n6{constructor(){this.layoutVertexArray=new ua,this.layoutAttenuationArray=new $l,this.layoutColorArray=new Ds,this.indexArray=new Us,this.indexArrayForConflation=new Us,this.segmentsBucket=new jn}}class aS{constructor(){this.layoutVertexArray=new ua,this.layoutNormalArray=new Kh,this.layoutCentroidArray=new Kh,this.layoutColorArray=new Ds,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutAOArray=[],this.indexArray=new Us,this.indexArrayForConflation=new Us,this.segmentsBucket=new jn,this.entranceBloom=new n6}}class s6{constructor(i){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new aS,this.buildingWithFacade=new aS,this.indexArrayForConflationUploaded=!1,this.footprintLookup={},this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.worldview=i.worldview,this.lut=i.lut,this.buildingWithFacade.layoutFacadePaintArray=new Ds,this.buildingWithFacade.layoutFacadeDataArray=new uf,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new Ds,this.programConfigurations=new Gl(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=i.projection,this.groundEffect=new HI(i)}updateFootprints(i,a){for(const h of this.footprints)a.push({footprint:h,id:i})}prepare(){return function(){if(Qb!=null||zM!=null)return null;if(sg!=null)return sg;const i=fetch(io.BUILDING_GEN_URL);return sg=function(a){let h,d,_,g;function b(){h=new Uint8Array(g.buffer),d=new Int32Array(g.buffer),_=new Float32Array(g.buffer)}function T(){throw new Error("Unexpected BuildingGen error.")}const S=()=>{},P={a:{a:T,f:function(M){const L=h.length,N=Math.max(M>>>0,Math.ceil(1.2*L)),B=Math.ceil((N-L)/65536);try{return g.grow(B),b(),!0}catch{return!1}},g:T,b:S,c:S,d:S,e:S}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,P):a.then(M=>M.arrayBuffer()).then(M=>WebAssembly.instantiate(M,P))).then(M=>{const L=M.instance.exports;return(0,L.g)(),g=L.f,b(),new vj({setStyle:L.h,setAOOptions:L.i,setMetricOptions:L.j,setStructuralOptions:L.k,setFacadeOptions:L.l,setFauxFacadeOptions:L.m,setFacadeClassifierOptions:L.n,addFeature:L.o,addFacade:L.p,generateMesh:L.q,getLastError:L.r,getOuterRingLength:L.s,getMeshCount:L.t,getPositionsPtr:L.u,getPositionsLength:L.v,getNormalsPtr:L.w,getNormalsLength:L.x,getColorsPtr:L.y,getColorsLength:L.z,getAOPtr:L.A,getAOLength:L.B,getUVPtr:L.C,getUVLength:L.D,getFauxFacadePtr:L.E,getFauxFacadeLength:L.F,getIndicesPtr:L.G,getIndicesLength:L.H,getBuildingPart:L.I,getRingCount:L.J,getRingPtr:L.K,getRingLength:L.L,free:L.M,malloc:L.N,heapU8:h,heap32:d,heapF32:_})})}(i).then(a=>(sg=null,Qb=a,Qb)).catch(a=>{Ji("Could not load building-gen"),sg=null,zM=a}),sg}()}populate(i,a,h,d){const _=xj();if(!_)return;const g=Xe(h);this.tileToMeter=g,this.brightness=a.brightness,_.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,g],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:g,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),_.setAOOptions(!1,.3),_.setMetricOptions(!1,16),_.setStructuralOptions(!0),_.setFacadeClassifierOptions(3);const b=new Map;for(const{feature:T}of i){if(r6[T.type]!=="LineString")continue;const S=this.layers[0]._featureFilter.needGeometry,P=Ct(T,S);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom),P,h))continue;const M=S?P.geometry:$t(T,h,d),L=[];for(const X of M)for(const Z of X)L.push({x:Z.x,y:Z.y});const N={coordinates:L,crossPerc:T.properties.cross_perc,distanceToRoad:T.properties.distance_to_road,entrances:T.properties.entrances,sourceId:0},B=T.properties.source_id;let W=b.get(B);W||(W=[],b.set(B,W)),W.push(N)}this.maxHeight=0;for(const{feature:T,index:S}of i){if(r6[T.type]==="LineString")continue;const P=this.layers[0]._featureFilter.needGeometry,M=Ct(T,P);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom),M,h))continue;const L=P?M.geometry:$t(T,h,d),N=tv(L,500);if(!qj(L,163))continue;const B=this.layers[0],W=B.layout.get("building-base").evaluate(T,{},h),X=B.layout.get("building-height").evaluate(T,{},h),Z=B.layout.get("building-roof-shape").evaluate(T,{},h),ne=B.paint.get("building-ambient-occlusion-intensity"),se=B.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(Z==="flat")continue;const le=B.layout.get("building-facade").evaluate(T,{},h);_.setFacadeOptions(4,!0),_.setFauxFacadeOptions(le,!1,1);const Ee=T.properties.source_id;let Ie;Ie=b.has(Ee)?b.get(Ee):[];let Re=0,Ne=0,je=0,ft=0,We=0,mt=0;if(le){let ei=Math.round(B.layout.get("building-facade-floors").evaluate(T,{},h));if(W===0){ei=Math.max(1,ei-(Ie.length>0?1:0));let Ir=4;if(X>100){const ue=[10,13,15];Ir=ue[T.id?T.id%ue.length:0],_.setFacadeOptions(Ir,!0)}We=1.6803*Ir/g}else We=W/g;mt=X/g,We=Math.min(We,mt),je=B.layout.get("building-facade-unit-width").evaluate(T,{},h)/g,ft=(mt-We)/ei,_.setFauxFacadeOptions(!0,!0,je);const qi=B.layout.get("building-facade-window").evaluate(T,{},h);Re=qi[0],Ne=qi[1]}const St=[],gt=new xt(1/0,1/0),wt=new xt(-1/0,-1/0),Rt=new xt(0,0);let ut=0;for(const ei of N)if(ei.length>0){const qi=[];for(const Ir of ei){const ue=[];for(let he=Ir.length-1;he>=0;he--){const it=Ir[he];ue.push({x:it.x,y:it.y}),gt.x=Math.min(gt.x,it.x),gt.y=Math.min(gt.y,it.y),wt.x=Math.max(wt.x,it.x),wt.y=Math.max(wt.y,it.y),Rt.x+=it.x,Rt.y+=it.y,ut++}qi.push(ue)}St.push({id:T.id?T.id:0,height:X,minHeight:W,sourceId:0,roofType:Z,coordinates:qi})}Rt.x/=ut||1,Rt.y/=ut||1;const Tt=_.generateMesh(St,Ie);if(typeof Tt=="string"){Ji(`Unable to generate building ${T.id}: ${Tt}`);continue}if(Tt.meshes.length===0||Tt.modifiedPolygonRings.length===0)continue;let rt=0;for(const ei of Tt.meshes)rt+=ei.positions.length/3;const et=le?this.buildingWithFacade:this.buildingWithoutFacade,Pt=et.segmentsBucket.prepareSegment(rt,et.layoutVertexArray,et.indexArray),At=[];let mi=null,qt=0,si=-1;const Ot=et.indexArray.length;let pi=0;for(const ei of Tt.meshes){const qi=et.layoutVertexArray.length;if(ei.buildingPart==="entrance"){const dt=new Array;for(let gi=0;gi<ei.indices.length;gi+=12){const ar=ei.positions[gi+0],lr=ei.positions[gi+1],rr=ei.positions[gi+3],Yr=ei.positions[gi+4],On=ei.positions[gi+2],tr=ei.positions[gi+8]-On,yn=1,rn=rr-ar,Nr=Yr-lr,bn=Math.hypot(rn,Nr);dt.push({pos:[ar+.5*rn,lr+.5*Nr,On],normal:[Nr/bn,-rn/bn,0],width:bn,height:tr,depth:yn,points:[ar,lr,rr,Yr]})}const Vt=et.entranceBloom.segmentsBucket.prepareSegment(10*dt.length,et.entranceBloom.layoutVertexArray,et.entranceBloom.indexArray),Bt=et.entranceBloom.layoutVertexArray.length;qt=et.entranceBloom.indexArray.length,e6(dt,.5/this.tileToMeter,et.entranceBloom.indexArray,et.entranceBloom.layoutVertexArray,et.entranceBloom.layoutAttenuationArray);const Yt=et.entranceBloom.layoutVertexArray.length-Bt;si=et.entranceBloom.indexArray.length-qt;for(let gi=0;gi<Yt;gi++)et.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Vt.vertexLength+=Yt,Vt.primitiveLength+=si,mi={part:ei.buildingPart,vertexOffset:Bt,vertexLength:Yt}}for(let dt=0;dt<ei.positions.length;dt+=3)pi=Math.max(pi,ei.positions[dt+2]),et.layoutVertexArray.emplaceBack(ei.positions[dt],ei.positions[dt+1],ei.positions[dt+2]);const Ir=Math.floor(Rt.x),ue=Math.floor(Rt.y),he=Math.floor(pi);for(let dt=0;dt<ei.positions.length;dt+=3)et.layoutCentroidArray.emplaceBack(Ir,ue,he);for(let dt=0;dt<ei.normals.length;dt+=3)et.layoutNormalArray.emplaceBack(ei.normals[dt+0]*oS,ei.normals[dt+1]*oS,ei.normals[dt+2]*oS);for(let dt=0;dt<ei.ao.length;dt++)et.layoutAOArray.push(ei.ao[dt]);for(let dt=0;dt<ei.colors.length;dt+=3){const Vt=1+(ei.ao[dt/3]-1)*ne;et.layoutColorArray.emplaceBack(ei.colors[dt]*Vt<<8|ei.colors[dt+1]*Vt,ei.colors[dt+2]*Vt<<8)}if(le){for(let dt=0;dt<ei.positions.length;dt+=3)et.layoutFacadePaintArray.emplaceBack(65535,255);for(let dt=0;dt<ei.isFauxFacade.length;dt++)if(ei.isFauxFacade[dt]){const Vt=1|Math.min(65535,Math.floor(ei.uv[2*dt]*Tt.outerRingLength)),Bt=Math.floor(255*Re)<<8|Math.floor(255*Ne),Yt=Math.floor(65535*Math.min(1,je/Ft)),gi=Math.floor(65535*Math.min(1,ft/Ft));et.layoutFacadeDataArray.emplaceBack(Vt,Bt,Yt,gi);const ar=Math.floor(65535*Math.min(1,We/Ft)),lr=Math.floor(65535*Math.min(1,mt/Ft));et.layoutFacadeVerticalRangeArray.emplaceBack(ar,lr)}else et.layoutFacadeDataArray.emplaceBack(0,0,0,0),et.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const it=Pt.vertexLength;for(let dt=0;dt<ei.indices.length;dt+=3)et.indexArray.emplaceBack(it+ei.indices[dt],it+ei.indices[dt+1],it+ei.indices[dt+2]);Pt.vertexLength+=ei.positions.length/3,Pt.primitiveLength+=ei.indices.length/3,(ei.buildingPart==="roof"||ei.buildingPart==="wall"||ei.buildingPart==="facade_glazing"||ei.buildingPart==="entrance")&&At.push({part:ei.buildingPart,vertexOffset:qi,vertexLength:ei.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,pi),this.buildingFeatures.push({feature:M,hasFauxFacade:le,segment:Pt,parts:At,buildingBloom:mi});const Ui=et.indexArray.length-Ot,Ut=[],ci=[],Li=new xt(1/0,1/0),Hi=new xt(-1/0,-1/0),or=this.groundEffect.vertexArray.length;for(const ei of Tt.modifiedPolygonRings){const qi=[],Ir=new xt(1/0,1/0),ue=new xt(-1/0,-1/0);for(let he=0;he<ei.length;he+=2){const it=ei.length-he-2;Ir.x=Math.min(Ir.x,ei[it]),Ir.y=Math.min(Ir.y,ei[it+1]),ue.x=Math.max(ue.x,ei[it]),ue.y=Math.max(ue.y,ei[it+1]);const dt=new xt(ei[it],ei[it+1]);qi.push(dt),Ut.push(dt.x,dt.y),ci.push(dt.clone())}Li.x=Math.min(Li.x,Ir.x),Li.y=Math.min(Li.y,Ir.y),Hi.x=Math.max(Hi.x,ue.x),Hi.y=Math.max(Hi.y,ue.y),this.groundEffect.addData(qi,[Ir,ue],se)}const Zi=this.groundEffect.vertexArray.length-or;(gt.x<0||wt.x>Ft||gt.y<0||wt.y>Ft)&&this.featuresOnBorder.push({featureId:T.id,footprintIndex:this.footprints.length});{const ei=eg(Ut,null,2),qi=new qb(ci,ei,8,256);let Ir=T.id;T.properties&&T.properties.hasOwnProperty("building_id")&&(Ir=T.properties.building_id),this.footprints.push({vertices:ci,indices:ei,grid:qi,min:Li,max:Hi,buildingId:Ir,hiddenFlags:0,indicesOffset:Ot,indicesLength:Ui,bloomIndicesOffset:qt,bloomIndicesLength:si,groundEffectVertexOffset:or,groundEffectVertexLength:Zi,hasFauxFacade:le,segment:Pt,height:pi})}this.programConfigurations.populatePaintArrays(et.layoutVertexArray.length,T,S,{},a.availableImages,h,a.brightness),this.groundEffect.addPaintPropertiesData(T,S,{},a.availableImages,h,a.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(i,a,h,d,_,g,b){this.programConfigurations.updatePaintArrays(i,a,_,h,d,g,b),this.groundEffect.update(i,a,_,h,d,g,b),this.evaluate(this.layers[0],i),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){const a=h=>{h.layoutVertexBuffer=i.createVertexBuffer(h.layoutVertexArray,t6.members),h.layoutNormalBuffer=i.createVertexBuffer(h.layoutNormalArray,Vj.members),h.layoutCentroidBuffer=i.createVertexBuffer(h.layoutCentroidArray,Uj.members),h.layoutFacadeDataArray&&h.layoutFacadeDataArray.length&&(h.layoutFacadeDataBuffer=i.createVertexBuffer(h.layoutFacadeDataArray,$j.members)),h.layoutFacadeVerticalRangeArray&&h.layoutFacadeVerticalRangeArray.length&&(h.layoutFacadeVerticalRangeBuffer=i.createVertexBuffer(h.layoutFacadeVerticalRangeArray,Gj.members)),h.entranceBloom.layoutVertexArray.length&&(h.entranceBloom.layoutVertexBuffer=i.createVertexBuffer(h.entranceBloom.layoutVertexArray,t6.members),h.entranceBloom.layoutAttenuationBuffer=i.createVertexBuffer(h.entranceBloom.layoutAttenuationArray,Hj.members)),this.uploadUpdatedColorBuffer(i),this.uploadUpdatedIndexBuffer(i)};this.uploaded||(a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){const i=a=>{a.layoutVertexBuffer&&(a.layoutVertexBuffer.destroy(),a.layoutNormalBuffer.destroy(),a.layoutColorBuffer.destroy(),a.segmentsBucket.destroy(),a.indexBuffer&&a.indexBuffer.destroy(),a.entranceBloom.layoutVertexBuffer&&(a.entranceBloom.layoutVertexBuffer.destroy(),a.entranceBloom.layoutColorBuffer.destroy(),a.entranceBloom.layoutAttenuationBuffer.destroy(),a.entranceBloom.indexBuffer.destroy(),a.entranceBloom.segmentsBucket.destroy()))};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(i,a,h=!0){let d=!1;const _=h?a:0,g=0|(h?-1:~a);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const b of i){const T=this.footprints[b],S=T.hiddenFlags&g|_;T.hiddenFlags!==S&&(T.hiddenFlags=S,d=!0,this.groundEffect.updateHiddenByLandmarkRange(T.groundEffectVertexOffset,T.groundEffectVertexLength,T.hiddenFlags!==0))}return d&&(this.indexArrayForConflationUploaded=!1),d}uploadUpdatedIndexBuffer(i){if(this.groundEffect.uploadHiddenByLandmark(i),this.indexArrayForConflationUploaded)return;const a=d=>{d.indexArray.length!==0&&(d.indexArrayForConflation.resize(d.indexArray.length),d.indexArrayForConflation.uint16.set(d.indexArray.uint16),d.entranceBloom.indexArrayForConflation.resize(d.entranceBloom.indexArray.length),d.entranceBloom.indexArrayForConflation.uint16.set(d.entranceBloom.indexArray.uint16))};a(this.buildingWithoutFacade),a(this.buildingWithFacade);for(const d of this.footprints){const _=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,g=d.indicesOffset+d.indicesLength;if(d.hiddenFlags!==0){for(let T=d.indicesOffset;T<g;T++)_.indexArrayForConflation.uint16[3*T+0]=0,_.indexArrayForConflation.uint16[3*T+1]=0,_.indexArrayForConflation.uint16[3*T+2]=0;const b=d.bloomIndicesOffset+d.bloomIndicesLength;for(let T=d.bloomIndicesOffset;T<b;T++)_.entranceBloom.indexArrayForConflation.uint16[3*T+0]=0,_.entranceBloom.indexArrayForConflation.uint16[3*T+1]=0,_.entranceBloom.indexArrayForConflation.uint16[3*T+2]=0}}const h=d=>{d.indexArray.length!==0&&(d.indexBuffer?d.indexBuffer.updateData(d.indexArrayForConflation):d.indexBuffer=i.createIndexBuffer(d.indexArrayForConflation,!0),d.entranceBloom.indexBuffer?d.entranceBloom.indexBuffer.updateData(d.entranceBloom.indexArrayForConflation):d.entranceBloom.indexBuffer=i.createIndexBuffer(d.entranceBloom.indexArrayForConflation,!0))};h(this.buildingWithoutFacade),h(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(i){const a=h=>{h.layoutColorBuffer?h.layoutColorBuffer.updateData(h.layoutColorArray):h.layoutColorBuffer=i.createVertexBuffer(h.layoutColorArray,i6.members,!0),h.layoutFacadePaintArray&&(h.layoutFacadePaintBuffer?h.layoutFacadePaintBuffer.updateData(h.layoutFacadePaintArray):h.layoutFacadePaintBuffer=i.createVertexBuffer(h.layoutFacadePaintArray,jj.members,!0)),h.entranceBloom.layoutColorBuffer?h.entranceBloom.layoutColorBuffer.updateData(h.entranceBloom.layoutColorArray):h.entranceBloom.layoutColorBuffer=i.createVertexBuffer(h.entranceBloom.layoutColorArray,i6.members,!0)};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(i,a){const h=i.paint.get("building-ambient-occlusion-intensity");for(const d of this.buildingFeatures){const _=a[d.feature.id],g=d.feature;g.properties["building-part"]="roof";const b=i.paint.get("building-color").evaluate(g,_,this.canonical).toPremultipliedRenderColor(this.lut),T=i.paint.get("building-emissive-strength").evaluate(g,_,this.canonical);g.properties["building-part"]="wall";const S=i.paint.get("building-color").evaluate(g,_,this.canonical).toPremultipliedRenderColor(this.lut),P=i.paint.get("building-emissive-strength").evaluate(g,_,this.canonical);g.properties["building-part"]="window";const M=i.paint.get("building-color").evaluate(g,_,this.canonical).toPremultipliedRenderColor(this.lut),L=i.paint.get("building-emissive-strength").evaluate(g,_,this.canonical);g.properties["building-part"]="door";const N=i.paint.get("building-color").evaluate(g,_,this.canonical).toPremultipliedRenderColor(this.lut),B=i.paint.get("building-emissive-strength").evaluate(g,_,this.canonical),W=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const Z of d.parts){let ne,se=b;Z.part==="roof"?(se=b,ne=T):Z.part==="wall"?(se=S,ne=P):Z.part==="facade_glazing"?(se=M,ne=L):Z.part==="entrance"&&(se=N,ne=B),ne=fe(ne,0,1);for(let le=0;le<Z.vertexLength;le++){const Ee=Z.vertexOffset+le,Ie=1+(W.layoutAOArray[Ee]-1)*h;W.layoutColorArray.emplace(Ee,se.r*Ie*255<<8|se.g*Ie*255,se.b*Ie*255<<8|255*ne),d.hasFauxFacade&&W.layoutFacadePaintArray.emplace(Ee,255*M.r<<8|255*M.g,255*M.b<<8|255*L)}}const X=d.buildingBloom;if(X)for(let Z=0;Z<X.vertexLength;Z++)W.entranceBloom.layoutColorArray.emplace(X.vertexOffset+Z,255*N.r<<8|255*N.g,255*N.b<<8|51*B)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(i,a,h){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(i.toUnwrapped());if(Xb(this.activeReplacements,d))return;this.activeReplacements=d;for(const g of this.footprints)g.hiddenFlags&=-2;const _=[];for(const g of this.activeReplacements){if(g.order<=cM)continue;const b=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-i.canonical.z));for(const T of this.footprints)T.min.x>g.max.x||T.max.x<g.min.x||T.min.y>g.max.y||T.max.y<g.min.y||(_.length=0,Wj(T.vertices,0,T.vertices.length,g.footprintTileId.canonical,i.canonical,_),UI(g.footprint,_,T.indices,0,T.indices.length,0,-b)&&(T.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const g of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(g.groundEffectVertexOffset,g.groundEffectVertexLength,g.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(i,a){let h=Number.NEGATIVE_INFINITY,d=!0;const _=4*(i+Ft)*Ft+(a+Ft);if(this.footprintLookup.hasOwnProperty(_)){const b=this.footprintLookup[_];return b?{height:b.height,hidden:b.hiddenFlags!==0}:void 0}const g=new xt(i,a);for(const b of this.footprints)i>b.max.x||b.min.x>i||a>b.max.y||b.min.y>a||b.height<=h||jI(g,b)&&(h=b.height,this.footprintLookup[_]=b,d=b.hiddenFlags!==0);if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:d};this.footprintLookup[_]=void 0}}function Wj(l,i,a,h,d,_){const g=Math.pow(2,h.z-d.z);for(let b=0;b<a;b++){let T=l[b+i].x,S=l[b+i].y;T=(T+d.x*Ft)*g-h.x*Ft,S=(S+d.y*Ft)*g-h.y*Ft,_.push(new xt(T,S))}}let o6,a6;Zt(s6,"BuildingBucket",{omit:["layers"]}),Zt(aS,"BuildingGeometry"),Zt(n6,"BuildingBloomGeometry");const Xj=xr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Zj=xr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Kj}=Xj,Yj=xr([{name:"a_packed",components:3,type:"Float32"}]),{members:Jj}=Yj,Qj=xr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:e$}=Qj;class l6{constructor(i,a){this.width=i,this.height=a,this.nextRow=0,this.image=new yf({width:i,height:a}),this.positions={},this.uploaded=!1}getDash(i,a){const h=this.getKey(i,a);return this.positions[h]}trim(){const i=this.width,a=this.height=Kt(this.nextRow);this.image.resize({width:i,height:a})}getKey(i,a){return i.join(",")+a}getDashRanges(i,a,h){const d=[];let _=i.length%2==1?-i[i.length-1]*h:0,g=i[0]*h,b=!0;d.push({left:_,right:g,isDash:b,zeroLength:i[0]===0});let T=i[0];for(let S=1;S<i.length;S++){b=!b;const P=i[S];_=T*h,T+=P,g=T*h,d.push({left:_,right:g,isDash:b,zeroLength:P===0})}return d}addRoundDash(i,a,h){const d=a/2;for(let _=-h;_<=h;_++){const g=this.width*(this.nextRow+h+_);let b=0,T=i[b];for(let S=0;S<this.width;S++){S/T.right>1&&(T=i[++b]);const P=Math.abs(S-T.left),M=Math.abs(S-T.right),L=Math.min(P,M);let N;const B=_/h*(d+1);if(T.isDash){const W=d-Math.abs(B);N=Math.sqrt(L*L+W*W)}else N=d-Math.sqrt(L*L+B*B);this.image.data[g+S]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(i,a){for(let T=i.length-1;T>=0;--T){const S=i[T],P=i[T+1];S.zeroLength?i.splice(T,1):P&&P.isDash===S.isDash&&(P.left=S.left,i.splice(T,1))}const h=i[0],d=i[i.length-1];h.isDash===d.isDash&&(h.left=d.left-this.width,d.right=h.right+this.width);const _=this.width*this.nextRow;let g=0,b=i[g];for(let T=0;T<this.width;T++){T/b.right>1&&(b=i[++g]);const S=Math.abs(T-b.left),P=Math.abs(T-b.right),M=Math.min(S,P);this.image.data[_+T]=Math.max(0,Math.min(255,(b.isDash?M:-M)+a+128))}}addDash(i,a){const h=this.getKey(i,a);if(this.positions[h])return this.positions[h];const d=a==="round",_=d?7:0,g=2*_+1;if(this.nextRow+g>this.height)return Ji("LineAtlas out of space"),null;i.length===0&&i.push(1);let b=0;for(let P=0;P<i.length;P++)i[P]<0&&(Ji("Negative value is found in line dasharray, replacing values with 0"),i[P]=0),b+=i[P];if(b!==0){const P=this.width/b,M=this.getDashRanges(i,this.width,P);d?this.addRoundDash(M,P,_):this.addRegularDash(M,a==="square"?.5*P:0)}const T=this.nextRow+_;this.nextRow+=g;const S={tl:[T,_],br:[b,0]};return this.positions[h]=S,S}}Zt(l6,"LineAtlas");const t$=It.types,i$=Math.cos(Math.PI/180*37.5),r$=Math.cos(Math.PI/180*5);class lS{constructor(i){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=i.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=i.overscaling,this.pixelRatio=i.pixelRatio,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new j_,this.layoutVertexArray2=new ua,this.patternVertexArray=new ua,this.indexArray=new Us,this.programConfigurations=new Gl(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new jn,this.maxLineLength=0,this.zOffsetVertexArray=new ua,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=i.tessellationStep?i.tessellationStep:Ft/64,this.worldview=i.worldview}updateFootprints(i,a){}populate(i,a,h,d){this.hasPattern=OI("line",this.layers,this.pixelRatio,a);const _=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Xe(h);const g=this.layers[0].layout.get("line-elevation-reference");if(g==="hd-road-markup")this.elevationType="road";else{const L=this.layers[0].layout.get("line-z-offset"),N=L.isConstant()&&!L.constantOr(0);this.elevationType=g!=="sea"&&g!=="ground"&&N?"none":"offset",this.elevationType==="offset"&&g==="none"&&Ji(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const b=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&b!==void 0;const T=[];for(const{feature:L,id:N,index:B,sourceLayerIndex:W}of i){const X=this.layers[0]._featureFilter.needGeometry,Z=Ct(L,X);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom,{worldview:this.worldview}),Z,h))continue;const ne=_?_.evaluate(Z,{},h):void 0,se={id:N,properties:L.properties,type:L.type,sourceLayerIndex:W,index:B,geometry:X?Z.geometry:$t(L,h,d),patterns:{},sortKey:ne};T.push(se)}_&&T.sort((L,N)=>L.sortKey-N.sortKey);const{lineAtlas:S,featureIndex:P}=a,M=this.addConstantDashes(S);for(const L of T){const{geometry:N,index:B,sourceLayerIndex:W}=L;if(M&&this.addFeatureDashes(L,S),this.hasPattern){const X=FI("line",this.layers,L,this.zoom,this.pixelRatio,a);this.patternFeatures.push(X)}else this.addFeature(L,N,B,h,S.positions,a.availableImages,a.brightness,a.elevationFeatures);P.insert(i[B].feature,N,B,W,this.index)}}addConstantDashes(i){let a=!1;for(const h of this.layers){const d=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if(d.kind!=="constant"||_.kind!=="constant")a=!0;else{const g=_.value,b=d.value;if(!b)continue;i.addDash(b,g)}}return a}addFeatureDashes(i,a){const h=this.zoom;for(const d of this.layers){const _=d.paint.get("line-dasharray").value,g=d.layout.get("line-cap").value;if(_.kind==="constant"&&g.kind==="constant")continue;let b,T;if(_.kind==="constant"){if(b=_.value,!b)continue}else b=_.evaluate({zoom:h},i);T=g.kind==="constant"?g.value:g.evaluate({zoom:h},i),a.addDash(b,T),i.patterns[d.id]=[a.getKey(b,T)]}}update(i,a,h,d,_,g,b,T){this.programConfigurations.updatePaintArrays(i,a,_,h,d,g,b,T)}addFeatures(i,a,h,d,_,g){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,a,h,d,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,Jj)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=i.createVertexBuffer(this.patternVertexArray,e$)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,Zj.members,!0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Kj),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i,a){let h,d;if(a&&a>0?(h=`mapbox_clip_start_${a}`,d=`mapbox_clip_end_${a}`):(h="mapbox_clip_start",d="mapbox_clip_end"),i.properties&&i.properties.hasOwnProperty(h)&&i.properties.hasOwnProperty(d))return{start:+i.properties[h],end:+i.properties[d]}}addFeature(i,a,h,d,_,g,b,T){const S=this.layers[0].layout,P=S.get("line-join").evaluate(i,{}),M=S.get("line-cap").evaluate(i,{}),L=S.get("line-miter-limit"),N=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(i),this.lineFeature=i;const B=!(!i.properties||!i.properties.hasOwnProperty("mapbox_line_metrics"))&&i.properties.mapbox_line_metrics;this.zOffsetValue=S.get("line-z-offset").value;const W=this.layers[0].paint.get("line-width").value;if(W.kind!=="constant"&&W.isLineProgressConstant===!1&&(this.variableWidthValue=W),this.elevationType==="road"){const X=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(i,a,d,T,P,M,L,N)){const[Z,ne]=this.clipRuntimeLinesToTile(a,1);for(let se=0;se<Z.length;se++){const le=Z[se],Ee=ne[se],Ie={progress:{min:Ee.progress.min,max:Ee.progress.max},nextDir:this.computeSegNextDir(Ee,le),prevDir:this.computeSegPrevDir(Ee,le)};this.addLine(le,i,d,P,M,L,N,Ie,B&&Ee.parentIndex>0?Ee.parentIndex:null)}this.fillNonElevatedRoadSegment(X)}}else for(let X=0;X<a.length;X++)this.addLine(a[X],i,d,P,M,L,N,void 0,B&&X>0?X:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,_,g,d,b,void 0,this.worldview)}computeSegNextDir(i,a){return i.nextPoint.sub(a.at(-2)).unit()}computeSegPrevDir(i,a){return a[1].sub(i.prevPoint).unit()}clipLinesToTile(i,a){return Yb(i,-a,-a,Ft+a,Ft+a)}clipRuntimeLinesToTile(i,a){const h=[];return[Yb(i,-a,-a,Ft+a,Ft+a,h),h]}addElevatedRoadFeature(i,a,h,d,_,g,b,T){const S=[],P=zn.getElevationFeature(i,d);if(P){const M=this.clipLinesToTile(a,1),L=this.prepareElevatedLines(M,P,h);for(const N of L)S.push({geometry:N,elevation:P,elevationTileID:h,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(S.length===0)return!1;for(const M of S){const L=this.layoutVertexArray.length;this.addLine(M.geometry,i,h,_,g,b,T);const N=new ws(h,M.elevationTileID);if(M.elevation)for(let B=L;B<this.layoutVertexArray.length;B++){const W=new xt(this.layoutVertexArray.int16[6*B]>>1,this.layoutVertexArray.int16[6*B+1]>>1),X=N.pointElevation(W,M.elevation,.05);this.updateHeightRange(X),this.zOffsetVertexArray.emplaceBack(X,0,0)}else this.fillNonElevatedRoadSegment(L)}return!0}prepareElevatedLines(i,a,h){if(a.constantHeight!=null)return i;const d=[],_=1/Xe(h);for(const g of i)_j(g,new Kr(a,_),0,d);return d}fillNonElevatedRoadSegment(i){for(let a=i;a<this.layoutVertexArray.length;a++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(i){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,i),this.heightRange.max=Math.max(this.heightRange.max,i)):this.heightRange={min:i,max:i}}addLine(i,a,h,d,_,g,b,T,S){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=S?this.lineFeatureClips(a,S):this.lineClips;const P=d==="none";this.patternJoinNone=this.hasPattern&&P,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const M=T&&T.progress.min>0,L=T&&T.progress.max<1;if(this.lineClips){let je={min:this.lineClips.start,max:this.lineClips.end},ft=1;if(T){const St=this.lineClips.end-this.lineClips.start;je=function(gt,wt,Rt){return{min:Za(gt.min,wt,Rt),max:Za(gt.max,wt,Rt)}}(T.progress,{min:0,max:1},je),St>0&&(ft=(je.max-je.min)/St)}const We=+a.properties.mapbox_clip_feature_len,mt=+a.properties.mapbox_clip_seg_len;if(Number.isNaN(We)||Number.isNaN(mt)){for(let gt=0;gt<i.length-1;gt++)this.totalDistance+=i[gt].dist(i[gt+1]);const St=this.totalDistance/(je.max-je.min);this.totalFeatureLength=Number.isFinite(St)?St:0,this.lineClips.start=je.min,this.lineClips.end=je.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=We,this.distance=mt*ft,this.lineClips.start=je.min,this.lineClips.end=je.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const N=t$[a.type]==="Polygon";let B=i.length;for(;B>=2&&i[B-1].equals(i[B-2]);)B--;let W=0;for(;W<B-1&&i[W].equals(i[W+1]);)W++;if(B<(N?3:2))return;d==="bevel"&&(g=1.05);const X=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray);let Z,ne,se,le,Ee,Ie,Re,Ne;T&&T.prevDir&&(Ie=T.prevDir.perp()),T&&T.nextDir&&(Re=T.nextDir.perp()),this.e1=this.e2=-1,N&&(Z=i[B-2],Ee=i[W].sub(Z)._unit()._perp());for(let je=W;je<B;je++){if(se=je===B-1?N?i[W+1]:void 0:i[je+1],se&&i[je].equals(se))continue;Ee&&(le=Ee),Z&&(ne=Z),Z=i[je],Ne=this.evaluateLineProgressFeatures(ne?ne.dist(Z):0),Ee=se?se.sub(Z)._unit()._perp():le,le=le||Ee;const ft=ne&&se;let We=ft?d:N||P?"butt":_;const mt=le.x*Ee.x+le.y*Ee.y;if(P){const et=function(Pt){if(Pt.patternJoinNone){const At=Pt.segmentPoints.length/2,mi=Pt.lineSoFar-Pt.segmentStart;for(let qt=0;qt<At;++qt){const si=Pt.segmentPoints[2*qt+1],Ot=Math.round(Pt.segmentPoints[2*qt])+.5+.25*si;Pt.patternVertexArray.emplaceBack(Ot,mi,Pt.segmentStart),Pt.patternVertexArray.emplaceBack(Ot,mi,Pt.segmentStart)}Pt.segmentPoints.length=0}Pt.e1=Pt.e2=-1};if(ft&&mt<r$){this.updateDistance(ne,Z),this.addCurrentVertex(Z,le,1,1,X,Ne),et(this),this.addCurrentVertex(Z,Ee,-1,-1,X,Ne);continue}if(ne){if(!se){this.updateDistance(ne,Z),this.addCurrentVertex(Z,le,1,1,X,Ne),et(this);continue}We="miter"}}let St=le.add(Ee);St.x===0&&St.y===0||St._unit();const gt=St.x*Ee.x+St.y*Ee.y,wt=gt!==0?1/gt:1/0,Rt=2*Math.sqrt(2-2*gt),ut=gt<i$&&ne&&se,Tt=le.x*Ee.y-le.y*Ee.x>0,rt=this.overscaling<=16?15*Ft/(512*this.overscaling):0;if(ft&&We==="round"){if(wt<b)We="miter";else if(wt<=2){const et=cS(Z,-10,Ft+10);We=this.elevationType==="offset"&&(et||this.hasCrossSlope)?"miter":"fakeround"}}if(We==="miter"&&wt>g&&(We="bevel"),We==="bevel"&&(wt>2&&(We="flipbevel"),wt<g&&(We="miter")),ne&&!(We==="miter"&&ut)&&this.updateDistance(ne,Z),We==="miter")if(ut){const et=Z.dist(ne);if(et>2*rt){const At=Z.sub(Z.sub(ne)._mult(rt/et)._round());this.updateDistance(ne,At),this.addCurrentVertex(At,le,0,0,X,Ne),ne=At}this.updateDistance(ne,Z),St._mult(wt),this.addCurrentVertex(Z,St,0,0,X,Ne);const Pt=Z.dist(se);if(Pt>2*rt){const At=Z.add(se.sub(Z)._mult(rt/Pt)._round());this.updateDistance(Z,At),this.addCurrentVertex(At,Ee,0,0,X,Ne),Z=At}}else St._mult(wt),this.addCurrentVertex(Z,St,0,0,X,Ne);else if(We==="flipbevel"){if(wt>100)St=Ee.mult(-1);else{const et=wt*le.add(Ee).mag()/le.sub(Ee).mag();St._perp()._mult(et*(Tt?-1:1))}this.addCurrentVertex(Z,St,0,0,X,Ne),this.addCurrentVertex(Z,St.mult(-1),0,0,X,Ne)}else if(We==="bevel"||We==="fakeround"){Ne!=null&&ne&&this.addCurrentVertex(Z,Re||le,-1,-1,X,Ne);const et=Z.dist(ne)<=2*rt&&We!=="bevel",Pt=St.mult(Tt?1:-1);Pt._mult(wt);const At=Ee.mult(Tt?-1:1),mi=le.mult(Tt?-1:1),qt=this.evaluateLineProgressFeatures(this.distance);if(Ne==null&&(this.addHalfVertex(Z,Pt.x,Pt.y,!1,!Tt,0,X,qt),et||this.addHalfVertex(Z,Pt.x+2*mi.x,Pt.y+2*mi.y,!1,Tt,0,X,qt)),We==="fakeround"){const si=Math.round(180*Rt/Math.PI/20);this.addHalfVertex(Z,mi.x,mi.y,!1,Tt,0,X,qt);for(let Ot=0;Ot<si;Ot++){let pi=Ot/si;if(pi!==.5){const Ut=pi-.5;pi+=pi*Ut*(pi-1)*((1.0904+mt*(mt*(3.55645-1.43519*mt)-3.2452))*Ut*Ut+(.848013+mt*(.215638*mt-1.06021)))}const Ui=At.sub(mi)._mult(pi)._add(mi)._unit();this.addHalfVertex(Z,Ui.x,Ui.y,!1,Tt,0,X,qt)}this.addHalfVertex(Z,At.x,At.y,!1,Tt,0,X,qt)}et||Ne!=null||this.addHalfVertex(Z,Pt.x+2*At.x,Pt.y+2*At.y,!1,Tt,0,X,qt),Ne!=null&&se&&this.addCurrentVertex(Z,Ie||Ee,1,1,X,Ne)}else if(We==="butt")this.addCurrentVertex(Z,St,0,0,X,Ne);else if(We==="square"){if(!ne){const et=M?0:-1;this.addCurrentVertex(Z,St,et,et,X,Ne)}if(this.addCurrentVertex(Z,St,0,0,X,Ne),ne){const et=L?0:1;this.addCurrentVertex(Z,St,et,et,X,Ne)}}else if(We==="round"){if(ne){const et=!ft&&Re?Re:le;this.addCurrentVertex(Z,et,0,0,X,Ne),!ft&&L||this.addCurrentVertex(Z,et,1,1,X,Ne,!0)}if(se){const et=!ft&&Ie?Ie:Ee;!ft&&M||this.addCurrentVertex(Z,et,-1,-1,X,Ne,!0),this.addCurrentVertex(Z,et,0,0,X,Ne)}}}}addVerticesTo(i,a,h,d,_,g,b,T,S,P){const M=(a.w-i.w)/this.tessellationStep|0;let L=0;const N=this.scaledDistance;if(M>1){this.lineSoFar=i.w;const W=(a.x-i.x)/M,X=(a.y-i.y)/M,Z=(a.z-i.z)/M,ne=(a.w-i.w)/M;for(let se=1;se<M;++se){i.x+=W,i.y+=X,i.z+=Z,this.lineSoFar+=ne,L+=ne;const le=this.evaluateLineProgressFeatures(this.prevDistance+L);this.scaledDistance=(this.prevDistance+L)/this.totalDistance,this.addHalfVertex(i,h,d,P,!1,b,S,le),this.addHalfVertex(i,_,g,P,!0,-T,S,le)}}this.lineSoFar=a.w,this.scaledDistance=N;const B=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,h,d,P,!1,b,S,B),this.addHalfVertex(a,_,g,P,!0,-T,S,B)}evaluateLineProgressFeatures(i){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+i)/this.totalFeatureLength):Ji(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:a}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}}addCurrentVertex(i,a,h,d,_,g,b=!1){const T=a.x+a.y*h,S=a.y-a.x*h,P=a.y*d-a.x,M=-a.y-a.x*d;if(g!=null){const L=this.elevationType==="offset",N=-10,B=Ft+10,W=g.zOffset,X=new PM(i.x,i.y,W,this.lineSoFar),Z=!!L&&cS(i,N,B),ne=this.lineSoFar,se=this.distance;if(this.currentVertex)if(Z){const le=this.currentVertexIsOutside,Ee=this.currentVertex,Ie=new PM(i.x,i.y,W,this.lineSoFar);if(kM(Ee,Ie,N,B),!cS(Ie,N,B)){if(le){this.e1=this.e2=-1,this.distance-=Ee.dist(X),this.lineSoFar=Ee.w;const Re=this.evaluateLineProgressFeatures(Ee.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ee,T,S,b,!1,h,_,Re),this.addHalfVertex(Ee,P,M,b,!0,-d,_,Re),this.prevDistance=this.distance}this.distance=this.prevDistance+Ee.dist(Ie),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Ee,Ie,T,S,P,M,h,d,_,b),this.distance=se,this.scaledDistance=this.distance/this.totalDistance}}else{const le=this.currentVertex;if(this.currentVertexIsOutside){kM(le,X,N,B),this.e1=this.e2=-1,this.distance-=le.dist(X),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=le.w;const Ee=this.evaluateLineProgressFeatures(le.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(le,T,S,b,!1,h,_,Ee),this.addHalfVertex(le,P,M,b,!0,-d,_,Ee),this.prevDistance=this.distance,this.distance=se,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(le,X,T,S,P,M,h,d,_,b)}else Z||(this.addHalfVertex(i,T,S,b,!1,h,_,g),this.addHalfVertex(i,P,M,b,!0,-d,_,g));this.currentVertex=X,this.currentVertexIsOutside=Z,this.lineSoFar=ne}else this.addHalfVertex(i,T,S,b,!1,h,_,g),this.addHalfVertex(i,P,M,b,!0,-d,_,g)}addHalfVertex({x:i,y:a},h,d,_,g,b,T,S){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((i<<1)+(_?1:0),(a<<1)+(g?1:0),Math.round(63*h)+128,Math.round(63*d)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const M=Ri(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,M)}const P=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),T.primitiveLength++),g?this.e2=P:this.e1=P,S!=null&&this.zOffsetVertexArray.emplaceBack(S.zOffset,S.variableWidth,S.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(i,a){this.prevDistance=this.distance,this.distance+=i.dist(a),this.updateScaledDistance()}}function cS(l,i,a){return l.x<i||l.x>a||l.y<i||l.y>a}let c6,u6;function h6(l,i,a){return i*(Ft/(l.tileSize*Math.pow(2,a-l.tileID.overscaledZ)))}Zt(lS,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const d6=(l,i,a)=>(1-a)*l+a*i;function f6(l,i){return 1/h6(l,1,i.tileZoom)}function p6(l,i,a,h){return l.translatePosMatrix(h||i.tileID.projMatrix,i,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const m6=l=>{const i=[];_6(l)&&i.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT");const a=l.paint.get("line-trim-offset");a[0]===0&&a[1]===0||i.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&i.push("RENDER_LINE_BORDER");const h=l.layout.get("line-join").constantOr("miter")==="none",d=!!l.paint.get("line-pattern").constantOr(1);return h&&d&&i.push("LINE_JOIN_NONE"),i};function _6(l){const i=l.paint.get("line-dasharray").value;return i.kind!=="constant"||i.value}let uS;const g6=()=>uS||(uS={layout:c6||(c6=new Kn({"line-cap":new jt(qe.layout_line["line-cap"]),"line-join":new jt(qe.layout_line["line-join"]),"line-miter-limit":new Mt(qe.layout_line["line-miter-limit"]),"line-round-limit":new Mt(qe.layout_line["line-round-limit"]),"line-sort-key":new jt(qe.layout_line["line-sort-key"]),"line-z-offset":new jt(qe.layout_line["line-z-offset"]),"line-elevation-reference":new Mt(qe.layout_line["line-elevation-reference"]),"line-cross-slope":new Mt(qe.layout_line["line-cross-slope"]),visibility:new Mt(qe.layout_line.visibility),"line-width-unit":new Mt(qe.layout_line["line-width-unit"])})),paint:u6||(u6=new Kn({"line-opacity":new jt(qe.paint_line["line-opacity"]),"line-color":new jt(qe.paint_line["line-color"]),"line-translate":new Mt(qe.paint_line["line-translate"]),"line-translate-anchor":new Mt(qe.paint_line["line-translate-anchor"]),"line-width":new jt(qe.paint_line["line-width"]),"line-gap-width":new jt(qe.paint_line["line-gap-width"]),"line-offset":new jt(qe.paint_line["line-offset"]),"line-blur":new jt(qe.paint_line["line-blur"]),"line-dasharray":new jt(qe.paint_line["line-dasharray"]),"line-pattern":new jt(qe.paint_line["line-pattern"]),"line-pattern-cross-fade":new Mt(qe.paint_line["line-pattern-cross-fade"]),"line-gradient":new of(qe.paint_line["line-gradient"]),"line-trim-offset":new Mt(qe.paint_line["line-trim-offset"]),"line-trim-fade-range":new Mt(qe.paint_line["line-trim-fade-range"]),"line-trim-color":new Mt(qe.paint_line["line-trim-color"]),"line-emissive-strength":new Mt(qe.paint_line["line-emissive-strength"]),"line-border-width":new jt(qe.paint_line["line-border-width"]),"line-border-color":new jt(qe.paint_line["line-border-color"]),"line-occlusion-opacity":new Mt(qe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"})}))},uS);class n$ extends jt{possiblyEvaluate(i,a){return a=new gn(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition,worldview:a.worldview}),super.possiblyEvaluate(i,a)}evaluate(i,a,h,d){return a=Object.assign({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(i,a,h,d)}}let fv;function y6(l,i){return i>0?i+2*l:l}const s$=xr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),o$=xr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),a$=xr([{name:"a_projected_pos",components:4,type:"Float32"}],4);xr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const l$=xr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),c$=xr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),u$=xr([{name:"a_texb",components:2,type:"Uint16"}]),h$=xr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),d$=xr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);xr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const v6=xr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),f$=xr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);xr([{name:"triangle",components:3,type:"Uint16"}]),xr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),xr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),xr([{type:"Float32",name:"offsetX"}]),xr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var co=24;function p$(l,i,a){return l.sections.forEach(h=>{h.text=function(d,_,g){const b=_.layout.get("text-transform").evaluate(g,{});return b==="uppercase"?d=d.toLocaleUpperCase():b==="lowercase"&&(d=d.toLocaleLowerCase()),vc.applyArabicShaping&&(d=vc.applyArabicShaping(d)),d}(h.text,i,a)}),l}const pv={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function m$(l){return l==="︶"||l==="﹈"||l==="︸"||l==="﹄"||l==="﹂"||l==="︾"||l==="︼"||l==="︺"||l==="︘"||l==="﹀"||l==="︐"||l==="︓"||l==="︔"||l==="｀"||l==="￣"||l==="︑"||l==="︒"}function _$(l){return l==="︵"||l==="﹇"||l==="︷"||l==="﹃"||l==="﹁"||l==="︽"||l==="︻"||l==="︹"||l==="︗"||l==="︿"}const hS=4294967296,x6=1/hS,b6=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let sw=class{constructor(l=new Uint8Array(16)){this.buf=ArrayBuffer.isView(l)?l:new Uint8Array(l),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(l,i,a=this.length){for(;this.pos<a;){const h=this.readVarint(),d=h>>3,_=this.pos;this.type=7&h,l(d,i,this),this.pos===_&&this.skip(h)}return i}readMessage(l,i){return this.readFields(l,i,this.readVarint()+this.pos)}readFixed32(){const l=this.dataView.getUint32(this.pos,!0);return this.pos+=4,l}readSFixed32(){const l=this.dataView.getInt32(this.pos,!0);return this.pos+=4,l}readFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*hS;return this.pos+=8,l}readSFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*hS;return this.pos+=8,l}readFloat(){const l=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,l}readDouble(){const l=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,l}readVarint(l){const i=this.buf;let a,h;return h=i[this.pos++],a=127&h,h<128?a:(h=i[this.pos++],a|=(127&h)<<7,h<128?a:(h=i[this.pos++],a|=(127&h)<<14,h<128?a:(h=i[this.pos++],a|=(127&h)<<21,h<128?a:(h=i[this.pos],a|=(15&h)<<28,function(d,_,g){const b=g.buf;let T,S;if(S=b[g.pos++],T=(112&S)>>4,S<128||(S=b[g.pos++],T|=(127&S)<<3,S<128)||(S=b[g.pos++],T|=(127&S)<<10,S<128)||(S=b[g.pos++],T|=(127&S)<<17,S<128)||(S=b[g.pos++],T|=(127&S)<<24,S<128)||(S=b[g.pos++],T|=(1&S)<<31,S<128))return ag(d,T,_);throw new Error("Expected varint not more than 10 bytes")}(a,l,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const l=this.readVarint();return l%2==1?(l+1)/-2:l/2}readBoolean(){return!!this.readVarint()}readString(){const l=this.readVarint()+this.pos,i=this.pos;return this.pos=l,l-i>=12&&b6?b6.decode(this.buf.subarray(i,l)):function(a,h,d){let _="",g=h;for(;g<d;){const b=a[g];let T,S,P,M=null,L=b>239?4:b>223?3:b>191?2:1;if(g+L>d)break;L===1?b<128&&(M=b):L===2?(T=a[g+1],(192&T)==128&&(M=(31&b)<<6|63&T,M<=127&&(M=null))):L===3?(T=a[g+1],S=a[g+2],(192&T)==128&&(192&S)==128&&(M=(15&b)<<12|(63&T)<<6|63&S,(M<=2047||M>=55296&&M<=57343)&&(M=null))):L===4&&(T=a[g+1],S=a[g+2],P=a[g+3],(192&T)==128&&(192&S)==128&&(192&P)==128&&(M=(15&b)<<18|(63&T)<<12|(63&S)<<6|63&P,(M<=65535||M>=1114112)&&(M=null))),M===null?(M=65533,L=1):M>65535&&(M-=65536,_+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),_+=String.fromCharCode(M),g+=L}return _}(this.buf,i,l)}readBytes(){const l=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,l);return this.pos=l,i}readPackedVarint(l=[],i){const a=this.readPackedEnd();for(;this.pos<a;)l.push(this.readVarint(i));return l}readPackedSVarint(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readSVarint());return l}readPackedBoolean(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readBoolean());return l}readPackedFloat(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readFloat());return l}readPackedDouble(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readDouble());return l}readPackedFixed32(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readFixed32());return l}readPackedSFixed32(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readSFixed32());return l}readPackedFixed64(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readFixed64());return l}readPackedSFixed64(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readSFixed64());return l}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(l){const i=7&l;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(l,i){this.writeVarint(l<<3|i)}realloc(l){let i=this.length||16;for(;i<this.pos+l;)i*=2;if(i!==this.length){const a=new Uint8Array(i);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeSFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*x6),!0),this.pos+=8}writeSFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*x6),!0),this.pos+=8}writeVarint(l){(l=+l||0)>268435455||l<0?function(i,a){let h,d;if(i>=0?(h=i%4294967296|0,d=i/4294967296|0):(h=~(-i%4294967296),d=~(-i/4294967296),4294967295^h?h=h+1|0:(h=0,d=d+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(_,g,b){b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,b.buf[b.pos]=127&(_>>>=7)}(h,0,a),function(_,g){const b=(7&_)<<4;g.buf[g.pos++]|=b|((_>>>=3)?128:0),_&&(g.buf[g.pos++]=127&_|((_>>>=7)?128:0),_&&(g.buf[g.pos++]=127&_|((_>>>=7)?128:0),_&&(g.buf[g.pos++]=127&_|((_>>>=7)?128:0),_&&(g.buf[g.pos++]=127&_|((_>>>=7)?128:0),_&&(g.buf[g.pos++]=127&_)))))}(d,a)}(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))}writeSVarint(l){this.writeVarint(l<0?2*-l-1:2*l)}writeBoolean(l){this.writeVarint(+l)}writeString(l){l=String(l),this.realloc(4*l.length),this.pos++;const i=this.pos;this.pos=function(h,d,_){for(let g,b,T=0;T<d.length;T++){if(g=d.charCodeAt(T),g>55295&&g<57344){if(!b){g>56319||T+1===d.length?(h[_++]=239,h[_++]=191,h[_++]=189):b=g;continue}if(g<56320){h[_++]=239,h[_++]=191,h[_++]=189,b=g;continue}g=b-55296<<10|g-56320|65536,b=null}else b&&(h[_++]=239,h[_++]=191,h[_++]=189,b=null);g<128?h[_++]=g:(g<2048?h[_++]=g>>6|192:(g<65536?h[_++]=g>>12|224:(h[_++]=g>>18|240,h[_++]=g>>12&63|128),h[_++]=g>>6&63|128),h[_++]=63&g|128)}return _}(this.buf,l,this.pos);const a=this.pos-i;a>=128&&w6(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a}writeFloat(l){this.realloc(4),this.dataView.setFloat32(this.pos,l,!0),this.pos+=4}writeDouble(l){this.realloc(8),this.dataView.setFloat64(this.pos,l,!0),this.pos+=8}writeBytes(l){const i=l.length;this.writeVarint(i),this.realloc(i);for(let a=0;a<i;a++)this.buf[this.pos++]=l[a]}writeRawMessage(l,i){this.pos++;const a=this.pos;l(i,this);const h=this.pos-a;h>=128&&w6(a,h,this),this.pos=a-1,this.writeVarint(h),this.pos+=h}writeMessage(l,i,a){this.writeTag(l,2),this.writeRawMessage(i,a)}writePackedVarint(l,i){i.length&&this.writeMessage(l,g$,i)}writePackedSVarint(l,i){i.length&&this.writeMessage(l,y$,i)}writePackedBoolean(l,i){i.length&&this.writeMessage(l,b$,i)}writePackedFloat(l,i){i.length&&this.writeMessage(l,v$,i)}writePackedDouble(l,i){i.length&&this.writeMessage(l,x$,i)}writePackedFixed32(l,i){i.length&&this.writeMessage(l,w$,i)}writePackedSFixed32(l,i){i.length&&this.writeMessage(l,T$,i)}writePackedFixed64(l,i){i.length&&this.writeMessage(l,E$,i)}writePackedSFixed64(l,i){i.length&&this.writeMessage(l,I$,i)}writeBytesField(l,i){this.writeTag(l,2),this.writeBytes(i)}writeFixed32Field(l,i){this.writeTag(l,5),this.writeFixed32(i)}writeSFixed32Field(l,i){this.writeTag(l,5),this.writeSFixed32(i)}writeFixed64Field(l,i){this.writeTag(l,1),this.writeFixed64(i)}writeSFixed64Field(l,i){this.writeTag(l,1),this.writeSFixed64(i)}writeVarintField(l,i){this.writeTag(l,0),this.writeVarint(i)}writeSVarintField(l,i){this.writeTag(l,0),this.writeSVarint(i)}writeStringField(l,i){this.writeTag(l,2),this.writeString(i)}writeFloatField(l,i){this.writeTag(l,5),this.writeFloat(i)}writeDoubleField(l,i){this.writeTag(l,1),this.writeDouble(i)}writeBooleanField(l,i){this.writeVarintField(l,+i)}};function ag(l,i,a){return a?4294967296*i+(l>>>0):4294967296*(i>>>0)+(l>>>0)}function w6(l,i,a){const h=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));a.realloc(h);for(let d=a.pos-1;d>=l;d--)a.buf[d+h]=a.buf[d]}function g$(l,i){for(let a=0;a<l.length;a++)i.writeVarint(l[a])}function y$(l,i){for(let a=0;a<l.length;a++)i.writeSVarint(l[a])}function v$(l,i){for(let a=0;a<l.length;a++)i.writeFloat(l[a])}function x$(l,i){for(let a=0;a<l.length;a++)i.writeDouble(l[a])}function b$(l,i){for(let a=0;a<l.length;a++)i.writeBoolean(l[a])}function w$(l,i){for(let a=0;a<l.length;a++)i.writeFixed32(l[a])}function T$(l,i){for(let a=0;a<l.length;a++)i.writeSFixed32(l[a])}function E$(l,i){for(let a=0;a<l.length;a++)i.writeFixed64(l[a])}function I$(l,i){for(let a=0;a<l.length;a++)i.writeSFixed64(l[a])}const dS=3;function S$(l,i,a){i.glyphs=[],l===1&&a.readMessage(A$,i)}function A$(l,i,a){if(l===3){const{id:h,bitmap:d,width:_,height:g,left:b,top:T,advance:S}=a.readMessage(C$,{});i.glyphs.push({id:h,bitmap:new yf({width:_+2*dS,height:g+2*dS},d),metrics:{width:_,height:g,left:b,top:T,advance:S}})}else l===4?i.ascender=a.readSVarint():l===5&&(i.descender=a.readSVarint())}function C$(l,i,a){l===1?i.id=a.readVarint():l===2?i.bitmap=a.readBytes():l===3?i.width=a.readVarint():l===4?i.height=a.readVarint():l===5?i.left=a.readSVarint():l===6?i.top=a.readSVarint():l===7&&(i.advance=a.readVarint())}const T6=dS,sl={horizontal:1,vertical:2,horizontalOnly:3};class mv{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(i,a){const h=new mv;return h.scale=i||1,h.fontStack=a,h}static forImage(i){const a=new mv;return a.image=i,a}}class lg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,a,h){const d=new lg;for(let _=0;_<i.sections.length;_++){const g=i.sections[_];g.image?d.addImageSection(g,h):d.addTextSection(g,a)}return d}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCodePoint(i){return this.text.codePointAt(i)}verticalizePunctuation(i){this.text=function(a,h){let d="";for(let _=0;_<a.length;_++){const g=a.charCodeAt(_+1)||null,b=a.charCodeAt(_-1)||null;d+=!h&&(g&&O_(g)&&!pv[a[_+1]]||b&&O_(b)&&!pv[a[_-1]])||!pv[a[_]]?a[_]:pv[a[_]]}return d}(this.text,i)}trim(){let i=0;for(let h=0;h<this.text.length&&ow[this.text.charCodeAt(h)];h++)i++;let a=this.text.length;for(let h=this.text.length-1;h>=0&&h>=i&&ow[this.text.charCodeAt(h)];h--)a--;this.text=this.text.substring(i,a),this.sectionIndex=this.sectionIndex.slice(i,a)}substring(i,a){const h=new lg;return h.text=this.text.substring(i,a),h.sectionIndex=this.sectionIndex.slice(i,a),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,a)=>Math.max(i,this.sections[a].scale),0)}addTextSection(i,a){this.text+=i.text,this.sections.push(mv.forText(i.scale,i.fontStack||a));const h=this.sections.length-1;for(let d=0;d<i.text.length;++d)this.sectionIndex.push(h)}addImageSection(i,a){const h=i.image?i.image.getPrimary():null;if(!h)return void Ji("Can't add FormattedSection with an empty image.");h.scaleSelf(a);const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(mv.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Ji("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function fS(l,i,a,h,d,_,g,b,T,S,P,M,L,N,B,W=1){const X=lg.fromFeature(l,d,W);M===sl.vertical&&X.verticalizePunctuation(L);let Z=[];const ne=function(Re,Ne,je,ft,We,mt){if(!Re)return[];const St=[],gt=function(Tt,rt,et,Pt,At,mi){let qt=0;for(let si=0;si<Tt.length();si++){const Ot=Tt.getSection(si);qt+=E6(Tt.getCodePoint(si),Ot,Pt,At,rt,mi)}return qt/Math.max(1,Math.ceil(qt/et))}(Re,Ne,je,ft,We,mt),wt=Re.text.indexOf("​")>=0;let Rt=0;for(let Tt=0;Tt<Re.length();Tt++){const rt=Re.getSection(Tt),et=Re.getCodePoint(Tt);if(ow[et]||(Rt+=E6(et,rt,ft,We,Ne,mt)),Tt<Re.length()-1){const Pt=!((ut=et)<11904||!(ki["Bopomofo Extended"](ut)||ki.Bopomofo(ut)||ki["CJK Compatibility Forms"](ut)||ki["CJK Compatibility Ideographs"](ut)||ki["CJK Compatibility"](ut)||ki["CJK Radicals Supplement"](ut)||ki["CJK Strokes"](ut)||ki["CJK Symbols and Punctuation"](ut)||ki["CJK Unified Ideographs Extension A"](ut)||ki["CJK Unified Ideographs"](ut)||ki["Enclosed CJK Letters and Months"](ut)||ki["Halfwidth and Fullwidth Forms"](ut)||ki.Hiragana(ut)||ki["Ideographic Description Characters"](ut)||ki["Kangxi Radicals"](ut)||ki["Katakana Phonetic Extensions"](ut)||ki.Katakana(ut)||ki["Vertical Forms"](ut)||ki["Yi Radicals"](ut)||ki["Yi Syllables"](ut)));(R$[et]||Pt||rt.image)&&St.push(S6(Tt+1,Rt,gt,St,P$(et,Re.getCodePoint(Tt+1),Pt&&wt),!1))}}var ut;return A6(S6(Re.length(),Rt,gt,St,0,!0))}(X,S,_,i,h,N),{processBidirectionalText:se,processStyledBidirectionalText:le}=vc;if(se&&X.sections.length===1){const Re=se(X.toString(),ne);for(const Ne of Re){const je=new lg;je.text=Ne,je.sections=X.sections;for(let ft=0;ft<Ne.length;ft++)je.sectionIndex.push(0);Z.push(je)}}else if(le){const Re=le(X.text,X.sectionIndex,ne);for(const Ne of Re){const je=new lg;je.text=Ne[0],je.sectionIndex=Ne[1],je.sections=X.sections,Z.push(je)}}else Z=function(Re,Ne){const je=[],ft=Re.text;let We=0;for(const mt of Ne)je.push(Re.substring(We,mt)),We=mt;return We<ft.length&&je.push(Re.substring(We,ft.length)),je}(X,ne);const Ee=[],Ie={positionedLines:Ee,text:X.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Re,Ne,je,ft,We,mt,St,gt,wt,Rt,ut,Tt){let rt=0,et=0,Pt=0;const At=gt==="right"?1:gt==="left"?0:.5;let mi=!1;for(const Ut of We){const ci=Ut.getSections();for(const Li of ci){if(Li.image)continue;const Hi=Ne[Li.fontStack];if(Hi&&(mi=Hi.ascender!==void 0&&Hi.descender!==void 0,!mi))break}if(!mi)break}let qt=0;for(const Ut of We){Ut.trim();const ci=Ut.getMaxScale(),Li=(ci-1)*co,Hi={positionedGlyphs:[],lineOffset:0};Re.positionedLines[qt]=Hi;const or=Hi.positionedGlyphs;let Zi=0;if(!Ut.length()){et+=mt,++qt;continue}let ei=0,qi=0;for(let ue=0;ue<Ut.length();ue++){const he=Ut.getSection(ue),it=Ut.getSectionIndex(ue),dt=Ut.getCodePoint(ue);let Vt=he.scale,Bt=null,Yt=null,gi=null,ar=co,lr=0,rr=wt;rr===sl.vertical&&((si=dt)===12312||si===12313||si===12316||si===12540||si===12448)&&(rr=sl.horizontal);const Yr=!(rr===sl.horizontal||!ut&&!L_(dt)||ut&&(ow[dt]||pI(dt)));if(he.image){const On=ft.get(he.image.toString());if(!On)continue;gi=he.image,Re.iconsInText=Re.iconsInText||!0,Yt=On.paddedRect;const tr=On.displaySize;Vt=Vt*co/Tt,Bt={width:tr[0],height:tr[1],left:0,top:-T6,advance:Yr?tr[1]:tr[0],localGlyph:!1},lr=mi?-Bt.height*Vt:ci*co-17-tr[1]*Vt,ar=Bt.advance;const yn=(Yr?tr[0]:tr[1])*Vt-co*ci;yn>0&&yn>Zi&&(Zi=yn)}else{const On=je[he.fontStack];if(!On)continue;On[dt]&&(Yt=On[dt]);const tr=Ne[he.fontStack];if(!tr)continue;const yn=tr.glyphs[dt];if(!yn)continue;if(Bt=yn.metrics,ar=dt!==8203?co:0,mi){const rn=tr.ascender!==void 0?Math.abs(tr.ascender):0,Nr=tr.descender!==void 0?Math.abs(tr.descender):0,bn=(rn+Nr)*Vt;ei<bn&&(ei=bn,qi=(rn-Nr)/2*Vt),lr=-rn*Vt}else lr=(ci-Vt)*co-17}Yr?(Re.verticalizable=!0,or.push({glyph:dt,image:gi,x:rt,y:et+lr,vertical:Yr,scale:Vt,localGlyph:Bt.localGlyph,fontStack:he.fontStack,sectionIndex:it,metrics:Bt,rect:Yt}),rt+=ar*Vt+Rt):(or.push({glyph:dt,image:gi,x:rt,y:et+lr,vertical:Yr,scale:Vt,localGlyph:Bt.localGlyph,fontStack:he.fontStack,sectionIndex:it,metrics:Bt,rect:Yt}),rt+=Bt.advance*Vt+Rt)}or.length!==0&&(Pt=Math.max(rt-Rt,Pt),mi?C6(or,At,Zi,qi,mt*ci/2):C6(or,At,Zi,0,mt/2)),rt=0;const Ir=mt*ci+Zi;Hi.lineOffset=Math.max(Zi,Li),et+=Ir,++qt}var si;const Ot=et,{horizontalAlign:pi,verticalAlign:Ui}=pS(St);(function(Ut,ci,Li,Hi,or,Zi){const ei=(ci-Li)*or,qi=-Zi*Hi;for(const Ir of Ut)for(const ue of Ir.positionedGlyphs)ue.x+=ei,ue.y+=qi})(Re.positionedLines,At,pi,Ui,Pt,Ot),Re.top+=-Ui*Ot,Re.bottom=Re.top+Ot,Re.left+=-pi*Pt,Re.right=Re.left+Pt,Re.hasBaseline=mi}(Ie,i,a,h,Z,g,b,T,M,S,L,B),!function(Re){for(const Ne of Re)if(Ne.positionedGlyphs.length!==0)return!1;return!0}(Ee))return Ie}const ow={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},R$={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function E6(l,i,a,h,d,_){if(i.image){const g=h.get(i.image.toString());return g?g.displaySize[0]*i.scale*co/_+d:0}{const g=a[i.fontStack],b=g&&g.glyphs[l];return b?b.metrics.advance*i.scale+d:0}}function I6(l,i,a,h){const d=Math.pow(l-i,2);return h?l<i?d/2:2*d:d+Math.abs(a)*a}function P$(l,i,a){let h=0;return l===10&&(h-=1e4),a&&(h+=150),l!==40&&l!==65288||(h+=50),i!==41&&i!==65289||(h+=50),h}function S6(l,i,a,h,d,_){let g=null,b=I6(i,a,d,_);for(const T of h){const S=I6(i-T.x,a,d,_)+T.badness;S<=b&&(g=T,b=S)}return{index:l,x:i,priorBreak:g,badness:b}}function A6(l){return l?A6(l.priorBreak).concat(l.index):[]}function pS(l){let i=.5,a=.5;switch(l){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:i,verticalAlign:a}}function C6(l,i,a,h,d){if(!(i||a||h||d))return;const _=l.length-1,g=l[_],b=(g.x+g.metrics.advance*g.scale)*i;for(let T=0;T<=_;T++)l[T].x-=b,l[T].y+=a+h+d}function R6(l){return l.imagePrimary!==void 0&&l.top!==void 0&&l.bottom!==void 0&&l.left!==void 0&&l.right!==void 0}function M$(l,i,a,h){const{horizontalAlign:d,verticalAlign:_}=pS(h),g=a[0]-l.displaySize[0]*d,b=a[1]-l.displaySize[1]*_;return{imagePrimary:l,imageSecondary:i,top:b,bottom:b+l.displaySize[1],left:g,right:g+l.displaySize[0]}}function P6(l,i,a,h,d,_){const g=l.imagePrimary;let b;if(g.content){const X=g.content,Z=g.pixelRatio||1;b=[X[0]/Z,X[1]/Z,g.displaySize[0]-X[2]/Z,g.displaySize[1]-X[3]/Z]}const T=i.left*_,S=i.right*_;let P,M,L,N;a==="width"||a==="both"?(N=d[0]+T-h[3],M=d[0]+S+h[1]):(N=d[0]+(T+S-g.displaySize[0])/2,M=N+g.displaySize[0]);const B=i.top*_,W=i.bottom*_;return a==="height"||a==="both"?(P=d[1]+B-h[0],L=d[1]+W+h[2]):(P=d[1]+(B+W-g.displaySize[1])/2,L=P+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:P,right:M,bottom:L,left:N,collisionPadding:b}}function M6(l){return!l.imagePrimary.stretchX}function k6(l){return!l.imagePrimary.stretchY}function D6(l){return{width:l.right-l.left,height:l.bottom-l.top}}const Xu=128;function L6(l,i,a){const{expression:h}=i;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new gn(l+1,{worldview:a}))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:_}=h;let g=0;for(;g<d.length&&d[g]<=l;)g++;g=Math.max(0,g-1);let b=g;for(;b<d.length&&d[b]<l+1;)b++;b=Math.min(d.length-1,b);const T=d[g],S=d[b];return h.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:S,interpolationType:_}:{kind:"camera",minZoom:T,maxZoom:S,minSize:h.evaluate(new gn(T,{worldview:a})),maxSize:h.evaluate(new gn(S,{worldview:a})),interpolationType:_}}}function mS(l,{uSize:i,uSizeT:a},{lowerSize:h,upperSize:d}){return l.kind==="source"?h/Xu:l.kind==="composite"?Ri(h/Xu,d/Xu,a):i}function _v(l,i,a=1){let h=0,d=0;if(l.kind==="constant")d=l.layoutSize*a;else if(l.kind!=="source"){const{interpolationType:_,minZoom:g,maxZoom:b}=l,T=_?fe(el.interpolationFactor(_,i,g,b),0,1):0;l.kind==="camera"?d=Ri(l.minSize,l.maxSize,T)*a:h=T*a}return{uSizeT:h,uSize:d}}class rd extends xt{constructor(i,a,h,d,_){super(i,a),this.angle=d,this.z=h,_!==void 0&&(this.segment=_)}clone(){return new rd(this.x,this.y,this.z,this.angle,this.segment)}}function O6(l,i,a,h,d){if(i.segment===void 0)return!0;let _=i,g=i.segment+1,b=0;for(;b>-a/2;){if(g--,g<0)return!1;b-=l[g].dist(_),_=l[g]}b+=l[g].dist(l[g+1]),g++;const T=[];let S=0;for(;b<a/2;){const P=l[g],M=l[g+1];if(!M)return!1;let L=l[g-1].angleTo(P)-P.angleTo(M);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:L}),S+=L;b-T[0].distance>h;)S-=T.shift().angleDelta;if(S>d)return!1;g++,b+=P.dist(M)}return!0}function F6(l){let i=0;for(let a=0;a<l.length-1;a++)i+=l[a].dist(l[a+1]);return i}function z6(l,i,a){return l?.6*i*a:0}function N6(l,i){return Math.max(l?l.right-l.left:0,i?i.right-i.left:0)}function k$(l,i,a,h,d,_){const g=z6(a,d,_),b=N6(a,h)*_;let T=0;const S=F6(l)/2;for(let P=0;P<l.length-1;P++){const M=l[P],L=l[P+1],N=M.dist(L);if(T+N>S){const B=(S-T)/N,W=Ri(M.x,L.x,B),X=Ri(M.y,L.y,B),Z=new rd(W,X,0,L.angleTo(M),P);return!g||O6(l,Z,b,g,i)?Z:void 0}T+=N}}function D$(l,i,a,h,d,_,g,b,T){const S=z6(h,_,g),P=N6(h,d),M=P*g,L=l[0].x===0||l[0].x===T||l[0].y===0||l[0].y===T;return i-M<i/4&&(i=M+i/4),B6(l,L?i/2*b%i:(P/2+2*_)*g*b%i,i,S,a,M,L,!1,T)}function B6(l,i,a,h,d,_,g,b,T){const S=_/2,P=F6(l);let M=0,L=i-a,N=[];for(let B=0;B<l.length-1;B++){const W=l[B],X=l[B+1],Z=W.dist(X),ne=X.angleTo(W);for(;L+a<M+Z;){L+=a;const se=(L-M)/Z,le=Ri(W.x,X.x,se),Ee=Ri(W.y,X.y,se);if(le>=0&&le<T&&Ee>=0&&Ee<T&&L-S>=0&&L+S<=P){const Ie=new rd(le,Ee,0,ne,B);h&&!O6(l,Ie,_,h,d)||N.push(Ie)}}M+=Z}return b||N.length||g||(N=B6(l,M/2,a,h,d,_,g,!0,T)),N}function V6(l){let i=0,a=0;for(const g of l)i+=g.w*g.h,a=Math.max(a,g.w);l.sort((g,b)=>b.h-g.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),a),h:1/0}];let d=0,_=0;for(const g of l)for(let b=h.length-1;b>=0;b--){const T=h[b];if(!(g.w>T.w||g.h>T.h)){if(g.x=T.x,g.y=T.y,_=Math.max(_,g.y+g.h),d=Math.max(d,g.x+g.w),g.w===T.w&&g.h===T.h){const S=h.pop();S&&b<h.length&&(h[b]=S)}else g.h===T.h?(T.x+=g.w,T.w-=g.w):g.w===T.w?(T.y+=g.h,T.h-=g.h):(h.push({x:T.x+g.w,y:T.y,w:T.w-g.w,h:g.h}),T.y+=g.h,T.h-=g.h);break}}return{w:d,h:_,fill:i/(d*_)||0}}Zt(rd,"Anchor");const Wp=1;class gv{static getImagePositionScale(i,a,h){if(a&&i&&i.options&&i.options.transform){const d=i.options.transform;return{x:d.a,y:d.d}}return{x:h,y:h}}constructor(i,a,h,d){this.paddedRect=i;const{pixelRatio:_,version:g,stretchX:b,stretchY:T,content:S,sdf:P,usvg:M}=a;this.pixelRatio=_,this.stretchX=b,this.stretchY=T,this.content=S,this.version=g,this.padding=h,this.sdf=P,this.usvg=M,this.scale=gv.getImagePositionScale(d,M,_)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function _S(l,i,a){const h=zt.parse(l),d=function(_,g,b=[1,1]){return{x:0,y:0,w:(_.data?_.data.width:_.width*b[0])+2*g,h:(_.data?_.data.height:_.height*b[1])+2*g}}(i,a,[h.options.transform.a,h.options.transform.d]);return{bin:d,imagePosition:new gv(d,i,a,h),imageVariant:h}}class U6{constructor(i,a,h){const d=new Map,_=new Map;this.haveRenderCallbacks=[];const g=[];this.addImages(i,d,Wp,g),this.addImages(a,_,2,g);const{w:b,h:T}=V6(g),S=new To({width:b||1,height:T||1});for(const[P,M]of i.entries()){const L=d.get(P).paddedRect;To.copy(M.data,S,{x:0,y:0},{x:L.x+Wp,y:L.y+Wp},M.data,null,M.sdf)}for(const[P,M]of a.entries()){const L=_.get(P),N=L.paddedRect;let B=L.padding;const W=N.x+B,X=N.y+B,Z=M.data.width,ne=M.data.height;B=B>1?B-1:B,To.copy(M.data,S,{x:0,y:0},{x:W,y:X},M.data,h),To.copy(M.data,S,{x:0,y:ne-B},{x:W,y:X-B},{width:Z,height:B},h),To.copy(M.data,S,{x:0,y:0},{x:W,y:X+ne},{width:Z,height:B},h),To.copy(M.data,S,{x:Z-B,y:0},{x:W-B,y:X},{width:B,height:ne},h),To.copy(M.data,S,{x:0,y:0},{x:W+Z,y:X},{width:B,height:ne},h),To.copy(M.data,S,{x:Z-B,y:ne-B},{x:W-B,y:X-B},{width:B,height:B},h),To.copy(M.data,S,{x:0,y:ne-B},{x:W+Z,y:X-B},{width:B,height:B},h),To.copy(M.data,S,{x:0,y:0},{x:W+Z,y:X+ne},{width:B,height:B},h),To.copy(M.data,S,{x:Z-B,y:0},{x:W-B,y:X+ne},{width:B,height:B},h)}this.lut=h,this.image=S,this.iconPositions=d,this.patternPositions=_}addImages(i,a,h,d){for(const[_,g]of i.entries()){const{bin:b,imagePosition:T,imageVariant:S}=_S(_,g,h);a.set(_,T),d.push(b),g.hasRenderCallback&&this.haveRenderCallbacks.push(S.id)}}patchUpdatedImages(i,a,h){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(d=>i.hasImage(d,h)),i.dispatchRenderCallbacks(this.haveRenderCallbacks,h);for(const d of i.getUpdatedImages(h)){for(const _ of this.iconPositions.keys()){const g=zt.parse(_);if(la.isEqual(g.id,d)){const b=i.getImage(d,h);this.patchUpdatedImage(this.iconPositions.get(_),b,a,null)}}for(const _ of this.patternPositions.keys()){const g=zt.parse(_);if(la.isEqual(g.id,d)){const b=i.getImage(d,h);this.patchUpdatedImage(this.patternPositions.get(_),b,a,this.lut)}}}}patchUpdatedImage(i,a,h,d=null){if(!i||!a||i.version===a.version)return;i.version=a.version;const[_,g]=i.tl,b=i.sdf;if(this.lut||b){const T={width:a.data.width,height:a.data.height},S=new To(T);To.copy(a.data,S,{x:0,y:0},{x:0,y:0},T,d,b),h.update(S,{position:{x:_,y:g}})}else h.update(a.data,{position:{x:_,y:g}})}}Zt(gv,"ImagePosition"),Zt(U6,"ImageAtlas");const yv=1e20;function j6(l,i,a,h,d,_,g,b,T){for(let S=i;S<i+h;S++)$6(l,a*_+S,_,d,g,b,T);for(let S=a;S<a+d;S++)$6(l,S*_+i,1,h,g,b,T)}function $6(l,i,a,h,d,_,g){_[0]=0,g[0]=-yv,g[1]=yv,d[0]=l[i];for(let b=1,T=0,S=0;b<h;b++){d[b]=l[i+b*a];const P=b*b;do{const M=_[T];S=(d[b]-d[M]+P-M*M)/(b-M)/2}while(S<=g[T]&&--T>-1);T++,_[T]=b,g[T]=S,g[T+1]=yv}for(let b=0,T=0;b<h;b++){for(;g[T+1]<b;)T++;const S=_[T],P=b-S;l[i+b*a]=d[S]+P*P}}const ru=2,gS={none:0,ideographs:1,all:2};class cg{constructor(i,a,h){this.requestManager=i,this.localGlyphMode=a,this.localFontFamily=h,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,a){const h=[],d=this.url||io.GLYPHS_URL;for(const _ in i)for(const g of i[_])h.push({stack:_,id:g});Ze(h,({stack:_,id:g},b)=>{let T=this.entries[_];T||(T=this.entries[_]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let S=T.glyphs[g];if(S!==void 0)return void b(null,{stack:_,id:g,glyph:S});if(S=this._tinySDF(T,_,g),S)return T.glyphs[g]=S,void b(null,{stack:_,id:g,glyph:S});const P=Math.floor(g/256);if(256*P>65535)return Ji("glyphs > 65535 not supported"),void b(null,{stack:_,id:g,glyph:S});if(T.ranges[P])return void b(null,{stack:_,id:g,glyph:S});let M=T.requests[P];M||(M=T.requests[P]=[],cg.loadGlyphRange(_,P,d,this.requestManager,(L,N)=>{if(N){T.ascender=N.ascender,T.descender=N.descender;for(const B in N.glyphs)this._doesCharSupportLocalGlyph(+B)||(T.glyphs[+B]=N.glyphs[+B]);T.ranges[P]=!0}for(const B of M)B(L,N);delete T.requests[P]})),M.push((L,N)=>{L?b(L):N&&b(null,{stack:_,id:g,glyph:N.glyphs[g]||null})})},(_,g)=>{if(_)a(_);else if(g){const b={};for(const{stack:T,id:S,glyph:P}of g)b[T]===void 0&&(b[T]={}),b[T].glyphs===void 0&&(b[T].glyphs={}),b[T].glyphs[S]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},b[T].ascender=this.entries[T].ascender,b[T].descender=this.entries[T].descender;a(null,b)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==gS.none&&(this.localGlyphMode===gS.all?!!this.localFontFamily:!!this.localFontFamily&&(ki["CJK Unified Ideographs"](i)||ki["Hangul Syllables"](i)||ki.Hiragana(i)||ki.Katakana(i)||ki["CJK Symbols and Punctuation"](i)||ki["CJK Unified Ideographs Extension A"](i)||ki["CJK Unified Ideographs Extension B"](i)||ki.Osage(i)))}_tinySDF(i,a,h){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(h))return;let _=i.tinySDF;if(!_){let W="400";/bold/i.test(a)?W="900":/medium/i.test(a)?W="500":/light/i.test(a)&&(W="200"),_=i.tinySDF=new cg.TinySDF({fontFamily:d,fontWeight:W,fontSize:24*ru,buffer:3*ru,radius:8*ru}),_.fontWeight=W}if(this.localGlyphs[_.fontWeight][h])return this.localGlyphs[_.fontWeight][h];const g=String.fromCodePoint(h),{data:b,width:T,height:S,glyphWidth:P,glyphHeight:M,glyphLeft:L,glyphTop:N,glyphAdvance:B}=_.draw(g);return this.localGlyphs[_.fontWeight][h]={id:h,bitmap:new yf({width:T,height:S},b),metrics:{width:P/ru,height:M/ru,left:L/ru,top:N/ru-27,advance:B/ru,localGlyph:!0}}}}cg.loadGlyphRange=function(l,i,a,h,d){const _=256*i,g=_+255,b=h.transformRequest(h.normalizeGlyphsURL(a).replace("{fontstack}",l).replace("{range}",`${_}-${g}`),Bd.Glyphs);Iu(b,(T,S)=>{if(T)d(T);else if(S){const P={},M=function(L){return new sw(L).readFields(S$,{})}(S);for(const L of M.glyphs)P[L.id]=L;d(null,{glyphs:P,ascender:M.ascender,descender:M.descender})}})},cg.TinySDF=class{constructor({fontSize:l=24,buffer:i=3,radius:a=8,cutoff:h=.25,fontFamily:d="sans-serif",fontWeight:_="normal",fontStyle:g="normal",lang:b=null}={}){this.buffer=i,this.cutoff=h,this.radius=a,this.lang=b;const T=this.size=l+4*i,S=this._createCanvas(T),P=this.ctx=S.getContext("2d",{willReadFrequently:!0});P.font=`${g} ${_} ${l}px ${d}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(l){const i=document.createElement("canvas");return i.width=i.height=l,i}draw(l){const{width:i,actualBoundingBoxAscent:a,actualBoundingBoxDescent:h,actualBoundingBoxLeft:d,actualBoundingBoxRight:_}=this.ctx.measureText(l),g=Math.ceil(a),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-d))),T=Math.min(this.size-this.buffer,g+Math.ceil(h)),S=b+2*this.buffer,P=T+2*this.buffer,M=Math.max(S*P,0),L=new Uint8ClampedArray(M),N={data:L,width:S,height:P,glyphWidth:b,glyphHeight:T,glyphTop:g,glyphLeft:0,glyphAdvance:i};if(b===0||T===0)return N;const{ctx:B,buffer:W,gridInner:X,gridOuter:Z}=this;this.lang&&(B.lang=this.lang),B.clearRect(W,W,b,T),B.fillText(l,W,W+g);const ne=B.getImageData(W,W,b,T);Z.fill(yv,0,M),X.fill(0,0,M);for(let se=0;se<T;se++)for(let le=0;le<b;le++){const Ee=ne.data[4*(se*b+le)+3]/255;if(Ee===0)continue;const Ie=(se+W)*S+le+W;if(Ee===1)Z[Ie]=0,X[Ie]=yv;else{const Re=.5-Ee;Z[Ie]=Re>0?Re*Re:0,X[Ie]=Re<0?Re*Re:0}}j6(Z,0,0,S,P,S,this.f,this.v,this.z),j6(X,W,W,b,T,S,this.f,this.v,this.z);for(let se=0;se<M;se++){const le=Math.sqrt(Z[se])-Math.sqrt(X[se]);L[se]=Math.round(255-255*(le/this.radius+this.cutoff))}return N}};const bf=Wp;function G6(l,i){return l+i[1]-i[0]}function H6(l,i,a,h,d=1){const _=[],g=l.imagePrimary,b=g.pixelRatio,T=g.paddedRect.w-2*bf,S=g.paddedRect.h-2*bf,P=(l.right-l.left)*d,M=(l.bottom-l.top)*d,L=g.stretchX||[[0,T]],N=g.stretchY||[[0,S]],B=L.reduce(G6,0),W=N.reduce(G6,0),X=T-B,Z=S-W;let ne=0,se=B,le=0,Ee=W,Ie=0,Re=X,Ne=0,je=Z;if(g.content&&h){const We=g.content;ne=aw(L,0,We[0]),le=aw(N,0,We[1]),se=aw(L,We[0],We[2]),Ee=aw(N,We[1],We[3]),Ie=We[0]-ne,Ne=We[1]-le,Re=We[2]-We[0]-se,je=We[3]-We[1]-Ee}const ft=(We,mt,St,gt)=>{const wt=lw(We.stretch-ne,se,P,l.left*d),Rt=cw(We.fixed-Ie,Re,We.stretch,B),ut=lw(mt.stretch-le,Ee,M,l.top*d),Tt=cw(mt.fixed-Ne,je,mt.stretch,W),rt=lw(St.stretch-ne,se,P,l.left*d),et=cw(St.fixed-Ie,Re,St.stretch,B),Pt=lw(gt.stretch-le,Ee,M,l.top*d),At=cw(gt.fixed-Ne,je,gt.stretch,W),mi=new xt(wt,ut),qt=new xt(rt,ut),si=new xt(rt,Pt),Ot=new xt(wt,Pt),pi=new xt(Rt/b,Tt/b),Ui=new xt(et/b,At/b),Ut=i*Math.PI/180;if(Ut){const ei=Math.sin(Ut),qi=Math.cos(Ut),Ir=[qi,-ei,ei,qi];mi._matMult(Ir),qt._matMult(Ir),Ot._matMult(Ir),si._matMult(Ir)}const ci=We.stretch+We.fixed,Li=St.stretch+St.fixed,Hi=mt.stretch+mt.fixed,or=gt.stretch+gt.fixed,Zi=l.imageSecondary;return{tl:mi,tr:qt,bl:Ot,br:si,texPrimary:{x:g.paddedRect.x+bf+ci,y:g.paddedRect.y+bf+Hi,w:Li-ci,h:or-Hi},texSecondary:Zi?{x:Zi.paddedRect.x+bf+ci,y:Zi.paddedRect.y+bf+Hi,w:Li-ci,h:or-Hi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:pi,pixelOffsetBR:Ui,minFontScaleX:Re/b/P,minFontScaleY:je/b/M,isSDF:a}};if(h&&(g.stretchX||g.stretchY)){const We=q6(L,X,B),mt=q6(N,Z,W);for(let St=0;St<We.length-1;St++){const gt=We[St],wt=We[St+1];for(let Rt=0;Rt<mt.length-1;Rt++)_.push(ft(gt,mt[Rt],wt,mt[Rt+1]))}}else _.push(ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:S+1}));return _}function aw(l,i,a){let h=0;for(const d of l)h+=Math.max(i,Math.min(a,d[1]))-Math.max(i,Math.min(a,d[0]));return h}function q6(l,i,a){const h=[{fixed:-bf,stretch:0}];for(const[d,_]of l){const g=h[h.length-1];h.push({fixed:d-g.stretch,stretch:g.stretch}),h.push({fixed:d-g.stretch,stretch:g.stretch+(_-d)})}return h.push({fixed:i+bf,stretch:a}),h}function lw(l,i,a,h){return l/i*a+h}function cw(l,i,a,h){return l-i*a/h}function L$(l,i,a,h){const d=i+l.positionedLines[h].lineOffset;return h===0?a+d/2:a+(d+(i+l.positionedLines[h-1].lineOffset))/2}function O$(l,i=1,a=!1){let h=1/0,d=1/0,_=-1/0,g=-1/0;const b=l[0];for(let N=0;N<b.length;N++){const B=b[N];(!N||B.x<h)&&(h=B.x),(!N||B.y<d)&&(d=B.y),(!N||B.x>_)&&(_=B.x),(!N||B.y>g)&&(g=B.y)}const T=Math.min(_-h,g-d);let S=T/2;const P=new l_([],F$);if(T===0)return new xt(h,d);for(let N=h;N<_;N+=T)for(let B=d;B<g;B+=T)P.push(new ug(N+S,B+S,S,l));let M=function(N){let B=0,W=0,X=0;const Z=N[0];for(let ne=0,se=Z.length,le=se-1;ne<se;le=ne++){const Ee=Z[ne],Ie=Z[le],Re=Ee.x*Ie.y-Ie.x*Ee.y;W+=(Ee.x+Ie.x)*Re,X+=(Ee.y+Ie.y)*Re,B+=3*Re}return new ug(W/B,X/B,0,N)}(l),L=P.length;for(;P.length;){const N=P.pop();(N.d>M.d||!M.d)&&(M=N,a&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,L)),N.max-M.d<=i||(S=N.h/2,P.push(new ug(N.p.x-S,N.p.y-S,S,l)),P.push(new ug(N.p.x+S,N.p.y-S,S,l)),P.push(new ug(N.p.x-S,N.p.y+S,S,l)),P.push(new ug(N.p.x+S,N.p.y+S,S,l)),L+=4)}return a&&(console.log(`num probes: ${L}`),console.log(`best distance: ${M.d}`)),M.p}function F$(l,i){return i.max-l.max}class ug{constructor(i,a,h,d){this.p=new xt(i,a),this.h=h,this.d=function(_,g){let b=!1,T=1/0;for(let S=0;S<g.length;S++){const P=g[S];for(let M=0,L=P.length,N=L-1;M<L;N=M++){const B=P[M],W=P[N];B.y>_.y!=W.y>_.y&&_.x<(W.x-B.x)*(_.y-B.y)/(W.y-B.y)+B.x&&(b=!b),T=Math.min(T,Nn(_,B,W))}}return(b?1:-1)*Math.sqrt(T)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const z$=Object.keys,yS=Number.POSITIVE_INFINITY,N$=Math.sqrt(2);function W6(l,[i,a]){let h=0,d=0;if(a===yS){i<0&&(i=0);const _=i/N$;switch(l){case"top-right":case"top-left":d=_-7;break;case"bottom-right":case"bottom-left":d=7-_;break;case"bottom":d=7-i;break;case"top":d=i-7}switch(l){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=i;break;case"right":h=-i}}else{switch(i=Math.abs(i),a=Math.abs(a),l){case"top-right":case"top-left":case"top":d=a-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-a}switch(l){case"top-right":case"bottom-right":case"right":h=-i;break;case"top-left":case"bottom-left":case"left":h=i}}return[h,d]}function uw(l,i,a,h,d,_,g,b,T){if(!i||!i.usvg)return;const S=D6(h),P=D6(d),M=_!=="both"&&_!=="width"||!M6(h)?1:P.width/S.width,L=_!=="both"&&_!=="height"||!k6(h)?1:P.height/S.height;a.scaleSelf(M,L);const N=a.toString();g.set(N,a),b.set(N,i);const{imagePosition:B}=_S(N,i,Wp);T.set(N,B)}function X6(l,i,a,h,d,_,g,b,T){if(!l)return;const S=function(P,M,L,N,B,W){if(P.kind==="camera")return P.maxSize;if(P.kind==="composite"){const X=M.possiblyEvaluate(new gn(P.maxZoom,{worldview:W}),L).evaluate(B,{},L),Z=M.possiblyEvaluate(new gn(P.minZoom,{worldview:W}),L).evaluate(B,{},L);return Math.max(X,Z)}return M.possiblyEvaluate(new gn(N,{worldview:W})).evaluate(B,{},L)}(i,a,h,d,_,T);return l.scaleSelf(S*b*g)}function Z6(l,i,a,h,d,_,g,b,T){return{iconPrimary:X6(l.getPrimary(),i,a,h,d,_,g,b,T),iconSecondary:X6(l.getSecondary(),i,a,h,d,_,g,b,T)}}function B$(l,i,a){if(!i)return;const h=a.get(l.toString()),d=a.get(i.toString());h&&d&&(h.paddedRect.w===d.paddedRect.w&&h.paddedRect.h===d.paddedRect.h||Ji(`Mismatch in icon variant sizes: ${l.toString()} and ${i.toString()}`),h.usvg!==d.usvg&&Ji(`Mismatch in icon variant image types: ${l.id} and ${i.id}`))}function K6(l,i,a,h){if(!l)return;const d=i.get(a.toString());if(l.imagePrimary=d,h){const _=i.get(h.toString());l.imageSecondary=_}}function V$(l,i){for(const a in l.horizontal)Y6(l.horizontal[a],i);Y6(l.vertical,i)}function Y6(l,i){if(l){for(const a of l.positionedLines)for(const h of a.positionedGlyphs)if(h.image!==null){const d=h.image.toString();h.rect=i.get(d).paddedRect}}}function vS(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function U$(l,i,a,h,d,_,g,b,T){const S=xS(_.horizontal)||_.vertical,P=a.get("icon-text-fit-padding").evaluate(h,{},d);let M,L=i;return i&&T!=="none"&&(l.allowVerticalPlacement&&_.vertical&&(M=P6(i,_.vertical,T,P,b,g)),S&&(L=P6(i,S,T,P,b,g))),{defaultShapedIcon:L,verticallyShapedIcon:M}}function j$(l,i,a,h,d,_,g,b,T,S,P,M,L,N,B,W,X,Z,ne,se){let le=g.textMaxSize.evaluate(i,{},L);le===void 0?le=b*g.textScaleFactor:le*=g.textScaleFactor;const Ee=l.layers[0].layout,Ie=xS(a.horizontal)||a.vertical,Re=N.name==="globe",Ne=co,je=l.tilePixelRatio*le/Ne,ft=(Rt=l.overscaling,l.zoom>18&&Rt>2&&(Rt>>=1),Math.max(Ft/(512*Rt),1)*Ee.get("symbol-spacing")),We=Ee.get("text-padding")*l.tilePixelRatio,mt=Ee.get("icon-padding")*l.tilePixelRatio,St=Pe(Ee.get("text-max-angle")),gt=Ee.get("icon-rotation-alignment")==="map"&&se!=="point",wt=ft/2;var Rt;l.hasAnyIconTextFit===!1&&X!=="none"&&(l.hasAnyIconTextFit=!0);const ut=i.properties?+i.properties[Qi]:null,Tt=ut&&l.elevationFeatureIdToIndex?l.elevationFeatureIdToIndex.get(ut):65535,rt=(et,Pt,At)=>{if(Pt.x<0||Pt.x>=Ft||Pt.y<0||Pt.y>=Ft)return;let mi=null;if(Re){const{x:qt,y:si,z:Ot}=N.projectTilePoint(Pt.x,Pt.y,At);mi={anchor:new rd(qt,si,Ot,0,void 0),up:N.upVector(At,Pt.x,Pt.y)}}(function(qt,si,Ot,pi,Ui,Ut,ci,Li,Hi,or,Zi,ei,qi,Ir,ue,he,it,dt,Vt,Bt,Yt,gi,ar,lr,rr,Yr,On,tr,yn){const rn=qt.addToLineVertexArray(si,pi);let Nr,bn,wn,mn,vn,nn,cr,an=0,$n=0,zi=0,Rr=0,Tn=-1,Jn=-1;const Cn={};let Os=Rh("");const hn=Ot?Ot.anchor:si,As=tr!=="none";let Pa=0,Eo=0;if(Hi._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Fs=Hi.layout.get("text-offset").evaluate(Yt,{},rr);Pa=Fs[0]*co,Eo=Fs[1]*co}else Pa=Hi.layout.get("text-radial-offset").evaluate(Yt,{},rr)*co,Eo=yS;if(qt.allowVerticalPlacement&&Ui.vertical){const Fs=Ui.vertical;if(ue)nn=bS(Fs),Li&&(cr=bS(Li));else{const Zs=Hi.layout.get("text-rotate").evaluate(Yt,{},rr)+90;wn=hw(or,hn,si,Zi,ei,qi,Fs,Ir,Zs,he),Li&&(mn=hw(or,hn,si,Zi,ei,qi,Li,dt,Zs))}}if(Ut){const Fs=qt.iconSizeData,Zs=Hi.layout.get("icon-rotate").evaluate(Yt,{},rr),Io=H6(Ut,Zs,ar,As,gi.iconScaleFactor),Yo=Li?H6(Li,Zs,ar,As,gi.iconScaleFactor):void 0;bn=hw(or,hn,si,Zi,ei,qi,Ut,dt,Zs,null),an=4*Io.length;let zo=null;Fs.kind==="source"?(zo=[Xu*Hi.layout.get("icon-size").evaluate(Yt,{},rr)*gi.iconScaleFactor],zo[0]>wf&&Ji(`${qt.layerIds[0]}: Value for "icon-size" is >= ${vv}. Reduce your "icon-size".`)):Fs.kind==="composite"&&(zo=[Xu*gi.compositeIconSizes[0].evaluate(Yt,{},rr)*gi.iconScaleFactor,Xu*gi.compositeIconSizes[1].evaluate(Yt,{},rr)*gi.iconScaleFactor],(zo[0]>wf||zo[1]>wf)&&Ji(`${qt.layerIds[0]}: Value for "icon-size" is >= ${vv}. Reduce your "icon-size".`)),qt.addSymbols(qt.icon,Io,zo,Bt,Vt,Yt,void 0,Ot,si,rn.lineStartIndex,rn.lineLength,-1,lr,rr,Yr,On),Tn=qt.icon.placedSymbolArray.length-1,Yo&&($n=4*Yo.length,qt.addSymbols(qt.icon,Yo,zo,Bt,Vt,Yt,sl.vertical,Ot,si,rn.lineStartIndex,rn.lineLength,-1,lr,rr,Yr,On),Jn=qt.icon.placedSymbolArray.length-1)}for(const Fs in Ui.horizontal){const Zs=Fs,Io=Ui.horizontal[Zs];Nr||(Os=Rh(Io.text),ue?vn=bS(Io):Nr=hw(or,hn,si,Zi,ei,qi,Io,Ir,Hi.layout.get("text-rotate").evaluate(Yt,{},rr),he));const Yo=Io.positionedLines.length===1;if(zi+=J6(qt,Ot,si,Io,ci,Hi,ue,Yt,he,rn,Ui.vertical?sl.horizontal:sl.horizontalOnly,Yo?z$(Ui.horizontal):[Zs],Cn,Tn,gi,lr,rr,Yr),Yo)break}Ui.vertical&&(Rr+=J6(qt,Ot,si,Ui.vertical,ci,Hi,ue,Yt,he,rn,sl.vertical,["vertical"],Cn,Jn,gi,lr,rr,Yr));let mo=-1;const Ma=(Fs,Zs)=>Fs?Math.max(Fs,Zs):Zs;mo=Ma(vn,mo),mo=Ma(nn,mo),mo=Ma(cr,mo);const Zu=mo>-1?1:0;qt.glyphOffsetArray.length>=65535&&Ji("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Yt.sortKey!==void 0&&qt.addToSortKeyRanges(qt.symbolInstances.length,Yt.sortKey),qt.symbolInstances.emplaceBack(si.x,si.y,hn.x,hn.y,hn.z,Cn.right>=0?Cn.right:-1,Cn.center>=0?Cn.center:-1,Cn.left>=0?Cn.left:-1,Cn.vertical>=0?Cn.vertical:-1,Tn,Jn,Os,Nr!==void 0?Nr:qt.collisionBoxArray.length,Nr!==void 0?Nr+1:qt.collisionBoxArray.length,wn!==void 0?wn:qt.collisionBoxArray.length,wn!==void 0?wn+1:qt.collisionBoxArray.length,bn!==void 0?bn:qt.collisionBoxArray.length,bn!==void 0?bn+1:qt.collisionBoxArray.length,mn||qt.collisionBoxArray.length,mn?mn+1:qt.collisionBoxArray.length,Zi,zi,Rr,an,$n,Zu,0,Pa,Eo,mo,0,As?1:0,yn)})(l,Pt,mi,et,a,h,_,d,l.layers[0],l.collisionBoxArray,i.index,i.sourceLayerIndex,l.index,We,ne,S,0,mt,gt,Z,i,g,P,M,L,B,W,X,Tt)};if(se==="line")for(const et of Yb(i.geometry,0,0,Ft,Ft)){const Pt=D$(et,ft,St,a.vertical||Ie,h,Ne,je,l.overscaling,Ft);for(const At of Pt)Ie&&$$(l,Ie.text,wt,At)||rt(et,At,L)}else if(se==="line-center"){for(const et of i.geometry)if(et.length>1){const Pt=k$(et,St,a.vertical||Ie,h,Ne,je);Pt&&rt(et,Pt,L)}}else if(i.type==="Polygon")for(const et of tv(i.geometry,0)){const Pt=O$(et,16);rt(et[0],new rd(Pt.x,Pt.y,0,0,void 0),L)}else if(i.type==="LineString")for(const et of i.geometry)rt(et,new rd(et[0].x,et[0].y,0,0,void 0),L);else if(i.type==="Point")for(const et of i.geometry)for(const Pt of et)rt([Pt],new rd(Pt.x,Pt.y,0,0,void 0),L)}const vv=255,wf=vv*Xu;function J6(l,i,a,h,d,_,g,b,T,S,P,M,L,N,B,W,X,Z){const ne=function(Ee,Ie,Re,Ne,je,ft,We,mt){const St=[];if(Ie.positionedLines.length===0)return St;const gt=Ne.layout.get("text-rotate").evaluate(ft,{})*Math.PI/180,wt=function(et){const Pt=et[0],At=et[1],mi=Pt*At;return mi>0?[Pt,-At]:mi<0?[-Pt,At]:Pt===0?[At,Pt]:[At,-Pt]}(Re);let Rt=Math.abs(Ie.top-Ie.bottom);for(const et of Ie.positionedLines)Rt-=et.lineOffset;const ut=Ie.positionedLines.length,Tt=Rt/ut;let rt=Ie.top-Re[1];for(let et=0;et<ut;++et){const Pt=Ie.positionedLines[et];rt=L$(Ie,Tt,rt,et);for(const At of Pt.positionedGlyphs){if(!At.rect)continue;const mi=At.rect||{};let qt=T6+1,si=!0,Ot=1,pi=0;if(At.image){const Yt=We.get(At.image.toString());if(!Yt)continue;if(Yt.sdf){Ji("SDF images are not supported in formatted text and will be ignored.");continue}si=!1,Ot=Yt.pixelRatio,qt=Wp/Ot}const Ui=(je||mt)&&At.vertical,Ut=At.metrics.advance*At.scale/2,ci=At.metrics,Li=At.rect;if(Li===null)continue;mt&&Ie.verticalizable&&(pi=At.image?Ut-At.metrics.width*At.scale/2:0);const Hi=je?[At.x+Ut,At.y]:[0,0];let or=[0,0],Zi=[0,0],ei=!1;je||(Ui?(Zi=[At.x+Ut+wt[0],At.y+wt[1]-pi],ei=!0):or=[At.x+Ut+Re[0],At.y+Re[1]-pi]);const qi=Li.w*At.scale/(Ot*(At.localGlyph?ru:1)),Ir=Li.h*At.scale/(Ot*(At.localGlyph?ru:1));let ue,he,it,dt;if(Ui){const Yt=At.y-rt,gi=new xt(-Ut,Ut-Yt),ar=-Math.PI/2,lr=new xt(...Zi);ue=new xt(-Ut+or[0],or[1]),ue._rotateAround(ar,gi)._add(lr),ue.x+=-Yt+Ut,ue.y-=(ci.left-qt)*At.scale;const rr=At.image?ci.advance*At.scale:co*At.scale,Yr=String.fromCodePoint(At.glyph);m$(Yr)?ue.x+=(1-qt)*At.scale:_$(Yr)?ue.x+=rr-ci.height*At.scale+(-qt-1)*At.scale:ue.x+=At.image||ci.width+2*qt===Li.w&&ci.height+2*qt===Li.h?(rr-Ir)/2:(rr-(ci.height+2*qt)*At.scale)/2,he=new xt(ue.x,ue.y-qi),it=new xt(ue.x+Ir,ue.y),dt=new xt(ue.x+Ir,ue.y-qi)}else{const Yt=(ci.left-qt)*At.scale-Ut+or[0],gi=(-ci.top-qt)*At.scale+or[1],ar=Yt+qi,lr=gi+Ir;ue=new xt(Yt,gi),he=new xt(ar,gi),it=new xt(Yt,lr),dt=new xt(ar,lr)}if(gt){let Yt;Yt=je?new xt(0,0):ei?new xt(wt[0],wt[1]):new xt(Re[0],Re[1]),ue._rotateAround(gt,Yt),he._rotateAround(gt,Yt),it._rotateAround(gt,Yt),dt._rotateAround(gt,Yt)}const Vt=new xt(0,0),Bt=new xt(0,0);St.push({tl:ue,tr:he,bl:it,br:dt,texPrimary:mi,texSecondary:void 0,writingMode:Ie.writingMode,glyphOffset:Hi,sectionIndex:At.sectionIndex,isSDF:si,pixelOffsetTL:Vt,pixelOffsetBR:Bt,minFontScaleX:0,minFontScaleY:0})}}return St}(0,h,T,_,g,b,d,l.allowVerticalPlacement),se=l.textSizeData;let le=null;se.kind==="source"?(le=[Xu*_.layout.get("text-size").evaluate(b,{},X)*B.textScaleFactor],le[0]>wf&&Ji(`${l.layerIds[0]}: Value for "text-size" is >= ${vv}. Reduce your "text-size".`)):se.kind==="composite"&&(le=[Xu*B.compositeTextSizes[0].evaluate(b,{},X)*B.textScaleFactor,Xu*B.compositeTextSizes[1].evaluate(b,{},X)*B.textScaleFactor],(le[0]>wf||le[1]>wf)&&Ji(`${l.layerIds[0]}: Value for "text-size" is >= ${vv}. Reduce your "text-size".`)),l.addSymbols(l.text,ne,le,T,g,b,P,i,a,S.lineStartIndex,S.lineLength,N,W,X,Z,!1);for(const Ee of M)L[Ee]=l.text.placedSymbolArray.length-1;return 4*ne.length}function xS(l){for(const i in l)return l[i];return null}function hw(l,i,a,h,d,_,g,b,T,S){let P=g.top,M=g.bottom,L=g.left,N=g.right;if(R6(g)&&g.collisionPadding){const B=g.collisionPadding;L-=B[0],P-=B[1],N+=B[2],M+=B[3]}if(T){const B=new xt(L,P),W=new xt(N,P),X=new xt(L,M),Z=new xt(N,M),ne=Pe(T);let se=new xt(0,0);S&&(se=new xt(S[0],S[1])),B._rotateAround(ne,se),W._rotateAround(ne,se),X._rotateAround(ne,se),Z._rotateAround(ne,se),L=Math.min(B.x,W.x,X.x,Z.x),N=Math.max(B.x,W.x,X.x,Z.x),P=Math.min(B.y,W.y,X.y,Z.y),M=Math.max(B.y,W.y,X.y,Z.y)}return l.emplaceBack(i.x,i.y,i.z,a.x,a.y,L,P,N,M,b,h,d,_),l.length-1}function bS(l){R6(l)&&l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const i=l.bottom-l.top;return i>0?Math.max(10,i):null}function $$(l,i,a,h){const d=l.compareText;if(i in d){const _=d[i];for(let g=_.length-1;g>=0;g--)if(h.dist(_[g])<a)return!0}else d[i]=[];return d[i].push(h),!1}function Q6(l,i){const a=l.fovAboveCenter,h=l.elevation?l.elevation.getMinElevationBelowMSL()*i:0,d=(l._camera.position[2]*l.worldSize-h)/Math.cos(l._pitch),_=Math.sin(a)*d/Math.sin(Math.max(Math.PI/2-l._pitch-a,.01));let g=Math.sin(l._pitch)*_+d;const b=d*(1/l._horizonShift);if(!l.elevation||l.elevation.exaggeration()===0){let T=Math.max(l.zoom-17,0);l.isOrthographic&&(T/=10),g*=1+T}return Math.min(1.01*g,b)}function xv(l,i){if(!i.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:i};const a=Math.pow(2,-l.z),h=l.x*a,d=(l.x+1)*a,_=l.y*a,g=(l.y+1)*a,b=xe(h),T=xe(d),S=ge(_),P=ge(g),M=i.project(b,S),L=i.project(T,S),N=i.project(T,P),B=i.project(b,P);let W=Math.min(M.x,L.x,N.x,B.x),X=Math.min(M.y,L.y,N.y,B.y),Z=Math.max(M.x,L.x,N.x,B.x),ne=Math.max(M.y,L.y,N.y,B.y);const se=a/16;function le(Ie,Re,Ne,je,ft,We){const mt=(Ne+ft)/2,St=(je+We)/2,gt=i.project(xe(mt),ge(St)),wt=Math.max(0,W-gt.x,X-gt.y,gt.x-Z,gt.y-ne);W=Math.min(W,gt.x),Z=Math.max(Z,gt.x),X=Math.min(X,gt.y),ne=Math.max(ne,gt.y),wt>se&&(le(Ie,gt,Ne,je,mt,St),le(gt,Re,mt,St,ft,We))}le(M,L,h,_,d,_),le(L,N,d,_,d,g),le(N,B,d,g,h,g),le(B,M,h,g,h,_),W-=se,X-=se,Z+=se,ne+=se;const Ee=1/Math.max(Z-W,ne-X);return{scale:Ee,x:W*Ee,y:X*Ee,x2:Z*Ee,y2:ne*Ee,projection:i}}function ek(l,{x:i,y:a},h=0){return new xt(((i-h)*l.scale-l.x)*Ft,(a*l.scale-l.y)*Ft)}const G$=Q(new Float32Array(16));class Tf{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,a){return{x:0,y:0,z:0}}unproject(i,a){return new H(0,0)}projectTilePoint(i,a,h){return{x:i,y:a,z:0}}locationPoint(i,a,h,d=!0){return i._coordinatePoint(i.locationCoordinate(a,h),d)}pixelsPerMeter(i,a){return _e(1,i)*a}pixelSpaceConversion(i,a,h){return 1}farthestPixelDistance(i){return Q6(i,i.pixelsPerMeter)}pointCoordinate(i,a,h,d){const _=i.horizonLineFromTop(!1),g=new xt(a,Math.max(_,h));return i.rayIntersectionCoordinate(i.pointRayIntersection(g,d))}pointCoordinate3D(i,a,h){const d=new xt(a,h);if(i.elevation)return i.elevation.pointCoordinate(d);{const _=this.pointCoordinate(i,d.x,d.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(i,a){if(i.elevation&&i.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(i,a.x,a.y);const h=i.horizonLineFromTop();return a.y<h}createInversionMatrix(i,a){return G$}createTileMatrix(i,a,h){let d,_,g;const b=h.canonical,T=Q(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=xv(b,this);d=1,_=S.x+h.wrap*S.scale,g=S.y,Le(T,T,[d/S.scale,d/S.scale,i.pixelsPerMeter/a])}else d=a/i.zoomScale(b.z),_=(b.x+Math.pow(2,b.z)*h.wrap)*d,g=b.y*d;return Fe(T,T,[_,g,0]),Le(T,T,[d/Ft,d/Ft,1]),T}upVector(i,a,h){return[0,0,1]}upVectorScale(i,a,h){return{metersToTile:1}}}class H$ extends Tf{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[a,h]=this.parallels=i.parallels||[29.5,45.5],d=Math.sin(Pe(a));this.n=(d+Math.sin(Pe(h)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(i,a){const{n:h,c:d,r0:_}=this,g=Pe(i-this.center[0]),b=Pe(a),T=Math.sqrt(d-2*h*Math.sin(b))/h;return{x:T*Math.sin(g*h),y:T*Math.cos(g*h)-_,z:0}}unproject(i,a){const{n:h,c:d,r0:_}=this,g=_+a;let b=Math.atan2(i,Math.abs(g))*Math.sign(g);g*h<0&&(b-=Math.PI*Math.sign(i)*Math.sign(g));const T=Pe(this.center[0])*h;b=ze(b,-Math.PI-T,Math.PI-T);const S=fe(q(b/h)+this.center[0],-180,180),P=Math.asin(fe((d-(i*i+g*g)*h*h)/(2*h),-1,1)),M=fe(q(P),-we,we);return new H(S,M)}}const bv=1.340264,wv=-.081106,Tv=893e-6,Ev=.003796,dw=Math.sqrt(3)/2;class q$ extends Tf{project(i,a){a=a/180*Math.PI,i=i/180*Math.PI;const h=Math.asin(dw*Math.sin(a)),d=h*h,_=d*d*d;return{x:.5*(i*Math.cos(h)/(dw*(bv+3*wv*d+_*(7*Tv+9*Ev*d)))/Math.PI+.5),y:1-.5*(h*(bv+wv*d+_*(Tv+Ev*d))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let h=a=(2*(1-a)-1)*Math.PI,d=h*h,_=d*d*d;for(let P,M,L,N=0;N<12&&(M=h*(bv+wv*d+_*(Tv+Ev*d))-a,L=bv+3*wv*d+_*(7*Tv+9*Ev*d),P=M/L,h=fe(h-P,-Math.PI/3,Math.PI/3),d=h*h,_=d*d*d,!(Math.abs(P)<1e-12));++N);const g=dw*i*(bv+3*wv*d+_*(7*Tv+9*Ev*d))/Math.cos(h),b=Math.asin(Math.sin(h)/dw),T=fe(180*g/Math.PI,-180,180),S=fe(180*b/Math.PI,-we,we);return new H(T,S)}}class W$ extends Tf{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){return{x:.5+i/360,y:.5-a/360,z:0}}unproject(i,a){const h=360*(i-.5),d=fe(360*(.5-a),-we,we);return new H(h,d)}}const hg=Math.PI/2;function fw(l){return Math.tan((hg+l)/2)}class X$ extends Tf{constructor(i){super(i),this.center=i.center||[0,30];const[a,h]=this.parallels=i.parallels||[30,30];let d=Pe(a),_=Pe(h);this.southernCenter=d+_<0,this.southernCenter&&(d=-d,_=-_);const g=Math.cos(d),b=fw(d);this.n=d===_?Math.sin(d):Math.log(g/Math.cos(_))/Math.log(fw(_)/b),this.f=g*Math.pow(fw(d),this.n)/this.n}project(i,a){a=Pe(a),this.southernCenter&&(a=-a),i=Pe(i-this.center[0]);const h=1e-6,{n:d,f:_}=this;_>0?a<-hg+h&&(a=-hg+h):a>hg-h&&(a=hg-h);const g=_/Math.pow(fw(a),d);let b=g*Math.sin(d*i),T=_-g*Math.cos(d*i);return b=.5*(b/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:b,y:this.southernCenter?T:1-T,z:0}}unproject(i,a){i=(2*i-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:h,f:d}=this,_=d-a,g=Math.sign(_),b=Math.sign(h)*Math.sqrt(i*i+_*_);let T=Math.atan2(i,Math.abs(_))*g;_*h<0&&(T-=Math.PI*Math.sign(i)*g);const S=fe(q(T/h)+this.center[0],-180,180),P=fe(q(2*Math.atan(Math.pow(d/b,1/h))-hg),-we,we);return new H(S,this.southernCenter?-P:P)}}class tk extends Tf{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,a){return{x:ce(i),y:ve(a),z:0}}unproject(i,a){const h=xe(i),d=ge(a);return new H(h,d)}}const ik=Pe(we);class Z$ extends Tf{project(i,a){const h=(a=Pe(a))*a,d=h*h;return{x:.5*((i=Pe(i))*(.8707-.131979*h+d*(d*(.003971*h-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+h*(.015085+d*(.028874*h-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let h=a=(2*(1-a)-1)*Math.PI,d=25,_=0,g=h*h;do{g=h*h;const S=g*g;_=(h*(1.007226+g*(.015085+S*(.028874*g-.044475-.005916*S)))-a)/(1.007226+g*(.045255+S*(.259866*g-.311325-.005916*11*S))),h=fe(h-_,-ik,ik)}while(Math.abs(_)>1e-6&&--d>0);g=h*h;const b=fe(q(i/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),T=q(h);return new H(b,T)}}const rk=Pe(we);class K$ extends Tf{project(i,a){a=Pe(a),i=Pe(i);const h=Math.cos(a),d=2/Math.PI,_=Math.acos(h*Math.cos(i/2)),g=Math.sin(_)/_,b=.5*(i*d+2*h*Math.sin(i/2)/g)||0,T=.5*(a+Math.sin(a)/g)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(i,a){let h=i=(2*i-.5)*Math.PI,d=a=(2*(1-a)-1)*Math.PI,_=25;const g=1e-6;let b=0,T=0;do{const S=Math.cos(d),P=Math.sin(d),M=2*P*S,L=P*P,N=S*S,B=Math.cos(h/2),W=Math.sin(h/2),X=2*B*W,Z=W*W,ne=1-N*B*B,se=ne?1/ne:0,le=ne?Math.acos(S*B)*Math.sqrt(1/ne):0,Ee=.5*(2*le*S*W+2*h/Math.PI)-i,Ie=.5*(le*P+d)-a,Re=.5*se*(N*Z+le*S*B*L)+1/Math.PI,Ne=se*(X*M/4-le*P*W),je=.125*se*(M*W-le*P*N*X),ft=.5*se*(L*B+le*Z*S)+.5,We=Ne*je-ft*Re;b=(Ie*Ne-Ee*ft)/We,T=(Ee*je-Ie*Re)/We,h=fe(h-b,-Math.PI,Math.PI),d=fe(d-T,-rk,rk)}while((Math.abs(b)>g||Math.abs(T)>g)&&--_>0);return new H(q(h),q(d))}}class nk extends Tf{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Pe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){const{scale:h,cosPhi:d}=this;return{x:Pe(i)*d*h+.5,y:-Math.sin(Pe(a))/d*h+.5,z:0}}unproject(i,a){const{scale:h,cosPhi:d}=this,_=-(a-.5)/h,g=fe(q((i-.5)/h)/d,-180,180),b=Math.asin(fe(_*d,-1,1)),T=fe(q(b),-we,we);return new H(g,T)}}class Y$ extends tk{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,a,h){const d=Zy(i,a,h);return ai(d,d,jb(qu(h))),{x:d[0],y:d[1],z:d[2]}}locationPoint(i,a,h){const d=z(a.lat,a.lng),_=Ni([],d),g=h?i._centerAltitude+h:i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(a),i._centerAltitude):i._centerAltitude;ji(d,d,_,_e(1,0)*Ft*g);const b=Q(new Float64Array(16));return Ce(b,i.pixelMatrix,i.globeMatrix),ai(d,d,b),new xt(d[0],d[1])}pixelsPerMeter(i,a){return _e(1,0)*a}pixelSpaceConversion(i,a,h){const d=_e(1,i)*a,_=Ri(_e(1,45)*a,d,h);return this.pixelsPerMeter(i,a)/_}createTileMatrix(i,a,h){const d=RI(qu(h.canonical));return Ce(new Float64Array(16),i.globeMatrix,d)}createInversionMatrix(i,a){const{center:h}=i,d=jb(qu(a));return at(d,d,Pe(h.lng)),Me(d,d,Pe(h.lat)),Le(d,d,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(i,a,h,d){return CP(i,a,h,!0)||new nt(0,0)}pointCoordinate3D(i,a,h){const d=this.pointCoordinate(i,a,h,0);return[d.x,d.y,d.z]}isPointAboveHorizon(i,a){return!CP(i,a.x,a.y,!1)}farthestPixelDistance(i){const a=function(d,_){const g=d.cameraToCenterDistance,b=d._centerAltitude*_,T=d._camera,S=d._camera.forward(),P=ti([],wi([],S,-g),[0,0,b]),M=d.worldSize/(2*Math.PI),L=[0,0,-M],N=d.width/d.height,B=Math.tan(d.fovAboveCenter),W=wi([],T.up(),B),X=wi([],T.right(),B*N),Z=Ni([],ti([],ti([],S,W),X)),ne=[];let se;if(new zr(P,Z).closestPointOnSphere(L,M,ne)){const le=ti([],ne,L),Ee=ht([],le,P);se=Math.cos(d.fovAboveCenter)*Oe(Ee)}else{const le=ht([],P,L),Ee=ht([],L,P);Ni(Ee,Ee);const Ie=Oe(le)-M;se=Math.sqrt(Ie*(Ie+2*M));const Re=Math.acos(se/(M+Ie))-Math.acos(vt(S,Ee));se*=Math.cos(Re)}return 1.01*se}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),h=gf(i.zoom);if(h>0){const d=Q6(i,_e(1,i.center.lat)*i.worldSize),_=i.worldSize/(2*Math.PI),g=Math.max(i.width,i.height)/i.worldSize*Math.PI;return Ri(a,d+_*(1-Math.cos(g)),Math.pow(h,10))}return a}upVector(i,a,h){return Zy(a,h,i,1)}upVectorScale(i){return{metersToTile:Bb(Ub(qu(i)))}}}function sk(l){const i=l.parallels,a=!!i&&Math.abs(i[0]+i[1])<.01;switch(l.name){case"mercator":return new tk(l);case"equirectangular":return new W$(l);case"naturalEarth":return new Z$(l);case"equalEarth":return new q$(l);case"winkelTripel":return new K$(l);case"albers":return a?new nk(l):new H$(l);case"lambertConformalConic":return a?new nk(l):new X$(l);case"globe":return new Y$(l)}throw new Error(`Invalid projection name: ${l.name}`)}const J$=It.types,Q$=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function pw(l,i,a,h,d,_,g,b,T,S,P,M,L){const N=b?Math.min(wf,Math.round(b[0])):0,B=b?Math.min(wf,Math.round(b[1])):0;l.emplaceBack(i,a,Math.round(32*h),Math.round(32*d),_,g,(N<<1)+(T?1:0),B,16*S,16*P,256*M,256*L)}function mw(l,i,a){l.emplaceBack(i,a)}function _w(l,i,a,h,d,_,g){l.emplaceBack(i,a,h,d,_,g)}const gw=(l,i,a,h)=>{for(let d=0;d<i;d++)l.emplaceBack(a[0],a[1],a[2],h[0],h[1],h[2])};function yw(l,i,a,h,d){l.emplaceBack(i,a,h,d),l.emplaceBack(i,a,h,d),l.emplaceBack(i,a,h,d),l.emplaceBack(i,a,h,d)}function eG(l){for(const i of l.sections)if(_I(i.text))return!0;return!1}class wS{constructor(i){this.layoutVertexArray=new Ny,this.indexArray=new Us,this.programConfigurations=i,this.segments=new jn,this.dynamicLayoutVertexArray=new $l,this.opacityVertexArray=new hf,this.placedSymbolArray=new Z_,this.iconTransitioningVertexArray=new Ds,this.globeExtVertexArray=new By,this.zOffsetVertexArray=new Uu,this.orientationVertexArray=new kp}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(i,a,h,d,_){this.isEmpty()||(h&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,s$.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,a$.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Q$,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=i.createVertexBuffer(this.iconTransitioningVertexArray,u$.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,o$.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||_)&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,l$.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=i.createVertexBuffer(this.orientationVertexArray,c$.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||d)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Zt(wS,"SymbolBuffers");class TS{constructor(i,a,h){this.layoutVertexArray=new i,this.layoutAttributes=a,this.indexArray=new h,this.segments=new jn,this.collisionVertexArray=new Uy,this.collisionVertexArrayExt=new $l}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,h$.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,d$.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Zt(TS,"CollisionBuffers");class vw{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Q([]),this.placementViewportMatrix=Q([]);const a=this.layers[0]._unevaluatedLayout._values;this.worldview=i.worldview,this.textSizeData=L6(this.zoom,a["text-size"],this.worldview),this.iconSizeData=L6(this.zoom,a["icon-size"],this.worldview);const h=this.layers[0].layout,d=h.get("symbol-sort-key"),_=h.get("symbol-z-order");this.lut=i.lut,this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(g=>sl[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=i.sourceID,this.projection=i.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new wS(new Gl(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("text")||i.startsWith("symbol"))),this.icon=new wS(new Gl(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("icon")||i.startsWith("symbol"))),this.glyphOffsetArray=new Pb,this.lineVertexArray=new Mb,this.symbolInstances=new Rb}calculateGlyphDependencies(i,a,h,d,_){for(const g of i){const b=g.codePointAt(0);if(b===void 0)break;if(a[b]=!0,d&&_&&b<=65535){const T=pv[g];T&&(a[T.charCodeAt(0)]=!0)}}}updateFootprints(i,a){}updateReplacement(i,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const h=a.getReplacementRegionsForTile(i.toUnwrapped(),!0);return!Xb(this.activeReplacements,h)&&(this.activeReplacements=h,!0)}populate(i,a,h,d){const _=this.layers[0],g=_.layout,b=this.projection.name==="globe",T=g.get("text-font"),S=g.get("text-field"),P=g.get("icon-image"),[M,L]=g.get("icon-size-scale-range"),N=fe(a.scaleFactor||1,M,L),B=(S.value.kind!=="constant"||S.value.value instanceof _t&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),W=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,X=g.get("symbol-sort-key");if(this.features=[],!B&&!W)return;const Z=a.iconDependencies,ne=a.glyphDependencies,se=a.availableImages,le=new gn(this.zoom,{worldview:this.worldview});for(const{feature:Ee,id:Ie,index:Re,sourceLayerIndex:Ne}of i){const je=_._featureFilter.needGeometry,ft=Ct(Ee,je);if(!_._featureFilter.filter(le,ft,h))continue;if(je||(ft.geometry=$t(Ee,h,d)),b&&Ee.type!==1&&h.z<=5){const wt=ft.geometry,Rt=.98078528056,ut=(Tt,rt)=>vt(Zy(Tt.x,Tt.y,h,1),Zy(rt.x,rt.y,h,1))<Rt;for(let Tt=0;Tt<wt.length;Tt++)wt[Tt]=ct(wt[Tt],ut)}let We,mt;if(B){const wt=_.getValueAndResolveTokens("text-field",ft,h,se),Rt=_t.factory(wt);eG(Rt)&&(this.hasRTLText=!0),(!this.hasRTLText||F_()==="unavailable"||this.hasRTLText&&vc.isParsed())&&(We=p$(Rt,_,ft))}if(W){const wt=_.getValueAndResolveTokens("icon-image",ft,h,se);mt=typeof wt=="string"?_i.build(wt):wt}if(!We&&!mt)continue;const St=this.sortFeaturesByKey?X.evaluate(ft,{},h):void 0,gt={id:Ie,text:We,icon:mt,index:Re,sourceLayerIndex:Ne,geometry:ft.geometry,properties:Ee.properties,type:J$[Ee.type],sortKey:St};if(this.features.push(gt),mt){const wt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Rt,iconSecondary:ut}=Z6(mt,this.iconSizeData,wt["icon-size"],h,this.zoom,gt,this.pixelRatio,N,this.worldview),Tt=Rt.id.toString();if(Z.has(Tt)?Z.get(Tt).push(Rt):Z.set(Tt,[Rt]),ut){this.hasAnySecondaryIcon=!0;const rt=ut.id.toString();Z.has(rt)?Z.get(rt).push(ut):Z.set(rt,[ut])}}if(We){const wt=T.evaluate(ft,{},h).join(","),Rt=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(sl.vertical)>=0;for(const ut of We.sections)if(ut.image){const Tt=ut.image.getPrimary().scaleSelf(this.pixelRatio),rt=Tt.id.toString(),et=Z.get(rt)||[];et.push(Tt),Z.set(rt,et)}else{const Tt=Cy(We.toString()),rt=ut.fontStack||wt,et=ne[rt]=ne[rt]||{};this.calculateGlyphDependencies(ut.text,et,Rt,this.allowVerticalPlacement,Tt)}}}if(g.get("symbol-placement")==="line"&&(this.features=function(Ee){const Ie={},Re={},Ne=[];let je=0;function ft(gt){Ne.push(Ee[gt]),je++}function We(gt,wt,Rt){const ut=Re[gt];return delete Re[gt],Re[wt]=ut,Ne[ut].geometry[0].pop(),Ne[ut].geometry[0]=Ne[ut].geometry[0].concat(Rt[0]),ut}function mt(gt,wt,Rt){const ut=Ie[wt];return delete Ie[wt],Ie[gt]=ut,Ne[ut].geometry[0].shift(),Ne[ut].geometry[0]=Rt[0].concat(Ne[ut].geometry[0]),ut}function St(gt,wt,Rt){const ut=Rt?wt[0][wt[0].length-1]:wt[0][0];return`${gt}:${ut.x}:${ut.y}`}for(let gt=0;gt<Ee.length;gt++){const wt=Ee[gt],Rt=wt.geometry,ut=wt.text?wt.text.toString():null;if(!ut){ft(gt);continue}const Tt=St(ut,Rt),rt=St(ut,Rt,!0);if(Tt in Re&&rt in Ie&&Re[Tt]!==Ie[rt]){const et=mt(Tt,rt,Rt),Pt=We(Tt,rt,Ne[et].geometry);delete Ie[Tt],delete Re[rt],Re[St(ut,Ne[Pt].geometry,!0)]=Pt,Ne[et].geometry=null}else Tt in Re?We(Tt,rt,Rt):rt in Ie?mt(Tt,rt,Rt):(ft(gt),Ie[Tt]=je-1,Re[rt]=je-1)}return Ne.filter(gt=>gt.geometry)}(this.features)),g.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",a.elevationFeatures){!this.elevationFeatures&&a.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ee of a.elevationFeatures)this.elevationFeatureIdToIndex.set(Ee.id,this.elevationFeatures.length),this.elevationFeatures.push(Ee)}}else g.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ee,Ie)=>Ee.sortKey-Ie.sortKey)}update(i,a,h,d,_,g,b){this.text.programConfigurations.updatePaintArrays(i,a,_,h,d,g,b,this.worldview),this.icon.programConfigurations.updatePaintArrays(i,a,_,h,d,g,b,this.worldview)}updateRoadElevation(i){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let a=!1;const h=Xe(i),d=1/h;let _=!1,g=!1;for(let b=0;b<this.symbolInstances.length;b++){const T=this.symbolInstances.get(b),S=xi(1,0,0),P=xi(0,1,0),{numHorizontalGlyphVertices:M,numVerticalGlyphVertices:L,numIconVertices:N,numVerticalIconVertices:B}=T,W=M>0||L>0,X=N>0,Z=this.elevationFeatures[T.elevationFeatureIndex];if(Z){const ne=new xt(T.tileAnchorX,T.tileAnchorY),se=.075+Z.pointElevation(ne);T.zOffset!==se&&(a=!0,T.zOffset=se);const le=Z.computeSlopeNormal(ne,d),Ee=on(Ai(),xi(0,0,1),le);Be(S,S,Ee),Be(P,P,Ee),S[2]*=h,P[2]*=h,S[0]===1&&S[1]===0&&S[2]===0&&P[0]===0&&P[1]===1&&P[2]===0||(_=_||W,g=g||X)}if(W&&(gw(this.text.orientationVertexArray,M,S,P),gw(this.text.orientationVertexArray,L,S,P)),X){const{placedIconSymbolIndex:ne,verticalPlacedIconSymbolIndex:se}=T;ne>=0&&gw(this.icon.orientationVertexArray,N,S,P),se>=0&&gw(this.icon.orientationVertexArray,B,S,P)}}_||(this.text.orientationVertexArray=void 0),g||(this.icon.orientationVertexArray=void 0),a&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const i=(_,g,b)=>{h+=g,h>_.length&&_.resize(h);for(let T=-g;T<0;T++)_.emplace(T+h,b)},a=(_,g,b)=>{d+=g,d>_.length&&_.resize(d);for(let T=-g;T<0;T++)_.emplace(T+d,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let h=0,d=0;for(let _=0;_<this.symbolInstances.length;_++){const g=this.symbolInstances.get(_),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:T,numIconVertices:S}=g,P=g.zOffset,M=S>0;if((b>0||T>0)&&(i(this.text.zOffsetVertexArray,b,P),i(this.text.zOffsetVertexArray,T,P)),M){const{placedIconSymbolIndex:L,verticalPlacedIconSymbolIndex:N}=g;L>=0&&a(this.icon.zOffsetVertexArray,S,P),N>=0&&a(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,P)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=sk(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,a){const h=this.lineVertexArray.length;if(i.segment!==void 0)for(const{x:d,y:_}of a)this.lineVertexArray.emplaceBack(d,_);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(i,a,h,d,_,g,b,T,S,P,M,L,N,B,W,X){const Z=i.indexArray,ne=i.layoutVertexArray,se=i.globeExtVertexArray,le=i.segments.prepareSegment(4*a.length,ne,Z,this.canOverlap?g.sortKey:void 0),Ee=this.glyphOffsetArray.length,Ie=le.vertexLength,Re=this.allowVerticalPlacement&&b===sl.vertical?Math.PI/2:0,Ne=g.text&&g.text.sections;for(let ft=0;ft<a.length;ft++){const{tl:We,tr:mt,bl:St,br:gt,texPrimary:wt,texSecondary:Rt,pixelOffsetTL:ut,pixelOffsetBR:Tt,minFontScaleX:rt,minFontScaleY:et,glyphOffset:Pt,isSDF:At,sectionIndex:mi}=a[ft],qt=le.vertexLength,si=Pt[1];if(pw(ne,S.x,S.y,We.x,si+We.y,wt.x,wt.y,h,At,ut.x,ut.y,rt,et),pw(ne,S.x,S.y,mt.x,si+mt.y,wt.x+wt.w,wt.y,h,At,Tt.x,ut.y,rt,et),pw(ne,S.x,S.y,St.x,si+St.y,wt.x,wt.y+wt.h,h,At,ut.x,Tt.y,rt,et),pw(ne,S.x,S.y,gt.x,si+gt.y,wt.x+wt.w,wt.y+wt.h,h,At,Tt.x,Tt.y,rt,et),T){const{x:Ot,y:pi,z:Ui}=T.anchor,[Ut,ci,Li]=T.up;_w(se,Ot,pi,Ui,Ut,ci,Li),_w(se,Ot,pi,Ui,Ut,ci,Li),_w(se,Ot,pi,Ui,Ut,ci,Li),_w(se,Ot,pi,Ui,Ut,ci,Li),yw(i.dynamicLayoutVertexArray,Ot,pi,Ui,Re)}else yw(i.dynamicLayoutVertexArray,S.x,S.y,S.z,Re);if(X){const Ot=Rt||wt;mw(i.iconTransitioningVertexArray,Ot.x,Ot.y),mw(i.iconTransitioningVertexArray,Ot.x+Ot.w,Ot.y),mw(i.iconTransitioningVertexArray,Ot.x,Ot.y+Ot.h),mw(i.iconTransitioningVertexArray,Ot.x+Ot.w,Ot.y+Ot.h)}Z.emplaceBack(qt,qt+1,qt+2),Z.emplaceBack(qt+1,qt+2,qt+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Pt[0]),ft!==a.length-1&&mi===a[ft+1].sectionIndex||i.programConfigurations.populatePaintArrays(ne.length,g,g.index,{},N,B,W,Ne&&Ne[mi],this.worldview)}const je=T?T.anchor:S;i.placedSymbolArray.emplaceBack(je.x,je.y,je.z,S.x,S.y,Ee,this.glyphOffsetArray.length-Ee,Ie,P,M,S.segment,h?h[0]:0,h?h[1]:0,d[0],d[1],b,0,0,0,L,0)}_commitLayoutVertex(i,a,h,d,_,g,b){i.emplaceBack(a,h,d,_,g,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(i,a,h,d,_,g,b){const T=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),S=T.vertexLength,P=b.tileAnchorX,M=b.tileAnchorY;for(let N=0;N<4;N++)h.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(h.collisionVertexArrayExt,a,i.padding,b.zOffset),this._commitLayoutVertex(h.layoutVertexArray,d,_,g,P,M,new xt(i.x1,i.y1)),this._commitLayoutVertex(h.layoutVertexArray,d,_,g,P,M,new xt(i.x2,i.y1)),this._commitLayoutVertex(h.layoutVertexArray,d,_,g,P,M,new xt(i.x2,i.y2)),this._commitLayoutVertex(h.layoutVertexArray,d,_,g,P,M,new xt(i.x1,i.y2)),T.vertexLength+=4;const L=h.indexArray;L.emplaceBack(S,S+1),L.emplaceBack(S+1,S+2),L.emplaceBack(S+2,S+3),L.emplaceBack(S+3,S),T.primitiveLength+=4}_addTextDebugCollisionBoxes(i,a,h,d,_,g){for(let b=d;b<_;b++){const T=h.get(b),S=this.getSymbolInstanceTextSize(i,g,a,b);this._addCollisionDebugVertices(T,S,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(i,a,h,d,_,g){for(let b=d;b<_;b++){const T=h.get(b),S=this.getSymbolInstanceIconSize(i,a,g.placedIconSymbolIndex);this._addCollisionDebugVertices(T,S,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,g)}}generateCollisionDebugBuffers(i,a,h){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new TS(G_,v6.members,Ds),this.iconCollisionBox=new TS(G_,v6.members,Ds);const d=_v(this.iconSizeData,i),_=_v(this.textSizeData,i,h);for(let g=0;g<this.symbolInstances.length;g++){const b=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(_,i,a,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(_,i,a,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(d,i,a,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(d,i,a,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(i,a,h,d){const _=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:d),g=mS(this.textSizeData,i,_)/co;return this.tilePixelRatio*g}getSymbolInstanceIconSize(i,a,h){const d=this.icon.placedSymbolArray.get(h),_=mS(this.iconSizeData,i,d);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(i,a,h,d){i.emplaceBack(a,-h,-h,d),i.emplaceBack(a,h,-h,d),i.emplaceBack(a,h,h,d),i.emplaceBack(a,-h,h,d)}_updateTextDebugCollisionBoxes(i,a,h,d,_,g,b){for(let T=d;T<_;T++){const S=h.get(T),P=this.getSymbolInstanceTextSize(i,g,a,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,P,S.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(i,a,h,d,_,g,b){for(let T=d;T<_;T++){const S=h.get(T),P=this.getSymbolInstanceIconSize(i,a,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,P,S.padding,g.zOffset)}}updateCollisionDebugBuffers(i,a,h,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const _=_v(this.iconSizeData,i,d),g=_v(this.textSizeData,i,h);for(let b=0;b<this.symbolInstances.length;b++){const T=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(g,i,a,T.textBoxStartIndex,T.textBoxEndIndex,T,h),this._updateTextDebugCollisionBoxes(g,i,a,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T,h),this._updateIconDebugCollisionBoxes(_,i,a,T.iconBoxStartIndex,T.iconBoxEndIndex,T,d),this._updateIconDebugCollisionBoxes(_,i,a,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,a,h,d,_,g,b,T,S){const P={};if(a<h){const{x1:M,y1:L,x2:N,y2:B,padding:W,projectedAnchorX:X,projectedAnchorY:Z,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:le,featureIndex:Ee}=i.get(a);P.textBox={x1:M,y1:L,x2:N,y2:B,padding:W,projectedAnchorX:X,projectedAnchorY:Z,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:le},P.textFeatureIndex=Ee}if(d<_){const{x1:M,y1:L,x2:N,y2:B,padding:W,projectedAnchorX:X,projectedAnchorY:Z,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:le,featureIndex:Ee}=i.get(d);P.verticalTextBox={x1:M,y1:L,x2:N,y2:B,padding:W,projectedAnchorX:X,projectedAnchorY:Z,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:le},P.verticalTextFeatureIndex=Ee}if(g<b){const{x1:M,y1:L,x2:N,y2:B,padding:W,projectedAnchorX:X,projectedAnchorY:Z,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:le,featureIndex:Ee}=i.get(g);P.iconBox={x1:M,y1:L,x2:N,y2:B,padding:W,projectedAnchorX:X,projectedAnchorY:Z,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:le},P.iconFeatureIndex=Ee}if(T<S){const{x1:M,y1:L,x2:N,y2:B,padding:W,projectedAnchorX:X,projectedAnchorY:Z,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:le,featureIndex:Ee}=i.get(T);P.verticalIconBox={x1:M,y1:L,x2:N,y2:B,padding:W,projectedAnchorX:X,projectedAnchorY:Z,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:le},P.verticalIconFeatureIndex=Ee}return P}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const h=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(i,a){const h=i.placedSymbolArray.get(a),d=h.vertexStartIndex+4*h.numGlyphs;for(let _=h.vertexStartIndex;_<d;_+=4)i.indexArray.emplaceBack(_,_+1,_+2),i.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(i),h=Math.cos(i),d=[],_=[],g=[];for(let b=0;b<this.symbolInstances.length;++b){g.push(b);const T=this.symbolInstances.get(b);d.push(0|Math.round(a*T.tileAnchorX+h*T.tileAnchorY)),_.push(T.featureIndex)}return g.sort((b,T)=>d[b]-d[T]||_[T]-_[b]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let i=0;i<this.symbolInstances.length;++i)this.symbolInstanceIndexesSortedZOffset.push(i)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((i,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(i).zOffset)}addToSortKeyRanges(i,a){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===a?h.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const h=this.symbolInstances.get(a);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:S}=h;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),_>=0&&_!==d&&this.addIndicesForPlacedSymbol(this.text,_),g>=0&&g!==_&&g!==d&&this.addIndicesForPlacedSymbol(this.text,g),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ok,ak,ES;Zt(vw,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),vw.addDynamicAttributes=yw;class lk{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Sa,this.defaultValue=i}evaluate(i){if(i.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(i.formattedSection))return a.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt(lk,"FormatSectionOverride",{omit:["defaultValue"]});const IS=()=>ES||(ES={layout:ok||(ok=new Kn({"symbol-placement":new Mt(qe.layout_symbol["symbol-placement"]),"symbol-spacing":new Mt(qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Mt(qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new jt(qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Mt(qe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Mt(qe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Mt(qe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Mt(qe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Mt(qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Mt(qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Mt(qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new jt(qe.layout_symbol["icon-size"]),"icon-size-scale-range":new Mt(qe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new jt(qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new jt(qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new jt(qe.layout_symbol["icon-image"]),"icon-image-use-theme":new Mt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new jt(qe.layout_symbol["icon-rotate"]),"icon-padding":new Mt(qe.layout_symbol["icon-padding"]),"icon-keep-upright":new Mt(qe.layout_symbol["icon-keep-upright"]),"icon-offset":new jt(qe.layout_symbol["icon-offset"]),"icon-anchor":new jt(qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Mt(qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Mt(qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Mt(qe.layout_symbol["text-rotation-alignment"]),"text-field":new jt(qe.layout_symbol["text-field"]),"text-font":new jt(qe.layout_symbol["text-font"]),"text-size":new jt(qe.layout_symbol["text-size"]),"text-size-scale-range":new Mt(qe.layout_symbol["text-size-scale-range"]),"text-max-width":new jt(qe.layout_symbol["text-max-width"]),"text-line-height":new jt(qe.layout_symbol["text-line-height"]),"text-letter-spacing":new jt(qe.layout_symbol["text-letter-spacing"]),"text-justify":new jt(qe.layout_symbol["text-justify"]),"text-radial-offset":new jt(qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Mt(qe.layout_symbol["text-variable-anchor"]),"text-anchor":new jt(qe.layout_symbol["text-anchor"]),"text-max-angle":new Mt(qe.layout_symbol["text-max-angle"]),"text-writing-mode":new Mt(qe.layout_symbol["text-writing-mode"]),"text-rotate":new jt(qe.layout_symbol["text-rotate"]),"text-padding":new Mt(qe.layout_symbol["text-padding"]),"text-keep-upright":new Mt(qe.layout_symbol["text-keep-upright"]),"text-transform":new jt(qe.layout_symbol["text-transform"]),"text-offset":new jt(qe.layout_symbol["text-offset"]),"text-allow-overlap":new Mt(qe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Mt(qe.layout_symbol["text-ignore-placement"]),"text-optional":new Mt(qe.layout_symbol["text-optional"]),visibility:new Mt(qe.layout_symbol.visibility)})),paint:ak||(ak=new Kn({"icon-opacity":new jt(qe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new jt(qe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new jt(qe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new jt(qe.paint_symbol["text-emissive-strength"]),"icon-color":new jt(qe.paint_symbol["icon-color"]),"icon-halo-color":new jt(qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new jt(qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new jt(qe.paint_symbol["icon-halo-blur"]),"icon-translate":new Mt(qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Mt(qe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Mt(qe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new jt(qe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new jt(qe.paint_symbol["text-occlusion-opacity"]),"text-color":new jt(qe.paint_symbol["text-color"],{runtimeType:Lo,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new jt(qe.paint_symbol["text-halo-color"]),"text-halo-width":new jt(qe.paint_symbol["text-halo-width"]),"text-halo-blur":new jt(qe.paint_symbol["text-halo-blur"]),"text-translate":new Mt(qe.paint_symbol["text-translate"]),"text-translate-anchor":new Mt(qe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Mt(qe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Mt(qe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Mt(qe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Mt(qe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new jt(qe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"})}))},ES);class xw extends Fo{constructor(i,a,h,d){super(i,IS(),a,h,d,i.layout?i.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Q([]),this.hasOcclusionOpacityProperties=i.paint!==void 0&&("icon-occlusion-opacity"in i.paint||"text-occlusion-opacity"in i.paint)}_handleSpecialPaintPropertyUpdate(i){i!=="icon-occlusion-opacity"&&i!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(i,a){super.recalculate(i,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const d=[];for(const _ of h)d.indexOf(_)<0&&d.push(_);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(i,a,h,d){return this._saturation===i&&this._contrast===a&&this._brightnessMin===h&&this._brightnessMax===d||(this._colorAdjustmentMatrix=function(_,g,b,T){_=Ss(_),g=Ms(g);const S=te(),P=_/3,M=1-2*P,L=[M,P,P,0,P,M,P,0,P,P,M,0,0,0,0,1],N=.5-.5*g,B=T-b;return Ce(S,[B,0,0,0,0,B,0,0,0,0,B,0,b,b,b,1],[g,0,0,0,0,g,0,0,0,0,g,0,N,N,N,1]),Ce(S,S,L),S}(i,a,h,d),this._saturation=i,this._contrast=a,this._brightnessMin=h,this._brightnessMax=d),this._colorAdjustmentMatrix}getValueAndResolveTokens(i,a,h,d){const _=this.layout.get(i).evaluate(a,{},h,d),g=this._unevaluatedLayout._values[i];return g.isDataDriven()||Iy(g.value)||!_?_:function(b,T){return T.replace(/{([^{}]+)}/g,(S,P)=>P in b?String(b[P]):"")}(a.properties,_)}createBucket(i){return new vw(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of IS().paint.overridableProperties){if(!xw.hasPaintOverride(this.layout,i))continue;const a=this.paint.get(i),h=new lk(a),d=new R_(h,a.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let _=null;_=a.value.kind==="constant"||a.value.kind==="source"?new Ap("source",d):new Ou("composite",d,a.value.zoomStops,a.value.interpolationType),this.paint._values[i]=new Wh(a.property,_,a.parameters)}}_handleOverridablePaintPropertyUpdate(i,a,h){return!(!this.layout||a.isDataDriven()||h.isDataDriven())&&xw.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,a){const h=i.get("text-field"),d=IS().paint.properties[a];let _=!1;const g=b=>{for(const T of b)if(d.overrides&&d.overrides.hasOverride(T))return void(_=!0)};if(h.value.kind==="constant"&&h.value.value instanceof _t)g(h.value.value.sections);else if(h.value.kind==="source"){const b=S=>{_||(S instanceof Di&&Er(S.value)===Bl?g(S.value.sections):S instanceof Vl?g(S.sections):S.eachChild(b))},T=h.value;T._styleExpression&&b(T._styleExpression.expression)}return _}getProgramIds(){return["symbol"]}getDefaultProgramParams(i,a,h){return{config:new ed(this,{zoom:a,lut:h}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let ck,uk,hk,dk;var SS=xr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function bw(l,i,a,h,d,_,g,b){const T=[l,i,1,a,h,1,d,_,1],S=[g,b,1],P=U([],T),[M,L,N]=nr(S,S,P);return $(T,T,[M,0,0,0,L,0,0,0,N])}function fk(l,i,a,h,d,_,g,b){const T=function(S,P,M,L,N,B,W,X){const Z=bw(0,0,1,0,1,1,0,1),ne=bw(S,P,M,L,N,B,W,X);return $(ne,ne,U([],Z))}(l,i,a,h,d,_,g,b);return[T[2]/T[8]/Ft,T[5]/T[8]/Ft]}function ww(l){return[l[0],Math.min(Math.max(l[1],-we),we)]}class pk extends mc{constructor(i,a,h,d){super(),this.id=i,this.dispatcher=h,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(d),this.options=a,this._dirty=!1}load(i,a){if(this._loaded=a||!1,this.fire(new Ea("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return i&&(this.coordinates=i),this._loaded=!0,void this._finishLoading();this._imageRequest=bl(this.map._requestManager.transformRequest(this.url,Bd.Image),(h,d)=>{this._imageRequest=null,this._loaded=!0,h?this.fire(new pc(h)):d&&(this.image=d instanceof HTMLImageElement?sa.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}setTexture(i){if(!(i.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new hv(this.map.painter.context,i.handle),this.width=i.dimensions[0],this.height=i.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ea("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(i){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof hv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(i){if(this.coordinates=i,this._boundsArray=void 0,this._unsupportedCoords=!1,!i.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=i[0][1],h=i[0][1];for(const _ of i)_[1]>h&&(h=_[1]),_[1]<a&&(a=_[1]);const d=(h+a)/2;if(d>we?this.onNorthPole=!0:d<-we&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const _=i.map(nt.fromLngLat);this.tileID=function(g){let b=1/0,T=1/0,S=-1/0,P=-1/0;for(const W of g)b=Math.min(b,W.x),T=Math.min(T,W.y),S=Math.max(S,W.x),P=Math.max(P,W.y);const M=Math.max(S-b,P-T),L=Math.max(0,Math.floor(-Math.log2(M))),N=Math.pow(2,L);let B=Math.floor((b+S)/2*N);return B>1&&(B-=1),new tu(L,B,Math.floor((T+P)/2*N))}(_),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ea("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof hv||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(i){for(const Z in this.tiles){const ne=this.tiles[Z];ne.state!=="loaded"&&(ne.state="loaded",ne.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=xv(new tu(0,0,0),this.map.transform.projection),h=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(Z){const ne=Z[1].x-Z[0].x,se=Z[1].y-Z[0].y,le=Z[2].x-Z[1].x,Ee=Z[2].y-Z[1].y,Ie=Z[3].x-Z[2].x,Re=Z[3].y-Z[2].y,Ne=Z[0].x-Z[3].x,je=Z[0].y-Z[3].y,ft=ne*Ee-le*se,We=le*Re-Ie*Ee,mt=Ie*je-Ne*Re,St=Ne*se-ne*je;return ft>0&&We>0&&mt>0&&St>0||ft<0&&We<0&&mt<0&&St<0}(h))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const d=xv(this.tileID,this.map.transform.projection),[_,g,b,T]=this.coordinates.map(Z=>{const ne=d.projection.project(Z[0],Z[1]);return ek(d,ne)._round()});this.perspectiveTransform=fk(_.x,_.y,g.x,g.y,b.x,b.y,T.x,T.y);const S=this._boundsArray=new Yh;S.emplaceBack(_.x,_.y,0,0),S.emplaceBack(g.x,g.y,Ft,0),S.emplaceBack(T.x,T.y,0,Ft),S.emplaceBack(b.x,b.y,Ft,Ft),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=i.createVertexBuffer(S,SS.members),this.boundsSegments=jn.simpleSegment(0,0,4,2);const P=[],M=[ww((L=this.coordinates)[0]),ww(L[1]),ww(L[2]),ww(L[3])];var L;const[N,B,W,X]=function(Z){let ne=Z[0][0],se=ne,le=Z[0][1],Ee=le;for(let Ie=1;Ie<Z.length;Ie++)Z[Ie][0]<ne?ne=Z[Ie][0]:Z[Ie][0]>se&&(se=Z[Ie][0]),Z[Ie][1]<le?le=Z[Ie][1]:Z[Ie][1]>Ee&&(Ee=Z[Ie][1]);return[ne,le,se-ne,Ee-le]}(M);{const Z=new Yh,[ne,se,le,Ee]=function(ut){let Tt=ut[0].x,rt=Tt,et=ut[0].y,Pt=et;for(let At=1;At<ut.length;At++)ut[At].x<Tt?Tt=ut[At].x:ut[At].x>rt&&(rt=ut[At].x),ut[At].y<et?et=ut[At].y:ut[At].y>Pt&&(Pt=ut[At].y);return[Tt,et,rt-Tt,Pt-et]}(h),Ie=ut=>[(ut.x-ne)/le,(ut.y-se)/Ee],[Re,Ne,je,ft]=h.map(Ie),We=function(ut,Tt,rt,et,Pt,At,mi,qt){const si=bw(0,0,1,0,1,1,0,1);return $(si,si,U([],bw(ut,Tt,rt,et,Pt,At,mi,qt)))}(Re[0],Re[1],Ne[0],Ne[1],je[0],je[1],ft[0],ft[1]);this.elevatedGlobePerspectiveTransform=fk(Re[0],Re[1],Ne[0],Ne[1],je[0],je[1],ft[0],ft[1]);const mt=(ut,Tt)=>{P.push(ut.lng);const rt=Math.round((ut.lng-N)/W*Ft),et=Math.round((ut.lat-B)/X*Ft),Pt=Ie(Tt),At=nr([],[Pt[0],Pt[1],1],We),mi=Math.round(At[0]/At[2]*Ft),qt=Math.round(At[1]/At[2]*Ft);Z.emplaceBack(rt,et,mi,qt)},St=h[3].x-h[0].x,gt=h[3].y-h[0].y,wt=h[2].x-h[1].x,Rt=h[2].y-h[1].y;for(let ut=0;ut<65;ut++){const Tt=ut/64,rt=[h[0].x+Tt*St,h[0].y+Tt*gt],et=[h[1].x+Tt*wt,h[1].y+Tt*Rt],Pt=et[0]-rt[0],At=et[1]-rt[1];for(let mi=0;mi<65;mi++){const qt=mi/64,si={x:rt[0]+Pt*qt,y:rt[1]+At*qt};mt(a.projection.unproject(si.x,si.y),si)}}this.elevatedGlobeVertexBuffer=i.createVertexBuffer(Z,SS.members)}{this.maxLongitudeTriangleSize=0;let Z=[],ne=new Us;const se=(le,Ee,Ie)=>{ne.emplaceBack(le,Ee,Ie);const Re=P[le],Ne=P[Ee],je=P[Ie],ft=Math.min(Math.min(Re,Ne),je),We=Math.max(Math.max(Re,Ne),je)-ft;We>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=We),Z.push(ft+We/2)};for(let le=0;le<64;le++)for(let Ee=0;Ee<64;Ee++){const Ie=65*le+Ee,Re=Ie+1,Ne=Ie+65,je=Ne+1;se(Ie,Ne,Re),se(Re,Ne,je)}[Z,ne]=function(le,Ee){const Ie=Array.from({length:le.length},(je,ft)=>ft);Ie.sort((je,ft)=>le[je]-le[ft]);const Re=[],Ne=new Us;for(let je=0;je<Ie.length;je++){const ft=Ie[je];Re.push(le[ft]);const We=3*ft,mt=We+1;Ne.emplaceBack(Ee.uint16[We],Ee.uint16[mt],Ee.uint16[mt+1])}return[Re,Ne]}(Z,ne),this.elevatedGlobeTrianglesCenterLongitudes=Z,this.elevatedGlobeIndexBuffer=i.createIndexBuffer(ne)}this.elevatedGlobeSegments=jn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,W/Ft,0,X/Ft,0,0,B,N,0])}prepare(){const i=Object.keys(this.tiles).length!==0;if(this.tileID&&!i)return;const a=this.map.painter.context,h=a.gl;!this._dirty||this.texture instanceof hv||(this.texture?this.texture.update(this.image):(this.texture=new eS(a,this.image,h.RGBA8),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),i&&this._prepareData(a)}loadTile(i,a){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},a(null)):(i.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(i){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const h=this.elevatedGlobeTrianglesCenterLongitudes;let d=(_=i+180)+360*Math.round((h[0]-_)/360);var _;const g=new jn,b=(M,L)=>{g.segments.push({vertexOffset:0,primitiveOffset:M,vertexLength:a.segments[0].vertexLength,primitiveLength:L,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(h[0]-d)<=T){const M=cs(h,0,h.length,d+T);return M===h.length||b(M,Fr(h,M+1,h.length,d+360-T)-M),g}d<h[0]&&(d+=360);const S=Fr(h,0,h.length,d-T);if(S===h.length)return b(0,h.length),g;b(0,S-0);const P=cs(h,S+1,h.length,d+T);return P!==h.length&&b(P,h.length-P),g}}const tG=(Math.pow(256,2)-1)/16907520;class mk extends Fo{constructor(i,a,h,d){super(i,{layout:hk||(hk=new Kn({visibility:new Mt(qe.layout_raster.visibility)})),paint:dk||(dk=new Kn({"raster-opacity":new Mt(qe.paint_raster["raster-opacity"]),"raster-color":new of(qe.paint_raster["raster-color"]),"raster-color-mix":new Mt(qe.paint_raster["raster-color-mix"]),"raster-color-range":new Mt(qe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Mt(qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Mt(qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Mt(qe.paint_raster["raster-brightness-max"]),"raster-saturation":new Mt(qe.paint_raster["raster-saturation"]),"raster-contrast":new Mt(qe.paint_raster["raster-contrast"]),"raster-resampling":new Mt(qe.paint_raster["raster-resampling"]),"raster-fade-duration":new Mt(qe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Mt(qe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Mt(qe.paint_raster["raster-array-band"]),"raster-elevation":new Mt(qe.paint_raster["raster-elevation"]),"raster-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"})}))},a,h,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(i){return!(i&&i._source instanceof pk&&(i._source.onNorthPole||i._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(i){i!=="raster-color"&&i!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(i){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[h,d]=i||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(h)&&isNaN(d)||h===this._curRampRange[0]&&d===this._curRampRange[1]||(this.colorRamp=Ky({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:h,end:d}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[h,d])}}let _k,gk,yk,vk,xk;class bk extends Fo{constructor(i,a,h,d){super(i,{layout:_k||(_k=new Kn({visibility:new Mt(qe["layout_raster-particle"].visibility)})),paint:gk||(gk=new Kn({"raster-particle-array-band":new Mt(qe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Mt(qe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new of(qe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Mt(qe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Mt(qe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Mt(qe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Mt(qe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Mt(qe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"})}))},a,h,d),this._updateColorRamp(),this.lastInvalidatedAt=sa.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(i){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(i){return!1}_handleSpecialPaintPropertyUpdate(i){i!=="raster-particle-color"&&i!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),i==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const i=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Ky({expression:i,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=sa.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class iG extends Fo{constructor(i,a){super(i,{},a,null),this.implementation=i,i.slot&&(this.slot=i.slot)}is3D(i){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(i){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}function AS(l,i,a){const h=[0,0,1],d=ni([]);return Ci(d,d,a?-Pe(l)+Math.PI:Pe(l)),bi(d,d,-Pe(i)),Be(h,h,d),Ni(h,h)}const wk={None:0,Model:1,Symbol:2,FillExtrusion:4};class Tw{constructor(i,a,h,d){this.message=(i?`${i}: `:"")+h,d&&(this.identifier=d),a!=null&&a.__line__&&(this.line=a.__line__)}}function CS(l,i){const a=l.indexOf("://")===-1;try{return new URL(l,a&&i?"http://example.com":void 0),!0}catch{return!1}}class Tk{constructor(i,a){this.feature=i,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Ek{constructor(){this.instancedDataArray=new Gy,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class RS{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=i.projection,this.index=i.index,this.worldview=i.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=i.styleDefinedModelURLs}updateFootprints(i,a){}populate(i,a,h,d){this.tileToMeter=Xe(h);const _=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:b,index:T,sourceLayerIndex:S}of i){const P=b??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),M=Ct(g,_);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom,{worldview:this.worldview}),M,h))continue;const L={id:P,sourceLayerIndex:S,index:T,geometry:_?M.geometry:$t(g,h,d),properties:g.properties,type:g.type,patterns:{}},N=this.addFeature(L,L.geometry,M);N&&a.featureIndex.insert(g,L.geometry,T,S,this.index,this.instancesPerModel[N].instancedDataArray.length,Ft/32)}this.lookup=null}update(i,a,h,d){for(const _ in this.instancesPerModel){const g=this.instancesPerModel[_];for(const b in i)g.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(g.features[g.idToFeaturesIndex[b]],i[b],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let i=!1;for(const a in this.instancesPerModel){const h=this.instancesPerModel[a];for(const d of h.features){const _=this.layers[0],g=d.feature,b=this.canonical,T=_.paint.get("model-rotation").evaluate(g,{},b),S=_.paint.get("model-scale").evaluate(g,{},b),P=_.paint.get("model-translation").evaluate(g,{},b);Qe(d.rotation,T)&&Qe(d.scale,S)&&Qe(d.translation,P)||(this.evaluate(d,d.featureStates,h,!0),i=!0)}}return i}updateReplacement(i,a,h,d){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const _=a.getReplacementRegionsForTile(i.toUnwrapped(),!0);if(Xb(this.activeReplacements,_))return!1;this.activeReplacements=_;let g=!1;for(const b in this.instancesPerModel){const T=this.instancesPerModel[b],S=T.instancedDataArray;for(const P of T.features){const M=P.instancedDataOffset,L=P.instancedDataCount;for(let N=0;N<L;N++){const B=16*(N+M);let W=S.float32[B+0];const X=W>Ft;W=X?W-Ft:W;const Z=Math.floor(W),ne=S.float32[B+1];let se=!1;for(const le of this.activeReplacements)if(!uM(le,h,wk.Model,d)&&!(le.min.x>Z||Z>le.max.x||le.min.y>ne||ne>le.max.y)&&(se=jI(pM(Z,ne,i.canonical,le.footprintTileId.canonical),le.footprint),se))break;S.float32[B]=se?W+Ft:W,g=g||se!==X}}}return g}isEmpty(){for(const i in this.instancesPerModel)if(this.instancesPerModel[i].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(i){if(!this.uploaded)for(const a in this.instancesPerModel){const h=this.instancesPerModel[a];h.instancedDataArray.length<0||h.instancedDataArray.length===0||(h.instancedDataBuffer?h.instancedDataBuffer.updateData(h.instancedDataArray):h.instancedDataBuffer=i.createVertexBuffer(h.instancedDataArray,Mj.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const a in this.instancesPerModel){const h=this.instancesPerModel[a];h.instancedDataArray.length!==0&&h.instancedDataBuffer&&h.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(i&&this.modelUris&&this.modelsRequested)for(const a of this.modelUris)i.removeModel(a,"",!0)}addFeature(i,a,h){const d=this.layers[0],_=d.layout.get("model-id").evaluate(h,{},this.canonical);if(!_)return Ji(`modelId is not evaluated for layer ${d.id} and it is not going to get rendered.`),_;(CS(_,!1)||this.styleDefinedModelURLs[_]!==void 0)&&(this.modelUris.includes(_)||this.modelUris.push(_)),this.instancesPerModel[_]||(this.instancesPerModel[_]=new Ek);const g=this.instancesPerModel[_],b=g.instancedDataArray,T=new Tk(h,b.length);for(const S of a)for(const P of S){if(P.x<0||P.x>=Ft||P.y<0||P.y>=Ft)continue;if(this.lookupDim!==0){const L=(this.lookupDim-1)/Ft,N=this.lookupDim*(P.y*L|0)+P.x*L|0;if(this.lookup){if(this.lookup[N]!==0)continue;this.lookup[N]=1}}this.instanceCount++;const M=b.length;b.resize(M+1),g.instancesEvaluatedElevation.push(0),b.float32[16*M]=P.x,b.float32[16*M+1]=P.y}return T.instancedDataCount=g.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(i.id&&(g.idToFeaturesIndex[i.id]=g.features.length),g.features.push(T),this.evaluate(T,{},g,!1)),_}getModelUris(){return this.modelUris}evaluate(i,a,h,d){const _=this.layers[0],g=i.feature,b=this.canonical,T=i.rotation=_.paint.get("model-rotation").evaluate(g,a,b),S=i.scale=_.paint.get("model-scale").evaluate(g,a,b),P=i.translation=_.paint.get("model-translation").evaluate(g,a,b),M=_.paint.get("model-color").evaluate(g,a,b);M.a=_.paint.get("model-color-mix-intensity").evaluate(g,a,b);const L=[];this.maxVerticalOffset<P[2]&&(this.maxVerticalOffset=P[2]),this.maxScale=Math.max(Math.max(this.maxScale,S[0]),Math.max(S[1],S[2])),ZM(L,T,S);const N=Math.round(100*M.a)+M.b/1.05;for(let B=0;B<i.instancedDataCount;++B){const W=i.instancedDataOffset+B,X=16*W,Z=h.instancedDataArray.float32;let ne=0;d&&(ne=Z[X+6]-h.instancesEvaluatedElevation[W]);const se=0|Z[X+1];Z[X]=(0|Z[X])+M.r/1.05,Z[X+1]=se+M.g/1.05,Z[X+2]=N,Z[X+3]=1/(b.z>10?this.tileToMeter:Xe(b,se)),Z[X+4]=P[0],Z[X+5]=P[1],Z[X+6]=P[2]+ne,Z[X+7]=L[0],Z[X+8]=L[1],Z[X+9]=L[2],Z[X+10]=L[4],Z[X+11]=L[5],Z[X+12]=L[6],Z[X+13]=L[8],Z[X+14]=L[9],Z[X+15]=L[10],h.instancesEvaluatedElevation[W]=P[2]}}}let Ik,Sk;Zt(RS,"ModelBucket",{omit:["layers"]}),Zt(Ek,"PerModelAttributes"),Zt(Tk,"ModelFeature");class dg{constructor(i,a,h){this._demTile=i,this._dem=this._demTile.dem,this._scale=a,this._offset=h}static create(i,a,h){const d=h||i.findDEMTileFor(a);if(!d||!d.dem)return;const _=d.dem,g=d.tileID,b=1<<a.canonical.z-g.canonical.z;return new dg(d,_.dim/Ft/b,[(a.canonical.x/b-g.canonical.x)*_.dim,(a.canonical.y/b-g.canonical.y)*_.dim])}tileCoordToPixel(i,a){const h=a*this._scale+this._offset[1];return new xt(Math.floor(i*this._scale+this._offset[0]),Math.floor(h))}getElevationAt(i,a,h,d){const _=i*this._scale+this._offset[0],g=a*this._scale+this._offset[1],b=Math.floor(_),T=Math.floor(g),S=this._dem;return d=!!d,h?Ri(Ri(S.get(b,T,d),S.get(b,T+1,d),g-T),Ri(S.get(b+1,T,d),S.get(b+1,T+1,d),g-T),_-b):S.get(b,T,d)}getElevationAtPixel(i,a,h){return this._dem.get(i,a,!!h)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*_e(1,i)*this._dem.stride}}const PS=new Float32Array(262144),Xp=new Uint8Array(262144);function Ak(l){let i=0;if(l.meshes)for(const a of l.meshes)i=Math.max(i,a.aabb.max[2]);if(l.children)for(const a of l.children)i=Math.max(i,Ak(a));return i}function Ck(l,i,a){if(l.meshes)for(const h of l.meshes){if(h.aabb.min[0]===1/0)continue;const d=Fi.applyTransform(h.aabb,l.matrix);a.insert(i,d.min[0],d.min[1],d.max[0],d.max[1])}if(l.children)for(const h of l.children)Ck(h,i,a)}const Rk=["","wall","door","roof","window","lamp","logo"];class Pk{constructor(i){this.node=i,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:i.id,geometry:[],properties:{height:Ak(i)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Fi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let i=0;const a=new Fi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const h of this.node.meshes)this.node.lightMeshIndex!==i&&(h.transformedAabb=Fi.applyTransformFast(h.aabb,this.node.matrix),a.encapsulate(h.transformedAabb)),i++;this.aabb=a}return this.aabb}}class Ew{constructor(i,a,h,d,_,g,b,T){this.id=h,this.layers=i,this.layerIds=this.layers.map(S=>S.fqid),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.modelTraits|=og.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=og.HasMapboxMeshFeatures),_&&(this.modelTraits|=og.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.worldview=T,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const S of a)this.nodesInfo.push(new Pk(S)),Ck(S,b.featureIndexArray.length,b.grid),b.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,b.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(i,a){for(const h of this.getNodesInfo()){const d=h.node;d.footprint&&a.push({footprint:d.footprint,id:i})}}update(i){const a=Object.keys(i).length!==0;if(a&&!this.stateDependentLayers.length)return;const h=a?this.stateDependentLayers:this.layers;if(!xo(i,this.states))for(const d of h)this.evaluate(d,i);this.states=structuredClone(i)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(i){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const h of a){const d=h.node;this.uploaded?this.updatePbrBuffer(d):rS(d,i,!0)}for(const h of a)nw(h.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(i){let a=!1;if(!i.meshes)return a;for(const h of i.meshes)h.pbrBuffer&&(h.pbrBuffer.updateData(h.featureArray),a=!0);return a}needsReEvaluation(i,a,h){const d=i.transform.projectionOptions,_=i.style.getBrightness(),g=this.brightness!==_;if(!this.uploaded||this.dirty||d.name!==this.projection.name||Iv(h.paint.get("model-color").value,g)||Iv(h.paint.get("model-color-mix-intensity").value,g)||Iv(h.paint.get("model-roughness").value,g)||Iv(h.paint.get("model-emissive-strength").value,g)||Iv(h.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=d,this.brightness=_;const b=this.getNodesInfo();for(const T of b)T.state=null;return!0}return!1}evaluateTransform(i,a){if(i.transform.zoom===this.zoom)return;this.zoom=i.transform.zoom;const h=this.getNodesInfo(),d=this.id.canonical;for(const _ of h){const g=_.feature;_.evaluatedTranslation=a.paint.get("model-translation").evaluate(g,{},d),_.evaluatedScale=a.paint.get("model-scale").evaluate(g,{},d)}}evaluate(i,a){const h=this.getNodesInfo();for(const d of h){if(!d.node.meshes)continue;const _=d.feature,g=a&&a[_.id];if(xo(g,d.state))continue;d.state=structuredClone(g);const b=d.node.meshes&&d.node.meshes[0].featureData,T=d.evaluatedColor[2],S=d.evaluatedRMEA[2],P=this.id.canonical;if(d.hasTranslucentParts=!1,b){for(let M=0;M<Rk.length;M++){const L=Rk[M];L.length&&(_.properties.part=L);const N=i.paint.get("model-color").evaluate(_,g,P).toPremultipliedRenderColor(null),B=i.paint.get("model-color-mix-intensity").evaluate(_,g,P);d.evaluatedColor[M]=[N.r,N.g,N.b,B],d.evaluatedRMEA[M][0]=i.paint.get("model-roughness").evaluate(_,g,P),d.evaluatedRMEA[M][2]=i.paint.get("model-emissive-strength").evaluate(_,g,P),d.evaluatedRMEA[M][3]=N.a,d.emissionHeightBasedParams[M]=i.paint.get("model-height-based-emissive-strength-multiplier").evaluate(_,g,P),!d.hasTranslucentParts&&N.a<1&&(d.hasTranslucentParts=!0)}delete _.properties.part,nG(d,T!==d.evaluatedColor[2]||S!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=i.paint.get("model-emissive-strength").evaluate(_,g,P);d.evaluatedTranslation=i.paint.get("model-translation").evaluate(_,g,P),d.evaluatedScale=i.paint.get("model-scale").evaluate(_,g,P),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(i,a,h,d){const _=i.findDEMTileFor(h);if(_&&(_.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(_.dem&&_.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=_.tileID.overscaledZ;const g=dg.create(i,h,_);if(!g)return;this.modelTraits&og.HasMapboxMeshFeatures&&this.updateDEM(i,g,h,d);for(const b of this.getNodesInfo()){const T=b.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const S=T.footprint.vertices;let P=g.getElevationAt(S[0].x,S[0].y,!0,!0);for(let M=1;M<S.length;M++)P=Math.min(P,g.getElevationAt(S[M].x,S[M].y,!0,!0));T.elevation=P}}this.terrainTile=_.tileID.canonical,this.terrainExaggeration=a}}updateDEM(i,a,h,d){let _=a._dem._modifiedForSources[d];if(_===void 0&&(a._dem._modifiedForSources[d]=[],_=a._dem._modifiedForSources[d]),_.includes(h.canonical))return;const g=a._dem.dim;_.push(h.canonical);let b=!1;for(const T of this.getNodesInfo()){const S=T.node;if(!S.footprint||!S.footprint.grid)continue;const P=S.footprint.grid,M=a.tileCoordToPixel(P.min.x,P.min.y),L=a.tileCoordToPixel(P.max.x,P.max.y),N=Math.min(Math.min(g-L.y,M.x),Math.min(M.y,g-L.x));if(N<0)continue;const B=fe(N,2,5);let W=Math.max(0,M.x-B),X=Math.max(0,M.y-B),Z=Math.min(L.x+B,g-1),ne=Math.min(L.y+B,g-1);for(let Ie=X;Ie<=ne;++Ie)for(let Re=W;Re<=Z;++Re)Xp[Ie*g+Re]=255;let se=0,le=0;for(let Ie=0;Ie<P.cellsY;++Ie)for(let Re=0;Re<P.cellsX;++Re){if(!P.cells[Ie*P.cellsX+Re])continue;const Ne=a.tileCoordToPixel(P.min.x+Re/P.xScale,P.min.y+Ie/P.yScale),je=a.tileCoordToPixel(P.min.x+(Re+1)/P.xScale,P.min.y+(Ie+1)/P.yScale);for(let ft=Ne.y;ft<=Math.min(je.y+1,g-1);++ft)for(let We=Ne.x;We<=Math.min(je.x+1,g-1);++We)Xp[ft*g+We]===255&&(Xp[ft*g+We]=0,se+=a.getElevationAtPixel(We,ft),le++)}const Ee=se/le;W=Math.max(1,M.x-B),X=Math.max(1,M.y-B),Z=Math.min(L.x+B,g-2),ne=Math.min(L.y+B,g-2),b=!0;for(let Ie=X;Ie<=ne;++Ie)for(let Re=W;Re<=Z;++Re)Xp[Ie*g+Re]===0&&(PS[Ie*g+Re]=a._dem.set(Re,Ie,Ee));for(let Ie=1;Ie<B;++Ie){W=Math.max(1,M.x-Ie),X=Math.max(1,M.y-Ie),Z=Math.min(L.x+Ie,g-2),ne=Math.min(L.y+Ie,g-2);for(let Re=X;Re<=ne;++Re)for(let Ne=W;Ne<=Z;++Ne){const je=Re*g+Ne;if(Xp[je]===255){let ft=0,We=0,mt=-1,St=-1;for(let gt=-1;gt<=1;++gt)for(let wt=-1;wt<=1;++wt){const Rt=(Re+gt)*g+Ne+wt;if(Xp[Rt]>=Ie)continue;const ut=PS[Rt],Tt=Math.abs(ut);Tt>We&&(ft=ut,We=Tt,mt=wt,St=gt)}if(We>.1){const gt=1-(Ie+.5*Math.abs(mt*St))/B;let wt=a._dem.get(Ne,Re)+ft*gt;const Rt=a._dem.get(Ne+mt,Re+St),ut=a._dem.get(Ne-mt,Re-St,!0);(wt-Rt)*(wt-ut)>0&&(wt=(Rt+ut)/2),PS[je]=a._dem.set(Ne,Re,wt),Xp[je]=Ie}}}}}b&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=sa.now())}setFilter(i){this.filter=i?Rp(i):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(i=>this.filter.filter(new gn(this.id.overscaledZ,{worldview:this.worldview}),i.feature,this.id.canonical)):this.nodesInfo}destroy(){const i=this.getNodesInfo();for(const a of i)nw(a.node),nS(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(i,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const h=a.getReplacementRegionsForTile(i.toUnwrapped());for(const d of this.getNodesInfo()){const _=d.node.footprint;d.hiddenByReplacement=!!_&&!h.find(g=>g.footprint===_)}}getHeightAtTileCoord(i,a){const h=[],d=[0,0,0],_=Q([]);for(const g of this.getNodesInfo()){const b=g.node.meshes[0],T=b.transformedAabb;if(i<T.min[0]||a<T.min[1]||i>T.max[0]||a>T.max[1])continue;if(g.node.hidden===!0)return{height:1/0,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};de(_,g.node.matrix),d[0]=i,d[1]=a,ai(d,d,_);const S=(d[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*Hp|0,P=Math.min(63,(d[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*Hp|0)*Hp+Math.min(63,S),M=b.heightmap[P];if(!(M<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:M,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new xt(i,a),new xt(i,a),h),h.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function Iv(l,i){return l instanceof Ap&&!l.isLightConstant&&i}function rG(l,i,a,h,d,_,g,b){let T=(61440&i|(61440&i)>>4)>>8,S=(3840&i|(3840&i)>>4)>>4,P=240&i|(240&i)>>4;a[3]>0&&(T=Ri(T,255*a[0],a[3]),S=Ri(S,255*a[1],a[3]),P=Ri(P,255*a[2],a[3]));const M=T<<8|S,L=P<<8|Math.floor(255*h[3]),N=function(Ie){const Re=fe(Ie,0,2);return Math.min(Math.round(.5*Re*255),255)}(h[2])<<8|15*h[0]<<4|15*h[1],B=fe(d[0],0,1),W=fe(d[1],0,1),X=fe(d[2],0,1),Z=fe(d[3],0,1);let ne,se,le,Ee;if(B!==W&&g!==_&&W!==B){const Ie=g-_;se=1/(Ie*(W-B)),le=-(_+Ie*B)/(Ie*(W-B));const Re=fe(d[4],-1,1);Ee=Math.pow(10,Re),ne=255*X<<8|255*Z}else ne=65535,se=0,le=1,Ee=1;if(l.emplaceBack(M,L,N,ne,se,le,Ee),b){const Ie=b.length;b.clear();for(let Re=0;Re<Ie;Re++)b.emplaceBack(M,L,N,ne,se,le,Ee)}}function nG(l,i,a){const h=l.node;let d=0;const _=a&og.HasMeshoptCompression;for(const g of h.meshes){if(h.lights&&h.lightMeshIndex===d||!g.featureData)continue;g.featureArray=new pf,g.featureArray.reserve(g.featureData.length);let b=i;for(const T of g.featureData){const S=_?65535&T:T>>16&65535,P=_?T>>16&65535:65535&T,M=(15&P)<8?15&P:0,L=l.evaluatedRMEA[M],N=l.evaluatedColor[M],B=l.emissionHeightBasedParams[M];let W;if(b&&M===2&&h.lights&&(W=new pf,W.resize(10*h.lights.length)),rG(g.featureArray,S,N,L,B,g.aabb.min[2],g.aabb.max[2],W),W&&b){b=!1;const X=h.meshes[h.lightMeshIndex];X.featureArray=W,X.featureArray._trim()}}g.featureArray._trim(),d++}}function Mk(l,i,a,h){const d=1<<l.z;i.lat=ge((h/Ft+l.y)/d),i.lng=xe((a/Ft+l.x)/d)}function sG(l,i,a,h){const d=l.getNodesInfo()[i];if(!d||d.hiddenByReplacement||!d.node.meshes)return;let _=Number.MAX_VALUE;const g=d.node,b=a.tile,T=h.calculatePosMatrix(b.tileID.toUnwrapped(),h.worldSize),S=d.evaluatedScale;let P=0;h.elevation&&g.elevation&&(P=g.elevation*h.elevation.exaggeration()),Fe(T,T,[(g.anchor?g.anchor[0]:0)*(S[0]-1),(g.anchor?g.anchor[1]:0)*(S[1]-1),P]),Le(T,T,S);const M=a.queryGeometry,L=M.isPointQuery()?M.screenBounds:M.screenGeometry,N=function(W){const X=Ce([],T,W.matrix);Ce(X,h.expandedFarZProjMatrix,X);for(let Z=0;Z<W.meshes.length;++Z){const ne=W.meshes[Z];if(Z===W.lightMeshIndex)continue;const se=KM(L,h,X,ne.aabb);se!=null&&(_=Math.min(se,_))}if(W.children)for(const Z of W.children)N(Z)};if(N(g),_===Number.MAX_VALUE)return;const B=new H(0,0);return Mk(b.tileID.canonical,B,d.node.anchor[0],d.node.anchor[1]),{intersectionZ:_,position:B,feature:d.feature}}Zt(Ew,"Tiled3dModelBucket",{omit:["layers"]}),Zt(Pk,"Tiled3dModelFeature");const oG={circle:class extends Fo{constructor(l,i,a,h){super(l,{layout:_f||(_f=new Kn({"circle-sort-key":new jt(qe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Mt(qe.layout_circle["circle-elevation-reference"]),visibility:new Mt(qe.layout_circle.visibility)})),paint:eu||(eu=new Kn({"circle-radius":new jt(qe.paint_circle["circle-radius"]),"circle-color":new jt(qe.paint_circle["circle-color"]),"circle-blur":new jt(qe.paint_circle["circle-blur"]),"circle-opacity":new jt(qe.paint_circle["circle-opacity"]),"circle-translate":new Mt(qe.paint_circle["circle-translate"]),"circle-translate-anchor":new Mt(qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Mt(qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Mt(qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new jt(qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new jt(qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new jt(qe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Mt(qe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h)}createBucket(l){return new lo(l)}queryRadius(l){const i=l;return ql("circle-radius",this,i)+ql("circle-stroke-width",this,i)+Gu(this.paint.get("circle-translate"))}queryIntersectsFeature(l,i,a,h,d,_,g,b){const T=Tc(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a);return zP(l,h,_,g,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,S)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,i,a){const h=FP(this);return{config:new ed(this,{zoom:i,lut:a}),defines:h,overrideFog:!1}}is3D(l){return!l&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Fo{createBucket(l){return new BP(l)}constructor(l,i,a,h){super(l,{layout:VP||(VP=new Kn({visibility:new Mt(qe.layout_heatmap.visibility)})),paint:UP||(UP=new Kn({"heatmap-radius":new jt(qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new jt(qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Mt(qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new of(qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Mt(qe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ky({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(l){return ql("heatmap-radius",this,l)}queryIntersectsFeature(l,i,a,h,d,_,g,b){const T=this.paint.get("heatmap-radius").evaluate(i,a);return zP(l,h,_,g,b,!0,!0,new xt(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,i,a){return l==="heatmap"?{config:new ed(this,{zoom:i,lut:a}),overrideFog:!1}:{}}},hillshade:class extends Fo{constructor(l,i,a,h){super(l,{layout:jP||(jP=new Kn({visibility:new Mt(qe.layout_hillshade.visibility)})),paint:$P||($P=new Kn({"hillshade-illumination-direction":new Mt(qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Mt(qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Mt(qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Mt(qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Mt(qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Mt(qe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Mt(qe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,i,a){return{overrideFog:!1}}},fill:class extends Fo{constructor(l,i,a,h){super(l,{layout:nM||(nM=new Kn({"fill-sort-key":new jt(qe.layout_fill["fill-sort-key"]),visibility:new Mt(qe.layout_fill.visibility),"fill-elevation-reference":new Mt(qe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new jt(qe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:sM||(sM=new Kn({"fill-antialias":new Mt(qe.paint_fill["fill-antialias"]),"fill-opacity":new jt(qe.paint_fill["fill-opacity"]),"fill-color":new jt(qe.paint_fill["fill-color"]),"fill-outline-color":new jt(qe.paint_fill["fill-outline-color"]),"fill-translate":new Mt(qe.paint_fill["fill-translate"]),"fill-translate-anchor":new Mt(qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new jt(qe.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Mt(qe.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Mt(qe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new jt(qe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new jt(qe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new jt(qe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h)}getProgramIds(){const l=this.paint.get("fill-pattern"),i=l&&l.constantOr(1),a=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(l,i,a){return{config:new ed(this,{zoom:i,lut:a}),overrideFog:!1}}recalculate(l,i){super.recalculate(l,i);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new BI(l)}queryRadius(){return Gu(this.paint.get("fill-translate"))}queryIntersectsFeature(l,i,a,h,d,_){return!l.queryGeometry.isAboveHorizon&&Ca(Hu(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),h)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(l){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const i=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return l!=null?i&&!l:i}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Fo{constructor(l,i,a,h){super(l,{layout:CM||(CM=new Kn({visibility:new Mt(qe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Mt(qe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:RM||(RM=new Kn({"fill-extrusion-opacity":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new jt(qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new jt(qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new jt(qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new jt(qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new jt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new jt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new jt(qe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new jt(qe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Mt(qe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new Kb(l)}queryRadius(){return Gu(this.paint.get("fill-extrusion-translate"))}is3D(l){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,i,a,h,d,_,g,b,T){const S=Tc(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),P=this.paint.get("fill-extrusion-height").evaluate(i,a),M=this.paint.get("fill-extrusion-base").evaluate(i,a),L=[0,0],N=b&&_.elevation,B=_.elevation?_.elevation.exaggeration():1,W=l.tile.getBucket(this);if(N&&W instanceof Kb){const le=W.centroidVertexArray,Ee=T+1;Ee<le.length&&(L[0]=le.geta_centroid_pos0(Ee),L[1]=le.geta_centroid_pos1(Ee))}if(L[0]===0&&L[1]===1)return!1;_.projection.name==="globe"&&(h=AM([h],[new xt(0,0),new xt(Ft,Ft)],l.tileID.canonical).map(le=>le.polygon).flat());const X=N?b:null,[Z,ne]=function(le,Ee,Ie,Re,Ne,je,ft,We,mt,St,gt){return le.projection.name==="globe"?function(wt,Rt,ut,Tt,rt,et,Pt,At,mi,qt,si){const Ot=[],pi=[],Ui=wt.projection.upVectorScale(si,wt.center.lat,wt.worldSize).metersToTile,Ut=[0,0,0,1],ci=[0,0,0,1],Li=(or,Zi,ei,qi)=>{or[0]=Zi,or[1]=ei,or[2]=qi,or[3]=1},Hi=SM();ut>0&&(ut+=Hi),Tt+=Hi;for(const or of Rt){const Zi=[],ei=[];for(const qi of or){const Ir=qi.x+rt.x,ue=qi.y+rt.y,he=wt.projection.projectTilePoint(Ir,ue,si),it=wt.projection.upVector(si,qi.x,qi.y);let dt=ut,Vt=Tt;if(Pt){const Bt=OM(Ir,ue,ut,Tt,Pt,At,mi,qt);dt+=Bt.base,Vt+=Bt.top}ut!==0?Li(Ut,he.x+it[0]*Ui*dt,he.y+it[1]*Ui*dt,he.z+it[2]*Ui*dt):Li(Ut,he.x,he.y,he.z),Li(ci,he.x+it[0]*Ui*Vt,he.y+it[1]*Ui*Vt,he.z+it[2]*Ui*Vt),ai(Ut,Ut,et),ai(ci,ci,et),Zi.push(new $p(Ut[0],Ut[1],Ut[2])),ei.push(new $p(ci[0],ci[1],ci[2]))}Ot.push(Zi),pi.push(ei)}return[Ot,pi]}(le,Ee,Ie,Re,Ne,je,ft,We,mt,St,gt):ft?function(wt,Rt,ut,Tt,rt,et,Pt,At,mi){const qt=[],si=[],Ot=[0,0,0,1];for(const pi of wt){const Ui=[],Ut=[];for(const ci of pi){const Li=ci.x+Tt.x,Hi=ci.y+Tt.y,or=OM(Li,Hi,Rt,ut,et,Pt,At,mi);Ot[0]=Li,Ot[1]=Hi,Ot[2]=or.base,Ot[3]=1,Lt(Ot,Ot,rt),Ot[3]=Math.max(Ot[3],1e-5);const Zi=new $p(Ot[0]/Ot[3],Ot[1]/Ot[3],Ot[2]/Ot[3]);Ot[0]=Li,Ot[1]=Hi,Ot[2]=or.top,Ot[3]=1,Lt(Ot,Ot,rt),Ot[3]=Math.max(Ot[3],1e-5);const ei=new $p(Ot[0]/Ot[3],Ot[1]/Ot[3],Ot[2]/Ot[3]);Ui.push(Zi),Ut.push(ei)}qt.push(Ui),si.push(Ut)}return[qt,si]}(Ee,Ie,Re,Ne,je,ft,We,mt,St):function(wt,Rt,ut,Tt,rt){const et=[],Pt=[],At=rt[8]*Rt,mi=rt[9]*Rt,qt=rt[10]*Rt,si=rt[11]*Rt,Ot=rt[8]*ut,pi=rt[9]*ut,Ui=rt[10]*ut,Ut=rt[11]*ut;for(const ci of wt){const Li=[],Hi=[];for(const or of ci){const Zi=or.x+Tt.x,ei=or.y+Tt.y,qi=rt[0]*Zi+rt[4]*ei+rt[12],Ir=rt[1]*Zi+rt[5]*ei+rt[13],ue=rt[2]*Zi+rt[6]*ei+rt[14],he=rt[3]*Zi+rt[7]*ei+rt[15],it=qi+At,dt=Ir+mi,Vt=ue+qt,Bt=Math.max(he+si,1e-5),Yt=qi+Ot,gi=Ir+pi,ar=ue+Ui,lr=Math.max(he+Ut,1e-5);Li.push(new $p(it/Bt,dt/Bt,Vt/Bt)),Hi.push(new $p(Yt/lr,gi/lr,ar/lr))}et.push(Li),Pt.push(Hi)}return[et,Pt]}(Ee,Ie,Re,Ne,je)}(_,h,M,P,S,g,X,L,B,_.center.lat,l.tileID.canonical),se=l.queryGeometry;return function(le,Ee,Ie){let Re=1/0;Ca(Ie,Ee)&&(Re=LM(Ie,Ee[0]));for(let Ne=0;Ne<Ee.length;Ne++){const je=Ee[Ne],ft=le[Ne];for(let We=0;We<je.length-1;We++){const mt=je[We],St=[mt,je[We+1],ft[We+1],ft[We],mt];il(Ie,St)&&(Re=Math.min(Re,LM(Ie,St)))}}return Re!==1/0&&Re}(Z,ne,se.isPointQuery()?se.screenBounds:se.screenGeometry)}},building:class extends Fo{constructor(l,i,a,h){super(l,{layout:o6||(o6=new Kn({visibility:new Mt(qe.layout_building.visibility),"building-facade":new jt(qe.layout_building["building-facade"]),"building-facade-floors":new jt(qe.layout_building["building-facade-floors"]),"building-facade-unit-width":new jt(qe.layout_building["building-facade-unit-width"]),"building-facade-window":new jt(qe.layout_building["building-facade-window"]),"building-roof-shape":new jt(qe.layout_building["building-roof-shape"]),"building-height":new jt(qe.layout_building["building-height"]),"building-base":new jt(qe.layout_building["building-base"]),"building-flood-light-wall-radius":new jt(qe.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new jt(qe.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new jt(qe.layout_building["building-flip-roof-orientation"])})),paint:a6||(a6=new Kn({"building-opacity":new Mt(qe.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Mt(qe.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Mt(qe.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Mt(qe.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Mt(qe.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Mt(qe.paint_building["building-vertical-scale"]),"building-cast-shadows":new Mt(qe.paint_building["building-cast-shadows"]),"building-color":new jt(qe.paint_building["building-color"]),"building-emissive-strength":new jt(qe.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Mt(qe.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Mt(qe.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Mt(qe.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Mt(qe.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Mt(qe.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new s6(l)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(l){return!0}},line:class extends Fo{constructor(l,i,a,h){const d=g6();super(l,d,i,a,h),d.layout&&(this.layout=new Xh(d.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof Tp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(l,i){super.recalculate(l,i),this.paint._values["line-floorwidth"]=(()=>{if(fv)return fv;const a=g6();return fv=new n$(a.paint.properties["line-width"].specification),fv.useIntegerZoom=!0,fv})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new lS(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,i,a){const h=m6(this);return{config:new ed(this,{zoom:i,lut:a}),defines:h,overrideFog:!1}}queryRadius(l){const i=l,a=y6(ql("line-width",this,i),ql("line-gap-width",this,i)),h=ql("line-offset",this,i);return a/2+Math.abs(h)+Gu(this.paint.get("line-translate"))}queryIntersectsFeature(l,i,a,h,d,_){if(l.queryGeometry.isAboveHorizon)return!1;const g=Hu(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),b=l.pixelToTileUnitsFactor/2*y6(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),T=this.paint.get("line-offset").evaluate(i,a);return T&&(h=function(S,P){const M=[],L=new xt(0,0);for(let N=0;N<S.length;N++){const B=S[N],W=[];for(let X=0;X<B.length;X++){const Z=B[X],ne=B[X+1],se=X===0?L:Z.sub(B[X-1])._unit()._perp(),le=X===B.length-1?L:ne.sub(Z)._unit()._perp(),Ee=se._add(le)._unit();Ee._mult(1/(Ee.x*le.x+Ee.y*le.y)),W.push(Ee._mult(P)._add(Z))}M.push(W)}return M}(h,T*l.pixelToTileUnitsFactor)),function(S,P,M){for(let L=0;L<P.length;L++){const N=P[L];if(S.length>=3){for(let B=0;B<N.length;B++)if(Xs(S,N[B]))return!0}if(Ra(S,N,M))return!0}return!1}(g,h,b)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(l){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:xw,background:class extends Fo{constructor(l,i,a,h){super(l,{layout:ck||(ck=new Kn({visibility:new Mt(qe.layout_background.visibility)})),paint:uk||(uk=new Kn({"background-pitch-alignment":new Mt(qe.paint_background["background-pitch-alignment"]),"background-color":new Mt(qe.paint_background["background-color"]),"background-pattern":new Mt(qe.paint_background["background-pattern"]),"background-opacity":new Mt(qe.paint_background["background-opacity"]),"background-emissive-strength":new Mt(qe.paint_background["background-emissive-strength"]),"background-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,i,a){return{overrideFog:!1}}is3D(l){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:mk,"raster-particle":bk,sky:class extends Fo{constructor(l,i,a,h){super(l,{layout:yk||(yk=new Kn({visibility:new Mt(qe.layout_sky.visibility)})),paint:vk||(vk=new Kn({"sky-type":new Mt(qe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Mt(qe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Mt(qe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Mt(qe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Mt(qe.paint_sky["sky-gradient-radius"]),"sky-gradient":new of(qe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Mt(qe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Mt(qe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Mt(qe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ky({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(l,i){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),d=!h,_=l.style.light,g=_.properties.get("position");return d&&_.properties.get("anchor")==="viewport"&&Ji("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?AS(g.azimuthal,90-g.polar,i):AS(h[0],90-h[1],i)}const a=this.paint.get("sky-gradient-center");return AS(a[0],90-a[1],i)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends Fo{constructor(l,i,a,h){super(l,{paint:xk||(xk=new Kn({}))},i,null)}},model:class extends Fo{constructor(l,i,a,h){super(l,{layout:Ik||(Ik=new Kn({visibility:new Mt(qe.layout_model.visibility),"model-id":new jt(qe.layout_model["model-id"])})),paint:Sk||(Sk=new Kn({"model-opacity":new jt(qe.paint_model["model-opacity"]),"model-rotation":new jt(qe.paint_model["model-rotation"]),"model-scale":new jt(qe.paint_model["model-scale"]),"model-translation":new jt(qe.paint_model["model-translation"]),"model-color":new jt(qe.paint_model["model-color"]),"model-color-mix-intensity":new jt(qe.paint_model["model-color-mix-intensity"]),"model-type":new Mt(qe.paint_model["model-type"]),"model-cast-shadows":new Mt(qe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Mt(qe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Mt(qe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new jt(qe.paint_model["model-emissive-strength"]),"model-roughness":new jt(qe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new jt(qe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Mt(qe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Mt(qe.paint_model["model-front-cutoff"]),"model-elevation-reference":new Mt(qe.paint_model["model-elevation-reference"]),"model-color-use-theme":new jt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new RS(l)}getProgramIds(){return["model"]}is3D(l){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof Ew?Ft-1:0}queryIntersectsFeature(l,i,a,h,d,_){if(!this.modelManager)return!1;const g=this.modelManager,b=l.tile.getBucket(this);if(!(b&&b instanceof RS))return!1;for(const T in b.instancesPerModel){const S=b.instancesPerModel[T],P=i.id!==void 0?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(S.idToFeaturesIndex.hasOwnProperty(P)){const M=S.features[S.idToFeaturesIndex[P]],L=g.getModel(T,this.scope);if(!L)return!1;let N=te();const B=new H(0,0),W=b.canonical;let X=Number.MAX_VALUE;for(let Z=0;Z<M.instancedDataCount;++Z){const ne=16*(M.instancedDataOffset+Z),se=S.instancedDataArray.float32,le=[se[ne+4],se[ne+5],se[ne+6]];Mk(W,B,se[ne],0|se[ne+1]),YM(N,L,_,B,M.rotation,M.scale,le,!1,!1,!1),_.projection.name==="globe"&&(N=iS(N,_));const Ee=Ce([],_.projMatrix,N),Ie=l.queryGeometry,Re=KM(Ie.isPointQuery()?Ie.screenBounds:Ie.screenGeometry,_,Ee,L.aabb);Re!=null&&(X=Math.min(Re,X))}return X!==Number.MAX_VALUE&&X}}return!1}_handleOverridablePaintPropertyUpdate(l,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){const i=this._transitionablePaint._values[l];return i!=null&&i.value!=null&&i.value.expression!=null&&i.value.expression instanceof Ou}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Fo{constructor(l,i,a,h){super(l,{layout:oM||(oM=new Kn({"clip-layer-types":new Mt(qe.layout_clip["clip-layer-types"]),"clip-layer-scope":new Mt(qe.layout_clip["clip-layer-scope"])})),paint:aM||(aM=new Kn({}))},i,a,h)}recalculate(l,i){super.recalculate(l,i)}createBucket(l){return new lM(l)}is3D(l){return!0}}},MS=new Mr(0,0,0),kS={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},DS={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Iw={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},aG={PAINT_ORDER_FILL_AND_STROKE:1},Sv={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},kk={MASK_TYPE_LUMINANCE:1};function lG(l,i,a){l===1&&i.icons.push(function(h,d){return function(_){if(_.usvg_tree.height||(_.usvg_tree.height=_.usvg_tree.width),!_.metadata)return _;const{metadata:g}=_;if(g.content_area){const{content_area:b}=g;b.left==null&&(b.left=0),b.top==null&&(b.top=b.left),b.width==null&&(b.width=_.usvg_tree.width),b.height==null&&(b.height=b.width)}if(g.text_placeholder){const{text_placeholder:b}=g;b.top==null&&(b.top=b.left),b.height==null&&(b.height=b.width)}return g.stretch_x&&g.stretch_x.length&&Dk(g,"x"),g.stretch_y&&g.stretch_y.length&&Dk(g,"y"),_}(h.readFields(cG,{name:void 0},d))}(a,a.readVarint()+a.pos))}function Dk(l,i){const a=[],h=l[`stretch_${i}`];let d=null;for(let _=0;_<h.length;_++)d===null?d=a.length===0?h[0]:a[a.length-1][1]+h[_]:(a.push([d,d+h[_]]),d=null);l[`stretch_${i}_areas`]=a}function cG(l,i,a){l===1?i.name=a.readString():l===2?i.metadata=function(h,d){return h.readFields(uG,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},d)}(a,a.readVarint()+a.pos):l===3&&(i.usvg_tree=function(h,d){return h.readFields(fG,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},d)}(a,a.readVarint()+a.pos),i.data="usvg_tree")}function uG(l,i,a){l===1?i.stretch_x=a.readPackedVarint():l===2?i.stretch_y=a.readPackedVarint():l===3?i.content_area=Lk(a,a.readVarint()+a.pos):l===4?i.variables.push(function(h,d){return h.readFields(dG,{name:void 0},d)}(a,a.readVarint()+a.pos)):l===5&&(i.text_placeholder=Lk(a,a.readVarint()+a.pos))}function Lk(l,i){return l.readFields(hG,{},i)}function hG(l,i,a){l===1?i.left=a.readVarint():l===2?i.width=a.readVarint():l===3?i.top=a.readVarint():l===4&&(i.height=a.readVarint())}function dG(l,i,a){l===1?i.name=a.readString():l===2&&(i.rgb_color=Cw(a.readVarint()),i.value="rgb_color")}function fG(l,i,a){l===1?i.width=i.height=a.readVarint():l===2?i.height=a.readVarint():l===3?i.children.push(Sw(a,a.readVarint()+a.pos)):l===4?i.linear_gradients.push(function(h,d){return h.readFields(xG,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},d)}(a,a.readVarint()+a.pos)):l===5?i.radial_gradients.push(function(h,d){return h.readFields(wG,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},d)}(a,a.readVarint()+a.pos)):l===7?i.clip_paths.push(function(h,d){return h.readFields(TG,{children:[]},d)}(a,a.readVarint()+a.pos)):l===8&&i.masks.push(function(h,d){const _=h.readFields(EG,{left:0,width:20,mask_type:kk.MASK_TYPE_LUMINANCE,children:[]},d);return _.height==null&&(_.height=_.width),_.top==null&&(_.top=_.left),_}(a,a.readVarint()+a.pos))}function Sw(l,i){return l.readFields(pG,{},i)}function pG(l,i,a){l===1?(i.group=function(h,d){return h.readFields(mG,{opacity:255,children:[]},d)}(a,a.readVarint()+a.pos),i.node="group"):l===2&&(i.path=function(h,d){return h.readFields(gG,{paint_order:1,commands:[],step:1,diffs:[],rule:kS.PATH_RULE_NON_ZERO},d)}(a,a.readVarint()+a.pos),i.node="path")}function mG(l,i,a){l===1?i.transform=Aw(a,a.readVarint()+a.pos):l===2?i.opacity=a.readVarint():l===5?i.clip_path_idx=a.readVarint():l===6?i.mask_idx=a.readVarint():l===7&&i.children.push(Sw(a,a.readVarint()+a.pos))}function Aw(l,i){return l.readFields(_G,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},i)}function _G(l,i,a){l===1?i.sx=a.readFloat():l===2?i.ky=a.readFloat():l===3?i.kx=a.readFloat():l===4?i.sy=a.readFloat():l===5?i.tx=a.readFloat():l===6&&(i.ty=a.readFloat())}function gG(l,i,a){l===1?i.fill=function(h,d){return h.readFields(yG,{rgb_color:MS,paint:"rgb_color",opacity:255},d)}(a,a.readVarint()+a.pos):l===2?i.stroke=function(h,d){return h.readFields(vG,{rgb_color:MS,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},d)}(a,a.readVarint()+a.pos):l===3?i.paint_order=a.readVarint():l===5?a.readPackedVarint(i.commands):l===6?i.step=a.readFloat():l===7?a.readPackedSVarint(i.diffs):l===8&&(i.rule=a.readVarint())}function yG(l,i,a){l===1?(i.rgb_color=Cw(a.readVarint()),i.paint="rgb_color"):l===2?(i.linear_gradient_idx=a.readVarint(),i.paint="linear_gradient_idx"):l===3?(i.radial_gradient_idx=a.readVarint(),i.paint="radial_gradient_idx"):l===5&&(i.opacity=a.readVarint())}function Cw(l){return new Mr((l>>16&255)/255,(l>>8&255)/255,(255&l)/255,1)}function vG(l,i,a){l===1?(i.rgb_color=Cw(a.readVarint()),i.paint="rgb_color"):l===2?(i.linear_gradient_idx=a.readVarint(),i.paint="linear_gradient_idx"):l===3?(i.radial_gradient_idx=a.readVarint(),i.paint="radial_gradient_idx"):l===5?a.readPackedFloat(i.dasharray):l===6?i.dashoffset=a.readFloat():l===7?i.miterlimit=a.readFloat():l===8?i.opacity=a.readVarint():l===9?i.width=a.readFloat():l===10?i.linecap=a.readVarint():l===11&&(i.linejoin=a.readVarint())}function xG(l,i,a){l===1?i.transform=Aw(a,a.readVarint()+a.pos):l===2?i.spread_method=a.readVarint():l===3?i.stops.push(Ok(a,a.readVarint()+a.pos)):l===4?i.x1=a.readFloat():l===5?i.y1=a.readFloat():l===6?i.x2=a.readFloat():l===7&&(i.y2=a.readFloat())}function Ok(l,i){return l.readFields(bG,{offset:0,opacity:255,rgb_color:MS},i)}function bG(l,i,a){l===1?i.offset=a.readFloat():l===2?i.opacity=a.readVarint():l===3&&(i.rgb_color=Cw(a.readVarint()))}function wG(l,i,a){l===1?i.transform=Aw(a,a.readVarint()+a.pos):l===2?i.spread_method=a.readVarint():l===3?i.stops.push(Ok(a,a.readVarint()+a.pos)):l===4?i.cx=a.readFloat():l===5?i.cy=a.readFloat():l===6?i.r=a.readFloat():l===7?i.fx=a.readFloat():l===8?i.fy=a.readFloat():l===9&&(i.fr=a.readFloat())}function TG(l,i,a){l===1?i.transform=Aw(a,a.readVarint()+a.pos):l===2?i.clip_path_idx=a.readVarint():l===3&&i.children.push(Sw(a,a.readVarint()+a.pos))}function EG(l,i,a){l===1?i.left=i.top=a.readFloat():l===2?i.width=i.height=a.readFloat():l===3?i.top=a.readFloat():l===4?i.height=a.readFloat():l===5?i.mask_type=a.readVarint():l===6?i.mask_idx=a.readVarint():l===7&&i.children.push(Sw(a,a.readVarint()+a.pos))}class IG{static calculate(i={},a=[]){const h=new Map,d=new Map;if(Object.keys(i).length===0)return h;a.forEach(_=>{d.set(_.name,_.rgb_color||new Mr(0,0,0))});for(const[_,g]of Object.entries(i))d.has(_)?h.set(d.get(_).toString(),g):console.warn(`Ignoring unknown image variable "${_}"`);return h}}function fg(l,i=255,a){const h=i/255,d=l.toString(),_=a.has(d)?a.get(d).clone():l.clone();return _.a*=h,_.toString()}function Av(l,i){if(!Ya()){const a=document.createElement("canvas");return a.width=l,a.height=i,a}return new OffscreenCanvas(l,i)}function SG(l,i){const a=IG.calculate(i.params,l.metadata?l.metadata.variables:[]),h=l.usvg_tree,d=h.width,_=h.height,g=i.transform?i.transform:new DOMMatrix,b=Math.max(1,Math.round(d*g.a)),T=Math.max(1,Math.round(_*g.d)),S=new DOMMatrix([b/d,0,0,T/_,0,0]),P=Av(b,T).getContext("2d");return LS(P,S,h,h,a),P.getImageData(0,0,b,T)}function LS(l,i,a,h,d){for(const _ of h.children)Fk(l,i,a,_,d)}function Fk(l,i,a,h,d){h.group?(l.save(),function(_,g,b,T,S){const P=T.mask_idx!=null?b.masks[T.mask_idx]:null,M=T.clip_path_idx!=null?b.clip_paths[T.clip_path_idx]:null;if(T.transform&&(g=pg(T.transform).preMultiplySelf(g)),!function(B,W,X){return B.opacity!==255||W||X}(T,M!=null,P!=null))return void LS(_,g,b,T,S);const L=Av(_.canvas.width,_.canvas.height),N=L.getContext("2d");LS(N,g,b,T,S),M&&$k(N,g,b,M),P&&Gk(N,g,b,P,S),_.globalAlpha=T.opacity/255,_.drawImage(L,0,0)}(l,i,a,h.group,d),l.restore()):h.path&&(l.save(),function(_,g,b,T,S){_.setTransform(g),T.paint_order===aG.PAINT_ORDER_FILL_AND_STROKE?(zk(_,b,T,S),Bk(_,b,T,S)):(Bk(_,b,T,S),zk(_,b,T,S))}(l,i,a,h.path,d),l.restore())}function zk(l,i,a,h){const d=a.fill;if(!d)return;const _=d.opacity/255;switch(l.save(),l.beginPath(),Hk(a,l),d.paint){case"rgb_color":l.fillStyle=fg(d.rgb_color,d.opacity,h);break;case"linear_gradient_idx":{const g=i.linear_gradients[d.linear_gradient_idx];g.transform&&l.setTransform(pg(g.transform).preMultiplySelf(l.getTransform())),l.fillStyle=Vk(l,g,_,h);break}case"radial_gradient_idx":{const g=i.radial_gradients[d.radial_gradient_idx];g.transform&&l.setTransform(pg(g.transform).preMultiplySelf(l.getTransform())),l.fillStyle=Uk(l,g,_,h)}}l.fill(Nk(a)),l.restore()}function Nk(l){return l.rule===kS.PATH_RULE_NON_ZERO?"nonzero":l.rule===kS.PATH_RULE_EVEN_ODD?"evenodd":void 0}function Bk(l,i,a,h){const d=a.stroke;if(!d)return;const _=qk(a);l.lineWidth=d.width,l.miterLimit=d.miterlimit,l.setLineDash(d.dasharray),l.lineDashOffset=d.dashoffset;const g=d.opacity/255;switch(d.paint){case"rgb_color":l.strokeStyle=fg(d.rgb_color,d.opacity,h);break;case"linear_gradient_idx":l.strokeStyle=Vk(l,i.linear_gradients[d.linear_gradient_idx],g,h,!0);break;case"radial_gradient_idx":l.strokeStyle=Uk(l,i.radial_gradients[d.radial_gradient_idx],g,h,!0)}switch(d.linejoin){case Iw.LINE_JOIN_MITER_CLIP:case Iw.LINE_JOIN_MITER:l.lineJoin="miter";break;case Iw.LINE_JOIN_ROUND:l.lineJoin="round";break;case Iw.LINE_JOIN_BEVEL:l.lineJoin="bevel"}switch(d.linecap){case DS.LINE_CAP_BUTT:l.lineCap="butt";break;case DS.LINE_CAP_ROUND:l.lineCap="round";break;case DS.LINE_CAP_SQUARE:l.lineCap="square"}l.stroke(_)}function Vk(l,i,a,h,d=!1){if(i.stops.length===1){const L=i.stops[0];return fg(L.rgb_color,L.opacity*a,h)}const{x1:_,y1:g,x2:b,y2:T}=i;let S=new DOMPoint(_,g),P=new DOMPoint(b,T);if(d){const L=pg(i.transform);S=L.transformPoint(S),P=L.transformPoint(P)}const M=l.createLinearGradient(S.x,S.y,P.x,P.y);for(const L of i.stops)M.addColorStop(L.offset,fg(L.rgb_color,L.opacity*a,h));return M}function Uk(l,i,a,h,d=!1){if(i.stops.length===1){const Z=i.stops[0];return fg(Z.rgb_color,Z.opacity*a,h)}const _=pg(i.transform),{fx:g,fy:b,fr:T,cx:S,cy:P,r:M}=i;let L=new DOMPoint(g,b),N=new DOMPoint(S,P),B=T,W=M;if(d){L=_.transformPoint(L),N=_.transformPoint(N);const Z=(_.a+_.d)/2;B=T*Z,W=i.r*Z}const X=l.createRadialGradient(L.x,L.y,B,N.x,N.y,W);for(const Z of i.stops)X.addColorStop(Z.offset,fg(Z.rgb_color,Z.opacity*a,h));return X}function jk(l,i,a,h){const d=h.transform?pg(h.transform).preMultiplySelf(i):i,_=Av(l.canvas.width,l.canvas.height),g=_.getContext("2d");for(const T of h.children)if(T.group)jk(g,d,a,T.group);else if(T.path){const S=T.path,P=new Path2D;P.addPath(qk(S),d),g.fill(P,Nk(S))}const b=h.clip_path_idx!=null?a.clip_paths[h.clip_path_idx]:null;b&&$k(g,d,a,b),l.globalCompositeOperation="source-over",l.drawImage(_,0,0)}function $k(l,i,a,h){const d=Av(l.canvas.width,l.canvas.height);jk(d.getContext("2d"),i,a,h),l.globalCompositeOperation="destination-in",l.drawImage(d,0,0)}function Gk(l,i,a,h,d){if(h.children.length===0)return;const _=h.mask_idx!=null?a.masks[h.mask_idx]:null;_&&Gk(l,i,a,_,d);const g=l.canvas.width,b=l.canvas.height,T=Av(g,b),S=T.getContext("2d"),P=h.width,M=h.height,L=h.left,N=h.top,B=new Path2D,W=new Path2D;W.rect(L,N,P,M),B.addPath(W,i),S.clip(B);for(const ne of h.children)Fk(S,i,a,ne,d);const X=S.getImageData(0,0,g,b),Z=X.data;if(h.mask_type===kk.MASK_TYPE_LUMINANCE)for(let ne=0;ne<Z.length;ne+=4)Z[ne+3]=Z[ne+3]/255*(.2126*Z[ne]+.7152*Z[ne+1]+.0722*Z[ne+2]);S.putImageData(X,0,0),l.globalCompositeOperation="destination-in",l.drawImage(T,0,0)}function pg(l){return l?new DOMMatrix([l.sx,l.ky,l.kx,l.sy,l.tx,l.ty]):new DOMMatrix}function Hk(l,i){const a=l.step;let h=l.diffs[0]*a,d=l.diffs[1]*a;i.moveTo(h,d);for(let _=0,g=2;_<l.commands.length;_++)switch(l.commands[_]){case Sv.PATH_COMMAND_MOVE:h+=l.diffs[g++]*a,d+=l.diffs[g++]*a,i.moveTo(h,d);break;case Sv.PATH_COMMAND_LINE:h+=l.diffs[g++]*a,d+=l.diffs[g++]*a,i.lineTo(h,d);break;case Sv.PATH_COMMAND_QUAD:{const b=h+l.diffs[g++]*a,T=d+l.diffs[g++]*a;h=b+l.diffs[g++]*a,d=T+l.diffs[g++]*a,i.quadraticCurveTo(b,T,h,d);break}case Sv.PATH_COMMAND_CUBIC:{const b=h+l.diffs[g++]*a,T=d+l.diffs[g++]*a,S=b+l.diffs[g++]*a,P=T+l.diffs[g++]*a;h=S+l.diffs[g++]*a,d=P+l.diffs[g++]*a,i.bezierCurveTo(b,T,S,P,h,d);break}case Sv.PATH_COMMAND_CLOSE:i.closePath()}return i}function qk(l){return Hk(l,new Path2D)}class Rw{constructor(i){this.capacity=i,this.cache=new Map}get(i){if(!this.cache.has(i))return;const a=this.cache.get(i);return this.cache.delete(i),this.cache.set(i,a),a}put(i,a){this.cache.has(i)?this.cache.delete(i):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(i,a)}delete(i){this.cache.delete(i)}}Zt(Rw,"LRUCache");class OS{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(i){return new To(i,i.data)}getFromCache(i,a,h){return this.cacheMap.has(h)||this.cacheMap.set(h,new Rw(150)),this.cacheMap.get(h).get(lf(i.toString(),a))}setInCache(i,a,h,d){this.cacheDependenciesMap.has(d)||this.cacheDependenciesMap.set(d,new Map),this.cacheMap.has(d)||this.cacheMap.set(d,new Rw(150));const _=this.cacheDependenciesMap.get(d),g=lf(i.id.toString(),h);_.get(g)||_.set(g,new Set);const b=this.cacheMap.get(d),T=i.toString();_.get(g).add(T),b.put(lf(i.toString(),h),a)}removeImagesFromCacheByIds(i,a,h=0){if(!this.cacheMap.has(h)||!this.cacheDependenciesMap.has(h))return;const d=this.cacheMap.get(h),_=this.cacheDependenciesMap.get(h);for(const g of i){const b=lf(g.toString(),a);if(_.has(b)){for(const T of _.get(b))d.delete(T);_.delete(b)}}}rasterize(i,a,h,d,_=SG){const g=this.getFromCache(i,h,d);if(g)return g.clone();const b=_(a.icon,i.options),T=OS._getImage(b);return this.setInCache(i,T,h,d),T.clone()}}class Wk{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,a){const h=this.toIdx(i,a);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(i,a){return this.leaves[this.toIdx(i,a)]}toIdx(i,a){return a*this.size+i}}function Xk(l,i,a,h){let d=0,_=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(h[g])<1e-15){if(a[g]<l[g]||a[g]>i[g])return null}else{const b=1/h[g];let T=(l[g]-a[g])*b,S=(i[g]-a[g])*b;if(T>S){const P=T;T=S,S=P}if(T>d&&(d=T),S<_&&(_=S),d>_)return null}return d}function Zk(l,i,a,h,d,_,g,b,T,S,P){const M=h-l,L=d-i,N=_-a,B=g-l,W=b-i,X=T-a,Z=P[1]*X-P[2]*W,ne=P[2]*B-P[0]*X,se=P[0]*W-P[1]*B,le=M*Z+L*ne+N*se;if(Math.abs(le)<1e-15)return null;const Ee=1/le,Ie=S[0]-l,Re=S[1]-i,Ne=S[2]-a,je=(Ie*Z+Re*ne+Ne*se)*Ee;if(je<0||je>1)return null;const ft=Re*N-Ne*L,We=Ne*M-Ie*N,mt=Ie*L-Re*M,St=(P[0]*ft+P[1]*We+P[2]*mt)*Ee;return St<0||je+St>1?null:(B*ft+W*We+X*mt)*Ee}function Kk(l,i,a){return(l-i)/(a-i)}function Yk(l,i,a,h,d,_,g,b,T){const S=1<<a,P=_-h,M=g-d,L=(l+1)/S*P+h,N=(i+0)/S*M+d,B=(i+1)/S*M+d;b[0]=(l+0)/S*P+h,b[1]=N,T[0]=L,T[1]=B}class Jk{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(_){const g=Math.ceil(Math.log2(_.dim/8)),b=[];let T=Math.ceil(Math.pow(2,g));const S=1/T,P=(N,B,W,X,Z)=>{const ne=X?1:0,se=(N+1)*W-ne,le=B*W,Ee=(B+1)*W-ne;Z[0]=N*W,Z[1]=le,Z[2]=se,Z[3]=Ee};let M=new Wk(T);const L=[];for(let N=0;N<T*T;N++){P(N%T,Math.floor(N/T),S,!1,L);const B=Ef(L[0],L[1],_),W=Ef(L[2],L[1],_),X=Ef(L[2],L[3],_),Z=Ef(L[0],L[3],_);M.minimums.push(Math.min(B,W,X,Z)),M.maximums.push(Math.max(B,W,X,Z)),M.leaves.push(1)}for(b.push(M),T/=2;T>=1;T/=2){const N=b[b.length-1];M=new Wk(T);for(let B=0;B<T*T;B++){P(B%T,Math.floor(B/T),2,!0,L);const W=N.getElevation(L[0],L[1]),X=N.getElevation(L[2],L[1]),Z=N.getElevation(L[2],L[3]),ne=N.getElevation(L[0],L[3]),se=N.isLeaf(L[0],L[1]),le=N.isLeaf(L[2],L[1]),Ee=N.isLeaf(L[2],L[3]),Ie=N.isLeaf(L[0],L[3]),Re=Math.min(W.min,X.min,Z.min,ne.min),Ne=Math.max(W.max,X.max,Z.max,ne.max),je=se&&le&&Ee&&Ie;M.maximums.push(Ne),M.minimums.push(Re),M.leaves.push(Ne-Re<=5&&je?1:0)}b.push(M)}return b}(this.dem),h=a.length-1,d=a[h];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(a,0,0,h,0)}raycastRoot(i,a,h,d,_,g,b=1){return Xk([i,a,-100],[h,d,this.maximums[0]*b],_,g)}raycast(i,a,h,d,_,g,b=1){if(!this.nodeCount)return null;const T=this.raycastRoot(i,a,h,d,_,g,b);if(T==null)return null;const S=[],P=[],M=[],L=[],N=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:B,t:W,nodex:X,nodey:Z,depth:ne}=N.pop();if(this.leaves[B]){Yk(X,Z,ne,i,a,h,d,M,L);const le=1<<ne,Ee=(X+0)/le,Ie=(X+1)/le,Re=(Z+0)/le,Ne=(Z+1)/le,je=Ef(Ee,Re,this.dem)*b,ft=Ef(Ie,Re,this.dem)*b,We=Ef(Ie,Ne,this.dem)*b,mt=Ef(Ee,Ne,this.dem)*b,St=Zk(M[0],M[1],je,L[0],M[1],ft,L[0],L[1],We,_,g),gt=Zk(L[0],L[1],We,M[0],L[1],mt,M[0],M[1],je,_,g),wt=Math.min(St!==null?St:Number.MAX_VALUE,gt!==null?gt:Number.MAX_VALUE);if(wt!==Number.MAX_VALUE)return wt;{const Rt=ji([],_,g,W);if(Qk(je,ft,mt,We,Kk(Rt[0],M[0],L[0]),Kk(Rt[1],M[1],L[1]))>=Rt[2])return W}continue}let se=0;for(let le=0;le<this._siblingOffset.length;le++){Yk((X<<1)+this._siblingOffset[le][0],(Z<<1)+this._siblingOffset[le][1],ne+1,i,a,h,d,M,L),M[2]=-100,L[2]=this.maximums[this.childOffsets[B]+le]*b;const Ee=Xk(M,L,_,g);if(Ee!=null){const Ie=Ee;S[le]=Ie;let Re=!1;for(let Ne=0;Ne<se&&!Re;Ne++)Ie>=S[P[Ne]]&&(P.splice(Ne,0,le),Re=!0);Re||(P[se]=le),se++}}for(let le=0;le<se;le++){const Ee=P[le];N.push({idx:this.childOffsets[B]+Ee,t:S[Ee],nodex:(X<<1)+this._siblingOffset[Ee][0],nodey:(Z<<1)+this._siblingOffset[Ee][1],depth:ne+1})}}return null}_addNode(i,a,h){return this.minimums.push(i),this.maximums.push(a),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(i,a,h,d,_){if(i[d].isLeaf(a,h)===1)return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const g=d-1,b=i[g];let T=0,S=0;for(let P=0;P<this._siblingOffset.length;P++){const M=2*a+this._siblingOffset[P][0],L=2*h+this._siblingOffset[P][1],N=b.getElevation(M,L),B=b.isLeaf(M,L),W=this._addNode(N.min,N.max,B);B&&(T|=1<<P),S||(S=W)}for(let P=0;P<this._siblingOffset.length;P++)T&1<<P||this._construct(i,2*a+this._siblingOffset[P][0],2*h+this._siblingOffset[P][1],g,S+P)}}function Qk(l,i,a,h,d,_){return Ri(Ri(l,a,_),Ri(i,h,_),d)}function Ef(l,i,a){const h=a.dim,d=fe(l*h-.5,0,h-1),_=fe(i*h-.5,0,h-1),g=Math.floor(d),b=Math.floor(_),T=Math.min(g+1,h-1),S=Math.min(b+1,h-1);return Qk(a.get(g,b),a.get(T,b),a.get(g,S),a.get(T,S),d-g,_-b)}const AG={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function CG(l,i,a){return(256*l*256+256*i+a)/10-1e4}function RG(l,i,a){return 256*l+i+a/256-32768}class Pw{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,a,h,d=!1){if(this.uid=i,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return void Ji(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const _=this.dim=a.height-2,g=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=d,this._modifiedForSources={},!d){for(let T=0;T<_;T++)g[this._idx(-1,T)]=g[this._idx(0,T)],g[this._idx(_,T)]=g[this._idx(_-1,T)],g[this._idx(T,-1)]=g[this._idx(T,0)],g[this._idx(T,_)]=g[this._idx(T,_-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(_,-1)]=g[this._idx(_-1,0)],g[this._idx(-1,_)]=g[this._idx(0,_-1)],g[this._idx(_,_)]=g[this._idx(_-1,_-1)]}const b=h==="terrarium"?RG:CG;for(let T=0;T<g.length;++T){const S=4*T;this.floatView[T]=b(this.pixels[S],this.pixels[S+1],this.pixels[S+2])}this._timestamp=sa.now()}_buildQuadTree(){this._tree=new Jk(this)}get(i,a,h=!1){h&&(i=fe(i,-1,this.dim),a=fe(a,-1,this.dim));const d=this._idx(i,a);return this.floatView[d]}set(i,a,h){const d=this._idx(i,a),_=this.floatView[d];return this.floatView[d]=h,h-_}static getUnpackVector(i){return AG[i]}_idx(i,a){if(i<-1||i>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(i+1)}static pack(i,a){const h=[0,0,0,0],d=Pw.getUnpackVector(a);let _=Math.floor((i+d[3])/d[2]);return h[2]=_%256,_=Math.floor(_/256),h[1]=_%256,_=Math.floor(_/256),h[0]=_,h}getPixels(){return new qP({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,a,h){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let d=a*this.dim,_=a*this.dim+this.dim,g=h*this.dim,b=h*this.dim+this.dim;switch(a){case-1:d=_-1;break;case 1:_=d+1}switch(h){case-1:g=b-1;break;case 1:b=g+1}const T=-a*this.dim,S=-h*this.dim;for(let P=g;P<b;P++)for(let M=d;M<_;M++){const L=4*this._idx(M,P),N=4*this._idx(M+T,P+S);this.pixels[L+0]=i.pixels[N+0],this.pixels[L+1]=i.pixels[N+1],this.pixels[L+2]=i.pixels[N+2],this.pixels[L+3]=i.pixels[N+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function PG(l,i,a){l===1?i.headerLength=a.readFixed32():l===2?i.x=a.readVarint():l===3?i.y=a.readVarint():l===4?i.z=a.readVarint():l===5&&i.layers.push(function(h,d){return h.readFields(OG,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},d)}(a,a.readVarint()+a.pos))}function MG(l,i,a){l===1?(i.delta_filter=function(h,d){return h.readFields(kG,{blockSize:0},d)}(a,a.readVarint()+a.pos),i.filter="delta_filter"):l===2?(a.readVarint(),i.filter="zigzag_filter"):l===3?(a.readVarint(),i.filter="bitshuffle_filter"):l===4&&(a.readVarint(),i.filter="byteshuffle_filter")}function kG(l,i,a){l===1&&(i.blockSize=a.readVarint())}function DG(l,i,a){l===1?(a.readVarint(),i.codec="gzip_data"):l===2?(a.readVarint(),i.codec="jpeg_image"):l===3?(a.readVarint(),i.codec="webp_image"):l===4&&(a.readVarint(),i.codec="png_image")}function LG(l,i,a){let h=0,d=0;l===1?i.firstByte=a.readFixed64():l===2?i.lastByte=a.readFixed64():l===3?i.filters.push(function(_,g){return _.readFields(MG,{},g)}(a,a.readVarint()+a.pos)):l===4?i.codec=function(_,g){return _.readFields(DG,{},g)}(a,a.readVarint()+a.pos):l===5?d=a.readFloat():l===6?h=a.readFloat():l===7?i.bands.push(a.readString()):l===8?i.offset=a.readDouble():l===9&&(i.scale=a.readDouble()),i.offset===0&&(i.offset=d),i.scale===0&&(i.scale=h)}function OG(l,i,a){l===1?i.version=a.readVarint():l===2?i.name=a.readString():l===3?i.units=a.readString():l===4?i.tileSize=a.readVarint():l===5?i.buffer=a.readVarint():l===6?i.pixelFormat=a.readVarint():l===7&&i.dataIndex.push(function(h,d){return h.readFields(LG,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},d)}(a,a.readVarint()+a.pos))}function FG(l,i,a){if(l===2)(function(h,d,_){h.readFields(zG,_,d)})(a,a.readVarint()+a.pos,i);else if(l===3)throw new Error("Not implemented")}function zG(l,i,a){if(l===1){let h=0;const d=a.readVarint()+a.pos;for(;a.pos<d;)i[h++]=a.readVarint()}}function NG(l,i){if(i.length!==4)throw new Error(`Expected data of dimension 4 but got ${i.length}.`);let a=i[3];for(let h=2;h>=1;h--){const d=h===1?1:0,_=h===2?1:0;for(let g=0;g<i[0];g++){const b=i[1]*g;for(let T=d;T<i[1];T++){const S=i[2]*(T+b);for(let P=_;P<i[2];P++){const M=i[3]*(P+S);for(let L=0;L<i[3];L++){const N=M+L;l[N]+=l[N-a]}}}}a*=i[h]}return l}function BG(l){for(let i=0,a=l.length;i<a;i++)l[i]=l[i]>>>1^-(1&l[i]);return l}function VG(l,i){switch(i){case"uint32":return l;case"uint16":for(let a=0;a<l.length;a+=2){const h=l[a],d=l[a+1];l[a]=(240&h)>>4|(61440&h)>>8|(240&d)<<4|61440&d,l[a+1]=15&h|(3840&h)>>4|(15&d)<<8|(3840&d)<<4}return l;case"uint8":for(let a=0;a<l.length;a+=4){const h=l[a],d=l[a+1],_=l[a+2],g=l[a+3];l[a+0]=(192&h)>>6|(192&d)>>4|(192&_)>>2|192&g,l[a+1]=(48&h)>>4|(48&d)>>2|48&_|(48&g)<<2,l[a+2]=(12&h)>>2|12&d|(12&_)<<2|(12&g)<<4,l[a+3]=3&h|(3&d)<<2|(3&_)<<4|(3&g)<<6}return l;default:throw new Error(`Invalid pixel format, "${i}"`)}}Zt(Pw,"DEMData"),Zt(Jk,"DemMinMaxQuadTree",{omit:["dem"]});var Wl=Uint8Array,Cv=Uint16Array,UG=Int32Array,e3=new Wl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),t3=new Wl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),jG=new Wl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i3=function(l,i){for(var a=new Cv(31),h=0;h<31;++h)a[h]=i+=1<<l[h-1];var d=new UG(a[30]);for(h=1;h<30;++h)for(var _=a[h];_<a[h+1];++_)d[_]=_-a[h]<<5|h;return{b:a,r:d}},r3=i3(e3,2),n3=r3.b,$G=r3.r;n3[28]=258,$G[258]=28;for(var GG=i3(t3,0).b,s3=new Cv(32768),js=0;js<32768;++js){var mg=(43690&js)>>1|(21845&js)<<1;s3[js]=((65280&(mg=(61680&(mg=(52428&mg)>>2|(13107&mg)<<2))>>4|(3855&mg)<<4))>>8|(255&mg)<<8)>>1}var Rv=function(l,i,a){for(var h=l.length,d=0,_=new Cv(i);d<h;++d)l[d]&&++_[l[d]-1];var g,b=new Cv(i);for(d=1;d<i;++d)b[d]=b[d-1]+_[d-1]<<1;g=new Cv(1<<i);var T=15-i;for(d=0;d<h;++d)if(l[d])for(var S=d<<4|l[d],P=i-l[d],M=b[l[d]-1]++<<P,L=M|(1<<P)-1;M<=L;++M)g[s3[M]>>T]=S;return g},Pv=new Wl(288);for(js=0;js<144;++js)Pv[js]=8;for(js=144;js<256;++js)Pv[js]=9;for(js=256;js<280;++js)Pv[js]=7;for(js=280;js<288;++js)Pv[js]=8;var o3=new Wl(32);for(js=0;js<32;++js)o3[js]=5;var HG=Rv(Pv,9),qG=Rv(o3,5),FS=function(l){for(var i=l[0],a=1;a<l.length;++a)l[a]>i&&(i=l[a]);return i},nu=function(l,i,a){var h=i/8|0;return(l[h]|l[h+1]<<8)>>(7&i)&a},zS=function(l,i){var a=i/8|0;return(l[a]|l[a+1]<<8|l[a+2]<<16)>>(7&i)},WG=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],su=function(l,i,a){var h=new Error(i||WG[l]);if(h.code=l,Error.captureStackTrace&&Error.captureStackTrace(h,su),!a)throw h;return h},XG=new Wl(0),ZG=typeof TextDecoder<"u"&&new TextDecoder;try{ZG.decode(XG,{stream:!0})}catch{}const KG={gzip_data:"gzip"};class Ic extends Error{constructor(i){super(i),this.name="MRTError"}}const YG={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},a3={uint32:1,uint16:2,uint8:4},JG={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let NS;class Mw{constructor(i=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=i}getLayer(i){const a=this.layers[i];if(!a)throw new Ic(`Layer '${i}' not found`);return a}getHeaderLength(i){const a=new Uint8Array(i),h=new DataView(i);if(a[0]!==13)throw new Ic("File is not a valid MRT.");return h.getUint32(1,!0)}parseHeader(i){const a=new Uint8Array(i),h=this.getHeaderLength(i);if(a.length<h)throw new Ic(`Expected header with length >= ${h} but got buffer of length ${a.length}`);const d=new NS(a.subarray(0,h)).readFields(PG,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new Ic(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(const _ of d.layers)this.layers[_.name]=new l3(_,{cacheSize:this._cacheSize});return this}createDecodingTask(i){const a=[],h=this.getLayer(i.layerName);for(let d of i.blockIndices){const _=h.dataIndex[d],g=_.firstByte-i.firstByte,b=_.lastByte-i.firstByte;if(h._blocksInProgress.has(d))continue;const T={layerName:h.name,firstByte:g,lastByte:b,pixelFormat:h.pixelFormat,blockIndex:d,blockShape:[_.bands.length].concat(h.bandShape),buffer:h.buffer,codec:_.codec.codec,filters:_.filters.map(S=>S.filter)};h._blocksInProgress.add(d),a.push(T)}return new c3(a,()=>{a.forEach(d=>h._blocksInProgress.delete(d.blockIndex))},(d,_)=>{if(a.forEach(g=>h._blocksInProgress.delete(g.blockIndex)),d)throw d;_.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class l3{constructor({version:i,name:a,units:h,tileSize:d,pixelFormat:_,buffer:g,dataIndex:b},T){if(this.version=i,this.version!==1)throw new Ic(`Cannot parse raster layer encoded with MRT version ${i}`);this.name=a,this.units=h,this.tileSize=d,this.buffer=g,this.pixelFormat=YG[_],this.dataIndex=b,this.bandShape=[d+2*g,d+2*g,a3[this.pixelFormat]],this._decodedBlocks=new Rw(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return a3[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:i})=>i).flat()}processDecodedData(i){const a=i.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,i.data)}getBlockForBand(i){let a=0;switch(typeof i){case"string":for(const[h,d]of this.dataIndex.entries()){for(const[_,g]of d.bands.entries())if(g===i)return{bandIndex:a+_,blockIndex:h,blockBandIndex:_};a+=d.bands.length}break;case"number":for(const[h,d]of this.dataIndex.entries()){if(i>=a&&i<a+d.bands.length)return{bandIndex:i,blockIndex:h,blockBandIndex:i-a};a+=d.bands.length}break;default:throw new Ic(`Invalid band \`${JSON.stringify(i)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(i){let a=1/0,h=-1/0;const d=[],_=new Set;for(const g of i){const{blockIndex:b}=this.getBlockForBand(g);if(b<0)throw new Ic(`Invalid band: ${JSON.stringify(g)}`);const T=this.dataIndex[b];d.includes(b)||d.push(b),_.add(b),a=Math.min(a,T.firstByte),h=Math.max(h,T.lastByte)}if(_.size>this.cacheSize)throw new Ic(`Number of blocks to decode (${_.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:h,blockIndices:d}}hasBand(i){const{blockIndex:a}=this.getBlockForBand(i);return a>=0}hasDataForBand(i){const{blockIndex:a}=this.getBlockForBand(i);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(i){const{blockIndex:a,blockBandIndex:h}=this.getBlockForBand(i);if(a<0)throw new Ic(`Band not found: ${JSON.stringify(i)}`);const d=this._decodedBlocks.get(a.toString());if(!d)throw new Ic(`Data for band ${JSON.stringify(i)} of layer "${this.name}" not decoded.`);const _=this.dataIndex[a],g=this.bandShape.reduce((S,P)=>S*P,1),b=h*g,T=d.subarray(b,b+g);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:_.offset,scale:_.scale}}}Mw.setPbf=function(l){NS=l};class c3{constructor(i,a,h){this.tasks=i,this._onCancel=a,this._onComplete=h,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(i,a){this._finalized||(this._onComplete(i,a),this._finalized=!0)}}Mw.performDecoding=function(l,i){const a=new Uint8Array(l);return Promise.all(i.tasks.map(h=>{const{layerName:d,firstByte:_,lastByte:g,pixelFormat:b,blockShape:T,blockIndex:S,filters:P,codec:M}=h,L=a.subarray(_,g+1),N=new Uint32Array(T[0]*T[1]*T[2]);let B;if(M!=="gzip_data")throw new Ic(`Unhandled codec: ${M}`);return B=function(W,X){if(!globalThis.DecompressionStream&&X==="gzip_data")return Promise.resolve(((le=function(Re){Re[0]==31&&Re[1]==139&&Re[2]==8||su(6,"invalid gzip data");var Ne=Re[3],je=10;4&Ne&&(je+=2+(Re[10]|Re[11]<<8));for(var ft=(Ne>>3&1)+(Ne>>4&1);ft>0;ft-=!Re[je++]);return je+(2&Ne)}(se=W))+8>se.length&&su(6,"invalid gzip data"),function(Re,Ne,je,ft){var We=Re.length;if(!We||Ne.f&&!Ne.l)return je||new Wl(0);var mt=!je,St=mt||Ne.i!=2,gt=Ne.i;mt&&(je=new Wl(3*We));var wt,Rt,ut=function(bn){var wn=je.length;if(bn>wn){var mn=new Wl(Math.max(2*wn,bn));mn.set(je),je=mn}},Tt=Ne.f||0,rt=Ne.p||0,et=Ne.b||0,Pt=Ne.l,At=Ne.d,mi=Ne.m,qt=Ne.n,si=8*We;do{if(!Pt){Tt=nu(Re,rt,1);var Ot=nu(Re,rt+1,3);if(rt+=3,!Ot){var pi=Re[(ue=4+((rt+7)/8|0))-4]|Re[ue-3]<<8,Ui=ue+pi;if(Ui>We){gt&&su(0);break}St&&ut(et+pi),je.set(Re.subarray(ue,Ui),et),Ne.b=et+=pi,Ne.p=rt=8*Ui,Ne.f=Tt;continue}if(Ot==1)Pt=HG,At=qG,mi=9,qt=5;else if(Ot==2){var Ut=nu(Re,rt,31)+257,ci=nu(Re,rt+10,15)+4,Li=Ut+nu(Re,rt+5,31)+1;rt+=14;for(var Hi=new Wl(Li),or=new Wl(19),Zi=0;Zi<ci;++Zi)or[jG[Zi]]=nu(Re,rt+3*Zi,7);rt+=3*ci;var ei=FS(or),qi=(1<<ei)-1,Ir=Rv(or,ei);for(Zi=0;Zi<Li;){var ue,he=Ir[nu(Re,rt,qi)];if(rt+=15&he,(ue=he>>4)<16)Hi[Zi++]=ue;else{var it=0,dt=0;for(ue==16?(dt=3+nu(Re,rt,3),rt+=2,it=Hi[Zi-1]):ue==17?(dt=3+nu(Re,rt,7),rt+=3):ue==18&&(dt=11+nu(Re,rt,127),rt+=7);dt--;)Hi[Zi++]=it}}var Vt=Hi.subarray(0,Ut),Bt=Hi.subarray(Ut);mi=FS(Vt),qt=FS(Bt),Pt=Rv(Vt,mi),At=Rv(Bt,qt)}else su(1);if(rt>si){gt&&su(0);break}}St&&ut(et+131072);for(var Yt=(1<<mi)-1,gi=(1<<qt)-1,ar=rt;;ar=rt){var lr=(it=Pt[zS(Re,rt)&Yt])>>4;if((rt+=15&it)>si){gt&&su(0);break}if(it||su(2),lr<256)je[et++]=lr;else{if(lr==256){ar=rt,Pt=null;break}var rr=lr-254;lr>264&&(rr=nu(Re,rt,(1<<(tr=e3[Zi=lr-257]))-1)+n3[Zi],rt+=tr);var Yr=At[zS(Re,rt)&gi],On=Yr>>4;if(Yr||su(3),rt+=15&Yr,Bt=GG[On],On>3){var tr=t3[On];Bt+=zS(Re,rt)&(1<<tr)-1,rt+=tr}if(rt>si){gt&&su(0);break}St&&ut(et+131072);var yn=et+rr;if(et<Bt){var rn=0-Bt,Nr=Math.min(Bt,yn);for(rn+et<0&&su(3);et<Nr;++et)je[et]=(void 0)[rn+et]}for(;et<yn;++et)je[et]=je[et-Bt]}}Ne.l=Pt,Ne.p=ar,Ne.b=et,Ne.f=Tt,Pt&&(Tt=1,Ne.m=mi,Ne.d=At,Ne.n=qt)}while(!Tt);return et!=je.length&&mt?(wt=je,((Rt=et)==null||Rt>wt.length)&&(Rt=wt.length),new Wl(wt.subarray(0,Rt))):je.subarray(0,et)}(se.subarray(le,-8),{i:2},new Wl(((Z=se)[(ne=Z.length)-4]|Z[ne-3]<<8|Z[ne-2]<<16|Z[ne-1]<<24)>>>0))));var Z,ne,se,le;const Ee=KG[X];if(!Ee)throw new Error(`Unhandled codec: ${X}`);const Ie=new globalThis.DecompressionStream(Ee);return new Response(new Blob([W]).stream().pipeThrough(Ie)).arrayBuffer().then(Re=>new Uint8Array(Re))}(L,M).then(W=>(function(X,Z){X.readFields(FG,Z)}(new NS(W),N),new JG[b](N.buffer))),B.then(W=>{for(let X=P.length-1;X>=0;X--)switch(P[X]){case"delta_filter":NG(W,T);break;case"zigzag_filter":BG(W);break;case"bitshuffle_filter":VG(W,b);break;default:throw new Ic(`Unhandled filter "${P[X]}"`)}return{layerName:d,blockIndex:S,data:W}}).catch(W=>{throw W})}))},Zt(c3,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Zt(Mw,"MapboxRasterTile"),Zt(l3,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class u3{constructor(i){this._stringToNumber={},this._numberToString=[];for(let a=0;a<i.length;a++){const h=i[a];this._stringToNumber[h]=a,this._numberToString[a]=h}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const QG=["id","tile","layer","source","sourceLayer","state"];class _g{constructor(i,a,h,d,_){this.type="Feature",this._vectorTileFeature=i,this._z=a,this._x=h,this._y=d,this.properties=i.properties,this.id=_}clone(){const i=new _g(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(i.state=Object.assign({},this.state)),this.layer&&(i.layer=Object.assign({},this.layer)),this.source&&(i.source=this.source),this.sourceLayer&&(i.sourceLayer=this.sourceLayer),i}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of QG)this[a]!==void 0&&(i[a]=this[a]);return i}}class h3{constructor(i,a){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new $h(Ft,16,0),this.featureIndexArray=new kb,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(i,a,h,d,_,g=0,b=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,d,_,g);const S=this.grid;for(let P=0;P<a.length;P++){const M=a[P],L=[1/0,1/0,-1/0,-1/0];for(let N=0;N<M.length;N++){const B=M[N];L[0]=Math.min(L[0],B.x),L[1]=Math.min(L[1],B.y),L[2]=Math.max(L[2],B.x),L[3]=Math.max(L[3],B.y)}b!==0&&(L[0]-=b,L[1]-=b,L[2]+=b,L[3]+=b),L[0]<Ft&&L[1]<Ft&&L[2]>=0&&L[3]>=0&&S.insert(T,L[0],L[1],L[2],L[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Vi(new sw(this.rawTileData)).layers,this.sourceLayerCoder=new u3(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,a){const{tilespaceGeometry:h,transform:d,tileTransform:_,pixelPosMatrix:g,availableImages:b,worldview:T}=a;this.loadVTLayers(),this.serializedLayersCache.clear();const S=h.bufferedTilespaceBounds,P=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(B,W,X,Z)=>vs(h.bufferedTilespaceGeometry,B,W,X,Z));P.sort(eH);let M=null;d.elevation&&P.length>0&&(M=dg.create(d.elevation,this.tileID));const L={};let N;for(let B=0;B<P.length;B++){const W=P[B];if(W===N)continue;N=W;const X=this.featureIndexArray.get(W);let Z=null;this.is3DTile?this.loadMatchingModelFeature(L,X,i,h,d,T):this.loadMatchingFeature(L,X,i,b,T,(ne,se,le,Ee=0)=>(Z||(Z=$t(ne,this.tileID.canonical,_)),se.queryIntersectsFeature(h,ne,le,Z,this.z,d,g,M,Ee)))}return L}loadMatchingFeature(i,a,h,d,_,g){const{featureIndex:b,bucketIndex:T,sourceLayerIndex:S,layoutVertexArrayOffset:P}=a,M=this.bucketLayerIDs[T],L=h.layers,N=Object.keys(L);if(N.length&&!$i(N,M))return;const B=h.sourceCache,W=this.sourceLayerCoder.decode(S),X=this.vtLayers[W].feature(b),Z=this.getId(X,W);for(let ne=0;ne<M.length;ne++){const se=M[ne];if(!L[se])continue;const{styleLayer:le,targets:Ee}=L[se];let Ie={};Z!==void 0&&(Ie=B.getFeatureState(le.sourceLayer,Z));const Re=!g||g(X,le,Ie,P);if(!Re)continue;const Ne=new _g(X,this.z,this.x,this.y,Z);Ne.tile=this.tileID.canonical,Ne.state=Ie;let je=this.serializedLayersCache.get(se);je||(je=le.serialize(),je.id=se,this.serializedLayersCache.set(se,je)),Ne.source=je.source,Ne.sourceLayer=je["source-layer"],Ne.layer=Object.assign({},je),Ne.layer.paint=d3(je.paint,le.paint,X,Ie,d),Ne.layer.layout=d3(je.layout,le.layout,X,Ie,d);let ft=!1;for(const We of Ee){this.updateFeatureProperties(Ne,We);const{filter:mt}=We;if(mt){if(X.properties=Ne.properties,mt.needGeometry){const St=Ct(X,!0);if(!mt.filter(new gn(this.tileID.overscaledZ,{worldview:_}),St,this.tileID.canonical))continue}else if(!mt.filter(new gn(this.tileID.overscaledZ,{worldview:_}),X))continue}ft=!0,We.targetId&&this.addFeatureVariant(Ne,We)}ft&&this.appendToResult(i,se,b,Ne,Re)}}loadMatchingModelFeature(i,a,h,d,_,g){const{featureIndex:b,bucketIndex:T}=a,S=this.bucketLayerIDs[T],P=h.layers,M=Object.keys(P);if(!M.length||$i(M,S))for(let L=0;L<S.length;L++){const N=S[L],{styleLayer:B,targets:W}=P[N];if(B.type!=="model")continue;const X=d.tile,Z=X.getBucket(B);if(!(Z&&Z instanceof Ew))continue;const ne=sG(Z,b,d,_);if(!ne)continue;const{z:se,x:le,y:Ee}=X.tileID.canonical,{feature:Ie,intersectionZ:Re,position:Ne}=ne;let je={};Ie.id!==void 0&&(je=h.sourceCache.getFeatureState(B.sourceLayer,Ie.id));const ft=new _g({},se,le,Ee,Ie.id);ft.tile=this.tileID.canonical,ft.state=je,ft.properties=Ie.properties,ft.geometry={type:"Point",coordinates:[Ne.lng,Ne.lat]};let We=this.serializedLayersCache.get(N);We||(We=B.serialize(),We.id=N,this.serializedLayersCache.set(N,We)),ft.source=We.source,ft.sourceLayer=We["source-layer"],ft.layer=Object.assign({},We);let mt=!1;for(const St of W){this.updateFeatureProperties(ft,St);const{filter:gt}=St;if(gt){if(Ie.properties=ft.properties,gt.needGeometry){if(!gt.filter(new gn(this.tileID.overscaledZ,{worldview:g}),Ie,this.tileID.canonical))continue}else if(!gt.filter(new gn(this.tileID.overscaledZ,{worldview:g}),Ie))continue}mt=!0,St.targetId&&this.addFeatureVariant(ft,St)}mt&&this.appendToResult(i,N,b,ft,Re)}}updateFeatureProperties(i,a,h){if(a.properties){const d={};for(const _ in a.properties){const g=a.properties[_].evaluate({zoom:this.z},i._vectorTileFeature,i.state,i.tile,h);g!=null&&(d[_]=g)}i.properties=d}}addFeatureVariant(i,a,h){const d={target:a.target,namespace:a.namespace,uniqueFeatureID:a.uniqueFeatureID};a.properties&&(d.properties=i.properties),i.variants=i.variants||{},i.variants[a.targetId]=i.variants[a.targetId]||[],i.variants[a.targetId].push(d)}appendToResult(i,a,h,d,_){let g=i[a];g===void 0&&(g=i[a]=[]),g.push({featureIndex:h,feature:d,intersectionZ:_})}lookupSymbolFeatures(i,a,h,d,_,g){const b={};this.loadVTLayers();for(const T of i)this.loadMatchingFeature(b,{bucketIndex:a,sourceLayerIndex:h,featureIndex:T,layoutVertexArrayOffset:0},d,_,g);return b}loadFeature(i){const{featureIndex:a,sourceLayerIndex:h}=i;this.loadVTLayers();const d=this.sourceLayerCoder.decode(h),_=this.vtFeatures[d];if(_[a])return _[a];const g=this.vtLayers[d].feature(a);return _[a]=g,g}hasLayer(i){for(const a of this.bucketLayerIDs)for(const h of a)if(i===h)return!0;return!1}getId(i,a){let h=i.id;if(this.promoteId){const d=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[a];if(d!=null)if(Array.isArray(d)){if(!this.promoteIdExpression){const _=yc(d);if(_.result!=="success"){const g=_.value.map(b=>`${b.key}: ${b.message}`).join(", ");return void Ji(`Failed to create expression for promoteId: ${g}`)}this.promoteIdExpression=_.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Xc),h=this.promoteIdExpression.evaluate({zoom:0},i)}else h=i.properties[d];typeof h=="boolean"&&(h=Number(h))}return h}}function d3(l,i,a,h,d){return Ii(l,(_,g)=>{const b=i instanceof Xh?i.get(g):null;return b&&b.evaluate?b.evaluate(a,h,void 0,d):b})}function eH(l,i){return i-l}Zt(h3,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const f3=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class BS{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,h]=new Uint8Array(i,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=h>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const _=f3[15&h];if(!_)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(i,2,1),[b]=new Uint32Array(i,4,1);return new BS(b,g,_,i)}constructor(i,a=64,h=Float64Array,d){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=h,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const _=f3.indexOf(this.ArrayType),g=2*i*this.ArrayType.BYTES_PER_ELEMENT,b=i*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-b%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${h}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+b+T,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+g+b+T),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+b+T,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=i)}add(i,a){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=i,this.coords[this._pos++]=a,h}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return VS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,a,h,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:g,nodeSize:b}=this,T=[0,_.length-1,0],S=[];for(;T.length;){const P=T.pop()||0,M=T.pop()||0,L=T.pop()||0;if(M-L<=b){for(let X=L;X<=M;X++){const Z=g[2*X],ne=g[2*X+1];Z>=i&&Z<=h&&ne>=a&&ne<=d&&S.push(_[X])}continue}const N=L+M>>1,B=g[2*N],W=g[2*N+1];B>=i&&B<=h&&W>=a&&W<=d&&S.push(_[N]),(P===0?i<=B:a<=W)&&(T.push(L),T.push(N-1),T.push(1-P)),(P===0?h>=B:d>=W)&&(T.push(N+1),T.push(M),T.push(1-P))}return S}within(i,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:_,nodeSize:g}=this,b=[0,d.length-1,0],T=[],S=h*h;for(;b.length;){const P=b.pop()||0,M=b.pop()||0,L=b.pop()||0;if(M-L<=g){for(let X=L;X<=M;X++)m3(_[2*X],_[2*X+1],i,a)<=S&&T.push(d[X]);continue}const N=L+M>>1,B=_[2*N],W=_[2*N+1];m3(B,W,i,a)<=S&&T.push(d[N]),(P===0?i-h<=B:a-h<=W)&&(b.push(L),b.push(N-1),b.push(1-P)),(P===0?i+h>=B:a+h>=W)&&(b.push(N+1),b.push(M),b.push(1-P))}return T}}function VS(l,i,a,h,d,_){if(d-h<=a)return;const g=h+d>>1;p3(l,i,g,h,d,_),VS(l,i,a,h,g-1,1-_),VS(l,i,a,g+1,d,1-_)}function p3(l,i,a,h,d,_){for(;d>h;){if(d-h>600){const S=d-h+1,P=a-h+1,M=Math.log(S),L=.5*Math.exp(2*M/3),N=.5*Math.sqrt(M*L*(S-L)/S)*(P-S/2<0?-1:1);p3(l,i,a,Math.max(h,Math.floor(a-P*L/S+N)),Math.min(d,Math.floor(a+(S-P)*L/S+N)),_)}const g=i[2*a+_];let b=h,T=d;for(Mv(l,i,h,a),i[2*d+_]>g&&Mv(l,i,h,d);b<T;){for(Mv(l,i,b,T),b++,T--;i[2*b+_]<g;)b++;for(;i[2*T+_]>g;)T--}i[2*h+_]===g?Mv(l,i,h,T):(T++,Mv(l,i,T,d)),T<=a&&(h=T+1),a<=T&&(d=T-1)}}function Mv(l,i,a,h){US(l,a,h),US(i,2*a,2*h),US(i,2*a+1,2*h+1)}function US(l,i,a){const h=l[i];l[i]=l[a],l[a]=h}function m3(l,i,a,h){const d=l-a,_=i-h;return d*d+_*_}s.$=Y0,s.A=zt,s.B=lf,s.C=2,s.D=ig,s.E=mc,s.F=gv,s.G=V6,s.H=K0,s.I=la,s.J=z_,s.K=Bi,s.L=yp,s.M=S_,s.N=I_,s.O=Ty,s.P=xt,s.Q=Iy,s.R=Bd,s.S=Zh,s.T=eS,s.U=yc,s.V=Tw,s.W=Sy,s.X=Qd,s.Y=Jd,s.Z=f_,s._=Wo,s.a=function(l){return io.API_CDN_URL_REGEX.test(l)},s.a$=ge,s.a0=gp,s.a1=kh,s.a2=N_,s.a3=class extends Tw{},s.a4=A_,s.a5=wy,s.a6=qe,s.a7=function(l){const i=l.value;return i?gp(i)?CS(i,!0)?[]:[new Tw(l.key,i,`invalid url "${i}"`)]:[new Tw(l.key,i,`string expected, "${Bi(i)}" found`)]:[]},s.a8=_b,s.a9=Kn,s.aA=fe,s.aB=Ce,s.aC=Lt,s.aD=p,s.aE=Xs,s.aF=ce,s.aG=Ye,s.aH=function(l,i){const a={};for(let h=0;h<i.length;h++){const d=i[h];d in l&&(a[d]=l[d])}return a},s.aI=ee,s.aJ=ve,s.aK=class{constructor(l){this.entries={},this.scheduler=l}request(l,i,a,h){const d=this.entries[l]=this.entries[l]||{callbacks:[]};if(d.result){const[_,g]=d.result;return this.scheduler?this.scheduler.add(()=>{h(_,g)},i):h(_,g),()=>{}}return d.callbacks.push(h),d.cancel||(d.cancel=a((_,g)=>{d.result=[_,g];for(const b of d.callbacks)this.scheduler?this.scheduler.add(()=>{b(_,g)},i):b(_,g);setTimeout(()=>delete this.entries[l],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(_=>_!==h),d.callbacks.length||(d.cancel(),delete this.entries[l]))}}},s.aL=function(l,i,a){const h=JSON.stringify(l.request);return l.data&&(this.deduped.entries[h]={result:[null,l.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},d=>{const _=Iu(l.request,(g,b,T,S)=>{g?d(g):b&&d(null,{vectorTile:a?void 0:new Vi(new sw(b)),rawData:b,cacheControl:T,expires:S})});return()=>{_.cancel(),d()}},i)},s.aM=function(l){fc++,fc>oa&&(l.getActor().send("enforceCacheSizeLimit",Go),fc=0)},s.aN=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log2(l)))},s.aO=Ko,s.aP=mk,s.aQ=bk,s.aR=H,s.aS=pk,s.aT=function(l,i){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){i(null,a)};for(let h=0;h<l.length;h++){const d=document.createElement("source");Jm(l[h])||(a.crossOrigin="Anonymous"),d.src=l[h],a.appendChild(d)}return{cancel:()=>{}}},s.aU=hv,s.aV=function(l){return fetch(l).then(i=>i.arrayBuffer()).then(i=>HM(i,0,l))},s.aW=QM,s.aX=class{constructor(l,i,a,h){this.id=l,this.position=i!=null?new H(i[0],i[1]):new H(0,0),this.orientation=a??[0,0,0],this.nodes=h,this.uploaded=!1,this.aabb=new Fi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(l,i){if(Ce(l.matrix,i,l.matrix),l.meshes)for(const a of l.meshes){const h=Fi.applyTransformFast(a.aabb,l.matrix);this.aabb.encapsulate(h)}if(l.children)for(const a of l.children)this._applyTransformations(a,l.matrix)}computeBoundsAndApplyParent(){const l=Q([]);for(const i of this.nodes)this._applyTransformations(i,l)}computeModelMatrix(l,i,a,h,d,_,g=!1){YM(this.matrix,this,l.transform,this.position,i,a,h,d,_,g)}upload(l){if(!this.uploaded){for(const i of this.nodes)rS(i,l);for(const i of this.nodes)nw(i);this.uploaded=!0}}destroy(){for(const l of this.nodes)nS(l)}},s.aY=Qt,s.aZ=xv,s.a_=xe,s.aa=Mt,s.ab=class{constructor(l){this.specification=l}possiblyEvaluate(l,i){return $r(l.expression.evaluate(i))}interpolate(l,i,a){return{x:Ri(l.x,i.x,a),y:Ri(l.y,i.y,a),z:Ri(l.z,i.z,a),azimuthal:Ri(l.azimuthal,i.azimuthal,a),polar:Ri(l.polar,i.polar,a)}}},s.ac=gn,s.ad=Ou,s.ae=nt,s.af=ai,s.ag=Oe,s.ah=Ke,s.ai=Xh,s.aj=gf,s.ak=Ri,s.al=Ft,s.am=Wc,s.an=Pe,s.ao=Mr,s.ap=class{constructor(l){this.specification=l}possiblyEvaluate(l,i){return function([a,h]){const d=$r([1,a,h]);return{x:d.x,y:d.y,z:d.z}}(l.expression.evaluate(i))}interpolate(l,i,a){return{x:Ri(l.x,i.x,a),y:Ri(l.y,i.y,a),z:Ri(l.z,i.z,a)}}},s.aq=function(l,i,a=0,h=!0){const d=new xt(a,a),_=l.sub(d),g=i.add(d),b=[_,new xt(g.x,_.y),g,new xt(_.x,g.y)];return h&&b.push(_.clone()),b},s.ar=function(l,i){const a=[];for(let h=0;h<l.length;h++){const d=ze(h-1,-1,l.length-1),_=ze(h+1,-1,l.length-1),g=l[h],b=l[_],T=l[d].sub(g).unit(),S=b.sub(g).unit(),P=S.angleWithSep(T.x,T.y),M=T.add(S).unit().mult(-1*i/Math.sin(P/2));a.push(g.add(M))}return a},s.as=ek,s.at=vs,s.au=function(l,i,a=0){return xi(((i.x-a)*l.scale-l.x)*Ft,(i.y*l.scale-l.y)*Ft,pe(i.z,i.y))},s.av=ht,s.aw=Ni,s.ax=zr,s.ay=h6,s.az=function(l){let i=1/0,a=1/0,h=-1/0,d=-1/0;for(const _ of l)i=Math.min(i,_.x),a=Math.min(a,_.y),h=Math.max(h,_.x),d=Math.max(d,_.y);return{min:new xt(i,a),max:new xt(h,d)}},s.b=function(l){return io.API_FONTS_REGEX.test(l)},s.b$=jI,s.b0=Yh,s.b1=Us,s.b2=lt,s.b3=Hy,s.b4=vw,s.b5=function(){vc.isLoading()||vc.isLoaded()||F_()!=="deferred"||Gh()},s.b6=Rp,s.b7=Ct,s.b8=_g,s.b9=br,s.bA=Q,s.bB=pt,s.bC=te,s.bD=function(l,i){const{x:a,y:h}=l.point,d=DP(a,h,l.worldSize/l._pixelsPerMercatorPixel,0,0);return Ce(d,d,RI(qu(i)))},s.bE=O,s.bF=Ge,s.bG=function(l,i){var a=i[0]-l[0],h=i[1]-l[1],d=i[2]-l[2];return Math.sqrt(a*a+h*h+d*d)},s.bH=ji,s.bI=Wt,s.bJ=vt,s.bK=_v,s.bL=sl,s.bM=mS,s.bN=function(l,i,a,h,d){const _=5*i+2;l.float32[_+0]=a,l.float32[_+1]=h,l.float32[_+2]=d},s.bO=yw,s.bP=_r,s.bQ=ss,s.bR=es,s.bS=gs,s.bT=ze,s.bU=function(l,i,a,h){var d=new R(4);return d[0]=l,d[1]=i,d[2]=a,d[3]=h,d},s.bV=Yb,s.bW=il,s.bX=co,s.bY=uM,s.bZ=wk,s.b_=pM,s.ba=lS,s.bb=BI,s.bc=$t,s.bd=Vu,s.be=W_,s.bf=AP,s.bg=jn,s.bh=eg,s.bi=SS,s.bj=function(l,i){const a=gf(i.zoom);if(a===0)return qu(l);const h=Vb(l),d=CI(h),_=ce(h.getWest())*i.worldSize,g=ce(h.getEast())*i.worldSize,b=ve(h.getNorth())*i.worldSize,T=ve(h.getSouth())*i.worldSize,S=[_,b,0],P=[g,b,0],M=[_,T,0],L=[g,T,0],N=de([],i.globeMatrix);return ai(S,S,N),ai(P,P,N),ai(M,M,N),ai(L,L,N),d[0]=td(d[0],M,a),d[1]=td(d[1],L,a),d[2]=td(d[2],P,a),d[3]=td(d[3],S,a),Fi.fromPoints(d)},s.bk=jb,s.bl=de,s.bm=Zy,s.bn=td,s.bo=Kh,s.bp=C7,s.bq=me,s.br=Fe,s.bs=Mw,s.bt=sw,s.bu=Iu,s.bv=function(l,i){const a=[];for(const h in l)h in i||a.push(h);return a},s.bw=Ze,s.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.by=xo,s.bz=function(l){var i=new R(16);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=l[3],i[4]=l[4],i[5]=l[5],i[6]=l[6],i[7]=l[7],i[8]=l[8],i[9]=l[9],i[10]=l[10],i[11]=l[11],i[12]=l[12],i[13]=l[13],i[14]=l[14],i[15]=l[15],i},s.c=fp,s.c$=function(l){return l*l*l*l*l},s.c0=pS,s.c1=W6,s.c2=vS,s.c3=BS,s.c4=wi,s.c5=Ue,s.c6=ni,s.c7=function(l,i,a){a*=.5;var h=i[0],d=i[1],_=i[2],g=i[3],b=Math.sin(a),T=Math.cos(a);return l[0]=h*T+d*b,l[1]=d*T-h*b,l[2]=_*T+g*b,l[3]=g*T-_*b,l},s.c8=bi,s.c9=fn,s.cA=er,s.cB=WM,s.cC=tu,s.cD=PP,s.cE=function(l,i,a,h,d,_,g,b,T){if(T.name==="globe")return PP(l,i,new tu(a,h,d),!1);const S=xv({z:a,x:h,y:d},T);return new Fi([(_+S.x/S.scale)*i,i*(S.y/S.scale),g],[(_+S.x2/S.scale)*i,i*(S.y2/S.scale),b])},s.cF=function(l,i,a){return l[0]=Math.min(i[0],a[0]),l[1]=Math.min(i[1],a[1]),l[2]=Math.min(i[2],a[2]),l[3]=Math.min(i[3],a[3]),l},s.cG=function(l,i,a){return l[0]=Math.max(i[0],a[0]),l[1]=Math.max(i[1],a[1]),l[2]=Math.max(i[2],a[2]),l[3]=Math.max(i[3],a[3]),l},s.cH=function(l){const i=Math.round((l+45+360)%360/90)%4;return J[i]},s.cI=we,s.cJ=Ht,s.cK=x,s.cL=function(l){const i=Q(new Float64Array(16));Ce(i,l.pixelMatrix,l.globeMatrix);const a=[0,D,0],h=[0,F,0];return ai(a,a,i),ai(h,h,i),[a[0]>0&&a[0]<=l.width&&a[1]>0&&a[1]<=l.height&&!MI(l,new H(l.center.lat,90)),h[0]>0&&h[0]<=l.width&&h[1]>0&&h[1]<=l.height&&!MI(l,new H(l.center.lat,-90))]},s.cM=function(l,i){const{scale:a}=l.tileTransform,h=a*Ft/(l.tileSize*Math.pow(2,i.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return function(d,_,g){var b=_[1],T=_[2],S=_[3],P=g[0],M=g[1];return d[0]=_[0]*P,d[1]=b*P,d[2]=T*M,d[3]=S*M,d}(new Float32Array(4),i.inverseAdjustmentMatrix,[h,h])},s.cN=iw,s.cO=ke,s.cP=qM,s.cQ=function(l){const i=qM(l,!0);return O([],[i[0],i[1],i[4],i[5]])},s.cR=Le,s.cS=Hr,s.cT=Me,s.cU=function(l){const{x:i,y:a}=l.point,{lng:h,lat:d}=l._center;return DP(i,a,l.worldSize,h,d)},s.cV=Si,s.cW=q,s.cX=Q_,s.cY=wo,s.cZ=v,s.c_=function(l,i,a){let h=0;for(let d=0;d<2;++d)l[d]>0&&(h+=(l[d]-0)*(l[d]-0)),i[d]<0&&(h+=(0-i[d])*(0-i[d]));return h},s.ca=function(l,i){return l[0]=-i[0],l[1]=-i[1],l[2]=-i[2],l[3]=i[3],l},s.cb=Se,s.cc=function(l,i,a,h,d){var _=1/Math.tan(i/2);if(l[0]=_/a,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=_,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,d!=null&&d!==1/0){var g=1/(h-d);l[10]=(d+h)*g,l[14]=2*d*h*g}else l[10]=-1,l[14]=-2*h;return l},s.cd=function(l,i,a,h,d,_,g){var b=1/(i-a),T=1/(h-d),S=1/(_-g);return l[0]=-2*b,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*T,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*S,l[11]=0,l[12]=(i+a)*b,l[13]=(d+h)*T,l[14]=(g+_)*S,l[15]=1,l},s.ce=_e,s.cf=function(l,i,a){l[4*i+0]=a[0],l[4*i+1]=a[1],l[4*i+2]=a[2],l[4*i+3]=a[3]},s.cg=zp,s.ch=Np,s.ci=ys,s.cj=bc,s.ck=Vp,s.cl=sk,s.cm=function(){var l=new R(4);return R!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},s.cn=function(l,i,a){var h=i[0],d=i[1],_=i[2],g=i[3],b=Math.sin(a),T=Math.cos(a);return l[0]=h*T+_*b,l[1]=d*T+g*b,l[2]=h*-b+_*T,l[3]=d*-b+g*T,l},s.co=function(l,i){return l[0]===i[0]&&l[1]===i[1]&&l[2]===i[2]&&l[3]===i[3]},s.cp=Qe,s.cq=function(l){var i=l[0],a=l[1],h=l[2],d=l[3];return Math.sqrt(i*i+a*a+h*h+d*d)},s.cr=wr,s.cs=Be,s.ct=J_,s.cu=3,s.cv=2,s.cw=7,s.cx=6,s.cy=Xt,s.cz=Ve,s.d=function(l){return io.API_TILEJSON_REGEX.test(l)},s.d$=m6,s.d0=ae,s.d1=45,s.d2=Bp,s.d3=function(l,i,a){const h=Math.sqrt(l*l+i*i+a*a),d=h>0?Math.acos(a/h)*gr:0;let _=l!==0||i!==0?Math.atan2(-i,-l)*gr+90:0;return _<0&&(_+=360),[h,_,d]},s.d4=xi,s.d5=$r,s.d6=Xe,s.d7=ti,s.d8=Fi,s.d9=ri,s.dA=function(l,i,a){const h=gf(a.zoom),d=l.style.map._antialias,_=l.terrain&&l.terrain.exaggeration()>0;return h===0&&!d&&!_},s.dB=function(l){const i=l.pixelsPerMeter,a=i/_e(1,l.center.lat),h=Q(new Float64Array(16));return Fe(h,h,[l.point.x,l.point.y,0]),Le(h,h,[a,a,i]),Float32Array.from(h)},s.dC=Vb,s.dD=function(l){const i=we-5;l=fe(l,-i,i)/i*90;const a=Math.pow(Math.abs(Math.sin(Pe(l))),3);return Math.round(a*(C.length-1))},s.dE=function(l,i,a,h){const d=i.getNorth(),_=i.getSouth(),g=i.getWest(),b=i.getEast(),T=1<<l.z,S=b-g,P=d-_,M=S/I,L=-P/C[a],N=[0,M,0,L,0,0,d,g,0];if(l.z>0){const B=180/h;$(N,N,[B/S+1,0,0,0,B/P+1,0,-.5*B/M,.5*B/L,1])}return N[2]=T,N[5]=l.x,N[8]=l.y,N},s.dF=qu,s.dG=function(l,i,a){const h=Q(new Float64Array(16)),d=(i/(1<<l)-.5)*Math.PI*2;return at(h,a.globeMatrix,d),Float32Array.from(h)},s.dH=class{isDataAvailableAtPoint(l){const i=this._source();if(this.isUsingMockSource()||!i||l.y<0||l.y>1)return!1;const a=i.getSource().maxzoom,h=1<<a,d=Math.floor(l.x),_=Math.floor((l.x-d)*h),g=Math.floor(l.y*h),b=this.findDEMTileFor(new Ko(a,d,a,_,g));return!(!b||!b.dem)}getAtPointOrZero(l,i=0){return this.getAtPoint(l,i)||0}getAtPoint(l,i,a=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);const h=this._source();if(!h||l.y<0||l.y>1)return i;const d=h.getSource().maxzoom,_=1<<d,g=Math.floor(l.x),b=l.x-g,T=new Ko(d,g,d,Math.floor(b*_),Math.floor(l.y*_)),S=this.findDEMTileFor(T);if(!S||!S.dem)return i;const P=S.dem,M=1<<S.tileID.canonical.z,L=(b*M-S.tileID.canonical.x)*P.dim,N=(l.y*M-S.tileID.canonical.y)*P.dim,B=Math.floor(L),W=Math.floor(N);return(a?this.exaggeration():1)*Ri(Ri(P.get(B,W),P.get(B,W+1),N-W),Ri(P.get(B+1,W),P.get(B+1,W+1),N-W),L-B)}getAtTileOffset(l,i,a){const h=1<<l.canonical.z;return this.getAtPointOrZero(new nt(l.wrap+(l.canonical.x+i/Ft)/h,(l.canonical.y+a/Ft)/h))}getAtTileOffsetFunc(l,i,a,h){return d=>{const _=this.getAtTileOffset(l,d.x,d.y),g=h.upVector(l.canonical,d.x,d.y);return wi(g,g,_*h.upVectorScale(l.canonical,i,a).metersToTile),g}}getForTilePoints(l,i,a,h){if(this.isUsingMockSource())return!1;const d=dg.create(this,l,h);return!!d&&(i.forEach(_=>{_[2]=this.exaggeration()*d.getElevationAt(_[0],_[1],a)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(l);if(!i||!i.dem)return null;const a=i.dem.tree,h=i.tileID,d=1<<l.canonical.z-h.canonical.z;let _=l.canonical.x/d-h.canonical.x,g=l.canonical.y/d-h.canonical.y,b=0;for(let T=0;T<l.canonical.z-h.canonical.z&&!a.leaves[b];T++){_*=2,g*=2;const S=2*Math.floor(g)+Math.floor(_);b=a.childOffsets[b]+S,_%=1,g%=1}return{min:this.exaggeration()*a.minimums[b],max:this.exaggeration()*a.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,i,a){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const l=this.visibleDemTiles;if(l.length===0)return null;let i=!1,a=Number.MAX_VALUE,h=Number.MIN_VALUE;for(const d of l){const _=this.getMinMaxForTile(d.tileID);_&&(a=Math.min(a,_.min),h=Math.max(h,_.max),i=!0)}return i?{min:a,max:h}:null}},s.dI=qP,s.dJ=Bb,s.dK=function(l,i){return[Math.pow(l[0],2.2)*i,Math.pow(l[1],2.2)*i,Math.pow(l[2],2.2)*i]},s.dL=A,s.dM=function(l,i){var a=Math.sin(i),h=Math.cos(i);return l[0]=h,l[1]=a,l[2]=0,l[3]=-a,l[4]=h,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},s.dN=nr,s.dO=kP,s.dP=Ms,s.dQ=Ss,s.dR=256,s.dS=function(l,i){const a=[0,0,0];return ai(a,a,jb(qu(i.canonical))),ai(a,a,l),a},s.dT=l=>({u_matrix:new Vp(l),u_texsize:new bc(l),u_pixels_to_tile_units:new Y_(l),u_device_pixel_ratio:new ys(l),u_width_scale:new ys(l),u_floor_width_scale:new ys(l),u_image:new zp(l),u_units_to_pixels:new bc(l),u_tile_units_to_pixels:new ys(l),u_alpha_discard_threshold:new ys(l),u_trim_offset:new bc(l),u_trim_fade_range:new bc(l),u_trim_color:new Bp(l),u_emissive_strength:new ys(l),u_zbias_factor:new ys(l),u_tile_to_meter:new ys(l),u_ground_shadow_factor:new Np(l),u_pattern_transition:new ys(l)}),s.dU=l=>({u_matrix:new Vp(l),u_pixels_to_tile_units:new Y_(l),u_device_pixel_ratio:new ys(l),u_width_scale:new ys(l),u_floor_width_scale:new ys(l),u_units_to_pixels:new bc(l),u_dash_image:new zp(l),u_gradient_image:new zp(l),u_image_height:new ys(l),u_texsize:new bc(l),u_tile_units_to_pixels:new ys(l),u_alpha_discard_threshold:new ys(l),u_trim_offset:new bc(l),u_trim_fade_range:new bc(l),u_trim_color:new Bp(l),u_emissive_strength:new ys(l),u_zbias_factor:new ys(l),u_tile_to_meter:new ys(l),u_ground_shadow_factor:new Np(l)}),s.dV=l=>({u_camera_to_center_distance:new ys(l),u_extrude_scale:new Y_(l),u_device_pixel_ratio:new ys(l),u_matrix:new Vp(l),u_inv_rot_matrix:new Vp(l),u_merc_center:new bc(l),u_tile_id:new Np(l),u_zoom_transition:new ys(l),u_up_dir:new Np(l),u_emissive_strength:new ys(l)}),s.dW=Vy,s.dX=f$,s.dY=class{constructor(l,i,a,h){this.context=l,this.format=h,this.size=a,this.texture=l.gl.createTexture();const[d,_,g]=this.size,{gl:b}=l;b.bindTexture(b.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in i&&i.data&&b.texImage3D(b.TEXTURE_3D,0,this.format,d,_,g,0,JI(this.format),QI(this.format),i.data)}bind(l,i){const{context:a}=this,{gl:h}=a;h.bindTexture(h.TEXTURE_3D,this.texture),l!==this.minFilter&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MAG_FILTER,l),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MIN_FILTER,l),this.minFilter=l),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},s.dZ=FP,s.d_=(l,i,a,h,d,_)=>{const g=l.transform,b=g.projection.name==="globe";let T;if(_.paint.get("circle-pitch-alignment")==="map")if(b){const P=kP(g.zoom,i.canonical)*g._pixelsPerMercatorPixel;T=Float32Array.from([P,0,0,P])}else T=g.calculatePixelsToTileUnitsMatrix(a);else T=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const S={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(g.projection),u_matrix:l.translatePosMatrix(i.projMatrix,a,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:sa.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:D7,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:_.paint.get("circle-emissive-strength")};if(b){S.u_inv_rot_matrix=h,S.u_merc_center=d,S.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],S.u_zoom_transition=gf(g.zoom);const P=d[0]*Ft,M=d[1]*Ft;S.u_up_dir=g.projection.upVector(new tu(0,0,0),P,M)}return S},s.da=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},s.db=CS,s.dc=function(l,i){return l.readFields(lG,{icons:[]},i)},s.dd=Jb,s.de=cg,s.df=gS,s.dg=Vd,s.dh=mb,s.di=Th,s.dj=Rh,s.dk=Oi,s.dl=function(l){const i=l.indexOf(Pp);return i>=0?l.slice(0,i):l},s.dm=function(l){return l.indexOf(Pp)>=0},s.dn=function(l){const i=l.lastIndexOf(Pp);return i>=0?l.slice(i+1):""},s.dp=function(l){const i=[],a=l.id;return a===void 0&&i.push({message:`layers.${a}: missing required property "id"`}),l.render===void 0&&i.push({message:`layers.${a}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&i.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),i},s.dq=function(l,i,a,h){return l.type==="custom"?new iG(l,i):new oG[l.type](l,i,a,h)},s.dr=Xi,s.ds=function(l){const i=l.indexOf(Pp);return i>=0?l.slice(i+1):""},s.dt=class extends _g{constructor(l,i){super(l._vectorTileFeature,l._z,l._x,l._y,l.id),l.state&&(this.state=Object.assign({},l.state)),this.target=i.target,this.namespace=i.namespace,i.properties&&(this.properties=i.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=l.source,this.sourceLayer=l.sourceLayer,this.layer=l.layer)}toJSON(){const l=super.toJSON();return l.target=this.target,l.namespace=this.namespace,l}},s.du=My,s.dv=fr,s.dw=function(l){return l({pluginStatus:Xo,pluginURL:Nu}),My.on("pluginStateChange",l),l},s.dx=Fb,s.dy=class extends xc{constructor(l){super(l),this.current=II}set(l,i,a){if(this.fetchUniformLocation(l,i)){for(let h=0;h<9;h++)if(a[h]!==this.current[h]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},s.dz=oe,s.e=io,s.e$=function(){const l=lv;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(WI),lv=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.e0=_i,s.e1=(l,i,a,h,d,_,g,b,T,S)=>{const P=l.transform,M=P.pitch<15?d6(.07,.7,fe((14-P.zoom)/5,0,1)):.07,L=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:p6(l,i,a,h),u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:P.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:d,u_width_scale:_,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:f6(i,P),u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:M,u_tile_to_meter:Xe(i.tileID.canonical,0),u_ground_shadow_factor:T,u_pattern_transition:S}},s.e2=(l,i,a,h,d,_,g,b,T,S)=>{const P=l.transform,M=P.calculatePixelsToTileUnitsMatrix(i),L=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none",N=P.pitch<15?d6(.07,.7,fe((14-P.zoom)/5,0,1)):.07;return{u_matrix:p6(l,i,a,h),u_pixels_to_tile_units:M,u_device_pixel_ratio:_,u_width_scale:g,u_floor_width_scale:b,u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:_6(a)&&i.lineAtlasTexture?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:f6(i,l.transform),u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:N,u_tile_to_meter:Xe(i.tileID.canonical,0),u_ground_shadow_factor:S}},s.e3=Kt,s.e4=Ky,s.e5=pe,s.e6=S7,s.e7=Kb,s.e8=SM,s.e9=vf,s.eA=Ds,s.eB=ff,s.eC=function(l,i,a,h,d,_,g,b,T,S,P,M,L,N,B,W){var X=new R(16);return X[0]=l,X[1]=i,X[2]=a,X[3]=h,X[4]=d,X[5]=_,X[6]=g,X[7]=b,X[8]=T,X[9]=S,X[10]=P,X[11]=M,X[12]=L,X[13]=N,X[14]=B,X[15]=W,X},s.eD=j,s.eE=Dp,s.eF=H_,s.eG=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new xt(1/0,1/0),max:new xt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,i=!1){const a=dM(new xt(0,0),new xt(Ft,Ft),l),h=[];if(i&&!VI(a,this._globalClipBounds))return h;for(const d of this._activeRegions){if(d.hiddenByOverlap||!VI(a,d))continue;const _=aj(d.min,d.max,l);h.push({min:_.min,max:_.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId,order:d.order,clipMask:d.clipMask,clipScope:d.clipScope})}return h}setSources(l){this._setSources(l.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{const a=[];for(const h of i.cache.getVisibleCoordinates()){const d=i.cache.getTile(h).buckets[i.layer];d&&d.updateFootprints(h.toUnwrapped(),a)}return a},getOrder:()=>i.order,getClipMask:()=>i.clipMask,getClipScope:()=>i.clipScope})))}_addSource(l){const i=l.getFootprints();if(i.length===0)return;const a=l.getOrder(),h=l.getClipMask(),d=l.getClipScope();for(const _ of i){if(!_.footprint)continue;const g=dM(_.footprint.min,_.footprint.max,_.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:_.id,footprint:_.footprint,order:a,clipMask:h,clipScope:d})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((i,a)=>i.priority-a.priority||Wb(i.min,a.min)||Wb(i.max,a.max)||i.order-a.order||i.clipMask-a.clipMask||function(h,d){const _=(g,b)=>g+b;return h.length-d.length||h.reduce(_,"").localeCompare(d.reduce(_,""))}(i.clipScope,a.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let i=0;for(;!l&&i!==this._activeRegions.length;){const a=this._activeRegions[i],h=this._prevRegions[i];l=a.priority!==h.priority||!hM(a,h)||a.order!==h.order||a.clipMask!==h.clipMask||!xo(a.clipScope,h.clipScope),++i}}if(l){++this._updateTime;for(const a of this._activeRegions)a.order!==iv&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const i=a=>{const h=this._activeRegions;if(a>=h.length)return a;const d=h[a].priority;for(;a<h.length&&h[a].priority===d;)++a;return a};if(this._sourceIds.length>1){let a=0,h=i(a);for(;a!==h;){let d=a;const _=a;for(;d!==h;){const g=this._activeRegions[d];g.hiddenByOverlap=!1;for(let b=0;b<_;b++){const T=this._activeRegions[b];if(!T.hiddenByOverlap&&g.order===iv&&VI(g,T)&&(g.hiddenByOverlap=fM(g.footprint,g.tileId,T.footprint,T.tileId),g.hiddenByOverlap))break}++d}a=h,h=i(a)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=l.length-1;i>=0;i--)this._addSource(l[i]);this._computeReplacement()}},s.eH=iv,s.eI=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();for(const l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,i){const a=new Vu,h=new Us,d=[],_=l+1+2,g=i[0]+1,b=i[0]+1+(1+i.length),T=(S,P,M)=>{let L=S===_-1?S-2:S===0?S:S-1;return L+=M?24575:0,[L,P]};for(let S=0;S<_;++S)a.emplaceBack(...T(S,0,!0));for(let S=0;S<g;++S)for(let P=0;P<_;++P)a.emplaceBack(...T(P,S,(P===0||P===_-1)&&!0));for(let S=0;S<i.length;++S){const P=i[S];for(let M=0;M<_;++M)a.emplaceBack(...T(M,P,!0))}for(let S=0;S<i.length;++S){const P=h.length,M=i[S]+1+2,L=new Us;for(let W=0;W<M-1;W++){const X=W===M-2,Z=X?_*(b-i.length+S-W):_;for(let ne=0;ne<_-1;ne++){const se=W*_+ne;W===0||X||ne===0||ne===_-2?(L.emplaceBack(se+1,se,se+Z),L.emplaceBack(se+Z,se+Z+1,se+1)):(h.emplaceBack(se+1,se,se+Z),h.emplaceBack(se+Z,se+Z+1,se+1))}}const N=jn.simpleSegment(0,P,a.length,h.length-P);for(let W=0;W<L.uint16.length;W+=3)h.emplaceBack(L.uint16[W],L.uint16[W+1],L.uint16[W+2]);const B=jn.simpleSegment(0,P,a.length,h.length-P);d.push({withoutSkirts:N,withSkirts:B})}return{vertices:a,indices:h,segments:d}}_createGrid(l){const i=this._fillGridMeshWithLods(I,C);this._gridSegments=i.segments,this._gridBuffer=l.createVertexBuffer(i.vertices,AP.members),this._gridIndexBuffer=l.createIndexBuffer(i.indices,!0)}_createPoles(l){const i=new Us;for(let g=0;g<=I;g++)i.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=l.createIndexBuffer(i,!0);const a=new Jh,h=new Jh,d=new Jh,_=new Jh;this._poleSegments=[];for(let g=0,b=0;g<v;g++){const T=360/(1<<g);a.emplaceBack(0,-p,0,.5,0),h.emplaceBack(0,-p,0,.5,1),d.emplaceBack(0,-p,0,.5,.5),_.emplaceBack(0,-p,0,.5,.5);for(let S=0;S<=I;S++){let P=S/I,M=0;const L=Ri(0,T,P),[N,B,W]=V(M7,k7,L,p);a.emplaceBack(N,B,W,P,M),h.emplaceBack(N,B,W,P,1-M);const X=Pe(L);P=.5+.5*Math.sin(X),M=.5+.5*Math.cos(X),d.emplaceBack(N,B,W,P,M),_.emplaceBack(N,B,W,P,1-M)}this._poleSegments.push(jn.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(a,Nb,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(h,Nb,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(d,Nb,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(_,Nb,!1)}getGridBuffers(l,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},s.eJ=cM,s.eK=Te,s.eL=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.eM=be,s.eN=ot,s.eO=function(l,i,a){return l[0]=i[0]/a[0],l[1]=i[1]/a[1],l[2]=i[2]/a[2],l},s.eP=Et,s.eQ=z,s.eR=Br,s.eS=ui,s.eT=function([l,i,a]){const h=Math.hypot(l,i,a),d=Math.atan2(l,a),_=.5*Math.PI-Math.acos(-i/h);return new H(q(d),q(_))},s.eU=Jt,s.eV=tS,s.eW=function(l){const i=l.navigator?l.navigator.userAgent:null;return!!function(a){if(un==null){const h=a.navigator?a.navigator.userAgent:null;un=!!a.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return un}(l)&&!(!i||!(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.eX=function(l,i){Go=l,oa=i},s.eY=MI,s.eZ=LP,s.e_=function(l){const i=[0,0,0],a=Q(new Float64Array(16));return Ce(a,l.pixelMatrix,l.globeMatrix),ai(i,i,a),new xt(i[0],i[1])},s.ea=450,s.eb=7,s.ec=$e,s.ed=function(l,i){if(l===i){var a=i[1],h=i[2],d=i[3],_=i[6],g=i[7],b=i[11];l[1]=i[4],l[2]=i[8],l[3]=i[12],l[4]=a,l[6]=i[9],l[7]=i[13],l[8]=h,l[9]=_,l[11]=i[14],l[12]=d,l[13]=g,l[14]=b}else l[0]=i[0],l[1]=i[4],l[2]=i[8],l[3]=i[12],l[4]=i[1],l[5]=i[5],l[6]=i[9],l[7]=i[13],l[8]=i[2],l[9]=i[6],l[10]=i[10],l[11]=i[14],l[12]=i[3],l[13]=i[7],l[14]=i[11],l[15]=i[15];return l},s.ee=tG,s.ef=xr,s.eg=mf,s.eh=256,s.ei=RI,s.ej=ua,s.ek=at,s.el=function(l,i){return l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[4],l[4]=i[5],l[5]=i[6],l[6]=i[8],l[7]=i[9],l[8]=i[10],l},s.em=Jh,s.en=$y,s.eo=yy,s.ep=function(l,i,a,h,d){return fe((l-i)/(a-i)*(d-h)+h,h,d)},s.eq=Ci,s.er=function(l,i){var a=i[0],h=i[1],d=i[2],_=i[3],g=i[4],b=i[5],T=i[6],S=i[7],P=i[8],M=P*g-b*S,L=-P*_+b*T,N=S*_-g*T,B=a*M+h*L+d*N;return B?(l[0]=M*(B=1/B),l[1]=(-P*h+d*S)*B,l[2]=(b*h-d*g)*B,l[3]=L*B,l[4]=(P*a-d*T)*B,l[5]=(-b*a+d*_)*B,l[6]=N*B,l[7]=(-S*a+h*T)*B,l[8]=(g*a-h*_)*B,l):null},s.es=2,s.et=Vr,s.eu=iS,s.ev=[1,1,1],s.ew=dg,s.ex=ii,s.ey=function(l,i,a,h){var d=i[0],_=i[1],g=i[2],b=i[3];return l[0]=d+h*(a[0]-d),l[1]=_+h*(a[1]-_),l[2]=g+h*(a[2]-g),l[3]=b+h*(a[3]-b),l},s.ez=og,s.f=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(i,a)=>String.fromCharCode(+("0x"+a))))},s.f0=function(){Jb().acquire(WI)},s.f1=F_,s.f2=function(l,i,a=!1){if(Xo===Aa.deferred||Xo===Aa.loading||Xo===Aa.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Nu=sa.resolveURL(l),Xo=Aa.deferred,Ry=i,Py(),a||Gh()},s.f3=function(l){rg=sa.resolveURL(l),ng||(ng=new ig(Jb(),new mc)),ng.broadcast("setMeshoptUrl",rg)},s.f4=BM,s.f5=function(l){ZI=sa.resolveURL(l),ng||(ng=new ig(Jb(),new mc)),ng.broadcast("setDracoUrl",ZI)},s.f6=NM,s.f7=av,s.f8=function(l){const i=pp();if(!i)return;const a=i.delete(pn);l&&a.then(()=>l()).catch(l)},s.f9=Gp,s.fA=function(l){Eh(),bo!=null&&bo.then(i=>{i.keys().then(a=>{for(let h=0;h<a.length-l;h++)i.delete(a[h]).catch(d=>Ji(d.message))}).catch(a=>Ji(a.message))}).catch(i=>Ji(i.message))},s.fa=Zt,s.fb=yf,s.fc=ru,s.fd=u3,s.fe=h3,s.ff=l6,s.fg=Qi,s.fh="hd_road_elevation",s.fi=zn,s.fj=Ii,s.fk=id,s.fl=_S,s.fm=Wp,s.fn=function(l,i,a,h,d,_,g,b=1,T,S,P){l.createArrays(),l.tilePixelRatio=Ft/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const M=l.layers[0].layout,L=l.layers[0]._unevaluatedLayout._values,N={};N.scaleFactor=b,N.textSizeScaleRange=M.get("text-size-scale-range"),N.iconSizeScaleRange=M.get("icon-size-scale-range");const[B,W]=N.textSizeScaleRange,[X,Z]=N.iconSizeScaleRange;N.textScaleFactor=fe(N.scaleFactor,B,W),N.iconScaleFactor=fe(N.scaleFactor,X,Z);const ne=L["text-size"],se=L["icon-size"];if(l.textSizeData.kind==="composite"){const{minZoom:je,maxZoom:ft}=l.textSizeData;N.compositeTextSizes=[ne.possiblyEvaluate(new gn(je,{worldview:P}),_),ne.possiblyEvaluate(new gn(ft,{worldview:P}),_)]}if(l.iconSizeData.kind==="composite"){const{minZoom:je,maxZoom:ft}=l.iconSizeData;N.compositeIconSizes=[se.possiblyEvaluate(new gn(je,{worldview:P}),_),se.possiblyEvaluate(new gn(ft,{worldview:P}),_)]}N.layoutTextSize=ne.possiblyEvaluate(new gn(g+1,{worldview:P}),_),N.layoutIconSize=se.possiblyEvaluate(new gn(g+1,{worldview:P}),_),N.textMaxSize=ne.possiblyEvaluate(new gn(18,{worldview:P}),_);const le=M.get("symbol-placement"),Ee=M.get("text-rotation-alignment")==="map"&&le!=="point",Ie=M.get("text-size");let Re=!1;const Ne=[];for(const je of l.features){const ft=M.get("text-font").evaluate(je,{},_).join(","),We=Ie.evaluate(je,{},_)*N.textScaleFactor,mt=N.layoutTextSize.evaluate(je,{},_)*N.textScaleFactor,St=N.layoutIconSize.evaluate(je,{},_)*N.iconScaleFactor,gt={horizontal:{},vertical:void 0},wt=je.text;let Rt,ut=[0,0];if(wt){const ci=wt.toString(),Li=M.get("text-letter-spacing").evaluate(je,{},_)*co,Hi=M.get("text-line-height").evaluate(je,{},_)*co,or=fb(ci)?Li:0,Zi=M.get("text-anchor").evaluate(je,{},_),ei=M.get("text-variable-anchor");if(!ei){const it=M.get("text-radial-offset").evaluate(je,{},_);if(it)ut=W6(Zi,[it*co,yS]);else{const dt=M.get("text-offset").evaluate(je,{},_);ut=[dt[0]*co,dt[1]*co]}}let qi=Ee?"center":M.get("text-justify").evaluate(je,{},_);const Ir=le==="point",ue=Ir?M.get("text-max-width").evaluate(je,{},_)*co:1/0,he=it=>{l.allowVerticalPlacement&&Cy(ci)&&(gt.vertical=fS(wt,i,a,d,ft,ue,Hi,Zi,it,or,ut,sl.vertical,!0,mt,We,T))};if(!Ee&&ei){const it=qi==="auto"?ei.map(Vt=>vS(Vt)):[qi];let dt=!1;for(let Vt=0;Vt<it.length;Vt++){const Bt=it[Vt];if(!gt.horizontal[Bt])if(dt)gt.horizontal[Bt]=gt.horizontal[0];else{const Yt=fS(wt,i,a,d,ft,ue,Hi,"center",Bt,or,ut,sl.horizontal,!1,mt,We,T);Yt&&(gt.horizontal[Bt]=Yt,dt=Yt.positionedLines.length===1)}}he("left")}else{if(qi==="auto"&&(qi=vS(Zi)),Ir||M.get("text-writing-mode").indexOf("horizontal")>=0||!Cy(ci)){const it=fS(wt,i,a,d,ft,ue,Hi,Zi,qi,or,ut,sl.horizontal,!1,mt,We,T);it&&(gt.horizontal[qi]=it)}he(Ir?"left":qi)}}let Tt,rt,et,Pt,At,mi,qt=!1;const si=M.get("icon-text-fit").evaluate(je,{},_);if(je.icon&&je.icon.hasPrimary()){const ci=Z6(je.icon,l.iconSizeData,L["icon-size"],_,l.zoom,je,T,N.iconScaleFactor,P);Tt=ci.iconPrimary,et=ci.iconSecondary;const Li=Tt.toString();if(rt=h.get(Li),rt&&(At=M.get("icon-offset").evaluate(je,{},_),mi=M.get("icon-anchor").evaluate(je,{},_),Rt=M$(d.get(Li),et?d.get(et.toString()):void 0,At,mi),qt=rt.sdf,l.sdfIcons===void 0?l.sdfIcons=rt.sdf:l.sdfIcons!==rt.sdf&&Ji("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(rt.pixelRatio!==l.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0)),et){const Hi=et.toString();Pt=h.get(Hi)}}Re=Re||!(!je.icon||!je.icon.hasSecondary());const Ot=xS(gt.horizontal)||gt.vertical;l.iconsInText||(l.iconsInText=!!Ot&&Ot.iconsInText);const pi=mt*N.textScaleFactor/co,{defaultShapedIcon:Ui,verticallyShapedIcon:Ut}=U$(l,Rt,M,je,_,gt,pi,At,si);si!=="none"&&Rt&&(M6(Rt)||k6(Rt))&&(uw(0,rt,Tt,Rt,Ui,si,S,h,d),uw(0,Pt,et,Rt,Ui,si,S,h,d),Ut&&(uw(0,rt,Tt,Rt,Ut,si,S,h,d),uw(0,Pt,et,Rt,Ut,si,S,h,d))),Rt=Ui,Ne.push({feature:je,shapedTextOrientations:gt,shapedText:Ot,shapedIcon:Rt,iconPrimary:Tt,iconSecondary:et,iconOffset:At,iconAnchor:mi,verticallyShapedIcon:Ut,layoutTextSize:mt,layoutIconSize:St,textOffset:ut,isSDFIcon:qt,iconTextFit:si})}return{featureData:Ne,sizes:N,hasAnySecondaryIcon:Re,textAlongLine:Ee,symbolPlacement:le}},s.fo=U6,s.fp=function(l,i,a,h,d,_,g,b,T,S){const{featureData:P,hasAnySecondaryIcon:M,sizes:L,textAlongLine:N,symbolPlacement:B}=i;for(const W of P){const{shapedIcon:X,verticallyShapedIcon:Z,feature:ne,shapedTextOrientations:se,shapedText:le,layoutTextSize:Ee,textOffset:Ie,isSDFIcon:Re,iconPrimary:Ne,iconSecondary:je,iconTextFit:ft,iconOffset:We}=W;K6(X,S.iconPositions,Ne,je),K6(Z,S.iconPositions,Ne,je),V$(se,S.iconPositions),B$(Ne,je,S.iconPositions),(le||X)&&j$(l,ne,se,X,Z,T,L,Ee,0,Ie,Re,h,d,g,b,M,ft,We,N,B)}a&&l.generateCollisionDebugBuffers(_,l.collisionBoxArray,L.textScaleFactor)},s.fq=Vi,s.fr=Pw,s.fs=It,s.ft=function(l){let i=0;if(new Uint32Array(l,0,1)[0]!==UM){const a=new Uint32Array(l,0,7),[,,h,d,_,g]=a;i=a.byteLength+d+_+g+_,(h!==l.byteLength||i>=l.byteLength)&&Ji("Invalid b3dm header information.")}return HM(l,i)},s.fu=function(l,i){const a=QM(l);for(const h of a){for(const d of h.meshes)Nj(d);h.lights&&(h.lightMeshIndex=h.meshes.length,h.meshes.push(Bj(h.lights,i)))}return a},s.fv=Ew,s.fw=Tr,s.fx=FM,s.fy=vc,s.fz=Aa,s.g=function(l,i){return fr(Object.assign(l,{method:"GET"}),i)},s.h=function(l){return l.indexOf("mapbox:")===0},s.i=function(l){return io.API_STYLE_REGEX.test(l)&&!fp(l)},s.j=$c,s.k=Ih,s.l=function(l){return decodeURIComponent(atob(l).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.m=function(l,i){return fr(Object.assign(l,{type:"json"}),i)},s.n=bl,s.o=sa,s.p=function(l,i){return fr(Object.assign(l,{method:"POST"}),i)},s.q=To,s.r=Ya,s.s=function(l){try{const i=self[l];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=function(){return XI||(XI=new Gp),XI},s.u=function(){return function l(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()},s.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},s.w=Ji,s.x=OS,s.y=pc,s.z=Ea}),f(["./shared"],function(s){function E(Pe){const q=Pe?Pe.url.toString():void 0;return q?performance.getEntriesByName(q):[]}function R(Pe){if(typeof Pe=="number"||typeof Pe=="boolean"||typeof Pe=="string"||Pe==null)return JSON.stringify(Pe);if(Array.isArray(Pe)){let J="[";for(const oe of Pe)J+=`${R(oe)},`;return`${J}]`}let q="{";for(const J of Object.keys(Pe).sort())q+=`${J}:${R(Pe[J])},`;return`${q}}`}function O(Pe){let q="";for(const J of s.bx)q+=`/${R(Pe[J])}`;return q}class A{constructor(q){this.keyCache={},this._layers={},this._layerConfigs={},q&&this.replace(q)}replace(q,J){this._layerConfigs={},this._layers={},this.update(q,[],J)}update(q,J,oe){this._options=oe;for(const be of q)this._layerConfigs[be.id]=be,(this._layers[be.id]=s.dq(be,this.scope,null,this._options)).compileFilter(oe),this.keyCache[be.id]&&delete this.keyCache[be.id];for(const be of J)delete this.keyCache[be],delete this._layerConfigs[be],delete this._layers[be];this.familiesBySource={};const Te=function(be,fe){const Ke={};for(let Ze=0;Ze<be.length;Ze++){const yt=be[Ze];let lt=fe&&fe[yt.id];lt||(yt.type==="symbol"?lt=yt.id:(lt=O(yt),yt.type==="line"&&yt.paint&&function Qt(Ii){return typeof Ii=="string"&&Ii==="line-progress"||(Array.isArray(Ii)?Ii.some(Qt):!(!Ii||typeof Ii!="object")&&Object.values(Ii).some(Qt))}(yt.paint["line-width"])&&(lt+=`/${R(yt.paint["line-width"])}`))),fe&&(fe[yt.id]=lt);let Kt=Ke[lt];Kt||(Kt=Ke[lt]=[]),Kt.push(yt)}const ze=[];for(const Ze in Ke)ze.push(Ke[Ze]);return ze}(Object.values(this._layerConfigs),this.keyCache);for(const be of Te){const fe=be.map(Kt=>this._layers[Kt.id]),Ke=fe[0];if(Ke.visibility==="none")continue;const ze=Ke.source||"";let Ze=this.familiesBySource[ze];Ze||(Ze=this.familiesBySource[ze]={});const yt=Ke.sourceLayer||"_geojsonTileLayer";let lt=Ze[yt];lt||(lt=Ze[yt]=[]),lt.push(fe)}}}const U=1*s.fc;class ${constructor(q){const J={},oe=[];for(const Ke in q){const ze=q[Ke],Ze=J[Ke]={};for(const yt in ze.glyphs){const lt=ze.glyphs[+yt];if(!lt||lt.bitmap.width===0||lt.bitmap.height===0)continue;const Kt=lt.metrics.localGlyph?U:1,Qt={x:0,y:0,w:lt.bitmap.width+2*Kt,h:lt.bitmap.height+2*Kt};oe.push(Qt),Ze[yt]=Qt}}const{w:Te,h:be}=s.G(oe),fe=new s.fb({width:Te||1,height:be||1});for(const Ke in q){const ze=q[Ke];for(const Ze in ze.glyphs){const yt=ze.glyphs[+Ze];if(!yt||yt.bitmap.width===0||yt.bitmap.height===0)continue;const lt=J[Ke][Ze],Kt=yt.metrics.localGlyph?U:1;s.fb.copy(yt.bitmap,fe,{x:0,y:0},{x:lt.x+Kt,y:lt.y+Kt},yt.bitmap)}}this.image=fe,this.positions=J}}s.fa($,"GlyphAtlas");class te{constructor(q){this.tileID=new s.aO(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.tileZoom=q.tileZoom,this.uid=q.uid,this.zoom=q.zoom,this.lut=q.lut,this.canonical=q.tileID.canonical,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.scope=q.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=q.showCollisionBoxes,this.collectResourceTiming=!!q.request&&q.request.collectResourceTiming,this.promoteId=q.promoteId,this.isSymbolTile=q.isSymbolTile,this.tileTransform=s.aZ(q.tileID.canonical,q.projection),this.projection=q.projection,this.worldview=q.worldview,this.localizableLayerIds=q.localizableLayerIds,this.brightness=q.brightness,this.extraShadowCaster=!!q.extraShadowCaster,this.tessellationStep=q.tessellationStep,this.scaleFactor=q.scaleFactor,this.worldview=q.worldview}parse(q,J,oe,Te,be,fe){this.status="parsing",this.data=q,this.collisionBoxArray=new s.b3;const Ke=new s.fd(Object.keys(q.layers).sort()),ze=new s.fe(this.tileID,this.promoteId);ze.bucketLayerIDs=[];const Ze={},yt=new s.ff(256,256),lt={featureIndex:ze,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:yt,availableImages:oe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Kt=[],Qt=J.familiesBySource[this.source];for(const Xi in Qt){const Oi=q.layers[Xi];if(!Oi)continue;let $i=!1,yr=!1,Ji=!1;for(const Tr of Qt[Xi])Tr[0].type==="symbol"?$i=!0:yr=!0,Tr[0].is3D()&&Tr[0].type!=="model"&&(Ji=!0);if(this.extraShadowCaster&&!Ji||this.isSymbolTile===!0&&!$i||this.isSymbolTile===!1&&!yr)continue;Oi.version===1&&s.w(`Vector tile source "${this.source}" layer "${Xi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const In=Ke.encode(Xi),qr=[];let $r=!1;for(let Tr=0,br=0;Tr<Oi.length;Tr++){const un=Oi.feature(Tr),fn=ze.getId(un,Xi);if(this.localizableLayerIds&&this.localizableLayerIds.has(Xi)){const Fr=un.properties?un.properties.worldview:null;if(this.worldview&&typeof Fr=="string")if(Fr==="all")un.properties.$localized=!0;else{if(!Fr.split(",").includes(this.worldview))continue;un.properties.$localized=!0,un.properties.worldview=this.worldview}}!$r&&un.properties&&un.properties.hasOwnProperty(s.fg)&&($r=!0),qr.push({feature:un,id:fn,index:br,sourceLayerIndex:In}),br++}$r&&!lt.elevationFeatures&&q.layers.hasOwnProperty(s.fh)&&(lt.elevationFeatures=s.fi.parseFrom(q.layers[s.fh],this.canonical));for(const Tr of Qt[Xi]){const br=Tr[0];if(this.extraShadowCaster&&(!br.is3D()||br.type==="model")||this.isSymbolTile!==void 0&&br.type==="symbol"!==this.isSymbolTile||br.minzoom&&this.zoom<Math.floor(br.minzoom)||br.maxzoom&&this.zoom>=br.maxzoom||br.visibility==="none")continue;Q(Tr,this.zoom,lt.brightness,oe,this.worldview);const un=Ze[br.id]=br.createBucket({index:ze.bucketLayerIDs.length,layers:Tr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:In,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Te,worldview:this.worldview});ze.bucketLayerIDs.push(Tr.map(Fr=>s.B(Fr.id,Fr.scope)));let fn=un.prepare?un.prepare():null;fn!=null?(fn=fn.then(()=>un.populate(qr,lt,this.tileID.canonical,this.tileTransform)),Kt.push(fn)):un.populate(qr,lt,this.tileID.canonical,this.tileTransform)}}const Ii=()=>{let Xi,Oi,$i,yr,Ji,In;yt.trim();const qr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},$r=()=>{if(Xi)return this.status="done",fe(Xi);if(this.extraShadowCaster)this.status="done",fe(null,{buckets:Object.values(Ze).filter(br=>!br.isEmpty()),featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:lt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Oi&&$i&&yr){const br=new $(Oi),un=new Map;for(const[cs,Ms]of $i.entries()){const{imagePosition:Ss}=s.fl(cs,Ms,s.fm);un.set(cs,Ss)}const fn={};for(const cs in Ze){const Ms=Ze[cs];Ms instanceof s.b4&&(Q(Ms.layers,this.zoom,lt.brightness,oe,this.worldview),fn[cs]=s.fn(Ms,Oi,br.positions,$i,un,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Ji,this.worldview))}const Fr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(be,$i,Ji,()=>{Fr.iconsPending=!1,Tr(fn,br,Fr)}),this.rasterizeIfNeeded(be,yr,In,()=>{Fr.patternsPending=!1,Tr(fn,br,Fr)})}},Tr=(br,un,fn,Fr)=>{if(fn.iconsPending||fn.patternsPending)return;const cs=new s.fo($i,yr,this.lut);for(const Ms in Ze){const Ss=Ze[Ms];if(Ms in br)s.fp(Ss,br[Ms],this.showCollisionBoxes,oe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,$i,cs);else if(Ss.hasPattern&&(Ss instanceof s.ba||Ss instanceof s.bb||Ss instanceof s.e7)){Q(Ss.layers,this.zoom,lt.brightness,oe,this.worldview);const Za=Object.fromEntries(cs.patternPositions);Ss.addFeatures(lt,this.tileID.canonical,Za,oe,this.tileTransform,this.brightness)}}this.status="done",fe(null,{buckets:Object.values(Ze).filter(Ms=>!Ms.isEmpty()),featureIndex:ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:un.image,lineAtlas:yt,imageAtlas:cs,brightness:lt.brightness})};if(!this.extraShadowCaster){const br=s.fj(lt.glyphDependencies,Fr=>Object.keys(Fr).map(Number));Object.keys(br).length?be.send("getGlyphs",{uid:this.uid,stacks:br},(Fr,cs)=>{Xi||(Xi=Fr,Oi=cs,$r())},void 0,!1,qr):Oi={};const un=Array.from(lt.iconDependencies.keys()).map(Fr=>s.I.parse(Fr));un.length?be.send("getImages",{images:un,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Fr,cs)=>{Xi||(Xi=Fr,$i=new Map,Ji=this.updateImageMapAndGetImageTaskQueue($i,cs,lt.iconDependencies),$r())},void 0,!1,qr):($i=new Map,Ji=new Map);const fn=Array.from(lt.patternDependencies.keys()).map(Fr=>s.I.parse(Fr));fn.length?be.send("getImages",{images:fn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Fr,cs)=>{Xi||(Xi=Fr,yr=new Map,In=this.updateImageMapAndGetImageTaskQueue(yr,cs,lt.patternDependencies),$r())},void 0,!1,qr):(yr=new Map,In=new Map)}if(lt.elevationFeatures&&lt.elevationFeatures.length>0){const br=[];for(const fn of Object.values(Ze))if(fn instanceof s.bb){const Fr=fn.getUnevaluatedPortalGraph();Fr&&br.push(Fr)}const un=s.fk.evaluate(br);for(const fn of Object.values(Ze))if(fn instanceof s.bb){const Fr=q.layers[Ke.decode(fn.sourceLayerIndex)];fn.setEvaluatedPortalGraph(un,Fr,this.tileID.canonical,lt.availableImages,lt.brightness)}}$r()};Kt.length>0?Promise.allSettled(Kt).then(Ii).catch(fe):Ii()}rasterizeIfNeeded(q,J,oe,Te){Array.from(J.values()).some(be=>be.usvg)?this.rasterize(q,J,oe,Te):Te()}updateImageMapAndGetImageTaskQueue(q,J,oe){const Te=new Map;for(const be of J.keys()){const fe=oe.get(be)||[];for(const Ke of fe){const ze=Ke.toString(),Ze=J.get(Ke.id.toString());Ze.usvg?Te.has(ze)||(Te.set(ze,Ke),q.set(ze,Object.assign({},Ze))):q.set(ze,Ze)}}return Te}rasterize(q,J,oe,Te){this.rasterizeTask=q.send("rasterizeImages",{scope:this.scope,tasks:oe},(be,fe)=>{if(!be)for(const[Ke,ze]of fe.entries()){const Ze=Object.assign(J.get(Ke),{data:ze});J.set(Ke,Ze)}Te()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Q(Pe,q,J,oe,Te){const be=new s.ac(q,{brightness:J,worldview:Te});for(const fe of Pe)fe.recalculate(be,oe)}class de extends s.E{constructor(q,J,oe,Te,be,fe,Ke){super(),this.actor=q,this.layerIndex=J,this.availableImages=oe,this.availableModels=Te,this.loadVectorData=fe||s.aL,this.loading={},this.loaded={},this.deduped=new s.aK(q.scheduler),this.isSpriteLoaded=be,this.scheduler=q.scheduler,this.brightness=Ke}loadTile(q,J){const oe=q.uid,Te=q&&q.request,be=Te&&Te.collectResourceTiming,fe=this.loading[oe]=new te(q);fe.abort=this.loadVectorData(q,(Ke,ze)=>{const Ze=!this.loading[oe];if(delete this.loading[oe],fe.cancelRasterize(),Ze||Ke||!ze)return fe.status="done",Ze||(this.loaded[oe]=fe),J(Ke);const yt=ze.rawData,lt={};ze.expires&&(lt.expires=ze.expires),ze.cacheControl&&(lt.cacheControl=ze.cacheControl),fe.vectorTile=ze.vectorTile||new s.fq(new s.bt(yt));const Kt=()=>{fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Qt,Ii)=>{if(Qt||!Ii)return J(Qt);const Xi={};if(be){const Oi=E(Te);Oi.length>0&&(Xi.resourceTiming=JSON.parse(JSON.stringify(Oi)))}J(null,Object.assign({rawTileData:yt.slice(0)},Ii,lt,Xi))})};this.isSpriteLoaded?Kt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Kt,{type:"parseTile",isSymbolTile:q.isSymbolTile,zoom:q.tileZoom}):Kt()}),this.loaded=this.loaded||{},this.loaded[oe]=fe})}reloadTile(q,J){const oe=this.loaded,Te=q.uid;if(oe&&oe[Te]){const be=oe[Te];be.scaleFactor=q.scaleFactor,be.showCollisionBoxes=q.showCollisionBoxes,be.projection=q.projection,be.brightness=q.brightness,be.tileTransform=s.aZ(q.tileID.canonical,q.projection),be.extraShadowCaster=q.extraShadowCaster,be.lut=q.lut,be.worldview=q.worldview;const fe=(Ke,ze)=>{const Ze=be.reloadCallback;Ze&&(delete be.reloadCallback,be.parse(be.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ze)),J(Ke,ze)};be.status==="parsing"?be.reloadCallback=fe:be.status==="done"&&(be.vectorTile?be.parse(be.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,fe):fe())}else J(null,void 0)}abortTile(q,J){const oe=q.uid,Te=this.loading[oe];Te&&(Te.abort&&Te.abort(),delete this.loading[oe]),J()}removeTile(q,J){const oe=this.loaded,Te=q.uid;oe&&oe[Te]&&delete oe[Te],J()}}class Ce{loadTile(q,J){const{uid:oe,encoding:Te,rawImageData:be,padding:fe}=q,Ke=ImageBitmap&&be instanceof ImageBitmap?this.getImageData(be,fe):be;J(null,new s.fr(oe,Ke,Te,fe<1))}reloadTile(q,J){J(null,null)}abortTile(q,J){J()}removeTile(q,J){J()}getImageData(q,J){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);const oe=this.offscreenCanvasContext.getImageData(-J,-J,q.width+2*J,q.height+2*J);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}s.bs.setPbf(s.bt);class Fe{constructor(q){this._mrt=new s.bs(q.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=q.uid,this.tileID=q.tileID,this.source=q.source}parse(q,J){const oe=this._mrt;this.status="parsing",this._entireBuffer=q;try{oe.parseHeader(q),this._isHeaderLoaded=!0;const Te=[];for(const be in oe.layers){const fe=oe.getLayer(be),Ke=fe.getDataRange(fe.getBandList()),ze=oe.createDecodingTask(Ke),Ze=q.slice(Ke.firstByte,Ke.lastByte+1),yt=s.bs.performDecoding(Ze,ze).then(lt=>ze.complete(null,lt)).catch(lt=>ze.complete(lt,null));Te.push(yt)}Promise.allSettled(Te).then(()=>J(null,oe)).catch(be=>J(be))}catch(Te){J(Te)}}}class Le{constructor(q){this.actor=q,this.loading={},this.loaded={}}loadTile(q,J){const oe=q.uid,Te=q.request,be=this.loading[oe]=new Fe(q),{cancel:fe}=s.bu(Te,(Ke,ze,Ze,yt)=>{const lt=!this.loading[oe];if(delete this.loading[oe],lt||Ke||!ze)return be.status="done",lt||(this.loaded[oe]=be),J(Ke);be.parse(ze,(Kt,Qt)=>{if(Kt||!Qt)return J(Kt);J(null,Qt,Ze,yt)}),this.loaded[oe]=be});be.abort=fe}reloadTile(q,J){J(null,void 0)}abortTile(q,J){const oe=q.uid,Te=this.loading[oe];Te&&(Te.abort&&Te.abort(),delete this.loading[oe]),J()}removeTile(q,J){const oe=q.uid;this.loaded[oe]&&delete this.loaded[oe],J()}decodeRasterArray(q,J){s.bs.performDecoding(q.buffer,q.task).then(oe=>J(null,oe)).catch(oe=>J(oe))}}const Me=s.fs.prototype.toGeoJSON;class at{constructor(q){this._feature=q,this.extent=s.al,this.type=q.type,this.properties=q.tags,"id"in q&&!isNaN(q.id)&&(this.id=parseInt(q.id,10))}loadGeometry(){if(this._feature.type===1){const q=[];for(const J of this._feature.geometry)q.push([new s.P(J[0],J[1])]);return q}{const q=[];for(const J of this._feature.geometry){const oe=[];for(const Te of J)oe.push(new s.P(Te[0],Te[1]));q.push(oe)}return q}}toGeoJSON(q,J,oe){return Me.call(this,q,J,oe)}}class pt{constructor(q,J){this.name=q,this.extent=s.al,this.length=J.length,this._jsonFeatures=J}feature(q){return new at(this._jsonFeatures[q])}}class me{constructor(q){this.layers={},this.extent=s.al;for(const J of Object.keys(q))this.layers[J]=new pt(J,q[J])}}const ye=64/4096,Se=128;class ke{constructor(){this.features=new Map}clear(){this.features.clear()}load(q=[],J){for(const oe of q){const Te=oe.id;if(Te==null)continue;let be=this.features.get(Te);be&&this.updateCache(be,J),oe.geometry?(be=He(oe),this.updateCache(be,J),this.features.set(Te,be)):this.features.delete(Te),this.updateCache(be,J)}}updateCache(q,J){for(const{canonical:oe,uid:Te}of Object.values(J)){const{z:be,x:fe,y:Ke}=oe;Ve(q,Math.pow(2,be),fe,Ke)&&delete J[Te]}}getTile(q,J,oe){const Te=Math.pow(2,q),be=[];for(const fe of this.features.values())Ve(fe,Te,J,oe)&&be.push(ti(fe,Te,J,oe));return{features:be}}getFeatures(){return[...this.features.values()]}}function Ve({minX:Pe,minY:q,maxX:J,maxY:oe},Te,be,fe){return Pe<(be+1+ye)/Te&&q<(fe+1+ye)/Te&&J>(be-ye)/Te&&oe>(fe-ye)/Te}function He(Pe){const{id:q,geometry:J,properties:oe}=Pe;if(!J)return;if(J.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Te,coordinates:be}=J,fe={id:q,type:1,geometry:[],tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ke=fe.geometry;if(Te==="Point")Oe(be,Ke,fe);else if(Te==="MultiPoint")for(const ze of be)Oe(ze,Ke,fe);else if(Te==="LineString")fe.type=2,xi(be,Ke,fe);else if(Te==="MultiLineString")fe.type=2,ui(be,Ke,fe);else if(Te==="Polygon")fe.type=3,ui(be,Ke,fe,!0);else{if(Te!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");fe.type=3;for(const ze of be)ui(ze,Ke,fe,!0)}return fe}function Oe([Pe,q],J,oe){const Te=s.aF(Pe);let be=s.aJ(q);be=be<0?0:be>1?1:be,J.push(Te,be),oe.minX=Math.min(oe.minX,Te),oe.minY=Math.min(oe.minY,be),oe.maxX=Math.max(oe.maxX,Te),oe.maxY=Math.max(oe.maxY,be)}function xi(Pe,q,J,oe=!1,Te=!1){const be=[];for(const fe of Pe)Oe(fe,be,J);q.push(be),oe&&function(fe,Ke){let ze=0;for(let Ze=0,yt=fe.length,lt=yt-2;Ze<yt;lt=Ze,Ze+=2)ze+=(fe[Ze]-fe[lt])*(fe[Ze+1]+fe[lt+1]);if(ze>0===Ke)for(let Ze=0,yt=fe.length;Ze<yt/2;Ze+=2){const lt=fe[Ze],Kt=fe[Ze+1];fe[Ze]=fe[yt-2-Ze],fe[Ze+1]=fe[yt-1-Ze],fe[yt-2-Ze]=lt,fe[yt-1-Ze]=Kt}}(be,Te)}function ui(Pe,q,J,oe=!1){for(let Te=0;Te<Pe.length;Te++)xi(Pe[Te],q,J,oe,Te===0)}function ti(Pe,q,J,oe){const{id:Te,type:be,geometry:fe,tags:Ke}=Pe,ze=[];if(be===1)(function(Ze,yt,lt,Kt,Qt){for(let Ii=0;Ii<Ze.length;Ii+=2){const Xi=Math.round(s.al*(Ze[Ii+0]*yt-lt)),Oi=Math.round(s.al*(Ze[Ii+1]*yt-Kt));Qt.push([Xi,Oi])}})(fe,q,J,oe,ze);else for(const Ze of fe)ri(Ze,q,J,oe,ze);return{id:Te,type:be,geometry:ze,tags:Ke}}function ri(Pe,q,J,oe,Te){const be=-Se,fe=s.al+Se;let Ke;for(let ze=0;ze<Pe.length-2;ze+=2){let Ze=Math.round(s.al*(Pe[ze+0]*q-J)),yt=Math.round(s.al*(Pe[ze+1]*q-oe)),lt=Math.round(s.al*(Pe[ze+2]*q-J)),Kt=Math.round(s.al*(Pe[ze+3]*q-oe));const Qt=lt-Ze,Ii=Kt-yt;Ze<be&&lt<be||(Ze<be?(yt+=Math.round(Ii*((be-Ze)/Qt)),Ze=be):lt<be&&(Kt=yt+Math.round(Ii*((be-Ze)/Qt)),lt=be),yt<be&&Kt<be||(yt<be?(Ze+=Math.round(Qt*((be-yt)/Ii)),yt=be):Kt<be&&(lt=Ze+Math.round(Qt*((be-yt)/Ii)),Kt=be),Ze>=fe&&lt>=fe||(Ze>=fe?(yt+=Math.round(Ii*((fe-Ze)/Qt)),Ze=fe):lt>=fe&&(Kt=yt+Math.round(Ii*((fe-Ze)/Qt)),lt=fe),yt>=fe&&Kt>=fe||(yt>=fe?(Ze+=Math.round(Qt*((fe-yt)/Ii)),yt=fe):Kt>=fe&&(lt=Ze+Math.round(Qt*((fe-yt)/Ii)),Kt=fe),Ke&&Ze===Ke[Ke.length-1][0]&&yt===Ke[Ke.length-1][1]||(Ke=[[Ze,yt]],Te.push(Ke)),Ke.push([lt,Kt])))))}}function Si({name:Pe,features:q},J){J.writeStringField(1,Pe),J.writeVarintField(5,s.al);const oe=new Map,Te=new Map,be={keys:oe,values:Te,feature:null};for(const fe of q)be.feature=fe,J.writeMessage(2,ir,be);for(const fe of oe.keys())J.writeStringField(3,fe);for(const fe of Te.keys())J.writeMessage(4,Br,fe)}function ir(Pe,q){const J=Pe.feature;J.id!==void 0&&Number.isSafeInteger(+J.id)&&q.writeVarintField(1,+J.id),J.tags&&q.writeMessage(2,st,Pe),q.writeVarintField(3,J.type),q.writeMessage(4,Ar,J)}function st({keys:Pe,values:q,feature:J},oe){for(const Te of Object.keys(J.tags)){let be=J.tags[Te];if(be===null)continue;let fe=Pe.get(Te);fe===void 0&&(fe=Pe.size,Pe.set(Te,fe)),oe.writeVarint(fe);const Ke=typeof be;Ke!=="string"&&Ke!=="boolean"&&Ke!=="number"&&(be=JSON.stringify(be));let ze=q.get(be);ze===void 0&&(ze=q.size,q.set(be,ze)),oe.writeVarint(ze)}}function wi(Pe,q){return(q<<3)+(7&Pe)}function ji(Pe){return Pe<<1^Pe>>31}function Ar(Pe,q){const{geometry:J,type:oe}=Pe;let Te=0,be=0;if(oe===1){q.writeVarint(wi(1,J.length));for(const fe of J){const Ke=fe[0]-Te,ze=fe[1]-be;q.writeVarint(ji(Ke)),q.writeVarint(ji(ze)),Te+=Ke,be+=ze}}else for(const fe of J){q.writeVarint(wi(1,1));const Ke=fe.length-(oe===3?1:0);for(let ze=0;ze<Ke;ze++){ze===1&&q.writeVarint(wi(2,Ke-1));const Ze=fe[ze][0]-Te,yt=fe[ze][1]-be;q.writeVarint(ji(Ze)),q.writeVarint(ji(yt)),Te+=Ze,be+=yt}oe===3&&q.writeVarint(wi(7,1))}}function Br(Pe,q){const J=typeof Pe;J==="string"?q.writeStringField(1,Pe):J==="boolean"?q.writeBooleanField(7,Pe):J==="number"&&(Pe%1!=0?q.writeDoubleField(3,Pe):Pe<0?q.writeSVarintField(6,Pe):q.writeVarintField(5,Pe))}const Vr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Pe=>Pe},Ni=Math.fround||(vt=new Float32Array(1),Pe=>(vt[0]=+Pe,vt[0]));var vt;const Wt=3,Xt=5,ai=6;class nr{constructor(q){this.options=Object.assign(Object.create(Vr),q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(q){const{log:J,minZoom:oe,maxZoom:Te}=this.options;J&&console.time("total time");const be=`prepare ${q.length} points`;J&&console.time(be),this.points=q;const fe=[];for(let ze=0;ze<q.length;ze++){const Ze=q[ze];if(!Ze.geometry)continue;const[yt,lt]=Ze.geometry.coordinates,Kt=Ni(Qe(yt)),Qt=Ni(ht(lt));fe.push(Kt,Qt,1/0,ze,-1,1),this.options.reduce&&fe.push(0)}let Ke=this.trees[Te+1]=this._createTree(fe);J&&console.timeEnd(be);for(let ze=Te;ze>=oe;ze--){const Ze=+Date.now();Ke=this.trees[ze]=this._createTree(this._cluster(Ke,ze)),J&&console.log("z%d: %d clusters in %dms",ze,Ke.numItems,+Date.now()-Ze)}return J&&console.timeEnd("total time"),this}getClusters(q,J){let oe=((q[0]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,q[1]));let be=q[2]===180?180:((q[2]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)oe=-180,be=180;else if(oe>be){const lt=this.getClusters([oe,Te,180,fe],J),Kt=this.getClusters([-180,Te,be,fe],J);return lt.concat(Kt)}const Ke=this.trees[this._limitZoom(J)],ze=Ke.range(Qe(oe),ht(fe),Qe(be),ht(Te)),Ze=Ke.data,yt=[];for(const lt of ze){const Kt=this.stride*lt;yt.push(Ze[Kt+Xt]>1?Be(Ze,Kt,this.clusterProps):this.points[Ze[Kt+Wt]])}return yt}getChildren(q){const J=this._getOriginId(q),oe=this._getOriginZoom(q),Te="No cluster with the specified id.",be=this.trees[oe];if(!be)throw new Error(Te);const fe=be.data;if(J*this.stride>=fe.length)throw new Error(Te);const Ke=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),ze=be.within(fe[J*this.stride],fe[J*this.stride+1],Ke),Ze=[];for(const yt of ze){const lt=yt*this.stride;fe[lt+4]===q&&Ze.push(fe[lt+Xt]>1?Be(fe,lt,this.clusterProps):this.points[fe[lt+Wt]])}if(Ze.length===0)throw new Error(Te);return Ze}getLeaves(q,J,oe){const Te=[];return this._appendLeaves(Te,q,J=J||10,oe=oe||0,0),Te}getTile(q,J,oe){const Te=this.trees[this._limitZoom(q)],be=Math.pow(2,q),{extent:fe,radius:Ke}=this.options,ze=Ke/fe,Ze=(oe-ze)/be,yt=(oe+1+ze)/be,lt={features:[]};return this._addTileFeatures(Te.range((J-ze)/be,Ze,(J+1+ze)/be,yt),Te.data,J,oe,be,lt),J===0&&this._addTileFeatures(Te.range(1-ze/be,Ze,1,yt),Te.data,be,oe,be,lt),J===be-1&&this._addTileFeatures(Te.range(0,Ze,ze/be,yt),Te.data,-1,oe,be,lt),lt.features.length?lt:null}getClusterExpansionZoom(q){let J=this._getOriginZoom(q)-1;for(;J<=this.options.maxZoom;){const oe=this.getChildren(q);if(J++,oe.length!==1)break;q=oe[0].properties.cluster_id}return J}_appendLeaves(q,J,oe,Te,be){const fe=this.getChildren(J);for(const Ke of fe){const ze=Ke.properties;if(ze&&ze.cluster?be+ze.point_count<=Te?be+=ze.point_count:be=this._appendLeaves(q,ze.cluster_id,oe,Te,be):be<Te?be++:q.push(Ke),q.length===oe)break}return be}_createTree(q){const J=new s.c3(q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oe=0;oe<q.length;oe+=this.stride)J.add(q[oe],q[oe+1]);return J.finish(),J.data=q,J}_addTileFeatures(q,J,oe,Te,be,fe){for(const Ke of q){const ze=Ke*this.stride,Ze=J[ze+Xt]>1;let yt,lt,Kt;if(Ze)yt=Ge(J,ze,this.clusterProps),lt=J[ze],Kt=J[ze+1];else{const Xi=this.points[J[ze+Wt]];yt=Xi.properties;const[Oi,$i]=Xi.geometry.coordinates;lt=Qe(Oi),Kt=ht($i)}const Qt={type:1,geometry:[[Math.round(this.options.extent*(lt*be-oe)),Math.round(this.options.extent*(Kt*be-Te))]],tags:yt};let Ii;Ii=Ze||this.options.generateId?J[ze+Wt]:this.points[J[ze+Wt]].id,Ii!==void 0&&(Qt.id=Ii),fe.features.push(Qt)}}_limitZoom(q){return Math.max(this.options.minZoom,Math.min(Math.floor(+q),this.options.maxZoom+1))}_cluster(q,J){const{radius:oe,extent:Te,reduce:be,minPoints:fe}=this.options,Ke=oe/(Te*Math.pow(2,J)),ze=q.data,Ze=[],yt=this.stride;for(let lt=0;lt<ze.length;lt+=yt){if(ze[lt+2]<=J)continue;ze[lt+2]=J;const Kt=ze[lt],Qt=ze[lt+1],Ii=q.within(ze[lt],ze[lt+1],Ke),Xi=ze[lt+Xt];let Oi=Xi;for(const $i of Ii){const yr=$i*yt;ze[yr+2]>J&&(Oi+=ze[yr+Xt])}if(Oi>Xi&&Oi>=fe){let $i,yr=Kt*Xi,Ji=Qt*Xi,In=-1;const qr=(lt/yt<<5)+(J+1)+this.points.length;for(const $r of Ii){const Tr=$r*yt;if(ze[Tr+2]<=J)continue;ze[Tr+2]=J;const br=ze[Tr+Xt];yr+=ze[Tr]*br,Ji+=ze[Tr+1]*br,ze[Tr+4]=qr,be&&($i||($i=this._map(ze,lt,!0),In=this.clusterProps.length,this.clusterProps.push($i)),be($i,this._map(ze,Tr)))}ze[lt+4]=qr,Ze.push(yr/Oi,Ji/Oi,1/0,qr,-1,Oi),be&&Ze.push(In)}else{for(let $i=0;$i<yt;$i++)Ze.push(ze[lt+$i]);if(Oi>1)for(const $i of Ii){const yr=$i*yt;if(!(ze[yr+2]<=J)){ze[yr+2]=J;for(let Ji=0;Ji<yt;Ji++)Ze.push(ze[yr+Ji])}}}}return Ze}_getOriginId(q){return q-this.points.length>>5}_getOriginZoom(q){return(q-this.points.length)%32}_map(q,J,oe){if(q[J+Xt]>1){const fe=this.clusterProps[q[J+ai]];return oe?Object.assign({},fe):fe}const Te=this.points[q[J+Wt]].properties,be=this.options.map(Te);return oe&&be===Te?Object.assign({},be):be}}function Be(Pe,q,J){return{type:"Feature",id:Pe[q+Wt],properties:Ge(Pe,q,J),geometry:{type:"Point",coordinates:[(oe=Pe[q],360*(oe-.5)),Et(Pe[q+1])]}};var oe}function Ge(Pe,q,J){const oe=Pe[q+Xt],Te=oe>=1e4?`${Math.round(oe/1e3)}k`:oe>=1e3?Math.round(oe/100)/10+"k":oe,be=Pe[q+ai],fe=be===-1?{}:Object.assign({},J[be]);return Object.assign(fe,{cluster:!0,cluster_id:Pe[q+Wt],point_count:oe,point_count_abbreviated:Te})}function Qe(Pe){return Pe/360+.5}function ht(Pe){const q=Math.sin(Pe*Math.PI/180),J=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return J<0?0:J>1?1:J}function Et(Pe){const q=(180-360*Pe)*Math.PI/180;return 360*Math.atan(Math.exp(q))/Math.PI-90}function Ue(Pe,q,J,oe){let Te=oe;const be=q+(J-q>>1);let fe,Ke=J-q;const ze=Pe[q],Ze=Pe[q+1],yt=Pe[J],lt=Pe[J+1];for(let Kt=q+3;Kt<J;Kt+=3){const Qt=ii(Pe[Kt],Pe[Kt+1],ze,Ze,yt,lt);if(Qt>Te)fe=Kt,Te=Qt;else if(Qt===Te){const Ii=Math.abs(Kt-be);Ii<Ke&&(fe=Kt,Ke=Ii)}}Te>oe&&(fe-q>3&&Ue(Pe,q,fe,oe),Pe[fe+2]=Te,J-fe>3&&Ue(Pe,fe,J,oe))}function ii(Pe,q,J,oe,Te,be){let fe=Te-J,Ke=be-oe;if(fe!==0||Ke!==0){const ze=((Pe-J)*fe+(q-oe)*Ke)/(fe*fe+Ke*Ke);ze>1?(J=Te,oe=be):ze>0&&(J+=fe*ze,oe+=Ke*ze)}return fe=Pe-J,Ke=q-oe,fe*fe+Ke*Ke}function Ht(Pe,q,J,oe){const Te={id:Pe??null,type:q,geometry:J,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(q==="Point"||q==="MultiPoint"||q==="LineString")Jt(Te,J);else if(q==="Polygon")Jt(Te,J[0]);else if(q==="MultiLineString")for(const be of J)Jt(Te,be);else if(q==="MultiPolygon")for(const be of J)Jt(Te,be[0]);return Te}function Jt(Pe,q){for(let J=0;J<q.length;J+=3)Pe.minX=Math.min(Pe.minX,q[J]),Pe.minY=Math.min(Pe.minY,q[J+1]),Pe.maxX=Math.max(Pe.maxX,q[J]),Pe.maxY=Math.max(Pe.maxY,q[J+1])}function Lt(Pe,q,J,oe){if(!q.geometry)return;const Te=q.geometry.coordinates;if(Te&&Te.length===0)return;const be=q.geometry.type,fe=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2);let Ke=[],ze=q.id;if(J.promoteId?ze=q.properties[J.promoteId]:J.generateId&&(ze=oe||0),be==="Point")Ai(Te,Ke);else if(be==="MultiPoint")for(const Ze of Te)Ai(Ze,Ke);else if(be==="LineString")ni(Te,Ke,fe,!1);else if(be==="MultiLineString"){if(J.lineMetrics){for(const Ze of Te)Ke=[],ni(Ze,Ke,fe,!1),Pe.push(Ht(ze,"LineString",Ke,q.properties));return}bi(Te,Ke,fe,!1)}else if(be==="Polygon")bi(Te,Ke,fe,!0);else{if(be!=="MultiPolygon"){if(be==="GeometryCollection"){for(const Ze of q.geometry.geometries)Lt(Pe,{id:ze,geometry:Ze,properties:q.properties},J,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ze of Te){const yt=[];bi(Ze,yt,fe,!0),Ke.push(yt)}}Pe.push(Ht(ze,be,Ke,q.properties))}function Ai(Pe,q){q.push(Ci(Pe[0]),Ti(Pe[1]),0)}function ni(Pe,q,J,oe){let Te,be,fe=0;for(let ze=0;ze<Pe.length;ze++){const Ze=Ci(Pe[ze][0]),yt=Ti(Pe[ze][1]);q.push(Ze,yt,0),ze>0&&(fe+=oe?(Te*yt-Ze*be)/2:Math.sqrt(Math.pow(Ze-Te,2)+Math.pow(yt-be,2))),Te=Ze,be=yt}const Ke=q.length-3;q[2]=1,Ue(q,0,Ke,J),q[Ke+2]=1,q.size=Math.abs(fe),q.start=0,q.end=q.size}function bi(Pe,q,J,oe){for(let Te=0;Te<Pe.length;Te++){const be=[];ni(Pe[Te],be,J,oe),q.push(be)}}function Ci(Pe){return Pe/360+.5}function Ti(Pe){const q=Math.sin(Pe*Math.PI/180),J=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return J<0?0:J>1?1:J}function Ei(Pe,q,J,oe,Te,be,fe,Ke){if(oe/=q,be>=(J/=q)&&fe<oe)return Pe;if(fe<J||be>=oe)return null;const ze=[];for(const Ze of Pe){const yt=Ze.geometry;let lt=Ze.type;const Kt=Te===0?Ze.minX:Ze.minY,Qt=Te===0?Ze.maxX:Ze.maxY;if(Kt>=J&&Qt<oe){ze.push(Ze);continue}if(Qt<J||Kt>=oe)continue;let Ii=[];if(lt==="Point"||lt==="MultiPoint")hr(yt,Ii,J,oe,Te);else if(lt==="LineString")wr(yt,Ii,J,oe,Te,!1,Ke.lineMetrics);else if(lt==="MultiLineString")Jr(yt,Ii,J,oe,Te,!1);else if(lt==="Polygon")Jr(yt,Ii,J,oe,Te,!0);else if(lt==="MultiPolygon")for(const Xi of yt){const Oi=[];Jr(Xi,Oi,J,oe,Te,!0),Oi.length&&Ii.push(Oi)}if(Ii.length){if(Ke.lineMetrics&&lt==="LineString"){for(const Xi of Ii)ze.push(Ht(Ze.id,lt,Xi,Ze.tags));continue}lt!=="LineString"&&lt!=="MultiLineString"||(Ii.length===1?(lt="LineString",Ii=Ii[0]):lt="MultiLineString"),lt!=="Point"&&lt!=="MultiPoint"||(lt=Ii.length===3?"Point":"MultiPoint"),ze.push(Ht(Ze.id,lt,Ii,Ze.tags))}}return ze.length?ze:null}function hr(Pe,q,J,oe,Te){for(let be=0;be<Pe.length;be+=3){const fe=Pe[be+Te];fe>=J&&fe<=oe&&_r(q,Pe[be],Pe[be+1],Pe[be+2])}}function wr(Pe,q,J,oe,Te,be,fe){let Ke=on(Pe);const ze=Te===0?Es:es;let Ze,yt,lt=Pe.start;for(let Oi=0;Oi<Pe.length-3;Oi+=3){const $i=Pe[Oi],yr=Pe[Oi+1],Ji=Pe[Oi+2],In=Pe[Oi+3],qr=Pe[Oi+4],$r=Te===0?$i:yr,Tr=Te===0?In:qr;let br=!1;fe&&(Ze=Math.sqrt(Math.pow($i-In,2)+Math.pow(yr-qr,2))),$r<J?Tr>J&&(yt=ze(Ke,$i,yr,In,qr,J),fe&&(Ke.start=lt+Ze*yt)):$r>oe?Tr<oe&&(yt=ze(Ke,$i,yr,In,qr,oe),fe&&(Ke.start=lt+Ze*yt)):_r(Ke,$i,yr,Ji),Tr<J&&$r>=J&&(yt=ze(Ke,$i,yr,In,qr,J),br=!0),Tr>oe&&$r<=oe&&(yt=ze(Ke,$i,yr,In,qr,oe),br=!0),!be&&br&&(fe&&(Ke.end=lt+Ze*yt),q.push(Ke),Ke=on(Pe)),fe&&(lt+=Ze)}let Kt=Pe.length-3;const Qt=Pe[Kt],Ii=Pe[Kt+1],Xi=Te===0?Qt:Ii;Xi>=J&&Xi<=oe&&_r(Ke,Qt,Ii,Pe[Kt+2]),Kt=Ke.length-3,be&&Kt>=3&&(Ke[Kt]!==Ke[0]||Ke[Kt+1]!==Ke[1])&&_r(Ke,Ke[0],Ke[1],Ke[2]),Ke.length&&q.push(Ke)}function on(Pe){const q=[];return q.size=Pe.size,q.start=Pe.start,q.end=Pe.end,q}function Jr(Pe,q,J,oe,Te,be){for(const fe of Pe)wr(fe,q,J,oe,Te,be,!1)}function _r(Pe,q,J,oe){Pe.push(q,J,oe)}function Es(Pe,q,J,oe,Te,be){const fe=(be-q)/(oe-q);return _r(Pe,be,J+(Te-J)*fe,1),fe}function es(Pe,q,J,oe,Te,be){const fe=(be-J)/(Te-J);return _r(Pe,q+(oe-q)*fe,be,1),fe}function xn(Pe,q){const J=[];for(let oe=0;oe<Pe.length;oe++){const Te=Pe[oe],be=Te.type;let fe;if(be==="Point"||be==="MultiPoint"||be==="LineString")fe=ss(Te.geometry,q);else if(be==="MultiLineString"||be==="Polygon"){fe=[];for(const Ke of Te.geometry)fe.push(ss(Ke,q))}else if(be==="MultiPolygon"){fe=[];for(const Ke of Te.geometry){const ze=[];for(const Ze of Ke)ze.push(ss(Ze,q));fe.push(ze)}}J.push(Ht(Te.id,be,fe,Te.tags))}return J}function ss(Pe,q){const J=[];J.size=Pe.size,Pe.start!==void 0&&(J.start=Pe.start,J.end=Pe.end);for(let oe=0;oe<Pe.length;oe+=3)J.push(Pe[oe]+q,Pe[oe+1],Pe[oe+2]);return J}function Qs(Pe,q){if(Pe.transformed)return Pe;const J=1<<Pe.z,oe=Pe.x,Te=Pe.y;for(const be of Pe.features){const fe=be.geometry,Ke=be.type;if(be.geometry=[],Ke===1)for(let ze=0;ze<fe.length;ze+=2)be.geometry.push(jr(fe[ze],fe[ze+1],q,J,oe,Te));else for(let ze=0;ze<fe.length;ze++){const Ze=[];for(let yt=0;yt<fe[ze].length;yt+=2)Ze.push(jr(fe[ze][yt],fe[ze][yt+1],q,J,oe,Te));be.geometry.push(Ze)}}return Pe.transformed=!0,Pe}function jr(Pe,q,J,oe,Te,be){return[Math.round(J*(Pe*oe-Te)),Math.round(J*(q*oe-be))]}function dr(Pe,q,J,oe,Te){const be=q===Te.maxZoom?0:Te.tolerance/((1<<q)*Te.extent),fe={features:[],numPoints:0,numSimplified:0,numFeatures:Pe.length,source:null,x:J,y:oe,z:q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ke of Pe)$o(fe,Ke,be,Te);return fe}function $o(Pe,q,J,oe){const Te=q.geometry,be=q.type,fe=[];if(Pe.minX=Math.min(Pe.minX,q.minX),Pe.minY=Math.min(Pe.minY,q.minY),Pe.maxX=Math.max(Pe.maxX,q.maxX),Pe.maxY=Math.max(Pe.maxY,q.maxY),be==="Point"||be==="MultiPoint")for(let Ke=0;Ke<Te.length;Ke+=3)fe.push(Te[Ke],Te[Ke+1]),Pe.numPoints++,Pe.numSimplified++;else if(be==="LineString")Is(fe,Te,Pe,J,!1,!1);else if(be==="MultiLineString"||be==="Polygon")for(let Ke=0;Ke<Te.length;Ke++)Is(fe,Te[Ke],Pe,J,be==="Polygon",Ke===0);else if(be==="MultiPolygon")for(let Ke=0;Ke<Te.length;Ke++){const ze=Te[Ke];for(let Ze=0;Ze<ze.length;Ze++)Is(fe,ze[Ze],Pe,J,!0,Ze===0)}if(fe.length){let Ke=q.tags||null;if(be==="LineString"&&oe.lineMetrics){Ke={};for(const Ze in q.tags)Ke[Ze]=q.tags[Ze];Ke.mapbox_clip_start=Te.start/Te.size,Ke.mapbox_clip_end=Te.end/Te.size}const ze={geometry:fe,type:be==="Polygon"||be==="MultiPolygon"?3:be==="LineString"||be==="MultiLineString"?2:1,tags:Ke};q.id!==null&&(ze.id=q.id),Pe.features.push(ze)}}function Is(Pe,q,J,oe,Te,be){const fe=oe*oe;if(oe>0&&q.size<(Te?fe:oe))return void(J.numPoints+=q.length/3);const Ke=[];for(let ze=0;ze<q.length;ze+=3)(oe===0||q[ze+2]>fe)&&(J.numSimplified++,Ke.push(q[ze],q[ze+1])),J.numPoints++;Te&&function(ze,Ze){let yt=0;for(let lt=0,Kt=ze.length,Qt=Kt-2;lt<Kt;Qt=lt,lt+=2)yt+=(ze[lt]-ze[Qt])*(ze[lt+1]+ze[Qt+1]);if(yt>0===Ze)for(let lt=0,Kt=ze.length;lt<Kt/2;lt+=2){const Qt=ze[lt],Ii=ze[lt+1];ze[lt]=ze[Kt-2-lt],ze[lt+1]=ze[Kt-1-lt],ze[Kt-2-lt]=Qt,ze[Kt-1-lt]=Ii}}(Ke,be),Pe.push(Ke)}const gs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class eo{constructor(q,J){const oe=(J=this.options=function(be,fe){for(const Ke in fe)be[Ke]=fe[Ke];return be}(Object.create(gs),J)).debug;if(oe&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");let Te=function(be,fe){const Ke=[];if(be.type==="FeatureCollection")for(let ze=0;ze<be.features.length;ze++)Lt(Ke,be.features[ze],fe,ze);else Lt(Ke,be.type==="Feature"?be:{geometry:be},fe);return Ke}(q,J);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Te=function(be,fe){const Ke=fe.buffer/fe.extent;let ze=be;const Ze=Ei(be,1,-1-Ke,Ke,0,-1,2,fe),yt=Ei(be,1,1-Ke,2+Ke,0,-1,2,fe);return(Ze||yt)&&(ze=Ei(be,1,-Ke,1+Ke,0,-1,2,fe)||[],Ze&&(ze=xn(Ze,1).concat(ze)),yt&&(ze=ze.concat(xn(yt,-1)))),ze}(Te,J),Te.length&&this.splitTile(Te,0,0,0),oe&&(Te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(q,J,oe,Te,be,fe,Ke){const ze=[q,J,oe,Te],Ze=this.options,yt=Ze.debug;for(;ze.length;){Te=ze.pop(),oe=ze.pop(),J=ze.pop(),q=ze.pop();const lt=1<<J,Kt=to(J,oe,Te);let Qt=this.tiles[Kt];if(!Qt&&(yt>1&&console.time("creation"),Qt=this.tiles[Kt]=dr(q,J,oe,Te,Ze),this.tileCoords.push({z:J,x:oe,y:Te}),yt)){yt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,oe,Te,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));const br=`z${J}`;this.stats[br]=(this.stats[br]||0)+1,this.total++}if(Qt.source=q,be==null){if(J===Ze.indexMaxZoom||Qt.numPoints<=Ze.indexMaxPoints)continue}else{if(J===Ze.maxZoom||J===be)continue;if(be!=null){const br=be-J;if(oe!==fe>>br||Te!==Ke>>br)continue}}if(Qt.source=null,q.length===0)continue;yt>1&&console.time("clipping");const Ii=.5*Ze.buffer/Ze.extent,Xi=.5-Ii,Oi=.5+Ii,$i=1+Ii;let yr=null,Ji=null,In=null,qr=null,$r=Ei(q,lt,oe-Ii,oe+Oi,0,Qt.minX,Qt.maxX,Ze),Tr=Ei(q,lt,oe+Xi,oe+$i,0,Qt.minX,Qt.maxX,Ze);q=null,$r&&(yr=Ei($r,lt,Te-Ii,Te+Oi,1,Qt.minY,Qt.maxY,Ze),Ji=Ei($r,lt,Te+Xi,Te+$i,1,Qt.minY,Qt.maxY,Ze),$r=null),Tr&&(In=Ei(Tr,lt,Te-Ii,Te+Oi,1,Qt.minY,Qt.maxY,Ze),qr=Ei(Tr,lt,Te+Xi,Te+$i,1,Qt.minY,Qt.maxY,Ze),Tr=null),yt>1&&console.timeEnd("clipping"),ze.push(yr||[],J+1,2*oe,2*Te),ze.push(Ji||[],J+1,2*oe,2*Te+1),ze.push(In||[],J+1,2*oe+1,2*Te),ze.push(qr||[],J+1,2*oe+1,2*Te+1)}}getTile(q,J,oe){q=+q,J=+J,oe=+oe;const Te=this.options,{extent:be,debug:fe}=Te;if(q<0||q>24)return null;const Ke=1<<q,ze=to(q,J=J+Ke&Ke-1,oe);if(this.tiles[ze])return Qs(this.tiles[ze],be);fe>1&&console.log("drilling down to z%d-%d-%d",q,J,oe);let Ze,yt=q,lt=J,Kt=oe;for(;!Ze&&yt>0;)yt--,lt>>=1,Kt>>=1,Ze=this.tiles[to(yt,lt,Kt)];return Ze&&Ze.source?(fe>1&&(console.log("found parent tile z%d-%d-%d",yt,lt,Kt),console.time("drilling down")),this.splitTile(Ze.source,yt,lt,Kt,q,J,oe),fe>1&&console.timeEnd("drilling down"),this.tiles[ze]?Qs(this.tiles[ze],be):null):null}}function to(Pe,q,J){return 32*((1<<Pe)*J+q)+Pe}function Ta(Pe,q){const J=Pe.tileID.canonical;if(!this._geoJSONIndex)return void q(null,null);const oe=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!oe)return void q(null,null);const Te=Ze=>Ze.tags&&"3d_elevation_id"in Ze.tags&&"source"in Ze.tags&&Ze.tags.source==="elevation",be=oe.features.filter(Ze=>Te(Ze));let fe={_geojsonTileLayer:oe.features};be.length>0&&(fe={_geojsonTileLayer:oe.features.filter(Ze=>!Te(Ze)),hd_road_elevation:be});const Ke=new me(fe),ze=function(Ze){const yt=new s.bt;for(const lt of Object.keys(Ze))yt.writeMessage(3,Si,{name:lt,features:Ze[lt]});return yt.finish()}(fe).buffer;q(null,{vectorTile:Ke,rawData:ze})}class xt extends de{constructor(q,J,oe,Te,be,fe,Ke){super(q,J,oe,Te,be,Ta,Ke),fe&&(this.loadGeoJSON=fe),this._dynamicIndex=new ke}loadData(q,J){const oe=q&&q.request,Te=oe&&oe.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(q,(be,fe)=>{if(be||!fe)return J(be);if(typeof fe!="object")return J(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));{try{if(q.filter){const ze=s.U(q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ze.result==="error")throw new Error(ze.value.map(Ze=>`${Ze.key}: ${Ze.message}`).join(", "));fe.features=fe.features.filter(Ze=>ze.value.evaluate({zoom:0},Ze))}q.dynamic?(fe.type==="Feature"&&(fe={type:"FeatureCollection",features:[fe]}),q.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(fe.features,this.loaded),q.cluster&&(fe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=q.cluster?new nr(function({superclusterOptions:ze,clusterProperties:Ze}){if(!Ze||!ze)return ze;const yt={},lt={},Kt={accumulated:null,zoom:0},Qt={properties:null},Ii=Object.keys(Ze);for(const Xi of Ii){const[Oi,$i]=Ze[Xi],yr=s.U($i),Ji=s.U(typeof Oi=="string"?[Oi,["accumulated"],["get",Xi]]:Oi);yt[Xi]=yr.value,lt[Xi]=Ji.value}return ze.map=Xi=>{Qt.properties=Xi;const Oi={};for(const $i of Ii)Oi[$i]=yt[$i].evaluate(Kt,Qt);return Oi},ze.reduce=(Xi,Oi)=>{Qt.properties=Oi;for(const $i of Ii)Kt.accumulated=Xi[$i],Xi[$i]=lt[$i].evaluate(Kt,Qt)},ze}(q)).load(fe.features):q.dynamic?this._dynamicIndex:function(ze,Ze){return new eo(ze,Ze)}(fe,q.geojsonVtOptions)}catch(ze){return J(ze)}const Ke={};if(Te){const ze=E(oe);ze&&(Ke.resourceTiming={},Ke.resourceTiming[q.source]=JSON.parse(JSON.stringify(ze)))}J(null,Ke)}})}reloadTile(q,J){const oe=this.loaded;return oe&&oe[q.uid]?q.partial?J(null,void 0):super.reloadTile(q,J):this.loadTile(q,J)}loadGeoJSON(q,J){if(q.request)s.m(q.request,J);else{if(typeof q.data!="string")return J(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return J(null,JSON.parse(q.data))}catch{return J(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(q,J){try{J(null,this._geoJSONIndex.getClusterExpansionZoom(q.clusterId))}catch(oe){J(oe)}}getClusterChildren(q,J){try{J(null,this._geoJSONIndex.getChildren(q.clusterId))}catch(oe){J(oe)}}getClusterLeaves(q,J){try{J(null,this._geoJSONIndex.getLeaves(q.clusterId,q.limit,q.offset))}catch(oe){J(oe)}}}class xo{constructor(q,J,oe){this.tileID=new s.aO(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.tileZoom=q.tileZoom,this.uid=q.uid,this.zoom=q.zoom,this.canonical=q.tileID.canonical,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=q.projection,this.brightness=J,this.worldview=oe}parse(q,J,oe,Te){this.status="parsing";const be=new s.aO(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),fe=[],Ke=J.familiesBySource[oe.source],ze=new s.fe(be,oe.promoteId);ze.bucketLayerIDs=[],ze.is3DTile=!0,s.ft(q).then(Ze=>{if(!Ze)return Te(new Error("Could not parse tile"));const yt=Ze.json.extensionsUsed&&Ze.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ze.json.asset.extras&&Ze.json.asset.extras.MAPBOX_mesh_features,lt=Ze.json.extensionsUsed&&Ze.json.extensionsUsed.includes("EXT_meshopt_compression"),Kt=new s.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Qt in Ke)for(const Ii of Ke[Qt]){const Xi=Ii[0];ze.bucketLayerIDs.push(Ii.map(yr=>s.B(yr.id,yr.scope))),Xi.recalculate(Kt,[]);const Oi=s.fu(Ze,1/s.d6(oe.tileID.canonical)),$i=new s.fv(Ii,Oi,be,yt,lt,this.brightness,ze,this.worldview);yt||($i.needsUpload=!0),fe.push($i),$i.evaluate(Xi)}this.status="done",Te(null,{buckets:fe,featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Ze=>Te(new Error(Ze.message)))}}class Cr{constructor(q,J,oe,Te,be,fe,Ke,ze){this.actor=q,this.layerIndex=J,this.availableImages=oe,this.availableModels=Te,this.brightness=Ke,this.loading={},this.loaded={},this.worldview=ze}loadTile(q,J){const oe=q.uid,Te=this.loading[oe]=new xo(q,this.brightness,this.worldview);s.bu(q.request,(be,fe)=>{const Ke=!this.loading[oe];return delete this.loading[oe],Ke||be?(Te.status="done",Ke||(this.loaded[oe]=Te),J(be)):fe&&fe.byteLength!==0?void Te.parse(fe,this.layerIndex,q,(ze,Ze)=>{Te.status="done",this.loaded=this.loaded||{},this.loaded[oe]=Te,ze||!Ze?J(ze):J(null,Ze)}):(Te.status="done",this.loaded[oe]=Te,J())})}reloadTile(q,J){const oe=this.loaded,Te=q.uid;if(oe&&oe[Te]){const be=oe[Te];be.projection=q.projection,be.brightness=q.brightness;const fe=(Ke,ze)=>{be.reloadCallback&&(delete be.reloadCallback,this.loadTile(q,J)),J(Ke,ze)};be.status==="parsing"?be.reloadCallback=fe:be.status==="done"&&this.loadTile(q,J)}}abortTile(q,J){const oe=q.uid;this.loading[oe]&&delete this.loading[oe],J()}removeTile(q,J){const oe=this.loaded,Te=q.uid;oe&&oe[Te]&&delete oe[Te],J()}}class gr{constructor(q){this.self=q,this.actor=new s.fx(q,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.cl({name:"mercator"}),this.workerSourceTypes={vector:de,geojson:xt,"raster-dem":Ce,"raster-array":Le,"batched-model":Cr},this.workerSources={},this.self.registerWorkerSource=(J,oe)=>{if(this.workerSourceTypes[J])throw new Error(`Worker source with name "${J}" already registered.`);this.workerSourceTypes[J]=oe},this.self.registerRTLTextPlugin=J=>{if(s.fy.isParsed())throw new Error("RTL text plugin already registered.");s.fy.setState({pluginStatus:s.fz.parsed,pluginURL:s.fy.getPluginURL()}),s.fy.applyArabicShaping=J.applyArabicShaping,s.fy.processBidirectionalText=J.processBidirectionalText,s.fy.processStyledBidirectionalText=J.processStyledBidirectionalText;for(const oe of this.rtlPluginParsingListeners)oe(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(q,J,oe){delete this.layerIndexes[q],delete this.availableImages[q],delete this.availableModels[q],delete this.workerSources[q],oe()}checkIfReady(q,J,oe){oe()}setReferrer(q,J){this.referrer=J}spriteLoaded(q,J){this.isSpriteLoaded[q]||(this.isSpriteLoaded[q]={});const{scope:oe,isLoaded:Te}=J;if(this.isSpriteLoaded[q][oe]=Te,this.workerSources[q]&&this.workerSources[q][oe])for(const be in this.workerSources[q][oe]){const fe=this.workerSources[q][oe][be];for(const Ke in fe){const ze=fe[Ke];ze instanceof de&&(ze.isSpriteLoaded=Te,ze.fire(new s.z("isSpriteLoaded")))}}}setImages(q,J,oe){this.availableImages[q]||(this.availableImages[q]={});const{scope:Te,images:be}=J;if(this.availableImages[q][Te]=be,this.workerSources[q]&&this.workerSources[q][Te]){for(const fe in this.workerSources[q][Te]){const Ke=this.workerSources[q][Te][fe];for(const ze in Ke)Ke[ze].availableImages=be}oe()}else oe()}setModels(q,{scope:J,models:oe},Te){if(this.availableModels[q]||(this.availableModels[q]={}),this.availableModels[q][J]=oe,this.workerSources[q]&&this.workerSources[q][J]){for(const be in this.workerSources[q][J]){const fe=this.workerSources[q][J][be];for(const Ke in fe)fe[Ke].availableModels=oe}Te()}else Te()}setProjection(q,J){this.projections[q]=s.cl(J)}setBrightness(q,J,oe){this.brightness=J,oe()}setWorldview(q,J,oe){this.worldview=J,oe()}setLayers(q,J,oe){this.getLayerIndex(q,J.scope).replace(J.layers,J.options),oe()}updateLayers(q,J,oe){this.getLayerIndex(q,J.scope).update(J.layers,J.removedIds,J.options),oe()}loadTile(q,J,oe){J.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,J.type,J.source,J.scope).loadTile(J,oe)}decodeRasterArray(q,J,oe){this.getWorkerSource(q,J.type,J.source,J.scope).decodeRasterArray(J,oe)}reloadTile(q,J,oe){J.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,J.type,J.source,J.scope).reloadTile(J,oe)}abortTile(q,J,oe){this.getWorkerSource(q,J.type,J.source,J.scope).abortTile(J,oe)}removeTile(q,J,oe){this.getWorkerSource(q,J.type,J.source,J.scope).removeTile(J,oe)}removeSource(q,J,oe){if(!(this.workerSources[q]&&this.workerSources[q][J.scope]&&this.workerSources[q][J.scope][J.type]&&this.workerSources[q][J.scope][J.type][J.source]))return;const Te=this.workerSources[q][J.scope][J.type][J.source];delete this.workerSources[q][J.scope][J.type][J.source],Te.removeSource!==void 0?Te.removeSource(J,oe):oe()}loadWorkerSource(q,J,oe){try{this.self.importScripts(J.url),oe()}catch(Te){oe(Te.toString())}}syncRTLPluginState(q,J,oe){if(s.fy.isParsed())oe(null,!0);else if(s.fy.isParsing())this.rtlPluginParsingListeners.push(oe);else try{s.fy.setState(J);const Te=s.fy.getPluginURL();!s.fy.isLoaded()||s.fy.isParsed()||s.fy.isParsing()||Te==null||(s.fy.setState({pluginStatus:s.fz.parsing,pluginURL:s.fy.getPluginURL()}),this.self.importScripts(Te),s.fy.isParsed()?oe(null,!0):this.rtlPluginParsingListeners.push(oe))}catch(Te){oe(Te.toString())}}setDracoUrl(q,J){this.dracoUrl=J}getAvailableImages(q,J){this.availableImages[q]||(this.availableImages[q]={});let oe=this.availableImages[q][J];return oe||(oe=[]),oe}getAvailableModels(q,J){this.availableModels[q]||(this.availableModels[q]={});let oe=this.availableModels[q][J];return oe||(oe={}),oe}getLayerIndex(q,J){this.layerIndexes[q]||(this.layerIndexes[q]={});let oe=this.layerIndexes[q][J];return oe||(oe=this.layerIndexes[q][J]=new A,oe.scope=J),oe}getWorkerSource(q,J,oe,Te){const be=this.workerSources;return be[q]||(be[q]={}),be[q][Te]||(be[q][Te]={}),be[q][Te][J]||(be[q][Te][J]={}),this.isSpriteLoaded[q]||(this.isSpriteLoaded[q]={}),be[q][Te][J][oe]||(be[q][Te][J][oe]=new this.workerSourceTypes[J]({send:(fe,Ke,ze,Ze,yt,lt)=>this.actor.send(fe,Ke,ze,q,yt,lt),scheduler:this.actor.scheduler},this.getLayerIndex(q,Te),this.getAvailableImages(q,Te),this.getAvailableModels(q,Te),this.isSpriteLoaded[q][Te],void 0,this.brightness,this.worldview)),be[q][Te][J][oe]}rasterizeImagesWorker(q,J,oe){const Te=new Map;for(const[be,{image:fe,imageVariant:Ke}]of J.tasks.entries()){const ze=this.imageRasterizer.rasterize(Ke,fe,J.scope,q);Te.set(be,ze)}oe(void 0,Te)}removeRasterizedImages(q,J,oe){this.imageRasterizer.removeImagesFromCacheByIds(J.imageIds,J.scope,q),oe()}enforceCacheSizeLimit(q,J){s.fA(J)}getWorkerPerformanceMetrics(q,J,oe){oe(void 0,void 0)}}return s.fw(self)&&(self.worker=new gr(self)),gr}),f(["./shared"],function(s){var E="3.15.0";const R={create:"create",load:"load",fullLoad:"fullLoad"},O={mark(m){performance.mark(m)},measure(m,n,u){performance.measure(m,n,u)}};function A(m){const n=m.name.split("?")[0];return s.a(n)&&n.includes("mapbox-gl.js")?"javascript":s.a(n)&&n.includes("mapbox-gl.css")?"css":s.b(n)?"fontRange":s.c(n)?"sprite":s.i(n)?"style":s.d(n)?"tilejson":"other"}var U,$={},te=function(){if(U)return $;function m(p){return!n(p)}function n(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,w,I=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(I);try{w=new Worker(C),x=!0}catch{x=!1}return w&&w.terminate(),URL.revokeObjectURL(C),x}()?function(){var x=document.createElement("canvas");x.width=x.height=1;var w=x.getContext("2d");if(!w)return!1;var I=w.getImageData(0,0,1,1);return I&&I.width===x.width}()?(u[v=p&&p.failIfMajorPerformanceCaveat]===void 0&&(u[v]=function(x){var w,I=function(C){var D=document.createElement("canvas"),F=Object.create(m.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=C,D.getContext("webgl2",F)}(x);if(!I)return!1;try{w=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!w||I.isContextLost())&&(I.shaderSource(w,"void main() {}"),I.compileShader(w),I.getShaderParameter(w,I.COMPILE_STATUS)===!0)}(v)),u[v]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var v}U=1,$.supported=m,$.notSupportedReason=n;var u={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},$}();function Q(m,n,u){const p=document.createElement(m);return n!=null&&(p.className=n),u&&u.appendChild(p),p}function de(m,n,u){const p=document.createElementNS("http://www.w3.org/2000/svg",m);for(const v of Object.keys(n))p.setAttributeNS(null,v,String(n[v]));return u&&u.appendChild(p),p}const Ce=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Fe=Ce&&Ce.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Le;function Me(){Ce&&Fe&&(Le=Ce[Fe],Ce[Fe]="none")}function at(){Ce&&Fe&&(Ce[Fe]=Le)}function pt(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",pt,!0)}function me(){window.addEventListener("click",pt,!0),window.setTimeout(()=>{window.removeEventListener("click",pt,!0)},0)}function ye(m,n){const u=m.getBoundingClientRect();return Ve(m,u,n)}function Se(m,n){const u=m.getBoundingClientRect(),p=[];for(let v=0;v<n.length;v++)p.push(Ve(m,u,n[v]));return p}function ke(m){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&m.button===2&&m.ctrlKey?0:m.button}function Ve(m,n,u){const p=m.offsetWidth===n.width?1:m.offsetWidth/n.width;return new s.P((u.clientX-n.left)*p,(u.clientY-n.top)*p)}const He="01",Oe="NO_ACCESS_TOKEN";class xi{constructor(n,u,p){this._transformRequestFn=n,this._customAccessToken=u,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const n=function(){let u="";for(let p=0;p<10;p++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",He,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,u){return this._transformRequestFn&&this._transformRequestFn(n,u)||{url:n}}normalizeStyleURL(n,u){if(!s.h(n))return n;const p=ti(n);return p.params.push(`sdk=js-${E}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||u)}normalizeGlyphsURL(n,u){if(!s.h(n))return n;const p=ti(n);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||u)}normalizeModelURL(n,u){if(!s.h(n))return n;const p=ti(n);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||u)}normalizeSourceURL(n,u,p,v){if(!s.h(n))return n;const x=ti(n);return x.path=`/v4/${x.authority}.json`,x.params.push("secure"),p&&x.params.push(`language=${p}`),v&&x.params.push(`worldview=${v}`),this._makeAPIURL(x,this._customAccessToken||u)}normalizeIconsetURL(n,u){const p=ti(n);return s.h(n)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||u)):ri(p)}normalizeSpriteURL(n,u,p,v){const x=ti(n);return s.h(n)?(x.path=`/styles/v1${x.path}/sprite${u}${p}`,this._makeAPIURL(x,this._customAccessToken||v)):(x.path+=`${u}${p}`,ri(x))}normalizeTileURL(n,u,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!s.h(n))return n;const v=ti(n);v.path=v.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${u||p&&v.authority!=="raster"&&p===512?"@2x":""}${s.k.supported?".webp":"$1"}`),v.authority==="raster"?v.path=`/${s.e.RASTER_URL_PREFIX}${v.path}`:v.authority==="rasterarrays"?v.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${v.path}`:v.authority==="3dtiles"?v.path=`/${s.e.TILES3D_URL_PREFIX}${v.path}`:(v.path=v.path.replace(/^.+\/v4\//,"/"),v.path=`/${s.e.TILE_URL_VERSION}${v.path}`);const x=this._customAccessToken||function(w){for(const I of w){const C=I.match(/^access_token=(.*)$/);if(C)return C[1]}return null}(v.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&v.params.push(`sku=${this._skuToken}`),this._makeAPIURL(v,x)}canonicalizeTileURL(n,u){const p=ti(n);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return n;let v="mapbox://";p.path.match(/^\/raster\/v1\//)?v+=`raster/${p.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?v+=`rasterarrays/${p.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:v+=`tiles/${p.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let x=p.params;return u&&(x=x.filter(w=>!w.match(/^access_token=/))),x.length&&(v+=`?${x.join("&")}`),v}canonicalizeTileset(n,u){const p=!!u&&s.h(u),v=[];for(const x of n.tiles||[])s.j(x)?v.push(this.canonicalizeTileURL(x,p)):v.push(x);return v}_makeAPIURL(n,u){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",v=ti(s.e.API_URL);if(n.protocol=v.protocol,n.authority=v.authority,n.protocol==="http"){const x=n.params.indexOf("secure");x>=0&&n.params.splice(x,1)}if(v.path!=="/"&&(n.path=`${v.path}${n.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return ri(n);if(u=u||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!u)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(u[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return n.params=n.params.filter(x=>x.indexOf("access_token")===-1),n.params.push(`access_token=${u||""}`),ri(n)}}const ui=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ti(m){const n=m.match(ui);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function ri(m){const n=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${n}`}const Si="mapbox.eventData";function ir(m){if(!m)return null;const n=m.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(s.l(n[1]))}catch{return null}}class st{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const u=ir(s.e.ACCESS_TOKEN);let p="";return p=u&&u.u?s.f(u.u):s.e.ACCESS_TOKEN||"",n?`${Si}.${n}:${p}`:`${Si}:${p}`}fetchEventData(){const n=s.s("localStorage"),u=this.getStorageKey(),p=this.getStorageKey("uuid");if(n)try{const v=localStorage.getItem(u);v&&(this.eventData=JSON.parse(v));const x=localStorage.getItem(p);x&&(this.anonId=x)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const n=s.s("localStorage"),u=this.getStorageKey(),p=this.getStorageKey("uuid"),v=this.anonId;if(n&&v)try{localStorage.setItem(p,v),Object.keys(this.eventData).length>=1&&localStorage.setItem(u,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,u,p,v){if(!s.e.EVENTS_URL)return;const x=ti(s.e.EVENTS_URL);x.params.push(`access_token=${v||s.e.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(n).toISOString()},I=u?Object.assign(w,u):w,C={url:ri(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=s.p(C,D=>{this.pendingRequest=null,p(D),this.saveEventData(),this.processRequests(v)})}queueRequest(n,u){this.queue.push(n),this.processRequests(u)}}const wi=new class extends st{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,n){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some(u=>s.h(u)||s.j(u))&&this.queueRequest(Date.now(),n)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=ir(s.e.ACCESS_TOKEN),u=n?n.u:s.e.ACCESS_TOKEN;let p=u!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),p=!0);const v=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),w=new Date(v),I=(v-this.eventData.lastSuccess)/864e5;p=p||I>=1||I<-1||x.getDate()!==w.getDate()}else p=!0;p?this.postEvent(v,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:He,"enabled.telemetry":!1,userId:this.anonId},x=>{x||(this.eventData.lastSuccess=v,this.eventData.tokenU=u)},m):this.processRequests()}},ji=wi.postTurnstileEvent.bind(wi),Ar=new class extends st{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,n,u,p){this.skuToken=n,this.errorCb=p,s.e.EVENTS_URL&&(u||s.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},u):this.errorCb(new Error(Oe)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:u}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:He,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},m))}remove(){this.errorCb=null}},Br=Ar.postMapLoadEvent.bind(Ar),Vr=new class extends st{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let n=this.mapInstanceIdMap.get(m);return n||(n=s.u(),this.mapInstanceIdMap.set(m,n)),n}getEventId(m){const n=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,n+1),n}postStyleLoadEvent(m,n){const{map:u,style:p,importedStyles:v}=n;if(!s.e.EVENTS_URL||!m&&!s.e.ACCESS_TOKEN)return;const x=this.getMapInstanceId(u),w={mapInstanceId:x,eventId:this.getEventId(x),style:p};v.length&&(w.importedStyles=v),this.queueRequest({timestamp:Date.now(),payload:w},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:u}=this.queue.shift();this.postEvent(n,u,()=>{},m)}},Ni=Vr.postStyleLoadEvent.bind(Vr),vt=new class extends st{constructor(){super("gljs.performance")}postPerformanceEvent(m,n){s.e.EVENTS_URL&&(m||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:u}=this.queue.shift(),p=function(v){const x=performance.getEntriesByType("resource"),w=performance.getEntriesByType("mark"),I=function(j){const G={};if(j){for(const H in j)if(H!=="other")for(const ee of j[H]){const K=`${H}ResolveRangeMin`,ie=`${H}ResolveRangeMax`,ae=`${H}RequestCount`,ce=`${H}RequestCachedCount`;G[K]=Math.min(G[K]||1/0,ee.startTime),G[ie]=Math.max(G[ie]||-1/0,ee.responseEnd);const ve=_e=>{G[_e]===void 0&&(G[_e]=0),++G[_e]};ee.transferSize!==void 0&&ee.transferSize===0&&ve(ce),ve(ae)}}return G}(function(j,G){const H={};if(j)for(const ee of j){const K=G(ee);H[K]===void 0&&(H[K]=[]),H[K].push(ee)}return H}(x,A)),C=window.devicePixelRatio,D=navigator.connection||navigator.mozConnection||navigator.webkitConnection,F=D?D.effectiveType:void 0,V={counters:[],metadata:[],attributes:[]},z=(j,G,H)=>{H!=null&&j.push({name:G,value:H.toString()})};for(const j in I)z(V.counters,j,I[j]);if(v.interactionRange[0]!==1/0&&v.interactionRange[1]!==-1/0&&(z(V.counters,"interactionRangeMin",v.interactionRange[0]),z(V.counters,"interactionRangeMax",v.interactionRange[1])),w)for(const j of Object.keys(R)){const G=R[j],H=w.find(ee=>ee.name===G);H&&z(V.counters,G,H.startTime)}return z(V.counters,"visibilityHidden",v.visibilityHidden),z(V.attributes,"style",function(j){if(j)for(const G of j){const H=G.name.split("?")[0];if(s.i(H)){const ee=H.split("/").slice(-2);if(ee.length===2)return`mapbox://styles/${ee[0]}/${ee[1]}`}}}(x)),z(V.attributes,"terrainEnabled",v.terrainEnabled?"true":"false"),z(V.attributes,"fogEnabled",v.fogEnabled?"true":"false"),z(V.attributes,"projection",v.projection),z(V.attributes,"zoom",v.zoom),z(V.metadata,"devicePixelRatio",C),z(V.metadata,"connectionEffectiveType",F),z(V.metadata,"navigatorUserAgent",navigator.userAgent),z(V.metadata,"screenWidth",window.screen.width),z(V.metadata,"screenHeight",window.screen.height),z(V.metadata,"windowWidth",window.innerWidth),z(V.metadata,"windowHeight",window.innerHeight),z(V.metadata,"mapWidth",v.width/C),z(V.metadata,"mapHeight",v.height/C),z(V.metadata,"webglRenderer",v.renderer),z(V.metadata,"webglVendor",v.vendor),z(V.metadata,"sdkVersion",E),z(V.metadata,"sdkIdentifier","mapbox-gl-js"),V}(u);for(const v of p.metadata);for(const v of p.counters);for(const v of p.attributes);this.postEvent(n,p,()=>{},m)}},Wt=vt.postPerformanceEvent.bind(vt),Xt=new class extends st{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,n,u,p){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const v=ti(s.e.API_URL+s.e.SESSION_PATH);v.params.push(`sku=${n||""}`),v.params.push(`access_token=${p||s.e.ACCESS_TOKEN||""}`);const x={url:ri(v),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(x,w=>{this.pendingRequest=null,u(w),this.saveEventData(),this.processRequests(p)})}getSessionAPI(m,n,u,p){this.skuToken=n,this.errorCb=p,s.e.SESSION_PATH&&s.e.API_URL&&(u||s.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},u):this.errorCb(new Error(Oe)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:u}=this.queue.shift();n&&this.success[n]||this.getSession(u,this.skuToken,p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},m)}remove(){this.errorCb=null}},ai=Xt.getSessionAPI.bind(Xt),nr=new Set;function Be(m,n){n?nr.add(m):nr.delete(m)}class Ge{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,u){this._updatedSourceCaches[n]=u,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const u=n.scope;this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._updatedLayers[u].add(n.id),this.setDirty()}removeLayer(n){const u=n.scope;this._removedLayers[u]=this._removedLayers[u]||{},this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._removedLayers[u][n.id]=n,this._updatedLayers[u].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const u in this._updatedLayers)n[u]=n[u]||{},n[u].updatedIds=Array.from(this._updatedLayers[u].values());for(const u in this._removedLayers)n[u]=n[u]||{},n[u].removedIds=Object.keys(this._removedLayers[u]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(n){return this._updatedImages[n]?Array.from(this._updatedImages[n].values()):[]}updateImage(n,u){this._updatedImages[u]=this._updatedImages[u]||new Set,this._updatedImages[u].add(s.I.toString(n)),this.setDirty()}resetUpdatedImages(n){this._updatedImages[n]&&this._updatedImages[n].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Qe(m){const{userImage:n}=m;return!!(n&&n.render&&n.render())&&(m.data.replace(new Uint8Array(n.data.buffer)),!0)}class ht extends s.E{constructor(n){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=n,n!=="raster"&&s.r()&&(this.imageRasterizerDispatcher=new s.D(s.t(),this,"Image Rasterizer Worker",1))}addScope(n){this.loaded.set(n,!1),this.imageProviders.set(n,new Map),this.images.set(n,new Map),this.updatedImages.set(n,new Set),this.callbackDispatchedThisFrame.set(n,new Set),this.patterns.set(n,new Map),this.atlasImage.set(n,new s.q({width:1,height:1}))}removeScope(n){this.loaded.delete(n),this.imageProviders.delete(n),this.images.delete(n),this.updatedImages.delete(n),this.callbackDispatchedThisFrame.delete(n),this.patterns.delete(n),this.atlasImage.delete(n);const u=this.atlasTexture.get(n);u&&(u.destroy(),this.atlasTexture.delete(n))}addImageProvider(n,u){this.imageProviders.has(u)||this.imageProviders.set(u,new Map),this.imageProviders.get(u).set(n.id,n)}removeImageProvider(n,u){this.imageProviders.has(u)&&this.imageProviders.get(u).delete(n)}getPendingImageProviders(){const n=[];for(const u of this.imageProviders.values())for(const p of u.values())p.hasPendingRequests()&&n.push(p);return n}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.x),this._imageRasterizer}isLoaded(){for(const n of this.loaded.keys())if(!this.loaded.get(n))return!1;return!0}setLoaded(n,u){if(this.loaded.get(u)!==n&&(this.loaded.set(u,n),n)){for(const{ids:p,callback:v}of this.requestors)this._notify(p,u,v);this.requestors=[]}}hasImage(n,u){return!!this.getImage(n,u)}getImage(n,u){return this.images.get(u).get(n.toString())}addImage(n,u,p){this._validate(n,p)&&this.images.get(u).set(n.toString(),p)}_validate(n,u){let p=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(u.content,u)||(this.fire(new s.y(new Error(`Image "${n.name}" has invalid "content" value`))),p=!1),p}_validateStretch(n,u){if(!n)return!0;let p=0;for(const v of n){if(v[0]<p||v[1]<v[0]||u<v[1])return!1;p=v[1]}return!0}_validateContent(n,u){return n?n.length!==4||!u.usvg&&(n[0]<0||u.data.width<n[0]||n[1]<0||u.data.height<n[1]||n[2]<0||u.data.width<n[2]||n[3]<0||u.data.height<n[3])?!1:!(n[2]<n[0]||n[3]<n[1]):!0}updateImage(n,u,p){const v=this.images.get(u).get(n.toString());p.version=v.version+1,this.images.get(u).set(n.toString(),p),this.updatedImages.get(u).add(n),this.removeFromImageRasterizerCache(n,u)}clearUpdatedImages(n){this.updatedImages.get(n).clear()}removeFromImageRasterizerCache(n,u){this.spriteFormat!=="raster"&&(s.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[n],scope:u}):this.imageRasterizer.removeImagesFromCacheByIds([n],u))}removeImage(n,u){const p=this.images.get(u),v=p.get(n.toString());p.delete(n.toString()),this.patterns.get(u).delete(n.toString()),this.removeFromImageRasterizerCache(n,u),v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()}listImages(n){return Array.from(this.images.get(n).keys()).map(u=>s.I.from(u))}getImages(n,u,p){const v=[],x=[],w=this.imageProviders.get(u);for(const F of n){if(!F.iconsetId){v.push(F);continue}const V=w.get(F.iconsetId);V&&(this.getImage(F,u)?x.push(F):V.addPendingRequest(F))}if(v.length===0)return void this._notify(x,u,p);let I=!0;const C=!!this.loaded.get(u),D=this.images.get(u);if(!C)for(const F of v)D.has(F.toString())||(I=!1);C||I?this._notify(v,u,p):this.requestors.push({ids:v,scope:u,callback:p})}rasterizeImages(n,u){const p=new Map,{tasks:v,scope:x}=n;for(const[w,I]of v.entries()){const C=this.getImage(I.id,x);C&&p.set(w,{image:C,imageVariant:I})}this._rasterizeImages(x,p,u)}_rasterizeImages(n,u,p){if(s.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:u,scope:n},p);else{const v=new Map;for(const[x,{image:w,imageVariant:I}]of u.entries())v.set(x,this.imageRasterizer.rasterize(I,w,n,0));p(void 0,v)}}getUpdatedImages(n){return this.updatedImages.get(n)||new Set}_notify(n,u,p){const v=this.images.get(u),x=new Map;for(const w of n){if(!v.get(w.toString())){if(w.iconsetId)continue;this.fire(new s.z("styleimagemissing",{id:w.name}))}const I=v.get(w.toString());if(!I){s.w(`Image "${w.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const C={data:I.usvg?null:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,usvg:I.usvg,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:!!(I.userImage&&I.userImage.render)};I.usvg&&Object.assign(C,{width:I.icon.usvg_tree.width,height:I.icon.usvg_tree.height}),x.set(s.I.toString(w),C)}p(null,x)}getPixelSize(n){const{width:u,height:p}=this.atlasImage.get(n);return{width:u,height:p}}getPattern(n,u,p){const v=n.toString(),x=this.patterns.get(u),w=x.get(v),I=this.getImage(n,u);if(!I)return null;if(w){if(w.position.version===I.version)return w.position;w.position.version=I.version}else{if(I.usvg&&!I.data){const C=this.getPatternInFlightId(v,u);if(this.patternsInFlight.has(C))return null;this.patternsInFlight.add(C);const D=new s.A(n).scaleSelf(s.o.devicePixelRatio),F=new Map([[D.toString(),{image:I,imageVariant:D}]]);return this._rasterizeImages(u,F,(V,z)=>this.storePatternImage(D,u,I,p,z)),null}this.storePattern(n,u,I)}return this._updatePatternAtlas(u,p),x.get(v).position}getPatternInFlightId(n,u){return s.B(n,u)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(n,u,p,v,x){const w=n.toString(),I=x?x.get(w):void 0;I&&(p.data=I,this.storePattern(n.id,u,p),this._updatePatternAtlas(u,v),this.patternsInFlight.delete(this.getPatternInFlightId(n.id.toString(),u)))}storePattern(n,u,p){const v={w:p.data.width+2*s.C,h:p.data.height+2*s.C,x:0,y:0},x=new s.F(v,p,s.C);this.patterns.get(u).set(n.toString(),{bin:v,position:x})}destroyAtlasTextures(){for(const n of this.atlasTexture.values())n&&n.destroy();this.atlasTexture.clear()}bind(n,u){const p=n.gl;let v=this.atlasTexture.get(u);v?this.dirty&&(v.update(this.atlasImage.get(u)),this.dirty=!1):(v=new s.T(n,this.atlasImage.get(u),p.RGBA8),this.atlasTexture.set(u,v)),v.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(n,u){const p=this.patterns.get(n),v=Array.from(p.values()).map(({bin:D})=>D),{w:x,h:w}=s.G(v),I=this.atlasImage.get(n);I.resize({width:x||1,height:w||1});const C=this.images.get(n);for(const[D,{bin:F,position:V}]of p.entries()){let z=V.padding;const j=F.x+z,G=F.y+z,H=C.get(D).data,ee=H.width,K=H.height;z=z>1?z-1:z,s.q.copy(H,I,{x:0,y:0},{x:j,y:G},{width:ee,height:K},u),s.q.copy(H,I,{x:0,y:K-z},{x:j,y:G-z},{width:ee,height:z},u),s.q.copy(H,I,{x:0,y:0},{x:j,y:G+K},{width:ee,height:z},u),s.q.copy(H,I,{x:ee-z,y:0},{x:j-z,y:G},{width:z,height:K},u),s.q.copy(H,I,{x:0,y:0},{x:j+ee,y:G},{width:z,height:K},u),s.q.copy(H,I,{x:ee-z,y:K-z},{x:j-z,y:G-z},{width:z,height:z},u),s.q.copy(H,I,{x:0,y:K-z},{x:j+ee,y:G-z},{width:z,height:z},u),s.q.copy(H,I,{x:0,y:0},{x:j+ee,y:G+K},{width:z,height:z},u),s.q.copy(H,I,{x:ee-z,y:0},{x:j-z,y:G+K},{width:z,height:z},u)}this.dirty=!0}beginFrame(){for(const n of this.images.keys())this.callbackDispatchedThisFrame.set(n,new Set)}dispatchRenderCallbacks(n,u){const p=this.images.get(u);for(const v of n){if(this.callbackDispatchedThisFrame.get(u).has(v.toString()))continue;this.callbackDispatchedThisFrame.get(u).add(v.toString());const x=p.get(v.toString());Qe(x)&&this.updateImage(v,u,x)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Et(m){const n=m.value,u=m.valueSpec,p=m.style,v=m.styleSpec,x=m.key,w=m.arrayElementValidator||jr;if(!Array.isArray(n))return[new s.V(x,n,`array expected, ${s.K(n)} found`)];if(u.length&&n.length!==u.length)return[new s.V(x,n,`array length ${u.length} expected, length ${n.length} found`)];if(u["min-length"]&&n.length<u["min-length"])return[new s.V(x,n,`array length at least ${u["min-length"]} expected, length ${n.length} found`)];let I={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};v.$version<7&&(I.function=u.function),s.H(u.value)&&(I=u.value);let C=[];for(let D=0;D<n.length;D++)C=C.concat(w({array:n,arrayIndex:D,value:n[D],valueSpec:I,style:p,styleSpec:v,key:`${x}[${D}]`},!0));return C}function Ue(m){const n=m.key,u=m.value,p=m.valueSpec;if(!s.L(u))return[new s.V(n,u,`number expected, ${s.K(u)} found`)];if(u!=u)return[new s.V(n,u,"number expected, NaN found")];if("minimum"in p){let v=p.minimum;if(Array.isArray(p.minimum)&&(v=p.minimum[m.arrayIndex]),u<v)return[new s.V(n,u,`${u} is less than the minimum value ${v}`)]}if("maximum"in p){let v=p.maximum;if(Array.isArray(p.maximum)&&(v=p.maximum[m.arrayIndex]),u>v)return[new s.V(n,u,`${u} is greater than the maximum value ${v}`)]}return[]}function ii(m){const n=m.key,u=m.value;if(!s.H(u))return[new s.V(n,u,`object expected, ${s.K(u)} found`)];const p=m.valueSpec,v=s.J(u.type);let x,w,I,C={};const D=v!=="categorical"&&u.property===void 0,F=!D,V=function(H){const ee=H.stops;return Array.isArray(ee)&&Array.isArray(ee[0])&&s.H(ee[0][0])}(u),z=dr({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(H){if(v==="identity")return[new s.V(H.key,H.value,'identity function may not have a "stops" property')];let ee=[];const K=H.value;return ee=ee.concat(Et({key:H.key,value:K,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:j})),Array.isArray(K)&&K.length===0&&ee.push(new s.V(H.key,K,"array must have at least one stop")),ee},default:function(H){return jr({key:H.key,value:H.value,valueSpec:p,style:H.style,styleSpec:H.styleSpec})}}});return v==="identity"&&D&&z.push(new s.V(m.key,m.value,'missing required property "property"')),v==="identity"||u.stops||z.push(new s.V(m.key,m.value,'missing required property "stops"')),v==="exponential"&&p.expression&&!s.M(p)&&z.push(new s.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(F&&!s.N(p)?z.push(new s.V(m.key,m.value,"property functions not supported")):D&&!s.O(p)&&z.push(new s.V(m.key,m.value,"zoom functions not supported"))),v!=="categorical"&&!V||u.property!==void 0||z.push(new s.V(m.key,m.value,'"property" property is required')),z;function j(H){let ee=[];const K=H.value,ie=H.key;if(!Array.isArray(K))return[new s.V(ie,K,`array expected, ${s.K(K)} found`)];if(K.length!==2)return[new s.V(ie,K,`array length 2 expected, length ${K.length} found`)];if(V){if(!s.H(K[0]))return[new s.V(ie,K,`object expected, ${s.K(K[0])} found`)];const ae=K[0];if(ae.zoom===void 0)return[new s.V(ie,K,"object stop key must have zoom")];if(ae.value===void 0)return[new s.V(ie,K,"object stop key must have value")];const ce=s.J(ae.zoom);if(typeof ce!="number")return[new s.V(ie,ae.zoom,"stop zoom values must be numbers")];if(I&&I>ce)return[new s.V(ie,ae.zoom,"stop zoom values must appear in ascending order")];ce!==I&&(I=ce,w=void 0,C={}),ee=ee.concat(dr({key:`${ie}[0]`,value:K[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:Ue,value:G}}))}else ee=ee.concat(G({key:`${ie}[0]`,value:K[0],style:H.style,styleSpec:H.styleSpec},K));return s.Q(s.S(K[1]))?ee.concat([new s.V(`${ie}[1]`,K[1],"expressions are not allowed in function stops.")]):ee.concat(jr({key:`${ie}[1]`,value:K[1],valueSpec:p,style:H.style,styleSpec:H.styleSpec}))}function G(H,ee){const K=s.K(H.value),ie=s.J(H.value),ae=H.value!==null?H.value:ee;if(x){if(K!==x)return[new s.V(H.key,ae,`${K} stop domain type must match previous stop domain type ${x}`)]}else x=K;if(K!=="number"&&K!=="string"&&K!=="boolean"&&typeof ie!="number"&&typeof ie!="string"&&typeof ie!="boolean")return[new s.V(H.key,ae,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&v!=="categorical"){let ce=`number expected, ${K} found`;return s.N(p)&&v===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(H.key,ae,ce)]}return v!=="categorical"||K!=="number"||typeof ie=="number"&&isFinite(ie)&&Math.floor(ie)===ie?v!=="categorical"&&K==="number"&&typeof ie=="number"&&typeof w=="number"&&w!==void 0&&ie<w?[new s.V(H.key,ae,"stop domain values must appear in ascending order")]:(w=ie,v==="categorical"&&ie in C?[new s.V(H.key,ae,"stop domain values must be unique")]:(C[ie]=!0,[])):[new s.V(H.key,ae,`integer expected, found ${String(ie)}`)]}}function Ht(m){const n=(m.expressionContext==="property"?s.W:s.U)(s.S(m.value),m.valueSpec);if(n.result==="error")return n.value.map(p=>new s.V(`${m.key}${p.key}`,m.value,p.message));const u=n.value.expression||n.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!u.outputDefined())return[new s.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!s.Z(u))return[new s.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return Jt(u,m);if(m.expressionContext==="appearance")return Lt(u,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!s.X(u,["zoom","feature-state"]))return[new s.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!s.Y(u))return[new s.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jt(m,n){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const v of n.valueSpec.expression.parameters)u.delete(v);if(u.size===0)return[];const p=[];return m instanceof s._&&u.has(m.name)?[new s.V(n.key,n.value,`["${m.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(m.eachChild(v=>{p.push(...Jt(v,n))}),p)}function Lt(m,n){const u=new Set;if(n.valueSpec&&n.valueSpec.expression)for(const v of n.valueSpec.expression.parameters)u.add(v);if(u.size===0)return[];const p=[];return m instanceof s._&&!u.has(m.name)?[new s.V(n.key,n.value,`["${m.name}"] is not an allowed parameter`)]:(m.eachChild(v=>{p.push(...Lt(v,n))}),p)}function Ai(m){const n=m.key,u=m.value,p=m.valueSpec,v=[];return Array.isArray(p.values)?p.values.indexOf(s.J(u))===-1&&v.push(new s.V(n,u,`expected one of [${p.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(p.values).indexOf(s.J(u))===-1&&v.push(new s.V(n,u,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(u)} found`)),v}function ni(m){return s.a2(s.S(m.value))?Ht(Object.assign({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):bi(m)}function bi(m){const n=m.value,u=m.key;if(!Array.isArray(n))return[new s.V(u,n,`array expected, ${s.K(n)} found`)];if(n.length<1)return[new s.V(u,n,"filter array must have at least 1 element")];const p=m.styleSpec;let v=Ai({key:`${u}[0]`,value:n[0],valueSpec:p.filter_operator});switch(s.J(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&s.J(n[1])==="$type"&&v.push(new s.V(u,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&v.push(new s.V(u,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(s.a0(n[1])||v.push(new s.V(`${u}[1]`,n[1],`string expected, ${s.K(n[1])} found`)));for(let x=2;x<n.length;x++)s.J(n[1])==="$type"?v=v.concat(Ai({key:`${u}[${x}]`,value:n[x],valueSpec:p.geometry_type})):s.a0(n[x])||s.L(n[x])||s.$(n[x])||v.push(new s.V(`${u}[${x}]`,n[x],`string, number, or boolean expected, ${s.K(n[x])} found.`));break;case"any":case"all":case"none":for(let x=1;x<n.length;x++)v=v.concat(bi({key:`${u}[${x}]`,value:n[x],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":n.length!==2?v.push(new s.V(u,n,`filter array for "${n[0]}" operator must have 2 elements`)):s.a0(n[1])||v.push(new s.V(`${u}[1]`,n[1],`string expected, ${s.K(n[1])} found`))}return v}function Ci(m,n){const u=m.key,p=m.style,v=m.layer,x=m.styleSpec,w=m.value,I=m.objectKey,C=x[`${n}_${m.layerType}`];if(!C)return[];const D=I.match(/^(.*)-use-theme$/);if(D&&C[D[1]])return s.Q(w)?[].concat(jr({key:m.key,value:w,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:x,expressionContext:"property",propertyType:n,propertyKey:I})):jr({key:u,value:w,valueSpec:{type:"string"},style:p,styleSpec:x});const F=I.match(/^(.*)-transition$/);if(n==="paint"&&F&&C[F[1]]&&C[F[1]].transition)return jr({key:u,value:w,valueSpec:x.transition,style:p,styleSpec:x});const V=m.valueSpec||C[I];if(!V)return[new s.a3(u,w,`unknown property "${I}"`)];let z;if(s.a0(w)&&s.N(V)&&!V.tokens&&(z=/^{([^}]+)}$/.exec(w))){const G=`\`{ "type": "identity", "property": ${z?JSON.stringify(z[1]):'"_"'} }\``;return[new s.V(u,w,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${G}.`)]}const j=[];if(m.layerType==="symbol")I!=="text-field"||!p||p.glyphs||p.imports||j.push(new s.V(u,w,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&s.a4(s.S(w))&&s.J(w.type)==="identity"&&j.push(new s.V(u,w,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&n==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&s.N(V)&&(s.a5(V)||s.O(V))){const G=s.W(s.S(w),V),H=G.value.expression||G.value._styleExpression.expression;H&&!s.X(H,["measure-light"])&&(I==="model-emissive-strength"&&s.Y(H)&&s.Z(H)||j.push(new s.V(u,w,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return j.concat(jr({key:m.key,value:w,valueSpec:V,style:p,styleSpec:x,expressionContext:"property",propertyType:n,propertyKey:I}))}function Ti(m){return Ci(m,"paint")}function Ei(m){return Ci(m,"layout")}function hr(m){let n=[];const u=m.value,p=m.key,v=m.style,x=m.styleSpec;if(!s.H(u))return[new s.V(p,u,"object expected")];u.type||u.ref||n.push(new s.V(p,u,'either "type" or "ref" is required'));let w=s.J(u.type);const I=s.J(u.ref);if(u.id){const C=s.J(u.id);for(let D=0;D<m.arrayIndex;D++){const F=v.layers[D];s.J(F.id)===C&&n.push(new s.V(p,u.id,`duplicate layer id "${C}", previously used at line ${F.id.__line__}`))}}if("ref"in u){let C;["type","source","source-layer","filter","layout"].forEach(D=>{D in u&&n.push(new s.V(p,u[D],`"${D}" is prohibited for ref layers`))}),v.layers.forEach(D=>{s.J(D.id)===I&&(C=D)}),C?C.ref?n.push(new s.V(p,u.ref,"ref cannot reference another ref layer")):w=s.J(C.type):typeof I=="string"&&n.push(new s.V(p,u.ref,`ref layer "${I}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(u.source)if(s.a0(u.source)){const C=v.sources&&v.sources[u.source],D=C&&s.J(C.type);C?D==="vector"&&w==="raster"?n.push(new s.V(p,u.source,`layer "${u.id}" requires a raster source`)):D==="raster"&&w!=="raster"?n.push(new s.V(p,u.source,`layer "${u.id}" requires a vector source`)):D!=="vector"||u["source-layer"]?D==="raster-dem"&&w!=="hillshade"?n.push(new s.V(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="raster-array"||["raster","raster-particle"].includes(w)?w==="line"&&u.paint&&(u.paint["line-gradient"]||u.paint["line-trim-offset"])&&D==="geojson"&&!C.lineMetrics?n.push(new s.V(p,u,`layer "${u.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):w==="raster-particle"&&D!=="raster-array"&&n.push(new s.V(p,u.source,`layer "${u.id}" requires a 'raster-array' source.`)):n.push(new s.V(p,u.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new s.V(p,u,`layer "${u.id}" must specify a "source-layer"`)):n.push(new s.V(p,u.source,`source "${u.source}" not found`))}else n.push(new s.V(`${p}.source`,u.source,'"source" must be a string'));else n.push(new s.V(p,u,'missing required property "source"'));return n=n.concat(dr({key:p,value:u,valueSpec:x.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>jr({key:`${p}.type`,value:u.type,valueSpec:x.layer.type,style:m.style,styleSpec:m.styleSpec,object:u,objectKey:"type"}),filter:C=>ni(Object.assign({layerType:w},C)),layout:C=>dr({layer:u,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":D=>Ei(Object.assign({layerType:w},D))}}),paint:C=>dr({layer:u,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":D=>Ti(Object.assign({layerType:w,layer:u},D))}}),appearances(C){const D=Et({key:C.key,value:C.value,valueSpec:C.valueSpec,style:C.style,styleSpec:C.styleSpec,arrayElementValidator:z=>function(j){const{key:G,layer:H,layerType:ee}=j,K=s.J(j.value),ie=s.J(K.name),ae=s.J(K.condition),ce=dr({key:G,value:K,valueSpec:j.styleSpec.appearance,style:j.style,styleSpec:j.styleSpec,objectElementValidators:{condition:ve=>function(_e){const xe=[];return xe.push(...Ht({key:_e.key,value:_e.object.condition,valueSpec:s.a6.appearance.condition,expressionContext:"appearance"})),xe}(Object.assign({layer:H,layerType:ee},ve)),properties:ve=>function(_e){const xe=[],{styleSpec:ge,layer:pe,layerType:we}=_e,Je=ge[`paint_${we}`],$e=ge[`layout_${we}`],ot=_e.object[_e.objectKey];for(const Xe in ot){const nt=Xe in Je?"paint":Xe in $e?"layout":void 0;if(!nt){xe.push(new s.V(_e.key,Xe,`unknown property "${Xe}" for layer type "${we}"`));continue}const Dt=Object.assign({},_e,{key:`${_e.key}.${Xe}`,object:ot,objectKey:Xe,layer:pe,layerType:we,value:ot[Xe],valueSpec:nt==="paint"?Je[Xe]:$e[Xe]});xe.push(...Ci(Dt,nt))}return xe}(Object.assign({layer:H,layerType:ee},ve))}});return ie==="hidden"||ae||ce.push(new s.V(j.key,"name",'Appearance with name different than "hidden" must have a condition')),ce}(Object.assign({layerType:w,layer:u},z))}),F=Array.isArray(C.value)?C.value:[],V=new Set;return F.forEach((z,j)=>{const G=s.J(z.name);if(G)if(V.has(G)){const H=s.J(u.id);D.push(new s.V(C.key,G,`Duplicated appearance name "${G}" for layer "${H}"`))}else V.add(G)}),D}}})),n}function wr({key:m,value:n}){return s.a0(n)?[]:[new s.V(m,n,`string expected, ${s.K(n)} found`)]}const on={promoteId:function m({key:n,value:u}){if(s.a0(u))return wr({key:n,value:u});if(Array.isArray(u)){const v=[],x=s.S(u),w=s.U(x);return w.result==="error"&&w.value.forEach(I=>{v.push(new s.V(`${n}${I.key}`,null,`${I.message}`))}),s.X(w.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||v.push(new s.V(`${n}`,null,"promoteId expression should be only feature dependent")),v}if(!s.H(u))return[new s.V(n,u,`string, expression or object expected, "${s.K(u)}" found`)];const p=[];for(const v in u)p.push(...m({key:`${n}.${v}`,value:u[v]}));return p}};function Jr(m){const n=m.value,u=m.key,p=m.styleSpec,v=m.style;if(!s.H(n))return[new s.V(u,n,`object expected, ${s.K(n)} found`)];if(!("type"in n))return[new s.V(u,n,'"type" is required')];const x=s.J(n.type);let w=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&("url"in n||"tiles"in n||w.push(new s.a3(u,n,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(dr({key:u,value:n,valueSpec:p[`source_${x.replace("-","_")}`],style:m.style,styleSpec:p,objectElementValidators:on})),w;case"geojson":if(w=dr({key:u,value:n,valueSpec:p.source_geojson,style:v,styleSpec:p,objectElementValidators:on}),"cluster"in n&&"clusterProperties"in n){if(!s.H(n.clusterProperties))return[new s.V(`${u}.clusterProperties`,n,`object expected, ${s.K(n)} found`)];for(const I in n.clusterProperties){const C=n.clusterProperties[I];if(!Array.isArray(C))return[new s.V(`${u}.clusterProperties.${I}`,C,"array expected")];const[D,F]=C,V=typeof D=="string"?[D,["accumulated"],["get",I]]:D;w.push(...Ht({key:`${u}.${I}.map`,value:F,expressionContext:"cluster-map"})),w.push(...Ht({key:`${u}.${I}.reduce`,value:V,expressionContext:"cluster-reduce"}))}}return w;case"video":return dr({key:u,value:n,valueSpec:p.source_video,style:v,styleSpec:p});case"image":return dr({key:u,value:n,valueSpec:p.source_image,style:v,styleSpec:p});case"canvas":return[new s.V(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ai({key:`${u}.type`,value:n.type,valueSpec:{values:_r(p)}})}}function _r(m){return m.source.reduce((n,u)=>{const p=m[u];return p.type.type==="enum"&&(n=n.concat(Object.keys(p.type.values))),n},[])}function Es(m){const n=m.value,u=m.styleSpec,p=u.light,v=m.style;if(n===void 0)return[];if(!s.H(n))return[new s.V("light",n,`object expected, ${s.K(n)} found`)];let x=[];for(const w in n){const I=w.match(/^(.*)-transition$/),C=w.match(/^(.*)-use-theme$/);x=x.concat(C&&p[C[1]]?jr({key:w,value:n[w],valueSpec:{type:"string"},style:v,styleSpec:u}):I&&p[I[1]]&&p[I[1]].transition?jr({key:w,value:n[w],valueSpec:u.transition,style:v,styleSpec:u}):p[w]?jr({key:w,value:n[w],valueSpec:p[w],style:v,styleSpec:u}):[new s.V(w,n[w],`unknown property "${w}"`)])}return x}function es(m){const n=m.value;if(!n)return[];const u=m.key;if(!s.H(n))return[new s.V(u,n,`object expected, ${s.K(n)} found`)];let p=[];const v=m.styleSpec,x=v["light-3d"],w=m.style,I=m.style.lights;for(const F of["type","id"])if(!(F in n))return p=p.concat([new s.V(u,n,`missing property "${F}"`)]),p;if(!s.a0(n.type))return p=p.concat([new s.V(`${u}.type`,n.type,"string expected")]),p;if(I)for(let F=0;F<m.arrayIndex;F++){const V=s.J(n.type),z=I[F];s.J(z.type)===V&&p.push(new s.V(u,n.id,`duplicate light type "${n.type}", previously defined at line ${z.id.__line__}`))}const C=`properties_light_${n.type}`;if(!(C in v))return p=p.concat([new s.V(`${u}.type`,n,`Invalid light type ${n.type}`)]),p;const D=v[C];for(const F in n)if(F==="properties"){const V=n[F];if(!s.H(V))return p=p.concat([new s.V("properties",V,`object expected, ${s.K(V)} found`)]),p;for(const z in V){const j=z.match(/^(.*)-transition$/),G=z.match(/^(.*)-use-theme$/);p=p.concat(G&&D[G[1]]?jr({key:F,value:V[z],valueSpec:{type:"string"},style:w,styleSpec:v}):j&&D[j[1]]&&D[j[1]].transition?jr({key:F,value:n[F],valueSpec:v.transition,style:w,styleSpec:v}):D[z]?jr({key:z,value:V[z],valueSpec:D[z],style:w,styleSpec:v}):[new s.a3(m.key,V[z],`unknown property "${z}"`)])}}else p=p.concat(x[F]?jr({key:F,value:n[F],valueSpec:x[F],style:w,styleSpec:v}):[new s.a3(F,n[F],`unknown property "${F}"`)]);return p}function xn(m){const n=m.value,u=m.key,p=m.style,v=m.styleSpec,x=v.terrain;if(n==null)return[];if(!s.H(n))return[new s.V("terrain",n,`object expected, ${s.K(n)} found`)];let w=[];for(const I in n){const C=I.match(/^(.*)-transition$/),D=I.match(/^(.*)-use-theme$/);w=w.concat(D&&x[D[1]]?jr({key:I,value:n[I],valueSpec:{type:"string"},style:p,styleSpec:v}):C&&x[C[1]]&&x[C[1]].transition?jr({key:I,value:n[I],valueSpec:v.transition,style:p,styleSpec:v}):x[I]?jr({key:I,value:n[I],valueSpec:x[I],style:p,styleSpec:v}):[new s.a3(I,n[I],`unknown property "${I}"`)])}if(n.source)if(s.a0(n.source)){const I=p.sources&&p.sources[n.source],C=I&&s.J(I.type);I?C!=="raster-dem"&&w.push(new s.V(`${u}.source`,n.source,`terrain cannot be used with a source of type ${C}, it only be used with a "raster-dem" source type`)):w.push(new s.V(`${u}.source`,n.source,`source "${n.source}" not found`))}else w.push(new s.V(`${u}.source`,n.source,"source must be a string"));else w.push(new s.V(u,n,'terrain is missing required property "source"'));return w}function ss(m){const n=m.value,u=m.style,p=m.styleSpec,v=p.fog;if(n===void 0)return[];if(!s.H(n))return[new s.V("fog",n,`object expected, ${s.K(n)} found`)];let x=[];for(const w in n){const I=w.match(/^(.*)-transition$/),C=w.match(/^(.*)-use-theme$/);x=x.concat(C&&v[C[1]]?jr({key:w,value:n[w],valueSpec:{type:"string"},style:u,styleSpec:p}):I&&v[I[1]]&&v[I[1]].transition?jr({key:w,value:n[w],valueSpec:p.transition,style:u,styleSpec:p}):v[w]?jr({key:w,value:n[w],valueSpec:v[w],style:u,styleSpec:p}):[new s.a3(w,n[w],`unknown property "${w}"`)])}return x}const Qs={"*":()=>[],array:Et,boolean:function(m){const n=m.value,u=m.key;return s.$(n)?[]:[new s.V(u,n,`boolean expected, ${s.K(n)} found`)]},number:Ue,color:function({key:m,value:n}){return s.a0(n)?s.a1.parseCSSColor(n)===null?[new s.V(m,n,`color expected, "${n}" found`)]:[]:[new s.V(m,n,`color expected, ${s.K(n)} found`)]},enum:Ai,filter:ni,function:ii,layer:hr,object:dr,source:Jr,model:s.a7,light:Es,"light-3d":es,terrain:xn,fog:ss,string:wr,formatted:function(m){return wr(m).length===0?[]:Ht(m)},resolvedImage:function(m){return wr(m).length===0?[]:Ht(m)},projection:function(m){const n=m.value,u=m.styleSpec,p=u.projection,v=m.style;if(s.H(n)){let x=[];for(const w in n)x=x.concat(jr({key:w,value:n[w],valueSpec:p[w],style:v,styleSpec:u}));return x}return s.a0(n)?[]:[new s.V("projection",n,`object or string expected, ${s.K(n)} found`)]},import:function(m){const n=m.key,{value:u,styleSpec:p}=m;if(!s.H(u))return[new s.V(n,u,"import must be an object")];const{data:v,...x}=u;Object.defineProperty(x,"__line__",{value:u.__line__,enumerable:!1});let w=dr(Object.assign({},m,{value:x,valueSpec:p.import}));return s.J(x.id)===""&&w.push(new s.V(`${m.key}.id`,x,"import id can't be an empty string")),v&&(w=w.concat(Is(v,p,{key:`${m.key}.data`}))),w},iconset:function(m){const n=m.value,u=m.key,p=m.styleSpec,v=m.style;if(!s.H(n))return[new s.V(u,n,"object expected")];if(!n.type)return[new s.V(u,n,'"type" is required')];const x=s.J(n.type);let w=[];if(w=w.concat(dr({key:u,value:n,valueSpec:p[`iconset_${x}`],style:v,styleSpec:p})),function(I,C){return!(I!=="source"||!C.source)}(x,n)){const I=v.sources&&v.sources[n.source],C=I&&s.J(I.type);I?C!=="raster-array"&&w.push(new s.V(u,n.source,`iconset cannot be used with a source of type ${String(C)}, it only be used with a "raster-array" source type`)):w.push(new s.V(u,n.source,`source "${n.source}" not found`))}return w}};function jr(m,n=!1){const u=m.value,p=m.valueSpec,v=m.styleSpec;if(p.expression){if(s.a4(s.J(u)))return ii(m);if(s.Q(s.S(u)))return Ht(m)}if(p.type&&Qs[p.type]){const x=Qs[p.type](m);return n===!0&&x.length>0&&Array.isArray(m.value)?Ht(m):x}return dr(Object.assign({},m,{valueSpec:p.type?v[p.type]:p}))}function dr(m){const n=m.key,u=m.value,p=m.valueSpec||{},v=m.objectElementValidators||{},x=m.style,w=m.styleSpec;if(!s.H(u))return[new s.V(n,u,`object expected, ${s.K(u)} found`)];let I=[];for(const C in u){const D=C.split(".")[0];let F;v[D]?F=v[D]:p[D]?F=jr:v["*"]?F=v["*"]:p["*"]&&(F=jr),F?I=I.concat(F({key:(n&&`${n}.`)+C,value:u[C],valueSpec:p[D]||p["*"],style:x,styleSpec:w,object:u,objectKey:C},u)):I.push(new s.a3(n,u[C],`unknown property "${C}"`))}for(const C in p)v[C]||p[C].required&&p[C].default===void 0&&u[C]===void 0&&I.push(new s.V(n,u,`missing required property "${C}"`));return I}function $o({key:m,value:n}){const u=wr({key:m,value:n});if(u.length)return u;const p=n;return p.indexOf("{fontstack}")===-1&&u.push(new s.V(m,n,'"glyphs" url must include a "{fontstack}" token')),p.indexOf("{range}")===-1&&u.push(new s.V(m,n,'"glyphs" url must include a "{range}" token')),u}function Is(m,n=s.a6,u={}){return dr({key:u.key||"",value:m,valueSpec:Object.assign(n.$root,{"*":{type:"*"}}),styleSpec:n,style:m,objectElementValidators:{glyphs:$o}})}function gs(m,n=s.a6){return be(Is(m,n))}const eo=m=>be(Jr(m)),to=m=>be(Es(m)),Ta=m=>be(es(m)),xt=m=>be(xn(m)),xo=m=>be(ss(m)),Cr=m=>be(function(n){const u=n.value,p=n.style,v=n.styleSpec,x=v.snow;if(u===void 0)return[];if(!s.H(u))return[new s.V("snow",u,`object expected, ${s.K(u)} found`)];let w=[];for(const I in u){const C=I.match(/^(.*)-transition$/);w=w.concat(C&&x[C[1]]&&x[C[1]].transition?jr({key:I,value:u[I],valueSpec:v.transition,style:p,styleSpec:v}):x[I]?jr({key:I,value:u[I],valueSpec:x[I],style:p,styleSpec:v}):[new s.a3(I,u[I],`unknown property "${I}"`)])}return w}(m)),gr=m=>be(function(n){const u=n.value,p=n.style,v=n.styleSpec,x=v.rain;if(u===void 0)return[];if(!s.H(u))return[new s.V("rain",u,`object expected, ${s.K(u)} found`)];let w=[];for(const I in u){const C=I.match(/^(.*)-transition$/);w=w.concat(C&&x[C[1]]&&x[C[1]].transition?jr({key:I,value:u[I],valueSpec:v.transition,style:p,styleSpec:v}):x[I]?jr({key:I,value:u[I],valueSpec:x[I],style:p,styleSpec:v}):[new s.a3(I,u[I],`unknown property "${I}"`)])}return w}(m)),Pe=m=>be(hr(m)),q=m=>be(ni(m)),J=m=>be(Ti(m)),oe=m=>be(Ei(m)),Te=m=>be(s.a7(m));function be(m){return m.slice().sort((n,u)=>n.line&&u.line?n.line-u.line:0)}function fe(m,n){let u=!1;if(n&&n.length)for(const p of n)p instanceof s.a3?s.w(p.message):(m.fire(new s.y(new Error(p.message))),u=!0);return u}let Ke;class ze extends s.E{constructor(n,u="flat"){super(),this._transitionable=new s.a8(Ke||(Ke=new s.a9({anchor:new s.aa(s.a6.light.anchor),position:new s.ab(s.a6.light.position),color:new s.aa(s.a6.light.color),intensity:new s.aa(s.a6.light.intensity)}))),this.setLight(n,u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,u,p={}){this._validate(to,n,p)||(this._transitionable.setTransitionOrValue(n),this.id=u)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,u,p){return(!p||p.validate!==!1)&&fe(this,n.call(gs,Object.assign({value:u,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let Ze=class extends s.E{constructor(m,n,u,p,v){super(),this.scope=u,this._transitionable=new s.a8(new s.a9({source:new s.aa(s.a6.terrain.source),exaggeration:new s.aa(s.a6.terrain.exaggeration)}),u,p),this._transitionable.setTransitionOrValue(m,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n,this.worldview=v}get(){return this._transitionable.serialize()}set(m,n){this._transitionable.setTransitionOrValue(m,n)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new s.ac(m,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const n=m.value.expression;if(!n)return null;let u=-1,p=-1,v=1;for(const x of n.zoomStops)v=n.evaluate(new s.ac(x,{worldview:this.worldview})),v>.01?(u=x,p=-1):p=x;return v<.01&&u>0&&p>u?[u,p]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof s.ad}};const yt=45,lt=65,Kt=.05;function Qt(m,n,u,p){const v=s.ah(yt,lt,u),[x,w]=Ii(m,p);let I=1-Math.min(1,Math.exp((n-x)/(w-x)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*v*m.alpha}function Ii(m,n){const u=.5/Math.tan(.5*n);return[m.range[0]+u,m.range[1]+u]}function Xi(m,n,u,p,v){const x=s.af([],[n,u,p],v.mercatorFogMatrix);return Qt(m,s.ag(x),v.pitch,v._fov)}function Oi(m,n,u,p,v,x,w){const I=[[u,p,0],[v,p,0],[v,x,0],[u,x,0]];let C=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(const F of I){const V=s.af([],F,n),z=s.ag(V);C=Math.min(C,z),D=Math.max(D,z)}return[Qt(m,C,w.pitch,w._fov),Qt(m,D,w.pitch,w._fov)]}class $i extends s.E{constructor(n,u,p,v){super();const x=new s.a9({range:new s.aa(s.a6.fog.range),color:new s.aa(s.a6.fog.color),"color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.aa(s.a6.fog["high-color"]),"high-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.aa(s.a6.fog["space-color"]),"space-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.aa(s.a6.fog["horizon-blend"]),"star-intensity":new s.aa(s.a6.fog["star-intensity"]),"vertical-range":new s.aa(s.a6.fog["vertical-range"])});this._transitionable=new s.a8(x,p,new Map(v)),this.set(n,v),this._transitioning=this._transitionable.untransitioned(),this._transform=u,this.properties=new s.ai(x),this.scope=p}get state(){const n=this._transform,u=n.projection.name==="globe",p=s.aj(n.zoom),v=this.properties.get("range"),x=[.5,3];return{range:u?[s.ak(x[0],v[0],p),s.ak(x[1],v[1],p)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,u,p={}){if(this._validate(xo,n,p))return;const v=Object.assign({},n);for(const x of Object.keys(s.a6.fog))v[x]===void 0&&(v[x]=s.a6.fog[x].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,u)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ah(yt,lt,n))*u.a}getOpacityAtLatLng(n,u){return this._transform.projection.supportsFog?function(p,v,x){const w=s.ae.fromLngLat(v),I=x.elevation?x.elevation.getAtPointOrZero(w):0;return Xi(p,w.x,w.y,I,x)}(this.state,n,u):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const u=this._transform.calculateFogTileMatrix(n.toUnwrapped());return Oi(this.state,u,0,0,s.al,s.al,this._transform)}getOpacityForBounds(n,u,p,v,x){return this._transform.projection.supportsFog?Oi(this.state,n,u,p,v,x,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Ii(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const u=[4,5,6,7];for(const p of u){const v=n.points[p];let x;if(v[2]>=0)x=v;else{const w=n.points[p-4];x=s.am(w,v,w[2]/(w[2]-v[2]))}if(Xi(this.state,x[0],x[1],0,this._transform)>=Kt)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,u,p){return(!p||p.validate!==!1)&&fe(this,n.call(gs,Object.assign({value:u,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let yr,Ji,In,qr,$r=class extends s.E{constructor(m,n,u,p){super();const v=yr||(yr=new s.a9({density:new s.aa(s.a6.snow.density),intensity:new s.aa(s.a6.snow.intensity),color:new s.aa(s.a6.snow.color),opacity:new s.aa(s.a6.snow.opacity),vignette:new s.aa(s.a6.snow.vignette),"vignette-color":new s.aa(s.a6.snow["vignette-color"]),"center-thinning":new s.aa(s.a6.snow["center-thinning"]),direction:new s.aa(s.a6.snow.direction),"flake-size":new s.aa(s.a6.snow["flake-size"])}));this._transitionable=new s.a8(v,u,new Map(p)),this.set(m,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(v),this.scope=u}get state(){const m=this.properties.get("opacity"),n=this.properties.get("color"),u=this.properties.get("direction"),p=s.an(u[0]),v=-Math.max(s.an(u[1]),.01),x=[Math.cos(p)*Math.cos(v),Math.sin(p)*Math.cos(v),Math.sin(v)],w=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=w,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(n.r,n.g,n.b,n.a*m),direction:x,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(m,n,u={}){if(this._validate(Cr,m,u))return;const p=Object.assign({},m);for(const v of Object.keys(s.a6.snow))p[v]===void 0&&(p[v]=s.a6.snow[v].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,n,u){return(!u||u.validate!==!1)&&fe(this,m.call(gs,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}},Tr=class extends s.E{constructor(m,n,u,p){super();const v=Ji||(Ji=new s.a9({density:new s.aa(s.a6.rain.density),intensity:new s.aa(s.a6.rain.intensity),color:new s.aa(s.a6.rain.color),opacity:new s.aa(s.a6.rain.opacity),vignette:new s.aa(s.a6.rain.vignette),"vignette-color":new s.aa(s.a6.rain["vignette-color"]),"center-thinning":new s.aa(s.a6.rain["center-thinning"]),direction:new s.aa(s.a6.rain.direction),"droplet-size":new s.aa(s.a6.rain["droplet-size"]),"distortion-strength":new s.aa(s.a6.rain["distortion-strength"])}));this._transitionable=new s.a8(v,u,new Map(p)),this.set(m,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(v),this.scope=u}get state(){const m=this.properties.get("opacity"),n=this.properties.get("color"),u=this.properties.get("direction"),p=s.an(u[0]),v=-Math.max(s.an(u[1]),.01),x=[Math.cos(p)*Math.cos(v),Math.sin(p)*Math.cos(v),Math.sin(v)],w=this.properties.get("vignette-color");return w.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(n.r,n.g,n.b,n.a*m),direction:x,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(m,n,u={}){if(this._validate(gr,m,u))return;const p=Object.assign({},m);for(const v of Object.keys(s.a6.rain))p[v]===void 0&&(p[v]=s.a6.rain[v].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,n,u){return(!u||u.validate!==!1)&&fe(this,m.call(gs,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}};class br extends s.E{constructor(n,u,p,v){super(),this.scope=p,this._options=n,this.properties=new s.ai(u),this._transitionable=new s.a8(u,p,new Map(v)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,u){this._options=n,this._transitionable.setTransitionOrValue(n.properties,u)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class un{constructor(n,u,p){this.screenBounds=n,this.cameraPoint=p.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(n,u){let p,v;if(n instanceof s.P||typeof n[0]=="number"){const x=s.P.convert(n);p=[x],v=u.isPointAboveHorizon(x)}else{const x=s.P.convert(n[0]),w=s.P.convert(n[1]),I=x.add(w)._div(2);p=[x,w],v=s.aq(x,w).every(C=>u.isPointAboveHorizon(C))&&u.isPointAboveHorizon(I)}return new un(p,v,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return s.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const u=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],v=s.aq(u,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<p.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?v[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(v[3]=this.cameraPoint)),s.ar(v,n)}bufferedCameraGeometryGlobe(n){const u=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],v=s.aq(u,p,n),x=this.cameraPoint.clone();switch(3*((x.y>u.y)+(x.y>p.y))+((x.x>u.x)+(x.x>p.x))){case 0:v[0]=x,v[4]=x.clone();break;case 1:v.splice(1,0,x);break;case 2:v[1]=x;break;case 3:v.splice(4,0,x);break;case 5:v.splice(2,0,x);break;case 6:v[3]=x;break;case 7:v.splice(3,0,x);break;case 8:v[2]=x}return v}containsTile(n,u,p,v=0){const x=n.queryPadding/u._pixelsPerMercatorPixel+1,w=p?this._bufferedCameraMercator(x,u):this._bufferedScreenMercator(x,u);let I=n.tileID.wrap+(w.unwrapped?v:0);const C=w.polygon.map(ee=>s.as(n.tileTransform,ee,I));if(!s.at(C,0,0,s.al,s.al))return;I=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const D=this.screenGeometryMercator.polygon.map(ee=>s.au(n.tileTransform,ee,I)),F=D.map(ee=>new s.P(ee[0],ee[1])),V=u.getFreeCameraOptions().position||new s.ae(0,0,0),z=s.au(n.tileTransform,V,I),j=D.map(ee=>{const K=s.av(ee,ee,z);return s.aw(K,K),new s.ax(z,K)}),G=s.ay(n,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:j,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(H=s.az(C),H.min.x=s.aA(H.min.x,0,s.al),H.min.y=s.aA(H.min.y,0,s.al),H.max.x=s.aA(H.max.x,0,s.al),H.max.y=s.aA(H.max.y,0,s.al),H),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:G};var H}_bufferedScreenMercator(n,u){const p=cs(n);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let v;return v=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),u):{polygon:this.bufferedScreenGeometry(n).map(x=>u.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[p]=v,v}}_bufferedCameraMercator(n,u){const p=cs(n);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let v;return v=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),u):{polygon:this.bufferedCameraGeometry(n).map(x=>u.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[p]=v,v}}_projectAndResample(n,u){const p=function(x,w){const I=s.aB([],w.pixelMatrix,w.globeMatrix),C=[0,-s.aD,0,1],D=[0,s.aD,0,1],F=[0,0,0,1];s.aC(C,C,I),s.aC(D,D,I),s.aC(F,F,I);const V=new s.P(C[0]/C[3],C[1]/C[3]),z=new s.P(D[0]/D[3],D[1]/D[3]),j=s.aE(x,V)&&C[3]<F[3],G=s.aE(x,z)&&D[3]<F[3];if(!j&&!G)return null;const H=function(xe,ge,pe){for(let we=1;we<xe.length;we++){const Je=Fr(ge.pointCoordinate3D(xe[we-1]).x),$e=Fr(ge.pointCoordinate3D(xe[we]).x);if(pe<0){if(Je<$e)return{idx:we,t:-Je/($e-1-Je)}}else if($e<Je)return{idx:we,t:(1-Je)/($e+1-Je)}}return null}(x,w,j?-1:1);if(!H)return null;const{idx:ee,t:K}=H;let ie=ee>1?fn(x.slice(0,ee),w):[],ae=ee<x.length?fn(x.slice(ee),w):[];ie=ie.map(xe=>new s.P(Fr(xe.x),xe.y)),ae=ae.map(xe=>new s.P(Fr(xe.x),xe.y));const ce=[...ie];ce.length===0&&ce.push(ae[ae.length-1]);const ve=s.ak(ce[ce.length-1].y,(ae.length===0?ie[0]:ae[0]).y,K);let _e;return _e=j?[new s.P(0,ve),new s.P(0,0),new s.P(1,0),new s.P(1,ve)]:[new s.P(1,ve),new s.P(1,1),new s.P(0,1),new s.P(0,ve)],ce.push(..._e),ae.length===0?ce.push(ie[0]):ce.push(...ae),{polygon:ce.map(xe=>new s.ae(xe.x,xe.y)),unwrapped:!1}}(n,u);if(p)return p;const v=function(x,w){let I=!1,C=-1/0,D=0;for(let V=0;V<x.length-1;V++)x[V].x>C&&(C=x[V].x,D=V);for(let V=0;V<x.length-1;V++){const z=(D+V)%(x.length-1),j=x[z],G=x[z+1];Math.abs(j.x-G.x)>.5&&(j.x<G.x?(j.x+=1,z===0&&(x[x.length-1].x+=1)):(G.x+=1,z+1===x.length-1&&(x[0].x+=1)),I=!0)}const F=s.aF(w.center.lng);return I&&F<Math.abs(F-1)&&x.forEach(V=>{V.x-=1}),{polygon:x,unwrapped:I}}(fn(n,u).map(x=>new s.P(Fr(x.x),x.y)),u);return{polygon:v.polygon.map(x=>new s.ae(x.x,x.y)),unwrapped:v.unwrapped}}}function fn(m,n){return s.aG(m,u=>{const p=n.pointCoordinate3D(u);u.x=p.x,u.y=p.y},1/256)}function Fr(m){return m<0?1+m%1:m%1}function cs(m){return 100*m|0}function Ms(m,n,u,p,v){const x=function(I,C){if(I)return v(I);if(C){if(m.url&&C.tiles&&m.tiles&&delete m.tiles,C.variants){if(!Array.isArray(C.variants))return v(new Error("variants must be an array"));for(const F of C.variants){if(F==null||typeof F!="object"||F.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(F.capabilities))return v(new Error("capabilities must be an array"));if(F.capabilities.length===1&&F.capabilities[0]==="meshopt"){C=Object.assign(C,F);break}}}const D=s.aH(Object.assign({},C,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);D.tiles=n.canonicalizeTileset(D,m.url),v(null,D)}},w=function(I,C,D){if(!I)return null;if(!C&&!D)return I;D=D||I.worldview_default;const F=Object.values(I.language||{});if(F.length===0)return null;const V=Object.values(I.worldview||{});if(V.length===0)return null;const z=F.every(G=>G===C),j=V.every(G=>G===D);return z&&j?I:C in(I.language_options||{})||D in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(m.data,u,p);return w?s.o.frame(()=>x(null,w)):m.url?s.m(n.transformRequest(n.normalizeSourceURL(m.url,null,u,p),s.R.Source),x):s.o.frame(()=>{const{data:I,...C}=m;x(null,C)})}function Ss(m,n){const u=Math.pow(2,n.z),p=Math.floor(s.aF(m.getWest())*u),v=Math.floor(s.aJ(m.getNorth())*u),x=Math.ceil(s.aF(m.getEast())*u),w=Math.ceil(s.aJ(m.getSouth())*u);return n.x>=p&&n.x<x&&n.y>=v&&n.y<w}class Za{constructor(n,u,p){this.bounds=n?s.aI.convert(this.validateBounds(n)):null,this.minzoom=u||0,this.maxzoom=p||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}addExtraBounds(n){if(n){this.extraBounds||(this.extraBounds=[]);for(const u of n)this.extraBounds.push(s.aI.convert(this.validateBounds(u)))}}contains(n){if(n.z>this.maxzoom||n.z<this.minzoom||this.bounds&&!Ss(this.bounds,n))return!1;if(!this.extraBounds)return!0;for(const u of this.extraBounds)if(Ss(u,n))return!0;return!1}static fromTileJSON(n){if(!n.bounds&&!n.extra_bounds)return null;const u=new Za(n.bounds,n.minzoom,n.maxzoom);return u.addExtraBounds(n.extra_bounds),u}}class io extends s.E{constructor(n,u,p,v){if(super(),this.id=n,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,s.aH(u,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},u),this._collectResourceTiming=!!u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new s.aK}load(n){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=Ms(this._options,this.map._requestManager,u,p,(v,x)=>{if(this._tileJSONRequest=null,this._loaded=!0,v)u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new s.y(v));else if(x){if(Object.assign(this,x),this.hasWorldviews=!!x.worldview_options,x.worldview_default&&(this.worldviewDefault=x.worldview_default),x.vector_layers){this.vectorLayers=x.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const w of x.vector_layers)this.vectorLayerIds.push(w.id),x.worldview&&x.worldview[w.source]&&this.localizableLayerIds.add(w.id)}this.tileBounds=Za.fromTileJSON(x),ji(x.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}n&&n(v)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(n,u){const p=n.tileID.canonical.url(this.tiles,this.scheme),v=this.map._requestManager.normalizeTileURL(p),x=this.map._requestManager.transformRequest(v,s.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,I=w?{image:w.image.clone()}:null,C={request:x,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&s.h(p)&&(C.localizableLayerIds=this.localizableLayerIds),C.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=u:n.request=n.actor.send("reloadTile",C,D.bind(this));else if(n.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",C,D.bind(this),void 0,!0);else{const F=s.aL.call({deduped:this._deduped},C,(V,z)=>{V||!z?D.call(this,V):(C.data={cacheControl:z.cacheControl,expires:z.expires,rawData:z.rawData.slice(0)},n.actor&&n.actor.send("loadTile",C,D.bind(this),void 0,!0))},!0);n.request={cancel:F}}function D(F,V){return delete n.request,n.aborted?u(null):F&&F.status!==404?u(F):(V&&V.resourceTiming&&(n.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&n.setExpiryData(V),n.loadVectorData(V,this.map.painter),s.aM(this.dispatcher),u(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,u){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class $c extends s.E{constructor(n,u,p,v){super(),this.id=n,this.dispatcher=p,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},u),Object.assign(this,s.aH(u,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const u=this.map.getWorldview();this._tileJSONRequest=Ms(this._options,this.map._requestManager,null,u,(p,v)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new s.y(p)):v&&(Object.assign(this,v),v.raster_layers&&(this.rasterLayers=v.raster_layers,this.rasterLayerIds=this.rasterLayers.map(x=>x.id)),this.tileBounds=Za.fromTileJSON(v),ji(v.tiles),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),n&&n(p)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,u){const p=s.o.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);n.request=s.n(this.map._requestManager.transformRequest(v,s.R.Tile),(x,w,I,C)=>(delete n.request,n.aborted?(n.state="unloaded",u(null)):x?(n.state="errored",u(x)):w?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:I,expires:C}),n.setTexture(w,this.map.painter),n.state="loaded",s.aM(this.dispatcher),void u(null)):u(null)))}abortTile(n,u){n.request&&(n.request.cancel(),delete n.request),u&&u()}unloadTile(n,u){n.texture&&n.texture instanceof s.T?(n.destroy(!0),n.texture&&n.texture instanceof s.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),u&&u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function fp([m,n],u,p,{scaled:v=!0}={}){const{tileSize:x,buffer:w}=p,{x:I,y:C,z:D}=u;if(!isFinite(I)||!isFinite(C)||!isFinite(D))throw new Error("Invalid MRT header");const F=2**D,V=F*s.aF(m),z=F*s.aJ(n);return function([j,G],H,{scaled:ee=!0}={}){if(!H)throw new Error("bandView is undefined");const{data:K,tileSize:ie,buffer:ae,offset:ce,scale:ve,dimension:_e}=H;if(j<-ae||j>ie+ae||G<-ae||G>ie+ae)throw new Error(`Point (${j}, ${G}) out of bounds for tileSize=${ie}, buffer=${ae}`);const xe=(G+ae)*(ie+2*ae)+(j+ae);if(new Uint32Array(K.buffer)[xe]===4294967295)return null;let ge=[];ge=ee?[]:new H.data.constructor(_e);for(let pe=0;pe<_e;pe++)ge[pe]=Math.round(1e12*(K[_e*xe+pe]*ve+ce))/1e12;return ge}([Math.min(Math.max(-w,Math.floor((V-I)*x)),x-1+w),Math.min(Math.max(-w,Math.floor((z-C)*x)),x-1+w)],p,{scaled:v})}class uc extends $c{constructor(n,u,p,v){super(n,u,p,v),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},u)}triggerRepaint(n){const u=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);u&&u.enabled&&p&&u._clearRenderCacheForTile(p.id,n.tileID),this.map.triggerRepaint()}loadTile(n,u){const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(p,s.R.Tile),x={request:v,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};n.source=this.id,n.scope=this.scope,n.requestParams=v,n.actor||(n.actor=this.dispatcher.getActor());const w=(I,C,D,F)=>{if(delete n.request,n.aborted)return n.state="unloaded",u(null);if(I)return I.name==="AbortError"?void 0:(n.state="errored",u(I));if(this.map._refreshExpiredTiles&&C&&n.setExpiryData({cacheControl:D,expires:F}),this.partial&&n.state!=="expired")n.state="empty";else if(!this.partial){if(!C)return u(null);n.state="loaded",n._isHeaderLoaded=!0,n._mrt=C}u(null)};n.request=this.partial?n.fetchHeader(void 0,w.bind(this)):n.actor.send("loadTile",x,w.bind(this),void 0,!0)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,u){const p=n.texturePerLayer;if(n.flushAllQueues(),p.size){n.destroy(!0);for(const v of p.values())this.map.painter.saveTileTexture(v)}else n.destroy()}prepareTile(n,u,p,v){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBandForRender(u,p,v,(x,w)=>{if(x)return n.state="errored",this.fire(new s.y(x)),void this.triggerRepaint(n);w&&(n._isHeaderLoaded=!0,n.setTexturePerLayer(p,w,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const u=this.rasterLayers.find(({id:x})=>x===n),p=u&&u.fields,v=p&&p.bands&&p.bands;return v?v[0]:0}getTextureDescriptor(n,u,p){if(!n)return;const v=u.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let x=null;u instanceof s.aP?x=u.paint.get("raster-array-band"):u instanceof s.aQ&&(x=u.paint.get("raster-particle-array-band"));const w=x||this.getInitialBand(v);if(w==null)return;if(!n.textureDescriptorPerLayer.get(u.id))return void this.prepareTile(n,v,u.id,w);if(n.updateNeeded(u.id,w)&&!p)return;const I=n.textureDescriptorPerLayer.get(u.id);return Object.assign({},I,{texture:n.texturePerLayer.get(u.id)})}getImages(n,u){const p=new Map;for(const v of n)for(const x of u){const[w,I]=x.split("/"),C=v.getLayer(w);if(!C||!C.hasBand(I)||!C.hasDataForBand(I))continue;const{bytes:D,tileSize:F,buffer:V}=C.getBandView(I),z=F+2*V,j={data:new s.q({width:z,height:z},D),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(x,j)}return p}queryRasterArrayValueByBandId(n,u,p){const v=u._mrt;return new Promise(x=>{const w={},I=new Set;for(const[C,D]of Object.entries(v.layers)){if(p.layerName&&C!==p.layerName)continue;const F={};w[C]=F;for(const{bands:V}of D.dataIndex)for(const z of V)p.bands&&!p.bands.includes(z)||(I.add(s.B(C,z)),u.fetchBand(C,null,z,j=>{s.o.frame(()=>{F[z]=j?null:fp([n.lng,n.lat],v,D.getBandView(z)),I.delete(s.B(C,z)),I.size===0&&x(w)})},!1))}I.size===0&&x(w)})}_loadTileForQuery(n,u){if(this._loadTileLoaded[n.uid])return void u(null,n._mrt);if(this._loadTilePending[n.uid])return void this._loadTilePending[n.uid].push(u);this._loadTilePending[n.uid]=[u];const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(p,s.R.Tile);n.actor.send("loadTile",{request:v,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(x,w,I,C)=>x?(this._loadTilePending[n.uid].forEach(D=>D(x,null)),void delete this._loadTilePending[n.uid]):w?(this.map._refreshExpiredTiles&&w&&n.setExpiryData({cacheControl:I,expires:C}),n._mrt=w,n._isHeaderLoaded=!0,n.state="loaded",this._loadTilePending[n.uid].forEach(D=>D(null,w)),this._loadTileLoaded[n.uid]=!0,void delete this._loadTilePending[n.uid]):(this._loadTilePending[n.uid].forEach(D=>D(null,null)),void delete this._loadTilePending[n.uid]),void 0,!0)}queryRasterArrayValueByAllBands(n,u,p){return new Promise((v,x)=>{this._loadTileForQuery(u,(w,I)=>{w?x(w):v(I?this.queryRasterArrayValueByBandId(n,u,p):null)})})}queryRasterArrayValue(n,u){const p=s.aR.convert(n),v=this.findLoadedParent(p);return v&&v._mrt?u.bands||!this.partial?this.queryRasterArrayValueByBandId(p,v,u):this.queryRasterArrayValueByAllBands(p,v,u):Promise.resolve(null)}findLoadedParent(n){const u=s.ae.fromLngLat(n,this.map.transform.tileSize),p=this.maxzoom+1,v=1<<p,x=Math.floor(u.x),w=Math.floor((u.x-x)*v),I=Math.floor(u.y*v),C=this.map.style.getSourceCache(this.id),D=new s.aO(p,x,p,w,I);return C.findLoadedParent(D,this.minzoom)}}const bu={vector:io,raster:$c,"raster-dem":class extends $c{constructor(m,n,u,p){super(m,n,u,p),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(m,n){const u=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(v,x){v&&(m.state="errored",n(v)),x&&(m.dem=x,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",n(null))}m.request=s.n(this.map._requestManager.transformRequest(u,s.R.Tile),(function(v,x,w,I){if(delete m.request,m.aborted)m.state="unloaded",n(null);else if(v)m.state="errored",n(v);else if(x){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:w,expires:I});const C=ImageBitmap&&x instanceof ImageBitmap&&s.r(),D=1-(x.width-s.aN(x.width))/2;D<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const F=C?x:s.o.getImageData(x,D),V={uid:m.uid,tileID:m.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:D};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadTile",V,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const n=m.canonical,u=Math.pow(2,n.z),p=(n.x-1+u)%u,v=n.x===0?m.wrap-1:m.wrap,x=(n.x+1+u)%u,w=n.x+1===u?m.wrap+1:m.wrap,I={};return I[new s.aO(m.overscaledZ,v,n.z,p,n.y).key]={backfilled:!1},I[new s.aO(m.overscaledZ,w,n.z,x,n.y).key]={backfilled:!1},n.y>0&&(I[new s.aO(m.overscaledZ,v,n.z,p,n.y-1).key]={backfilled:!1},I[new s.aO(m.overscaledZ,m.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},I[new s.aO(m.overscaledZ,w,n.z,x,n.y-1).key]={backfilled:!1}),n.y+1<u&&(I[new s.aO(m.overscaledZ,v,n.z,p,n.y+1).key]={backfilled:!1},I[new s.aO(m.overscaledZ,m.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},I[new s.aO(m.overscaledZ,w,n.z,x,n.y+1).key]={backfilled:!1}),I}},"raster-array":uc,geojson:class extends s.E{constructor(m,n,u,p){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(p),this._data=n.data,this._options=Object.assign({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const v=s.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*v,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*v,extent:s.al,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.al,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*v,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new s.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection"))return this.fire(new s.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const u of this._data.features)n.set(u.id,u);for(const u of m.features)n.set(u.id,u);this._data.features=[...n.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},n),this}getClusterChildren(m,n){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},n),this}getClusterLeaves(m,n,u,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:n,offset:u},p),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.z("dataloading",{dataType:"source"})),this._loaded=!1;const n=Object.assign({append:m},this.workerOptions);n.scope=this.scope;const u=this._data;typeof u=="string"?(n.request=this.map._requestManager.transformRequest(s.o.resolveURL(u),s.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(p,v)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new s.y(p));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(x.resourceTiming=v.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new s.z("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const m=s.B(this.id,this.scope);this.map.style.clearSource(m),this._updateWorkerData()}loadTile(m,n){const u=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,v=p?{image:p.image.clone()}:null,x=this._partialReload,w={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:v,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:m.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:x,worldview:this.map.getWorldview()};m.request=this.actor.send(u,w,(I,C)=>x&&!C?(m.state="loaded",n(null)):(delete m.request,m.destroy(),m.aborted?n(null):I?n(I):(m.loadVectorData(C,this.map.painter,u==="reloadTile"),n(null))),void 0,u==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,n){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aS{constructor(m,n,u,p){super(m,n,u,p),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const n of m.urls)this.urls.push(this.map._requestManager.transformRequest(n,s.R.Source).url);s.aT(this.urls,(n,u)=>{this._loaded=!0,n?this.fire(new s.y(n)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const n=this.video.seekable;m<n.start(0)||m>n.end(0)?this.fire(new s.y(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,n=m.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(m,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aS,model:class extends s.E{constructor(m,n,u,p){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const m=[];for(const n in this._options.models){const u=this._options.models[n],p=s.aV(this.map._requestManager.transformRequest(u.uri,s.R.Model).url).then(v=>{if(!v)return;const x=s.aW(v),w=new s.aX(n,u.position,u.orientation,x);w.computeBoundsAndApplyParent(),this.models.push(w)}).catch(v=>{this.fire(new s.y(new Error(`Could not load model ${n} from ${u.uri}: ${v.message}`)))});m.push(p)}Promise.allSettled(m).then(()=>{this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this._loaded=!0,this.fire(new s.y(new Error(`Could not load models: ${n.message}`)))})}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,n){}serialize(){return this._options}},"batched-model":class extends s.E{constructor(m,n,u,p){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=u,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(m){this.map=m,this.load()}reload(){this.cancelTileJSONRequest();const m=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(m))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(m){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=Ms(this._options,this.map._requestManager,n,u,(p,v)=>{this._tileJSONRequest=null,this._loaded=!0,p?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new s.y(p))):v&&(Object.assign(this,v),v.bounds&&(this.tileBounds=new Za(v.bounds,this.minzoom,this.maxzoom)),ji(v.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),m&&m(p)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,n){const u=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(u,s.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.o.devicePixelRatio,promoteId:this.promoteId};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=n;else{if(m.buckets){const x=Object.values(m.buckets);for(const w of x)w.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",p,v.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",p,v.bind(this),void 0,!0);function v(x,w){return m.aborted?n(null):x&&x.status!==404?n(x):(this.map._refreshExpiredTiles&&w&&m.setExpiryData(w),m.loadModelData(w,this.map.painter),m.state="loaded",void n(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends s.aS{constructor(m,n,u,p){super(m,n,u,p),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(x=>typeof x!="number"))||this.fire(new s.y(new s.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.y(new s.V(`sources.${m}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.y(new s.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new s.y(new s.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.y(new s.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof s.aU||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends s.E{constructor(m,n,u,p){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=n,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Za(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,s.aH(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:n,y:u,z:p}=m.canonical;return this._implementation.hasTile({x:n,y:u,z:p})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,n){const{x:u,y:p,z:v}=m.tileID.canonical,x=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:u,y:p,z:v},{signal:x.signal})).then((function(w){return delete m.request,m.aborted?(m.state="unloaded",n(null)):w===void 0?(m.state="errored",n(null)):w===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",n(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(w)?(this.loadTileData(m,w),m.state="loaded",void n(null)):(m.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.name!=="AbortError"&&(m.state="errored",n(w))}),m.request.cancel=()=>x.abort()}loadTileData(m,n){m.setTexture(n,this.map.painter)}unloadTile(m,n){if(m.texture&&m.texture instanceof s.T?(m.destroy(!0),m.texture&&m.texture instanceof s.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:u,y:p,z:v}=m.tileID.canonical;this._implementation.unloadTile({x:u,y:p,z:v})}n&&n()}abortTile(m,n){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=s.B(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}}},wu=function(m,n,u,p){const v=new bu[n.type](m,n,u,p);if(v.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${v.id}`);return s.aY(["load","abort","unload","serialize","prepare"],v),v};function Tu(m,n,u=""){return`${u}:${n.id||""}:${n.layer.id}:${function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:v,importId:x}=p;return`featureset:${v}${x?`:import:${x}`:""}`}}(m.target)}`}function hc(m,n,u,p=""){if(m.uniqueFeatureID){const v=Tu(m,n,p);if(u.has(v))return!0;u.add(v)}return!1}function Ka(m,n,u,p,v=!1){const x=n.sourceCache.transform,w=n.sourceCache.tilesIn(m,n.has3DLayers,v);w.sort(Eu);const I=[];for(const C of w){const D=C.tile.queryRenderedFeatures(n,C,u,p,x,v);Object.keys(D).length&&I.push({wrappedTileID:C.tile.tileID.wrapped().key,queryResults:D})}return I.length===0?{}:function(C){const D={},F={};for(const V of C){const z=V.queryResults,j=V.wrappedTileID,G=F[j]=F[j]||{};for(const H in z){const ee=z[H],K=G[H]=G[H]||{},ie=D[H]=D[H]||[];for(const ae of ee)K[ae.featureIndex]||(K[ae.featureIndex]=!0,ie.push(ae))}}return D}(I)}function Ya(m,n,u,p,v,x){const w={},I=p.queryRenderedSymbols(m),C=[];for(const D of Object.keys(I).map(Number))C.push(v[D]);C.sort(Eu);for(const D of C){const F=D.featureIndex.lookupSymbolFeatures(I[D.bucketInstanceId],D.bucketIndex,D.sourceLayerIndex,n,u,x);for(const V in F){const z=w[V]=w[V]||[],j=F[V];j.sort((G,H)=>{const ee=D.featureSortOrder;if(ee){const K=ee.indexOf(G.featureIndex);return ee.indexOf(H.featureIndex)-K}return H.featureIndex-G.featureIndex});for(const G of j)z.push(G)}}return w}function sa(m,n){const u=m.getRenderableIds().map(x=>m.getTileByID(x)),p=[],v={};for(let x=0;x<u.length;x++){const w=u[x],I=w.tileID.canonical.key;v[I]||(v[I]=!0,w.querySourceFeatures(p,n))}return p}function Eu(m,n){const u=m.tileID,p=n.tileID;return u.overscaledZ-p.overscaledZ||u.canonical.y-p.canonical.y||u.wrap-p.wrap||u.canonical.x-p.canonical.x}function Th(m,n){const u={};if(!n)return u;for(const p of m){const v=p.layerIds.map(x=>n.getLayer(x)).filter(Boolean);if(v.length!==0){p.layers=v,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(x=>v.filter(w=>w.id===x)[0]));for(const x of v)u[x.fqid]=p}}return u}const pn=32,Go=33,oa=new Uint16Array(8184);for(let m=0;m<2046;m++){let n=m+2,u=0,p=0,v=0,x=0,w=0,I=0;for(1&n?v=x=w=pn:u=p=I=pn;(n>>=1)>1;){const D=u+v>>1,F=p+x>>1;1&n?(v=u,x=p,u=w,p=I):(u=v,p=x,v=w,x=I),w=D,I=F}const C=4*m;oa[C+0]=u,oa[C+1]=p,oa[C+2]=v,oa[C+3]=x}const Do=new Uint16Array(2178),bo=new Uint8Array(1089),dc=new Uint16Array(1089);function pp(m){return m===0?-.03125:m===32?.03125:0}const Eh={type:2,extent:s.al,loadGeometry:()=>[[new s.P(0,0),new s.P(s.al+1,0),new s.P(s.al+1,s.al+1),new s.P(0,s.al+1),new s.P(0,0)]]};class fc{constructor(n,u,p,v,x,w){this.tileID=n,this.uid=s.b2(),this.uses=0,this.tileSize=u,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,v&&v.style&&(this._lastUpdatedBrightness=v.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",v&&v.transform&&(this.projection=v.transform.projection),this.worldview=w}registerFadeDuration(n){const u=n+this.timeAdded;u<s.o.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,u,p){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=Th(n.buckets,u.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const x=this.buckets[v];if(x instanceof s.b4){if(this.hasSymbolBuckets=!0,!p)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const x=this.buckets[v];if(x instanceof s.b4&&x.hasRTLText){this.hasRTLText=!0,s.b5();break}}this.queryPadding=0;for(const v in this.buckets){const x=this.buckets[v],w=u.style.getOwnLayer(v);if(!w)continue;const I=w.queryRadius(x);this.queryPadding=Math.max(this.queryPadding,I)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new s.b3}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,u,p){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets=Object.assign({},this.buckets,Th(n.buckets,u.style)),n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const v in this.buckets){const x=this.buckets[v];x.uploadPending()&&x.upload(n)}const u=n.gl,p=this.imageAtlas;p&&!p.uploaded&&(this.imageAtlasTexture=new s.T(n,p.image,u.RGBA8,{useMipmap:!!p.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(n,this.glyphAtlasImage,u.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(n,this.lineAtlas.image,u.R8),this.lineAtlas.uploaded=!0)}prepare(n,u,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,p),!u||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const v=u.style.getBrightness();(this._lastUpdatedBrightness||v)&&(this._lastUpdatedBrightness&&v&&Math.abs(this._lastUpdatedBrightness-v)<.001||(this.updateBuckets(u,this._lastUpdatedBrightness!==v),this._lastUpdatedBrightness=v))}queryRenderedFeatures(n,u,p,v,x,w){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const I=function(C,D){const F=s.bq([],[.5*C.width,.5*-C.height,1]);return s.br(F,F,[1,-1,0]),s.aB(F,F,C.calculateProjMatrix(D.toUnwrapped())),Float32Array.from(F)}(x,this.tileID);return this.latestFeatureIndex.query(n,{tilespaceGeometry:u,pixelPosMatrix:I,transform:v,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(n,u){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const v=p.loadVTLayers(),x=u?u.sourceLayer:"",w=v._geojsonTileLayer||v[x];if(!w)return;const I=s.b6(u&&u.filter),{z:C,x:D,y:F}=this.tileID.canonical,V={z:C,x:D,y:F};for(let z=0;z<w.length;z++){const j=w.feature(z);if(I.needGeometry){const ee=s.b7(j,!0);if(!I.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ee,this.tileID.canonical))continue}else if(!I.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),j))continue;const G=p.getId(j,x),H=new s.b8(j,C,D,F,G);H.tile=V,n.push(H)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(n){const u=this.expirationTime;if(n.cacheControl){const p=s.b9(n.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const p=Date.now();let v=!1;if(this.expirationTime>p)v=!1;else if(u)if(this.expirationTime<u)v=!0;else{const x=this.expirationTime-u;x?this.expirationTime=p+Math.max(x,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}updateBuckets(n,u){if(!this.latestFeatureIndex||!n.style)return;const p=this.latestFeatureIndex.loadVTLayers(),v=n.style.listImages(),x=n.style.getBrightness();for(const w in this.buckets){if(!n.style.hasLayer(w))continue;const I=this.buckets[w],C=I.layers[0],D=C.sourceLayer||"_geojsonTileLayer",F=p[D],V=n.style.getLayerSourceCache(C);let z={};V&&(z=V._state.getState(D,void 0));const j=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},G=Object.keys(z).length>0&&!u;(G&&I.stateDependentLayers.length!==0||u)&&I.update(z,F,v,j,G?I.stateDependentLayers:I.layers,u,x),(I instanceof s.ba||I instanceof s.bb)&&n._terrain&&n._terrain.enabled&&V&&I.uploadPending()&&n._terrain._clearRenderCacheForTile(V.id,this.tileID);const H=n&&n.style&&n.style.getOwnLayer(w);H&&(this.queryPadding=Math.max(this.queryPadding,H.queryRadius(I)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=s.o.now()+n}setTexture(n,u){const p=u.context,v=p.gl;this.texture=this.texture||u.getTileTexture(n.width),this.texture&&this.texture instanceof s.T?this.texture.update(n):(this.texture=new s.T(p,n,v.RGBA8,{useMipmap:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE))}setDependencies(n,u){const p={};for(const v of u)p[v]=!0;this.dependencies[n]=p}hasDependency(n,u){for(const p of n){const v=this.dependencies[p];if(v){for(const x of u)if(v[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,u){if(!u||u.name==="mercator"||this._tileDebugBuffer)return;const p=s.bc(Eh,this.tileID.canonical,this.tileTransform)[0],v=new s.bd,x=new s.be;for(let w=0;w<p.length;w++){const{x:I,y:C}=p[w];v.emplaceBack(I,C),x.emplaceBack(w)}x.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(x),this._tileDebugBuffer=n.createVertexBuffer(v,s.bf.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,v.length,x.length)}_makeTileBoundsBuffers(n,u){if(this._tileBoundsBuffer||!u||u.name==="mercator")return;const p=s.bc(Eh,this.tileID.canonical,this.tileTransform)[0];let v,x;if(this.isRaster){const w=function(I,C){const D=s.aZ(I,C),F=Math.pow(2,I.z);for(let ee=0;ee<Go;ee++)for(let K=0;K<Go;K++){const ie=s.a_((I.x+(K+pp(K))/pn)/F),ae=s.a$((I.y+(ee+pp(ee))/pn)/F),ce=C.project(ie,ae),ve=ee*Go+K;Do[2*ve+0]=Math.round((ce.x*D.scale-D.x)*s.al),Do[2*ve+1]=Math.round((ce.y*D.scale-D.y)*s.al)}bo.fill(0),dc.fill(0);for(let ee=2045;ee>=0;ee--){const K=4*ee,ie=oa[K+0],ae=oa[K+1],ce=oa[K+2],ve=oa[K+3],_e=ie+ce>>1,xe=ae+ve>>1,ge=_e+xe-ae,pe=xe+ie-_e,we=ae*Go+ie,Je=ve*Go+ce,$e=xe*Go+_e,ot=Math.hypot((Do[2*we+0]+Do[2*Je+0])/2-Do[2*$e+0],(Do[2*we+1]+Do[2*Je+1])/2-Do[2*$e+1])>=16;bo[$e]=bo[$e]||(ot?1:0),ee<1022&&(bo[$e]=bo[$e]||bo[(ae+pe>>1)*Go+(ie+ge>>1)]||bo[(ve+pe>>1)*Go+(ce+ge>>1)])}const V=new s.b0,z=new s.b1;let j=0;function G(ee,K){const ie=K*Go+ee;return dc[ie]===0&&(V.emplaceBack(Do[2*ie+0],Do[2*ie+1],ee*s.al/pn,K*s.al/pn),dc[ie]=++j),dc[ie]-1}function H(ee,K,ie,ae,ce,ve){const _e=ee+ie>>1,xe=K+ae>>1;if(Math.abs(ee-ce)+Math.abs(K-ve)>1&&bo[xe*Go+_e])H(ce,ve,ee,K,_e,xe),H(ie,ae,ce,ve,_e,xe);else{const ge=G(ee,K),pe=G(ie,ae),we=G(ce,ve);z.emplaceBack(ge,pe,we)}}return H(0,0,pn,pn,pn,0),H(pn,pn,0,0,0,pn),{vertices:V,indices:z}}(this.tileID.canonical,u);v=w.vertices,x=w.indices}else{v=new s.b0,x=new s.b1;for(const{x:I,y:C}of p)v.emplaceBack(I,C,0,0);const w=s.bh(v.int16.subarray(0,4*v.length),void 0,4);for(let I=0;I<w.length;I+=3)x.emplaceBack(w[I],w[I+1],w[I+2])}this._tileBoundsBuffer=n.createVertexBuffer(v,s.bi.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(x),this._tileBoundsSegments=s.bg.simpleSegment(0,0,v.length,x.length)}_makeGlobeTileDebugBuffers(n,u){const p=u.projection;if(!p||p.name!=="globe"||u.freezeTileCoverage)return;const v=this.tileID.canonical,x=s.bj(v,u),w=s.bk(x),I=s.aj(u.zoom);let C;I>0&&(C=s.bl(new Float64Array(16),u.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,v,u,w,C,I),this._makeGlobeTileDebugTextBuffer(n,v,u,w,C,I)}_globePoint(n,u,p,v,x,w,I){let C=s.bm(n,u,p);if(w){const D=1<<p.z,F=s.aF(v.center.lng),V=s.aJ(v.center.lat),z=(p.x+.5)/D-F;let j=0;z>.5?j=-1:z<-.5&&(j=1);let G=(n/s.al+p.x)/D+j,H=(u/s.al+p.y)/D;G=(G-F)*v._pixelsPerMercatorPixel+F,H=(H-V)*v._pixelsPerMercatorPixel+V;const ee=[G*v.worldSize,H*v.worldSize,0];s.af(ee,ee,w),C=s.bn(C,ee,I)}return s.af(C,C,x)}_makeGlobeTileDebugBorderBuffer(n,u,p,v,x,w){const I=new s.bd,C=new s.be,D=new s.bo,F=(z,j,G,H,ee)=>{const K=(G-z)/(ee-1),ie=(H-j)/(ee-1),ae=I.length;for(let ce=0;ce<ee;ce++){const ve=z+ce*K,_e=j+ce*ie;I.emplaceBack(ve,_e);const xe=this._globePoint(ve,_e,u,p,v,x,w);D.emplaceBack(xe[0],xe[1],xe[2]),C.emplaceBack(ae+ce)}},V=s.al;F(0,0,V,0,16),F(V,0,V,V,16),F(V,V,0,V,16),F(0,V,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(C),this._tileDebugBuffer=n.createVertexBuffer(I,s.bf.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(D,s.bp.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,I.length,C.length)}_makeGlobeTileDebugTextBuffer(n,u,p,v,x,w){const I=s.al/4,C=new s.bd,D=new s.b1,F=new s.bo,V=25;D.reserve(32),C.reserve(V),F.reserve(V);const z=(j,G)=>V*j+G;for(let j=0;j<V;j++){const G=j*I;for(let H=0;H<V;H++){const ee=H*I;C.emplaceBack(ee,G);const K=this._globePoint(ee,G,u,p,v,x,w);F.emplaceBack(K[0],K[1],K[2])}}for(let j=0;j<4;j++)for(let G=0;G<4;G++){const H=z(j,G),ee=z(j,G+1),K=z(j+1,G),ie=z(j+1,G+1);D.emplaceBack(H,ee,K),D.emplaceBack(K,ee,ie)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(D),this._tileDebugTextBuffer=n.createVertexBuffer(C,s.bf.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(F,s.bp.members),this._tileDebugTextSegments=s.bg.simpleSegment(0,0,V,32)}destroy(n=!1){for(const u in this.buckets)this.buckets[u].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bs.setPbf(s.bt);class Ih extends fc{constructor(n,u,p,v,x){super(n,u,p,v,x),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(n){return this._mrt&&this._mrt.getLayer(n)}setTexturePerLayer(n,u,p){const v=p.context,x=v.gl;let w=this.texturePerLayer.get(n)||p.getTileTexture(u.width);w&&w instanceof s.T?w.update(u,{premultiply:!1}):w=new s.T(v,u,x.RGBA8,{premultiply:!1}),this.texturePerLayer.has(n)||this.texturePerLayer.set(n,w)}flushQueues(n){const u=this._workQueuePerLayer.get(n)||[],p=this._fetchQueuePerLayer.get(n)||[];for(;u.length;)u.pop()();for(;p.length;)p.pop()()}flushAllQueues(){for(const n of this._workQueuePerLayer.keys()){const u=this._workQueuePerLayer.get(n)||[];for(;u.length;)u.pop()()}for(const n of this._fetchQueuePerLayer.keys()){const u=this._fetchQueuePerLayer.get(n)||[];for(;u.length;)u.pop()()}}fetchHeader(n=16384,u){const p=this._mrt=new s.bs(30),v=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=s.bu(v,(x,w,I,C)=>{if(x)u(x);else try{const D=p.getHeaderLength(w);if(D>n)return void(this.request=this.fetchHeader(D,u));p.parseHeader(w),this._isHeaderLoaded=!0;let F=0;for(const V of Object.values(p.layers))F=Math.max(F,V.dataIndex[V.dataIndex.length-1].lastByte);w.byteLength>=F&&(this.entireBuffer=w),u(null,this.entireBuffer||w,I,C)}catch(D){u(D)}}),this.request}fetchBandForRender(n,u,p,v){this.fetchBand(n,u,p,x=>{if(x)return void v(x);this.updateTextureDescriptor(n,u,p);const w=this.textureDescriptorPerLayer.get(u);v(null,w?w.img:null)})}fetchBand(n,u,p,v,x=!0){const w=this._mrt;if(!this._isHeaderLoaded||!w)return void v(new Error("Tile header is not ready"));const I=this.actor;if(!I)return void v(new Error("Can't fetch tile band without an actor"));let C;const D=s.B(String(p),s.B(this.tileID.key,n));let F=this._taskQueue.get(D);F?F.add(v):(F=new Set,F.add(v),this._taskQueue.set(D,F));const V=(H,ee)=>{C.complete(H,ee),H?v(H):(F.values().forEach(K=>K(null,ee)),this._taskQueue.delete(D))},z=(H,ee)=>{if(H)return v(H);const K=I.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ee,task:C},V,void 0,!0);if(u!==null){const ie=this._workQueuePerLayer.get(u)||[];ie.push(()=>{K&&K.cancel(),C.cancel()}),this._workQueuePerLayer.has(u)||this._workQueuePerLayer.set(u,ie)}};let j;try{j=w.getLayer(n)}catch(H){if(this.state==="reloading")return;throw H}if(!j)return void v(new Error(`Unknown sourceLayer "${n}"`));if(j.hasDataForBand(p))return F.values().forEach(H=>H(null,null)),void this._taskQueue.delete(D);const G=j.getDataRange([p]);if(C=w.createDecodingTask(G),!C||C.tasks.length)if(u!==null&&this.flushQueues(u),this.entireBuffer)z(null,this.entireBuffer.slice(G.firstByte,G.lastByte+1));else{const H=Object.assign({},this.requestParams,{headers:{Range:`bytes=${G.firstByte}-${G.lastByte}`}}),ee=s.bu(H,z);if(u!==null){const K=this._fetchQueuePerLayer.get(u)||[];K.push(()=>{ee.cancel(),C.cancel()}),this._fetchQueuePerLayer.has(u)||this._fetchQueuePerLayer.set(u,K)}}}updateNeeded(n,u){return(!this.textureDescriptorPerLayer.get(n)||this.textureDescriptorPerLayer.get(n).band!==u||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(n,u,p){if(!this._mrt)return;const v=this._mrt.getLayer(n);if(!v||!v.hasBand(p)||!v.hasDataForBand(p))return;const{bytes:x,tileSize:w,buffer:I,offset:C,scale:D}=v.getBandView(p),F=w+2*I,V=new s.q({width:F,height:F},x),z=this.texturePerLayer.get(u);z&&z instanceof s.T&&z.update(V,{premultiply:!1}),this.textureDescriptorPerLayer.set(u,{layer:n,band:p,img:V,buffer:I,offset:C,tileSize:w,format:v.pixelFormat,mix:[D,256*D,65536*D,16777216*D]})}destroy(n=!1){if(super.destroy(n),delete this._mrt,!n)for(const u of this.texturePerLayer.values())u&&u instanceof s.T&&u.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Fl{constructor(n,u){this.max=n,this.onRemove=u,this.reset()}reset(){for(const n in this.data)for(const u of this.data[n])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(n,u,p){const v=n.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const x={value:u,timeout:void 0};if(p!==void 0&&(x.timeout=setTimeout(()=>{this.remove(n,x)},p)),this.data[v].push(x),this.order.push(v),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const u=this.data[n].shift();return u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),u.value}getByKey(n){const u=this.data[n];return u?u[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,u){if(!this.has(n))return this;const p=n.wrapped().key,v=u===void 0?0:this.data[p].indexOf(u),x=this.data[p][v];return this.data[p].splice(v,1),x.timeout&&clearTimeout(x.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(x.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(n){const u=[];for(const p in this.data)for(const v of this.data[p])n(v.value)||u.push(v);for(const p of u)this.remove(p.value.tileID,p)}}class aa{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,u,p){const v=String(u);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][v]=this.stateChanges[n][v]||{},Object.assign(this.stateChanges[n][v],p),this.deletedStates[n]===null){this.deletedStates[n]={};for(const x in this.state[n])x!==v&&(this.deletedStates[n][x]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][v]===null){this.deletedStates[n][v]={};for(const x in this.state[n][v])p[x]||(this.deletedStates[n][v][x]=null)}else for(const x in p)this.deletedStates[n]&&this.deletedStates[n][v]&&this.deletedStates[n][v][x]===null&&delete this.deletedStates[n][v][x]}removeFeatureState(n,u,p){if(this.deletedStates[n]===null)return;const v=String(u);if(this.deletedStates[n]=this.deletedStates[n]||{},p&&u!==void 0)this.deletedStates[n][v]!==null&&(this.deletedStates[n][v]=this.deletedStates[n][v]||{},this.deletedStates[n][v][p]=null);else if(u!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][v])for(p in this.deletedStates[n][v]={},this.stateChanges[n][v])this.deletedStates[n][v][p]=null;else this.deletedStates[n][v]=null;else this.deletedStates[n]=null}getState(n,u){const p=this.state[n]||{},v=this.stateChanges[n]||{},x=this.deletedStates[n];if(x===null)return{};if(u!==void 0){const I=String(u),C=Object.assign({},p[I],v[I]);if(x){const D=x[u];if(D===null)return{};for(const F in D)delete C[F]}return C}const w=Object.assign({},p,v);if(x)for(const I in x)delete w[I];return w}initializeTileState(n,u){n.refreshFeatureState(u)}coalesceChanges(n,u){const p={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const x={};for(const w in this.stateChanges[v])this.state[v][w]||(this.state[v][w]={}),Object.assign(this.state[v][w],this.stateChanges[v][w]),x[w]=this.state[v][w];p[v]=x}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const x={};if(this.deletedStates[v]===null)for(const w in this.state[v])x[w]={},this.state[v][w]={};else for(const w in this.deletedStates[v]){if(this.deletedStates[v][w]===null)this.state[v][w]={};else if(this.state[v][w])for(const I of Object.keys(this.deletedStates[v][w]))delete this.state[v][w][I];x[w]=this.state[v][w]}p[v]=p[v]||{},Object.assign(p[v],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const v in n)n[v].refreshFeatureState(u)}}class Ho extends s.E{constructor(n,u,p){super(),this.id=n,this._onlySymbols=p,u.on("data",v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),u.on("error",()=>{this._sourceErrored=!0}),this._source=u,this._tiles={},this._cache=new Fl(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new aa,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles)if(!this._tiles[n].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,u){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,u)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const p=this._tiles[u];p.upload(n),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(Nd).map(n=>n.key)}getRenderableIds(n,u){const p=[];for(const v in this._tiles)this._isIdRenderable(+v,n,u)&&p.push(this._tiles[v]);return n?p.sort((v,x)=>{const w=v.tileID,I=x.tileID,C=new s.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),D=new s.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-I.overscaledZ||D.y-C.y||D.x-C.x}).map(v=>v.tileID.key):p.map(v=>v.tileID).sort(Nd).map(v=>v.key)}hasRenderableParent(n){const u=this.findLoadedParent(n,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(n,u,p){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(u||!this._tiles[n].holdingForFade())&&(p||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,u){const p=this._tiles[n];p&&(p.state!=="loading"&&(p.state=u),this._loadTile(p,this._tileLoaded.bind(this,p,n,u)))}_tileLoaded(n,u,p,v){if(v)if(n.state="errored",v.status!==404)this._source.fire(new s.y(v,{tile:n}));else{if(this._source.fire(new s.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=s.o.now(),p==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(u,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new s.z("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const u=this.getRenderableIds();for(let v=0;v<u.length;v++){const x=u[v];if(n.neighboringTiles&&n.neighboringTiles[x]){const w=this.getTileByID(x);p(n,w),p(w,n)}}function p(v,x){if(!v.dem||v.dem.borderReady)return;v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0;let w=x.tileID.canonical.x-v.tileID.canonical.x;const I=x.tileID.canonical.y-v.tileID.canonical.y,C=Math.pow(2,v.tileID.canonical.z),D=x.tileID.key;w===0&&I===0||Math.abs(I)>1||(Math.abs(w)>1&&(Math.abs(w+C)===1?w+=C:Math.abs(w-C)===1&&(w-=C)),x.dem&&v.dem&&(v.dem.backfillBorder(x.dem,w,I),v.neighboringTiles&&v.neighboringTiles[D]&&(v.neighboringTiles[D].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,u,p,v){for(const x in this._tiles){let w=this._tiles[x];if(v[x]||!w.hasData()||w.tileID.overscaledZ<=u||w.tileID.overscaledZ>p)continue;let I=w.tileID;for(;w&&w.tileID.overscaledZ>u+1;){const D=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[D.key],w&&w.hasData()&&(I=D)}let C=I;for(;C.overscaledZ>u;)if(C=C.scaledTo(C.overscaledZ-1),n[C.key]){v[I.key]=I;break}}}findLoadedParent(n,u){if(n.key in this._loadedParentTiles){const p=this._loadedParentTiles[n.key];return p&&p.tileID.overscaledZ>=u?p:null}for(let p=n.overscaledZ-1;p>=u;p--){const v=n.scaledTo(p),x=this._getLoadedTile(v);if(x)return x}}_getLoadedTile(n){const u=this._tiles[n.key];return u&&u.hasData()?u:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,u){u=u||this._source.tileSize;const p=Math.ceil(n.width/u)+1,v=Math.ceil(n.height/u)+1,x=Math.floor(p*v*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(I)}handleWrapJump(n){const u=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,u){const p={};for(const v in this._tiles){const x=this._tiles[v];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+u),p[x.tileID.key]=x}this._tiles=p;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(+v,this._tiles[v])}}update(n,u,p,v,x){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(n,u),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const w=this._source.type==="batched-model";let I,C=this._source.maxzoom;const D=this.map&&this.map.painter?this.map.painter._terrain:null;if(D&&D.sourceCache===this&&D.attenuationRange()){const z=D.attenuationRange()[0],j=Math.floor(z)-Math.log2(D.getDemUpscale());C>j&&(C=j)}if(this.used||this.usedForTerrain){if(this._source.tileID)I=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new s.aO(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y));else if(this.tileCoverLift!==0){const z=n.clone();z.tileCoverLift=this.tileCoverLift,I=z.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.minzoom<=1&&n.projection.name==="globe"&&(I.push(new s.aO(1,0,1,0,0)),I.push(new s.aO(1,0,1,1,0)),I.push(new s.aO(1,0,1,0,1)),I.push(new s.aO(1,0,1,1,1)))}else if(I=n.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.hasTile){const z=this._source.hasTile.bind(this._source);I=I.filter(j=>z(j))}}else I=[];if(I.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Sh(this._source.type)){const z=n.coveringZoomLevel({tileSize:u||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),j=Math.min(z,this._source.maxzoom);if(w){const G=n.extendTileCover(I,j);for(const H of G)I.push(H)}else if(x){const G=n.extendTileCoverToNearPlane(I,this.transform.getFrustum(j),j);for(const H of G)I.push(H)}else if(this.castsShadows&&v){const G=n.extendTileCover(I,j,v);for(const H of G)this._shadowCasterTiles[H.key]=!0,I.push(H)}}const F=this._updateRetainedTiles(I);if(Sh(this._source.type)&&I.length!==0){const z={},j={},G=Object.keys(F);for(const ee of G){const K=F[ee],ie=this._tiles[ee];if(!ie||ie.fadeEndTime&&ie.fadeEndTime<=s.o.now())continue;const ae=this.findLoadedParent(K,Math.max(K.overscaledZ-Ho.maxOverzooming,this._source.minzoom));ae&&(this._addTile(ae.tileID),z[ae.tileID.key]=ae.tileID),j[ee]=K}const H=I[I.length-1].overscaledZ;for(const ee in this._tiles){const K=this._tiles[ee];if(F[ee]||!K.hasData())continue;let ie=K.tileID;for(;ie.overscaledZ>H;){ie=ie.scaledTo(ie.overscaledZ-1);const ae=this._tiles[ie.key];if(ae&&ae.hasData()&&j[ie.key]){F[ee]=K.tileID;break}}}for(const ee in z)F[ee]||(this._coveredTiles[ee]=!0,F[ee]=z[ee])}for(const z in F)this._tiles[z].clearFadeHold();const V=s.bv(this._tiles,F);for(const z of V){const j=this._tiles[z];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(+z)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const u={};if(n.length===0)return u;const p={},v=n.reduce((D,F)=>Math.min(D,F.overscaledZ),1/0),x=n[0].overscaledZ,w=Math.max(x-Ho.maxOverzooming,this._source.minzoom),I=Math.max(x+Ho.maxUnderzooming,this._source.minzoom),C={};for(const D of n){const F=this._addTile(D);u[D.key]=D,F.hasData()||v<this._source.maxzoom&&(C[D.key]=D)}this._retainLoadedChildren(C,v,I,u);for(const D of n){let F=this._tiles[D.key];if(F.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const z=D.children(this._source.maxzoom)[0],j=this.getTile(z);if(j&&j.hasData()){u[z.key]=z;continue}}else{const z=D.children(this._source.maxzoom);if(u[z[0].key]&&u[z[1].key]&&u[z[2].key]&&u[z[3].key])continue}let V=F.wasRequested();for(let z=D.overscaledZ-1;z>=w;--z){const j=D.scaledTo(z);if(p[j.key]||(p[j.key]=!0,F=this.getTile(j),!F&&V&&(F=this._addTile(j)),F&&(u[j.key]=j,V=F.wasRequested(),F.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const u=[];let p,v=this._tiles[n].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){p=this._loadedParentTiles[v.key];break}u.push(v.key);const x=v.scaledTo(v.overscaledZ-1);if(p=this._getLoadedTile(x),p)break;v=x}for(const x of u)this._loadedParentTiles[x]=p}}_addTile(n){let u=this._tiles[n.key];if(u)return u.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),u;u=this._cache.getAndRemove(n),u&&(this._setTileReloadTimer(n.key,u),u.tileID=n,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,u)));const p=!!u;if(!p){const v=this.map?this.map.painter:null,x=this._source.tileSize*n.overscaleFactor();u=this._source.type==="raster-array"?new Ih(n,x,this.transform.tileZoom,v,this._isRaster):new fc(n,x,this.transform.tileZoom,v,this._isRaster,this._source.worldview),this._loadTile(u,this._tileLoaded.bind(this,u,n.key,u.state))}return u.uses++,this._tiles[n.key]=u,p||this._source.fire(new s.z("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(n,u){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const p=u.getExpiryTimeout();p&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},p))}_removeTile(n){const u=this._tiles[n];u&&(u.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),u.uses>0||(u.hasData()&&u.state!=="reloading"||u.state==="empty"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,u,p){const v=[],x=this.transform;if(!x)return v;const w=x.projection.name==="globe",I=s.aF(x.center.lng);for(const C in this._tiles){const D=this._tiles[C];if(p&&D.clearQueryDebugViz(),D.holdingForFade())continue;let F;if(w){const V=D.tileID.canonical;if(V.z===0){const z=[Math.abs(s.aA(I,...Ja(V,-1))-I),Math.abs(s.aA(I,...Ja(V,1))-I)];F=[0,2*z.indexOf(Math.min(...z))-1]}else{const z=[Math.abs(s.aA(I,...Ja(V,-1))-I),Math.abs(s.aA(I,...Ja(V,0))-I),Math.abs(s.aA(I,...Ja(V,1))-I)];F=[z.indexOf(Math.min(...z))-1]}}else F=[0];for(const V of F){const z=n.containsTile(D,x,u,V);z&&v.push(z)}}return v}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,u){const p=this.getRenderableIds(n,u).map(x=>this._tiles[x].tileID),v=this.transform.projection.name==="globe";for(const x of p)x.projMatrix=this.transform.calculateProjMatrix(x.toUnwrapped()),x.expandedProjMatrix=v?this.transform.calculateProjMatrix(x.toUnwrapped(),!1,!0):x.projMatrix;return p}sortCoordinatesByDistance(n){const u=n.slice(),p=this.transform._camera.position,v=this.transform._camera.forward(),x={};for(const w of u){const I=1/(1<<w.canonical.z);x[w.key]=((w.canonical.x+.5)*I+w.wrap-p[0])*v[0]+((w.canonical.y+.5)*I-p[1])*v[1]-p[2]*v[2]}return u.sort((w,I)=>x[w.key]-x[I.key]),u}hasTransition(){if(this._source.hasTransition())return!0;if(Sh(this._source.type))for(const n in this._tiles){const u=this._tiles[n];if(u.fadeEndTime!==void 0&&u.fadeEndTime>=s.o.now())return!0}return!1}setFeatureState(n,u,p){this._state.updateState(n=n||"_geojsonTileLayer",u,p)}removeFeatureState(n,u,p){this._state.removeFeatureState(n=n||"_geojsonTileLayer",u,p)}getFeatureState(n,u){return this._state.getState(n=n||"_geojsonTileLayer",u)}setDependencies(n,u,p){const v=this._tiles[n];v&&v.setDependencies(u,p)}reloadTilesForDependencies(n,u){for(const p in this._tiles)this._tiles[p].hasDependency(n,u)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(n,u))}_preloadTiles(n,u){if(!this._sourceLoaded){const C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(n,u))};return void this._source.on("data",C)}const p=new Map,v=Array.isArray(n)?n:[n],x=this.map.painter.terrain,w=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const C of v){const D=C.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of D)p.set(F.key,F);this.usedForTerrain&&C.updateElevation(!1)}const I=Array.from(p.values());s.bw(I,(C,D)=>{const F=new fc(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(F,V=>{this._source.type==="raster-dem"&&F.dem&&this._backfillDEM(F),D(V,F)})},u)}}function Nd(m,n){const u=Math.abs(2*m.wrap)-+(m.wrap<0),p=Math.abs(2*n.wrap)-+(n.wrap<0);return m.overscaledZ-n.overscaledZ||p-u||n.canonical.y-m.canonical.y||n.canonical.x-m.canonical.x}function Sh(m){return m==="raster"||m==="image"||m==="video"||m==="custom"}function Ja(m,n){const u=1<<m.z;return[m.x/u+n,(m.x+1)/u+n]}Ho.maxOverzooming=10,Ho.maxUnderzooming=3;class Bd{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,u=!1;for(const p in this.style._mergedLayers){const v=this.style._mergedLayers[p];if(v.type==="fill-extrusion"||v.type==="building")this.layers.push({layer:v,visible:n,visibilityChanged:u});else if(v.type==="model"){const x=this.style.getLayerSource(v);x&&x.type==="batched-model"&&this.layers.push({layer:v,visible:n,visibilityChanged:u})}}}onNewFrame(n){this.layersGotHidden=!1;for(const u of this.layers){const p=u.layer;let v=!1;p.type==="fill-extrusion"?v=!p.isHidden(n)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="building"?v=!p.isHidden(n)&&p.paint.get("building-opacity")>0:p.type==="model"&&(v=!p.isHidden(n)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!v&&u.visible,u.visible=v}}updateZOffset(n,u){this.currentBuildingBuckets=[];for(const v of this.layers){const x=v.layer,w=this.style.getLayerSourceCache(x);let I=1;x.type==="fill-extrusion"?I=v.visible?x.paint.get("fill-extrusion-vertical-scale"):0:x.type==="building"&&(I=v.visible?x.paint.get("building-vertical-scale"):0);let C=w?w.getTile(u):null;if(!C&&w)for(const D in w._tiles){const F=w._tiles[D];if(u.canonical.isChildOf(F.tileID.canonical)){C=F;break}}this.currentBuildingBuckets.push({bucket:C?C.getBucket(x):null,tileID:C?C.tileID:u,verticalScale:I})}n.hasAnyZOffset=!1;let p=!1;for(let v=0;v<n.symbolInstances.length;v++){const x=n.symbolInstances.get(v),w=x.zOffset,I=this._getHeightAtTileOffset(u,x.tileAnchorX,x.tileAnchorY);x.zOffset=I!==Number.NEGATIVE_INFINITY?I:w,p||w===x.zOffset||(p=!0),n.hasAnyZOffset||x.zOffset===0||(n.hasAnyZOffset=!0)}p&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,u,p,v){let x=u,w=p;if(n.canonical.z!==v.canonical.z){const I=v.canonical,C=1/(1<<n.canonical.z-I.z);x=(u+n.canonical.x*s.al)*C-I.x*s.al|0,w=(p+n.canonical.y*s.al)*C-I.y*s.al|0}return{tileX:x,tileY:w}}_getHeightAtTileOffset(n,u,p){let v,x;for(let w=0;w<this.layers.length;++w){const I=this.layers[w].layer;if(I.type!=="fill-extrusion"&&I.type!=="building")continue;const{bucket:C,tileID:D,verticalScale:F}=this.currentBuildingBuckets[w];if(!C)continue;const{tileX:V,tileY:z}=this._mapCoordToOverlappingTile(n,u,p,D),j=C.getHeightAtTileCoord(V,z);j&&j.height!==void 0&&(j.hidden?v=j.height:x=Math.max(j.height*F,x||0))}if(x!==void 0)return x;for(let w=0;w<this.layers.length;++w){const I=this.layers[w];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:C,tileID:D}=this.currentBuildingBuckets[w];if(!C)continue;const{tileX:F,tileY:V}=this._mapCoordToOverlappingTile(n,u,p,D),z=C.getHeightAtTileCoord(F,V);if(z&&!z.hidden)return z.height===void 0&&v!==void 0?Math.min(z.maxHeight,v)*z.verticalScale:z.height?z.height*z.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function mp(m,n){const u={};for(const p in m)p!=="ref"&&(u[p]=m[p]);return s.bx.forEach(p=>{p in n&&(u[p]=n[p])}),u}function Vd(m){m=m.slice();const n=Object.create(null);for(let u=0;u<m.length;u++)n[m[u].id]=m[u];for(let u=0;u<m.length;u++)"ref"in m[u]&&(m[u]=mp(m[u],n[m[u].ref]));return m}const fr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Iu(m,n,u){u.push({command:fr.addSource,args:[m,n[m]]})}function Jm(m,n,u){n.push({command:fr.removeSource,args:[m]}),u[m]=!0}function Ah(m,n,u,p){Jm(m,u,p),Iu(m,n,u)}function Gc(m,n,u){let p;for(p in m[u])if(m[u].hasOwnProperty(p)&&p!=="data"&&!s.by(m[u][p],n[u][p]))return!1;for(p in n[u])if(n[u].hasOwnProperty(p)&&p!=="data"&&!s.by(m[u][p],n[u][p]))return!1;return!0}function zl(m,n,u,p,v,x){let w;for(w in n=n||{},m=m||{})m.hasOwnProperty(w)&&(s.by(m[w],n[w])||u.push({command:x,args:[p,w,n[w],v]}));for(w in n)n.hasOwnProperty(w)&&!m.hasOwnProperty(w)&&(s.by(m[w],n[w])||u.push({command:x,args:[p,w,n[w],v]}))}function bl(m){return m.id}function Nl(m,n){return m[n.id]=n,m}function Ch(m,n,u){const p=n.createTileMatrix(m,m.worldSize,u.toUnwrapped());return s.aB(new Float32Array(16),m.projMatrix,p)}function Ud(m,n,u){if(n.projection.name===u.projection.name)return m.projMatrix;const p=u.clone();return p.setProjection(n.projection),Ch(p,n.getProjection(),m)}function ts(m,n,u){return n.name===u.projection.name?m.projMatrix:Ch(u,n,m)}class Qm{constructor(n,u){this.reset(n,u)}reset(n,u){this.points=n||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=s.aA(n,0,1);let u=1,p=this._distances[u];const v=n*this.paddedLength+this.padding;for(;p<v&&u<this._distances.length;)p=this._distances[++u];const x=u-1,w=this._distances[x],I=p-w,C=I>0?(v-w)/I:0;return this.points[x].mult(1-C).add(this.points[u].mult(C))}}class _p{constructor(n,u,p){const v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(n/p),this.yCellCount=Math.ceil(u/p);for(let w=0;w<this.xCellCount*this.yCellCount;w++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=u,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,u,p,v,x){this._forEachCell(u,p,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(n,u,p,v){this._forEachCell(u-v,p-v,u+v,p+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(u),this.circles.push(p),this.circles.push(v)}_insertBoxCell(n,u,p,v,x,w){this.boxCells[x].push(w)}_insertCircleCell(n,u,p,v,x,w){this.circleCells[x].push(w)}_query(n,u,p,v,x,w){if(p<0||n>this.width||v<0||u>this.height)return!x&&[];const I=[];if(n<=0&&u<=0&&this.width<=p&&this.height<=v){if(x)return!0;for(let C=0;C<this.boxKeys.length;C++)I.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const D=this.circles[3*C],F=this.circles[3*C+1],V=this.circles[3*C+2];I.push({key:this.circleKeys[C],x1:D-V,y1:F-V,x2:D+V,y2:F+V})}return w?I.filter(w):I}return this._forEachCell(n,u,p,v,this._queryCell,I,{hitTest:x,seenUids:{box:{},circle:{}}},w),x?I.length>0:I}_queryCircle(n,u,p,v,x){const w=n-p,I=n+p,C=u-p,D=u+p;if(I<0||w>this.width||D<0||C>this.height)return!v&&[];const F=[];return this._forEachCell(w,C,I,D,this._queryCellCircle,F,{hitTest:v,circle:{x:n,y:u,radius:p},seenUids:{box:{},circle:{}}},x),v?F.length>0:F}query(n,u,p,v,x){return this._query(n,u,p,v,!1,x)}hitTest(n,u,p,v,x){return this._query(n,u,p,v,!0,x)}hitTestCircle(n,u,p,v){return this._queryCircle(n,u,p,!0,v)}_queryCell(n,u,p,v,x,w,I,C){const D=I.seenUids,F=this.boxCells[x];if(F!==null){const z=this.bboxes;for(const j of F)if(!D.box[j]){D.box[j]=!0;const G=4*j;if(n<=z[G+2]&&u<=z[G+3]&&p>=z[G+0]&&v>=z[G+1]&&(!C||C(this.boxKeys[j]))){if(I.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[j],x1:z[G],y1:z[G+1],x2:z[G+2],y2:z[G+3]})}}}const V=this.circleCells[x];if(V!==null){const z=this.circles;for(const j of V)if(!D.circle[j]){D.circle[j]=!0;const G=3*j;if(this._circleAndRectCollide(z[G],z[G+1],z[G+2],n,u,p,v)&&(!C||C(this.circleKeys[j]))){if(I.hitTest)return w.push(!0),!0;{const H=z[G],ee=z[G+1],K=z[G+2];w.push({key:this.circleKeys[j],x1:H-K,y1:ee-K,x2:H+K,y2:ee+K})}}}}}_queryCellCircle(n,u,p,v,x,w,I,C){const D=I.circle,F=I.seenUids,V=this.boxCells[x];if(V!==null){const j=this.bboxes;for(const G of V)if(!F.box[G]){F.box[G]=!0;const H=4*G;if(this._circleAndRectCollide(D.x,D.y,D.radius,j[H+0],j[H+1],j[H+2],j[H+3])&&(!C||C(this.boxKeys[G])))return w.push(!0),!0}}const z=this.circleCells[x];if(z!==null){const j=this.circles;for(const G of z)if(!F.circle[G]){F.circle[G]=!0;const H=3*G;if(this._circlesCollide(j[H],j[H+1],j[H+2],D.x,D.y,D.radius)&&(!C||C(this.circleKeys[G])))return w.push(!0),!0}}}_forEachCell(n,u,p,v,x,w,I,C){const D=this._convertToXCellCoord(n),F=this._convertToYCellCoord(u),V=this._convertToXCellCoord(p),z=this._convertToYCellCoord(v);for(let j=D;j<=V;j++)for(let G=F;G<=z;G++)if(x.call(this,n,u,p,v,this.xCellCount*G+j,w,I,C))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,u,p,v,x,w){const I=v-n,C=x-u,D=p+w;return D*D>I*I+C*C}_circleAndRectCollide(n,u,p,v,x,w,I){const C=(w-v)/2,D=Math.abs(n-(v+C));if(D>C+p)return!1;const F=(I-x)/2,V=Math.abs(u-(x+F));if(V>F+p)return!1;if(D<=C||V<=F)return!0;const z=D-C,j=V-F;return z*z+j*j<=p*p}}const Hc={unknown:0,flipRequired:1,flipNotRequired:2},Rh=Math.tan(85*Math.PI/180);function Ea(m,n,u,p,v,x,w){const I=s.bC();if(u)if(x.name==="globe"){const C=s.bD(v,n);s.aB(I,I,C)}else{const C=s.bE([],w);I[0]=C[0],I[1]=C[1],I[4]=C[2],I[5]=C[3],p||s.bB(I,I,v.angle)}else s.aB(I,v.labelPlaneMatrix,m);return I}function pc(m,n,u,p,v,x,w){const I=Ea(m,n,u,p,v,x,w);return x.name==="globe"&&u||(I[2]=I[6]=I[10]=I[14]=0),I}function Ph(m,n,u,p,v,x,w){if(u){if(x.name==="globe"){const I=Ea(m,n,u,p,v,x,w);return s.bl(I,I),s.aB(I,m,I),I}{const I=s.bz(m),C=s.bA([]);return C[0]=w[0],C[1]=w[1],C[4]=w[2],C[5]=w[3],s.aB(I,I,C),p||s.bB(I,I,-v.angle),I}}return v.glCoordMatrix}function Vs(m,n,u,p){const v=[m,n,u,1];u?s.aC(v,v,p):Wc(v,v,p);const x=v[3];return v[0]/=x,v[1]/=x,v[2]/=x,v}function mc(m,n){return Math.min(.5+m/n*.5,1.5)}function la(m,n){const u=m[0]/m[3],p=m[1]/m[3];return u>=-n[0]&&u<=n[0]&&p>=-n[1]&&p<=n[1]}function qc(m,n,u,p,v,x,w,I,C,D){const F=u.transform,V=p?m.textSizeData:m.iconSizeData,z=s.bK(V,u.transform.zoom),j=F.projection.name==="globe",G=[256/u.width*2+1,256/u.height*2+1],H=p?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;H.clear();let ee=null;j&&(ee=p?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const K=m.lineVertexArray,ie=p?m.text.placedSymbolArray:m.icon.placedSymbolArray,ae=u.transform.width/u.transform.height;let ce,ve=!1;for(let _e=0;_e<ie.length;_e++){const xe=ie.get(_e),{numGlyphs:ge,writingMode:pe}=xe;if(pe!==s.bL.vertical||ve||ce===s.bL.horizontal||(ve=!0),ce=pe,(xe.hidden||pe===s.bL.vertical)&&!ve){Ri(ge,H);continue}ve=!1;const we=new s.P(xe.tileAnchorX,xe.tileAnchorY);let{x:Je,y:$e,z:ot}=F.projection.projectTilePoint(we.x,we.y,D.canonical);if(C){const[It,fi,li]=C(we);Je+=It,$e+=fi,ot+=li}const Xe=[Je,$e,ot,1];if(s.aC(Xe,Xe,n),!la(Xe,G)){Ri(ge,H);continue}const nt=Xe[3],Dt=mc(u.transform.getCameraToCenterDistance(F.projection),nt),Ye=s.bM(V,z,xe),De=w?Ye/Dt:Ye*Dt,ct=Vs(Je,$e,ot,v);if(ct[3]<=0){Ri(ge,H);continue}let tt={};const bt=s.an(m.layers[0].layout.get("text-max-angle")),kt=Math.cos(bt),$t=w?null:C,Ct=Mr(xe,De,!1,I,n,v,x,m.glyphOffsetArray,K,H,ee,ct,we,tt,ae,$t,F.projection,D,w,kt);ve=Ct.useVertical,$t&&Ct.needsFlipping&&(tt={}),(Ct.notEnoughRoom||ve||Ct.needsFlipping&&Mr(xe,De,!0,I,n,v,x,m.glyphOffsetArray,K,H,ee,ct,we,tt,ae,$t,F.projection,D,w,kt).notEnoughRoom)&&Ri(ge,H)}p?(m.text.dynamicLayoutVertexBuffer.updateData(H),ee&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(ee)):(m.icon.dynamicLayoutVertexBuffer.updateData(H),ee&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(ee))}function Mh(m,n,u,p,v,x,w,I,C,D,F,V,z,j,G,H,ee){const{lineStartIndex:K,glyphStartIndex:ie,segment:ae}=I,ce=ie+I.numGlyphs,ve=K+I.lineLength,_e=n.getoffsetX(ie),xe=n.getoffsetX(ce-1),ge=$d(m*_e,u,p,v,x,w,ae,K,ve,C,D,F,V,z,!0,j,G,H,ee);if(!ge)return null;const pe=$d(m*xe,u,p,v,x,w,ae,K,ve,C,D,F,V,z,!0,j,G,H,ee);return pe?{first:ge,last:pe}:null}function kh(m,n,u,p){return m===s.bL.horizontal&&Math.abs(p)>Math.abs(u)?{useVertical:!0}:m===s.bL.vertical?p>0?{needsFlipping:!0}:null:n!==Hc.unknown&&function(v,x){return v===0||Math.abs(x/v)>Rh}(u,p)?n===Hc.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function Mr(m,n,u,p,v,x,w,I,C,D,F,V,z,j,G,H,ee,K,ie,ae){const ce=n/24,ve=m.lineOffsetX*ce,_e=m.lineOffsetY*ce,{lineStartIndex:xe,glyphStartIndex:ge,numGlyphs:pe,segment:we,writingMode:Je,flipState:$e}=m,ot=xe+m.lineLength,Xe=nt=>{if(F){const[ct,tt,bt]=nt.up,kt=D.length;s.bN(F,kt+0,ct,tt,bt),s.bN(F,kt+1,ct,tt,bt),s.bN(F,kt+2,ct,tt,bt),s.bN(F,kt+3,ct,tt,bt)}const[Dt,Ye,De]=nt.point;s.bO(D,Dt,Ye,De,nt.angle)};if(pe>1){const nt=Mh(ce,I,ve,_e,u,V,z,m,C,x,j,H,!1,ee,K,ie,ae);if(!nt)return{notEnoughRoom:!0};if(p&&!u){let[Dt,Ye,De]=nt.first.point,[ct,tt,bt]=nt.last.point;[Dt,Ye]=Vs(Dt,Ye,De,w),[ct,tt]=Vs(ct,tt,bt,w);const kt=kh(Je,$e,(ct-Dt)*G,tt-Ye);if(m.flipState=kt&&kt.needsFlipping?Hc.flipRequired:Hc.flipNotRequired,kt)return kt}Xe(nt.first);for(let Dt=ge+1;Dt<ge+pe-1;Dt++){const Ye=$d(ce*I.getoffsetX(Dt),ve,_e,u,V,z,we,xe,ot,C,x,j,H,!1,!1,ee,K,ie,ae);if(!Ye)return D.length-=4*(Dt-ge),{notEnoughRoom:!0};Xe(Ye)}Xe(nt.last)}else{if(p&&!u){const Dt=Vs(z.x,z.y,0,v),Ye=xe+we+1,De=new s.P(C.getx(Ye),C.gety(Ye)),ct=Vs(De.x,De.y,0,v),tt=ct[3]>0?ct:Dh(z,De,Dt,1,v,void 0,ee,K.canonical),bt=kh(Je,$e,(tt[0]-Dt[0])*G,tt[1]-Dt[1]);if(m.flipState=bt&&bt.needsFlipping?Hc.flipRequired:Hc.flipNotRequired,bt)return bt}const nt=$d(ce*I.getoffsetX(ge),ve,_e,u,V,z,we,xe,ot,C,x,j,H,!1,!1,ee,K,ie,ae);if(!nt)return{notEnoughRoom:!0};Xe(nt)}return{}}function jd(m,n,u,p,v){const{x,y:w,z:I}=p.projectTilePoint(m.x,m.y,n);if(!v)return Vs(x,w,I,u);const[C,D,F]=v(m);return Vs(x+C,w+D,I+F,u)}function Dh(m,n,u,p,v,x,w,I){const C=jd(m.sub(n)._unit()._add(m),I,v,w,x);return s.av(C,u,C),s.aw(C,C),s.bH(C,u,C,p)}function $d(m,n,u,p,v,x,w,I,C,D,F,V,z,j,G,H,ee,K,ie){const ae=p?m-n:m+n;let ce=ae>0?1:-1,ve=0;p&&(ce*=-1,ve=Math.PI),ce<0&&(ve+=Math.PI);let _e=I+w+(ce>0?0:1)|0,xe=v,ge=v,pe=0,we=0;const Je=Math.abs(ae),$e=[],ot=[];let Xe=x,nt=Xe,Dt=s.bF([]);const Ye=()=>Dh(nt,Xe,ge,Je-pe+1,F,z,H,ee.canonical);for(;pe+we<=Je;){if(_e+=ce,_e<I||_e>=C)return null;if(ge=xe,nt=Xe,$e.push(ge),j&&ot.push(nt),Xe=new s.P(D.getx(_e),D.gety(_e)),xe=V[_e],!xe){const li=jd(Xe,ee.canonical,F,H,z);xe=li[3]>0?V[_e]=li:Ye()}pe+=we;const It=s.av([],xe,ge),fi=s.bG(ge,xe);if(u&&fi>0&&we>0&&s.bJ(Dt,It)/(we*fi)<ie)return null;we=fi,Dt=It}G&&z&&(V[_e]&&(xe=Ye(),we=s.bG(ge,xe),Dt=s.av([],xe,ge)),V[_e]=xe);const De=(Je-pe)/we,ct=Xe.sub(nt)._mult(De)._add(nt),tt=s.bH([],ge,Dt,De);let bt=[0,0,1],kt=Dt[0],$t=Dt[1];if(K&&(bt=H.upVector(ee.canonical,ct.x,ct.y),bt[0]!==0||bt[1]!==0||bt[2]!==1)){const It=[bt[2],0,-bt[0]],fi=s.bI([],bt,It);s.aw(It,It),s.aw(fi,fi),kt=s.bJ(Dt,It),$t=s.bJ(Dt,fi)}if(u){const It=s.bI([],bt,Dt);s.aw(It,It),s.bH(tt,tt,It,u*ce)}const Ct=ve+Math.atan2($t,kt);return $e.push(tt),j&&ot.push(ct),{point:tt,angle:Ct,path:$e,tilePath:ot,up:bt}}function Ri(m,n){const u=n.length,p=u+4*m;n.resize(p),n.float32.fill(-1/0,4*u,4*p)}function Wc(m,n,u){const p=n[0],v=n[1];return m[0]=u[0]*p+u[4]*v+u[12],m[1]=u[1]*p+u[5]*v+u[13],m[3]=u[3]*p+u[7]*v+u[15],m}const qo=100;class Ia{constructor(n,u,p=new _p(n.width+200,n.height+200,25),v=new _p(n.width+200,n.height+200,25)){this.transform=n,this.grid=p,this.ignoredGrid=v,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+qo,this.screenBottomBoundary=n.height+qo,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=u}placeCollisionBox(n,u,p,v,x,w,I,C,D,F,V){let z=p.projectedAnchorX,j=p.projectedAnchorY,G=p.projectedAnchorZ;const H=p.tileAnchorX,ee=p.tileAnchorY,K=p.elevation,ie=p.tileID,ae=n.getProjection();if(K&&ie){const[ot,Xe,nt]=ae.upVector(ie.canonical,p.tileAnchorX,p.tileAnchorY),Dt=ae.upVectorScale(ie.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=ot*K*Dt,j+=Xe*K*Dt,G+=nt*K*Dt}const ce=n.projection.name==="globe",ve=n.projection.name==="globe"?s.aj(this.transform.zoom):0;if(ie&&ce&&ve<1&&!w){const ot=1<<ie.canonical.z,Xe=s.bP(H,ee);s.bQ(Xe,Xe,1/s.al),s.bR(Xe,Xe,s.bP(ie.canonical.x,ie.canonical.y)),s.bQ(Xe,Xe,1/ot),s.bS(Xe,Xe,s.bP(v[0],v[1])),Xe[0]=s.bT(Xe[0],-.5,.5),s.bQ(Xe,Xe,s.al);const nt=s.bU(Xe[0],Xe[1],s.al/(2*Math.PI),1);s.aC(nt,nt,x),z=s.ak(z,nt[0],ve),j=s.ak(j,nt[1],ve),G=s.ak(G,nt[2],ve)}const _e=this.projectAndGetPerspectiveRatio(F,z,j,G,p.tileID,ae.name==="globe"||!!K||this.transform.pitch>0,ae),xe=D*_e.perspectiveRatio,ge=(p.x1*u+I.x-p.padding)*xe+_e.point.x,pe=(p.y1*u+I.y-p.padding)*xe+_e.point.y,we=(p.x2*u+I.x+p.padding)*xe+_e.point.x,Je=(p.y2*u+I.y+p.padding)*xe+_e.point.y,$e=_e.perspectiveRatio<=.55||_e.occluded;return!this.isInsideGrid(ge,pe,we,Je)||!C&&this.grid.hitTest(ge,pe,we,Je,V)||$e?{box:[],offscreen:!1,occluded:_e.occluded}:{box:[ge,pe,we,Je],offscreen:this.isOffscreen(ge,pe,we,Je),occluded:!1}}placeCollisionCircles(n,u,p,v,x,w,I,C,D,F,V,z,j,G,H){const ee=[],K=this.transform.elevation,ie=n.getProjection(),ae=K?K.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,ie):null,ce=new s.P(p.tileAnchorX,p.tileAnchorY);let{x:ve,y:_e,z:xe}=ie.projectTilePoint(ce.x,ce.y,H.canonical);if(ae){const[bt,kt,$t]=ae(ce);ve+=bt,_e+=kt,xe+=$t}const ge=ie.name==="globe",pe=this.projectAndGetPerspectiveRatio(I,ve,_e,xe,H,ge||!!K||this.transform.pitch>0,ie),{perspectiveRatio:we}=pe,Je=(V?w/we:w*we)/s.bX,$e=Vs(ve,_e,xe,C),ot=p.lineOffsetX*Je,Xe=p.lineOffsetY*Je,nt=s.an(n.layers[0].layout.get("text-max-angle")),Dt=Math.cos(nt),Ye=pe.signedDistanceFromCamera>0?Mh(Je,x,ot,Xe,!1,$e,ce,p,v,C,{},K&&!V?ae:null,V&&!!K,ie,H,V,Dt):null;let De=!1,ct=!1,tt=!0;if(Ye&&!pe.occluded){const bt=.5*j*we+G,kt=new s.P(-100,-100),$t=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Ct=new Qm,{first:It,last:fi}=Ye,li=It.path.length;let di=[];for(let Ki=li-1;Ki>=1;Ki--)di.push(It.path[Ki]);for(let Ki=1;Ki<fi.path.length;Ki++)di.push(fi.path[Ki]);const oi=2.5*bt;D&&(di=di.map(([Ki,Qi,Zr],Gi)=>(ae&&!ge&&(Zr=ae(Gi<li-1?It.tilePath[li-1-Gi]:fi.tilePath[Gi-li+2])[2]),Vs(Ki,Qi,Zr,D))),di.some(Ki=>Ki[3]<=0)&&(di=[]));let Vi=[];if(di.length>0){let Ki=1/0,Qi=-1/0,Zr=1/0,Gi=-1/0;for(const Lr of di)Ki=Math.min(Ki,Lr[0]),Zr=Math.min(Zr,Lr[1]),Qi=Math.max(Qi,Lr[0]),Gi=Math.max(Gi,Lr[1]);Qi>=kt.x&&Ki<=$t.x&&Gi>=kt.y&&Zr<=$t.y&&(Vi=[di.map(Lr=>new s.P(Lr[0],Lr[1]))],(Ki<kt.x||Qi>$t.x||Zr<kt.y||Gi>$t.y)&&(Vi=s.bV(Vi,kt.x,kt.y,$t.x,$t.y)))}for(const Ki of Vi){Ct.reset(Ki,.25*bt);let Qi=0;Qi=Ct.length<=.5*bt?1:Math.ceil(Ct.paddedLength/oi)+1;for(let Zr=0;Zr<Qi;Zr++){const Gi=Zr/Math.max(Qi-1,1),Lr=Ct.lerp(Gi),Wr=Lr.x+qo,An=Lr.y+qo;ee.push(Wr,An,bt,0);const Yi=Wr-bt,Ur=An-bt,zr=Wr+bt,Hr=An+bt;if(tt=tt&&this.isOffscreen(Yi,Ur,zr,Hr),ct=ct||this.isInsideGrid(Yi,Ur,zr,Hr),!u&&this.grid.hitTestCircle(Wr,An,bt,z)&&(De=!0,!F))return{circles:[],offscreen:!1,collisionDetected:De,occluded:!1}}}}return{circles:!F&&De||!ct?[]:ee,offscreen:tt,collisionDetected:De,occluded:pe.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let p=1/0,v=1/0,x=-1/0,w=-1/0;for(const F of n){const V=new s.P(F.x+qo,F.y+qo);p=Math.min(p,V.x),v=Math.min(v,V.y),x=Math.max(x,V.x),w=Math.max(w,V.y),u.push(V)}const I=this.grid.query(p,v,x,w).concat(this.ignoredGrid.query(p,v,x,w)),C={},D={};for(const F of I){const V=F.key;if(C[V.bucketInstanceId]===void 0&&(C[V.bucketInstanceId]={}),C[V.bucketInstanceId][V.featureIndex])continue;const z=[new s.P(F.x1,F.y1),new s.P(F.x2,F.y1),new s.P(F.x2,F.y2),new s.P(F.x1,F.y2)];s.bW(u,z)&&(C[V.bucketInstanceId][V.featureIndex]=!0,D[V.bucketInstanceId]===void 0&&(D[V.bucketInstanceId]=[]),D[V.bucketInstanceId].push(V.featureIndex))}return D}insertCollisionBox(n,u,p,v,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:v,collisionGroupID:x},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,u,p,v,x){const w=u?this.ignoredGrid:this.grid,I={bucketInstanceId:p,featureIndex:v,collisionGroupID:x};for(let C=0;C<n.length;C+=4)w.insertCircle(I,n[C],n[C+1],n[C+2])}projectAndGetPerspectiveRatio(n,u,p,v,x,w,I){const C=[u,p,v,1];let D=!1;v||this.transform.pitch>0?(s.aC(C,C,n),this.fogState&&x&&I.name!=="globe"&&(D=function(z,j,G,H,ee,K){const ie=K.calculateFogTileMatrix(ee),ae=[j,G,H];return s.af(ae,ae,ie),Qt(z,s.ag(ae),K.pitch,K._fov)}(this.fogState,u,p,v,x.toUnwrapped(),this.transform)>.9)):Wc(C,C,n);const F=C[3];return{point:new s.P((C[0]/F+1)/2*this.transform.width+qo,(-C[1]/F+1)/2*this.transform.height+qo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/F*.5,1.5),signedDistanceFromCamera:F,occluded:w&&C[2]>F||D}}isOffscreen(n,u,p,v){return p<qo||n>=this.screenRightBoundary||v<qo||u>this.screenBottomBoundary}isInsideGrid(n,u,p,v){return p>=0&&n<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const n=s.bA([]);return s.br(n,n,[-100,-100,0]),n}}class Su{constructor(n,u,p,v){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?u:-u))):v&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Sa{constructor(n,u,p,v,x,w=!1){this.text=new Su(n?n.text:null,u,p,x),this.icon=new Su(n?n.icon:null,u,v,x),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class hi{constructor(n,u,p,v=!1){this.text=n,this.icon=u,this.skipFade=p,this.clipped=v}}class kr{constructor(){this.invProjMatrix=s.bC(),this.viewportMatrix=s.bC(),this.circles=[]}}class Gr{constructor(n,u,p,v,x){this.bucketInstanceId=n,this.featureIndex=u,this.sourceLayerIndex=p,this.bucketIndex=v,this.tileID=x}}class Lo{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const u=++this.maxGroupID;this.collisionGroups[n]={ID:u,predicate:p=>p.collisionGroupID===u}}return this.collisionGroups[n]}}function ca(m,n,u,p,v){const{horizontalAlign:x,verticalAlign:w}=s.c0(m),I=-(x-.5)*n,C=-(w-.5)*u,D=s.c1(m,p);return new s.P(I+D[0]*v,C+D[1]*v)}function Dr(m,n,u,p,v){const x=new s.P(m,n);return u&&x._rotate(p?v:-v),x}class Lh{constructor(n,u,p,v,x,w){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Ia(this.transform,x),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Lo(p),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,u,p,v,x=1){const w=p.getBucket(u),I=p.latestFeatureIndex;if(!w||!I||u.fqid!==w.layerIds[0])return;const C=w.layers[0].layout,D=w.layers[0].paint,F=p.collisionBoxArray,V=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),z=p.tileSize/s.al,j=p.tileID.toUnwrapped();this.transform.setProjection(w.projection);const G=(H=p.tileID,ee=w.getProjection(),K=this.transform,ee.name===this.projection?K.calculateProjMatrix(H.toUnwrapped()):Ch(K,ee,H));var H,ee,K;const ie=C.get("text-pitch-alignment")==="map",ae=C.get("text-rotation-alignment")==="map";u.compileFilter(u.options);const ce=u.dynamicFilter(),ve=u.dynamicFilterNeedsFeature(),_e=this.transform.calculatePixelsToTileUnitsMatrix(p),xe=pc(G,p.tileID.canonical,ie,ae,this.transform,w.getProjection(),_e);let ge=null;const pe=w.getProjection().createInversionMatrix(this.transform,p.tileID.canonical);if(ie){const De=Ph(G,p.tileID.canonical,ie,ae,this.transform,w.getProjection(),_e);ge=s.aB([],this.transform.labelPlaneMatrix,De)}let we=null;ce&&p.latestFeatureIndex&&(we={unwrappedTileID:j,dynamicFilter:ce,dynamicFilterNeedsFeature:ve}),this.retainedQueryData[w.bucketInstanceId]=new Gr(w.bucketInstanceId,I,w.sourceLayerIndex,w.index,p.tileID);const[Je,$e]=w.layers[0].layout.get("text-size-scale-range"),ot=s.aA(x,Je,$e),[Xe,nt]=C.get("icon-size-scale-range"),Dt=s.aA(x,Xe,nt),Ye={bucket:w,layout:C,paint:D,posMatrix:G,invMatrix:pe,mercatorCenter:[s.aF(this.transform.center.lng),s.aJ(this.transform.center.lat)],textLabelPlaneMatrix:xe,labelToScreenMatrix:ge,clippingData:we,scale:V,textPixelRatio:z,holdingForFade:p.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:s.bK(w.textSizeData,this.transform.zoom,ot),partiallyEvaluatedIconSize:s.bK(w.iconSizeData,this.transform.zoom,Dt),collisionGroup:this.collisionGroups.get(w.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(v)for(const De of w.sortKeyRanges){const{sortKey:ct,symbolInstanceStart:tt,symbolInstanceEnd:bt}=De;n.push({sortKey:ct,symbolInstanceStart:tt,symbolInstanceEnd:bt,parameters:Ye})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Ye})}attemptAnchorPlacement(n,u,p,v,x,w,I,C,D,F,V,z,j,G,H,ee,K,ie,ae,ce,ve){const{textOffset0:_e,textOffset1:xe,crossTileID:ge}=H,pe=[_e,xe],we=ca(n,w,I,pe,C),Je=this.collisionIndex.placeCollisionBox(K,C,u,p,v,x,Dr(we.x,we.y,D,F,this.transform.angle),G,V,z,j.predicate);if(ae){const $e=K.getSymbolInstanceIconSize(ve,this.transform.zoom,H.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(K,$e,ae,p,v,x,Dr(we.x,we.y,D,F,this.transform.angle),G,V,z,j.predicate).box.length===0)return}if(Je.box.length>0){let $e;return this.prevPlacement&&this.prevPlacement.variableOffsets[ge]&&this.prevPlacement.placements[ge]&&this.prevPlacement.placements[ge].text&&($e=this.prevPlacement.variableOffsets[ge].anchor),this.variableOffsets[ge]={textOffset:pe,width:w,height:I,anchor:n,textScale:C,prevAnchor:$e},this.markUsedJustification(K,n,H,ie),K.allowVerticalPlacement&&(this.markUsedOrientation(K,ie,H),this.placedOrientations[ge]=ie),{shift:we,placedGlyphBoxes:Je}}}placeLayerBucketPart(n,u,p,v,x=1){const{bucket:w,layout:I,paint:C,posMatrix:D,textLabelPlaneMatrix:F,labelToScreenMatrix:V,clippingData:z,textPixelRatio:j,mercatorCenter:G,invMatrix:H,holdingForFade:ee,collisionBoxArray:K,partiallyEvaluatedTextSize:ie,partiallyEvaluatedIconSize:ae,collisionGroup:ce,latestFeatureIndex:ve}=n.parameters,_e=I.get("text-optional"),xe=I.get("icon-optional"),ge=I.get("text-allow-overlap"),pe=I.get("icon-allow-overlap"),we=I.get("text-rotation-alignment")==="map",Je=I.get("icon-rotation-alignment")==="map",$e=I.get("text-pitch-alignment")==="map",ot=C.get("symbol-z-offset"),Xe=I.get("symbol-elevation-reference")==="sea",nt=I.get("symbol-placement"),[Dt,Ye]=I.get("text-size-scale-range"),[De,ct]=I.get("icon-size-scale-range"),tt=s.aA(x,Dt,Ye),bt=s.aA(x,De,ct),kt=I.get("text-variable-anchor"),$t=we&&nt!=="point",Ct=Je&&nt!=="point",It=kt&&w.hasTextData(),fi=w.hasIconTextFit()&&It&&w.hasIconData();this.transform.setProjection(w.projection);const li=It||$t,di=Ct||fi;let oi=ge&&(pe||!w.hasIconData()||xe),Vi=pe&&(ge||!w.hasTextData()||_e);const Ki=!ot.isConstant();!w.collisionArrays&&K&&w.deserializeCollisionBoxes(K),p&&v&&w.updateCollisionDebugBuffers(this.transform.zoom,K,tt,bt);const Qi=(Gi,Lr,Wr)=>{const{crossTileID:An,numVerticalGlyphVertices:Yi}=Gi;let Ur=null;if(z&&z.dynamicFilterNeedsFeature||Ki){const rs=this.retainedQueryData[w.bucketInstanceId];Ur=ve.loadFeature({featureIndex:Gi.featureIndex,bucketIndex:rs.bucketIndex,sourceLayerIndex:rs.sourceLayerIndex,layoutVertexArrayOffset:0})}if(z&&!(0,z.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Ur,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new s.P(Gi.tileAnchorX,Gi.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[An]=new hi(!1,!1,!1,!0),void u.add(An);const zr=ot.evaluate(Ur,{});if(u.has(An))return;if(ee)return void(this.placements[An]=new hi(!1,!1,!1));let Hr=!1,Dn=!1,os=!0,Ws=!1,Ln=!1,er=null,Fi={box:null,offscreen:null,occluded:null},Kr={box:null},Yn=null,zn=null,ws=null,lo=0,il=0,rl=0;Wr.textFeatureIndex?lo=Wr.textFeatureIndex:Gi.useRuntimeCollisionCircles&&(lo=Gi.featureIndex),Wr.verticalTextFeatureIndex&&(il=Wr.verticalTextFeatureIndex);const Ca=rs=>{rs.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const as=this.transform.elevation;rs.elevation=Xe?zr:zr+(as?as.getAtTileOffset(rs.tileID,rs.tileAnchorX,rs.tileAnchorY):0),rs.elevation+=Gi.zOffset},Ra=Wr.textBox;if(Ra){Ca(Ra);const rs=Nn=>{let Ls=s.bL.horizontal;if(w.allowVerticalPlacement&&!Nn&&this.prevPlacement){const Xs=this.prevPlacement.placedOrientations[An];Xs&&(this.placedOrientations[An]=Xs,Ls=Xs,this.markUsedOrientation(w,Ls,Gi))}return Ls},as=(Nn,Ls)=>{if(w.allowVerticalPlacement&&Yi>0&&Wr.verticalTextBox){for(const Xs of w.writingModes)if(Xs===s.bL.vertical?(Fi=Ls(),Kr=Fi):Fi=Nn(),Fi&&Fi.box&&Fi.box.length)break}else Fi=Nn()};if(kt){let Nn=kt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[An]){const vs=this.prevPlacement.variableOffsets[An];Nn.indexOf(vs.anchor)>0&&(Nn=Nn.filter(wo=>wo!==vs.anchor),Nn.unshift(vs.anchor))}const Ls=(vs,wo,wc)=>{const Qc=w.getSymbolInstanceTextSize(ie,Gi,this.transform.zoom,Lr),ql=(vs.x2-vs.x1)*Qc+2*vs.padding,Gu=(vs.y2-vs.y1)*Qc+2*vs.padding,Hu=Gi.hasIconTextFit&&!pe?wo:null;Hu&&Ca(Hu);let Tc={box:[],offscreen:!1,occluded:!1};const _f=ge?2*Nn.length:Nn.length;for(let eu=0;eu<_f;++eu){const Ec=this.attemptAnchorPlacement(Nn[eu%Nn.length],vs,G,H,li,ql,Gu,Qc,we,$e,j,D,ce,eu>=Nn.length,Gi,Lr,w,wc,Hu,ie,ae);if(Ec&&(Tc=Ec.placedGlyphBoxes,Tc&&Tc.box&&Tc.box.length)){Hr=!0,er=Ec.shift;break}}return Tc};as(()=>Ls(Ra,Wr.iconBox,s.bL.horizontal),()=>{const vs=Wr.verticalTextBox;return vs&&Ca(vs),w.allowVerticalPlacement&&!(Fi&&Fi.box&&Fi.box.length)&&Yi>0&&vs?Ls(vs,Wr.verticalIconBox,s.bL.vertical):{box:null,offscreen:null,occluded:null}}),Fi&&(Hr=Fi.box,os=Fi.offscreen,Ws=Fi.occluded);const Xs=rs(!(!Fi||!Fi.box));if(!Hr&&this.prevPlacement){const vs=this.prevPlacement.variableOffsets[An];vs&&(this.variableOffsets[An]=vs,this.markUsedJustification(w,vs.anchor,Gi,Xs))}}else{const Nn=(Ls,Xs)=>{const vs=w.getSymbolInstanceTextSize(ie,Gi,this.transform.zoom,Lr),wo=this.collisionIndex.placeCollisionBox(w,vs,Ls,G,H,li,new s.P(0,0),ge,j,D,ce.predicate);return wo&&wo.box&&wo.box.length&&(this.markUsedOrientation(w,Xs,Gi),this.placedOrientations[An]=Xs),wo};as(()=>Nn(Ra,s.bL.horizontal),()=>{const Ls=Wr.verticalTextBox;return w.allowVerticalPlacement&&Yi>0&&Ls?(Ca(Ls),Nn(Ls,s.bL.vertical)):{box:null,offscreen:null,occluded:null}}),rs(!!(Fi&&Fi.box&&Fi.box.length))}}if(Yn=Fi,Hr=Yn&&Yn.box&&Yn.box.length>0,os=Yn&&Yn.offscreen,Ws=Yn&&Yn.occluded,Gi.useRuntimeCollisionCircles){const rs=w.text.placedSymbolArray.get(Gi.centerJustifiedTextSymbolIndex>=0?Gi.centerJustifiedTextSymbolIndex:Gi.verticalPlacedTextSymbolIndex),as=s.bM(w.textSizeData,ie,rs),Nn=I.get("text-padding");zn=this.collisionIndex.placeCollisionCircles(w,ge,rs,w.lineVertexArray,w.glyphOffsetArray,as,D,F,V,p,$e,ce.predicate,Gi.collisionCircleDiameter*as/s.bX,Nn,this.retainedQueryData[w.bucketInstanceId].tileID),Hr=ge||zn.circles.length>0&&!zn.collisionDetected,os=os&&zn.offscreen,Ws=zn.occluded}if(Wr.iconFeatureIndex&&(rl=Wr.iconFeatureIndex),Wr.iconBox){const rs=as=>{Ca(as);const Nn=Gi.hasIconTextFit&&er?Dr(er.x,er.y,we,$e,this.transform.angle):new s.P(0,0),Ls=w.getSymbolInstanceIconSize(ae,this.transform.zoom,Gi.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Ls,as,G,H,di,Nn,pe,j,D,ce.predicate)};Kr&&Kr.box&&Kr.box.length&&Wr.verticalIconBox?(ws=rs(Wr.verticalIconBox),Dn=ws.box.length>0):(ws=rs(Wr.iconBox),Dn=ws.box.length>0),os=os&&ws.offscreen,Ln=ws.occluded}const Zo=_e||Gi.numHorizontalGlyphVertices===0&&Yi===0,El=xe||Gi.numIconVertices===0;if(Zo||El?El?Zo||(Dn=Dn&&Hr):Hr=Dn&&Hr:Dn=Hr=Dn&&Hr,Hr&&Yn&&Yn.box&&this.collisionIndex.insertCollisionBox(Yn.box,I.get("text-ignore-placement"),w.bucketInstanceId,Kr&&Kr.box&&il?il:lo,ce.ID),Dn&&ws&&this.collisionIndex.insertCollisionBox(ws.box,I.get("icon-ignore-placement"),w.bucketInstanceId,rl,ce.ID),zn&&(Hr&&this.collisionIndex.insertCollisionCircles(zn.circles,I.get("text-ignore-placement"),w.bucketInstanceId,lo,ce.ID),p)){const rs=w.bucketInstanceId;let as=this.collisionCircleArrays[rs];as===void 0&&(as=this.collisionCircleArrays[rs]=new kr);for(let Nn=0;Nn<zn.circles.length;Nn+=4)as.circles.push(zn.circles[Nn+0]),as.circles.push(zn.circles[Nn+1]),as.circles.push(zn.circles[Nn+2]),as.circles.push(zn.collisionDetected?1:0)}const Hl=w.projection.name!=="globe";oi=oi&&(Hl||!Ws),Vi=Vi&&(Hl||!Ln),this.placements[An]=new hi(Hr||oi,Dn||Vi,os||w.justReloaded),u.add(An)},Zr=this.retainedQueryData[w.bucketInstanceId].tileID;if(w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,Zr),w.elevationType==="road"&&w.updateRoadElevation(Zr.canonical),w.updateZOffset(),w.sortFeaturesByY){const Gi=w.getSortedSymbolIndexes(this.transform.angle);for(let Lr=Gi.length-1;Lr>=0;--Lr){const Wr=Gi[Lr];Qi(w.symbolInstances.get(Wr),Wr,w.collisionArrays[Wr])}w.hasAnyZOffset&&s.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const Gi=w.getSortedIndexesByZOffset();for(let Lr=0;Lr<Gi.length;++Lr){const Wr=Gi[Lr];Qi(w.symbolInstances.get(Wr),Wr,w.collisionArrays[Wr])}}else for(let Gi=n.symbolInstanceStart;Gi<n.symbolInstanceEnd;Gi++)Qi(w.symbolInstances.get(Gi),Gi,w.collisionArrays[Gi]);if(p&&w.bucketInstanceId in this.collisionCircleArrays){const Gi=this.collisionCircleArrays[w.bucketInstanceId];s.bl(Gi.invProjMatrix,D),Gi.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(n,u,p,v){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:C,crossTileID:D}=p,F=s.c2(u),V=v===s.bL.vertical?C:F==="left"?x:F==="center"?w:F==="right"?I:-1;x>=0&&(n.text.placedSymbolArray.get(x).crossTileID=V>=0&&x!==V?0:D),w>=0&&(n.text.placedSymbolArray.get(w).crossTileID=V>=0&&w!==V?0:D),I>=0&&(n.text.placedSymbolArray.get(I).crossTileID=V>=0&&I!==V?0:D),C>=0&&(n.text.placedSymbolArray.get(C).crossTileID=V>=0&&C!==V?0:D)}markUsedOrientation(n,u,p){const v=u===s.bL.horizontal||u===s.bL.horizontalOnly?u:0,x=u===s.bL.vertical?u:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:D}=p,F=n.text.placedSymbolArray;w>=0&&(F.get(w).placedOrientation=v),I>=0&&(F.get(I).placedOrientation=v),C>=0&&(F.get(C).placedOrientation=v),D>=0&&(F.get(D).placedOrientation=x)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let p=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const v=u?u.symbolFadeChange(n):1,x=u?u.opacities:{},w=u?u.variableOffsets:{},I=u?u.placedOrientations:{};for(const C in this.placements){const D=this.placements[C],F=x[C];F?(this.opacities[C]=new Sa(F,v,D.text,D.icon,null,D.clipped),p=p||D.text!==F.text.placed||D.icon!==F.icon.placed):(this.opacities[C]=new Sa(null,v,D.text,D.icon,D.skipFade,D.clipped),p=p||D.text||D.icon)}for(const C in x){const D=x[C];if(!this.opacities[C]){const F=new Sa(D,v,!1,!1);F.isHidden()||(this.opacities[C]=F,p=p||D.text.placed||D.icon.placed)}}for(const C in w)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=w[C]);for(const C in I)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=I[C]);p?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:n)}updateLayerOpacities(n,u,p,v){const x=new Set;for(const w of u){const I=w.getBucket(n);I&&w.latestFeatureIndex&&n.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,x,w,w.collisionBoxArray,p,v,w.tileID,n.scope),I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,w.tileID),I.elevationType==="road"&&I.updateRoadElevation(w.tileID.canonical),I.updateZOffset())}}updateBucketOpacities(n,u,p,v,x,w,I,C){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const D=n.layers[0].layout,F=n.layers[0].paint,V=!!n.layers[0].dynamicFilter(),z=new Sa(null,0,!1,!1,!0),j=D.get("text-allow-overlap"),G=D.get("icon-allow-overlap"),H=D.get("text-variable-anchor"),ee=D.get("text-rotation-alignment")==="map",K=D.get("text-pitch-alignment")==="map",ie=F.get("symbol-z-offset"),ae=D.get("symbol-elevation-reference")==="sea",ce=!ie.isConstant(),ve=new Sa(null,0,j&&(G||!n.hasIconData()||D.get("icon-optional")),G&&(j||!n.hasTextData()||D.get("text-optional")),!0);!n.collisionArrays&&v&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(v);const _e=(ge,pe,we)=>{for(let Je=0;Je<pe/4;Je++)ge.opacityVertexArray.emplaceBack(we)};let xe=0;w&&n.updateReplacement(I,w);for(let ge=0;ge<n.symbolInstances.length;ge++){const pe=n.symbolInstances.get(ge),{numHorizontalGlyphVertices:we,numVerticalGlyphVertices:Je,crossTileID:$e,numIconVertices:ot,tileAnchorX:Xe,tileAnchorY:nt}=pe;let Dt=null;const Ye=this.retainedQueryData[n.bucketInstanceId];ce&&pe&&Ye&&(Dt=p.latestFeatureIndex.loadFeature({featureIndex:pe.featureIndex,bucketIndex:Ye.bucketIndex,sourceLayerIndex:Ye.sourceLayerIndex,layoutVertexArrayOffset:0}));const De=ie.evaluate(Dt,{}),ct=u.has($e);let tt=this.opacities[$e];ct?tt=z:tt||(tt=ve,this.opacities[$e]=tt),u.add($e);const bt=we>0||Je>0,kt=ot>0,$t=this.placedOrientations[$e],Ct=$t===s.bL.vertical,It=$t===s.bL.horizontal||$t===s.bL.horizontalOnly;!bt&&!kt||tt.isHidden()||xe++;let fi=!1;if((bt||kt)&&w)for(const li of n.activeReplacements){if(s.bY(li,x,s.bZ.Symbol,C)||li.min.x>Xe||Xe>li.max.x||li.min.y>nt||nt>li.max.y)continue;const di=s.b_(Xe,nt,I.canonical,li.footprintTileId.canonical);if(fi=s.b$(di,li.footprint),fi)break}if(bt){const li=fi?re:Y(tt.text);_e(n.text,we,Ct?re:li),_e(n.text,Je,It?re:li);const di=tt.text.isHidden(),{leftJustifiedTextSymbolIndex:oi,centerJustifiedTextSymbolIndex:Vi,rightJustifiedTextSymbolIndex:Ki,verticalPlacedTextSymbolIndex:Qi}=pe,Zr=n.text.placedSymbolArray,Gi=di||Ct?1:0;oi>=0&&(Zr.get(oi).hidden=Gi),Vi>=0&&(Zr.get(Vi).hidden=Gi),Ki>=0&&(Zr.get(Ki).hidden=Gi),Qi>=0&&(Zr.get(Qi).hidden=di||It?1:0);const Lr=this.variableOffsets[$e];Lr&&this.markUsedJustification(n,Lr.anchor,pe,$t);const Wr=this.placedOrientations[$e];Wr&&(this.markUsedJustification(n,"left",pe,Wr),this.markUsedOrientation(n,Wr,pe))}if(kt){const li=fi?re:Y(tt.icon),{placedIconSymbolIndex:di,verticalPlacedIconSymbolIndex:oi}=pe,Vi=n.icon.placedSymbolArray,Ki=tt.icon.isHidden()?1:0;di>=0&&(_e(n.icon,ot,Ct?re:li),Vi.get(di).hidden=Ki),oi>=0&&(_e(n.icon,pe.numVerticalIconVertices,It?re:li),Vi.get(oi).hidden=Ki)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const li=n.collisionArrays[ge];if(li){let di=new s.P(0,0),oi=!0;if(li.textBox||li.verticalTextBox){if(H){const Ki=this.variableOffsets[$e];Ki?(di=ca(Ki.anchor,Ki.width,Ki.height,Ki.textOffset,Ki.textScale),ee&&di._rotate(K?this.transform.angle:-this.transform.angle)):oi=!1}V&&(oi=!tt.clipped),li.textBox&&Bl(n.textCollisionBox.collisionVertexArray,tt.text.placed,!oi||Ct,De,ae,di.x,di.y),li.verticalTextBox&&Bl(n.textCollisionBox.collisionVertexArray,tt.text.placed,!oi||It,De,ae,di.x,di.y)}const Vi=oi&&!!(!It&&li.verticalIconBox);li.iconBox&&Bl(n.iconCollisionBox.collisionVertexArray,tt.icon.placed,Vi,De,ae,pe.hasIconTextFit?di.x:0,pe.hasIconTextFit?di.y:0),li.verticalIconBox&&Bl(n.iconCollisionBox.collisionVertexArray,tt.icon.placed,!Vi,De,ae,pe.hasIconTextFit?di.x:0,pe.hasIconTextFit?di.y:0)}}}if(n.fullyClipped=xe===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const ge=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=ge.invProjMatrix,n.placementViewportMatrix=ge.viewportMatrix,n.collisionCircleArray=ge.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,u){const p=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*p>n}setStale(){this.stale=!0}}function Bl(m,n,u,p,v,x,w){m.emplaceBack(n?1:0,u?1:0,x||0,w||0,p,v?1:0),m.emplaceBack(n?1:0,u?1:0,x||0,w||0,p,v?1:0),m.emplaceBack(n?1:0,u?1:0,x||0,w||0,p,v?1:0),m.emplaceBack(n?1:0,u?1:0,x||0,w||0,p,v?1:0)}const Au=Math.pow(2,25),qs=Math.pow(2,24),_n=Math.pow(2,17),e_=Math.pow(2,16),Cu=Math.pow(2,9),_c=Math.pow(2,8),k=Math.pow(2,1);function Y(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const n=m.placed?1:0,u=Math.floor(127*m.opacity);return u*Au+n*qs+u*_n+n*e_+u*Cu+n*_c+u*k+n}const re=0;class Ae{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,u,p,v,x,w){const I=this._bucketParts;for(;this._currentTileIndex<n.length;)if(u.getBucketParts(I,v,n[this._currentTileIndex],this._sortAcrossTiles,w),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((C,D)=>C.sortKey-D.sortKey));this._currentPartIndex<I.length;){const C=I[this._currentPartIndex];if(u.placeLayerBucketPart(C,this._seenCrossTileIDs,p,C.symbolInstanceStart===0,w),this._currentPartIndex++,x())return!0}return!1}}class _t{constructor(n,u,p,v,x,w,I,C,D){this.placement=new Lh(n,x,w,I,C,D),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(n,u,p,v,x){const w=s.o.now(),I=()=>{const C=s.o.now()-w;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=u[n[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=D)&&(!C.maxzoom||C.maxzoom>D)){const F=C,V=F.layout.get("symbol-z-elevate"),z=F.layout.get("symbol-sort-key").constantOr(1)!==void 0,j=F.layout.get("symbol-z-order"),G=j==="viewport-y"||j==="auto"&&!(j!=="viewport-y"&&z),H=F.layout.get("text-allow-overlap")||F.layout.get("icon-allow-overlap")||F.layout.get("text-ignore-placement")||F.layout.get("icon-ignore-placement"),ee=G&&H,K=this._inProgressLayer=this._inProgressLayer||new Ae(F),ie=s.B(C.source,C.scope);if(K.continuePlacement(V||ee?v[ie]:p[ie],this.placement,this._showCollisionBoxes,C,I,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const zt=512/s.al/2;class _i{constructor(n,u,p){this.tileID=n,this.bucketInstanceId=p,this.index=new s.c3(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=n.canonical.x*s.al,x=n.canonical.y*s.al;for(let w=0;w<u.length;w++){const{key:I,crossTileID:C,tileAnchorX:D,tileAnchorY:F}=u.get(w),V=Math.floor((v+D)*zt),z=Math.floor((x+F)*zt);this.index.add(V,z),this.keys.push(I),this.crossTileIDs.push(C)}this.index.finish()}findMatches(n,u,p){const v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),x=zt/Math.pow(2,u.canonical.z-this.tileID.canonical.z),w=u.canonical.x*s.al,I=u.canonical.y*s.al;for(let C=0;C<n.length;C++){const D=n.get(C);if(D.crossTileID)continue;const{key:F,tileAnchorX:V,tileAnchorY:z}=D,j=Math.floor((w+V)*x),G=Math.floor((I+z)*x),H=this.index.range(j-v,G-v,j+v,G+v).sort((ee,K)=>ee-K);for(const ee of H){const K=this.crossTileIDs[ee];if(this.keys[ee]===F&&!p.has(K)){p.add(K),D.crossTileID=K;break}}}}}class is{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ks{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const u=Math.round((n-this.lng)/360);if(u!==0)for(const p in this.indexes){const v=this.indexes[p],x={};for(const w in v){const I=v[w];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+u),x[I.tileID.key]=I}this.indexes[p]=x}this.lng=n}addBucket(n,u,p){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let x=0;x<u.symbolInstances.length;x++)u.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const v=this.usedCrossTileIDs[n.overscaledZ];for(const x in this.indexes){const w=this.indexes[x];if(Number(x)>n.overscaledZ)for(const I in w){const C=w[I];C.tileID.isChildOf(n)&&C.findMatches(u.symbolInstances,n,v)}else{const I=w[n.scaledTo(Number(x)).key];I&&I.findMatches(u.symbolInstances,n,v)}}for(let x=0;x<u.symbolInstances.length;x++){const w=u.symbolInstances.get(x);w.crossTileID||(w.crossTileID=p.generate(),v.add(w.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new _i(n,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(n,u){for(const p of u.crossTileIDs)this.usedCrossTileIDs[n].delete(p)}removeStaleBuckets(n){let u=!1;for(const p in this.indexes){const v=this.indexes[p];for(const x in v)n[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,v[x]),delete v[x],u=!0)}return u}}class Er{constructor(){this.layerIndexes={},this.crossTileIDs=new is,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,u,p,v){let x=this.layerIndexes[n.fqid];x===void 0&&(x=this.layerIndexes[n.fqid]=new ks);let w=!1;const I={};v.name!=="globe"&&x.handleWrapJump(p);for(const C of u){const D=C.getBucket(n);D&&n.fqid===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(C.tileID,D,this.crossTileIDs)&&(w=!0),I[D.bucketInstanceId]=!0)}return x.removeStaleBuckets(I)&&(w=!0),w}pruneUnusedLayers(n){const u={};n.forEach(p=>{u[p]=!0});for(const p in this.layerIndexes)u[p]||delete this.layerIndexes[p]}}const qn=771;class Di{constructor(n,u,p,v){this.blendFunction=n,this.blendColor=u.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=v}}Di.Replace=[1,0,1,0],Di.disabled=new Di(Di.Replace,s.ao.transparent,[!1,!1,!1,!1]),Di.unblended=new Di(Di.Replace,s.ao.transparent,[!0,!0,!0,!0]),Di.alphaBlended=new Di([1,qn,1,qn],s.ao.transparent,[!0,!0,!0,!0]),Di.alphaBlendedNonPremultiplied=new Di([770,qn,770,qn],s.ao.transparent,[!0,!0,!0,!0]),Di.multiply=new Di([774,0,774,0],s.ao.transparent,[!0,!0,!0,!0]);class Gt{constructor(n,u,p){this.func=n,this.mask=u,this.range=p}}Gt.ReadOnly=!1,Gt.ReadWrite=!0,Gt.disabled=new Gt(519,Gt.ReadOnly,[0,1]);const Oo=7680;class Pi{constructor(n,u,p,v,x,w){this.test=n,this.ref=u,this.mask=p,this.fail=v,this.depthFail=x,this.pass=w}}Pi.disabled=new Pi({func:519,mask:0},0,0,Oo,Oo,Oo);const Vl=1029,Gd=2305;class Bi{constructor(n,u,p){this.enable=n,this.mode=u,this.frontFace=p}}function K0(m,n){const u=s.c9(m,3);s.cb(m,n),s.cf(m,3,u)}function gp(m,n){const u=s.c6([]);return s.c7(u,u,-n),s.c8(u,u,-m),u}function yp(m,n){const u=[m[0],m[1],0],p=[n[0],n[1],0];if(s.ag(u)>=1e-15){const w=s.aw([],u);s.c4(p,w,s.bJ(p,w)),n[0]=p[0],n[1]=p[1]}const v=s.bI([],n,m);if(s.c5(v)<1e-15)return null;const x=Math.atan2(-v[1],v[0]);return gp(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),x)}Bi.disabled=new Bi(!1,Vl,Gd),Bi.backCCW=new Bi(!0,Vl,Gd),Bi.backCW=new Bi(!0,Vl,2304),Bi.frontCW=new Bi(!0,1028,2304),Bi.frontCCW=new Bi(!0,1028,Gd);class Y0{constructor(n,u){this.position=n,this.orientation=u}get position(){return this._position}set position(n){if(n){const u=n instanceof s.ae?n:new s.ae(n[0],n[1],n[2]);this._renderWorldCopies&&(u.x=s.bT(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(n,u){if(this.orientation=null,!this.position)return;const p=this.position,v=this._elevation?this._elevation.getAtPointOrZero(s.ae.fromLngLat(n)):0,x=s.ae.fromLngLat(n,v),w=[x.x-p.x,x.y-p.y,x.z-p.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=yp(w,u)}setPitchBearing(n,u){this.orientation=gp(s.an(n),s.an(-u))}}class t_{constructor(n,u){this._transform=s.bA([]),this.orientation=u,this.position=n}get mercatorPosition(){const n=this.position;return new s.ae(n[0],n[1],n[2])}get position(){const n=s.c9(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var u;n&&s.cf(this._transform,3,[(u=n)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||s.c6([]),n&&K0(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,u){this._orientation=gp(n,u),K0(this._transform,this._orientation)}forward(){const n=s.c9(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=s.c9(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=s.c9(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,u){const p=new Float64Array(16);return s.bl(p,this.getWorldToCamera(n,u)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,u,p){const v=this.position;s.c4(v,v,-n);const x=new Float64Array(16);return s.bq(x,[p,p,p]),s.br(x,x,v),x[10]*=u,x}getWorldToCamera(n,u){const p=new Float64Array(16),v=new Float64Array(4),x=this.position;return s.ca(v,this._orientation),s.c4(x,x,-n),s.cb(p,v),s.br(p,p,x),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=u,p[9]*=u,p[10]*=u,p[11]*=u,p}getCameraToClipPerspective(n,u,p,v){const x=new Float64Array(16);return s.cc(x,n,u,p,v),x}getCameraToClipOrthographic(n,u,p,v,x,w){const I=new Float64Array(16);return s.cd(I,n,u,p,v,x,w),I}getDistanceToElevation(n,u=!1){const p=n===0?0:s.ce(n,u?s.a$(this.position[1]):this.position[1]),v=this.forward();return(p-this.position[2])/v[2]}clone(){return new t_([...this.position],[...this.orientation])}}const bs={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class J0{constructor(n=0,u=0,p=0,v=0){if(isNaN(n)||n<0||isNaN(u)||u<0||isNaN(p)||p<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=u,this.left=p,this.right=v}interpolate(n,u,p){return u.top!=null&&n.top!=null&&(this.top=s.ak(n.top,u.top,p)),u.bottom!=null&&n.bottom!=null&&(this.bottom=s.ak(n.bottom,u.bottom,p)),u.left!=null&&n.left!=null&&(this.left=s.ak(n.left,u.left,p)),u.right!=null&&n.right!=null&&(this.right=s.ak(n.right,u.right,p)),this}getCenter(n,u){const p=s.aA((this.left+n-this.right)/2,0,n),v=s.aA((this.top+u-this.bottom)/2,0,u);return new s.P(p,v)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new J0(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Xc=15;class Wo{constructor(n,u,p,v,x,w,I){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=n||0,this._maxZoom=u||22,this._minPitch=p??0,this._maxPitch=v??60,this.setProjection(w),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new s.aR(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new J0,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new t_,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const n=new Wo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n._allowWorldUnderZoom=this._allowWorldUnderZoom,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Xc}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,u=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(n||p)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return s.aH(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=s.cl(this.projectionOptions);const p=this.getProjection(),v=!s.by(u,p);return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.cl({name:"mercator"});const u=n!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bT(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const u=-n*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=s.cm(),s.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const u=s.aA(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=s.an(n),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const u=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,u=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!u||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;u||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const n=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(n)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let v=0,x=0;for(let w=0;w<u.length;w++){const I=new s.P(u[w][0]*this.width,p+u[w][1]*(this.height-p)),C=n.pointCoordinate(I);if(!C)continue;const D=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);v+=C[3]*D,x+=D}return x===0?NaN:v/x}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*u,v=this._mercatorZfromZoom(n),x=this._mercatorZfromZoom(this._maxZoom),w=Math.max(v-p,x);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let p;p=n.z<this._camera.position[2]?[u.x,u.y,u.z]:[n.x,n.y,n.z];const v=s.ag(s.av([],this._camera.position,p));return s.aA(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let u=!1;if(n.orientation&&!s.co(n.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(n.orientation)),n.position){const p=[n.position.x,n.position.y,n.position.z];s.cp(p,this._camera.position)||(this._setCameraPosition(p),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,u=new Y0;return u.position=new s.ae(n[0],n[1],n[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(n){if(!s.cq(n))return!1;s.cr(n,n);const u=s.cs([],[0,0,-1],n),p=s.cs([],[0,-1,0],n);if(p[2]<0)return!1;const v=yp(u,p);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(n){const u=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;n[2]=s.aA(n[2],v/p,v/u),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,u,p){this._unmodified=!1,this._edgeInsets.interpolate(n,u,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const u=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(n){const u=[new s.ct(0,n)];if(this.renderWorldCopies){const p=this.pointCoordinate(new s.P(0,0)),v=this.pointCoordinate(new s.P(this.width,0)),x=this.pointCoordinate(new s.P(this.width,this.height)),w=this.pointCoordinate(new s.P(0,this.height)),I=Math.floor(Math.min(p.x,v.x,x.x,w.x)),C=Math.floor(Math.max(p.x,v.x,x.x,w.x)),D=1;for(let F=I-D;F<=C+D;F++)F!==0&&u.push(new s.ct(F,n))}return u}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,u,p){let v=[];const x=p!=null,w=!x;if(w&&this.zoom<u||x&&p[0]===0&&p[1]===0)return v;const I=new Set,C=(F,V,z,j,G)=>{const H=s.cX(V,F,z,j,G);I.has(H)||(v.push(new s.aO(F,V,z,j,G)),I.add(H))};for(let F=0;F<n.length;F++){const V=n[F];if(w&&V.canonical.z!==u)continue;const z=V.canonical,j=V.overscaledZ,G=V.wrap,H=1<<z.z,ee=z.x+1<H,K=z.x>0,ie=z.y+1<H,ae=z.y>0,ce=V.wrap-(K?0:1),ve=V.wrap+(ee?0:1),_e=K?z.x-1:H-1,xe=ee?z.x+1:0;if(x)p[0]<0?(C(j,ve,z.z,xe,z.y),p[1]<0&&ie&&(C(j,G,z.z,z.x,z.y+1),C(j,ve,z.z,xe,z.y+1)),p[1]>0&&ae&&(C(j,G,z.z,z.x,z.y-1),C(j,ve,z.z,xe,z.y-1))):p[0]>0?(C(j,ce,z.z,_e,z.y),p[1]<0&&ie&&(C(j,G,z.z,z.x,z.y+1),C(j,ce,z.z,_e,z.y+1)),p[1]>0&&ae&&(C(j,G,z.z,z.x,z.y-1),C(j,ce,z.z,_e,z.y-1))):p[1]<0&&ie?C(j,G,z.z,z.x,z.y+1):ae&&C(j,G,z.z,z.x,z.y-1);else{const ge=V.visibleQuadrants;1&ge&&(C(j,ce,z.z,_e,z.y),ae&&(C(j,G,z.z,z.x,z.y-1),C(j,ce,z.z,_e,z.y-1))),2&ge&&(C(j,ve,z.z,xe,z.y),ae&&(C(j,G,z.z,z.x,z.y-1),C(j,ve,z.z,xe,z.y-1))),4&ge&&(C(j,ce,z.z,_e,z.y),ie&&(C(j,G,z.z,z.x,z.y+1),C(j,ce,z.z,_e,z.y+1))),8&ge&&(C(j,ve,z.z,xe,z.y),ie&&(C(j,G,z.z,z.x,z.y+1),C(j,ve,z.z,xe,z.y+1)))}}const D=[];for(const F of v)v.some(V=>F.isChildOf(V))||D.push(F);if(v=D.filter(F=>!n.some(V=>!!(F.overscaledZ<u&&V.isChildOf(F))||F.equals(V)||F.isChildOf(V))),w){const F=1<<u,V=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),z=[F*V.x,F*V.y],j=4,G=j*j;v=v.filter(H=>{const ee=H.canonical.x+.5-z[0],K=H.canonical.y+.5-z[1];return ee*ee+K*K<G})}return v}extendTileCoverToNearPlane(n,u,p){const v=[],x=new Set;for(const ie of n)x.add(ie.key);const w=(ie,ae,ce,ve,_e)=>{const xe=s.cX(ae,ie,ce,ve,_e);x.has(xe)||(v.push(new s.aO(ie,ae,ce,ve,_e)),x.add(xe))},I=n.reduce((ie,ae)=>Math.max(ie,ae.overscaledZ),p),C=1<<p,D=[new s.P(0,0),new s.P(s.al,0),new s.P(s.al,s.al),new s.P(0,s.al)],F=new s.P(0,0),V=new s.P(0,0),z=(ie,ae)=>{const ce=Math.floor(ie[0]),ve=Math.floor(ie[1]),_e=(ie[0]-ce)*s.al,xe=(ie[1]-ve)*s.al,ge=Math.floor(ae[0]),pe=Math.floor(ae[1]),we=(ae[0]-ge)*s.al,Je=(ae[1]-pe)*s.al;for(let $e=-1;$e<=1;$e++){const ot=ce+$e;if(!(ot<0||ot>=C)){F.x=_e-$e*s.al,V.x=we-(ot-ge)*s.al;for(let Xe=-1;Xe<=1;Xe++){const nt=ve+Xe;F.y=xe-Xe*s.al,V.y=Je-(nt-pe)*s.al,s.cY(F,V,D)&&w(I,0,p,ot,nt)}}}},j=u.points,G=j[s.cu],H=j[s.cv],ee=this._projectToGround(G,j[s.cw]),K=this._projectToGround(H,j[s.cx]);return z(G,ee),z(H,K),v}_projectToGround(n,u){return s.cy(s.cz(),n,u,n[2]/(n[2]-u[2]))}coveringTiles(n){let u=this.coveringZoomLevel(n);const p=u,v=this.elevation&&this.elevation.exaggeration(),x=v&&!n.isTerrainDEM,w=this.projection.name==="mercator";if(n.minzoom!==void 0&&u<n.minzoom)return[];n.maxzoom!==void 0&&u>n.maxzoom&&(u=n.maxzoom);const I=this.locationCoordinate(this.center),C=this.center.lat,D=1<<u,F=[D*I.x,D*I.y,0],V=this.projection.name==="globe",z=!V,j=s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,z),G=V?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),H=D*s.ce(1,this.center.lat),ee=this._camera.position[2]/s.ce(1,this.center.lat),K=[D*G.x,D*G.y,ee*(z?1:H)],ie=V||v,ae=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),ce=this.isLODDisabled(!0)?u:0;let ve;if(this._elevation&&n.isTerrainDEM)ve=1e4*this._elevation.exaggeration();else if(this._elevation){const De=this._elevation.getMinMaxForVisibleTiles();ve=De?De.max:this._centerAltitude}else ve=this._centerAltitude;const _e=n.isTerrainDEM?-ve:this._elevation?this._elevation.getMinElevationBelowMSL():0,xe=this.projection.isReprojectedInTileSpace?s.cB(this):1,ge=De=>{const tt=new s.ae(De.x+25e-6,De.y,De.z),bt=new s.ae(De.x,De.y+25e-6,De.z),kt=De.toLngLat(),$t=tt.toLngLat(),Ct=bt.toLngLat(),It=this.locationCoordinate(kt),fi=this.locationCoordinate($t),li=this.locationCoordinate(Ct),di=Math.hypot(fi.x-It.x,fi.y-It.y),oi=Math.hypot(li.x-It.x,li.y-It.y);return Math.sqrt(di*oi)*xe/25e-6},pe=De=>{const ct=ve,tt=_e;return{aabb:s.cE(this,D,0,0,0,De,tt,ct,this.projection),zoom:0,x:0,y:0,minZ:tt,maxZ:ct,wrap:De,fullyVisible:!1}},we=[];let Je=[];const $e=u,ot=n.reparseOverscaled?p:u,Xe=(ee-this._centerAltitude)*H,nt=De=>{if(!this._elevation||!De.tileID||!w)return;const ct=this._elevation.getMinMaxForTile(De.tileID),tt=De.aabb;ct?(tt.min[2]=ct.min,tt.max[2]=ct.max,tt.center[2]=(tt.min[2]+tt.max[2])/2):(De.shouldSplit=Ye(De),De.shouldSplit||(tt.min[2]=tt.max[2]=tt.center[2]=this._centerAltitude))},Dt=(De,ct)=>{if(.707*ct<De)return 1;const tt=ct/De;return tt/(1.4144271570014144+(Math.pow(1.1,tt-1.4144271570014144+1)-1)/(1.1-1)-1)},Ye=De=>{if(De.zoom<ce)return!0;if(De.zoom===$e)return!1;if(De.shouldSplit!=null)return De.shouldSplit;const ct=De.aabb.distanceX(K),tt=De.aabb.distanceY(K);let bt=Xe,kt=1;if(V){bt=De.aabb.distanceZ(K);const oi=Math.pow(2,De.zoom),Vi=s.a$((De.y+1)/oi),Ki=s.a$(De.y/oi),Qi=Math.min(Math.max(C,Vi),Ki),Zr=s.d0(Qi)/s.d0(C);if(kt=Qi===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Zr/this._mercatorScaleRatio),this.zoom<=s.cZ&&De.zoom===$e-1&&Zr>=.9)return!0}else if(x&&(bt=De.aabb.distanceZ(K)*H),this.projection.isReprojectedInTileSpace&&p<=5){const oi=Math.pow(2,De.zoom),Vi=ge(new s.ae((De.x+.5)/oi,(De.y+.5)/oi));kt=Vi>.85?1:Vi}if(!w){const oi=Math.sqrt(ct*ct+tt*tt+bt*bt);let Vi=(1<<$e-De.zoom)*ae*kt;return Vi*=Dt(Math.max(bt,Xe),oi),oi<Vi}let $t=Number.MAX_VALUE,Ct=0;const It=De.aabb.getCorners(),fi=[];for(const oi of It){s.av(fi,oi,K),V||(x?fi[2]*=H:fi[2]=Xe);const Vi=s.bJ(fi,this._camera.forward());Vi<$t&&($t=Vi,Ct=Math.abs(fi[2]))}let li=(1<<$e-De.zoom)*ae*kt;if(li*=Dt(Math.max(Ct,Xe),$t),$t<li)return!0;const di=De.aabb.closestPoint(F);return di[0]===F[0]&&di[1]===F[1]};if(this.renderWorldCopies)for(let De=1;De<=3;De++)we.push(pe(-De)),we.push(pe(De));for(we.push(pe(0));we.length>0;){const De=we.pop(),ct=De.x,tt=De.y;let bt=De.fullyVisible;const kt=()=>this.projection.name==="globe"&&(De.y===0||De.y===(1<<De.zoom)-1);if(!bt){let $t=ie?De.aabb.intersects(j):De.aabb.intersectsFlat(j);if($t===0&&kt()){const Ct=new s.cC(De.zoom,ct,tt);$t=s.cD(this,D,Ct,!0).intersects(j)}if($t===0)continue;bt=$t===2}if(De.zoom!==$e&&Ye(De))for(let $t=0;$t<4;$t++){const Ct=(ct<<1)+$t%2,It=(tt<<1)+($t>>1),fi={aabb:w?De.aabb.quadrant($t):s.cE(this,D,De.zoom+1,Ct,It,De.wrap,De.minZ,De.maxZ,this.projection),zoom:De.zoom+1,x:Ct,y:It,wrap:De.wrap,fullyVisible:bt,tileID:void 0,shouldSplit:void 0,minZ:De.minZ,maxZ:De.maxZ};x&&!V&&(fi.tileID=new s.aO(De.zoom+1===$e?ot:De.zoom+1,De.wrap,De.zoom+1,Ct,It),nt(fi)),we.push(fi)}else{const $t=De.zoom===$e?ot:De.zoom;if(n.minzoom&&n.minzoom>$t)continue;let Ct=0;if(!bt){let di=ie?De.aabb.intersectsPrecise(j):De.aabb.intersectsPreciseFlat(j);if(di===0&&kt()){const oi=new s.cC(De.zoom,ct,tt);di=s.cD(this,D,oi,!0).intersectsPrecise(j)}if(di===0)continue;if(n.calculateQuadrantVisibility)if(j.containsPoint(De.aabb.center))Ct=15;else for(let oi=0;oi<4;oi++)De.aabb.quadrant(oi).intersects(j)!==0&&(Ct|=1<<oi)}const It=F[0]-(.5+ct+(De.wrap<<De.zoom))*(1<<u-De.zoom),fi=F[1]-.5-tt,li=De.tileID?De.tileID:new s.aO($t,De.wrap,De.zoom,ct,tt);n.calculateQuadrantVisibility&&(li.visibleQuadrants=Ct),Je.push({tileID:li,distanceSq:It*It+fi*fi})}}if(this.fogCullDistSq){const De=this.fogCullDistSq,ct=this.horizonLineFromTop();Je=Je.filter(tt=>{const bt=[0,0,0,1],kt=[s.al,s.al,0,1],$t=this.calculateFogTileMatrix(tt.tileID.toUnwrapped());s.aC(bt,bt,$t),s.aC(kt,kt,$t);const Ct=s.cF([],bt,kt),It=s.cG([],bt,kt),fi=s.c_(Ct,It);if(fi===0)return!0;let li=!1;const di=this._elevation;if(di&&fi>De&&ct!==0){const oi=this.calculateProjMatrix(tt.tileID.toUnwrapped());let Vi;n.isTerrainDEM||(Vi=di.getMinMaxForTile(tt.tileID)),Vi||(Vi={min:_e,max:ve});const Ki=s.cH(this.rotation),Qi=[Ki[0]*s.al,Ki[1]*s.al,Vi.max];s.af(Qi,Qi,oi),li=(1-Qi[1])*this.height*.5<ct}return fi<De||li})}return Je.sort((De,ct)=>De.distanceSq-ct.distanceSq).map(De=>De.tileID)}resize(n,u){this.width=n,this.height=u,this.pixelsToGLUnits=[2/n,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log2(n)}project(n){const u=s.aA(n.lat,-s.cI,s.cI),p=this.projection.project(n.lng,u);return new s.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,u){let p,v;const x=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;p=(u.x-x.x)/I,v=(u.y-x.y)/I}else{const I=this.pointCoordinate(u),C=this.pointCoordinate(x);p=I.x-C.x,v=I.y-C.y}const w=this.locationCoordinate(n);this.setLocation(new s.ae(w.x-p,w.y-v))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n,u){return this.projection.locationPoint(this,n,u)}locationPoint3D(n,u){return this.projection.locationPoint(this,n,u,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n,u){return this.coordinateLocation(this.pointCoordinate3D(n,u))}locationCoordinate(n,u){const p=u?s.ce(u,n.lat):void 0,v=this.projection.project(n.lng,n.lat);return new s.ae(v.x,v.y,p)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,u){const p=u??this._centerAltitude,v=[n.x,n.y,0,1],x=[n.x,n.y,1,1];s.aC(v,v,this.pixelMatrixInverse),s.aC(x,x,this.pixelMatrixInverse);const w=x[3];s.cJ(v,v,1/v[3]),s.cJ(x,x,1/w);const I=v[2],C=x[2];return{p0:v,p1:x,t:I===C?0:(p-I)/(C-I)}}screenPointToMercatorRay(n){const u=[n.x,n.y,0,1],p=[n.x,n.y,1,1];return s.aC(u,u,this.pixelMatrixInverse),s.aC(p,p,this.pixelMatrixInverse),s.cJ(u,u,1/u[3]),s.cJ(p,p,1/p[3]),u[2]=s.ce(u[2],this._center.lat)*this.worldSize,p[2]=s.ce(p[2],this._center.lat)*this.worldSize,s.cJ(u,u,1/this.worldSize),s.cJ(p,p,1/this.worldSize),new s.ax([u[0],u[1],u[2]],s.aw([],s.av([],p,u)))}rayIntersectionCoordinate(n){const{p0:u,p1:p,t:v}=n,x=s.ce(u[2],this._center.lat),w=s.ce(p[2],this._center.lat);return new s.ae(s.ak(u[0],p[0],v)/this.worldSize,s.ak(u[1],p[1],v)/this.worldSize,s.ak(x,w,v))}pointCoordinate(n,u=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,u)}pointCoordinate3D(n,u){if(!this.elevation)return this.pointCoordinate(n,u);let p=this.projection.pointCoordinate3D(this,n.x,n.y);if(p)return new s.ae(p[0],p[1],p[2]);let v=0,x=this.horizonLineFromTop();if(n.y>x)return this.pointCoordinate(n,u);const w=.02*x,I=n.clone();for(let C=0;C<10&&x-v>w;C++){I.y=s.ak(v,x,.66);const D=this.projection.pointCoordinate3D(this,I.x,I.y);D?(x=I.y,p=D):v=I.y}return p?new s.ae(p[0],p[1],p[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=s.cK)return!this.isPointAboveHorizon(n);const u=this.pointCoordinate(n);return u.y>=0&&u.y<=1}_coordinatePoint(n,u){const p=u&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,v=[n.x*this.worldSize,n.y*this.worldSize,p+n.toAltitude(),1];return s.aC(v,v,this.pixelMatrix),v[3]>0?new s.P(v[0]/v[3],v[1]/v[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:u}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,x=this.pointLocation3D(new s.P(u,n)),w=this.pointLocation3D(new s.P(v,n)),I=this.pointLocation3D(new s.P(v,p)),C=this.pointLocation3D(new s.P(u,p));let D=Math.min(x.lng,w.lng,I.lng,C.lng),F=Math.max(x.lng,w.lng,I.lng,C.lng),V=Math.min(x.lat,w.lat,I.lat,C.lat),z=Math.max(x.lat,w.lat,I.lat,C.lat);const j=Math.pow(2,-this.zoom)/16*270,G=this.projection.name==="globe"?1:4,H=(ee,K,ie,ae,ce)=>{const ve=(ee+ie)/2,_e=(K+ae)/2,xe=new s.P(ve,_e),{lng:ge,lat:pe}=this.pointLocation3D(xe),we=Math.max(0,D-ge,V-pe,ge-F,pe-z);D=Math.min(D,ge),F=Math.max(F,ge),V=Math.min(V,pe),z=Math.max(z,pe),(ce<G||we>j)&&(H(ee,K,ve,_e,ce+1),H(ve,_e,ie,ae,ce+1))};if(H(u,n,v,n,1),H(v,n,v,p,1),H(v,p,u,p,1),H(u,p,u,n,1),this.projection.name==="globe"){const[ee,K]=s.cL(this);ee?(z=90,F=180,D=-180):K&&(V=-90,F=180,D=-180)}return new s.aI(new s.aR(D,V),new s.aR(F,z))}_getBoundsRectangular(n,u){const{top:p,left:v}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,I=new s.P(v,p),C=new s.P(w,p),D=new s.P(w,x),F=new s.P(v,x);let V=this.pointCoordinate(I,n),z=this.pointCoordinate(C,n);const j=this.pointCoordinate(D,u),G=this.pointCoordinate(F,u),H=(ee,K)=>(K.y-ee.y)/(K.x-ee.x);return V.y>1&&z.y>=0?V=new s.ae((1-G.y)/H(G,V)+G.x,1):V.y<0&&z.y<=1&&(V=new s.ae(-G.y/H(G,V)+G.x,0)),z.y>1&&V.y>=0?z=new s.ae((1-j.y)/H(j,z)+j.x,1):z.y<0&&V.y<=1&&(z=new s.ae(-j.y/H(j,z)+j.x,0)),new s.aI().extend(this.coordinateLocation(V)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(j))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const u=n.visibleDemTiles.reduce((p,v)=>{if(v.dem){const x=v.dem.tree;p.min=Math.min(p.min,x.minimums[0]),p.max=Math.max(p.max,x.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*n.exaggeration(),u.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-u*(1-this._horizonShift);return n?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-s.cI,this.maxLat=s.cI,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aF(this.minLng)*this.tileSize,this.worldMaxX=s.aF(this.maxLng)*this.tileSize,this.worldMinY=s.aJ(this.maxLat)*this.tileSize,this.worldMaxY=s.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,u){return this.projection.createTileMatrix(this,u,n)}calculateDistanceTileData(n){const u=n.key,p=this._distanceTileDataCache;if(p[u])return p[u];const v=n.canonical,x=1/this.height,w=this.cameraWorldSize,I=w/this.zoomScale(v.z),C=(v.x+Math.pow(2,v.z)*n.wrap)*I,D=v.y*I,F=this.point;F.x*=w/this.worldSize,F.y*=w/this.worldSize;const V=this.angle,z=Math.sin(-V),j=-Math.cos(-V);return p[u]={bearing:[z,j],center:[(F.x-C)*x,(F.y-D)*x],scale:I/s.al*x},p[u]}calculateFogTileMatrix(n){const u=n.key,p=this._fogTileMatrixCache;if(p[u])return p[u];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return s.aB(v,this.worldToFogMatrix,v),p[u]=new Float32Array(v),p[u]}calculateProjMatrix(n,u=!1,p=!1){const v=n.key;let x;if(x=p?this._expandedProjMatrixCache:u?this._alignedProjMatrixCache:this._projMatrixCache,x[v])return x[v];const w=this.calculatePosMatrix(n,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:u?this.alignedProjMatrix:this.projMatrix,s.aB(w,I,w),x[v]=new Float32Array(w),x[v]}calculatePixelsToTileUnitsMatrix(n){const u=n.tileID.key,p=this._pixelsToTileUnitsCache;if(p[u])return p[u];const v=s.cM(n,this);return p[u]=v,p[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,u=s.bq([],[n,n,n]);return s.aB(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const u=s.ce(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(u),v=this._camera.forward(),x=s.ce(1,this._center.lat);p[2]/=x,v[2]/=x,s.aw(v,v);const w=n.raycast(p,v,n.exaggeration());if(w){const I=s.bH([],p,v,w),C=new s.ae(I[0],I[1],s.ce(I[2],s.a$(I[1]))),D=(C.z+s.ag([C.x-p[0],C.y-p[1],C.z-p[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const u=this._elevation,p=s.ce(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(p),x=u.getAtPointOrZero(new s.ae(...v)),w=this.pixelsPerMeter/this.worldSize*x,I=this._minimumHeightOverTerrain(),C=v[2]-w;if(C<=I)if(C<0||n){const D=this.locationCoordinate(this._center,this._centerAltitude),F=[v[0],v[1],D.z-v[2]],V=s.ag(F);F[2]-=(I-C)/this._pixelsPerMercatorPixel;const z=s.ag(F);if(z===0)return;s.c4(F,F,V/z*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],D.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const z=this.center;return z.lat=s.aA(z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(z.lng=s.aA(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}const u=this._unmodified,{x:p,y:v}=this.point;let x=0,w=p,I=v;const C=this.width/2,D=this.height/2,F=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(v-D<F&&(I=F+D),v+D>V&&(I=V-D),V-F<this.height&&(x=Math.max(x,this.height/(V-F)),I=(V+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const z=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,G=this.worldSize/2-(z+j)/2;w=(p+G+this.worldSize)%this.worldSize-G,w-C<z&&(w=z+C),w+C>j&&(w=j-C),j-z<this.width&&(x=Math.max(x,this.width/(j-z)),w=(j+z)/2)}w===p&&I===v||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(w,I))),x&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,u=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.ce(1,this.center.lat)/s.ce(1,s.d1));const v=s.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?p:1,w=this._camera.getWorldToCamera(this.worldSize,x);let I;const C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(C[8]=2*-n.x/this.width,C[9]=2*n.y/this.height,this.isOrthographic){let pe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),we=pe*this.aspect,Je=-we,$e=-pe;we-=n.x,Je-=n.x,pe+=n.y,$e+=n.y,I=this._camera.getCameraToClipOrthographic(Je,we,$e,pe,this._nearZ,this._farZ),((ot,Xe,nt,Dt)=>{for(let Ye=0;Ye<16;Ye++)ot[Ye]=s.ak(Xe[Ye],nt[Ye],Dt)})(I,I,C,s.c$(this.pitch>=Xc?1:this.pitch/Xc))}else I=C;const D=s.cO([],C,w);let F=s.cO([],I,w);if(this.projection.isReprojectedInTileSpace){const pe=this.locationCoordinate(this.center),we=s.bA([]);s.br(we,we,[pe.x*this.worldSize,pe.y*this.worldSize,0]),s.aB(we,we,s.cP(this)),s.br(we,we,[-pe.x*this.worldSize,-pe.y*this.worldSize,0]),s.aB(F,F,we),s.aB(D,D,we),this.inverseAdjustmentMatrix=s.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cR([],F,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=F,this.invProjMatrix=s.bl(new Float64Array(16),this.projMatrix),u){const pe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);pe[8]=2*-n.x/this.width,pe[9]=2*n.y/this.height,this.expandedFarZProjMatrix=s.cO([],pe,w)}else this.expandedFarZProjMatrix=this.projMatrix;const V=s.bl([],I);this.frustumCorners=s.cS.fromInvProjectionMatrix(V,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!u);const z=new Float32Array(16);s.bA(z),s.cR(z,z,[1,-1,1]),s.cT(z,z,this._pitch),s.bB(z,z,this.angle);const j=s.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bz(j);const G=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-n.x/this.width,j[9]=2*(n.y+G)/this.height,this.skyboxMatrix=s.aB(z,j,z);const H=this.point,ee=H.x,K=H.y,ie=this.width%2/2,ae=this.height%2/2,ce=Math.cos(this.angle),ve=Math.sin(this.angle),_e=ee-Math.round(ee)+ce*ie+ve*ae,xe=K-Math.round(K)+ce*ae+ve*ie,ge=new Float64Array(F);if(s.br(ge,ge,[_e>.5?_e-1:_e,xe>.5?xe-1:xe,0]),this.alignedProjMatrix=ge,F=s.bC(),s.cR(F,F,[this.width/2,-this.height/2,1]),s.br(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=s.bC(),s.cR(F,F,[1,-1,1]),s.br(F,F,[-1,-1,0]),s.cR(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=s.aB(new Float64Array(16),this.labelPlaneMatrix,D),this._calcFogMatrices(),this._distanceTileDataCache={},F=s.bl(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cU(this);const pe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.af(pe,pe,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,p=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,x=[n,n,u];s.c4(x,x,v),s.c4(p,p,-1),s.cV(p,p,x);const w=s.bC();s.br(w,w,p),s.cR(w,w,x),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,u,v)}_computeCameraPosition(n){const u=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),v=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-n/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-p[0]*x,v.y/this.worldSize-p[1]*x,n/this.worldSize*this._centerAltitude-p[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],v=n[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(x=Math.min((u-p)/v,1)),this._camera.position=s.bH([],this._camera.position,n,x),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,u=this._camera.forward(),{pitch:p,bearing:v}=this._camera.getPitchBearing(),x=s.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.an(this._maxPitch)),I=Math.max((n[2]-x)/Math.cos(p),w),C=this._zoomFromMercatorZ(I);s.bH(n,n,u,I),this._pitch=s.aA(p,s.an(this.minPitch),s.an(this.maxPitch)),this.angle=s.bT(v,-Math.PI,Math.PI),this._setZoom(s.aA(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ae(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,n)*this.tileSize))}zoomFromMercatorZAdjusted(n){let u=0,p=s.cK,v=0,x=1/0;for(;p-u>1e-6&&p>u;){const w=u+.5*(p-u),I=this.tileSize*Math.pow(2,w),C=this.getCameraToCenterDistance(this.projection,w,I),D=this.scaleZoom(C/(Math.max(0,n)*this.tileSize)),F=Math.abs(w-D);F<x&&(x=F,v=w),w<D?u=w:p=w}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,u){const p=Math.min(n.x,u.x),v=Math.max(n.x,u.x),x=Math.min(n.y,u.y),w=Math.max(n.y,u.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new s.P(p,x),new s.P(v,w),new s.P(p,w),new s.P(v,x)],C=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const F of I){const V=this.pointRayIntersection(F);if(V.t<0)return!0;const z=this.rayIntersectionCoordinate(V);if(z.x<C||z.y<0||z.x>D||z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(n,u){const p=s.ag(s.av([],this._camera.position,n)),v=this._zoomFromMercatorZ(p)+u;return p-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([u,p,v],x){const w=[u,p,v,1];s.aC(w,w,x);const I=w[3]=Math.max(w[3],1e-6);return w[0]/=I,w[1]/=I,w[2]/=I,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,n))}}getCameraToCenterDistance(n,u=this.zoom,p=this.worldSize){const v=s.cN(n,u,this.width,this.height,1024),x=n.pixelSpaceConversion(this.center.lat,p,v);let w=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(w=s.ak(1,w,s.c$(this.pitch>=Xc?1:this.pitch/Xc))),w}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.aB(n,n,this.globeMatrix),n}getFrustum(n){return s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const Ru=(m,n)=>{if(n>0&&m.terrain&&s.w("Cutoff is currently disabled on terrain"),n<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const u=m.transform,p=Math.max(Math.abs(u._zoom-(m.minCutoffZoom-1)),1),v=u.isLODDisabled(!1)?s.ah(60,45,u.pitch):s.ah(30,15,u.pitch),x=u._farZ-u._nearZ,w=n*u.height,I=((1-(C=v))*u.cameraToCenterDistance+C*(u._farZ+w))*p;var C;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[u._nearZ,u._farZ,(I-u._nearZ)/x,(I-w-u._nearZ)/x]}}},po={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class qx{constructor(n,u){this.aabb=n,this.lastCascade=u}}class vp{add(n,u){const p=this.receivers[n.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],u.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],u.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],u.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],u.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],u.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],u.max[2])):this.receivers[n.key]=new qx(u,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,u,p){const v=s.d8.fromPoints(n.points);let x=0;for(const w in this.receivers){const I=this.receivers[w];if(!I||!v.intersectsAabb(I.aabb))continue;I.aabb.min=v.closestPoint(I.aabb.min),I.aabb.max=v.closestPoint(I.aabb.max);const C=I.aabb.getCorners();for(let D=0;D<p.length;D++){let F=!0;for(const V of C){const z=[V[0]*u,V[1]*u,V[2]];if(s.af(z,z,p[D].matrix),z[0]<-1||z[0]>1||z[1]<-1||z[1]>1){F=!1;break}}if(I.lastCascade=D,x=Math.max(x,D),F)break}}return x+1}}class HE{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new vp,this._depthMode=new Gt(n.context.gl.LEQUAL,Gt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),n.tp.registerParameter(po,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(po,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),n.tp.registerParameter(po,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,u){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!u||!u.properties)return;const v=u.properties.get("shadow-intensity");if(!u.shadowsEnabled()||v<=0||(this._shadowLayerCount=p.style.order.reduce((G,H)=>{const ee=p.style._mergedLayers[H];return G+(ee.hasShadowPass()&&!ee.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const x=p.context,w=po.shadowMapResolution,I=po.shadowMapResolution;if(this._cascades.length===0||po.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let G=0;G<po.cascadeCount;++G){const H=p._shadowMapDebug,ee=x.gl,K=x.createFramebuffer(w,I,H,"texture"),ie=new s.T(x,{width:w,height:I,data:null},ee.DEPTH_COMPONENT16);if(K.depthAttachment.set(ie.texture),H){const ae=new s.T(x,{width:w,height:I,data:null},ee.RGBA8);K.colorAttachment.set(ae.texture)}this._cascades.push({framebuffer:K,texture:ie,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cA,scale:0})}}this.shadowDirection=Hd(u);let C=0;if(n.elevation){const G=n.elevation,H=[1e4,-1e4];G.visibleDemTiles.filter(ee=>ee.dem).forEach(ee=>{const K=ee.dem.tree;H[0]=Math.min(H[0],K.minimums[0]),H[1]=Math.max(H[1],K.maximums[0])}),H[0]!==1e4&&(C=(H[1]-H[0])*G.exaggeration())}const D=1.5*n.cameraToCenterDistance,F=3*D,V=new Float64Array(16);for(let G=0;G<this._cascades.length;++G){const H=this._cascades[G];let ee=n.height/50,K=1;po.cascadeCount===1?K=F:G===0?K=D:(ee=D,K=F);const[ie,ae]=qE(n,this.shadowDirection,ee,K,po.shadowMapResolution,C);H.scale=n.scale,H.matrix=ie,H.boundingSphereRadius=ae,s.bl(V,H.matrix),H.frustum=s.cA.fromInvProjectionMatrix(V,1,0,!0),H.far=K}const z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[z].far,this._cascades[z].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/po.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=po.shadowMapResolution,this._uniformValues.u_shadowmap_0=bs.ShadowMap0,this._uniformValues.u_shadowmap_1=bs.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const j=p.transform.elevation;for(const G of this._groundShadowTiles){let H={min:0,max:0};if(j){const ee=j.getMinMaxForTile(G);ee&&(H=ee)}this.addShadowReceiver(G.toUnwrapped(),H.min,H.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,u){if(!this.enabled)return;const p=this.painter,v=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),v.viewport.set([0,0,po.shadowMapResolution,po.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){p.currentShadowCascade=x,v.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),v.clear({color:s.ao.white,depth:1});for(const w of n.order){const I=n._mergedLayers[w];if(!I.hasShadowPass()||I.isHidden(p.transform.zoom))continue;const C=n.getLayerSourceCache(I),D=C?u[C.id]:void 0;(I.type==="model"||D&&D.length)&&p.renderLayer(p,C,I,D)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,u=n.style,p=n.context,v=p.gl,x=u.directionalLight,w=u.ambientLight;if(!x||!w)return;const I=[],C=Ru(n,n.longestCutoffRange);C.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),I.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&I.push("NORMAL_OFFSET");const D=Ul(u,x,w),F=new Gt(v.LEQUAL,Gt.ReadOnly,n.depthRangeFor3D),V=new Pi({func:v.EQUAL,mask:255},0,255,v.KEEP,v.KEEP,v.KEEP);for(const z of this._groundShadowTiles){const j=z.toUnwrapped(),G=n.isTileAffectedByFog(z),H=n.getOrCreateProgram("groundShadow",{defines:I,overrideFog:G});this.setupShadows(j,H),n.uploadCommonUniforms(p,H,j,null,C);const ee={u_matrix:n.transform.calculateProjMatrix(j),u_ground_shadow_factor:D};H.draw(n,v.TRIANGLES,F,V,Di.multiply,Bi.disabled,ee,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,null,n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Di.unblended:Di.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const u=this.painter.transform,p=u.calculatePosMatrix(n,u.worldSize);return s.aB(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(n){return s.aB(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,u,p){if(!this.enabled)return;const v=this.painter.transform,x=this.painter.context,w=x.gl,I=this._uniformValues,C=new Float64Array(16),D=v.calculatePosMatrix(n,v.worldSize);for(let F=0;F<this._cascades.length;F++)s.aB(C,this._cascades[F].matrix,D),I[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),x.activeTexture.set(w.TEXTURE0+bs.ShadowMap0+F),this._cascades[F].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){const F=s.d6(n.canonical),V=2/v.tileSize*s.al/po.shadowMapResolution,z=V*this._cascades[0].boundingSphereRadius,j=V*this._cascades[this._cascades.length-1].boundingSphereRadius,G=(p==="vector-tile"?1:3)*function(H,ee,K,ie,ae){const ce=s.aA((H-22)/-22,0,1);return .125*(1-ce)+4*ce}(v.zoom);I.u_shadow_normal_offset=[F,z*G,j*G],I.u_shadow_bias=[1e-4,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(x,I)}setupShadowsFromMatrix(n,u,p=!1){if(!this.enabled)return;const v=this.painter.context,x=v.gl,w=this._uniformValues,I=new Float64Array(16);for(let C=0;C<po.cascadeCount;C++)s.aB(I,this._cascades[C].matrix,n),w[C===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),v.activeTexture.set(x.TEXTURE0+bs.ShadowMap0+C),this._cascades[C].texture.bindExtraParam(x.LINEAR,x.LINEAR,x.CLAMP_TO_EDGE,x.CLAMP_TO_EDGE,x.GREATER);if(this.useNormalOffset=p,p){const C=po.normalOffset;w.u_shadow_normal_offset=[1,C,C],w.u_shadow_bias=[6e-5,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(v,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,u,p,v){if(v[2]>=0)return{};const x=function(C,D,F){const V=F/(1<<C.canonical.z);return new s.d8([C.canonical.x*V+C.wrap*F,C.canonical.y*V+C.wrap*F,0],[(C.canonical.x+1)*V+C.wrap*F,(C.canonical.y+1)*V+C.wrap*F,D])}(n,u,p).getCorners(),w=u/-v[2];v[0]<0?(s.d7(x[0],x[0],[v[0]*w,0,0]),s.d7(x[3],x[3],[v[0]*w,0,0])):v[0]>0&&(s.d7(x[1],x[1],[v[0]*w,0,0]),s.d7(x[2],x[2],[v[0]*w,0,0])),v[1]<0?(s.d7(x[0],x[0],[0,v[1]*w,0]),s.d7(x[1],x[1],[0,v[1]*w,0])):v[1]>0&&(s.d7(x[2],x[2],[0,v[1]*w,0]),s.d7(x[3],x[3],[0,v[1]*w,0]));const I={};return I.vertices=x,I.planes=[i_(x[1],x[0],x[4]),i_(x[2],x[1],x[5]),i_(x[3],x[2],x[6]),i_(x[0],x[3],x[7])],I}addShadowReceiver(n,u,p){this._receivers.add(n,s.d8.fromTileIdAndHeight(n,u,p))}getMaxCascadeForTile(n){const u=this._receivers.get(n);return u&&u.lastCascade?u.lastCascade:0}}function i_(m,n,u){const p=s.av([],u,n),v=s.av([],m,n),x=s.bI([],p,v),w=s.ag(x);return w===0?[0,0,1,0]:(s.c4(x,x,1/w),[x[0],x[1],x[2],-s.bJ(x,n)])}function Hd(m){const n=m.properties.get("direction"),u=s.d3(n.x,n.y,n.z);u[2]=s.aA(u[2],0,75);const p=s.d5([u[0],u[1],u[2]]);return s.d4(p.x,p.y,p.z)}function Ul(m,n,u){const p=n.properties.get("color-use-theme")==="none",v=n.properties.get("color"),x=n.properties.get("intensity"),w=n.properties.get("direction"),I=[w.x,w.y,w.z],C=u.properties.get("color-use-theme")==="none",D=u.properties.get("color"),F=u.properties.get("intensity"),V=Math.max(s.bJ([0,0,1],I),0),z=[0,0,0];s.c4(z,D.toPremultipliedRenderColor(C?null:m.getLut(n.scope)).toArray01Linear().slice(0,3),F);const j=[0,0,0];return s.c4(j,v.toPremultipliedRenderColor(p?null:m.getLut(u.scope)).toArray01Linear().slice(0,3),V*x),s.da([z[0]>0?z[0]/(z[0]+j[0]):0,z[1]>0?z[1]/(z[1]+j[1]):0,z[2]>0?z[2]/(z[2]+j[2]):0])}function qE(m,n,u,p,v,x){const w=m.zoom,I=m.scale,C=m.worldSize,D=1/C,F=m.aspect,V=Math.sqrt(1+F*F)*Math.tan(.5*m.fovX),z=V*V,j=p-u,G=p+u;let H,ee;z>j/G?(H=p,ee=p*V):(H=.5*G*(1+z),ee=.5*Math.sqrt(j*j+2*(p*p+u*u)*z+G*G*z*z));const K=m.projection.pixelsPerMeter(m.center.lat,C),ie=m._camera.getCameraToWorldMercator(),ae=[0,0,-H*D];s.af(ae,ae,ie);let ce=ee*D;const ve=m._edgeInsets;if(!(ve.left===0&&ve.top===0&&ve.right===0&&ve.bottom===0||ve.left===ve.right&&ve.top===ve.bottom)){const bt=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?K:1),kt=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,u,p);kt[8]=2*-m.centerOffset.x/m.width,kt[9]=2*m.centerOffset.y/m.height;const $t=new Float64Array(16);s.cO($t,kt,bt);const Ct=new Float64Array(16);s.bl(Ct,$t);const It=s.cA.fromInvProjectionMatrix(Ct,C,w,!0);for(const fi of It.points){const li=((_e=fi)[0]/=I,_e[1]/=I,_e[2]=s.ce(_e[2],m._center.lat),_e);ce=Math.max(ce,s.c5(s.d9([],ae,li)))}}var _e;ce*=v/(v-1);const xe=Math.acos(n[2]),ge=Math.atan2(-n[0],-n[1]),pe=new t_;pe.position=ae,pe.setPitchBearing(xe,ge);const we=pe.getWorldToCamera(C,K),Je=ce*C,$e=Math.min(m._mercatorZfromZoom(17)*C*-2,-2*Je),ot=pe.getCameraToClipOrthographic(-Je,Je,-Je,Je,$e,(Je+x*K)/n[2]),Xe=new Float64Array(16);s.aB(Xe,ot,we);const nt=s.d4(Math.floor(1e6*ae[0])/1e6*C,Math.floor(1e6*ae[1])/1e6*C,0),Dt=.5*v,Ye=[0,0,0];s.af(Ye,nt,Xe),s.c4(Ye,Ye,Dt);const De=[Math.floor(Ye[0]),Math.floor(Ye[1]),Math.floor(Ye[2])],ct=[0,0,0];s.av(ct,Ye,De),s.c4(ct,ct,-1/Dt);const tt=new Float64Array(16);return s.bA(tt),s.br(tt,tt,ct),s.aB(Xe,tt,Xe),[Xe,Je]}class qd extends s.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(n,u){return s.aV(this.requestManager.transformRequest(u,s.R.Model).url).then(p=>{if(!p)return;const v=s.aW(p),x=new s.aX(n,void 0,void 0,v);return x.computeBoundsAndApplyParent(),x}).catch(p=>{if(p&&p.status===404)return null;this.fire(new s.y(new Error(`Could not load model ${n} from ${u}: ${p.message}`)))})}load(n,u,p={forceReload:!1}){this.models[u]||(this.models[u]={});const v=Object.keys(n),x=[],w=[];for(const I of v){const C=n[I];this.hasURLBeenRequested(C)&&!p.forceReload||(this.modelByURL[C]={modelId:I,scope:u},x.push(this.loadModel(I,C)),w.push(I)),this.models[u][I]||(this.models[u][I]={model:null,numReferences:1})}this.numModelsLoading[u]=(this.numModelsLoading[u]||0)+w.length,Promise.allSettled(x).then(I=>{for(let C=0;C<I.length;C++){const{status:D}=I[C];if(D==="rejected")continue;const{value:F}=I[C];this.models[u][w[C]]||(this.models[u][w[C]]={model:null,numReferences:1}),this.models[u][w[C]].model=F}this.numModelsLoading[u]-=w.length,this.fire(new s.z("data",{dataType:"style"}))}).catch(I=>{this.fire(new s.y(new Error(`Could not load models: ${I.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,u,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(n,u):this.getModelByURL(this.modelUris[u][n]))}getModel(n,u){return this.models[u]||(this.models[u]={}),this.models[u][n]?this.models[u][n].model:void 0}getModelByURL(n){if(!n)return null;const u=this.modelByURL[n];return u?this.models[u.scope][u.modelId].model:null}hasModelBeenAdded(n,u){return this.models[u]&&this.models[u][n]!==void 0}getModelURIs(n){return this.modelUris[n]||{}}addModel(n,u,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const v=this.requestManager.normalizeModelURL(u);if((this.hasModel(n,p,{exactIdMatch:!0})||this.hasModelBeenAdded(n,p))&&this.modelUris[p][n]===v)this.models[p][n].numReferences++;else if(this.hasURLBeenRequested(v)){const{scope:x,modelId:w}=this.modelByURL[v];this.models[x][w].numReferences++}else this.modelUris[p][n]=v,this.load({[n]:this.modelUris[p][n]},p)}addModelURLs(n,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const p=this.modelUris[u];for(const v in n)p[v]=this.requestManager.normalizeModelURL(n[v])}reloadModels(n){this.load(this.modelUris[n],n,{forceReload:!0})}addModelsFromBucket(n,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const p={};for(const v of n)this.hasModel(v,u,{exactIdMatch:!0})||this.hasURLBeenRequested(v)?this.models[u][v].numReferences++:this.modelUris[u][v]&&!this.hasURLBeenRequested(v)?p[v]=this.modelUris[u][v]:!this.hasURLBeenRequested(v)&&s.db(v,!1)&&(this.modelUris[u][v]=this.requestManager.normalizeModelURL(v),p[v]=this.modelUris[u][v]);this.load(p,u)}hasURLBeenRequested(n){return this.modelByURL[n]!==void 0}removeModel(n,u,p=!1,v=!1){if(this.models[u]&&this.models[u][n]&&(this.models[u][n].numReferences--,this.models[u][n].numReferences===0||v)){const x=this.modelUris[u][n];p||delete this.modelUris[u][n],delete this.modelByURL[x];const w=this.models[u][n].model;if(!w)return;delete this.models[u][n],w.destroy()}}destroy(){for(const n of Object.keys(this.models))for(const u of Object.keys(this.models[n])){const p=this.models[n][u].model;delete this.models[n][u],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,u){this.models[u]||(this.models[u]={});for(const p in this.models[u])this.models[u][p].model&&this.models[u][p].model.upload(n.context)}}const Wx=new s.a9({data:new s.aa(s.a6.colorTheme.data)});function r_(m){if(!m.metadata||!m.metadata.content_area)return;const n=s.o.devicePixelRatio,{left:u,top:p,width:v,height:x}=m.metadata.content_area,w=u*n,I=p*n;return[w,I,w+v*n,I+x*n]}function n_(m){if(m)return m.map(([n,u])=>[n*s.o.devicePixelRatio,u*s.o.devicePixelRatio])}class Pu{constructor(n,u,p){this.id=n,this.scope=u,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(n){this.missingRequests.has(n.name)||this.pendingRequests.has(n.name)||this.pendingRequests.add(n.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const n=new Map;if(!this.sourceCache.loaded())return n;const u=this.sourceCache.getVisibleCoordinates();if(u.length===0)return n;const p=this.sourceCache.getSource();if(!(p instanceof uc))return n;const v=u.map(w=>this.sourceCache.getTile(w)),x=p.getImages(v,Array.from(this.pendingRequests));for(const[w,I]of x)n.set(s.I.from({name:w,iconsetId:this.id}),I),this.pendingRequests.delete(w);for(const w of this.pendingRequests)this.missingRequests.add(w);return this.pendingRequests.clear(),n}}const Oh=(m,n)=>fe(m,n&&n.filter(u=>u.identifier!=="source.canvas")),WE=s.aH(fr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),XE=s.aH(fr,["setCenter","setZoom","setBearing","setPitch"]),s_=new Set(["background","sky","slot","custom"]),Xx={version:8,layers:[],sources:{}},o_={duration:300,delay:0};class wl extends s.E{constructor(n,u={}){super(),this.map=n,this.scope=u.scope||"",this.globalId=null,this.fragments=[],this.importDepth=u.importDepth||0,this.importsCache=u.importsCache||new Map,this.resolvedImports=u.resolvedImports||new Set,this.transition=Object.assign({},o_),this._buildingIndex=new Bd(this),this.crossTileSymbolIndex=new Er,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=u.styleChanges||new Ge,this.dispatcher=u.dispatcher?u.dispatcher:new s.D(s.dd(),this),u.imageManager?this.imageManager=u.imageManager:(this.imageManager=new ht(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=u.glyphManager?u.glyphManager:new s.de(n._requestManager,u.localFontFamily?s.df.all:u.localIdeographFontFamily?s.df.ideographs:s.df.none,u.localFontFamily||u.localIdeographFontFamily),u.modelManager?this.modelManager=u.modelManager:(this.modelManager=new qd(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=u.configOptions?u.configOptions:new Map,this._configDependentLayers=u.configDependentLayers?u.configDependentLayers:new Set,this._config=u.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:u.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=u.initialConfig,this.dispatcher.broadcast("setReferrer",s.dg());const p=this;this._rtlTextPluginCallback=wl.registerForPluginStateChange(v=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,w)=>{if(s.dh(x),w&&w.every(I=>I))for(const I in p._sourceCaches){const C=p._sourceCaches[I],D=C.getSource().type;D!=="vector"&&D!=="geojson"||C.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const x=this.getOwnSource(v.sourceId);if(x&&x.vectorLayerIds)for(const w in this._layers){const I=this._layers[w];I.source===x.id&&this._validateLayer(I)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(s.h(n))return n;const u=s.di(n);if(!u.startsWith("http"))try{return new URL(u,location.href).toString()}catch{return u}return u}return`json://${s.dj(JSON.stringify(n))}`}_diffStyle(n,u,p){this.globalId=this._getGlobalId(n);const v=(x,w)=>{try{w(null,this.setState(x,p))}catch(I){w(I,!1)}};if(typeof n=="string"){const x=this.map._requestManager.normalizeStyleURL(n),w=this.map._requestManager.transformRequest(x,s.R.Style);s.m(w,(I,C)=>{I?this.fire(new s.y(I)):C&&v(C,u)})}else typeof n=="object"&&v(n,u)}loadURL(n,u={}){this.fire(new s.z("dataloading",{dataType:"style"}));const p=typeof u.validate=="boolean"?u.validate:!s.h(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,u.accessToken),this.resolvedImports.add(n);const v=this.importsCache.get(n);if(v)return this._load(v,p);const x=this.map._requestManager.transformRequest(n,s.R.Style);this._request=s.m(x,(w,I)=>{if(this._request=null,w)this.fire(new s.y(w));else if(I)return this.importsCache.set(n,I),this._load(I,p)})}loadJSON(n,u={}){this.fire(new s.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=s.o.frame(()=>{this._request=null,this._load(n,u.validate!==!1)})}loadEmpty(){this.fire(new s.z("dataloading",{dataType:"style"})),this._load(Xx,!1)}_loadImports(n,u,p){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const x of n){const w=this._createFragmentStyle(x),I=new Promise(F=>{w.once("style.import.load",F),w.once("error",F)}).then(()=>this.mergeAll());if(v.push(I),this.resolvedImports.has(x.url)){w.loadEmpty();continue}const C=x.data||this.importsCache.get(x.url);C?(w.loadJSON(C,{validate:u}),this._isInternalStyle(C)&&(w.globalId=null)):x.url?w.loadURL(x.url,{validate:u}):w.loadEmpty();const D={style:w,id:x.id,config:x.config};if(p){const F=this.fragments.findIndex(({id:V})=>V===p);this.fragments=this.fragments.slice(0,F).concat(D).concat(this.fragments.slice(F))}else this.fragments.push(D)}return Promise.allSettled(v)}getImportGlobalIds(n=this,u=new Set){for(const p of n.fragments)p.style.globalId&&u.add(p.style.globalId),this.getImportGlobalIds(p.style,u);return[...u.values()]}_createFragmentStyle(n){const u=this.scope?s.B(n.id,this.scope):n.id;let p;const v=this._initialConfig&&this._initialConfig[u];(n.config||v)&&(p=Object.assign({},n.config,v));const x=new wl(this.map,{scope:u,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:n["color-theme"],configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,u){if(this._isInternalStyle(n)){const x=Object.assign({},Xx,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(x,u)}if(this.updateConfig(this._config,n.schema),u&&Oh(this,gs(n)))return;this._loaded=!0,this.stylesheet=s.dk(n);const p=()=>{for(const C in n.sources)this.addSource(C,n.sources[C],{validate:!1,isInitialLoad:!0});if(n.iconsets)for(const C in n.iconsets)this.addIconset(C,n.iconsets[C]);n.sprite?this._loadIconset(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&n.glyphs&&this.glyphManager.setURL(n.glyphs);const x=Vd(this.stylesheet.layers);if(this._order=x.map(C=>C.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const C=this.stylesheet.lights[0];this.light=new ze(C.properties,C.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ze(this.stylesheet.light)),this._layers={};for(const C of x){const D=s.dq(C,this.scope,this._styleColorTheme.lut,this.options);D.configDependencies.size!==0&&this._configDependentLayers.add(D.fqid),D.setEventedParent(this,{layer:{id:D.id}}),this._layers[D.id]=D;const F=this.getOwnLayerSourceCache(D),V=!!this.directionalLight&&this.directionalLight.shadowsEnabled();F&&D.canCastShadows()&&V&&(F.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const w=this.stylesheet.terrain;w&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(w,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.z("data",{dataType:"style"}));const I=this.isRootStyle();n.imports?this._loadImports(n.imports,u).then(()=>{this._reloadImports(),this.fire(new s.z(I?"style.load":"style.import.load"))}).catch(C=>{this.fire(new s.y(new Error("Failed to load imports",C))),this.fire(new s.z(I?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.z(I?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const v=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(v){const x=this._evaluateColorThemeData(v);this._loadColorTheme(x).then(()=>{p()}).catch(w=>{s.w(`Couldn't load color theme from the stylesheet: ${w}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,u,p,v,x,w,I,C,D,F;const V={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(z=>{if(z.stylesheet){if(z.light!=null&&(n=z.light),z.stylesheet.lights)for(const j of z.stylesheet.lights)j.type==="ambient"&&z.ambientLight!=null&&(u=z.ambientLight),j.type==="directional"&&z.directionalLight!=null&&(p=z.directionalLight);v=this._prioritizeTerrain(v,z.terrain,z.stylesheet.terrain),z.stylesheet.fog&&z.fog!=null&&(x=z.fog),z.stylesheet.snow&&z.snow!=null&&(w=z.snow),z.stylesheet.rain&&z.rain!=null&&(I=z.rain),z.stylesheet.camera!=null&&(F=z.stylesheet.camera),z.stylesheet.projection!=null&&(C=z.stylesheet.projection),z.stylesheet.transition!=null&&(D=z.stylesheet.transition),V[z.scope]=z._styleColorTheme}}),this.light=n,this.ambientLight=u,this.directionalLight=p,this.fog=x,this.snow=w,this.rain=I,this._styleColorThemeForScope=V,v===null?delete this.terrain:this.terrain=v,this.camera=F||{"camera-projection":"perspective"},this.projection=C||{name:"mercator"},this.transition=Object.assign({},o_,D),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const u=p=>{for(const v of p.fragments)u(v.style);n(p)};u(this)}_prioritizeTerrain(n,u,p){const v=n&&n.drapeRenderMode===0;return p===null?u&&u.drapeRenderMode===0?u:v?n:null:u!=null&&(!n||v||u&&u.drapeRenderMode===1)?u:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(u=>{n=this._prioritizeTerrain(n,u.terrain,u.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(u=>{u.stylesheet.projection!=null&&(n=u.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},u={},p={};this.forEachFragmentStyle(v=>{for(const x in v._sourceCaches){const w=s.B(x,v.scope);n[w]=v._sourceCaches[x]}for(const x in v._otherSourceCaches){const w=s.B(x,v.scope);u[w]=v._otherSourceCaches[x]}for(const x in v._symbolSourceCaches){const w=s.B(x,v.scope);p[w]=v._symbolSourceCaches[x]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=u,this._mergedSymbolSourceCaches=p}mergeLayers(){const n={},u=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(const I of w._order){const C=w._layers[I];if(C.type==="slot"){const D=s.dl(I);if(n[D])continue;n[D]=[]}C.slot&&n[C.slot]?n[C.slot].push(C):u.push(C)}}),this._mergedOrder=[];let v=-1;const x=(w=[])=>{for(const I of w)if(I.type==="slot"){const C=s.dl(I.id);n[C]&&x(n[C]),this._mergedSlots.push(C)}else{const C=s.B(I.id,I.scope);this._mergedOrder.push(C),p[C]=I,I.is3D(!!this.terrain)&&(this._has3DLayers=!0,v=this._mergedOrder.length-1),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&(this._clipLayerPresent=!0)}};if(x(u),this._has3DLayers){const w={};for(let I=0;I<this._mergedOrder.length;++I){const C=this._mergedOrder[I];w[C]=I===v?1:I<v?p[C].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((I,C)=>w[I]-w[C])}this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?function(u,p,v,x){const w=Object.assign({},p);for(const C of Object.keys(s.a6.colorTheme))w[C]===void 0&&(w[C]=s.a6.colorTheme[C].default);const I=new s.a8(Wx,u,new Map(v));return I.setTransitionOrValue(w,v),I.untransitioned().possiblyEvaluate(new s.ac(0,{worldview:void 0}))}(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const u=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,v)=>{const x="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let w=n;w.startsWith(x)||(w=x+w);const I=s.I.from("mapbox-reserved-lut"),C=new Image;C.src=w,C.onerror=()=>{this._styleColorTheme.lutLoading=!1,v(new Error("Failed to load image data"))},C.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==u)return void p();this._styleColorTheme.lutLoading=!1;const{width:D,height:F,data:V}=s.o.getImageData(C);if(F>32)return void v(new Error("The height of the image must be less than or equal to 32 pixels."));if(D!==F*F)return void v(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new s.q({width:D,height:F},V),pixelRatio:1,sdf:!1,usvg:!1,version:0});const z=this.imageManager.getImage(I,this.scope);z?(this._styleColorTheme.lut={image:z.data,data:n},p()):v(new Error("Missing LUT image."))}})}getLut(n){const u=this._styleColorThemeForScope[n];return u?u.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(u,p,v){let x,w,I;const C=s.o.devicePixelRatio>1?"@2x":"";let D=s.m(p.transformRequest(p.normalizeSpriteURL(u,C,".json"),s.R.SpriteJSON),(z,j)=>{D=null,I||(I=z,x=j,V())}),F=s.n(p.transformRequest(p.normalizeSpriteURL(u,C,".png"),s.R.SpriteImage),(z,j)=>{F=null,I||(I=z,w=j,V())});function V(){if(I)v(I);else if(x&&w){const z=s.o.getImageData(w),j={};for(const G in x){const{width:H,height:ee,x:K,y:ie,sdf:ae,pixelRatio:ce,stretchX:ve,stretchY:_e,content:xe}=x[G],ge=new s.q({width:H,height:ee});s.q.copy(z,ge,{x:K,y:ie},{x:0,y:0},{width:H,height:ee},null),j[G]={data:ge,pixelRatio:ce!==void 0?ce:1,sdf:ae!==void 0&&ae,stretchX:ve,stretchY:_e,content:xe,usvg:!1,version:0}}v(null,j)}}return{cancel(){D&&(D.cancel(),D=null),F&&(F.cancel(),F=null)}}}(n,this.map._requestManager,(u,p)=>{if(this._spriteRequest=null,u)this.fire(new s.y(u));else if(p){const v=new Map;for(const x in p)v.set(s.I.from(x),p[x]);this.addImages(v)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))})}addIconset(n,u){if(u.type==="sprite")return void this._loadSprite(u.url);const p=this.getOwnSourceCache(u.source);if(!p)return void this.fire(new s.y(new Error(`Source "${u.source}" as specified by iconset "${n}" does not exist and cannot be used as an iconset source`)));const v=p.getSource();if(v.type!=="raster-array")return void this.fire(new s.y(new Error(`Source "${u.source}" as specified by iconset "${n}" is not a "raster-array" source and cannot be used as an iconset source`)));v.partial=!1;const x=new Pu(n,this.scope,p);this.imageManager.addImageProvider(x,this.scope)}removeIconset(n){this.imageManager.removeImageProvider(n,this.scope)}_loadIconset(n){if(!s.h(n)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(n);const u=this.map._spriteFormat==="auto";var p,v;this._spriteRequest=(v=(x,w)=>{if(this._spriteRequest=null,x)u?this._loadSprite(n):this.fire(new s.y(x));else if(w){const I=new Map;for(const C in w)I.set(s.I.from(C),w[C]);this.addImages(I)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))},s.bu((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(n),s.R.Iconset),(x,w)=>{if(x)return void v(x);const I={},C=s.dc(new s.bt(w));for(const D of C.icons){const F={version:1,pixelRatio:s.o.devicePixelRatio,content:r_(D),stretchX:D.metadata?n_(D.metadata.stretch_x_areas):void 0,stretchY:D.metadata?n_(D.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:D};I[D.name]=F}v(null,I)}))}_validateLayer(n){const u=this.getOwnSource(n.source);if(!u)return;const p=n.sourceLayer;p&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(p)===-1)&&this.fire(new s.y(new Error(`Source layer "${p}" does not exist on source "${u.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,u)=>{const p=this.fragments[u];return p&&p.style&&(n.data=p.style.serialize()),n})}_serializeSources(){const n={};for(const u in this._sourceCaches){const p=this._sourceCaches[u].getSource();n[p.id]||(n[p.id]=p.serialize())}return n}_serializeLayers(n){const u=[];for(const p of n){const v=this._layers[p];v&&v.type!=="custom"&&u.push(v.serialize())}return u}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const u=this.getOwnLayer(n);if(u)return u;this.fire(new s.y(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const u=this.getOwnSource(n);if(u)return u;this.fire(new s.y(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,u){const p=this.map.painter;if(p)for(let v=n.minzoom||0;v<(n.maxzoom||25.5);v++){const x=n.getProgramIds();if(x)for(const w of x){const I=n.getDefaultProgramParams(w,u.zoom,this._styleColorTheme.lut);I&&(p.style=this,this.fog&&(p._fogVisible=!0,I.overrideFog=!0,p.getOrCreateProgram(w,I)),p._fogVisible=!1,I.overrideFog=!1,p.getOrCreateProgram(w,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,p.getOrCreateProgram(w,I)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const u=this.calculateLightsBrightness();n.brightness=u||0,u!==this._brightness&&(this._brightness=u,this.dispatcher.broadcast("setBrightness",u)),n.worldview!==this._worldview&&(this._worldview=n.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const p=this._changes.isDirty();let v=!1;if(this._changes.isDirty()){const I=this._changes.getLayerUpdatesByScope();for(const C in I){const{updatedIds:D,removedIds:F}=I[C];(D||F)&&(this._updateWorkerLayers(C,D,F),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this.snow&&this.snow.updateTransitions(n),this.rain&&this.rain.updateTransitions(n),this._changes.reset()}const x={};for(const I in this._mergedSourceCaches){const C=this._mergedSourceCaches[I];x[I]=C.used,C.used=!1,C.tileCoverLift=0}for(const I of this._mergedOrder){const C=this._mergedLayers[I];if(C.recalculate(n,this._availableImages),!C.isHidden(n.zoom)){const D=this.getLayerSourceCache(C);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,C.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(C,n)}):this.precompilePrograms(C,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();const w=this.imageManager.getPendingImageProviders();for(const I of w)I.sourceCache.used=!0;for(const I in x){const C=this._mergedSourceCaches[I];x[I]!==C.used&&C.getSource().fire(new s.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.snow&&this.snow.recalculate(n),this.rain&&this.rain.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new s.z("data",{dataType:"style"}))}updateImageProviders(){const n=this.imageManager.getPendingImageProviders();for(const u of n){const p=u.resolvePendingRequests(),v=this.getFragmentStyle(u.scope);v&&v.addImages(p)}}_updateTilesForChangedImages(){const n={};for(const u in this._mergedSourceCaches){const p=this._mergedSourceCaches[u].getSource().scope;n[p]=n[p]||this._changes.getUpdatedImages(p),n[p].length!==0&&this._mergedSourceCaches[u].reloadTilesForDependencies(["icons","patterns"],n[p])}for(const u in n)this._changes.resetUpdatedImages(u)}_updateWorkerLayers(n,u,p){const v=this.getFragmentStyle(n);v&&this.dispatcher.broadcast("updateLayers",{layers:u?v._serializeLayers(u):[],scope:n,removedIds:p||[],options:v.options})}setState(n,u){if(this._checkLoaded(),Oh(this,gs(n)))return!1;(n=s.dk(n)).layers=Vd(n.layers);const p=function(w,I){if(!w)return[{command:fr.setStyle,args:[I]}];let C=[];try{if(!s.by(w.version,I.version))return[{command:fr.setStyle,args:[I]}];if(s.by(w.center,I.center)||C.push({command:fr.setCenter,args:[I.center]}),s.by(w.zoom,I.zoom)||C.push({command:fr.setZoom,args:[I.zoom]}),s.by(w.bearing,I.bearing)||C.push({command:fr.setBearing,args:[I.bearing]}),s.by(w.pitch,I.pitch)||C.push({command:fr.setPitch,args:[I.pitch]}),s.by(w.sprite,I.sprite)||C.push({command:fr.setSprite,args:[I.sprite]}),s.by(w.glyphs,I.glyphs)||C.push({command:fr.setGlyphs,args:[I.glyphs]}),s.by(w.imports,I.imports)||function(j=[],G=[],H){G=G||[];const ee=(j=j||[]).map(bl),K=G.map(bl),ie=j.reduce(Nl,{}),ae=G.reduce(Nl,{}),ce=ee.slice();let ve,_e,xe,ge;for(ve=0,_e=0;ve<ee.length;ve++)xe=ee[ve],ae.hasOwnProperty(xe)?_e++:(H.push({command:fr.removeImport,args:[xe]}),ce.splice(ce.indexOf(xe,_e),1));for(ve=0,_e=0;ve<K.length;ve++)xe=K[K.length-1-ve],ce[ce.length-1-ve]!==xe&&(ie.hasOwnProperty(xe)?(H.push({command:fr.removeImport,args:[xe]}),ce.splice(ce.lastIndexOf(xe,ce.length-_e),1)):_e++,ge=ce[ce.length-ve],H.push({command:fr.addImport,args:[ae[xe],ge]}),ce.splice(ce.length-ve,0,xe));for(const pe of G){const we=ie[pe.id];we&&(delete we.data,s.by(we,pe)||H.push({command:fr.updateImport,args:[pe.id,pe]}))}}(w.imports,I.imports,C),s.by(w.transition,I.transition)||C.push({command:fr.setTransition,args:[I.transition]}),s.by(w.light,I.light)||C.push({command:fr.setLight,args:[I.light]}),s.by(w.fog,I.fog)||C.push({command:fr.setFog,args:[I.fog]}),s.by(w.snow,I.snow)||C.push({command:fr.setSnow,args:[I.snow]}),s.by(w.rain,I.rain)||C.push({command:fr.setRain,args:[I.rain]}),s.by(w.projection,I.projection)||C.push({command:fr.setProjection,args:[I.projection]}),s.by(w.lights,I.lights)||C.push({command:fr.setLights,args:[I.lights]}),s.by(w.camera,I.camera)||C.push({command:fr.setCamera,args:[I.camera]}),s.by(w.iconsets,I.iconsets)||function(j,G,H){let ee;for(ee in G=G||{},j=j||{})j.hasOwnProperty(ee)&&(G.hasOwnProperty(ee)||H.push({command:fr.removeIconset,args:[ee]}));for(ee in G){if(!G.hasOwnProperty(ee))continue;const K=G[ee];j.hasOwnProperty(ee)?s.by(j[ee],K)||(H.push({command:fr.removeIconset,args:[ee]}),H.push({command:fr.addIconset,args:[ee,K]})):H.push({command:fr.addIconset,args:[ee,K]})}}(w.iconsets,I.iconsets,C),!s.by(w["color-theme"],I["color-theme"]))return[{command:fr.setStyle,args:[I]}];const D={},F=[];(function(j,G,H,ee){let K;for(K in G=G||{},j=j||{})j.hasOwnProperty(K)&&(G.hasOwnProperty(K)||Jm(K,H,ee));for(K in G){if(!G.hasOwnProperty(K))continue;const ie=G[K];j.hasOwnProperty(K)?s.by(j[K],ie)||(j[K].type==="geojson"&&ie.type==="geojson"&&Gc(j,G,K)?H.push({command:fr.setGeoJSONSourceData,args:[K,ie.data]}):Ah(K,G,H,ee)):Iu(K,G,H)}})(w.sources,I.sources,F,D);const V=[];w.layers&&w.layers.forEach(j=>{j.source&&D[j.source]?C.push({command:fr.removeLayer,args:[j.id]}):V.push(j)});let z=w.terrain;z&&D[z.source]&&(C.push({command:fr.setTerrain,args:[void 0]}),z=void 0),C=C.concat(F),s.by(z,I.terrain)||C.push({command:fr.setTerrain,args:[I.terrain]}),function(j,G,H){G=G||[];const ee=(j=j||[]).map(bl),K=G.map(bl),ie=j.reduce(Nl,{}),ae=G.reduce(Nl,{}),ce=ee.slice(),ve=Object.create(null);let _e,xe,ge,pe,we,Je,$e;for(_e=0,xe=0;_e<ee.length;_e++)ge=ee[_e],ae.hasOwnProperty(ge)?xe++:(H.push({command:fr.removeLayer,args:[ge]}),ce.splice(ce.indexOf(ge,xe),1));for(_e=0,xe=0;_e<K.length;_e++)ge=K[K.length-1-_e],ce[ce.length-1-_e]!==ge&&(ie.hasOwnProperty(ge)?(H.push({command:fr.removeLayer,args:[ge]}),ce.splice(ce.lastIndexOf(ge,ce.length-xe),1)):xe++,Je=ce[ce.length-_e],H.push({command:fr.addLayer,args:[ae[ge],Je]}),ce.splice(ce.length-_e,0,ge),ve[ge]=!0);for(_e=0;_e<K.length;_e++)if(ge=K[_e],pe=ie[ge],we=ae[ge],!ve[ge]&&!s.by(pe,we))if(s.by(pe.source,we.source)&&s.by(pe["source-layer"],we["source-layer"])&&s.by(pe.type,we.type)){for($e in zl(pe.layout,we.layout,H,ge,null,fr.setLayoutProperty),zl(pe.paint,we.paint,H,ge,null,fr.setPaintProperty),s.by(pe.slot,we.slot)||H.push({command:fr.setSlot,args:[ge,we.slot]}),s.by(pe.filter,we.filter)||H.push({command:fr.setFilter,args:[ge,we.filter]}),s.by(pe.minzoom,we.minzoom)&&s.by(pe.maxzoom,we.maxzoom)||H.push({command:fr.setLayerZoomRange,args:[ge,we.minzoom,we.maxzoom]}),pe)pe.hasOwnProperty($e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&$e!=="slot"&&($e.indexOf("paint.")===0?zl(pe[$e],we[$e],H,ge,$e.slice(6),fr.setPaintProperty):s.by(pe[$e],we[$e])||H.push({command:fr.setLayerProperty,args:[ge,$e,we[$e]]}));for($e in we)we.hasOwnProperty($e)&&!pe.hasOwnProperty($e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&$e!=="slot"&&($e.indexOf("paint.")===0?zl(pe[$e],we[$e],H,ge,$e.slice(6),fr.setPaintProperty):s.by(pe[$e],we[$e])||H.push({command:fr.setLayerProperty,args:[ge,$e,we[$e]]}))}else H.push({command:fr.removeLayer,args:[ge]}),Je=ce[ce.lastIndexOf(ge)+1],H.push({command:fr.addLayer,args:[we,Je]})}(V,I.layers,C)}catch(D){console.warn("Unable to compute style diff:",D),C=[{command:fr.setStyle,args:[I]}]}return C}(this.serialize(),n).filter(w=>!(w.command in XE));if(p.length===0)return!1;const v=p.filter(w=>!(w.command in WE));if(v.length>0)throw new Error(`Unimplemented: ${v.map(w=>w.command).join(", ")}.`);const x=[];return p.forEach(w=>{x.push(this[w.command](...w.args))}),u&&Promise.all(x).then(u).catch(u),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(n){if(n.size===0)return this;for(const[u,p]of n.entries()){if(this.getImage(u))return this.fire(new s.y(new Error(`An image with the name "${u.name}" already exists.`)));this.imageManager.addImage(u,this.scope,p),this._changes.updateImage(u,this.scope)}return this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this}addImage(n,u){return this.getImage(n)?this.fire(new s.y(new Error(`An image with the name "${n.name}" already exists.`))):(this.imageManager.addImage(n,this.scope,u),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this)}updateImage(n,u,p=!1){this.imageManager.updateImage(n,this.scope,u),p&&(this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})))}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(n){return this.modelManager.addModelURLs(n,this.scope),this._updateWorkerModels(),this.fire(new s.z("data",{dataType:"style"})),this}addModel(n,u,p={}){return this._checkLoaded(),this._validate(Te,`models.${n}`,u,null,p)||(this.modelManager.addModel(n,u,this.scope),this.fire(new s.z("data",{dataType:"style"}))),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope,!1,!0),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,u,p={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(eo,`sources.${n}`,u,null,p))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const v=wu(n,u,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));const x=w=>{const I=(w?"symbol:":"other:")+v.id,C=s.B(I,this.scope),D=this._sourceCaches[I]=new Ho(C,v,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=D,D.onAdd(this.map)};x(!1),u.type!=="vector"&&u.type!=="geojson"||x(!0),v.onAdd&&v.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const u=this.getOwnSource(n);if(!u)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===n)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const v=Object.entries(this.stylesheet.iconsets).find(([x,w])=>w.type==="source"&&w.source===n);if(v)return this.fire(new s.y(new Error(`Source "${n}" cannot be removed while iconset "${v[0]}" is using it.`)))}const p=this.getOwnSourceCaches(n);for(const v of p){const x=s.dl(v.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(v.id),v.fire(new s.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,u){this._checkLoaded(),this.getOwnSource(n).setData(u),this._changes.setDirty()}getOwnSource(n){const u=this.getOwnSourceCache(n);return u&&u.getSource()}getOwnSources(){const n=[];for(const u in this._otherSourceCaches){const p=this.getOwnSourceCache(u);p&&n.push(p.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const u in n){const p=n[u]._tiles;for(const v in p){const x=p[v];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const u=this._getTransitionParameters();for(const x of n){if(this._validate(Ta,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(x),w.updateTransitions(u)}else this.ambientLight=new br(x,In||(In=new s.a9({color:new s.aa(s.a6.properties_light_ambient.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(x),w.updateTransitions(u)}else this.directionalLight=new br(x,qr||(qr=new s.a9({direction:new s.ap(s.a6.properties_light_directional.direction),color:new s.aa(s.a6.properties_light_directional.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_directional.intensity),"cast-shadows":new s.aa(s.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new s.aa(s.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.aa(s.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=Object.assign(u,{worldview:this.map.getWorldview()}),v=new s.ac(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(v),this.directionalLight&&this.directionalLight.recalculate(v),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,u=this.ambientLight;if(!n||!u)return;const p=z=>.2126*(z[0]<=.03928?z[0]/12.92:Math.pow((z[0]+.055)/1.055,2.4))+.7152*(z[1]<=.03928?z[1]/12.92:Math.pow((z[1]+.055)/1.055,2.4))+.0722*(z[2]<=.03928?z[2]/12.92:Math.pow((z[2]+.055)/1.055,2.4)),v=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),x=n.properties.get("intensity"),w=n.properties.get("direction"),I=1-s.d3(w.x,w.y,w.z)[2]/90,C=p(v)*x*I,D=u.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),F=u.properties.get("intensity"),V=p(D)*F;return Number(((C+V)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(n==null||n===""&&this.isRootStyle())return this;if(s.dm(n)){const u=s.dn(n),p=this.fragments.find(({id:x})=>x===u);if(!p)return;const v=s.dl(n);return p.style.getFragmentStyle(v)}{const u=this.fragments.find(({id:p})=>p===n);return u?u.style:void 0}}setFeaturesetSelectors(n){if(!n)return;const u={},p=(v,x="")=>`${v}::${x}`;this._featuresetSelectors={};for(const v in n){const x=this._featuresetSelectors[v]=[];for(const w of n[v].selectors){if(w.featureNamespace){const C=this.getOwnLayer(w.layer);if(!C){s.w(`Layer is undefined for selector: ${w.layer}`);continue}const D=p(C.source,C.sourceLayer);if(D in u&&u[D]!==w.featureNamespace){s.w(`"featureNamespace ${w.featureNamespace} of featureset ${v}'s selector is not associated to the same source, skip this selector`);continue}u[D]=w.featureNamespace}let I;if(w.properties)for(const C in w.properties){const D=s.U(w.properties[C]);D.result==="success"&&(I=I||{},I[C]=D.value)}x.push({layerId:w.layer,namespace:w.featureNamespace,properties:I,uniqueFeatureID:w._uniqueFeatureID})}}}getFeaturesetDescriptors(n){const u=this.getFragmentStyle(n);if(!u||!u.stylesheet.featuresets)return[];const p=[];for(const v in u.stylesheet.featuresets)p.push({featuresetId:v,importId:u.scope?u.scope:void 0});return p}getFeaturesetLayers(n,u){const p=this.getFragmentStyle(u),v=p.stylesheet.featuresets;if(!v||!v[n])return this.fire(new s.y(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const x=[];for(const w of v[n].selectors){const I=p.getOwnLayer(w.layer);I&&x.push(I)}return x}getConfigProperty(n,u){const p=this.getFragmentStyle(n);if(!p)return null;const v=s.B(u,p.scope),x=p.options.get(v),w=x?x.value||x.default:null;return w?w.serialize():null}setConfigProperty(n,u,p){const v=this.getFragmentStyle(n);if(!v)return;const x=v.stylesheet.schema;if(!x||!x[u])return;const w=s.U(p);if(w.result!=="success")return void Oh(this,w.value);const I=w.value.expression,C=s.B(u,v.scope),D=v.options.get(C);if(!D)return;let F;const{minValue:V,maxValue:z,stepValue:j,type:G,values:H}=x[u],ee=s.U(x[u].default);ee.result==="success"&&(F=ee.value.expression),F?(this.options.set(C,Object.assign({},D,{value:I,default:F,minValue:V,maxValue:z,stepValue:j,type:G,values:H})),this.updateConfigDependencies(u)):this.fire(new s.y(new Error(`No schema defined for the config option "${u}" in the "${n}" fragment.`)))}getConfig(n){const u=this.getFragmentStyle(n);if(!u)return null;const p=u.stylesheet.schema;if(!p)return null;const v={};for(const x in p){const w=s.B(x,u.scope),I=u.options.get(w),C=I?I.value||I.default:null;v[x]=C?C.serialize():null}return v}setConfig(n,u){const p=this.getFragmentStyle(n);p&&(p.updateConfig(u,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const u=this.getFragmentStyle(n);return u?u.stylesheet.schema:null}setSchema(n,u){const p=this.getFragmentStyle(n);p&&(p.stylesheet.schema=u,p.updateConfig(p._config,u),this.updateConfigDependencies())}updateConfig(n,u){if(this._config=n,n||u)if(u)for(const p in u){let v,x;const w=s.U(u[p].default);if(w.result==="success"&&(v=w.value.expression),n&&n[p]!==void 0){const z=s.U(n[p]);z.result==="success"&&(x=z.value.expression)}const{minValue:I,maxValue:C,stepValue:D,type:F,values:V}=u[p];if(v){const z=s.B(p,this.scope);this.options.set(z,{default:v,value:x,minValue:I,maxValue:C,stepValue:D,type:F,values:V})}else this.fire(new s.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new s.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(n){for(const u of this._configDependentLayers){const p=this.getLayer(u);if(p){if(n&&!p.configDependencies.has(n))continue;p.possiblyEvaluateVisibility(),this._updateLayer(p)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(u=>{const p=u._styleColorTheme.colorThemeOverride?u._styleColorTheme.colorThemeOverride:u._styleColorTheme.colorTheme;if(p){const v=u._evaluateColorThemeData(p);(!u._styleColorTheme.lut&&v!==""||u._styleColorTheme.lut&&v!==u._styleColorTheme.lut.data)&&u.setColorTheme(p)}}),this._changes.setDirty()}addLayer(n,u,p={}){this._checkLoaded();const v=n.id;if(this._layers[v])return void this.fire(new s.y(new Error(`Layer with id "${v}" already exists on this map`)));let x;if(n.type==="custom"){if(Oh(this,s.dp(n)))return;x=s.dq(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(v,n.source),n=s.dk(n),n=Object.assign(n,{source:v})),this._validate(Pe,`layers.${v}`,n,{arrayIndex:-1},p))return;x=s.dq(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}})}x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid);let w=this._order.length;if(u){const F=this._order.indexOf(u);if(F===-1)return void this.fire(new s.y(new Error(`Layer with id "${u}" does not exist on this map.`)));x.slot===this._layers[u].slot?w=F:s.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,v),this._layerOrderChanged=!0,this._layers[v]=x;const I=this.getOwnLayerSourceCache(x),C=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&x.canCastShadows()&&C&&(I.castsShadows=!0);const D=this._changes.getRemovedLayer(x);if(D&&x.source&&I&&x.type!=="custom"){this._changes.discardLayerRemoval(x);const F=s.B(x.source,x.scope);D.type!==x.type?this._changes.updateSourceCache(F,"clear"):(this._changes.updateSourceCache(F,"reload"),I.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(n,u){this._checkLoaded();const p=this._checkLayer(n);if(!p||n===u)return;const v=this._order.indexOf(n);this._order.splice(v,1);let x=this._order.length;if(u){const w=this._order.indexOf(u);if(w===-1)return void this.fire(new s.y(new Error(`Layer with id "${u}" does not exist on this map.`)));p.slot===this._layers[u].slot?x=w:s.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const u=this._checkLayer(n);if(!u)return;u.setEventedParent(null);const p=this._order.indexOf(n);this._order.splice(p,1),delete this._layers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(u.fqid),this._changes.removeLayer(u);const v=this.getOwnLayerSourceCache(u);if(v&&v.castsShadows){let x=!1;for(const w in this._layers)if(this._layers[w].source===u.source&&this._layers[w].canCastShadows()){x=!0;break}v.castsShadows=x}u.onRemove&&u.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const u in this._layers)if(this._layers[u].type===n)return!0;return!1}setLayerZoomRange(n,u,p){this._checkLoaded();const v=this._checkLayer(n);v&&(v.minzoom===u&&v.maxzoom===p||(u!=null&&(v.minzoom=u),p!=null&&(v.maxzoom=p),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,u){this._checkLoaded();const p=this._checkLayer(n);p&&p.slot!==u&&(p.slot=u,this._updateLayer(p))}setFilter(n,u,p={}){this._checkLoaded();const v=this._checkLayer(n);if(v&&!s.by(v.filter,u))return u==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(q,`layers.${v.id}.filter`,u,{layerType:v.type},p)||(v.filter=s.dk(u),this._updateLayer(v)))}getFilter(n){const u=this._checkLayer(n);if(u)return s.dk(u.filter)}setLayoutProperty(n,u,p,v={}){this._checkLoaded();const x=this._checkLayer(n);if(x&&!s.by(x.getLayoutProperty(u),p)){if(p!=null&&(!v||v.validate!==!1)&&Oh(x,oe.call(gs,{key:`layers.${n}.layout.${u}`,layerType:x.type,objectKey:u,value:p,styleSpec:s.a6,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(u,p),x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(n,u){const p=this._checkLayer(n);if(p)return p.getLayoutProperty(u)}setPaintProperty(n,u,p,v={}){this._checkLoaded();const x=this._checkLayer(n);if(!x||s.by(x.getPaintProperty(u),p)||p!=null&&(!v||v.validate!==!1)&&Oh(x,J.call(gs,{key:`layers.${n}.paint.${u}`,layerType:x.type,objectKey:u,value:p,styleSpec:s.a6})))return;const w=x.setPaintProperty(u,p);x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),w&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(n,u){const p=this._checkLayer(n);if(p)return p.getPaintProperty(u)}setFeatureState(n,u){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:C,importId:D}=n.target,F=this.getFragmentStyle(D),V=F.getFeaturesetLayers(C);for(const{source:z,sourceLayer:j}of V)F.setFeatureState({id:n.id,source:z,sourceLayer:j},u)}else if("layerId"in n.target){const{layerId:C}=n.target,D=this.getLayer(C);this.setFeatureState({id:n.id,source:D.source,sourceLayer:D.sourceLayer},u)}return}const p=n.source,v=n.sourceLayer,x=this._checkSource(p);if(!x)return;const w=x.type;if(w==="geojson"&&v)return void this.fire(new s.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!v)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(p);for(const C of I)C.setFeatureState(v,n.id,u)}removeFeatureState(n,u){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:C,importId:D}=n.target,F=this.getFragmentStyle(D),V=F.getFeaturesetLayers(C);for(const{source:z,sourceLayer:j}of V)F.removeFeatureState({id:n.id,source:z,sourceLayer:j},u)}else if("layerId"in n.target){const{layerId:C}=n.target,D=this.getLayer(C);this.removeFeatureState({id:n.id,source:D.source,sourceLayer:D.sourceLayer},u)}return}const p=n.source,v=this._checkSource(p);if(!v)return;const x=v.type,w=x==="vector"?n.sourceLayer:void 0;if(x==="vector"&&!w)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new s.y(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(p);for(const C of I)C.removeFeatureState(w,n.id,u)}getFeatureState(n){if(this._checkLoaded(),"target"in n){let x;if("featuresetId"in n.target){const{featuresetId:w,importId:I}=n.target,C=this.getFragmentStyle(I),D=C.getFeaturesetLayers(w);for(const{source:F,sourceLayer:V}of D){const z=C.getFeatureState({id:n.id,source:F,sourceLayer:V});if(z&&!x)x=z;else if(!s.by(x,z))return void this.fire(new s.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n.target){const{layerId:w}=n.target,I=this.getLayer(w);x=this.getFeatureState({id:n.id,source:I.source,sourceLayer:I.sourceLayer})}return x}const u=n.source,p=n.sourceLayer,v=this._checkSource(u);if(v){if(v.type!=="vector"||p)return n.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(u)[0].getFeatureState(p,n.id);this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),u=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return s.dr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:u,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(n){for(const u of Object.values(this._mergedLayers))n(u)&&this._updateLayer(u)}_updateLayer(n){this._changes.updateLayer(n);const u=this.getLayerSourceCache(n),p=s.B(n.source,n.scope),v=this._changes.getUpdatedSourceCaches();n.source&&!v[p]&&u&&u.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),u.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const u=I=>this._mergedLayers[I].is3D(!!this.terrain),p=this.order,v={},x=[];for(let I=p.length-1;I>=0;I--){const C=p[I];if(u(C)){v[C]=I;for(const D of n){const F=D[C];if(F)for(const V of F)x.push(V)}}}x.sort((I,C)=>C.intersectionZ-I.intersectionZ);const w=[];for(let I=p.length-1;I>=0;I--){const C=p[I];if(u(C))for(let D=x.length-1;D>=0;D--){const F=x[D].feature;if(F.layer&&v[F.layer.id]<I)break;w.push(F),x.pop()}else for(const D of n){const F=D[C];if(F)for(const V of F)w.push(V.feature)}}return w}queryRasterValue(n,u,p){const v=this.getOwnSource(n);return v?v.type!=="raster-array"?(this.fire(new s.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):v.queryRasterArrayValue(u,p):(this.fire(new s.y(new Error(`Source with id "${n}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(n,u,p){let v;u&&!Array.isArray(u)&&u.filter&&(this._validate(q,"queryRenderedFeatures.filter",u.filter,null,u),v=s.b6(u.filter));const x={},w=F=>{if(s_.has(F.type))return;const V=this.getOwnLayerSourceCache(F),z=x[V.id]=x[V.id]||{sourceCache:V,layers:{},has3DLayers:!1};F.is3D(!!this.terrain)&&(z.has3DLayers=!0),z.layers[F.fqid]=z.layers[F.fqid]||{styleLayer:F,targets:[]},z.layers[F.fqid].targets.push({filter:v})};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new s.y(new Error("parameters.layers must be an Array."))),[];for(const F of u.layers){const V=this._layers[F];if(!V)return this.fire(new s.y(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];w(V)}}else for(const F in this._layers)w(this._layers[F]);const I=this._queryRenderedFeatures(n,x,p),C=this._flattenAndSortRenderedFeatures(I),D=[];for(const F of C)s.ds(F.layer.id)===this.scope&&D.push(F);return D}queryRenderedFeatureset(n,u,p){let v;u&&!Array.isArray(u)&&u.filter&&(this._validate(q,"queryRenderedFeatures.filter",u.filter,null,u),v=s.b6(u.filter));const x="mock",w=[];if(u&&u.target)w.push(Object.assign({},u,{targetId:x,filter:v}));else{const F=this.getFeaturesetDescriptors();for(const V of F)w.push({targetId:x,filter:v,target:V});for(const{style:V}of this.fragments){const z=V.getFeaturesetDescriptors();for(const j of z)w.push({targetId:x,filter:v,target:j})}}const I=this.queryRenderedTargets(n,w,p),C=[],D=new Set;for(const F of I)for(const V of F.variants[x])hc(V,F,D)||C.push(new s.dt(F,V));return C}queryRenderedTargets(n,u,p){const v={},x=(I,C,D,F)=>{const V=v[C.id]=v[C.id]||{sourceCache:C,layers:{},has3DLayers:!1};if(V.layers[I.fqid]=V.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D(!!this.terrain)&&(V.has3DLayers=!0),!F)return D.uniqueFeatureID=!1,void V.layers[I.fqid].targets.push(D);V.layers[I.fqid].targets.push(Object.assign({},D,{namespace:F.namespace,properties:F.properties,uniqueFeatureID:F.uniqueFeatureID}))};for(const I of u)if("featuresetId"in I.target){const{featuresetId:C,importId:D}=I.target,F=this.getFragmentStyle(D);if(!F||!F._featuresetSelectors)continue;const V=F._featuresetSelectors[C];if(!V){this.fire(new s.y(new Error(`The featureset '${C}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const z of V){const j=F.getOwnLayer(z.layerId);j&&!s_.has(j.type)&&x(j,F.getOwnLayerSourceCache(j),I,z)}}else if("layerId"in I.target){const{layerId:C}=I.target,D=this.getLayer(C);if(!D||s_.has(D.type))continue;x(D,this.getLayerSourceCache(D),I)}const w=this._queryRenderedFeatures(n,v,p);return this._flattenAndSortRenderedFeatures(w)}_queryRenderedFeatures(n,u,p){const v=[],x=!!this.map._showQueryGeometry,w=un.createFromScreenPoints(n,p);for(const I in u){const C=Ka(w,u[I],this._availableImages,p,x);Object.keys(C).length&&v.push(C)}if(this.placement)for(const I in u){if(!u[I].sourceCache._onlySymbols)continue;const C=Ya(w.screenGeometry,u[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(C).length&&v.push(C)}return v}querySourceFeatures(n,u){const p=u&&u.filter;p&&this._validate(q,"querySourceFeatures.filter",p,null,u);let v=[];const x=this.getOwnSourceCaches(n);for(const w of x)v=v.concat(sa(w,u));return v}addSourceType(n,u,p){return wl.getSourceType(n)?p(new Error(`A source type called "${n}" already exists.`)):(wl.setSourceType(n,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:u.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,u,p={}){this._checkLoaded();const v=this.light.getLight();let x=!1;for(const I in n)if(!s.by(n[I],v[I])){x=!0;break}if(!x)return;const w=this._getTransitionParameters();this.light.setLight(n,u,p),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,u=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),u===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=n;const v=n.source==null;if(u===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const I="terrain-dem-src";this.addSource(I,p.source),p=s.dk(p),p=Object.assign(p,{source:I})}const x=Object.assign({},p),w={};if(this.terrain&&v){x.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(w.style=I.serialize())}if(this._validate(xt,"terrain",x,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&u!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,u),this.fire(new s.z("data",{dataType:"style"}))}else{const x=this.terrain,w=x.get();for(const I of Object.keys(s.a6.terrain))!p.hasOwnProperty(I)&&s.a6.terrain[I].default&&(p[I]=s.a6.terrain[I].default);for(const I in n)if(!s.by(n[I],w[I])){x.set(n,this.options),this.stylesheet.terrain=n;const C=this._getTransitionParameters({duration:0});x.updateTransitions(C),this.fire(new s.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const u=this.fog=new $i(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=u.get();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_createSnow(n){const u=this.snow=new $r(n,this.map.transform,this.scope,this.options);this.stylesheet.snow=u.get();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_createRain(n){const u=this.rain=new Tr(n,this.map.transform,this.scope,this.options);this.stylesheet.rain=u.get();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog;if(!s.by(u.get(),n)){u.set(n,this.options),this.stylesheet.fog=u.get();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}}else this._createFog(n);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(n){if(this._checkLoaded(),!n)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const u=this.snow;if(!s.by(u.get(),n)){u.set(n,this.options),this.stylesheet.snow=u.get();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}}else this._createSnow(n);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(n){if(this._checkLoaded(),!n)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const u=this.rain;if(!s.by(u.get(),n)){u.set(n,this.options),this.stylesheet.rain=u.get();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}}else this._createRain(n);this._markersNeedUpdate=!0}_reloadColorTheme(){const n=()=>{for(const v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()},u=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!u)return this._styleColorTheme.lut=null,void n();const p=this._evaluateColorThemeData(u);this._loadColorTheme(p).then(()=>{this.fire(new s.z("colorthemeset")),n()}).catch(v=>{s.w(`Couldn't set color theme: ${v}`)})}setColorTheme(n){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=n,this._reloadColorTheme()}setImportColorTheme(n,u){const p=this.getFragmentStyle(n);p&&(p._styleColorTheme.colorThemeOverride=u,p._reloadColorTheme())}_getTransitionParameters(n){return{now:s.o.now(),transition:Object.assign(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],u=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?n.push(p):u.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...u)}_createTerrain(n,u){const p=this.terrain=new Ze(n,u,this.scope,this.options,this.map.getWorldview());u===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const v=this._getTransitionParameters({duration:0});p.updateTransitions(v)}_force3DLayerUpdate(){for(const n in this._layers){const u=this._layers[n];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const u=this._layers[n];u.type==="symbol"&&this._updateLayer(u)}}_validate(n,u,p,v,x={}){if(x&&x.validate===!1)return!1;const w=Object.assign({},this.serialize());return Oh(this,n.call(gs,Object.assign({key:u,style:w,value:p,styleSpec:s.a6},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.du.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(n){const u=this.getSourceCaches(n);for(const p of u)p.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}clearLayers(){for(const n in this._mergedLayers){const u=this._mergedLayers[n];u._clear&&u._clear()}}reloadSource(n){const u=this.getSourceCaches(n);for(const p of u)p.resume(),p.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(n=>{n.modelManager.reloadModels(n.scope)})}updateSources(n){let u;this.directionalLight&&(u=Hd(this.directionalLight));const p=new Set;for(const v in this._mergedLayers){const x=this._mergedLayers[v];x.hasElevation()&&!p.has(x.source)&&p.add(x.source)}for(const v in this._mergedSourceCaches){const x=this._mergedSourceCaches[v],w=p.has(x._source.id);x.update(n,void 0,void 0,u,w)}}_generateCollisionBoxes(){for(const n in this._sourceCaches){const u=this._sourceCaches[n];u.resume(),u.reload()}}_updatePlacement(n,u,p,v,x,w,I=!1){let C=!1,D=!1;const F={},V={};for(const z of this._mergedOrder){const j=this._mergedLayers[z];if(j.type!=="symbol")continue;const G=s.B(j.source,j.scope);let H=F[G];if(!H){const K=this.getLayerSourceCache(j);if(!K)continue;const ie=K.getRenderableIds(!0).map(ae=>K.getTileByID(ae));V[G]=ie.slice(),H=F[G]=ie.sort((ae,ce)=>ce.tileID.overscaledZ-ae.tileID.overscaledZ||(ae.tileID.isLessThan(ce.tileID)?-1:1))}const ee=this.crossTileSymbolIndex.addLayer(j,H,u.center.lng,u.projection);C=C||ee}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new s.z("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.o.now(),u.zoom))&&(this.pauseablePlacement=new _t(u,this._mergedOrder,I,p,v,x,this.placement,this.fog&&u.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,F,V,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.o.now()),D=!0),C&&this.pauseablePlacement.placement.setStale()),D||C){this._buildingIndex.onNewFrame(u.zoom);for(let z=0;z<this._mergedOrder.length;z++){const j=this._mergedLayers[this._mergedOrder[z]];if(j.type!=="symbol")continue;const G=this.isLayerClipped(j);this.placement.updateLayerOpacities(j,F[s.B(j.source,j.scope)],z,G?w:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.o.now())}}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,u){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:x})=>x===n.id)!==-1)return void this.fire(new s.y(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!u)return p.push(n),this._loadImports([n],!0);const v=p.findIndex(({id:x})=>x===u);return v===-1&&this.fire(new s.y(new Error(`Import with id "${u}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,v).concat(n).concat(p.slice(v)),this._loadImports([n],!0,u)}updateImport(n,u){this._checkLoaded();const p=this.stylesheet.imports||[],v=this.getImportIndex(n);return v===-1?this:typeof u=="string"?(this.setImportUrl(n,u),this):(u.url&&u.url!==p[v].url&&this.setImportUrl(n,u.url),s.by(u.config,p[v].config)||this.setImportConfig(n,u.config,u.data.schema),s.by(u.data,p[v].data)||this.setImportData(n,u.data),this)}moveImport(n,u){this._checkLoaded();let p=this.stylesheet.imports||[];const v=this.getImportIndex(n);if(v===-1)return this;const x=this.getImportIndex(u);if(x===-1)return this;const w=p[v],I=this.fragments[v];return p=p.filter(({id:C})=>C!==n),this.fragments=this.fragments.filter(({id:C})=>C!==n),this.stylesheet.imports=p.slice(0,x).concat(w).concat(p.slice(x)),this.fragments=this.fragments.slice(0,x).concat(I).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(n,u){this._checkLoaded();const p=this.stylesheet.imports||[],v=this.getImportIndex(n);if(v===-1)return this;p[v].url=u;const x=this.fragments[v];return x.style=this._createFragmentStyle(p[v]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(u),this}setImportData(n,u){this._checkLoaded();const p=this.getImportIndex(n),v=this.stylesheet.imports||[];return p===-1?this:u?(this.fragments[p].style.setState(u),this._reloadImports(),this):(delete v[p].data,this.setImportUrl(n,v[p].url))}setImportConfig(n,u,p){this._checkLoaded();const v=this.getImportIndex(n),x=this.stylesheet.imports||[];if(v===-1)return this;u?x[v].config=u:delete x[v].config;const w=this.fragments[v];p&&w.style.stylesheet&&(w.style.stylesheet.schema=p);const I=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=u,w.style.updateConfig(u,I),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(n);p!==-1&&(u.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(n){const u=(this.stylesheet.imports||[]).findIndex(p=>p.id===n);return u===-1&&this.fire(new s.y(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),u}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const u in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[u];p&&n.push(p.getSource())}return n}getSource(n,u){const p=this.getSourceCache(n,u);return p&&p.getSource()}getLayerSource(n){const u=this.getLayerSourceCache(n);return u&&u.getSource()}getSourceCache(n,u){const p=s.B(n,u);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(n){const u=s.B(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[u]:this._mergedOtherSourceCaches[u]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const u=[];return this._mergedOtherSourceCaches[n]&&u.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&u.push(this._mergedSymbolSourceCaches[n]),u}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const u in n){const p=n[u];p==="reload"?this.reloadSource(u):p==="clear"&&this.clearSource(u)}}updateLayers(n){const u=this._changes.getUpdatedPaintProperties();for(const p of u){const v=this.getLayer(p);v&&v.updateTransitions(n)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(n){this.stylesheet.glyphs=n,this.glyphManager.setURL(n)}getImages(n,u,p){this.imageManager.getImages(u.images,u.scope,p),this._updateTilesForChangedImages();const v=w=>{if(w){const I=u.images.map(C=>s.I.toString(C));w.setDependencies(u.tileID.key,u.type,I)}},x=s.B(u.source,u.scope);v(this._mergedOtherSourceCaches[x]),v(this._mergedSymbolSourceCaches[x]),u.images.some(w=>w.iconsetId)&&this.fire(new s.z("data",{dataType:"style"}))}rasterizeImages(n,u,p){this.imageManager.rasterizeImages(u,p)}getGlyphs(n,u,p){this.glyphManager.getGlyphs(u.stacks,p)}getResource(n,u,p){return s.dv(u,p)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const u=[];return this._otherSourceCaches[n]&&u.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&u.push(this._symbolSourceCaches[n]),u}_isSourceCacheLoaded(n){const u=this.getOwnSourceCaches(n);return u.length===0?(this.fire(new s.y(new Error(`There is no source with ID '${n}'`))),!1):u.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,u){if(!this._clipLayerPresent&&n.type!=="fill-extrusion"&&n.type!=="building")return!1;const p=n.type==="fill-extrusion"&&(n.sourceLayer==="building"||n.sourceLayer==="procedural_buildings"),v=n.type==="building";if(n.is3D(!!this.terrain)){if(p||v||u&&u.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}wl.getSourceType=function(m){return bu[m]},wl.setSourceType=function(m,n){bu[m]=n},wl.registerForPluginStateChange=s.dw;class Zx{execute(n){const u=this._makeBuildingsQueryArea(n),p=this._makeFloorsQueryArea(n),v=n.queryRenderedFeatures(u).reduce((D,F)=>{const V=F.properties.id;return F.properties.type!=="building"||D.some(z=>z.properties.id===V)||D.push(F),D},[]),x=n.queryRenderedFeatures(p).reduce((D,F)=>{const V=F.properties.id;return F.properties.type!=="floor"||D.some(z=>z.properties.id===V)||D.push(F),D},[]),w=[n.getCenter().lng,n.getCenter().lat],I=this._findBuildingAtCenter(w,v),C=v.length>0?v[0]:null;return{floors:x.map(D=>({id:D.properties.id,name:D.properties.name,isDefault:D.properties.is_default,zIndex:D.properties.z_index,connectedFloorIds:D.properties.connected_floor_ids,conflictedFloorIds:D.properties.conflicted_floor_ids,buildingIds:D.properties.building_ids})),building:I?{id:I.properties.id,name:I.properties.name}:{id:C.properties.id,name:C.properties.name}}}_makeBuildingsQueryArea(n){const u=n.transform.width,p=n.transform.height,v=Math.min(u,p)*(1/8),x=.5*(u-v),w=.5*(p-v);return[new s.P(x,w),new s.P(x+v,w+v)]}_makeFloorsQueryArea(n){const u=n.transform.width,p=n.transform.height;return[new s.P(0,0),new s.P(u,p)]}_findBuildingAtCenter(n,u){for(const p of u)if(p.geometry.type==="Polygon"&&this._pointInPolygon(n,p.geometry.coordinates[0]))return p;return null}_pointInPolygon(n,u){let p=!1;for(let v=0,x=u.length-1;v<u.length;x=v++){const w=u[v][0],I=u[v][1],C=u[x][1];I>n[1]!=C>n[1]&&n[0]<(u[x][0]-w)*(n[1]-I)/(C-I)+w&&(p=!p)}return p}}class Kx{constructor(){this._floors=new Map,this._buildings=new Map}append(n){const u=n.building;let p=!1;if(u){const v=u.id;v&&(this._buildings.set(v,u),p||this._buildings.has(v)||(p=!0))}return n.floors.forEach(v=>{const x=v.id;p||this._floors.has(x)||(p=!0),this._floors.set(x,v)}),p}clear(){this._floors.clear(),this._buildings.clear()}getFloors(n=null){const u=Array.from(this._floors.values());return n?u.filter(p=>{const v=p.buildingIds;return!!v&&v.split(";").includes(n)}):u}}class Yx{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage=new Kx}setIndoorData(n){const u=this._featuresStorage.append(n);return this._selectedBuildingId=n.building?n.building.id:null,u}setFloorId(n){const u=this._selectedFloorId!==n;return u&&(this._selectedFloorId=n),u}getCurrentBuildingSelection(){if(!this._selectedBuildingId)return{selectedFloorId:null,floors:[]};const n=this._featuresStorage.getFloors(this._selectedBuildingId),u=this.getActiveFloors().find(p=>{const v=p.buildingIds;if(!v)return!1;const x=v.split(";");return!!this._selectedBuildingId&&x.includes(this._selectedBuildingId)});return{selectedFloorId:u?u.id:null,floors:n}}getActiveFloors(n=!1){const u=this._featuresStorage.getFloors(),p=u.find(C=>C.id===this._selectedFloorId),v=u.filter(C=>C.isDefault===!0);let x=[];if(p)return x=this._calculateCurrentActiveFloors(u,p,v,n),x;if(v.length===0){const C=this._featuresStorage.getFloors(this._selectedBuildingId);x=C.length>0?[C[0]]:[]}else x=v;const w=this._getNonConflictingLastActiveFloors(x),I=[...x,...w];return this._lastActiveFloors=I,I}hasBuildingChanged(n){return this._selectedBuildingId!==(n.building?n.building.id:null)}hasActiveBuilding(){return this._selectedBuildingId!==null}isEmpty(){return this._selectedFloorId===null&&this._selectedBuildingId===null&&this._lastActiveFloors.length===0}_calculateCurrentActiveFloors(n,u,p,v){if(!u)return this._getNonConflictingDefaultFloors(this._lastActiveFloors,p);const x=this._getConnectedFloors(u,n);return v?this._buildExplicitSelectionFloors(u,x,p):this._buildImplicitSelectionFloors(x,p)}_getConnectedFloors(n,u){const p=n.connectedFloorIds;if(!p)return[];const v=new Set(p.split(";"));return u.filter(x=>v.has(x.id))}_buildExplicitSelectionFloors(n,u,p){const v=[n,...u],x=this._getNonConflictingLastActiveFloors(v),w=[...v,...x],I=this._deduplicateFloors(w),C=this._getConflictingFloorIdsFrom(I),D=p.filter(V=>!C.has(V.id)),F=[...I,...D];return this._lastActiveFloors=F,F}_buildImplicitSelectionFloors(n,u){const p=this._getConflictingFloorIdsFrom(this._lastActiveFloors),v=u.filter(w=>!p.has(w.id)),x=this._deduplicateFloors([...this._lastActiveFloors,...v]);return this._lastActiveFloors=x,x}_getNonConflictingDefaultFloors(n,u){const p=this._getConflictingFloorIdsFrom(n),v=u.filter(w=>!p.has(w.id)),x=this._deduplicateFloors([...n,...v]);return this._lastActiveFloors=x,x}_deduplicateFloors(n){const u=new Set;return n.filter(p=>{const v=p.id;return!u.has(v)&&(u.add(v),!0)})}_getConflictingFloorIdsFrom(n){const u=new Set;return n.forEach(p=>{const v=p.conflictedFloorIds;v&&v.split(";").forEach(x=>u.add(x))}),u}_getNonConflictingLastActiveFloors(n){if(!this._lastActiveFloors||this._lastActiveFloors.length===0)return[];const u=new Set(n.map(v=>v.id)),p=this._getConflictingFloorIdsFrom(n);return this._lastActiveFloors.filter(v=>{const x=v.id;return!u.has(x)&&!p.has(x)})}_isFloorConflicted(n,u){const p=n.id;return u.some(v=>{const x=v.conflictedFloorIds;return!!x&&x.split(";").includes(p)})}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage.clear()}}class Fh extends s.E{constructor(n){super(),s.aY(["_onLoad","_onMove"],this),this._map=n,this._floorSelectionState=new Yx,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.off("load",this._onLoad),this._map.off("move",this._onMove),this._map=null,this._floorSelectionState=null}selectFloor(n){this._floorSelectionState.setFloorId(n)&&this._updateIndoorConfig(!0)}_onLoad(){this._map.style.forEachFragmentStyle(n=>{n.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new s.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=n.scope,this._indoorDataQuery=new Zx))}),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<15)return void this._clearIndoorData();const n=this._indoorDataQuery.execute(this._map);if(!n||n.floors.length===0||this._map.transform.zoom<16)this._clearIndoorData();else if(this._floorSelectionState.hasBuildingChanged(n)){if(!n.building&&this._floorSelectionState.getActiveFloors().length<=0)return void this._clearIndoorData();this._setIndoorData(n),n.building&&this._updateIndoorSelector()}else this._setIndoorData(n)}_setIndoorData(n){this._floorSelectionState.setIndoorData(n)&&this._updateIndoorConfig()}_clearIndoorData(){this._floorSelectionState.isEmpty()||(this._floorSelectionState.reset(),this._updateIndoorSelector(),this._map.setConfigProperty(this._scope,"activeFloors",["literal",[]]))}_updateIndoorSelector(){const n=this._floorSelectionState.getCurrentBuildingSelection(),u=n.floors.map(p=>({id:p.id,name:p.name,shortName:p.zIndex.toString(),levelOrder:p.zIndex}));this.fire(new s.z("indoorupdate",{selectedFloorId:n.selectedFloorId,floors:u}))}_updateIndoorConfig(n=!1){const u=this._floorSelectionState.getActiveFloors(n).map(p=>p.id)||[];this._map.setConfigProperty(this._scope,"activeFloors",["literal",u])}}var xp=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Q0=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,ey=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Wd="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Xd=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,ty=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,a_=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Qa=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,l_=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Ft=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,iy=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Zd=[];Tl(xp,Zd),Tl(ey,Zd),Tl(Q0,Zd);const Kd={"_prelude_fog.vertex.glsl":ty,"_prelude_terrain.vertex.glsl":Xd,"_prelude_shadow.vertex.glsl":Ft,"_prelude_fog.fragment.glsl":a_,"_prelude_shadow.fragment.glsl":iy,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Qa,"_prelude_raster_particle.glsl":l_},bp={};vr("",Xd),vr(a_,ty),vr(iy,Ft),vr(Qa,""),vr(l_,"");const wp=vr(Q0,ey),gc=xp;var c_={background:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:vr(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:vr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:vr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:vr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:vr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:vr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:vr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:vr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:vr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:vr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:vr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:vr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:vr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:vr(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:vr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:vr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:vr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:vr(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:vr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:vr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Wd),skyboxGradient:vr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Wd),skyboxCapture:vr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:vr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:vr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:vr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:vr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:vr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:vr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:vr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Tl(m,n){const u=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of u)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=p.split(" ");for(const x of v)n.includes(x)||n.push(x)}}function vr(m,n){const u=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,v={},x=[],w=[];if(m=m.replace(u,(C,D)=>(w.push(D),"")),(n=n.replace(u,(C,D)=>(x.push(D),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let I=[...Zd];Tl(m,I),Tl(n,I);for(const C of[...x,...w])Kd[C]||console.error(`Undefined include: ${C}`),bp[C]||(bp[C]=[],Tl(Kd[C],bp[C])),I=[...I,...bp[C]];return{fragmentSource:m=m.replace(p,(C,D,F,V,z)=>(v[z]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${z}
in ${F} ${V} ${z};
#else
uniform ${F} ${V} u_${z};
#endif
`:D==="initialize"?`
#ifdef HAS_UNIFORM_u_${z}
    ${F} ${V} ${z} = u_${z};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    in ${F} ${V} ${z};
#endif
`:D==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(p,(C,D,F,V,z)=>{const j=V==="float"?"vec2":V,G=z.match(/color/)?"color":j;return D==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${z}
in ${F} ${V} a_${z};
#endif
`:v[z]?D==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
in ${F} ${j} a_${z};
out ${F} ${V} ${z};
#else
uniform ${F} ${V} u_${z};
#endif
`:D==="initialize"?G==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${F} ${V} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${G}(a_${z}, u_${z}_t);
#else
    ${F} ${V} ${z} = u_${z};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    in ${F} ${V} a_${z};
    out ${F} ${V} ${z};
#endif
`:D==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    ${z} = a_${z};
#endif
`:void 0:D==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
in ${F} ${j} a_${z};
#else
uniform ${F} ${V} u_${z};
#endif
`:D==="define-instanced"?G==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${z}0;
in vec4 a_${z}1;
in vec4 a_${z}2;
in vec4 a_${z}3;
#else
uniform ${F} ${V} u_${z};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${F} ${j} a_${z};
#else
uniform ${F} ${V} u_${z};
#endif
`:D==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    ${F} ${V} ${z} = a_${z};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${F} ${V} ${z} = a_${z};
#else
    ${F} ${V} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${F} ${V} ${z} = unpack_mix_${G}(a_${z}, u_${z}_t);
#else
    ${F} ${V} ${z} = u_${z};
#endif
`}),usedDefines:I,vertexIncludes:x,fragmentIncludes:w}}class Yd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,u,p,v,x,w,I,C){this.context=n;let D=this.boundPaintVertexBuffers.length!==v.length;for(let V=0;!D&&V<v.length;V++)this.boundPaintVertexBuffers[V]!==v[V]&&(D=!0);let F=this.boundDynamicVertexBuffers.length!==I.length;for(let V=0;!F&&V<I.length;V++)this.boundDynamicVertexBuffers[V]!==I[V]&&(F=!0);if(!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==p||D||F||this.boundIndexBuffer!==x||this.boundVertexOffset!==w)this.freshBind(u,p,v,x,w,I,C);else{n.bindVertexArrayOES.set(this.vao);for(const V of I)V&&(V.bind(),C&&V.instanceCount&&V.setVertexAttribDivisor(n.gl,u,C));x&&x.dynamicDraw&&x.bind()}}freshBind(n,u,p,v,x,w,I){const C=this.context,D=C.gl;this.vao&&this.destroy(),this.vao=C.gl.createVertexArray(),C.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=w,u.enableAttributes(D,n),u.bind(),u.setVertexAttribPointers(D,n,x);for(const F of p)F.enableAttributes(D,n),F.bind(),F.setVertexAttribPointers(D,n,x);for(const F of w)F&&(F.enableAttributes(D,n),F.bind(),F.setVertexAttribPointers(D,n,x),I&&F.instanceCount&&F.setVertexAttribDivisor(D,n,I));v&&v.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ZE(m,n){const u=Math.pow(2,n.canonical.z),p=n.canonical.y;return[new s.ae(0,p/u).toLngLat().lat,new s.ae(0,(p+1)/u).toLngLat().lat]}function KE(m,n,u,p,v,x,w){const I=m.context,C=I.gl,D=u.hillshadeFBO;if(!D)return;m.prepareDrawTile();const F=m.isTileAffectedByFog(n),V=m.getOrCreateProgram("hillshade",{overrideFog:F});I.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,D.colorAttachment.get());const z=((ee,K,ie,ae)=>{const ce=ie.paint.get("hillshade-shadow-color"),ve=ie.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",_e=ie.paint.get("hillshade-highlight-color"),xe=ie.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ge=ie.paint.get("hillshade-accent-color"),pe=ie.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",we=ie.paint.get("hillshade-emissive-strength");let Je=s.an(ie.paint.get("hillshade-illumination-direction"));if(ie.paint.get("hillshade-illumination-anchor")==="viewport")Je-=ee.transform.angle;else if(ee.style&&ee.style.enable3dLights()&&ee.style.directionalLight){const ot=ee.style.directionalLight.properties.get("direction"),Xe=s.d3(ot.x,ot.y,ot.z);Je=s.an(Xe[1])}const $e=!ee.options.moving;return{u_matrix:ae||ee.transform.calculateProjMatrix(K.tileID.toUnwrapped(),$e),u_image:0,u_latrange:ZE(0,K.tileID),u_light:[ie.paint.get("hillshade-exaggeration"),Je],u_shadow:ce.toPremultipliedRenderColor(ve?null:ie.lut),u_highlight:_e.toPremultipliedRenderColor(xe?null:ie.lut),u_emissive_strength:we,u_accent:ge.toPremultipliedRenderColor(pe?null:ie.lut)}})(m,u,p,m.terrain?n.projMatrix:null);m.uploadCommonUniforms(I,V,n.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:G,tileBoundsSegments:H}=m.getTileBoundsBuffers(u);V.draw(m,C.TRIANGLES,v,x,w,Bi.disabled,z,p.id,j,G,H)}function u_(m,n,u){if(!n.needsDEMTextureUpload)return;const p=m.context,v=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||m.getTileTexture(u.stride);const x=u.getPixels();n.demTexture?n.demTexture.update(x,{premultiply:!1}):n.demTexture=new s.T(p,x,v.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function YE(m,n,u){const p=m.context,v=p.gl;if(!n.dem)return;const x=n.dem;if(p.activeTexture.set(v.TEXTURE1),u_(m,n,x),!n.demTexture)return;n.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const w=x.dim;p.activeTexture.set(v.TEXTURE0);let I=n.hillshadeFBO;if(!I){const z=new s.T(p,{width:w,height:w,data:null},v.RGBA8);z.bind(v.LINEAR,v.CLAMP_TO_EDGE),I=n.hillshadeFBO=p.createFramebuffer(w,w,!0,"renderbuffer"),I.colorAttachment.set(z.texture)}p.bindFramebuffer.set(I.framebuffer),p.viewport.set([0,0,w,w]);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:D,tileBoundsSegments:F}=m.getMercatorTileBoundsBuffers(),V=[];m.linearFloatFilteringSupported()&&V.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:V}).draw(m,v.TRIANGLES,Gt.disabled,Pi.disabled,Di.unblended,Bi.disabled,((z,j)=>{const G=j.stride,H=s.bC();return s.cd(H,0,s.al,-s.al,0,0,1),s.br(H,H,[0,-s.al,0]),{u_matrix:H,u_image:1,u_dimension:[G,G],u_zoom:z.overscaledZ}})(n.tileID,x),u.id,C,D,F),n.needsHillshadePrepare=!1}class Un{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Jx extends Un{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const u=this.current;(n.r!==u.r||n.g!==u.g||n.b!==u.b||n.a!==u.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class ry extends Un{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class JE extends Un{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class QE extends Un{getDefault(){return[!0,!0,!0,!0]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||n[3]!==u[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class eI extends Un{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class tI extends Un{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Qx extends Un{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const u=this.current;(n.func!==u.func||n.ref!==u.ref||n.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class iI extends Un{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class h_ extends Un{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=n,this.dirty=!1}}class rI extends Un{getDefault(){return[0,1]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class eb extends Un{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=n,this.dirty=!1}}class ny extends Un{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class d_ extends Un{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.BLEND):u.disable(u.BLEND),this.current=n,this.dirty=!1}}class sy extends Un{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||n[3]!==u[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class zh extends Un{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const u=this.current;(n.r!==u.r||n.g!==u.g||n.b!==u.b||n.a!==u.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Jd extends Un{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class f_ extends Un{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=n,this.dirty=!1}}class p_ extends Un{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Qd extends Un{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let tb=class extends Un{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class oy extends Un{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class ib extends Un{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||n[3]!==u[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class ef extends Un{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class m_ extends Un{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class __ extends Un{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class ay extends Un{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class g_ extends Un{getDefault(){return null}set(n){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Tp extends Un{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class rb extends Un{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class nb extends Un{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class sb extends Un{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Mu extends Un{constructor(n,u){super(n),this.context=n,this.parent=u}getDefault(){return null}}class ob extends Mu{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class ab extends Mu{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class nI extends Mu{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,this.attachment(),u.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class sI extends ab{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const ly=(m,n,u)=>({u_matrix:m,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:u}),y_=(m,n,u,p,v,x,w,I,C,D,F,V,z,j,G,H)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:u,u_zoom_transition:v,u_merc_center:x,u_image0:0,u_frustum_tl:w,u_frustum_tr:I,u_frustum_br:C,u_frustum_bl:D,u_globe_pos:F,u_globe_radius:V,u_viewport:z,u_grid_matrix:H?Float32Array.from(H):new Float32Array(9),u_skirt_height:j,u_far_z_cutoff:G});function v_(m,n){return m!=null&&n!=null&&!(!m.hasData()||!n.hasData())&&m.demTexture!=null&&n.demTexture!=null&&m.tileID.key!==n.tileID.key}const ku=new class{constructor(){this.operations={}}newMorphing(m,n,u,p,v){if(m in this.operations){const x=this.operations[m];x.to.tileID.key!==u.tileID.key&&(x.queued=u)}else this.operations[m]={startTime:p,phase:0,duration:v,from:n,to:u,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const n=this.operations[m];return{from:n.from,to:n.to,phase:n.phase}}update(m){for(const n in this.operations){const u=this.operations[n];for(u.phase=(m-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,m)){delete this.operations[n];break}}}_nextOp(m,n){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=n,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},cy={0:null,1:"TERRAIN_VERTEX_MORPHING"};function uy(m,n,u){if(n===0)return 0;const p=n<1&&u===514?.25/n:1;return 6*Math.pow(1.5,22-m)*Math.max(n,1)*p}function oI(m,n){const u=1<<m.z;return!n&&(m.x===0||m.x===u-1)||m.y===0||m.y===u-1}const Nh=m=>({u_matrix:m});function Bh(m,n,u,p,v){if(v>0){const x=s.o.now(),w=(x-m.timeAdded)/v,I=n?(x-n.timeAdded)/v:-1,C=u.getSource(),D=p.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),F=!n||Math.abs(n.tileID.overscaledZ-D)>Math.abs(m.tileID.overscaledZ-D),V=F&&m.refreshedUponExpiration?1:s.aA(F?w:1-I,0,1);return n?{opacity:1,mix:1-V,isFading:w<1}:{opacity:V,mix:0,isFading:w<1}}return{opacity:1,mix:0,isFading:!1}}class lb extends Ho{constructor(n){const u=wu("mock-dem",{type:"raster-dem",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("mock-dem",u,!1),u.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,u){n.state="loaded",u(null)}}class el extends Ho{constructor(n){const u=wu("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,u,p){if(n.freezeTileCoverage)return;this.transform=n;const v=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,w)=>{if(x[w.key]="",!this._tiles[w.key]){const I=new fc(w,this._source.tileSize*w.overscaleFactor(),n.tileZoom,void 0,void 0,this._source.worldview);I.state="loaded",this._tiles[w.key]=I}return x},{});for(const x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(n){const u=this.proxyCachedFBO[n];if(u!==void 0){const p=Object.values(u);this.renderCachePool.push(...p),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class x_ extends s.aO{constructor(n,u,p){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=u,this.projMatrix=p}}class Ep extends s.dH{constructor(n,u){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,v,x]=function(C){const D=new s.bd,F=new s.b1,V=131;D.reserve(17161),F.reserve(33800);const z=s.al/128,j=s.al+z/2,G=j+z;for(let ee=-z;ee<G;ee+=z)for(let K=-z;K<G;K+=z){const ie=K<0||K>j||ee<0||ee>j?24575:0,ae=s.aA(Math.round(K),0,s.al),ce=s.aA(Math.round(ee),0,s.al);D.emplaceBack(ae+ie,ce)}const H=(ee,K)=>{const ie=K*V+ee;F.emplaceBack(ie+1,ie,ie+V),F.emplaceBack(ie+V,ie+V+1,ie+1)};for(let ee=1;ee<129;ee++)for(let K=1;K<129;K++)H(K,ee);return[0,129].forEach(ee=>{for(let K=0;K<130;K++)H(K,ee),H(ee,K)}),[D,F,32768]}(),w=n.context;this.gridBuffer=w.createVertexBuffer(p,s.bf.members),this.gridIndexBuffer=w.createIndexBuffer(v),this.gridSegments=s.bg.simpleSegment(0,0,p.length,v.length),this.gridNoSkirtSegments=s.bg.simpleSegment(0,0,p.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new el(u.map),this.orthoMatrix=s.bC(),s.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.al,0,s.al,0,1);const I=w.gl;this._overlapStencilMode=new Pi({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new lb(u.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,u,p){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const v=n.terrain.properties,x=n.terrain.drapeRenderMode===0,w=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.o.now();const I=n.terrain&&n.terrain.scope,C=v.get("source"),D=x?this._mockSourceCache:n.getSourceCache(C,I);if(!D)return void s.w(`Couldn't find terrain source "${C}".`);if(this.sourceCache=D,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=w?this.calculateExaggeration(u):v.get("exaggeration"),!u.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;const F=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const V=this.getScaledDemTileSize();this.sourceCache.update(u,V,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),u.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0,this._previousZoom=u.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const u=this._previousCameraAltitude,p=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=p;const v=u!=null?p-u:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;const x=n.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(x);let I=x-this._previousZoom;const C=this._previousUpdateTimestamp;let D=x;this._evaluationZoom!=null&&(D=this._evaluationZoom,Math.abs(x-D)>.5&&(I=.5*(x-D+I)),I*v<0&&(D+=I)),this._evaluationZoom=D;const F=w.getExaggeration(D),V=F===w.getExaggeration(Math.max(0,D-.1));if(V&&Math.abs(F-this._exaggeration)<.01)return F;let z=Math.min(.1,.00375*(this._updateTimestamp-C));return(V||F<.1||Math.abs(I)<1e-4)&&(z=Math.min(.2,4*z)),s.ak(this._exaggeration,F,z)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.dataType==="source"&&n.coord?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(s.ae.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=u.getIds().map(C=>{const D=u.getTileByID(C).tileID;return D.projMatrix=p.calculateProjMatrix(D.toUnwrapped()),D});(function(C,D){const F=D.transform.pointCoordinate(D.transform.getCameraPoint()),V=new s.P(F.x,F.y);C.sort((z,j)=>{if(j.overscaledZ-z.overscaledZ)return j.overscaledZ-z.overscaledZ;const G=new s.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),H=new s.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),ee=V.mult(1<<z.canonical.z);return ee.x-=.5,ee.y-=.5,ee.distSqr(G)-ee.distSqr(H)})})(v,this.painter);const x=this.proxyToSource||{};this.proxyToSource={},v.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const w=this._style._mergedSourceCaches;for(const C in w){const D=w[C];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,n[C],x),D.usedForTerrain))continue;const F=n[C];D.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[u.id]=v.map(C=>new x_(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const D=this.terrainTileForTile[C.key];if(!D)continue;const F=D.tileID.key;F in I||(this._visibleDemTiles.push(D),I[F]=F)}}_assignTerrainTiles(n){this._initializing||n.forEach(u=>{if(this.terrainTileForTile[u.key])return;const p=this._findTileCoveringTileID(u,this.sourceCache);p&&(this.terrainTileForTile[u.key]=p)})}_prepareDEMTextures(){const n=this.painter.context,u=n.gl;for(const p in this.terrainTileForTile){const v=this.terrainTileForTile[p],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(n.activeTexture.set(u.TEXTURE1),u_(this.painter,v,x))}}_prepareDemTileUniforms(n,u,p,v){if(!u||u.demTexture==null)return!1;const x=n.tileID.canonical,w=Math.pow(2,u.tileID.canonical.z-x.z),I=v||"";return p[`u_dem_tl${I}`]=[x.x*w%1,x.y*w%1],p[`u_dem_scale${I}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const u=this._visibleDemTiles.reduce((p,v)=>{if(!v.dem)return p;const x=v.dem.tree.minimums[0];return x>0&&n++,p+x},0);return n?u/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,u=n.gl;n.activeTexture.set(u.TEXTURE2);const p=this._getLoadedAreaMinimum(),v=new s.dI({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(v,{premultiply:!1}):x=this._emptyDEMTexture=new s.T(n,v,u.R32F,{premultiply:!1}),x}setupElevationDraw(n,u,p){const v=this.painter.context,x=v.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};w.u_exaggeration=this.exaggeration();let I=null,C=null,D=1;if(p&&p.morphing&&this._useVertexMorphing){const j=p.morphing.srcDemTile,G=p.morphing.dstDemTile;D=p.morphing.phase,j&&G&&(this._prepareDemTileUniforms(n,j,w,"_prev")&&(C=j),this._prepareDemTileUniforms(n,G,w)&&(I=G))}const F=j=>j&&j.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST;let V=null;var z;if(this.enabled?C&&I?(V=I.demTexture,v.activeTexture.set(x.TEXTURE4),C.demTexture.bind(F(C),x.CLAMP_TO_EDGE),w.u_dem_lerp=D):(I=this.terrainTileForTile[n.tileID.key],V=this._prepareDemTileUniforms(n,I,w)?I.demTexture:this.emptyDEMTexture):V=this.emptyDEMTexture,v.activeTexture.set(x.TEXTURE2),V&&(w.u_dem_size=(z=V).size[0]===1?1:z.size[0]-2,V.bind(F(I),x.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,u,w),p&&p.useMeterToDem&&I){const j=(1<<I.tileID.canonical.z)*s.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=j}if(p&&p.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),u.setTerrainUniformValues(v,w),this.painter.transform.projection.name==="globe"){const j=this.globeUniformValues(this.painter.transform,n.tileID.canonical,p&&p.useDenormalizedUpVectorScale);u.setGlobeUniformValues(v,j)}}globeUniformValues(n,u,p){const v=n.projection;return{u_tile_tl_up:v.upVector(u,0,0),u_tile_tr_up:v.upVector(u,s.al,0),u_tile_br_up:v.upVector(u,s.al,s.al),u_tile_bl_up:v.upVector(u,0,s.al),u_tile_up_scale:p?s.dJ(1):v.upVectorScale(u,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const u=this.painter,p=this.painter.context;n.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,x,w,I,C){if(v.transform.projection.name==="globe")(function(D,F,V,z,j){const G=D.context,H=G.gl;let ee,K;const ie=D.transform,ae=s.dA(D,G,ie),ce=(ot,Xe)=>{if(K===Xe)return;const nt=[cy[Xe],"PROJECTION_GLOBE_VIEW"];ae&&nt.push("CUSTOM_ANTIALIASING");const Dt=D.isTileAffectedByFog(ot);ee=D.getOrCreateProgram("globeRaster",{defines:nt,overrideFog:Dt}),K=Xe},ve=D.colorModeForRenderPass(),_e=new Gt(H.LEQUAL,Gt.ReadWrite,D.depthRangeFor3D);ku.update(j);const xe=s.dB(ie),ge=[s.aF(ie.center.lng),s.aJ(ie.center.lat)],pe=D.globeSharedBuffers,we=[ie.width*s.o.devicePixelRatio,ie.height*s.o.devicePixelRatio],Je=Float32Array.from(ie.globeMatrix),$e={useDenormalizedUpVectorScale:!0};{const ot=D.transform,Xe=uy(ot.zoom,F.exaggeration(),F.sourceCache._source.tileSize);K=-1;const nt=H.TRIANGLES;for(const Dt of z){const Ye=V.getTile(Dt),De=Pi.disabled,ct=F.prevTerrainTileForTile[Dt.key],tt=F.terrainTileForTile[Dt.key];v_(ct,tt)&&ku.newMorphing(Dt.key,ct,tt,j,250),G.activeTexture.set(H.TEXTURE0),Ye.texture&&Ye.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const bt=ku.getMorphValuesForProxy(Dt.key),kt=bt?1:0;bt&&Object.assign($e,{morphing:{srcDemTile:bt.from,dstDemTile:bt.to,phase:s.dz(bt.phase)}});const $t=s.dC(Dt.canonical),Ct=s.dD($t.getCenter().lat),It=s.dE(Dt.canonical,$t,Ct,ot.worldSize/ot._pixelsPerMercatorPixel),fi=s.bk(s.dF(Dt.canonical)),li=y_(ot.expandedFarZProjMatrix,Je,xe,fi,s.aj(ot.zoom),ge,ot.frustumCorners.TL,ot.frustumCorners.TR,ot.frustumCorners.BR,ot.frustumCorners.BL,ot.globeCenterInViewSpace,ot.globeRadius,we,Xe,ot._farZ,It);if(ce(Dt,kt),ee&&(F.setupElevationDraw(Ye,ee,$e),D.uploadCommonUniforms(G,ee,Dt.toUnwrapped()),pe)){const[di,oi,Vi]=pe.getGridBuffers(Ct,Xe!==0);ee.draw(D,nt,_e,De,ve,Bi.backCCW,li,"globe_raster",di,oi,Vi)}}}if(pe&&(D.renderDefaultNorthPole||D.renderDefaultSouthPole)){const ot=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ae&&ot.push("CUSTOM_ANTIALIASING"),ee=D.getOrCreateProgram("globeRaster",{defines:ot});for(const Xe of z){const{x:nt,y:Dt,z:Ye}=Xe.canonical,De=Dt===0,ct=Dt===(1<<Ye)-1,[tt,bt,kt,$t]=pe.getPoleBuffers(Ye,!1);if($t&&(De||ct)){const Ct=V.getTile(Xe);G.activeTexture.set(H.TEXTURE0),Ct.texture&&Ct.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let It=s.dG(Ye,nt,ie);const fi=s.bk(s.dF(Xe.canonical)),li=(di,oi)=>di.draw(D,H.TRIANGLES,_e,Pi.disabled,ve,Bi.disabled,y_(ie.expandedFarZProjMatrix,It,It,fi,0,ge,ie.frustumCorners.TL,ie.frustumCorners.TR,ie.frustumCorners.BR,ie.frustumCorners.BL,ie.globeCenterInViewSpace,ie.globeRadius,we,0,ie._farZ),"globe_pole_raster",oi,kt,$t);F.setupElevationDraw(Ct,ee,$e),D.uploadCommonUniforms(G,ee,Xe.toUnwrapped()),De&&D.renderDefaultNorthPole&&li(ee,tt),ct&&D.renderDefaultSouthPole&&(It=s.cR(s.bC(),It,[1,-1,1]),li(ee,bt))}}}})(v,x,w,I,C);else{const D=v.context,F=D.gl;let V,z;const j=v.shadowRenderer,G=Ru(v,v.longestCutoffRange),H=ve=>{if(z===ve)return;const _e=[];_e.push(cy[ve]),G.shouldRenderCutoff&&_e.push("RENDER_CUTOFF"),j&&(_e.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&_e.push("NORMAL_OFFSET")),V=v.getOrCreateProgram("terrainRaster",{defines:_e}),z=ve},ee=v.colorModeForRenderPass(),K=new Gt(F.LEQUAL,Gt.ReadWrite,v.depthRangeFor3D);ku.update(C);const ie=v.transform,ae=uy(ie.zoom,x.exaggeration(),x.sourceCache._source.tileSize);let ce=[0,0,0];if(j){const ve=v.style.directionalLight,_e=v.style.ambientLight;ve&&_e&&(ce=Ul(v.style,ve,_e))}{z=-1;const ve=F.TRIANGLES,[_e,xe]=[x.gridIndexBuffer,x.gridSegments];for(const ge of I){const pe=w.getTile(ge),we=Pi.disabled,Je=x.prevTerrainTileForTile[ge.key],$e=x.terrainTileForTile[ge.key];v_(Je,$e)&&ku.newMorphing(ge.key,Je,$e,C,250),D.activeTexture.set(F.TEXTURE0),pe.texture&&pe.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const ot=ku.getMorphValuesForProxy(ge.key),Xe=ot?1:0;let nt;ot&&(nt={morphing:{srcDemTile:ot.from,dstDemTile:ot.to,phase:s.dz(ot.phase)}});const Dt=ly(ge.projMatrix,oI(ge.canonical,ie.renderWorldCopies)?ae/10:ae,ce);if(H(Xe),!V)continue;x.setupElevationDraw(pe,V,nt);const Ye=ge.toUnwrapped();j&&j.setupShadows(Ye,V),v.uploadCommonUniforms(D,V,Ye,null,G),V.draw(v,ve,K,we,ee,Bi.backCCW,Dt,"terrain_raster",x.gridBuffer,_e,xe)}}}}(u,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const u=this.painter,p=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],w=this._drapedRenderBatches.shift(),I=u.style.order,C=[];let D=0;for(const F of x){const V=v.getTileByID(F.proxyTileKey),z=v.proxyCachedFBO[F.key]?v.proxyCachedFBO[F.key][n]:void 0,j=z!==void 0?v.renderCache[z]:this.pool[D++],G=z!==void 0;if(V.texture=j.tex,G&&!j.dirty){C.push(V.tileID);continue}let H;p.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(p.clear({color:s.ao.transparent,stencil:0}),j.dirty=!1);for(let ee=w.start;ee<=w.end;++ee){const K=u.style._mergedLayers[I[ee]];if(K.isHidden(u.transform.zoom))continue;const ie=u.style.getLayerSourceCache(K),ae=ie?this.proxyToSource[F.key][ie.id]:[F];if(!ae)continue;const ce=ae;p.viewport.set([0,0,j.fb.width,j.fb.height]),H!==(ie?ie.id:null)&&(this._setupStencil(j,ae,K,ie),H=ie?ie.id:null),u.renderLayer(u,ie,K,ce)}if(this._drapedRenderBatches.length===0)for(const ee of this._pendingGroundEffectLayers){const K=u.style._mergedLayers[I[ee]];if(K.isHidden(u.transform.zoom))continue;const ie=u.style.getLayerSourceCache(K),ae=ie?this.proxyToSource[F.key][ie.id]:[F];if(!ae)continue;const ce=ae;p.viewport.set([0,0,j.fb.width,j.fb.height]),H!==(ie?ie.id:null)&&(this._setupStencil(j,ae,K,ie),H=ie?ie.id:null),u.renderLayer(u,ie,K,ce)}this.renderedToTile?(j.dirty=!0,C.push(V.tileID)):G||--D,D===5&&(D=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,u.width,u.height]),w.end+1}postRender(){}isLayerOrderingCorrect(n){const u=n.order.length;let p=-1,v=u;for(let x=0;x<u;++x)this._style.isLayerDraped(n._mergedLayers[n.order[x]])?p=Math.max(p,x):v=Math.min(v,x);return v>p}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{n=Math.min(n,u.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,u,p){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const w=x.tileID,I=1<<w.overscaledZ,{x:C,y:D}=w.canonical,F=C/I,V=(C+1)/I,z=D/I,j=(D+1)/I;return{minx:F,miny:z,maxx:V,maxy:j,t:x.dem.tree.raycastRoot(F,z,V,j,n,u,p),tile:x}});v.sort((x,w)=>(x.t!==null?x.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const x of v){if(x.t==null)return null;const w=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,n,u,p);if(w!=null)return w}return null}_createFBO(){const n=this.painter.context,u=n.gl,p=this.drapeBufferSize;n.activeTexture.set(u.TEXTURE0);const v=new s.T(n,{width:p[0],height:p[1],data:null},u.RGBA8);v.bind(u.LINEAR,u.CLAMP_TO_EDGE);const x=n.createFramebuffer(p[0],p[1],!0,null);return x.colorAttachment.set(v.texture),x.depthAttachment=new sI(n,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const u=this._style._mergedLayers[n],p=u.isHidden(this.painter.transform.zoom);return u.type==="hillshade"||u.type==="custom"?!p&&u.shouldRedrape():!p&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const p of this._style.getSources())if(p instanceof io){n=!0;break}if(!n)return;const u={};for(let p=0;p<this._style.order.length;++p){const v=this._style._mergedLayers[this._style.order[p]],x=this._style.getLayerSourceCache(v);if(x&&!u[x.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof s.ad){u[x.id]=!0;for(const w of this.proxyCoords){const I=this.proxyToSource[w.key][x.id];if(I)for(const C of I)this._clearRenderCacheForTile(x.id,C)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof $c){n=!0;break}if(!n)return;const u={};for(let p=0;p<this._style.order.length;++p){const v=this._style._mergedLayers[this._style.order[p]],x=this._style.getLayerSourceCache(v);if(!x||u[x.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const w=v.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const C=this.proxyToSource[I.key][x.id];if(C)for(const D of C){const F=Bh(x.getTile(D),x.findLoadedParent(D,0),x,this.painter.transform,w);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(x.id,D)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const n=this._style.order,u=n.length;if(u===0)return;const p=[];this._pendingGroundEffectLayers=[];let v,x=0,w=this._style._mergedLayers[n[x]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++x<u;)w=this._style._mergedLayers[n[x]];for(;x<u;++x){const I=this._style._mergedLayers[n[x]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?v===void 0&&(v=x):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),v!==void 0&&(p.push({start:v,end:x-1}),v=void 0)))}if(v!==void 0&&p.push({start:v,end:x-1}),p.length!==0){const I=p[p.length-1];this._pendingGroundEffectLayers.every(C=>C>I.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(n){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const w=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let I=0;I<w.length;++I){const C=Object.values(w[I]);u.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,v=this._tilesDirty;for(let w=p.length-1;w>=0;w--){const I=p[w];if(u.getTileByID(I.key),u.proxyCachedFBO[I.key]!==void 0){const C=n[I.key],D=this.proxyToSource[I.key];let F=0;for(const V in D){const z=D[V],j=C[V];if(!j||j.length!==z.length||z.some((G,H)=>G!==j[H]||v[V]&&v[V].hasOwnProperty(G.key))){F=-1;break}++F}for(const V in u.proxyCachedFBO[I.key])u.renderCache[u.proxyCachedFBO[I.key][V]].dirty=F<0||F!==Object.values(C).length}}const x=[...this._drapedRenderBatches];x.sort((w,I)=>I.end-I.start-(w.end-w.start));for(const w of x)for(const I of p){if(u.proxyCachedFBO[I.key])continue;let C=u.renderCachePool.pop();C===void 0&&u.renderCache.length<50&&(C=u.renderCache.length,u.renderCache.push(this._createFBO())),C!==void 0&&(u.proxyCachedFBO[I.key]={},u.proxyCachedFBO[I.key][w.start]=C,u.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(n,u,p,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,w=x.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let I;if(p.isTileClipped())I=u.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):Pi.disabled}_renderTileClippingMasks(n,u){const p=this.painter,v=this.painter.context,x=v.gl;p._tileClippingMaskIDs={},v.setColorMode(Di.disabled),v.setDepthMode(Gt.disabled);const w=p.getOrCreateProgram("clippingMask");for(const I of n){const C=p._tileClippingMaskIDs[I.key]=--u;w.draw(p,x.TRIANGLES,Gt.disabled,new Pi({func:x.ALWAYS,mask:0},C,255,x.KEEP,x.KEEP,x.REPLACE),Di.disabled,Bi.disabled,Nh(I.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(n){const u=this.painter.transform;if(n.x<0||n.x>u.width||n.y<0||n.y>u.height)return null;const p=[n.x,n.y,1,1];s.aC(p,p,u.pixelMatrixInverse),s.cJ(p,p,1/p[3]),p[0]/=u.worldSize,p[1]/=u.worldSize;const v=u._camera.position,x=s.ce(1,u.center.lat),w=[v[0],v[1],v[2]/x,0],I=s.d9([],p.slice(0,3),w);s.aw(I,I);const C=this.raycast(w,I,this._exaggeration);return C!==null&&C?(s.bH(w,w,I,C),w[3]=w[2],w[2]*=x,w):null}_setupProxiedCoordsForOrtho(n,u,p){if(n.getSource()instanceof s.aS)return this._setupProxiedCoordsForImageSource(n,u,p);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const v=this.proxiedCoords[n.id]=[],x=this.proxyCoords;for(let C=0;C<x.length;C++){const D=x[C],F=this._findTileCoveringTileID(D,n);if(F){const V=this._createProxiedId(D,F,p[D.key]&&p[D.key][n.id]);v.push(V),this.proxyToSource[D.key][n.id]=[V]}}let w=!1;const I=new Set;for(let C=0;C<u.length;C++){const D=n.getTile(u[C]);if(!D||!D.hasData())continue;const F=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==D.tileID.canonical.z){const V=this.proxyToSource[F.tileID.key][n.id],z=this._createProxiedId(F.tileID,D,p[F.tileID.key]&&p[F.tileID.key][n.id]);V?V.splice(V.length-1,0,z):this.proxyToSource[F.tileID.key][n.id]=[z];const j=this.proxyToSource[F.tileID.key][n.id];I.has(j)||I.add(j),v.push(z),w=!0}}if(this._sourceTilesOverlap[n.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(const C of I)C.sort((D,F)=>F.overscaledZ-D.overscaledZ)}_setupProxiedCoordsForImageSource(n,u,p){if(!n.getSource().loaded())return;const v=this.proxiedCoords[n.id]=[],x=this.proxyCoords,w=n.getSource(),I=w.tileID;if(!I)return;const C=new s.P(I.x,I.y)._div(1<<I.z),D=w.coordinates.map(s.ae.fromLngLat).reduce((V,z)=>(V.min.x=Math.min(V.min.x,z.x-C.x),V.min.y=Math.min(V.min.y,z.y-C.y),V.max.x=Math.max(V.max.x,z.x-C.x),V.max.y=Math.max(V.max.y,z.y-C.y),V),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(V,z)=>{const j=V.wrap+V.canonical.x/(1<<V.canonical.z),G=V.canonical.y/(1<<V.canonical.z),H=s.al/(1<<V.canonical.z),ee=z.wrap+z.canonical.x/(1<<z.canonical.z),K=z.canonical.y/(1<<z.canonical.z);return j+H<ee+D.min.x||j>ee+D.max.x||G+H<K+D.min.y||G>K+D.max.y};for(let V=0;V<x.length;V++){const z=x[V];for(let j=0;j<u.length;j++){const G=n.getTile(u[j]);if(!G||!G.hasData()||F(z,G.tileID))continue;const H=this._createProxiedId(z,G,p[z.key]&&p[z.key][n.id]),ee=this.proxyToSource[z.key][n.id];ee?ee.push(H):this.proxyToSource[z.key][n.id]=[H],v.push(H)}}}_createProxiedId(n,u,p){let v=this.orthoMatrix;if(p){const x=p.find(w=>w.key===u.tileID.key);if(x)return x}if(u.tileID.key!==n.key){const x=n.canonical.z-u.tileID.canonical.z;let w,I,C;v=s.bC();const D=u.tileID.wrap-n.wrap<<n.overscaledZ;x>0?(w=s.al>>x,I=w*((u.tileID.canonical.x<<x)-n.canonical.x+D),C=w*((u.tileID.canonical.y<<x)-n.canonical.y)):(w=s.al<<-x,I=s.al*(u.tileID.canonical.x-(n.canonical.x+D<<-x)),C=s.al*(u.tileID.canonical.y-(n.canonical.y<<-x))),s.cd(v,0,w,0,w,0,1),s.br(v,v,[I,C,0])}return new x_(u.tileID,n.key,v)}_findTileCoveringTileID(n,u){let p=u.getTile(n);if(p&&p.hasData())return p;const v=this._findCoveringTileCache[u.id],x=v[n.key];if(p=x?u.getTileByID(x):null,p&&p.hasData()||x===null)return p;let w=p?p.tileID:n,I=w.overscaledZ;const C=u.getSource().minzoom,D=[];if(!x){const V=u.getSource().maxzoom;if(n.canonical.z>=V){const z=n.canonical.z-V;u.getSource().reparseOverscaled?(I=Math.max(n.canonical.z+2,u.transform.tileZoom),w=new s.aO(I,n.wrap,V,n.canonical.x>>z,n.canonical.y>>z)):z!==0&&(I=V,w=new s.aO(I,n.wrap,V,n.canonical.x>>z,n.canonical.y>>z))}w.key!==n.key&&(D.push(w.key),p=u.getTile(w))}const F=V=>{D.forEach(z=>{v[z]=V}),D.length=0};for(I-=1;I>=C&&(!p||!p.hasData());I--){p&&F(p.tileID.key);const V=w.calculateScaledKey(I);if(p=u.getTileByID(V),p&&p.hasData())break;const z=v[V];if(z===null)break;z===void 0?D.push(V):p=u.getTileByID(z)}return F(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,u){let p=this._tilesDirty[n];p||(p=this._tilesDirty[n]={}),p[u.key]=!0}}function b_(m,n,u){const p=function(I,C,D){const F=s.bJ(C,I),V=s.bJ(D,[.2126,.7152,.0722]),z=(G,H,ee)=>(1-ee)*G+ee*H,j=z(1-.3*Math.min(V,1),1,Math.min(F+1,1));return z(.92,1,Math.asin(s.aA(C[2],-1,1))/Math.PI+.5)*j}(m,[0,0,1],n),v=[0,0,0];s.c4(v,u.slice(0,3),p);const x=[0,0,0];s.c4(x,n.slice(0,3),m[2]);const w=[0,0,0];return s.d7(w,v,x),s.da(w)}const hy=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],dy=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class w_{static cacheKey(n,u,p,v){let x=`${u}${v?v.cacheKey:""}`;for(const w of p)n.usedDefines.includes(w)&&(x+=`/${w}`);return x}constructor(n,u,p,v,x,w){const I=n.gl;this.program=I.createProgram(),this.configuration=v,this.name=u,this.fixedDefines=[...w];let C=v?v.defines():[];C=C.concat(w.map(G=>`#define ${G}`));const D=`#version 300 es
`;let F=D+C.concat("precision mediump float;",gc,wp.fragmentSource).join(`
`);for(const G of p.fragmentIncludes)F+=`
${Kd[G]}`;F+=`
${p.fragmentSource}`;let V=D+C.concat("precision highp float;",gc,wp.vertexSource).join(`
`);for(const G of p.vertexIncludes)V+=`
${Kd[G]}`;this.forceManualRenderingForInstanceIDShaders=n.forceManualRenderingForInstanceIDShaders&&p.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(V+=`
uniform int u_instanceID;
`),V+=`
${p.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(V=V.replaceAll("gl_InstanceID","u_instanceID"));const z=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(z,F),I.compileShader(z),I.attachShader(this.program,z);const j=I.createShader(I.VERTEX_SHADER);I.isContextLost()?this.failedToCreate=!0:(I.shaderSource(j,V),I.compileShader(j),I.attachShader(this.program,j),this.attributes={},I.linkProgram(this.program),I.deleteShader(j),I.deleteShader(z),this.fixedUniforms=x(n),this.binderUniforms=v?v.getUniforms(n):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(G=>({u_instanceID:new s.cg(G)}))(n)),(w.includes("TERRAIN")||u.indexOf("symbol")!==-1||u.indexOf("circle")!==-1)&&(this.terrainUniforms=(G=>({u_dem:new s.cg(G),u_dem_prev:new s.cg(G),u_dem_tl:new s.cj(G),u_dem_scale:new s.ci(G),u_dem_tl_prev:new s.cj(G),u_dem_scale_prev:new s.ci(G),u_dem_size:new s.ci(G),u_dem_lerp:new s.ci(G),u_exaggeration:new s.ci(G),u_depth:new s.cg(G),u_depth_size_inv:new s.cj(G),u_depth_range_unpack:new s.cj(G),u_occluder_half_size:new s.ci(G),u_occlusion_depth_offset:new s.ci(G),u_meter_to_dem:new s.ci(G),u_label_plane_matrix_inv:new s.ck(G)}))(n)),w.includes("GLOBE")&&(this.globeUniforms=(G=>({u_tile_tl_up:new s.ch(G),u_tile_tr_up:new s.ch(G),u_tile_br_up:new s.ch(G),u_tile_bl_up:new s.ch(G),u_tile_up_scale:new s.ci(G)}))(n)),w.includes("FOG")&&(this.fogUniforms=(G=>({u_fog_matrix:new s.ck(G),u_fog_range:new s.cj(G),u_fog_color:new s.d2(G),u_fog_horizon_blend:new s.ci(G),u_fog_vertical_limit:new s.cj(G),u_fog_temporal_offset:new s.ci(G),u_frustum_tl:new s.ch(G),u_frustum_tr:new s.ch(G),u_frustum_br:new s.ch(G),u_frustum_bl:new s.ch(G),u_globe_pos:new s.ch(G),u_globe_radius:new s.ci(G),u_globe_transition:new s.ci(G),u_is_globe:new s.cg(G),u_viewport:new s.cj(G)}))(n)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(G=>({u_cutoff_params:new s.d2(G)}))(n)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(G=>({u_lighting_ambient_color:new s.ch(G),u_lighting_directional_dir:new s.ch(G),u_lighting_directional_color:new s.ch(G),u_ground_radiance:new s.ch(G)}))(n)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(G=>({u_light_matrix_0:new s.ck(G),u_light_matrix_1:new s.ck(G),u_fade_range:new s.cj(G),u_shadow_normal_offset:new s.ch(G),u_shadow_intensity:new s.ci(G),u_shadow_texel_size:new s.ci(G),u_shadow_map_resolution:new s.ci(G),u_shadow_direction:new s.ch(G),u_shadow_bias:new s.ch(G),u_shadowmap_0:new s.cg(G),u_shadowmap_1:new s.cg(G)}))(n)))}getAttributeLocation(n,u){let p=this.attributes[u];return p===void 0&&(p=this.attributes[u]=n.getAttribLocation(this.program,u)),p}setTerrainUniformValues(n,u){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in u)p[v]&&p[v].set(this.program,v,u[v])}}setGlobeUniformValues(n,u){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in u)p[v]&&p[v].set(this.program,v,u[v])}}setFogUniformValues(n,u){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in u)p[v].set(this.program,v,u[v])}}setCutoffUniformValues(n,u){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in u)p[v].set(this.program,v,u[v])}}setLightsUniformValues(n,u){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in u)p[v].set(this.program,v,u[v])}}setShadowUniformValues(n,u){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;n.program.set(this.program);for(const v in u)p[v].set(this.program,v,u[v])}_drawDebugWireframe(n,u,p,v,x,w,I,C,D,F){const V=n.options.wireframe;if(V.terrain===!1&&V.layers2D===!1&&V.layers3D===!1)return;const z=n.context;if(!(!(!V.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!V.layers2D||n._terrain&&n._terrain.renderingToTexture||!hy.includes(this.name))||!(!V.layers3D||!dy.includes(this.name))))return;const j=z.gl,G=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,x,z);if(!G)return;const H=[...this.fixedDefines];H.push("DEBUG_WIREFRAME");const ee=n.getOrCreateProgram(this.name,{config:this.configuration,defines:H});z.program.set(ee.program);const K=(ce,ve,_e)=>{if(ve[ce]&&_e[ce])for(const xe in ve[ce])_e[ce][xe]&&_e[ce][xe].set(_e.program,xe,ve[ce][xe].current)};D&&D.setUniforms(ee.program,z,ee.binderUniforms,I,{zoom:C}),K("fixedUniforms",this,ee),K("terrainUniforms",this,ee),K("globeUniforms",this,ee),K("fogUniforms",this,ee),K("lightsUniforms",this,ee),K("shadowUniforms",this,ee),G.bind(),z.setColorMode(new Di([j.ONE,j.ONE_MINUS_SRC_ALPHA,j.ZERO,j.ONE],s.ao.transparent,[!0,!0,!0,!1])),z.setDepthMode(new Gt(u.func===j.LESS?j.LEQUAL:u.func,Gt.ReadOnly,u.range)),z.setStencilMode(Pi.disabled);const ie=3*w.primitiveLength*2,ae=3*w.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ce=F||1;for(let ve=0;ve<ce;++ve)ee.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ve),j.drawElements(j.LINES,ie,j.UNSIGNED_SHORT,ae)}else F&&F>1?j.drawElementsInstanced(j.LINES,ie,j.UNSIGNED_SHORT,ae,F):j.drawElements(j.LINES,ie,j.UNSIGNED_SHORT,ae);x.bind(),z.program.set(this.program),z.setDepthMode(u),z.setStencilMode(p),z.setColorMode(v)}checkUniforms(n,u,p){if(this.fixedDefines.includes(u)){for(const v of Object.keys(p))if(!p[v].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${v} not set but required by ${u} being defined`)}}draw(n,u,p,v,x,w,I,C,D,F,V,z,j,G,H,ee){const K=n.context,ie=K.gl;if(this.failedToCreate)return;K.program.set(this.program),K.setDepthMode(p),K.setStencilMode(v),K.setColorMode(x),K.setCullFace(w);for(const ve of Object.keys(this.fixedUniforms))this.fixedUniforms[ve].set(this.program,ve,I[ve]);G&&G.setUniforms(this.program,K,this.binderUniforms,z,{zoom:j});const ae={[ie.POINTS]:1,[ie.LINES]:2,[ie.TRIANGLES]:3,[ie.LINE_STRIP]:1}[u];this.checkUniforms(C,"RENDER_SHADOWS",this.shadowUniforms);const ce=ee&&ee>0?1:void 0;for(const ve of V.get()){const _e=ve.vaos||(ve.vaos={});if((_e[C]||(_e[C]=new Yd)).bind(K,this,D,G?G.getPaintVertexBuffers():[],F,ve.vertexOffset,H||[],ce),this.forceManualRenderingForInstanceIDShaders){const xe=ee||1;for(let ge=0;ge<xe;++ge)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ge),F?ie.drawElements(u,ve.primitiveLength*ae,ie.UNSIGNED_SHORT,ve.primitiveOffset*ae*2):ie.drawArrays(u,ve.vertexOffset,ve.vertexLength)}else ee&&ee>1?ie.drawElementsInstanced(u,ve.primitiveLength*ae,ie.UNSIGNED_SHORT,ve.primitiveOffset*ae*2,ee):F?ie.drawElements(u,ve.primitiveLength*ae,ie.UNSIGNED_SHORT,ve.primitiveOffset*ae*2):ie.drawArrays(u,ve.vertexOffset,ve.vertexLength);u===ie.TRIANGLES&&F&&this._drawDebugWireframe(n,p,v,x,F,ve,z,j,G,ee)}}}function Ip(m,n,u=0){const p=Math.pow(2,n.tileID.overscaledZ),v=n.tileSize*Math.pow(2,m.transform.tileZoom)/p,x=v*(n.tileID.canonical.x+n.tileID.wrap*p),w=v*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(n,1,m.transform.tileZoom),u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w],u_pattern_transition:u}}const tf={terrain:0,flat:1},fy=s.bC(),Sp=(m,n,u,p,v,x,w,I,C,D,F,V,z,j,G,H,ee,K)=>{const ie=n.style.light,ae=ie.properties.get("position"),ce=[ae.x,ae.y,ae.z],ve=s.dL();ie.properties.get("anchor")==="viewport"&&(s.dM(ve,-n.transform.angle),s.dN(ce,ce,ve));const _e=ie.properties.get("color").toPremultipliedRenderColor(null),xe=n.transform,ge={u_matrix:m,u_lightpos:ce,u_lightintensity:ie.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_vertical_gradient:+u,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:fy,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:tf[D],u_base_type:tf[F],u_ao:v,u_edge_radius:x,u_width_scale:w,u_flood_light_color:G,u_vertical_scale:H,u_flood_light_intensity:ee,u_ground_shadow_factor:K};return xe.projection.name==="globe"&&(ge.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],ge.u_zoom_transition=V,ge.u_inv_rot_matrix=j,ge.u_merc_center=z,ge.u_up_dir=xe.projection.upVector(new s.cC(0,0,0),z[0]*s.al,z[1]*s.al),ge.u_height_lift=C),ge},py=(m,n,u,p,v,x)=>({u_matrix:m,u_edge_radius:n,u_width_scale:u,u_vertical_scale:p,u_height_type:tf[v],u_base_type:tf[x]}),cb=(m,n,u,p,v,x,w,I,C,D,F,V,z,j,G,H,ee,K)=>{const ie=Sp(m,n,u,p,v,x,w,I,D,F,V,z,j,G,H,ee,1,[0,0,0]),ae={u_height_factor:-Math.pow(2,I.overscaledZ)/C.tileSize/8};return Object.assign(ie,Ip(n,C,K),ae)},my=(m,n,u)=>({u_matrix:m,u_emissive_strength:n,u_ground_shadow_factor:u}),Vh=(m,n,u,p,v,x=0)=>Object.assign(my(m,n,v),Ip(u,p,x)),aI=(m,n,u,p)=>({u_matrix:m,u_world:u,u_emissive_strength:n,u_ground_shadow_factor:p}),lI=(m,n,u,p,v,x,w=0)=>Object.assign(Vh(m,n,u,p,x,w),{u_world:v}),cI=(m,n)=>({u_matrix:m,u_ground_shadow_factor:n}),T_=(m,n,u,p,v)=>({u_matrix:m,u_camera_pos:[n[0],n[1],n[2]],u_depth_bias:u,u_height_scale:p,u_reset_depth:v}),uI=(m,n,u,p,v,x,w)=>({u_matrix:m,u_normal_matrix:n,u_opacity:u,u_faux_facade_ao_intensity:p,u_camera_pos:v,u_tile_to_meter:x,u_facade_emissive_chance:w}),hI=m=>({u_matrix:m}),_y=m=>({u_matrix:m}),gy=(m,n,u,p,v,x,w,I)=>{const C=s.al/x.tileSize;return{u_matrix:m,u_inv_rot_matrix:n,u_camera_to_center_distance:u.getCameraToCenterDistance(I),u_extrude_scale:[u.pixelsToGLUnits[0]/C,u.pixelsToGLUnits[1]/C],u_zoom_transition:p,u_tile_id:w,u_merc_center:v}},yy=(m,n,u=1)=>({u_matrix:m,u_color:n,u_overlay:0,u_overlay_scale:u}),rf=s.bC(),ub=(m,n,u,p,v,x,w)=>{const I=m.transform,C=I.projection.name==="globe",D=C?s.dO(I.zoom,n.canonical)*I._pixelsPerMercatorPixel:s.ay(u,1,x),F={u_matrix:n.projMatrix,u_extrude_scale:D,u_intensity:w,u_inv_rot_matrix:rf,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){F.u_inv_rot_matrix=p,F.u_merc_center=v,F.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],F.u_zoom_transition=s.aj(I.zoom);const V=v[0]*s.al,z=v[1]*s.al;F.u_up_dir=I.projection.upVector(new s.cC(0,0,0),V,z)}return F};function vy(m,[n,u,p,v],[x,w]){if(x===w)return[0,0,0,0];const I=255*(m-1)/(m*(w-x));return[n*I,u*I,p*I,v*I]}function xy(m,n,[u,p]){return u===p?0:.5/m+(n-u)*(m-1)/(m*(p-u))}const E_=(m,n,u,p,v,x,w,I,C,D,F,V,z,j,G,H,ee,K,ie,ae,ce)=>({u_matrix:m,u_normalize_matrix:n,u_globe_matrix:u,u_merc_matrix:p,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:D,u_fade_t:F.mix,u_opacity:F.opacity*V.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:V.paint.get("raster-brightness-min"),u_brightness_high:V.paint.get("raster-brightness-max"),u_saturation_factor:s.dQ(V.paint.get("raster-saturation")),u_contrast_factor:s.dP(V.paint.get("raster-contrast")),u_spin_weights:Uh(V.paint.get("raster-hue-rotate")),u_perspective_transform:z,u_raster_elevation:j,u_zoom_transition:w,u_merc_center:I,u_cutoff_params:C,u_colorization_mix:vy(s.dR,H,K),u_colorization_offset:xy(s.dR,ee,K),u_color_ramp:G,u_texture_offset:[ae/(ie+2*ae),ie/(ie+2*ae)],u_texture_res:[ie+2*ae,ie+2*ae],u_emissive_strength:ce});function Uh(m){m*=Math.PI/180;const n=Math.sin(m),u=Math.cos(m);return[(2*u+1)/3,(-Math.sqrt(3)*n-u+1)/3,(Math.sqrt(3)*n-u+1)/3]}const jh=.05,Du=(m,n,u,p,v,x,w,I,C,D,F,V)=>({u_matrix:m,u_normalize_matrix:n,u_globe_matrix:u,u_merc_matrix:p,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:D,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:V,u_zoom_transition:w,u_merc_center:I,u_cutoff_params:C}),by=(m,n,u,p,v,x,w,I,C,D)=>({u_particle_texture:m,u_particle_texture_side_len:n,u_tile_offset:u,u_velocity:p,u_color_ramp:x,u_velocity_res:v,u_max_speed:w,u_uv_offset:I,u_data_scale:[255*C[0],255*C[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[jh,jh]}),I_=(m,n,u,p,v,x,w,I,C,D)=>({u_particle_texture:m,u_particle_texture_side_len:n,u_velocity:u,u_velocity_res:p,u_max_speed:v,u_speed_factor:x,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*C[0],255*C[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[jh,jh]}),wy=s.bC(),Ty=(m,n,u,p,v,x,w,I,C,D,F,V,z,j,G,H,ee,K,ie,ae,ce,ve,_e,xe)=>{const ge=v.transform,pe={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:ge.getCameraToCenterDistance(ie),u_rotate_symbol:+u,u_aspect_ratio:ge.width/ge.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:w,u_coord_matrix:I,u_is_text:+D,u_elevation_from_sea:C?1:0,u_pitch_with_map:+p,u_texsize:F,u_texsize_icon:V,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:wy,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:wy,u_up_vector:[0,-1,0],u_color_adj_mat:ve,u_icon_transition:_e||0,u_gamma_scale:p?v.transform.getCameraToCenterDistance(ie)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:s.o.devicePixelRatio,u_is_halo:1,u_scale_factor:xe||1,u_ground_shadow_factor:ae,u_inv_matrix:s.bl(s.bC(),w),u_normal_scale:ce,u_lutTexture:bs.LUT};return ie.name==="globe"&&(pe.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],pe.u_zoom_transition=G,pe.u_inv_rot_matrix=ee,pe.u_merc_center=H,pe.u_camera_forward=ge._camera.forward(),pe.u_ecef_origin=s.dS(ge.globeMatrix,j.toUnwrapped()),pe.u_tile_matrix=Float32Array.from(ge.globeMatrix),pe.u_up_vector=K),pe},S_=(m,n,u,p)=>({u_matrix:m,u_emissive_strength:n,u_opacity:u,u_color:p}),A_=(m,n,u,p,v,x,w,I,C)=>Object.assign(function(D,F,V,z,j,G){const{width:H,height:ee}=z.imageManager.getPixelSize(F),K=Math.pow(2,G.tileID.overscaledZ),ie=G.tileSize*Math.pow(2,z.transform.tileZoom)/K,ae=ie*(G.tileID.canonical.x+G.tileID.wrap*K),ce=ie*G.tileID.canonical.y;return{u_image:0,u_pattern_tl:V.tl,u_pattern_br:V.br,u_texsize:[H,ee],u_pattern_size:V.displaySize,u_pattern_units_to_pixels:j?[z.transform.width,-1*z.transform.height]:[1/s.ay(G,1,z.transform.tileZoom),1/s.ay(G,1,z.transform.tileZoom)],u_pixel_coord_upper:[ae>>16,ce>>16],u_pixel_coord_lower:[65535&ae,65535&ce]}}(0,x,w,p,I,C),{u_matrix:m,u_emissive_strength:n,u_opacity:u}),Ey=new Float32Array(s.bA([])),C_=(m,n,u,p,v,x,w,I,C,D,F,V,z,j=[0,0,0],G)=>{const H=v.style.light,ee=H.properties.get("position"),K=[-ee.x,-ee.y,ee.z],ie=s.dL();H.properties.get("anchor")==="viewport"&&(s.dM(ie,-v.transform.angle),s.dN(K,K,ie));const ae=F.alphaMode==="MASK",ce=H.properties.get("color").toNonPremultipliedRenderColor(null),ve=z.paint.get("model-ambient-occlusion-intensity"),_e=z.paint.get("model-color").constantOr(s.ao.white).toNonPremultipliedRenderColor(null);return _e.a=z.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:m,u_lighting_matrix:n,u_normal_matrix:u,u_node_matrix:p||Ey,u_lightpos:K,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_camera_pos:j,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+ae,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:w.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:I.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:C,u_roughnessFactor:D,u_baseColorTexture:bs.BaseColor,u_metallicRoughnessTexture:bs.MetallicRoughness,u_normalTexture:bs.Normal,u_occlusionTexture:bs.Occlusion,u_emissionTexture:bs.Emission,u_lutTexture:bs.LUT,u_color_mix:_e.toArray01(),u_aoIntensity:ve,u_emissive_strength:V,u_occlusionTextureTransform:G||[0,0,0,0]}},nf=(m,n=Ey,u=Ey)=>({u_matrix:m,u_instance:n,u_node_matrix:u}),dI={fillExtrusion:m=>({u_matrix:new s.ck(m),u_lightpos:new s.ch(m),u_lightintensity:new s.ci(m),u_lightcolor:new s.ch(m),u_vertical_gradient:new s.ci(m),u_opacity:new s.ci(m),u_edge_radius:new s.ci(m),u_width_scale:new s.ci(m),u_ao:new s.cj(m),u_height_type:new s.cg(m),u_base_type:new s.cg(m),u_tile_id:new s.ch(m),u_zoom_transition:new s.ci(m),u_inv_rot_matrix:new s.ck(m),u_merc_center:new s.cj(m),u_up_dir:new s.ch(m),u_height_lift:new s.ci(m),u_flood_light_color:new s.ch(m),u_vertical_scale:new s.ci(m),u_flood_light_intensity:new s.ci(m),u_ground_shadow_factor:new s.ch(m)}),fillExtrusionDepth:m=>({u_matrix:new s.ck(m),u_edge_radius:new s.ci(m),u_width_scale:new s.ci(m),u_vertical_scale:new s.ci(m),u_height_type:new s.cg(m),u_base_type:new s.cg(m)}),fillExtrusionPattern:m=>({u_matrix:new s.ck(m),u_lightpos:new s.ch(m),u_lightintensity:new s.ci(m),u_lightcolor:new s.ch(m),u_vertical_gradient:new s.ci(m),u_height_factor:new s.ci(m),u_edge_radius:new s.ci(m),u_width_scale:new s.ci(m),u_ao:new s.cj(m),u_height_type:new s.cg(m),u_base_type:new s.cg(m),u_tile_id:new s.ch(m),u_zoom_transition:new s.ci(m),u_inv_rot_matrix:new s.ck(m),u_merc_center:new s.cj(m),u_up_dir:new s.ch(m),u_height_lift:new s.ci(m),u_image:new s.cg(m),u_texsize:new s.cj(m),u_pixel_coord_upper:new s.cj(m),u_pixel_coord_lower:new s.cj(m),u_tile_units_to_pixels:new s.ci(m),u_opacity:new s.ci(m),u_pattern_transition:new s.ci(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new s.ck(m),u_opacity:new s.ci(m),u_ao_pass:new s.ci(m),u_meter_to_tile:new s.ci(m),u_ao:new s.cj(m),u_flood_light_intensity:new s.ci(m),u_flood_light_color:new s.ch(m),u_attenuation:new s.ci(m),u_edge_radius:new s.ci(m),u_fb:new s.cg(m),u_fb_size:new s.ci(m),u_dynamic_offset:new s.ci(m)}),fill:m=>({u_matrix:new s.ck(m),u_emissive_strength:new s.ci(m),u_ground_shadow_factor:new s.ch(m)}),fillPattern:m=>({u_matrix:new s.ck(m),u_emissive_strength:new s.ci(m),u_image:new s.cg(m),u_texsize:new s.cj(m),u_pixel_coord_upper:new s.cj(m),u_pixel_coord_lower:new s.cj(m),u_tile_units_to_pixels:new s.ci(m),u_ground_shadow_factor:new s.ch(m),u_pattern_transition:new s.ci(m)}),fillOutline:m=>({u_matrix:new s.ck(m),u_emissive_strength:new s.ci(m),u_world:new s.cj(m),u_ground_shadow_factor:new s.ch(m)}),fillOutlinePattern:m=>({u_matrix:new s.ck(m),u_emissive_strength:new s.ci(m),u_world:new s.cj(m),u_image:new s.cg(m),u_texsize:new s.cj(m),u_pixel_coord_upper:new s.cj(m),u_pixel_coord_lower:new s.cj(m),u_tile_units_to_pixels:new s.ci(m),u_ground_shadow_factor:new s.ch(m),u_pattern_transition:new s.ci(m)}),building:m=>({u_matrix:new s.ck(m),u_normal_matrix:new s.ck(m),u_opacity:new s.ci(m),u_faux_facade_ao_intensity:new s.ci(m),u_camera_pos:new s.ch(m),u_tile_to_meter:new s.ci(m),u_facade_emissive_chance:new s.ci(m)}),buildingBloom:m=>({u_matrix:new s.ck(m)}),buildingDepth:m=>({u_matrix:new s.ck(m)}),elevatedStructuresDepth:m=>({u_matrix:new s.ck(m),u_depth_bias:new s.ci(m)}),elevatedStructures:m=>({u_matrix:new s.ck(m),u_ground_shadow_factor:new s.ch(m)}),elevatedStructuresDepthReconstruct:m=>({u_matrix:new s.ck(m),u_camera_pos:new s.ch(m),u_depth_bias:new s.ci(m),u_height_scale:new s.ci(m),u_reset_depth:new s.ci(m)}),circle:s.dV,collisionBox:m=>({u_matrix:new s.ck(m),u_inv_rot_matrix:new s.ck(m),u_camera_to_center_distance:new s.ci(m),u_extrude_scale:new s.cj(m),u_zoom_transition:new s.ci(m),u_merc_center:new s.cj(m),u_tile_id:new s.ch(m)}),collisionCircle:m=>({u_matrix:new s.ck(m),u_inv_matrix:new s.ck(m),u_camera_to_center_distance:new s.ci(m),u_viewport_size:new s.cj(m)}),debug:m=>({u_color:new s.dx(m),u_matrix:new s.ck(m),u_overlay:new s.cg(m),u_overlay_scale:new s.ci(m)}),clippingMask:m=>({u_matrix:new s.ck(m)}),heatmap:m=>({u_extrude_scale:new s.ci(m),u_intensity:new s.ci(m),u_matrix:new s.ck(m),u_inv_rot_matrix:new s.ck(m),u_merc_center:new s.cj(m),u_tile_id:new s.ch(m),u_zoom_transition:new s.ci(m),u_up_dir:new s.ch(m)}),heatmapTexture:m=>({u_image:new s.cg(m),u_color_ramp:new s.cg(m),u_opacity:new s.ci(m)}),hillshade:m=>({u_matrix:new s.ck(m),u_image:new s.cg(m),u_latrange:new s.cj(m),u_light:new s.cj(m),u_shadow:new s.dx(m),u_highlight:new s.dx(m),u_emissive_strength:new s.ci(m),u_accent:new s.dx(m)}),hillshadePrepare:m=>({u_matrix:new s.ck(m),u_image:new s.cg(m),u_dimension:new s.cj(m),u_zoom:new s.ci(m)}),line:s.dU,linePattern:s.dT,raster:m=>({u_matrix:new s.ck(m),u_normalize_matrix:new s.ck(m),u_globe_matrix:new s.ck(m),u_merc_matrix:new s.ck(m),u_grid_matrix:new s.dy(m),u_tl_parent:new s.cj(m),u_scale_parent:new s.ci(m),u_fade_t:new s.ci(m),u_opacity:new s.ci(m),u_image0:new s.cg(m),u_image1:new s.cg(m),u_brightness_low:new s.ci(m),u_brightness_high:new s.ci(m),u_saturation_factor:new s.ci(m),u_contrast_factor:new s.ci(m),u_spin_weights:new s.ch(m),u_perspective_transform:new s.cj(m),u_raster_elevation:new s.ci(m),u_zoom_transition:new s.ci(m),u_merc_center:new s.cj(m),u_cutoff_params:new s.d2(m),u_colorization_mix:new s.d2(m),u_colorization_offset:new s.ci(m),u_color_ramp:new s.cg(m),u_texture_offset:new s.cj(m),u_texture_res:new s.cj(m),u_emissive_strength:new s.ci(m)}),rasterParticle:m=>({u_matrix:new s.ck(m),u_normalize_matrix:new s.ck(m),u_globe_matrix:new s.ck(m),u_merc_matrix:new s.ck(m),u_grid_matrix:new s.dy(m),u_tl_parent:new s.cj(m),u_scale_parent:new s.ci(m),u_fade_t:new s.ci(m),u_opacity:new s.ci(m),u_image0:new s.cg(m),u_image1:new s.cg(m),u_raster_elevation:new s.ci(m),u_zoom_transition:new s.ci(m),u_merc_center:new s.cj(m),u_cutoff_params:new s.d2(m)}),rasterParticleTexture:m=>({u_texture:new s.cg(m),u_opacity:new s.ci(m)}),rasterParticleDraw:m=>({u_particle_texture:new s.cg(m),u_particle_texture_side_len:new s.ci(m),u_tile_offset:new s.cj(m),u_velocity:new s.cg(m),u_color_ramp:new s.cg(m),u_velocity_res:new s.cj(m),u_max_speed:new s.ci(m),u_uv_offset:new s.cj(m),u_data_scale:new s.cj(m),u_data_offset:new s.ci(m),u_particle_pos_scale:new s.ci(m),u_particle_pos_offset:new s.cj(m)}),rasterParticleUpdate:m=>({u_particle_texture:new s.cg(m),u_particle_texture_side_len:new s.ci(m),u_velocity:new s.cg(m),u_velocity_res:new s.cj(m),u_max_speed:new s.ci(m),u_speed_factor:new s.ci(m),u_reset_rate:new s.ci(m),u_rand_seed:new s.ci(m),u_uv_offset:new s.cj(m),u_data_scale:new s.cj(m),u_data_offset:new s.ci(m),u_particle_pos_scale:new s.ci(m),u_particle_pos_offset:new s.cj(m)}),symbol:m=>({u_is_size_zoom_constant:new s.cg(m),u_is_size_feature_constant:new s.cg(m),u_size_t:new s.ci(m),u_size:new s.ci(m),u_camera_to_center_distance:new s.ci(m),u_rotate_symbol:new s.cg(m),u_aspect_ratio:new s.ci(m),u_fade_change:new s.ci(m),u_matrix:new s.ck(m),u_label_plane_matrix:new s.ck(m),u_coord_matrix:new s.ck(m),u_is_text:new s.cg(m),u_elevation_from_sea:new s.cg(m),u_pitch_with_map:new s.cg(m),u_texsize:new s.cj(m),u_texsize_icon:new s.cj(m),u_texture:new s.cg(m),u_texture_icon:new s.cg(m),u_gamma_scale:new s.ci(m),u_device_pixel_ratio:new s.ci(m),u_tile_id:new s.ch(m),u_zoom_transition:new s.ci(m),u_inv_rot_matrix:new s.ck(m),u_merc_center:new s.cj(m),u_camera_forward:new s.ch(m),u_tile_matrix:new s.ck(m),u_up_vector:new s.ch(m),u_ecef_origin:new s.ch(m),u_is_halo:new s.cg(m),u_icon_transition:new s.ci(m),u_color_adj_mat:new s.ck(m),u_scale_factor:new s.ci(m),u_ground_shadow_factor:new s.ch(m),u_inv_matrix:new s.ck(m),u_normal_scale:new s.ci(m),u_lutTexture:new s.cg(m)}),background:m=>({u_matrix:new s.ck(m),u_emissive_strength:new s.ci(m),u_opacity:new s.ci(m),u_color:new s.dx(m)}),backgroundPattern:m=>({u_matrix:new s.ck(m),u_emissive_strength:new s.ci(m),u_opacity:new s.ci(m),u_image:new s.cg(m),u_pattern_tl:new s.cj(m),u_pattern_br:new s.cj(m),u_texsize:new s.cj(m),u_pattern_size:new s.cj(m),u_pixel_coord_upper:new s.cj(m),u_pixel_coord_lower:new s.cj(m),u_pattern_units_to_pixels:new s.cj(m)}),terrainRaster:m=>({u_matrix:new s.ck(m),u_image0:new s.cg(m),u_skirt_height:new s.ci(m),u_ground_shadow_factor:new s.ch(m)}),skybox:m=>({u_matrix:new s.ck(m),u_sun_direction:new s.ch(m),u_cubemap:new s.cg(m),u_opacity:new s.ci(m),u_temporal_offset:new s.ci(m)}),skyboxGradient:m=>({u_matrix:new s.ck(m),u_color_ramp:new s.cg(m),u_center_direction:new s.ch(m),u_radius:new s.ci(m),u_opacity:new s.ci(m),u_temporal_offset:new s.ci(m)}),skyboxCapture:m=>({u_matrix_3f:new s.dy(m),u_sun_direction:new s.ch(m),u_sun_intensity:new s.ci(m),u_color_tint_r:new s.d2(m),u_color_tint_m:new s.d2(m),u_luminance:new s.ci(m)}),globeRaster:m=>({u_proj_matrix:new s.ck(m),u_globe_matrix:new s.ck(m),u_normalize_matrix:new s.ck(m),u_merc_matrix:new s.ck(m),u_zoom_transition:new s.ci(m),u_merc_center:new s.cj(m),u_image0:new s.cg(m),u_grid_matrix:new s.dy(m),u_skirt_height:new s.ci(m),u_far_z_cutoff:new s.ci(m),u_frustum_tl:new s.ch(m),u_frustum_tr:new s.ch(m),u_frustum_br:new s.ch(m),u_frustum_bl:new s.ch(m),u_globe_pos:new s.ch(m),u_globe_radius:new s.ci(m),u_viewport:new s.cj(m)}),globeAtmosphere:m=>({u_frustum_tl:new s.ch(m),u_frustum_tr:new s.ch(m),u_frustum_br:new s.ch(m),u_frustum_bl:new s.ch(m),u_horizon:new s.ci(m),u_transition:new s.ci(m),u_fadeout_range:new s.ci(m),u_atmosphere_fog_color:new s.d2(m),u_high_color:new s.d2(m),u_space_color:new s.d2(m),u_temporal_offset:new s.ci(m),u_horizon_angle:new s.ci(m)}),model:m=>({u_matrix:new s.ck(m),u_lighting_matrix:new s.ck(m),u_normal_matrix:new s.ck(m),u_node_matrix:new s.ck(m),u_lightpos:new s.ch(m),u_lightintensity:new s.ci(m),u_lightcolor:new s.ch(m),u_camera_pos:new s.ch(m),u_opacity:new s.ci(m),u_baseColorFactor:new s.d2(m),u_emissiveFactor:new s.d2(m),u_metallicFactor:new s.ci(m),u_roughnessFactor:new s.ci(m),u_baseTextureIsAlpha:new s.cg(m),u_alphaMask:new s.cg(m),u_alphaCutoff:new s.ci(m),u_baseColorTexture:new s.cg(m),u_metallicRoughnessTexture:new s.cg(m),u_normalTexture:new s.cg(m),u_occlusionTexture:new s.cg(m),u_emissionTexture:new s.cg(m),u_lutTexture:new s.cg(m),u_color_mix:new s.d2(m),u_aoIntensity:new s.ci(m),u_emissive_strength:new s.ci(m),u_occlusionTextureTransform:new s.d2(m)}),modelDepth:m=>({u_matrix:new s.ck(m),u_instance:new s.ck(m),u_node_matrix:new s.ck(m)}),groundShadow:m=>({u_matrix:new s.ck(m),u_ground_shadow_factor:new s.ch(m)}),stars:m=>({u_matrix:new s.ck(m),u_up:new s.ch(m),u_right:new s.ch(m),u_intensity_multiplier:new s.ci(m)}),snowParticle:m=>({u_modelview:new s.ck(m),u_projection:new s.ck(m),u_time:new s.ci(m),u_cam_pos:new s.ch(m),u_velocityConeAperture:new s.ci(m),u_velocity:new s.ci(m),u_horizontalOscillationRadius:new s.ci(m),u_horizontalOscillationRate:new s.ci(m),u_boxSize:new s.ci(m),u_billboardSize:new s.ci(m),u_simpleShapeParameters:new s.cj(m),u_screenSize:new s.cj(m),u_thinningCenterPos:new s.cj(m),u_thinningShape:new s.ch(m),u_thinningAffectedRatio:new s.ci(m),u_thinningParticleOffset:new s.ci(m),u_particleColor:new s.d2(m),u_direction:new s.ch(m)}),rainParticle:m=>({u_modelview:new s.ck(m),u_projection:new s.ck(m),u_time:new s.ci(m),u_cam_pos:new s.ch(m),u_texScreen:new s.cg(m),u_velocityConeAperture:new s.ci(m),u_velocity:new s.ci(m),u_boxSize:new s.ci(m),u_rainDropletSize:new s.cj(m),u_distortionStrength:new s.ci(m),u_rainDirection:new s.ch(m),u_color:new s.d2(m),u_screenSize:new s.cj(m),u_thinningCenterPos:new s.cj(m),u_thinningShape:new s.ch(m),u_thinningAffectedRatio:new s.ci(m),u_thinningParticleOffset:new s.ci(m),u_shapeDirectionalPower:new s.ci(m),u_shapeNormalPower:new s.ci(m),u_mode:new s.ci(m)}),vignette:m=>({u_vignetteShape:new s.ch(m),u_vignetteColor:new s.d2(m)}),occlusion:m=>({u_matrix:new s.ck(m),u_anchorPos:new s.ch(m),u_screenSizePx:new s.cj(m),u_occluderSizePx:new s.cj(m),u_color:new s.d2(m)})};class Lu{constructor(n,u,p,v){this.id=Lu.uniqueIdxCounter,Lu.uniqueIdxCounter++,this.context=n;const x=n.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||v||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=Lu.uniqueIdxCounter,Lu.uniqueIdxCounter++;const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Lu.uniqueIdxCounter=0;const hb={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class fI{constructor(n,u,p,v,x,w){this.length=u.length,this.attributes=p,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.instanceCount=w,this.context=n;const I=n.gl;this.buffer=I.createBuffer(),n.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||x||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,u){for(let p=0;p<this.attributes.length;p++){const v=u.getAttributeLocation(n,this.attributes[p].name);v!==-1&&n.enableVertexAttribArray(v)}}setVertexAttribPointers(n,u,p){for(let v=0;v<this.attributes.length;v++){const x=this.attributes[v],w=u.getAttributeLocation(n,x.name);w!==-1&&n.vertexAttribPointer(w,x.components,n[hb[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(n,u,p){for(let v=0;v<this.attributes.length;v++){const x=u.getAttributeLocation(n,this.attributes[v].name);x!==-1&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(x,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class R_{constructor(n,u,p,v,x){this.context=n,this.width=u,this.height=p;const w=this.framebuffer=n.gl.createFramebuffer();v&&(this.colorAttachment=new ob(n,w)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new ab(n,w):new nI(n,w))}destroy(){const n=this.context.gl;if(this.colorAttachment){const u=this.colorAttachment.get();u&&n.deleteTexture(u)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const u=this.depthAttachment.get();u&&n.deleteRenderbuffer(u)}else{const u=this.depthAttachment.get();u&&n.deleteTexture(u)}n.deleteFramebuffer(this.framebuffer)}}class Iy{constructor(n,u){this.gl=n,this.clearColor=new Jx(this),this.clearDepth=new ry(this),this.clearStencil=new JE(this),this.colorMask=new QE(this),this.depthMask=new eI(this),this.stencilMask=new tI(this),this.stencilFunc=new Qx(this),this.stencilOp=new iI(this),this.stencilTest=new h_(this),this.depthRange=new rI(this),this.depthTest=new eb(this),this.depthFunc=new ny(this),this.blend=new d_(this),this.blendFunc=new sy(this),this.blendColor=new zh(this),this.blendEquation=new Jd(this),this.cullFace=new f_(this),this.cullFaceSide=new p_(this),this.frontFace=new Qd(this),this.program=new tb(this),this.activeTexture=new oy(this),this.viewport=new ib(this),this.bindFramebuffer=new ef(this),this.bindRenderbuffer=new m_(this),this.bindTexture=new __(this),this.bindVertexBuffer=new ay(this),this.bindElementBuffer=new g_(this),this.bindVertexArrayOES=new Tp(this),this.pixelStoreUnpack=new rb(this),this.pixelStoreUnpackPremultiplyAlpha=new nb(this),this.pixelStoreUnpackFlipY=new sb(this),this.options=u?Object.assign({},u):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=u&&!!u.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,u,p){return new Lu(this,n,u,p)}createVertexBuffer(n,u,p,v,x){return new fI(this,n,u,p,v,x)}createRenderbuffer(n,u,p){const v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,n,u,p),this.bindRenderbuffer.set(null),x}createFramebuffer(n,u,p,v){return new R_(this,n,u,p,v)}clear({color:n,depth:u,stencil:p,colorMask:v}){const x=this.gl;let w=0;n&&(w|=x.COLOR_BUFFER_BIT,this.clearColor.set(n.toNonPremultipliedRenderColor(null)),this.colorMask.set(v||[!0,!0,!0,!0])),u!==void 0&&(w|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),p!==void 0&&(w|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),x.clear(w)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){s.by(n.blendFunction,Di.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let yc;function Ap(m,n,u,p,v,x,w){const I=m.context,C=I.gl,D=m.transform,F=[s.aF(D.center.lng),s.aJ(D.center.lat)],V=u.layout.get("symbol-placement"),z=u.layout.get("text-variable-anchor"),j=u.layout.get("icon-rotation-alignment")==="map",G=u.layout.get("text-rotation-alignment")==="map",H=V!=="point",ee=[];let K=0,ie=0;for(let pe=0;pe<p.length;pe++){const we=p[pe],Je=n.getTile(we),$e=Je.getBucket(u);if(!$e)continue;const ot=$e.getProjection().createInversionMatrix(D,we.canonical),Xe=[],nt=Ud(we,$e,D),Dt=!w&&j&&H,Ye=w&&G&&H,De=z&&$e.hasTextData(),ct=$e.hasIconTextFit()&&De&&$e.hasIconData(),tt=Dt||Ye||w&&De||ct,bt=$e.projection.name==="globe",kt=bt?s.aj(D.zoom):0;bt&&(Xe.push("PROJECTION_GLOBE_VIEW"),tt&&Xe.push("PROJECTED_POS_ON_VIEWPORT"));const $t=m.getOrCreateProgram("collisionBox",{defines:Xe});let Ct=nt;v[0]===0&&v[1]===0||(Ct=m.translatePosMatrix(nt,Je,v,x));const It=w?$e.textCollisionBox:$e.iconCollisionBox,fi=$e.collisionCircleArray;if(fi.length>0){const di=s.bC(),oi=Ct;s.cO(di,$e.placementInvProjMatrix,D.glCoordMatrix),s.cO(di,di,$e.placementViewportMatrix),ee.push({circleArray:fi,circleOffset:ie,transform:oi,invTransform:di,projection:$e.getProjection()}),K+=fi.length/4,ie=K}if(!It)continue;m.terrain&&m.terrain.setupElevationDraw(Je,$t);const li=bt?[we.canonical.x,we.canonical.y,1<<we.canonical.z]:[0,0,0];$t.draw(m,C.LINES,Gt.disabled,Pi.disabled,m.colorModeForRenderPass(),Bi.disabled,gy(Ct,ot,D,kt,F,Je,li,$e.getProjection()),u.id,It.layoutVertexBuffer,It.indexBuffer,It.segments,null,D.zoom,null,[It.collisionVertexBuffer,It.collisionVertexBufferExt])}if(!w||!ee.length)return;const ae=m.getOrCreateProgram("collisionCircle"),ce=new s.dW;ce.resize(4*K),ce._trim();let ve=0;for(const pe of ee)for(let we=0;we<pe.circleArray.length/4;we++){const Je=4*we,$e=pe.circleArray[Je+0],ot=pe.circleArray[Je+1],Xe=pe.circleArray[Je+2],nt=pe.circleArray[Je+3];ce.emplace(ve++,$e,ot,Xe,nt,0),ce.emplace(ve++,$e,ot,Xe,nt,1),ce.emplace(ve++,$e,ot,Xe,nt,2),ce.emplace(ve++,$e,ot,Xe,nt,3)}(!yc||yc.length<2*K)&&(yc=function(pe){const we=2*pe,Je=new s.b1;Je.resize(we),Je._trim();for(let $e=0;$e<we;$e++){const ot=6*$e;Je.uint16[ot+0]=4*$e+0,Je.uint16[ot+1]=4*$e+1,Je.uint16[ot+2]=4*$e+2,Je.uint16[ot+3]=4*$e+2,Je.uint16[ot+4]=4*$e+3,Je.uint16[ot+5]=4*$e+0}return Je}(K));const _e=I.createIndexBuffer(yc,!0),xe=I.createVertexBuffer(ce,s.dX.members,!0);for(const pe of ee){const we={u_matrix:pe.transform,u_inv_matrix:pe.invTransform,u_camera_to_center_distance:(ge=D).getCameraToCenterDistance(pe.projection),u_viewport_size:[ge.width,ge.height]};ae.draw(m,C.TRIANGLES,Gt.disabled,Pi.disabled,m.colorModeForRenderPass(),Bi.disabled,we,u.id,xe,_e,s.bg.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,D.zoom)}var ge;xe.destroy(),_e.destroy()}const Ou=s.bC();function Sy(m){const n=m._camera.getWorldToCamera(m.worldSize,1),u=s.aB([],n,m.globeMatrix);s.bl(u,u);const p=[0,0,0],v=[0,1,0,0];return s.aC(v,v,u),p[0]=v[0],p[1]=v[1],p[2]=v[2],s.aw(p,p),p}function P_({width:m,height:n,anchor:u,textOffset:p,textScale:v},x){const{horizontalAlign:w,verticalAlign:I}=s.c0(u),C=-(w-.5)*m,D=-(I-.5)*n,F=s.c1(u,p);return new s.P((C/v+F[0])*x,(D/v+F[1])*x)}function M_(m,n,u,p,v,x,w,I,C,D){const F=m.text.placedSymbolArray,V=m.text.dynamicLayoutVertexArray,z=m.icon.dynamicLayoutVertexArray,j={},G=m.getProjection(),H=ts(w,G,v),ee=v.elevation,K=G.upVectorScale(w.canonical,v.center.lat,v.worldSize).metersToTile;V.clear();for(let ie=0;ie<F.length;ie++){const ae=F.get(ie),{tileAnchorX:ce,tileAnchorY:ve,numGlyphs:_e}=ae,xe=ae.hidden||!ae.crossTileID||m.allowVerticalPlacement&&!ae.placedOrientation?null:p[ae.crossTileID];if(xe){let ge=0,pe=0,we=0;if(ee){const ct=ee?ee.getAtTileOffset(w,ce,ve):0,[tt,bt,kt]=G.upVector(w.canonical,ce,ve);ge=ct*tt*K,pe=ct*bt*K,we=ct*kt*K}let[Je,$e,ot,Xe]=Vs(ae.projectedAnchorX+ge,ae.projectedAnchorY+pe,ae.projectedAnchorZ+we,u?H:x);const nt=mc(v.getCameraToCenterDistance(G),Xe);let Dt=s.bM(m.textSizeData,C,ae)*nt/s.bX;u&&(Dt*=m.tilePixelRatio/I);const Ye=P_(xe,Dt);u?({x:Je,y:$e,z:ot}=G.projectTilePoint(ce+Ye.x,ve+Ye.y,w.canonical),[Je,$e,ot]=Vs(Je+ge,$e+pe,ot+we,x)):(n&&Ye._rotate(-v.angle),Je+=Ye.x,$e+=Ye.y,ot=0);const De=m.allowVerticalPlacement&&ae.placedOrientation===s.bL.vertical?Math.PI/2:0;for(let ct=0;ct<_e;ct++)s.bO(V,Je,$e,ot,De);D&&ae.associatedIconIndex>=0&&(j[ae.associatedIconIndex]={x:Je,y:$e,z:ot,angle:De})}else Ri(_e,V)}if(D){z.clear();const ie=m.icon.placedSymbolArray;for(let ae=0;ae<ie.length;ae++){const ce=ie.get(ae),{numGlyphs:ve}=ce,_e=j[ae];if(ce.hidden||!_e)Ri(ve,z);else{const{x:xe,y:ge,z:pe,angle:we}=_e;for(let Je=0;Je<ve;Je++)s.bO(z,xe,ge,pe,we)}}m.icon.dynamicLayoutVertexBuffer.updateData(z)}m.text.dynamicLayoutVertexBuffer.updateData(V)}function Cp(m,n,u,p,v,x,w={}){const I=u.paint.get("icon-translate"),C=u.paint.get("text-translate"),D=u.paint.get("icon-translate-anchor"),F=u.paint.get("text-translate-anchor"),V=u.layout.get("icon-rotation-alignment"),z=u.layout.get("text-rotation-alignment"),j=u.layout.get("icon-pitch-alignment"),G=u.layout.get("text-pitch-alignment"),H=u.layout.get("icon-keep-upright"),ee=u.layout.get("text-keep-upright"),K=u.paint.get("icon-color-saturation"),ie=u.paint.get("icon-color-contrast"),ae=u.paint.get("icon-color-brightness-min"),ce=u.paint.get("icon-color-brightness-max"),ve=u.layout.get("symbol-elevation-reference")==="sea",_e=u.layout.get("icon-image-use-theme")==="none",xe=m.context,ge=xe.gl,pe=m.transform,we=V==="map",Je=z==="map",$e=j==="map",ot=G==="map",Xe=u.layout.get("symbol-sort-key").constantOr(1)!==void 0;let nt=!1;const Dt=m.depthModeForSublayer(0,Gt.ReadOnly),Ye=new Gt(m.context.gl.LEQUAL,Gt.ReadOnly,m.depthRangeFor3D),De=[s.aF(pe.center.lng),s.aJ(pe.center.lat)],ct=u.layout.get("text-variable-anchor"),tt=pe.projection.name==="globe",bt=[],kt=[0,-1,0];for(const $t of p){const Ct=n.getTile($t),It=Ct.getBucket(u);if(!It||It.projection.name==="mercator"&&tt||It.fullyClipped)continue;const fi=It.projection.name==="globe",li=fi?s.aj(pe.zoom):0,di=ts($t,It.getProjection(),pe),oi=pe.calculatePixelsToTileUnitsMatrix(Ct),Vi=ct&&It.hasTextData(),Ki=It.hasIconTextFit()&&Vi&&It.hasIconData(),Qi=It.getProjection().createInversionMatrix(pe,$t.canonical),Zr=(1<<Ct.tileID.canonical.z)*s.al/m.transform.worldSize,Gi=Ln=>{let er=[0,0,0];if(Ln){const Fi=m.style.directionalLight,Kr=m.style.ambientLight;Fi&&Kr&&(er=Ul(m.style,Fi,Kr))}return er},Lr=Ln=>{pe.depthOcclusionForSymbolsAndCircles&&(u.hasOcclusionOpacityProperties||m.terrain)&&(Ln.push("DEPTH_D24"),Ln.push("DEPTH_OCCLUSION"))},Wr=Ln=>{u.lut&&!_e&&(u.lut.texture||(u.lut.texture=new s.dY(m.context,u.lut.image,[u.lut.image.height,u.lut.image.height,u.lut.image.height],xe.gl.RGBA8)),xe.activeTexture.set(xe.gl.TEXTURE0+bs.LUT),u.lut.texture&&u.lut.texture.bind(xe.gl.LINEAR,xe.gl.CLAMP_TO_EDGE),Ln.push("APPLY_LUT_ON_GPU"))},An=()=>{const Ln=we&&u.layout.get("symbol-placement")!=="point",er=[];Lr(er),Wr(er);const Fi=Ln||Ki,Kr=It.elevationType==="road",Yn=m.shadowRenderer,zn=Kr&&$e&&!!Yn&&Yn.enabled,ws=Gi(zn),lo=Kr&&$e&&!m.terrain?Ye:Dt,il=u.paint.get("icon-image-cross-fade");m.terrainRenderModeElevated()&&$e&&er.push("PITCH_WITH_MAP_TERRAIN"),fi&&(er.push("PROJECTION_GLOBE_VIEW"),Fi&&er.push("PROJECTED_POS_ON_VIEWPORT")),il>0&&It.hasAnySecondaryIcon&&er.push("ICON_TRANSITION"),!It.icon.zOffsetVertexBuffer||Kr&&m.terrain||er.push("Z_OFFSET"),K===0&&ie===0&&ae===0&&ce===1||er.push("COLOR_ADJUSTMENT"),It.sdfIcons&&er.push("RENDER_SDF"),zn&&er.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Kr&&$e&&!m.terrain&&It.icon.orientationVertexBuffer&&er.push("ELEVATED_ROADS");const rl=It.icon.programConfigurations.get(u.id),Ca=m.getOrCreateProgram("symbol",{config:rl,defines:er}),Ra=Ct.imageAtlasTexture?Ct.imageAtlasTexture.size:[0,0],Zo=It.iconSizeData,El=s.bK(Zo,pe.zoom),Hl=$e||!pe.isOrthographic,rs=Ea(di,Ct.tileID.canonical,$e,we,pe,It.getProjection(),oi),as=Ph(di,Ct.tileID.canonical,$e,we,pe,It.getProjection(),oi),Nn=m.translatePosMatrix(as,Ct,I,D,!0),Ls=m.translatePosMatrix(di,Ct,I,D),Xs=Fi?Ou:rs,vs=we&&!$e&&!Ln;let wo=kt;!tt&&!pe.mercatorFromTransition||we||(wo=Sy(pe));const wc=fi?wo:kt,Qc=u.getColorAdjustmentMatrix(K,ie,ae,ce),ql=Ty(Zo.kind,El,vs,$e,m,Ls,Xs,Nn,ve,!1,Ra,[0,0],0,$t,li,De,Qi,wc,It.getProjection(),ws,Zr,Qc,il,null),Gu=Ct.imageAtlasTexture?Ct.imageAtlasTexture:null,Hu=u.layout.get("icon-size").constantOr(0)!==1||It.iconsNeedLinear,Tc=It.sdfIcons||m.options.rotating||m.options.zooming||Hu||Hl?ge.LINEAR:ge.NEAREST,_f=It.sdfIcons&&u.paint.get("icon-halo-width").constantOr(1)!==0,eu=m.terrain&&$e&&Ln?s.bl(s.bC(),rs):Ou;if(Ln&&It.icon){const Ec=pe.elevation,tu=Ec?Ec.getAtTileOffsetFunc($t,pe.center.lat,pe.worldSize,It.getProjection()):null,J_=pc(di,Ct.tileID.canonical,$e,we,pe,It.getProjection(),oi);qc(It,di,m,!1,J_,as,$e,H,tu,$t)}return{program:Ca,buffers:It.icon,uniformValues:ql,atlasTexture:Gu,atlasTextureIcon:null,atlasInterpolation:Tc,atlasInterpolationIcon:null,isSDF:It.sdfIcons,hasHalo:_f,depthMode:lo,tile:Ct,renderWithShadows:zn,labelPlaneMatrixInv:eu}},Yi=()=>{const Ln=Je&&u.layout.get("symbol-placement")!=="point",er=[],Fi=Ln||ct||Ki,Kr=It.elevationType==="road",Yn=m.shadowRenderer,zn=Kr&&ot&&!!Yn&&Yn.enabled,ws=Gi(zn),lo=Kr&&ot&&!m.terrain?Ye:Dt;m.terrainRenderModeElevated()&&ot&&er.push("PITCH_WITH_MAP_TERRAIN"),fi&&(er.push("PROJECTION_GLOBE_VIEW"),Fi&&er.push("PROJECTED_POS_ON_VIEWPORT")),!It.text.zOffsetVertexBuffer||Kr&&m.terrain||er.push("Z_OFFSET"),It.iconsInText&&er.push("RENDER_TEXT_AND_SYMBOL"),er.push("RENDER_SDF"),zn&&er.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Kr&&ot&&!m.terrain&&It.text.orientationVertexBuffer&&er.push("ELEVATED_ROADS"),Lr(er);const il=It.text.programConfigurations.get(u.id),rl=m.getOrCreateProgram("symbol",{config:il,defines:er});let Ca,Ra=[0,0],Zo=null;const El=It.textSizeData;It.iconsInText&&(Ra=Ct.imageAtlasTexture?Ct.imageAtlasTexture.size:[0,0],Zo=Ct.imageAtlasTexture?Ct.imageAtlasTexture:null,Ca=ot||!pe.isOrthographic||m.options.rotating||m.options.zooming||El.kind==="composite"||El.kind==="camera"?ge.LINEAR:ge.NEAREST);const Hl=Ct.glyphAtlasTexture?Ct.glyphAtlasTexture.size:[0,0],rs=u.layout.get("text-size-scale-range"),as=s.aA(m.scaleFactor,rs[0],rs[1]),Nn=s.bK(El,pe.zoom,as),Ls=Ea(di,Ct.tileID.canonical,ot,Je,pe,It.getProjection(),oi),Xs=Ph(di,Ct.tileID.canonical,ot,Je,pe,It.getProjection(),oi),vs=m.translatePosMatrix(Xs,Ct,C,F,!0),wo=m.translatePosMatrix(di,Ct,C,F),wc=Fi?Ou:Ls,Qc=Je&&!ot&&!Ln;let ql=kt;!tt&&!pe.mercatorFromTransition||Je||(ql=Sy(pe));const Gu=Ty(El.kind,Nn,Qc,ot,m,wo,wc,vs,ve,!0,Hl,Ra,0,$t,li,De,Qi,fi?ql:kt,It.getProjection(),ws,Zr,null,null,as),Hu=Ct.glyphAtlasTexture?Ct.glyphAtlasTexture:null,Tc=ge.LINEAR,_f=u.paint.get("text-halo-width").constantOr(1)!==0,eu=m.terrain&&ot&&Ln?s.bl(s.bC(),Ls):Ou;if(Ln&&It.text){const Ec=pe.elevation,tu=Ec?Ec.getAtTileOffsetFunc($t,pe.center.lat,pe.worldSize,It.getProjection()):null,J_=pc(di,Ct.tileID.canonical,ot,Je,pe,It.getProjection(),oi);qc(It,di,m,!0,J_,Xs,ot,ee,tu,$t)}return{program:rl,buffers:It.text,uniformValues:Gu,atlasTexture:Hu,atlasTextureIcon:Zo,atlasInterpolation:Tc,atlasInterpolationIcon:Ca,isSDF:!0,hasHalo:_f,depthMode:lo,tile:Ct,renderWithShadows:zn,labelPlaneMatrixInv:eu}},Ur=It.icon.segments.get().length,zr=It.text.segments.get().length,Hr=Ur&&!w.onlyText?An():null,Dn=zr&&!w.onlyIcons?Yi():null,os=u.paint.get("icon-opacity").constantOr(1),Ws=u.paint.get("text-opacity").constantOr(1);if(Xe&&It.canOverlap){nt=!0;const Ln=os&&!w.onlyText?It.icon.segments.get():[],er=Ws&&!w.onlyIcons?It.text.segments.get():[];for(const Fi of Ln)bt.push({segments:new s.bg([Fi]),sortKey:Fi.sortKey,state:Hr});for(const Fi of er)bt.push({segments:new s.bg([Fi]),sortKey:Fi.sortKey,state:Dn})}else w.onlyText||bt.push({segments:os?It.icon.segments:new s.bg([]),sortKey:0,state:Hr}),w.onlyIcons||bt.push({segments:Ws?It.text.segments:new s.bg([]),sortKey:0,state:Dn})}nt&&bt.sort(($t,Ct)=>$t.sortKey-Ct.sortKey);for(const $t of bt){const Ct=$t.state;if(Ct)if(m.terrain?m.terrain.setupElevationDraw(Ct.tile,Ct.program,{useDepthForOcclusion:pe.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ct.labelPlaneMatrixInv}):m.setupDepthForOcclusion(pe.depthOcclusionForSymbolsAndCircles,Ct.program),xe.activeTexture.set(ge.TEXTURE0),Ct.atlasTexture&&Ct.atlasTexture.bind(Ct.atlasInterpolation,ge.CLAMP_TO_EDGE,!0),Ct.atlasTextureIcon&&(xe.activeTexture.set(ge.TEXTURE1),Ct.atlasTextureIcon&&Ct.atlasTextureIcon.bind(Ct.atlasInterpolationIcon,ge.CLAMP_TO_EDGE,!0)),Ct.renderWithShadows&&m.shadowRenderer.setupShadows(Ct.tile.tileID.toUnwrapped(),Ct.program,"vector-tile"),m.uploadCommonLightUniforms(m.context,Ct.program),Ct.hasHalo){const It=Ct.uniformValues;It.u_is_halo=1,k_(Ct.buffers,$t.segments,u,m,Ct.program,Ct.depthMode,v,x,It,2),It.u_is_halo=0}else{if(Ct.isSDF){const It=Ct.uniformValues;Ct.hasHalo&&(It.u_is_halo=1,k_(Ct.buffers,$t.segments,u,m,Ct.program,Ct.depthMode,v,x,It,1)),It.u_is_halo=0}k_(Ct.buffers,$t.segments,u,m,Ct.program,Ct.depthMode,v,x,Ct.uniformValues,1)}}}function k_(m,n,u,p,v,x,w,I,C,D){const F=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer,m.orientationVertexBuffer];v.draw(p,p.context.gl.TRIANGLES,x,w,I,Bi.disabled,C,u.id,m.layoutVertexBuffer,m.indexBuffer,n,u.paint,p.transform.zoom,m.programConfigurations.get(u.id),F,D)}function db(m,n){const u=1<<m.canonical.z,p=(n.x*u-m.canonical.x-m.wrap*u)*s.al,v=(n.y*u-m.canonical.y)*s.al,x=s.e5(n.z,n.y);return s.d4(p,v,x)}function $h(m,n,u,p,v){if(!u.layout||u.layout.get("fill-elevation-reference")==="none")return;const x=m.context.gl,w=new Gt(m.context.gl.LEQUAL,Gt.ReadWrite,m.depthRangeFor3D),I=new Gt(m.context.gl.GREATER,Gt.ReadWrite,m.depthRangeFor3D),C=function(j){let G=.01;return j.isOrthographic&&(G=s.ak(1e-4,G,s.c$(j.pitch>=Xc?1:j.pitch/Xc))),2*G}(m.transform),D=m.transform.getFreeCameraOptions().position,F="elevatedStructuresDepthReconstruct",V=m.getOrCreateProgram(F,{defines:["DEPTH_RECONSTRUCTION"]}),z=m.getOrCreateProgram(F);for(const j of p){const G=n.getTile(j),H=G.getBucket(u);if(!H)continue;const ee=H.elevatedStructures;if(!ee)continue;const K=H.elevationBufferData.heightRange,ie=db(j.toUnwrapped(),D),ae=m.translatePosMatrix(j.projMatrix,G,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));let ce,ve,_e,xe;if(v==="initialize"){if(!K||K.min>=1||ee.depthSegments.segments[0].primitiveLength===0)continue;ce=T_(ae,ie,C,1,0),ve=w,_e=ee.depthSegments,xe=V}else if(v==="reset"){if(!K||K.min>=0||ee.maskSegments.segments[0].primitiveLength===0)continue;ce=T_(ae,ie,0,0,1),ve=I,_e=ee.maskSegments,xe=V}else if(v==="geometry"){if(ee.depthSegments.segments[0].primitiveLength===0)continue;ce=T_(ae,ie,C,1,0),ve=w,_e=ee.depthSegments,xe=z}xe.draw(m,x.TRIANGLES,ve,Pi.disabled,Di.disabled,Bi.disabled,ce,u.id,ee.vertexBuffer,ee.indexBuffer,_e,u.paint,m.transform.zoom)}}function sf(m,n,u){const{painter:p,sourceCache:v,layer:x,coords:w,colorMode:I,elevationType:C,terrainEnabled:D,pass:F}=m,V=p.context.gl,z=x.paint.get("fill-pattern"),j=x.paint.get("fill-pattern-cross-fade"),G=z.constantOr(null);let H=C;C!=="road"||n&&!D||(H="none");const ee=H==="road",K=m.painter.shadowRenderer,ie=ee&&!!K&&K.enabled,ae=new Gt(p.context.gl.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D);let ce=[0,0,0];if(ie){const xe=p.style.directionalLight,ge=p.style.ambientLight;xe&&ge&&(ce=Ul(p.style,xe,ge))}const ve=z&&z.constantOr(1),_e=(xe,ge)=>{let pe,we,Je,$e,ot;ge?(pe=ve&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Je=V.LINES):(pe=ve?"fillPattern":"fill",Je=V.TRIANGLES);for(const Xe of w){const nt=v.getTile(Xe);if(ve&&!nt.patternsLoaded())continue;const Dt=nt.getBucket(x);if(!Dt)continue;const Ye=n?Dt.elevationBufferData:Dt.bufferData;if(Ye.isEmpty())continue;p.prepareDrawTile();const De=Ye.programConfigurations.get(x.id),ct=p.isTileAffectedByFog(Xe),tt=[],bt=[];ee&&(tt.push("ELEVATED_ROADS"),bt.push(Ye.elevatedLayoutVertexBuffer)),ie&&tt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ve&&(p.context.activeTexture.set(V.TEXTURE0),nt.imageAtlasTexture&&nt.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),De.updatePaintBuffers());let kt=!1;if(G&&nt.imageAtlas){const li=nt.imageAtlas,di=s.e0.from(G),oi=di.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),Vi=di.getSecondary(),Ki=li.patternPositions.get(oi),Qi=Vi?li.patternPositions.get(Vi.scaleSelf(s.o.devicePixelRatio).toString()):null;kt=!!Ki&&!!Qi,Ki&&De.setConstantPatternPositions(Ki,Qi)}j>0&&(kt||De.getPatternTransitionVertexBuffer("fill-pattern"))&&tt.push("FILL_PATTERN_TRANSITION");const $t=p.getOrCreateProgram(pe,{config:De,overrideFog:ct,defines:tt}),Ct=p.translatePosMatrix(Xe.projMatrix,nt,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));ie&&K.setupShadows(nt.tileID.toUnwrapped(),$t,"vector-tile");const It=x.paint.get("fill-emissive-strength");if(ge){$e=Ye.lineIndexBuffer,ot=Ye.lineSegments;const li=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[V.drawingBufferWidth,V.drawingBufferHeight];we=pe==="fillOutlinePattern"&&ve?lI(Ct,It,p,nt,li,ce,j):aI(Ct,It,li,ce)}else $e=Ye.indexBuffer,ot=Ye.triangleSegments,we=ve?Vh(Ct,It,p,nt,ce,j):my(Ct,It,ce);p.uploadCommonUniforms(p.context,$t,Xe.toUnwrapped());let fi=xe;(C==="road"&&!D||C==="offset")&&(fi=ae),$t.draw(p,Je,fi,u||p.stencilModeForClipping(Xe),I,Bi.disabled,we,x.id,Ye.layoutVertexBuffer,$e,ot,x.paint,p.transform.zoom,De,bt)}};p.renderPass===F&&_e(p.depthModeForSublayer(1,p.renderPass==="opaque"?Gt.ReadWrite:Gt.ReadOnly),!1),H==="none"&&p.renderPass==="translucent"&&x.paint.get("fill-antialias")&&_e(p.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,Gt.ReadOnly),!0)}function Zt(m,n,u,p,v,x,w,I){u.resetLayerRenderingStats(m);const C=m.context,D=C.gl,F=m.transform,V=u.paint.get("fill-extrusion-pattern"),z=u.paint.get("fill-extrusion-pattern-cross-fade"),j=V.constantOr(null),G=V.constantOr(1),H=u.paint.get("fill-extrusion-opacity"),ee=m.style.enable3dLights(),K=u.paint.get(ee&&!G?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ie=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),K],ae=u.layout.get("fill-extrusion-edge-radius"),ce=ae>0&&!u.paint.get("fill-extrusion-rounded-roof"),ve=ce?0:ae,_e=F.projection.name==="globe"?s.e8():0,xe=F.projection.name==="globe",ge=xe?s.aj(F.zoom):0,pe=[s.aF(F.center.lng),s.aJ(F.center.lat)],we=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Je=u.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(we?null:u.lut).toArray01().slice(0,3),$e=u.paint.get("fill-extrusion-flood-light-intensity"),ot=u.paint.get("fill-extrusion-vertical-scale"),Xe=u.paint.get("fill-extrusion-line-width").constantOr(1)!==0,nt=u.paint.get("fill-extrusion-height-alignment"),Dt=u.paint.get("fill-extrusion-base-alignment"),Ye=Ru(m,u.paint.get("fill-extrusion-cutoff-fade-range")),De=[];let ct;xe&&De.push("PROJECTION_GLOBE_VIEW"),ie[0]>0&&De.push("FAUX_AO"),ce&&De.push("ZERO_ROOF_RADIUS"),I&&De.push("HAS_CENTROID"),$e>0&&De.push("FLOOD_LIGHT"),Ye.shouldRenderCutoff&&De.push("RENDER_CUTOFF"),Xe&&De.push("RENDER_WALL_MODE");const tt=m.renderPass==="shadow",bt=m.shadowRenderer,kt=tt&&!!bt,$t=tt?Bi.disabled:Bi.backCCW;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let Ct=[0,0,0];if(bt){const li=m.style.directionalLight,di=m.style.ambientLight;li&&di&&(Ct=Ul(m.style,li,di)),tt||(De.push("RENDER_SHADOWS","DEPTH_TEXTURE"),bt.useNormalOffset&&De.push("NORMAL_OFFSET")),ct=De.concat(["SHADOWS_SINGLE_CASCADE"])}const It=kt?"fillExtrusionDepth":G?"fillExtrusionPattern":"fillExtrusion",fi=u.getLayerRenderingStats();for(const li of p){const di=n.getTile(li),oi=di.getBucket(u);if(!oi||oi.projection.name!==F.projection.name)continue;let Vi=!1;bt&&(Vi=bt.getMaxCascadeForTile(li.toUnwrapped())===0);const Ki=m.isTileAffectedByFog(li),Qi=oi.programConfigurations.get(u.id);let Zr=!1;if(j&&di.imageAtlas){const zr=di.imageAtlas,Hr=s.e0.from(j),Dn=Hr.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),os=Hr.getSecondary(),Ws=zr.patternPositions.get(Dn),Ln=os?zr.patternPositions.get(os.scaleSelf(s.o.devicePixelRatio).toString()):null;Zr=!!Ws&&!!Ln,Ws&&Qi.setConstantPatternPositions(Ws,Ln)}z>0&&(Zr||Qi.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&De.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Gi=m.getOrCreateProgram(It,{config:Qi,defines:Vi?ct:De,overrideFog:Ki});if(m.terrain&&m.terrain.setupElevationDraw(di,Gi,{useMeterToDem:!0}),!oi.centroidVertexBuffer){const zr=Gi.getAttributeLocation(D,"a_centroid_pos");zr!==-1&&D.vertexAttrib2f(zr,0,0)}!tt&&bt&&bt.setupShadows(di.tileID.toUnwrapped(),Gi,"vector-tile"),G&&(m.context.activeTexture.set(D.TEXTURE0),di.imageAtlasTexture&&di.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Qi.updatePaintBuffers());const Lr=u.paint.get("fill-extrusion-vertical-gradient"),Wr=1/oi.tileToMeter;let An;if(tt&&bt){if(fb(di.tileID,oi.maxHeight,m))continue;const zr=bt.calculateShadowPassMatrixFromTile(di.tileID.toUnwrapped());An=py(zr,ve,Wr,ot,nt,Dt)}else{const zr=m.translatePosMatrix(li.expandedProjMatrix,di,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Hr=F.projection.createInversionMatrix(F,li.canonical);An=G?cb(zr,m,Lr,H,ie,ve,Wr,li,di,_e,nt,Dt,ge,pe,Hr,Je,ot,z):Sp(zr,m,Lr,H,ie,ve,Wr,li,_e,nt,Dt,ge,pe,Hr,Je,ot,$e,Ct)}m.uploadCommonUniforms(C,Gi,li.toUnwrapped(),null,Ye);let Yi=oi.segments;if(F.projection.name==="mercator"&&!tt&&(Yi=oi.getVisibleSegments(di.tileID,m.terrain,m.transform.getFrustum(0)),!Yi.get().length))continue;if(fi)if(tt)for(const zr of Yi.get())fi.numRenderedVerticesInShadowPass+=zr.primitiveLength;else for(const zr of Yi.get())fi.numRenderedVerticesInTransparentPass+=zr.primitiveLength;const Ur=[];(m.terrain||I)&&Ur.push(oi.centroidVertexBuffer),xe&&Ur.push(oi.layoutVertexExtBuffer),Xe&&Ur.push(oi.wallVertexBuffer),Gi.draw(m,C.gl.TRIANGLES,v,x,w,$t,An,u.id,oi.layoutVertexBuffer,oi.indexBuffer,Yi,u.paint,m.transform.zoom,Qi,Ur)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}class Ay{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Zc(m,n,u,p,v,x,w,I,C,D,F,V,z,j,G,H,ee,K,ie,ae){const ce=n.context,ve=ce.gl,_e=n.transform,xe=n.transform.zoom,ge=[],pe=m.translate,we=m.translateAnchor,Je=m.edgeRadius,$e=Ru(n,m.cutoffFadeRange);F==="clear"?(ge.push("CLEAR_SUBPASS"),ae&&(ge.push("CLEAR_FROM_TEXTURE"),ce.activeTexture.set(ve.TEXTURE0),ae.bind(ve.LINEAR,ve.CLAMP_TO_EDGE))):F==="sdf"&&ge.push("SDF_SUBPASS"),K&&ge.push("HAS_CENTROID"),$e.shouldRenderCutoff&&ge.push("RENDER_CUTOFF");const ot=(Xe,nt,Dt,Ye,De)=>{const ct=nt.programConfigurations.get(p.id),tt=n.isTileAffectedByFog(Xe),bt=n.getOrCreateProgram("fillExtrusionGroundEffect",{config:ct,defines:ge,overrideFog:tt}),kt=((Ct,It,fi,li,di,oi,Vi,Ki,Qi,Zr,Gi)=>({u_matrix:It,u_opacity:fi,u_ao_pass:li?1:0,u_meter_to_tile:di,u_ao:oi,u_flood_light_intensity:Vi,u_flood_light_color:Ki,u_attenuation:Qi,u_edge_radius:Zr,u_fb:0,u_fb_size:Gi,u_dynamic_offset:1}))(0,Ye,V,D,De,[z,j*De],G,H,ee,xe>=17?0:Je*De,ae?ae.size[0]:0),$t=[];K&&$t.push(nt.hiddenByLandmarkVertexBuffer),n.uploadCommonUniforms(ce,bt,Xe.toUnwrapped(),null,$e),bt.draw(n,ce.gl.TRIANGLES,x,w,I,C,kt,p.id,nt.vertexBuffer,nt.indexBuffer,Dt,p.paint,xe,ct,$t)};for(const Xe of v){const nt=u.getTile(Xe),Dt=nt.getBucket(p);if(!Dt||Dt.projection.name!==_e.projection.name||!Dt.groundEffect||Dt.groundEffect&&!Dt.groundEffect.hasData())continue;const Ye=Dt.groundEffect,De=1/Dt.tileToMeter;{const ct=n.translatePosMatrix(Xe.projMatrix,nt,pe,we),tt=Ye.getDefaultSegment();ot(Xe,Ye,tt,ct,De)}if(ie)for(let ct=0;ct<4;ct++){const tt=s.e6[ct](Xe),bt=u.getTile(tt);if(!bt)continue;const kt=bt.getBucket(p);if(!kt||kt.projection.name!==_e.projection.name||!kt.groundEffect||kt.groundEffect&&!kt.groundEffect.hasData())continue;const $t=kt.groundEffect;let Ct,It;ct===0?(Ct=[-s.al,0,0],It=1):ct===1?(Ct=[s.al,0,0],It=0):ct===2?(Ct=[0,-s.al,0],It=3):(Ct=[0,s.al,0],It=2);const fi=$t.regionSegments[It];if(!fi)continue;const li=new Float32Array(16);s.br(li,Xe.projMatrix,Ct),ot(Xe,$t,fi,n.translatePosMatrix(li,nt,pe,we),De)}}}function Fu(m,n,u,p,v,x,w){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const I=x?x.findDEMTileFor(u):null;if(!(I&&I.dem||w))return;x&&I&&I.dem&&p.selfDEMTileTimestamp!==I.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=I.dem._timestamp);const C=K=>new s.P(Math.ceil((K+s.ea)*s.eb),0),D=K=>{const ie=n.getSource().minzoom,ae=ve=>{const _e=n.getTileByID(ve);if(_e&&_e.hasData())return _e.getBucket(v)},ce=[0,-1,1];for(const ve of ce){if(K.overscaledZ+ve<ie)continue;const _e=ae(K.calculateScaledKey(K.overscaledZ+ve));if(_e)return _e}},F=[0,0,0],V=(K,ie)=>(F[0]=Math.min(K.min.y,ie.min.y),F[1]=Math.max(K.max.y,ie.max.y),F[2]=s.al-ie.min.x>K.max.x?ie.min.x-s.al:K.max.x,F),z=(K,ie)=>(F[0]=Math.min(K.min.x,ie.min.x),F[1]=Math.max(K.max.x,ie.max.x),F[2]=s.al-ie.min.y>K.max.y?ie.min.y-s.al:K.max.y,F),j=[(K,ie)=>V(K,ie),(K,ie)=>V(ie,K),(K,ie)=>z(K,ie),(K,ie)=>z(ie,K)],G=(K,ie,ae,ce,ve,_e,xe)=>{if(!x)return 0;const ge=[[_e?ae:K,_e?K:ae,0],[_e?ae:ie,_e?ie:ae,0]],pe=xe<0?s.al+xe:xe,we=[_e?pe:(K+ie)/2,_e?(K+ie)/2:pe,0];return ae===0&&xe<0||ae!==0&&xe>0?x.getForTilePoints(ve,[we],!0,ce):ge.push(we),x.getForTilePoints(u,ge,!0,I),Math.max(ge[0][2],ge[1][2],we[2])/x.exaggeration()};for(let K=0;K<4;K++){const ie=p.borderFeatureIndices[K];if(ie.length===0)continue;const ae=s.e6[K](u),ce=D(ae);if(!(ce&&ce instanceof s.e7))continue;const ve=x?x.findDEMTileFor(ae):null;if(!(ve&&ve.dem||w)||(x&&ve&&ve.dem&&p.borderDEMTileTimestamp[K]!==ve.dem._timestamp&&(p.borderDoneWithNeighborZ[K]=-1,p.borderDEMTileTimestamp[K]=ve.dem._timestamp),p.borderDoneWithNeighborZ[K]===ce.canonical.z))continue;ce.centroidVertexArray.length===0&&ce.createCentroidsBuffer();const _e=(K<2?1:5)-K,xe=ce.borderDoneWithNeighborZ[_e]!==p.canonical.z,ge=ce.borderFeatureIndices[_e];let pe=0;if(p.canonical.z!==ce.canonical.z){for(const we of ie)p.showCentroid(p.featuresOnBorder[we]);if(xe)for(const we of ge)ce.showCentroid(ce.featuresOnBorder[we]);p.borderDoneWithNeighborZ[K]=ce.canonical.z,ce.borderDoneWithNeighborZ[_e]=p.canonical.z}for(const we of ie){const Je=p.featuresOnBorder[we],$e=p.centroidData[Je.centroidDataIndex],ot=Je.borders[K];let Xe;for(;pe<ge.length;){Xe=ce.featuresOnBorder[ge[pe]];const nt=Xe.borders[_e];if(nt[1]>ot[0]+3||nt[0]>ot[0]-3)break;ce.showCentroid(Xe),pe++}if(Xe&&pe<ge.length){const nt=pe;let Dt=0;for(;!(Xe.borders[_e][0]>ot[1]-3)&&(Dt++,++pe!==ge.length);)Xe=ce.featuresOnBorder[ge[pe]];Xe=ce.featuresOnBorder[ge[nt]];let Ye=!1;if(Dt>=1){const tt=Xe.borders[_e];Math.abs(ot[0]-tt[0])<3&&Math.abs(ot[1]-tt[1])<3&&(Dt=1,Ye=!0,pe=nt+1)}else if(Dt===0){p.showCentroid(Je);continue}const De=ce.centroidData[Xe.centroidDataIndex];w&&Ye&&(((H=$e).flags|(ee=De).flags)&s.e9?(H.flags|=s.e9,ee.flags|=s.e9):(H.flags&=~s.e9,ee.flags&=~s.e9));const ct=Je.intersectsCount()>1||Xe.intersectsCount()>1;if(Dt>1)pe=nt,$e.centroidXY=De.centroidXY=new s.P(0,0);else if(ve&&ve.dem&&!ct){const tt=j[K]($e,De),bt=K%2?s.al-1:0,kt=G(tt[0],Math.min(s.al-1,tt[1]),bt,ve,ae,K<2,tt[2]);$e.centroidXY=De.centroidXY=C(kt)}else ct?$e.centroidXY=De.centroidXY=new s.P(0,0):($e.centroidXY=p.encodeBorderCentroid(Je),De.centroidXY=ce.encodeBorderCentroid(Xe));p.writeCentroidToBuffer($e),ce.writeCentroidToBuffer(De)}else p.showCentroid(Je)}p.borderDoneWithNeighborZ[K]=ce.canonical.z,ce.borderDoneWithNeighborZ[_e]=p.canonical.z}var H,ee;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(m)}const zu=[1,0,0],ki=[0,1,0],Cy=[0,0,1];function fb(m,n,u){const p=u.transform,v=u.shadowRenderer;if(!v)return!0;const x=m.toUnwrapped(),w=p.tileSize*v._cascades[u.currentShadowCascade].scale;let I=n;if(p.elevation){const H=p.elevation.getMinMaxForTile(m);H&&(I+=H.max)}const C=[...v.shadowDirection];C[2]=-C[2];const D=v.computeSimplifiedTileShadowVolume(x,I,w,C);if(!D)return!1;const F=[zu,ki,Cy,C,[C[0],0,C[2]],[0,C[1],C[2]]],V=p.projection.name==="globe",z=p.scaleZoom(w),j=s.cA.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,z,!V),G=v.getCurrentCascadeFrustum();return j.intersectsPrecise(D.vertices,D.planes,F)===0||G.intersectsPrecise(D.vertices,D.planes,F)===0}function D_(m){const{painter:n,source:u,layer:p,coords:v}=m;let x=m.defines;const w=n.context,I=n.renderPass==="shadow",C=n.renderPass==="light-beam",D=n.shadowRenderer,F=s.ec(n.transform.center.lat,n.transform.zoom),V=Ru(n,p.paint.get("building-cutoff-fade-range"));V.shouldRenderCutoff&&(x=x.concat("RENDER_CUTOFF"));for(const z of v){const j=u.getTile(z),G=j.getBucket(p);if(!G)continue;D&&D.getMaxCascadeForTile(z.toUnwrapped())===0&&(x=x.concat("SHADOWS_SINGLE_CASCADE"));const H=G.programConfigurations.get(p.id);let ee,K,ie,ae=n.translatePosMatrix(z.expandedProjMatrix,j,[0,0],"map");if(ae=s.cR(s.bC(),ae,[1,1,m.verticalScale]),I&&D){if(fb(j.tileID,G.maxHeight*F,n))continue;let ve=D.calculateShadowPassMatrixFromTile(j.tileID.toUnwrapped());ve=s.cR(s.bC(),ve,[1,1,m.verticalScale]),ie=_y(ve),ee=K=n.getOrCreateProgram("buildingDepth",{config:H,defines:x,overrideFog:!1})}else if(C)ee=K=n.getOrCreateProgram("buildingBloom",{config:H,defines:x,overrideFog:!1}),ie=hI(ae);else{const ve=n.transform.calculatePosMatrix(z.toUnwrapped(),n.transform.worldSize);s.cR(ve,ve,[1,1,m.verticalScale]);const _e=s.bC();s.cR(_e,ve,[1,-1,1/F]),s.bl(_e,_e),s.ed(_e,_e);const xe=n.transform.getFreeCameraOptions().position,ge=1<<z.canonical.z;ie=uI(ae,_e,m.opacity,m.facadeAOIntensity,[((xe.x-z.wrap)*ge-z.canonical.x)*s.al,(xe.y*ge-z.canonical.y)*s.al,xe.z*ge*s.al],G.tileToMeter,m.facadeEmissiveChance),K=n.getOrCreateProgram("building",{config:H,defines:x,overrideFog:!1});const pe=x.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);ee=n.getOrCreateProgram("building",{config:H,defines:pe,overrideFog:!1}),D&&(D.setupShadowsFromMatrix(ve,K,!0),D.setupShadowsFromMatrix(ve,ee,!0))}const ce=(ve,_e)=>{if(C){const xe=ve.entranceBloom;_e.draw(n,w.gl.TRIANGLES,m.depthMode,Pi.disabled,m.blendMode,Bi.disabled,ie,p.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segmentsBucket,p.paint,n.transform.zoom,H,[xe.layoutAttenuationBuffer,xe.layoutColorBuffer])}else{const xe=ve.segmentsBucket;let ge=[ve.layoutNormalBuffer,ve.layoutCentroidBuffer,ve.layoutColorBuffer];ve.layoutFacadePaintBuffer&&(ge=ge.concat([ve.layoutFacadeDataBuffer,ve.layoutFacadeVerticalRangeBuffer,ve.layoutFacadePaintBuffer])),_e.draw(n,w.gl.TRIANGLES,m.depthMode,Pi.disabled,m.blendMode,I?Bi.disabled:Bi.backCW,ie,p.id,ve.layoutVertexBuffer,ve.indexBuffer,xe,p.paint,n.transform.zoom,H,ge)}};n.uploadCommonUniforms(w,K,z.toUnwrapped(),null,V),G.buildingWithoutFacade&&ce(G.buildingWithoutFacade,K),ee!==K&&n.uploadCommonUniforms(w,ee,z.toUnwrapped(),null,V),G.buildingWithFacade&&ce(G.buildingWithFacade,ee)}}function L_(m){return[m[0]*s.ee,m[1]*s.ee,m[2]*s.ee,0]}function O_(m,n,u,p,v,x,w,I,C){const D=p.getSource(),F=u.globeSharedBuffers;if(!F)return;let V,z,j;if(n&&(V=p.getTile(n)),D instanceof s.aS?(z=D.texture,j=s.dG(0,0,u.transform)):V&&n&&(z=V.texture,j=s.dG(n.canonical.z,n.canonical.x,u.transform)),!z||!j)return;m||(j=s.cR(s.bC(),j,[1,-1,1]));const G=u.context,H=G.gl,ee=v.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR,K=u.colorModeForDrapableLayerRenderPass(x),ie=w.defines;ie.push("GLOBE_POLES");const ae=new Gt(H.LEQUAL,Gt.ReadWrite,u.depthRangeFor3D),ce=Float32Array.from(u.transform.expandedFarZProjMatrix),ve=Float32Array.from(s.bk(s.dF(new s.cC(0,0,0))));u.terrain&&u.terrain.prepareDrawTile(),G.activeTexture.set(H.TEXTURE0),z.bind(ee,H.CLAMP_TO_EDGE),G.activeTexture.set(H.TEXTURE1),z.bind(ee,H.CLAMP_TO_EDGE),"useMipmap"in z&&G.extTextureFilterAnisotropic&&u.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);const[_e,xe,ge,pe]=n?F.getPoleBuffers(n.canonical.z,!1):F.getPoleBuffers(0,!0),we=v.paint.get("raster-elevation");let Je;m?(Je=_e,u.renderDefaultNorthPole=we!==0):(Je=xe,u.renderDefaultSouthPole=we!==0);const $e=L_(w.mix),ot=((nt,Dt,Ye,De,ct,tt,bt,kt,$t,Ct,It,fi,li)=>E_(nt,Dt,Ye,new Float32Array(16),new Float32Array(9),[0,0],De,[0,0],[0,0,0,0],1,{opacity:1,mix:0},tt,[0,0],kt,2,Ct,It,fi,1,0,li))(ce,ve,j,s.aj(u.transform.zoom),0,v,0,we,0,$e,w.offset,w.range,x),Xe=u.getOrCreateProgram("raster",{defines:ie});u.uploadCommonUniforms(G,Xe,null),Xe.draw(u,H.TRIANGLES,ae,C,K,I,ot,v.id,Je,ge,pe)}function pI(m){const n=m._nearZ,u=m.projection.farthestPixelDistance(m),p=u-n,v=.2*m.height,x=n+v;return[n,u,(x-v-n)/p,(x-n)/p]}function pb(m,n,u,p){if(m)return n instanceof uc&&m instanceof Ih?n.getTextureDescriptor(m,u,!0):{texture:m.texture,mix:L_(p.mix),offset:p.offset,buffer:0,tileSize:1}}var mI=s.ef([{name:"a_index",type:"Int16",components:1}]);class _I{constructor(n,u,p,v){const x={width:p[0],height:p[1],data:null},w=n.gl;this.targetColorTexture=new s.T(n,x,w.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(n,x,w.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(u,v),this.lastInvalidatedAt=0}updateParticleTexture(n,u){if(this.particleTextureDimension===u.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,v=u.width*u.height;this.particleTexture0=new s.T(this.context,u,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,u,p.RGBA8,{premultiply:!1,useMipmap:!1});const x=new s.eg;x.reserve(v);for(let w=0;w<v;w++)x.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(x,mI.members,!0),this.particleSegment=s.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=u.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=s.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Aa(m,n,u){if(!m)return null;const p=n.getTextureDescriptor(m,u,!0);if(!p)return null;let{texture:v,mix:x,offset:w,tileSize:I,buffer:C,format:D}=p;if(!v||!D)return null;let F=!1;return D==="uint32"&&(F=!0,x[3]=0,x=vy(s.eh,x,[0,u.paint.get("raster-particle-max-speed")]),w=xy(s.eh,w,[0,u.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[C/(I+2*C),I/(I+2*C)],tileSize:I,scalarData:F,scale:x,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[D]]}}function Ry(m){const n=m._nearZ,u=m.projection.farthestPixelDistance(m),p=u-n,v=.2*m.height,x=n+v;return[n,u,(x-v-n)/p,(x-n)/p]}const Xo=new s.ao(1,0,0,1),Nu=new s.ao(0,1,0,1),mb=new s.ao(0,0,1,1),Py=new s.ao(1,0,1,1),My=new s.ao(0,1,1,1);function F_(m,n,u,p,v,x){for(let w=0;w<u.length;w++)if(v){const D=new s.ao(p.r*.8,p.g*.8,p.b*.8,1);Gh(m,n,u[w],p,-1,-1,x),Gh(m,n,u[w],p,-1,1,x),Gh(m,n,u[w],p,1,1,x),Gh(m,n,u[w],p,1,-1,x),Gh(m,n,u[w],D,0,0,x)}else Gh(m,n,u[w],p,0,0,x)}function Gh(m,n,u,p,v,x,w){const I=m.context,C=m.transform,D=I.gl,F=C.projection.name==="globe",V=F?["PROJECTION_GLOBE_VIEW"]:[];let z=s.bz(u.projMatrix);if(F&&s.aj(C.zoom)>0){const $e=s.bj(u.canonical,C),ot=s.ei($e);z=s.aB(new Float32Array(16),C.globeMatrix,ot),s.aB(z,C.projMatrix,z)}const j=s.bC();j[12]+=2*v/(s.o.devicePixelRatio*C.width),j[13]+=2*x/(s.o.devicePixelRatio*C.height),s.aB(z,j,z);const G=m.getOrCreateProgram("debug",{defines:V}),H=n.getTileByID(u.key);m.terrain&&m.terrain.setupElevationDraw(H,G);const ee=Gt.disabled,K=Pi.disabled,ie=m.colorModeForRenderPass(),ae="$debug";I.activeTexture.set(D.TEXTURE0),m.emptyTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),F?H._makeGlobeTileDebugBuffers(m.context,C):H._makeDebugTileBoundsBuffers(m.context,C.projection);const ce=H._tileDebugBuffer||m.debugBuffer,ve=H._tileDebugIndexBuffer||m.debugIndexBuffer,_e=H._tileDebugSegments||m.debugSegments;if(G.draw(m,D.LINE_STRIP,ee,K,ie,Bi.disabled,yy(z,p.toPremultipliedRenderColor(null)),ae,ce,ve,_e,null,null,null,[H._globeTileDebugBorderBuffer]),w){const $e=H.latestRawTileData,ot=Math.floor(($e&&$e.byteLength||0)/1024);let Xe=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Xe+=` => ${u.overscaledZ}`),Xe+=` ${H.state}`,Xe+=` ${ot}kb`,function(nt,Dt){nt.initDebugOverlayCanvas();const Ye=nt.debugOverlayCanvas,De=nt.context.gl,ct=nt.debugOverlayCanvas.getContext("2d");ct.clearRect(0,0,Ye.width,Ye.height),ct.shadowColor="white",ct.shadowBlur=2,ct.lineWidth=1.5,ct.strokeStyle="white",ct.textBaseline="top",ct.font="bold 36px Open Sans, sans-serif",ct.fillText(Dt,5,5),ct.strokeText(Dt,5,5),nt.debugOverlayTexture.update(Ye),nt.debugOverlayTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE)}(m,Xe)}const xe=n.getTile(u).tileSize,ge=512/Math.min(xe,512)*(u.overscaledZ/C.zoom)*.5,pe=H._tileDebugTextBuffer||m.debugBuffer,we=H._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Je=H._tileDebugTextSegments||m.debugSegments;G.draw(m,D.TRIANGLES,ee,K,Di.alphaBlended,Bi.disabled,yy(z,s.ao.transparent.toPremultipliedRenderColor(null),ge),ae,pe,we,Je,null,null,null,[H._globeTileDebugTextBuffer])}function vc(m,n,u,p){Hh(m,0,n+u/2,m.transform.width,u,p)}function gn(m,n,u,p){Hh(m,n-u/2,0,u,m.transform.height,p)}function Hh(m,n,u,p,v,x){const w=m.context,I=w.gl;I.enable(I.SCISSOR_TEST),I.scissor(n*s.o.devicePixelRatio,u*s.o.devicePixelRatio,p*s.o.devicePixelRatio,v*s.o.devicePixelRatio),w.clear({color:x}),I.disable(I.SCISSOR_TEST)}const ky=s.ef([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:_b}=ky;function Kc(m,n,u,p){m.emplaceBack(n,u,p)}class Dy{constructor(n){this.vertexArray=new s.ej,this.indices=new s.b1,Kc(this.vertexArray,-1,-1,1),Kc(this.vertexArray,1,-1,1),Kc(this.vertexArray,-1,1,1),Kc(this.vertexArray,1,1,1),Kc(this.vertexArray,-1,-1,-1),Kc(this.vertexArray,1,-1,-1),Kc(this.vertexArray,-1,1,-1),Kc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,_b),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=s.bg.simpleSegment(0,0,36,12)}}function qh(m,n,u,p,v,x){const w=m.context.gl,I=n.paint.get("sky-atmosphere-color"),C=n.paint.get("sky-atmosphere-halo-color"),D=n.paint.get("sky-atmosphere-sun-intensity"),F=((V,z,j,G,H)=>({u_matrix_3f:V,u_sun_direction:z,u_sun_intensity:j,u_color_tint_r:[G.r,G.g,G.b,G.a],u_color_tint_m:[H.r,H.g,H.b,H.a],u_luminance:5e-5}))(s.el(s.dL(),p),v,D,I.toPremultipliedRenderColor(null),C.toPremultipliedRenderColor(null));w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+x,n.skyboxTexture,0),u.draw(m,w.TRIANGLES,Gt.disabled,Pi.disabled,Di.unblended,Bi.frontCW,F,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Wh=s.ef([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Xh{constructor(n){const u=new s.em;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const p=new s.b1;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(u,Wh.members),this.indexBuffer=n.createIndexBuffer(p),this.segments=s.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Mt=s.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class jt{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class of{constructor(n){this.colorModeAlphaBlendedWriteRGB=new Di([1,qn,1,qn],s.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Di([1,0,1,0],s.ao.transparent,[!1,!1,!1,!0]),this.params=new jt,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){const u=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Xh(u);const p=this.params.sizeRange,v=this.params.intensityRange,x=function(F){const V=s.eo(30),z=[];for(let j=0;j<F;++j){const G=2*Math.PI*V(),H=Math.acos(1-2*V())-.5*Math.PI;z.push(s.d4(Math.cos(H)*Math.cos(G),Math.cos(H)*Math.sin(G),Math.sin(H)))}return z}(this.params.starsCount),w=s.eo(300),I=new s.en,C=new s.b1;let D=0;for(let F=0;F<x.length;++F){const V=s.c4([],x[F],200),z=Math.max(0,1+.01*p*(1*w()-.5)),j=Math.max(0,1+.01*v*(1*w()-.5));I.emplaceBack(V[0],V[1],V[2],-1,-1,z,j),I.emplaceBack(V[0],V[1],V[2],1,-1,z,j),I.emplaceBack(V[0],V[1],V[2],1,1,z,j),I.emplaceBack(V[0],V[1],V[2],-1,1,z,j),C.emplaceBack(D+0,D+1,D+2),C.emplaceBack(D+0,D+2,D+3),D+=4}this.starsVx=u.createVertexBuffer(I,Mt.members),this.starsIdx=u.createIndexBuffer(C),this.starsSegments=s.bg.simpleSegment(0,0,I.length,C.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,u){const p=n.context,v=p.gl,x=n.transform,w=new Gt(v.LEQUAL,Gt.ReadOnly,[0,1]),I=s.aj(x.zoom),C=n.style.getLut(u.scope),D=u.properties.get("color-use-theme")==="none",F=u.properties.get("color").toNonPremultipliedRenderColor(D?null:C),V=u.properties.get("high-color-use-theme")==="none",z=u.properties.get("high-color").toNonPremultipliedRenderColor(V?null:C),j=u.properties.get("space-color-use-theme")==="none",G=u.properties.get("space-color").toNonPremultipliedRenderColor(j?null:C),H=5e-4,ee=s.ep(u.properties.get("horizon-blend"),0,1,H,.25),K=s.dA(n,p,x)&&ee===H?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,ie=n.frameCounter/1e3%1,ae=s.ag(x.globeCenterInViewSpace),ce=Math.sqrt(Math.pow(ae,2)-Math.pow(K,2)),ve=Math.acos(ce/ae),_e=xe=>{const ge=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];xe&&ge.push("ALPHA_PASS");const pe=n.getOrCreateProgram("globeAtmosphere",{defines:ge}),we=(($e,ot,Xe,nt,Dt,Ye,De,ct,tt,bt,kt,$t)=>({u_frustum_tl:$e,u_frustum_tr:ot,u_frustum_br:Xe,u_frustum_bl:nt,u_horizon:Dt,u_transition:Ye,u_fadeout_range:De,u_atmosphere_fog_color:ct.toArray01(),u_high_color:tt.toArray01(),u_space_color:bt.toArray01(),u_temporal_offset:kt,u_horizon_angle:$t}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,I,ee,F,z,G,ie,ve);n.uploadCommonUniforms(p,pe);const Je=this.atmosphereBuffer;Je&&pe.draw(n,v.TRIANGLES,w,Pi.disabled,xe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Bi.backCW,we,xe?"atmosphere_glow_alpha":"atmosphere_glow",Je.vertexBuffer,Je.indexBuffer,Je.segments)};_e(!1),_e(!0)}drawStars(n,u){const p=s.aA(u.properties.get("star-intensity"),0,1);if(p===0)return;const v=n.context,x=v.gl,w=n.transform,I=n.getOrCreateProgram("stars"),C=s.c6([]);s.c8(C,C,-w._pitch),s.c7(C,C,-w.angle),s.c8(C,C,s.an(w._center.lat)),s.eq(C,C,-s.an(w._center.lng));const D=s.cb(new Float32Array(16),C),F=s.aB([],w.starsProjMatrix,D),V=s.el([],D),z=s.er([],V),j=[0,1,0];s.dN(j,j,z),s.c4(j,j,this.params.sizeMultiplier);const G=[1,0,0];s.dN(G,G,z),s.c4(G,G,this.params.sizeMultiplier);const H=(ee=j,K=G,ie=p,{u_matrix:Float32Array.from(F),u_up:ee,u_right:K,u_intensity_multiplier:ie});var ee,K,ie;n.uploadCommonUniforms(v,I),this.starsVx&&this.starsIdx&&I.draw(n,x.TRIANGLES,Gt.disabled,Pi.disabled,this.colorModeAlphaBlendedWriteRGB,Bi.disabled,H,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Kn{constructor(){this.visibleTiles=[]}updateBorders(n,u){const p=[],v=[],x=n._getRenderableCoordinates(!1,!0);for(const C of x){const D=n.getTile(C);if(!D.hasData())continue;const F=D.getBucket(u);F&&(F.isEmpty()||(p.push(C.key),v.push({bucket:F,tileID:C.canonical})))}let w=p.length!==this.visibleTiles.length;if(!w){p.sort();for(let C=0;C<p.length;C++)if(p[C]!==this.visibleTiles[C]){w=!0;break}}if(!w)return;const I=new Set;this.visibleTiles=p,v.sort((C,D)=>C.tileID.z-D.tileID.z||C.tileID.x-D.tileID.x||C.tileID.y-D.tileID.y);for(const C of v){const D=new Array,F=new Array,V=C.bucket;for(const z of V.featuresOnBorder)I.has(z.featureId)?F.push(z.footprintIndex):(I.add(z.featureId),D.push(z.footprintIndex));V.updateFootprintHiddenFlags(D,s.es,!1),V.updateFootprintHiddenFlags(F,s.es,!0)}}}function qe(m,n){const u=[...m],p=n.cameraWorldSizeForFog/n.worldSize,v=s.bA([]);return s.cR(v,v,[p,p,1]),s.aB(u,v,u),s.aB(u,n.worldToFogMatrix,u),u}function z_(m,n,u,p,v){const x=u.material,w=p.context,{baseColorTexture:I,metallicRoughnessTexture:C}=x.pbrMetallicRoughness,{normalTexture:D,occlusionTexture:F,emissionTexture:V}=x;function z(G,H,ee){if(G&&(m.push(H),w.activeTexture.set(w.gl.TEXTURE0+ee),G.gfxTexture)){const{minFilter:K,magFilter:ie,wrapS:ae,wrapT:ce}=G.sampler;G.gfxTexture.bindExtraParam(K,ie,ae,ce)}}z(I,"HAS_TEXTURE_u_baseColorTexture",bs.BaseColor),z(C,"HAS_TEXTURE_u_metallicRoughnessTexture",bs.MetallicRoughness),z(D,"HAS_TEXTURE_u_normalTexture",bs.Normal),z(F,"HAS_TEXTURE_u_occlusionTexture",bs.Occlusion),z(V,"HAS_TEXTURE_u_emissionTexture",bs.Emission),v&&(v.texture||(v.texture=new s.dY(p.context,v.image,[v.image.height,v.image.height,v.image.height],w.gl.RGBA8)),w.activeTexture.set(w.gl.TEXTURE0+bs.LUT),v.texture&&v.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),u.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(u.texcoordBuffer)),u.colorBuffer&&(m.push(u.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(u.colorBuffer)),u.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(u.normalBuffer)),u.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(u.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||m.push("DIFFUSE_SHADED");const j=p.shadowRenderer;j&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&m.push("NORMAL_OFFSET"))}function Zh(m,n,u,p,v,x){const w=u.paint.get("model-opacity").constantOr(1),I=n.context,C=new Gt(n.context.gl.LEQUAL,Gt.ReadWrite,n.depthRangeFor3D),D=n.transform,F=m.mesh,V=F.material,z=V.pbrMetallicRoughness,j=n.style.fog;let G;G=n.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:s.aB([],p.zScaleMatrix,m.nodeModelMatrix),s.aB(G,p.negCameraPosMatrix,G);const H=s.bl([],G);s.ed(H,H);const ee=u.paint.get("model-color-use-theme").constantOr("default")==="none",K=u.paint.get("model-emissive-strength").constantOr(0),ie=C_(new Float32Array(m.worldViewProjection),new Float32Array(G),new Float32Array(H),null,n,w,z.baseColorFactor,V.emissiveFactor,z.metallicFactor,z.roughnessFactor,V,K,u),ae={defines:[]},ce=[],ve=n.shadowRenderer;ve&&(ve.useNormalOffset=!1),z_(ae.defines,ce,F,n,ee?null:u.lut);let _e=null;if(j){const pe=qe(m.nodeModelMatrix,n.transform);if(_e=new Float32Array(pe),D.projection.name!=="globe"){const we=F.aabb.min,Je=F.aabb.max,[$e,ot]=j.getOpacityForBounds(pe,we[0],we[1],Je[0],Je[1]);ae.overrideFog=$e>=Kt||ot>=Kt}}const xe=Ru(n,u.paint.get("model-cutoff-fade-range"));xe.shouldRenderCutoff&&ae.defines.push("RENDER_CUTOFF");const ge=n.getOrCreateProgram("model",ae);n.uploadCommonUniforms(I,ge,null,_e,xe),n.renderPass!=="shadow"&&ve&&ve.setupShadowsFromMatrix(m.nodeModelMatrix,ge),ge.draw(n,I.gl.TRIANGLES,C,v,x,F.material.doubleSided?Bi.disabled:Bi.backCCW,ie,u.id,F.vertexBuffer,F.indexBuffer,F.segments,u.paint,n.transform.zoom,void 0,ce)}function N_(m,n,u,p,v,x,w){let I;I=m.projection.name==="globe"?s.eu(u,m):[...u],s.aB(I,I,n.matrix);const C=s.aB([],p,I);if(n.meshes)for(const D of n.meshes){if(D.material.alphaMode!=="BLEND"){w.push({mesh:D,depth:0,modelIndex:v,worldViewProjection:C,nodeModelMatrix:I});continue}const F=s.af([],D.centroid,C);!m.isOrthographic&&F[2]<=0||x.push({mesh:D,depth:F[2],modelIndex:v,worldViewProjection:C,nodeModelMatrix:I})}if(n.children)for(const D of n.children)N_(m,D,u,p,v,x,w)}function Rp(m,n,u,p){const v=u.shadowRenderer;if(!v)return;const x=v.getShadowPassDepthMode(),w=v.getShadowPassColorMode(),I=v.calculateShadowPassMatrixFromMatrix(n),C=nf(I);u.getOrCreateProgram("modelDepth",{defines:u._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(u,u.context.gl.TRIANGLES,x,Pi.disabled,w,Bi.backCCW,C,p.id,m.vertexBuffer,m.indexBuffer,m.segments,p.paint,u.transform.zoom,void 0,void 0)}function gb(m,n,u){const p=n.updateZoomBasedPaintProperties(),v=function(x,w,I){let C,D,F,V=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&V>0){const z=x.terrain,j=z.findDEMTileFor(I);j&&j.dem?C=s.ew.create(z,I,j):V=0}if(V===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),V===w.validForExaggeration&&(V===0||C&&C._demTile&&C._demTile.tileID===w.validForDEMTile.id&&C._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(const z in w.instancesPerModel){const j=w.instancesPerModel[z];for(let G=0;G<j.instancedDataArray.length;++G){const H=(C?V*C.getElevationAt(0|j.instancedDataArray.float32[16*G],0|j.instancedDataArray.float32[16*G+1],!0,!0):0)+j.instancesEvaluatedElevation[G];j.instancedDataArray.float32[16*G+6]=H,D=D?Math.min(w.terrainElevationMin,H):H,F=F?Math.max(w.terrainElevationMax,H):H}}return w.terrainElevationMin=D||0,w.terrainElevationMax=F||0,w.validForExaggeration=V,w.validForDEMTile=C&&C._demTile?{id:C._demTile.tileID,timestamp:C._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,n,u);(p||v)&&(n.uploaded=!1,n.upload(m.context))}const jl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.d8([0,0,0],[s.al,s.al,0])};function af(m,n){const u=1<<m.canonical.z,p=n.getFreeCameraOptions().position,v=n.elevation,x=m.canonical.x/u,w=(m.canonical.x+1)/u,I=m.canonical.y/u,C=(m.canonical.y+1)/u;let D=n._centerAltitude;if(v){const j=v.getMinMaxForTile(m);j&&j.max>D&&(D=j.max)}const F=s.aA(p.x,x,w)-p.x,V=s.aA(p.y,I,C)-p.y,z=s.ce(D,n.center.lat)-p.z;return n._zoomFromMercatorZ(Math.sqrt(F*F+V*V+z*z))}function yb(m,n,u,p,v,x,w){const I=m.context,C=m.renderPass==="shadow",D=m.shadowRenderer,F=C&&D?D.getShadowPassDepthMode():new Gt(I.gl.LEQUAL,Gt.ReadWrite,m.depthRangeFor3D),V=m.isTileAffectedByFog(x);if(u.meshes)for(const z of u.meshes){const j=["MODEL_POSITION_ON_GPU"],G=[];let H,ee,K;p.instancedDataArray.length>20&&j.push("INSTANCED_ARRAYS");const ie=Ru(m,n.paint.get("model-cutoff-fade-range"));if(ie.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),C&&D)H=m.getOrCreateProgram("modelDepth",{defines:j}),ee=nf(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(u.matrix)),K=D.getShadowPassColorMode();else{z_(j,G,z,m,n.paint.get("model-color-use-theme").constantOr("default")==="none"?null:n.lut),H=m.getOrCreateProgram("model",{defines:j,overrideFog:V});const ce=z.material,ve=ce.pbrMetallicRoughness,_e=n.paint.get("model-opacity").constantOr(1),xe=n.paint.get("model-emissive-strength").constantOr(0);ee=C_(x.expandedProjMatrix,Float32Array.from(u.matrix),new Float32Array(16),null,m,_e,ve.baseColorFactor,ce.emissiveFactor,ve.metallicFactor,ve.roughnessFactor,ce,xe,n,v),D&&(w.shadowUniformsInitialized?H.setShadowUniformValues(I,D.getShadowUniformValues()):(D.setupShadows(x.toUnwrapped(),H,"model-tile"),w.shadowUniformsInitialized=!0)),K=ie.shouldRenderCutoff||_e<1||ce.alphaMode!=="OPAQUE"?Di.alphaBlended:Di.unblended}m.uploadCommonUniforms(I,H,x.toUnwrapped(),null,ie);const ae=z.material.doubleSided?Bi.disabled:Bi.backCCW;if(p.instancedDataArray.length>20)G.push(p.instancedDataBuffer),H.draw(m,I.gl.TRIANGLES,F,Pi.disabled,K,ae,ee,n.id,z.vertexBuffer,z.indexBuffer,z.segments,n.paint,m.transform.zoom,void 0,G,p.instancedDataArray.length);else{const ce=C?"u_instance":"u_normal_matrix";for(let ve=0;ve<p.instancedDataArray.length;++ve)ee[ce]=new Float32Array(p.instancedDataArray.arrayBuffer,64*ve,16),H.draw(m,I.gl.TRIANGLES,F,Pi.disabled,K,ae,ee,n.id,z.vertexBuffer,z.indexBuffer,z.segments,n.paint,m.transform.zoom,void 0,G)}}if(u.children)for(const z of u.children)yb(m,n,z,p,v,x,w)}const gI=[1,-1,1];function vb(m,n,u,p){if(!u.modelManager)return!0;const v=u.modelManager;if(!u.shadowRenderer)return!0;const x=u.shadowRenderer,w=n.aabb;let I=!0,C=m.maxHeight;if(C===0){let F=0;for(const V in m.instancesPerModel){const z=v.getModel(V,p);z?F=Math.max(F,Math.max(Math.max(z.aabb.max[0],z.aabb.max[1]),z.aabb.max[2])):I=!1}C=m.maxScale*F*1.41+m.maxVerticalOffset,I&&(m.maxHeight=C)}w.max[2]=C,w.min[2]+=m.terrainElevationMin,w.max[2]+=m.terrainElevationMax,s.af(w.min,w.min,n.tileMatrix),s.af(w.max,w.max,n.tileMatrix);const D=w.intersects(x.getCurrentCascadeFrustum());return u.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=D===2),D===0}function B_(m,n){const u=m.uniformValues.u_cutoff_params[0],p=m.uniformValues.u_cutoff_params[1],v=m.uniformValues.u_cutoff_params[2],x=m.uniformValues.u_cutoff_params[3];return p===u||x===v?1:s.aA(((n-u)/(p-u)-v)/(x-v),0,1)}function Ly(m,n,u,p){if(n.pitch<20)return 1;const v=n.getWorldToCameraMatrix();s.aB(v,v,m);const x=s.bU(u.min[0],u.min[1],u.min[2],1);let w=s.aC(s.ex(),x,v),I=w,C=w;x[1]=u.max[1],w=s.aC(s.ex(),x,v),I=w[1]<I[1]?w:I,C=w[1]>C[1]?w:C,x[0]=u.max[0],w=s.aC(s.ex(),x,v),I=w[1]<I[1]?w:I,C=w[1]>C[1]?w:C,x[1]=u.min[1],w=s.aC(s.ex(),x,v),I=w[1]<I[1]?w:I,C=w[1]>C[1]?w:C;const D=s.aA(p[0],0,1),F=100*n.pixelsPerMeter*s.aA(p[1],0,1),V=s.aA(p[2],0,1),z=s.ey(s.ex(),I,C,D),j=Math.tan(.5*n.fovX),G=-z[2]*j;if(F===0)return z[1]<-Math.abs(G)?V:1;const H=(-Math.abs(G)-z[1])/F,ee=(ie,ae,ce)=>(1-ce)*ie+ce*ae,K=s.aA(ee(1,V,H),V,1);return ee(1,K,s.aA((n.pitch-20)/20,0,1))}class xb{}class bb{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,u,p){{const V=this._storage.get(u.id);if(V)return V.lastUsedFrameIdx=n,V.buf}const v=p.gl,x=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),w=new ArrayBuffer(x),I=new Int16Array(w);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));const C=new s.eA;for(let V=0;V<x/2;V+=3){const z=I[V],j=I[V+1],G=I[V+2];C.emplaceBack(z,j),C.emplaceBack(j,G),C.emplaceBack(G,z)}const D=p.bindVertexArrayOES.current,F=new xb;return F.buf=new Lu(p,C),F.lastUsedFrameIdx=n,this._storage.set(u.id,F),p.bindVertexArrayOES.set(D),F.buf}update(n){for(const[u,p]of this._storage)n-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(u))}destroy(){for(const[n,u]of this._storage)u.buf.destroy(),this._storage.delete(n)}}class V_{constructor(n){this.occluderSize=30,this.depthOffset=-1e-4,n.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),n.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Pp=s.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class lf{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Oy{constructor(n,u){this.revealStart=11,this.revealRange=2,n.registerParameter(this,[...u,"Reveal"],"revealStart",{min:0,max:17,step:.05}),n.registerParameter(this,[...u,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const wb=s.ef([{type:"Float32",name:"a_pos_2f",components:2}]);class yI{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(n,u){const p=n.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const w=new s.eB,I=new s.b1;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(1,1),w.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=n.context.createVertexBuffer(w,wb.members),this.vignetteIdx=n.context.createIndexBuffer(I)}const v=s.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){n.uploadCommonUniforms(n.context,p);const w={u_vignetteShape:(x={vignetteShape:[u.start,u.range,Math.pow(10,u.fadePower)],vignetteColor:[u.color.r,u.color.g,u.color.b,u.color.a*u.strength]}).vignetteShape,u_vignetteColor:x.vignetteColor};p.draw(n,n.context.gl.TRIANGLES,Gt.disabled,Pi.disabled,Di.alphaBlended,Bi.disabled,w,"vignette",this.vignetteVx,this.vignetteIdx,v)}var x}}class Tb{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(n,u){const p=n.getFreeCameraOptions().position,v=p.toAltitude(),x=p.toLngLat(),w=s.an(x.lng),I=s.an(x.lat),C=n.pixelsPerMeter/u,D=w*s.eD,F=s.eD*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const V=-this._offsetYPrev+F,z=-this._elevationPrev+v;this._accumulatedOffsetX+=(-this._offsetXPrev+D)*C,this._accumulatedOffsetY+=V*C,this._accumulatedElevation+=z*C,this._offsetXPrev=D,this._offsetYPrev=F,this._elevationPrev=v}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Eb(m,n){return[-(m[0]-Math.floor(m[0]/n)*n),-(m[1]-Math.floor(m[1]/n)*n),-(m[2]-Math.floor(m[2]/n)*n)]}function Fo(m){const n=s.eo(1323123451230),u=[];for(let p=0;p<m;++p){const v=2*n()-1,x=2*n()-1,w=2*n()-1;u.push(s.d4(v,x,w))}return u}function Bu(m,n,u,p,v){const x=s.aA((v-u)/(p-u),0,1);return(1-x)*m+x*n}class cf{constructor(n){this._movement=new Tb,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new yI,this._ppmScaleFactor=n}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(n,u){const p=n.transform;this._movement.update(p,this._ppmScaleFactor);const v=p.starsProjMatrix,x=s.c6([]);s.c8(x,x,s.an(90)-p._pitch),s.c7(x,x,-p.angle);const w=s.cb(new Float32Array(16),x),I=s.eC(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),C=s.ed([],I),D=s.aB([],C,w),F=Date.now()/1e3;return this._accumulatedTimeFromStart+=(F-this._prevTime)*u,this._prevTime=F,{projectionMatrix:v,modelviewMatrix:D}}}class Sn extends cf{constructor(n){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Oy(n.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(n){const u=n.context;if(!this.particlesVx){const p=Fo(this.particlesCount),v=new s.eE,x=new s.b1;let w=0;const I=s.eo(1323123451230);for(let C=0;C<p.length;++C){const D=p[C],F=[2*I()-1,I(),I(),I()];v.emplaceBack(D[0],D[1],D[2],-1,-1,...F),v.emplaceBack(D[0],D[1],D[2],1,-1,...F),v.emplaceBack(D[0],D[1],D[2],1,1,...F),v.emplaceBack(D[0],D[1],D[2],-1,1,...F),x.emplaceBack(w+0,w+1,w+2),x.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=u.createVertexBuffer(v,Pp.members),this.particlesIdx=u.createIndexBuffer(x)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.rain)return;const u=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=n.transform.zoom;if(u.revealStart>p)return;const v=Bu(0,1,u.revealStart,u.revealStart+u.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const x=structuredClone(this._params);let w=[-x.direction.x,x.direction.y,-100];s.aw(w,w);const I=structuredClone(this._vignetteParams);I.strength*=v,x.overrideStyleParameters||(x.intensity=n.style.rain.state.density,x.timeFactor=n.style.rain.state.intensity,x.color=structuredClone(n.style.rain.state.color),w=structuredClone(n.style.rain.state.direction),x.screenThinning.intensity=n.style.rain.state.centerThinning,x.dropletSizeX=n.style.rain.state.dropletSize[0],x.dropletSizeYScale=n.style.rain.state.dropletSize[1]/n.style.rain.state.dropletSize[0],x.distortionStrength=100*n.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(n.style.rain.state.vignetteColor));const C=this.updateOnRender(n,x.timeFactor),D=n.context,F=D.gl,V=n.transform;this.screenTexture&&this.screenTexture.size[0]===n.width&&this.screenTexture.size[1]===n.height||(this.screenTexture=new s.T(D,{width:n.width,height:n.height,data:null},F.RGBA8)),x.distortionStrength>0&&(D.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.copyTexSubImage2D(F.TEXTURE_2D,0,0,0,0,0,n.width,n.height));const z=n.getOrCreateProgram("rainParticle");n.uploadCommonUniforms(D,z),D.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const j=[x.color.r,x.color.g,x.color.b,x.color.a],G=(H,ee)=>{const K=Eb(this._movement.getPosition(),H),ie=x.dropletSizeX,ae=x.dropletSizeX*x.dropletSizeYScale,ce=n.width/2,ve=n.height/2,_e=Bu(0,x.screenThinning.start,0,1,x.screenThinning.intensity),xe=Bu(.001,x.screenThinning.range,0,1,x.screenThinning.intensity),ge=Bu(0,x.screenThinning.particleOffset,0,1,x.screenThinning.intensity),pe=(we={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:K,velocityConeAperture:x.velocityConeAperture,velocity:x.velocity,boxSize:H,rainDropletSize:[ie,ae],distortionStrength:x.distortionStrength,rainDirection:w,color:j,screenSize:[V.width,V.height],thinningCenterPos:[ce,ve],thinningShape:[_e,xe,Math.pow(10,x.screenThinning.fadePower)],thinningAffectedRatio:x.screenThinning.affectedRatio,thinningParticleOffset:ge,shapeDirectionalPower:x.shapeDirPower,shapeNormalPower:x.shapeNormalPower,mode:ee?0:1},{u_modelview:Float32Array.from(we.modelview),u_projection:Float32Array.from(we.projection),u_time:we.time,u_cam_pos:we.camPos,u_texScreen:0,u_velocityConeAperture:we.velocityConeAperture,u_velocity:we.velocity,u_boxSize:we.boxSize,u_rainDropletSize:we.rainDropletSize,u_distortionStrength:we.distortionStrength,u_rainDirection:we.rainDirection,u_color:we.color,u_screenSize:we.screenSize,u_thinningCenterPos:we.thinningCenterPos,u_thinningShape:we.thinningShape,u_thinningAffectedRatio:we.thinningAffectedRatio,u_thinningParticleOffset:we.thinningParticleOffset,u_shapeDirectionalPower:we.shapeDirectionalPower,u_shapeNormalPower:we.shapeNormalPower,u_mode:we.mode});var we;const Je=Math.round(x.intensity*this.particlesCount),$e=s.bg.simpleSegment(0,0,4*Je,2*Je);z.draw(n,F.TRIANGLES,Gt.disabled,Pi.disabled,Di.alphaBlended,Bi.disabled,pe,"rain_particles",this.particlesVx,this.particlesIdx,$e)};x.distortionStrength>0&&G(x.boxSize,!0),G(x.boxSize,!1),this._vignette.draw(n,I)}}const xr=s.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Ib extends cf{constructor(n){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Oy(n.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(n){const u=n.context;if(!this.particlesVx){const p=Fo(this.particlesCount),v=new s.eF,x=new s.b1;let w=0;const I=s.eo(1323123451230);for(let C=0;C<p.length;++C){const D=p[C],F=I(),V=I(),z=I(),j=[C/p.length,F,V,z],G=[I(),I()];v.emplaceBack(D[0],D[1],D[2],-1,-1,...j,...G),v.emplaceBack(D[0],D[1],D[2],1,-1,...j,...G),v.emplaceBack(D[0],D[1],D[2],1,1,...j,...G),v.emplaceBack(D[0],D[1],D[2],-1,1,...j,...G),x.emplaceBack(w+0,w+1,w+2),x.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=u.createVertexBuffer(v,xr.members),this.particlesIdx=u.createIndexBuffer(x)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.snow)return;const u=structuredClone(this._params);let p=[-u.direction.x,u.direction.y,-100];s.aw(p,p);const v=structuredClone(this._vignetteParams),x=u.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},w=n.transform.zoom;if(x.revealStart>w)return;const I=Bu(0,1,x.revealStart,x.revealStart+x.revealRange,w);v.strength*=I,u.overrideStyleParameters||(u.intensity=n.style.snow.state.density,u.timeFactor=n.style.snow.state.intensity,u.color=structuredClone(n.style.snow.state.color),p=structuredClone(n.style.snow.state.direction),u.screenThinning.intensity=n.style.snow.state.centerThinning,u.billboardSize=2.79*n.style.snow.state.flakeSize,v.strength=1,v.color=structuredClone(n.style.snow.state.vignetteColor));const C=this.updateOnRender(n,u.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const D=n.context,F=D.gl,V=n.transform,z=n.getOrCreateProgram("snowParticle");n.uploadCommonUniforms(D,z),((j,G,H)=>{const ee=Eb(this._movement.getPosition(),j),K=V.width/2,ie=V.height/2,ae=Bu(0,H.screenThinning.start,0,1,H.screenThinning.intensity),ce=Bu(.001,H.screenThinning.range,0,1,H.screenThinning.intensity),ve=Bu(0,H.screenThinning.particleOffset,0,1,H.screenThinning.intensity),_e=(xe={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ee,velocityConeAperture:H.velocityConeAperture,velocity:H.velocity,horizontalOscillationRadius:H.horizontalOscillationRadius,horizontalOscillationRate:H.horizontalOscillationRate,boxSize:j,billboardSize:1*H.billboardSize,simpleShapeParameters:[H.shapeFadeStart,H.shapeFadePower],screenSize:[V.width,V.height],thinningCenterPos:[K,ie],thinningShape:[ae,ce,Math.pow(10,H.screenThinning.fadePower)],thinningAffectedRatio:H.screenThinning.affectedRatio,thinningParticleOffset:ve,color:[H.color.r,H.color.g,H.color.b,H.color.a],direction:p},{u_modelview:Float32Array.from(xe.modelview),u_projection:Float32Array.from(xe.projection),u_time:xe.time,u_cam_pos:xe.camPos,u_velocityConeAperture:xe.velocityConeAperture,u_velocity:xe.velocity,u_horizontalOscillationRadius:xe.horizontalOscillationRadius,u_horizontalOscillationRate:xe.horizontalOscillationRate,u_boxSize:xe.boxSize,u_billboardSize:xe.billboardSize,u_simpleShapeParameters:xe.simpleShapeParameters,u_screenSize:xe.screenSize,u_thinningCenterPos:xe.thinningCenterPos,u_thinningShape:xe.thinningShape,u_thinningAffectedRatio:xe.thinningAffectedRatio,u_thinningParticleOffset:xe.thinningParticleOffset,u_particleColor:xe.color,u_direction:xe.direction});var xe;const ge=Math.round(H.intensity*this.particlesCount),pe=s.bg.simpleSegment(0,0,4*ge,2*ge);this.particlesVx&&this.particlesIdx&&z.draw(n,F.TRIANGLES,Gt.disabled,Pi.disabled,Di.alphaBlended,Bi.disabled,_e,"snow_particles",this.particlesVx,this.particlesIdx,pe)})(u.boxSize,0,u),this._vignette.draw(n,v)}}const Vu={symbol:function(m,n,u,p,v){if(m.renderPass!=="translucent")return;const x=Pi.disabled,w=m.colorModeForRenderPass(),I=u.layout.get("text-variable-anchor"),C=u.layout.get("text-size-scale-range"),D=s.aA(m.scaleFactor,C[0],C[1]);I&&function(z,j,G,H,ee,K,ie,ae){const ce=j.transform,ve=ee==="map",_e=K==="map";for(const xe of z){const ge=H.getTile(xe),pe=ge.getBucket(G);if(!pe||!pe.text||!pe.text.segments.get().length)continue;const we=s.bK(pe.textSizeData,ce.zoom,ae),Je=ts(xe,pe.getProjection(),ce),$e=ce.calculatePixelsToTileUnitsMatrix(ge),ot=Ea(Je,ge.tileID.canonical,_e,ve,ce,pe.getProjection(),$e),Xe=pe.hasIconTextFit()&&pe.hasIconData();we&&M_(pe,ve,_e,ie,ce,ot,xe,Math.pow(2,ce.zoom-ge.tileID.overscaledZ),we,Xe)}}(p,m,u,n,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),v,D);const F=u.paint.get("icon-opacity").constantOr(1)!==0,V=u.paint.get("text-opacity").constantOr(1)!==0;u.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(F||V)?Cp(m,n,u,p,x,w):(F&&Cp(m,n,u,p,x,w,{onlyIcons:!0}),V&&Cp(m,n,u,p,x,w,{onlyText:!0})),n.map.showCollisionBoxes&&(Ap(m,n,u,p,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Ap(m,n,u,p,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(m,n,u,p){if(m.renderPass!=="translucent")return;const v=u.paint.get("circle-opacity"),x=u.paint.get("circle-stroke-width"),w=u.paint.get("circle-stroke-opacity"),I=u.layout.get("circle-sort-key").constantOr(1)!==void 0,C=u.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(x.constantOr(1)===0||w.constantOr(1)===0))return;const D=m.context,F=D.gl,V=m.transform,z=!(!m.terrain||!m.terrain.enabled),j=u.layout.get("circle-elevation-reference"),G=m.depthModeForSublayer(0,Gt.ReadOnly),H=new Gt(m.context.gl.LEQUAL,Gt.ReadOnly,m.depthRangeFor3D),ee=j==="none"||z?G:H,K=Pi.disabled,ie=m.colorModeForDrapableLayerRenderPass(C),ae=V.projection.name==="globe",ce=[s.aF(V.center.lng),s.aJ(V.center.lat)],ve=[];for(let xe=0;xe<p.length;xe++){const ge=p[xe],pe=n.getTile(ge),we=pe.getBucket(u);if(!we||we.projection.name!==V.projection.name)continue;const Je=we.programConfigurations.get(u.id),$e=we.layoutVertexBuffer,ot=we.globeExtVertexBuffer,Xe=we.indexBuffer,nt=s.dZ(u),Dt=[ot],Ye=m.isTileAffectedByFog(ge);ae&&nt.push("PROJECTION_GLOBE_VIEW"),nt.push("DEPTH_D24"),m.terrain&&V.depthOcclusionForSymbolsAndCircles&&nt.push("DEPTH_OCCLUSION"),we.hasElevation&&!m.terrain&&(nt.push("ELEVATED_ROADS"),Dt.push(we.elevatedLayoutVertexBuffer));const De=m.getOrCreateProgram("circle",{config:Je,defines:nt,overrideFog:Ye}),ct=V.projection.createInversionMatrix(V,ge.canonical),tt={programConfiguration:Je,program:De,layoutVertexBuffer:$e,dynamicBuffers:Dt,indexBuffer:Xe,uniformValues:s.d_(m,ge,pe,ct,ce,u),tile:pe};if(I){const bt=we.segments.get();for(const kt of bt)ve.push({segments:new s.bg([kt]),sortKey:kt.sortKey,state:tt})}else ve.push({segments:we.segments,sortKey:0,state:tt})}I&&ve.sort((xe,ge)=>xe.sortKey-ge.sortKey);const _e={useDepthForOcclusion:V.depthOcclusionForSymbolsAndCircles};for(const xe of ve){const{programConfiguration:ge,program:pe,layoutVertexBuffer:we,dynamicBuffers:Je,indexBuffer:$e,uniformValues:ot,tile:Xe}=xe.state,nt=xe.segments;m.terrain&&m.terrain.setupElevationDraw(Xe,pe,_e),m.uploadCommonUniforms(D,pe,Xe.tileID.toUnwrapped()),pe.draw(m,F.TRIANGLES,ee,K,ie,Bi.disabled,ot,u.id,we,$e,nt,u.paint,V.zoom,ge,Je)}},heatmap:function(m,n,u,p){if(u.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const v=m.context,x=v.gl,w=Pi.disabled,I=new Di([x.ONE,x.ONE,x.ONE,x.ONE],s.ao.transparent,[!0,!0,!0,!0]);(function(j,G,H,ee){const K=j.gl,ie=G.width*ee,ae=G.height*ee;j.activeTexture.set(K.TEXTURE1),j.viewport.set([0,0,ie,ae]);let ce=H.heatmapFbo;if(!ce||ce&&(ce.width!==ie||ce.height!==ae)){ce&&ce.destroy();const ve=K.createTexture();K.bindTexture(K.TEXTURE_2D,ve),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),ce=H.heatmapFbo=j.createFramebuffer(ie,ae,!0,null),function(_e,xe,ge,pe,we,Je){const $e=_e.gl;$e.texImage2D($e.TEXTURE_2D,0,_e.extRenderToTextureHalfFloat?$e.RGBA16F:$e.RGBA,we,Je,0,$e.RGBA,_e.extRenderToTextureHalfFloat?$e.HALF_FLOAT:$e.UNSIGNED_BYTE,null),pe.colorAttachment.set(ge)}(j,0,ve,ce,ie,ae)}else K.bindTexture(K.TEXTURE_2D,ce.colorAttachment.get()),j.bindFramebuffer.set(ce.framebuffer)})(v,m,u,m.transform.projection.name==="globe"?.5:.25),v.clear({color:s.ao.transparent});const C=m.transform,D=C.projection.name==="globe",F=D?["PROJECTION_GLOBE_VIEW"]:[],V=D?Bi.frontCCW:Bi.disabled,z=[s.aF(C.center.lng),s.aJ(C.center.lat)];for(let j=0;j<p.length;j++){const G=p[j];if(n.hasRenderableParent(G))continue;const H=n.getTile(G),ee=H.getBucket(u);if(!ee||ee.projection.name!==C.projection.name)continue;const K=m.isTileAffectedByFog(G),ie=ee.programConfigurations.get(u.id),ae=m.getOrCreateProgram("heatmap",{config:ie,defines:F,overrideFog:K}),{zoom:ce}=m.transform;m.terrain&&m.terrain.setupElevationDraw(H,ae),m.uploadCommonUniforms(v,ae,G.toUnwrapped());const ve=C.projection.createInversionMatrix(C,G.canonical);ae.draw(m,x.TRIANGLES,Gt.disabled,w,I,V,ub(m,G,H,ve,z,ce,u.paint.get("heatmap-intensity")),u.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,u.paint,m.transform.zoom,ie,D?[ee.globeExtVertexBuffer]:null)}v.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(v,x){const w=v.context,I=w.gl,C=x.heatmapFbo;if(!C)return;w.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,C.colorAttachment.get()),w.activeTexture.set(I.TEXTURE1);let D=x.colorRampTexture;D||(D=x.colorRampTexture=new s.T(w,x.colorRamp,I.RGBA8)),D.bind(I.LINEAR,I.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,I.TRIANGLES,Gt.disabled,Pi.disabled,v.colorModeForRenderPass(),Bi.disabled,((F,V,z,j)=>({u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}))(0,x),x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(m,u))},line:function(m,n,u,p){if(m.renderPass!=="translucent")return;const v=u.paint.get("line-opacity"),x=u.paint.get("line-width");if(v.constantOr(1)===0||x.constantOr(1)===0)return;const w=u.paint.get("line-emissive-strength"),I=u.paint.get("line-occlusion-opacity"),C=u.layout.get("line-elevation-reference"),D=u.layout.get("line-width-unit")==="meters",F=C==="sea",V=!(!m.terrain||!m.terrain.enabled),z=m.context,j=z.gl;if(u.hasElevatedBuckets&&m.transform.projection.name==="globe")return;const G=u.layout.get("line-cross-slope"),H=G!==void 0,ee=G<1,K=m.colorModeForDrapableLayerRenderPass(w),ie=m.terrain&&m.terrain.renderingToTexture,ae=ie?1:s.o.devicePixelRatio,ce=u.paint.get("line-dasharray"),ve=ce.constantOr(1),_e=u.layout.get("line-cap"),xe=ce.constantOr(null),ge=_e.constantOr(null),pe=u.paint.get("line-pattern"),we=pe.constantOr(1),Je=u.paint.get("line-pattern-cross-fade"),$e=pe.constantOr(null),ot=u.paint.get("line-opacity").constantOr(1);let Xe=!we&&ot!==1||m.depthOcclusion&&I>0&&I<1;const nt=u.paint.get("line-gradient"),Dt=we?"linePattern":"line",Ye=s.d$(u);let De;if(ie&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(Xe=!1),I!==0&&m.depthOcclusion){const kt=u.paint._values["line-opacity"];kt&&kt.value&&kt.value.kind==="constant"?De=kt.value:s.w(`Occlusion opacity for layer ${u.id} is supported only when line-opacity isn't data-driven.`)}x.value.kind!=="constant"&&x.value.isLineProgressConstant===!1&&Ye.push("VARIABLE_LINE_WIDTH");const ct=(kt,$t,Ct,It,fi,li)=>{for(const di of kt){const oi=n.getTile(di);if(we&&!oi.patternsLoaded())continue;const Vi=oi.getBucket(u);if(!Vi||Vi.elevationType!=="none"&&!fi||Vi.elevationType==="none"&&fi)continue;m.prepareDrawTile();const Ki=[...$t],Qi=m.shadowRenderer,Zr=Vi.elevationType==="road"&&!!Qi&&Qi.enabled;let Gi=[0,0,0];if(Zr){const er=m.style.directionalLight,Fi=m.style.ambientLight;er&&Fi&&(Gi=Ul(m.style,er,Fi)),Ki.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Lr=Vi.programConfigurations.get(u.id);let Wr=!1;if($e&&oi.imageAtlas){const er=s.e0.from($e),Fi=er.getPrimary().scaleSelf(ae).toString(),Kr=oi.imageAtlas.patternPositions.get(Fi),Yn=er.getSecondary(),zn=Yn?oi.imageAtlas.patternPositions.get(Yn.scaleSelf(ae).toString()):null;Wr=!!Kr&&!!zn,Kr&&Lr.setConstantPatternPositions(Kr,zn)}Je>0&&(Wr||Lr.getPatternTransitionVertexBuffer("line-pattern"))&&Ki.push("LINE_PATTERN_TRANSITION");const An=m.isTileAffectedByFog(di),Yi=m.getOrCreateProgram(Dt,{config:Lr,defines:Ki,overrideFog:An});if(!we&&xe&&ge&&oi.lineAtlas){const er=oi.lineAtlas.getDash(xe,ge);er&&Lr.setConstantPatternPositions(er)}Zr&&Qi.setupShadows(oi.tileID.toUnwrapped(),Yi,"vector-tile");let[Ur,zr]=u.paint.get("line-trim-offset");(ge==="round"||ge==="square")&&Ur!==zr&&(Ur===0&&(Ur-=1),zr===1&&(zr+=1));const Hr=ie?di.projMatrix:null,Dn=D?1/Vi.tileToMeter/s.ay(oi,1,m.transform.zoom):1,os=D?1/Vi.tileToMeter/s.ay(oi,1,Math.floor(m.transform.zoom)):1,Ws=we?s.e1(m,oi,u,Hr,ae,Dn,os,[Ur,zr],Gi,Je):s.e2(m,oi,u,Hr,Vi.lineClipsArray.length,ae,Dn,os,[Ur,zr],Gi);if(nt){const er=Vi.gradients[u.id];let Fi=er.texture;if(u.gradientVersion!==er.version){let Kr=256;if(u.stepInterpolant){const Yn=n.getSource().maxzoom,zn=di.canonical.z===Yn?Math.ceil(1<<m.transform.maxZoom-di.canonical.z):1;Kr=s.aA(s.e3(Vi.maxLineLength/s.al*1024*zn),256,z.maxTextureSize)}er.gradient=s.e4({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Kr,image:er.gradient||void 0,clips:Vi.lineClipsArray}),er.texture?er.texture.update(er.gradient):er.texture=new s.T(z,er.gradient,j.RGBA8),er.version=u.gradientVersion,Fi=er.texture}z.activeTexture.set(j.TEXTURE1),Fi.bind(u.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}ve&&(z.activeTexture.set(j.TEXTURE0),oi.lineAtlasTexture&&oi.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),Lr.updatePaintBuffers()),we&&(z.activeTexture.set(j.TEXTURE0),oi.imageAtlasTexture&&oi.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Lr.updatePaintBuffers()),fi&&!F&&m.terrain.setupElevationDraw(oi,Yi),m.uploadCommonUniforms(z,Yi,di.toUnwrapped());const Ln=er=>{De!=null&&(De.value=ot*I),Yi.draw(m,j.TRIANGLES,Ct,er,K,Bi.disabled,Ws,u.id,Vi.layoutVertexBuffer,Vi.indexBuffer,Vi.segments,u.paint,m.transform.zoom,Lr,[Vi.layoutVertexBuffer2,Vi.patternVertexBuffer,Vi.zOffsetVertexBuffer]),De!=null&&(De.value=ot)};if(Xe&&!fi){const er=m.stencilModeForClipping(di).ref;er===0&&ie&&z.clear({stencil:0});const Fi={func:j.EQUAL,mask:255};Ws.u_alpha_discard_threshold=.8,Ln(new Pi(Fi,er,255,j.KEEP,j.KEEP,j.INVERT)),Ws.u_alpha_discard_threshold=0,Ln(new Pi(Fi,er,255,j.KEEP,j.KEEP,j.KEEP))}else Ws.u_alpha_discard_threshold=Xe&&fi&&li?.8:0,Ln(fi?It:m.stencilModeForClipping(di))}};let tt=m.depthModeForSublayer(0,Gt.ReadOnly);const bt=new Gt(m.depthOcclusion?j.GREATER:j.LEQUAL,Gt.ReadOnly,m.depthRangeFor3D);if(u.hasNonElevatedBuckets){const kt=!ie&&m.terrain;I!==0&&kt?s.w(`Occlusion opacity for layer ${u.id} is supported on terrain only if the layer has line-z-offset enabled.`):kt?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${u.id}.`):ct(p,Ye,tt,Pi.disabled,!1,!0)}if(u.hasElevatedBuckets){C==="hd-road-markup"?V||(tt=bt,Ye.push("ELEVATED_ROADS")):(Ye.push("ELEVATED"),tt=bt,H&&Ye.push(ee?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),F&&Ye.push("ELEVATION_REFERENCE_SEA"));const kt=Xe?m.stencilModeFor3D():Pi.disabled;m.forceTerrainMode=!0,ct(p,Ye,tt,kt,!0,!0),Xe&&ct(p,Ye,tt,kt,!0,!1),m.forceTerrainMode=!1}Xe&&(m.resetStencilClippingMasks(),ie&&z.clear({stencil:0})),I===0||m.depthOcclusion||ie||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,n,u,p){const v=u.paint.get("fill-color"),x=u.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const w=u.paint.get("fill-emissive-strength"),I=m.colorModeForDrapableLayerRenderPass(w),C=u.paint.get("fill-pattern"),D=m.opaquePassEnabledForLayer()&&!C.constantOr(1)&&v.constantOr(s.ao.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";let F="none";u.layout.get("fill-elevation-reference")!=="none"?F="road":u.paint.get("fill-z-offset").constantOr(1)!==0&&(F="offset");const V=!(!m.terrain||!m.terrain.enabled),z={painter:m,sourceCache:n,layer:u,coords:p,colorMode:I,elevationType:F,terrainEnabled:V,pass:D};if(m.renderPass!=="shadow")if(F!=="offset"){if(sf(z,!1),F==="road"){const j=!V&&m.renderPass==="translucent";j&&$h(m,n,u,p,"geometry"),sf(z,!0,Pi.disabled),j&&function(G){const{painter:H,sourceCache:ee,layer:K,coords:ie,colorMode:ae}=G,ce=H.context.gl,ve=G.painter.shadowRenderer,_e=!!ve&&ve.enabled,xe=new Gt(H.context.gl.LEQUAL,Gt.ReadOnly,H.depthRangeFor3D);let ge=[0,0,0];if(_e){const we=H.style.directionalLight,Je=H.style.ambientLight;we&&Je&&(ge=Ul(H.style,we,Je))}const pe=we=>{for(const Je of ie){const $e=ee.getTile(Je),ot=$e.getBucket(K);if(!ot)continue;const Xe=ot.elevatedStructures;if(!Xe)continue;let nt,Dt;if(we?(nt=Xe.renderableBridgeSegments,Dt=Xe.bridgeProgramConfigurations.get(K.id)):(nt=Xe.renderableTunnelSegments,Dt=Xe.tunnelProgramConfigurations.get(K.id)),!nt||nt.segments[0].primitiveLength===0)continue;Dt.updatePaintBuffers(),H.prepareDrawTile();const Ye=H.isTileAffectedByFog(Je),De=[];_e&&De.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ct=H.getOrCreateProgram("elevatedStructures",{config:Dt,overrideFog:Ye,defines:De}),tt=H.translatePosMatrix(Je.projMatrix,$e,K.paint.get("fill-translate"),K.paint.get("fill-translate-anchor"));_e&&ve.setupShadows($e.tileID.toUnwrapped(),ct,"vector-tile");const bt=cI(tt,ge);H.uploadCommonUniforms(H.context,ct,Je.toUnwrapped()),ct.draw(H,ce.TRIANGLES,xe,Pi.disabled,ae,Bi.backCCW,bt,K.id,Xe.vertexBuffer,Xe.indexBuffer,nt,K.paint,H.transform.zoom,Dt,[Xe.vertexBufferNormal])}};pe(!0),pe(!1)}(z)}}else sf(z,!1,m.stencilModeFor3D());else m.shadowRenderer&&F==="road"&&!V&&function(j){const{painter:G,sourceCache:H,layer:ee,coords:K}=j,ie=G.context.gl,ae=j.painter.shadowRenderer;for(const ce of K){const ve=H.getTile(ce),_e=ve.getBucket(ee);if(!_e)continue;const xe=_e.elevatedStructures;if(!xe||!xe.shadowCasterSegments||xe.shadowCasterSegments.segments[0].primitiveLength===0)continue;G.prepareDrawTile();const ge=_e.bufferData.programConfigurations.get(ee.id),pe=G.isTileAffectedByFog(ce),we=G.getOrCreateProgram("elevatedStructuresDepth",{config:ge,overrideFog:pe}),Je=ae.calculateShadowPassMatrixFromTile(ve.tileID.toUnwrapped());G.uploadCommonUniforms(G.context,we,ce.toUnwrapped());const $e={u_matrix:Je,u_depth_bias:0};we.draw(G,ie.TRIANGLES,ae.getShadowPassDepthMode(),Pi.disabled,ae.getShadowPassColorMode(),Bi.disabled,$e,ee.id,xe.vertexBuffer,xe.indexBuffer,xe.shadowCasterSegments,ee.paint,G.transform.zoom,ge)}}(z)},"fill-extrusion":function(m,n,u,p){const v=u.paint.get("fill-extrusion-opacity"),x=m.context,w=x.gl,I=m.terrain,C=I&&I.renderingToTexture;if(v===0)return;const D=m.conflationActive&&m.style.isLayerClipped(u,n.getSource()),F=m.style.order.indexOf(u.fqid);if(D&&function(V,z,j,G,H){for(const ee of G){const K=z.getTile(ee).getBucket(j);K&&(K.updateReplacement(ee,V.replacementSource,H),K.uploadCentroid(V.context))}}(m,n,u,p,F),I||D)for(const V of p){const z=n.getTile(V).getBucket(u);z&&Fu(m.context,n,V,z,u,I,D)}if(m.renderPass==="shadow"&&m.shadowRenderer){const V=m.shadowRenderer;if(I&&v<.65&&u._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ad)return;const z=V.getShadowPassDepthMode(),j=V.getShadowPassColorMode();Zt(m,n,u,p,z,Pi.disabled,j,D)}else if(m.renderPass==="translucent"){const V=!u.paint.get("fill-extrusion-pattern").constantOr(1),z=u.paint.get("fill-extrusion-color").constantOr(s.ao.white);if(!C&&z.a!==0){const j=new Gt(m.context.gl.LEQUAL,Gt.ReadWrite,m.depthRangeFor3D);v===1&&V?Zt(m,n,u,p,j,Pi.disabled,Di.unblended,D):(Zt(m,n,u,p,j,Pi.disabled,Di.disabled,D),Zt(m,n,u,p,j,m.stencilModeFor3D(),m.colorModeForRenderPass(),D),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&V&&(!I&&m.transform.projection.name!=="globe"||C)){const j=u.paint.get("fill-extrusion-opacity"),G=u.paint.get("fill-extrusion-ambient-occlusion-intensity"),H=u.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ee=u.paint.get("fill-extrusion-flood-light-intensity"),K=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ie=u.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(K?null:u.lut).toArray01().slice(0,3),ae=G>0&&H>0,ce=ee>0,ve=(ge,pe,we)=>(1-we)*ge+we*pe,_e=new Ay;_e.translate=u.paint.get("fill-extrusion-translate"),_e.translateAnchor=u.paint.get("fill-extrusion-translate-anchor"),_e.edgeRadius=u.layout.get("fill-extrusion-edge-radius"),_e.cutoffFadeRange=u.paint.get("fill-extrusion-cutoff-fade-range");const xe=ge=>{const pe=m.depthModeForSublayer(1,Gt.ReadOnly,w.LEQUAL,!0),we=u.paint.get(ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Je=ve(.1,3,we),$e=m._showOverdrawInspector;if(!$e){const ot=new Pi({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Xe=new Di([w.ONE,w.ONE,w.ONE,w.ONE],s.ao.transparent,[!1,!1,!1,!0],w.MIN);Zc(_e,m,n,u,p,pe,ot,Xe,Bi.disabled,ge,"sdf",j,G,H,ee,ie,Je,D,!1)}{const ot=$e?Pi.disabled:new Pi({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Xe=$e?m.colorModeForRenderPass():new Di([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],s.ao.transparent,[!0,!0,!0,!0]);Zc(_e,m,n,u,p,pe,ot,Xe,Bi.disabled,ge,"color",j,G,H,ee,ie,Je,D,!1)}};if(C){const ge=(pe,we,Je)=>{const $e=m.depthModeForSublayer(1,Gt.ReadOnly,w.LEQUAL,!1),ot=u.paint.get(pe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Xe=ve(.1,3,ot);{const nt=new Di([w.ONE,w.ONE,w.ONE,w.ONE],s.ao.transparent,[!1,!1,!1,!0]);Zc(_e,m,n,u,p,$e,Pi.disabled,nt,Bi.disabled,pe,"clear",j,G,H,ee,ie,Xe,D,we)}{const nt=new Pi({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Dt=new Di([w.ONE,w.ONE,w.ONE,w.ONE],s.ao.transparent,[!1,!1,!1,!0],w.MIN);Zc(_e,m,n,u,p,$e,nt,Dt,Bi.disabled,pe,"sdf",j,G,H,ee,ie,Xe,D,we)}{const nt=pe?w.ZERO:w.ONE_MINUS_DST_ALPHA,Dt=new Pi({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Ye=new Di([nt,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],s.ao.transparent,[!0,!0,!0,!0]);Zc(_e,m,n,u,p,$e,Dt,Ye,Bi.disabled,pe,"color",j,G,H,ee,ie,Xe,D,we)}{const nt=new Di([w.ONE,w.ONE,w.ONE,pe?w.ZERO:w.ONE],s.ao.transparent,[!1,!1,!1,!0],pe?w.FUNC_ADD:w.MAX);Zc(_e,m,n,u,p,$e,Pi.disabled,nt,Bi.disabled,pe,"clear",j,G,H,ee,ie,Xe,D,we,Je)}};if(ae||ce){let pe;if(m.prepareDrawTile(),I){const we=I.drapeBufferSize[0],Je=I.drapeBufferSize[1];pe=I.framebufferCopyTexture,pe&&(!pe||pe.size[0]===we&&pe.size[1]===Je)||(pe&&pe.destroy(),pe=I.framebufferCopyTexture=new s.T(x,new s.q({width:we,height:Je}),w.RGBA8)),pe.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexSubImage2D(w.TEXTURE_2D,0,0,0,0,0,we,Je)}ae&&ge(!0,!1,pe),ce&&ge(!1,!0,pe)}}else ae&&xe(!0),ce&&xe(!1),(ae||ce)&&m.resetStencilClippingMasks()}}},building:function(m,n,u,p){m.currentLayer<m.firstLightBeamLayer&&(m.firstLightBeamLayer=m.currentLayer);const v=u.paint.get("building-ambient-occlusion-ground-intensity"),x=u.paint.get("building-ambient-occlusion-ground-radius"),w=u.paint.get("building-ambient-occlusion-ground-attenuation"),I=u.paint.get("building-opacity");if(I<=0)return;let C=v>0&&x>0,D=!0;const F=u.paint.get("building-vertical-scale");(!m.shadowRenderer||F<1)&&(D=!1);const V=m.conflationActive&&m.style.isLayerClipped(u,n.getSource()),z=m.style.order.indexOf(u.fqid);if(function(j,G,H,ee,K,ie){for(const ae of ie){const ce=G.getTile(ae).getBucket(H);ce&&(K&&ce.updateReplacement(ae,j.replacementSource,ee),ce.uploadUpdatedIndexBuffer(j.context))}}(m,n,u,z,V,p),function(j,G,H,ee){for(const K of ee){const ie=G.getTile(K).getBucket(H);ie&&ie.needsEvaluation()&&ie.uploadUpdatedColorBuffer(j.context)}}(m,n,u,p),u.resetLayerRenderingStats(m),m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0),m.renderPass==="shadow"&&m.shadowRenderer){const j=m.shadowRenderer,G=[],H=j.getShadowPassDepthMode();D_({painter:m,source:n,layer:u,coords:p,defines:G,blendMode:j.getShadowPassColorMode(),depthMode:H,opacity:I,verticalScale:F,facadeEmissiveChance:0,facadeAOIntensity:0})}else if(m.renderPass==="translucent"){let j=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];D&&(j=j.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),m.shadowRenderer&&m.shadowRenderer.useNormalOffset&&(j=j.concat("NORMAL_OFFSET"));const G=u.paint.get("building-facade-emissive-chance"),H=u.paint.get("building-ambient-occlusion-intensity"),ee=new Gt(m.context.gl.LEQUAL,Gt.ReadWrite,m.depthRangeFor3D);I<1&&D_({painter:m,source:n,layer:u,coords:p,defines:j,blendMode:Di.disabled,depthMode:ee,opacity:I,verticalScale:F,facadeEmissiveChance:G,facadeAOIntensity:H});const K=m.colorModeForRenderPass();D_({painter:m,source:n,layer:u,coords:p,defines:j,blendMode:K,depthMode:ee,opacity:I,verticalScale:F,facadeEmissiveChance:G,facadeAOIntensity:H}),C&&function(ie,ae,ce,ve,_e,xe,ge,pe,we,Je,$e,ot,Xe){const nt=ie.context.gl,Dt=ie.depthModeForSublayer(1,Gt.ReadOnly,nt.LEQUAL,!0),Ye=.1*(1-(De=$e))+3*De;var De;const ct=ie._showOverdrawInspector,tt=ot,bt=new Ay;ct||Zc(bt,ie,ae,ce,ve,Dt,new Pi({func:nt.ALWAYS,mask:255},255,255,nt.KEEP,nt.KEEP,nt.REPLACE),new Di([nt.ONE,nt.ONE,nt.ONE,nt.ONE],s.ao.transparent,[!1,!1,!1,!0],nt.MIN),Bi.disabled,_e,"sdf",xe,ge,pe,0,Je,Ye,tt,!1);{const kt=ct?Pi.disabled:new Pi({func:nt.EQUAL,mask:255},255,255,nt.KEEP,nt.DECR,nt.DECR),$t=ct?ie.colorModeForRenderPass():new Di([nt.ONE_MINUS_DST_ALPHA,nt.DST_ALPHA,nt.ONE,nt.ONE],s.ao.transparent,[!0,!0,!0,!0]);Zc(bt,ie,ae,ce,ve,Dt,kt,$t,Bi.disabled,_e,"color",xe,ge,pe,0,Je,Ye,tt,!1)}}(m,n,u,p,!0,I,v,x,0,[0,0,0],w,V)}else if(m.renderPass==="light-beam"){const j=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],G=new Gt(m.context.gl.LEQUAL,Gt.ReadOnly,m.depthRangeFor3D);D_({painter:m,source:n,layer:u,coords:p,defines:j,blendMode:Di.alphaBlended,depthMode:G,opacity:I,verticalScale:F,facadeEmissiveChance:0,facadeAOIntensity:0})}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1),m.resetStencilClippingMasks()},hillshade:function(m,n,u,p){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;const v=m.context,x=m.terrain&&m.terrain.renderingToTexture,[w,I]=m.renderPass!=="translucent"||x?[{},p]:m.stencilConfigForOverlap(p);for(const C of I){const D=n.getTile(C);if(D.needsHillshadePrepare&&m.renderPass==="offscreen")YE(m,D,u);else if(m.renderPass==="translucent"){const F=m.depthModeForSublayer(0,Gt.ReadOnly),V=u.paint.get("hillshade-emissive-strength"),z=m.colorModeForDrapableLayerRenderPass(V),j=x&&m.terrain?m.terrain.stencilModeForRTTOverlap(C):w[C.overscaledZ];KE(m,C,D,u,F,j,z)}}v.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,n,u,p,v,x){if(m.renderPass!=="translucent"||u.paint.get("raster-opacity")===0)return;const w=m.transform.projection.name==="globe",I=u.paint.get("raster-elevation")!==0,C=I&&w;if(m.renderElevatedRasterBackface&&!C)return;const D=m.context,F=D.gl,V=n.getSource(),z=function(_e,xe,ge,pe){const we=xe.paint.get("raster-color"),Je=_e.type==="raster-array",$e=[],ot=xe.paint.get("raster-resampling"),Xe=xe.paint.get("raster-color-mix");let nt=xe.paint.get("raster-color-range");const Dt=[Xe[0],Xe[1],Xe[2],0],Ye=Xe[3];let De=ot==="nearest"?pe.NEAREST:pe.LINEAR;if(Je&&($e.push("RASTER_ARRAY"),we||$e.push("RASTER_COLOR"),ot==="linear"&&$e.push("RASTER_ARRAY_LINEAR"),De=pe.NEAREST,!nt&&_e.rasterLayers)){const ct=_e.rasterLayers.find(({id:tt})=>tt===xe.sourceLayer);ct&&ct.fields&&ct.fields.range&&(nt=ct.fields.range)}if(nt=nt||[0,1],we){$e.push("RASTER_COLOR"),ge.activeTexture.set(pe.TEXTURE2),xe.updateColorRamp(nt);let ct=xe.colorRampTexture;ct||(ct=xe.colorRampTexture=new s.T(ge,xe.colorRamp,pe.RGBA8)),ct.bind(pe.LINEAR,pe.CLAMP_TO_EDGE)}return{mix:Dt,range:nt,offset:Ye,defines:$e,resampling:De}}(V,u,D,F);if(V instanceof s.aS&&!p.length&&!w)return;const j=u.paint.get("raster-emissive-strength"),G=m.colorModeForDrapableLayerRenderPass(j),H=m.terrain&&m.terrain.renderingToTexture,ee=!m.options.moving,K=u.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;if(V instanceof s.aS&&!p.length&&(V.onNorthPole||V.onSouthPole)){const _e=I?m.stencilModeFor3D():Pi.disabled;return void O_(!!V.onNorthPole,null,m,n,u,j,z,Bi.disabled,_e)}if(!p.length)return;const[ie,ae]=V instanceof s.aS||H?[{},p]:m.stencilConfigForOverlap(p),ce=ae[ae.length-1].overscaledZ;C&&z.defines.push("PROJECTION_GLOBE_VIEW"),I&&z.defines.push("RENDER_CUTOFF");const ve=(_e,xe,ge)=>{for(const pe of _e){const we=pe.toUnwrapped(),Je=n.getTile(pe);if(H&&(!Je||!Je.hasData()))continue;D.activeTexture.set(F.TEXTURE0);const $e=pb(Je,V,u,z);if(!$e||!$e.texture)continue;const{texture:ot,mix:Xe,offset:nt,tileSize:Dt,buffer:Ye}=$e;let De,ct;H?(De=Gt.disabled,ct=pe.projMatrix):I?(De=new Gt(F.LEQUAL,Gt.ReadWrite,m.depthRangeFor3D),ct=w?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(we,ee)):(De=m.depthModeForSublayer(pe.overscaledZ-ce,u.paint.get("raster-opacity")===1?Gt.ReadWrite:Gt.ReadOnly,F.LESS),ct=m.transform.calculateProjMatrix(we,ee));const tt=m.terrain&&H?m.terrain.stencilModeForRTTOverlap(pe):ie[pe.overscaledZ],bt=x?0:u.paint.get("raster-fade-duration");Je.registerFadeDuration(bt);const kt=n.findLoadedParent(pe,0),$t=Bh(Je,kt,n,m.transform,bt);let Ct,It;!$t.isFading&&Je.refreshedUponExpiration&&(Je.refreshedUponExpiration=!1),m.terrain&&m.terrain.prepareDrawTile(),D.activeTexture.set(F.TEXTURE0),ot.bind(K,F.CLAMP_TO_EDGE),D.activeTexture.set(F.TEXTURE1),kt?(kt.texture&&kt.texture.bind(K,F.CLAMP_TO_EDGE),Ct=Math.pow(2,kt.tileID.overscaledZ-Je.tileID.overscaledZ),It=[Je.tileID.canonical.x*Ct%1,Je.tileID.canonical.y*Ct%1]):ot.bind(K,F.CLAMP_TO_EDGE),"useMipmap"in ot&&D.extTextureFilterAnisotropic&&m.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const fi=m.transform;let li;const di=I?pI(fi):[0,0,0,0];let oi,Vi,Ki,Qi,Zr,Gi=0;if(C&&V instanceof s.aS&&V.coordinates.length>3)oi=Float32Array.from(s.bk(s.dF(new s.cC(0,0,0)))),Vi=Float32Array.from(fi.globeMatrix),Ki=Float32Array.from(s.dB(fi)),Qi=[s.aF(fi.center.lng),s.aJ(fi.center.lat)],li=V.elevatedGlobePerspectiveTransform,Zr=V.elevatedGlobeGridMatrix||new Float32Array(9);else if(C){const Yi=s.dC(pe.canonical);Gi=s.dD(Yi.getCenter().lat),oi=Float32Array.from(s.bk(s.dF(pe.canonical))),Vi=Float32Array.from(fi.globeMatrix),Ki=Float32Array.from(s.dB(fi)),Qi=[s.aF(fi.center.lng),s.aJ(fi.center.lat)],li=[0,0],Zr=Float32Array.from(s.dE(pe.canonical,Yi,Gi,fi.worldSize/fi._pixelsPerMercatorPixel))}else li=V instanceof s.aS?V.perspectiveTransform:[0,0],oi=new Float32Array(16),Vi=new Float32Array(9),Ki=new Float32Array(16),Qi=[0,0],Zr=new Float32Array(9);const Lr=E_(ct,oi,Vi,Ki,Zr,It||[0,0],s.aj(m.transform.zoom),Qi,di,Ct||1,$t,u,li,I?u.paint.get("raster-elevation"):0,2,Xe,nt,z.range,Dt,Ye,j),Wr=m.isTileAffectedByFog(pe),An=m.getOrCreateProgram("raster",{defines:z.defines,overrideFog:Wr});if(m.uploadCommonUniforms(D,An,we),V instanceof s.aS){const Yi=V.elevatedGlobeVertexBuffer,Ur=V.elevatedGlobeIndexBuffer;if(H||!w)V.boundsBuffer&&V.boundsSegments&&An.draw(m,F.TRIANGLES,De,Pi.disabled,G,Bi.disabled,Lr,u.id,V.boundsBuffer,m.quadTriangleIndexBuffer,V.boundsSegments);else if(Yi&&Ur){const zr=fi.zoom<=s.cZ?V.elevatedGlobeSegments:V.getSegmentsForLongitude(fi.center.lng);zr&&An.draw(m,F.TRIANGLES,De,Pi.disabled,G,xe,Lr,u.id,Yi,Ur,zr)}}else if(C){De=new Gt(F.LEQUAL,Gt.ReadOnly,m.depthRangeFor3D);const Yi=m.globeSharedBuffers;if(Yi){const[Ur,zr,Hr]=Yi.getGridBuffers(Gi,!1);An.draw(m,F.TRIANGLES,De,ge||tt,m.colorModeForRenderPass(),xe,Lr,u.id,Ur,zr,Hr)}}else{const{tileBoundsBuffer:Yi,tileBoundsIndexBuffer:Ur,tileBoundsSegments:zr}=m.getTileBoundsBuffers(Je);An.draw(m,F.TRIANGLES,De,tt,G,Bi.disabled,Lr,u.id,Yi,Ur,zr)}}if(!(V instanceof s.aS)&&C)for(const pe of _e){const we=pe.canonical.y===(1<<pe.canonical.z)-1;pe.canonical.y===0&&O_(!0,pe,m,n,u,j,z,xe,ge||Pi.disabled),we&&O_(!1,pe,m,n,u,j,z,xe===Bi.frontCW?Bi.backCW:Bi.frontCW,ge||Pi.disabled)}};C?ve(ae,m.renderElevatedRasterBackface?Bi.backCW:Bi.frontCW,m.stencilModeFor3D()):ve(ae,Bi.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,n,u,p,v,x){m.renderPass==="offscreen"&&function(w,I,C,D){if(!D.length)return;const F=w.context,V=F.gl,z=I.getSource();if(!(z instanceof uc))return;const j=Math.ceil(Math.sqrt(C.paint.get("raster-particle-count")));let G=C.particlePositionRGBAImage;if(!G||G.width!==j){const ae=function(ce){const ve=ce*ce,_e=new Uint8Array(4*ve),xe=function(pe){return pe|=0,pe=Math.imul(2747636419^pe,2654435769),pe=Math.imul(pe^pe>>>16,2654435769),((pe=Math.imul(pe^pe>>>16,2654435769))>>>0)/4294967296},ge=1/1.1;for(let pe=0;pe<ve;pe++){const we=ge*(xe(2*pe+0)+jh),Je=ge*(xe(2*pe+1)+jh),$e=255*we%1,ot=255*Je%1,Xe=$e,nt=Je-ot/255,Dt=ot;_e[4*pe+0]=255*(we-$e/255),_e[4*pe+1]=255*Xe,_e[4*pe+2]=255*nt,_e[4*pe+3]=255*Dt}return _e}(j);G=C.particlePositionRGBAImage=new s.q({width:j,height:j},ae)}let H=C.particleFramebuffer;H?H.width!==j&&(H.destroy(),H=C.particleFramebuffer=F.createFramebuffer(j,j,!0,null)):H=C.particleFramebuffer=F.createFramebuffer(j,j,!0,null);const ee=[];for(const ae of D){const ce=I.getTile(ae);if(!(ce instanceof Ih))continue;const ve=Aa(ce,z,C);if(!ve)continue;const _e=[ce.tileSize,ce.tileSize];let xe=C.tileFramebuffer;xe||(xe=C.tileFramebuffer=F.createFramebuffer(_e[0],_e[1],!0,null));let ge=ce.rasterParticleState;ge||(ge=ce.rasterParticleState=new _I(F,ae,_e,G));const pe=ge.update(C.lastInvalidatedAt);ge.particleTextureDimension!==j&&ge.updateParticleTexture(ae,G);const we=ge.targetColorTexture;ge.targetColorTexture=ge.backgroundColorTexture,ge.backgroundColorTexture=we;const Je=ge.particleTexture0;ge.particleTexture0=ge.particleTexture1,ge.particleTexture1=Je,ee.push([ae,ve,ge,pe])}if(ee.length===0)return;const K=s.o.now(),ie=C.previousDrawTimestamp?.001*(K-C.previousDrawTimestamp):.0167;if(C.previousDrawTimestamp=K,C.hasColorMap()){F.activeTexture.set(V.TEXTURE0+2);let ae=C.colorRampTexture;ae||(ae=C.colorRampTexture=new s.T(F,C.colorRamp,V.RGBA8)),ae.bind(V.LINEAR,V.CLAMP_TO_EDGE)}F.bindFramebuffer.set(C.tileFramebuffer.framebuffer),function(ae,ce,ve){const _e=ae.context,xe=_e.gl,ge=ce.tileFramebuffer;_e.activeTexture.set(xe.TEXTURE0);const pe={u_texture:0,u_opacity:1.05*(Je=ce.paint.get("raster-particle-fade-opacity-factor"))/(Je+.05)},we=ae.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Je;for(const $e of ve){const[,,ot,Xe]=$e;ge.colorAttachment.set(ot.targetColorTexture.texture),_e.viewport.set([0,0,ge.width,ge.height]),_e.clear({color:s.ao.transparent}),Xe&&(ot.backgroundColorTexture.bind(xe.NEAREST,xe.CLAMP_TO_EDGE),we.draw(ae,xe.TRIANGLES,Gt.disabled,Pi.disabled,Di.alphaBlended,Bi.disabled,pe,ce.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments))}}(w,C,ee),function(ae,ce,ve,_e){const xe=ae.context,ge=xe.gl,pe=ve.tileFramebuffer,we=ae.transform.projection.name==="globe",Je=ve.paint.get("raster-particle-max-speed");for(const $e of _e){const[ot,Xe,nt]=$e;xe.activeTexture.set(ge.TEXTURE0+0),Xe.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),pe.colorAttachment.set(nt.targetColorTexture.texture);const Dt=ae.getOrCreateProgram("rasterParticleDraw",{defines:Xe.defines,overrideFog:!1});xe.activeTexture.set(ge.TEXTURE0+1);const Ye=Xe.scalarData?[]:[0,1,2,3].map(tt=>s.e6[tt](ot));Ye.push(ot);const De=ot.canonical.x,ct=ot.canonical.y;for(const tt of Ye){const bt=ce.getTile(we?tt.wrapped():tt);if(!bt)continue;const kt=bt.rasterParticleState;if(!kt)continue;const $t=tt.canonical.x+(1<<tt.canonical.z)*(tt.wrap-ot.wrap),Ct=tt.canonical.y;kt.particleTexture0.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);const It=by(1,kt.particleTexture0.size[0],[$t-De,Ct-ct],0,Xe.texture.size,2,Je,Xe.textureOffset,Xe.scale,Xe.offset);Dt.draw(ae,ge.POINTS,Gt.disabled,Pi.disabled,Di.alphaBlended,Bi.disabled,It,ve.id,kt.particleIndexBuffer,void 0,kt.particleSegment)}}}(w,I,C,ee),F.bindFramebuffer.set(C.particleFramebuffer.framebuffer),function(ae,ce,ve,_e){const xe=ae.context,ge=xe.gl,pe=ce.paint.get("raster-particle-max-speed"),we=_e*ce.paint.get("raster-particle-speed-factor")*.15,Je=function(ot){return Math.pow(ot,6)}(.01+1*ce.paint.get("raster-particle-reset-rate-factor")),$e=ce.particleFramebuffer;xe.viewport.set([0,0,$e.width,$e.height]);for(const ot of ve){const[,Xe,nt]=ot;xe.activeTexture.set(ge.TEXTURE0+0),Xe.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),xe.activeTexture.set(ge.TEXTURE0+1);const Dt=nt.particleTexture0;Dt.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);const Ye=I_(1,Dt.size[0],0,Xe.texture.size,pe,we,Je,Xe.textureOffset,Xe.scale,Xe.offset);$e.colorAttachment.set(nt.particleTexture1.texture),xe.clear({color:s.ao.transparent}),ae.getOrCreateProgram("rasterParticleUpdate",{defines:Xe.defines}).draw(ae,ge.TRIANGLES,Gt.disabled,Pi.disabled,Di.unblended,Bi.disabled,Ye,ce.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments)}}(w,C,ee,ie)}(m,n,u,p),m.renderPass==="translucent"&&(function(w,I,C,D,F){const V=w.context,z=V.gl,j=I.getSource().tileSize,G=5*(1-s.ah(s.cK,s.cK+1,w.transform.zoom))*j+C.paint.get("raster-particle-elevation"),H=!w.options.moving,ee=w.transform.projection.name==="globe";if(!D.length)return;const[K,ie]=w.stencilConfigForOverlap(D),ae=[];ee&&ae.push("PROJECTION_GLOBE_VIEW");const ce=w.stencilModeFor3D();for(const ve of ie){const _e=ve.toUnwrapped(),xe=I.getTile(ve);if(!xe.rasterParticleState)continue;const ge=xe.rasterParticleState,pe=100;xe.registerFadeDuration(pe);const we=I.findLoadedParent(ve,0),Je=Bh(xe,we,I,w.transform,pe);let $e,ot;w.terrain&&w.terrain.prepareDrawTile(),V.activeTexture.set(z.TEXTURE0),ge.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),V.activeTexture.set(z.TEXTURE1),we&&we.rasterParticleState?(we.rasterParticleState.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),$e=Math.pow(2,we.tileID.overscaledZ-xe.tileID.overscaledZ),ot=[xe.tileID.canonical.x*$e%1,xe.tileID.canonical.y*$e%1]):ge.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const Xe=ee?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(_e,H),nt=w.transform,Dt=Ry(nt),Ye=s.dC(ve.canonical),De=s.dD(Ye.getCenter().lat);let ct,tt,bt,kt,$t;ee?(ct=Float32Array.from(s.bk(s.dF(ve.canonical))),tt=Float32Array.from(nt.globeMatrix),bt=Float32Array.from(s.dB(nt)),kt=[s.aF(nt.center.lng),s.aJ(nt.center.lat)],$t=Float32Array.from(s.dE(ve.canonical,Ye,De,nt.worldSize/nt._pixelsPerMercatorPixel))):(ct=new Float32Array(16),tt=new Float32Array(9),bt=new Float32Array(16),kt=[0,0],$t=new Float32Array(9));const Ct=Du(Xe,ct,tt,bt,$t,ot||[0,0],s.aj(w.transform.zoom),kt,Dt,$e||1,Je,G),It=w.isTileAffectedByFog(ve),fi=w.getOrCreateProgram("rasterParticle",{defines:ae,overrideFog:It});if(w.uploadCommonUniforms(V,fi,_e),ee){const li=new Gt(z.LEQUAL,Gt.ReadOnly,w.depthRangeFor3D),di=0,oi=w.globeSharedBuffers;if(oi){const[Vi,Ki,Qi]=oi.getGridBuffers(De,di!==0);fi.draw(w,z.TRIANGLES,li,ce,Di.alphaBlended,w.renderElevatedRasterBackface?Bi.frontCCW:Bi.backCCW,Ct,C.id,Vi,Ki,Qi)}}else{const li=w.depthModeForSublayer(0,Gt.ReadOnly),di=K[ve.overscaledZ],{tileBoundsBuffer:oi,tileBoundsIndexBuffer:Vi,tileBoundsSegments:Ki}=w.getTileBoundsBuffers(xe);fi.draw(w,z.TRIANGLES,li,di,Di.alphaBlended,Bi.disabled,Ct,C.id,oi,Vi,Ki)}}w.resetStencilClippingMasks()}(m,n,u,p),m.style.map.triggerRepaint())},background:function(m,n,u,p){const v=u.paint.get("background-color"),x=u.paint.get("background-color-use-theme").constantOr("default")==="none",w=u.paint.get("background-opacity"),I=u.paint.get("background-emissive-strength"),C=u.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const D=m.context,F=D.gl,V=m.transform,z=V.tileSize,j=u.paint.get("background-pattern");let G;if(j!==void 0&&(j===null||(G=m.imageManager.getPattern(s.I.from(j.toString()),u.scope,m.style.getLut(u.scope)),!G)))return;const H=!j&&v.a===1&&w===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==H)return;const ee=Pi.disabled,K=m.depthModeForSublayer(0,H==="opaque"?Gt.ReadWrite:Gt.ReadOnly),ie=m.colorModeForDrapableLayerRenderPass(I),ae=j?"backgroundPattern":"background";let ce,ve=p;if(ve||(ce=m.getBackgroundTiles(),ve=Object.values(ce).map(_e=>_e.tileID)),j&&(D.activeTexture.set(F.TEXTURE0),m.imageManager.bind(m.context,u.scope)),C){const _e=m.getOrCreateProgram(ae,{overrideFog:!1,overrideRtt:!0}),xe=new Float32Array(s.bA([])),ge=new s.aO(0,0,0,0,0),pe=j?A_(xe,I,w,m,0,u.scope,G,C,{tileID:ge,tileSize:z}):S_(xe,I,w,v.toPremultipliedRenderColor(x?null:u.lut));_e.draw(m,F.TRIANGLES,K,ee,ie,Bi.disabled,pe,u.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}else for(const _e of ve){const xe=m.isTileAffectedByFog(_e),ge=m.getOrCreateProgram(ae,{overrideFog:xe}),pe=_e.toUnwrapped(),we=p?_e.projMatrix:m.transform.calculateProjMatrix(pe);m.prepareDrawTile();const Je=n?n.getTile(_e):ce?ce[_e.key]:new fc(_e,z,V.zoom,m),$e=j?A_(we,I,w,m,0,u.scope,G,C,{tileID:_e,tileSize:z}):S_(we,I,w,v.toPremultipliedRenderColor(x?null:u.lut));m.uploadCommonUniforms(D,ge,pe);const{tileBoundsBuffer:ot,tileBoundsIndexBuffer:Xe,tileBoundsSegments:nt}=m.getTileBoundsBuffers(Je);ge.draw(m,F.TRIANGLES,K,ee,ie,Bi.disabled,$e,u.id,ot,Xe,nt)}},sky:function(m,n,u){const p=m._atmosphere?s.aj(m.transform.zoom):1,v=u.paint.get("sky-opacity")*p;if(v===0)return;const x=m.context,w=u.paint.get("sky-type"),I=new Gt(x.gl.LEQUAL,Gt.ReadOnly,[0,1]),C=m.frameCounter/1e3%1;w==="atmosphere"?m.renderPass==="offscreen"?u.needsSkyboxCapture(m)&&(function(D,F,V,z){const j=D.context,G=j.gl;let H=F.skyboxFbo;if(!H){H=F.skyboxFbo=j.createFramebuffer(32,32,!0,null),F.skyboxGeometry=new Dy(j),F.skyboxTexture=j.gl.createTexture(),G.bindTexture(G.TEXTURE_CUBE_MAP,F.skyboxTexture),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,G.LINEAR);for(let ae=0;ae<6;++ae)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+ae,0,G.RGBA,32,32,0,G.RGBA,G.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(H.framebuffer),j.viewport.set([0,0,32,32]);const ee=F.getCenter(D,!0),K=D.getOrCreateProgram("skyboxCapture"),ie=new Float64Array(16);s.bA(ie),s.ek(ie,ie,.5*-Math.PI),qh(D,F,K,ie,ee,0),s.bA(ie),s.ek(ie,ie,.5*Math.PI),qh(D,F,K,ie,ee,1),s.bA(ie),s.cT(ie,ie,.5*-Math.PI),qh(D,F,K,ie,ee,2),s.bA(ie),s.cT(ie,ie,.5*Math.PI),qh(D,F,K,ie,ee,3),s.bA(ie),qh(D,F,K,ie,ee,4),s.bA(ie),s.ek(ie,ie,Math.PI),qh(D,F,K,ie,ee,5),j.viewport.set([0,0,D.width,D.height])}(m,u),u.markSkyboxValid(m)):m.renderPass==="sky"&&function(D,F,V,z,j){const G=D.context,H=G.gl,ee=D.transform,K=D.getOrCreateProgram("skybox");G.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_CUBE_MAP,F.skyboxTexture);const ie=((ae,ce,ve,_e,xe)=>({u_matrix:ae,u_sun_direction:ce,u_cubemap:0,u_opacity:_e,u_temporal_offset:xe}))(ee.skyboxMatrix,F.getCenter(D,!1),0,z,j);D.uploadCommonUniforms(G,K),K.draw(D,H.TRIANGLES,V,Pi.disabled,D.colorModeForRenderPass(),Bi.backCW,ie,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(m,u,I,v,C):w==="gradient"&&m.renderPass==="sky"&&function(D,F,V,z,j){const G=D.context,H=G.gl,ee=D.transform,K=D.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new Dy(G)),G.activeTexture.set(H.TEXTURE0);let ie=F.colorRampTexture;ie||(ie=F.colorRampTexture=new s.T(G,F.colorRamp,H.RGBA8)),ie.bind(H.LINEAR,H.CLAMP_TO_EDGE);const ae=((ce,ve,_e,xe,ge)=>({u_matrix:ce,u_color_ramp:0,u_center_direction:ve,u_radius:s.an(_e),u_opacity:xe,u_temporal_offset:ge}))(ee.skyboxMatrix,F.getCenter(D,!1),F.paint.get("sky-gradient-radius"),z,j);D.uploadCommonUniforms(G,K),K.draw(D,H.TRIANGLES,V,Pi.disabled,D.colorModeForRenderPass(),Bi.backCW,ae,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(m,u,I,v,C)},custom:function(m,n,u,p){const v=m.context,x=u.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&u.isDraped(n)){if(m.renderPass==="offscreen"){const w=x.prerender;if(w){if(m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const I=m.transform.pointMerc;w.call(x,v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),s.aj(m.transform.zoom),[I.x,I.y],m.transform.pixelsPerMeterRatio)}else w.call(x,v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const I=x.renderToTile;if(I){const C=p[0].canonical,D={x:C.x+p[0].wrap*(x.wrapTileId?0:1<<C.z),y:C.y,z:C.z};v.setDepthMode(Gt.disabled),v.setStencilMode(Pi.disabled),v.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),I.call(x,v.gl,D),v.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),v.setStencilMode(Pi.disabled);const w=x.renderingMode==="3d"?new Gt(m.context.gl.LEQUAL,Gt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Gt.ReadOnly);if(v.setDepthMode(w),m.transform.projection.name==="globe"){const I=m.transform.pointMerc;x.render(v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),s.aj(m.transform.zoom),[I.x,I.y],m.transform.pixelsPerMeterRatio)}else x.render(v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState(),v.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,n,u,p){if(m.renderPass==="opaque")return;const v=u.paint.get("model-opacity").constantOr(1);if(v===0)return;const x=u.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!x||m.terrain&&v<.65&&u._transitionablePaint._values["model-opacity"].value.expression instanceof s.ad))return;const w=m.shadowRenderer,I=u.paint.get("model-receive-shadows");w&&(w.useNormalOffset=!0,I||(w.enabled=!1));const C=()=>{w&&(w.useNormalOffset=!0,I||(w.enabled=!0))},D=n.getSource();if(m.renderPass==="light-beam"&&D.type!=="batched-model")return;if(D.type==="vector"||D.type==="geojson")return function(K,ie,ae,ce,ve){const _e=K.transform;if(_e.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${_e.projection.name} projection is not yet implemented`);const xe=_e.getFreeCameraOptions().position;if(!K.modelManager)return;const ge=K.modelManager;ae.modelManager=ge;const pe=K.shadowRenderer;if(!ae._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const we=ae._unevaluatedLayout._values["model-id"],Je=Object.assign({},ae.layout.get("model-id").parameters),$e=K.style.order.indexOf(ae.fqid);for(const ot of ce){const Xe=ie.getTile(ot).getBucket(ae);if(!Xe||Xe.projection.name!==_e.projection.name)continue;const nt=Xe.getModelUris();nt&&!Xe.modelsRequested&&(ge.addModelsFromBucket(nt,ve),Xe.modelsRequested=!0);const Dt=af(ot,_e);Je.zoom=Dt;const Ye=we.possiblyEvaluate(Je);if(gb(K,Xe,ot),jl.shadowUniformsInitialized=!1,jl.useSingleShadowCascade=!!pe&&pe.getMaxCascadeForTile(ot.toUnwrapped())===0,K.renderPass==="shadow"&&pe){if(K.currentShadowCascade===1&&Xe.isInsideFirstShadowMapFrustum)continue;const tt=_e.calculatePosMatrix(ot.toUnwrapped(),_e.worldSize);if(jl.tileMatrix.set(tt),jl.shadowTileMatrix=Float32Array.from(pe.calculateShadowPassMatrixFromMatrix(tt)),jl.aabb.min=[0,0,0],jl.aabb.max[0]=jl.aabb.max[1]=s.al,jl.aabb.max[2]=0,vb(Xe,jl,K,ae.scope))continue}const De=1<<ot.canonical.z,ct=[((xe.x-ot.wrap)*De-ot.canonical.x)*s.al,(xe.y*De-ot.canonical.y)*s.al,xe.z*De*s.al];K.conflationActive&&Object.keys(Xe.instancesPerModel).length>0&&K.style.isLayerClipped(ae,ie.getSource())&&Xe.updateReplacement(ot,K.replacementSource,$e,ve)&&(Xe.uploaded=!1,Xe.upload(K.context));for(let tt in Xe.instancesPerModel){const bt=Xe.instancesPerModel[tt];bt.features.length>0&&(tt=Ye.evaluate(bt.features[0].feature,{}));const kt=ge.getModel(tt,ve);if(kt||ge.hasURLBeenRequested(tt)||Xe.modelUris.includes(tt)||(Xe.modelUris.push(tt),Xe.modelsRequested=!1),kt&&kt.uploaded)for(const $t of kt.nodes)yb(K,ae,$t,bt,ct,ot,jl)}}}(m,n,u,p,D.type==="vector"?u.scope:""),void C();if(!D.loaded())return;if(D.type==="batched-model")return function(K,ie,ae,ce){ae.resetLayerRenderingStats(K);const ve=K.context,_e=K.transform,xe=K.style.fog,ge=K.shadowRenderer;if(_e.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${_e.projection.name} projection is not yet implemented`);const pe=K.transform.getFreeCameraOptions().position,we=s.c4([],[pe.x,pe.y,pe.z],K.transform.worldSize),Je=s.et([],we),$e=s.bA([]),ot=s.ec(_e.center.lat,_e.zoom),Xe=s.bq([],[1,1,1/ot]);s.br($e,$e,Je);const nt=ae.paint.get("model-opacity").constantOr(1),Dt=new Gt(ve.gl.LEQUAL,Gt.ReadWrite,K.depthRangeFor3D),Ye=new Gt(ve.gl.LEQUAL,Gt.ReadOnly,K.depthRangeFor3D),De=new s.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ct=K.renderPass==="shadow",tt=ct&&ge?ge.getCurrentCascadeFrustum():_e.getFrustum(_e.scaleZoom(_e.worldSize)),bt=ae.paint.get("model-front-cutoff"),kt=bt[2]<1,$t=Ru(K,ae.paint.get("model-cutoff-fade-range")),Ct=ae.getLayerRenderingStats();(function(It,fi,li,di){const oi=It.terrain?It.terrain.exaggeration():0,Vi=It.transform.zoom;for(const Ki of di){const Qi=fi.getTile(Ki).getBucket(li);Qi&&(Qi.setFilter(li.filter),It.conflationActive&&Qi.updateReplacement(Ki,It.replacementSource),Qi.evaluateTransform(It,li),It.terrain&&oi>0&&Qi.elevationUpdate(It.terrain,oi,Ki,li.source),Qi.needsReEvaluation(It,Vi,li)&&Qi.evaluate(li))}})(K,ie,ae,ce),function(){let It,fi,li;kt?(It=ce.length-1,fi=-1,li=-1):(It=0,fi=ce.length,li=1);const di=new Float64Array(16),oi=s.cz(),Vi=new s.P(0,0);for(let Ki=It;Ki!==fi;Ki+=li){const Qi=ce[Ki],Zr=ie.getTile(Qi).getBucket(ae);if(!Zr||!Zr.uploaded)continue;let Gi=!1;ge&&(Gi=ge.getMaxCascadeForTile(Qi.toUnwrapped())===0);const Lr=_e.calculatePosMatrix(Qi.toUnwrapped(),_e.worldSize),Wr=Zr.modelTraits;!ct&&kt&&(s.bl(di,Lr),s.af(oi,we,di),Vi.x=oi[0],Vi.y=oi[1]);const An=[];Zr.setFilter(ae.filter);for(const Yi of Zr.getNodesInfo()){if(Yi.hiddenByReplacement||!Yi.node.meshes)continue;const Ur=Yi.node;let zr=0;K.terrain&&Ur.elevation&&(zr=Ur.elevation*K.terrain.exaggeration());const Hr=(()=>{const lo=Yi.aabb;return De.min=[...lo.min],De.max=[...lo.max],De.min[2]+=zr,De.max[2]+=zr,s.af(De.min,De.min,Lr),s.af(De.max,De.max,Lr),De})(),Dn=Yi.evaluatedScale;if(Dn[0]<=1&&Dn[1]<=1&&Dn[2]<=1&&Hr.intersects(tt)===0)continue;if(!ct&&kt){const lo=.16666666666666666;Yi.cameraCollisionOpacity=we[0]>Hr.min[0]&&we[0]<Hr.max[0]&&we[1]>Hr.min[1]&&we[1]<Hr.max[1]&&we[2]*ot<Hr.max[2]&&Ur.footprint&&s.b$(Vi,Ur.footprint)?Math.max(Yi.cameraCollisionOpacity-lo,0):Math.min(1,Yi.cameraCollisionOpacity+lo)}const os=[...Lr],Ws=1/s.d6(Qi.canonical),Ln=Ur.anchor?Ur.anchor[0]:0,er=Ur.anchor?Ur.anchor[1]:0;s.br(os,os,[Ln*(Dn[0]-1)+Yi.evaluatedTranslation[0]*Ws,er*(Dn[1]-1)+Yi.evaluatedTranslation[1]*Ws,zr+Yi.evaluatedTranslation[2]]),s.cp(Dn,s.ev)||s.cR(os,os,Dn);const Fi=s.aB([],os,Ur.matrix),Kr=s.aB([],_e.expandedFarZProjMatrix,Fi),Yn=s.aB([],_e.expandedFarZProjMatrix,os),zn=s.aC([],[Ln,er,zr,1],Kr)[2];Ur.hidden=!1;let ws=nt;ct||(kt&&(ws*=Yi.cameraCollisionOpacity,ws*=Ly(os,_e,Yi.aabb,bt)),ws*=B_($t,zn)),ws!==0?An.push({nodeInfo:Yi,depth:zn,opacity:ws,wvpForNode:Kr,wvpForTile:Yn,nodeModelMatrix:Fi,tileModelMatrix:os}):Ur.hidden=!0}ct||An.sort((Yi,Ur)=>!kt||Yi.opacity===1&&Ur.opacity===1?Yi.depth<Ur.depth?-1:1:Yi.opacity===1?-1:Ur.opacity===1?1:Yi.depth>Ur.depth?-1:1);for(const Yi of An){const Ur=Yi.nodeInfo,zr=Ur.node;let Hr=s.aB([],Xe,Yi.tileModelMatrix);s.aB(Hr,$e,Hr);const Dn=s.bl([],Hr);s.ed(Dn,Dn),s.cR(Dn,Dn,gI),Hr=s.aB(Hr,Hr,zr.matrix);const os=K.renderPass==="light-beam",Ws=ae.paint.get("model-color-use-theme").constantOr("default")==="none",Ln=Wr&s.ez.HasMapboxMeshFeatures,er=Ln?0:Ur.evaluatedRMEA[0][2];for(let Fi=0;Fi<zr.meshes.length;++Fi){const Kr=zr.meshes[Fi],Yn=Fi===zr.lightMeshIndex;let zn=Yi.wvpForNode;if(Yn){if(!os&&!K.terrain&&K.shadowRenderer){K.currentLayer<K.firstLightBeamLayer&&(K.firstLightBeamLayer=K.currentLayer);continue}zn=Yi.wvpForTile}else if(os)continue;const ws={defines:[]},lo=[];if(!ct&&ge&&(ge.useNormalOffset=!!Kr.normalBuffer),z_(ws.defines,lo,Kr,K,Ws?null:ae.lut),Ln||ws.defines.push("DIFFUSE_SHADED"),Gi&&ws.defines.push("SHADOWS_SINGLE_CASCADE"),Ct&&(ct?Ct.numRenderedVerticesInShadowPass+=Kr.vertexArray.length:Ct.numRenderedVerticesInTransparentPass+=Kr.vertexArray.length),ct){Rp(Kr,Yi.nodeModelMatrix,K,ae);continue}let il=null;if(xe){const Hl=qe(Yi.nodeModelMatrix,K.transform);if(il=new Float32Array(Hl),_e.projection.name!=="globe"){const rs=Kr.aabb.min,as=Kr.aabb.max,[Nn,Ls]=xe.getOpacityForBounds(Hl,rs[0],rs[1],as[0],as[1]);ws.overrideFog=Nn>=Kt||Ls>=Kt}}const rl=Kr.material;let Ca;rl.occlusionTexture&&rl.occlusionTexture.offsetScale&&(Ca=rl.occlusionTexture.offsetScale,ws.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ra=K.getOrCreateProgram("model",ws);!ct&&ge&&ge.setupShadowsFromMatrix(Yi.tileModelMatrix,Ra,ge.useNormalOffset),K.uploadCommonUniforms(ve,Ra,null,il);const Zo=rl.pbrMetallicRoughness;Zo.metallicFactor=.9,Zo.roughnessFactor=.5;const El=C_(new Float32Array(zn),new Float32Array(Hr),new Float32Array(Dn),new Float32Array(zr.matrix),K,Yi.opacity,Zo.baseColorFactor,rl.emissiveFactor,Zo.metallicFactor,Zo.roughnessFactor,rl,er,ae,[0,0,0],Ca);!Yn&&(Ur.hasTranslucentParts||Yi.opacity<1)&&Ra.draw(K,ve.gl.TRIANGLES,Dt,Pi.disabled,Di.disabled,Bi.backCCW,El,ae.id,Kr.vertexBuffer,Kr.indexBuffer,Kr.segments,ae.paint,K.transform.zoom,void 0,lo),Ra.draw(K,ve.gl.TRIANGLES,Yn?Ye:Dt,Pi.disabled,Yn||Yi.opacity<1||Ur.hasTranslucentParts?Di.alphaBlended:Di.unblended,Bi.backCCW,El,ae.id,Kr.vertexBuffer,Kr.indexBuffer,Kr.segments,ae.paint,K.transform.zoom,void 0,lo)}}}}()}(m,n,u,p),void C();if(D.type!=="model")return;const F=D.getModels(),V=[],z=m.transform.getFreeCameraOptions().position,j=s.c4([],[z.x,z.y,z.z],m.transform.worldSize);s.et(j,j);const G=[],H=[];let ee=0;for(const K of F){const ie=u.paint.get("model-rotation").constantOr(null),ae=u.paint.get("model-scale").constantOr(null),ce=u.paint.get("model-translation").constantOr(null);K.computeModelMatrix(m,ie,ae,ce,!0,!0,!1);const ve=s.bA([]),_e=s.ec(K.position.lat,m.transform.zoom),xe=s.bq([],[1,1,1/_e]);s.br(ve,ve,j),V.push({zScaleMatrix:xe,negCameraPosMatrix:ve});for(const ge of K.nodes)N_(m.transform,ge,K.matrix,m.transform.expandedFarZProjMatrix,ee,G,H);ee++}if(G.sort((K,ie)=>ie.depth-K.depth),m.renderPass!=="shadow"){if(v===1)for(const K of H)Zh(K,m,u,V[K.modelIndex],Pi.disabled,m.colorModeForRenderPass());else{for(const K of H)Zh(K,m,u,V[K.modelIndex],Pi.disabled,Di.disabled);for(const K of H)Zh(K,m,u,V[K.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(const K of G)Zh(K,m,u,V[K.modelIndex],Pi.disabled,m.colorModeForRenderPass());C()}else{for(const K of H)Rp(K.mesh,K.nodeModelMatrix,m,u);for(const K of G)Rp(K.mesh,K.nodeModelMatrix,m,u);C()}}},Kh={line:function(m,n,u){if(m.hasElevatedBuckets=!1,m.hasNonElevatedBuckets=!1,m._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||m._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(n){const p=n.getVisibleCoordinates();for(const v of p){const x=n.getTile(v).getBucket(m);if(x&&(x.elevationType!=="none"?m.hasElevatedBuckets=!0:m.hasNonElevatedBuckets=!0,m.hasElevatedBuckets&&m.hasNonElevatedBuckets))break}}}else m.hasNonElevatedBuckets=!0},model:function(m,n,u){const p=n.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(u.modelManager&&u.modelManager.upload(u,p.type==="vector"?m.scope:""));if(p.type==="batched-model"||p.type!=="model")return;const v=p.getModels();for(const x of v)x.upload(u.context)},raster:function(m,n,u){const p=n.getSource();if(!(p instanceof uc&&p.loaded()))return;const v=m.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!v)return;const x=m.paint.get("raster-array-band")||p.getInitialBand(v);if(x==null)return;const w=n.getIds().map(I=>n.getTileByID(I));for(const I of w)I.updateNeeded(m.id,x)&&p.prepareTile(I,v,m.id,x)},"raster-particle":function(m,n,u){const p=n.getSource();if(!(p instanceof uc&&p.loaded()))return;const v=m.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!v)return;const x=m.paint.get("raster-particle-array-band")||p.getInitialBand(v);if(x==null)return;const w=n.getIds().map(I=>n.getTileByID(I));for(const I of w)I.updateNeeded(m.id,x)&&p.prepareTile(I,v,m.id,x)}},Yh={fill:$h},Uu={fill:function(m,n,u,p){if(!u.layout||u.layout.get("fill-elevation-reference")==="none")return;const v=m.context.gl,x=new Gt(v.LEQUAL,Gt.ReadOnly,m.depthRangeFor3D),w=new Pi({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),I=m.transform.getFreeCameraOptions().position,C=m.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const D of p){const F=n.getTile(D),V=F.getBucket(u);if(!V)continue;const z=V.elevatedStructures;if(!z||z.depthSegments.segments[0].primitiveLength===0)continue;const j=db(D.toUnwrapped(),I),G=m.translatePosMatrix(D.projMatrix,F,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor")),H=T_(G,j,0,1,0);C.draw(m,v.TRIANGLES,x,w,Di.disabled,Bi.disabled,H,u.id,z.vertexBuffer,z.indexBuffer,z.depthSegments,u.paint,m.transform.zoom)}}};class Fy{constructor(n,u,p,v,x,w){this.context=new Iy(n,u),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=s.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const I=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const D of I)this._debugParams.enabledLayers[D]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),x.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const D of I)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],D);this.occlusionParams=new V_(x),this.setup(),this.numSublayers=Ho.maxUnderzooming+Ho.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.eG,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new HE(this),this._wireframeDebugCache=new bb,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const C=new s.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,C,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=v,this.worldview=w}updateTerrain(n,u){const p=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ep(this,n));const v=this._terrain;this.transform.elevation=p?v:null,v.update(n,this.transform,u),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(n){const u=n.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,v]=u.getFovAdjustedRange(this.transform._fov);if(p>v)return void(this.transform.fogCullDistSq=null);const x=p+.78*(v-p);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new Ep(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,u){if(this.width=n*s.o.devicePixelRatio,this.height=u*s.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const n=this.context,u=new s.bd;u.emplaceBack(0,0),u.emplaceBack(s.al,0),u.emplaceBack(0,s.al),u.emplaceBack(s.al,s.al),this.tileExtentBuffer=n.createVertexBuffer(u,s.bf.members),this.tileExtentSegments=s.bg.simpleSegment(0,0,4,2);const p=new s.bd;p.emplaceBack(0,0),p.emplaceBack(s.al,0),p.emplaceBack(0,s.al),p.emplaceBack(s.al,s.al),this.debugBuffer=n.createVertexBuffer(p,s.bf.members),this.debugSegments=s.bg.simpleSegment(0,0,4,5);const v=new s.bd;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(v,s.bf.members),this.viewportSegments=s.bg.simpleSegment(0,0,4,2);const x=new s.b0;x.emplaceBack(0,0,0,0),x.emplaceBack(s.al,0,s.al,0),x.emplaceBack(0,s.al,0,s.al),x.emplaceBack(s.al,s.al,s.al,s.al),this.mercatorBoundsBuffer=n.createVertexBuffer(x,s.bi.members),this.mercatorBoundsSegments=s.bg.simpleSegment(0,0,4,2);const w=new s.b1;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(w);const I=new s.be;for(const D of[0,1,3,2,0])I.emplaceBack(D);this.debugIndexBuffer=n.createIndexBuffer(I),this.emptyTexture=new s.T(n,new s.q({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=s.bC();const C=this.context.gl;this.stencilClearMode=new Pi({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,Gt.disabled,this.stencilClearMode,Di.disabled,Bi.disabled,Nh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,u,p){if(!u||this.currentStencilSource===u.id||!n.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const C of p)if(this._tileClippingMaskIDs[C.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=u.id;const v=this.context,x=v.gl;this.nextStencilID+p.length>256&&this.clearStencil(),v.setColorMode(Di.disabled),v.setDepthMode(Gt.disabled);const w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of p){const C=u.getTile(I),D=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:V,tileBoundsSegments:z}=this.getTileBoundsBuffers(C);w.draw(this,x.TRIANGLES,Gt.disabled,new Pi({func:x.ALWAYS,mask:0},D,255,x.KEEP,x.KEEP,x.REPLACE),Di.disabled,Bi.disabled,Nh(I.projMatrix),"$clipping",F,V,z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,u=this.context.gl;return new Pi({func:u.NOTEQUAL,mask:255},n,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const u=this.context.gl;return new Pi({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(n){const u=this.context.gl,p=n.sort((w,I)=>I.overscaledZ-w.overscaledZ),v=p[p.length-1].overscaledZ,x=p[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const w={};for(let I=0;I<x;I++)w[I+v]=new Pi({func:u.GEQUAL,mask:255},I+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=x,[w,p]}return[{[v]:Pi.disabled},p]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new Di([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new s.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Di.unblended:Di.alphaBlended}colorModeForDrapableLayerRenderPass(n){const u=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Di([u.ONE,u.ONE_MINUS_SRC_ALPHA,u.CONSTANT_ALPHA,u.ONE_MINUS_SRC_ALPHA],new s.ao(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,u,p,v=!1){if(this.depthOcclusion)return new Gt(this.context.gl.GREATER,Gt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return Gt.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new Gt(p||this.context.gl.LEQUAL,u,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,u=Math.ceil(this.width),p=Math.ceil(this.height),v=this.context.bindFramebuffer.get(),x=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===u&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),u!==0&&p!==0&&(this.depthFBO=new R_(this.context,u,p,!1,"texture"),this.depthTexture=new s.T(this.context,{width:u,height:p,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(v),n.bindTexture(n.TEXTURE_2D,x),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,u,p,0,0,u,p,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((n,u)=>n+u/this._fpsHistory.length,0))}render(n,u){const p=s.o.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=u;const v=this.style._mergedLayers,x=!(!this.terrain||!this.terrain.enabled),w=()=>this.style._getOrder(x).filter(Ye=>{const De=v[Ye];return!(De.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[De.type]});let I=w(),C=!1,D=!1,F=null;for(const Ye of I){const De=v[Ye];De.type==="circle"?C=!0:De.type==="building"?F=De:De.type==="symbol"&&(De.hasOcclusionOpacityProperties?D=!0:C=!0)}let V=I.map(Ye=>v[Ye]);const z=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(s.o.now()),this.imageManager.beginFrame();let j=0,G=!1;for(const Ye in z){const De=z[Ye];De.used&&(De.prepare(this.context),De.getSource().usedInConflation&&++j)}let H=!1;for(const Ye of V)Ye.isHidden(this.transform.zoom)||(Ye.type==="clip"&&(H=!0),this.prepareLayer(Ye));const ee={},K={},ie={},ae={},ce={};for(const Ye in z){const De=z[Ye];ee[Ye]=De.getVisibleCoordinates(),K[Ye]=ee[Ye].slice().reverse(),ie[Ye]=De.getVisibleCoordinates(!0).reverse(),ae[Ye]=De.getShadowCasterCoordinates(),ce[Ye]=De.sortCoordinatesByDistance(ee[Ye])}const ve=Ye=>{const De=this.style.getLayerSourceCache(Ye);return De&&De.used?De.getSource():null};if(j||H||this._clippingActiveLastFrame){const Ye=[],De=[];let ct=0;for(const tt of V)this.isSourceForClippingOrConflation(tt,ve(tt))&&(Ye.push(tt),De.push(ct)),ct++;if(Ye&&(H||Ye.length>1)||this._clippingActiveLastFrame){H=!1;const tt=[];for(let bt=0;bt<Ye.length;bt++){const kt=Ye[bt],$t=De[bt],Ct=this.style.getLayerSourceCache(kt);if(!Ct||!Ct.used||!Ct.getSource().usedInConflation&&kt.type!=="clip"&&kt.type!=="building")continue;let It=s.eH,fi=s.bZ.None;const li=[];let di=!0;if(kt.type==="building")It=s.eJ;else if(kt.type==="clip"){It=$t;for(const oi of kt.layout.get("clip-layer-types"))fi|=oi==="model"?s.bZ.Model:oi==="symbol"?s.bZ.Symbol:s.bZ.FillExtrusion;for(const oi of kt.layout.get("clip-layer-scope"))li.push(oi);kt.isHidden(this.transform.zoom)?di=!1:H=!0}di&&tt.push({layer:kt.fqid,cache:Ct,order:It,clipMask:fi,clipScope:li})}this.replacementSource.setSources(tt),G=!0}}this._clippingActiveLastFrame=H,G||this.replacementSource.clear(),this.conflationActive=G,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ye=0;Ye<V.length;Ye++){const De=V[Ye],ct=De.cutoffRange();if(this.longestCutoffRange=Math.max(ct,this.longestCutoffRange),ct>0){const tt=ve(De);tt&&(this.minCutoffZoom=Math.max(tt.minzoom,this.minCutoffZoom)),De.minzoom&&(this.minCutoffZoom=Math.max(De.minzoom,this.minCutoffZoom))}De.is3D(x)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ye),this._lastOcclusionLayer=Ye)}const _e=this.style&&this.style.fog;_e?(this._fogVisible=_e.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=_e.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ie),this.opaquePassCutoff=0,I=w(),V=I.map(Ye=>v[Ye]));const xe=this._shadowRenderer;if(xe){xe.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ye in z)for(const De of ee[Ye]){let ct={min:0,max:0};this.terrain&&(ct=this.terrain.getMinMaxForTile(De)||ct),xe.addShadowReceiver(De.toUnwrapped(),ct.min,ct.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eI(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new of(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ge=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),pe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ge&&!this._snow&&(this._snow=new Ib(this)),!ge&&this._snow&&(this._snow.destroy(),delete this._snow),pe&&!this._rain&&(this._rain=new Sn(this)),!pe&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),F){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Kn);const Ye=this.style.getLayerSourceCache(F);this.buildingTileBorderManager.updateBorders(Ye,F)}if(!nr.has(this.context.gl))return;this.renderPass="offscreen";for(const Ye of V){const De=n.getLayerSourceCache(Ye);if(!Ye.hasOffscreenPass()||Ye.isHidden(this.transform.zoom))continue;const ct=De?K[De.id]:void 0;(Ye.type==="custom"||Ye.type==="raster"||Ye.type==="raster-particle"||Ye.isSky()||ct&&ct.length)&&this.renderLayer(this,De,Ye,ct)}this.depthRangeFor3D=[0,1-(V.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ae)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const we=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Je=(()=>{if(u.showOverdrawInspector)return s.ao.black;const Ye=this.style.fog;if(Ye&&this.transform.projection.supportsFog){const De=this.style.getLut(Ye.scope);if(!we){const ct=Ye.properties.get("color-use-theme")==="none",tt=Ye.properties.get("color").toNonPremultipliedRenderColor(ct?null:De).toArray01();return new s.ao(...tt)}if(we){const ct=Ye.properties.get("space-color-use-theme")==="none",tt=Ye.properties.get("space-color").toNonPremultipliedRenderColor(ct?null:De).toArray01();return new s.ao(...tt)}}return s.ao.transparent})();if(this.context.clear({color:Je,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&we&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const Ye=V[this.currentLayer],De=n.getLayerSourceCache(Ye);if(Ye.isSky())continue;const ct=De?(Ye.is3D(x)?ce:K)[De.id]:void 0;this._renderTileClippingMasks(Ye,De,ct),this.renderLayer(this,De,Ye,ct)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&we&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const Ye=V[this.currentLayer],De=n.getLayerSourceCache(Ye);Ye.isSky()&&this.renderLayer(this,De,Ye,De?K[De.id]:void 0)}function $e(Ye,De){let ct;return De&&(ct=(Ye.type==="symbol"?ie:Ye.is3D(x)?ce:K)[De.id]),ct}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const Ye=V[this.currentLayer];if(Ye.type==="raster"||Ye.type==="raster-particle"){const De=n.getLayerSourceCache(Ye);this.renderLayer(this,De,Ye,$e(Ye,De))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ot=0;xe&&(ot=xe.getShadowCastingLayerCount());let Xe=!1,nt=-1;for(let Ye=0;Ye<I.length;++Ye){const De=V[Ye];De.isHidden(this.transform.zoom)||De.is3D(x)&&(nt=Ye)}D&&nt===-1&&(C=!0);let Dt=!1;for(;this.currentLayer<I.length;){const Ye=V[this.currentLayer],De=n.getLayerSourceCache(Ye);if(Ye.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ye)){if(Ye.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Dt&&Ye.is3D(x)&&!x){const ct=this.currentLayer,tt=bt=>{for(this.currentLayer=0;this.currentLayer<V.length;this.currentLayer++){const kt=V[this.currentLayer];if(Yh[kt.type]){const $t=this.style.getLayerSourceCache(kt);Yh[kt.type](this,$t,kt,$e(kt,$t),bt)}}};tt("initialize"),tt("reset"),this.currentLayer=ct,Dt=!0}if(C&&!Xe&&this.terrain&&!this.transform.isOrthographic&&(Xe=!0,this.blitDepth()),D&&nt!==-1&&this.currentLayer===nt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ye,De,De?ee[De.id]:void 0),this.renderLayer(this,De,Ye,$e(Ye,De)),!this.terrain&&xe&&ot>0&&Ye.hasShadowPass()&&--ot==0){{this.clearStencil(),this.resetStencilClippingMasks();const ct=this.currentLayer;for(this.currentLayer=0;this.currentLayer<V.length;this.currentLayer++){const tt=V[this.currentLayer];if(Uu[tt.type]){const bt=this.style.getLayerSourceCache(tt);Uu[tt.type](this,bt,tt,$e(tt,bt))}}this.currentLayer=ct}if(xe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const ct=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ct;this.currentLayer++){const tt=V[this.currentLayer];if(!tt.hasLightBeamPass())continue;const bt=n.getLayerSourceCache(tt);this.renderLayer(this,bt,tt,bt?K[bt.id]:void 0)}this.currentLayer=ct,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ct=this.currentLayer;this.depthOcclusion=!0;for(const tt of this.layersWithOcclusionOpacity){this.currentLayer=tt;const bt=V[this.currentLayer],kt=n.getLayerSourceCache(bt),$t=kt?K[kt.id]:void 0;this.terrain||this._renderTileClippingMasks(bt,kt,kt?ee[kt.id]:void 0),this.renderLayer(this,kt,bt,$t)}this.depthOcclusion=!1,this.currentLayer=ct,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ye=null;V.forEach(De=>{const ct=n.getLayerSourceCache(De);ct&&!De.isHidden(this.transform.zoom)&&ct.getVisibleCoordinates().length&&(!Ye||Ye.getSource().maxzoom<ct.getSource().maxzoom)&&(Ye=ct)}),Ye&&this.options.showTileBoundaries&&F_(this,Ye,Ye.getVisibleCoordinates(),s.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&F_(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ye){const De=Ye.transform.padding;vc(Ye,Ye.transform.height-(De.top||0),3,Xo),vc(Ye,De.bottom||0,3,Nu),gn(Ye,De.left||0,3,mb),gn(Ye,Ye.transform.width-(De.right||0),3,Py);const ct=Ye.transform.centerPoint;(function(tt,bt,kt,$t){Hh(tt,bt-1,kt-10,2,20,$t),Hh(tt,bt-10,kt-1,20,2,$t)})(Ye,ct.x,Ye.transform.height-ct.y,My)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),G||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:u}=this.transform.projection,p=!u||!u.includes(n.type);if(Kh[n.type]&&(p||this.terrain&&n.type==="custom")){const v=this.style.getLayerSourceCache(n);Kh[n.type](n,v,this)}this.gpuTimingEnd()}renderLayer(n,u,p,v){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||v&&v.length)&&(this.id=p.id,this.gpuTimingStart(p),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(p.type)&&(!n.terrain||p.type!=="custom")||p.type==="clip"||Vu[p.type](n,u,p,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery,p=this.context.gl;let v=this.gpuTimers[n.id];v||(v=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:p.createQuery()}),v.calls++,p.beginQuery(u.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,u=this.context.gl,p=u.createQuery();this.deferredRenderGpuTimeQueries.push(p),u.beginQuery(n.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const u={};for(const p in n){const v=n[p],x=this.context.extTimerQuery,w=x.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(v.query),u[p]=w}return u}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.gl;let p=0;for(const v of n)p+=u.getQueryParameter(v,u.QUERY_RESULT)/1e6,u.deleteQuery(v);return p}translatePosMatrix(n,u,p,v,x){if(!p[0]&&!p[1])return n;const w=x?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(w){const D=Math.sin(w),F=Math.cos(w);p=[p[0]*F-p[1]*D,p[0]*D+p[1]*F]}const I=[x?p[0]:s.ay(u,p[0],this.transform.zoom),x?p[1]:s.ay(u,p[1],this.transform.zoom),0],C=new Float32Array(16);return s.br(C,n,I),C}saveTileTexture(n){if(n.context!==this.context)return;const u=n.size[0],p=this._tileTextures[u];p?p.push(n):this._tileTextures[u]=[n]}getTileTexture(n){const u=this._tileTextures[n];return u&&u.length>0?u.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,u,p){const v=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,x=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||x.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||v||u!==void 0&&!u||x.push("FOG","FOG_DITHERING"),v&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(n,u){this.cache=this.cache||{};const p=u&&u.defines||[],v=u&&u.config,x=this.currentGlobalDefines(n,u&&u.overrideFog,u&&u.overrideRtt).concat(p),w=w_.cacheKey(c_[n],n,x,v);return this.cache[w]||(this.cache[w]=new w_(this.context,n,c_[n],v,dI[n],x)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,u){if(this.style.enable3dLights()){const p=this.style.directionalLight,v=this.style.ambientLight;if(p&&v){const x=((w,I,C)=>{const D=w.properties.get("direction"),F=w.properties.get("color-use-theme")==="none",V=w.properties.get("color").toNonPremultipliedRenderColor(F?null:C.getLut(w.scope)).toArray01(),z=w.properties.get("intensity"),j=I.properties.get("color-use-theme")==="none",G=I.properties.get("color").toNonPremultipliedRenderColor(j?null:C.getLut(I.scope)).toArray01(),H=I.properties.get("intensity"),ee=[D.x,D.y,D.z],K=s.dK(G,H),ie=s.dK(V,z);return{u_lighting_ambient_color:K,u_lighting_directional_dir:ee,u_lighting_directional_color:ie,u_ground_radiance:b_(ee,ie,K)}})(p,v,this.style);u.setLightsUniformValues(n,x)}}}uploadCommonUniforms(n,u,p,v,x){if(this.uploadCommonLightUniforms(n,u),this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const I=w.getOpacity(this.transform.pitch),C=((D,F,V,z,j,G,H,ee,K,ie,ae,ce)=>{const ve=D.transform,_e=F.properties.get("color-use-theme")==="none",xe=F.properties.get("color").toNonPremultipliedRenderColor(_e?null:D.style.getLut(F.scope)).toArray01();xe[3]=z;const ge=D.frameCounter/1e3%1,[pe,we]=F.properties.get("vertical-range");return{u_fog_matrix:V?ve.calculateFogTileMatrix(V):ce||D.identityMat,u_fog_range:F.getFovAdjustedRange(ve._fov),u_fog_color:xe,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(pe,we),we],u_fog_temporal_offset:ge,u_frustum_tl:j,u_frustum_tr:G,u_frustum_br:H,u_frustum_bl:ee,u_globe_pos:K,u_globe_radius:ie,u_viewport:ae,u_globe_transition:s.aj(ve.zoom),u_is_globe:+(ve.projection.name==="globe")}})(this,w,p,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.o.devicePixelRatio,this.transform.height*s.o.devicePixelRatio],v);u.setFogUniformValues(n,C)}x&&u.setCutoffUniformValues(n,x.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,u=n.createTexture();return n.bindTexture(n.TEXTURE_2D,u),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,u=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const v of p)u[v.key]=n[v.key]||new fc(v,512,this.transform.tileZoom,this,void 0,this.worldview);return u}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,u){return!(!n.is3D(!(!this.terrain||!this.terrain.enabled))||n.type!=="clip"&&n.type!=="building"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building"&&n.sourceLayer!=="procedural_buildings")&&(!u||u.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let u=this._cachedTileFogOpacities[n.key];return u||(this._cachedTileFogOpacities[n.key]=u=this.style.fog.getOpacityForTile(n)),u[0]>=Kt||u[1]>=Kt}setupDepthForOcclusion(n,u,p){const v=this.context,x=v.gl,w=!!p;var I;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),v.activeTexture.set(x.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),v.activeTexture.set(x.TEXTURE0),w||u.setTerrainUniformValues(v,p)}}function U_(m,n){let u=!1,p=null;const v=()=>{p=null,u&&(m(),p=setTimeout(v,n),u=!1)};return()=>(u=!0,p||v(),p)}class zy{constructor(n){this._hashName=n&&encodeURIComponent(n),s.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=U_(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const u=j_(n);if(this._hashName){const p=this._hashName;let v=!1;const x=location.hash.slice(1).split("&").map(w=>{const I=w.split("=")[0];return I===p?(v=!0,`${I}=${u}`):w}).filter(w=>w);return v||x.push(`${p}=${u}`),`#${x.join("&")}`}return`#${u}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let u;return n.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(u=p)}),(u&&u[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(p=>isNaN(Number(p)))){const p=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(u[3]||0):n.getBearing();return n.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:p,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function j_(m,n){const u=m.getCenter(),p=Math.round(100*m.getZoom())/100,v=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),w=Math.round(u.lng*x)/x,I=Math.round(u.lat*x)/x,C=m.getBearing(),D=m.getPitch();let F=n?`/${w}/${I}/${p}`:`${p}/${I}/${w}`;return(C||D)&&(F+="/"+Math.round(10*C)/10),D&&(F+=`/${Math.round(D)}`),F}const ua={linearity:.3,easing:s.eK(0,0,.3,1)},ju=Object.assign({deceleration:2500,maxSpeed:1400},ua),uf=Object.assign({deceleration:20,maxSpeed:1400},ua),$_=Object.assign({deceleration:1e3,maxSpeed:360},ua),Ny=Object.assign({deceleration:1e3,maxSpeed:90},ua);class By{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.o.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,u=s.o.now();for(;n.length>0&&u-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const u={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)u.zoom+=x.zoomDelta||0,u.bearing+=x.bearingDelta||0,u.pitch+=x.pitchDelta||0,x.panDelta&&u.pan._add(x.panDelta),x.around&&(u.around=x.around),x.pinchAround&&(u.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){const x=hf(u.pan.mag(),p,Object.assign({},ju,n||{}));v.offset=u.pan.mult(x.amount/u.pan.mag()),v.center=this._map.transform.center,$l(v,x)}if(u.zoom){const x=hf(u.zoom,p,uf);v.zoom=this._map.transform.zoom+x.amount,$l(v,x)}if(u.bearing){const x=hf(u.bearing,p,$_);v.bearing=this._map.transform.bearing+s.aA(x.amount,-179,179),$l(v,x)}if(u.pitch){const x=hf(u.pitch,p,Ny);v.pitch=this._map.transform.pitch+x.amount,$l(v,x)}if(v.zoom||v.bearing){const x=u.pinchAround===void 0?u.around:u.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function $l(m,n){(!m.duration||m.duration<n.duration)&&(m.duration=n.duration,m.easing=n.easing)}function hf(m,n,u){const{maxSpeed:p,linearity:v,deceleration:x}=u,w=s.aA(m*v/(n/1e3),-p,p),I=Math.abs(w)/(x*v);return{easing:u.easing,duration:1e3*I,amount:w*(I/2)}}class Ds extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u,p,v={}){const x=ye(u.getCanvasContainer(),p),w=u.unproject(x);super(n,Object.assign({point:x,lngLat:w,originalEvent:p},v)),this._defaultPrevented=!1,this.target=u}}class df extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u,p){const v=n==="touchend"?p.changedTouches:p.touches,x=Se(u.getCanvasContainer(),v),w=x.map(C=>u.unproject(C)),I=x.reduce((C,D,F,V)=>C.add(D.div(V.length)),new s.P(0,0));super(n,{points:x,point:I,lngLats:w,lngLat:u.unproject(I),originalEvent:p}),this._defaultPrevented=!1}}class G_ extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u){super("wheel",{originalEvent:u}),this._defaultPrevented=!1}}class Vy{constructor(n,u){this._map=n,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new G_(this._map,n))}mousedown(n,u){return this._mousedownPos=u,this._firePreventable(new Ds(n.type,this._map,n))}mouseup(n){this._map.fire(new Ds(n.type,this._map,n))}preclick(n){const u=new MouseEvent("preclick",n);this._map.fire(new Ds(u.type,this._map,u))}click(n,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Ds(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Ds(n.type,this._map,n))}mouseover(n){this._map.fire(new Ds(n.type,this._map,n))}mouseout(n){this._map.fire(new Ds(n.type,this._map,n))}touchstart(n){return this._firePreventable(new df(n.type,this._map,n))}touchmove(n){this._map.fire(new df(n.type,this._map,n))}touchend(n){this._map.fire(new df(n.type,this._map,n))}touchcancel(n){this._map.fire(new df(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Uy{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Ds(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ds("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Ds(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Us{constructor(n,u){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,u){this.isEnabled()&&n.shiftKey&&n.button===0&&(Me(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(n,u){if(!this._active)return;const p=u,v=this._startPos,x=this._lastPos;if(!v||!x||x.equals(p)||!this._box&&p.dist(v)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=Q("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const w=Math.min(v.x,p.x),I=Math.max(v.x,p.x),C=Math.min(v.y,p.y),D=Math.max(v.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${C}px)`,this._box.style.width=I-w+"px",this._box.style.height=D-C+"px")})}mouseupWindow(n,u){if(!this._active)return;const p=this._startPos,v=u;if(p&&n.button===0){if(this.reset(),me(),p.x!==v.x||p.y!==v.y)return this._map.fire(new s.z("boxzoomend",{originalEvent:n})),{cameraAnimation:x=>x.fitScreenCoordinates(p,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),at(),delete this._startPos,delete this._lastPos}_fireEvent(n,u){return this._map.fire(new s.z(n,{originalEvent:u}))}}function Mp(m,n){const u={};for(let p=0;p<m.length;p++)u[m[p].identifier]=n[p];return u}class jy{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,u,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),p.length===this.numTouches&&(this.centroid=function(v){const x=new s.P(0,0);for(const w of v)x._add(w);return x.div(v.length)}(u),this.touches=Mp(p,u)))}touchmove(n,u,p){if(this.aborted||!this.centroid)return;const v=Mp(p,u);for(const x in this.touches){const w=v[x];(!w||w.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(n,u,p){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class kp{constructor(n){this.singleTap=new jy(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,u,p){this.singleTap.touchstart(n,u,p)}touchmove(n,u,p){this.singleTap.touchmove(n,u,p)}touchend(n,u,p){const v=this.singleTap.touchend(n,u,p);if(v){const x=n.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(v)<30;if(x&&w||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Jh{constructor(){this._zoomIn=new kp({numTouches:1,numTaps:2}),this._zoomOut=new kp({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,u,p){this._zoomIn.touchstart(n,u,p),this._zoomOut.touchstart(n,u,p)}touchmove(n,u,p){this._zoomIn.touchmove(n,u,p),this._zoomOut.touchmove(n,u,p)}touchend(n,u,p){const v=this._zoomIn.touchend(n,u,p),x=this._zoomOut.touchend(n,u,p);return v?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(v)},{originalEvent:n})}):x?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(x)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const $y={0:1,2:2},H_={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Dp{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,u){return!1}_move(n,u){return{}}mousedown(n,u){if(this._lastPoint)return;const p=ke(n);this._correctButton(n,p)&&(this._lastPoint=u,this._eventButton=p)}mousemoveWindow(n,u){const p=this._lastPoint;if(p){if(n.preventDefault(),this._eventButton!=null&&function(v,x){const w=$y[x];return v.buttons===void 0||(v.buttons&w)!==w}(n,this._eventButton))this.reset();else if(this._moved||!(u.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(p,u)}}mouseupWindow(n){this._lastPoint&&ke(n)===this._eventButton&&(this._moved&&me(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ff extends Dp{mousedown(n,u){super.mousedown(n,u),this._lastPoint&&(this._active=!0)}_correctButton(n,u){return u===0&&!n.ctrlKey}_move(n,u){return{around:u,panDelta:u.sub(n)}}}class q_ extends Dp{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?H_[n.pitchRotateKey]:void 0}_correctButton(n,u){return this._pitchRotateKey?u===0&&n[this._pitchRotateKey]:u===0&&n.ctrlKey||u===2}_move(n,u){const p=.8*(u.x-n.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class W_ extends Dp{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?H_[n.pitchRotateKey]:void 0}_correctButton(n,u){return this._pitchRotateKey?u===0&&n[this._pitchRotateKey]:u===0&&n.ctrlKey||u===2}_move(n,u){const p=-.5*(u.y-n.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class Gy{constructor(n,u){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),s.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(n,u,p){return this._calculateTransform(n,u,p)}touchmove(n,u,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!s.eL())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,u,p)}}touchend(n,u,p){this._calculateTransform(n,u,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,u,p){p.length>0&&(this._active=!0);const v=Mp(p,u),x=new s.P(0,0),w=new s.P(0,0);let I=0;for(const D in v){const F=v[D],V=this._touches[D];V&&(x._add(F),w._add(F.sub(V)),I++,v[D]=F)}if(this._touches=v,I<this._minTouches||!w.mag())return;const C=w.div(I);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(I),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Q("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class pf{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,u,p){return{}}touchstart(n,u,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([u[0],u[1]]))}touchmove(n,u,p){const v=this._firstTwoTouches;if(!v)return;n.preventDefault();const[x,w]=v,I=mf(p,u,x),C=mf(p,u,w);if(!I||!C)return;const D=this._aroundCenter?null:I.add(C).div(2);return this._move([I,C],D,n)}touchend(n,u,p){if(!this._firstTwoTouches)return;const[v,x]=this._firstTwoTouches,w=mf(p,u,v),I=mf(p,u,x);w&&I||(this._active&&me(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function mf(m,n,u){for(let p=0;p<m.length;p++)if(m[p].identifier===u)return n[p]}function X_(m,n){return Math.log2(m/n)}class Sb extends pf{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,u){const p=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(X_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:X_(this._distance,p),pinchAround:u}}}function Hy(m,n){return 180*m.angleWith(n)/Math.PI}class Ab extends pf{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,u){const p=this._vector;if(this._vector=n[0].sub(n[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Hy(this._vector,p),pinchAround:u}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const u=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const v=Hy(n,p);return Math.abs(v)<u}}function Z_(m){return Math.abs(m.y)>Math.abs(m.x)}class Cb extends pf{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Z_(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,u,p){const v=this._lastPoints;if(!v)return;const x=n[0].sub(v[0]),w=n[1].sub(v[1]);return this._map._cooperativeGestures&&!s.eL()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(x,w,p.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(x.y+w.y)/2*-.5})}gestureBeginsVertically(n,u,p){if(this._valid!==void 0)return this._valid;const v=n.mag()>=2,x=u.mag()>=2;if(!v&&!x)return;if(!v||!x)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const w=n.y>0==u.y>0;return Z_(n)&&Z_(u)&&w}}const Rb={panStep:100,bearingStep:15,pitchStep:10};class Pb{constructor(){const n=Rb;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let u=0,p=0,v=0,x=0,w=0;switch(n.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:n.shiftKey?p=-1:(n.preventDefault(),x=-1);break;case 39:n.shiftKey?p=1:(n.preventDefault(),x=1);break;case 38:n.shiftKey?v=1:(n.preventDefault(),w=-1);break;case 40:n.shiftKey?v=-1:(n.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(p=0,v=0),{cameraAnimation:I=>{const C=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Mb,zoom:u?Math.round(C)+u*(n.shiftKey?2:1):C,bearing:I.getBearing()+p*this._bearingStep,pitch:I.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-w*this._panStep],center:I.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Mb(m){return m*(2-m)}const qy=4.000244140625,kb=1/450;class Db{constructor(n,u){this._map=n,this._el=n.getCanvasContainer(),this._handler=u,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=kb,s.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||s.eL()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const p=s.o.now(),v=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,u!==0&&u%qy==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),n.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=n,this._delta-=u,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=ye(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>qy?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&F!==0&&(F=1/F);const V=u(),z=Math.pow(2,V),j=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(j*F))),this._type==="wheel"&&(this._startZoom=V,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:u(),v=this._startZoom,x=this._easing;let w,I=!1;if(this._type==="wheel"&&v&&x){const D=Math.min((s.o.now()-this._lastWheelEventTime)/200,1),F=x(D);w=s.ak(v,p,F),D<1?this._frameId||(this._frameId=!0):I=!0}else w=p,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let C=w-u();return C*this._lastDelta<0&&(C=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:C,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let u=s.eM;if(this._prevEase){const p=this._prevEase,v=(s.o.now()-p.start)/p.duration,x=p.easing(v+.01)-p.easing(v),w=.27/Math.sqrt(x*x+1e-4)*.01,I=Math.sqrt(.0729-w*w);u=s.eK(w,I,.25,1)}return this._prevEase={start:s.o.now(),duration:n,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Q("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Lb{constructor(n,u){this._clickZoom=n,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ob{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,u){return n.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(n.shiftKey?-1:1),around:p.unproject(u)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vI{constructor(){this._tap=new kp({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,u,p){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=u[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(n,u,p))}touchmove(n,u,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const v=u[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,n.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(n,u,p)}touchend(n,u,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(n,u,p)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xI{constructor(n,u,p){this._el=n,this._mousePan=u,this._touchPan=p}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class bI{constructor(n,u,p){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=u,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class jn{constructor(n,u,p,v){this._el=n,this._touchZoom=u,this._touchRotate=p,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Lp=m=>m.zoom||m.drag||m.pitch||m.rotate;class wI extends s.z{}class TI{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,u){const p=s.av([],u,n);this.radius=s.ag(p[2]<0?s.eO([],p,this.constants):[p[0],p[1],0])}projectRay(n){s.eO(n,n,this.constants),s.aw(n,n),s.eP(n,n,this.constants);const u=s.c4([],n,this.radius);if(u[2]>0){const p=s.c4([],[0,0,1],s.bJ(u,[0,0,1])),v=s.c4([],s.aw([],[u[0],u[1],0]),this.radius),x=s.d7([],u,s.c4([],s.av([],s.d7([],v,p),u),2));u[0]=x[0],u[1]=x[1]}return u}}function K_(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Op{constructor(n,u){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new By(n),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new TI,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),s.aY(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,x,w]of this._listeners){const I=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(x,I,w)}}destroy(){for(const[n,u,p]of this._listeners){const v=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(u,v,p)}}_addDefaultHandlers(n){const u=this._map,p=u.getCanvasContainer();this._add("mapEvent",new Vy(u,n));const v=u.boxZoom=new Us(u,n);this._add("boxZoom",v);const x=new Jh,w=new Ob;u.doubleClickZoom=new Lb(w,x),this._add("tapZoom",x),this._add("clickZoom",w);const I=new vI;this._add("tapDragZoom",I);const C=u.touchPitch=new Cb(u);this._add("touchPitch",C);const D=new q_(n),F=new W_(n);u.dragRotate=new bI(n,D,F),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const V=new ff(n),z=new Gy(u,n);u.dragPan=new xI(p,V,z),this._add("mousePan",V),this._add("touchPan",z,["touchZoom","touchRotate"]);const j=new Ab,G=new Sb;u.touchZoomRotate=new jn(p,G,j,I),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Uy(u));const H=u.scrollZoom=new Db(u,this);this._add("scrollZoom",H,["mousePan"]);const ee=u.keyboard=new Pb;this._add("keyboard",ee);for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[K]&&u[K].enable(n[K])}_add(n,u,p){this._handlers.push({handlerName:n,handler:u,allowed:p}),this._handlersById[n]=u}stop(n){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Lp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,u,p){for(const v in n)if(v!==p&&(!u||u.indexOf(v)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const u=[];for(const p of n)this._el.contains(p.target)&&u.push(p);return u}handleEvent(n,u){this._updatingCamera=!0;const p=n.type==="renderFrame",v=p?void 0:n,x={needsRenderFrame:!1},w={},I={},C=n.touches?this._getMapTouches(n.touches):void 0,D=C?Se(this._el,C):p?void 0:ye(this._el,n);for(const{handlerName:z,handler:j,allowed:G}of this._handlers){if(!j.isEnabled())continue;let H;this._blockedByActive(I,G,z)?j.reset():j[u||n.type]&&(H=j[u||n.type](n,D,C),this.mergeHandlerResult(x,w,H,z,v),H&&H.needsRenderFrame&&this._triggerRenderFrame()),(H||j.isActive())&&(I[z]=j)}const F={};for(const z in this._previousActiveHandlers)I[z]||(F[z]=v);this._previousActiveHandlers=I,(Object.keys(F).length||K_(x))&&(this._changes.push([x,w,F]),this._triggerRenderFrame()),(Object.keys(I).length||K_(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=x;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(n,u,p,v,x){if(!p)return;Object.assign(n,p);const w={handlerName:v,originalEvent:p.originalEvent||x};p.zoomDelta!==void 0&&(u.zoom=w),p.panDelta!==void 0&&(u.drag=w),p.pitchDelta!==void 0&&(u.pitch=w),p.bearingDelta!==void 0&&(u.rotate=w)}_applyChanges(){const n={},u={},p={};for(const[v,x,w]of this._changes)v.panDelta&&(n.panDelta=(n.panDelta||new s.P(0,0))._add(v.panDelta)),v.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(n.around=v.around),v.aroundCoord!==void 0&&(n.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(n.pinchAround=v.pinchAround),v.noInertia&&(n.noInertia=v.noInertia),Object.assign(u,x),Object.assign(p,w);this._updateMapTransform(n,u,p),this._changes=[]}_updateMapTransform(n,u,p){const v=this._map,x=v.transform,w=ie=>[ie.x,ie.y,ie.z];if((ie=>{const ae=this._eventsInProgress.drag;return ae&&!this._handlersById[ae.handlerName].isActive()})()&&!K_(n)){const ie=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),ie!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&v._stop(!0),!K_(n))return void this._fireEvents(u,p,!0);let{panDelta:I,zoomDelta:C,bearingDelta:D,pitchDelta:F,around:V,aroundCoord:z,pinchAround:j}=n;x._isCameraConstrained&&(C>0&&(C=0),x._isCameraConstrained=!1),j!==void 0&&(V=j),(C||(ie=>u[ie]&&!this._eventsInProgress[ie])("drag"))&&V&&(this._dragOrigin=w(x.pointCoordinate3D(V)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),V=V||v.transform.centerPoint,D&&(x.bearing+=D),F&&(x.pitch+=F),x._updateCameraState();const G=[0,0,0];if(I)if(x.projection.name==="mercator"){const ie=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(V).dir),ae=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(V.sub(I)).dir);G[0]=ae[0]-ie[0],G[1]=ae[1]-ie[1]}else{const ie=x.pointCoordinate(V);if(x.projection.name==="globe"){I=I.rotate(-x.angle);const ae=x._pixelsPerMercatorPixel/x.worldSize;G[0]=-I.x*s.eN(s.a$(ie.y))*ae,G[1]=-I.y*s.eN(x.center.lat)*ae}else{const ae=x.pointCoordinate(V.sub(I));ie&&ae&&(G[0]=ae.x-ie.x,G[1]=ae.y-ie.y)}}const H=x.zoom,ee=[0,0,0];if(C){const ie=w(z||x.pointCoordinate3D(V)),ae={dir:s.aw([],s.av([],ie,x._camera.position))};if(ae.dir[2]<0){const ce=x.zoomDeltaToMovement(ie,C);s.c4(ee,ae.dir,ce)}}const K=s.d7(G,G,ee);x._translateCameraConstrained(K),C&&Math.abs(x.zoom-H)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(u,p,!0)}_fireEvents(n,u,p){const v=Lp(this._eventsInProgress),x=Lp(n),w={};for(const F in n){const{originalEvent:V}=n[F];this._eventsInProgress[F]||(w[`${F}start`]=V),this._eventsInProgress[F]=n[F]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(const F in w)this._fireEvent(F,w[F]);x&&this._fireEvent("move",x.originalEvent);for(const F in n){const{originalEvent:V}=n[F];this._fireEvent(F,V)}const I={};let C;for(const F in this._eventsInProgress){const{handlerName:V,originalEvent:z}=this._eventsInProgress[F];this._handlersById[V].isActive()||(delete this._eventsInProgress[F],C=u[V]||z,I[`${F}end`]=C)}for(const F in I)this._fireEvent(F,I[F]);const D=Lp(this._eventsInProgress);if(p&&(v||x)&&!D){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;F?(V(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:C})):(this._map.fire(new s.z("moveend",{originalEvent:C})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,u){this._map.fire(new s.z(n,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new wI("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Wy="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Xy extends s.E{constructor(n,u){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,s.aY(["_renderFrameCallback"],this)}getCenter(){return new s.aR(this.transform.center.lng,this.transform.center.lat)}setCenter(n,u){return this.jumpTo({center:n},u)}panBy(n,u,p){return n=s.P.convert(n).mult(-1),this.panTo(this.transform.center,Object.assign({offset:n},u),p)}panTo(n,u,p){return this.easeTo(Object.assign({center:n},u),p)}getZoom(){return this.transform.zoom}setZoom(n,u){return this.jumpTo({zoom:n},u),this}zoomTo(n,u,p){return this.easeTo(Object.assign({zoom:n},u),p)}zoomIn(n,u){return this.zoomTo(this.getZoom()+1,n,u),this}zoomOut(n,u){return this.zoomTo(this.getZoom()-1,n,u),this}getBearing(){return this.transform.bearing}setBearing(n,u){return this.jumpTo({bearing:n},u),this}getPadding(){return this.transform.padding}setPadding(n,u){return this.jumpTo({padding:n},u),this}rotateTo(n,u,p){return this.easeTo(Object.assign({bearing:n},u),p)}resetNorth(n,u){return this.rotateTo(0,Object.assign({duration:1e3},n),u),this}resetNorthPitch(n,u){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},n),u),this}snapToNorth(n,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,u):this}getPitch(){return this.transform.pitch}setPitch(n,u){return this.jumpTo({pitch:n},u),this}cameraForBounds(n,u){n=s.aI.convert(n);const p=u&&u.bearing||0,v=u&&u.pitch||0,x=n.getNorthWest(),w=n.getSouthEast();return this._cameraForBounds(this.transform,x,w,p,v,u)}_extendPadding(n){const u={top:0,right:0,bottom:0,left:0};return n==null?Object.assign({},u,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:Object.assign({},u,n)}_extendCameraOptions(n){return(n=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,u){const p=u.max[0]-u.min[0],v=u.max[1]-u.min[1];return p/v>n.aspect?p/(2*Math.tan(.5*n.fovX)*n.aspect):v/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,u,p,v,x,w){const I=n.clone(),C=this._extendCameraOptions(w);I.bearing=v,I.pitch=x;const D=s.aR.convert(u),F=s.aR.convert(p),V=.5*(D.lat+F.lat),z=.5*(D.lng+F.lng),j=s.eQ(V,z),G=s.aw([],j),H=s.aw([],s.bI([],G,[0,1,0])),ee=s.bI([],H,G),K=[H[0],H[1],H[2],0,ee[0],ee[1],ee[2],0,G[0],G[1],G[2],0,0,0,0,1],ie=[j,s.eQ(D.lat,D.lng),s.eQ(F.lat,D.lng),s.eQ(F.lat,F.lng),s.eQ(D.lat,F.lng),s.eQ(V,D.lng),s.eQ(V,F.lng),s.eQ(D.lat,z),s.eQ(F.lat,z)];let ae=s.d8.fromPoints(ie.map(tt=>[s.bJ(H,tt),s.bJ(ee,tt),s.bJ(G,tt)]));const ce=s.af([],ae.center,K);s.eR(ce)===0&&s.eS(ce,0,0,1),s.aw(ce,ce),s.c4(ce,ce,s.aD),I.center=s.eT(ce);const ve=I.getWorldToCameraMatrix(),_e=s.bl(new Float64Array(16),ve);ae=s.d8.applyTransform(ae,s.aB([],ve,K));const xe=this._extendAABB(ae,I,C,v);if(!xe)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ae=xe,s.af(ce,ce,ve);const ge=.5*(ae.max[2]-ae.min[2]),pe=this._minimumAABBFrustumDistance(I,ae),we=s.c4([],[0,0,1],ge),Je=s.d7(we,ce,we),$e=pe+(I.pitch===0?0:s.bG(ce,Je)),ot=I.globeCenterInViewSpace,Xe=s.av([],ce,[ot[0],ot[1],ot[2]]);s.aw(Xe,Xe),s.c4(Xe,Xe,$e);const nt=s.d7([],ce,Xe);s.af(nt,nt,_e);const Dt=s.eD/s.aD,Ye=s.ag(nt),De=s.ce(Math.max(Ye*Dt-s.eD,Number.EPSILON),0),ct=Math.min(I.zoomFromMercatorZAdjusted(De),C.maxZoom);return ct>.5*(s.cZ+s.cK)?(I.setProjection({name:"mercator"}),I.zoom=ct,this._cameraForBounds(I,u,p,v,x,w)):{center:I.center,zoom:ct,bearing:v,pitch:x}}_extendAABB(n,u,p,v){const x=.5*((p.padding.left||0)+(p.padding.right||0)),w=.5*((p.padding.top||0)+(p.padding.bottom||0)),I=w,C=x,D=x,F=w,V=u.width-(C+D),z=u.height-(I+F),j=s.av([],n.max,n.min),G=Math.min(V/j[0],z/j[1]),H=Math.min(u.scaleZoom(u.scale*G),p.maxZoom);if(isNaN(H))return null;const ee=u.scale/u.zoomScale(H),K=new s.d8([n.min[0]-C*ee,n.min[1]-F*ee,n.min[2]],[n.max[0]+D*ee,n.max[1]+I*ee,n.max[2]]),ie=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new s.P(p.offset.x,p.offset.y):s.P.convert(p.offset)).rotate(-s.an(v));return K.center[0]-=ie.x*ee,K.center[1]+=ie.y*ee,K}queryTerrainElevation(n,u){const p=this.transform.elevation;return p?(u=Object.assign({},{exaggerated:!0},u),p.getAtPoint(s.ae.fromLngLat(n),null,u.exaggerated)):null}_cameraForBounds(n,u,p,v,x,w){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,u,p,v,x,w);const I=n.clone(),C=this._extendCameraOptions(w);I.bearing=v,I.pitch=x;const D=s.aR.convert(u),F=s.aR.convert(p),V=new s.aR(D.lng,F.lat),z=new s.aR(F.lng,D.lat),j=I.project(D),G=I.project(F),H=this.queryTerrainElevation(D),ee=this.queryTerrainElevation(F),K=this.queryTerrainElevation(V),ie=this.queryTerrainElevation(z),ae=[[j.x,j.y,Math.min(H||0,ee||0,K||0,ie||0)],[G.x,G.y,Math.max(H||0,ee||0,K||0,ie||0)]];let ce=s.d8.fromPoints(ae);const ve=I.getWorldToCameraMatrix(),_e=s.bl(new Float64Array(16),ve);ce=s.d8.applyTransform(ce,ve);const xe=this._extendAABB(ce,I,C,v);if(!xe)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=xe;const ge=.5*s.av([],ce.max,ce.min)[2],pe=this._minimumAABBFrustumDistance(I,ce),we=[0,0,1,0];s.aC(we,we,ve),s.eU(we,we);const Je=s.c4([],we,pe+ge),$e=s.d7([],ce.center,Je);s.af(ce.center,ce.center,_e),s.af($e,$e,_e);const ot=I.unproject(new s.P(ce.center[0],ce.center[1])),Xe=s.eV(I.projection,ot),nt=Math.pow(2,Xe),Dt=Math.min(I._zoomFromMercatorZ($e[2]*I.pixelsPerMeter*nt/I.worldSize),C.maxZoom);return I.mercatorFromTransition&&Dt<.5*(s.cZ+s.cK)?(I.setProjection({name:"globe"}),I.zoom=Dt,this._cameraForBounds(I,u,p,v,x,w)):{center:ot,zoom:Dt,bearing:v,pitch:x}}fitBounds(n,u,p){const v=this.cameraForBounds(n,u);return this._fitInternal(v,u,p)}fitScreenCoordinates(n,u,p,v,x){const w=s.P.convert(n),I=s.P.convert(u),C=new s.P(Math.min(w.x,I.x),Math.min(w.y,I.y)),D=new s.P(Math.max(w.x,I.x),Math.max(w.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,I))return this;const F=this.transform.pointLocation3D(C),V=this.transform.pointLocation3D(D),z=this.transform.pointLocation3D(new s.P(C.x,D.y)),j=this.transform.pointLocation3D(new s.P(D.x,C.y)),G=[Math.min(F.lng,V.lng,z.lng,j.lng),Math.min(F.lat,V.lat,z.lat,j.lat)],H=[Math.max(F.lng,V.lng,z.lng,j.lng),Math.max(F.lat,V.lat,z.lat,j.lat)],ee=v&&v.pitch?v.pitch:this.getPitch(),K=this._cameraForBounds(this.transform,G,H,p,ee,v);return this._fitInternal(K,v,x)}_fitInternal(n,u,p){return n?(u=Object.assign(n,u)).linear?this.easeTo(u,p):this.flyTo(u,p):this}jumpTo(n,u){this.stop();const p=n.preloadOnly?this.transform.clone():this.transform;let v=!1,x=!1,w=!1;"zoom"in n&&p.zoom!==+n.zoom&&(v=!0,p.zoom=+n.zoom),n.center!==void 0&&(p.center=s.aR.convert(n.center)),"bearing"in n&&p.bearing!==+n.bearing&&(x=!0,p.bearing=+n.bearing),"pitch"in n&&p.pitch!==+n.pitch&&(w=!0,p.pitch=+n.pitch);const I=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!p.isPaddingEqual(I))if(n.retainPadding===!1){const C=p.clone();C.padding=I,p.setLocationAtPoint(p.center,C.centerPoint)}else p.padding=I;return n.preloadOnly?(this._preloadTiles(p),this):(this.fire(new s.z("movestart",u)).fire(new s.z("move",u)),v&&this.fire(new s.z("zoomstart",u)).fire(new s.z("zoom",u)).fire(new s.z("zoomend",u)),x&&this.fire(new s.z("rotatestart",u)).fire(new s.z("rotate",u)).fire(new s.z("rotateend",u)),w&&this.fire(new s.z("pitchstart",u)).fire(new s.z("pitch",u)).fire(new s.z("pitchend",u)),this.fire(new s.z("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(Wy),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,u){const p=this.transform;if(!p.projection.supportsFreeCamera)return s.w(Wy),this;this.stop();const v=p.zoom,x=p.pitch,w=p.bearing;p.setFreeCameraOptions(n);const I=v!==p.zoom,C=x!==p.pitch,D=w!==p.bearing;return this.fire(new s.z("movestart",u)).fire(new s.z("move",u)),I&&this.fire(new s.z("zoomstart",u)).fire(new s.z("zoom",u)).fire(new s.z("zoomend",u)),D&&this.fire(new s.z("rotatestart",u)).fire(new s.z("rotate",u)).fire(new s.z("rotateend",u)),C&&this.fire(new s.z("pitchstart",u)).fire(new s.z("pitch",u)).fire(new s.z("pitchend",u)),this.fire(new s.z("moveend",u)),this}easeTo(n,u){this._stop(!1,n.easeId),((n=Object.assign({offset:[0,0],duration:500,easing:s.eM},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const p=this.transform,v=this.getZoom(),x=this.getBearing(),w=this.getPitch(),I=this.getPadding(),C="zoom"in n?+n.zoom:v,D="bearing"in n?this._normalizeBearing(n.bearing,x):x,F="pitch"in n?+n.pitch:w,V=this._extendPadding(n.padding),z=s.P.convert(n.offset);let j,G,H;if(p.projection.name==="globe"){const we=s.ae.fromLngLat(p.center),Je=z.rotate(-p.angle);we.x+=Je.x/p.worldSize,we.y+=Je.y/p.worldSize;const $e=we.toLngLat(),ot=s.aR.convert(n.center||$e);this._normalizeCenter(ot),j=p.centerPoint.add(Je),G=new s.P(we.x,we.y).mult(p.worldSize),H=new s.P(s.aF(ot.lng),s.aJ(ot.lat)).mult(p.worldSize).sub(G)}else{j=p.centerPoint.add(z);const we=p.pointLocation(j),Je=s.aR.convert(n.center||we);this._normalizeCenter(Je),G=p.project(we),H=p.project(Je).sub(G)}const ee=p.zoomScale(C-v);let K,ie;n.around&&(K=s.aR.convert(n.around),ie=p.locationPoint(K));const ae=this._zooming||C!==v,ce=this._rotating||x!==D,ve=this._pitching||F!==w,_e=!p.isPaddingEqual(V),xe=n.retainPadding===!1?p.clone():p,ge=we=>Je=>{if(ae&&(we.zoom=s.ak(v,C,Je)),ce&&(we.bearing=s.ak(x,D,Je)),ve&&(we.pitch=s.ak(w,F,Je)),_e&&(xe.interpolatePadding(I,V,Je),j=xe.centerPoint.add(z)),K)we.setLocationAtPoint(K,ie);else{const $e=we.zoomScale(we.zoom-v),ot=C>v?Math.min(2,ee):Math.max(.5,ee),Xe=Math.pow(ot,1-Je),nt=we.unproject(G.add(H.mult(Je*Xe)).mult($e));we.setLocationAtPoint(we.renderWorldCopies?nt.wrap():nt,j)}return n.preloadOnly||this._fireMoveEvents(u),we};if(n.preloadOnly){const we=this._emulate(ge,n.duration,p);return this._preloadTiles(we),this}const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ae,this._rotating=ce,this._pitching=ve,this._padding=_e,this._easeId=n.easeId,this._prepareEase(u,n.noMoveStart,pe),this._ease(ge(p),we=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(u,we)},n),this}_prepareEase(n,u,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),u||p.moving||this.fire(new s.z("movestart",n)),this._zooming&&!p.zooming&&this.fire(new s.z("zoomstart",n)),this._rotating&&!p.rotating&&this.fire(new s.z("rotatestart",n)),this._pitching&&!p.pitching&&this.fire(new s.z("pitchstart",n))}_fireMoveEvents(n){this.fire(new s.z("move",n)),this._zooming&&this.fire(new s.z("zoom",n)),this._rotating&&this.fire(new s.z("rotate",n)),this._pitching&&this.fire(new s.z("pitch",n))}_afterEase(n,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new s.z("zoomend",n)),v&&this.fire(new s.z("rotateend",n)),x&&this.fire(new s.z("pitchend",n)),this.fire(new s.z("moveend",n))}flyTo(n,u){if(this._prefersReducedMotion(n)){const tt=s.aH(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(tt,u)}this.stop(),n=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:s.eM},n);const p=this.transform,v=this.getZoom(),x=this.getBearing(),w=this.getPitch(),I=this.getPadding(),C="zoom"in n?s.aA(+n.zoom,p.minZoom,p.maxZoom):v,D="bearing"in n?this._normalizeBearing(n.bearing,x):x,F="pitch"in n?+n.pitch:w,V=this._extendPadding(n.padding),z=p.zoomScale(C-v),j=s.P.convert(n.offset);let G=p.centerPoint.add(j);const H=p.pointLocation(G),ee=s.aR.convert(n.center||H);this._normalizeCenter(ee);const K=p.project(H),ie=p.project(ee).sub(K);let ae=n.curve;const ce=Math.max(p.width,p.height),ve=ce/z,_e=ie.mag();if("minZoom"in n){const tt=s.aA(Math.min(n.minZoom,v,C),p.minZoom,p.maxZoom),bt=ce/p.zoomScale(tt-v);ae=Math.sqrt(bt/_e*2)}const xe=ae*ae;function ge(tt){const bt=(ve*ve-ce*ce+(tt?-1:1)*xe*xe*_e*_e)/(2*(tt?ve:ce)*xe*_e);return Math.log(Math.sqrt(bt*bt+1)-bt)}function pe(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function we(tt){return(Math.exp(tt)+Math.exp(-tt))/2}const Je=ge(0);let $e=function(tt){return we(Je)/we(Je+ae*tt)},ot=function(tt){return ce*((we(Je)*(pe(bt=Je+ae*tt)/we(bt))-pe(Je))/xe)/_e;var bt},Xe=(ge(1)-Je)/ae;if(Math.abs(_e)<1e-6||!isFinite(Xe)){if(Math.abs(ce-ve)<1e-6)return this.easeTo(n,u);const tt=ve<ce?-1:1;Xe=Math.abs(Math.log(ve/ce))/ae,ot=function(){return 0},$e=function(bt){return Math.exp(tt*ae*bt)}}n.duration="duration"in n?+n.duration:1e3*Xe/("screenSpeed"in n?+n.screenSpeed/ae:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const nt=x!==D,Dt=F!==w,Ye=!p.isPaddingEqual(V),De=n.retainPadding===!1?p.clone():p,ct=tt=>bt=>{const kt=bt*Xe,$t=1/$e(kt);tt.zoom=bt===1?C:v+tt.scaleZoom($t),nt&&(tt.bearing=s.ak(x,D,bt)),Dt&&(tt.pitch=s.ak(w,F,bt)),Ye&&(De.interpolatePadding(I,V,bt),G=De.centerPoint.add(j));const Ct=bt===1?ee:tt.unproject(K.add(ie.mult(ot(kt))).mult($t));return tt.setLocationAtPoint(tt.renderWorldCopies?Ct.wrap():Ct,G),tt._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(u),tt};if(n.preloadOnly){const tt=this._emulate(ct,n.duration,p);return this._preloadTiles(tt),this}return this._zooming=!0,this._rotating=nt,this._pitching=Dt,this._padding=Ye,this._prepareEase(u,!1),this._ease(ct(p),()=>this._afterEase(u),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,u)}if(!n){const p=this.handlers;p&&p.stop(!1)}return this}_ease(n,u,p){p.animate===!1||p.duration===0?(n(1),u()):(this._easeStart=s.o.now(),this._easeOptions=p,this._onEaseFrame=n,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((s.o.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,u){n=s.bT(n,-180,180);const p=Math.abs(n-u);return Math.abs(n-360-u)<p&&(n-=360),Math.abs(n+360-u)<p&&(n+=360),n}_normalizeCenter(n){const u=this.transform;if(u.maxBounds||u.projection.name!=="globe"&&!u.renderWorldCopies)return;const p=n.lng-u.center.lng;n.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&s.o.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,u,p){const v=Math.ceil(15*u/1e3),x=[],w=n(p.clone());for(let I=0;I<=v;I++){const C=w(I/v);x.push(C.clone())}return x}_preloadTiles(n,u){}}class Fp{constructor(n={}){this.options=n,s.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const u=this.options&&this.options.compact,p=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Q("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const v=Q("span","mapboxgl-ctrl-icon",this._compactButton);return v.setAttribute("aria-hidden","true"),v.setAttribute("title",p),this._innerContainer=Q("div","mapboxgl-ctrl-attrib-inner",this._container),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(n){const p=u.reduce((v,x,w)=>(x.value&&(v+=`${x.key}=${x.value}${w<u.length-1?"&":""}`),v),"?");n.href=`${s.e.FEEDBACK_URL}/${p}#${j_(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||(n.dataType!=="source"||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility")&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const u=this._map.style._mergedSourceCaches;for(const v in u){const x=u[v];if(x.used){const w=x.getSource();w.attribution&&n.indexOf(w.attribution)<0&&n.push(w.attribution)}}n.sort((v,x)=>v.length-x.length),n=n.filter((v,x)=>{for(let w=x+1;w<n.length;w++)if(n[w].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const p=n.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,n.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class xc{constructor(){s.aY(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=Q("div","mapboxgl-ctrl");const u=Q("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const u in n){const p=n[u].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const u=n[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class zp{constructor(){s.aY(["_onIndoorUpdate"],this)}onAdd(n){return this._map=n,this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",u=>this._onIndoorUpdate({selectedFloorId:u.selectedFloorId,floors:u.floors})),this._container}_createButton(n,u){const p=Q("button",n,this._container);return p.type="button",p.addEventListener("click",u),p}_createSeparator(){return Q("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(n,u){this._map&&(n.setAttribute("aria-label",u),n.textContent=u)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(n){if(!n||!n.floors)return void(this._container.style.display="none");const u=this._model;this._model=n,this._container.style.display="inline-block",this._container.style.borderRadius="8px";const p=n.floors.sort((v,x)=>x.levelOrder-v.levelOrder);u?(Array.from(this._container.children).forEach(v=>v.remove()),this.addCurrentFloors(p)):this.addCurrentFloors(p)}addCurrentFloors(n){for(let u=0;u<n.length;u++){const p=n[u],v=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(p.id),this._model&&(this._model.selectedFloorId=p.id),Array.from(this._container.children).forEach(x=>{x.classList.contains("mapboxgl-ctrl-level-button")&&x.classList.remove("mapboxgl-ctrl-level-button-selected")}),v.classList.add("mapboxgl-ctrl-level-button-selected")});this._setButtonTitle(v,p.shortName),this._model&&p.id===this._model.selectedFloorId&&v.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(v),u<n.length-1&&this._createSeparator()}}}class ys{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const u=++this._id;return this._queue.push({callback:n,id:u,cancelled:!1}),u}remove(n){const u=this._currentlyRunning,p=u?this._queue.concat(u):this._queue;for(const v of p)if(v.id===n)return void(v.cancelled=!0)}run(n=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const p of u)if(!p.cancelled&&(p.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class bc{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const u=s.dz((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,u,p){this._start=this.getValue(u),this._end=n,this._startTime=u,this._endTime=u+p}}const Np={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Bp extends s.z{constructor(n,u,p,v){const{point:x,lngLat:w,originalEvent:I,target:C}=n;super(n.type,{point:x,lngLat:w,originalEvent:I,target:C}),this.preventDefault=()=>{n.preventDefault()},this.id=u,this.interaction=p,this.feature=v}}class Fb{constructor(n){this.map=n,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(n,u){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const p=u.filter;let v=u.type;p&&this.filters.set(n,s.b6(p)),v==="mouseover"&&(v="mouseenter"),v==="mouseout"&&(v="mouseleave");const x=this.interactionsByType.get(v)||new Map;v==="mouseenter"||v==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(n,u)):x.size===0&&this.map.on(v,this.handleType),x.size===0&&this.interactionsByType.set(v,x),x.set(n,u),this.typeById.set(n,v)}get(n){const u=this.typeById.get(n);if(!u)return;const p=this.interactionsByType.get(u);return p?p.get(n):void 0}remove(n){const u=this.typeById.get(n);if(!u)return;this.typeById.delete(n),this.filters.delete(n);const p=this.interactionsByType.get(u);p&&(p.delete(n),u==="mouseenter"||u==="mouseleave"?(this.delegatedInteractions.delete(n),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(u,this.handleType))}queryTargets(n,u){const p=[];for(const[v,x]of u)x.target&&p.push({targetId:v,target:x.target,filter:this.filters.get(v)});return this.map.style.queryRenderedTargets(n,p,this.map.transform)}handleMove(n){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const u=this.queryTargets(n.point,Array.from(this.delegatedInteractions).reverse());u.length&&(n.type="mouseenter",this.handleType(n,u));const p=new Map;for(const[v,{feature:x}]of this.prevHoveredFeatures)this.hoveredFeatures.has(v)||p.set(x.id,x);p.size&&(n.type="mouseleave",this.handleType(n,Array.from(p.values())))}handleOut(n){const u=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);u.length&&(n.type="mouseleave",this.handleType(n,u)),this.hoveredFeatures.clear()}handleType(n,u){const p=n.type==="mouseenter";if(p&&!this.interactionsByType.has(n.type))return void s.w("mouseenter interaction required for mouseleave to work.");const v=Array.from(this.interactionsByType.get(n.type)).reverse(),x=!!u;u=u||this.queryTargets(n.point,v);let w=!1;const I=new Set;for(const C of u){for(const[D,F]of v){if(!F.target)continue;const V=C.variants?C.variants[D]:null;if(V){for(const z of V){if(hc(z,C,I,D))continue;const j=new s.dt(C,z),G=Tu(z,C,D);x&&(j.state=this.map.getFeatureState(j));const H=p?this.prevHoveredFeatures.get(G):null,ee=new Bp(n,D,F,j),K=H?H.stop:F.handler(ee);if(p&&this.hoveredFeatures.set(G,{feature:C,stop:K}),K!==!1){w=!0;break}}if(w)break}}if(w)break}if(!w)for(const[C,D]of v){const{handler:F,target:V}=D;if(!V&&F(new Bp(n,C,D,null))!==!1)break}}}function EI(m,n){if(Array.isArray(m)&&Array.isArray(n)){const u=new Set(m),p=new Set(n);return u.size===p.size&&m.every(v=>p.has(v))}return s.by(m,n)}const Vp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},II={showCompass:!0,showZoom:!0,visualizePitch:!1};class SI{constructor(n,u,p=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new q_({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,p&&(this.mousePitch=new W_({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),s.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(n,u){this.mouseRotate.mousedown(n,u),this.mousePitch&&this.mousePitch.mousedown(n,u),Me()}move(n,u){const p=this.map,v=this.mouseRotate.mousemoveWindow(n,u),x=v&&v.bearingDelta;if(x&&p.setBearing(p.getBearing()+x),this.mousePitch){const w=this.mousePitch.mousemoveWindow(n,u),I=w&&w.pitchDelta;I&&p.setPitch(p.getPitch()+I)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){at(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(Object.assign({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),ye(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,ye(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Se(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Se(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Y_(m,n,u){if(m=new s.aR(m.lng,m.lat),n){const p=new s.aR(m.lng-360,m.lat),v=new s.aR(m.lng+360,m.lat),x=360*Math.ceil(Math.abs(m.lng-u.center.lng)/360),w=u.locationPoint3D(m).distSqr(n),I=n.x<0||n.y<0||n.x>u.width||n.y>u.height;u.locationPoint3D(p).distSqr(n)<w&&(I||Math.abs(p.lng-u.center.lng)<x)?m=p:u.locationPoint3D(v).distSqr(n)<w&&(I||Math.abs(v.lng-u.center.lng)<x)&&(m=v)}for(;Math.abs(m.lng-u.center.lng)>180;){const p=u.locationPoint3D(m);if(p.x>=0&&p.y>=0&&p.x<=u.width&&p.y<=u.height)break;m.lng>u.center.lng?m.lng-=360:m.lng+=360}return m}const Up={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},tl={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Qh extends s.E{constructor(n,u){super(),(n instanceof HTMLElement||u)&&(n=Object.assign({element:n},u)),s.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:p="center",color:v="#3FB1CE",scale:x=1,draggable:w=!1,clickTolerance:I=0,rotation:C=tl.rotation,rotationAlignment:D=tl.rotationAlignment,pitchAlignment:F=tl.pitchAlignment,occludedOpacity:V=tl.occludedOpacity,altitude:z=tl.altitude}=n||{};this._anchor=p,this._color=v,this._scale=x,this._draggable=w,this._clickTolerance=I,this._rotation=C,this._rotationAlignment=D,this._pitchAlignment=F,this._occludedOpacity=V,this._altitude=z,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),n&&n.element?(this._element=n.element,this._offset=s.P.convert(n&&n.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(n&&n.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",H=>{H.preventDefault()}),this._element.addEventListener("mousedown",H=>{H.preventDefault()});const j=this._element.classList;for(const H in Up)j.remove(`mapboxgl-marker-anchor-${H}`);j.add(`mapboxgl-marker-anchor-${this._anchor}`);const G=n&&n.className?n.className.trim().split(/\s+/):[];j.add(...G),this._popup=null}_createDefaultMarker(){const n=Q("div"),u=de("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},n);if(this._altitude===0){const p=de("radialGradient",{id:"shadowGradient"},de("defs",{},u));de("stop",{offset:"10%","stop-opacity":.4},p),de("stop",{offset:"100%","stop-opacity":.05},p),de("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},u)}return de("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},u),de("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},u),de("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},u),n}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=s.aR.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(n){return n===this._altitude||(this._defaultMarker&&(this._altitude===0&&n!==0||this._altitude!==0&&n===0)&&(this._element=this._createDefaultMarker()),this._altitude=n||tl.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,n._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const u=n.code,p=n.charCode||n.keyCode;u!=="Space"&&u!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(n){const u=n.originalEvent.target,p=this._element;this._popup&&(u===p||p.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,u=this._pos;if(!n||!u)return!1;const p=n.unproject(u,this._altitude),v=n.getFreeCameraOptions();if(!v.position)return!1;const x=v.position.toLngLat();return x.distanceTo(p)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const u=this._pos;if(!u||u.x<0||u.x>n.transform.width||u.y<0||u.y>n.transform.height)return void this._clearFadeTimer();const p=n.unproject(u,this._altitude);let v;n._showingGlobe()&&s.eY(n.transform,this._lngLat)?v=0:(v=1-n._queryFogOpacity(p),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Up[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){const n=this._pos,u=this._map,p=this.getPitchAlignment();if(!u||!n||p!=="map")return"";if(!u._showingGlobe()){const C=u.getPitch();return C?`rotateX(${C}deg)`:""}const v=s.cW(s.eZ(u.transform,this._lngLat)),x=n.sub(s.e_(u.transform)),w=Math.abs(x.x)+Math.abs(x.y);if(w===0)return"";const I=v/w;return`rotateX(${-x.y*I}deg) rotateY(${x.x*I}deg)`}_calculateZTransform(){const n=this._pos,u=this._map;if(!u||!n)return"";let p=0;const v=this.getRotationAlignment();if(v==="map")if(u._showingGlobe()){const x=u.project(new s.aR(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),w=u.project(new s.aR(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(x);p=s.cW(Math.atan2(w.y,w.x))-90}else p=-u.getBearing();else if(v==="horizon"){const x=s.ah(4,6,u.getZoom()),w=s.e_(u.transform);w.y+=x*u.transform.height;const I=n.sub(w),C=s.cW(Math.atan2(I.y,I.x));p=(C>90?C-270:C+90)*(1-x)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Y_(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat,this._altitude),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=s.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const u=this._map;if(!u)return;const p=this._pointerdownPos,v=this._positionDelta;if(p&&v){if(!this._isDragging){const x=this._clickTolerance||u._clickTolerance;if(n.point.dist(p)<x)return;this._isDragging=!0}this._pos=n.point.sub(v),this._lngLat=u.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.z("dragstart"))),this.fire(new s.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.z("dragend")),this._state="inactive"}_addDragHandler(n){const u=this._map,p=this._pos;u&&p&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(p),this._pointerdownPos=n.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const u=this._map;return u&&(n?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||tl.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||tl.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||tl.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||tl.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const $u={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Yc={maxWidth:100,unit:"metric"},Jc={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ed={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Gl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function zb(m=new s.P(0,0),n="bottom"){if(typeof m=="number"){const u=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(n){case"top":return new s.P(0,m);case"top-left":return new s.P(u,u);case"top-right":return new s.P(-u,u);case"bottom":return new s.P(0,-m);case"bottom-left":return new s.P(u,-u);case"bottom-right":return new s.P(-u,-u);case"left":return new s.P(m,0);case"right":return new s.P(-m,0)}return new s.P(0,0)}return m instanceof s.P||Array.isArray(m)?s.P.convert(m):s.P.convert(m[n]||[0,0])}return{version:E,supported:te.supported,setRTLTextPlugin:s.f2,getRTLTextPluginStatus:s.f1,Map:class extends Xy{constructor(m){O.mark(R.create);const n=m;if((m=Object.assign({},Vp,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&s.eW(window)&&(m.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Wo(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies,null,null),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new ys,this._domRenderTaskQueue=new ys,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.b2(),this._locale=Object.assign({},Np,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new bc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new xi(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?Object.assign({},m.contextCreateOptions):{},typeof m.container=="string"){const u=document.getElementById(m.container);if(!u)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=u}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),this._spriteFormat=m.spriteFormat,s.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new lf),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Op(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||s.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this.indoor=new Fh(this),m.hash&&(this._hash=new zy(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const u=m.bounds;u&&(this.resize(),this.fitBounds(u,Object.assign({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new Fp({customAttribution:m.customAttribution})),this._logoControl=new xc,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new s.z(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new s.z(`${u.dataType}dataloading`,u))}),this._interactions=new Fb(this)}_getMapId(){return this._mapId}addControl(m,n){if(n===void 0&&(n=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new s.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=m.onAdd(this);this._controls.push(m);const p=this._controlPositions[n];return n.indexOf("bottom")!==-1?p.insertBefore(u,p.firstChild):p.appendChild(u),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new s.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(m);return n>-1&&this._controls.splice(n,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new s.z("movestart",m)).fire(new s.z("move",m)),this.fire(new s.z("resize",m)),n&&this.fire(new s.z("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(s.aI.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(n=>n.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(n=>n==="auto"?navigator.language:n):m}setLanguage(m){const n=this._parseLanguage(m);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,n=m.projection.name;let u;n==="globe"&&m.zoom>=s.cK?(m.setMercatorFromTransition(),u=!0):n==="mercator"&&m.zoom<s.cK&&(m.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(m,n){return this._updateProjection(m||n||{name:"mercator"})}_updateProjection(m){let n;return n=m.name==="globe"&&this.transform.zoom>=s.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m,n){return this.transform.locationPoint3D(s.aR.convert(m),n)}unproject(m,n){return this.transform.pointLocation3D(s.P.convert(m),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,n,u){const p=v=>{let x=[];if(Array.isArray(n)){const w=n.filter(I=>this.getLayer(I));x=w.length?this.queryRenderedFeatures(v,{layers:w}):[]}else x=this.queryRenderedFeatures(v,{target:n});return x};if(m==="mouseenter"||m==="mouseover"){let v=!1;return{listener:u,targets:n,delegates:{mousemove:w=>{const I=p(w.point);I.length?v||(v=!0,u.call(this,new Ds(m,this,w.originalEvent,{features:I}))):v=!1},mouseout:()=>{v=!1}}}}if(m==="mouseleave"||m==="mouseout"){let v=!1;return{listener:u,targets:n,delegates:{mousemove:I=>{p(I.point).length?v=!0:v&&(v=!1,u.call(this,new Ds(m,this,I.originalEvent)))},mouseout:I=>{v&&(v=!1,u.call(this,new Ds(m,this,I.originalEvent)))}}}}{const v=x=>{const w=p(x.point);w.length&&(x.features=w,u.call(this,x),delete x.features)};return{listener:u,targets:n,delegates:{[m]:v}}}}on(m,n,u){if(typeof n=="function"||u===void 0)return super.on(m,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._createDelegatedListener(m,n,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(p);for(const v in p.delegates)this.on(v,p.delegates[v]);return this}once(m,n,u){if(typeof n=="function"||u===void 0)return super.once(m,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._createDelegatedListener(m,n,u);for(const v in p.delegates)this.once(v,p.delegates[v]);return this}off(m,n,u){if(typeof n=="function"||u===void 0)return super.off(m,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._delegatedListeners?this._delegatedListeners[m]:void 0;return p&&(v=>{for(let x=0;x<v.length;x++){const w=v[x];if(w.listener===u&&EI(w.targets,n)){for(const I in w.delegates)this.off(I,w.delegates[I]);return v.splice(x,1),this}}})(p),this}queryRenderedFeatures(m,n){if(!this.style)return[];if(m===void 0||m instanceof s.P||Array.isArray(m)||n!==void 0||(n=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],!n){const x=this.style.queryRenderedFeatures(m,void 0,this.transform),w=this.style.queryRenderedFeatureset(m,void 0,this.transform);return x.concat(w)}let u=!0;if(n.target&&(u=this._isTargetValid(n.target),u&&!n.layers))return this.style.queryRenderedFeatureset(m,n,this.transform);let p=!0;if(n.layers&&Array.isArray(n.layers)){for(const x of n.layers)if(!this._isValidId(x)){p=!1;break}if(p&&!n.target)return this.style.queryRenderedFeatures(m,n,this.transform)}let v=[];return p&&(v=v.concat(this.style.queryRenderedFeatures(m,n,this.transform))),u&&(v=v.concat(this.style.queryRenderedFeatureset(m,n,this.transform))),v}querySourceFeatures(m,n){return!m||typeof m=="string"&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,n)}queryRasterValue(m,n,u){return this._isValidId(m)?this.style.queryRasterValue(m,n,u):Promise.resolve(null)}isPointOnSurface(m){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&s.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(m))}addInteraction(m,n){return this._interactions.add(m,n),this}removeInteraction(m){return this._interactions.remove(m),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this}setStyle(m,n){return n=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&m&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(m,(u,p)=>{if(u){const v=typeof u=="string"?u:u instanceof Error?u.message:u.error;s.w(`Unable to perform style diff: ${v}. Rebuilding the style from scratch.`),this._updateStyle(m,n)}else p&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(m,n))}_getUIString(m){const n=this._locale[m];if(n==null)throw new Error(`Missing UI string '${m}'`);return n}_updateStyle(m,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const u=Object.assign({},n);n&&n.config&&(u.initialConfig=n.config,delete u.config),this.style=new wl(this,u).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new wl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new s.y(new Error("IDs can't be empty."))),!1):!s.dm(m)||(this.fire(new s.y(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isTargetValid(m){return"featuresetId"in m?this._isValidId("importId"in m?m.importId:m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const n of m)if(!this._isValidId(n))return!1;return!0}return this._isTargetValid(m)}addSource(m,n){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,n),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,n,u){this._lazyInitEmptyStyle(),this.style.addSourceType(m,n,u)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,n,{pixelRatio:u=1,sdf:p=!1,stretchX:v,stretchY:x,content:w}={}){this._lazyInitEmptyStyle();const I=s.I.from(m);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:C,height:D,data:F}=s.o.getImageData(n);this.style.addImage(I,{data:new s.q({width:C,height:D},F),pixelRatio:u,stretchX:v,stretchY:x,content:w,sdf:p,version:0,usvg:!1})}else if(n.width===void 0||n.height===void 0)this.fire(new s.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:D}=n,F=n;this.style.addImage(I,{data:new s.q({width:C,height:D},new Uint8Array(F.data)),pixelRatio:u,stretchX:v,stretchY:x,content:w,sdf:p,usvg:!1,version:0,userImage:F}),F.onAdd&&F.onAdd(this,m)}}updateImage(m,n){this._lazyInitEmptyStyle();const u=s.I.from(m),p=this.style.getImage(u);if(!p)return void this.fire(new s.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?s.o.getImageData(n):n,{width:x,height:w,data:I}=v;if(x===void 0||w===void 0)return void this.fire(new s.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||w!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new s.y(new Error(`The width and height of the updated image (${x}, ${w})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const C=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let D=!1;p.usvg?(p.data=new s.q({width:x,height:w},new Uint8Array(I)),p.usvg=!1,p.icon=void 0,D=!0):p.data.replace(I,C),this.style.updateImage(u,p,D)}hasImage(m){return m?!!this.style&&!!this.style.getImage(s.I.from(m)):(this.fire(new s.y(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(s.I.from(m))}loadImage(m,n){s.n(this._requestManager.transformRequest(m,s.R.Image),(u,p)=>{n(u,p instanceof HTMLImageElement?s.o.getImageData(p):p)})}listImages(){return this.style.listImages().map(m=>m.name)}addModel(m,n){this._lazyInitEmptyStyle(),this.style.addModel(m,n)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new s.y(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,n){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,n),this._update(!0)):this}getSlot(m){const n=this.getLayer(m);return n&&n.slot||null}setSlot(m,n){return this.style.setSlot(m,n),this.style.mergeLayers(),this._update(!0)}addImport(m,n){return this.style.addImport(m,n).catch(u=>this.fire(new s.y(new Error("Failed to add import",u)))),this}updateImport(m,n){return typeof n!="string"&&n.id!==m?(this.removeImport(m),this.addImport(n)):(this.style.updateImport(m,n),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,n){return this.style.moveImport(m,n),this._update(!0)}moveLayer(m,n){return this._isValidId(m)?(this.style.moveLayer(m,n),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const n=this.style.getOwnLayer(m);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,n,u){return this._isValidId(m)?(this.style.setLayerZoomRange(m,n,u),this._update(!0)):this}setFilter(m,n,u={}){return this._isValidId(m)?(this.style.setFilter(m,n,u),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,n,u,p={}){return this._isValidId(m)?(this.style.setPaintProperty(m,n,u,p),this._update(!0)):this}getPaintProperty(m,n){return this._isValidId(m)?this.style.getPaintProperty(m,n):null}setLayoutProperty(m,n,u,p={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,n,u,p),this._update(!0)):this}getLayoutProperty(m,n){return this._isValidId(m)?this.style.getLayoutProperty(m,n):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(m){return this.style.setGlyphsUrl(m),this._update(!0)}getSchema(m){return this.style.getSchema(m)}setSchema(m,n){return this.style.setSchema(m,n),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,n){return this.style.setConfig(m,n),this._update(!0)}getConfigProperty(m,n){return this.style.getConfigProperty(m,n)}setConfigProperty(m,n,u){return this.style.setConfigProperty(m,n,u),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){const n=m[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(m){return this._lazyInitEmptyStyle(),this.style.setSnow(m),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(m){return this._lazyInitEmptyStyle(),this.style.setRain(m),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setImportColorTheme(m,n){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(m,n),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.aR.convert(m),this.transform):0}setFeatureState(m,n){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,n),this._update())}removeFeatureState(m,n){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,n),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_selectIndoorFloor(m){this.indoor.selectFloor(m)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new zp),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let u,p,v,x=this._container;for(;x&&(!p||!v);){const w=window.getComputedStyle(x).transform;w&&w!=="none"&&(u=w.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(p=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(v=u[3])),x=x.parentElement}this._containerWidth=p?Math.abs(m/p):m,this._containerHeight=v?Math.abs(n/v):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=Q("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=Q("div","mapboxgl-canvas-container",m);this._canvas=Q("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=Q("div","mapboxgl-control-container",m),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(v=>{p[v]=Q("div",`mapboxgl-ctrl-${v}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,n){const u=s.o.devicePixelRatio||1;this._canvas.width=u*Math.ceil(m),this._canvas.height=u*Math.ceil(n),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${n}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const n=this._markers.indexOf(m);n!==-1&&this._markers.splice(n,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const n=this._popups.indexOf(m);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const m=Object.assign({},te.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",m);n?(Be(n,!0),this.painter=new Fy(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",u=>{u.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.k.testSupport(n)):this.fire(new s.y(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.z("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.z("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let n;this.fire(new s.z("renderstart")),++this._frameId;const u=this.painter.context.extTimerQuery,p=s.o.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=v.createQuery(),v.beginQuery(u.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,F=this.transform.pitch,V=s.o.now(),z=new s.ac(D,{now:V,fadeDuration:x,pitch:F,transition:this.style.transition,worldview:this._worldview});this.style.update(z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(p);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,O.mark(R.load),this.fire(new s.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const D=s.o.now()-p;v.endQuery(u.TIME_ELAPSED_EXT),setTimeout(()=>{const F=v.getQueryParameter(n,v.QUERY_RESULT)/1e6;v.deleteQuery(n),this.fire(new s.z("gpu-timing-frame",{cpuTime:D,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const D=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(D);this.fire(new s.z("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const D=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(D);this.fire(new s.z("gpu-timing-deferred-render",{gpuTime:F}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(C||this._repaint)this.triggerRepaint();else{const D=this.idle();if(D&&(w=this._updateAverageElevation(p,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),D&&(this.fire(new s.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new s.z("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,O.mark(R.fullLoad),this._performanceMetricsCollection&&Wt(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const n of this._markers)m&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!m||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(m,n=!1){const u=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(n||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const v=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=m;const w=Math.abs(v-x);if(w>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(x),u(x);this._averageElevation.easeTo(x,m,300)}else if(w>1e-4)return this._averageElevation.jumpTo(x),u(x)}return!!this._averageElevation.isEasing(m)&&u(this._averageElevation.getValue(m))}_authenticate(){ai(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===Oe||m.status===401)){const n=this.painter.context.gl;Be(n,!1),this._logoControl instanceof xc&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Br(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Ni(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const u=this.painter.context.gl,p=u.createFramebuffer();function v(x){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,x,0);const w=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,w),w}return u.bindFramebuffer(u.FRAMEBUFFER,p),this._canvasPixelComparison(v(m),n.canvasCopies.map(v),n.timeStamps)}_canvasPixelComparison(m,n,u){let p=u[1]-u[0];const v=m.length/4;for(let x=0;x<n.length;x++){const w=n[x];let I=0;for(let C=0;C<w.length;C+=4)w[C]===m[C]&&w[C+1]===m[C+1]&&w[C+2]===m[C+2]&&w[C+3]===m[C+3]&&(I+=1);p+=(u[x+2]-u[x+1])*(1-I/v)}return p}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),nr.delete(this.painter.context.gl),Xt.remove(),Ar.remove(),this._removed=!0,this.fire(new s.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=s.o.frame(n=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(n)}))}_preloadTiles(m){const n=this.style?this.style.getSourceCaches():[];return s.bw(n,(u,p)=>u._preloadTiles(m,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this._tp.refreshUI(),m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,this._tp.refreshUI(),m&&this._update())}_setCacheLimits(m,n){s.eX(m,n)}get version(){return E}},NavigationControl:class{constructor(m={}){this.options=Object.assign({},II,m),this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(s.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),Q("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),Q("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:n}):u.resetNorth({},{originalEvent:n}))}),this._compassIcon=Q("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const n=m.getZoom(),u=n===m.getMaxZoom(),p=n===m.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new SI(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,n){const u=Q("button",m,this._container);return u.type="button",u.addEventListener("click",n),u}_setButtonTitle(m,n){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${n}`);m.setAttribute("aria-label",u),m.firstElementChild&&m.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends s.E{constructor(m={}){super();const n=navigator.geolocation;this.options=Object.assign({geolocation:n},$u,m),s.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=U_(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const n=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,m(u)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(u=>n(u.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(m){const n=this._map.getMaxBounds(),u=m.coords;return!!n&&(u.longitude<n.getWest()||u.longitude>n.getEast()||u.latitude<n.getSouth()||u.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new s.z("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("geolocate",m)),this._finish()}}_updateCamera(m){const n=new s.aR(m.coords.longitude,m.coords.latitude),u=m.coords.accuracy,p=this._map.getBearing(),v=Object.assign({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(u),v,{geolocateSource:!0})}_updateMarker(m){if(m){const n=new s.aR(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,n=s.ce(1,m._center.lat)*m.worldSize,u=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=Q("button","mapboxgl-ctrl-geolocate",this._container),Q("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Q("div","mapboxgl-user-location"),this._dotElement.appendChild(Q("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Q("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Qh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Q("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Qh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.z("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Fp,ScaleControl:class{constructor(m={}){this.options=Object.assign({},Yc,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,n=this._map,u=n._containerHeight/2,p=n._containerWidth/2-m/2,v=n.unproject([p,u]),x=n.unproject([p+m,u]),w=v.distanceTo(x);if(this.options.unit==="imperial"){const I=3.2808*w;I>5280?this._setScale(m,I/5280,"mile"):this._setScale(m,I,"foot")}else this.options.unit==="nautical"?this._setScale(m,w/1852,"nautical-mile"):w>=1e3?this._setScale(m,w/1e3,"kilometer"):this._setScale(m,w,"meter")}_setScale(m,n,u){this._map._requestDomTask(()=>{const p=function(x){const w=Math.pow(10,`${Math.floor(x)}`.length-1);let I=x/w;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(C){const D=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*D)/D}(I),w*I}(n),v=p/n;this._container.innerHTML=this._isNumberFormatSupported&&u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(p):`${p}&nbsp;${Jc[u]}`,this._container.style.width=m*v+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:s.w("Full screen control 'container' must be a DOM element.")),s.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=Q("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Q("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:zp,Popup:class extends s.E{constructor(m){super(),this.options=Object.assign(Object.create(ed),m),this._altitude=this.options.altitude,s.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new s.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new s.z("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=s.aR.convert(m),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(m){return this._altitude=m,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const n=document.createDocumentFragment(),u=document.createElement("body");let p;for(u.innerHTML=m;p=u.firstChild,p;)n.appendChild(p);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=Q("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(m),this.options.closeButton){const u=this._closeButton=Q("button","mapboxgl-popup-close-button",n);u.type="button",u.setAttribute("aria-label","Close popup"),u.innerHTML='<span aria-hidden="true">&#215;</span>',u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let n;return this._classList.delete(m)?n=!1:(this._classList.add(m),n=!0),this._updateClassList(),n}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const n=this._map,u=this._container,p=this._pos;if(!n||!u||!p)return"bottom";const v=u.offsetWidth,x=u.offsetHeight,w=p.x<v/2,I=p.x>n.transform.width-v/2;if(p.y+m<x)return w?"top-left":I?"top-right":"top";if(p.y>n.transform.height-x){if(w)return"bottom-left";if(I)return"bottom-right"}return w?"left":I?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),m.className=n.join(" ")}_update(m){const n=this._map,u=this._content;if(!n||!this._lngLat&&!this._trackPointer||!u)return;let p=this._container;if(p||(p=this._container=Q("div","mapboxgl-popup",n.getContainer()),this._tip=Q("div","mapboxgl-popup-tip",p),p.appendChild(u)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Y_(this._lngLat,this._pos,n.transform)),!this._trackPointer||m){const v=this._pos=this._trackPointer&&m instanceof s.P?m:n.project(this._lngLat,this._altitude),x=zb(this.options.offset),w=this._anchor=this._getAnchor(x.y),I=zb(this.options.offset,w),C=v.add(I).round();n._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${Up[w]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&n._showingGlobe()){const v=s.eY(n.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Gl);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Qh,Style:wl,LngLat:s.aR,LngLatBounds:s.aI,Point:s.P,MercatorCoordinate:s.ae,FreeCameraOptions:Y0,Evented:s.E,config:s.e,prewarm:s.f0,clearPrewarmedResources:s.e$,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(m){s.e.ACCESS_TOKEN=m},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(m){s.e.API_URL=m},get workerCount(){return s.f9.workerCount},set workerCount(m){s.f9.workerCount=m},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){s.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){s.f8(m)},get workerUrl(){return s.f7.workerUrl},set workerUrl(m){s.f7.workerUrl=m},get workerClass(){return s.f7.workerClass},set workerClass(m){s.f7.workerClass=m},get workerParams(){return s.f7.workerParams},set workerParams(m){s.f7.workerParams=m},get dracoUrl(){return s.f6()},set dracoUrl(m){s.f5(m)},get meshoptUrl(){return s.f4()},set meshoptUrl(m){s.f3(m)},setNow:s.o.setNow,restoreNow:s.o.restoreNow}});var y=c;return y})})(v9);var zoe=v9.exports;const jv=Foe(zoe);function PO(r,e,t){var o=e[1],c=e[0],f=o-c;return r===o&&t?r:((r-c)%f+f)%f+c}function IT(r,e){if(e===!1)return r;var t=Math.pow(10,e===void 0?6:e);return Math.round(r*t)/t}var b9=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"};function ps(r,e,t){this.x=t?Math.round(r):r,this.y=t?Math.round(e):e}var MO=Math.trunc||function(r){return r>0?Math.floor(r):Math.ceil(r)};function Sc(r,e,t){return r instanceof ps?r:b9(r)?new ps(r[0],r[1]):r==null?r:typeof r=="object"&&"x"in r&&"y"in r?new ps(r.x,r.y):new ps(r,e,t)}function mh(r,e){if(r)for(var t=e?[r,e]:r,o=0,c=t.length;o<c;o++)this.extend(t[o])}function xg(r,e){return!r||r instanceof mh?r:new mh(r,e)}function du(r,e){if(r)for(var t=e?[r,e]:r,o=0,c=t.length;o<c;o++)this.extend(t[o])}function kg(r,e){return r instanceof du?r:new du(r,e)}ps.prototype={clone:function(){return new ps(this.x,this.y)},add:function(r){return this.clone()._add(Sc(r))},_add:function(r){return this.x+=r.x,this.y+=r.y,this},subtract:function(r){return this.clone()._subtract(Sc(r))},_subtract:function(r){return this.x-=r.x,this.y-=r.y,this},divideBy:function(r){return this.clone()._divideBy(r)},_divideBy:function(r){return this.x/=r,this.y/=r,this},multiplyBy:function(r){return this.clone()._multiplyBy(r)},_multiplyBy:function(r){return this.x*=r,this.y*=r,this},scaleBy:function(r){return new ps(this.x*r.x,this.y*r.y)},unscaleBy:function(r){return new ps(this.x/r.x,this.y/r.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=MO(this.x),this.y=MO(this.y),this},distanceTo:function(r){var e=(r=Sc(r)).x-this.x,t=r.y-this.y;return Math.sqrt(e*e+t*t)},equals:function(r){return(r=Sc(r)).x===this.x&&r.y===this.y},contains:function(r){return r=Sc(r),Math.abs(r.x)<=Math.abs(this.x)&&Math.abs(r.y)<=Math.abs(this.y)},toString:function(){return"Point("+IT(this.x)+", "+IT(this.y)+")"}},mh.prototype={extend:function(r){var e,t;if(!r)return this;if(r instanceof ps||typeof r[0]=="number"||"x"in r)e=t=Sc(r);else if(e=(r=xg(r)).min,t=r.max,!e||!t)return this;return this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=e.clone(),this.max=t.clone()),this},getCenter:function(r){return Sc((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,r)},getBottomLeft:function(){return Sc(this.min.x,this.max.y)},getTopRight:function(){return Sc(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(r){var e,t;return(r=typeof r[0]=="number"||r instanceof ps?Sc(r):xg(r))instanceof mh?(e=r.min,t=r.max):e=t=r,e.x>=this.min.x&&t.x<=this.max.x&&e.y>=this.min.y&&t.y<=this.max.y},intersects:function(r){r=xg(r);var e=this.min,t=this.max,o=r.min,c=r.max,f=c.x>=e.x&&o.x<=t.x,y=c.y>=e.y&&o.y<=t.y;return f&&y},overlaps:function(r){r=xg(r);var e=this.min,t=this.max,o=r.min,c=r.max,f=c.x>e.x&&o.x<t.x,y=c.y>e.y&&o.y<t.y;return f&&y},isValid:function(){return!(!this.min||!this.max)},pad:function(r){var e=this.min,t=this.max,o=Math.abs(e.x-t.x)*r,c=Math.abs(e.y-t.y)*r;return xg(Sc(e.x-o,e.y-c),Sc(t.x+o,t.y+c))},equals:function(r){return!!r&&(r=xg(r),this.min.equals(r.getTopLeft())&&this.max.equals(r.getBottomRight()))}},du.prototype={extend:function(r){var e,t,o=this._southWest,c=this._northEast;if(r instanceof _o)e=r,t=r;else{if(!(r instanceof du))return r?this.extend(ST(r)||kg(r)):this;if(e=r._southWest,t=r._northEast,!e||!t)return this}return o||c?(o.lat=Math.min(e.lat,o.lat),o.lng=Math.min(e.lng,o.lng),c.lat=Math.max(t.lat,c.lat),c.lng=Math.max(t.lng,c.lng)):(this._southWest=new _o(e.lat,e.lng),this._northEast=new _o(t.lat,t.lng)),this},pad:function(r){var e=this._southWest,t=this._northEast,o=Math.abs(e.lat-t.lat)*r,c=Math.abs(e.lng-t.lng)*r;return new du(new _o(e.lat-o,e.lng-c),new _o(t.lat+o,t.lng+c))},getCenter:function(){return new _o((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new _o(this.getNorth(),this.getWest())},getSouthEast:function(){return new _o(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(r){r=typeof r[0]=="number"||r instanceof _o||"lat"in r?ST(r):kg(r);var e,t,o=this._southWest,c=this._northEast;return r instanceof du?(e=r.getSouthWest(),t=r.getNorthEast()):e=t=r,e.lat>=o.lat&&t.lat<=c.lat&&e.lng>=o.lng&&t.lng<=c.lng},intersects:function(r){r=kg(r);var e=this._southWest,t=this._northEast,o=r.getSouthWest(),c=r.getNorthEast(),f=c.lat>=e.lat&&o.lat<=t.lat,y=c.lng>=e.lng&&o.lng<=t.lng;return f&&y},overlaps:function(r){r=kg(r);var e=this._southWest,t=this._northEast,o=r.getSouthWest(),c=r.getNorthEast(),f=c.lat>e.lat&&o.lat<t.lat,y=c.lng>e.lng&&o.lng<t.lng;return f&&y},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(r,e){return!!r&&(r=kg(r),this._southWest.equals(r.getSouthWest(),e)&&this._northEast.equals(r.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}};var kO=function(r){var e,t,o,c;for(t=1,o=arguments.length;t<o;t++)for(e in c=arguments[t])r[e]=c[e];return r}({},{latLngToPoint:function(r,e){var t=this.projection.project(r),o=this.scale(e);return this.transformation._transform(t,o)},pointToLatLng:function(r,e){var t=this.scale(e),o=this.transformation.untransform(r,t);return this.projection.unproject(o)},project:function(r){return this.projection.project(r)},unproject:function(r){return this.projection.unproject(r)},scale:function(r){return 256*Math.pow(2,r)},zoom:function(r){return Math.log(r/256)/Math.LN2},getProjectedBounds:function(r){if(this.infinite)return null;var e=this.projection.bounds,t=this.scale(r);return new mh(this.transformation.transform(e.min,t),this.transformation.transform(e.max,t))},infinite:!1,wrapLatLng:function(r){var e=this.wrapLng?PO(r.lng,this.wrapLng,!0):r.lng;return new _o(this.wrapLat?PO(r.lat,this.wrapLat,!0):r.lat,e,r.alt)},wrapLatLngBounds:function(r){var e=r.getCenter(),t=this.wrapLatLng(e),o=e.lat-t.lat,c=e.lng-t.lng;if(o===0&&c===0)return r;var f=r.getSouthWest(),y=r.getNorthEast();return new du(new _o(f.lat-o,f.lng-c),new _o(y.lat-o,y.lng-c))}},{wrapLng:[-180,180],R:6371e3,distance:function(r,e){var t=Math.PI/180,o=r.lat*t,c=e.lat*t,f=Math.sin((e.lat-r.lat)*t/2),y=Math.sin((e.lng-r.lng)*t/2),s=f*f+Math.cos(o)*Math.cos(c)*y*y,E=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return this.R*E}});function _o(r,e,t){if(isNaN(r)||isNaN(e))throw new Error("Invalid LatLng object: ("+r+", "+e+")");this.lat=+r,this.lng=+e,t!==void 0&&(this.alt=+t)}function ST(r,e,t){return r instanceof _o?r:b9(r)&&typeof r[0]!="object"?r.length===3?new _o(r[0],r[1],r[2]):r.length===2?new _o(r[0],r[1]):null:r==null?r:typeof r=="object"&&"lat"in r?new _o(r.lat,"lng"in r?r.lng:r.lon,r.alt):e===void 0?null:new _o(r,e,t)}_o.prototype={equals:function(r,e){return!!r&&(r=ST(r),Math.max(Math.abs(this.lat-r.lat),Math.abs(this.lng-r.lng))<=(e===void 0?1e-9:e))},toString:function(r){return"LatLng("+IT(this.lat,r)+", "+IT(this.lng,r)+")"},distanceTo:function(r){return kO.distance(this,ST(r))},wrap:function(){return kO.wrapLatLng(this)},toBounds:function(r){var e=180*r/40075017,t=e/Math.cos(Math.PI/180*this.lat);return kg([this.lat-e,this.lng-t],[this.lat+e,this.lng+t])},clone:function(){return new _o(this.lat,this.lng,this.alt)}};const AT=r=>{const e=r.valueOf();return w9(e)},w9=r=>{const e=r/864e5-10957.5,t=6.240059966692059+.017201969994578018*e,o=t+.017453292519943295*(1.9148*Math.sin(t)+.02*Math.sin(2*t)+3e-4*Math.sin(3*t))+1.796593062783907+Math.PI,c=Math.atan2(Math.sin(o)*Math.cos(.40909994067971484),Math.cos(o));return{dec:Math.asin(Math.sin(.40909994067971484)*Math.sin(o)),Hi:(4.889714432387314+6.3003876824396166*e-c)%(2*Math.PI)+2*Math.PI}},$v=()=>Math.floor(1e7*Math.random()),PA=(r,e,t)=>{const o=1/e,c=Math.min(r[0]*o,255),f=Math.min(r[1]*o,255),y=Math.min(r[2]*o,255);let s=0;return c+f+y!==0&&(s=c>0?c/255*.5+.5:y>0?.5*(1-y/255):.5),s*t},bg=(r=new Date,e)=>{const t=new Date(r.toLocaleString("en-US",{timeZone:"UTC"})),o=new Date(r.toLocaleString("en-US",e?{timeZone:e}:{}));return t.getTime()-o.getTime()},Gv=r=>{const e=()=>!r.getPitch;return{project:(t,o)=>{if(e())return r.project(t,o);{const{lat:c,lng:f}=t;return new ps(((y,s)=>(y+180)/360*Math.pow(2,s)*256)(f,o),((y,s)=>(1-Math.log(Math.tan(y*Math.PI/180)+1/Math.cos(y*Math.PI/180))/Math.PI)/2*Math.pow(2,s)*256)(c,o))}},unproject:(t,o)=>{return e()?r.unproject(t,o):new _o((c=t.y,f=o,y=Math.PI-2*Math.PI*c/256/Math.pow(2,f),180/Math.PI*Math.atan(.5*(Math.exp(y)-Math.exp(-y)))),function(s,E){return s/256/Math.pow(2,E)*360-180}(t.x,o));var c,f,y},screenUnproject:t=>e()?r.containerPointToLatLng(t):r.unproject(t),getZoom:()=>e()?r.getZoom():r.getZoom()+1,getCenter:()=>r.getCenter(),getBounds:()=>r.getBounds(),eachLayer:t=>{e()&&r.eachLayer(t)},getBearing:()=>e()?0:r.getBearing(),getPitch:()=>e()?0:r.getPitch(),rawMap:()=>r,isLeaflet:e,getPixelDimensions:()=>{const t=r.getContainer();return{width:t.clientWidth,height:t.clientHeight}},createBounds:t=>{const{nw:o,se:c}=t;return new du(o,c)}}};function au(r,e,t,o){return new(t||(t=Promise))(function(c,f){function y(R){try{E(o.next(R))}catch(O){f(O)}}function s(R){try{E(o.throw(R))}catch(O){f(O)}}function E(R){var O;R.done?c(R.value):(O=R.value,O instanceof t?O:new t(function(A){A(O)})).then(y,s)}E((o=o.apply(r,[])).next())})}function CT(r,e,t){t=t||2;var o,c,f,y,s,E,R,O=e&&e.length,A=O?e[0]*t:r.length,U=DO(r,0,A,t,!0),$=[];if(!U||U.next===U.prev)return $;if(O&&(U=function(Q,de,Ce,Fe){var Le,Me,at,pt=[];for(Le=0,Me=de.length;Le<Me;Le++)(at=DO(Q,de[Le]*Fe,Le<Me-1?de[Le+1]*Fe:Q.length,Fe,!1))===at.next&&(at.steiner=!0),pt.push(Hoe(at));for(pt.sort(joe),Le=0;Le<pt.length;Le++)Ce=$oe(pt[Le],Ce);return Ce}(r,e,U,t)),r.length>80*t){o=f=r[0],c=y=r[1];for(var te=t;te<A;te+=t)(s=r[te])<o&&(o=s),(E=r[te+1])<c&&(c=E),s>f&&(f=s),E>y&&(y=E);R=(R=Math.max(f-o,y-c))!==0?32767/R:0}return hx(U,$,t,o,c,R,0),$}function DO(r,e,t,o,c){var f,y;if(c===c4(r,e,t,o)>0)for(f=e;f<t;f+=o)y=LO(f,r[f],r[f+1],y);else for(f=t-o;f>=e;f-=o)y=LO(f,r[f],r[f+1],y);return y&&LE(y,y.next)&&(fx(y),y=y.next),y}function zm(r,e){if(!r)return r;e||(e=r);var t,o=r;do if(t=!1,o.steiner||!LE(o,o.next)&&so(o.prev,o,o.next)!==0)o=o.next;else{if(fx(o),(o=e=o.prev)===o.next)break;t=!0}while(t||o!==e);return e}function hx(r,e,t,o,c,f,y){if(r){!y&&f&&function(O,A,U,$){var te=O;do te.z===0&&(te.z=a4(te.x,te.y,A,U,$)),te.prevZ=te.prev,te.nextZ=te.next,te=te.next;while(te!==O);te.prevZ.nextZ=null,te.prevZ=null,function(Q){var de,Ce,Fe,Le,Me,at,pt,me,ye=1;do{for(Ce=Q,Q=null,Me=null,at=0;Ce;){for(at++,Fe=Ce,pt=0,de=0;de<ye&&(pt++,Fe=Fe.nextZ);de++);for(me=ye;pt>0||me>0&&Fe;)pt!==0&&(me===0||!Fe||Ce.z<=Fe.z)?(Le=Ce,Ce=Ce.nextZ,pt--):(Le=Fe,Fe=Fe.nextZ,me--),Me?Me.nextZ=Le:Q=Le,Le.prevZ=Me,Me=Le;Ce=Fe}Me.nextZ=null,ye*=2}while(at>1)}(te)}(r,o,c,f);for(var s,E,R=r;r.prev!==r.next;)if(s=r.prev,E=r.next,f?Boe(r,o,c,f):Noe(r))e.push(s.i/t|0),e.push(r.i/t|0),e.push(E.i/t|0),fx(r),r=E.next,R=E.next;else if((r=E)===R){y?y===1?hx(r=Voe(zm(r),e,t),e,t,o,c,f,2):y===2&&Uoe(r,e,t,o,c,f):hx(zm(r),e,t,o,c,f,1);break}}}function Noe(r){var e=r.prev,t=r,o=r.next;if(so(e,t,o)>=0)return!1;for(var c=e.x,f=t.x,y=o.x,s=e.y,E=t.y,R=o.y,O=c<f?c<y?c:y:f<y?f:y,A=s<E?s<R?s:R:E<R?E:R,U=c>f?c>y?c:y:f>y?f:y,$=s>E?s>R?s:R:E>R?E:R,te=o.next;te!==e;){if(te.x>=O&&te.x<=U&&te.y>=A&&te.y<=$&&Ng(c,s,f,E,y,R,te.x,te.y)&&so(te.prev,te,te.next)>=0)return!1;te=te.next}return!0}function Boe(r,e,t,o){var c=r.prev,f=r,y=r.next;if(so(c,f,y)>=0)return!1;for(var s=c.x,E=f.x,R=y.x,O=c.y,A=f.y,U=y.y,$=s<E?s<R?s:R:E<R?E:R,te=O<A?O<U?O:U:A<U?A:U,Q=s>E?s>R?s:R:E>R?E:R,de=O>A?O>U?O:U:A>U?A:U,Ce=a4($,te,e,t,o),Fe=a4(Q,de,e,t,o),Le=r.prevZ,Me=r.nextZ;Le&&Le.z>=Ce&&Me&&Me.z<=Fe;){if(Le.x>=$&&Le.x<=Q&&Le.y>=te&&Le.y<=de&&Le!==c&&Le!==y&&Ng(s,O,E,A,R,U,Le.x,Le.y)&&so(Le.prev,Le,Le.next)>=0||(Le=Le.prevZ,Me.x>=$&&Me.x<=Q&&Me.y>=te&&Me.y<=de&&Me!==c&&Me!==y&&Ng(s,O,E,A,R,U,Me.x,Me.y)&&so(Me.prev,Me,Me.next)>=0))return!1;Me=Me.nextZ}for(;Le&&Le.z>=Ce;){if(Le.x>=$&&Le.x<=Q&&Le.y>=te&&Le.y<=de&&Le!==c&&Le!==y&&Ng(s,O,E,A,R,U,Le.x,Le.y)&&so(Le.prev,Le,Le.next)>=0)return!1;Le=Le.prevZ}for(;Me&&Me.z<=Fe;){if(Me.x>=$&&Me.x<=Q&&Me.y>=te&&Me.y<=de&&Me!==c&&Me!==y&&Ng(s,O,E,A,R,U,Me.x,Me.y)&&so(Me.prev,Me,Me.next)>=0)return!1;Me=Me.nextZ}return!0}function Voe(r,e,t){var o=r;do{var c=o.prev,f=o.next.next;!LE(c,f)&&T9(c,o,o.next,f)&&dx(c,f)&&dx(f,c)&&(e.push(c.i/t|0),e.push(o.i/t|0),e.push(f.i/t|0),fx(o),fx(o.next),o=r=f),o=o.next}while(o!==r);return zm(o)}function Uoe(r,e,t,o,c,f){var y=r;do{for(var s=y.next.next;s!==y.prev;){if(y.i!==s.i&&qoe(y,s)){var E=E9(y,s);return y=zm(y,y.next),E=zm(E,E.next),hx(y,e,t,o,c,f,0),void hx(E,e,t,o,c,f,0)}s=s.next}y=y.next}while(y!==r)}function joe(r,e){return r.x-e.x}function $oe(r,e){var t=function(c,f){var y,s=f,E=c.x,R=c.y,O=-1/0;do{if(R<=s.y&&R>=s.next.y&&s.next.y!==s.y){var A=s.x+(R-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(A<=E&&A>O&&(O=A,y=s.x<s.next.x?s:s.next,A===E))return y}s=s.next}while(s!==f);if(!y)return null;var U,$=y,te=y.x,Q=y.y,de=1/0;s=y;do E>=s.x&&s.x>=te&&E!==s.x&&Ng(R<Q?E:O,R,te,Q,R<Q?O:E,R,s.x,s.y)&&(U=Math.abs(R-s.y)/(E-s.x),dx(s,c)&&(U<de||U===de&&(s.x>y.x||s.x===y.x&&Goe(y,s)))&&(y=s,de=U)),s=s.next;while(s!==$);return y}(r,e);if(!t)return e;var o=E9(t,r);return zm(o,o.next),zm(t,t.next)}function Goe(r,e){return so(r.prev,r,e.prev)<0&&so(e.next,r,r.next)<0}function a4(r,e,t,o,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-t)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Hoe(r){var e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function Ng(r,e,t,o,c,f,y,s){return(c-y)*(e-s)>=(r-y)*(f-s)&&(r-y)*(o-s)>=(t-y)*(e-s)&&(t-y)*(f-s)>=(c-y)*(o-s)}function qoe(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(t,o){var c=t;do{if(c.i!==t.i&&c.next.i!==t.i&&c.i!==o.i&&c.next.i!==o.i&&T9(c,c.next,t,o))return!0;c=c.next}while(c!==t);return!1}(r,e)&&(dx(r,e)&&dx(e,r)&&function(t,o){var c=t,f=!1,y=(t.x+o.x)/2,s=(t.y+o.y)/2;do c.y>s!=c.next.y>s&&c.next.y!==c.y&&y<(c.next.x-c.x)*(s-c.y)/(c.next.y-c.y)+c.x&&(f=!f),c=c.next;while(c!==t);return f}(r,e)&&(so(r.prev,r,e.prev)||so(r,e.prev,e))||LE(r,e)&&so(r.prev,r,r.next)>0&&so(e.prev,e,e.next)>0)}function so(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function LE(r,e){return r.x===e.x&&r.y===e.y}function T9(r,e,t,o){var c=Ww(so(r,e,t)),f=Ww(so(r,e,o)),y=Ww(so(t,o,r)),s=Ww(so(t,o,e));return c!==f&&y!==s||!(c!==0||!qw(r,t,e))||!(f!==0||!qw(r,o,e))||!(y!==0||!qw(t,r,o))||!(s!==0||!qw(t,e,o))}function qw(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function Ww(r){return r>0?1:r<0?-1:0}function dx(r,e){return so(r.prev,r,r.next)<0?so(r,e,r.next)>=0&&so(r,r.prev,e)>=0:so(r,e,r.prev)<0||so(r,r.next,e)<0}function E9(r,e){var t=new l4(r.i,r.x,r.y),o=new l4(e.i,e.x,e.y),c=r.next,f=e.prev;return r.next=e,e.prev=r,t.next=c,c.prev=t,o.next=t,t.prev=o,f.next=o,o.prev=f,o}function LO(r,e,t,o){var c=new l4(r,e,t);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function fx(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function l4(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function c4(r,e,t,o){for(var c=0,f=e,y=t-o;f<t;f+=o)c+=(r[y]-r[f])*(r[f+1]+r[y+1]),y=f;return c}function Woe(r){return r.filter(e=>e.geometry.type==="MultiPolygon").forEach(e=>{const{geometry:t,properties:o,type:c}=e;if(t.type==="MultiPolygon")for(let f=0;f<t.coordinates.length;f++)r.push(Object.assign(Object.assign({},e),{geometry:Object.assign(Object.assign({},t),{type:"Polygon",coordinates:t.coordinates[f]})}))}),r.filter(e=>e.geometry.type==="Polygon").map(e=>{const{geometry:t,properties:o}=e,c=CT.flatten(t.coordinates),f=new Float32Array(c.vertices.map(($,te)=>{return te%2==1?(Q=$,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+Q*Math.PI/360)))/360):(180+$)/360;var Q})),y=CT(c.vertices,c.holes,c.dimensions),s=y.length>256?new Uint16Array(y):new Uint8Array(y),E=function($){const{height:te=0,levels:Q=0,render_height:de=0}=$;return Q?3.04*Q:Math.max(te,de)}(o),R=o.highlight||!1;let O=0,A=0,U=0;for(let $=0;$<f.length;$+=2)O+=f[$],A+=f[$+1],U++;return{aPosition:f,cuts:s,buildingHeight:E,centroid:[O/U,A/U],highlight:R}})}CT.deviation=function(r,e,t,o){var c=e&&e.length,f=c?e[0]*t:r.length,y=Math.abs(c4(r,0,f,t));if(c)for(var s=0,E=e.length;s<E;s++){var R=e[s]*t,O=s<E-1?e[s+1]*t:r.length;y-=Math.abs(c4(r,R,O,t))}var A=0;for(s=0;s<o.length;s+=3){var U=o[s]*t,$=o[s+1]*t,te=o[s+2]*t;A+=Math.abs((r[U]-r[te])*(r[$+1]-r[U+1])-(r[U]-r[$])*(r[te+1]-r[U+1]))}return y===0&&A===0?0:Math.abs((A-y)/y)},CT.flatten=function(r){for(var e=r[0][0].length,t={vertices:[],holes:[],dimensions:e},o=0,c=0;c<r.length;c++){for(var f=0;f<r[c].length;f++)for(var y=0;y<e;y++)t.vertices.push(r[c][f][y]);c>0&&(o+=r[c-1].length,t.holes.push(o))}return t};const Bg=(r,e)=>{const{lat:t,lng:o}=r;return new ps(((c,f)=>(c+180)/360*Math.pow(2,f)*256)(o,e),((c,f)=>(1-Math.log(Math.tan(c*Math.PI/180)+1/Math.cos(c*Math.PI/180))/Math.PI)/2*Math.pow(2,f)*256)(t,e))},Vg=(r,e)=>{return new _o((t=r.y,o=e,c=Math.PI-2*Math.PI*t/256/Math.pow(2,o),180/Math.PI*Math.atan(.5*(Math.exp(c)-Math.exp(-c)))),function(f,y){return f/256/Math.pow(2,y)*360-180}(r.x,e));var t,o,c};let OO,Cf={heightMapTex:null,width:0,height:0,visibleDEMPixelBounds:new mh(new ps(0,0),new ps(0,0)),DEMPixelBounds:new mh(new ps(0,0),new ps(0,0)),maxHeight:8848,raster:[],demZoom:0,dirty:!1,outputWidth:0,outputHeight:0};const Xoe=r=>au(void 0,void 0,void 0,function*(){const{demZoom:e,getFeatures:t,terrainSource:o,canopySource:c,dsmSource:f,tileLoaded:y,gl:s,bounds:E,buildingRasterizer:R,tileMerger:O,canopyMerger:A,forceUpdate:U=!1}=r,{getSourceUrl:$,getElevation:te,maxZoom:Q,tileSize:de,_overzoom:Ce}=o,Fe=(Le={getFeatures:t},au(void 0,void 0,void 0,function*(){const{getFeatures:Me}=Le;try{return Woe(yield Me())}catch(at){console.log("Error merging buildings",at)}return[]}));var Le;try{const Me=E,at=Me.getNorthWest(),pt=Me.getSouthEast(),me=new mh(Bg(at,e),Bg(pt,e));let ye=new ps(me.min.x,me.min.y),Se=me.max.x-me.min.x;const ke=me.max.y-me.min.y,Ve=me.max.subtract(me.min);Ve.y>Ve.x&&(ye.x-=256,Se+=512);const He=(Be=>{const{upperLeft:Ge,width:Qe,height:ht}=Be,Et=Ge.divideBy(256).floor().multiplyBy(256),Ue=256*(Math.ceil(Qe/256)+1),ii=256*(Math.ceil(ht/256)+1),Ht=Et.add([Ue,ii]);return new mh(Et,Ht)})({upperLeft:ye,width:Se,height:ke}),{x:Oe,y:xi}=He.max.subtract(He.min),ui=(Be=>{Be.sort((ht,Et)=>ht.y!==Et.y?ht.y-Et.y:ht.x-Et.x);const Ge=Be.reduce((ht,Et)=>Et.x<ht.x?Et:ht).x,Qe=Be.reduce((ht,Et)=>Et.y<ht.y?Et:ht).y;return Be.map(ht=>{const Et=Math.pow(2,ht.z);return{x:(ht.x%Et+Et)%Et,y:(ht.y%Et+Et)%Et,z:ht.z,xOffset:256*(ht.x-Ge),yOffset:256*(ht.y-Qe)}})})((Be=>{const{upperLeft:Ge,width:Qe,height:ht,zoom:Et}=Be,Ue=Ge.divideBy(256).floor(),ii=Ue.x+Qe/256,Ht=Math.min(Ue.y+ht/256,Math.pow(2,Et)-1),Jt=[];for(var Lt=Ue.x;Lt<ii;Lt++)for(var Ai=Ue.y;Ai<Ht;Ai++)Jt.push({x:Lt,y:Ai,z:Et});return Jt})({upperLeft:He.min,width:Oe,height:xi,zoom:e})),ti=me.max.x-me.min.x,ri=me.max.y-me.min.y,Si=Math.round(ti),ir=Math.round(ri),st=JSON.stringify(ui);if(!U&&st===OO&&e<Q)return Cf=Object.assign(Object.assign({},Cf),{outputWidth:Si,outputHeight:ir,visibleDEMPixelBounds:me,demZoom:e,dirty:!0}),Cf;const wi=[O.merge(ui,{maxZoom:Q,width:Oe,height:xi,crossOrigin:"Anonymous",getSourceUrl:$,getElevation:te,tileSize:de,tileLoaded:y})];if(c!==void 0){const Be=A.merge(ui,{maxZoom:c.maxZoom,width:Oe,height:xi,crossOrigin:"Anonymous",getSourceUrl:c.getSourceUrl,getElevation:c.getElevation,tileSize:c.tileSize,tileLoaded:y});wi.push(Be)}else wi.push(new Promise(Be=>{const Ge=s.createTexture();s.activeTexture(s.TEXTURE2),s.bindTexture(s.TEXTURE_2D,Ge),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,new Uint8ClampedArray([0,0,0,0])),Be(Ge)}));const[ji,Ar]=yield Promise.all(wi);if(ji===null||Ar===null)return Cf=Object.assign(Object.assign({},Cf),{visibleDEMPixelBounds:me,demZoom:e,dirty:!1}),Cf;const Br=new mh(Bg(new du(f.bounds).getNorthWest(),e),Bg(new du(f.bounds).getSouthEast(),e)),Vr=Br.min.subtract(He.min),Ni=Br.max.subtract(He.min),vt=[Vr.x/Oe,Vr.y/xi,Ni.x/Oe,Ni.y/xi].map(Be=>2*Be-1),Wt=yield Fe,{maxHeight:Xt,heightMapTex:ai}=R.raster({upperLeftTile:ui[0],width:Oe,height:xi,mapZoom:e,features:Wt,imageData:ji,gl:s,dsmSource:f,dsmCoords:vt,canopyData:Ar}),nr=Math.max(f.maxHeight,ji.maxHeight+Xt);OO=st,Cf={heightMapTex:ai,maxHeight:nr,width:Oe,height:xi,DEMPixelBounds:He,visibleDEMPixelBounds:me,raster:ui,demZoom:e,dirty:!0,outputWidth:Si,outputHeight:ir}}catch(Me){console.error("Could not decode height map",Me)}return Cf}),Ug=(r,e)=>{const{r:t,g:o,b:c}=r;return[t/255,o/255,c/255,e]},FO=(r,e)=>{const{date:t}=e,{dec:o,Hi:c}=AT(t);r.updateDate({dec:o,Hi:c})},zO=(r,e)=>au(void 0,void 0,void 0,function*(){return yield r.updateDateRange(Object.assign({},e))}),NO=(r,e)=>{const{color:t,opacity:o}=e,c=Ug(t,o);r.updateColor({colorVec:c})},Zoe=r=>{const{kernel:e,map:t,heightMap:o,now:c,color:f,opacity:y,belowCanopy:s,skipRender:E}=r;try{const{heightMapTex:R,outputHeight:O,outputWidth:A,maxHeight:U,width:$,height:te,DEMPixelBounds:Q,visibleDEMPixelBounds:de,demZoom:Ce}=o;if($===0||te===0)return;const{min:Fe,max:Le}=de;if(!Fe||!Le)return;const{x:Me,y:at}=Le.subtract(Fe),pt=Q.min,me=t.getPixelDimensions(),ye=t.screenUnproject([0,0]),Se=t.screenUnproject([me.width,0]),ke=t.screenUnproject([me.width,me.height]),Ve=t.screenUnproject([0,me.height]),He=[Ve,ke,ye,Se].map(st=>t.project(st,Ce)),Oe=He.map(st=>[(st.x-pt.x)/$,(st.y-pt.y)/te]).flat(),xi=He.map(st=>[(st.x-Fe.x)/Me,(st.y-Fe.y)/at]).map(st=>[2*st[0]-1,(2*st[1]-1)*(t.isLeaflet()?-1:1)]).flat(),ui=pt.y/256/Math.pow(2,Ce),ti=te/256/Math.pow(2,Ce),ri=new du(Vg(Q.getTopLeft(),Ce),Vg(Q.getBottomRight(),Ce)),Si=ri.getWest(),ir=Math.abs(ri.getWest()-ri.getEast());((st,wi)=>{const{color:ji,opacity:Ar,date:Br}=wi,Vr=Ug(ji,Ar),{dec:Ni,Hi:vt}=AT(Br);st.updateHeightMap(Object.assign({dec:Ni,Hi:vt,colorVec:Vr,step:1},wi))})(e,{heightMapTex:R,maxHeight:U,width:$,height:te,heightMapZoom:Ce,cornerTextureCoords:Oe,cornerClipCoords:xi,topYCoord:ui,ySize:ti,west:Si,dLng:ir,date:c,color:f,opacity:y,outputHeight:O,outputWidth:A,belowCanopy:s,skipRender:E})}catch(R){console.error("EXCEPTION",R)}},Dg=r=>{const{gl:e}=r,{texture:t,imageData:o=null,format:c=e.RGBA,width:f,height:y,filter:s=e.NEAREST,wrap:E=e.CLAMP_TO_EDGE,type:R=e.UNSIGNED_BYTE,internalFormat:O=c}=r;e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,E),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,E),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,s),e.texImage2D(e.TEXTURE_2D,0,O,f,y,0,c,R,o)};function qR(r){const{gl:e,vSrc:t,fSrc:o}=r,c=e.createShader(e.VERTEX_SHADER);e.shaderSource(c,t),e.compileShader(c);const f=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(f,o),e.compileShader(f);const y=e.createProgram();return e.attachShader(y,c),e.attachShader(y,f),e.linkProgram(y),y}class Koe{constructor(e){this.gl=e,this.program=qR({gl:e,vSrc:`
uniform vec3 xyz;
uniform vec2 dimensions;
uniform bool use_dsm;
uniform vec2 u_centroid;
uniform sampler2D height_map;
attribute vec2 dsm_position;
attribute vec2 a_position;
varying vec2 vCoord;
varying float v_use_dsm;
varying vec4 v_elevation;

	void main() {
		if (use_dsm == true) {
			gl_Position = vec4(a_position, 0, 1);
			vCoord = dsm_position;
      v_use_dsm = 1.0;
			return;
		}
		if (abs(a_position) == vec2(1,1)) {
			gl_Position = vec4(a_position, 0, 1);
			vCoord = a_position * 0.5 + 0.5;
			return;
		}
		float x = a_position.x - xyz.x;
		float y = a_position.y - xyz.y;
		vec2 transformed = vec2(x, y);
		vec2 normalized = transformed / dimensions;
		vec2 final = normalized * 2.0 - 1.0;
    v_elevation = texture2D(height_map, vec2(u_centroid.x, u_centroid.y));
    vCoord = normalized;
		gl_Position = vec4(final, 0, 1);
	}
`,fSrc:`
#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
#else
  precision mediump float;
#endif

uniform vec4 color;
uniform sampler2D height_map;
uniform sampler2D canopy_map;
varying vec2 vCoord;
varying float v_use_dsm;
varying vec4 v_elevation;

vec4 addElevation(vec4 color, vec4 toAdd) {
  float ground = (color.r * 255.0 * 255.0 + color.g * 255.0);
  float building = (toAdd.r * 255.0 * 255.0 + toAdd.g * 255.0);
  float elevation = ground + building;
  float r = floor(elevation / 255.0) / 255.0;
  float g = floor(mod(elevation, 255.0)) / 255.0;
  return vec4(r, g, r, g);
}

void main() {
	if (color == vec4(1,1,1,1)) {
	 	vec4 textureColor = texture2D(height_map, vec2(vCoord.x, vCoord.y));
	 	vec4 canopyColor = texture2D(canopy_map, vec2(vCoord.x, vCoord.y));
    if (v_use_dsm == 1.0) {
	 	  gl_FragColor = vec4(0.0, 0.0, textureColor.b, textureColor.a);
      if (gl_FragColor.zw == vec2(0.0)) {
        discard;
      }
    } else {
      float upper = textureColor.r + canopyColor.r;
      float combined = textureColor.g + canopyColor.g;
      if (combined > 1.0) {
        combined = combined - floor(combined);
        upper += 1.0 / 255.0;
      }
      gl_FragColor = vec4(textureColor.r, textureColor.g, upper, combined);
    }
    // DSM noData values should not be included in heightMap because they produce ugly borders
		return;
  }
  if (color == vec4(0,0,0,0)) {
	 	vec4 textureColor = texture2D(height_map, vec2(vCoord.x, vCoord.y));
    gl_FragColor = vec4(textureColor.r, textureColor.g, textureColor.r, textureColor.g);
    return;
  }
  vec4 final = addElevation(v_elevation, color);
	gl_FragColor = final;
}
`}),this.positionAttributeLocation=e.getAttribLocation(this.program,"a_position"),this.dsmAttributeLocation=e.getAttribLocation(this.program,"dsm_position"),this.useDSMUniformLocation=e.getUniformLocation(this.program,"use_dsm"),this.xyzUniformLocation=e.getUniformLocation(this.program,"xyz"),this.dimensionsUniformLocation=e.getUniformLocation(this.program,"dimensions"),this.heightMapUniformLocation=e.getUniformLocation(this.program,"height_map"),this.canopyMapUniformLocation=e.getUniformLocation(this.program,"canopy_map"),this.centroidUniformLocation=e.getUniformLocation(this.program,"u_centroid"),this.colorUniformLocation=e.getUniformLocation(this.program,"color"),this.positionBuffer=e.createBuffer(),this.dsmBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.targetTexture=e.createTexture()}raster(e){const{features:t,upperLeftTile:o,mapZoom:c,width:f,height:y,imageData:s,dsmCoords:E,dsmSource:R,canopyData:O,gl:A}=e,{x:U,y:$,z:te}=o;let Q=0;A.useProgram(this.program),A.activeTexture(A.TEXTURE1),A.bindTexture(A.TEXTURE_2D,s),A.activeTexture(A.TEXTURE2),A.bindTexture(A.TEXTURE_2D,O);const de=f,Ce=y;A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,this.targetTexture),A.texImage2D(A.TEXTURE_2D,0,A.RGBA,de,Ce,0,A.RGBA,A.UNSIGNED_BYTE,null),c>15&&t.length>5?(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.NEAREST)):(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.LINEAR)),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.viewport(0,0,de,Ce);const Fe=A.createFramebuffer();A.bindFramebuffer(A.FRAMEBUFFER,Fe);const Le=A.COLOR_ATTACHMENT0;A.framebufferTexture2D(A.FRAMEBUFFER,Le,A.TEXTURE_2D,this.targetTexture,0),A.disable(A.BLEND),A.bindBuffer(A.ARRAY_BUFFER,this.positionBuffer),A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,this.indexBuffer),A.clearColor(0,0,0,0),A.clear(A.COLOR_BUFFER_BIT);const Me=U/Math.pow(2,te),at=$/Math.pow(2,te),pt=new ps(Me,at),me=f/256/Math.pow(2,te),ye=y/256/Math.pow(2,te);A.uniform3f(this.xyzUniformLocation,Me,at,te),A.uniform2f(this.dimensionsUniformLocation,me,ye),A.uniform1i(this.heightMapUniformLocation,1),A.uniform1i(this.canopyMapUniformLocation,2),A.uniform1i(this.useDSMUniformLocation,0);const Se=new Float32Array([-1,-1,1,-1,-1,1,1,1]);if(A.enableVertexAttribArray(this.positionAttributeLocation),A.bufferData(A.ARRAY_BUFFER,Se,A.STATIC_DRAW),A.vertexAttribPointer(this.positionAttributeLocation,2,A.FLOAT,!1,0,0),A.uniform4f(this.colorUniformLocation,1,1,1,1),A.drawArrays(A.TRIANGLE_STRIP,0,4),t.filter(ke=>!ke.highlight).forEach(ke=>{const{buildingHeight:Ve,aPosition:He,cuts:Oe,centroid:xi,highlight:ui}=ke,ti=new ps(xi[0],xi[1]).subtract(pt).unscaleBy(new ps(me,ye)).scaleBy(new ps(f,y)).floor();if(ti.x<0||ti.y<0||ti.x>f||ti.y>y)return;const ri=ti.x/f,Si=ti.y/y,ir=5*Ve,st=Math.floor(ir/255)/255,wi=Math.floor(ir%255)/255;Q=Math.max(Q,Ve),A.uniform2f(this.centroidUniformLocation,ri,Si),A.uniform4f(this.colorUniformLocation,st,wi,st,wi),A.bufferData(A.ARRAY_BUFFER,He,A.DYNAMIC_DRAW),A.vertexAttribPointer(this.positionAttributeLocation,2,A.FLOAT,!1,0,0),A.bufferData(A.ARRAY_BUFFER,He,A.DYNAMIC_DRAW),A.vertexAttribPointer(this.dsmAttributeLocation,2,A.FLOAT,!1,0,0),A.bufferData(A.ELEMENT_ARRAY_BUFFER,Oe,A.DYNAMIC_DRAW),A.drawElements(A.TRIANGLES,Oe.length,Oe.length>256?A.UNSIGNED_SHORT:A.UNSIGNED_BYTE,0)}),R.data.length!==0){A.activeTexture(A.TEXTURE1);const ke=A.createTexture();A.bindTexture(A.TEXTURE_2D,ke),A.pixelStorei(A.UNPACK_ALIGNMENT,2),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.NEAREST),A.texImage2D(A.TEXTURE_2D,0,A.LUMINANCE_ALPHA,R.width,R.height,0,A.LUMINANCE_ALPHA,A.UNSIGNED_BYTE,R.data),A.pixelStorei(A.UNPACK_ALIGNMENT,4);const Ve=[E[0],E[3],E[2],E[3],E[0],E[1],E[2],E[1]],He=new Float32Array(Ve);A.enableVertexAttribArray(this.positionAttributeLocation),A.bufferData(A.ARRAY_BUFFER,He,A.STATIC_DRAW),A.vertexAttribPointer(this.positionAttributeLocation,2,A.FLOAT,!1,0,0),A.enableVertexAttribArray(this.dsmAttributeLocation),A.bindBuffer(A.ARRAY_BUFFER,this.dsmBuffer),A.bufferData(A.ARRAY_BUFFER,new Float32Array([0,1,1,1,0,0,1,0]),A.STATIC_DRAW),A.vertexAttribPointer(this.dsmAttributeLocation,2,A.FLOAT,!1,0,0),A.uniform4f(this.colorUniformLocation,1,1,1,1),A.uniform1i(this.useDSMUniformLocation,1),A.colorMask(!1,!1,!0,!0),A.drawArrays(A.TRIANGLE_STRIP,0,4),A.deleteTexture(ke)}return A.colorMask(!0,!0,!0,!0),A.activeTexture(A.TEXTURE1),A.bindTexture(A.TEXTURE_2D,s),A.activeTexture(A.TEXTURE2),A.bindTexture(A.TEXTURE_2D,O),A.uniform1i(this.useDSMUniformLocation,0),t.filter(ke=>ke.highlight).forEach(ke=>{const{buildingHeight:Ve,aPosition:He,cuts:Oe,centroid:xi,highlight:ui}=ke,ti=new ps(xi[0],xi[1]).subtract(pt).unscaleBy(new ps(me,ye)).scaleBy(new ps(f,y)).floor();if(ti.x<0||ti.y<0||ti.x>f||ti.y>y)return;const ri=ti.x/f,Si=ti.y/y,ir=5*Ve,st=Math.floor(ir/255)/255,wi=Math.floor(ir%255)/255;Q=Math.max(Q,Ve),A.uniform2f(this.centroidUniformLocation,ri,Si),A.uniform4f(this.colorUniformLocation,st,wi,st,wi),A.bufferData(A.ARRAY_BUFFER,He,A.DYNAMIC_DRAW),A.vertexAttribPointer(this.positionAttributeLocation,2,A.FLOAT,!1,0,0),A.bufferData(A.ARRAY_BUFFER,He,A.DYNAMIC_DRAW),A.vertexAttribPointer(this.dsmAttributeLocation,2,A.FLOAT,!1,0,0),A.bufferData(A.ELEMENT_ARRAY_BUFFER,Oe,A.DYNAMIC_DRAW),A.drawElements(A.TRIANGLES,Oe.length,Oe.length>256?A.UNSIGNED_SHORT:A.UNSIGNED_BYTE,0)}),A.deleteFramebuffer(Fe),{maxHeight:Q,heightMapTex:this.targetTexture}}}const BO=r=>{const{tile:e,maxZoom:t,tileSize:o}=r;let{x:c,y:f,z:y}=e;if(y>t){const s=Math.pow(2,e.z-t);c=Math.floor(c/s),f=Math.floor(f/s),y=t}return{x:o===256?c:Math.floor(c/2),y:o===256?f:Math.floor(f/2),z:o===256?y:y-1}};class VO{constructor(e){this.gl=e,this.program=qR({vSrc:`
      attribute vec4 a_tex_position;
      attribute vec4 a_tile_position;
      varying vec2 v_tex_pos;
      void main() {
        v_tex_pos = a_tex_position.xy;
        gl_Position = a_tile_position;
      }
    `,fSrc:`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
    #else
      precision mediump float;
    #endif
      uniform sampler2D u_texture;
      uniform float u_encoding;
      uniform float u_tile_size;
      varying vec2 v_tex_pos;

      float getElevationTerrarium(vec4 color) {
        float decoded = color.r * 255.0 * 256.0 + color.g * 255.0 + color.b * 255.0 / 256.0 - 32768.0;
        return decoded;
      }

      float getElevationMapbox(vec4 color) {
        float decoded = -10000.0 + (color.r * 255.0 * 256.0 * 256.0 + color.g * 255.0 * 256.0 + color.b * 255.0) * .1;
        return decoded;
      }

      float getElevationSwitzerland(vec4 color) {
        float decoded = ((color.r * 255.0 * 256.0 + color.g * 255.0) / pow(2.0, 16.0)) * 4808.0;
        return decoded;
      }

      float getElevationCanopy(vec4 color) {
        float closestDistance = 1000.0;
        int closestColor = 100;
        const int colorCount = 26;
        vec3 colorArray[colorCount];

        colorArray[0] = vec3(51.0 / 255.0, 0, 66.0 / 255.0);
        colorArray[1] = vec3(51.0 / 255.0, 16.0/255.0, 86.0 / 255.0);
        colorArray[2] = vec3(51.0 / 255.0, 24.0/255.0, 86.0 / 255.0);
        colorArray[3] = vec3(51.0 / 255.0, 24.0/255.0, 98.0 / 255.0);
        colorArray[4] = vec3(51.0 / 255.0, 37.0/255.0, 108.0 / 255.0);
        colorArray[5] = vec3(48.0 / 255.0, 47.0/255.0, 114.0 / 255.0);
        colorArray[6] = vec3(44.0 / 255.0, 57.0/255.0, 116.0 / 255.0);
        colorArray[7] = vec3(42.0 / 255.0, 68.0/255.0, 117.0 / 255.0);
        colorArray[8] = vec3(39.0 / 255.0, 79.0/255.0, 120.0 / 255.0);
        colorArray[9] = vec3(37.0 / 255.0, 89.0/255.0, 123.0 / 255.0);
        colorArray[10] = vec3(34.0 / 255.0, 100.0/255.0, 120.0 / 255.0);
        colorArray[11] = vec3(34.0 / 255.0, 110.0/255.0, 121.0 / 255.0);
        colorArray[12] = vec3(30.0 / 255.0, 120.0/255.0, 120.0 / 255.0);
        colorArray[13] = vec3(32.0 / 255.0, 132.0/255.0, 117.0 / 255.0);
        colorArray[14] = vec3(36.0 / 255.0, 141.0/255.0, 112.0 / 255.0);
        colorArray[15] = vec3(40.0 / 255.0, 152.0/255.0, 108.0 / 255.0);
        colorArray[16] = vec3(44.0 / 255.0, 161.0/255.0, 101.0 / 255.0);
        colorArray[17] = vec3(52.0 / 255.0, 173.0/255.0, 95.0 / 255.0);
        colorArray[18] = vec3(69.0 / 255.0, 182.0/255.0, 84.0 / 255.0);
        colorArray[19] = vec3(88.0 / 255.0, 191.0/255.0, 72.0 / 255.0);
        colorArray[20] = vec3(109.0 / 255.0, 201.0/255.0, 61.0 / 255.0);
        colorArray[21] = vec3(130.0 / 255.0, 209.0/255.0, 51.0 / 255.0);
        colorArray[22] = vec3(158.0 / 255.0, 213.0/255.0, 45.0 / 255.0);
        colorArray[23] = vec3(189.0 / 255.0, 218.0/255.0, 40.0 / 255.0);
        colorArray[24] = vec3(219.0 / 255.0, 224.0/255.0, 36.0 / 255.0);
        colorArray[25] = vec3(252.0 / 255.0, 228.0/255.0, 30.0 / 255.0);

        for (int i = 0; i < colorCount; i++) {
          float distance = sqrt(pow(color.x - colorArray[i].x, 2.0) + pow(color.y - colorArray[i].y, 2.0) + pow(color.z - colorArray[i].z, 2.0));
          if (distance < closestDistance) {
            closestDistance = distance;
            closestColor = i;
          }
        }
        if (closestColor < 3) {
          closestColor = 0;
        }

        return float(closestColor);
      }

      float getElevation(vec4 color, float encoding) {
        float decoded;
        if (encoding == 1.0) {
          decoded = getElevationMapbox(color);
        } else if (encoding == 2.0) {
          decoded = getElevationSwitzerland(color);
        } else if (encoding == 3.0) {
          decoded = getElevationCanopy(color);
        } else {
          decoded = getElevationTerrarium(color);
        }
        float scaled = decoded * 5.0;
        float elevation = max(scaled, 0.0);
        return elevation;
      }

      float textureSampleLinear(sampler2D sampler, vec2 texCoord) {
        vec2 texelSize = vec2(1.0 / u_tile_size, 1.0 / u_tile_size);
      
        // Calculate interpolation weights based on texCoord fract (fractional part)
        vec2 uv = fract(texCoord * u_tile_size);
      
        // Sample four nearest texels
        vec4 bottomLeft  = texture2D(sampler, texCoord);
        vec4 bottomRight = texture2D(sampler, texCoord + vec2(texelSize.x, 0.0));
        vec4 topLeft    = texture2D(sampler, texCoord + vec2(0.0, texelSize.y));
        vec4 topRight   = texture2D(sampler, texCoord + texelSize);

        float bottomLeftEl = getElevation(bottomLeft, u_encoding);
        float bottomRightEl = getElevation(bottomRight, u_encoding);
        float topLeftEl = getElevation(topLeft, u_encoding);
        float topRightEl = getElevation(topRight, u_encoding);
      
        // Interpolate between bottom and top rows
        float bottom = mix(bottomLeftEl, bottomRightEl, uv.x);
        float top    = mix(topLeftEl, topRightEl, uv.x);
      
        // Interpolate final color
        return mix(bottom, top, uv.y);
      }

      void main() {
        float elevation = textureSampleLinear(u_texture, v_tex_pos);
        float r = floor(elevation / 255.0) / 255.0;
        float g = floor(mod(elevation, 255.0)) / 255.0;
        gl_FragColor = vec4(r, g, r, g);

        // vec4 color = texture2D(u_texture, v_tex_pos);
        // float elevation = getElevation(color, u_encoding);
        // float r = floor(elevation / 255.0) / 255.0;
        // float g = floor(mod(elevation, 255.0)) / 255.0;
        // gl_FragColor = vec4(0, 0, r, g);
        // gl_FragColor = color;
      }
    `,gl:e}),e.useProgram(this.program),this.texPositionAttributeLocation=e.getAttribLocation(this.program,"a_tex_position"),this.tilePositionAttributeLocation=e.getAttribLocation(this.program,"a_tile_position"),this.encodingUniformLocation=e.getUniformLocation(this.program,"u_encoding"),this.tileSizeUniformLocation=e.getUniformLocation(this.program,"u_tile_size"),this.texPositionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texPositionBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(this.texPositionAttributeLocation),e.vertexAttribPointer(this.texPositionAttributeLocation,2,e.FLOAT,!1,0,0),this.tilePositionBuffer=e.createBuffer(),this.tileTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.tileTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),this.outputTexture=e.createTexture(),this.inProgress=[],this.finished=0}merge(e,t){return au(this,void 0,void 0,function*(){const o=this.gl;let c=0;const{width:f,height:y,crossOrigin:s,getSourceUrl:E,getElevation:R,tileSize:O,tileLoaded:A,maxZoom:U}=t;if(o){this.inProgress.forEach(Fe=>Fe.src=""),this.inProgress=[],this.finished=0;const $=new Set;e.forEach(Fe=>{$.add(E(BO({tile:Fe,maxZoom:U,tileSize:O})))}),o.useProgram(this.program);let te=0;R({r:0,g:0,b:0,a:0})===-32768&&(te=0),R({r:0,g:0,b:0,a:0})===-1e4&&(te=1),R({r:256,g:0,b:0,a:0})===4808&&(te=2),R({r:51,g:0,b:66,a:0})===0&&(te=3),o.uniform1f(this.encodingUniformLocation,te),Dg({gl:o,texture:this.outputTexture,imageData:null,format:o.RGBA,width:f,height:y,wrap:o.CLAMP_TO_EDGE,filter:o.NEAREST});const Q=o.createFramebuffer();o.bindFramebuffer(o.FRAMEBUFFER,Q),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,this.outputTexture,0);const de=o.checkFramebufferStatus(o.FRAMEBUFFER);de!==o.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete: "+de),o.clear(o.COLOR_BUFFER_BIT);const Ce=Array.from($).map(Fe=>au(this,void 0,void 0,function*(){return new Promise((Le,Me)=>{const at=new Image;this.inProgress.push(at),at.onload=()=>{o.useProgram(this.program),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this.tileTexture),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,at),o.bindFramebuffer(o.FRAMEBUFFER,Q);const pt=e.filter(Qe=>Fe===E(BO({tile:Qe,maxZoom:U,tileSize:O}))),me=pt.reduce((Qe,ht)=>Math.min(Qe,ht.xOffset),1/0),ye=pt.reduce((Qe,ht)=>Math.min(Qe,ht.yOffset),1/0),Se=pt.reduce((Qe,ht)=>Math.max(Qe,ht.xOffset),0),ke=pt.reduce((Qe,ht)=>Math.max(Qe,ht.yOffset),0),Ve=pt.reduce((Qe,ht)=>Math.min(Qe,ht.x),1/0),He=pt.reduce((Qe,ht)=>Math.min(Qe,ht.y),1/0),Oe=pt.reduce((Qe,ht)=>Math.max(Qe,ht.x),0),xi=pt.reduce((Qe,ht)=>Math.max(Qe,ht.y),0),ui=pt[0].z,ti=me/f,ri=ye/y,Si=(Se+256)/f,ir=(ke+256)/y,st=[ti,ri,Si,ri,ti,ir,Si,ir].map(Qe=>2*Qe-1);o.bindBuffer(o.ARRAY_BUFFER,this.tilePositionBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(st),o.STATIC_DRAW),o.enableVertexAttribArray(this.tilePositionAttributeLocation),o.vertexAttribPointer(this.tilePositionAttributeLocation,2,o.FLOAT,!1,0,0);let wi=[0,0,1,0,0,1,1,1];const ji=Math.pow(2,Math.max(0,ui-U)+(O!==256?1:0)),Ar=O===514?1/O:0,Br=1/ji,Vr=Ve%ji/ji,Ni=He%ji/ji,vt=Oe%ji/ji,Wt=xi%ji/ji;wi=[Vr,Ni,vt+Br,Ni,Vr,Wt+Br,vt+Br,Wt+Br].map(Qe=>Qe*(O===514?512/514:1)+Ar),o.bindBuffer(o.ARRAY_BUFFER,this.texPositionBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(wi),o.STATIC_DRAW),o.enableVertexAttribArray(this.texPositionAttributeLocation),o.vertexAttribPointer(this.texPositionAttributeLocation,2,o.FLOAT,!1,0,0),o.uniform1f(this.tileSizeUniformLocation,O),o.viewport(0,0,f,y),o.disable(o.BLEND),o.drawArrays(o.TRIANGLE_STRIP,0,4);const Xt=Math.floor(ti*f),ai=Math.floor(ri*y),nr=Math.ceil((Si-ti)*f),Be=Math.ceil((ir-ri)*y),Ge=new Uint8Array(4*nr*Be);o.readPixels(Xt,ai,nr,Be,o.RGBA,o.UNSIGNED_BYTE,Ge);for(let Qe=0;Qe<Ge.length;Qe+=4){const ht=(256*Ge[Qe+2]+Ge[Qe+3])/5;c=Math.max(ht,c)}Le(null)},at.onerror=pt=>{if(at.src!==at.originalSource)return Me("new tiles requested");Le(null)},at.crossOrigin=s||null,at.src=Fe,at.originalSource=at.src}).then(()=>{this.finished++,A(this.finished,this.inProgress.length)})}));try{yield Promise.all(Ce)}catch(Fe){return console.log(`${Ce.length} requests aborted`,Fe),null}return this.inProgress=[],this.outputTexture.maxHeight=c,o.deleteFramebuffer(Q),this.outputTexture}throw new Error("Could not get canvas context for merging tile images")})}}class Yoe extends class extends class{constructor(){this.events={}}on(e,t){return typeof this.events[e]!="object"&&(this.events[e]=[]),this.events[e].push(t),()=>this.removeListener(e,t)}removeListener(e,t){if(typeof this.events[e]!="object")return;const o=this.events[e].indexOf(t);o>-1&&this.events[e].splice(o,1)}removeAllListeners(){Object.keys(this.events).forEach(e=>this.events[e].splice(0,this.events[e].length))}emit(e,...t){typeof this.events[e]=="object"&&[...this.events[e]].forEach(o=>o.apply(this,t))}once(e,t){const o=this.on(e,(...c)=>{o(),t.apply(this,c)});return o}}{constructor(...e){super(),this.options={date:new Date,color:"000",opacity:.3,sunExposure:{enabled:!1,startDate:new Date,endDate:new Date,iterations:32},apiKey:"",terrainSource:{maxZoom:15,tileSize:256,_overzoom:15,getSourceUrl:o=>"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/7/17/45.png",getElevation:o=>{const{r:c,g:f,b:y}=o;return 256*c+f+y/256-32768}},canopySource:void 0,dsmSource:{bounds:[{lat:0,lng:0},{lat:0,lng:0}],data:new Uint8ClampedArray,width:0,height:0,maxHeight:0},belowCanopy:!1,getFeatures:()=>Promise.resolve([]),getSize:()=>({width:Number.NaN,height:Number.NaN}),debug:o=>{}};const t=e[0];if(this.options=Object.assign(this.options,t),!this.options.apiKey)throw new Error("Could not load ShadeMap: apiKey missing");fetch("https://shademap.app/sdk/load",{method:"POST",body:JSON.stringify({api_key:this.options.apiKey}),headers:{"Content-Type":"application/json"}}).then(o=>au(this,void 0,void 0,function*(){if(o.status!==200)throw new Error(yield o.text())})).catch(o=>au(this,void 0,void 0,function*(){throw new Error(`Could not load ShadeMap API. Key: ${this.options.apiKey} Error: ${o}`)})),this._canvas=document.createElement("canvas"),this._color=this._parseColor(this.options.color),this._reset=this._reset.bind(this),this._draw=this._draw.bind(this)}onRemove(){return this._map&&this._map.off("moveend",this._reset),this}setDate(e){return this.options.date.getTime()!==e.getTime()?(this.options.date=e,this._compiledKernel&&(FO(this._compiledKernel,{date:this.options.date}),this._heightMap&&this._flush())):this.emit("idle"),this}_setDateForTimezone(e,t){let o=0;t&&(o=bg(this.options.date)-bg(this.options.date,t)),this.setDate(new Date(e.getTime()-o))}setColor(e){return this.options.color!==e&&(this.options.color=e,this._color=this._parseColor(this.options.color),this._compiledKernel&&(NO(this._compiledKernel,{color:this._color,opacity:this.options.opacity}),this._flush())),this}setOpacity(e){return this.options.opacity!==e&&(this.options.opacity=e,this._compiledKernel&&(NO(this._compiledKernel,{color:this._color,opacity:this.options.opacity}),this._flush())),this}setBelowCanopy(e){return this.options.belowCanopy=e,this._heightMap?this._draw(this._heightMap):this._reset(),this}setTerrainSource(e){return this.options.terrainSource=e,delete this._heightMap,this._reset(),this}setCanopySource(e){return this.options.canopySource=e,delete this._heightMap,this._reset(),this}setDSMSource(e){return this.options.dsmSource=e,delete this._heightMap,this._reset(),this}setSunExposure(e=!1,t){return au(this,void 0,void 0,function*(){if(this.options.sunExposure=Object.assign(Object.assign({},this.options.sunExposure),{enabled:e}),t){const{startDate:o=new Date,endDate:c=new Date,iterations:f=32}=t;this.options.sunExposure={enabled:e,startDate:o,endDate:c,iterations:f}}if(this._map&&this._compiledKernel&&this._heightMap){if(e===!1)FO(this._compiledKernel,{date:this.options.date});else{const{startDate:o,endDate:c,iterations:f}=this.options.sunExposure;if(!(o instanceof Date&&c instanceof Date))throw new Error("Start date or end date or both are missing");if(c.getTime()<o.getTime())throw new Error("End date must come after the start date to calculate sun exposure");if((yield zO(this._compiledKernel,{startDate:o,endDate:c,iterations:f,emit:this.emit.bind(this)}))===!0)return this}this._flush()}return this})}_lngLatToTextureCoords(e){if(this._heightMap){const{DEMPixelBounds:t,demZoom:o,width:c,height:f}=this._heightMap,y=t.min;return e.map(s=>{const E=Bg(s,o);return[(E.x-y.x)/c,(E.y-y.y)/f]})}return[]}_getBounds(e,t){const{width:o,height:c}=this.options.getSize();if(Number.isNaN(o)||Number.isNaN(c))return e.getBounds();const f=e.getCenter(),y=Bg(f,t),s=Vg(new ps(y.x-o/2,y.y-c/2),t),E=Vg(new ps(y.x+o/2,y.y+c/2),t);return e.createBounds({nw:s,se:E})}_getDEMZoom(e){const t=Math.min(this.options.terrainSource._overzoom||this.options.terrainSource.maxZoom,e.getZoom());return Math.round(t)}_reset(){return au(this,void 0,void 0,function*(){if(this.options.debug("_reset()"),this._map){const e=Gv(this._map);let t=this._getDEMZoom(e);try{this._bounds=this._getBounds(e,t)}catch(c){return console.error("Invalid bounds returned: ",c),this}try{if(!e.isLeaflet()&&this._map.getPitch()>45){yield new Promise($=>{this._map.loaded()?$(!0):this._map.once("idle",function(){$(!0)})});const c=this._map.style._sourceCaches["other:composite"].getVisibleCoordinates().reverse(),f=c.reduce(($,te)=>Math.max($,te.canonical.z),Number.MIN_SAFE_INTEGER),y=c.filter($=>$.canonical.z===f).map($=>$.canonical),[s,E,R,O]=y.reduce(($,te)=>[Math.min($[0],te.x),Math.min($[1],te.y),Math.max($[2],te.x),Math.max($[3],te.y)],[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER]),A=Vg(new ps(512*s,512*E),f+1),U=Vg(new ps(512*(R+1),512*(O+1)),f+1);t=f+1,this._bounds=e.createBounds({nw:A,se:U})}}catch(c){console.log("Mapbox tile optimization failed",c)}const o=yield Xoe({gl:this._gl,demZoom:t,bounds:this._bounds,terrainSource:this.options.terrainSource,canopySource:this.options.canopySource,dsmSource:this.options.dsmSource,getFeatures:this.options.getFeatures,buildingRasterizer:this._buildingRasterizer,tileMerger:this._tileMerger,canopyMerger:this._canopyMerger,tileLoaded:(c,f)=>this.emit("tileloaded",c,f),forceUpdate:!this._heightMap});this._heightMap=o,o.dirty&&(yield this._draw(o))}return this})}_draw(e){return au(this,void 0,void 0,function*(){if(this.options.debug("_draw()"),this._canvas&&this._compiledKernel&&this._map){if(Zoe({kernel:this._compiledKernel,map:Gv(this._map),heightMap:e,color:this._color,belowCanopy:this.options.belowCanopy,opacity:this.options.opacity,now:this.options.date,maxZoom:this.options.terrainSource.maxZoom,skipRender:this.options.sunExposure.enabled}),this.options.sunExposure.enabled){const{startDate:t,endDate:o,iterations:c}=this.options.sunExposure;if((yield zO(this._compiledKernel,{startDate:t,endDate:o,iterations:c,emit:this.emit.bind(this)}))===!0)return this}this._bounds&&this._repositionCanvas(this._bounds)}return this})}readPixel(e,t){const o=new Uint8Array(4);return this._gl&&this._gl.readPixels(e,t,1,1,this._gl.RGBA,this._gl.UNSIGNED_BYTE,o),o}readPixels(e,t,o,c){const f=new Uint8Array(o*c*4);return this._gl&&this._gl.readPixels(e,t,o,c,this._gl.RGBA,this._gl.UNSIGNED_BYTE,f),f}toGeoTiff(){const e=(t,o)=>{const c=this.readPixels(0,0,t,o),f=t*o*1,y=1*t,s=(o-1)*y,E=new Uint8Array(f),R=new Uint8Array(f);let O=0;const{startDate:A,endDate:U}=this.options.sunExposure;this.options.sunExposure.enabled&&A&&U&&(O=U.getTime()-A.getTime());for(let $=0;$<c.length;$+=4){let te;if(this.options.sunExposure.enabled){const Q=c.subarray($,$+3),de=PA(Q,.5,O)/1e3/60,Ce=Math.min(Math.floor(de/6),255);te=new Uint8Array([Ce])}else te=c[$]+c[$+1]+c[$+2]===0?new Uint8Array([255]):new Uint8Array([0]);E.set(te,$/4*1)}if(this._map&&!Gv(this._map).isLeaflet())return E;for(let $=0;$<f;$+=y)R.set(E.subarray($,$+y),s-$);return R};if(this._map&&this._heightMap){const t=this._heightMap.outputWidth,o=this._heightMap.outputHeight,c=e(t,o),f=Gv(this._map),{lat:y,lng:s}=f.getBounds().getNorthWest(),E=f.getBounds().getSouthEast(),R=[0,0,0,s,y,0],O=[(E.lng-s)/t,(y-E.lat)/o,0];return this.options.sunExposure.enabled,{data:c,metadata:{width:t,height:o,ModelTiepoint:R,ModelPixelScale:O,GeographicTypeGeoKey:4326,GeogCitationGeoKey:"WGS 84"}}}return null}_generateShadeProfile(e){if(this._compiledKernel){const t=this._lngLatToTextureCoords(e.locations);return((o,c)=>{const f=Ug({r:c.sunColor[0],g:c.sunColor[1],b:c.sunColor[2]},1),y=Ug({r:c.shadeColor[0],g:c.shadeColor[1],b:c.shadeColor[2]},1);return o.generateShadeProfile(Object.assign(Object.assign({},c),{sunColor:f,shadeColor:y}))})(this._compiledKernel,Object.assign(Object.assign({},e),{texCoords:t}))}return new Uint8Array}_generateLocationShadeProfile(e){if(this._compiledKernel){const t=bg(e.startDate)-bg(e.startDate,e.tzId),o=e.startDate.getTime()-t,c=e.endDate.getTime()-t,f=this._lngLatToTextureCoords([e.location])[0],{output:y,outputWidth:s,outputHeight:E}=((R,O)=>{const A=Ug({r:O.sunColor[0],g:O.sunColor[1],b:O.sunColor[2]},1),U=Ug({r:O.shadeColor[0],g:O.shadeColor[1],b:O.shadeColor[2]},1);return R.generateLocationShadeProfile(Object.assign(Object.assign({},O),{sunColor:A,shadeColor:U}))})(this._compiledKernel,Object.assign(Object.assign({},e),{startTime:o,endTime:c,texCoord:f}));return y.toArray=function(){const R=new Array;for(let O=0;O<s;O++){const A=[];for(let U=E-1;U>=0;U--){const $=U*s*4+4*O,te=this.slice($,$+4);A.push(te.join("")===e.sunColor.join("")?1:0)}R.push(A)}return R},{data:y,width:s,height:E}}return{data:new Uint8Array,width:0,height:0}}getHoursOfSun(e,t){if(this.options.sunExposure.enabled){const o=this.readPixel(e,t),{startDate:c,endDate:f}=this.options.sunExposure,y=f.getTime()-c.getTime(),s=PA(o,.5,y);return Math.abs(s/1e3/3600)}return 0}_repositionCanvas(e){}_flush(){}flushSync(){this._gl&&this._gl.finish()}_parseColor(e){e=e.replace("#","");const t={r:0,g:0,b:0};return/^([0-9A-F]{3}){1,2}$/i.test(e)&&(e.length===3?(t.r=parseInt(e[0]+e[0],16),t.g=parseInt(e[1]+e[1],16),t.b=parseInt(e[2]+e[2],16)):e.length===6&&(t.r=parseInt(e[0]+e[1],16),t.g=parseInt(e[2]+e[3],16),t.b=parseInt(e[4]+e[5],16))),t}}{constructor(e){super(e),this.id="shademap-layer",this.type="custom",this.canvasSourceId="canvas-source",this.attributionSourceId="attribution-source",this.canvasLayerId="canvas-layer",this.attributionLayerId="attribution-layer",this._refreshing=0,this._raf=0,this.id=this.id+$v(),this.canvasSourceId=this.canvasSourceId+$v(),this.attributionSourceId=this.attributionSourceId+$v(),this.canvasLayerId=this.canvasLayerId+$v(),this.attributionLayerId=this.attributionLayerId+$v(),this.options.terrainSource.tileSize>256&&(this.options.terrainSource.maxZoom=this.options.terrainSource.maxZoom+1),this._moveEndHandler=()=>{this._map&&this._reset()}}render(e,t){}addTo(e){return e.addLayer(this),this}onAdd(e){this._map=e,this._gl=this._map.painter.context.gl,this._framebuffer=this._gl.createFramebuffer(),this._compiledKernel=function(E){const{context:R,setRenderBuffer:O}=E,A=R,U=qR({gl:A,vSrc:"precision lowp float;precision lowp int;precision lowp sampler2D;attribute vec2 a_pos;attribute vec2 a_tex_pos;varying vec2 vTexCoordCropped;varying vec2 vTexCoordFull;void main(void){gl_Position=vec4(a_pos,0,1);vTexCoordFull=(gl_Position*0.5+0.5).xy;vTexCoordCropped=a_tex_pos;}",fSrc:`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
precision lowp int;precision lowp sampler2D;float atan2(float v1,float v2){if(v1==0.0||v2==0.0)return 0.0;return atan(v1,v2);}float _pow(float v1,float v2){if(v2==0.0)return 1.0;return pow(v1,v2);}float integerMod(float x,float y){float res=floor(mod(x,y));return res*(res>floor(y)-1.0 ? 0.0 : 1.0);}float divWithIntCheck(float x,float y){if(floor(x)==x&&floor(y)==y&&integerMod(x,y)==0.0){return float(int(x)/int(y));}return x/y;}float integerCorrectionModulo(float number,float divisor){if(number<0.0){number=abs(number);if(divisor<0.0){divisor=abs(divisor);}return-(number-(divisor*floor(divWithIntCheck(number,divisor))));}if(divisor<0.0){divisor=abs(divisor);}return number-(divisor*floor(divWithIntCheck(number,divisor)));}float getDEMElevationFromSampler2D(sampler2D tex,float x,float y){vec4 result=texture2D(tex,vec2(x,y));return(result.r*255.0*256.0+result.g*255.0)/5000.0;}float getDSMElevationFromSampler2D(sampler2D tex,float x,float y){vec4 result=texture2D(tex,vec2(x,y));return(result.b*255.0*256.0+result.a*255.0)/5000.0;}vec4 actualColor;void color(float r,float g,float b,float a){actualColor=vec4(r,g,b,a);}void color(float r,float g,float b){color(r,g,b,1.0);}void color(float r){color(r,r,r,1.0);}void color(vec4 color){actualColor=color;}const int LOOP_MAX=1000;varying vec2 vTexCoordCropped;varying vec2 vTexCoordFull;uniform sampler2D user_a;uniform float user_width;uniform float user_height;uniform float user_maxHeight;uniform float user_zoom;uniform float user_topYCoord;uniform float user_ySize;uniform vec4 user_color;uniform vec4 u_sunColor;uniform float user_step;uniform float user_west;uniform float user_dLng;uniform float user_dec;uniform float user_Hi;uniform bool u_below_canopy;uniform sampler2D user_sunExposureTexture;uniform bool user_outputSunExposure;uniform bool u_outputShadeProfile;uniform sampler2D u_decHiTexture;uniform sampler2D u_gpxTexture;uniform bool u_outputLocationShadeProfile;uniform vec2 u_shadeProfileLocation;float kernelResult;void kernel(){float sunDec=user_dec;float sunHi=user_Hi;vec4 shade_color=user_color;float maxHeight=user_maxHeight/1000.0;float user_x=vTexCoordCropped.x;float user_y=vTexCoordCropped.y;if(u_outputShadeProfile==true){vec4 decHi=texture2D(u_decHiTexture,vec2(vTexCoordFull.x,1.0-vTexCoordFull.y));sunDec=-decHi.r;sunHi=decHi.g*10.0;vec4 gpx=texture2D(u_gpxTexture,vec2(vTexCoordFull.x,.5));user_x=gpx.x;user_y=gpx.y;}if(u_outputLocationShadeProfile==true){vec4 decHi=texture2D(u_decHiTexture,vec2(vTexCoordFull.x,1.0-vTexCoordFull.y));sunDec=-decHi.r;sunHi=decHi.g*10.0;user_x=u_shadeProfileLocation.x;user_y=u_shadeProfileLocation.y;}float user_lit=1.0;float dsm_height=getDSMElevationFromSampler2D(user_a,user_x,user_y);if(u_below_canopy==true){float dem_height=getDEMElevationFromSampler2D(user_a,user_x,user_y);if(dsm_height-dem_height>.002){user_lit=0.0;}}float user_z=dsm_height;float user_PI=3.141592653589793;float user_2PI=6.283185307179586;float earthRadiusInKm=6378.137;float user_deg=57.29577951308232;float user_y_coord=user_topYCoord+(user_y*user_ySize);float user_lat_coord=(user_y_coord-0.5)/-0.15915494309189532;float user_lat=(2.0*atan(exp(user_lat_coord)))-(user_PI/2.0);float user_rad=0.017453292519943295;float user_lng=user_west+(user_dLng*user_x);float user_H=integerCorrectionModulo((sunHi-(user_rad*-user_lng)),user_2PI);float sun_azimuth=atan2(sin(user_H),((cos(user_H)*sin(user_lat))-(tan(sunDec)*cos(user_lat))));float sun_altitude=asin(((sin(user_lat)*sin(sunDec))+((cos(user_lat)*cos(sunDec))*cos(user_H))));float user_zoom_factor=_pow(2.0,user_zoom);float user_kmPerPixel=divWithIntCheck(156.5430339296875,user_zoom_factor)*abs(cos(user_lat));float user_dx=((-sin(sun_azimuth)*cos(sun_altitude))*user_step)/user_width;float user_dy=((cos(sun_azimuth)*cos(sun_altitude))*user_step)/user_height;float user_dz=((sin(sun_altitude)*user_kmPerPixel)*user_step);float shadow_bias=0.0005;float user_curvature=0.0;float cur_height=0.0;float user_distance=0.0;float user_startX=user_x;float user_startY=user_y;user_x+=user_dx;user_y+=user_dy;user_z+=user_dz;if((abs(1.0)<0.0)){kernelResult=0.0;return;}float minAngle=asin((earthRadiusInKm/(earthRadiusInKm+user_z)))-(user_PI/2.0);if(user_z<0.0||sun_altitude<minAngle){user_lit=0.0;}else{float xIter=ceil(user_dx<0.0 ? abs(user_x/user_dx):(1.0-user_x)/user_dx);float yIter=ceil(user_dy<0.0 ? abs(user_y/user_dy):(1.0-user_y)/user_dy);float zIter=ceil(user_dz<0.0 ? float(LOOP_MAX):(maxHeight-user_z)/user_dz);int iter=int(min(xIter,min(yIter,zIter)));float user_distance=(sqrt(pow(user_dx*user_width,2.0)+pow(user_dy*user_height,2.0))*user_kmPerPixel)/earthRadiusInKm;for(int safeI=0;safeI<LOOP_MAX;safeI++){if(safeI>iter){break;}cur_height=getDSMElevationFromSampler2D(user_a,user_x,user_y);if(cur_height-user_z>shadow_bias){user_curvature=earthRadiusInKm*(1.0-cos(user_distance*float(safeI+1)));if(user_z<(cur_height-user_curvature)){user_lit=0.0;vec4 result=texture2D(user_a,vec2(user_x,user_y));iter=0;break;}}user_x+=user_dx;user_y+=user_dy;user_z+=user_dz;}}if((user_lit==1.0)){if(u_outputLocationShadeProfile==true&&u_sunColor==shade_color){float timeInSun=pow(.7,pow(sin(sun_altitude),.678))*sin(sun_altitude)*(1.0/0.7);float h=0.5;vec4 blue=vec4(0.0,0.0,1.0,1.0);vec4 green=vec4(0.0,1.0,0.0,1.0);vec4 red=vec4(1.0,0.0,0.0,1.0);vec4 col=mix(mix(blue,green,timeInSun/h),mix(green,red,(timeInSun-h)/(1.0-h)),step(h,timeInSun));color(col.r,col.g,col.b,1.0);}else{color(u_sunColor);}}else{color(shade_color);}if(user_outputSunExposure){vec4 aggregateColor=texture2D(user_sunExposureTexture,vec2(vTexCoordFull.x,vTexCoordFull.y));float timeInSun=1.0-aggregateColor.r;float h=0.5;vec4 blue=vec4(0.0,0.0,1.0,1.0);vec4 green=vec4(0.0,1.0,0.0,1.0);vec4 red=vec4(1.0,0.0,0.0,1.0);vec4 col=mix(mix(blue,green,timeInSun/h),mix(green,red,(timeInSun-h)/(1.0-h)),step(h,timeInSun));color(col.r,col.g,col.b,0.5);}}void main(void){kernel();gl_FragColor=actualColor;}`});A.useProgram(U);const $=A.createBuffer(),te=A.getAttribLocation(U,"a_pos"),Q=A.createBuffer(),de=A.getAttribLocation(U,"a_tex_pos"),Ce=A.createBuffer();A.bindBuffer(A.ARRAY_BUFFER,Ce),A.bufferData(A.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),A.STATIC_DRAW);const Fe=A.createBuffer();A.bindBuffer(A.ARRAY_BUFFER,Fe),A.bufferData(A.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,1,1]),A.STATIC_DRAW);const Le=A.getUniformLocation(U,"user_a");A.uniform1i(Le,0);const Me=A.getUniformLocation(U,"user_width"),at=A.getUniformLocation(U,"user_height"),pt=A.getUniformLocation(U,"user_maxHeight"),me=A.getUniformLocation(U,"user_zoom"),ye=A.getUniformLocation(U,"user_topYCoord"),Se=A.getUniformLocation(U,"user_ySize"),ke=A.getUniformLocation(U,"user_step"),Ve=A.getUniformLocation(U,"user_west"),He=A.getUniformLocation(U,"user_dLng"),Oe=A.getUniformLocation(U,"user_dec"),xi=A.getUniformLocation(U,"user_Hi"),ui=A.getUniformLocation(U,"user_color"),ti=A.getUniformLocation(U,"u_below_canopy"),ri=A.getUniformLocation(U,"user_sunExposureTexture"),Si=A.getUniformLocation(U,"user_outputSunExposure"),ir=A.getUniformLocation(U,"u_outputShadeProfile"),st=A.getUniformLocation(U,"u_gpxTexture"),wi=A.getUniformLocation(U,"u_decHiTexture"),ji=A.getUniformLocation(U,"u_sunColor"),Ar=A.getUniformLocation(U,"u_outputLocationShadeProfile"),Br=A.getUniformLocation(U,"u_shadeProfileLocation"),Vr=A.createTexture();let Ni=0,vt=0,Wt=0,Xt=null;const ai=()=>{vt&&Wt&&(A.useProgram(U),A.bindBuffer(A.ARRAY_BUFFER,$),A.enableVertexAttribArray(te),A.vertexAttribPointer(te,2,A.FLOAT,!1,0,0),A.bindBuffer(A.ARRAY_BUFFER,Q),A.enableVertexAttribArray(de),A.vertexAttribPointer(de,2,A.FLOAT,!1,0,0),Xt!==null&&(A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,Xt)),O(A,vt,Wt),A.viewport(0,0,vt,Wt),A.clear(A.COLOR_BUFFER_BIT),A.drawArrays(A.TRIANGLE_STRIP,0,4))};let nr=0,Be=0,Ge=0,Qe="";const ht=Et=>{const Ue=(Et.endTime-Et.startTime)/86400/1e3,ii=1440;if(A.activeTexture(A.TEXTURE3),A.uniform1i(wi,3),Et.startTime!==Be||Et.endTime!==Ge||Et.tzId!==Qe){Be=Et.startTime,Ge=Et.endTime,Qe=Et.tzId;const Ht=[],Jt=828e5,Lt=bg(new Date(Be),Qe);for(let ni=0;ni<Ue;ni++){const bi=bg(new Date(Be+86400*ni*1e3+Jt),Qe)-Lt;Ht[ni]=bi}const Ai=new Float32Array(ii*Ue*2);for(let ni=0;ni<ii;ni++)for(let bi=0;bi<Ue;bi++){const Ci=Be+86400*bi*1e3+60*ni*1e3,{dec:Ti,Hi:Ei}=w9(Ci+Ht[bi]);Ai[2*(ni*Ue+bi)]=-Ti,Ai[2*(ni*Ue+bi)+1]=Ei/10}Dg({gl:A,texture:Vr,imageData:Ai,width:Ue,height:ii,wrap:A.CLAMP_TO_EDGE,filter:A.NEAREST,format:A.RG,internalFormat:A.RG32F,type:A.FLOAT})}else A.bindTexture(A.TEXTURE_2D,Vr);return{outputWidth:Ue,outputHeight:ii}};return{updateHeightMap:function(Et){const{heightMapTex:Ue,width:ii,height:Ht,maxHeight:Jt,heightMapZoom:Lt,topYCoord:Ai,ySize:ni,colorVec:bi,step:Ci,west:Ti,dLng:Ei,dec:hr,Hi:wr,cornerClipCoords:on,cornerTextureCoords:Jr,outputWidth:_r,outputHeight:Es,belowCanopy:es,skipRender:xn}=Et;A.useProgram(U),vt=_r,Wt=Es,Xt=Ue,A.bindBuffer(A.ARRAY_BUFFER,$),A.bufferData(A.ARRAY_BUFFER,new Float32Array(on),A.STATIC_DRAW),A.bindBuffer(A.ARRAY_BUFFER,Q),A.bufferData(A.ARRAY_BUFFER,new Float32Array(Jr),A.STATIC_DRAW),A.uniform1f(Me,ii),A.uniform1f(at,Ht),A.uniform1f(pt,Jt),A.uniform1f(me,Lt),A.uniform1f(ye,Ai),A.uniform1f(Se,ni),A.uniform4fv(ui,bi),A.uniform1f(ke,Ci),A.uniform1f(Ve,Ti),A.uniform1f(He,Ei),A.uniform1f(Oe,hr),A.uniform1f(xi,wr),A.uniform1f(ti,es?1:0),xn||(window.cancelAnimationFrame(Ni),Ni=window.requestAnimationFrame(ai))},updateDate:Et=>{const{dec:Ue,Hi:ii}=Et;A.useProgram(U),A.uniform1f(Oe,Ue),A.uniform1f(xi,ii),window.cancelAnimationFrame(Ni),Ni=window.requestAnimationFrame(ai)},updateDateRange:Et=>au(this,void 0,void 0,function*(){const{startDate:Ue,endDate:ii,iterations:Ht,emit:Jt}=Et;A.useProgram(U);const Lt=nr=Date.now(),Ai=Math.floor((ii.getTime()-Ue.getTime())/Ht),ni=A.getUniform(U,ui),bi=vt,Ci=Wt,Ti=A.createTexture();A.activeTexture(A.TEXTURE2),A.bindTexture(A.TEXTURE_2D,Ti),A.texImage2D(A.TEXTURE_2D,0,A.RGBA,bi,Ci,0,A.RGBA,A.UNSIGNED_BYTE,null),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.NEAREST);const Ei=A.createFramebuffer();A.bindFramebuffer(A.FRAMEBUFFER,Ei);const hr=A.COLOR_ATTACHMENT0;A.framebufferTexture2D(A.FRAMEBUFFER,hr,A.TEXTURE_2D,Ti,0);for(let wr=0;wr<Ht;wr++){if(A.useProgram(U),Jt("tileloaded",wr,Ht-1),Lt!==nr)return A.deleteFramebuffer(Ei),A.deleteTexture(Ti),A.uniform4fv(ui,ni),!0;yield new Promise((on,Jr)=>{window.requestAnimationFrame(()=>{A.useProgram(U),Xt!==null&&(A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,Xt)),A.bindFramebuffer(A.FRAMEBUFFER,Ei);const _r=A.checkFramebufferStatus(A.FRAMEBUFFER);_r!==A.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete: "+_r);const{dec:Es,Hi:es}=AT(new Date(Ue.getTime()+Ai*wr));A.uniform1f(Oe,Es),A.uniform1f(xi,es),A.uniform4fv(ui,[1/Ht,0,0,1]),A.bindBuffer(A.ARRAY_BUFFER,$),A.enableVertexAttribArray(te),A.vertexAttribPointer(te,2,A.FLOAT,!1,0,0),A.bindBuffer(A.ARRAY_BUFFER,Q),A.enableVertexAttribArray(de),A.vertexAttribPointer(de,2,A.FLOAT,!1,0,0),A.viewport(0,0,bi,Ci),A.enable(A.BLEND),A.blendFunc(A.ONE,A.ONE),A.drawArrays(A.TRIANGLE_STRIP,0,4),on()})})}return A.deleteFramebuffer(Ei),yield new Promise((wr,on)=>{window.requestAnimationFrame(()=>{if(A.useProgram(U),Lt!==nr)return A.deleteTexture(Ti),A.uniform4fv(ui,ni),void wr(!0);A.activeTexture(A.TEXTURE2),A.bindTexture(A.TEXTURE_2D,Ti),A.uniform1i(ri,2),A.uniform1i(Si,1),ai(),A.uniform1i(Si,0),A.uniform1i(ri,0),A.deleteTexture(Ti),A.uniform4fv(ui,ni),wr(!1)})})}),updateColor:Et=>{const{colorVec:Ue}=Et;A.useProgram(U),A.uniform4fv(ui,Ue),window.cancelAnimationFrame(Ni),Ni=window.requestAnimationFrame(ai)},generateShadeProfile:Et=>{A.useProgram(U);const{dates:Ue,texCoords:ii,shadeColor:Ht,sunColor:Jt}=Et,Lt=ii.length,Ai=Ue.length,ni=A.getUniform(U,ui);A.uniform4fv(ui,Ht),A.uniform4fv(ji,Jt),A.uniform1i(ir,1);const bi=A.createTexture();A.activeTexture(A.TEXTURE3),Dg({gl:A,imageData:null,width:Lt,height:Ai,wrap:A.CLAMP_TO_EDGE,filter:A.NEAREST,format:A.RGBA,texture:bi});const Ci=A.createFramebuffer();A.bindFramebuffer(A.FRAMEBUFFER,Ci),A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,bi,0);const Ti=A.checkFramebufferStatus(A.FRAMEBUFFER);Ti!==A.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete: "+Ti);const Ei=ii.map(_r=>[_r[0],_r[1]]).flat(),hr=A.createTexture();A.activeTexture(A.TEXTURE2),Dg({gl:A,texture:hr,imageData:new Float32Array(Ei),width:Ei.length/2,height:1,wrap:A.CLAMP_TO_EDGE,filter:A.NEAREST,format:A.RG,internalFormat:A.RG32F,type:A.FLOAT}),A.uniform1i(st,2);const wr=Ue.map(_r=>{const{dec:Es,Hi:es}=AT(_r);return[-Es,es/10]}).flat(),on=A.createTexture();A.activeTexture(A.TEXTURE1),Dg({gl:A,texture:on,imageData:new Float32Array(wr),width:1,height:Ue.length,wrap:A.CLAMP_TO_EDGE,filter:A.NEAREST,format:A.RG,internalFormat:A.RG32F,type:A.FLOAT}),A.uniform1i(wi,1),Xt!==null&&(A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,Xt)),A.bindBuffer(A.ARRAY_BUFFER,Ce),A.enableVertexAttribArray(te),A.vertexAttribPointer(te,2,A.FLOAT,!1,0,0),A.bindBuffer(A.ARRAY_BUFFER,Fe),A.enableVertexAttribArray(de),A.vertexAttribPointer(de,2,A.FLOAT,!1,0,0),A.viewport(0,0,Lt,Ai),A.clear(A.COLOR_BUFFER_BIT),A.drawArrays(A.TRIANGLE_STRIP,0,4);const Jr=new Uint8Array(Lt*Ai*4);return A.readPixels(0,0,Lt,Ai,A.RGBA,A.UNSIGNED_BYTE,Jr),A.deleteTexture(bi),A.deleteTexture(on),A.deleteTexture(hr),A.deleteFramebuffer(Ci),A.uniform1i(wi,0),A.uniform1i(st,0),A.uniform1i(ir,0),A.uniform4fv(ui,ni),A.uniform4fv(ji,[0,0,0,0]),Jr},generateLocationShadeProfile:Et=>{A.useProgram(U);const{startTime:Ue,endTime:ii,tzId:Ht,texCoord:Jt,shadeColor:Lt,sunColor:Ai}=Et,ni=A.getUniform(U,ui),{outputWidth:bi,outputHeight:Ci}=ht({startTime:Ue,endTime:ii,tzId:Ht});A.uniform4fv(ui,Lt),A.uniform4fv(ji,Ai),A.uniform1i(Ar,1),A.uniform2fv(Br,[Jt[0],Jt[1]]);const Ti=A.createTexture();A.activeTexture(A.TEXTURE2),Dg({gl:A,imageData:null,width:bi,height:Ci,wrap:A.CLAMP_TO_EDGE,filter:A.NEAREST,format:A.RGBA,texture:Ti});const Ei=A.createFramebuffer();A.bindFramebuffer(A.FRAMEBUFFER,Ei),A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,Ti,0);const hr=A.checkFramebufferStatus(A.FRAMEBUFFER);hr!==A.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete: "+hr),Xt!==null&&(A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,Xt)),A.bindBuffer(A.ARRAY_BUFFER,Ce),A.enableVertexAttribArray(te),A.vertexAttribPointer(te,2,A.FLOAT,!1,0,0),A.bindBuffer(A.ARRAY_BUFFER,Fe),A.enableVertexAttribArray(de),A.vertexAttribPointer(de,2,A.FLOAT,!1,0,0),A.viewport(0,0,bi,Ci),A.clear(A.COLOR_BUFFER_BIT),A.drawArrays(A.TRIANGLE_STRIP,0,4);const wr=new Uint8Array(bi*Ci*4);return A.readPixels(0,0,bi,Ci,A.RGBA,A.UNSIGNED_BYTE,wr),A.deleteTexture(Ti),A.deleteFramebuffer(Ei),A.uniform1i(wi,0),A.uniform1i(Ar,0),A.uniform4fv(ui,ni),A.uniform4fv(ji,[0,0,0,0]),{output:wr,outputWidth:bi,outputHeight:Ci}}}}({context:this._gl,setRenderBuffer:(E,R,O)=>{const A=e.getSource(this.canvasSourceId).texture;E.activeTexture(E.TEXTURE1),A.bind(E.LINEAR,E.CLAMP_TO_EDGE),A.size=[R,O],E.texImage2D(E.TEXTURE_2D,0,E.RGBA,R,O,0,E.RGBA,E.UNSIGNED_BYTE,null),E.bindFramebuffer(E.FRAMEBUFFER,this._framebuffer),E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,A.texture,0),E.enable(E.BLEND),E.blendFunc(E.SRC_ALPHA,E.ONE_MINUS_SRC_ALPHA)}}),this._tileMerger=new VO(this._gl),this._canopyMerger=new VO(this._gl),this._buildingRasterizer=new Koe(this._gl),document.body.appendChild(this._canvas),this._canvas.style.display="none";const t=e.getBounds(),o=t.getNorthWest(),c=t.getNorthEast(),f=t.getSouthEast(),y=t.getSouthWest(),s=[[o.lng,o.lat],[c.lng,c.lat],[f.lng,f.lat],[y.lng,y.lat]];return e.addSource(this.canvasSourceId,{type:"canvas",canvas:this._canvas,coordinates:s,animate:!1}),e.addLayer({id:this.canvasLayerId,type:"raster",source:this.canvasSourceId,paint:{"raster-fade-duration":0}}),e.addSource(this.attributionSourceId,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"Point",coordinates:[-122.210598,47.769799]}},attribution:'<a href="https://shademap.app/about">&copy; ShadeMap</a>'}),e.addLayer({id:this.attributionLayerId,type:"fill",source:this.attributionSourceId}),this._map.on("moveend",this._moveEndHandler),this._moveEndHandler(),this}onRemove(){return this._map&&(this._map.off("moveend",this._moveEndHandler),this._map.removeLayer(this.attributionLayerId),this._map.removeLayer(this.canvasLayerId),this._map.removeSource(this.attributionSourceId),this._map.removeSource(this.canvasSourceId)),this._gl&&this._framebuffer&&this._gl.deleteFramebuffer(this._framebuffer),document.body.removeChild(this._canvas),this.options.debug("onRemove called"),this}_getHeightMapCoords(e,t){if(this._map&&this.options.sunExposure.enabled&&this._bounds&&this._heightMap){const o=this._map.unproject([e,t]);if(o.toString()===this._map.unproject([e,t+1]).toString())return new ps(-1,-1);const{visibleDEMPixelBounds:c,demZoom:f}=this._heightMap;return Gv(this._map).project(o,f).subtract(c.min)}return new ps(-1,-1)}getHoursOfSun(e,t){if(this.options.sunExposure.enabled){const o=this._getHeightMapCoords(e,t),c=this.readPixel(o.x,o.y),{startDate:f,endDate:y}=this.options.sunExposure,s=y.getTime()-f.getTime(),E=PA(c,.5,s);return Math.abs(E/1e3/3600)}return 0}remove(){this._map&&this._map.removeLayer(this.id)}readPixel(e,t){const o=new Uint8Array(4);if(this._map&&this._gl&&this._framebuffer){const c=this._gl,f=this._map.getSource(this.canvasSourceId).texture;c.activeTexture(c.TEXTURE1),f.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.bindFramebuffer(c.FRAMEBUFFER,this._framebuffer),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,f.texture,0),this._gl.readPixels(e,t,1,1,this._gl.RGBA,this._gl.UNSIGNED_BYTE,o)}return o}readPixels(e,t,o,c){const f=new Uint8Array(o*c*4);if(this._map&&this._gl&&this._framebuffer){const y=this._gl,s=this._map.getSource(this.canvasSourceId).texture;y.activeTexture(y.TEXTURE1),s.bind(y.LINEAR,y.CLAMP_TO_EDGE),y.bindFramebuffer(y.FRAMEBUFFER,this._framebuffer),y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,s.texture,0),this._gl.readPixels(e,t,o,c,this._gl.RGBA,this._gl.UNSIGNED_BYTE,f)}return f}_flush(){this._map&&this._map.getSource(this.canvasSourceId).fire({type:"data",dataType:"source",sourceDataType:"content"}),this.emit("idle")}_repositionCanvas(e){if(this._map){const t=this._map.getSource(this.canvasSourceId);if(t){const o=e.getNorthWest(),c=e.getNorthEast(),f=e.getSouthEast(),y=e.getSouthWest(),s=[[o.lng,o.lat],[c.lng,c.lat],[f.lng,f.lat],[y.lng,y.lat]];t.setCoordinates(s),this.emit("idle")}}return this}}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function OE(r){const e=new MouseEvent("click",{bubbles:!0});return r.dispatchEvent(e),e}function FE(r){return r.currentTarget!==r.target||r.composedPath()[0]!==r.target||r.target.disabled?!1:!Joe(r)}function Joe(r){const e=u4;return e&&(r.preventDefault(),r.stopImmediatePropagation()),Qoe(),e}let u4=!1;async function Qoe(){u4=!0,await null,u4=!1}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function px(r,e){e.bubbles&&(!r.shadowRoot||e.composed)&&e.stopPropagation();const t=Reflect.construct(e.constructor,[e.type,e]),o=r.dispatchEvent(t);return o||e.preventDefault(),o}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const mx=Symbol("createValidator"),_x=Symbol("getValidityAnchor"),MA=Symbol("privateValidator"),od=Symbol("privateSyncValidity"),Xw=Symbol("privateCustomValidationMessage");function WR(r){var e;class t extends r{constructor(){super(...arguments),this[e]=""}get validity(){return this[od](),this[pl].validity}get validationMessage(){return this[od](),this[pl].validationMessage}get willValidate(){return this[od](),this[pl].willValidate}checkValidity(){return this[od](),this[pl].checkValidity()}reportValidity(){return this[od](),this[pl].reportValidity()}setCustomValidity(c){this[Xw]=c,this[od]()}requestUpdate(c,f,y){super.requestUpdate(c,f,y),this[od]()}firstUpdated(c){super.firstUpdated(c),this[od]()}[(e=Xw,od)](){this[MA]||(this[MA]=this[mx]());const{validity:c,validationMessage:f}=this[MA].getValidity(),y=!!this[Xw],s=this[Xw]||f;this[pl].setValidity({...c,customError:y},s,this[_x]()??void 0)}[mx](){throw new Error("Implement [createValidator]")}[_x](){throw new Error("Implement [getValidityAnchor]")}}return t}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const _m=Symbol("getFormValue"),RT=Symbol("getFormState");function zE(r){class e extends r{get form(){return this[pl].form}get labels(){return this[pl].labels}get name(){return this.getAttribute("name")??""}set name(o){this.setAttribute("name",o)}get disabled(){return this.hasAttribute("disabled")}set disabled(o){this.toggleAttribute("disabled",o)}attributeChangedCallback(o,c,f){if(o==="name"||o==="disabled"){const y=o==="disabled"?c!==null:c;this.requestUpdate(o,y);return}super.attributeChangedCallback(o,c,f)}requestUpdate(o,c,f){super.requestUpdate(o,c,f),this[pl].setFormValue(this[_m](),this[RT]())}[_m](){throw new Error("Implement [getFormValue]")}[RT](){return this[_m]()}formDisabledCallback(o){this.disabled=o}}return e.formAssociated=!0,Nt([Mi({noAccessor:!0})],e.prototype,"name",null),Nt([Mi({type:Boolean,noAccessor:!0})],e.prototype,"disabled",null),e}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class I9{constructor(e){this.getCurrentState=e,this.currentValidity={validity:{},validationMessage:""}}getValidity(){const e=this.getCurrentState();if(!(!this.prevState||!this.equals(this.prevState,e)))return this.currentValidity;const{validity:o,validationMessage:c}=this.computeValidity(e);return this.prevState=this.copy(e),this.currentValidity={validationMessage:c,validity:{badInput:o.badInput,customError:o.customError,patternMismatch:o.patternMismatch,rangeOverflow:o.rangeOverflow,rangeUnderflow:o.rangeUnderflow,stepMismatch:o.stepMismatch,tooLong:o.tooLong,tooShort:o.tooShort,typeMismatch:o.typeMismatch,valueMissing:o.valueMissing}},this.currentValidity}}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class S9 extends I9{computeValidity(e){return this.checkboxControl||(this.checkboxControl=document.createElement("input"),this.checkboxControl.type="checkbox"),this.checkboxControl.checked=e.checked,this.checkboxControl.required=e.required,{validity:this.checkboxControl.validity,validationMessage:this.checkboxControl.validationMessage}}equals(e,t){return e.checked===t.checked&&e.required===t.required}copy({checked:e,required:t}){return{checked:e,required:t}}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const eae=WR(zE(X0(Uo)));class xu extends eae{constructor(){super(),this.checked=!1,this.indeterminate=!1,this.required=!1,this.value="on",this.prevChecked=!1,this.prevDisabled=!1,this.prevIndeterminate=!1,this.addEventListener("click",e=>{!FE(e)||!this.input||(this.focus(),OE(this.input))})}update(e){(e.has("checked")||e.has("disabled")||e.has("indeterminate"))&&(this.prevChecked=e.get("checked")??this.checked,this.prevDisabled=e.get("disabled")??this.disabled,this.prevIndeterminate=e.get("indeterminate")??this.indeterminate),super.update(e)}render(){const e=!this.prevChecked&&!this.prevIndeterminate,t=this.prevChecked&&!this.prevIndeterminate,o=this.prevIndeterminate,c=this.checked&&!this.indeterminate,f=this.indeterminate,y=Sl({disabled:this.disabled,selected:c||f,unselected:!c&&!f,checked:c,indeterminate:f,"prev-unselected":e,"prev-checked":t,"prev-indeterminate":o,"prev-disabled":this.prevDisabled}),{ariaLabel:s,ariaInvalid:E}=this;return Xr`
      <div class="container ${y}">
        <input
          type="checkbox"
          id="input"
          aria-checked=${f?"mixed":sr}
          aria-label=${s||sr}
          aria-invalid=${E||sr}
          ?disabled=${this.disabled}
          ?required=${this.required}
          .indeterminate=${this.indeterminate}
          .checked=${this.checked}
          @input=${this.handleInput}
          @change=${this.handleChange} />

        <div class="outline"></div>
        <div class="background"></div>
        <md-focus-ring part="focus-ring" for="input"></md-focus-ring>
        <md-ripple for="input" ?disabled=${this.disabled}></md-ripple>
        <svg class="icon" viewBox="0 0 18 18" aria-hidden="true">
          <rect class="mark short" />
          <rect class="mark long" />
        </svg>
      </div>
    `}handleInput(e){const t=e.target;this.checked=t.checked,this.indeterminate=t.indeterminate}handleChange(e){px(this,e)}[_m](){return!this.checked||this.indeterminate?null:this.value}[RT](){return String(this.checked)}formResetCallback(){this.checked=this.hasAttribute("checked")}formStateRestoreCallback(e){this.checked=e==="true"}[mx](){return new S9(()=>this)}[_x](){return this.input}}Km(xu);xu.shadowRootOptions={...Uo.shadowRootOptions,delegatesFocus:!0};Nt([Mi({type:Boolean})],xu.prototype,"checked",void 0);Nt([Mi({type:Boolean})],xu.prototype,"indeterminate",void 0);Nt([Mi({type:Boolean})],xu.prototype,"required",void 0);Nt([Mi()],xu.prototype,"value",void 0);Nt([jo()],xu.prototype,"prevChecked",void 0);Nt([jo()],xu.prototype,"prevDisabled",void 0);Nt([jo()],xu.prototype,"prevIndeterminate",void 0);Nt([lc("input")],xu.prototype,"input",void 0);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const tae=ho`:host{border-start-start-radius:var(--md-checkbox-container-shape-start-start, var(--md-checkbox-container-shape, 2px));border-start-end-radius:var(--md-checkbox-container-shape-start-end, var(--md-checkbox-container-shape, 2px));border-end-end-radius:var(--md-checkbox-container-shape-end-end, var(--md-checkbox-container-shape, 2px));border-end-start-radius:var(--md-checkbox-container-shape-end-start, var(--md-checkbox-container-shape, 2px));display:inline-flex;height:var(--md-checkbox-container-size, 18px);position:relative;vertical-align:top;width:var(--md-checkbox-container-size, 18px);-webkit-tap-highlight-color:rgba(0,0,0,0);cursor:pointer}:host([disabled]){cursor:default}:host([touch-target=wrapper]){margin:max(0px,(48px - var(--md-checkbox-container-size, 18px))/2)}md-focus-ring{height:44px;inset:unset;width:44px}input{appearance:none;height:48px;margin:0;opacity:0;outline:none;position:absolute;width:48px;z-index:1;cursor:inherit}:host([touch-target=none]) input{height:100%;width:100%}.container{border-radius:inherit;display:flex;height:100%;place-content:center;place-items:center;position:relative;width:100%}.outline,.background,.icon{inset:0;position:absolute}.outline,.background{border-radius:inherit}.outline{border-color:var(--md-checkbox-outline-color, var(--md-sys-color-on-surface-variant, #49454f));border-style:solid;border-width:var(--md-checkbox-outline-width, 2px);box-sizing:border-box}.background{background-color:var(--md-checkbox-selected-container-color, var(--md-sys-color-primary, #6750a4))}.background,.icon{opacity:0;transition-duration:150ms,50ms;transition-property:transform,opacity;transition-timing-function:cubic-bezier(0.3, 0, 0.8, 0.15),linear;transform:scale(0.6)}:where(.selected) :is(.background,.icon){opacity:1;transition-duration:350ms,50ms;transition-timing-function:cubic-bezier(0.05, 0.7, 0.1, 1),linear;transform:scale(1)}md-ripple{border-radius:var(--md-checkbox-state-layer-shape, var(--md-sys-shape-corner-full, 9999px));height:var(--md-checkbox-state-layer-size, 40px);inset:unset;width:var(--md-checkbox-state-layer-size, 40px);--md-ripple-hover-color: var(--md-checkbox-hover-state-layer-color, var(--md-sys-color-on-surface, #1d1b20));--md-ripple-hover-opacity: var(--md-checkbox-hover-state-layer-opacity, 0.08);--md-ripple-pressed-color: var(--md-checkbox-pressed-state-layer-color, var(--md-sys-color-primary, #6750a4));--md-ripple-pressed-opacity: var(--md-checkbox-pressed-state-layer-opacity, 0.12)}.selected md-ripple{--md-ripple-hover-color: var(--md-checkbox-selected-hover-state-layer-color, var(--md-sys-color-primary, #6750a4));--md-ripple-hover-opacity: var(--md-checkbox-selected-hover-state-layer-opacity, 0.08);--md-ripple-pressed-color: var(--md-checkbox-selected-pressed-state-layer-color, var(--md-sys-color-on-surface, #1d1b20));--md-ripple-pressed-opacity: var(--md-checkbox-selected-pressed-state-layer-opacity, 0.12)}.icon{fill:var(--md-checkbox-selected-icon-color, var(--md-sys-color-on-primary, #fff));height:var(--md-checkbox-icon-size, 18px);width:var(--md-checkbox-icon-size, 18px)}.mark.short{height:2px;transition-property:transform,height;width:2px}.mark.long{height:2px;transition-property:transform,width;width:10px}.mark{animation-duration:150ms;animation-timing-function:cubic-bezier(0.3, 0, 0.8, 0.15);transition-duration:150ms;transition-timing-function:cubic-bezier(0.3, 0, 0.8, 0.15)}.selected .mark{animation-duration:350ms;animation-timing-function:cubic-bezier(0.05, 0.7, 0.1, 1);transition-duration:350ms;transition-timing-function:cubic-bezier(0.05, 0.7, 0.1, 1)}.checked .mark,.prev-checked.unselected .mark{transform:scaleY(-1) translate(7px, -14px) rotate(45deg)}.checked .mark.short,.prev-checked.unselected .mark.short{height:5.6568542495px}.checked .mark.long,.prev-checked.unselected .mark.long{width:11.313708499px}.indeterminate .mark,.prev-indeterminate.unselected .mark{transform:scaleY(-1) translate(4px, -10px) rotate(0deg)}.prev-unselected .mark{transition-property:none}.prev-unselected.checked .mark.long{animation-name:prev-unselected-to-checked}@keyframes prev-unselected-to-checked{from{width:0}}:where(:hover) .outline{border-color:var(--md-checkbox-hover-outline-color, var(--md-sys-color-on-surface, #1d1b20));border-width:var(--md-checkbox-hover-outline-width, 2px)}:where(:hover) .background{background:var(--md-checkbox-selected-hover-container-color, var(--md-sys-color-primary, #6750a4))}:where(:hover) .icon{fill:var(--md-checkbox-selected-hover-icon-color, var(--md-sys-color-on-primary, #fff))}:where(:focus-within) .outline{border-color:var(--md-checkbox-focus-outline-color, var(--md-sys-color-on-surface, #1d1b20));border-width:var(--md-checkbox-focus-outline-width, 2px)}:where(:focus-within) .background{background:var(--md-checkbox-selected-focus-container-color, var(--md-sys-color-primary, #6750a4))}:where(:focus-within) .icon{fill:var(--md-checkbox-selected-focus-icon-color, var(--md-sys-color-on-primary, #fff))}:where(:active) .outline{border-color:var(--md-checkbox-pressed-outline-color, var(--md-sys-color-on-surface, #1d1b20));border-width:var(--md-checkbox-pressed-outline-width, 2px)}:where(:active) .background{background:var(--md-checkbox-selected-pressed-container-color, var(--md-sys-color-primary, #6750a4))}:where(:active) .icon{fill:var(--md-checkbox-selected-pressed-icon-color, var(--md-sys-color-on-primary, #fff))}:where(.disabled,.prev-disabled) :is(.background,.icon,.mark){animation-duration:0s;transition-duration:0s}:where(.disabled) .outline{border-color:var(--md-checkbox-disabled-outline-color, var(--md-sys-color-on-surface, #1d1b20));border-width:var(--md-checkbox-disabled-outline-width, 2px);opacity:var(--md-checkbox-disabled-container-opacity, 0.38)}:where(.selected.disabled) .outline{visibility:hidden}:where(.selected.disabled) .background{background:var(--md-checkbox-selected-disabled-container-color, var(--md-sys-color-on-surface, #1d1b20));opacity:var(--md-checkbox-selected-disabled-container-opacity, 0.38)}:where(.disabled) .icon{fill:var(--md-checkbox-selected-disabled-icon-color, var(--md-sys-color-surface, #fef7ff))}@media(forced-colors: active){.background{background-color:CanvasText}.selected.disabled .background{background-color:GrayText;opacity:1}.outline{border-color:CanvasText}.disabled .outline{border-color:GrayText;opacity:1}.icon{fill:Canvas}}
`;/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let h4=class extends xu{};h4.styles=[tae];h4=Nt([Xa("md-checkbox")],h4);const iae={class:"optional-field"},rae={class:"check-and-label"},nae=["name"],sae=["for"],oae=wa({__name:"OptionalField",props:{label:{}},emits:["checkbox-changed"],setup(r,{emit:e}){const t=r,o=e,c=fa(()=>t.label.toLowerCase().replace(" ","-")),f=Qn(!1);function y(){f.value=!f.value,o("checkbox-changed",f.value)}return(s,E)=>(Pr(),Qr("div",iae,[mr("div",rae,[mr("md-checkbox",{name:c.value,onChange:y},null,40,nae),mr("label",{for:c.value},ms(s.label),9,sae)]),f.value?nq(s.$slots,"default",{key:0,class:"content"},void 0):pu("",!0)]))}}),C0=cc(oae,[["__scopeId","data-v-fef957e3"]]);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class fo extends Uo{constructor(){super(...arguments),this.disabled=!1,this.error=!1,this.focused=!1,this.label="",this.noAsterisk=!1,this.populated=!1,this.required=!1,this.resizable=!1,this.supportingText="",this.errorText="",this.count=-1,this.max=-1,this.hasStart=!1,this.hasEnd=!1,this.isAnimating=!1,this.refreshErrorAlert=!1,this.disableTransitions=!1}get counterText(){const e=this.count??-1,t=this.max??-1;return e<0||t<=0?"":`${e} / ${t}`}get supportingOrErrorText(){return this.error&&this.errorText?this.errorText:this.supportingText}reannounceError(){this.refreshErrorAlert=!0}update(e){e.has("disabled")&&e.get("disabled")!==void 0&&(this.disableTransitions=!0),this.disabled&&this.focused&&(e.set("focused",!0),this.focused=!1),this.animateLabelIfNeeded({wasFocused:e.get("focused"),wasPopulated:e.get("populated")}),super.update(e)}render(){var f,y,s;const e=this.renderLabel(!0),t=this.renderLabel(!1),o=(f=this.renderOutline)==null?void 0:f.call(this,e),c={disabled:this.disabled,"disable-transitions":this.disableTransitions,error:this.error&&!this.disabled,focused:this.focused,"with-start":this.hasStart,"with-end":this.hasEnd,populated:this.populated,resizable:this.resizable,required:this.required,"no-label":!this.label};return Xr`
      <div class="field ${Sl(c)}">
        <div class="container-overflow">
          ${(y=this.renderBackground)==null?void 0:y.call(this)} ${(s=this.renderIndicator)==null?void 0:s.call(this)} ${o}
          <div class="container">
            <div class="start">
              <slot name="start"></slot>
            </div>
            <div class="middle">
              <div class="label-wrapper">
                ${t} ${o?sr:e}
              </div>
              <div class="content">
                <slot></slot>
              </div>
            </div>
            <div class="end">
              <slot name="end"></slot>
            </div>
          </div>
        </div>
        ${this.renderSupportingText()}
      </div>
    `}updated(e){(e.has("supportingText")||e.has("errorText")||e.has("count")||e.has("max"))&&this.updateSlottedAriaDescribedBy(),this.refreshErrorAlert&&requestAnimationFrame(()=>{this.refreshErrorAlert=!1}),this.disableTransitions&&requestAnimationFrame(()=>{this.disableTransitions=!1})}renderSupportingText(){const{supportingOrErrorText:e,counterText:t}=this;if(!e&&!t)return sr;const o=Xr`<span>${e}</span>`,c=t?Xr`<span class="counter">${t}</span>`:sr,y=this.error&&this.errorText&&!this.refreshErrorAlert?"alert":sr;return Xr`
      <div class="supporting-text" role=${y}>${o}${c}</div>
      <slot
        name="aria-describedby"
        @slotchange=${this.updateSlottedAriaDescribedBy}></slot>
    `}updateSlottedAriaDescribedBy(){for(const e of this.slottedAriaDescribedBy)c9(Xr`${this.supportingOrErrorText} ${this.counterText}`,e),e.setAttribute("hidden","")}renderLabel(e){if(!this.label)return sr;let t;e?t=this.focused||this.populated||this.isAnimating:t=!this.focused&&!this.populated&&!this.isAnimating;const o={hidden:!t,floating:e,resting:!e},c=`${this.label}${this.required&&!this.noAsterisk?"*":""}`;return Xr`
      <span class="label ${Sl(o)}" aria-hidden=${!t}
        >${c}</span
      >
    `}animateLabelIfNeeded({wasFocused:e,wasPopulated:t}){var f,y,s;if(!this.label)return;e??(e=this.focused),t??(t=this.populated);const o=e||t,c=this.focused||this.populated;o!==c&&(this.isAnimating=!0,(f=this.labelAnimation)==null||f.cancel(),this.labelAnimation=(y=this.floatingLabelEl)==null?void 0:y.animate(this.getLabelKeyframes(),{duration:150,easing:d9.STANDARD}),(s=this.labelAnimation)==null||s.addEventListener("finish",()=>{this.isAnimating=!1}))}getLabelKeyframes(){const{floatingLabelEl:e,restingLabelEl:t}=this;if(!e||!t)return[];const{x:o,y:c,height:f}=e.getBoundingClientRect(),{x:y,y:s,height:E}=t.getBoundingClientRect(),R=e.scrollWidth,O=t.scrollWidth,A=O/R,U=y-o,$=s-c+Math.round((E-f*A)/2),te=`translateX(${U}px) translateY(${$}px) scale(${A})`,Q="translateX(0) translateY(0) scale(1)",de=t.clientWidth,Fe=O>de?`${de/A}px`:"";return this.focused||this.populated?[{transform:te,width:Fe},{transform:Q,width:Fe}]:[{transform:Q,width:Fe},{transform:te,width:Fe}]}getSurfacePositionClientRect(){return this.containerEl.getBoundingClientRect()}}Nt([Mi({type:Boolean})],fo.prototype,"disabled",void 0);Nt([Mi({type:Boolean})],fo.prototype,"error",void 0);Nt([Mi({type:Boolean})],fo.prototype,"focused",void 0);Nt([Mi()],fo.prototype,"label",void 0);Nt([Mi({type:Boolean,attribute:"no-asterisk"})],fo.prototype,"noAsterisk",void 0);Nt([Mi({type:Boolean})],fo.prototype,"populated",void 0);Nt([Mi({type:Boolean})],fo.prototype,"required",void 0);Nt([Mi({type:Boolean})],fo.prototype,"resizable",void 0);Nt([Mi({attribute:"supporting-text"})],fo.prototype,"supportingText",void 0);Nt([Mi({attribute:"error-text"})],fo.prototype,"errorText",void 0);Nt([Mi({type:Number})],fo.prototype,"count",void 0);Nt([Mi({type:Number})],fo.prototype,"max",void 0);Nt([Mi({type:Boolean,attribute:"has-start"})],fo.prototype,"hasStart",void 0);Nt([Mi({type:Boolean,attribute:"has-end"})],fo.prototype,"hasEnd",void 0);Nt([ME({slot:"aria-describedby"})],fo.prototype,"slottedAriaDescribedBy",void 0);Nt([jo()],fo.prototype,"isAnimating",void 0);Nt([jo()],fo.prototype,"refreshErrorAlert",void 0);Nt([jo()],fo.prototype,"disableTransitions",void 0);Nt([lc(".label.floating")],fo.prototype,"floatingLabelEl",void 0);Nt([lc(".label.resting")],fo.prototype,"restingLabelEl",void 0);Nt([lc(".container")],fo.prototype,"containerEl",void 0);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class aae extends fo{renderOutline(e){return Xr`
      <div class="outline">
        <div class="outline-start"></div>
        <div class="outline-notch">
          <div class="outline-panel-inactive"></div>
          <div class="outline-panel-active"></div>
          <div class="outline-label">${e}</div>
        </div>
        <div class="outline-end"></div>
      </div>
    `}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const lae=ho`@layer styles{:host{--_bottom-space: var(--md-outlined-field-bottom-space, 16px);--_content-color: var(--md-outlined-field-content-color, var(--md-sys-color-on-surface, #1d1b20));--_content-font: var(--md-outlined-field-content-font, var(--md-sys-typescale-body-large-font, var(--md-ref-typeface-plain, Roboto)));--_content-line-height: var(--md-outlined-field-content-line-height, var(--md-sys-typescale-body-large-line-height, 1.5rem));--_content-size: var(--md-outlined-field-content-size, var(--md-sys-typescale-body-large-size, 1rem));--_content-weight: var(--md-outlined-field-content-weight, var(--md-sys-typescale-body-large-weight, var(--md-ref-typeface-weight-regular, 400)));--_disabled-content-color: var(--md-outlined-field-disabled-content-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-content-opacity: var(--md-outlined-field-disabled-content-opacity, 0.38);--_disabled-label-text-color: var(--md-outlined-field-disabled-label-text-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-label-text-opacity: var(--md-outlined-field-disabled-label-text-opacity, 0.38);--_disabled-leading-content-color: var(--md-outlined-field-disabled-leading-content-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-leading-content-opacity: var(--md-outlined-field-disabled-leading-content-opacity, 0.38);--_disabled-outline-color: var(--md-outlined-field-disabled-outline-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-outline-opacity: var(--md-outlined-field-disabled-outline-opacity, 0.12);--_disabled-outline-width: var(--md-outlined-field-disabled-outline-width, 1px);--_disabled-supporting-text-color: var(--md-outlined-field-disabled-supporting-text-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-supporting-text-opacity: var(--md-outlined-field-disabled-supporting-text-opacity, 0.38);--_disabled-trailing-content-color: var(--md-outlined-field-disabled-trailing-content-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-trailing-content-opacity: var(--md-outlined-field-disabled-trailing-content-opacity, 0.38);--_error-content-color: var(--md-outlined-field-error-content-color, var(--md-sys-color-on-surface, #1d1b20));--_error-focus-content-color: var(--md-outlined-field-error-focus-content-color, var(--md-sys-color-on-surface, #1d1b20));--_error-focus-label-text-color: var(--md-outlined-field-error-focus-label-text-color, var(--md-sys-color-error, #b3261e));--_error-focus-leading-content-color: var(--md-outlined-field-error-focus-leading-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_error-focus-outline-color: var(--md-outlined-field-error-focus-outline-color, var(--md-sys-color-error, #b3261e));--_error-focus-supporting-text-color: var(--md-outlined-field-error-focus-supporting-text-color, var(--md-sys-color-error, #b3261e));--_error-focus-trailing-content-color: var(--md-outlined-field-error-focus-trailing-content-color, var(--md-sys-color-error, #b3261e));--_error-hover-content-color: var(--md-outlined-field-error-hover-content-color, var(--md-sys-color-on-surface, #1d1b20));--_error-hover-label-text-color: var(--md-outlined-field-error-hover-label-text-color, var(--md-sys-color-on-error-container, #410e0b));--_error-hover-leading-content-color: var(--md-outlined-field-error-hover-leading-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_error-hover-outline-color: var(--md-outlined-field-error-hover-outline-color, var(--md-sys-color-on-error-container, #410e0b));--_error-hover-supporting-text-color: var(--md-outlined-field-error-hover-supporting-text-color, var(--md-sys-color-error, #b3261e));--_error-hover-trailing-content-color: var(--md-outlined-field-error-hover-trailing-content-color, var(--md-sys-color-on-error-container, #410e0b));--_error-label-text-color: var(--md-outlined-field-error-label-text-color, var(--md-sys-color-error, #b3261e));--_error-leading-content-color: var(--md-outlined-field-error-leading-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_error-outline-color: var(--md-outlined-field-error-outline-color, var(--md-sys-color-error, #b3261e));--_error-supporting-text-color: var(--md-outlined-field-error-supporting-text-color, var(--md-sys-color-error, #b3261e));--_error-trailing-content-color: var(--md-outlined-field-error-trailing-content-color, var(--md-sys-color-error, #b3261e));--_focus-content-color: var(--md-outlined-field-focus-content-color, var(--md-sys-color-on-surface, #1d1b20));--_focus-label-text-color: var(--md-outlined-field-focus-label-text-color, var(--md-sys-color-primary, #6750a4));--_focus-leading-content-color: var(--md-outlined-field-focus-leading-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_focus-outline-color: var(--md-outlined-field-focus-outline-color, var(--md-sys-color-primary, #6750a4));--_focus-outline-width: var(--md-outlined-field-focus-outline-width, 3px);--_focus-supporting-text-color: var(--md-outlined-field-focus-supporting-text-color, var(--md-sys-color-on-surface-variant, #49454f));--_focus-trailing-content-color: var(--md-outlined-field-focus-trailing-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-content-color: var(--md-outlined-field-hover-content-color, var(--md-sys-color-on-surface, #1d1b20));--_hover-label-text-color: var(--md-outlined-field-hover-label-text-color, var(--md-sys-color-on-surface, #1d1b20));--_hover-leading-content-color: var(--md-outlined-field-hover-leading-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-outline-color: var(--md-outlined-field-hover-outline-color, var(--md-sys-color-on-surface, #1d1b20));--_hover-outline-width: var(--md-outlined-field-hover-outline-width, 1px);--_hover-supporting-text-color: var(--md-outlined-field-hover-supporting-text-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-trailing-content-color: var(--md-outlined-field-hover-trailing-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_label-text-color: var(--md-outlined-field-label-text-color, var(--md-sys-color-on-surface-variant, #49454f));--_label-text-font: var(--md-outlined-field-label-text-font, var(--md-sys-typescale-body-large-font, var(--md-ref-typeface-plain, Roboto)));--_label-text-line-height: var(--md-outlined-field-label-text-line-height, var(--md-sys-typescale-body-large-line-height, 1.5rem));--_label-text-padding-bottom: var(--md-outlined-field-label-text-padding-bottom, 8px);--_label-text-populated-line-height: var(--md-outlined-field-label-text-populated-line-height, var(--md-sys-typescale-body-small-line-height, 1rem));--_label-text-populated-size: var(--md-outlined-field-label-text-populated-size, var(--md-sys-typescale-body-small-size, 0.75rem));--_label-text-size: var(--md-outlined-field-label-text-size, var(--md-sys-typescale-body-large-size, 1rem));--_label-text-weight: var(--md-outlined-field-label-text-weight, var(--md-sys-typescale-body-large-weight, var(--md-ref-typeface-weight-regular, 400)));--_leading-content-color: var(--md-outlined-field-leading-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_leading-space: var(--md-outlined-field-leading-space, 16px);--_outline-color: var(--md-outlined-field-outline-color, var(--md-sys-color-outline, #79747e));--_outline-label-padding: var(--md-outlined-field-outline-label-padding, 4px);--_outline-width: var(--md-outlined-field-outline-width, 1px);--_supporting-text-color: var(--md-outlined-field-supporting-text-color, var(--md-sys-color-on-surface-variant, #49454f));--_supporting-text-font: var(--md-outlined-field-supporting-text-font, var(--md-sys-typescale-body-small-font, var(--md-ref-typeface-plain, Roboto)));--_supporting-text-leading-space: var(--md-outlined-field-supporting-text-leading-space, 16px);--_supporting-text-line-height: var(--md-outlined-field-supporting-text-line-height, var(--md-sys-typescale-body-small-line-height, 1rem));--_supporting-text-size: var(--md-outlined-field-supporting-text-size, var(--md-sys-typescale-body-small-size, 0.75rem));--_supporting-text-top-space: var(--md-outlined-field-supporting-text-top-space, 4px);--_supporting-text-trailing-space: var(--md-outlined-field-supporting-text-trailing-space, 16px);--_supporting-text-weight: var(--md-outlined-field-supporting-text-weight, var(--md-sys-typescale-body-small-weight, var(--md-ref-typeface-weight-regular, 400)));--_top-space: var(--md-outlined-field-top-space, 16px);--_trailing-content-color: var(--md-outlined-field-trailing-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_trailing-space: var(--md-outlined-field-trailing-space, 16px);--_container-shape-start-start: var(--md-outlined-field-container-shape-start-start, var(--md-outlined-field-container-shape, var(--md-sys-shape-corner-extra-small, 4px)));--_container-shape-start-end: var(--md-outlined-field-container-shape-start-end, var(--md-outlined-field-container-shape, var(--md-sys-shape-corner-extra-small, 4px)));--_container-shape-end-end: var(--md-outlined-field-container-shape-end-end, var(--md-outlined-field-container-shape, var(--md-sys-shape-corner-extra-small, 4px)));--_container-shape-end-start: var(--md-outlined-field-container-shape-end-start, var(--md-outlined-field-container-shape, var(--md-sys-shape-corner-extra-small, 4px)))}.outline{border-color:var(--_outline-color);border-radius:inherit;display:flex;pointer-events:none;height:100%;position:absolute;width:100%;z-index:1}.outline-start::before,.outline-start::after,.outline-panel-inactive::before,.outline-panel-inactive::after,.outline-panel-active::before,.outline-panel-active::after,.outline-end::before,.outline-end::after{border:inherit;content:"";inset:0;position:absolute}.outline-start,.outline-end{border:inherit;border-radius:inherit;box-sizing:border-box;position:relative}.outline-start::before,.outline-start::after,.outline-end::before,.outline-end::after{border-bottom-style:solid;border-top-style:solid}.outline-start::after,.outline-end::after{opacity:0;transition:opacity 150ms cubic-bezier(0.2, 0, 0, 1)}.focused .outline-start::after,.focused .outline-end::after{opacity:1}.outline-start::before,.outline-start::after{border-inline-start-style:solid;border-inline-end-style:none;border-start-start-radius:inherit;border-start-end-radius:0;border-end-start-radius:inherit;border-end-end-radius:0;margin-inline-end:var(--_outline-label-padding)}.outline-end{flex-grow:1;margin-inline-start:calc(-1*var(--_outline-label-padding))}.outline-end::before,.outline-end::after{border-inline-start-style:none;border-inline-end-style:solid;border-start-start-radius:0;border-start-end-radius:inherit;border-end-start-radius:0;border-end-end-radius:inherit}.outline-notch{align-items:flex-start;border:inherit;display:flex;margin-inline-start:calc(-1*var(--_outline-label-padding));margin-inline-end:var(--_outline-label-padding);max-width:calc(100% - var(--_leading-space) - var(--_trailing-space));padding:0 var(--_outline-label-padding);position:relative}.no-label .outline-notch{display:none}.outline-panel-inactive,.outline-panel-active{border:inherit;border-bottom-style:solid;inset:0;position:absolute}.outline-panel-inactive::before,.outline-panel-inactive::after,.outline-panel-active::before,.outline-panel-active::after{border-top-style:solid;border-bottom:none;bottom:auto;transform:scaleX(1);transition:transform 150ms cubic-bezier(0.2, 0, 0, 1)}.outline-panel-inactive::before,.outline-panel-active::before{right:50%;transform-origin:top left}.outline-panel-inactive::after,.outline-panel-active::after{left:50%;transform-origin:top right}.populated .outline-panel-inactive::before,.populated .outline-panel-inactive::after,.populated .outline-panel-active::before,.populated .outline-panel-active::after,.focused .outline-panel-inactive::before,.focused .outline-panel-inactive::after,.focused .outline-panel-active::before,.focused .outline-panel-active::after{transform:scaleX(0)}.outline-panel-active{opacity:0;transition:opacity 150ms cubic-bezier(0.2, 0, 0, 1)}.focused .outline-panel-active{opacity:1}.outline-label{display:flex;max-width:100%;transform:translateY(calc(-100% + var(--_label-text-padding-bottom)))}.outline-start,.field:not(.with-start) .content ::slotted(*){padding-inline-start:max(var(--_leading-space),max(var(--_container-shape-start-start),var(--_container-shape-end-start)) + var(--_outline-label-padding))}.field:not(.with-start) .label-wrapper{margin-inline-start:max(var(--_leading-space),max(var(--_container-shape-start-start),var(--_container-shape-end-start)) + var(--_outline-label-padding))}.field:not(.with-end) .content ::slotted(*){padding-inline-end:max(var(--_trailing-space),max(var(--_container-shape-start-end),var(--_container-shape-end-end)))}.field:not(.with-end) .label-wrapper{margin-inline-end:max(var(--_trailing-space),max(var(--_container-shape-start-end),var(--_container-shape-end-end)))}.outline-start::before,.outline-end::before,.outline-panel-inactive,.outline-panel-inactive::before,.outline-panel-inactive::after{border-width:var(--_outline-width)}:hover .outline{border-color:var(--_hover-outline-color);color:var(--_hover-outline-color)}:hover .outline-start::before,:hover .outline-end::before,:hover .outline-panel-inactive,:hover .outline-panel-inactive::before,:hover .outline-panel-inactive::after{border-width:var(--_hover-outline-width)}.focused .outline{border-color:var(--_focus-outline-color);color:var(--_focus-outline-color)}.outline-start::after,.outline-end::after,.outline-panel-active,.outline-panel-active::before,.outline-panel-active::after{border-width:var(--_focus-outline-width)}.disabled .outline{border-color:var(--_disabled-outline-color);color:var(--_disabled-outline-color)}.disabled .outline-start,.disabled .outline-end,.disabled .outline-panel-inactive{opacity:var(--_disabled-outline-opacity)}.disabled .outline-start::before,.disabled .outline-end::before,.disabled .outline-panel-inactive,.disabled .outline-panel-inactive::before,.disabled .outline-panel-inactive::after{border-width:var(--_disabled-outline-width)}.error .outline{border-color:var(--_error-outline-color);color:var(--_error-outline-color)}.error:hover .outline{border-color:var(--_error-hover-outline-color);color:var(--_error-hover-outline-color)}.error.focused .outline{border-color:var(--_error-focus-outline-color);color:var(--_error-focus-outline-color)}.resizable .container{bottom:var(--_focus-outline-width);inset-inline-end:var(--_focus-outline-width);clip-path:inset(var(--_focus-outline-width) 0 0 var(--_focus-outline-width))}.resizable .container>*{top:var(--_focus-outline-width);inset-inline-start:var(--_focus-outline-width)}.resizable .container:dir(rtl){clip-path:inset(var(--_focus-outline-width) var(--_focus-outline-width) 0 0)}}@layer hcm{@media(forced-colors: active){.disabled .outline{border-color:GrayText;color:GrayText}.disabled :is(.outline-start,.outline-end,.outline-panel-inactive){opacity:1}}}
`;/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const cae=ho`:host{display:inline-flex;resize:both}.field{display:flex;flex:1;flex-direction:column;writing-mode:horizontal-tb;max-width:100%}.container-overflow{border-start-start-radius:var(--_container-shape-start-start);border-start-end-radius:var(--_container-shape-start-end);border-end-end-radius:var(--_container-shape-end-end);border-end-start-radius:var(--_container-shape-end-start);display:flex;height:100%;position:relative}.container{align-items:center;border-radius:inherit;display:flex;flex:1;max-height:100%;min-height:100%;min-width:min-content;position:relative}.field,.container-overflow{resize:inherit}.resizable:not(.disabled) .container{resize:inherit;overflow:hidden}.disabled{pointer-events:none}@layer styles{.start,.middle,.end{display:flex;box-sizing:border-box;height:100%;position:relative}.start{color:var(--_leading-content-color)}.end{color:var(--_trailing-content-color)}.start,.end{align-items:center;justify-content:center}.with-start .start,.with-end .end{min-width:48px}.with-start .start{margin-inline-end:4px}.with-end .end{margin-inline-start:4px}.middle{align-items:stretch;align-self:baseline;flex:1}.content{color:var(--_content-color);display:flex;flex:1;opacity:0;transition:opacity 83ms cubic-bezier(0.2, 0, 0, 1)}.no-label .content,.focused .content,.populated .content{opacity:1;transition-delay:67ms}:is(.disabled,.disable-transitions) .content{transition:none}.content ::slotted(*){all:unset;color:currentColor;font-family:var(--_content-font);font-size:var(--_content-size);line-height:var(--_content-line-height);font-weight:var(--_content-weight);width:100%;overflow-wrap:revert;white-space:revert}.content ::slotted(:not(textarea)){padding-top:var(--_top-space);padding-bottom:var(--_bottom-space)}.content ::slotted(textarea){margin-top:var(--_top-space);margin-bottom:var(--_bottom-space)}:hover .content{color:var(--_hover-content-color)}:hover .start{color:var(--_hover-leading-content-color)}:hover .end{color:var(--_hover-trailing-content-color)}.focused .content{color:var(--_focus-content-color)}.focused .start{color:var(--_focus-leading-content-color)}.focused .end{color:var(--_focus-trailing-content-color)}.disabled .content{color:var(--_disabled-content-color)}.disabled.no-label .content,.disabled.focused .content,.disabled.populated .content{opacity:var(--_disabled-content-opacity)}.disabled .start{color:var(--_disabled-leading-content-color);opacity:var(--_disabled-leading-content-opacity)}.disabled .end{color:var(--_disabled-trailing-content-color);opacity:var(--_disabled-trailing-content-opacity)}.error .content{color:var(--_error-content-color)}.error .start{color:var(--_error-leading-content-color)}.error .end{color:var(--_error-trailing-content-color)}.error:hover .content{color:var(--_error-hover-content-color)}.error:hover .start{color:var(--_error-hover-leading-content-color)}.error:hover .end{color:var(--_error-hover-trailing-content-color)}.error.focused .content{color:var(--_error-focus-content-color)}.error.focused .start{color:var(--_error-focus-leading-content-color)}.error.focused .end{color:var(--_error-focus-trailing-content-color)}}@layer hcm{@media(forced-colors: active){.disabled :is(.start,.content,.end){color:GrayText;opacity:1}}}@layer styles{.label{box-sizing:border-box;color:var(--_label-text-color);overflow:hidden;max-width:100%;text-overflow:ellipsis;white-space:nowrap;z-index:1;font-family:var(--_label-text-font);font-size:var(--_label-text-size);line-height:var(--_label-text-line-height);font-weight:var(--_label-text-weight);width:min-content}.label-wrapper{inset:0;pointer-events:none;position:absolute}.label.resting{position:absolute;top:var(--_top-space)}.label.floating{font-size:var(--_label-text-populated-size);line-height:var(--_label-text-populated-line-height);transform-origin:top left}.label.hidden{opacity:0}.no-label .label{display:none}.label-wrapper{inset:0;position:absolute;text-align:initial}:hover .label{color:var(--_hover-label-text-color)}.focused .label{color:var(--_focus-label-text-color)}.disabled .label{color:var(--_disabled-label-text-color)}.disabled .label:not(.hidden){opacity:var(--_disabled-label-text-opacity)}.error .label{color:var(--_error-label-text-color)}.error:hover .label{color:var(--_error-hover-label-text-color)}.error.focused .label{color:var(--_error-focus-label-text-color)}}@layer hcm{@media(forced-colors: active){.disabled .label:not(.hidden){color:GrayText;opacity:1}}}@layer styles{.supporting-text{color:var(--_supporting-text-color);display:flex;font-family:var(--_supporting-text-font);font-size:var(--_supporting-text-size);line-height:var(--_supporting-text-line-height);font-weight:var(--_supporting-text-weight);gap:16px;justify-content:space-between;padding-inline-start:var(--_supporting-text-leading-space);padding-inline-end:var(--_supporting-text-trailing-space);padding-top:var(--_supporting-text-top-space)}.supporting-text :nth-child(2){flex-shrink:0}:hover .supporting-text{color:var(--_hover-supporting-text-color)}.focus .supporting-text{color:var(--_focus-supporting-text-color)}.disabled .supporting-text{color:var(--_disabled-supporting-text-color);opacity:var(--_disabled-supporting-text-opacity)}.error .supporting-text{color:var(--_error-supporting-text-color)}.error:hover .supporting-text{color:var(--_error-hover-supporting-text-color)}.error.focus .supporting-text{color:var(--_error-focus-supporting-text-color)}}@layer hcm{@media(forced-colors: active){.disabled .supporting-text{color:GrayText;opacity:1}}}
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let d4=class extends aae{};d4.styles=[cae,lae];d4=Nt([Xa("md-outlined-field")],d4);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const uae=ho`:host{--_caret-color: var(--md-outlined-text-field-caret-color, var(--md-sys-color-primary, #6750a4));--_disabled-input-text-color: var(--md-outlined-text-field-disabled-input-text-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-input-text-opacity: var(--md-outlined-text-field-disabled-input-text-opacity, 0.38);--_disabled-label-text-color: var(--md-outlined-text-field-disabled-label-text-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-label-text-opacity: var(--md-outlined-text-field-disabled-label-text-opacity, 0.38);--_disabled-leading-icon-color: var(--md-outlined-text-field-disabled-leading-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-leading-icon-opacity: var(--md-outlined-text-field-disabled-leading-icon-opacity, 0.38);--_disabled-outline-color: var(--md-outlined-text-field-disabled-outline-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-outline-opacity: var(--md-outlined-text-field-disabled-outline-opacity, 0.12);--_disabled-outline-width: var(--md-outlined-text-field-disabled-outline-width, 1px);--_disabled-supporting-text-color: var(--md-outlined-text-field-disabled-supporting-text-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-supporting-text-opacity: var(--md-outlined-text-field-disabled-supporting-text-opacity, 0.38);--_disabled-trailing-icon-color: var(--md-outlined-text-field-disabled-trailing-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-trailing-icon-opacity: var(--md-outlined-text-field-disabled-trailing-icon-opacity, 0.38);--_error-focus-caret-color: var(--md-outlined-text-field-error-focus-caret-color, var(--md-sys-color-error, #b3261e));--_error-focus-input-text-color: var(--md-outlined-text-field-error-focus-input-text-color, var(--md-sys-color-on-surface, #1d1b20));--_error-focus-label-text-color: var(--md-outlined-text-field-error-focus-label-text-color, var(--md-sys-color-error, #b3261e));--_error-focus-leading-icon-color: var(--md-outlined-text-field-error-focus-leading-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_error-focus-outline-color: var(--md-outlined-text-field-error-focus-outline-color, var(--md-sys-color-error, #b3261e));--_error-focus-supporting-text-color: var(--md-outlined-text-field-error-focus-supporting-text-color, var(--md-sys-color-error, #b3261e));--_error-focus-trailing-icon-color: var(--md-outlined-text-field-error-focus-trailing-icon-color, var(--md-sys-color-error, #b3261e));--_error-hover-input-text-color: var(--md-outlined-text-field-error-hover-input-text-color, var(--md-sys-color-on-surface, #1d1b20));--_error-hover-label-text-color: var(--md-outlined-text-field-error-hover-label-text-color, var(--md-sys-color-on-error-container, #410e0b));--_error-hover-leading-icon-color: var(--md-outlined-text-field-error-hover-leading-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_error-hover-outline-color: var(--md-outlined-text-field-error-hover-outline-color, var(--md-sys-color-on-error-container, #410e0b));--_error-hover-supporting-text-color: var(--md-outlined-text-field-error-hover-supporting-text-color, var(--md-sys-color-error, #b3261e));--_error-hover-trailing-icon-color: var(--md-outlined-text-field-error-hover-trailing-icon-color, var(--md-sys-color-on-error-container, #410e0b));--_error-input-text-color: var(--md-outlined-text-field-error-input-text-color, var(--md-sys-color-on-surface, #1d1b20));--_error-label-text-color: var(--md-outlined-text-field-error-label-text-color, var(--md-sys-color-error, #b3261e));--_error-leading-icon-color: var(--md-outlined-text-field-error-leading-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_error-outline-color: var(--md-outlined-text-field-error-outline-color, var(--md-sys-color-error, #b3261e));--_error-supporting-text-color: var(--md-outlined-text-field-error-supporting-text-color, var(--md-sys-color-error, #b3261e));--_error-trailing-icon-color: var(--md-outlined-text-field-error-trailing-icon-color, var(--md-sys-color-error, #b3261e));--_focus-input-text-color: var(--md-outlined-text-field-focus-input-text-color, var(--md-sys-color-on-surface, #1d1b20));--_focus-label-text-color: var(--md-outlined-text-field-focus-label-text-color, var(--md-sys-color-primary, #6750a4));--_focus-leading-icon-color: var(--md-outlined-text-field-focus-leading-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_focus-outline-color: var(--md-outlined-text-field-focus-outline-color, var(--md-sys-color-primary, #6750a4));--_focus-outline-width: var(--md-outlined-text-field-focus-outline-width, 3px);--_focus-supporting-text-color: var(--md-outlined-text-field-focus-supporting-text-color, var(--md-sys-color-on-surface-variant, #49454f));--_focus-trailing-icon-color: var(--md-outlined-text-field-focus-trailing-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-input-text-color: var(--md-outlined-text-field-hover-input-text-color, var(--md-sys-color-on-surface, #1d1b20));--_hover-label-text-color: var(--md-outlined-text-field-hover-label-text-color, var(--md-sys-color-on-surface, #1d1b20));--_hover-leading-icon-color: var(--md-outlined-text-field-hover-leading-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-outline-color: var(--md-outlined-text-field-hover-outline-color, var(--md-sys-color-on-surface, #1d1b20));--_hover-outline-width: var(--md-outlined-text-field-hover-outline-width, 1px);--_hover-supporting-text-color: var(--md-outlined-text-field-hover-supporting-text-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-trailing-icon-color: var(--md-outlined-text-field-hover-trailing-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_input-text-color: var(--md-outlined-text-field-input-text-color, var(--md-sys-color-on-surface, #1d1b20));--_input-text-font: var(--md-outlined-text-field-input-text-font, var(--md-sys-typescale-body-large-font, var(--md-ref-typeface-plain, Roboto)));--_input-text-line-height: var(--md-outlined-text-field-input-text-line-height, var(--md-sys-typescale-body-large-line-height, 1.5rem));--_input-text-placeholder-color: var(--md-outlined-text-field-input-text-placeholder-color, var(--md-sys-color-on-surface-variant, #49454f));--_input-text-prefix-color: var(--md-outlined-text-field-input-text-prefix-color, var(--md-sys-color-on-surface-variant, #49454f));--_input-text-size: var(--md-outlined-text-field-input-text-size, var(--md-sys-typescale-body-large-size, 1rem));--_input-text-suffix-color: var(--md-outlined-text-field-input-text-suffix-color, var(--md-sys-color-on-surface-variant, #49454f));--_input-text-weight: var(--md-outlined-text-field-input-text-weight, var(--md-sys-typescale-body-large-weight, var(--md-ref-typeface-weight-regular, 400)));--_label-text-color: var(--md-outlined-text-field-label-text-color, var(--md-sys-color-on-surface-variant, #49454f));--_label-text-font: var(--md-outlined-text-field-label-text-font, var(--md-sys-typescale-body-large-font, var(--md-ref-typeface-plain, Roboto)));--_label-text-line-height: var(--md-outlined-text-field-label-text-line-height, var(--md-sys-typescale-body-large-line-height, 1.5rem));--_label-text-populated-line-height: var(--md-outlined-text-field-label-text-populated-line-height, var(--md-sys-typescale-body-small-line-height, 1rem));--_label-text-populated-size: var(--md-outlined-text-field-label-text-populated-size, var(--md-sys-typescale-body-small-size, 0.75rem));--_label-text-size: var(--md-outlined-text-field-label-text-size, var(--md-sys-typescale-body-large-size, 1rem));--_label-text-weight: var(--md-outlined-text-field-label-text-weight, var(--md-sys-typescale-body-large-weight, var(--md-ref-typeface-weight-regular, 400)));--_leading-icon-color: var(--md-outlined-text-field-leading-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_leading-icon-size: var(--md-outlined-text-field-leading-icon-size, 24px);--_outline-color: var(--md-outlined-text-field-outline-color, var(--md-sys-color-outline, #79747e));--_outline-width: var(--md-outlined-text-field-outline-width, 1px);--_supporting-text-color: var(--md-outlined-text-field-supporting-text-color, var(--md-sys-color-on-surface-variant, #49454f));--_supporting-text-font: var(--md-outlined-text-field-supporting-text-font, var(--md-sys-typescale-body-small-font, var(--md-ref-typeface-plain, Roboto)));--_supporting-text-line-height: var(--md-outlined-text-field-supporting-text-line-height, var(--md-sys-typescale-body-small-line-height, 1rem));--_supporting-text-size: var(--md-outlined-text-field-supporting-text-size, var(--md-sys-typescale-body-small-size, 0.75rem));--_supporting-text-weight: var(--md-outlined-text-field-supporting-text-weight, var(--md-sys-typescale-body-small-weight, var(--md-ref-typeface-weight-regular, 400)));--_trailing-icon-color: var(--md-outlined-text-field-trailing-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_trailing-icon-size: var(--md-outlined-text-field-trailing-icon-size, 24px);--_container-shape-start-start: var(--md-outlined-text-field-container-shape-start-start, var(--md-outlined-text-field-container-shape, var(--md-sys-shape-corner-extra-small, 4px)));--_container-shape-start-end: var(--md-outlined-text-field-container-shape-start-end, var(--md-outlined-text-field-container-shape, var(--md-sys-shape-corner-extra-small, 4px)));--_container-shape-end-end: var(--md-outlined-text-field-container-shape-end-end, var(--md-outlined-text-field-container-shape, var(--md-sys-shape-corner-extra-small, 4px)));--_container-shape-end-start: var(--md-outlined-text-field-container-shape-end-start, var(--md-outlined-text-field-container-shape, var(--md-sys-shape-corner-extra-small, 4px)));--_leading-space: var(--md-outlined-text-field-leading-space, 16px);--_trailing-space: var(--md-outlined-text-field-trailing-space, 16px);--_top-space: var(--md-outlined-text-field-top-space, 16px);--_bottom-space: var(--md-outlined-text-field-bottom-space, 16px);--_input-text-prefix-trailing-space: var(--md-outlined-text-field-input-text-prefix-trailing-space, 2px);--_input-text-suffix-leading-space: var(--md-outlined-text-field-input-text-suffix-leading-space, 2px);--_focus-caret-color: var(--md-outlined-text-field-focus-caret-color, var(--md-sys-color-primary, #6750a4));--md-outlined-field-bottom-space: var(--_bottom-space);--md-outlined-field-container-shape-end-end: var(--_container-shape-end-end);--md-outlined-field-container-shape-end-start: var(--_container-shape-end-start);--md-outlined-field-container-shape-start-end: var(--_container-shape-start-end);--md-outlined-field-container-shape-start-start: var(--_container-shape-start-start);--md-outlined-field-content-color: var(--_input-text-color);--md-outlined-field-content-font: var(--_input-text-font);--md-outlined-field-content-line-height: var(--_input-text-line-height);--md-outlined-field-content-size: var(--_input-text-size);--md-outlined-field-content-weight: var(--_input-text-weight);--md-outlined-field-disabled-content-color: var(--_disabled-input-text-color);--md-outlined-field-disabled-content-opacity: var(--_disabled-input-text-opacity);--md-outlined-field-disabled-label-text-color: var(--_disabled-label-text-color);--md-outlined-field-disabled-label-text-opacity: var(--_disabled-label-text-opacity);--md-outlined-field-disabled-leading-content-color: var(--_disabled-leading-icon-color);--md-outlined-field-disabled-leading-content-opacity: var(--_disabled-leading-icon-opacity);--md-outlined-field-disabled-outline-color: var(--_disabled-outline-color);--md-outlined-field-disabled-outline-opacity: var(--_disabled-outline-opacity);--md-outlined-field-disabled-outline-width: var(--_disabled-outline-width);--md-outlined-field-disabled-supporting-text-color: var(--_disabled-supporting-text-color);--md-outlined-field-disabled-supporting-text-opacity: var(--_disabled-supporting-text-opacity);--md-outlined-field-disabled-trailing-content-color: var(--_disabled-trailing-icon-color);--md-outlined-field-disabled-trailing-content-opacity: var(--_disabled-trailing-icon-opacity);--md-outlined-field-error-content-color: var(--_error-input-text-color);--md-outlined-field-error-focus-content-color: var(--_error-focus-input-text-color);--md-outlined-field-error-focus-label-text-color: var(--_error-focus-label-text-color);--md-outlined-field-error-focus-leading-content-color: var(--_error-focus-leading-icon-color);--md-outlined-field-error-focus-outline-color: var(--_error-focus-outline-color);--md-outlined-field-error-focus-supporting-text-color: var(--_error-focus-supporting-text-color);--md-outlined-field-error-focus-trailing-content-color: var(--_error-focus-trailing-icon-color);--md-outlined-field-error-hover-content-color: var(--_error-hover-input-text-color);--md-outlined-field-error-hover-label-text-color: var(--_error-hover-label-text-color);--md-outlined-field-error-hover-leading-content-color: var(--_error-hover-leading-icon-color);--md-outlined-field-error-hover-outline-color: var(--_error-hover-outline-color);--md-outlined-field-error-hover-supporting-text-color: var(--_error-hover-supporting-text-color);--md-outlined-field-error-hover-trailing-content-color: var(--_error-hover-trailing-icon-color);--md-outlined-field-error-label-text-color: var(--_error-label-text-color);--md-outlined-field-error-leading-content-color: var(--_error-leading-icon-color);--md-outlined-field-error-outline-color: var(--_error-outline-color);--md-outlined-field-error-supporting-text-color: var(--_error-supporting-text-color);--md-outlined-field-error-trailing-content-color: var(--_error-trailing-icon-color);--md-outlined-field-focus-content-color: var(--_focus-input-text-color);--md-outlined-field-focus-label-text-color: var(--_focus-label-text-color);--md-outlined-field-focus-leading-content-color: var(--_focus-leading-icon-color);--md-outlined-field-focus-outline-color: var(--_focus-outline-color);--md-outlined-field-focus-outline-width: var(--_focus-outline-width);--md-outlined-field-focus-supporting-text-color: var(--_focus-supporting-text-color);--md-outlined-field-focus-trailing-content-color: var(--_focus-trailing-icon-color);--md-outlined-field-hover-content-color: var(--_hover-input-text-color);--md-outlined-field-hover-label-text-color: var(--_hover-label-text-color);--md-outlined-field-hover-leading-content-color: var(--_hover-leading-icon-color);--md-outlined-field-hover-outline-color: var(--_hover-outline-color);--md-outlined-field-hover-outline-width: var(--_hover-outline-width);--md-outlined-field-hover-supporting-text-color: var(--_hover-supporting-text-color);--md-outlined-field-hover-trailing-content-color: var(--_hover-trailing-icon-color);--md-outlined-field-label-text-color: var(--_label-text-color);--md-outlined-field-label-text-font: var(--_label-text-font);--md-outlined-field-label-text-line-height: var(--_label-text-line-height);--md-outlined-field-label-text-populated-line-height: var(--_label-text-populated-line-height);--md-outlined-field-label-text-populated-size: var(--_label-text-populated-size);--md-outlined-field-label-text-size: var(--_label-text-size);--md-outlined-field-label-text-weight: var(--_label-text-weight);--md-outlined-field-leading-content-color: var(--_leading-icon-color);--md-outlined-field-leading-space: var(--_leading-space);--md-outlined-field-outline-color: var(--_outline-color);--md-outlined-field-outline-width: var(--_outline-width);--md-outlined-field-supporting-text-color: var(--_supporting-text-color);--md-outlined-field-supporting-text-font: var(--_supporting-text-font);--md-outlined-field-supporting-text-line-height: var(--_supporting-text-line-height);--md-outlined-field-supporting-text-size: var(--_supporting-text-size);--md-outlined-field-supporting-text-weight: var(--_supporting-text-weight);--md-outlined-field-top-space: var(--_top-space);--md-outlined-field-trailing-content-color: var(--_trailing-icon-color);--md-outlined-field-trailing-space: var(--_trailing-space)}
`;/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const hae=r=>r.strings===void 0,dae={},fae=(r,e=dae)=>r._$AH=e;/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const UO=GR(class extends HR{constructor(r){if(super(r),r.type!==Df.PROPERTY&&r.type!==Df.ATTRIBUTE&&r.type!==Df.BOOLEAN_ATTRIBUTE)throw Error("The `live` directive is not allowed on child or event bindings");if(!hae(r))throw Error("`live` bindings can only contain a single expression")}render(r){return r}update(r,[e]){if(e===Dc||e===sr)return e;const t=r.element,o=r.name;if(r.type===Df.PROPERTY){if(e===t[o])return Dc}else if(r.type===Df.BOOLEAN_ATTRIBUTE){if(!!e===t.hasAttribute(o))return Dc}else if(r.type===Df.ATTRIBUTE&&t.getAttribute(o)===e+"")return Dc;return fae(r),e}});/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const A9="important",pae=" !"+A9,f4=GR(class extends HR{constructor(r){var e;if(super(r),r.type!==Df.ATTRIBUTE||r.name!=="style"||((e=r.strings)==null?void 0:e.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(r){return Object.keys(r).reduce((e,t)=>{const o=r[t];return o==null?e:e+`${t=t.includes("-")?t:t.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${o};`},"")}update(r,[e]){const{style:t}=r.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(e)),this.render(e);for(const o of this.ft)e[o]==null&&(this.ft.delete(o),o.includes("-")?t.removeProperty(o):t[o]=null);for(const o in e){const c=e[o];if(c!=null){this.ft.add(o);const f=typeof c=="string"&&c.endsWith(pae);o.includes("-")||f?t.setProperty(o,f?c.slice(0,-11):c,f?A9:""):t[o]=c}}return Dc}});/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const mae={fromAttribute(r){return r??""},toAttribute(r){return r||null}};/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const p4=Symbol("onReportValidity"),Zw=Symbol("privateCleanupFormListeners"),Kw=Symbol("privateDoNotReportInvalid"),Yw=Symbol("privateIsSelfReportingValidity"),Jw=Symbol("privateCallOnReportValidity");function _ae(r){var e,t,o;class c extends r{constructor(...y){super(...y),this[e]=new AbortController,this[t]=!1,this[o]=!1,this.addEventListener("invalid",s=>{this[Kw]||!s.isTrusted||this.addEventListener("invalid",()=>{this[Jw](s)},{once:!0})},{capture:!0})}checkValidity(){this[Kw]=!0;const y=super.checkValidity();return this[Kw]=!1,y}reportValidity(){this[Yw]=!0;const y=super.reportValidity();return y&&this[Jw](null),this[Yw]=!1,y}[(e=Zw,t=Kw,o=Yw,Jw)](y){const s=y==null?void 0:y.defaultPrevented;s||(this[p4](y),!(!s&&(y==null?void 0:y.defaultPrevented)))||(this[Yw]||vae(this[pl].form,this))&&this.focus()}[p4](y){throw new Error("Implement [onReportValidity]")}formAssociatedCallback(y){super.formAssociatedCallback&&super.formAssociatedCallback(y),this[Zw].abort(),y&&(this[Zw]=new AbortController,gae(this,y,()=>{this[Jw](null)},this[Zw].signal))}}return c}function gae(r,e,t,o){const c=yae(e);let f=!1,y,s=!1;c.addEventListener("before",()=>{s=!0,y=new AbortController,f=!1,r.addEventListener("invalid",()=>{f=!0},{signal:y.signal})},{signal:o}),c.addEventListener("after",()=>{s=!1,y==null||y.abort(),!f&&t()},{signal:o}),e.addEventListener("submit",()=>{s||t()},{signal:o})}const kA=new WeakMap;function yae(r){if(!kA.has(r)){const e=new EventTarget;kA.set(r,e);for(const t of["reportValidity","requestSubmit"]){const o=r[t];r[t]=function(){e.dispatchEvent(new Event("before"));const c=Reflect.apply(o,this,arguments);return e.dispatchEvent(new Event("after")),c}}}return kA.get(r)}function vae(r,e){if(!r)return!0;let t;for(const o of r.elements)if(o.matches(":invalid")){t=o;break}return t===e}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class xae extends I9{computeValidity({state:e,renderedControl:t}){let o=t;Hv(e)&&!o?(o=this.inputControl||document.createElement("input"),this.inputControl=o):o||(o=this.textAreaControl||document.createElement("textarea"),this.textAreaControl=o);const c=Hv(e)?o:null;if(c&&(c.type=e.type),o.value!==e.value&&(o.value=e.value),o.required=e.required,c){const f=e;f.pattern?c.pattern=f.pattern:c.removeAttribute("pattern"),f.min?c.min=f.min:c.removeAttribute("min"),f.max?c.max=f.max:c.removeAttribute("max"),f.step?c.step=f.step:c.removeAttribute("step")}return(e.minLength??-1)>-1?o.setAttribute("minlength",String(e.minLength)):o.removeAttribute("minlength"),(e.maxLength??-1)>-1?o.setAttribute("maxlength",String(e.maxLength)):o.removeAttribute("maxlength"),{validity:o.validity,validationMessage:o.validationMessage}}equals({state:e},{state:t}){const o=e.type===t.type&&e.value===t.value&&e.required===t.required&&e.minLength===t.minLength&&e.maxLength===t.maxLength;return!Hv(e)||!Hv(t)?o:o&&e.pattern===t.pattern&&e.min===t.min&&e.max===t.max&&e.step===t.step}copy({state:e}){return{state:Hv(e)?this.copyInput(e):this.copyTextArea(e),renderedControl:null}}copyInput(e){const{type:t,pattern:o,min:c,max:f,step:y}=e;return{...this.copySharedState(e),type:t,pattern:o,min:c,max:f,step:y}}copyTextArea(e){return{...this.copySharedState(e),type:e.type}}copySharedState({value:e,required:t,minLength:o,maxLength:c}){return{value:e,required:t,minLength:o,maxLength:c}}}function Hv(r){return r.type!=="textarea"}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const bae=_ae(WR(zE(X0(Uo))));class kn extends bae{constructor(){super(...arguments),this.error=!1,this.errorText="",this.label="",this.noAsterisk=!1,this.required=!1,this.value="",this.prefixText="",this.suffixText="",this.hasLeadingIcon=!1,this.hasTrailingIcon=!1,this.supportingText="",this.textDirection="",this.rows=2,this.cols=20,this.inputMode="",this.max="",this.maxLength=-1,this.min="",this.minLength=-1,this.noSpinner=!1,this.pattern="",this.placeholder="",this.readOnly=!1,this.multiple=!1,this.step="",this.type="text",this.autocomplete="",this.dirty=!1,this.focused=!1,this.nativeError=!1,this.nativeErrorText=""}get selectionDirection(){return this.getInputOrTextarea().selectionDirection}set selectionDirection(e){this.getInputOrTextarea().selectionDirection=e}get selectionEnd(){return this.getInputOrTextarea().selectionEnd}set selectionEnd(e){this.getInputOrTextarea().selectionEnd=e}get selectionStart(){return this.getInputOrTextarea().selectionStart}set selectionStart(e){this.getInputOrTextarea().selectionStart=e}get valueAsNumber(){const e=this.getInput();return e?e.valueAsNumber:NaN}set valueAsNumber(e){const t=this.getInput();t&&(t.valueAsNumber=e,this.value=t.value)}get valueAsDate(){const e=this.getInput();return e?e.valueAsDate:null}set valueAsDate(e){const t=this.getInput();t&&(t.valueAsDate=e,this.value=t.value)}get hasError(){return this.error||this.nativeError}select(){this.getInputOrTextarea().select()}setRangeText(...e){this.getInputOrTextarea().setRangeText(...e),this.value=this.getInputOrTextarea().value}setSelectionRange(e,t,o){this.getInputOrTextarea().setSelectionRange(e,t,o)}stepDown(e){const t=this.getInput();t&&(t.stepDown(e),this.value=t.value)}stepUp(e){const t=this.getInput();t&&(t.stepUp(e),this.value=t.value)}reset(){this.dirty=!1,this.value=this.getAttribute("value")??"",this.nativeError=!1,this.nativeErrorText=""}attributeChangedCallback(e,t,o){e==="value"&&this.dirty||super.attributeChangedCallback(e,t,o)}render(){const e={disabled:this.disabled,error:!this.disabled&&this.hasError,textarea:this.type==="textarea","no-spinner":this.noSpinner};return Xr`
      <span class="text-field ${Sl(e)}">
        ${this.renderField()}
      </span>
    `}updated(e){const t=this.getInputOrTextarea().value;this.value!==t&&(this.value=t)}renderField(){return p9`<${this.fieldTag}
      class="field"
      count=${this.value.length}
      ?disabled=${this.disabled}
      ?error=${this.hasError}
      error-text=${this.getErrorText()}
      ?focused=${this.focused}
      ?has-end=${this.hasTrailingIcon}
      ?has-start=${this.hasLeadingIcon}
      label=${this.label}
      ?no-asterisk=${this.noAsterisk}
      max=${this.maxLength}
      ?populated=${!!this.value}
      ?required=${this.required}
      ?resizable=${this.type==="textarea"}
      supporting-text=${this.supportingText}
    >
      ${this.renderLeadingIcon()}
      ${this.renderInputOrTextarea()}
      ${this.renderTrailingIcon()}
      <div id="description" slot="aria-describedby"></div>
    </${this.fieldTag}>`}renderLeadingIcon(){return Xr`
      <span class="icon leading" slot="start">
        <slot name="leading-icon" @slotchange=${this.handleIconChange}></slot>
      </span>
    `}renderTrailingIcon(){return Xr`
      <span class="icon trailing" slot="end">
        <slot name="trailing-icon" @slotchange=${this.handleIconChange}></slot>
      </span>
    `}renderInputOrTextarea(){const e={direction:this.textDirection},t=this.ariaLabel||this.label||sr,o=this.autocomplete,c=(this.maxLength??-1)>-1,f=(this.minLength??-1)>-1;if(this.type==="textarea")return Xr`
        <textarea
          class="input"
          style=${f4(e)}
          aria-describedby="description"
          aria-invalid=${this.hasError}
          aria-label=${t}
          autocomplete=${o||sr}
          name=${this.name||sr}
          ?disabled=${this.disabled}
          maxlength=${c?this.maxLength:sr}
          minlength=${f?this.minLength:sr}
          placeholder=${this.placeholder||sr}
          ?readonly=${this.readOnly}
          ?required=${this.required}
          rows=${this.rows}
          cols=${this.cols}
          .value=${UO(this.value)}
          @change=${this.redispatchEvent}
          @focus=${this.handleFocusChange}
          @blur=${this.handleFocusChange}
          @input=${this.handleInput}
          @select=${this.redispatchEvent}></textarea>
      `;const y=this.renderPrefix(),s=this.renderSuffix(),E=this.inputMode;return Xr`
      <div class="input-wrapper">
        ${y}
        <input
          class="input"
          style=${f4(e)}
          aria-describedby="description"
          aria-invalid=${this.hasError}
          aria-label=${t}
          autocomplete=${o||sr}
          name=${this.name||sr}
          ?disabled=${this.disabled}
          inputmode=${E||sr}
          max=${this.max||sr}
          maxlength=${c?this.maxLength:sr}
          min=${this.min||sr}
          minlength=${f?this.minLength:sr}
          pattern=${this.pattern||sr}
          placeholder=${this.placeholder||sr}
          ?readonly=${this.readOnly}
          ?required=${this.required}
          ?multiple=${this.multiple}
          step=${this.step||sr}
          type=${this.type}
          .value=${UO(this.value)}
          @change=${this.redispatchEvent}
          @focus=${this.handleFocusChange}
          @blur=${this.handleFocusChange}
          @input=${this.handleInput}
          @select=${this.redispatchEvent} />
        ${s}
      </div>
    `}renderPrefix(){return this.renderAffix(this.prefixText,!1)}renderSuffix(){return this.renderAffix(this.suffixText,!0)}renderAffix(e,t){return e?Xr`<span class="${Sl({suffix:t,prefix:!t})}">${e}</span>`:sr}getErrorText(){return this.error?this.errorText:this.nativeErrorText}handleFocusChange(){var e;this.focused=((e=this.inputOrTextarea)==null?void 0:e.matches(":focus"))??!1}handleInput(e){this.dirty=!0,this.value=e.target.value}redispatchEvent(e){px(this,e)}getInputOrTextarea(){return this.inputOrTextarea||(this.connectedCallback(),this.scheduleUpdate()),this.isUpdatePending&&this.scheduleUpdate(),this.inputOrTextarea}getInput(){return this.type==="textarea"?null:this.getInputOrTextarea()}handleIconChange(){this.hasLeadingIcon=this.leadingIcons.length>0,this.hasTrailingIcon=this.trailingIcons.length>0}[_m](){return this.value}formResetCallback(){this.reset()}formStateRestoreCallback(e){this.value=e}focus(){this.getInputOrTextarea().focus()}[mx](){return new xae(()=>({state:this,renderedControl:this.inputOrTextarea}))}[_x](){return this.inputOrTextarea}[p4](e){var o;e==null||e.preventDefault();const t=this.getErrorText();this.nativeError=!!e,this.nativeErrorText=this.validationMessage,t===this.getErrorText()&&((o=this.field)==null||o.reannounceError())}}Km(kn);kn.shadowRootOptions={...Uo.shadowRootOptions,delegatesFocus:!0};Nt([Mi({type:Boolean,reflect:!0})],kn.prototype,"error",void 0);Nt([Mi({attribute:"error-text"})],kn.prototype,"errorText",void 0);Nt([Mi()],kn.prototype,"label",void 0);Nt([Mi({type:Boolean,attribute:"no-asterisk"})],kn.prototype,"noAsterisk",void 0);Nt([Mi({type:Boolean,reflect:!0})],kn.prototype,"required",void 0);Nt([Mi()],kn.prototype,"value",void 0);Nt([Mi({attribute:"prefix-text"})],kn.prototype,"prefixText",void 0);Nt([Mi({attribute:"suffix-text"})],kn.prototype,"suffixText",void 0);Nt([Mi({type:Boolean,attribute:"has-leading-icon"})],kn.prototype,"hasLeadingIcon",void 0);Nt([Mi({type:Boolean,attribute:"has-trailing-icon"})],kn.prototype,"hasTrailingIcon",void 0);Nt([Mi({attribute:"supporting-text"})],kn.prototype,"supportingText",void 0);Nt([Mi({attribute:"text-direction"})],kn.prototype,"textDirection",void 0);Nt([Mi({type:Number})],kn.prototype,"rows",void 0);Nt([Mi({type:Number})],kn.prototype,"cols",void 0);Nt([Mi({reflect:!0})],kn.prototype,"inputMode",void 0);Nt([Mi()],kn.prototype,"max",void 0);Nt([Mi({type:Number})],kn.prototype,"maxLength",void 0);Nt([Mi()],kn.prototype,"min",void 0);Nt([Mi({type:Number})],kn.prototype,"minLength",void 0);Nt([Mi({type:Boolean,attribute:"no-spinner"})],kn.prototype,"noSpinner",void 0);Nt([Mi()],kn.prototype,"pattern",void 0);Nt([Mi({reflect:!0,converter:mae})],kn.prototype,"placeholder",void 0);Nt([Mi({type:Boolean,reflect:!0})],kn.prototype,"readOnly",void 0);Nt([Mi({type:Boolean,reflect:!0})],kn.prototype,"multiple",void 0);Nt([Mi()],kn.prototype,"step",void 0);Nt([Mi({reflect:!0})],kn.prototype,"type",void 0);Nt([Mi({reflect:!0})],kn.prototype,"autocomplete",void 0);Nt([jo()],kn.prototype,"dirty",void 0);Nt([jo()],kn.prototype,"focused",void 0);Nt([jo()],kn.prototype,"nativeError",void 0);Nt([jo()],kn.prototype,"nativeErrorText",void 0);Nt([lc(".input")],kn.prototype,"inputOrTextarea",void 0);Nt([lc(".field")],kn.prototype,"field",void 0);Nt([ME({slot:"leading-icon"})],kn.prototype,"leadingIcons",void 0);Nt([ME({slot:"trailing-icon"})],kn.prototype,"trailingIcons",void 0);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class wae extends kn{constructor(){super(...arguments),this.fieldTag=ET`md-outlined-field`}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Tae=ho`:host{display:inline-flex;outline:none;resize:both;text-align:start;-webkit-tap-highlight-color:rgba(0,0,0,0)}.text-field,.field{width:100%}.text-field{display:inline-flex}.field{cursor:text}.disabled .field{cursor:default}.text-field,.textarea .field{resize:inherit}.icon{color:currentColor;display:flex;fill:currentColor}.icon ::slotted(*){display:flex}[hasstart] .icon.leading{font-size:var(--_leading-icon-size);height:var(--_leading-icon-size);width:var(--_leading-icon-size)}[hasend] .icon.trailing{font-size:var(--_trailing-icon-size);height:var(--_trailing-icon-size);width:var(--_trailing-icon-size)}.input-wrapper{display:flex}.input-wrapper>*{all:inherit;padding:0}.input{caret-color:var(--_caret-color);overflow-x:hidden;text-align:inherit}.input::placeholder{color:currentColor;opacity:1}.input::-webkit-calendar-picker-indicator{display:none}.input::-webkit-search-decoration,.input::-webkit-search-cancel-button{display:none}@media(forced-colors: active){.input{background:none}}.no-spinner .input::-webkit-inner-spin-button,.no-spinner .input::-webkit-outer-spin-button{display:none}.no-spinner .input[type=number]{-moz-appearance:textfield}:focus-within .input{caret-color:var(--_focus-caret-color)}.error:focus-within .input{caret-color:var(--_error-focus-caret-color)}.text-field:not(.disabled) .prefix{color:var(--_input-text-prefix-color)}.text-field:not(.disabled) .suffix{color:var(--_input-text-suffix-color)}.text-field:not(.disabled) .input::placeholder{color:var(--_input-text-placeholder-color)}.prefix,.suffix{text-wrap:nowrap;width:min-content}.prefix{padding-inline-end:var(--_input-text-prefix-trailing-space)}.suffix{padding-inline-start:var(--_input-text-suffix-leading-space)}
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let m4=class extends wae{constructor(){super(...arguments),this.fieldTag=ET`md-outlined-field`}};m4.styles=[Tae,uae];m4=Nt([Xa("md-outlined-text-field")],m4);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Eae=ho`@media(forced-colors: active){:host{--md-slider-active-track-color: CanvasText;--md-slider-disabled-active-track-color: GrayText;--md-slider-disabled-active-track-opacity: 1;--md-slider-disabled-handle-color: GrayText;--md-slider-disabled-inactive-track-color: GrayText;--md-slider-disabled-inactive-track-opacity: 1;--md-slider-focus-handle-color: CanvasText;--md-slider-handle-color: CanvasText;--md-slider-handle-shadow-color: Canvas;--md-slider-hover-handle-color: CanvasText;--md-slider-hover-state-layer-color: Canvas;--md-slider-hover-state-layer-opacity: 1;--md-slider-inactive-track-color: Canvas;--md-slider-label-container-color: Canvas;--md-slider-label-text-color: CanvasText;--md-slider-pressed-handle-color: CanvasText;--md-slider-pressed-state-layer-color: Canvas;--md-slider-pressed-state-layer-opacity: 1;--md-slider-with-overlap-handle-outline-color: CanvasText}.label,.label::before{border:var(--_with-overlap-handle-outline-color) solid var(--_with-overlap-handle-outline-width)}:host(:not([disabled])) .track::before{border:1px solid var(--_active-track-color)}.tickmarks::before{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='CanvasText'%3E%3Ccircle cx='2' cy='2'  r='1'/%3E%3C/svg%3E")}.tickmarks::after{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='Canvas'%3E%3Ccircle cx='2' cy='2' r='1'/%3E%3C/svg%3E")}:host([disabled]) .tickmarks::before{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='Canvas'%3E%3Ccircle cx='2' cy='2'  r='1'/%3E%3C/svg%3E")}}
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function DA(r,e,t){return r?e(r):t==null?void 0:t(r)}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Iae=zE(X0(Uo));class ls extends Iae{get nameStart(){return this.getAttribute("name-start")??this.name}set nameStart(e){this.setAttribute("name-start",e)}get nameEnd(){return this.getAttribute("name-end")??this.nameStart}set nameEnd(e){this.setAttribute("name-end",e)}get renderAriaLabelStart(){const{ariaLabel:e}=this;return this.ariaLabelStart||e&&`${e} start`||this.valueLabelStart||String(this.valueStart)}get renderAriaValueTextStart(){return this.ariaValueTextStart||this.valueLabelStart||String(this.valueStart)}get renderAriaLabelEnd(){const{ariaLabel:e}=this;return this.range?this.ariaLabelEnd||e&&`${e} end`||this.valueLabelEnd||String(this.valueEnd):e||this.valueLabel||String(this.value)}get renderAriaValueTextEnd(){if(this.range)return this.ariaValueTextEnd||this.valueLabelEnd||String(this.valueEnd);const{ariaValueText:e}=this;return e||this.valueLabel||String(this.value)}constructor(){super(),this.min=0,this.max=100,this.valueLabel="",this.valueLabelStart="",this.valueLabelEnd="",this.ariaLabelStart="",this.ariaValueTextStart="",this.ariaLabelEnd="",this.ariaValueTextEnd="",this.step=1,this.ticks=!1,this.labeled=!1,this.range=!1,this.handleStartHover=!1,this.handleEndHover=!1,this.startOnTop=!1,this.handlesOverlapping=!1,this.ripplePointerId=1,this.isRedispatchingEvent=!1,this.addEventListener("click",e=>{!FE(e)||!this.inputEnd||(this.focus(),OE(this.inputEnd))})}focus(){var e;(e=this.inputEnd)==null||e.focus()}willUpdate(e){var o,c;this.renderValueStart=e.has("valueStart")?this.valueStart:(o=this.inputStart)==null?void 0:o.valueAsNumber;const t=e.has("valueEnd")&&this.range||e.has("value");this.renderValueEnd=t?this.range?this.valueEnd:this.value:(c=this.inputEnd)==null?void 0:c.valueAsNumber,e.get("handleStartHover")!==void 0?this.toggleRippleHover(this.rippleStart,this.handleStartHover):e.get("handleEndHover")!==void 0&&this.toggleRippleHover(this.rippleEnd,this.handleEndHover)}updated(e){var t,o;if(this.range&&(this.renderValueStart=this.inputStart.valueAsNumber),this.renderValueEnd=this.inputEnd.valueAsNumber,this.range){const c=(this.max-this.min)/3;if(this.valueStart===void 0){this.inputStart.valueAsNumber=this.min+c;const f=this.inputStart.valueAsNumber;this.valueStart=this.renderValueStart=f}if(this.valueEnd===void 0){this.inputEnd.valueAsNumber=this.min+2*c;const f=this.inputEnd.valueAsNumber;this.valueEnd=this.renderValueEnd=f}}else this.value??(this.value=this.renderValueEnd);if(e.has("range")||e.has("renderValueStart")||e.has("renderValueEnd")||this.isUpdatePending){const c=(t=this.handleStart)==null?void 0:t.querySelector(".handleNub"),f=(o=this.handleEnd)==null?void 0:o.querySelector(".handleNub");this.handlesOverlapping=Sae(c,f)}this.performUpdate()}render(){const e=this.step===0?1:this.step,t=Math.max(this.max-this.min,e),o=this.range?((this.renderValueStart??this.min)-this.min)/t:0,c=((this.renderValueEnd??this.min)-this.min)/t,f={"--_start-fraction":String(o),"--_end-fraction":String(c),"--_tick-count":String(t/e)},y={ranged:this.range},s=this.valueLabelStart||String(this.renderValueStart),E=(this.range?this.valueLabelEnd:this.valueLabel)||String(this.renderValueEnd),R={start:!0,value:this.renderValueStart,ariaLabel:this.renderAriaLabelStart,ariaValueText:this.renderAriaValueTextStart,ariaMin:this.min,ariaMax:this.valueEnd??this.max},O={start:!1,value:this.renderValueEnd,ariaLabel:this.renderAriaLabelEnd,ariaValueText:this.renderAriaValueTextEnd,ariaMin:this.range?this.valueStart??this.min:this.min,ariaMax:this.max},A={start:!0,hover:this.handleStartHover,label:s},U={start:!1,hover:this.handleEndHover,label:E},$={hover:this.handleStartHover||this.handleEndHover};return Xr` <div
      class="container ${Sl(y)}"
      style=${f4(f)}>
      ${DA(this.range,()=>this.renderInput(R))}
      ${this.renderInput(O)} ${this.renderTrack()}
      <div class="handleContainerPadded">
        <div class="handleContainerBlock">
          <div class="handleContainer ${Sl($)}">
            ${DA(this.range,()=>this.renderHandle(A))}
            ${this.renderHandle(U)}
          </div>
        </div>
      </div>
    </div>`}renderTrack(){return Xr`
      <div class="track"></div>
      ${this.ticks?Xr`<div class="tickmarks"></div>`:sr}
    `}renderLabel(e){return Xr`<div class="label" aria-hidden="true">
      <span class="labelContent" part="label">${e}</span>
    </div>`}renderHandle({start:e,hover:t,label:o}){const c=!this.disabled&&e===this.startOnTop,f=!this.disabled&&this.handlesOverlapping,y=e?"start":"end";return Xr`<div
      class="handle ${Sl({[y]:!0,hover:t,onTop:c,isOverlapping:f})}">
      <md-focus-ring part="focus-ring" for=${y}></md-focus-ring>
      <md-ripple
        for=${y}
        class=${y}
        ?disabled=${this.disabled}></md-ripple>
      <div class="handleNub">
        <md-elevation part="elevation"></md-elevation>
      </div>
      ${DA(this.labeled,()=>this.renderLabel(o))}
    </div>`}renderInput({start:e,value:t,ariaLabel:o,ariaValueText:c,ariaMin:f,ariaMax:y}){const s=e?"start":"end";return Xr`<input
      type="range"
      class="${Sl({start:e,end:!e})}"
      @focus=${this.handleFocus}
      @pointerdown=${this.handleDown}
      @pointerup=${this.handleUp}
      @pointerenter=${this.handleEnter}
      @pointermove=${this.handleMove}
      @pointerleave=${this.handleLeave}
      @keydown=${this.handleKeydown}
      @keyup=${this.handleKeyup}
      @input=${this.handleInput}
      @change=${this.handleChange}
      id=${s}
      .disabled=${this.disabled}
      .min=${String(this.min)}
      aria-valuemin=${f}
      .max=${String(this.max)}
      aria-valuemax=${y}
      .step=${String(this.step)}
      .value=${String(t)}
      .tabIndex=${e?1:0}
      aria-label=${o||sr}
      aria-valuetext=${c} />`}async toggleRippleHover(e,t){const o=await e;o&&(t?o.handlePointerenter(new PointerEvent("pointerenter",{isPrimary:!0,pointerId:this.ripplePointerId})):o.handlePointerleave(new PointerEvent("pointerleave",{isPrimary:!0,pointerId:this.ripplePointerId})))}handleFocus(e){this.updateOnTop(e.target)}startAction(e){const t=e.target,o=t===this.inputStart?this.inputEnd:this.inputStart;this.action={canFlip:e.type==="pointerdown",flipped:!1,target:t,fixed:o,values:new Map([[t,t.valueAsNumber],[o,o==null?void 0:o.valueAsNumber]])}}finishAction(e){this.action=void 0}handleKeydown(e){this.startAction(e)}handleKeyup(e){this.finishAction(e)}handleDown(e){this.startAction(e),this.ripplePointerId=e.pointerId;const t=e.target===this.inputStart;this.handleStartHover=!this.disabled&&t&&!!this.handleStart,this.handleEndHover=!this.disabled&&!t&&!!this.handleEnd}async handleUp(e){if(!this.action)return;const{target:t,values:o,flipped:c}=this.action;await new Promise(requestAnimationFrame),t!==void 0&&(t.focus(),c&&t.valueAsNumber!==o.get(t)&&t.dispatchEvent(new Event("change",{bubbles:!0}))),this.finishAction(e)}handleMove(e){this.handleStartHover=!this.disabled&&jO(e,this.handleStart),this.handleEndHover=!this.disabled&&jO(e,this.handleEnd)}handleEnter(e){this.handleMove(e)}handleLeave(){this.handleStartHover=!1,this.handleEndHover=!1}updateOnTop(e){this.startOnTop=e.classList.contains("start")}needsClamping(){if(!this.action)return!1;const{target:e,fixed:t}=this.action;return e===this.inputStart?e.valueAsNumber>t.valueAsNumber:e.valueAsNumber<t.valueAsNumber}isActionFlipped(){const{action:e}=this;if(!e)return!1;const{target:t,fixed:o,values:c}=e;return e.canFlip&&c.get(t)===c.get(o)&&this.needsClamping()&&(e.canFlip=!1,e.flipped=!0,e.target=o,e.fixed=t),e.flipped}flipAction(){if(!this.action)return!1;const{target:e,fixed:t,values:o}=this.action,c=e.valueAsNumber!==t.valueAsNumber;return e.valueAsNumber=t.valueAsNumber,t.valueAsNumber=o.get(t),c}clampAction(){if(!this.needsClamping()||!this.action)return!1;const{target:e,fixed:t}=this.action;return e.valueAsNumber=t.valueAsNumber,!0}handleInput(e){if(this.isRedispatchingEvent)return;let t=!1,o=!1;this.range&&(this.isActionFlipped()&&(t=!0,o=this.flipAction()),this.clampAction()&&(t=!0,o=!1));const c=e.target;this.updateOnTop(c),this.range?(this.valueStart=this.inputStart.valueAsNumber,this.valueEnd=this.inputEnd.valueAsNumber):this.value=this.inputEnd.valueAsNumber,t&&e.stopPropagation(),o&&(this.isRedispatchingEvent=!0,px(c,e),this.isRedispatchingEvent=!1)}handleChange(e){const t=e.target,{target:o,values:c}=this.action??{};o&&o.valueAsNumber===c.get(t)||px(this,e),this.finishAction(e)}[_m](){if(this.range){const e=new FormData;return e.append(this.nameStart,String(this.valueStart)),e.append(this.nameEnd,String(this.valueEnd)),e}return String(this.value)}formResetCallback(){if(this.range){const t=this.getAttribute("value-start");this.valueStart=t!==null?Number(t):void 0;const o=this.getAttribute("value-end");this.valueEnd=o!==null?Number(o):void 0;return}const e=this.getAttribute("value");this.value=e!==null?Number(e):void 0}formStateRestoreCallback(e){if(Array.isArray(e)){const[[,t],[,o]]=e;this.valueStart=Number(t),this.valueEnd=Number(o),this.range=!0;return}this.value=Number(e),this.range=!1}}Km(ls);ls.shadowRootOptions={...Uo.shadowRootOptions,delegatesFocus:!0};Nt([Mi({type:Number})],ls.prototype,"min",void 0);Nt([Mi({type:Number})],ls.prototype,"max",void 0);Nt([Mi({type:Number})],ls.prototype,"value",void 0);Nt([Mi({type:Number,attribute:"value-start"})],ls.prototype,"valueStart",void 0);Nt([Mi({type:Number,attribute:"value-end"})],ls.prototype,"valueEnd",void 0);Nt([Mi({attribute:"value-label"})],ls.prototype,"valueLabel",void 0);Nt([Mi({attribute:"value-label-start"})],ls.prototype,"valueLabelStart",void 0);Nt([Mi({attribute:"value-label-end"})],ls.prototype,"valueLabelEnd",void 0);Nt([Mi({attribute:"aria-label-start"})],ls.prototype,"ariaLabelStart",void 0);Nt([Mi({attribute:"aria-valuetext-start"})],ls.prototype,"ariaValueTextStart",void 0);Nt([Mi({attribute:"aria-label-end"})],ls.prototype,"ariaLabelEnd",void 0);Nt([Mi({attribute:"aria-valuetext-end"})],ls.prototype,"ariaValueTextEnd",void 0);Nt([Mi({type:Number})],ls.prototype,"step",void 0);Nt([Mi({type:Boolean})],ls.prototype,"ticks",void 0);Nt([Mi({type:Boolean})],ls.prototype,"labeled",void 0);Nt([Mi({type:Boolean})],ls.prototype,"range",void 0);Nt([lc("input.start")],ls.prototype,"inputStart",void 0);Nt([lc(".handle.start")],ls.prototype,"handleStart",void 0);Nt([i9("md-ripple.start")],ls.prototype,"rippleStart",void 0);Nt([lc("input.end")],ls.prototype,"inputEnd",void 0);Nt([lc(".handle.end")],ls.prototype,"handleEnd",void 0);Nt([i9("md-ripple.end")],ls.prototype,"rippleEnd",void 0);Nt([jo()],ls.prototype,"handleStartHover",void 0);Nt([jo()],ls.prototype,"handleEndHover",void 0);Nt([jo()],ls.prototype,"startOnTop",void 0);Nt([jo()],ls.prototype,"handlesOverlapping",void 0);Nt([jo()],ls.prototype,"renderValueStart",void 0);Nt([jo()],ls.prototype,"renderValueEnd",void 0);function jO({x:r,y:e},t){if(!t)return!1;const{top:o,left:c,bottom:f,right:y}=t.getBoundingClientRect();return r>=c&&r<=y&&e>=o&&e<=f}function Sae(r,e){if(!(r&&e))return!1;const t=r.getBoundingClientRect(),o=e.getBoundingClientRect();return!(t.top>o.bottom||t.right<o.left||t.bottom<o.top||t.left>o.right)}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Aae=ho`:host{--_active-track-color: var(--md-slider-active-track-color, var(--md-sys-color-primary, #6750a4));--_active-track-height: var(--md-slider-active-track-height, 4px);--_active-track-shape: var(--md-slider-active-track-shape, var(--md-sys-shape-corner-full, 9999px));--_disabled-active-track-color: var(--md-slider-disabled-active-track-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-active-track-opacity: var(--md-slider-disabled-active-track-opacity, 0.38);--_disabled-handle-color: var(--md-slider-disabled-handle-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-handle-elevation: var(--md-slider-disabled-handle-elevation, 0);--_disabled-inactive-track-color: var(--md-slider-disabled-inactive-track-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-inactive-track-opacity: var(--md-slider-disabled-inactive-track-opacity, 0.12);--_focus-handle-color: var(--md-slider-focus-handle-color, var(--md-sys-color-primary, #6750a4));--_handle-color: var(--md-slider-handle-color, var(--md-sys-color-primary, #6750a4));--_handle-elevation: var(--md-slider-handle-elevation, 1);--_handle-height: var(--md-slider-handle-height, 20px);--_handle-shadow-color: var(--md-slider-handle-shadow-color, var(--md-sys-color-shadow, #000));--_handle-shape: var(--md-slider-handle-shape, var(--md-sys-shape-corner-full, 9999px));--_handle-width: var(--md-slider-handle-width, 20px);--_hover-handle-color: var(--md-slider-hover-handle-color, var(--md-sys-color-primary, #6750a4));--_hover-state-layer-color: var(--md-slider-hover-state-layer-color, var(--md-sys-color-primary, #6750a4));--_hover-state-layer-opacity: var(--md-slider-hover-state-layer-opacity, 0.08);--_inactive-track-color: var(--md-slider-inactive-track-color, var(--md-sys-color-surface-container-highest, #e6e0e9));--_inactive-track-height: var(--md-slider-inactive-track-height, 4px);--_inactive-track-shape: var(--md-slider-inactive-track-shape, var(--md-sys-shape-corner-full, 9999px));--_label-container-color: var(--md-slider-label-container-color, var(--md-sys-color-primary, #6750a4));--_label-container-height: var(--md-slider-label-container-height, 28px);--_pressed-handle-color: var(--md-slider-pressed-handle-color, var(--md-sys-color-primary, #6750a4));--_pressed-state-layer-color: var(--md-slider-pressed-state-layer-color, var(--md-sys-color-primary, #6750a4));--_pressed-state-layer-opacity: var(--md-slider-pressed-state-layer-opacity, 0.12);--_state-layer-size: var(--md-slider-state-layer-size, 40px);--_with-overlap-handle-outline-color: var(--md-slider-with-overlap-handle-outline-color, var(--md-sys-color-on-primary, #fff));--_with-overlap-handle-outline-width: var(--md-slider-with-overlap-handle-outline-width, 1px);--_with-tick-marks-active-container-color: var(--md-slider-with-tick-marks-active-container-color, var(--md-sys-color-on-primary, #fff));--_with-tick-marks-container-size: var(--md-slider-with-tick-marks-container-size, 2px);--_with-tick-marks-disabled-container-color: var(--md-slider-with-tick-marks-disabled-container-color, var(--md-sys-color-on-surface, #1d1b20));--_with-tick-marks-inactive-container-color: var(--md-slider-with-tick-marks-inactive-container-color, var(--md-sys-color-on-surface-variant, #49454f));--_label-text-color: var(--md-slider-label-text-color, var(--md-sys-color-on-primary, #fff));--_label-text-font: var(--md-slider-label-text-font, var(--md-sys-typescale-label-medium-font, var(--md-ref-typeface-plain, Roboto)));--_label-text-line-height: var(--md-slider-label-text-line-height, var(--md-sys-typescale-label-medium-line-height, 1rem));--_label-text-size: var(--md-slider-label-text-size, var(--md-sys-typescale-label-medium-size, 0.75rem));--_label-text-weight: var(--md-slider-label-text-weight, var(--md-sys-typescale-label-medium-weight, var(--md-ref-typeface-weight-medium, 500)));--_start-fraction: 0;--_end-fraction: 0;--_tick-count: 0;display:inline-flex;vertical-align:middle;min-inline-size:200px;--md-elevation-level: var(--_handle-elevation);--md-elevation-shadow-color: var(--_handle-shadow-color)}md-focus-ring{height:48px;inset:unset;width:48px}md-elevation{transition-duration:250ms}@media(prefers-reduced-motion){.label{transition-duration:0}}:host([disabled]){opacity:var(--_disabled-active-track-opacity);--md-elevation-level: var(--_disabled-handle-elevation)}.container{flex:1;display:flex;align-items:center;position:relative;block-size:var(--_state-layer-size);pointer-events:none;touch-action:none}.track,.tickmarks{position:absolute;inset:0;display:flex;align-items:center}.track::before,.tickmarks::before,.track::after,.tickmarks::after{position:absolute;content:"";inset-inline-start:calc(var(--_state-layer-size)/2 - var(--_with-tick-marks-container-size));inset-inline-end:calc(var(--_state-layer-size)/2 - var(--_with-tick-marks-container-size));background-size:calc((100% - var(--_with-tick-marks-container-size)*2)/var(--_tick-count)) 100%}.track::before,.tickmarks::before{block-size:var(--_inactive-track-height);border-radius:var(--_inactive-track-shape)}.track::before{background:var(--_inactive-track-color)}.tickmarks::before{background-image:radial-gradient(circle at var(--_with-tick-marks-container-size) center, var(--_with-tick-marks-inactive-container-color) 0, var(--_with-tick-marks-inactive-container-color) calc(var(--_with-tick-marks-container-size) / 2), transparent calc(var(--_with-tick-marks-container-size) / 2))}:host([disabled]) .track::before{opacity:calc(1/var(--_disabled-active-track-opacity)*var(--_disabled-inactive-track-opacity));background:var(--_disabled-inactive-track-color)}.track::after,.tickmarks::after{block-size:var(--_active-track-height);border-radius:var(--_active-track-shape);clip-path:inset(0 calc(var(--_with-tick-marks-container-size) * min((1 - var(--_end-fraction)) * 1000000000, 1) + (100% - var(--_with-tick-marks-container-size) * 2) * (1 - var(--_end-fraction))) 0 calc(var(--_with-tick-marks-container-size) * min(var(--_start-fraction) * 1000000000, 1) + (100% - var(--_with-tick-marks-container-size) * 2) * var(--_start-fraction)))}.track::after{background:var(--_active-track-color)}.tickmarks::after{background-image:radial-gradient(circle at var(--_with-tick-marks-container-size) center, var(--_with-tick-marks-active-container-color) 0, var(--_with-tick-marks-active-container-color) calc(var(--_with-tick-marks-container-size) / 2), transparent calc(var(--_with-tick-marks-container-size) / 2))}.track:dir(rtl)::after{clip-path:inset(0 calc(var(--_with-tick-marks-container-size) * min(var(--_start-fraction) * 1000000000, 1) + (100% - var(--_with-tick-marks-container-size) * 2) * var(--_start-fraction)) 0 calc(var(--_with-tick-marks-container-size) * min((1 - var(--_end-fraction)) * 1000000000, 1) + (100% - var(--_with-tick-marks-container-size) * 2) * (1 - var(--_end-fraction))))}.tickmarks:dir(rtl)::after{clip-path:inset(0 calc(var(--_with-tick-marks-container-size) * min(var(--_start-fraction) * 1000000000, 1) + (100% - var(--_with-tick-marks-container-size) * 2) * var(--_start-fraction)) 0 calc(var(--_with-tick-marks-container-size) * min((1 - var(--_end-fraction)) * 1000000000, 1) + (100% - var(--_with-tick-marks-container-size) * 2) * (1 - var(--_end-fraction))))}:host([disabled]) .track::after{background:var(--_disabled-active-track-color)}:host([disabled]) .tickmarks::before{background-image:radial-gradient(circle at var(--_with-tick-marks-container-size) center, var(--_with-tick-marks-disabled-container-color) 0, var(--_with-tick-marks-disabled-container-color) calc(var(--_with-tick-marks-container-size) / 2), transparent calc(var(--_with-tick-marks-container-size) / 2))}.handleContainerPadded{position:relative;block-size:100%;inline-size:100%;padding-inline:calc(var(--_state-layer-size)/2)}.handleContainerBlock{position:relative;block-size:100%;inline-size:100%}.handleContainer{position:absolute;inset-block-start:0;inset-block-end:0;inset-inline-start:calc(100%*var(--_start-fraction));inline-size:calc(100%*(var(--_end-fraction) - var(--_start-fraction)))}.handle{position:absolute;block-size:var(--_state-layer-size);inline-size:var(--_state-layer-size);border-radius:var(--_handle-shape);display:flex;place-content:center;place-items:center}.handleNub{position:absolute;height:var(--_handle-height);width:var(--_handle-width);border-radius:var(--_handle-shape);background:var(--_handle-color)}:host([disabled]) .handleNub{background:var(--_disabled-handle-color)}input.end:focus~.handleContainerPadded .handle.end>.handleNub,input.start:focus~.handleContainerPadded .handle.start>.handleNub{background:var(--_focus-handle-color)}.container>.handleContainerPadded .handle.hover>.handleNub{background:var(--_hover-handle-color)}:host(:not([disabled])) input.end:active~.handleContainerPadded .handle.end>.handleNub,:host(:not([disabled])) input.start:active~.handleContainerPadded .handle.start>.handleNub{background:var(--_pressed-handle-color)}.onTop.isOverlapping .label,.onTop.isOverlapping .label::before{outline:var(--_with-overlap-handle-outline-color) solid var(--_with-overlap-handle-outline-width)}.onTop.isOverlapping .handleNub{border:var(--_with-overlap-handle-outline-color) solid var(--_with-overlap-handle-outline-width)}.handle.start{inset-inline-start:calc(0px - var(--_state-layer-size)/2)}.handle.end{inset-inline-end:calc(0px - var(--_state-layer-size)/2)}.label{position:absolute;box-sizing:border-box;display:flex;padding:4px;place-content:center;place-items:center;border-radius:var(--md-sys-shape-corner-full, 9999px);color:var(--_label-text-color);font-family:var(--_label-text-font);font-size:var(--_label-text-size);line-height:var(--_label-text-line-height);font-weight:var(--_label-text-weight);inset-block-end:100%;min-inline-size:var(--_label-container-height);min-block-size:var(--_label-container-height);background:var(--_label-container-color);transition:transform 100ms cubic-bezier(0.2, 0, 0, 1);transform-origin:center bottom;transform:scale(0)}:host(:focus-within) .label,.handleContainer.hover .label,:where(:has(input:active)) .label{transform:scale(1)}.label::before,.label::after{position:absolute;display:block;content:"";background:inherit}.label::before{inline-size:calc(var(--_label-container-height)/2);block-size:calc(var(--_label-container-height)/2);bottom:calc(var(--_label-container-height)/-10);transform:rotate(45deg)}.label::after{inset:0px;border-radius:inherit}.labelContent{z-index:1}input[type=range]{opacity:0;-webkit-tap-highlight-color:rgba(0,0,0,0);position:absolute;box-sizing:border-box;height:100%;width:100%;margin:0;background:rgba(0,0,0,0);cursor:pointer;pointer-events:auto;appearance:none}input[type=range]:focus{outline:none}::-webkit-slider-runnable-track{-webkit-appearance:none}::-moz-range-track{appearance:none}::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;block-size:var(--_handle-height);inline-size:var(--_handle-width);opacity:0;z-index:2}input.end::-webkit-slider-thumb{--_track-and-knob-padding: calc( (var(--_state-layer-size) - var(--_handle-width)) / 2 );--_x-translate: calc( var(--_track-and-knob-padding) - 2 * var(--_end-fraction) * var(--_track-and-knob-padding) );transform:translateX(var(--_x-translate))}input.end:dir(rtl)::-webkit-slider-thumb{transform:translateX(calc(-1 * var(--_x-translate)))}input.start::-webkit-slider-thumb{--_track-and-knob-padding: calc( (var(--_state-layer-size) - var(--_handle-width)) / 2 );--_x-translate: calc( var(--_track-and-knob-padding) - 2 * var(--_start-fraction) * var(--_track-and-knob-padding) );transform:translateX(var(--_x-translate))}input.start:dir(rtl)::-webkit-slider-thumb{transform:translateX(calc(-1 * var(--_x-translate)))}::-moz-range-thumb{appearance:none;block-size:var(--_state-layer-size);inline-size:var(--_state-layer-size);transform:scaleX(0);opacity:0;z-index:2}.ranged input.start{clip-path:inset(0 calc(100% - (var(--_state-layer-size) / 2 + (100% - var(--_state-layer-size)) * (var(--_start-fraction) + (var(--_end-fraction) - var(--_start-fraction)) / 2))) 0 0)}.ranged input.start:dir(rtl){clip-path:inset(0 0 0 calc(100% - (var(--_state-layer-size) / 2 + (100% - var(--_state-layer-size)) * (var(--_start-fraction) + (var(--_end-fraction) - var(--_start-fraction)) / 2))))}.ranged input.end{clip-path:inset(0 0 0 calc(var(--_state-layer-size) / 2 + (100% - var(--_state-layer-size)) * (var(--_start-fraction) + (var(--_end-fraction) - var(--_start-fraction)) / 2)))}.ranged input.end:dir(rtl){clip-path:inset(0 calc(var(--_state-layer-size) / 2 + (100% - var(--_state-layer-size)) * (var(--_start-fraction) + (var(--_end-fraction) - var(--_start-fraction)) / 2)) 0 0)}.onTop{z-index:1}.handle{--md-ripple-hover-color: var(--_hover-state-layer-color);--md-ripple-hover-opacity: var(--_hover-state-layer-opacity);--md-ripple-pressed-color: var(--_pressed-state-layer-color);--md-ripple-pressed-opacity: var(--_pressed-state-layer-opacity)}md-ripple{border-radius:50%;height:var(--_state-layer-size);width:var(--_state-layer-size)}
`;/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let _4=class extends ls{};_4.styles=[Aae,Eae];_4=Nt([Xa("md-slider")],_4);const Cae={class:"map-box"},Rae={class:"content"},Pae=["value"],Mae=wa({__name:"MapBox",props:{mapData:{},date:{}},setup(r){const e=Qn(),t=Qn(),o=Qn(),c=Qn(),f=Qn(),y=Qn(),s=r;jv.accessToken="pk.eyJ1IjoidGhlLXN6IiwiYSI6ImNrODNheWJlajA0YmozaG81NGFzYTk5a2UifQ.NrNoKE7ivp2MHYylQB672A",hC(()=>{o.value=new jv.Map({container:e.value,center:[16.064952,40.64773],zoom:9,style:"mapbox://styles/mapbox/outdoors-v12"});let Q=!1;Array.isArray(s.mapData)&&(Q=!0);const de=s.mapData;o.value.on("style.load",()=>{if(o.value.addControl(new jv.NavigationControl),o.value.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),Q)$(s.mapData);else{const Ce=E(de);o.value.addSource("geojson-source",{type:"geojson",data:de}),o.value.addLayer({id:"line-layer",type:"line",source:"geojson-source",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#FF0000","line-width":2},filter:["==","$type","LineString"]}),o.value.fitBounds(Ce,{padding:20,pitch:75,bearing:-35})}o.value.setTerrain({source:"mapbox-dem",exaggeration:1.5})})});function E(Q){const de=Q.features.flatMap(me=>me.geometry.coordinates);let Ce,Fe;Array.isArray(de[0][0])?(Ce=de[0].map(me=>me[0]),Fe=de[0].map(me=>me[1])):(Ce=de.map(me=>me[0]),Fe=de.map(me=>me[1]));const Le=Math.min(...Fe),Me=Math.max(...Fe),at=Math.min(...Ce),pt=Math.max(...Ce);return new jv.LngLatBounds([at,Le],[pt,Me])}function R(){const Q=new Date,de=Q.getHours(),Ce=Q.getMinutes();s.date.setHours(de),s.date.setMinutes(Ce),c.value=`${de}:${Ce}`,f.value=new Yoe({date:new Date,color:"#01112f",opacity:.7,apiKey:"eyJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6InRwcGlvdHJvd3NraUBzaGFkZW1hcC5hcHAiLCJjcmVhdGVkIjoxNjYyNDkzMDY2Nzk0LCJpYXQiOjE2NjI0OTMwNjZ9.ovCrLTYsdKFTF6TW3DuODxCaAtGQ3qhcmqj3DWcol5g",terrainSource:{tileSize:256,maxZoom:15,getSourceUrl:({x:Fe,y:Le,z:Me})=>`https://s3.amazonaws.com/elevation-tiles-prod/terrarium/${Me}/${Fe}/${Le}.png`,getElevation:({r:Fe,g:Le,b:Me,a:at})=>Fe*256+Le+Me/256-32768}}).addTo(o.value)}function O(){if(f.value){f.value.remove(),f.value=void 0;return}R()}Hf(c,(Q,de)=>{var Ce;if(Q!==de){const Fe=`${s.date.getMonth()+1}-${s.date.getDate()}-${s.date.getFullYear()} ${Q}`;(Ce=f.value)==null||Ce.setDate(new Date(Fe))}});function A(Q){c.value=`${Q.target.value<10?"0"+Q.target.value:Q.target.value}:00`}function U(){navigator.geolocation?navigator.geolocation.getCurrentPosition(Q=>{const{latitude:de,longitude:Ce}=Q.coords;$([Ce,de])},Q=>{console.error("Error obtaining location:",Q)}):console.error("Geolocation is not supported by this browser.")}function $(Q){o.value&&(y.value&&y.value.remove(),y.value=new jv.Marker().setLngLat(Q).addTo(o.value),o.value.fitBounds([Q[0]+.008,Q[1]-.008,Q[0]-.008,Q[1]+.008],{padding:20,pitch:75,bearing:-35}))}function te(Q){Q?U():y.value&&(y.value.remove(),y.value=void 0)}return(Q,de)=>(Pr(),Qr("div",Cae,[mr("div",{ref_key:"mapBox",ref:e,id:"map-box"},null,512),Bs(C0,{class:"optional-field",label:"Ombre",onCheckboxChanged:O},{default:c0(()=>{var Ce;return[mr("div",Rae,[ch(" del "+ms(s.date.toLocaleDateString())+" ",1),u0(mr("md-outlined-text-field",{label:"Orario",type:"time","onUpdate:modelValue":de[0]||(de[0]=Fe=>c.value=Fe)},null,512),[[d0,c.value]]),mr("md-slider",{ref_key:"slider",ref:t,class:"slider",onChange:A,step:"1",ticks:"",min:"0",max:"23",labeled:"",value:parseInt((Ce=c.value)==null?void 0:Ce.slice(0,2))},null,40,Pae)])]}),_:1}),Bs(C0,{class:"optional-field",label:"Mostra posizione attuale",onCheckboxChanged:te})]))}}),kae=cc(Mae,[["__scopeId","data-v-a03fa2ec"]]);function cd(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function C9(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.__proto__=e}/*!
 * GSAP 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var sc={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},R0={duration:.5,overwrite:!1,delay:0},XR,xa,Ys,Lc=1e8,Rs=1/Lc,g4=Math.PI*2,Dae=g4/4,Lae=0,R9=Math.sqrt,Oae=Math.cos,Fae=Math.sin,na=function(e){return typeof e=="string"},uo=function(e){return typeof e=="function"},Pd=function(e){return typeof e=="number"},ZR=function(e){return typeof e>"u"},bh=function(e){return typeof e=="object"},Rl=function(e){return e!==!1},KR=function(){return typeof window<"u"},Qw=function(e){return uo(e)||na(e)},P9=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},Ha=Array.isArray,y4=/(?:-?\.?\d|\.)+/gi,M9=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,jg=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,LA=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,k9=/[+-]=-?[.\d]+/,D9=/[^,'"\[\]\s]+/gi,zae=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,no,Qu,v4,YR,oc={},PT={},L9,O9=function(e){return(PT=P0(e,oc))&&Ol},JR=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},gx=function(e,t){return!t&&console.warn(e)},F9=function(e,t){return e&&(oc[e]=t)&&PT&&(PT[e]=t)||oc},yx=function(){return 0},Nae={suppressEvents:!0,isStart:!0,kill:!1},C2={suppressEvents:!0,kill:!1},Bae={suppressEvents:!0},QR={},Yf=[],x4={},z9,Jl={},OA={},$O=30,R2=[],eP="",tP=function(e){var t=e[0],o,c;if(bh(t)||uo(t)||(e=[e]),!(o=(t._gsap||{}).harness)){for(c=R2.length;c--&&!R2[c].targetTest(t););o=R2[c]}for(c=e.length;c--;)e[c]&&(e[c]._gsap||(e[c]._gsap=new aU(e[c],o)))||e.splice(c,1);return e},gm=function(e){return e._gsap||tP(Oc(e))[0]._gsap},N9=function(e,t,o){return(o=e[t])&&uo(o)?e[t]():ZR(o)&&e.getAttribute&&e.getAttribute(t)||o},Pl=function(e,t){return(e=e.split(",")).forEach(t)||e},yo=function(e){return Math.round(e*1e5)/1e5||0},Ro=function(e){return Math.round(e*1e7)/1e7||0},r0=function(e,t){var o=t.charAt(0),c=parseFloat(t.substr(2));return e=parseFloat(e),o==="+"?e+c:o==="-"?e-c:o==="*"?e*c:e/c},Vae=function(e,t){for(var o=t.length,c=0;e.indexOf(t[c])<0&&++c<o;);return c<o},MT=function(){var e=Yf.length,t=Yf.slice(0),o,c;for(x4={},Yf.length=0,o=0;o<e;o++)c=t[o],c&&c._lazy&&(c.render(c._lazy[0],c._lazy[1],!0)._lazy=0)},iP=function(e){return!!(e._initted||e._startAt||e.add)},B9=function(e,t,o,c){Yf.length&&!xa&&MT(),e.render(t,o,!!(xa&&t<0&&iP(e))),Yf.length&&!xa&&MT()},V9=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(D9).length<2?t:na(e)?e.trim():e},U9=function(e){return e},ac=function(e,t){for(var o in t)o in e||(e[o]=t[o]);return e},Uae=function(e){return function(t,o){for(var c in o)c in t||c==="duration"&&e||c==="ease"||(t[c]=o[c])}},P0=function(e,t){for(var o in t)e[o]=t[o];return e},GO=function r(e,t){for(var o in t)o!=="__proto__"&&o!=="constructor"&&o!=="prototype"&&(e[o]=bh(t[o])?r(e[o]||(e[o]={}),t[o]):t[o]);return e},kT=function(e,t){var o={},c;for(c in e)c in t||(o[c]=e[c]);return o},P1=function(e){var t=e.parent||no,o=e.keyframes?Uae(Ha(e.keyframes)):ac;if(Rl(e.inherit))for(;t;)o(e,t.vars.defaults),t=t.parent||t._dp;return e},jae=function(e,t){for(var o=e.length,c=o===t.length;c&&o--&&e[o]===t[o];);return o<0},j9=function(e,t,o,c,f){var y=e[c],s;if(f)for(s=t[f];y&&y[f]>s;)y=y._prev;return y?(t._next=y._next,y._next=t):(t._next=e[o],e[o]=t),t._next?t._next._prev=t:e[c]=t,t._prev=y,t.parent=t._dp=e,t},NE=function(e,t,o,c){o===void 0&&(o="_first"),c===void 0&&(c="_last");var f=t._prev,y=t._next;f?f._next=y:e[o]===t&&(e[o]=y),y?y._prev=f:e[c]===t&&(e[c]=f),t._next=t._prev=t.parent=null},op=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},ym=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var o=e;o;)o._dirty=1,o=o.parent;return e},$ae=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},b4=function(e,t,o,c){return e._startAt&&(xa?e._startAt.revert(C2):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,c))},Gae=function r(e){return!e||e._ts&&r(e.parent)},HO=function(e){return e._repeat?M0(e._tTime,e=e.duration()+e._rDelay)*e:0},M0=function(e,t){var o=Math.floor(e=Ro(e/t));return e&&o===e?o-1:o},DT=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},BE=function(e){return e._end=Ro(e._start+(e._tDur/Math.abs(e._ts||e._rts||Rs)||0))},VE=function(e,t){var o=e._dp;return o&&o.smoothChildTiming&&e._ts&&(e._start=Ro(o._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),BE(e),o._dirty||ym(o,e)),e},$9=function(e,t){var o;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(o=DT(e.rawTime(),t),(!t._dur||Hx(0,t.totalDuration(),o)-t._tTime>Rs)&&t.render(o,!0)),ym(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(o=e;o._dp;)o.rawTime()>=0&&o.totalTime(o._tTime),o=o._dp;e._zTime=-Rs}},ih=function(e,t,o,c){return t.parent&&op(t),t._start=Ro((Pd(o)?o:o||e!==no?Ac(e,o,t):e._time)+t._delay),t._end=Ro(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),j9(e,t,"_first","_last",e._sort?"_start":0),w4(t)||(e._recent=t),c||$9(e,t),e._ts<0&&VE(e,e._tTime),e},G9=function(e,t){return(oc.ScrollTrigger||JR("scrollTrigger",t))&&oc.ScrollTrigger.create(t,e)},H9=function(e,t,o,c,f){if(nP(e,t,f),!e._initted)return 1;if(!o&&e._pt&&!xa&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&z9!==ec.frame)return Yf.push(e),e._lazy=[f,c],1},Hae=function r(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||r(t))},w4=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},qae=function(e,t,o,c){var f=e.ratio,y=t<0||!t&&(!e._start&&Hae(e)&&!(!e._initted&&w4(e))||(e._ts<0||e._dp._ts<0)&&!w4(e))?0:1,s=e._rDelay,E=0,R,O,A;if(s&&e._repeat&&(E=Hx(0,e._tDur,t),O=M0(E,s),e._yoyo&&O&1&&(y=1-y),O!==M0(e._tTime,s)&&(f=1-y,e.vars.repeatRefresh&&e._initted&&e.invalidate())),y!==f||xa||c||e._zTime===Rs||!t&&e._zTime){if(!e._initted&&H9(e,t,c,o,E))return;for(A=e._zTime,e._zTime=t||(o?Rs:0),o||(o=t&&!A),e.ratio=y,e._from&&(y=1-y),e._time=0,e._tTime=E,R=e._pt;R;)R.r(y,R.d),R=R._next;t<0&&b4(e,t,o,!0),e._onUpdate&&!o&&rc(e,"onUpdate"),E&&e._repeat&&!o&&e.parent&&rc(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===y&&(y&&op(e,1),!o&&!xa&&(rc(e,y?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},Wae=function(e,t,o){var c;if(o>t)for(c=e._first;c&&c._start<=o;){if(c.data==="isPause"&&c._start>t)return c;c=c._next}else for(c=e._last;c&&c._start>=o;){if(c.data==="isPause"&&c._start<t)return c;c=c._prev}},k0=function(e,t,o,c){var f=e._repeat,y=Ro(t)||0,s=e._tTime/e._tDur;return s&&!c&&(e._time*=y/e._dur),e._dur=y,e._tDur=f?f<0?1e10:Ro(y*(f+1)+e._rDelay*f):y,s>0&&!c&&VE(e,e._tTime=e._tDur*s),e.parent&&BE(e),o||ym(e.parent,e),e},qO=function(e){return e instanceof _l?ym(e):k0(e,e._dur)},Xae={_start:0,endTime:yx,totalDuration:yx},Ac=function r(e,t,o){var c=e.labels,f=e._recent||Xae,y=e.duration()>=Lc?f.endTime(!1):e._dur,s,E,R;return na(t)&&(isNaN(t)||t in c)?(E=t.charAt(0),R=t.substr(-1)==="%",s=t.indexOf("="),E==="<"||E===">"?(s>=0&&(t=t.replace(/=/,"")),(E==="<"?f._start:f.endTime(f._repeat>=0))+(parseFloat(t.substr(1))||0)*(R?(s<0?f:o).totalDuration()/100:1)):s<0?(t in c||(c[t]=y),c[t]):(E=parseFloat(t.charAt(s-1)+t.substr(s+1)),R&&o&&(E=E/100*(Ha(o)?o[0]:o).totalDuration()),s>1?r(e,t.substr(0,s-1),o)+E:y+E)):t==null?y:+t},M1=function(e,t,o){var c=Pd(t[1]),f=(c?2:1)+(e<2?0:1),y=t[f],s,E;if(c&&(y.duration=t[1]),y.parent=o,e){for(s=y,E=o;E&&!("immediateRender"in s);)s=E.vars.defaults||{},E=Rl(E.vars.inherit)&&E.parent;y.immediateRender=Rl(s.immediateRender),e<2?y.runBackwards=1:y.startAt=t[f-1]}return new Co(t[0],y,t[f+1])},dp=function(e,t){return e||e===0?t(e):t},Hx=function(e,t,o){return o<e?e:o>t?t:o},Ua=function(e,t){return!na(e)||!(t=zae.exec(e))?"":t[1]},Zae=function(e,t,o){return dp(o,function(c){return Hx(e,t,c)})},T4=[].slice,q9=function(e,t){return e&&bh(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&bh(e[0]))&&!e.nodeType&&e!==Qu},Kae=function(e,t,o){return o===void 0&&(o=[]),e.forEach(function(c){var f;return na(c)&&!t||q9(c,1)?(f=o).push.apply(f,Oc(c)):o.push(c)})||o},Oc=function(e,t,o){return Ys&&!t&&Ys.selector?Ys.selector(e):na(e)&&!o&&(v4||!D0())?T4.call((t||YR).querySelectorAll(e),0):Ha(e)?Kae(e,o):q9(e)?T4.call(e,0):e?[e]:[]},E4=function(e){return e=Oc(e)[0]||gx("Invalid scope")||{},function(t){var o=e.current||e.nativeElement||e;return Oc(t,o.querySelectorAll?o:o===e?gx("Invalid scope")||YR.createElement("div"):e)}},W9=function(e){return e.sort(function(){return .5-Math.random()})},X9=function(e){if(uo(e))return e;var t=bh(e)?e:{each:e},o=vm(t.ease),c=t.from||0,f=parseFloat(t.base)||0,y={},s=c>0&&c<1,E=isNaN(c)||s,R=t.axis,O=c,A=c;return na(c)?O=A={center:.5,edges:.5,end:1}[c]||0:!s&&E&&(O=c[0],A=c[1]),function(U,$,te){var Q=(te||t).length,de=y[Q],Ce,Fe,Le,Me,at,pt,me,ye,Se;if(!de){if(Se=t.grid==="auto"?0:(t.grid||[1,Lc])[1],!Se){for(me=-Lc;me<(me=te[Se++].getBoundingClientRect().left)&&Se<Q;);Se<Q&&Se--}for(de=y[Q]=[],Ce=E?Math.min(Se,Q)*O-.5:c%Se,Fe=Se===Lc?0:E?Q*A/Se-.5:c/Se|0,me=0,ye=Lc,pt=0;pt<Q;pt++)Le=pt%Se-Ce,Me=Fe-(pt/Se|0),de[pt]=at=R?Math.abs(R==="y"?Me:Le):R9(Le*Le+Me*Me),at>me&&(me=at),at<ye&&(ye=at);c==="random"&&W9(de),de.max=me-ye,de.min=ye,de.v=Q=(parseFloat(t.amount)||parseFloat(t.each)*(Se>Q?Q-1:R?R==="y"?Q/Se:Se:Math.max(Se,Q/Se))||0)*(c==="edges"?-1:1),de.b=Q<0?f-Q:f,de.u=Ua(t.amount||t.each)||0,o=o&&Q<0?nU(o):o}return Q=(de[U]-de.min)/de.max||0,Ro(de.b+(o?o(Q):Q)*de.v)+de.u}},I4=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(o){var c=Ro(Math.round(parseFloat(o)/e)*e*t);return(c-c%1)/t+(Pd(o)?0:Ua(o))}},Z9=function(e,t){var o=Ha(e),c,f;return!o&&bh(e)&&(c=o=e.radius||Lc,e.values?(e=Oc(e.values),(f=!Pd(e[0]))&&(c*=c)):e=I4(e.increment)),dp(t,o?uo(e)?function(y){return f=e(y),Math.abs(f-y)<=c?f:y}:function(y){for(var s=parseFloat(f?y.x:y),E=parseFloat(f?y.y:0),R=Lc,O=0,A=e.length,U,$;A--;)f?(U=e[A].x-s,$=e[A].y-E,U=U*U+$*$):U=Math.abs(e[A]-s),U<R&&(R=U,O=A);return O=!c||R<=c?e[O]:y,f||O===y||Pd(y)?O:O+Ua(y)}:I4(e))},K9=function(e,t,o,c){return dp(Ha(e)?!t:o===!0?!!(o=0):!c,function(){return Ha(e)?e[~~(Math.random()*e.length)]:(o=o||1e-5)&&(c=o<1?Math.pow(10,(o+"").length-2):1)&&Math.floor(Math.round((e-o/2+Math.random()*(t-e+o*.99))/o)*o*c)/c})},Yae=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return function(c){return t.reduce(function(f,y){return y(f)},c)}},Jae=function(e,t){return function(o){return e(parseFloat(o))+(t||Ua(o))}},Qae=function(e,t,o){return J9(e,t,0,1,o)},Y9=function(e,t,o){return dp(o,function(c){return e[~~t(c)]})},ele=function r(e,t,o){var c=t-e;return Ha(e)?Y9(e,r(0,e.length),t):dp(o,function(f){return(c+(f-e)%c)%c+e})},tle=function r(e,t,o){var c=t-e,f=c*2;return Ha(e)?Y9(e,r(0,e.length-1),t):dp(o,function(y){return y=(f+(y-e)%f)%f||0,e+(y>c?f-y:y)})},vx=function(e){for(var t=0,o="",c,f,y,s;~(c=e.indexOf("random(",t));)y=e.indexOf(")",c),s=e.charAt(c+7)==="[",f=e.substr(c+7,y-c-7).match(s?D9:y4),o+=e.substr(t,c-t)+K9(s?f:+f[0],s?0:+f[1],+f[2]||1e-5),t=y+1;return o+e.substr(t,e.length-t)},J9=function(e,t,o,c,f){var y=t-e,s=c-o;return dp(f,function(E){return o+((E-e)/y*s||0)})},ile=function r(e,t,o,c){var f=isNaN(e+t)?0:function($){return(1-$)*e+$*t};if(!f){var y=na(e),s={},E,R,O,A,U;if(o===!0&&(c=1)&&(o=null),y)e={p:e},t={p:t};else if(Ha(e)&&!Ha(t)){for(O=[],A=e.length,U=A-2,R=1;R<A;R++)O.push(r(e[R-1],e[R]));A--,f=function(te){te*=A;var Q=Math.min(U,~~te);return O[Q](te-Q)},o=t}else c||(e=P0(Ha(e)?[]:{},e));if(!O){for(E in t)rP.call(s,e,E,"get",t[E]);f=function(te){return aP(te,s)||(y?e.p:e)}}}return dp(o,f)},WO=function(e,t,o){var c=e.labels,f=Lc,y,s,E;for(y in c)s=c[y]-t,s<0==!!o&&s&&f>(s=Math.abs(s))&&(E=y,f=s);return E},rc=function(e,t,o){var c=e.vars,f=c[t],y=Ys,s=e._ctx,E,R,O;if(f)return E=c[t+"Params"],R=c.callbackScope||e,o&&Yf.length&&MT(),s&&(Ys=s),O=E?f.apply(R,E):f.call(R),Ys=y,O},n1=function(e){return op(e),e.scrollTrigger&&e.scrollTrigger.kill(!!xa),e.progress()<1&&rc(e,"onInterrupt"),e},$g,Q9=[],eU=function(e){if(e)if(e=!e.name&&e.default||e,KR()||e.headless){var t=e.name,o=uo(e),c=t&&!o&&e.init?function(){this._props=[]}:e,f={init:yx,render:aP,add:rP,kill:yle,modifier:gle,rawVars:0},y={targetTest:0,get:0,getSetter:oP,aliases:{},register:0};if(D0(),e!==c){if(Jl[t])return;ac(c,ac(kT(e,f),y)),P0(c.prototype,P0(f,kT(e,y))),Jl[c.prop=t]=c,e.targetTest&&(R2.push(c),QR[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}F9(t,c),e.register&&e.register(Ol,c,Ml)}else Q9.push(e)},Cs=255,s1={aqua:[0,Cs,Cs],lime:[0,Cs,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Cs],navy:[0,0,128],white:[Cs,Cs,Cs],olive:[128,128,0],yellow:[Cs,Cs,0],orange:[Cs,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Cs,0,0],pink:[Cs,192,203],cyan:[0,Cs,Cs],transparent:[Cs,Cs,Cs,0]},FA=function(e,t,o){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(o-t)*e*6:e<.5?o:e*3<2?t+(o-t)*(2/3-e)*6:t)*Cs+.5|0},tU=function(e,t,o){var c=e?Pd(e)?[e>>16,e>>8&Cs,e&Cs]:0:s1.black,f,y,s,E,R,O,A,U,$,te;if(!c){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),s1[e])c=s1[e];else if(e.charAt(0)==="#"){if(e.length<6&&(f=e.charAt(1),y=e.charAt(2),s=e.charAt(3),e="#"+f+f+y+y+s+s+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return c=parseInt(e.substr(1,6),16),[c>>16,c>>8&Cs,c&Cs,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),c=[e>>16,e>>8&Cs,e&Cs]}else if(e.substr(0,3)==="hsl"){if(c=te=e.match(y4),!t)E=+c[0]%360/360,R=+c[1]/100,O=+c[2]/100,y=O<=.5?O*(R+1):O+R-O*R,f=O*2-y,c.length>3&&(c[3]*=1),c[0]=FA(E+1/3,f,y),c[1]=FA(E,f,y),c[2]=FA(E-1/3,f,y);else if(~e.indexOf("="))return c=e.match(M9),o&&c.length<4&&(c[3]=1),c}else c=e.match(y4)||s1.transparent;c=c.map(Number)}return t&&!te&&(f=c[0]/Cs,y=c[1]/Cs,s=c[2]/Cs,A=Math.max(f,y,s),U=Math.min(f,y,s),O=(A+U)/2,A===U?E=R=0:($=A-U,R=O>.5?$/(2-A-U):$/(A+U),E=A===f?(y-s)/$+(y<s?6:0):A===y?(s-f)/$+2:(f-y)/$+4,E*=60),c[0]=~~(E+.5),c[1]=~~(R*100+.5),c[2]=~~(O*100+.5)),o&&c.length<4&&(c[3]=1),c},iU=function(e){var t=[],o=[],c=-1;return e.split(Jf).forEach(function(f){var y=f.match(jg)||[];t.push.apply(t,y),o.push(c+=y.length+1)}),t.c=o,t},XO=function(e,t,o){var c="",f=(e+c).match(Jf),y=t?"hsla(":"rgba(",s=0,E,R,O,A;if(!f)return e;if(f=f.map(function(U){return(U=tU(U,t,1))&&y+(t?U[0]+","+U[1]+"%,"+U[2]+"%,"+U[3]:U.join(","))+")"}),o&&(O=iU(e),E=o.c,E.join(c)!==O.c.join(c)))for(R=e.replace(Jf,"1").split(jg),A=R.length-1;s<A;s++)c+=R[s]+(~E.indexOf(s)?f.shift()||y+"0,0,0,0)":(O.length?O:f.length?f:o).shift());if(!R)for(R=e.split(Jf),A=R.length-1;s<A;s++)c+=R[s]+f[s];return c+R[A]},Jf=function(){var r="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in s1)r+="|"+e+"\\b";return new RegExp(r+")","gi")}(),rle=/hsl[a]?\(/,rU=function(e){var t=e.join(" "),o;if(Jf.lastIndex=0,Jf.test(t))return o=rle.test(t),e[1]=XO(e[1],o),e[0]=XO(e[0],o,iU(e[1])),!0},xx,ec=function(){var r=Date.now,e=500,t=33,o=r(),c=o,f=1e3/240,y=f,s=[],E,R,O,A,U,$,te=function Q(de){var Ce=r()-c,Fe=de===!0,Le,Me,at,pt;if((Ce>e||Ce<0)&&(o+=Ce-t),c+=Ce,at=c-o,Le=at-y,(Le>0||Fe)&&(pt=++A.frame,U=at-A.time*1e3,A.time=at=at/1e3,y+=Le+(Le>=f?4:f-Le),Me=1),Fe||(E=R(Q)),Me)for($=0;$<s.length;$++)s[$](at,U,pt,de)};return A={time:0,frame:0,tick:function(){te(!0)},deltaRatio:function(de){return U/(1e3/(de||60))},wake:function(){L9&&(!v4&&KR()&&(Qu=v4=window,YR=Qu.document||{},oc.gsap=Ol,(Qu.gsapVersions||(Qu.gsapVersions=[])).push(Ol.version),O9(PT||Qu.GreenSockGlobals||!Qu.gsap&&Qu||{}),Q9.forEach(eU)),O=typeof requestAnimationFrame<"u"&&requestAnimationFrame,E&&A.sleep(),R=O||function(de){return setTimeout(de,y-A.time*1e3+1|0)},xx=1,te(2))},sleep:function(){(O?cancelAnimationFrame:clearTimeout)(E),xx=0,R=yx},lagSmoothing:function(de,Ce){e=de||1/0,t=Math.min(Ce||33,e)},fps:function(de){f=1e3/(de||240),y=A.time*1e3+f},add:function(de,Ce,Fe){var Le=Ce?function(Me,at,pt,me){de(Me,at,pt,me),A.remove(Le)}:de;return A.remove(de),s[Fe?"unshift":"push"](Le),D0(),Le},remove:function(de,Ce){~(Ce=s.indexOf(de))&&s.splice(Ce,1)&&$>=Ce&&$--},_listeners:s},A}(),D0=function(){return!xx&&ec.wake()},Hn={},nle=/^[\d.\-M][\d.\-,\s]/,sle=/["']/g,ole=function(e){for(var t={},o=e.substr(1,e.length-3).split(":"),c=o[0],f=1,y=o.length,s,E,R;f<y;f++)E=o[f],s=f!==y-1?E.lastIndexOf(","):E.length,R=E.substr(0,s),t[c]=isNaN(R)?R.replace(sle,"").trim():+R,c=E.substr(s+1).trim();return t},ale=function(e){var t=e.indexOf("(")+1,o=e.indexOf(")"),c=e.indexOf("(",t);return e.substring(t,~c&&c<o?e.indexOf(")",o+1):o)},lle=function(e){var t=(e+"").split("("),o=Hn[t[0]];return o&&t.length>1&&o.config?o.config.apply(null,~e.indexOf("{")?[ole(t[1])]:ale(e).split(",").map(V9)):Hn._CE&&nle.test(e)?Hn._CE("",e):o},nU=function(e){return function(t){return 1-e(1-t)}},sU=function r(e,t){for(var o=e._first,c;o;)o instanceof _l?r(o,t):o.vars.yoyoEase&&(!o._yoyo||!o._repeat)&&o._yoyo!==t&&(o.timeline?r(o.timeline,t):(c=o._ease,o._ease=o._yEase,o._yEase=c,o._yoyo=t)),o=o._next},vm=function(e,t){return e&&(uo(e)?e:Hn[e]||lle(e))||t},Ym=function(e,t,o,c){o===void 0&&(o=function(E){return 1-t(1-E)}),c===void 0&&(c=function(E){return E<.5?t(E*2)/2:1-t((1-E)*2)/2});var f={easeIn:t,easeOut:o,easeInOut:c},y;return Pl(e,function(s){Hn[s]=oc[s]=f,Hn[y=s.toLowerCase()]=o;for(var E in f)Hn[y+(E==="easeIn"?".in":E==="easeOut"?".out":".inOut")]=Hn[s+"."+E]=f[E]}),f},oU=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},zA=function r(e,t,o){var c=t>=1?t:1,f=(o||(e?.3:.45))/(t<1?t:1),y=f/g4*(Math.asin(1/c)||0),s=function(O){return O===1?1:c*Math.pow(2,-10*O)*Fae((O-y)*f)+1},E=e==="out"?s:e==="in"?function(R){return 1-s(1-R)}:oU(s);return f=g4/f,E.config=function(R,O){return r(e,R,O)},E},NA=function r(e,t){t===void 0&&(t=1.70158);var o=function(y){return y?--y*y*((t+1)*y+t)+1:0},c=e==="out"?o:e==="in"?function(f){return 1-o(1-f)}:oU(o);return c.config=function(f){return r(e,f)},c};Pl("Linear,Quad,Cubic,Quart,Quint,Strong",function(r,e){var t=e<5?e+1:e;Ym(r+",Power"+(t-1),e?function(o){return Math.pow(o,t)}:function(o){return o},function(o){return 1-Math.pow(1-o,t)},function(o){return o<.5?Math.pow(o*2,t)/2:1-Math.pow((1-o)*2,t)/2})});Hn.Linear.easeNone=Hn.none=Hn.Linear.easeIn;Ym("Elastic",zA("in"),zA("out"),zA());(function(r,e){var t=1/e,o=2*t,c=2.5*t,f=function(s){return s<t?r*s*s:s<o?r*Math.pow(s-1.5/e,2)+.75:s<c?r*(s-=2.25/e)*s+.9375:r*Math.pow(s-2.625/e,2)+.984375};Ym("Bounce",function(y){return 1-f(1-y)},f)})(7.5625,2.75);Ym("Expo",function(r){return Math.pow(2,10*(r-1))*r+r*r*r*r*r*r*(1-r)});Ym("Circ",function(r){return-(R9(1-r*r)-1)});Ym("Sine",function(r){return r===1?1:-Oae(r*Dae)+1});Ym("Back",NA("in"),NA("out"),NA());Hn.SteppedEase=Hn.steps=oc.SteppedEase={config:function(e,t){e===void 0&&(e=1);var o=1/e,c=e+(t?0:1),f=t?1:0,y=1-Rs;return function(s){return((c*Hx(0,y,s)|0)+f)*o}}};R0.ease=Hn["quad.out"];Pl("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(r){return eP+=r+","+r+"Params,"});var aU=function(e,t){this.id=Lae++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:N9,this.set=t?t.getSetter:oP},bx=function(){function r(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,k0(this,+t.duration,1,1),this.data=t.data,Ys&&(this._ctx=Ys,Ys.data.push(this)),xx||ec.wake()}var e=r.prototype;return e.delay=function(o){return o||o===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+o-this._delay),this._delay=o,this):this._delay},e.duration=function(o){return arguments.length?this.totalDuration(this._repeat>0?o+(o+this._rDelay)*this._repeat:o):this.totalDuration()&&this._dur},e.totalDuration=function(o){return arguments.length?(this._dirty=0,k0(this,this._repeat<0?o:(o-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(o,c){if(D0(),!arguments.length)return this._tTime;var f=this._dp;if(f&&f.smoothChildTiming&&this._ts){for(VE(this,o),!f._dp||f.parent||$9(f,this);f&&f.parent;)f.parent._time!==f._start+(f._ts>=0?f._tTime/f._ts:(f.totalDuration()-f._tTime)/-f._ts)&&f.totalTime(f._tTime,!0),f=f.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&o<this._tDur||this._ts<0&&o>0||!this._tDur&&!o)&&ih(this._dp,this,this._start-this._delay)}return(this._tTime!==o||!this._dur&&!c||this._initted&&Math.abs(this._zTime)===Rs||!o&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=o),B9(this,o,c)),this},e.time=function(o,c){return arguments.length?this.totalTime(Math.min(this.totalDuration(),o+HO(this))%(this._dur+this._rDelay)||(o?this._dur:0),c):this._time},e.totalProgress=function(o,c){return arguments.length?this.totalTime(this.totalDuration()*o,c):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(o,c){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-o:o)+HO(this),c):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(o,c){var f=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(o-1)*f,c):this._repeat?M0(this._tTime,f)+1:1},e.timeScale=function(o,c){if(!arguments.length)return this._rts===-Rs?0:this._rts;if(this._rts===o)return this;var f=this.parent&&this._ts?DT(this.parent._time,this):this._tTime;return this._rts=+o||0,this._ts=this._ps||o===-Rs?0:this._rts,this.totalTime(Hx(-Math.abs(this._delay),this.totalDuration(),f),c!==!1),BE(this),$ae(this)},e.paused=function(o){return arguments.length?(this._ps!==o&&(this._ps=o,o?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(D0(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Rs&&(this._tTime-=Rs)))),this):this._ps},e.startTime=function(o){if(arguments.length){this._start=o;var c=this.parent||this._dp;return c&&(c._sort||!this.parent)&&ih(c,this,o-this._delay),this}return this._start},e.endTime=function(o){return this._start+(Rl(o)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(o){var c=this.parent||this._dp;return c?o&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?DT(c.rawTime(o),this):this._tTime:this._tTime},e.revert=function(o){o===void 0&&(o=Bae);var c=xa;return xa=o,iP(this)&&(this.timeline&&this.timeline.revert(o),this.totalTime(-.01,o.suppressEvents)),this.data!=="nested"&&o.kill!==!1&&this.kill(),xa=c,this},e.globalTime=function(o){for(var c=this,f=arguments.length?o:c.rawTime();c;)f=c._start+f/(Math.abs(c._ts)||1),c=c._dp;return!this.parent&&this._sat?this._sat.globalTime(o):f},e.repeat=function(o){return arguments.length?(this._repeat=o===1/0?-2:o,qO(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(o){if(arguments.length){var c=this._time;return this._rDelay=o,qO(this),c?this.time(c):this}return this._rDelay},e.yoyo=function(o){return arguments.length?(this._yoyo=o,this):this._yoyo},e.seek=function(o,c){return this.totalTime(Ac(this,o),Rl(c))},e.restart=function(o,c){return this.play().totalTime(o?-this._delay:0,Rl(c)),this._dur||(this._zTime=-Rs),this},e.play=function(o,c){return o!=null&&this.seek(o,c),this.reversed(!1).paused(!1)},e.reverse=function(o,c){return o!=null&&this.seek(o||this.totalDuration(),c),this.reversed(!0).paused(!1)},e.pause=function(o,c){return o!=null&&this.seek(o,c),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(o){return arguments.length?(!!o!==this.reversed()&&this.timeScale(-this._rts||(o?-Rs:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-Rs,this},e.isActive=function(){var o=this.parent||this._dp,c=this._start,f;return!!(!o||this._ts&&this._initted&&o.isActive()&&(f=o.rawTime(!0))>=c&&f<this.endTime(!0)-Rs)},e.eventCallback=function(o,c,f){var y=this.vars;return arguments.length>1?(c?(y[o]=c,f&&(y[o+"Params"]=f),o==="onUpdate"&&(this._onUpdate=c)):delete y[o],this):y[o]},e.then=function(o){var c=this;return new Promise(function(f){var y=uo(o)?o:U9,s=function(){var R=c.then;c.then=null,uo(y)&&(y=y(c))&&(y.then||y===c)&&(c.then=R),f(y),c.then=R};c._initted&&c.totalProgress()===1&&c._ts>=0||!c._tTime&&c._ts<0?s():c._prom=s})},e.kill=function(){n1(this)},r}();ac(bx.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-Rs,_prom:0,_ps:!1,_rts:1});var _l=function(r){C9(e,r);function e(o,c){var f;return o===void 0&&(o={}),f=r.call(this,o)||this,f.labels={},f.smoothChildTiming=!!o.smoothChildTiming,f.autoRemoveChildren=!!o.autoRemoveChildren,f._sort=Rl(o.sortChildren),no&&ih(o.parent||no,cd(f),c),o.reversed&&f.reverse(),o.paused&&f.paused(!0),o.scrollTrigger&&G9(cd(f),o.scrollTrigger),f}var t=e.prototype;return t.to=function(c,f,y){return M1(0,arguments,this),this},t.from=function(c,f,y){return M1(1,arguments,this),this},t.fromTo=function(c,f,y,s){return M1(2,arguments,this),this},t.set=function(c,f,y){return f.duration=0,f.parent=this,P1(f).repeatDelay||(f.repeat=0),f.immediateRender=!!f.immediateRender,new Co(c,f,Ac(this,y),1),this},t.call=function(c,f,y){return ih(this,Co.delayedCall(0,c,f),y)},t.staggerTo=function(c,f,y,s,E,R,O){return y.duration=f,y.stagger=y.stagger||s,y.onComplete=R,y.onCompleteParams=O,y.parent=this,new Co(c,y,Ac(this,E)),this},t.staggerFrom=function(c,f,y,s,E,R,O){return y.runBackwards=1,P1(y).immediateRender=Rl(y.immediateRender),this.staggerTo(c,f,y,s,E,R,O)},t.staggerFromTo=function(c,f,y,s,E,R,O,A){return s.startAt=y,P1(s).immediateRender=Rl(s.immediateRender),this.staggerTo(c,f,s,E,R,O,A)},t.render=function(c,f,y){var s=this._time,E=this._dirty?this.totalDuration():this._tDur,R=this._dur,O=c<=0?0:Ro(c),A=this._zTime<0!=c<0&&(this._initted||!R),U,$,te,Q,de,Ce,Fe,Le,Me,at,pt,me;if(this!==no&&O>E&&c>=0&&(O=E),O!==this._tTime||y||A){if(s!==this._time&&R&&(O+=this._time-s,c+=this._time-s),U=O,Me=this._start,Le=this._ts,Ce=!Le,A&&(R||(s=this._zTime),(c||!f)&&(this._zTime=c)),this._repeat){if(pt=this._yoyo,de=R+this._rDelay,this._repeat<-1&&c<0)return this.totalTime(de*100+c,f,y);if(U=Ro(O%de),O===E?(Q=this._repeat,U=R):(at=Ro(O/de),Q=~~at,Q&&Q===at&&(U=R,Q--),U>R&&(U=R)),at=M0(this._tTime,de),!s&&this._tTime&&at!==Q&&this._tTime-at*de-this._dur<=0&&(at=Q),pt&&Q&1&&(U=R-U,me=1),Q!==at&&!this._lock){var ye=pt&&at&1,Se=ye===(pt&&Q&1);if(Q<at&&(ye=!ye),s=ye?0:O%R?R:O,this._lock=1,this.render(s||(me?0:Ro(Q*de)),f,!R)._lock=0,this._tTime=O,!f&&this.parent&&rc(this,"onRepeat"),this.vars.repeatRefresh&&!me&&(this.invalidate()._lock=1),s&&s!==this._time||Ce!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(R=this._dur,E=this._tDur,Se&&(this._lock=2,s=ye?R:-1e-4,this.render(s,!0),this.vars.repeatRefresh&&!me&&this.invalidate()),this._lock=0,!this._ts&&!Ce)return this;sU(this,me)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(Fe=Wae(this,Ro(s),Ro(U)),Fe&&(O-=U-(U=Fe._start))),this._tTime=O,this._time=U,this._act=!Le,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=c,s=0),!s&&O&&!f&&!at&&(rc(this,"onStart"),this._tTime!==O))return this;if(U>=s&&c>=0)for($=this._first;$;){if(te=$._next,($._act||U>=$._start)&&$._ts&&Fe!==$){if($.parent!==this)return this.render(c,f,y);if($.render($._ts>0?(U-$._start)*$._ts:($._dirty?$.totalDuration():$._tDur)+(U-$._start)*$._ts,f,y),U!==this._time||!this._ts&&!Ce){Fe=0,te&&(O+=this._zTime=-Rs);break}}$=te}else{$=this._last;for(var ke=c<0?c:U;$;){if(te=$._prev,($._act||ke<=$._end)&&$._ts&&Fe!==$){if($.parent!==this)return this.render(c,f,y);if($.render($._ts>0?(ke-$._start)*$._ts:($._dirty?$.totalDuration():$._tDur)+(ke-$._start)*$._ts,f,y||xa&&iP($)),U!==this._time||!this._ts&&!Ce){Fe=0,te&&(O+=this._zTime=ke?-Rs:Rs);break}}$=te}}if(Fe&&!f&&(this.pause(),Fe.render(U>=s?0:-Rs)._zTime=U>=s?1:-1,this._ts))return this._start=Me,BE(this),this.render(c,f,y);this._onUpdate&&!f&&rc(this,"onUpdate",!0),(O===E&&this._tTime>=this.totalDuration()||!O&&s)&&(Me===this._start||Math.abs(Le)!==Math.abs(this._ts))&&(this._lock||((c||!R)&&(O===E&&this._ts>0||!O&&this._ts<0)&&op(this,1),!f&&!(c<0&&!s)&&(O||s||!E)&&(rc(this,O===E&&c>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(O<E&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(c,f){var y=this;if(Pd(f)||(f=Ac(this,f,c)),!(c instanceof bx)){if(Ha(c))return c.forEach(function(s){return y.add(s,f)}),this;if(na(c))return this.addLabel(c,f);if(uo(c))c=Co.delayedCall(0,c);else return this}return this!==c?ih(this,c,f):this},t.getChildren=function(c,f,y,s){c===void 0&&(c=!0),f===void 0&&(f=!0),y===void 0&&(y=!0),s===void 0&&(s=-Lc);for(var E=[],R=this._first;R;)R._start>=s&&(R instanceof Co?f&&E.push(R):(y&&E.push(R),c&&E.push.apply(E,R.getChildren(!0,f,y)))),R=R._next;return E},t.getById=function(c){for(var f=this.getChildren(1,1,1),y=f.length;y--;)if(f[y].vars.id===c)return f[y]},t.remove=function(c){return na(c)?this.removeLabel(c):uo(c)?this.killTweensOf(c):(c.parent===this&&NE(this,c),c===this._recent&&(this._recent=this._last),ym(this))},t.totalTime=function(c,f){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Ro(ec.time-(this._ts>0?c/this._ts:(this.totalDuration()-c)/-this._ts))),r.prototype.totalTime.call(this,c,f),this._forcing=0,this):this._tTime},t.addLabel=function(c,f){return this.labels[c]=Ac(this,f),this},t.removeLabel=function(c){return delete this.labels[c],this},t.addPause=function(c,f,y){var s=Co.delayedCall(0,f||yx,y);return s.data="isPause",this._hasPause=1,ih(this,s,Ac(this,c))},t.removePause=function(c){var f=this._first;for(c=Ac(this,c);f;)f._start===c&&f.data==="isPause"&&op(f),f=f._next},t.killTweensOf=function(c,f,y){for(var s=this.getTweensOf(c,y),E=s.length;E--;)Bf!==s[E]&&s[E].kill(c,f);return this},t.getTweensOf=function(c,f){for(var y=[],s=Oc(c),E=this._first,R=Pd(f),O;E;)E instanceof Co?Vae(E._targets,s)&&(R?(!Bf||E._initted&&E._ts)&&E.globalTime(0)<=f&&E.globalTime(E.totalDuration())>f:!f||E.isActive())&&y.push(E):(O=E.getTweensOf(s,f)).length&&y.push.apply(y,O),E=E._next;return y},t.tweenTo=function(c,f){f=f||{};var y=this,s=Ac(y,c),E=f,R=E.startAt,O=E.onStart,A=E.onStartParams,U=E.immediateRender,$,te=Co.to(y,ac({ease:f.ease||"none",lazy:!1,immediateRender:!1,time:s,overwrite:"auto",duration:f.duration||Math.abs((s-(R&&"time"in R?R.time:y._time))/y.timeScale())||Rs,onStart:function(){if(y.pause(),!$){var de=f.duration||Math.abs((s-(R&&"time"in R?R.time:y._time))/y.timeScale());te._dur!==de&&k0(te,de,0,1).render(te._time,!0,!0),$=1}O&&O.apply(te,A||[])}},f));return U?te.render(0):te},t.tweenFromTo=function(c,f,y){return this.tweenTo(f,ac({startAt:{time:Ac(this,c)}},y))},t.recent=function(){return this._recent},t.nextLabel=function(c){return c===void 0&&(c=this._time),WO(this,Ac(this,c))},t.previousLabel=function(c){return c===void 0&&(c=this._time),WO(this,Ac(this,c),1)},t.currentLabel=function(c){return arguments.length?this.seek(c,!0):this.previousLabel(this._time+Rs)},t.shiftChildren=function(c,f,y){y===void 0&&(y=0);for(var s=this._first,E=this.labels,R;s;)s._start>=y&&(s._start+=c,s._end+=c),s=s._next;if(f)for(R in E)E[R]>=y&&(E[R]+=c);return ym(this)},t.invalidate=function(c){var f=this._first;for(this._lock=0;f;)f.invalidate(c),f=f._next;return r.prototype.invalidate.call(this,c)},t.clear=function(c){c===void 0&&(c=!0);for(var f=this._first,y;f;)y=f._next,this.remove(f),f=y;return this._dp&&(this._time=this._tTime=this._pTime=0),c&&(this.labels={}),ym(this)},t.totalDuration=function(c){var f=0,y=this,s=y._last,E=Lc,R,O,A;if(arguments.length)return y.timeScale((y._repeat<0?y.duration():y.totalDuration())/(y.reversed()?-c:c));if(y._dirty){for(A=y.parent;s;)R=s._prev,s._dirty&&s.totalDuration(),O=s._start,O>E&&y._sort&&s._ts&&!y._lock?(y._lock=1,ih(y,s,O-s._delay,1)._lock=0):E=O,O<0&&s._ts&&(f-=O,(!A&&!y._dp||A&&A.smoothChildTiming)&&(y._start+=O/y._ts,y._time-=O,y._tTime-=O),y.shiftChildren(-O,!1,-1/0),E=0),s._end>f&&s._ts&&(f=s._end),s=R;k0(y,y===no&&y._time>f?y._time:f,1,1),y._dirty=0}return y._tDur},e.updateRoot=function(c){if(no._ts&&(B9(no,DT(c,no)),z9=ec.frame),ec.frame>=$O){$O+=sc.autoSleep||120;var f=no._first;if((!f||!f._ts)&&sc.autoSleep&&ec._listeners.length<2){for(;f&&!f._ts;)f=f._next;f||ec.sleep()}}},e}(bx);ac(_l.prototype,{_lock:0,_hasPause:0,_forcing:0});var cle=function(e,t,o,c,f,y,s){var E=new Ml(this._pt,e,t,0,1,fU,null,f),R=0,O=0,A,U,$,te,Q,de,Ce,Fe;for(E.b=o,E.e=c,o+="",c+="",(Ce=~c.indexOf("random("))&&(c=vx(c)),y&&(Fe=[o,c],y(Fe,e,t),o=Fe[0],c=Fe[1]),U=o.match(LA)||[];A=LA.exec(c);)te=A[0],Q=c.substring(R,A.index),$?$=($+1)%5:Q.substr(-5)==="rgba("&&($=1),te!==U[O++]&&(de=parseFloat(U[O-1])||0,E._pt={_next:E._pt,p:Q||O===1?Q:",",s:de,c:te.charAt(1)==="="?r0(de,te)-de:parseFloat(te)-de,m:$&&$<4?Math.round:0},R=LA.lastIndex);return E.c=R<c.length?c.substring(R,c.length):"",E.fp=s,(k9.test(c)||Ce)&&(E.e=0),this._pt=E,E},rP=function(e,t,o,c,f,y,s,E,R,O){uo(c)&&(c=c(f||0,e,y));var A=e[t],U=o!=="get"?o:uo(A)?R?e[t.indexOf("set")||!uo(e["get"+t.substr(3)])?t:"get"+t.substr(3)](R):e[t]():A,$=uo(A)?R?ple:hU:sP,te;if(na(c)&&(~c.indexOf("random(")&&(c=vx(c)),c.charAt(1)==="="&&(te=r0(U,c)+(Ua(U)||0),(te||te===0)&&(c=te))),!O||U!==c||S4)return!isNaN(U*c)&&c!==""?(te=new Ml(this._pt,e,t,+U||0,c-(U||0),typeof A=="boolean"?_le:dU,0,$),R&&(te.fp=R),s&&te.modifier(s,this,e),this._pt=te):(!A&&!(t in e)&&JR(t,c),cle.call(this,e,t,U,c,$,E||sc.stringFilter,R))},ule=function(e,t,o,c,f){if(uo(e)&&(e=k1(e,f,t,o,c)),!bh(e)||e.style&&e.nodeType||Ha(e)||P9(e))return na(e)?k1(e,f,t,o,c):e;var y={},s;for(s in e)y[s]=k1(e[s],f,t,o,c);return y},lU=function(e,t,o,c,f,y){var s,E,R,O;if(Jl[e]&&(s=new Jl[e]).init(f,s.rawVars?t[e]:ule(t[e],c,f,y,o),o,c,y)!==!1&&(o._pt=E=new Ml(o._pt,f,e,0,1,s.render,s,0,s.priority),o!==$g))for(R=o._ptLookup[o._targets.indexOf(f)],O=s._props.length;O--;)R[s._props[O]]=E;return s},Bf,S4,nP=function r(e,t,o){var c=e.vars,f=c.ease,y=c.startAt,s=c.immediateRender,E=c.lazy,R=c.onUpdate,O=c.runBackwards,A=c.yoyoEase,U=c.keyframes,$=c.autoRevert,te=e._dur,Q=e._startAt,de=e._targets,Ce=e.parent,Fe=Ce&&Ce.data==="nested"?Ce.vars.targets:de,Le=e._overwrite==="auto"&&!XR,Me=e.timeline,at,pt,me,ye,Se,ke,Ve,He,Oe,xi,ui,ti,ri;if(Me&&(!U||!f)&&(f="none"),e._ease=vm(f,R0.ease),e._yEase=A?nU(vm(A===!0?f:A,R0.ease)):0,A&&e._yoyo&&!e._repeat&&(A=e._yEase,e._yEase=e._ease,e._ease=A),e._from=!Me&&!!c.runBackwards,!Me||U&&!c.stagger){if(He=de[0]?gm(de[0]).harness:0,ti=He&&c[He.prop],at=kT(c,QR),Q&&(Q._zTime<0&&Q.progress(1),t<0&&O&&s&&!$?Q.render(-1,!0):Q.revert(O&&te?C2:Nae),Q._lazy=0),y){if(op(e._startAt=Co.set(de,ac({data:"isStart",overwrite:!1,parent:Ce,immediateRender:!0,lazy:!Q&&Rl(E),startAt:null,delay:0,onUpdate:R&&function(){return rc(e,"onUpdate")},stagger:0},y))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(xa||!s&&!$)&&e._startAt.revert(C2),s&&te&&t<=0&&o<=0){t&&(e._zTime=t);return}}else if(O&&te&&!Q){if(t&&(s=!1),me=ac({overwrite:!1,data:"isFromStart",lazy:s&&!Q&&Rl(E),immediateRender:s,stagger:0,parent:Ce},at),ti&&(me[He.prop]=ti),op(e._startAt=Co.set(de,me)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(xa?e._startAt.revert(C2):e._startAt.render(-1,!0)),e._zTime=t,!s)r(e._startAt,Rs,Rs);else if(!t)return}for(e._pt=e._ptCache=0,E=te&&Rl(E)||E&&!te,pt=0;pt<de.length;pt++){if(Se=de[pt],Ve=Se._gsap||tP(de)[pt]._gsap,e._ptLookup[pt]=xi={},x4[Ve.id]&&Yf.length&&MT(),ui=Fe===de?pt:Fe.indexOf(Se),He&&(Oe=new He).init(Se,ti||at,e,ui,Fe)!==!1&&(e._pt=ye=new Ml(e._pt,Se,Oe.name,0,1,Oe.render,Oe,0,Oe.priority),Oe._props.forEach(function(Si){xi[Si]=ye}),Oe.priority&&(ke=1)),!He||ti)for(me in at)Jl[me]&&(Oe=lU(me,at,e,ui,Se,Fe))?Oe.priority&&(ke=1):xi[me]=ye=rP.call(e,Se,me,"get",at[me],ui,Fe,0,c.stringFilter);e._op&&e._op[pt]&&e.kill(Se,e._op[pt]),Le&&e._pt&&(Bf=e,no.killTweensOf(Se,xi,e.globalTime(t)),ri=!e.parent,Bf=0),e._pt&&E&&(x4[Ve.id]=1)}ke&&pU(e),e._onInit&&e._onInit(e)}e._onUpdate=R,e._initted=(!e._op||e._pt)&&!ri,U&&t<=0&&Me.render(Lc,!0,!0)},hle=function(e,t,o,c,f,y,s,E){var R=(e._pt&&e._ptCache||(e._ptCache={}))[t],O,A,U,$;if(!R)for(R=e._ptCache[t]=[],U=e._ptLookup,$=e._targets.length;$--;){if(O=U[$][t],O&&O.d&&O.d._pt)for(O=O.d._pt;O&&O.p!==t&&O.fp!==t;)O=O._next;if(!O)return S4=1,e.vars[t]="+=0",nP(e,s),S4=0,E?gx(t+" not eligible for reset"):1;R.push(O)}for($=R.length;$--;)A=R[$],O=A._pt||A,O.s=(c||c===0)&&!f?c:O.s+(c||0)+y*O.c,O.c=o-O.s,A.e&&(A.e=yo(o)+Ua(A.e)),A.b&&(A.b=O.s+Ua(A.b))},dle=function(e,t){var o=e[0]?gm(e[0]).harness:0,c=o&&o.aliases,f,y,s,E;if(!c)return t;f=P0({},t);for(y in c)if(y in f)for(E=c[y].split(","),s=E.length;s--;)f[E[s]]=f[y];return f},fle=function(e,t,o,c){var f=t.ease||c||"power1.inOut",y,s;if(Ha(t))s=o[e]||(o[e]=[]),t.forEach(function(E,R){return s.push({t:R/(t.length-1)*100,v:E,e:f})});else for(y in t)s=o[y]||(o[y]=[]),y==="ease"||s.push({t:parseFloat(e),v:t[y],e:f})},k1=function(e,t,o,c,f){return uo(e)?e.call(t,o,c,f):na(e)&&~e.indexOf("random(")?vx(e):e},cU=eP+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",uU={};Pl(cU+",id,stagger,delay,duration,paused,scrollTrigger",function(r){return uU[r]=1});var Co=function(r){C9(e,r);function e(o,c,f,y){var s;typeof c=="number"&&(f.duration=c,c=f,f=null),s=r.call(this,y?c:P1(c))||this;var E=s.vars,R=E.duration,O=E.delay,A=E.immediateRender,U=E.stagger,$=E.overwrite,te=E.keyframes,Q=E.defaults,de=E.scrollTrigger,Ce=E.yoyoEase,Fe=c.parent||no,Le=(Ha(o)||P9(o)?Pd(o[0]):"length"in c)?[o]:Oc(o),Me,at,pt,me,ye,Se,ke,Ve;if(s._targets=Le.length?tP(Le):gx("GSAP target "+o+" not found. https://gsap.com",!sc.nullTargetWarn)||[],s._ptLookup=[],s._overwrite=$,te||U||Qw(R)||Qw(O)){if(c=s.vars,Me=s.timeline=new _l({data:"nested",defaults:Q||{},targets:Fe&&Fe.data==="nested"?Fe.vars.targets:Le}),Me.kill(),Me.parent=Me._dp=cd(s),Me._start=0,U||Qw(R)||Qw(O)){if(me=Le.length,ke=U&&X9(U),bh(U))for(ye in U)~cU.indexOf(ye)&&(Ve||(Ve={}),Ve[ye]=U[ye]);for(at=0;at<me;at++)pt=kT(c,uU),pt.stagger=0,Ce&&(pt.yoyoEase=Ce),Ve&&P0(pt,Ve),Se=Le[at],pt.duration=+k1(R,cd(s),at,Se,Le),pt.delay=(+k1(O,cd(s),at,Se,Le)||0)-s._delay,!U&&me===1&&pt.delay&&(s._delay=O=pt.delay,s._start+=O,pt.delay=0),Me.to(Se,pt,ke?ke(at,Se,Le):0),Me._ease=Hn.none;Me.duration()?R=O=0:s.timeline=0}else if(te){P1(ac(Me.vars.defaults,{ease:"none"})),Me._ease=vm(te.ease||c.ease||"none");var He=0,Oe,xi,ui;if(Ha(te))te.forEach(function(ti){return Me.to(Le,ti,">")}),Me.duration();else{pt={};for(ye in te)ye==="ease"||ye==="easeEach"||fle(ye,te[ye],pt,te.easeEach);for(ye in pt)for(Oe=pt[ye].sort(function(ti,ri){return ti.t-ri.t}),He=0,at=0;at<Oe.length;at++)xi=Oe[at],ui={ease:xi.e,duration:(xi.t-(at?Oe[at-1].t:0))/100*R},ui[ye]=xi.v,Me.to(Le,ui,He),He+=ui.duration;Me.duration()<R&&Me.to({},{duration:R-Me.duration()})}}R||s.duration(R=Me.duration())}else s.timeline=0;return $===!0&&!XR&&(Bf=cd(s),no.killTweensOf(Le),Bf=0),ih(Fe,cd(s),f),c.reversed&&s.reverse(),c.paused&&s.paused(!0),(A||!R&&!te&&s._start===Ro(Fe._time)&&Rl(A)&&Gae(cd(s))&&Fe.data!=="nested")&&(s._tTime=-Rs,s.render(Math.max(0,-O)||0)),de&&G9(cd(s),de),s}var t=e.prototype;return t.render=function(c,f,y){var s=this._time,E=this._tDur,R=this._dur,O=c<0,A=c>E-Rs&&!O?E:c<Rs?0:c,U,$,te,Q,de,Ce,Fe,Le,Me;if(!R)qae(this,c,f,y);else if(A!==this._tTime||!c||y||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==O||this._lazy){if(U=A,Le=this.timeline,this._repeat){if(Q=R+this._rDelay,this._repeat<-1&&O)return this.totalTime(Q*100+c,f,y);if(U=Ro(A%Q),A===E?(te=this._repeat,U=R):(de=Ro(A/Q),te=~~de,te&&te===de?(U=R,te--):U>R&&(U=R)),Ce=this._yoyo&&te&1,Ce&&(Me=this._yEase,U=R-U),de=M0(this._tTime,Q),U===s&&!y&&this._initted&&te===de)return this._tTime=A,this;te!==de&&(Le&&this._yEase&&sU(Le,Ce),this.vars.repeatRefresh&&!Ce&&!this._lock&&U!==Q&&this._initted&&(this._lock=y=1,this.render(Ro(Q*te),!0).invalidate()._lock=0))}if(!this._initted){if(H9(this,O?c:U,y,f,A))return this._tTime=0,this;if(s!==this._time&&!(y&&this.vars.repeatRefresh&&te!==de))return this;if(R!==this._dur)return this.render(c,f,y)}if(this._tTime=A,this._time=U,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=Fe=(Me||this._ease)(U/R),this._from&&(this.ratio=Fe=1-Fe),!s&&A&&!f&&!de&&(rc(this,"onStart"),this._tTime!==A))return this;for($=this._pt;$;)$.r(Fe,$.d),$=$._next;Le&&Le.render(c<0?c:Le._dur*Le._ease(U/this._dur),f,y)||this._startAt&&(this._zTime=c),this._onUpdate&&!f&&(O&&b4(this,c,f,y),rc(this,"onUpdate")),this._repeat&&te!==de&&this.vars.onRepeat&&!f&&this.parent&&rc(this,"onRepeat"),(A===this._tDur||!A)&&this._tTime===A&&(O&&!this._onUpdate&&b4(this,c,!0,!0),(c||!R)&&(A===this._tDur&&this._ts>0||!A&&this._ts<0)&&op(this,1),!f&&!(O&&!s)&&(A||s||Ce)&&(rc(this,A===E?"onComplete":"onReverseComplete",!0),this._prom&&!(A<E&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(c){return(!c||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(c),r.prototype.invalidate.call(this,c)},t.resetTo=function(c,f,y,s,E){xx||ec.wake(),this._ts||this.play();var R=Math.min(this._dur,(this._dp._time-this._start)*this._ts),O;return this._initted||nP(this,R),O=this._ease(R/this._dur),hle(this,c,f,y,s,O,R,E)?this.resetTo(c,f,y,s,1):(VE(this,0),this.parent||j9(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(c,f){if(f===void 0&&(f="all"),!c&&(!f||f==="all"))return this._lazy=this._pt=0,this.parent?n1(this):this.scrollTrigger&&this.scrollTrigger.kill(!!xa),this;if(this.timeline){var y=this.timeline.totalDuration();return this.timeline.killTweensOf(c,f,Bf&&Bf.vars.overwrite!==!0)._first||n1(this),this.parent&&y!==this.timeline.totalDuration()&&k0(this,this._dur*this.timeline._tDur/y,0,1),this}var s=this._targets,E=c?Oc(c):s,R=this._ptLookup,O=this._pt,A,U,$,te,Q,de,Ce;if((!f||f==="all")&&jae(s,E))return f==="all"&&(this._pt=0),n1(this);for(A=this._op=this._op||[],f!=="all"&&(na(f)&&(Q={},Pl(f,function(Fe){return Q[Fe]=1}),f=Q),f=dle(s,f)),Ce=s.length;Ce--;)if(~E.indexOf(s[Ce])){U=R[Ce],f==="all"?(A[Ce]=f,te=U,$={}):($=A[Ce]=A[Ce]||{},te=f);for(Q in te)de=U&&U[Q],de&&((!("kill"in de.d)||de.d.kill(Q)===!0)&&NE(this,de,"_pt"),delete U[Q]),$!=="all"&&($[Q]=1)}return this._initted&&!this._pt&&O&&n1(this),this},e.to=function(c,f){return new e(c,f,arguments[2])},e.from=function(c,f){return M1(1,arguments)},e.delayedCall=function(c,f,y,s){return new e(f,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:c,onComplete:f,onReverseComplete:f,onCompleteParams:y,onReverseCompleteParams:y,callbackScope:s})},e.fromTo=function(c,f,y){return M1(2,arguments)},e.set=function(c,f){return f.duration=0,f.repeatDelay||(f.repeat=0),new e(c,f)},e.killTweensOf=function(c,f,y){return no.killTweensOf(c,f,y)},e}(bx);ac(Co.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Pl("staggerTo,staggerFrom,staggerFromTo",function(r){Co[r]=function(){var e=new _l,t=T4.call(arguments,0);return t.splice(r==="staggerFromTo"?5:4,0,0),e[r].apply(e,t)}});var sP=function(e,t,o){return e[t]=o},hU=function(e,t,o){return e[t](o)},ple=function(e,t,o,c){return e[t](c.fp,o)},mle=function(e,t,o){return e.setAttribute(t,o)},oP=function(e,t){return uo(e[t])?hU:ZR(e[t])&&e.setAttribute?mle:sP},dU=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},_le=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},fU=function(e,t){var o=t._pt,c="";if(!e&&t.b)c=t.b;else if(e===1&&t.e)c=t.e;else{for(;o;)c=o.p+(o.m?o.m(o.s+o.c*e):Math.round((o.s+o.c*e)*1e4)/1e4)+c,o=o._next;c+=t.c}t.set(t.t,t.p,c,t)},aP=function(e,t){for(var o=t._pt;o;)o.r(e,o.d),o=o._next},gle=function(e,t,o,c){for(var f=this._pt,y;f;)y=f._next,f.p===c&&f.modifier(e,t,o),f=y},yle=function(e){for(var t=this._pt,o,c;t;)c=t._next,t.p===e&&!t.op||t.op===e?NE(this,t,"_pt"):t.dep||(o=1),t=c;return!o},vle=function(e,t,o,c){c.mSet(e,t,c.m.call(c.tween,o,c.mt),c)},pU=function(e){for(var t=e._pt,o,c,f,y;t;){for(o=t._next,c=f;c&&c.pr>t.pr;)c=c._next;(t._prev=c?c._prev:y)?t._prev._next=t:f=t,(t._next=c)?c._prev=t:y=t,t=o}e._pt=f},Ml=function(){function r(t,o,c,f,y,s,E,R,O){this.t=o,this.s=f,this.c=y,this.p=c,this.r=s||dU,this.d=E||this,this.set=R||sP,this.pr=O||0,this._next=t,t&&(t._prev=this)}var e=r.prototype;return e.modifier=function(o,c,f){this.mSet=this.mSet||this.set,this.set=vle,this.m=o,this.mt=f,this.tween=c},r}();Pl(eP+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(r){return QR[r]=1});oc.TweenMax=oc.TweenLite=Co;oc.TimelineLite=oc.TimelineMax=_l;no=new _l({sortChildren:!1,defaults:R0,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});sc.stringFilter=rU;var xm=[],P2={},xle=[],ZO=0,ble=0,BA=function(e){return(P2[e]||xle).map(function(t){return t()})},A4=function(){var e=Date.now(),t=[];e-ZO>2&&(BA("matchMediaInit"),xm.forEach(function(o){var c=o.queries,f=o.conditions,y,s,E,R;for(s in c)y=Qu.matchMedia(c[s]).matches,y&&(E=1),y!==f[s]&&(f[s]=y,R=1);R&&(o.revert(),E&&t.push(o))}),BA("matchMediaRevert"),t.forEach(function(o){return o.onMatch(o,function(c){return o.add(null,c)})}),ZO=e,BA("matchMedia"))},mU=function(){function r(t,o){this.selector=o&&E4(o),this.data=[],this._r=[],this.isReverted=!1,this.id=ble++,t&&this.add(t)}var e=r.prototype;return e.add=function(o,c,f){uo(o)&&(f=c,c=o,o=uo);var y=this,s=function(){var R=Ys,O=y.selector,A;return R&&R!==y&&R.data.push(y),f&&(y.selector=E4(f)),Ys=y,A=c.apply(y,arguments),uo(A)&&y._r.push(A),Ys=R,y.selector=O,y.isReverted=!1,A};return y.last=s,o===uo?s(y,function(E){return y.add(null,E)}):o?y[o]=s:s},e.ignore=function(o){var c=Ys;Ys=null,o(this),Ys=c},e.getTweens=function(){var o=[];return this.data.forEach(function(c){return c instanceof r?o.push.apply(o,c.getTweens()):c instanceof Co&&!(c.parent&&c.parent.data==="nested")&&o.push(c)}),o},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(o,c){var f=this;if(o?function(){for(var s=f.getTweens(),E=f.data.length,R;E--;)R=f.data[E],R.data==="isFlip"&&(R.revert(),R.getChildren(!0,!0,!1).forEach(function(O){return s.splice(s.indexOf(O),1)}));for(s.map(function(O){return{g:O._dur||O._delay||O._sat&&!O._sat.vars.immediateRender?O.globalTime(0):-1/0,t:O}}).sort(function(O,A){return A.g-O.g||-1/0}).forEach(function(O){return O.t.revert(o)}),E=f.data.length;E--;)R=f.data[E],R instanceof _l?R.data!=="nested"&&(R.scrollTrigger&&R.scrollTrigger.revert(),R.kill()):!(R instanceof Co)&&R.revert&&R.revert(o);f._r.forEach(function(O){return O(o,f)}),f.isReverted=!0}():this.data.forEach(function(s){return s.kill&&s.kill()}),this.clear(),c)for(var y=xm.length;y--;)xm[y].id===this.id&&xm.splice(y,1)},e.revert=function(o){this.kill(o||{})},r}(),wle=function(){function r(t){this.contexts=[],this.scope=t,Ys&&Ys.data.push(this)}var e=r.prototype;return e.add=function(o,c,f){bh(o)||(o={matches:o});var y=new mU(0,f||this.scope),s=y.conditions={},E,R,O;Ys&&!y.selector&&(y.selector=Ys.selector),this.contexts.push(y),c=y.add("onMatch",c),y.queries=o;for(R in o)R==="all"?O=1:(E=Qu.matchMedia(o[R]),E&&(xm.indexOf(y)<0&&xm.push(y),(s[R]=E.matches)&&(O=1),E.addListener?E.addListener(A4):E.addEventListener("change",A4)));return O&&c(y,function(A){return y.add(null,A)}),this},e.revert=function(o){this.kill(o||{})},e.kill=function(o){this.contexts.forEach(function(c){return c.kill(o,!0)})},r}(),LT={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];t.forEach(function(c){return eU(c)})},timeline:function(e){return new _l(e)},getTweensOf:function(e,t){return no.getTweensOf(e,t)},getProperty:function(e,t,o,c){na(e)&&(e=Oc(e)[0]);var f=gm(e||{}).get,y=o?U9:V9;return o==="native"&&(o=""),e&&(t?y((Jl[t]&&Jl[t].get||f)(e,t,o,c)):function(s,E,R){return y((Jl[s]&&Jl[s].get||f)(e,s,E,R))})},quickSetter:function(e,t,o){if(e=Oc(e),e.length>1){var c=e.map(function(O){return Ol.quickSetter(O,t,o)}),f=c.length;return function(O){for(var A=f;A--;)c[A](O)}}e=e[0]||{};var y=Jl[t],s=gm(e),E=s.harness&&(s.harness.aliases||{})[t]||t,R=y?function(O){var A=new y;$g._pt=0,A.init(e,o?O+o:O,$g,0,[e]),A.render(1,A),$g._pt&&aP(1,$g)}:s.set(e,E);return y?R:function(O){return R(e,E,o?O+o:O,s,1)}},quickTo:function(e,t,o){var c,f=Ol.to(e,ac((c={},c[t]="+=0.1",c.paused=!0,c.stagger=0,c),o||{})),y=function(E,R,O){return f.resetTo(t,E,R,O)};return y.tween=f,y},isTweening:function(e){return no.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=vm(e.ease,R0.ease)),GO(R0,e||{})},config:function(e){return GO(sc,e||{})},registerEffect:function(e){var t=e.name,o=e.effect,c=e.plugins,f=e.defaults,y=e.extendTimeline;(c||"").split(",").forEach(function(s){return s&&!Jl[s]&&!oc[s]&&gx(t+" effect requires "+s+" plugin.")}),OA[t]=function(s,E,R){return o(Oc(s),ac(E||{},f),R)},y&&(_l.prototype[t]=function(s,E,R){return this.add(OA[t](s,bh(E)?E:(R=E)&&{},this),R)})},registerEase:function(e,t){Hn[e]=vm(t)},parseEase:function(e,t){return arguments.length?vm(e,t):Hn},getById:function(e){return no.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var o=new _l(e),c,f;for(o.smoothChildTiming=Rl(e.smoothChildTiming),no.remove(o),o._dp=0,o._time=o._tTime=no._time,c=no._first;c;)f=c._next,(t||!(!c._dur&&c instanceof Co&&c.vars.onComplete===c._targets[0]))&&ih(o,c,c._start-c._delay),c=f;return ih(no,o,0),o},context:function(e,t){return e?new mU(e,t):Ys},matchMedia:function(e){return new wle(e)},matchMediaRefresh:function(){return xm.forEach(function(e){var t=e.conditions,o,c;for(c in t)t[c]&&(t[c]=!1,o=1);o&&e.revert()})||A4()},addEventListener:function(e,t){var o=P2[e]||(P2[e]=[]);~o.indexOf(t)||o.push(t)},removeEventListener:function(e,t){var o=P2[e],c=o&&o.indexOf(t);c>=0&&o.splice(c,1)},utils:{wrap:ele,wrapYoyo:tle,distribute:X9,random:K9,snap:Z9,normalize:Qae,getUnit:Ua,clamp:Zae,splitColor:tU,toArray:Oc,selector:E4,mapRange:J9,pipe:Yae,unitize:Jae,interpolate:ile,shuffle:W9},install:O9,effects:OA,ticker:ec,updateRoot:_l.updateRoot,plugins:Jl,globalTimeline:no,core:{PropTween:Ml,globals:F9,Tween:Co,Timeline:_l,Animation:bx,getCache:gm,_removeLinkedListItem:NE,reverting:function(){return xa},context:function(e){return e&&Ys&&(Ys.data.push(e),e._ctx=Ys),Ys},suppressOverwrites:function(e){return XR=e}}};Pl("to,from,fromTo,delayedCall,set,killTweensOf",function(r){return LT[r]=Co[r]});ec.add(_l.updateRoot);$g=LT.to({},{duration:0});var Tle=function(e,t){for(var o=e._pt;o&&o.p!==t&&o.op!==t&&o.fp!==t;)o=o._next;return o},Ele=function(e,t){var o=e._targets,c,f,y;for(c in t)for(f=o.length;f--;)y=e._ptLookup[f][c],y&&(y=y.d)&&(y._pt&&(y=Tle(y,c)),y&&y.modifier&&y.modifier(t[c],e,o[f],c))},VA=function(e,t){return{name:e,headless:1,rawVars:1,init:function(c,f,y){y._onInit=function(s){var E,R;if(na(f)&&(E={},Pl(f,function(O){return E[O]=1}),f=E),t){E={};for(R in f)E[R]=t(f[R]);f=E}Ele(s,f)}}}},Ol=LT.registerPlugin({name:"attr",init:function(e,t,o,c,f){var y,s,E;this.tween=o;for(y in t)E=e.getAttribute(y)||"",s=this.add(e,"setAttribute",(E||0)+"",t[y],c,f,0,0,y),s.op=y,s.b=E,this._props.push(y)},render:function(e,t){for(var o=t._pt;o;)xa?o.set(o.t,o.p,o.b,o):o.r(e,o.d),o=o._next}},{name:"endArray",headless:1,init:function(e,t){for(var o=t.length;o--;)this.add(e,o,e[o]||0,t[o],0,0,0,0,0,1)}},VA("roundProps",I4),VA("modifiers"),VA("snap",Z9))||LT;Co.version=_l.version=Ol.version="3.13.0";L9=1;KR()&&D0();Hn.Power0;Hn.Power1;Hn.Power2;Hn.Power3;Hn.Power4;Hn.Linear;Hn.Quad;Hn.Cubic;Hn.Quart;Hn.Quint;Hn.Strong;Hn.Elastic;Hn.Back;Hn.SteppedEase;Hn.Bounce;Hn.Sine;Hn.Expo;Hn.Circ;/*!
 * CSSPlugin 3.13.0
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var KO,Vf,n0,lP,um,YO,cP,Ile=function(){return typeof window<"u"},Md={},rm=180/Math.PI,s0=Math.PI/180,wg=Math.atan2,JO=1e8,uP=/([A-Z])/g,Sle=/(left|right|width|margin|padding|x)/i,Ale=/[\s,\(]\S/,oh={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},C4=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},Cle=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},Rle=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},Ple=function(e,t){var o=t.s+t.c*e;t.set(t.t,t.p,~~(o+(o<0?-.5:.5))+t.u,t)},_U=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},gU=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},Mle=function(e,t,o){return e.style[t]=o},kle=function(e,t,o){return e.style.setProperty(t,o)},Dle=function(e,t,o){return e._gsap[t]=o},Lle=function(e,t,o){return e._gsap.scaleX=e._gsap.scaleY=o},Ole=function(e,t,o,c,f){var y=e._gsap;y.scaleX=y.scaleY=o,y.renderTransform(f,y)},Fle=function(e,t,o,c,f){var y=e._gsap;y[t]=o,y.renderTransform(f,y)},oo="transform",kl=oo+"Origin",zle=function r(e,t){var o=this,c=this.target,f=c.style,y=c._gsap;if(e in Md&&f){if(this.tfm=this.tfm||{},e!=="transform")e=oh[e]||e,~e.indexOf(",")?e.split(",").forEach(function(s){return o.tfm[s]=ud(c,s)}):this.tfm[e]=y.x?y[e]:ud(c,e),e===kl&&(this.tfm.zOrigin=y.zOrigin);else return oh.transform.split(",").forEach(function(s){return r.call(o,s,t)});if(this.props.indexOf(oo)>=0)return;y.svg&&(this.svgo=c.getAttribute("data-svg-origin"),this.props.push(kl,t,"")),e=oo}(f||t)&&this.props.push(e,t,f[e])},yU=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},Nle=function(){var e=this.props,t=this.target,o=t.style,c=t._gsap,f,y;for(f=0;f<e.length;f+=3)e[f+1]?e[f+1]===2?t[e[f]](e[f+2]):t[e[f]]=e[f+2]:e[f+2]?o[e[f]]=e[f+2]:o.removeProperty(e[f].substr(0,2)==="--"?e[f]:e[f].replace(uP,"-$1").toLowerCase());if(this.tfm){for(y in this.tfm)c[y]=this.tfm[y];c.svg&&(c.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),f=cP(),(!f||!f.isStart)&&!o[oo]&&(yU(o),c.zOrigin&&o[kl]&&(o[kl]+=" "+c.zOrigin+"px",c.zOrigin=0,c.renderTransform()),c.uncache=1)}},vU=function(e,t){var o={target:e,props:[],revert:Nle,save:zle};return e._gsap||Ol.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(c){return o.save(c)}),o},xU,R4=function(e,t){var o=Vf.createElementNS?Vf.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Vf.createElement(e);return o&&o.style?o:Vf.createElement(e)},Fc=function r(e,t,o){var c=getComputedStyle(e);return c[t]||c.getPropertyValue(t.replace(uP,"-$1").toLowerCase())||c.getPropertyValue(t)||!o&&r(e,L0(t)||t,1)||""},QO="O,Moz,ms,Ms,Webkit".split(","),L0=function(e,t,o){var c=t||um,f=c.style,y=5;if(e in f&&!o)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);y--&&!(QO[y]+e in f););return y<0?null:(y===3?"ms":y>=0?QO[y]:"")+e},P4=function(){Ile()&&window.document&&(KO=window,Vf=KO.document,n0=Vf.documentElement,um=R4("div")||{style:{}},R4("div"),oo=L0(oo),kl=oo+"Origin",um.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",xU=!!L0("perspective"),cP=Ol.core.reverting,lP=1)},eF=function(e){var t=e.ownerSVGElement,o=R4("svg",t&&t.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),c=e.cloneNode(!0),f;c.style.display="block",o.appendChild(c),n0.appendChild(o);try{f=c.getBBox()}catch{}return o.removeChild(c),n0.removeChild(o),f},tF=function(e,t){for(var o=t.length;o--;)if(e.hasAttribute(t[o]))return e.getAttribute(t[o])},bU=function(e){var t,o;try{t=e.getBBox()}catch{t=eF(e),o=1}return t&&(t.width||t.height)||o||(t=eF(e)),t&&!t.width&&!t.x&&!t.y?{x:+tF(e,["x","cx","x1"])||0,y:+tF(e,["y","cy","y1"])||0,width:0,height:0}:t},wU=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&bU(e))},Nm=function(e,t){if(t){var o=e.style,c;t in Md&&t!==kl&&(t=oo),o.removeProperty?(c=t.substr(0,2),(c==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),o.removeProperty(c==="--"?t:t.replace(uP,"-$1").toLowerCase())):o.removeAttribute(t)}},Uf=function(e,t,o,c,f,y){var s=new Ml(e._pt,t,o,0,1,y?gU:_U);return e._pt=s,s.b=c,s.e=f,e._props.push(o),s},iF={deg:1,rad:1,turn:1},Ble={grid:1,flex:1},ap=function r(e,t,o,c){var f=parseFloat(o)||0,y=(o+"").trim().substr((f+"").length)||"px",s=um.style,E=Sle.test(t),R=e.tagName.toLowerCase()==="svg",O=(R?"client":"offset")+(E?"Width":"Height"),A=100,U=c==="px",$=c==="%",te,Q,de,Ce;if(c===y||!f||iF[c]||iF[y])return f;if(y!=="px"&&!U&&(f=r(e,t,o,"px")),Ce=e.getCTM&&wU(e),($||y==="%")&&(Md[t]||~t.indexOf("adius")))return te=Ce?e.getBBox()[E?"width":"height"]:e[O],yo($?f/te*A:f/100*te);if(s[E?"width":"height"]=A+(U?y:c),Q=c!=="rem"&&~t.indexOf("adius")||c==="em"&&e.appendChild&&!R?e:e.parentNode,Ce&&(Q=(e.ownerSVGElement||{}).parentNode),(!Q||Q===Vf||!Q.appendChild)&&(Q=Vf.body),de=Q._gsap,de&&$&&de.width&&E&&de.time===ec.time&&!de.uncache)return yo(f/de.width*A);if($&&(t==="height"||t==="width")){var Fe=e.style[t];e.style[t]=A+c,te=e[O],Fe?e.style[t]=Fe:Nm(e,t)}else($||y==="%")&&!Ble[Fc(Q,"display")]&&(s.position=Fc(e,"position")),Q===e&&(s.position="static"),Q.appendChild(um),te=um[O],Q.removeChild(um),s.position="absolute";return E&&$&&(de=gm(Q),de.time=ec.time,de.width=Q[O]),yo(U?te*f/A:te&&f?A/te*f:0)},ud=function(e,t,o,c){var f;return lP||P4(),t in oh&&t!=="transform"&&(t=oh[t],~t.indexOf(",")&&(t=t.split(",")[0])),Md[t]&&t!=="transform"?(f=Tx(e,c),f=t!=="transformOrigin"?f[t]:f.svg?f.origin:FT(Fc(e,kl))+" "+f.zOrigin+"px"):(f=e.style[t],(!f||f==="auto"||c||~(f+"").indexOf("calc("))&&(f=OT[t]&&OT[t](e,t,o)||Fc(e,t)||N9(e,t)||(t==="opacity"?1:0))),o&&!~(f+"").trim().indexOf(" ")?ap(e,t,f,o)+o:f},Vle=function(e,t,o,c){if(!o||o==="none"){var f=L0(t,e,1),y=f&&Fc(e,f,1);y&&y!==o?(t=f,o=y):t==="borderColor"&&(o=Fc(e,"borderTopColor"))}var s=new Ml(this._pt,e.style,t,0,1,fU),E=0,R=0,O,A,U,$,te,Q,de,Ce,Fe,Le,Me,at;if(s.b=o,s.e=c,o+="",c+="",c.substring(0,6)==="var(--"&&(c=Fc(e,c.substring(4,c.indexOf(")")))),c==="auto"&&(Q=e.style[t],e.style[t]=c,c=Fc(e,t)||c,Q?e.style[t]=Q:Nm(e,t)),O=[o,c],rU(O),o=O[0],c=O[1],U=o.match(jg)||[],at=c.match(jg)||[],at.length){for(;A=jg.exec(c);)de=A[0],Fe=c.substring(E,A.index),te?te=(te+1)%5:(Fe.substr(-5)==="rgba("||Fe.substr(-5)==="hsla(")&&(te=1),de!==(Q=U[R++]||"")&&($=parseFloat(Q)||0,Me=Q.substr(($+"").length),de.charAt(1)==="="&&(de=r0($,de)+Me),Ce=parseFloat(de),Le=de.substr((Ce+"").length),E=jg.lastIndex-Le.length,Le||(Le=Le||sc.units[t]||Me,E===c.length&&(c+=Le,s.e+=Le)),Me!==Le&&($=ap(e,t,Q,Le)||0),s._pt={_next:s._pt,p:Fe||R===1?Fe:",",s:$,c:Ce-$,m:te&&te<4||t==="zIndex"?Math.round:0});s.c=E<c.length?c.substring(E,c.length):""}else s.r=t==="display"&&c==="none"?gU:_U;return k9.test(c)&&(s.e=0),this._pt=s,s},rF={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Ule=function(e){var t=e.split(" "),o=t[0],c=t[1]||"50%";return(o==="top"||o==="bottom"||c==="left"||c==="right")&&(e=o,o=c,c=e),t[0]=rF[o]||o,t[1]=rF[c]||c,t.join(" ")},jle=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var o=t.t,c=o.style,f=t.u,y=o._gsap,s,E,R;if(f==="all"||f===!0)c.cssText="",E=1;else for(f=f.split(","),R=f.length;--R>-1;)s=f[R],Md[s]&&(E=1,s=s==="transformOrigin"?kl:oo),Nm(o,s);E&&(Nm(o,oo),y&&(y.svg&&o.removeAttribute("transform"),c.scale=c.rotate=c.translate="none",Tx(o,1),y.uncache=1,yU(c)))}},OT={clearProps:function(e,t,o,c,f){if(f.data!=="isFromStart"){var y=e._pt=new Ml(e._pt,t,o,0,0,jle);return y.u=c,y.pr=-10,y.tween=f,e._props.push(o),1}}},wx=[1,0,0,1,0,0],TU={},EU=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},nF=function(e){var t=Fc(e,oo);return EU(t)?wx:t.substr(7).match(M9).map(yo)},hP=function(e,t){var o=e._gsap||gm(e),c=e.style,f=nF(e),y,s,E,R;return o.svg&&e.getAttribute("transform")?(E=e.transform.baseVal.consolidate().matrix,f=[E.a,E.b,E.c,E.d,E.e,E.f],f.join(",")==="1,0,0,1,0,0"?wx:f):(f===wx&&!e.offsetParent&&e!==n0&&!o.svg&&(E=c.display,c.display="block",y=e.parentNode,(!y||!e.offsetParent&&!e.getBoundingClientRect().width)&&(R=1,s=e.nextElementSibling,n0.appendChild(e)),f=nF(e),E?c.display=E:Nm(e,"display"),R&&(s?y.insertBefore(e,s):y?y.appendChild(e):n0.removeChild(e))),t&&f.length>6?[f[0],f[1],f[4],f[5],f[12],f[13]]:f)},M4=function(e,t,o,c,f,y){var s=e._gsap,E=f||hP(e,!0),R=s.xOrigin||0,O=s.yOrigin||0,A=s.xOffset||0,U=s.yOffset||0,$=E[0],te=E[1],Q=E[2],de=E[3],Ce=E[4],Fe=E[5],Le=t.split(" "),Me=parseFloat(Le[0])||0,at=parseFloat(Le[1])||0,pt,me,ye,Se;o?E!==wx&&(me=$*de-te*Q)&&(ye=Me*(de/me)+at*(-Q/me)+(Q*Fe-de*Ce)/me,Se=Me*(-te/me)+at*($/me)-($*Fe-te*Ce)/me,Me=ye,at=Se):(pt=bU(e),Me=pt.x+(~Le[0].indexOf("%")?Me/100*pt.width:Me),at=pt.y+(~(Le[1]||Le[0]).indexOf("%")?at/100*pt.height:at)),c||c!==!1&&s.smooth?(Ce=Me-R,Fe=at-O,s.xOffset=A+(Ce*$+Fe*Q)-Ce,s.yOffset=U+(Ce*te+Fe*de)-Fe):s.xOffset=s.yOffset=0,s.xOrigin=Me,s.yOrigin=at,s.smooth=!!c,s.origin=t,s.originIsAbsolute=!!o,e.style[kl]="0px 0px",y&&(Uf(y,s,"xOrigin",R,Me),Uf(y,s,"yOrigin",O,at),Uf(y,s,"xOffset",A,s.xOffset),Uf(y,s,"yOffset",U,s.yOffset)),e.setAttribute("data-svg-origin",Me+" "+at)},Tx=function(e,t){var o=e._gsap||new aU(e);if("x"in o&&!t&&!o.uncache)return o;var c=e.style,f=o.scaleX<0,y="px",s="deg",E=getComputedStyle(e),R=Fc(e,kl)||"0",O,A,U,$,te,Q,de,Ce,Fe,Le,Me,at,pt,me,ye,Se,ke,Ve,He,Oe,xi,ui,ti,ri,Si,ir,st,wi,ji,Ar,Br,Vr;return O=A=U=Q=de=Ce=Fe=Le=Me=0,$=te=1,o.svg=!!(e.getCTM&&wU(e)),E.translate&&((E.translate!=="none"||E.scale!=="none"||E.rotate!=="none")&&(c[oo]=(E.translate!=="none"?"translate3d("+(E.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(E.rotate!=="none"?"rotate("+E.rotate+") ":"")+(E.scale!=="none"?"scale("+E.scale.split(" ").join(",")+") ":"")+(E[oo]!=="none"?E[oo]:"")),c.scale=c.rotate=c.translate="none"),me=hP(e,o.svg),o.svg&&(o.uncache?(Si=e.getBBox(),R=o.xOrigin-Si.x+"px "+(o.yOrigin-Si.y)+"px",ri=""):ri=!t&&e.getAttribute("data-svg-origin"),M4(e,ri||R,!!ri||o.originIsAbsolute,o.smooth!==!1,me)),at=o.xOrigin||0,pt=o.yOrigin||0,me!==wx&&(Ve=me[0],He=me[1],Oe=me[2],xi=me[3],O=ui=me[4],A=ti=me[5],me.length===6?($=Math.sqrt(Ve*Ve+He*He),te=Math.sqrt(xi*xi+Oe*Oe),Q=Ve||He?wg(He,Ve)*rm:0,Fe=Oe||xi?wg(Oe,xi)*rm+Q:0,Fe&&(te*=Math.abs(Math.cos(Fe*s0))),o.svg&&(O-=at-(at*Ve+pt*Oe),A-=pt-(at*He+pt*xi))):(Vr=me[6],Ar=me[7],st=me[8],wi=me[9],ji=me[10],Br=me[11],O=me[12],A=me[13],U=me[14],ye=wg(Vr,ji),de=ye*rm,ye&&(Se=Math.cos(-ye),ke=Math.sin(-ye),ri=ui*Se+st*ke,Si=ti*Se+wi*ke,ir=Vr*Se+ji*ke,st=ui*-ke+st*Se,wi=ti*-ke+wi*Se,ji=Vr*-ke+ji*Se,Br=Ar*-ke+Br*Se,ui=ri,ti=Si,Vr=ir),ye=wg(-Oe,ji),Ce=ye*rm,ye&&(Se=Math.cos(-ye),ke=Math.sin(-ye),ri=Ve*Se-st*ke,Si=He*Se-wi*ke,ir=Oe*Se-ji*ke,Br=xi*ke+Br*Se,Ve=ri,He=Si,Oe=ir),ye=wg(He,Ve),Q=ye*rm,ye&&(Se=Math.cos(ye),ke=Math.sin(ye),ri=Ve*Se+He*ke,Si=ui*Se+ti*ke,He=He*Se-Ve*ke,ti=ti*Se-ui*ke,Ve=ri,ui=Si),de&&Math.abs(de)+Math.abs(Q)>359.9&&(de=Q=0,Ce=180-Ce),$=yo(Math.sqrt(Ve*Ve+He*He+Oe*Oe)),te=yo(Math.sqrt(ti*ti+Vr*Vr)),ye=wg(ui,ti),Fe=Math.abs(ye)>2e-4?ye*rm:0,Me=Br?1/(Br<0?-Br:Br):0),o.svg&&(ri=e.getAttribute("transform"),o.forceCSS=e.setAttribute("transform","")||!EU(Fc(e,oo)),ri&&e.setAttribute("transform",ri))),Math.abs(Fe)>90&&Math.abs(Fe)<270&&(f?($*=-1,Fe+=Q<=0?180:-180,Q+=Q<=0?180:-180):(te*=-1,Fe+=Fe<=0?180:-180)),t=t||o.uncache,o.x=O-((o.xPercent=O&&(!t&&o.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-O)?-50:0)))?e.offsetWidth*o.xPercent/100:0)+y,o.y=A-((o.yPercent=A&&(!t&&o.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-A)?-50:0)))?e.offsetHeight*o.yPercent/100:0)+y,o.z=U+y,o.scaleX=yo($),o.scaleY=yo(te),o.rotation=yo(Q)+s,o.rotationX=yo(de)+s,o.rotationY=yo(Ce)+s,o.skewX=Fe+s,o.skewY=Le+s,o.transformPerspective=Me+y,(o.zOrigin=parseFloat(R.split(" ")[2])||!t&&o.zOrigin||0)&&(c[kl]=FT(R)),o.xOffset=o.yOffset=0,o.force3D=sc.force3D,o.renderTransform=o.svg?Gle:xU?IU:$le,o.uncache=0,o},FT=function(e){return(e=e.split(" "))[0]+" "+e[1]},UA=function(e,t,o){var c=Ua(t);return yo(parseFloat(t)+parseFloat(ap(e,"x",o+"px",c)))+c},$le=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,IU(e,t)},Jp="0deg",qv="0px",Qp=") ",IU=function(e,t){var o=t||this,c=o.xPercent,f=o.yPercent,y=o.x,s=o.y,E=o.z,R=o.rotation,O=o.rotationY,A=o.rotationX,U=o.skewX,$=o.skewY,te=o.scaleX,Q=o.scaleY,de=o.transformPerspective,Ce=o.force3D,Fe=o.target,Le=o.zOrigin,Me="",at=Ce==="auto"&&e&&e!==1||Ce===!0;if(Le&&(A!==Jp||O!==Jp)){var pt=parseFloat(O)*s0,me=Math.sin(pt),ye=Math.cos(pt),Se;pt=parseFloat(A)*s0,Se=Math.cos(pt),y=UA(Fe,y,me*Se*-Le),s=UA(Fe,s,-Math.sin(pt)*-Le),E=UA(Fe,E,ye*Se*-Le+Le)}de!==qv&&(Me+="perspective("+de+Qp),(c||f)&&(Me+="translate("+c+"%, "+f+"%) "),(at||y!==qv||s!==qv||E!==qv)&&(Me+=E!==qv||at?"translate3d("+y+", "+s+", "+E+") ":"translate("+y+", "+s+Qp),R!==Jp&&(Me+="rotate("+R+Qp),O!==Jp&&(Me+="rotateY("+O+Qp),A!==Jp&&(Me+="rotateX("+A+Qp),(U!==Jp||$!==Jp)&&(Me+="skew("+U+", "+$+Qp),(te!==1||Q!==1)&&(Me+="scale("+te+", "+Q+Qp),Fe.style[oo]=Me||"translate(0, 0)"},Gle=function(e,t){var o=t||this,c=o.xPercent,f=o.yPercent,y=o.x,s=o.y,E=o.rotation,R=o.skewX,O=o.skewY,A=o.scaleX,U=o.scaleY,$=o.target,te=o.xOrigin,Q=o.yOrigin,de=o.xOffset,Ce=o.yOffset,Fe=o.forceCSS,Le=parseFloat(y),Me=parseFloat(s),at,pt,me,ye,Se;E=parseFloat(E),R=parseFloat(R),O=parseFloat(O),O&&(O=parseFloat(O),R+=O,E+=O),E||R?(E*=s0,R*=s0,at=Math.cos(E)*A,pt=Math.sin(E)*A,me=Math.sin(E-R)*-U,ye=Math.cos(E-R)*U,R&&(O*=s0,Se=Math.tan(R-O),Se=Math.sqrt(1+Se*Se),me*=Se,ye*=Se,O&&(Se=Math.tan(O),Se=Math.sqrt(1+Se*Se),at*=Se,pt*=Se)),at=yo(at),pt=yo(pt),me=yo(me),ye=yo(ye)):(at=A,ye=U,pt=me=0),(Le&&!~(y+"").indexOf("px")||Me&&!~(s+"").indexOf("px"))&&(Le=ap($,"x",y,"px"),Me=ap($,"y",s,"px")),(te||Q||de||Ce)&&(Le=yo(Le+te-(te*at+Q*me)+de),Me=yo(Me+Q-(te*pt+Q*ye)+Ce)),(c||f)&&(Se=$.getBBox(),Le=yo(Le+c/100*Se.width),Me=yo(Me+f/100*Se.height)),Se="matrix("+at+","+pt+","+me+","+ye+","+Le+","+Me+")",$.setAttribute("transform",Se),Fe&&($.style[oo]=Se)},Hle=function(e,t,o,c,f){var y=360,s=na(f),E=parseFloat(f)*(s&&~f.indexOf("rad")?rm:1),R=E-c,O=c+R+"deg",A,U;return s&&(A=f.split("_")[1],A==="short"&&(R%=y,R!==R%(y/2)&&(R+=R<0?y:-y)),A==="cw"&&R<0?R=(R+y*JO)%y-~~(R/y)*y:A==="ccw"&&R>0&&(R=(R-y*JO)%y-~~(R/y)*y)),e._pt=U=new Ml(e._pt,t,o,c,R,Cle),U.e=O,U.u="deg",e._props.push(o),U},sF=function(e,t){for(var o in t)e[o]=t[o];return e},qle=function(e,t,o){var c=sF({},o._gsap),f="perspective,force3D,transformOrigin,svgOrigin",y=o.style,s,E,R,O,A,U,$,te;c.svg?(R=o.getAttribute("transform"),o.setAttribute("transform",""),y[oo]=t,s=Tx(o,1),Nm(o,oo),o.setAttribute("transform",R)):(R=getComputedStyle(o)[oo],y[oo]=t,s=Tx(o,1),y[oo]=R);for(E in Md)R=c[E],O=s[E],R!==O&&f.indexOf(E)<0&&($=Ua(R),te=Ua(O),A=$!==te?ap(o,E,R,te):parseFloat(R),U=parseFloat(O),e._pt=new Ml(e._pt,s,E,A,U-A,C4),e._pt.u=te||0,e._props.push(E));sF(s,c)};Pl("padding,margin,Width,Radius",function(r,e){var t="Top",o="Right",c="Bottom",f="Left",y=(e<3?[t,o,c,f]:[t+f,t+o,c+o,c+f]).map(function(s){return e<2?r+s:"border"+s+r});OT[e>1?"border"+r:r]=function(s,E,R,O,A){var U,$;if(arguments.length<4)return U=y.map(function(te){return ud(s,te,R)}),$=U.join(" "),$.split(U[0]).length===5?U[0]:$;U=(O+"").split(" "),$={},y.forEach(function(te,Q){return $[te]=U[Q]=U[Q]||U[(Q-1)/2|0]}),s.init(E,$,A)}});var SU={name:"css",register:P4,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,o,c,f){var y=this._props,s=e.style,E=o.vars.startAt,R,O,A,U,$,te,Q,de,Ce,Fe,Le,Me,at,pt,me,ye;lP||P4(),this.styles=this.styles||vU(e),ye=this.styles.props,this.tween=o;for(Q in t)if(Q!=="autoRound"&&(O=t[Q],!(Jl[Q]&&lU(Q,t,o,c,e,f)))){if($=typeof O,te=OT[Q],$==="function"&&(O=O.call(o,c,e,f),$=typeof O),$==="string"&&~O.indexOf("random(")&&(O=vx(O)),te)te(this,e,Q,O,o)&&(me=1);else if(Q.substr(0,2)==="--")R=(getComputedStyle(e).getPropertyValue(Q)+"").trim(),O+="",Jf.lastIndex=0,Jf.test(R)||(de=Ua(R),Ce=Ua(O)),Ce?de!==Ce&&(R=ap(e,Q,R,Ce)+Ce):de&&(O+=de),this.add(s,"setProperty",R,O,c,f,0,0,Q),y.push(Q),ye.push(Q,0,s[Q]);else if($!=="undefined"){if(E&&Q in E?(R=typeof E[Q]=="function"?E[Q].call(o,c,e,f):E[Q],na(R)&&~R.indexOf("random(")&&(R=vx(R)),Ua(R+"")||R==="auto"||(R+=sc.units[Q]||Ua(ud(e,Q))||""),(R+"").charAt(1)==="="&&(R=ud(e,Q))):R=ud(e,Q),U=parseFloat(R),Fe=$==="string"&&O.charAt(1)==="="&&O.substr(0,2),Fe&&(O=O.substr(2)),A=parseFloat(O),Q in oh&&(Q==="autoAlpha"&&(U===1&&ud(e,"visibility")==="hidden"&&A&&(U=0),ye.push("visibility",0,s.visibility),Uf(this,s,"visibility",U?"inherit":"hidden",A?"inherit":"hidden",!A)),Q!=="scale"&&Q!=="transform"&&(Q=oh[Q],~Q.indexOf(",")&&(Q=Q.split(",")[0]))),Le=Q in Md,Le){if(this.styles.save(Q),$==="string"&&O.substring(0,6)==="var(--"&&(O=Fc(e,O.substring(4,O.indexOf(")"))),A=parseFloat(O)),Me||(at=e._gsap,at.renderTransform&&!t.parseTransform||Tx(e,t.parseTransform),pt=t.smoothOrigin!==!1&&at.smooth,Me=this._pt=new Ml(this._pt,s,oo,0,1,at.renderTransform,at,0,-1),Me.dep=1),Q==="scale")this._pt=new Ml(this._pt,at,"scaleY",at.scaleY,(Fe?r0(at.scaleY,Fe+A):A)-at.scaleY||0,C4),this._pt.u=0,y.push("scaleY",Q),Q+="X";else if(Q==="transformOrigin"){ye.push(kl,0,s[kl]),O=Ule(O),at.svg?M4(e,O,0,pt,0,this):(Ce=parseFloat(O.split(" ")[2])||0,Ce!==at.zOrigin&&Uf(this,at,"zOrigin",at.zOrigin,Ce),Uf(this,s,Q,FT(R),FT(O)));continue}else if(Q==="svgOrigin"){M4(e,O,1,pt,0,this);continue}else if(Q in TU){Hle(this,at,Q,U,Fe?r0(U,Fe+O):O);continue}else if(Q==="smoothOrigin"){Uf(this,at,"smooth",at.smooth,O);continue}else if(Q==="force3D"){at[Q]=O;continue}else if(Q==="transform"){qle(this,O,e);continue}}else Q in s||(Q=L0(Q)||Q);if(Le||(A||A===0)&&(U||U===0)&&!Ale.test(O)&&Q in s)de=(R+"").substr((U+"").length),A||(A=0),Ce=Ua(O)||(Q in sc.units?sc.units[Q]:de),de!==Ce&&(U=ap(e,Q,R,Ce)),this._pt=new Ml(this._pt,Le?at:s,Q,U,(Fe?r0(U,Fe+A):A)-U,!Le&&(Ce==="px"||Q==="zIndex")&&t.autoRound!==!1?Ple:C4),this._pt.u=Ce||0,de!==Ce&&Ce!=="%"&&(this._pt.b=R,this._pt.r=Rle);else if(Q in s)Vle.call(this,e,Q,R,Fe?Fe+O:O);else if(Q in e)this.add(e,Q,R||e[Q],Fe?Fe+O:O,c,f);else if(Q!=="parseTransform"){JR(Q,O);continue}Le||(Q in s?ye.push(Q,0,s[Q]):typeof e[Q]=="function"?ye.push(Q,2,e[Q]()):ye.push(Q,1,R||e[Q])),y.push(Q)}}me&&pU(this)},render:function(e,t){if(t.tween._time||!cP())for(var o=t._pt;o;)o.r(e,o.d),o=o._next;else t.styles.revert()},get:ud,aliases:oh,getSetter:function(e,t,o){var c=oh[t];return c&&c.indexOf(",")<0&&(t=c),t in Md&&t!==kl&&(e._gsap.x||ud(e,"x"))?o&&YO===o?t==="scale"?Lle:Dle:(YO=o||{})&&(t==="scale"?Ole:Fle):e.style&&!ZR(e.style[t])?Mle:~t.indexOf("-")?kle:oP(e,t)},core:{_removeProperty:Nm,_getMatrix:hP}};Ol.utils.checkPrefix=L0;Ol.core.getStyleSaver=vU;(function(r,e,t,o){var c=Pl(r+","+e+","+t,function(f){Md[f]=1});Pl(e,function(f){sc.units[f]="deg",TU[f]=1}),oh[c[13]]=r+","+e,Pl(o,function(f){var y=f.split(":");oh[y[1]]=c[y[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Pl("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(r){sc.units[r]="px"});Ol.registerPlugin(SU);var k4=Ol.registerPlugin(SU)||Ol;k4.core.Tween;function Wle(r,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(r,o.key,o)}}function Xle(r,e,t){return e&&Wle(r.prototype,e),r}/*!
 * Observer 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var _a,M2,tc,jf,$f,o0,AU,nm,D1,CU,vd,ou,RU,PU=function(){return _a||typeof window<"u"&&(_a=window.gsap)&&_a.registerPlugin&&_a},MU=1,Gg=[],Mn=[],_h=[],L1=Date.now,D4=function(e,t){return t},Zle=function(){var e=D1.core,t=e.bridge||{},o=e._scrollers,c=e._proxies;o.push.apply(o,Mn),c.push.apply(c,_h),Mn=o,_h=c,D4=function(y,s){return t[y](s)}},Qf=function(e,t){return~_h.indexOf(e)&&_h[_h.indexOf(e)+1][t]},O1=function(e){return!!~CU.indexOf(e)},ll=function(e,t,o,c,f){return e.addEventListener(t,o,{passive:c!==!1,capture:!!f})},ol=function(e,t,o,c){return e.removeEventListener(t,o,!!c)},e2="scrollLeft",t2="scrollTop",L4=function(){return vd&&vd.isPressed||Mn.cache++},zT=function(e,t){var o=function c(f){if(f||f===0){MU&&(tc.history.scrollRestoration="manual");var y=vd&&vd.isPressed;f=c.v=Math.round(f)||(vd&&vd.iOS?1:0),e(f),c.cacheID=Mn.cache,y&&D4("ss",f)}else(t||Mn.cache!==c.cacheID||D4("ref"))&&(c.cacheID=Mn.cache,c.v=e());return c.v+c.offset};return o.offset=0,e&&o},gl={s:e2,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:zT(function(r){return arguments.length?tc.scrollTo(r,Bo.sc()):tc.pageXOffset||jf[e2]||$f[e2]||o0[e2]||0})},Bo={s:t2,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:gl,sc:zT(function(r){return arguments.length?tc.scrollTo(gl.sc(),r):tc.pageYOffset||jf[t2]||$f[t2]||o0[t2]||0})},Il=function(e,t){return(t&&t._ctx&&t._ctx.selector||_a.utils.toArray)(e)[0]||(typeof e=="string"&&_a.config().nullTargetWarn!==!1?console.warn("Element not found:",e):null)},Kle=function(e,t){for(var o=t.length;o--;)if(t[o]===e||t[o].contains(e))return!0;return!1},lp=function(e,t){var o=t.s,c=t.sc;O1(e)&&(e=jf.scrollingElement||$f);var f=Mn.indexOf(e),y=c===Bo.sc?1:2;!~f&&(f=Mn.push(e)-1),Mn[f+y]||ll(e,"scroll",L4);var s=Mn[f+y],E=s||(Mn[f+y]=zT(Qf(e,o),!0)||(O1(e)?c:zT(function(R){return arguments.length?e[o]=R:e[o]})));return E.target=e,s||(E.smooth=_a.getProperty(e,"scrollBehavior")==="smooth"),E},O4=function(e,t,o){var c=e,f=e,y=L1(),s=y,E=t||50,R=Math.max(500,E*3),O=function(te,Q){var de=L1();Q||de-y>E?(f=c,c=te,s=y,y=de):o?c+=te:c=f+(te-f)/(de-s)*(y-s)},A=function(){f=c=o?0:c,s=y=0},U=function(te){var Q=s,de=f,Ce=L1();return(te||te===0)&&te!==c&&O(te),y===s||Ce-s>R?0:(c+(o?de:-de))/((o?Ce:y)-Q)*1e3};return{update:O,reset:A,getVelocity:U}},Wv=function(e,t){return t&&!e._gsapAllow&&e.preventDefault(),e.changedTouches?e.changedTouches[0]:e},oF=function(e){var t=Math.max.apply(Math,e),o=Math.min.apply(Math,e);return Math.abs(t)>=Math.abs(o)?t:o},kU=function(){D1=_a.core.globals().ScrollTrigger,D1&&D1.core&&Zle()},DU=function(e){return _a=e||PU(),!M2&&_a&&typeof document<"u"&&document.body&&(tc=window,jf=document,$f=jf.documentElement,o0=jf.body,CU=[tc,jf,$f,o0],_a.utils.clamp,RU=_a.core.context||function(){},nm="onpointerenter"in o0?"pointer":"mouse",AU=vo.isTouch=tc.matchMedia&&tc.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in tc||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,ou=vo.eventTypes=("ontouchstart"in $f?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in $f?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout(function(){return MU=0},500),kU(),M2=1),M2};gl.op=Bo;Mn.cache=0;var vo=function(){function r(t){this.init(t)}var e=r.prototype;return e.init=function(o){M2||DU(_a)||console.warn("Please gsap.registerPlugin(Observer)"),D1||kU();var c=o.tolerance,f=o.dragMinimum,y=o.type,s=o.target,E=o.lineHeight,R=o.debounce,O=o.preventDefault,A=o.onStop,U=o.onStopDelay,$=o.ignore,te=o.wheelSpeed,Q=o.event,de=o.onDragStart,Ce=o.onDragEnd,Fe=o.onDrag,Le=o.onPress,Me=o.onRelease,at=o.onRight,pt=o.onLeft,me=o.onUp,ye=o.onDown,Se=o.onChangeX,ke=o.onChangeY,Ve=o.onChange,He=o.onToggleX,Oe=o.onToggleY,xi=o.onHover,ui=o.onHoverEnd,ti=o.onMove,ri=o.ignoreCheck,Si=o.isNormalizer,ir=o.onGestureStart,st=o.onGestureEnd,wi=o.onWheel,ji=o.onEnable,Ar=o.onDisable,Br=o.onClick,Vr=o.scrollSpeed,Ni=o.capture,vt=o.allowClicks,Wt=o.lockAxis,Xt=o.onLockAxis;this.target=s=Il(s)||$f,this.vars=o,$&&($=_a.utils.toArray($)),c=c||1e-9,f=f||0,te=te||1,Vr=Vr||1,y=y||"wheel,touch,pointer",R=R!==!1,E||(E=parseFloat(tc.getComputedStyle(o0).lineHeight)||22);var ai,nr,Be,Ge,Qe,ht,Et,Ue=this,ii=0,Ht=0,Jt=o.passive||!O&&o.passive!==!1,Lt=lp(s,gl),Ai=lp(s,Bo),ni=Lt(),bi=Ai(),Ci=~y.indexOf("touch")&&!~y.indexOf("pointer")&&ou[0]==="pointerdown",Ti=O1(s),Ei=s.ownerDocument||jf,hr=[0,0,0],wr=[0,0,0],on=0,Jr=function(){return on=L1()},_r=function(gr,Pe){return(Ue.event=gr)&&$&&Kle(gr.target,$)||Pe&&Ci&&gr.pointerType!=="touch"||ri&&ri(gr,Pe)},Es=function(){Ue._vx.reset(),Ue._vy.reset(),nr.pause(),A&&A(Ue)},es=function(){var gr=Ue.deltaX=oF(hr),Pe=Ue.deltaY=oF(wr),q=Math.abs(gr)>=c,J=Math.abs(Pe)>=c;Ve&&(q||J)&&Ve(Ue,gr,Pe,hr,wr),q&&(at&&Ue.deltaX>0&&at(Ue),pt&&Ue.deltaX<0&&pt(Ue),Se&&Se(Ue),He&&Ue.deltaX<0!=ii<0&&He(Ue),ii=Ue.deltaX,hr[0]=hr[1]=hr[2]=0),J&&(ye&&Ue.deltaY>0&&ye(Ue),me&&Ue.deltaY<0&&me(Ue),ke&&ke(Ue),Oe&&Ue.deltaY<0!=Ht<0&&Oe(Ue),Ht=Ue.deltaY,wr[0]=wr[1]=wr[2]=0),(Ge||Be)&&(ti&&ti(Ue),Be&&(de&&Be===1&&de(Ue),Fe&&Fe(Ue),Be=0),Ge=!1),ht&&!(ht=!1)&&Xt&&Xt(Ue),Qe&&(wi(Ue),Qe=!1),ai=0},xn=function(gr,Pe,q){hr[q]+=gr,wr[q]+=Pe,Ue._vx.update(gr),Ue._vy.update(Pe),R?ai||(ai=requestAnimationFrame(es)):es()},ss=function(gr,Pe){Wt&&!Et&&(Ue.axis=Et=Math.abs(gr)>Math.abs(Pe)?"x":"y",ht=!0),Et!=="y"&&(hr[2]+=gr,Ue._vx.update(gr,!0)),Et!=="x"&&(wr[2]+=Pe,Ue._vy.update(Pe,!0)),R?ai||(ai=requestAnimationFrame(es)):es()},Qs=function(gr){if(!_r(gr,1)){gr=Wv(gr,O);var Pe=gr.clientX,q=gr.clientY,J=Pe-Ue.x,oe=q-Ue.y,Te=Ue.isDragging;Ue.x=Pe,Ue.y=q,(Te||(J||oe)&&(Math.abs(Ue.startX-Pe)>=f||Math.abs(Ue.startY-q)>=f))&&(Be=Te?2:1,Te||(Ue.isDragging=!0),ss(J,oe))}},jr=Ue.onPress=function(Cr){_r(Cr,1)||Cr&&Cr.button||(Ue.axis=Et=null,nr.pause(),Ue.isPressed=!0,Cr=Wv(Cr),ii=Ht=0,Ue.startX=Ue.x=Cr.clientX,Ue.startY=Ue.y=Cr.clientY,Ue._vx.reset(),Ue._vy.reset(),ll(Si?s:Ei,ou[1],Qs,Jt,!0),Ue.deltaX=Ue.deltaY=0,Le&&Le(Ue))},dr=Ue.onRelease=function(Cr){if(!_r(Cr,1)){ol(Si?s:Ei,ou[1],Qs,!0);var gr=!isNaN(Ue.y-Ue.startY),Pe=Ue.isDragging,q=Pe&&(Math.abs(Ue.x-Ue.startX)>3||Math.abs(Ue.y-Ue.startY)>3),J=Wv(Cr);!q&&gr&&(Ue._vx.reset(),Ue._vy.reset(),O&&vt&&_a.delayedCall(.08,function(){if(L1()-on>300&&!Cr.defaultPrevented){if(Cr.target.click)Cr.target.click();else if(Ei.createEvent){var oe=Ei.createEvent("MouseEvents");oe.initMouseEvent("click",!0,!0,tc,1,J.screenX,J.screenY,J.clientX,J.clientY,!1,!1,!1,!1,0,null),Cr.target.dispatchEvent(oe)}}})),Ue.isDragging=Ue.isGesturing=Ue.isPressed=!1,A&&Pe&&!Si&&nr.restart(!0),Be&&es(),Ce&&Pe&&Ce(Ue),Me&&Me(Ue,q)}},$o=function(gr){return gr.touches&&gr.touches.length>1&&(Ue.isGesturing=!0)&&ir(gr,Ue.isDragging)},Is=function(){return(Ue.isGesturing=!1)||st(Ue)},gs=function(gr){if(!_r(gr)){var Pe=Lt(),q=Ai();xn((Pe-ni)*Vr,(q-bi)*Vr,1),ni=Pe,bi=q,A&&nr.restart(!0)}},eo=function(gr){if(!_r(gr)){gr=Wv(gr,O),wi&&(Qe=!0);var Pe=(gr.deltaMode===1?E:gr.deltaMode===2?tc.innerHeight:1)*te;xn(gr.deltaX*Pe,gr.deltaY*Pe,0),A&&!Si&&nr.restart(!0)}},to=function(gr){if(!_r(gr)){var Pe=gr.clientX,q=gr.clientY,J=Pe-Ue.x,oe=q-Ue.y;Ue.x=Pe,Ue.y=q,Ge=!0,A&&nr.restart(!0),(J||oe)&&ss(J,oe)}},Ta=function(gr){Ue.event=gr,xi(Ue)},xt=function(gr){Ue.event=gr,ui(Ue)},xo=function(gr){return _r(gr)||Wv(gr,O)&&Br(Ue)};nr=Ue._dc=_a.delayedCall(U||.25,Es).pause(),Ue.deltaX=Ue.deltaY=0,Ue._vx=O4(0,50,!0),Ue._vy=O4(0,50,!0),Ue.scrollX=Lt,Ue.scrollY=Ai,Ue.isDragging=Ue.isGesturing=Ue.isPressed=!1,RU(this),Ue.enable=function(Cr){return Ue.isEnabled||(ll(Ti?Ei:s,"scroll",L4),y.indexOf("scroll")>=0&&ll(Ti?Ei:s,"scroll",gs,Jt,Ni),y.indexOf("wheel")>=0&&ll(s,"wheel",eo,Jt,Ni),(y.indexOf("touch")>=0&&AU||y.indexOf("pointer")>=0)&&(ll(s,ou[0],jr,Jt,Ni),ll(Ei,ou[2],dr),ll(Ei,ou[3],dr),vt&&ll(s,"click",Jr,!0,!0),Br&&ll(s,"click",xo),ir&&ll(Ei,"gesturestart",$o),st&&ll(Ei,"gestureend",Is),xi&&ll(s,nm+"enter",Ta),ui&&ll(s,nm+"leave",xt),ti&&ll(s,nm+"move",to)),Ue.isEnabled=!0,Ue.isDragging=Ue.isGesturing=Ue.isPressed=Ge=Be=!1,Ue._vx.reset(),Ue._vy.reset(),ni=Lt(),bi=Ai(),Cr&&Cr.type&&jr(Cr),ji&&ji(Ue)),Ue},Ue.disable=function(){Ue.isEnabled&&(Gg.filter(function(Cr){return Cr!==Ue&&O1(Cr.target)}).length||ol(Ti?Ei:s,"scroll",L4),Ue.isPressed&&(Ue._vx.reset(),Ue._vy.reset(),ol(Si?s:Ei,ou[1],Qs,!0)),ol(Ti?Ei:s,"scroll",gs,Ni),ol(s,"wheel",eo,Ni),ol(s,ou[0],jr,Ni),ol(Ei,ou[2],dr),ol(Ei,ou[3],dr),ol(s,"click",Jr,!0),ol(s,"click",xo),ol(Ei,"gesturestart",$o),ol(Ei,"gestureend",Is),ol(s,nm+"enter",Ta),ol(s,nm+"leave",xt),ol(s,nm+"move",to),Ue.isEnabled=Ue.isPressed=Ue.isDragging=!1,Ar&&Ar(Ue))},Ue.kill=Ue.revert=function(){Ue.disable();var Cr=Gg.indexOf(Ue);Cr>=0&&Gg.splice(Cr,1),vd===Ue&&(vd=0)},Gg.push(Ue),Si&&O1(s)&&(vd=Ue),Ue.enable(Q)},Xle(r,[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}]),r}();vo.version="3.13.0";vo.create=function(r){return new vo(r)};vo.register=DU;vo.getAll=function(){return Gg.slice()};vo.getById=function(r){return Gg.filter(function(e){return e.vars.id===r})[0]};PU()&&_a.registerPlugin(vo);/*!
 * ScrollTrigger 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var ur,Lg,Pn,zs,Ql,hs,dP,NT,Ex,F1,o1,i2,Da,UE,F4,hl,aF,lF,Og,LU,jA,OU,ul,z4,FU,zU,Rf,N4,fP,a0,pP,BT,B4,$A,r2=1,Fa=Date.now,GA=Fa(),Nc=0,a1=0,cF=function(e,t,o){var c=Yl(e)&&(e.substr(0,6)==="clamp("||e.indexOf("max")>-1);return o["_"+t+"Clamp"]=c,c?e.substr(6,e.length-7):e},uF=function(e,t){return t&&(!Yl(e)||e.substr(0,6)!=="clamp(")?"clamp("+e+")":e},Yle=function r(){return a1&&requestAnimationFrame(r)},hF=function(){return UE=1},dF=function(){return UE=0},eh=function(e){return e},l1=function(e){return Math.round(e*1e5)/1e5||0},NU=function(){return typeof window<"u"},BU=function(){return ur||NU()&&(ur=window.gsap)&&ur.registerPlugin&&ur},Bm=function(e){return!!~dP.indexOf(e)},VU=function(e){return(e==="Height"?pP:Pn["inner"+e])||Ql["client"+e]||hs["client"+e]},UU=function(e){return Qf(e,"getBoundingClientRect")||(Bm(e)?function(){return F2.width=Pn.innerWidth,F2.height=pP,F2}:function(){return pd(e)})},Jle=function(e,t,o){var c=o.d,f=o.d2,y=o.a;return(y=Qf(e,"getBoundingClientRect"))?function(){return y()[c]}:function(){return(t?VU(f):e["client"+f])||0}},Qle=function(e,t){return!t||~_h.indexOf(e)?UU(e):function(){return F2}},ah=function(e,t){var o=t.s,c=t.d2,f=t.d,y=t.a;return Math.max(0,(o="scroll"+c)&&(y=Qf(e,o))?y()-UU(e)()[f]:Bm(e)?(Ql[o]||hs[o])-VU(c):e[o]-e["offset"+c])},n2=function(e,t){for(var o=0;o<Og.length;o+=3)(!t||~t.indexOf(Og[o+1]))&&e(Og[o],Og[o+1],Og[o+2])},Yl=function(e){return typeof e=="string"},ja=function(e){return typeof e=="function"},c1=function(e){return typeof e=="number"},sm=function(e){return typeof e=="object"},Xv=function(e,t,o){return e&&e.progress(t?0:1)&&o&&e.pause()},HA=function(e,t){if(e.enabled){var o=e._ctx?e._ctx.add(function(){return t(e)}):t(e);o&&o.totalTime&&(e.callbackAnimation=o)}},Tg=Math.abs,jU="left",$U="top",mP="right",_P="bottom",bm="width",wm="height",z1="Right",N1="Left",B1="Top",V1="Bottom",Ao="padding",Cc="margin",O0="Width",gP="Height",No="px",Rc=function(e){return Pn.getComputedStyle(e)},ece=function(e){var t=Rc(e).position;e.style.position=t==="absolute"||t==="fixed"?t:"relative"},fF=function(e,t){for(var o in t)o in e||(e[o]=t[o]);return e},pd=function(e,t){var o=t&&Rc(e)[F4]!=="matrix(1, 0, 0, 1, 0, 0)"&&ur.to(e,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),c=e.getBoundingClientRect();return o&&o.progress(0).kill(),c},VT=function(e,t){var o=t.d2;return e["offset"+o]||e["client"+o]||0},GU=function(e){var t=[],o=e.labels,c=e.duration(),f;for(f in o)t.push(o[f]/c);return t},tce=function(e){return function(t){return ur.utils.snap(GU(e),t)}},yP=function(e){var t=ur.utils.snap(e),o=Array.isArray(e)&&e.slice(0).sort(function(c,f){return c-f});return o?function(c,f,y){y===void 0&&(y=.001);var s;if(!f)return t(c);if(f>0){for(c-=y,s=0;s<o.length;s++)if(o[s]>=c)return o[s];return o[s-1]}else for(s=o.length,c+=y;s--;)if(o[s]<=c)return o[s];return o[0]}:function(c,f,y){y===void 0&&(y=.001);var s=t(c);return!f||Math.abs(s-c)<y||s-c<0==f<0?s:t(f<0?c-e:c+e)}},ice=function(e){return function(t,o){return yP(GU(e))(t,o.direction)}},s2=function(e,t,o,c){return o.split(",").forEach(function(f){return e(t,f,c)})},Qo=function(e,t,o,c,f){return e.addEventListener(t,o,{passive:!c,capture:!!f})},Jo=function(e,t,o,c){return e.removeEventListener(t,o,!!c)},o2=function(e,t,o){o=o&&o.wheelHandler,o&&(e(t,"wheel",o),e(t,"touchmove",o))},pF={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},a2={toggleActions:"play",anticipatePin:0},UT={top:0,left:0,center:.5,bottom:1,right:1},k2=function(e,t){if(Yl(e)){var o=e.indexOf("="),c=~o?+(e.charAt(o-1)+1)*parseFloat(e.substr(o+1)):0;~o&&(e.indexOf("%")>o&&(c*=t/100),e=e.substr(0,o-1)),e=c+(e in UT?UT[e]*t:~e.indexOf("%")?parseFloat(e)*t/100:parseFloat(e)||0)}return e},l2=function(e,t,o,c,f,y,s,E){var R=f.startColor,O=f.endColor,A=f.fontSize,U=f.indent,$=f.fontWeight,te=zs.createElement("div"),Q=Bm(o)||Qf(o,"pinType")==="fixed",de=e.indexOf("scroller")!==-1,Ce=Q?hs:o,Fe=e.indexOf("start")!==-1,Le=Fe?R:O,Me="border-color:"+Le+";font-size:"+A+";color:"+Le+";font-weight:"+$+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return Me+="position:"+((de||E)&&Q?"fixed;":"absolute;"),(de||E||!Q)&&(Me+=(c===Bo?mP:_P)+":"+(y+parseFloat(U))+"px;"),s&&(Me+="box-sizing:border-box;text-align:left;width:"+s.offsetWidth+"px;"),te._isStart=Fe,te.setAttribute("class","gsap-marker-"+e+(t?" marker-"+t:"")),te.style.cssText=Me,te.innerText=t||t===0?e+"-"+t:e,Ce.children[0]?Ce.insertBefore(te,Ce.children[0]):Ce.appendChild(te),te._offset=te["offset"+c.op.d2],D2(te,0,c,Fe),te},D2=function(e,t,o,c){var f={display:"block"},y=o[c?"os2":"p2"],s=o[c?"p2":"os2"];e._isFlipped=c,f[o.a+"Percent"]=c?-100:0,f[o.a]=c?"1px":0,f["border"+y+O0]=1,f["border"+s+O0]=0,f[o.p]=t+"px",ur.set(e,f)},En=[],V4={},Ix,mF=function(){return Fa()-Nc>34&&(Ix||(Ix=requestAnimationFrame(wd)))},Eg=function(){(!ul||!ul.isPressed||ul.startX>hs.clientWidth)&&(Mn.cache++,ul?Ix||(Ix=requestAnimationFrame(wd)):wd(),Nc||Um("scrollStart"),Nc=Fa())},qA=function(){zU=Pn.innerWidth,FU=Pn.innerHeight},u1=function(e){Mn.cache++,(e===!0||!Da&&!OU&&!zs.fullscreenElement&&!zs.webkitFullscreenElement&&(!z4||zU!==Pn.innerWidth||Math.abs(Pn.innerHeight-FU)>Pn.innerHeight*.25))&&NT.restart(!0)},Vm={},rce=[],HU=function r(){return Jo(Fn,"scrollEnd",r)||hm(!0)},Um=function(e){return Vm[e]&&Vm[e].map(function(t){return t()})||rce},Zl=[],qU=function(e){for(var t=0;t<Zl.length;t+=5)(!e||Zl[t+4]&&Zl[t+4].query===e)&&(Zl[t].style.cssText=Zl[t+1],Zl[t].getBBox&&Zl[t].setAttribute("transform",Zl[t+2]||""),Zl[t+3].uncache=1)},vP=function(e,t){var o;for(hl=0;hl<En.length;hl++)o=En[hl],o&&(!t||o._ctx===t)&&(e?o.kill(1):o.revert(!0,!0));BT=!0,t&&qU(t),t||Um("revert")},WU=function(e,t){Mn.cache++,(t||!dl)&&Mn.forEach(function(o){return ja(o)&&o.cacheID++&&(o.rec=0)}),Yl(e)&&(Pn.history.scrollRestoration=fP=e)},dl,Tm=0,_F,nce=function(){if(_F!==Tm){var e=_F=Tm;requestAnimationFrame(function(){return e===Tm&&hm(!0)})}},XU=function(){hs.appendChild(a0),pP=!ul&&a0.offsetHeight||Pn.innerHeight,hs.removeChild(a0)},gF=function(e){return Ex(".gsap-marker-start, .gsap-marker-end, .gsap-marker-scroller-start, .gsap-marker-scroller-end").forEach(function(t){return t.style.display=e?"none":"block"})},hm=function(e,t){if(Ql=zs.documentElement,hs=zs.body,dP=[Pn,zs,Ql,hs],Nc&&!e&&!BT){Qo(Fn,"scrollEnd",HU);return}XU(),dl=Fn.isRefreshing=!0,Mn.forEach(function(c){return ja(c)&&++c.cacheID&&(c.rec=c())});var o=Um("refreshInit");LU&&Fn.sort(),t||vP(),Mn.forEach(function(c){ja(c)&&(c.smooth&&(c.target.style.scrollBehavior="auto"),c(0))}),En.slice(0).forEach(function(c){return c.refresh()}),BT=!1,En.forEach(function(c){if(c._subPinOffset&&c.pin){var f=c.vars.horizontal?"offsetWidth":"offsetHeight",y=c.pin[f];c.revert(!0,1),c.adjustPinSpacing(c.pin[f]-y),c.refresh()}}),B4=1,gF(!0),En.forEach(function(c){var f=ah(c.scroller,c._dir),y=c.vars.end==="max"||c._endClamp&&c.end>f,s=c._startClamp&&c.start>=f;(y||s)&&c.setPositions(s?f-1:c.start,y?Math.max(s?f:c.start+1,f):c.end,!0)}),gF(!1),B4=0,o.forEach(function(c){return c&&c.render&&c.render(-1)}),Mn.forEach(function(c){ja(c)&&(c.smooth&&requestAnimationFrame(function(){return c.target.style.scrollBehavior="smooth"}),c.rec&&c(c.rec))}),WU(fP,1),NT.pause(),Tm++,dl=2,wd(2),En.forEach(function(c){return ja(c.vars.onRefresh)&&c.vars.onRefresh(c)}),dl=Fn.isRefreshing=!1,Um("refresh")},U4=0,L2=1,U1,wd=function(e){if(e===2||!dl&&!BT){Fn.isUpdating=!0,U1&&U1.update(0);var t=En.length,o=Fa(),c=o-GA>=50,f=t&&En[0].scroll();if(L2=U4>f?-1:1,dl||(U4=f),c&&(Nc&&!UE&&o-Nc>200&&(Nc=0,Um("scrollEnd")),o1=GA,GA=o),L2<0){for(hl=t;hl-- >0;)En[hl]&&En[hl].update(0,c);L2=1}else for(hl=0;hl<t;hl++)En[hl]&&En[hl].update(0,c);Fn.isUpdating=!1}Ix=0},j4=[jU,$U,_P,mP,Cc+V1,Cc+z1,Cc+B1,Cc+N1,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],O2=j4.concat([bm,wm,"boxSizing","max"+O0,"max"+gP,"position",Cc,Ao,Ao+B1,Ao+z1,Ao+V1,Ao+N1]),sce=function(e,t,o){l0(o);var c=e._gsap;if(c.spacerIsNative)l0(c.spacerState);else if(e._gsap.swappedIn){var f=t.parentNode;f&&(f.insertBefore(e,t),f.removeChild(t))}e._gsap.swappedIn=!1},WA=function(e,t,o,c){if(!e._gsap.swappedIn){for(var f=j4.length,y=t.style,s=e.style,E;f--;)E=j4[f],y[E]=o[E];y.position=o.position==="absolute"?"absolute":"relative",o.display==="inline"&&(y.display="inline-block"),s[_P]=s[mP]="auto",y.flexBasis=o.flexBasis||"auto",y.overflow="visible",y.boxSizing="border-box",y[bm]=VT(e,gl)+No,y[wm]=VT(e,Bo)+No,y[Ao]=s[Cc]=s[$U]=s[jU]="0",l0(c),s[bm]=s["max"+O0]=o[bm],s[wm]=s["max"+gP]=o[wm],s[Ao]=o[Ao],e.parentNode!==t&&(e.parentNode.insertBefore(t,e),t.appendChild(e)),e._gsap.swappedIn=!0}},oce=/([A-Z])/g,l0=function(e){if(e){var t=e.t.style,o=e.length,c=0,f,y;for((e.t._gsap||ur.core.getCache(e.t)).uncache=1;c<o;c+=2)y=e[c+1],f=e[c],y?t[f]=y:t[f]&&t.removeProperty(f.replace(oce,"-$1").toLowerCase())}},c2=function(e){for(var t=O2.length,o=e.style,c=[],f=0;f<t;f++)c.push(O2[f],o[O2[f]]);return c.t=e,c},ace=function(e,t,o){for(var c=[],f=e.length,y=o?8:0,s;y<f;y+=2)s=e[y],c.push(s,s in t?t[s]:e[y+1]);return c.t=e.t,c},F2={left:0,top:0},yF=function(e,t,o,c,f,y,s,E,R,O,A,U,$,te){ja(e)&&(e=e(E)),Yl(e)&&e.substr(0,3)==="max"&&(e=U+(e.charAt(4)==="="?k2("0"+e.substr(3),o):0));var Q=$?$.time():0,de,Ce,Fe;if($&&$.seek(0),isNaN(e)||(e=+e),c1(e))$&&(e=ur.utils.mapRange($.scrollTrigger.start,$.scrollTrigger.end,0,U,e)),s&&D2(s,o,c,!0);else{ja(t)&&(t=t(E));var Le=(e||"0").split(" "),Me,at,pt,me;Fe=Il(t,E)||hs,Me=pd(Fe)||{},(!Me||!Me.left&&!Me.top)&&Rc(Fe).display==="none"&&(me=Fe.style.display,Fe.style.display="block",Me=pd(Fe),me?Fe.style.display=me:Fe.style.removeProperty("display")),at=k2(Le[0],Me[c.d]),pt=k2(Le[1]||"0",o),e=Me[c.p]-R[c.p]-O+at+f-pt,s&&D2(s,pt,c,o-pt<20||s._isStart&&pt>20),o-=o-pt}if(te&&(E[te]=e||-.001,e<0&&(e=0)),y){var ye=e+o,Se=y._isStart;de="scroll"+c.d2,D2(y,ye,c,Se&&ye>20||!Se&&(A?Math.max(hs[de],Ql[de]):y.parentNode[de])<=ye+1),A&&(R=pd(s),A&&(y.style[c.op.p]=R[c.op.p]-c.op.m-y._offset+No))}return $&&Fe&&(de=pd(Fe),$.seek(U),Ce=pd(Fe),$._caScrollDist=de[c.p]-Ce[c.p],e=e/$._caScrollDist*U),$&&$.seek(Q),$?e:Math.round(e)},lce=/(webkit|moz|length|cssText|inset)/i,vF=function(e,t,o,c){if(e.parentNode!==t){var f=e.style,y,s;if(t===hs){e._stOrig=f.cssText,s=Rc(e);for(y in s)!+y&&!lce.test(y)&&s[y]&&typeof f[y]=="string"&&y!=="0"&&(f[y]=s[y]);f.top=o,f.left=c}else f.cssText=e._stOrig;ur.core.getCache(e).uncache=1,t.appendChild(e)}},ZU=function(e,t,o){var c=t,f=c;return function(y){var s=Math.round(e());return s!==c&&s!==f&&Math.abs(s-c)>3&&Math.abs(s-f)>3&&(y=s,o&&o()),f=c,c=Math.round(y),c}},u2=function(e,t,o){var c={};c[t.p]="+="+o,ur.set(e,c)},xF=function(e,t){var o=lp(e,t),c="_scroll"+t.p2,f=function y(s,E,R,O,A){var U=y.tween,$=E.onComplete,te={};R=R||o();var Q=ZU(o,R,function(){U.kill(),y.tween=0});return A=O&&A||0,O=O||s-R,U&&U.kill(),E[c]=s,E.inherit=!1,E.modifiers=te,te[c]=function(){return Q(R+O*U.ratio+A*U.ratio*U.ratio)},E.onUpdate=function(){Mn.cache++,y.tween&&wd()},E.onComplete=function(){y.tween=0,$&&$.call(U)},U=y.tween=ur.to(e,E),U};return e[c]=o,o.wheelHandler=function(){return f.tween&&f.tween.kill()&&(f.tween=0)},Qo(e,"wheel",o.wheelHandler),Fn.isTouch&&Qo(e,"touchmove",o.wheelHandler),f},Fn=function(){function r(t,o){Lg||r.register(ur)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),N4(this),this.init(t,o)}var e=r.prototype;return e.init=function(o,c){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),!a1){this.update=this.refresh=this.kill=eh;return}o=fF(Yl(o)||c1(o)||o.nodeType?{trigger:o}:o,a2);var f=o,y=f.onUpdate,s=f.toggleClass,E=f.id,R=f.onToggle,O=f.onRefresh,A=f.scrub,U=f.trigger,$=f.pin,te=f.pinSpacing,Q=f.invalidateOnRefresh,de=f.anticipatePin,Ce=f.onScrubComplete,Fe=f.onSnapComplete,Le=f.once,Me=f.snap,at=f.pinReparent,pt=f.pinSpacer,me=f.containerAnimation,ye=f.fastScrollEnd,Se=f.preventOverlaps,ke=o.horizontal||o.containerAnimation&&o.horizontal!==!1?gl:Bo,Ve=!A&&A!==0,He=Il(o.scroller||Pn),Oe=ur.core.getCache(He),xi=Bm(He),ui=("pinType"in o?o.pinType:Qf(He,"pinType")||xi&&"fixed")==="fixed",ti=[o.onEnter,o.onLeave,o.onEnterBack,o.onLeaveBack],ri=Ve&&o.toggleActions.split(" "),Si="markers"in o?o.markers:a2.markers,ir=xi?0:parseFloat(Rc(He)["border"+ke.p2+O0])||0,st=this,wi=o.onRefreshInit&&function(){return o.onRefreshInit(st)},ji=Jle(He,xi,ke),Ar=Qle(He,xi),Br=0,Vr=0,Ni=0,vt=lp(He,ke),Wt,Xt,ai,nr,Be,Ge,Qe,ht,Et,Ue,ii,Ht,Jt,Lt,Ai,ni,bi,Ci,Ti,Ei,hr,wr,on,Jr,_r,Es,es,xn,ss,Qs,jr,dr,$o,Is,gs,eo,to,Ta,xt;if(st._startClamp=st._endClamp=!1,st._dir=ke,de*=45,st.scroller=He,st.scroll=me?me.time.bind(me):vt,nr=vt(),st.vars=o,c=c||o.animation,"refreshPriority"in o&&(LU=1,o.refreshPriority===-9999&&(U1=st)),Oe.tweenScroll=Oe.tweenScroll||{top:xF(He,Bo),left:xF(He,gl)},st.tweenTo=Wt=Oe.tweenScroll[ke.p],st.scrubDuration=function(q){$o=c1(q)&&q,$o?dr?dr.duration(q):dr=ur.to(c,{ease:"expo",totalProgress:"+=0",inherit:!1,duration:$o,paused:!0,onComplete:function(){return Ce&&Ce(st)}}):(dr&&dr.progress(1).kill(),dr=0)},c&&(c.vars.lazy=!1,c._initted&&!st.isReverted||c.vars.immediateRender!==!1&&o.immediateRender!==!1&&c.duration()&&c.render(0,!0,!0),st.animation=c.pause(),c.scrollTrigger=st,st.scrubDuration(A),Qs=0,E||(E=c.vars.id)),Me&&((!sm(Me)||Me.push)&&(Me={snapTo:Me}),"scrollBehavior"in hs.style&&ur.set(xi?[hs,Ql]:He,{scrollBehavior:"auto"}),Mn.forEach(function(q){return ja(q)&&q.target===(xi?zs.scrollingElement||Ql:He)&&(q.smooth=!1)}),ai=ja(Me.snapTo)?Me.snapTo:Me.snapTo==="labels"?tce(c):Me.snapTo==="labelsDirectional"?ice(c):Me.directional!==!1?function(q,J){return yP(Me.snapTo)(q,Fa()-Vr<500?0:J.direction)}:ur.utils.snap(Me.snapTo),Is=Me.duration||{min:.1,max:2},Is=sm(Is)?F1(Is.min,Is.max):F1(Is,Is),gs=ur.delayedCall(Me.delay||$o/2||.1,function(){var q=vt(),J=Fa()-Vr<500,oe=Wt.tween;if((J||Math.abs(st.getVelocity())<10)&&!oe&&!UE&&Br!==q){var Te=(q-Ge)/Lt,be=c&&!Ve?c.totalProgress():Te,fe=J?0:(be-jr)/(Fa()-o1)*1e3||0,Ke=ur.utils.clamp(-Te,1-Te,Tg(fe/2)*fe/.185),ze=Te+(Me.inertia===!1?0:Ke),Ze,yt,lt=Me,Kt=lt.onStart,Qt=lt.onInterrupt,Ii=lt.onComplete;if(Ze=ai(ze,st),c1(Ze)||(Ze=ze),yt=Math.max(0,Math.round(Ge+Ze*Lt)),q<=Qe&&q>=Ge&&yt!==q){if(oe&&!oe._initted&&oe.data<=Tg(yt-q))return;Me.inertia===!1&&(Ke=Ze-Te),Wt(yt,{duration:Is(Tg(Math.max(Tg(ze-be),Tg(Ze-be))*.185/fe/.05||0)),ease:Me.ease||"power3",data:Tg(yt-q),onInterrupt:function(){return gs.restart(!0)&&Qt&&Qt(st)},onComplete:function(){st.update(),Br=vt(),c&&!Ve&&(dr?dr.resetTo("totalProgress",Ze,c._tTime/c._tDur):c.progress(Ze)),Qs=jr=c&&!Ve?c.totalProgress():st.progress,Fe&&Fe(st),Ii&&Ii(st)}},q,Ke*Lt,yt-q-Ke*Lt),Kt&&Kt(st,Wt.tween)}}else st.isActive&&Br!==q&&gs.restart(!0)}).pause()),E&&(V4[E]=st),U=st.trigger=Il(U||$!==!0&&$),xt=U&&U._gsap&&U._gsap.stRevert,xt&&(xt=xt(st)),$=$===!0?U:Il($),Yl(s)&&(s={targets:U,className:s}),$&&(te===!1||te===Cc||(te=!te&&$.parentNode&&$.parentNode.style&&Rc($.parentNode).display==="flex"?!1:Ao),st.pin=$,Xt=ur.core.getCache($),Xt.spacer?Ai=Xt.pinState:(pt&&(pt=Il(pt),pt&&!pt.nodeType&&(pt=pt.current||pt.nativeElement),Xt.spacerIsNative=!!pt,pt&&(Xt.spacerState=c2(pt))),Xt.spacer=Ci=pt||zs.createElement("div"),Ci.classList.add("pin-spacer"),E&&Ci.classList.add("pin-spacer-"+E),Xt.pinState=Ai=c2($)),o.force3D!==!1&&ur.set($,{force3D:!0}),st.spacer=Ci=Xt.spacer,ss=Rc($),Jr=ss[te+ke.os2],Ei=ur.getProperty($),hr=ur.quickSetter($,ke.a,No),WA($,Ci,ss),bi=c2($)),Si){Ht=sm(Si)?fF(Si,pF):pF,Ue=l2("scroller-start",E,He,ke,Ht,0),ii=l2("scroller-end",E,He,ke,Ht,0,Ue),Ti=Ue["offset"+ke.op.d2];var xo=Il(Qf(He,"content")||He);ht=this.markerStart=l2("start",E,xo,ke,Ht,Ti,0,me),Et=this.markerEnd=l2("end",E,xo,ke,Ht,Ti,0,me),me&&(Ta=ur.quickSetter([ht,Et],ke.a,No)),!ui&&!(_h.length&&Qf(He,"fixedMarkers")===!0)&&(ece(xi?hs:He),ur.set([Ue,ii],{force3D:!0}),Es=ur.quickSetter(Ue,ke.a,No),xn=ur.quickSetter(ii,ke.a,No))}if(me){var Cr=me.vars.onUpdate,gr=me.vars.onUpdateParams;me.eventCallback("onUpdate",function(){st.update(0,0,1),Cr&&Cr.apply(me,gr||[])})}if(st.previous=function(){return En[En.indexOf(st)-1]},st.next=function(){return En[En.indexOf(st)+1]},st.revert=function(q,J){if(!J)return st.kill(!0);var oe=q!==!1||!st.enabled,Te=Da;oe!==st.isReverted&&(oe&&(eo=Math.max(vt(),st.scroll.rec||0),Ni=st.progress,to=c&&c.progress()),ht&&[ht,Et,Ue,ii].forEach(function(be){return be.style.display=oe?"none":"block"}),oe&&(Da=st,st.update(oe)),$&&(!at||!st.isActive)&&(oe?sce($,Ci,Ai):WA($,Ci,Rc($),_r)),oe||st.update(oe),Da=Te,st.isReverted=oe)},st.refresh=function(q,J,oe,Te){if(!((Da||!st.enabled)&&!J)){if($&&q&&Nc){Qo(r,"scrollEnd",HU);return}!dl&&wi&&wi(st),Da=st,Wt.tween&&!oe&&(Wt.tween.kill(),Wt.tween=0),dr&&dr.pause(),Q&&c&&(c.revert({kill:!1}).invalidate(),c.getChildren&&c.getChildren(!0,!0,!1).forEach(function(Ss){return Ss.vars.immediateRender&&Ss.render(0,!0,!0)})),st.isReverted||st.revert(!0,!0),st._subPinOffset=!1;var be=ji(),fe=Ar(),Ke=me?me.duration():ah(He,ke),ze=Lt<=.01||!Lt,Ze=0,yt=Te||0,lt=sm(oe)?oe.end:o.end,Kt=o.endTrigger||U,Qt=sm(oe)?oe.start:o.start||(o.start===0||!U?0:$?"0 0":"0 100%"),Ii=st.pinnedContainer=o.pinnedContainer&&Il(o.pinnedContainer,st),Xi=U&&Math.max(0,En.indexOf(st))||0,Oi=Xi,$i,yr,Ji,In,qr,$r,Tr,br,un,fn,Fr,cs,Ms;for(Si&&sm(oe)&&(cs=ur.getProperty(Ue,ke.p),Ms=ur.getProperty(ii,ke.p));Oi-- >0;)$r=En[Oi],$r.end||$r.refresh(0,1)||(Da=st),Tr=$r.pin,Tr&&(Tr===U||Tr===$||Tr===Ii)&&!$r.isReverted&&(fn||(fn=[]),fn.unshift($r),$r.revert(!0,!0)),$r!==En[Oi]&&(Xi--,Oi--);for(ja(Qt)&&(Qt=Qt(st)),Qt=cF(Qt,"start",st),Ge=yF(Qt,U,be,ke,vt(),ht,Ue,st,fe,ir,ui,Ke,me,st._startClamp&&"_startClamp")||($?-.001:0),ja(lt)&&(lt=lt(st)),Yl(lt)&&!lt.indexOf("+=")&&(~lt.indexOf(" ")?lt=(Yl(Qt)?Qt.split(" ")[0]:"")+lt:(Ze=k2(lt.substr(2),be),lt=Yl(Qt)?Qt:(me?ur.utils.mapRange(0,me.duration(),me.scrollTrigger.start,me.scrollTrigger.end,Ge):Ge)+Ze,Kt=U)),lt=cF(lt,"end",st),Qe=Math.max(Ge,yF(lt||(Kt?"100% 0":Ke),Kt,be,ke,vt()+Ze,Et,ii,st,fe,ir,ui,Ke,me,st._endClamp&&"_endClamp"))||-.001,Ze=0,Oi=Xi;Oi--;)$r=En[Oi],Tr=$r.pin,Tr&&$r.start-$r._pinPush<=Ge&&!me&&$r.end>0&&($i=$r.end-(st._startClamp?Math.max(0,$r.start):$r.start),(Tr===U&&$r.start-$r._pinPush<Ge||Tr===Ii)&&isNaN(Qt)&&(Ze+=$i*(1-$r.progress)),Tr===$&&(yt+=$i));if(Ge+=Ze,Qe+=Ze,st._startClamp&&(st._startClamp+=Ze),st._endClamp&&!dl&&(st._endClamp=Qe||-.001,Qe=Math.min(Qe,ah(He,ke))),Lt=Qe-Ge||(Ge-=.01)&&.001,ze&&(Ni=ur.utils.clamp(0,1,ur.utils.normalize(Ge,Qe,eo))),st._pinPush=yt,ht&&Ze&&($i={},$i[ke.a]="+="+Ze,Ii&&($i[ke.p]="-="+vt()),ur.set([ht,Et],$i)),$&&!(B4&&st.end>=ah(He,ke)))$i=Rc($),In=ke===Bo,Ji=vt(),wr=parseFloat(Ei(ke.a))+yt,!Ke&&Qe>1&&(Fr=(xi?zs.scrollingElement||Ql:He).style,Fr={style:Fr,value:Fr["overflow"+ke.a.toUpperCase()]},xi&&Rc(hs)["overflow"+ke.a.toUpperCase()]!=="scroll"&&(Fr.style["overflow"+ke.a.toUpperCase()]="scroll")),WA($,Ci,$i),bi=c2($),yr=pd($,!0),br=ui&&lp(He,In?gl:Bo)(),te?(_r=[te+ke.os2,Lt+yt+No],_r.t=Ci,Oi=te===Ao?VT($,ke)+Lt+yt:0,Oi&&(_r.push(ke.d,Oi+No),Ci.style.flexBasis!=="auto"&&(Ci.style.flexBasis=Oi+No)),l0(_r),Ii&&En.forEach(function(Ss){Ss.pin===Ii&&Ss.vars.pinSpacing!==!1&&(Ss._subPinOffset=!0)}),ui&&vt(eo)):(Oi=VT($,ke),Oi&&Ci.style.flexBasis!=="auto"&&(Ci.style.flexBasis=Oi+No)),ui&&(qr={top:yr.top+(In?Ji-Ge:br)+No,left:yr.left+(In?br:Ji-Ge)+No,boxSizing:"border-box",position:"fixed"},qr[bm]=qr["max"+O0]=Math.ceil(yr.width)+No,qr[wm]=qr["max"+gP]=Math.ceil(yr.height)+No,qr[Cc]=qr[Cc+B1]=qr[Cc+z1]=qr[Cc+V1]=qr[Cc+N1]="0",qr[Ao]=$i[Ao],qr[Ao+B1]=$i[Ao+B1],qr[Ao+z1]=$i[Ao+z1],qr[Ao+V1]=$i[Ao+V1],qr[Ao+N1]=$i[Ao+N1],ni=ace(Ai,qr,at),dl&&vt(0)),c?(un=c._initted,jA(1),c.render(c.duration(),!0,!0),on=Ei(ke.a)-wr+Lt+yt,es=Math.abs(Lt-on)>1,ui&&es&&ni.splice(ni.length-2,2),c.render(0,!0,!0),un||c.invalidate(!0),c.parent||c.totalTime(c.totalTime()),jA(0)):on=Lt,Fr&&(Fr.value?Fr.style["overflow"+ke.a.toUpperCase()]=Fr.value:Fr.style.removeProperty("overflow-"+ke.a));else if(U&&vt()&&!me)for(yr=U.parentNode;yr&&yr!==hs;)yr._pinOffset&&(Ge-=yr._pinOffset,Qe-=yr._pinOffset),yr=yr.parentNode;fn&&fn.forEach(function(Ss){return Ss.revert(!1,!0)}),st.start=Ge,st.end=Qe,nr=Be=dl?eo:vt(),!me&&!dl&&(nr<eo&&vt(eo),st.scroll.rec=0),st.revert(!1,!0),Vr=Fa(),gs&&(Br=-1,gs.restart(!0)),Da=0,c&&Ve&&(c._initted||to)&&c.progress()!==to&&c.progress(to||0,!0).render(c.time(),!0,!0),(ze||Ni!==st.progress||me||Q||c&&!c._initted)&&(c&&!Ve&&(c._initted||Ni||c.vars.immediateRender!==!1)&&c.totalProgress(me&&Ge<-.001&&!Ni?ur.utils.normalize(Ge,Qe,0):Ni,!0),st.progress=ze||(nr-Ge)/Lt===Ni?0:Ni),$&&te&&(Ci._pinOffset=Math.round(st.progress*on)),dr&&dr.invalidate(),isNaN(cs)||(cs-=ur.getProperty(Ue,ke.p),Ms-=ur.getProperty(ii,ke.p),u2(Ue,ke,cs),u2(ht,ke,cs-(Te||0)),u2(ii,ke,Ms),u2(Et,ke,Ms-(Te||0))),ze&&!dl&&st.update(),O&&!dl&&!Jt&&(Jt=!0,O(st),Jt=!1)}},st.getVelocity=function(){return(vt()-Be)/(Fa()-o1)*1e3||0},st.endAnimation=function(){Xv(st.callbackAnimation),c&&(dr?dr.progress(1):c.paused()?Ve||Xv(c,st.direction<0,1):Xv(c,c.reversed()))},st.labelToScroll=function(q){return c&&c.labels&&(Ge||st.refresh()||Ge)+c.labels[q]/c.duration()*Lt||0},st.getTrailing=function(q){var J=En.indexOf(st),oe=st.direction>0?En.slice(0,J).reverse():En.slice(J+1);return(Yl(q)?oe.filter(function(Te){return Te.vars.preventOverlaps===q}):oe).filter(function(Te){return st.direction>0?Te.end<=Ge:Te.start>=Qe})},st.update=function(q,J,oe){if(!(me&&!oe&&!q)){var Te=dl===!0?eo:st.scroll(),be=q?0:(Te-Ge)/Lt,fe=be<0?0:be>1?1:be||0,Ke=st.progress,ze,Ze,yt,lt,Kt,Qt,Ii,Xi;if(J&&(Be=nr,nr=me?vt():Te,Me&&(jr=Qs,Qs=c&&!Ve?c.totalProgress():fe)),de&&$&&!Da&&!r2&&Nc&&(!fe&&Ge<Te+(Te-Be)/(Fa()-o1)*de?fe=1e-4:fe===1&&Qe>Te+(Te-Be)/(Fa()-o1)*de&&(fe=.9999)),fe!==Ke&&st.enabled){if(ze=st.isActive=!!fe&&fe<1,Ze=!!Ke&&Ke<1,Qt=ze!==Ze,Kt=Qt||!!fe!=!!Ke,st.direction=fe>Ke?1:-1,st.progress=fe,Kt&&!Da&&(yt=fe&&!Ke?0:fe===1?1:Ke===1?2:3,Ve&&(lt=!Qt&&ri[yt+1]!=="none"&&ri[yt+1]||ri[yt],Xi=c&&(lt==="complete"||lt==="reset"||lt in c))),Se&&(Qt||Xi)&&(Xi||A||!c)&&(ja(Se)?Se(st):st.getTrailing(Se).forEach(function(Ji){return Ji.endAnimation()})),Ve||(dr&&!Da&&!r2?(dr._dp._time-dr._start!==dr._time&&dr.render(dr._dp._time-dr._start),dr.resetTo?dr.resetTo("totalProgress",fe,c._tTime/c._tDur):(dr.vars.totalProgress=fe,dr.invalidate().restart())):c&&c.totalProgress(fe,!!(Da&&(Vr||q)))),$){if(q&&te&&(Ci.style[te+ke.os2]=Jr),!ui)hr(l1(wr+on*fe));else if(Kt){if(Ii=!q&&fe>Ke&&Qe+1>Te&&Te+1>=ah(He,ke),at)if(!q&&(ze||Ii)){var Oi=pd($,!0),$i=Te-Ge;vF($,hs,Oi.top+(ke===Bo?$i:0)+No,Oi.left+(ke===Bo?0:$i)+No)}else vF($,Ci);l0(ze||Ii?ni:bi),es&&fe<1&&ze||hr(wr+(fe===1&&!Ii?on:0))}}Me&&!Wt.tween&&!Da&&!r2&&gs.restart(!0),s&&(Qt||Le&&fe&&(fe<1||!$A))&&Ex(s.targets).forEach(function(Ji){return Ji.classList[ze||Le?"add":"remove"](s.className)}),y&&!Ve&&!q&&y(st),Kt&&!Da?(Ve&&(Xi&&(lt==="complete"?c.pause().totalProgress(1):lt==="reset"?c.restart(!0).pause():lt==="restart"?c.restart(!0):c[lt]()),y&&y(st)),(Qt||!$A)&&(R&&Qt&&HA(st,R),ti[yt]&&HA(st,ti[yt]),Le&&(fe===1?st.kill(!1,1):ti[yt]=0),Qt||(yt=fe===1?1:3,ti[yt]&&HA(st,ti[yt]))),ye&&!ze&&Math.abs(st.getVelocity())>(c1(ye)?ye:2500)&&(Xv(st.callbackAnimation),dr?dr.progress(1):Xv(c,lt==="reverse"?1:!fe,1))):Ve&&y&&!Da&&y(st)}if(xn){var yr=me?Te/me.duration()*(me._caScrollDist||0):Te;Es(yr+(Ue._isFlipped?1:0)),xn(yr)}Ta&&Ta(-Te/me.duration()*(me._caScrollDist||0))}},st.enable=function(q,J){st.enabled||(st.enabled=!0,Qo(He,"resize",u1),xi||Qo(He,"scroll",Eg),wi&&Qo(r,"refreshInit",wi),q!==!1&&(st.progress=Ni=0,nr=Be=Br=vt()),J!==!1&&st.refresh())},st.getTween=function(q){return q&&Wt?Wt.tween:dr},st.setPositions=function(q,J,oe,Te){if(me){var be=me.scrollTrigger,fe=me.duration(),Ke=be.end-be.start;q=be.start+Ke*q/fe,J=be.start+Ke*J/fe}st.refresh(!1,!1,{start:uF(q,oe&&!!st._startClamp),end:uF(J,oe&&!!st._endClamp)},Te),st.update()},st.adjustPinSpacing=function(q){if(_r&&q){var J=_r.indexOf(ke.d)+1;_r[J]=parseFloat(_r[J])+q+No,_r[1]=parseFloat(_r[1])+q+No,l0(_r)}},st.disable=function(q,J){if(st.enabled&&(q!==!1&&st.revert(!0,!0),st.enabled=st.isActive=!1,J||dr&&dr.pause(),eo=0,Xt&&(Xt.uncache=1),wi&&Jo(r,"refreshInit",wi),gs&&(gs.pause(),Wt.tween&&Wt.tween.kill()&&(Wt.tween=0)),!xi)){for(var oe=En.length;oe--;)if(En[oe].scroller===He&&En[oe]!==st)return;Jo(He,"resize",u1),xi||Jo(He,"scroll",Eg)}},st.kill=function(q,J){st.disable(q,J),dr&&!J&&dr.kill(),E&&delete V4[E];var oe=En.indexOf(st);oe>=0&&En.splice(oe,1),oe===hl&&L2>0&&hl--,oe=0,En.forEach(function(Te){return Te.scroller===st.scroller&&(oe=1)}),oe||dl||(st.scroll.rec=0),c&&(c.scrollTrigger=null,q&&c.revert({kill:!1}),J||c.kill()),ht&&[ht,Et,Ue,ii].forEach(function(Te){return Te.parentNode&&Te.parentNode.removeChild(Te)}),U1===st&&(U1=0),$&&(Xt&&(Xt.uncache=1),oe=0,En.forEach(function(Te){return Te.pin===$&&oe++}),oe||(Xt.spacer=0)),o.onKill&&o.onKill(st)},En.push(st),st.enable(!1,!1),xt&&xt(st),c&&c.add&&!Lt){var Pe=st.update;st.update=function(){st.update=Pe,Mn.cache++,Ge||Qe||st.refresh()},ur.delayedCall(.01,st.update),Lt=.01,Ge=Qe=0}else st.refresh();$&&nce()},r.register=function(o){return Lg||(ur=o||BU(),NU()&&window.document&&r.enable(),Lg=a1),Lg},r.defaults=function(o){if(o)for(var c in o)a2[c]=o[c];return a2},r.disable=function(o,c){a1=0,En.forEach(function(y){return y[c?"kill":"disable"](o)}),Jo(Pn,"wheel",Eg),Jo(zs,"scroll",Eg),clearInterval(i2),Jo(zs,"touchcancel",eh),Jo(hs,"touchstart",eh),s2(Jo,zs,"pointerdown,touchstart,mousedown",hF),s2(Jo,zs,"pointerup,touchend,mouseup",dF),NT.kill(),n2(Jo);for(var f=0;f<Mn.length;f+=3)o2(Jo,Mn[f],Mn[f+1]),o2(Jo,Mn[f],Mn[f+2])},r.enable=function(){if(Pn=window,zs=document,Ql=zs.documentElement,hs=zs.body,ur&&(Ex=ur.utils.toArray,F1=ur.utils.clamp,N4=ur.core.context||eh,jA=ur.core.suppressOverwrites||eh,fP=Pn.history.scrollRestoration||"auto",U4=Pn.pageYOffset||0,ur.core.globals("ScrollTrigger",r),hs)){a1=1,a0=document.createElement("div"),a0.style.height="100vh",a0.style.position="absolute",XU(),Yle(),vo.register(ur),r.isTouch=vo.isTouch,Rf=vo.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),z4=vo.isTouch===1,Qo(Pn,"wheel",Eg),dP=[Pn,zs,Ql,hs],ur.matchMedia?(r.matchMedia=function(R){var O=ur.matchMedia(),A;for(A in R)O.add(A,R[A]);return O},ur.addEventListener("matchMediaInit",function(){return vP()}),ur.addEventListener("matchMediaRevert",function(){return qU()}),ur.addEventListener("matchMedia",function(){hm(0,1),Um("matchMedia")}),ur.matchMedia().add("(orientation: portrait)",function(){return qA(),qA})):console.warn("Requires GSAP 3.11.0 or later"),qA(),Qo(zs,"scroll",Eg);var o=hs.hasAttribute("style"),c=hs.style,f=c.borderTopStyle,y=ur.core.Animation.prototype,s,E;for(y.revert||Object.defineProperty(y,"revert",{value:function(){return this.time(-.01,!0)}}),c.borderTopStyle="solid",s=pd(hs),Bo.m=Math.round(s.top+Bo.sc())||0,gl.m=Math.round(s.left+gl.sc())||0,f?c.borderTopStyle=f:c.removeProperty("border-top-style"),o||(hs.setAttribute("style",""),hs.removeAttribute("style")),i2=setInterval(mF,250),ur.delayedCall(.5,function(){return r2=0}),Qo(zs,"touchcancel",eh),Qo(hs,"touchstart",eh),s2(Qo,zs,"pointerdown,touchstart,mousedown",hF),s2(Qo,zs,"pointerup,touchend,mouseup",dF),F4=ur.utils.checkPrefix("transform"),O2.push(F4),Lg=Fa(),NT=ur.delayedCall(.2,hm).pause(),Og=[zs,"visibilitychange",function(){var R=Pn.innerWidth,O=Pn.innerHeight;zs.hidden?(aF=R,lF=O):(aF!==R||lF!==O)&&u1()},zs,"DOMContentLoaded",hm,Pn,"load",hm,Pn,"resize",u1],n2(Qo),En.forEach(function(R){return R.enable(0,1)}),E=0;E<Mn.length;E+=3)o2(Jo,Mn[E],Mn[E+1]),o2(Jo,Mn[E],Mn[E+2])}},r.config=function(o){"limitCallbacks"in o&&($A=!!o.limitCallbacks);var c=o.syncInterval;c&&clearInterval(i2)||(i2=c)&&setInterval(mF,c),"ignoreMobileResize"in o&&(z4=r.isTouch===1&&o.ignoreMobileResize),"autoRefreshEvents"in o&&(n2(Jo)||n2(Qo,o.autoRefreshEvents||"none"),OU=(o.autoRefreshEvents+"").indexOf("resize")===-1)},r.scrollerProxy=function(o,c){var f=Il(o),y=Mn.indexOf(f),s=Bm(f);~y&&Mn.splice(y,s?6:2),c&&(s?_h.unshift(Pn,c,hs,c,Ql,c):_h.unshift(f,c))},r.clearMatchMedia=function(o){En.forEach(function(c){return c._ctx&&c._ctx.query===o&&c._ctx.kill(!0,!0)})},r.isInViewport=function(o,c,f){var y=(Yl(o)?Il(o):o).getBoundingClientRect(),s=y[f?bm:wm]*c||0;return f?y.right-s>0&&y.left+s<Pn.innerWidth:y.bottom-s>0&&y.top+s<Pn.innerHeight},r.positionInViewport=function(o,c,f){Yl(o)&&(o=Il(o));var y=o.getBoundingClientRect(),s=y[f?bm:wm],E=c==null?s/2:c in UT?UT[c]*s:~c.indexOf("%")?parseFloat(c)*s/100:parseFloat(c)||0;return f?(y.left+E)/Pn.innerWidth:(y.top+E)/Pn.innerHeight},r.killAll=function(o){if(En.slice(0).forEach(function(f){return f.vars.id!=="ScrollSmoother"&&f.kill()}),o!==!0){var c=Vm.killAll||[];Vm={},c.forEach(function(f){return f()})}},r}();Fn.version="3.13.0";Fn.saveStyles=function(r){return r?Ex(r).forEach(function(e){if(e&&e.style){var t=Zl.indexOf(e);t>=0&&Zl.splice(t,5),Zl.push(e,e.style.cssText,e.getBBox&&e.getAttribute("transform"),ur.core.getCache(e),N4())}}):Zl};Fn.revert=function(r,e){return vP(!r,e)};Fn.create=function(r,e){return new Fn(r,e)};Fn.refresh=function(r){return r?u1(!0):(Lg||Fn.register())&&hm(!0)};Fn.update=function(r){return++Mn.cache&&wd(r===!0?2:0)};Fn.clearScrollMemory=WU;Fn.maxScroll=function(r,e){return ah(r,e?gl:Bo)};Fn.getScrollFunc=function(r,e){return lp(Il(r),e?gl:Bo)};Fn.getById=function(r){return V4[r]};Fn.getAll=function(){return En.filter(function(r){return r.vars.id!=="ScrollSmoother"})};Fn.isScrolling=function(){return!!Nc};Fn.snapDirectional=yP;Fn.addEventListener=function(r,e){var t=Vm[r]||(Vm[r]=[]);~t.indexOf(e)||t.push(e)};Fn.removeEventListener=function(r,e){var t=Vm[r],o=t&&t.indexOf(e);o>=0&&t.splice(o,1)};Fn.batch=function(r,e){var t=[],o={},c=e.interval||.016,f=e.batchMax||1e9,y=function(R,O){var A=[],U=[],$=ur.delayedCall(c,function(){O(A,U),A=[],U=[]}).pause();return function(te){A.length||$.restart(!0),A.push(te.trigger),U.push(te),f<=A.length&&$.progress(1)}},s;for(s in e)o[s]=s.substr(0,2)==="on"&&ja(e[s])&&s!=="onRefreshInit"?y(s,e[s]):e[s];return ja(f)&&(f=f(),Qo(Fn,"refresh",function(){return f=e.batchMax()})),Ex(r).forEach(function(E){var R={};for(s in o)R[s]=o[s];R.trigger=E,t.push(Fn.create(R))}),t};var bF=function(e,t,o,c){return t>c?e(c):t<0&&e(0),o>c?(c-t)/(o-t):o<0?t/(t-o):1},XA=function r(e,t){t===!0?e.style.removeProperty("touch-action"):e.style.touchAction=t===!0?"auto":t?"pan-"+t+(vo.isTouch?" pinch-zoom":""):"none",e===Ql&&r(hs,t)},h2={auto:1,scroll:1},cce=function(e){var t=e.event,o=e.target,c=e.axis,f=(t.changedTouches?t.changedTouches[0]:t).target,y=f._gsap||ur.core.getCache(f),s=Fa(),E;if(!y._isScrollT||s-y._isScrollT>2e3){for(;f&&f!==hs&&(f.scrollHeight<=f.clientHeight&&f.scrollWidth<=f.clientWidth||!(h2[(E=Rc(f)).overflowY]||h2[E.overflowX]));)f=f.parentNode;y._isScroll=f&&f!==o&&!Bm(f)&&(h2[(E=Rc(f)).overflowY]||h2[E.overflowX]),y._isScrollT=s}(y._isScroll||c==="x")&&(t.stopPropagation(),t._gsapAllow=!0)},KU=function(e,t,o,c){return vo.create({target:e,capture:!0,debounce:!1,lockAxis:!0,type:t,onWheel:c=c&&cce,onPress:c,onDrag:c,onScroll:c,onEnable:function(){return o&&Qo(zs,vo.eventTypes[0],TF,!1,!0)},onDisable:function(){return Jo(zs,vo.eventTypes[0],TF,!0)}})},uce=/(input|label|select|textarea)/i,wF,TF=function(e){var t=uce.test(e.target.tagName);(t||wF)&&(e._gsapAllow=!0,wF=t)},hce=function(e){sm(e)||(e={}),e.preventDefault=e.isNormalizer=e.allowClicks=!0,e.type||(e.type="wheel,touch"),e.debounce=!!e.debounce,e.id=e.id||"normalizer";var t=e,o=t.normalizeScrollX,c=t.momentum,f=t.allowNestedScroll,y=t.onRelease,s,E,R=Il(e.target)||Ql,O=ur.core.globals().ScrollSmoother,A=O&&O.get(),U=Rf&&(e.content&&Il(e.content)||A&&e.content!==!1&&!A.smooth()&&A.content()),$=lp(R,Bo),te=lp(R,gl),Q=1,de=(vo.isTouch&&Pn.visualViewport?Pn.visualViewport.scale*Pn.visualViewport.width:Pn.outerWidth)/Pn.innerWidth,Ce=0,Fe=ja(c)?function(){return c(s)}:function(){return c||2.8},Le,Me,at=KU(R,e.type,!0,f),pt=function(){return Me=!1},me=eh,ye=eh,Se=function(){E=ah(R,Bo),ye=F1(Rf?1:0,E),o&&(me=F1(0,ah(R,gl))),Le=Tm},ke=function(){U._gsap.y=l1(parseFloat(U._gsap.y)+$.offset)+"px",U.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(U._gsap.y)+", 0, 1)",$.offset=$.cacheID=0},Ve=function(){if(Me){requestAnimationFrame(pt);var Si=l1(s.deltaY/2),ir=ye($.v-Si);if(U&&ir!==$.v+$.offset){$.offset=ir-$.v;var st=l1((parseFloat(U&&U._gsap.y)||0)-$.offset);U.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+st+", 0, 1)",U._gsap.y=st+"px",$.cacheID=Mn.cache,wd()}return!0}$.offset&&ke(),Me=!0},He,Oe,xi,ui,ti=function(){Se(),He.isActive()&&He.vars.scrollY>E&&($()>E?He.progress(1)&&$(E):He.resetTo("scrollY",E))};return U&&ur.set(U,{y:"+=0"}),e.ignoreCheck=function(ri){return Rf&&ri.type==="touchmove"&&Ve()||Q>1.05&&ri.type!=="touchstart"||s.isGesturing||ri.touches&&ri.touches.length>1},e.onPress=function(){Me=!1;var ri=Q;Q=l1((Pn.visualViewport&&Pn.visualViewport.scale||1)/de),He.pause(),ri!==Q&&XA(R,Q>1.01?!0:o?!1:"x"),Oe=te(),xi=$(),Se(),Le=Tm},e.onRelease=e.onGestureStart=function(ri,Si){if($.offset&&ke(),!Si)ui.restart(!0);else{Mn.cache++;var ir=Fe(),st,wi;o&&(st=te(),wi=st+ir*.05*-ri.velocityX/.227,ir*=bF(te,st,wi,ah(R,gl)),He.vars.scrollX=me(wi)),st=$(),wi=st+ir*.05*-ri.velocityY/.227,ir*=bF($,st,wi,ah(R,Bo)),He.vars.scrollY=ye(wi),He.invalidate().duration(ir).play(.01),(Rf&&He.vars.scrollY>=E||st>=E-1)&&ur.to({},{onUpdate:ti,duration:ir})}y&&y(ri)},e.onWheel=function(){He._ts&&He.pause(),Fa()-Ce>1e3&&(Le=0,Ce=Fa())},e.onChange=function(ri,Si,ir,st,wi){if(Tm!==Le&&Se(),Si&&o&&te(me(st[2]===Si?Oe+(ri.startX-ri.x):te()+Si-st[1])),ir){$.offset&&ke();var ji=wi[2]===ir,Ar=ji?xi+ri.startY-ri.y:$()+ir-wi[1],Br=ye(Ar);ji&&Ar!==Br&&(xi+=Br-Ar),$(Br)}(ir||Si)&&wd()},e.onEnable=function(){XA(R,o?!1:"x"),Fn.addEventListener("refresh",ti),Qo(Pn,"resize",ti),$.smooth&&($.target.style.scrollBehavior="auto",$.smooth=te.smooth=!1),at.enable()},e.onDisable=function(){XA(R,!0),Jo(Pn,"resize",ti),Fn.removeEventListener("refresh",ti),at.kill()},e.lockAxis=e.lockAxis!==!1,s=new vo(e),s.iOS=Rf,Rf&&!$()&&$(1),Rf&&ur.ticker.add(eh),ui=s._dc,He=ur.to(s,{ease:"power4",paused:!0,inherit:!1,scrollX:o?"+=0.1":"+=0",scrollY:"+=0.1",modifiers:{scrollY:ZU($,$(),function(){return He.pause()})},onUpdate:wd,onComplete:ui.vars.onComplete}),s};Fn.sort=function(r){if(ja(r))return En.sort(r);var e=Pn.pageYOffset||0;return Fn.getAll().forEach(function(t){return t._sortY=t.trigger?e+t.trigger.getBoundingClientRect().top:t.start+Pn.innerHeight}),En.sort(r||function(t,o){return(t.vars.refreshPriority||0)*-1e6+(t.vars.containerAnimation?1e6:t._sortY)-((o.vars.containerAnimation?1e6:o._sortY)+(o.vars.refreshPriority||0)*-1e6)})};Fn.observe=function(r){return new vo(r)};Fn.normalizeScroll=function(r){if(typeof r>"u")return ul;if(r===!0&&ul)return ul.enable();if(r===!1){ul&&ul.kill(),ul=r;return}var e=r instanceof vo?r:hce(r);return ul&&ul.target===e.target&&ul.kill(),Bm(e.target)&&(ul=e),e};Fn.core={_getVelocityProp:O4,_inputObserver:KU,_scrollers:Mn,_proxies:_h,bridge:{ss:function(){Nc||Um("scrollStart"),Nc=Fa()},ref:function(){return Da}}};BU()&&ur.registerPlugin(Fn);const dce={class:"weather"},fce={class:"label"},pce={class:"condition"},mce={class:"time"},_ce={class:"temperature"},gce={class:"precipitation"},yce={class:"wind"},vce="9de243494c0b295cca9337e1e96b00e2",xce=wa({__name:"Weather",props:{lat:{},lon:{},day:{}},setup(r){k4.registerPlugin(Fn);const e=Qn(),t=r,o=Qn();fetch(`https://pro.openweathermap.org/data/2.5/forecast?lat=${t.lat}&lon=${t.lon}&appid=${vce}&lang=it&units=metric`).then(E=>{E.json().then(R=>{o.value=R.list})});const c=fa(()=>o.value==null||o.value.length===0?[]:o.value.filter(E=>f(new Date(E.dt*1e3),t.day)));function f(E,R){return E.getMonth()===R.getMonth()&&E.getDate()===R.getDate()}const y=E=>new Date(E*1e3).toLocaleTimeString().slice(0,-3),s=E=>{switch(E){case"01d":case"01n":return"sunny";case"02d":case"02n":return"partly_cloudy_day";case"03d":case"03n":case"04d":case"04n":return"cloud";case"09d":case"09n":return"rainy_light";case"10d":case"10n":return"rainy_heavy";case"11d":case"11n":return"thunderstorm";case"13d":case"13n":return"snowing";case"50d":case"50n":return"mist"}};return Hf(o,E=>{E&&E.length>0&&lC(()=>{e.value&&e.value.children.length>0?k4.from(e.value.children,{scrollTrigger:{trigger:e.value,start:"top 80%",end:"bottom 20%",toggleActions:"play none none none"},opacity:0,y:20,stagger:.2,duration:.5,ease:"power1.out"}):console.warn("Elements not found for GSAP animation after data fetch")})}),(E,R)=>(Pr(),Qr("div",dce,[mr("div",fce," Previsioni meteo per il "+ms(E.day.toLocaleDateString())+": ",1),mr("div",{ref_key:"weatherGridRef",ref:e,class:"weather-grid"},[(Pr(!0),Qr(Po,null,Em(c.value,O=>(Pr(),Qr("div",{class:"weather-data",key:O.dt},[mr("div",pce,[mr("md-icon",null,ms(s(O.weather[0].icon)),1)]),mr("div",mce,ms(y(O.dt)),1),mr("div",_ce,ms(O.main.temp)+"°C",1),mr("div",gce,ms(O.pop*100)+"%",1),mr("div",yce,ms(O.wind.speed)+" m/s ",1)]))),128))],512)]))}}),bce=cc(xce,[["__scopeId","data-v-40ef7b63"]]);/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const wce=X0(Uo);class xl extends wce{get name(){return this.getAttribute("name")??""}set name(e){this.setAttribute("name",e)}get form(){return this[pl].form}constructor(){super(),this.disabled=!1,this.href="",this.target="",this.trailingIcon=!1,this.hasIcon=!1,this.type="submit",this.value="",this.handleActivationClick=e=>{!FE(e)||!this.buttonElement||(this.focus(),OE(this.buttonElement))},this.addEventListener("click",this.handleActivationClick)}focus(){var e;(e=this.buttonElement)==null||e.focus()}blur(){var e;(e=this.buttonElement)==null||e.blur()}render(){var c;const e=this.disabled&&!this.href,t=this.href?this.renderLink():this.renderButton(),o=this.href?"link":"button";return Xr`
      ${(c=this.renderElevationOrOutline)==null?void 0:c.call(this)}
      <div class="background"></div>
      <md-focus-ring part="focus-ring" for=${o}></md-focus-ring>
      <md-ripple
        part="ripple"
        for=${o}
        ?disabled="${e}"></md-ripple>
      ${t}
    `}renderButton(){const{ariaLabel:e,ariaHasPopup:t,ariaExpanded:o}=this;return Xr`<button
      id="button"
      class="button"
      ?disabled=${this.disabled}
      aria-label="${e||sr}"
      aria-haspopup="${t||sr}"
      aria-expanded="${o||sr}">
      ${this.renderContent()}
    </button>`}renderLink(){const{ariaLabel:e,ariaHasPopup:t,ariaExpanded:o}=this;return Xr`<a
      id="link"
      class="button"
      aria-label="${e||sr}"
      aria-haspopup="${t||sr}"
      aria-expanded="${o||sr}"
      href=${this.href}
      target=${this.target||sr}
      >${this.renderContent()}
    </a>`}renderContent(){const e=Xr`<slot
      name="icon"
      @slotchange="${this.handleSlotChange}"></slot>`;return Xr`
      <span class="touch"></span>
      ${this.trailingIcon?sr:e}
      <span class="label"><slot></slot></span>
      ${this.trailingIcon?e:sr}
    `}handleSlotChange(){this.hasIcon=this.assignedIcons.length>0}}Km(xl),g9(xl);xl.formAssociated=!0;xl.shadowRootOptions={mode:"open",delegatesFocus:!0};Nt([Mi({type:Boolean,reflect:!0})],xl.prototype,"disabled",void 0);Nt([Mi()],xl.prototype,"href",void 0);Nt([Mi()],xl.prototype,"target",void 0);Nt([Mi({type:Boolean,attribute:"trailing-icon",reflect:!0})],xl.prototype,"trailingIcon",void 0);Nt([Mi({type:Boolean,attribute:"has-icon",reflect:!0})],xl.prototype,"hasIcon",void 0);Nt([Mi()],xl.prototype,"type",void 0);Nt([Mi({reflect:!0})],xl.prototype,"value",void 0);Nt([lc(".button")],xl.prototype,"buttonElement",void 0);Nt([ME({slot:"icon",flatten:!0})],xl.prototype,"assignedIcons",void 0);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Tce extends xl{renderElevationOrOutline(){return Xr`<md-elevation part="elevation"></md-elevation>`}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ece=ho`:host{--_container-color: var(--md-filled-tonal-button-container-color, var(--md-sys-color-secondary-container, #e8def8));--_container-elevation: var(--md-filled-tonal-button-container-elevation, 0);--_container-height: var(--md-filled-tonal-button-container-height, 40px);--_container-shadow-color: var(--md-filled-tonal-button-container-shadow-color, var(--md-sys-color-shadow, #000));--_disabled-container-color: var(--md-filled-tonal-button-disabled-container-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-container-elevation: var(--md-filled-tonal-button-disabled-container-elevation, 0);--_disabled-container-opacity: var(--md-filled-tonal-button-disabled-container-opacity, 0.12);--_disabled-label-text-color: var(--md-filled-tonal-button-disabled-label-text-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-label-text-opacity: var(--md-filled-tonal-button-disabled-label-text-opacity, 0.38);--_focus-container-elevation: var(--md-filled-tonal-button-focus-container-elevation, 0);--_focus-label-text-color: var(--md-filled-tonal-button-focus-label-text-color, var(--md-sys-color-on-secondary-container, #1d192b));--_hover-container-elevation: var(--md-filled-tonal-button-hover-container-elevation, 1);--_hover-label-text-color: var(--md-filled-tonal-button-hover-label-text-color, var(--md-sys-color-on-secondary-container, #1d192b));--_hover-state-layer-color: var(--md-filled-tonal-button-hover-state-layer-color, var(--md-sys-color-on-secondary-container, #1d192b));--_hover-state-layer-opacity: var(--md-filled-tonal-button-hover-state-layer-opacity, 0.08);--_label-text-color: var(--md-filled-tonal-button-label-text-color, var(--md-sys-color-on-secondary-container, #1d192b));--_label-text-font: var(--md-filled-tonal-button-label-text-font, var(--md-sys-typescale-label-large-font, var(--md-ref-typeface-plain, Roboto)));--_label-text-line-height: var(--md-filled-tonal-button-label-text-line-height, var(--md-sys-typescale-label-large-line-height, 1.25rem));--_label-text-size: var(--md-filled-tonal-button-label-text-size, var(--md-sys-typescale-label-large-size, 0.875rem));--_label-text-weight: var(--md-filled-tonal-button-label-text-weight, var(--md-sys-typescale-label-large-weight, var(--md-ref-typeface-weight-medium, 500)));--_pressed-container-elevation: var(--md-filled-tonal-button-pressed-container-elevation, 0);--_pressed-label-text-color: var(--md-filled-tonal-button-pressed-label-text-color, var(--md-sys-color-on-secondary-container, #1d192b));--_pressed-state-layer-color: var(--md-filled-tonal-button-pressed-state-layer-color, var(--md-sys-color-on-secondary-container, #1d192b));--_pressed-state-layer-opacity: var(--md-filled-tonal-button-pressed-state-layer-opacity, 0.12);--_disabled-icon-color: var(--md-filled-tonal-button-disabled-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-icon-opacity: var(--md-filled-tonal-button-disabled-icon-opacity, 0.38);--_focus-icon-color: var(--md-filled-tonal-button-focus-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_hover-icon-color: var(--md-filled-tonal-button-hover-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_icon-color: var(--md-filled-tonal-button-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_icon-size: var(--md-filled-tonal-button-icon-size, 18px);--_pressed-icon-color: var(--md-filled-tonal-button-pressed-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_container-shape-start-start: var(--md-filled-tonal-button-container-shape-start-start, var(--md-filled-tonal-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-start-end: var(--md-filled-tonal-button-container-shape-start-end, var(--md-filled-tonal-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-end: var(--md-filled-tonal-button-container-shape-end-end, var(--md-filled-tonal-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-start: var(--md-filled-tonal-button-container-shape-end-start, var(--md-filled-tonal-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_leading-space: var(--md-filled-tonal-button-leading-space, 24px);--_trailing-space: var(--md-filled-tonal-button-trailing-space, 24px);--_with-leading-icon-leading-space: var(--md-filled-tonal-button-with-leading-icon-leading-space, 16px);--_with-leading-icon-trailing-space: var(--md-filled-tonal-button-with-leading-icon-trailing-space, 24px);--_with-trailing-icon-leading-space: var(--md-filled-tonal-button-with-trailing-icon-leading-space, 24px);--_with-trailing-icon-trailing-space: var(--md-filled-tonal-button-with-trailing-icon-trailing-space, 16px)}
`;/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const YU=ho`md-elevation{transition-duration:280ms}:host([disabled]) md-elevation{transition:none}md-elevation{--md-elevation-level: var(--_container-elevation);--md-elevation-shadow-color: var(--_container-shadow-color)}:host(:focus-within) md-elevation{--md-elevation-level: var(--_focus-container-elevation)}:host(:hover) md-elevation{--md-elevation-level: var(--_hover-container-elevation)}:host(:active) md-elevation{--md-elevation-level: var(--_pressed-container-elevation)}:host([disabled]) md-elevation{--md-elevation-level: var(--_disabled-container-elevation)}
`;/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const JU=ho`:host{border-start-start-radius:var(--_container-shape-start-start);border-start-end-radius:var(--_container-shape-start-end);border-end-start-radius:var(--_container-shape-end-start);border-end-end-radius:var(--_container-shape-end-end);box-sizing:border-box;cursor:pointer;display:inline-flex;gap:8px;min-height:var(--_container-height);outline:none;padding-block:calc((var(--_container-height) - max(var(--_label-text-line-height),var(--_icon-size)))/2);padding-inline-start:var(--_leading-space);padding-inline-end:var(--_trailing-space);place-content:center;place-items:center;position:relative;font-family:var(--_label-text-font);font-size:var(--_label-text-size);line-height:var(--_label-text-line-height);font-weight:var(--_label-text-weight);text-overflow:ellipsis;text-wrap:nowrap;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);vertical-align:top;--md-ripple-hover-color: var(--_hover-state-layer-color);--md-ripple-pressed-color: var(--_pressed-state-layer-color);--md-ripple-hover-opacity: var(--_hover-state-layer-opacity);--md-ripple-pressed-opacity: var(--_pressed-state-layer-opacity)}md-focus-ring{--md-focus-ring-shape-start-start: var(--_container-shape-start-start);--md-focus-ring-shape-start-end: var(--_container-shape-start-end);--md-focus-ring-shape-end-end: var(--_container-shape-end-end);--md-focus-ring-shape-end-start: var(--_container-shape-end-start)}:host([disabled]){cursor:default;pointer-events:none}.button{border-radius:inherit;cursor:inherit;display:inline-flex;align-items:center;justify-content:center;border:none;outline:none;-webkit-appearance:none;vertical-align:middle;background:rgba(0,0,0,0);text-decoration:none;min-width:calc(64px - var(--_leading-space) - var(--_trailing-space));width:100%;z-index:0;height:100%;font:inherit;color:var(--_label-text-color);padding:0;gap:inherit;text-transform:inherit}.button::-moz-focus-inner{padding:0;border:0}:host(:hover) .button{color:var(--_hover-label-text-color)}:host(:focus-within) .button{color:var(--_focus-label-text-color)}:host(:active) .button{color:var(--_pressed-label-text-color)}.background{background-color:var(--_container-color);border-radius:inherit;inset:0;position:absolute}.label{overflow:hidden}:is(.button,.label,.label slot),.label ::slotted(*){text-overflow:inherit}:host([disabled]) .label{color:var(--_disabled-label-text-color);opacity:var(--_disabled-label-text-opacity)}:host([disabled]) .background{background-color:var(--_disabled-container-color);opacity:var(--_disabled-container-opacity)}@media(forced-colors: active){.background{border:1px solid CanvasText}:host([disabled]){--_disabled-icon-color: GrayText;--_disabled-icon-opacity: 1;--_disabled-container-opacity: 1;--_disabled-label-text-color: GrayText;--_disabled-label-text-opacity: 1}}:host([has-icon]:not([trailing-icon])){padding-inline-start:var(--_with-leading-icon-leading-space);padding-inline-end:var(--_with-leading-icon-trailing-space)}:host([has-icon][trailing-icon]){padding-inline-start:var(--_with-trailing-icon-leading-space);padding-inline-end:var(--_with-trailing-icon-trailing-space)}::slotted([slot=icon]){display:inline-flex;position:relative;writing-mode:horizontal-tb;fill:currentColor;flex-shrink:0;color:var(--_icon-color);font-size:var(--_icon-size);inline-size:var(--_icon-size);block-size:var(--_icon-size)}:host(:hover) ::slotted([slot=icon]){color:var(--_hover-icon-color)}:host(:focus-within) ::slotted([slot=icon]){color:var(--_focus-icon-color)}:host(:active) ::slotted([slot=icon]){color:var(--_pressed-icon-color)}:host([disabled]) ::slotted([slot=icon]){color:var(--_disabled-icon-color);opacity:var(--_disabled-icon-opacity)}.touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}:host([touch-target=wrapper]){margin:max(0px,(48px - var(--_container-height))/2) 0}:host([touch-target=none]) .touch{display:none}
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let $4=class extends Tce{};$4.styles=[JU,YU,Ece];$4=Nt([Xa("md-filled-tonal-button")],$4);/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Z0 extends Uo{constructor(){super(...arguments),this.value=0,this.max=1,this.indeterminate=!1,this.fourColor=!1}render(){const{ariaLabel:e}=this;return Xr`
      <div
        class="progress ${Sl(this.getRenderClasses())}"
        role="progressbar"
        aria-label="${e||sr}"
        aria-valuemin="0"
        aria-valuemax=${this.max}
        aria-valuenow=${this.indeterminate?sr:this.value}
        >${this.renderIndicator()}</div
      >
    `}getRenderClasses(){return{indeterminate:this.indeterminate,"four-color":this.fourColor}}}Km(Z0);Nt([Mi({type:Number})],Z0.prototype,"value",void 0);Nt([Mi({type:Number})],Z0.prototype,"max",void 0);Nt([Mi({type:Boolean})],Z0.prototype,"indeterminate",void 0);Nt([Mi({type:Boolean,attribute:"four-color"})],Z0.prototype,"fourColor",void 0);/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ice extends Z0{renderIndicator(){return this.indeterminate?this.renderIndeterminateContainer():this.renderDeterminateContainer()}renderDeterminateContainer(){const e=(1-this.value/this.max)*100;return Xr`
      <svg viewBox="0 0 4800 4800">
        <circle class="track" pathLength="100"></circle>
        <circle
          class="active-track"
          pathLength="100"
          stroke-dashoffset=${e}></circle>
      </svg>
    `}renderIndeterminateContainer(){return Xr` <div class="spinner">
      <div class="left">
        <div class="circle"></div>
      </div>
      <div class="right">
        <div class="circle"></div>
      </div>
    </div>`}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Sce=ho`:host{--_active-indicator-color: var(--md-circular-progress-active-indicator-color, var(--md-sys-color-primary, #6750a4));--_active-indicator-width: var(--md-circular-progress-active-indicator-width, 10);--_four-color-active-indicator-four-color: var(--md-circular-progress-four-color-active-indicator-four-color, var(--md-sys-color-tertiary-container, #ffd8e4));--_four-color-active-indicator-one-color: var(--md-circular-progress-four-color-active-indicator-one-color, var(--md-sys-color-primary, #6750a4));--_four-color-active-indicator-three-color: var(--md-circular-progress-four-color-active-indicator-three-color, var(--md-sys-color-tertiary, #7d5260));--_four-color-active-indicator-two-color: var(--md-circular-progress-four-color-active-indicator-two-color, var(--md-sys-color-primary-container, #eaddff));--_size: var(--md-circular-progress-size, 48px);display:inline-flex;vertical-align:middle;width:var(--_size);height:var(--_size);position:relative;align-items:center;justify-content:center;contain:strict;content-visibility:auto}.progress{flex:1;align-self:stretch;margin:4px}.progress,.spinner,.left,.right,.circle,svg,.track,.active-track{position:absolute;inset:0}svg{transform:rotate(-90deg)}circle{cx:50%;cy:50%;r:calc(50%*(1 - var(--_active-indicator-width)/100));stroke-width:calc(var(--_active-indicator-width)*1%);stroke-dasharray:100;fill:rgba(0,0,0,0)}.active-track{transition:stroke-dashoffset 500ms cubic-bezier(0, 0, 0.2, 1);stroke:var(--_active-indicator-color)}.track{stroke:rgba(0,0,0,0)}.progress.indeterminate{animation:linear infinite linear-rotate;animation-duration:1568.2352941176ms}.spinner{animation:infinite both rotate-arc;animation-duration:5332ms;animation-timing-function:cubic-bezier(0.4, 0, 0.2, 1)}.left{overflow:hidden;inset:0 50% 0 0}.right{overflow:hidden;inset:0 0 0 50%}.circle{box-sizing:border-box;border-radius:50%;border:solid calc(var(--_active-indicator-width)/100*(var(--_size) - 8px));border-color:var(--_active-indicator-color) var(--_active-indicator-color) rgba(0,0,0,0) rgba(0,0,0,0);animation:expand-arc;animation-iteration-count:infinite;animation-fill-mode:both;animation-duration:1333ms,5332ms;animation-timing-function:cubic-bezier(0.4, 0, 0.2, 1)}.four-color .circle{animation-name:expand-arc,four-color}.left .circle{rotate:135deg;inset:0 -100% 0 0}.right .circle{rotate:100deg;inset:0 0 0 -100%;animation-delay:-666.5ms,0ms}@media(forced-colors: active){.active-track{stroke:CanvasText}.circle{border-color:CanvasText CanvasText Canvas Canvas}}@keyframes expand-arc{0%{transform:rotate(265deg)}50%{transform:rotate(130deg)}100%{transform:rotate(265deg)}}@keyframes rotate-arc{12.5%{transform:rotate(135deg)}25%{transform:rotate(270deg)}37.5%{transform:rotate(405deg)}50%{transform:rotate(540deg)}62.5%{transform:rotate(675deg)}75%{transform:rotate(810deg)}87.5%{transform:rotate(945deg)}100%{transform:rotate(1080deg)}}@keyframes linear-rotate{to{transform:rotate(360deg)}}@keyframes four-color{0%{border-top-color:var(--_four-color-active-indicator-one-color);border-right-color:var(--_four-color-active-indicator-one-color)}15%{border-top-color:var(--_four-color-active-indicator-one-color);border-right-color:var(--_four-color-active-indicator-one-color)}25%{border-top-color:var(--_four-color-active-indicator-two-color);border-right-color:var(--_four-color-active-indicator-two-color)}40%{border-top-color:var(--_four-color-active-indicator-two-color);border-right-color:var(--_four-color-active-indicator-two-color)}50%{border-top-color:var(--_four-color-active-indicator-three-color);border-right-color:var(--_four-color-active-indicator-three-color)}65%{border-top-color:var(--_four-color-active-indicator-three-color);border-right-color:var(--_four-color-active-indicator-three-color)}75%{border-top-color:var(--_four-color-active-indicator-four-color);border-right-color:var(--_four-color-active-indicator-four-color)}90%{border-top-color:var(--_four-color-active-indicator-four-color);border-right-color:var(--_four-color-active-indicator-four-color)}100%{border-top-color:var(--_four-color-active-indicator-one-color);border-right-color:var(--_four-color-active-indicator-one-color)}}
`;/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let G4=class extends Ice{};G4.styles=[Sce];G4=Nt([Xa("md-circular-progress")],G4);const QU="@firebase/installations",xP="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e7=1e4,t7=`w:${xP}`,i7="FIS_v2",Ace="https://firebaseinstallations.googleapis.com/v1",Cce=60*60*1e3,Rce="installations",Pce="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mce={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},jm=new cp(Rce,Pce,Mce);function r7(r){return r instanceof jc&&r.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n7({projectId:r}){return`${Ace}/projects/${r}/installations`}function s7(r){return{token:r.token,requestStatus:2,expiresIn:Dce(r.expiresIn),creationTime:Date.now()}}async function o7(r,e){const o=(await e.json()).error;return jm.create("request-failed",{requestName:r,serverCode:o.code,serverMessage:o.message,serverStatus:o.status})}function a7({apiKey:r}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":r})}function kce(r,{refreshToken:e}){const t=a7(r);return t.append("Authorization",Lce(e)),t}async function l7(r){const e=await r();return e.status>=500&&e.status<600?r():e}function Dce(r){return Number(r.replace("s","000"))}function Lce(r){return`${i7} ${r}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Oce({appConfig:r,heartbeatServiceProvider:e},{fid:t}){const o=n7(r),c=a7(r),f=e.getImmediate({optional:!0});if(f){const R=await f.getHeartbeatsHeader();R&&c.append("x-firebase-client",R)}const y={fid:t,authVersion:i7,appId:r.appId,sdkVersion:t7},s={method:"POST",headers:c,body:JSON.stringify(y)},E=await l7(()=>fetch(o,s));if(E.ok){const R=await E.json();return{fid:R.fid||t,registrationStatus:2,refreshToken:R.refreshToken,authToken:s7(R.authToken)}}else throw await o7("Create Installation",E)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c7(r){return new Promise(e=>{setTimeout(e,r)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fce(r){return btoa(String.fromCharCode(...r)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zce=/^[cdef][\w-]{21}$/,H4="";function Nce(){try{const r=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(r),r[0]=112+r[0]%16;const t=Bce(r);return zce.test(t)?t:H4}catch{return H4}}function Bce(r){return Fce(r).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jE(r){return`${r.appName}!${r.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u7=new Map;function h7(r,e){const t=jE(r);d7(t,e),Vce(t,e)}function d7(r,e){const t=u7.get(r);if(t)for(const o of t)o(e)}function Vce(r,e){const t=Uce();t&&t.postMessage({key:r,fid:e}),jce()}let dm=null;function Uce(){return!dm&&"BroadcastChannel"in self&&(dm=new BroadcastChannel("[Firebase] FID Change"),dm.onmessage=r=>{d7(r.data.key,r.data.fid)}),dm}function jce(){u7.size===0&&dm&&(dm.close(),dm=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $ce="firebase-installations-database",Gce=1,$m="firebase-installations-store";let ZA=null;function bP(){return ZA||(ZA=wN($ce,Gce,{upgrade:(r,e)=>{switch(e){case 0:r.createObjectStore($m)}}})),ZA}async function jT(r,e){const t=jE(r),c=(await bP()).transaction($m,"readwrite"),f=c.objectStore($m),y=await f.get(t);return await f.put(e,t),await c.done,(!y||y.fid!==e.fid)&&h7(r,e.fid),e}async function f7(r){const e=jE(r),o=(await bP()).transaction($m,"readwrite");await o.objectStore($m).delete(e),await o.done}async function $E(r,e){const t=jE(r),c=(await bP()).transaction($m,"readwrite"),f=c.objectStore($m),y=await f.get(t),s=e(y);return s===void 0?await f.delete(t):await f.put(s,t),await c.done,s&&(!y||y.fid!==s.fid)&&h7(r,s.fid),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wP(r){let e;const t=await $E(r.appConfig,o=>{const c=Hce(o),f=qce(r,c);return e=f.registrationPromise,f.installationEntry});return t.fid===H4?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function Hce(r){const e=r||{fid:Nce(),registrationStatus:0};return p7(e)}function qce(r,e){if(e.registrationStatus===0){if(!navigator.onLine){const c=Promise.reject(jm.create("app-offline"));return{installationEntry:e,registrationPromise:c}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},o=Wce(r,t);return{installationEntry:t,registrationPromise:o}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:Xce(r)}:{installationEntry:e}}async function Wce(r,e){try{const t=await Oce(r,e);return jT(r.appConfig,t)}catch(t){throw r7(t)&&t.customData.serverCode===409?await f7(r.appConfig):await jT(r.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function Xce(r){let e=await EF(r.appConfig);for(;e.registrationStatus===1;)await c7(100),e=await EF(r.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:o}=await wP(r);return o||t}return e}function EF(r){return $E(r,e=>{if(!e)throw jm.create("installation-not-found");return p7(e)})}function p7(r){return Zce(r)?{fid:r.fid,registrationStatus:0}:r}function Zce(r){return r.registrationStatus===1&&r.registrationTime+e7<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kce({appConfig:r,heartbeatServiceProvider:e},t){const o=Yce(r,t),c=kce(r,t),f=e.getImmediate({optional:!0});if(f){const R=await f.getHeartbeatsHeader();R&&c.append("x-firebase-client",R)}const y={installation:{sdkVersion:t7,appId:r.appId}},s={method:"POST",headers:c,body:JSON.stringify(y)},E=await l7(()=>fetch(o,s));if(E.ok){const R=await E.json();return s7(R)}else throw await o7("Generate Auth Token",E)}function Yce(r,{fid:e}){return`${n7(r)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TP(r,e=!1){let t;const o=await $E(r.appConfig,f=>{if(!m7(f))throw jm.create("not-registered");const y=f.authToken;if(!e&&eue(y))return f;if(y.requestStatus===1)return t=Jce(r,e),f;{if(!navigator.onLine)throw jm.create("app-offline");const s=iue(f);return t=Qce(r,s),s}});return t?await t:o.authToken}async function Jce(r,e){let t=await IF(r.appConfig);for(;t.authToken.requestStatus===1;)await c7(100),t=await IF(r.appConfig);const o=t.authToken;return o.requestStatus===0?TP(r,e):o}function IF(r){return $E(r,e=>{if(!m7(e))throw jm.create("not-registered");const t=e.authToken;return rue(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function Qce(r,e){try{const t=await Kce(r,e),o=Object.assign(Object.assign({},e),{authToken:t});return await jT(r.appConfig,o),t}catch(t){if(r7(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await f7(r.appConfig);else{const o=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await jT(r.appConfig,o)}throw t}}function m7(r){return r!==void 0&&r.registrationStatus===2}function eue(r){return r.requestStatus===2&&!tue(r)}function tue(r){const e=Date.now();return e<r.creationTime||r.creationTime+r.expiresIn<e+Cce}function iue(r){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},r),{authToken:e})}function rue(r){return r.requestStatus===1&&r.requestTime+e7<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nue(r){const e=r,{installationEntry:t,registrationPromise:o}=await wP(e);return o?o.catch(console.error):TP(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sue(r,e=!1){const t=r;return await oue(t),(await TP(t,e)).token}async function oue(r){const{registrationPromise:e}=await wP(r);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aue(r){if(!r||!r.options)throw KA("App Configuration");if(!r.name)throw KA("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!r.options[t])throw KA(t);return{appName:r.name,projectId:r.options.projectId,apiKey:r.options.apiKey,appId:r.options.appId}}function KA(r){return jm.create("missing-app-config-values",{valueName:r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _7="installations",lue="installations-internal",cue=r=>{const e=r.getProvider("app").getImmediate(),t=aue(e),o=sE(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:o,_delete:()=>Promise.resolve()}},uue=r=>{const e=r.getProvider("app").getImmediate(),t=sE(e,_7).getImmediate();return{getId:()=>nue(t),getToken:c=>sue(t,c)}};function hue(){Ll(new vl(_7,cue,"PUBLIC")),Ll(new vl(lue,uue,"PRIVATE"))}hue();ya(QU,xP);ya(QU,xP,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SF="analytics",due="firebase_id",fue="origin",pue=60*1e3,mue="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",EP="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dl=new B0("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _ue={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Bc=new cp("analytics","Analytics",_ue);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gue(r){if(!r.startsWith(EP)){const e=Bc.create("invalid-gtag-resource",{gtagURL:r});return Dl.warn(e.message),""}return r}function g7(r){return Promise.all(r.map(e=>e.catch(t=>t)))}function yue(r,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(r,e)),t}function vue(r,e){const t=yue("firebase-js-sdk-policy",{createScriptURL:gue}),o=document.createElement("script"),c=`${EP}?l=${r}&id=${e}`;o.src=t?t==null?void 0:t.createScriptURL(c):c,o.async=!0,document.head.appendChild(o)}function xue(r){let e=[];return Array.isArray(window[r])?e=window[r]:window[r]=e,e}async function bue(r,e,t,o,c,f){const y=o[c];try{if(y)await e[y];else{const E=(await g7(t)).find(R=>R.measurementId===c);E&&await e[E.appId]}}catch(s){Dl.error(s)}r("config",c,f)}async function wue(r,e,t,o,c){try{let f=[];if(c&&c.send_to){let y=c.send_to;Array.isArray(y)||(y=[y]);const s=await g7(t);for(const E of y){const R=s.find(A=>A.measurementId===E),O=R&&e[R.appId];if(O)f.push(O);else{f=[];break}}}f.length===0&&(f=Object.values(e)),await Promise.all(f),r("event",o,c||{})}catch(f){Dl.error(f)}}function Tue(r,e,t,o){async function c(f,...y){try{if(f==="event"){const[s,E]=y;await wue(r,e,t,s,E)}else if(f==="config"){const[s,E]=y;await bue(r,e,t,o,s,E)}else if(f==="consent"){const[s,E]=y;r("consent",s,E)}else if(f==="get"){const[s,E,R]=y;r("get",s,E,R)}else if(f==="set"){const[s]=y;r("set",s)}else r(f,...y)}catch(s){Dl.error(s)}}return c}function Eue(r,e,t,o,c){let f=function(...y){window[o].push(arguments)};return window[c]&&typeof window[c]=="function"&&(f=window[c]),window[c]=Tue(f,r,e,t),{gtagCore:f,wrappedGtag:window[c]}}function Iue(r){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(EP)&&t.src.includes(r))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sue=30,Aue=1e3;class Cue{constructor(e={},t=Aue){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const y7=new Cue;function Rue(r){return new Headers({Accept:"application/json","x-goog-api-key":r})}async function Pue(r){var e;const{appId:t,apiKey:o}=r,c={method:"GET",headers:Rue(o)},f=mue.replace("{app-id}",t),y=await fetch(f,c);if(y.status!==200&&y.status!==304){let s="";try{const E=await y.json();!((e=E.error)===null||e===void 0)&&e.message&&(s=E.error.message)}catch{}throw Bc.create("config-fetch-failed",{httpStatus:y.status,responseMessage:s})}return y.json()}async function Mue(r,e=y7,t){const{appId:o,apiKey:c,measurementId:f}=r.options;if(!o)throw Bc.create("no-app-id");if(!c){if(f)return{measurementId:f,appId:o};throw Bc.create("no-api-key")}const y=e.getThrottleMetadata(o)||{backoffCount:0,throttleEndTimeMillis:Date.now()},s=new Lue;return setTimeout(async()=>{s.abort()},pue),v7({appId:o,apiKey:c,measurementId:f},y,s,e)}async function v7(r,{throttleEndTimeMillis:e,backoffCount:t},o,c=y7){var f;const{appId:y,measurementId:s}=r;try{await kue(o,e)}catch(E){if(s)return Dl.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${s} provided in the "measurementId" field in the local Firebase config. [${E==null?void 0:E.message}]`),{appId:y,measurementId:s};throw E}try{const E=await Pue(r);return c.deleteThrottleMetadata(y),E}catch(E){const R=E;if(!Due(R)){if(c.deleteThrottleMetadata(y),s)return Dl.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${s} provided in the "measurementId" field in the local Firebase config. [${R==null?void 0:R.message}]`),{appId:y,measurementId:s};throw E}const O=Number((f=R==null?void 0:R.customData)===null||f===void 0?void 0:f.httpStatus)===503?fD(t,c.intervalMillis,Sue):fD(t,c.intervalMillis),A={throttleEndTimeMillis:Date.now()+O,backoffCount:t+1};return c.setThrottleMetadata(y,A),Dl.debug(`Calling attemptFetch again in ${O} millis`),v7(r,A,o,c)}}function kue(r,e){return new Promise((t,o)=>{const c=Math.max(e-Date.now(),0),f=setTimeout(t,c);r.addEventListener(()=>{clearTimeout(f),o(Bc.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function Due(r){if(!(r instanceof jc)||!r.customData)return!1;const e=Number(r.customData.httpStatus);return e===429||e===500||e===503||e===504}class Lue{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Oue(r,e,t,o,c){if(c&&c.global){r("event",t,o);return}else{const f=await e,y=Object.assign(Object.assign({},o),{send_to:f});r("event",t,y)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fue(){if(vC())try{await yN()}catch(r){return Dl.warn(Bc.create("indexeddb-unavailable",{errorInfo:r==null?void 0:r.toString()}).message),!1}else return Dl.warn(Bc.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function zue(r,e,t,o,c,f,y){var s;const E=Mue(r);E.then($=>{t[$.measurementId]=$.appId,r.options.measurementId&&$.measurementId!==r.options.measurementId&&Dl.warn(`The measurement ID in the local Firebase config (${r.options.measurementId}) does not match the measurement ID fetched from the server (${$.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch($=>Dl.error($)),e.push(E);const R=Fue().then($=>{if($)return o.getId()}),[O,A]=await Promise.all([E,R]);Iue(f)||vue(f,O.measurementId),c("js",new Date);const U=(s=y==null?void 0:y.config)!==null&&s!==void 0?s:{};return U[fue]="firebase",U.update=!0,A!=null&&(U[due]=A),c("config",O.measurementId,U),O.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nue{constructor(e){this.app=e}_delete(){return delete j1[this.app.options.appId],Promise.resolve()}}let j1={},AF=[];const CF={};let YA="dataLayer",Bue="gtag",RF,x7,PF=!1;function Vue(){const r=[];if(_N()&&r.push("This is a browser extension environment."),jX()||r.push("Cookies are not available."),r.length>0){const e=r.map((o,c)=>`(${c+1}) ${o}`).join(" "),t=Bc.create("invalid-analytics-context",{errorInfo:e});Dl.warn(t.message)}}function Uue(r,e,t){Vue();const o=r.options.appId;if(!o)throw Bc.create("no-app-id");if(!r.options.apiKey)if(r.options.measurementId)Dl.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${r.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Bc.create("no-api-key");if(j1[o]!=null)throw Bc.create("already-exists",{id:o});if(!PF){xue(YA);const{wrappedGtag:f,gtagCore:y}=Eue(j1,AF,CF,YA,Bue);x7=f,RF=y,PF=!0}return j1[o]=zue(r,AF,CF,e,RF,YA,t),new Nue(r)}function jue(r,e,t,o){r=yl(r),Oue(x7,j1[r.app.options.appId],e,t,o).catch(c=>Dl.error(c))}const MF="@firebase/analytics",kF="0.10.8";function $ue(){Ll(new vl(SF,(e,{options:t})=>{const o=e.getProvider("app").getImmediate(),c=e.getProvider("installations-internal").getImmediate();return Uue(o,c,t)},"PUBLIC")),Ll(new vl("analytics-internal",r,"PRIVATE")),ya(MF,kF),ya(MF,kF,"esm2017");function r(e){try{const t=e.getProvider(SF).getImmediate();return{logEvent:(o,c,f)=>jue(t,o,c,f)}}catch(t){throw Bc.create("interop-component-reg-failed",{reason:t})}}}$ue();const Gue={apiKey:"AIzaSyBk1CeHu4Cgb9TASIxYTAV1_yioUKI6dtY",authDomain:"thisorganization.it",projectId:"this-organization",storageBucket:"this-organization.appspot.com",messagingSenderId:"765581073008",appId:"1:765581073008:web:a6acc8fc063747ba3532b5",measurementId:"G-DRJ288CGWD"},b7=TN(Gue),IP=Sne(b7),Hue="/assets/G-UibcS5yq.png",DF=new fd,que=wa({__name:"GoogleLogin",emits:["loginStart","loginEnd"],setup(r,{emit:e}){const t=Cse(),o=Qn(!1),c=e;function f(){c("loginStart"),o.value?TY(t,DF).catch(y=>{console.error("Failed signin redirect",y)}):RY(t,DF).catch(y=>{console.error("Failed signin popup",y)})}return hC(async()=>{const y=window.navigator.userAgent;o.value=/iPad|iPhone|iPod/.test(y),await MY(t).catch(E=>{console.error("Failed redirect result",E)})&&c("loginEnd")}),(y,s)=>(Pr(),Qr("md-filled-tonal-button",{onClick:f,alt:"Login button"},[...s[0]||(s[0]=[mr("img",{slot:"icon",class:"loginBtn",src:Hue},null,-1),ch(" Login con Google ",-1)])]))}}),Wue={key:0,class:"full"},Xue={key:1,class:"already-joined"},Zue={key:0,class:"need-login"},Kue={key:1,class:"join"},Yue={key:0,indeterminate:""},Jue={key:2,class:"already-joined"},Que=wa({__name:"JoinSection",props:{userAlreadyJoined:{type:Boolean},isFull:{type:Boolean}},emits:["join"],setup(r,{emit:e}){const t=Qn(!1),o=LC(),c=r,f=e;function y(){!o||!o.value||f("join",o.value)}return(s,E)=>(Pr(),Qr("div",{class:F0({"join-section":!0,"section-full":s.isFull,"section-already-joined":c.userAlreadyJoined})},[s.isFull&&(Rn(o)==null||!c.userAlreadyJoined)?(Pr(),Qr("div",Wue,[...E[0]||(E[0]=[ch(" Al completo ",-1),mr("md-icon",null,"cancel",-1)])])):s.isFull&&Rn(o)&&c.userAlreadyJoined?(Pr(),Qr("div",Xue,[...E[1]||(E[1]=[ch(" Partecipi a questo evento ",-1),mr("md-icon",null,"task_alt",-1)])])):(Pr(),Qr(Po,{key:2},[Rn(o)==null?(Pr(),Qr("div",Zue,[E[2]||(E[2]=mr("p",null," Per partecipare devi effettuare l'accesso:",-1)),Bs(que)])):(Pr(),Qr("div",Kue,[t.value?(Pr(),Qr("md-circular-progress",Yue)):c.userAlreadyJoined?(Pr(),Qr("div",Jue,[...E[3]||(E[3]=[ch(" Partecipi a questo evento ",-1),mr("md-icon",null,"task_alt",-1)])])):(Pr(),Qr("md-filled-tonal-button",{key:1,onClick:y}," Partecipa come "+ms(Rn(o).displayName||Rn(o).email),1))]))],64))],2))}}),LF=cc(Que,[["__scopeId","data-v-2178eeaa"]]),ehe={class:"event-view"},the={class:"img-container"},ihe=["src"],rhe={class:"content"},nhe={class:"title"},she={class:"date"},ohe=["innerHTML"],ahe={key:0,class:"max-participants"},lhe=wa({__name:"EventView",setup(r){const e=uN(),t=y9.find(A=>A.id===e.params.id),o=Qn(!1);function c(A){const U=new Date,$=new Date(A),te=Math.abs($.getTime()-U.getTime()),Q=5*24*60*60*1e3;return te<=Q&&U<$}const f=k8(IP,`events/${e.params.id}`),y=Ese(f,{wait:!0}),s=LC();async function E(A){A==null||A.uid==null||(o.value=!0,await Bne(f,{participants:Une({[A.uid]:{nome:A.displayName||A.email}})}),o.value=!1)}const R=fa(()=>s.value==null||y.value==null?!1:y.value.participants.some(A=>Object.keys(A)[0]===s.value.uid)),O=fa(()=>y.value==null?0:y.value.participants.length);return(A,U)=>{var $,te,Q,de,Ce,Fe,Le,Me,at,pt,me,ye,Se,ke;return Pr(),Qr("div",ehe,[mr("div",the,[mr("img",{src:($=Rn(t))==null?void 0:$.imageUrl,alt:""},null,8,ihe)]),mr("div",rhe,[mr("div",nhe,ms((te=Rn(t))==null?void 0:te.name),1),mr("div",she,ms((Q=Rn(t))==null?void 0:Q.date.toLocaleDateString()),1),mr("div",{class:"description",innerHTML:(de=Rn(t))==null?void 0:de.description},null,8,ohe),(Ce=Rn(t))!=null&&Ce.maxParticipants?(Pr(),Qr("div",ahe,[U[0]||(U[0]=mr("md-icon",null,"person",-1)),ch(" "+ms(O.value)+"/"+ms((Fe=Rn(t))==null?void 0:Fe.maxParticipants),1)])):pu("",!0),Bs(LF,{"is-full":((Le=Rn(t))==null?void 0:Le.maxParticipants)!=null&&O.value>=Rn(t).maxParticipants,"user-already-joined":R.value,onJoin:E},null,8,["is-full","user-already-joined"]),Bs(kae,{"map-data":((Me=Rn(t))==null?void 0:Me.mapData)||[(at=Rn(t))==null?void 0:at.position.lon,(pt=Rn(t))==null?void 0:pt.position.lat],date:(me=Rn(t))==null?void 0:me.date},null,8,["map-data","date"]),(ye=Rn(t))!=null&&ye.date&&c(Rn(t).date)?(Pr(),Im(bce,{key:1,class:"weather",lat:Rn(t).position.lat,lon:Rn(t).position.lon,day:(Se=Rn(t))==null?void 0:Se.date},null,8,["lat","lon","day"])):pu("",!0),Bs(LF,{"is-full":((ke=Rn(t))==null?void 0:ke.maxParticipants)!=null&&O.value>=Rn(t).maxParticipants,"user-already-joined":R.value,onJoin:E},null,8,["is-full","user-already-joined"])])])}}}),che=cc(lhe,[["__scopeId","data-v-2390b86a"]]);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const uhe=ho`:host{--_container-height: var(--md-outlined-icon-button-container-height, 40px);--_container-width: var(--md-outlined-icon-button-container-width, 40px);--_disabled-icon-color: var(--md-outlined-icon-button-disabled-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-icon-opacity: var(--md-outlined-icon-button-disabled-icon-opacity, 0.38);--_disabled-selected-container-color: var(--md-outlined-icon-button-disabled-selected-container-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-selected-container-opacity: var(--md-outlined-icon-button-disabled-selected-container-opacity, 0.12);--_hover-state-layer-opacity: var(--md-outlined-icon-button-hover-state-layer-opacity, 0.08);--_icon-size: var(--md-outlined-icon-button-icon-size, 24px);--_pressed-state-layer-opacity: var(--md-outlined-icon-button-pressed-state-layer-opacity, 0.12);--_selected-container-color: var(--md-outlined-icon-button-selected-container-color, var(--md-sys-color-inverse-surface, #322f35));--_selected-focus-icon-color: var(--md-outlined-icon-button-selected-focus-icon-color, var(--md-sys-color-inverse-on-surface, #f5eff7));--_selected-hover-icon-color: var(--md-outlined-icon-button-selected-hover-icon-color, var(--md-sys-color-inverse-on-surface, #f5eff7));--_selected-hover-state-layer-color: var(--md-outlined-icon-button-selected-hover-state-layer-color, var(--md-sys-color-inverse-on-surface, #f5eff7));--_selected-icon-color: var(--md-outlined-icon-button-selected-icon-color, var(--md-sys-color-inverse-on-surface, #f5eff7));--_selected-pressed-icon-color: var(--md-outlined-icon-button-selected-pressed-icon-color, var(--md-sys-color-inverse-on-surface, #f5eff7));--_selected-pressed-state-layer-color: var(--md-outlined-icon-button-selected-pressed-state-layer-color, var(--md-sys-color-inverse-on-surface, #f5eff7));--_disabled-outline-color: var(--md-outlined-icon-button-disabled-outline-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-outline-opacity: var(--md-outlined-icon-button-disabled-outline-opacity, 0.12);--_focus-icon-color: var(--md-outlined-icon-button-focus-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-icon-color: var(--md-outlined-icon-button-hover-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-state-layer-color: var(--md-outlined-icon-button-hover-state-layer-color, var(--md-sys-color-on-surface-variant, #49454f));--_icon-color: var(--md-outlined-icon-button-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_outline-color: var(--md-outlined-icon-button-outline-color, var(--md-sys-color-outline, #79747e));--_outline-width: var(--md-outlined-icon-button-outline-width, 1px);--_pressed-icon-color: var(--md-outlined-icon-button-pressed-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_pressed-state-layer-color: var(--md-outlined-icon-button-pressed-state-layer-color, var(--md-sys-color-on-surface, #1d1b20));--_container-shape-start-start: var(--md-outlined-icon-button-container-shape-start-start, var(--md-outlined-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-start-end: var(--md-outlined-icon-button-container-shape-start-end, var(--md-outlined-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-end: var(--md-outlined-icon-button-container-shape-end-end, var(--md-outlined-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-start: var(--md-outlined-icon-button-container-shape-end-start, var(--md-outlined-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)))}.outlined{background-color:rgba(0,0,0,0);color:var(--_icon-color);--md-ripple-hover-color: var(--_hover-state-layer-color);--md-ripple-hover-opacity: var(--_hover-state-layer-opacity);--md-ripple-pressed-color: var(--_pressed-state-layer-color);--md-ripple-pressed-opacity: var(--_pressed-state-layer-opacity)}.outlined::before{border-color:var(--_outline-color);border-width:var(--_outline-width)}.outlined:hover{color:var(--_hover-icon-color)}.outlined:focus{color:var(--_focus-icon-color)}.outlined:active{color:var(--_pressed-icon-color)}.outlined:disabled{color:var(--_disabled-icon-color)}.outlined:disabled::before{border-color:var(--_disabled-outline-color);opacity:var(--_disabled-outline-opacity)}.outlined:disabled .icon{opacity:var(--_disabled-icon-opacity)}.outlined::before{block-size:100%;border-style:solid;border-radius:inherit;box-sizing:border-box;content:"";inline-size:100%;inset:0;pointer-events:none;position:absolute;z-index:-1}.outlined.selected::before{border-width:0}.selected{--md-ripple-hover-color: var(--_selected-hover-state-layer-color);--md-ripple-hover-opacity: var(--_hover-state-layer-opacity);--md-ripple-pressed-color: var(--_selected-pressed-state-layer-color);--md-ripple-pressed-opacity: var(--_pressed-state-layer-opacity)}.selected:not(:disabled){color:var(--_selected-icon-color)}.selected:not(:disabled):hover{color:var(--_selected-hover-icon-color)}.selected:not(:disabled):focus{color:var(--_selected-focus-icon-color)}.selected:not(:disabled):active{color:var(--_selected-pressed-icon-color)}.selected:not(:disabled)::before{background-color:var(--_selected-container-color)}.selected:disabled::before{background-color:var(--_disabled-selected-container-color);opacity:var(--_disabled-selected-container-opacity)}@media(forced-colors: active){:host([disabled]){--_disabled-outline-opacity: 1}.selected::before{border-color:CanvasText;border-width:var(--_outline-width)}.selected:disabled::before{border-color:GrayText;opacity:1}}
`;/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let q4=class extends ra{getRenderClasses(){return{...super.getRenderClasses(),outlined:!0}}};q4.styles=[DE,uhe];q4=Nt([Xa("md-outlined-icon-button")],q4);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const hhe=ho`:host{--_container-color: var(--md-filled-icon-button-container-color, var(--md-sys-color-primary, #6750a4));--_container-height: var(--md-filled-icon-button-container-height, 40px);--_container-width: var(--md-filled-icon-button-container-width, 40px);--_disabled-container-color: var(--md-filled-icon-button-disabled-container-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-container-opacity: var(--md-filled-icon-button-disabled-container-opacity, 0.12);--_disabled-icon-color: var(--md-filled-icon-button-disabled-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-icon-opacity: var(--md-filled-icon-button-disabled-icon-opacity, 0.38);--_focus-icon-color: var(--md-filled-icon-button-focus-icon-color, var(--md-sys-color-on-primary, #fff));--_hover-icon-color: var(--md-filled-icon-button-hover-icon-color, var(--md-sys-color-on-primary, #fff));--_hover-state-layer-color: var(--md-filled-icon-button-hover-state-layer-color, var(--md-sys-color-on-primary, #fff));--_hover-state-layer-opacity: var(--md-filled-icon-button-hover-state-layer-opacity, 0.08);--_icon-color: var(--md-filled-icon-button-icon-color, var(--md-sys-color-on-primary, #fff));--_icon-size: var(--md-filled-icon-button-icon-size, 24px);--_pressed-icon-color: var(--md-filled-icon-button-pressed-icon-color, var(--md-sys-color-on-primary, #fff));--_pressed-state-layer-color: var(--md-filled-icon-button-pressed-state-layer-color, var(--md-sys-color-on-primary, #fff));--_pressed-state-layer-opacity: var(--md-filled-icon-button-pressed-state-layer-opacity, 0.12);--_selected-container-color: var(--md-filled-icon-button-selected-container-color, var(--md-sys-color-primary, #6750a4));--_toggle-selected-focus-icon-color: var(--md-filled-icon-button-toggle-selected-focus-icon-color, var(--md-sys-color-on-primary, #fff));--_toggle-selected-hover-icon-color: var(--md-filled-icon-button-toggle-selected-hover-icon-color, var(--md-sys-color-on-primary, #fff));--_toggle-selected-hover-state-layer-color: var(--md-filled-icon-button-toggle-selected-hover-state-layer-color, var(--md-sys-color-on-primary, #fff));--_toggle-selected-icon-color: var(--md-filled-icon-button-toggle-selected-icon-color, var(--md-sys-color-on-primary, #fff));--_toggle-selected-pressed-icon-color: var(--md-filled-icon-button-toggle-selected-pressed-icon-color, var(--md-sys-color-on-primary, #fff));--_toggle-selected-pressed-state-layer-color: var(--md-filled-icon-button-toggle-selected-pressed-state-layer-color, var(--md-sys-color-on-primary, #fff));--_unselected-container-color: var(--md-filled-icon-button-unselected-container-color, var(--md-sys-color-surface-container-highest, #e6e0e9));--_toggle-focus-icon-color: var(--md-filled-icon-button-toggle-focus-icon-color, var(--md-sys-color-primary, #6750a4));--_toggle-hover-icon-color: var(--md-filled-icon-button-toggle-hover-icon-color, var(--md-sys-color-primary, #6750a4));--_toggle-hover-state-layer-color: var(--md-filled-icon-button-toggle-hover-state-layer-color, var(--md-sys-color-primary, #6750a4));--_toggle-icon-color: var(--md-filled-icon-button-toggle-icon-color, var(--md-sys-color-primary, #6750a4));--_toggle-pressed-icon-color: var(--md-filled-icon-button-toggle-pressed-icon-color, var(--md-sys-color-primary, #6750a4));--_toggle-pressed-state-layer-color: var(--md-filled-icon-button-toggle-pressed-state-layer-color, var(--md-sys-color-primary, #6750a4));--_container-shape-start-start: var(--md-filled-icon-button-container-shape-start-start, var(--md-filled-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-start-end: var(--md-filled-icon-button-container-shape-start-end, var(--md-filled-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-end: var(--md-filled-icon-button-container-shape-end-end, var(--md-filled-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-start: var(--md-filled-icon-button-container-shape-end-start, var(--md-filled-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)))}.icon-button{color:var(--_icon-color);--md-ripple-hover-color: var(--_hover-state-layer-color);--md-ripple-hover-opacity: var(--_hover-state-layer-opacity);--md-ripple-pressed-color: var(--_pressed-state-layer-color);--md-ripple-pressed-opacity: var(--_pressed-state-layer-opacity)}.icon-button:hover{color:var(--_hover-icon-color)}.icon-button:focus{color:var(--_focus-icon-color)}.icon-button:active{color:var(--_pressed-icon-color)}.icon-button:disabled{color:var(--_disabled-icon-color)}.icon-button::before{background-color:var(--_container-color);border-radius:inherit;content:"";inset:0;position:absolute;z-index:-1}.icon-button:disabled::before{background-color:var(--_disabled-container-color);opacity:var(--_disabled-container-opacity)}.icon-button:disabled .icon{opacity:var(--_disabled-icon-opacity)}.toggle-filled{--md-ripple-hover-color: var(--_toggle-hover-state-layer-color);--md-ripple-pressed-color: var(--_toggle-pressed-state-layer-color)}.toggle-filled:not(:disabled){color:var(--_toggle-icon-color)}.toggle-filled:not(:disabled):hover{color:var(--_toggle-hover-icon-color)}.toggle-filled:not(:disabled):focus{color:var(--_toggle-focus-icon-color)}.toggle-filled:not(:disabled):active{color:var(--_toggle-pressed-icon-color)}.toggle-filled:not(:disabled)::before{background-color:var(--_unselected-container-color)}.selected{--md-ripple-hover-color: var(--_toggle-selected-hover-state-layer-color);--md-ripple-pressed-color: var(--_toggle-selected-pressed-state-layer-color)}.selected:not(:disabled){color:var(--_toggle-selected-icon-color)}.selected:not(:disabled):hover{color:var(--_toggle-selected-hover-icon-color)}.selected:not(:disabled):focus{color:var(--_toggle-selected-focus-icon-color)}.selected:not(:disabled):active{color:var(--_toggle-selected-pressed-icon-color)}.selected:not(:disabled)::before{background-color:var(--_selected-container-color)}
`;/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let W4=class extends ra{getRenderClasses(){return{...super.getRenderClasses(),filled:!0,"toggle-filled":this.toggle}}};W4.styles=[DE,hhe];W4=Nt([Xa("md-filled-icon-button")],W4);const dhe={class:"time-range-selector"},fhe={class:"time-ranges"},phe=["onClick"],mhe={key:0,class:"new-time-form"},_he={class:"inputs"},ghe={class:"input-container"},yhe={class:"input-container"},vhe=["disabled"],xhe=wa({__name:"TimeRangeSelector",emits:["editTimeRanges"],setup(r,{emit:e}){const t=Qn(!1),o=e,c=Qn([]),f=Qn({start:"",end:""});function y(){s()||(c.value.push(f.value),o("editTimeRanges",c.value),t.value=!1,f.value={start:"",end:""})}function s(){return f.value.start.length===0||f.value.end.length===0}function E(R){c.value.splice(R,1)}return(R,O)=>(Pr(),Qr("div",dhe,[mr("div",fhe,[(Pr(!0),Qr(Po,null,Em(c.value,(A,U)=>(Pr(),Qr("div",{class:"time-range",onClick:()=>E(U)},[ch(ms(A.start)+" - "+ms(A.end)+" ",1),O[3]||(O[3]=mr("md-ripple",null,null,-1))],8,phe))),256))]),mr("md-outlined-icon-button",{onClick:O[0]||(O[0]=A=>t.value=!t.value)},[mr("md-icon",null,ms(t.value?"close":"add"),1)]),t.value?(Pr(),Qr("div",mhe,[mr("div",_he,[mr("div",ghe,[O[4]||(O[4]=mr("label",{for:"start"},"Ora di inizio",-1)),u0(mr("md-outlined-text-field",{type:"time",name:"start","onUpdate:modelValue":O[1]||(O[1]=A=>f.value.start=A)},null,512),[[d0,f.value.start]])]),mr("div",yhe,[O[5]||(O[5]=mr("label",{for:"end"},"Ora di fine",-1)),u0(mr("md-outlined-text-field",{type:"time",name:"end","onUpdate:modelValue":O[2]||(O[2]=A=>f.value.end=A)},null,512),[[d0,f.value.end]])])]),mr("md-filled-icon-button",{onClick:y,disabled:s()},[...O[6]||(O[6]=[mr("md-icon",null," check ",-1)])],8,vhe)])):pu("",!0)]))}}),w7=cc(xhe,[["__scopeId","data-v-e3650ea4"]]);var T7=(r=>(r[r.Domenica=0]="Domenica",r[r.Lunedì=1]="Lunedì",r[r.Martedì=2]="Martedì",r[r.Mercoledì=3]="Mercoledì",r[r.Giovedì=4]="Giovedì",r[r.Venerdì=5]="Venerdì",r[r.Sabato=6]="Sabato",r))(T7||{});const bhe={class:"dayofweek-selector"},whe={class:"days"},The=["onClick"],Ehe=wa({__name:"DayOfWeekSelector",props:{value:{}},setup(r){const e=r,t=Object.keys(T7).filter(c=>isNaN(Number(c)));function o(c){var y,s,E;const f=(y=e.value)==null?void 0:y.findIndex(R=>R===c);f!==-1?(s=e.value)==null||s.splice(f,1):(E=e.value)==null||E.push(c)}return(c,f)=>(Pr(),Qr("div",bhe,[mr("div",whe,[(Pr(!0),Qr(Po,null,Em(Rn(t),(y,s)=>{var E;return Pr(),Qr("div",{class:F0(["day",{selected:(E=e.value)==null?void 0:E.some(R=>R===s)}]),onClick:R=>o(s)},[f[0]||(f[0]=mr("md-ripple",null,null,-1)),ch(" "+ms(y),1)],10,The)}),256))])]))}}),Ihe=cc(Ehe,[["__scopeId","data-v-c0944ca1"]]);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class She extends xl{renderElevationOrOutline(){return Xr`<md-elevation part="elevation"></md-elevation>`}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ahe=ho`:host{--_container-color: var(--md-filled-button-container-color, var(--md-sys-color-primary, #6750a4));--_container-elevation: var(--md-filled-button-container-elevation, 0);--_container-height: var(--md-filled-button-container-height, 40px);--_container-shadow-color: var(--md-filled-button-container-shadow-color, var(--md-sys-color-shadow, #000));--_disabled-container-color: var(--md-filled-button-disabled-container-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-container-elevation: var(--md-filled-button-disabled-container-elevation, 0);--_disabled-container-opacity: var(--md-filled-button-disabled-container-opacity, 0.12);--_disabled-label-text-color: var(--md-filled-button-disabled-label-text-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-label-text-opacity: var(--md-filled-button-disabled-label-text-opacity, 0.38);--_focus-container-elevation: var(--md-filled-button-focus-container-elevation, 0);--_focus-label-text-color: var(--md-filled-button-focus-label-text-color, var(--md-sys-color-on-primary, #fff));--_hover-container-elevation: var(--md-filled-button-hover-container-elevation, 1);--_hover-label-text-color: var(--md-filled-button-hover-label-text-color, var(--md-sys-color-on-primary, #fff));--_hover-state-layer-color: var(--md-filled-button-hover-state-layer-color, var(--md-sys-color-on-primary, #fff));--_hover-state-layer-opacity: var(--md-filled-button-hover-state-layer-opacity, 0.08);--_label-text-color: var(--md-filled-button-label-text-color, var(--md-sys-color-on-primary, #fff));--_label-text-font: var(--md-filled-button-label-text-font, var(--md-sys-typescale-label-large-font, var(--md-ref-typeface-plain, Roboto)));--_label-text-line-height: var(--md-filled-button-label-text-line-height, var(--md-sys-typescale-label-large-line-height, 1.25rem));--_label-text-size: var(--md-filled-button-label-text-size, var(--md-sys-typescale-label-large-size, 0.875rem));--_label-text-weight: var(--md-filled-button-label-text-weight, var(--md-sys-typescale-label-large-weight, var(--md-ref-typeface-weight-medium, 500)));--_pressed-container-elevation: var(--md-filled-button-pressed-container-elevation, 0);--_pressed-label-text-color: var(--md-filled-button-pressed-label-text-color, var(--md-sys-color-on-primary, #fff));--_pressed-state-layer-color: var(--md-filled-button-pressed-state-layer-color, var(--md-sys-color-on-primary, #fff));--_pressed-state-layer-opacity: var(--md-filled-button-pressed-state-layer-opacity, 0.12);--_disabled-icon-color: var(--md-filled-button-disabled-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-icon-opacity: var(--md-filled-button-disabled-icon-opacity, 0.38);--_focus-icon-color: var(--md-filled-button-focus-icon-color, var(--md-sys-color-on-primary, #fff));--_hover-icon-color: var(--md-filled-button-hover-icon-color, var(--md-sys-color-on-primary, #fff));--_icon-color: var(--md-filled-button-icon-color, var(--md-sys-color-on-primary, #fff));--_icon-size: var(--md-filled-button-icon-size, 18px);--_pressed-icon-color: var(--md-filled-button-pressed-icon-color, var(--md-sys-color-on-primary, #fff));--_container-shape-start-start: var(--md-filled-button-container-shape-start-start, var(--md-filled-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-start-end: var(--md-filled-button-container-shape-start-end, var(--md-filled-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-end: var(--md-filled-button-container-shape-end-end, var(--md-filled-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-start: var(--md-filled-button-container-shape-end-start, var(--md-filled-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_leading-space: var(--md-filled-button-leading-space, 24px);--_trailing-space: var(--md-filled-button-trailing-space, 24px);--_with-leading-icon-leading-space: var(--md-filled-button-with-leading-icon-leading-space, 16px);--_with-leading-icon-trailing-space: var(--md-filled-button-with-leading-icon-trailing-space, 24px);--_with-trailing-icon-leading-space: var(--md-filled-button-with-trailing-icon-leading-space, 24px);--_with-trailing-icon-trailing-space: var(--md-filled-button-with-trailing-icon-trailing-space, 16px)}
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let X4=class extends She{};X4.styles=[JU,YU,Ahe];X4=Nt([Xa("md-filled-button")],X4);const Che={class:"add-event-view"},Rhe=["disabled"],Phe=wa({__name:"AddEventView",setup(r){const e=Qn({name:"",duration:null,daysConstraints:[],timeConstraints:[]}),t=fa(()=>e.value.name!=null&&e.value.name.length>0&&e.value.duration!=null&&e.value.duration>0),o=Qn();async function c(){try{o.value=!0,await Vne(M8(IP,"/groups/H4EW1no30JDBMpwpVr3W/events"),e.value),e.value={name:"",duration:null,daysConstraints:[],timeConstraints:[]},o.value=!1}catch(f){console.error(f)}}return(f,y)=>(Pr(),Qr("div",Che,[u0(mr("md-outlined-text-field",{class:"field",label:"Nome evento","onUpdate:modelValue":y[0]||(y[0]=s=>e.value.name=s)},null,512),[[d0,e.value.name]]),u0(mr("md-outlined-text-field",{class:"field",label:"Durata minima",type:"number","suffix-text":"h","onUpdate:modelValue":y[1]||(y[1]=s=>e.value.duration=s)},null,512),[[d0,e.value.duration]]),Bs(C0,{class:"field",label:"Aggiungi vincoli giornalieri"},{default:c0(()=>[Bs(Ihe,{value:e.value.daysConstraints},null,8,["value"])]),_:1}),Bs(C0,{class:"field",label:"Aggiungi vincoli orari"},{default:c0(()=>[Bs(w7,{onEditTimeRanges:y[2]||(y[2]=s=>e.value.timeConstraints=s)})]),_:1}),mr("md-filled-button",{class:"submit-button",onClick:c,disabled:!t.value||o.value},ms(o.value?"Carico...":"Aggiungi evento"),9,Rhe)]))}}),Mhe=cc(Phe,[["__scopeId","data-v-f8ca140f"]]),khe={class:"calendar-input"},Dhe=["min"],Lhe=wa({__name:"CalendarInput",emits:["selectDate"],setup(r,{emit:e}){const t=Qn(null),o=Qn(null),c=Qn(!0),f=e;function y(){s().showPicker()}const s=()=>{var A,U;return(U=(A=t.value)==null?void 0:A.shadowRoot)==null?void 0:U.childNodes[2].childNodes[2].childNodes[8].childNodes[3]};function E(){return R(new Date)}function R(A){const U=String(A.getDate()).padStart(2,"0"),$=String(A.getMonth()+1).padStart(2,"0");return`${A.getFullYear()}-${$}-${U}`}function O(A){f("selectDate",new Date(o.value))}return(A,U)=>(Pr(),Qr("div",khe,[u0(mr("md-outlined-text-field",{ref_key:"dateInputRef",ref:t,class:"date-input",type:"date",label:"Data",min:E(),"onUpdate:modelValue":U[0]||(U[0]=$=>o.value=$),onInput:O},null,40,Dhe),[[d0,o.value]]),c.value?(Pr(),Qr("md-filled-icon-button",{key:0,onClick:y},[...U[1]||(U[1]=[mr("md-icon",null," calendar_month ",-1)])])):pu("",!0)]))}}),Ohe=cc(Lhe,[["__scopeId","data-v-a4d5f47f"]]);/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const E7=Symbol("dispatchHooks");function Fhe(r,e){const t=r[E7];if(!t)throw new Error(`'${r.type}' event needs setupDispatchHooks().`);t.addEventListener("after",e)}const OF=new WeakMap;function zhe(r,...e){let t=OF.get(r);t||(t=new Set,OF.set(r,t));for(const o of e){if(t.has(o))continue;let c=!1;r.addEventListener(o,f=>{if(c)return;f.stopImmediatePropagation();const y=Reflect.construct(f.constructor,[f.type,f]),s=new EventTarget;y[E7]=s,c=!0;const E=r.dispatchEvent(y);c=!1,E||f.preventDefault(),s.dispatchEvent(new Event("after"))},{capture:!0}),t.add(o)}}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Nhe=WR(zE(X0(Uo)));class zd extends Nhe{constructor(){super(),this.selected=!1,this.icons=!1,this.showOnlySelectedIcon=!1,this.required=!1,this.value="on",this.addEventListener("click",e=>{!FE(e)||!this.input||(this.focus(),OE(this.input))}),zhe(this,"keydown"),this.addEventListener("keydown",e=>{Fhe(e,()=>{e.defaultPrevented||e.key!=="Enter"||this.disabled||!this.input||this.input.click()})})}render(){return Xr`
      <div class="switch ${Sl(this.getRenderClasses())}">
        <input
          id="switch"
          class="touch"
          type="checkbox"
          role="switch"
          aria-label=${this.ariaLabel||sr}
          ?checked=${this.selected}
          ?disabled=${this.disabled}
          ?required=${this.required}
          @input=${this.handleInput}
          @change=${this.handleChange} />

        <md-focus-ring part="focus-ring" for="switch"></md-focus-ring>
        <span class="track"> ${this.renderHandle()} </span>
      </div>
    `}getRenderClasses(){return{selected:this.selected,unselected:!this.selected,disabled:this.disabled}}renderHandle(){const e={"with-icon":this.showOnlySelectedIcon?this.selected:this.icons};return Xr`
      ${this.renderTouchTarget()}
      <span class="handle-container">
        <md-ripple for="switch" ?disabled="${this.disabled}"></md-ripple>
        <span class="handle ${Sl(e)}">
          ${this.shouldShowIcons()?this.renderIcons():Xr``}
        </span>
      </span>
    `}renderIcons(){return Xr`
      <div class="icons">
        ${this.renderOnIcon()}
        ${this.showOnlySelectedIcon?Xr``:this.renderOffIcon()}
      </div>
    `}renderOnIcon(){return Xr`
      <slot class="icon icon--on" name="on-icon">
        <svg viewBox="0 0 24 24">
          <path
            d="M9.55 18.2 3.65 12.3 5.275 10.675 9.55 14.95 18.725 5.775 20.35 7.4Z" />
        </svg>
      </slot>
    `}renderOffIcon(){return Xr`
      <slot class="icon icon--off" name="off-icon">
        <svg viewBox="0 0 24 24">
          <path
            d="M6.4 19.2 4.8 17.6 10.4 12 4.8 6.4 6.4 4.8 12 10.4 17.6 4.8 19.2 6.4 13.6 12 19.2 17.6 17.6 19.2 12 13.6Z" />
        </svg>
      </slot>
    `}renderTouchTarget(){return Xr`<span class="touch"></span>`}shouldShowIcons(){return this.icons||this.showOnlySelectedIcon}handleInput(e){const t=e.target;this.selected=t.checked}handleChange(e){px(this,e)}[_m](){return this.selected?this.value:null}[RT](){return String(this.selected)}formResetCallback(){this.selected=this.hasAttribute("selected")}formStateRestoreCallback(e){this.selected=e==="true"}[mx](){return new S9(()=>({checked:this.selected,required:this.required}))}[_x](){return this.input}}Km(zd);zd.shadowRootOptions={mode:"open",delegatesFocus:!0};Nt([Mi({type:Boolean})],zd.prototype,"selected",void 0);Nt([Mi({type:Boolean})],zd.prototype,"icons",void 0);Nt([Mi({type:Boolean,attribute:"show-only-selected-icon"})],zd.prototype,"showOnlySelectedIcon",void 0);Nt([Mi({type:Boolean})],zd.prototype,"required",void 0);Nt([Mi()],zd.prototype,"value",void 0);Nt([lc("input")],zd.prototype,"input",void 0);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Bhe=ho`@layer styles, hcm;@layer styles{:host{display:inline-flex;outline:none;vertical-align:top;-webkit-tap-highlight-color:rgba(0,0,0,0);cursor:pointer}:host([disabled]){cursor:default}:host([touch-target=wrapper]){margin:max(0px,(48px - var(--md-switch-track-height, 32px))/2) 0px}md-focus-ring{--md-focus-ring-shape-start-start: var(--md-switch-track-shape-start-start, var(--md-switch-track-shape, var(--md-sys-shape-corner-full, 9999px)));--md-focus-ring-shape-start-end: var(--md-switch-track-shape-start-end, var(--md-switch-track-shape, var(--md-sys-shape-corner-full, 9999px)));--md-focus-ring-shape-end-end: var(--md-switch-track-shape-end-end, var(--md-switch-track-shape, var(--md-sys-shape-corner-full, 9999px)));--md-focus-ring-shape-end-start: var(--md-switch-track-shape-end-start, var(--md-switch-track-shape, var(--md-sys-shape-corner-full, 9999px)))}.switch{align-items:center;display:inline-flex;flex-shrink:0;position:relative;width:var(--md-switch-track-width, 52px);height:var(--md-switch-track-height, 32px);border-start-start-radius:var(--md-switch-track-shape-start-start, var(--md-switch-track-shape, var(--md-sys-shape-corner-full, 9999px)));border-start-end-radius:var(--md-switch-track-shape-start-end, var(--md-switch-track-shape, var(--md-sys-shape-corner-full, 9999px)));border-end-end-radius:var(--md-switch-track-shape-end-end, var(--md-switch-track-shape, var(--md-sys-shape-corner-full, 9999px)));border-end-start-radius:var(--md-switch-track-shape-end-start, var(--md-switch-track-shape, var(--md-sys-shape-corner-full, 9999px)))}input{appearance:none;height:48px;outline:none;margin:0;position:absolute;width:100%;z-index:1;cursor:inherit}:host([touch-target=none]) input{display:none}}@layer styles{.track{position:absolute;width:100%;height:100%;box-sizing:border-box;border-radius:inherit;display:flex;justify-content:center;align-items:center}.track::before{content:"";display:flex;position:absolute;height:100%;width:100%;border-radius:inherit;box-sizing:border-box;transition-property:opacity,background-color;transition-timing-function:linear;transition-duration:67ms}.disabled .track{background-color:rgba(0,0,0,0);border-color:rgba(0,0,0,0)}.disabled .track::before,.disabled .track::after{transition:none;opacity:var(--md-switch-disabled-track-opacity, 0.12)}.disabled .track::before{background-clip:content-box}.selected .track::before{background-color:var(--md-switch-selected-track-color, var(--md-sys-color-primary, #6750a4))}.selected:hover .track::before{background-color:var(--md-switch-selected-hover-track-color, var(--md-sys-color-primary, #6750a4))}.selected:focus-within .track::before{background-color:var(--md-switch-selected-focus-track-color, var(--md-sys-color-primary, #6750a4))}.selected:active .track::before{background-color:var(--md-switch-selected-pressed-track-color, var(--md-sys-color-primary, #6750a4))}.selected.disabled .track{background-clip:border-box}.selected.disabled .track::before{background-color:var(--md-switch-disabled-selected-track-color, var(--md-sys-color-on-surface, #1d1b20))}.unselected .track::before{background-color:var(--md-switch-track-color, var(--md-sys-color-surface-container-highest, #e6e0e9));border-color:var(--md-switch-track-outline-color, var(--md-sys-color-outline, #79747e));border-style:solid;border-width:var(--md-switch-track-outline-width, 2px)}.unselected:hover .track::before{background-color:var(--md-switch-hover-track-color, var(--md-sys-color-surface-container-highest, #e6e0e9));border-color:var(--md-switch-hover-track-outline-color, var(--md-sys-color-outline, #79747e))}.unselected:focus-visible .track::before{background-color:var(--md-switch-focus-track-color, var(--md-sys-color-surface-container-highest, #e6e0e9));border-color:var(--md-switch-focus-track-outline-color, var(--md-sys-color-outline, #79747e))}.unselected:active .track::before{background-color:var(--md-switch-pressed-track-color, var(--md-sys-color-surface-container-highest, #e6e0e9));border-color:var(--md-switch-pressed-track-outline-color, var(--md-sys-color-outline, #79747e))}.unselected.disabled .track::before{background-color:var(--md-switch-disabled-track-color, var(--md-sys-color-surface-container-highest, #e6e0e9));border-color:var(--md-switch-disabled-track-outline-color, var(--md-sys-color-on-surface, #1d1b20))}}@layer hcm{@media(forced-colors: active){.selected .track::before{background:ButtonText;border-color:ButtonText}.disabled .track::before{border-color:GrayText;opacity:1}.disabled.selected .track::before{background:GrayText}}}@layer styles{.handle-container{display:flex;place-content:center;place-items:center;position:relative;transition:margin 300ms cubic-bezier(0.175, 0.885, 0.32, 1.275)}.selected .handle-container{margin-inline-start:calc(var(--md-switch-track-width, 52px) - var(--md-switch-track-height, 32px))}.unselected .handle-container{margin-inline-end:calc(var(--md-switch-track-width, 52px) - var(--md-switch-track-height, 32px))}.disabled .handle-container{transition:none}.handle{border-start-start-radius:var(--md-switch-handle-shape-start-start, var(--md-switch-handle-shape, var(--md-sys-shape-corner-full, 9999px)));border-start-end-radius:var(--md-switch-handle-shape-start-end, var(--md-switch-handle-shape, var(--md-sys-shape-corner-full, 9999px)));border-end-end-radius:var(--md-switch-handle-shape-end-end, var(--md-switch-handle-shape, var(--md-sys-shape-corner-full, 9999px)));border-end-start-radius:var(--md-switch-handle-shape-end-start, var(--md-switch-handle-shape, var(--md-sys-shape-corner-full, 9999px)));height:var(--md-switch-handle-height, 16px);width:var(--md-switch-handle-width, 16px);transform-origin:center;transition-property:height,width;transition-duration:250ms,250ms;transition-timing-function:cubic-bezier(0.2, 0, 0, 1),cubic-bezier(0.2, 0, 0, 1);z-index:0}.handle::before{content:"";display:flex;inset:0;position:absolute;border-radius:inherit;box-sizing:border-box;transition:background-color 67ms linear}.disabled .handle,.disabled .handle::before{transition:none}.selected .handle{height:var(--md-switch-selected-handle-height, 24px);width:var(--md-switch-selected-handle-width, 24px)}.handle.with-icon{height:var(--md-switch-with-icon-handle-height, 24px);width:var(--md-switch-with-icon-handle-width, 24px)}.selected:not(.disabled):active .handle,.unselected:not(.disabled):active .handle{height:var(--md-switch-pressed-handle-height, 28px);width:var(--md-switch-pressed-handle-width, 28px);transition-timing-function:linear;transition-duration:100ms}.selected .handle::before{background-color:var(--md-switch-selected-handle-color, var(--md-sys-color-on-primary, #fff))}.selected:hover .handle::before{background-color:var(--md-switch-selected-hover-handle-color, var(--md-sys-color-primary-container, #eaddff))}.selected:focus-within .handle::before{background-color:var(--md-switch-selected-focus-handle-color, var(--md-sys-color-primary-container, #eaddff))}.selected:active .handle::before{background-color:var(--md-switch-selected-pressed-handle-color, var(--md-sys-color-primary-container, #eaddff))}.selected.disabled .handle::before{background-color:var(--md-switch-disabled-selected-handle-color, var(--md-sys-color-surface, #fef7ff));opacity:var(--md-switch-disabled-selected-handle-opacity, 1)}.unselected .handle::before{background-color:var(--md-switch-handle-color, var(--md-sys-color-outline, #79747e))}.unselected:hover .handle::before{background-color:var(--md-switch-hover-handle-color, var(--md-sys-color-on-surface-variant, #49454f))}.unselected:focus-within .handle::before{background-color:var(--md-switch-focus-handle-color, var(--md-sys-color-on-surface-variant, #49454f))}.unselected:active .handle::before{background-color:var(--md-switch-pressed-handle-color, var(--md-sys-color-on-surface-variant, #49454f))}.unselected.disabled .handle::before{background-color:var(--md-switch-disabled-handle-color, var(--md-sys-color-on-surface, #1d1b20));opacity:var(--md-switch-disabled-handle-opacity, 0.38)}md-ripple{border-radius:var(--md-switch-state-layer-shape, var(--md-sys-shape-corner-full, 9999px));height:var(--md-switch-state-layer-size, 40px);inset:unset;width:var(--md-switch-state-layer-size, 40px)}.selected md-ripple{--md-ripple-hover-color: var(--md-switch-selected-hover-state-layer-color, var(--md-sys-color-primary, #6750a4));--md-ripple-pressed-color: var(--md-switch-selected-pressed-state-layer-color, var(--md-sys-color-primary, #6750a4));--md-ripple-hover-opacity: var(--md-switch-selected-hover-state-layer-opacity, 0.08);--md-ripple-pressed-opacity: var(--md-switch-selected-pressed-state-layer-opacity, 0.12)}.unselected md-ripple{--md-ripple-hover-color: var(--md-switch-hover-state-layer-color, var(--md-sys-color-on-surface, #1d1b20));--md-ripple-pressed-color: var(--md-switch-pressed-state-layer-color, var(--md-sys-color-on-surface, #1d1b20));--md-ripple-hover-opacity: var(--md-switch-hover-state-layer-opacity, 0.08);--md-ripple-pressed-opacity: var(--md-switch-pressed-state-layer-opacity, 0.12)}}@layer hcm{@media(forced-colors: active){.unselected .handle::before{background:ButtonText}.disabled .handle::before{opacity:1}.disabled.unselected .handle::before{background:GrayText}}}@layer styles{.icons{position:relative;height:100%;width:100%}.icon{position:absolute;inset:0;margin:auto;display:flex;align-items:center;justify-content:center;fill:currentColor;transition:fill 67ms linear,opacity 33ms linear,transform 167ms cubic-bezier(0.2, 0, 0, 1);opacity:0}.disabled .icon{transition:none}.selected .icon--on,.unselected .icon--off{opacity:1}.unselected .handle:not(.with-icon) .icon--on{transform:rotate(-45deg)}.icon--off{width:var(--md-switch-icon-size, 16px);height:var(--md-switch-icon-size, 16px);color:var(--md-switch-icon-color, var(--md-sys-color-surface-container-highest, #e6e0e9))}.unselected:hover .icon--off{color:var(--md-switch-hover-icon-color, var(--md-sys-color-surface-container-highest, #e6e0e9))}.unselected:focus-within .icon--off{color:var(--md-switch-focus-icon-color, var(--md-sys-color-surface-container-highest, #e6e0e9))}.unselected:active .icon--off{color:var(--md-switch-pressed-icon-color, var(--md-sys-color-surface-container-highest, #e6e0e9))}.unselected.disabled .icon--off{color:var(--md-switch-disabled-icon-color, var(--md-sys-color-surface-container-highest, #e6e0e9));opacity:var(--md-switch-disabled-icon-opacity, 0.38)}.icon--on{width:var(--md-switch-selected-icon-size, 16px);height:var(--md-switch-selected-icon-size, 16px);color:var(--md-switch-selected-icon-color, var(--md-sys-color-on-primary-container, #21005d))}.selected:hover .icon--on{color:var(--md-switch-selected-hover-icon-color, var(--md-sys-color-on-primary-container, #21005d))}.selected:focus-within .icon--on{color:var(--md-switch-selected-focus-icon-color, var(--md-sys-color-on-primary-container, #21005d))}.selected:active .icon--on{color:var(--md-switch-selected-pressed-icon-color, var(--md-sys-color-on-primary-container, #21005d))}.selected.disabled .icon--on{color:var(--md-switch-disabled-selected-icon-color, var(--md-sys-color-on-surface, #1d1b20));opacity:var(--md-switch-disabled-selected-icon-opacity, 0.38)}}@layer hcm{@media(forced-colors: active){.icon--off{fill:Canvas}.icon--on{fill:ButtonText}.disabled.unselected .icon--off,.disabled.selected .icon--on{opacity:1}.disabled .icon--on{fill:GrayText}}}
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Z4=class extends zd{};Z4.styles=[Bhe];Z4=Nt([Xa("md-switch")],Z4);function Vhe(r){const e=String(r.getDate()).padStart(2,"0"),t=String(r.getMonth()+1).padStart(2,"0");return`${r.getFullYear()}-${t}-${e}`}function Uhe(r,e){const[t,o]=r.split(":").map(Number),[c,f]=e.split(":").map(Number);return(c*60+f-(t*60+o))/60}const jhe={class:"availability-switch"},$he=["selected"],Ghe={class:"availability-label"},Hhe={class:"events field"},qhe={class:"event-select"},Whe=["checked","name","onChange"],Xhe=["for"],Zhe=["disabled"],Khe=wa({__name:"AvailabilitySelector",props:{events:{}},emits:["submitAvailability"],setup(r,{emit:e}){const t=r,o=Qn([]),c=Qn({timeRanges:[],isAvailable:!0,forEvents:[...t.events]}),f=e;fa(()=>c.value.day!=null);function y(A){const U=c.value.forEvents.findIndex($=>$.name===A.name);if(U===-1)c.value.forEvents.push(A);else{if(c.value.forEvents.length===1)return;c.value.forEvents.splice(U,1)}}function s(A){const U=A.getDay();let $=!0;for(const te of c.value.forEvents)te.daysConstraints.includes(U)||(console.error(`La data selezionata non è valida per l'evento ${te.name} che richiede il giorno ${te.daysConstraints}.`),$=!1);return $}function E(A){console.log(A);let U=!0;for(const $ of c.value.forEvents){const te=$.duration;A.some(de=>Uhe(de.start,de.end)>=te)||(o.value.push,console.error(`Nessun TimeRange valido per l'evento ${$.name} che richiede una durata di ${te} ore.`),U=!1)}return U}function R(A){s(A),c.value.day=A}function O(A){E(A),c.value.timeRanges=A}return(A,U)=>(Pr(),Qr("div",{class:F0(["availability-selector",{unavailability:!c.value.isAvailable}])},[mr("div",jhe,[U[2]||(U[2]=mr("label",{for:"switch"},"Disponibilità ",-1)),mr("md-switch",{name:"switch",selected:c.value.isAvailable,icons:"",onInput:U[0]||(U[0]=$=>c.value.isAvailable=!c.value.isAvailable)},null,40,$he)]),mr("div",Ghe,ms(c.value.isAvailable?"Potrei esserci: ":"Non sono disponibile: "),1),mr("div",Hhe,[U[3]||(U[3]=ch(" Per gli eventi: ",-1)),(Pr(!0),Qr(Po,null,Em(A.events,$=>(Pr(),Qr("div",qhe,[mr("md-checkbox",{checked:c.value.forEvents.some(te=>te.name===$.name),name:$.name.toLowerCase(),onChange:te=>y($)},null,40,Whe),mr("label",{for:$.name.toLowerCase()},ms($.name),9,Xhe)]))),256))]),Bs(Ohe,{class:"field",label:"Data",onSelectDate:R}),Bs(C0,{class:"field",label:"Aggiungi orari"},{default:c0(()=>[Bs(w7,{onEditTimeRanges:O})]),_:1}),Bs(C0,{class:"field",label:"Si ripete"}),mr("md-filled-button",{class:"submit-button",onClick:U[1]||(U[1]=$=>f("submitAvailability",c.value)),disabled:o.value.length>0},ms("Inserisci "+(c.value.isAvailable?"disponibilità":"non disponibilità")),9,Zhe)],2))}}),Yhe=cc(Khe,[["__scopeId","data-v-70e4e734"]]),Jhe={class:"change-user-availability-view"},Qhe={key:0,class:"no-availabilities"},ede={key:1,class:"availabilities"},tde={class:"availability"},ide=wa({__name:"ChangeUserAvailabilityView",setup(r){const e=Qn([]);Qn(!1);const t=Qn(!1),o=Tse(M8(IP,"/groups/H4EW1no30JDBMpwpVr3W/events"));async function c(){for(const s of e.value);}function f(s,E){const[R,O]=E.split(":").map(Number);return s.setHours(R,O),s}function y(s){if(s.day!=null){s.timeRanges.length===0&&s.timeRanges.push({start:"00:00",end:"23:59"});for(const E of s.timeRanges){const R=new Date(s.day);f(R,E.start);const O=new Date(s.day);f(R,E.end),e.value.push({isAvailable:s.isAvailable,startTime:R,endTime:O,forEvents:[]})}t.value=!1}}return(s,E)=>(Pr(),Qr("div",Jhe,[e.value.length===0?(Pr(),Qr("div",Qhe," Nessuna disponibilità inserita. Premi il bottone per aggiungerne ")):(Pr(),Qr("div",ede,[(Pr(!0),Qr(Po,null,Em(e.value,R=>(Pr(),Qr("div",tde,ms(Rn(Vhe)(R.startTime))+" "+ms(R.startTime.getTime())+" "+ms(R.endTime.getTime()),1))),256))])),t.value?pu("",!0):(Pr(),Qr("md-outlined-icon-button",{key:2,onClick:E[0]||(E[0]=R=>t.value=!0),class:"add-availability-button"},[...E[1]||(E[1]=[mr("md-icon",null," add ",-1)])])),t.value?(Pr(),Im(Yhe,{key:3,class:"new-availability",onSubmitAvailability:y,events:Rn(o)},null,8,["events"])):pu("",!0),e.value.length>0?(Pr(),Qr("md-filled-button",{key:4,class:"submit-button",onClick:c},ms("Salva "+e.value.length+" disponibilità"),1)):pu("",!0)]))}}),rde=cc(ide,[["__scopeId","data-v-8aac9b96"]]),I7=wX({history:QW("/"),routes:[{path:"/",name:"home",component:Loe},{path:"/add-event",name:"add-event",component:Mhe,meta:{requiresAuth:!0}},{path:"/availabilities",name:"availabilities",component:rde,meta:{requiresAuth:!0}},{path:"/login",name:"login",component:()=>xoe(()=>import("./LoginView-BYgse4pv.js"),__vite__mapDeps([0,1]))},{path:"/event/:id",name:"event",component:che,meta:{requiresAuth:!1}}]});I7.beforeEach(async r=>{if(r.meta.requiresAuth&&!await QJ())return{path:"/login",query:{redirect:r.fullPath}}});const GE=gW(goe);GE.use(bW());GE.use(I7);GE.use(Rse,{firebaseApp:b7,modules:[Ise()]});GE.mount("#app");export{cc as _,mr as a,ode as b,Qr as c,wa as d,pu as e,ade as f,cde as g,LC as h,Rn as i,Bs as j,ch as k,que as l,Pr as o,Qn as r,lde as s,ms as t,Cse as u,d0 as v,u0 as w};
