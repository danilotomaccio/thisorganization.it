const __vite__fileDeps=["assets/LoginView-CSoQNhzt.js","assets/LoginView-BU5Yypxo.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var _$=Object.defineProperty;var g$=(n,e,r)=>e in n?_$(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r;var Xc=(n,e,r)=>(g$(n,typeof e!="symbol"?e+"":e,r),r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const _ of d.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&s(_)}).observe(document,{childList:!0,subtree:!0});function r(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(c){if(c.ep)return;c.ep=!0;const d=r(c);fetch(c.href,d)}})();/**
* @vue/shared v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function BS(n,e){const r=new Set(n.split(","));return s=>r.has(s)}const Xn={},ig=[],zl=()=>{},y$=()=>!1,FT=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),VS=n=>n.startsWith("onUpdate:"),fo=Object.assign,US=(n,e)=>{const r=n.indexOf(e);r>-1&&n.splice(r,1)},v$=Object.prototype.hasOwnProperty,pn=(n,e)=>v$.call(n,e),Ri=Array.isArray,ng=n=>NT(n)==="[object Map]",XO=n=>NT(n)==="[object Set]",Ni=n=>typeof n=="function",Qs=n=>typeof n=="string",dm=n=>typeof n=="symbol",is=n=>n!==null&&typeof n=="object",YO=n=>(is(n)||Ni(n))&&Ni(n.then)&&Ni(n.catch),QO=Object.prototype.toString,NT=n=>QO.call(n),x$=n=>NT(n).slice(8,-1),KO=n=>NT(n)==="[object Object]",jS=n=>Qs(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,av=BS(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),BT=n=>{const e=Object.create(null);return r=>e[r]||(e[r]=n(r))},b$=/-(\w)/g,yg=BT(n=>n.replace(b$,(e,r)=>r?r.toUpperCase():"")),w$=/\B([A-Z])/g,qg=BT(n=>n.replace(w$,"-$1").toLowerCase()),JO=BT(n=>n.charAt(0).toUpperCase()+n.slice(1)),D4=BT(n=>n?`on${JO(n)}`:""),Zd=(n,e)=>!Object.is(n,e),cw=(n,e)=>{for(let r=0;r<n.length;r++)n[r](e)},ez=(n,e,r,s=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:s,value:r})},UA=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let M3;const tz=()=>M3||(M3=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function $S(n){if(Ri(n)){const e={};for(let r=0;r<n.length;r++){const s=n[r],c=Qs(s)?I$(s):$S(s);if(c)for(const d in c)e[d]=c[d]}return e}else if(Qs(n)||is(n))return n}const T$=/;(?![^(]*\))/g,E$=/:([^]+)/,A$=/\/\*[^]*?\*\//g;function I$(n){const e={};return n.replace(A$,"").split(T$).forEach(r=>{if(r){const s=r.split(E$);s.length>1&&(e[s[0].trim()]=s[1].trim())}}),e}function Hg(n){let e="";if(Qs(n))e=n;else if(Ri(n))for(let r=0;r<n.length;r++){const s=Hg(n[r]);s&&(e+=s+" ")}else if(is(n))for(const r in n)n[r]&&(e+=r+" ");return e.trim()}const S$="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",C$=BS(S$);function rz(n){return!!n||n===""}const Mn=n=>Qs(n)?n:n==null?"":Ri(n)||is(n)&&(n.toString===QO||!Ni(n.toString))?JSON.stringify(n,iz,2):String(n),iz=(n,e)=>e&&e.__v_isRef?iz(n,e.value):ng(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((r,[s,c],d)=>(r[L4(s,d)+" =>"]=c,r),{})}:XO(e)?{[`Set(${e.size})`]:[...e.values()].map(r=>L4(r))}:dm(e)?L4(e):is(e)&&!Ri(e)&&!KO(e)?String(e):e,L4=(n,e="")=>{var r;return dm(n)?`Symbol(${(r=n.description)!=null?r:e})`:n};/**
* @vue/reactivity v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let sl;class nz{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=sl,!e&&sl&&(this.index=(sl.scopes||(sl.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const r=sl;try{return sl=this,e()}finally{sl=r}}}on(){sl=this}off(){sl=this.parent}stop(e){if(this._active){let r,s;for(r=0,s=this.effects.length;r<s;r++)this.effects[r].stop();for(r=0,s=this.cleanups.length;r<s;r++)this.cleanups[r]();if(this.scopes)for(r=0,s=this.scopes.length;r<s;r++)this.scopes[r].stop(!0);if(!this.detached&&this.parent&&!e){const c=this.parent.scopes.pop();c&&c!==this&&(this.parent.scopes[this.index]=c,c.index=this.index)}this.parent=void 0,this._active=!1}}}function sz(n){return new nz(n)}function R$(n,e=sl){e&&e.active&&e.effects.push(n)}function oz(){return sl}function P$(n){sl&&sl.cleanups.push(n)}let Lp;class GS{constructor(e,r,s,c){this.fn=e,this.trigger=r,this.scheduler=s,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,R$(this,c)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,nf();for(let e=0;e<this._depsLength;e++){const r=this.deps[e];if(r.computed&&(M$(r.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),sf()}return this._dirtyLevel>=4}set dirty(e){this._dirtyLevel=e?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let e=Fd,r=Lp;try{return Fd=!0,Lp=this,this._runnings++,k3(this),this.fn()}finally{D3(this),this._runnings--,Lp=r,Fd=e}}stop(){this.active&&(k3(this),D3(this),this.onStop&&this.onStop(),this.active=!1)}}function M$(n){return n.value}function k3(n){n._trackId++,n._depsLength=0}function D3(n){if(n.deps.length>n._depsLength){for(let e=n._depsLength;e<n.deps.length;e++)az(n.deps[e],n);n.deps.length=n._depsLength}}function az(n,e){const r=n.get(e);r!==void 0&&e._trackId!==r&&(n.delete(e),n.size===0&&n.cleanup())}let Fd=!0,jA=0;const lz=[];function nf(){lz.push(Fd),Fd=!1}function sf(){const n=lz.pop();Fd=n===void 0?!0:n}function qS(){jA++}function HS(){for(jA--;!jA&&$A.length;)$A.shift()()}function cz(n,e,r){if(e.get(n)!==n._trackId){e.set(n,n._trackId);const s=n.deps[n._depsLength];s!==e?(s&&az(s,n),n.deps[n._depsLength++]=e):n._depsLength++}}const $A=[];function uz(n,e,r){qS();for(const s of n.keys()){let c;s._dirtyLevel<e&&(c??(c=n.get(s)===s._trackId))&&(s._shouldSchedule||(s._shouldSchedule=s._dirtyLevel===0),s._dirtyLevel=e),s._shouldSchedule&&(c??(c=n.get(s)===s._trackId))&&(s.trigger(),(!s._runnings||s.allowRecurse)&&s._dirtyLevel!==2&&(s._shouldSchedule=!1,s.scheduler&&$A.push(s.scheduler)))}HS()}const hz=(n,e)=>{const r=new Map;return r.cleanup=n,r.computed=e,r},GA=new WeakMap,Op=Symbol(""),qA=Symbol("");function Ga(n,e,r){if(Fd&&Lp){let s=GA.get(n);s||GA.set(n,s=new Map);let c=s.get(r);c||s.set(r,c=hz(()=>s.delete(r))),cz(Lp,c)}}function hh(n,e,r,s,c,d){const _=GA.get(n);if(!_)return;let x=[];if(e==="clear")x=[..._.values()];else if(r==="length"&&Ri(n)){const l=Number(s);_.forEach((S,D)=>{(D==="length"||!dm(D)&&D>=l)&&x.push(S)})}else switch(r!==void 0&&x.push(_.get(r)),e){case"add":Ri(n)?jS(r)&&x.push(_.get("length")):(x.push(_.get(Op)),ng(n)&&x.push(_.get(qA)));break;case"delete":Ri(n)||(x.push(_.get(Op)),ng(n)&&x.push(_.get(qA)));break;case"set":ng(n)&&x.push(_.get(Op));break}qS();for(const l of x)l&&uz(l,4);HS()}const k$=BS("__proto__,__v_isRef,__isVue"),dz=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(dm)),L3=D$();function D$(){const n={};return["includes","indexOf","lastIndexOf"].forEach(e=>{n[e]=function(...r){const s=Cn(this);for(let d=0,_=this.length;d<_;d++)Ga(s,"get",d+"");const c=s[e](...r);return c===-1||c===!1?s[e](...r.map(Cn)):c}}),["push","pop","shift","unshift","splice"].forEach(e=>{n[e]=function(...r){nf(),qS();const s=Cn(this)[e].apply(this,r);return HS(),sf(),s}}),n}function L$(n){dm(n)||(n=String(n));const e=Cn(this);return Ga(e,"has",n),e.hasOwnProperty(n)}class fz{constructor(e=!1,r=!1){this._isReadonly=e,this._isShallow=r}get(e,r,s){const c=this._isReadonly,d=this._isShallow;if(r==="__v_isReactive")return!c;if(r==="__v_isReadonly")return c;if(r==="__v_isShallow")return d;if(r==="__v_raw")return s===(c?d?W$:gz:d?_z:mz).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(s)?e:void 0;const _=Ri(e);if(!c){if(_&&pn(L3,r))return Reflect.get(L3,r,s);if(r==="hasOwnProperty")return L$}const x=Reflect.get(e,r,s);return(dm(r)?dz.has(r):k$(r))||(c||Ga(e,"get",r),d)?x:ya(x)?_&&jS(r)?x:x.value:is(x)?c?vz(x):UT(x):x}}class pz extends fz{constructor(e=!1){super(!1,e)}set(e,r,s,c){let d=e[r];if(!this._isShallow){const l=Bv(d);if(!Ow(s)&&!Bv(s)&&(d=Cn(d),s=Cn(s)),!Ri(e)&&ya(d)&&!ya(s))return l?!1:(d.value=s,!0)}const _=Ri(e)&&jS(r)?Number(r)<e.length:pn(e,r),x=Reflect.set(e,r,s,c);return e===Cn(c)&&(_?Zd(s,d)&&hh(e,"set",r,s):hh(e,"add",r,s)),x}deleteProperty(e,r){const s=pn(e,r);e[r];const c=Reflect.deleteProperty(e,r);return c&&s&&hh(e,"delete",r,void 0),c}has(e,r){const s=Reflect.has(e,r);return(!dm(r)||!dz.has(r))&&Ga(e,"has",r),s}ownKeys(e){return Ga(e,"iterate",Ri(e)?"length":Op),Reflect.ownKeys(e)}}class O$ extends fz{constructor(e=!1){super(!0,e)}set(e,r){return!0}deleteProperty(e,r){return!0}}const z$=new pz,F$=new O$,N$=new pz(!0);const WS=n=>n,VT=n=>Reflect.getPrototypeOf(n);function Ib(n,e,r=!1,s=!1){n=n.__v_raw;const c=Cn(n),d=Cn(e);r||(Zd(e,d)&&Ga(c,"get",e),Ga(c,"get",d));const{has:_}=VT(c),x=s?WS:r?YS:Vv;if(_.call(c,e))return x(n.get(e));if(_.call(c,d))return x(n.get(d));n!==c&&n.get(e)}function Sb(n,e=!1){const r=this.__v_raw,s=Cn(r),c=Cn(n);return e||(Zd(n,c)&&Ga(s,"has",n),Ga(s,"has",c)),n===c?r.has(n):r.has(n)||r.has(c)}function Cb(n,e=!1){return n=n.__v_raw,!e&&Ga(Cn(n),"iterate",Op),Reflect.get(n,"size",n)}function O3(n){n=Cn(n);const e=Cn(this);return VT(e).has.call(e,n)||(e.add(n),hh(e,"add",n,n)),this}function z3(n,e){e=Cn(e);const r=Cn(this),{has:s,get:c}=VT(r);let d=s.call(r,n);d||(n=Cn(n),d=s.call(r,n));const _=c.call(r,n);return r.set(n,e),d?Zd(e,_)&&hh(r,"set",n,e):hh(r,"add",n,e),this}function F3(n){const e=Cn(this),{has:r,get:s}=VT(e);let c=r.call(e,n);c||(n=Cn(n),c=r.call(e,n)),s&&s.call(e,n);const d=e.delete(n);return c&&hh(e,"delete",n,void 0),d}function N3(){const n=Cn(this),e=n.size!==0,r=n.clear();return e&&hh(n,"clear",void 0,void 0),r}function Rb(n,e){return function(s,c){const d=this,_=d.__v_raw,x=Cn(_),l=e?WS:n?YS:Vv;return!n&&Ga(x,"iterate",Op),_.forEach((S,D)=>s.call(c,l(S),l(D),d))}}function Pb(n,e,r){return function(...s){const c=this.__v_raw,d=Cn(c),_=ng(d),x=n==="entries"||n===Symbol.iterator&&_,l=n==="keys"&&_,S=c[n](...s),D=r?WS:e?YS:Vv;return!e&&Ga(d,"iterate",l?qA:Op),{next(){const{value:I,done:V}=S.next();return V?{value:I,done:V}:{value:x?[D(I[0]),D(I[1])]:D(I),done:V}},[Symbol.iterator](){return this}}}}function gd(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function B$(){const n={get(d){return Ib(this,d)},get size(){return Cb(this)},has:Sb,add:O3,set:z3,delete:F3,clear:N3,forEach:Rb(!1,!1)},e={get(d){return Ib(this,d,!1,!0)},get size(){return Cb(this)},has:Sb,add:O3,set:z3,delete:F3,clear:N3,forEach:Rb(!1,!0)},r={get(d){return Ib(this,d,!0)},get size(){return Cb(this,!0)},has(d){return Sb.call(this,d,!0)},add:gd("add"),set:gd("set"),delete:gd("delete"),clear:gd("clear"),forEach:Rb(!0,!1)},s={get(d){return Ib(this,d,!0,!0)},get size(){return Cb(this,!0)},has(d){return Sb.call(this,d,!0)},add:gd("add"),set:gd("set"),delete:gd("delete"),clear:gd("clear"),forEach:Rb(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(d=>{n[d]=Pb(d,!1,!1),r[d]=Pb(d,!0,!1),e[d]=Pb(d,!1,!0),s[d]=Pb(d,!0,!0)}),[n,r,e,s]}const[V$,U$,j$,$$]=B$();function ZS(n,e){const r=e?n?$$:j$:n?U$:V$;return(s,c,d)=>c==="__v_isReactive"?!n:c==="__v_isReadonly"?n:c==="__v_raw"?s:Reflect.get(pn(r,c)&&c in s?r:s,c,d)}const G$={get:ZS(!1,!1)},q$={get:ZS(!1,!0)},H$={get:ZS(!0,!1)};const mz=new WeakMap,_z=new WeakMap,gz=new WeakMap,W$=new WeakMap;function Z$(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function X$(n){return n.__v_skip||!Object.isExtensible(n)?0:Z$(x$(n))}function UT(n){return Bv(n)?n:XS(n,!1,z$,G$,mz)}function yz(n){return XS(n,!1,N$,q$,_z)}function vz(n){return XS(n,!0,F$,H$,gz)}function XS(n,e,r,s,c){if(!is(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const d=c.get(n);if(d)return d;const _=X$(n);if(_===0)return n;const x=new Proxy(n,_===2?s:r);return c.set(n,x),x}function lv(n){return Bv(n)?lv(n.__v_raw):!!(n&&n.__v_isReactive)}function Bv(n){return!!(n&&n.__v_isReadonly)}function Ow(n){return!!(n&&n.__v_isShallow)}function xz(n){return n?!!n.__v_raw:!1}function Cn(n){const e=n&&n.__v_raw;return e?Cn(e):n}function bz(n){return Object.isExtensible(n)&&ez(n,"__v_skip",!0),n}const Vv=n=>is(n)?UT(n):n,YS=n=>is(n)?vz(n):n;class wz{constructor(e,r,s,c){this.getter=e,this._setter=r,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new GS(()=>e(this._value),()=>uw(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!c,this.__v_isReadonly=s}get value(){const e=Cn(this);return(!e._cacheable||e.effect.dirty)&&Zd(e._value,e._value=e.effect.run())&&uw(e,4),Tz(e),e.effect._dirtyLevel>=2&&uw(e,2),e._value}set value(e){this._setter(e)}get _dirty(){return this.effect.dirty}set _dirty(e){this.effect.dirty=e}}function Y$(n,e,r=!1){let s,c;const d=Ni(n);return d?(s=n,c=zl):(s=n.get,c=n.set),new wz(s,c,d||!c,r)}function Tz(n){var e;Fd&&Lp&&(n=Cn(n),cz(Lp,(e=n.dep)!=null?e:n.dep=hz(()=>n.dep=void 0,n instanceof wz?n:void 0)))}function uw(n,e=4,r){n=Cn(n);const s=n.dep;s&&uz(s,e)}function ya(n){return!!(n&&n.__v_isRef===!0)}function mn(n){return Az(n,!1)}function Ez(n){return Az(n,!0)}function Az(n,e){return ya(n)?n:new Q$(n,e)}class Q${constructor(e,r){this.__v_isShallow=r,this.dep=void 0,this.__v_isRef=!0,this._rawValue=r?e:Cn(e),this._value=r?e:Vv(e)}get value(){return Tz(this),this._value}set value(e){const r=this.__v_isShallow||Ow(e)||Bv(e);e=r?e:Cn(e),Zd(e,this._rawValue)&&(this._rawValue=e,this._value=r?e:Vv(e),uw(this,4))}}function Hi(n){return ya(n)?n.value:n}function th(n){return Ni(n)?n():Hi(n)}const K$={get:(n,e,r)=>Hi(Reflect.get(n,e,r)),set:(n,e,r,s)=>{const c=n[e];return ya(c)&&!ya(r)?(c.value=r,!0):Reflect.set(n,e,r,s)}};function Iz(n){return lv(n)?n:new Proxy(n,K$)}/**
* @vue/runtime-core v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Nd(n,e,r,s){try{return s?n(...s):n()}catch(c){jT(c,e,r)}}function wc(n,e,r,s){if(Ni(n)){const c=Nd(n,e,r,s);return c&&YO(c)&&c.catch(d=>{jT(d,e,r)}),c}if(Ri(n)){const c=[];for(let d=0;d<n.length;d++)c.push(wc(n[d],e,r,s));return c}}function jT(n,e,r,s=!0){const c=e?e.vnode:null;if(e){let d=e.parent;const _=e.proxy,x=`https://vuejs.org/error-reference/#runtime-${r}`;for(;d;){const S=d.ec;if(S){for(let D=0;D<S.length;D++)if(S[D](n,_,x)===!1)return}d=d.parent}const l=e.appContext.config.errorHandler;if(l){nf(),Nd(l,null,10,[n,_,x]),sf();return}}J$(n,r,c,s)}function J$(n,e,r,s=!0){console.error(n)}let Uv=!1,HA=!1;const Wo=[];let eu=0;const sg=[];let wd=null,Ap=0;const Sz=Promise.resolve();let QS=null;function KS(n){const e=QS||Sz;return n?e.then(this?n.bind(this):n):e}function eG(n){let e=eu+1,r=Wo.length;for(;e<r;){const s=e+r>>>1,c=Wo[s],d=jv(c);d<n||d===n&&c.pre?e=s+1:r=s}return e}function JS(n){(!Wo.length||!Wo.includes(n,Uv&&n.allowRecurse?eu+1:eu))&&(n.id==null?Wo.push(n):Wo.splice(eG(n.id),0,n),Cz())}function Cz(){!Uv&&!HA&&(HA=!0,QS=Sz.then(Pz))}function tG(n){const e=Wo.indexOf(n);e>eu&&Wo.splice(e,1)}function rG(n){Ri(n)?sg.push(...n):(!wd||!wd.includes(n,n.allowRecurse?Ap+1:Ap))&&sg.push(n),Cz()}function B3(n,e,r=Uv?eu+1:0){for(;r<Wo.length;r++){const s=Wo[r];if(s&&s.pre){if(n&&s.id!==n.uid)continue;Wo.splice(r,1),r--,s()}}}function Rz(n){if(sg.length){const e=[...new Set(sg)].sort((r,s)=>jv(r)-jv(s));if(sg.length=0,wd){wd.push(...e);return}for(wd=e,Ap=0;Ap<wd.length;Ap++)wd[Ap]();wd=null,Ap=0}}const jv=n=>n.id==null?1/0:n.id,iG=(n,e)=>{const r=jv(n)-jv(e);if(r===0){if(n.pre&&!e.pre)return-1;if(e.pre&&!n.pre)return 1}return r};function Pz(n){HA=!1,Uv=!0,Wo.sort(iG);try{for(eu=0;eu<Wo.length;eu++){const e=Wo[eu];e&&e.active!==!1&&Nd(e,null,14)}}finally{eu=0,Wo.length=0,Rz(),Uv=!1,QS=null,(Wo.length||sg.length)&&Pz()}}function nG(n,e,...r){if(n.isUnmounted)return;const s=n.vnode.props||Xn;let c=r;const d=e.startsWith("update:"),_=d&&e.slice(7);if(_&&_ in s){const D=`${_==="modelValue"?"model":_}Modifiers`,{number:I,trim:V}=s[D]||Xn;V&&(c=r.map(j=>Qs(j)?j.trim():j)),I&&(c=r.map(UA))}let x,l=s[x=D4(e)]||s[x=D4(yg(e))];!l&&d&&(l=s[x=D4(qg(e))]),l&&wc(l,n,6,c);const S=s[x+"Once"];if(S){if(!n.emitted)n.emitted={};else if(n.emitted[x])return;n.emitted[x]=!0,wc(S,n,6,c)}}function Mz(n,e,r=!1){const s=e.emitsCache,c=s.get(n);if(c!==void 0)return c;const d=n.emits;let _={},x=!1;if(!Ni(n)){const l=S=>{const D=Mz(S,e,!0);D&&(x=!0,fo(_,D))};!r&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!d&&!x?(is(n)&&s.set(n,null),null):(Ri(d)?d.forEach(l=>_[l]=null):fo(_,d),is(n)&&s.set(n,_),_)}function $T(n,e){return!n||!FT(e)?!1:(e=e.slice(2).replace(/Once$/,""),pn(n,e[0].toLowerCase()+e.slice(1))||pn(n,qg(e))||pn(n,e))}let ho=null,GT=null;function zw(n){const e=ho;return ho=n,GT=n&&n.type.__scopeId||null,e}function of(n){GT=n}function af(){GT=null}function vg(n,e=ho,r){if(!e||n._n)return n;const s=(...c)=>{s._d&&X3(-1);const d=zw(e);let _;try{_=n(...c)}finally{zw(d),s._d&&X3(1)}return _};return s._n=!0,s._c=!0,s._d=!0,s}function O4(n){const{type:e,vnode:r,proxy:s,withProxy:c,propsOptions:[d],slots:_,attrs:x,emit:l,render:S,renderCache:D,props:I,data:V,setupState:j,ctx:Q,inheritAttrs:te}=n,ce=zw(n);let Ce,Me;try{if(r.shapeFlag&4){const Te=c||s,Ge=Te;Ce=Jc(S.call(Ge,Te,D,I,j,V,Q)),Me=x}else{const Te=e;Ce=Jc(Te.length>1?Te(I,{attrs:x,slots:_,emit:l}):Te(I,null)),Me=e.props?x:sG(x)}}catch(Te){dv.length=0,jT(Te,n,1),Ce=kn(Xd)}let Ie=Ce;if(Me&&te!==!1){const Te=Object.keys(Me),{shapeFlag:Ge}=Ie;Te.length&&Ge&7&&(d&&Te.some(VS)&&(Me=oG(Me,d)),Ie=bg(Ie,Me,!1,!0))}return r.dirs&&(Ie=bg(Ie,null,!1,!0),Ie.dirs=Ie.dirs?Ie.dirs.concat(r.dirs):r.dirs),r.transition&&(Ie.transition=r.transition),Ce=Ie,zw(ce),Ce}const sG=n=>{let e;for(const r in n)(r==="class"||r==="style"||FT(r))&&((e||(e={}))[r]=n[r]);return e},oG=(n,e)=>{const r={};for(const s in n)(!VS(s)||!(s.slice(9)in e))&&(r[s]=n[s]);return r};function aG(n,e,r){const{props:s,children:c,component:d}=n,{props:_,children:x,patchFlag:l}=e,S=d.emitsOptions;if(e.dirs||e.transition)return!0;if(r&&l>=0){if(l&1024)return!0;if(l&16)return s?V3(s,_,S):!!_;if(l&8){const D=e.dynamicProps;for(let I=0;I<D.length;I++){const V=D[I];if(_[V]!==s[V]&&!$T(S,V))return!0}}}else return(c||x)&&(!x||!x.$stable)?!0:s===_?!1:s?_?V3(s,_,S):!0:!!_;return!1}function V3(n,e,r){const s=Object.keys(e);if(s.length!==Object.keys(n).length)return!0;for(let c=0;c<s.length;c++){const d=s[c];if(e[d]!==n[d]&&!$T(r,d))return!0}return!1}function lG({vnode:n,parent:e},r){for(;e;){const s=e.subTree;if(s.suspense&&s.suspense.activeBranch===n&&(s.el=n.el),s===n)(n=e.vnode).el=r,e=e.parent;else break}}const cG=Symbol.for("v-ndc"),uG=n=>n.__isSuspense;function hG(n,e){e&&e.pendingBranch?Ri(n)?e.effects.push(...n):e.effects.push(n):rG(n)}const dG=Symbol.for("v-scx"),fG=()=>Fa(dG),Mb={};function Bd(n,e,r){return kz(n,e,r)}function kz(n,e,{immediate:r,deep:s,flush:c,once:d,onTrack:_,onTrigger:x}=Xn){if(e&&d){const $e=e;e=(...ue)=>{$e(...ue),Ge()}}const l=Zo,S=$e=>s===!0?$e:Ip($e,s===!1?1:void 0);let D,I=!1,V=!1;if(ya(n)?(D=()=>n.value,I=Ow(n)):lv(n)?(D=()=>S(n),I=!0):Ri(n)?(V=!0,I=n.some($e=>lv($e)||Ow($e)),D=()=>n.map($e=>{if(ya($e))return $e.value;if(lv($e))return S($e);if(Ni($e))return Nd($e,l,2)})):Ni(n)?e?D=()=>Nd(n,l,2):D=()=>(j&&j(),wc(n,l,3,[Q])):D=zl,e&&s){const $e=D;D=()=>Ip($e())}let j,Q=$e=>{j=Ie.onStop=()=>{Nd($e,l,4),j=Ie.onStop=void 0}},te;if(WT)if(Q=zl,e?r&&wc(e,l,3,[D(),V?[]:void 0,Q]):D(),c==="sync"){const $e=fG();te=$e.__watcherHandles||($e.__watcherHandles=[])}else return zl;let ce=V?new Array(n.length).fill(Mb):Mb;const Ce=()=>{if(!(!Ie.active||!Ie.dirty))if(e){const $e=Ie.run();(s||I||(V?$e.some((ue,pe)=>Zd(ue,ce[pe])):Zd($e,ce)))&&(j&&j(),wc(e,l,3,[$e,ce===Mb?void 0:V&&ce[0]===Mb?[]:ce,Q]),ce=$e)}else Ie.run()};Ce.allowRecurse=!!e;let Me;c==="sync"?Me=Ce:c==="post"?Me=()=>La(Ce,l&&l.suspense):(Ce.pre=!0,l&&(Ce.id=l.uid),Me=()=>JS(Ce));const Ie=new GS(D,zl,Me),Te=oz(),Ge=()=>{Ie.stop(),Te&&US(Te.effects,Ie)};return e?r?Ce():ce=Ie.run():c==="post"?La(Ie.run.bind(Ie),l&&l.suspense):Ie.run(),te&&te.push(Ge),Ge}function pG(n,e,r){const s=this.proxy,c=Qs(n)?n.includes(".")?Dz(s,n):()=>s[n]:n.bind(s,s);let d;Ni(e)?d=e:(d=e.handler,r=e);const _=b1(this),x=kz(c,d.bind(s),r);return _(),x}function Dz(n,e){const r=e.split(".");return()=>{let s=n;for(let c=0;c<r.length&&s;c++)s=s[r[c]];return s}}function Ip(n,e=1/0,r){if(e<=0||!is(n)||n.__v_skip||(r=r||new Set,r.has(n)))return n;if(r.add(n),e--,ya(n))Ip(n.value,e,r);else if(Ri(n))for(let s=0;s<n.length;s++)Ip(n[s],e,r);else if(XO(n)||ng(n))n.forEach(s=>{Ip(s,e,r)});else if(KO(n))for(const s in n)Ip(n[s],e,r);return n}function xg(n,e){if(ho===null)return n;const r=ZT(ho)||ho.proxy,s=n.dirs||(n.dirs=[]);for(let c=0;c<e.length;c++){let[d,_,x,l=Xn]=e[c];d&&(Ni(d)&&(d={mounted:d,updated:d}),d.deep&&Ip(_),s.push({dir:d,instance:r,value:_,oldValue:void 0,arg:x,modifiers:l}))}return n}function mp(n,e,r,s){const c=n.dirs,d=e&&e.dirs;for(let _=0;_<c.length;_++){const x=c[_];d&&(x.oldValue=d[_].value);let l=x.dir[s];l&&(nf(),wc(l,r,8,[n.el,x,n,e]),sf())}}/*! #__NO_SIDE_EFFECTS__ */function Ro(n,e){return Ni(n)?fo({name:n.name},e,{setup:n}):n}const cv=n=>!!n.type.__asyncLoader,Lz=n=>n.type.__isKeepAlive;function mG(n,e){Oz(n,"a",e)}function _G(n,e){Oz(n,"da",e)}function Oz(n,e,r=Zo){const s=n.__wdc||(n.__wdc=()=>{let c=r;for(;c;){if(c.isDeactivated)return;c=c.parent}return n()});if(qT(e,s,r),r){let c=r.parent;for(;c&&c.parent;)Lz(c.parent.vnode)&&gG(s,e,r,c),c=c.parent}}function gG(n,e,r,s){const c=qT(e,n,s,!0);zz(()=>{US(s[e],c)},r)}function qT(n,e,r=Zo,s=!1){if(r){const c=r[n]||(r[n]=[]),d=e.__weh||(e.__weh=(..._)=>{if(r.isUnmounted)return;nf();const x=b1(r),l=wc(e,r,n,_);return x(),sf(),l});return s?c.unshift(d):c.push(d),d}}const xh=n=>(e,r=Zo)=>(!WT||n==="sp")&&qT(n,(...s)=>e(...s),r),yG=xh("bm"),eC=xh("m"),vG=xh("bu"),xG=xh("u"),bG=xh("bum"),zz=xh("um"),Fz=xh("sp"),wG=xh("rtg"),TG=xh("rtc");function EG(n,e=Zo){qT("ec",n,e)}function qp(n,e,r,s){let c;const d=r;if(Ri(n)||Qs(n)){c=new Array(n.length);for(let _=0,x=n.length;_<x;_++)c[_]=e(n[_],_,void 0,d)}else if(typeof n=="number"){c=new Array(n);for(let _=0;_<n;_++)c[_]=e(_+1,_,void 0,d)}else if(is(n))if(n[Symbol.iterator])c=Array.from(n,(_,x)=>e(_,x,void 0,d));else{const _=Object.keys(n);c=new Array(_.length);for(let x=0,l=_.length;x<l;x++){const S=_[x];c[x]=e(n[S],S,x,d)}}else c=[];return c}function AG(n,e,r={},s,c){if(ho.isCE||ho.parent&&cv(ho.parent)&&ho.parent.isCE)return kn("slot",r,s);let d=n[e];d&&d._c&&(d._d=!1),li();const _=d&&Nz(d(r)),x=Wg(Zs,{key:r.key||_&&_.key||`_${e}`},_||[],_&&n._===1?64:-2);return d&&d._c&&(d._d=!0),x}function Nz(n){return n.some(e=>Nw(e)?!(e.type===Xd||e.type===Zs&&!Nz(e.children)):!0)?n:null}const WA=n=>n?eF(n)?ZT(n)||n.proxy:WA(n.parent):null,uv=fo(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>WA(n.parent),$root:n=>WA(n.root),$emit:n=>n.emit,$options:n=>tC(n),$forceUpdate:n=>n.f||(n.f=()=>{n.effect.dirty=!0,JS(n.update)}),$nextTick:n=>n.n||(n.n=KS.bind(n.proxy)),$watch:n=>pG.bind(n)}),z4=(n,e)=>n!==Xn&&!n.__isScriptSetup&&pn(n,e),IG={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:r,setupState:s,data:c,props:d,accessCache:_,type:x,appContext:l}=n;let S;if(e[0]!=="$"){const j=_[e];if(j!==void 0)switch(j){case 1:return s[e];case 2:return c[e];case 4:return r[e];case 3:return d[e]}else{if(z4(s,e))return _[e]=1,s[e];if(c!==Xn&&pn(c,e))return _[e]=2,c[e];if((S=n.propsOptions[0])&&pn(S,e))return _[e]=3,d[e];if(r!==Xn&&pn(r,e))return _[e]=4,r[e];ZA&&(_[e]=0)}}const D=uv[e];let I,V;if(D)return e==="$attrs"&&Ga(n.attrs,"get",""),D(n);if((I=x.__cssModules)&&(I=I[e]))return I;if(r!==Xn&&pn(r,e))return _[e]=4,r[e];if(V=l.config.globalProperties,pn(V,e))return V[e]},set({_:n},e,r){const{data:s,setupState:c,ctx:d}=n;return z4(c,e)?(c[e]=r,!0):s!==Xn&&pn(s,e)?(s[e]=r,!0):pn(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(d[e]=r,!0)},has({_:{data:n,setupState:e,accessCache:r,ctx:s,appContext:c,propsOptions:d}},_){let x;return!!r[_]||n!==Xn&&pn(n,_)||z4(e,_)||(x=d[0])&&pn(x,_)||pn(s,_)||pn(uv,_)||pn(c.config.globalProperties,_)},defineProperty(n,e,r){return r.get!=null?n._.accessCache[e]=0:pn(r,"value")&&this.set(n,e,r.value,null),Reflect.defineProperty(n,e,r)}};function U3(n){return Ri(n)?n.reduce((e,r)=>(e[r]=null,e),{}):n}let ZA=!0;function SG(n){const e=tC(n),r=n.proxy,s=n.ctx;ZA=!1,e.beforeCreate&&j3(e.beforeCreate,n,"bc");const{data:c,computed:d,methods:_,watch:x,provide:l,inject:S,created:D,beforeMount:I,mounted:V,beforeUpdate:j,updated:Q,activated:te,deactivated:ce,beforeDestroy:Ce,beforeUnmount:Me,destroyed:Ie,unmounted:Te,render:Ge,renderTracked:$e,renderTriggered:ue,errorCaptured:pe,serverPrefetch:_e,expose:ge,inheritAttrs:Fe,components:De,directives:Se,filters:pr}=e;if(S&&CG(S,s,null),_)for(const Ht in _){const Kt=_[Ht];Ni(Kt)&&(s[Ht]=Kt.bind(r))}if(c){const Ht=c.call(r,r);is(Ht)&&(n.data=UT(Ht))}if(ZA=!0,d)for(const Ht in d){const Kt=d[Ht],Tr=Ni(Kt)?Kt.bind(r,r):Ni(Kt.get)?Kt.get.bind(r,r):zl,We=!Ni(Kt)&&Ni(Kt.set)?Kt.set.bind(r):zl,Sr=wo({get:Tr,set:We});Object.defineProperty(s,Ht,{enumerable:!0,configurable:!0,get:()=>Sr.value,set:Xt=>Sr.value=Xt})}if(x)for(const Ht in x)Bz(x[Ht],s,r,Ht);if(l){const Ht=Ni(l)?l.call(r):l;Reflect.ownKeys(Ht).forEach(Kt=>{hw(Kt,Ht[Kt])})}D&&j3(D,n,"c");function Vt(Ht,Kt){Ri(Kt)?Kt.forEach(Tr=>Ht(Tr.bind(r))):Kt&&Ht(Kt.bind(r))}if(Vt(yG,I),Vt(eC,V),Vt(vG,j),Vt(xG,Q),Vt(mG,te),Vt(_G,ce),Vt(EG,pe),Vt(TG,$e),Vt(wG,ue),Vt(bG,Me),Vt(zz,Te),Vt(Fz,_e),Ri(ge))if(ge.length){const Ht=n.exposed||(n.exposed={});ge.forEach(Kt=>{Object.defineProperty(Ht,Kt,{get:()=>r[Kt],set:Tr=>r[Kt]=Tr})})}else n.exposed||(n.exposed={});Ge&&n.render===zl&&(n.render=Ge),Fe!=null&&(n.inheritAttrs=Fe),De&&(n.components=De),Se&&(n.directives=Se)}function CG(n,e,r=zl){Ri(n)&&(n=XA(n));for(const s in n){const c=n[s];let d;is(c)?"default"in c?d=Fa(c.from||s,c.default,!0):d=Fa(c.from||s):d=Fa(c),ya(d)?Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:()=>d.value,set:_=>d.value=_}):e[s]=d}}function j3(n,e,r){wc(Ri(n)?n.map(s=>s.bind(e.proxy)):n.bind(e.proxy),e,r)}function Bz(n,e,r,s){const c=s.includes(".")?Dz(r,s):()=>r[s];if(Qs(n)){const d=e[n];Ni(d)&&Bd(c,d)}else if(Ni(n))Bd(c,n.bind(r));else if(is(n))if(Ri(n))n.forEach(d=>Bz(d,e,r,s));else{const d=Ni(n.handler)?n.handler.bind(r):e[n.handler];Ni(d)&&Bd(c,d,n)}}function tC(n){const e=n.type,{mixins:r,extends:s}=e,{mixins:c,optionsCache:d,config:{optionMergeStrategies:_}}=n.appContext,x=d.get(e);let l;return x?l=x:!c.length&&!r&&!s?l=e:(l={},c.length&&c.forEach(S=>Fw(l,S,_,!0)),Fw(l,e,_)),is(e)&&d.set(e,l),l}function Fw(n,e,r,s=!1){const{mixins:c,extends:d}=e;d&&Fw(n,d,r,!0),c&&c.forEach(_=>Fw(n,_,r,!0));for(const _ in e)if(!(s&&_==="expose")){const x=RG[_]||r&&r[_];n[_]=x?x(n[_],e[_]):e[_]}return n}const RG={data:$3,props:G3,emits:G3,methods:qy,computed:qy,beforeCreate:la,created:la,beforeMount:la,mounted:la,beforeUpdate:la,updated:la,beforeDestroy:la,beforeUnmount:la,destroyed:la,unmounted:la,activated:la,deactivated:la,errorCaptured:la,serverPrefetch:la,components:qy,directives:qy,watch:MG,provide:$3,inject:PG};function $3(n,e){return e?n?function(){return fo(Ni(n)?n.call(this,this):n,Ni(e)?e.call(this,this):e)}:e:n}function PG(n,e){return qy(XA(n),XA(e))}function XA(n){if(Ri(n)){const e={};for(let r=0;r<n.length;r++)e[n[r]]=n[r];return e}return n}function la(n,e){return n?[...new Set([].concat(n,e))]:e}function qy(n,e){return n?fo(Object.create(null),n,e):e}function G3(n,e){return n?Ri(n)&&Ri(e)?[...new Set([...n,...e])]:fo(Object.create(null),U3(n),U3(e??{})):e}function MG(n,e){if(!n)return e;if(!e)return n;const r=fo(Object.create(null),n);for(const s in e)r[s]=la(n[s],e[s]);return r}function Vz(){return{app:null,config:{isNativeTag:y$,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let kG=0;function DG(n,e){return function(s,c=null){Ni(s)||(s=fo({},s)),c!=null&&!is(c)&&(c=null);const d=Vz(),_=new WeakSet;let x=!1;const l=d.app={_uid:kG++,_component:s,_props:c,_container:null,_context:d,_instance:null,version:rq,get config(){return d.config},set config(S){},use(S,...D){return _.has(S)||(S&&Ni(S.install)?(_.add(S),S.install(l,...D)):Ni(S)&&(_.add(S),S(l,...D))),l},mixin(S){return d.mixins.includes(S)||d.mixins.push(S),l},component(S,D){return D?(d.components[S]=D,l):d.components[S]},directive(S,D){return D?(d.directives[S]=D,l):d.directives[S]},mount(S,D,I){if(!x){const V=kn(s,c);return V.appContext=d,I===!0?I="svg":I===!1&&(I=void 0),D&&e?e(V,S):n(V,S,I),x=!0,l._container=S,S.__vue_app__=l,ZT(V.component)||V.component.proxy}},unmount(){x&&(n(null,l._container),delete l._container.__vue_app__)},provide(S,D){return d.provides[S]=D,l},runWithContext(S){const D=hv;hv=l;try{return S()}finally{hv=D}}};return l}}let hv=null;function hw(n,e){if(Zo){let r=Zo.provides;const s=Zo.parent&&Zo.parent.provides;s===r&&(r=Zo.provides=Object.create(s)),r[n]=e}}function Fa(n,e,r=!1){const s=Zo||ho;if(s||hv){const c=s?s.parent==null?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides:hv._context.provides;if(c&&n in c)return c[n];if(arguments.length>1)return r&&Ni(e)?e.call(s&&s.proxy):e}}const Uz={},jz=()=>Object.create(Uz),$z=n=>Object.getPrototypeOf(n)===Uz;function LG(n,e,r,s=!1){const c={},d=jz();n.propsDefaults=Object.create(null),Gz(n,e,c,d);for(const _ in n.propsOptions[0])_ in c||(c[_]=void 0);r?n.props=s?c:yz(c):n.type.props?n.props=c:n.props=d,n.attrs=d}function OG(n,e,r,s){const{props:c,attrs:d,vnode:{patchFlag:_}}=n,x=Cn(c),[l]=n.propsOptions;let S=!1;if((s||_>0)&&!(_&16)){if(_&8){const D=n.vnode.dynamicProps;for(let I=0;I<D.length;I++){let V=D[I];if($T(n.emitsOptions,V))continue;const j=e[V];if(l)if(pn(d,V))j!==d[V]&&(d[V]=j,S=!0);else{const Q=yg(V);c[Q]=YA(l,x,Q,j,n,!1)}else j!==d[V]&&(d[V]=j,S=!0)}}}else{Gz(n,e,c,d)&&(S=!0);let D;for(const I in x)(!e||!pn(e,I)&&((D=qg(I))===I||!pn(e,D)))&&(l?r&&(r[I]!==void 0||r[D]!==void 0)&&(c[I]=YA(l,x,I,void 0,n,!0)):delete c[I]);if(d!==x)for(const I in d)(!e||!pn(e,I))&&(delete d[I],S=!0)}S&&hh(n.attrs,"set","")}function Gz(n,e,r,s){const[c,d]=n.propsOptions;let _=!1,x;if(e)for(let l in e){if(av(l))continue;const S=e[l];let D;c&&pn(c,D=yg(l))?!d||!d.includes(D)?r[D]=S:(x||(x={}))[D]=S:$T(n.emitsOptions,l)||(!(l in s)||S!==s[l])&&(s[l]=S,_=!0)}if(d){const l=Cn(r),S=x||Xn;for(let D=0;D<d.length;D++){const I=d[D];r[I]=YA(c,l,I,S[I],n,!pn(S,I))}}return _}function YA(n,e,r,s,c,d){const _=n[r];if(_!=null){const x=pn(_,"default");if(x&&s===void 0){const l=_.default;if(_.type!==Function&&!_.skipFactory&&Ni(l)){const{propsDefaults:S}=c;if(r in S)s=S[r];else{const D=b1(c);s=S[r]=l.call(null,e),D()}}else s=l}_[0]&&(d&&!x?s=!1:_[1]&&(s===""||s===qg(r))&&(s=!0))}return s}function qz(n,e,r=!1){const s=e.propsCache,c=s.get(n);if(c)return c;const d=n.props,_={},x=[];let l=!1;if(!Ni(n)){const D=I=>{l=!0;const[V,j]=qz(I,e,!0);fo(_,V),j&&x.push(...j)};!r&&e.mixins.length&&e.mixins.forEach(D),n.extends&&D(n.extends),n.mixins&&n.mixins.forEach(D)}if(!d&&!l)return is(n)&&s.set(n,ig),ig;if(Ri(d))for(let D=0;D<d.length;D++){const I=yg(d[D]);q3(I)&&(_[I]=Xn)}else if(d)for(const D in d){const I=yg(D);if(q3(I)){const V=d[D],j=_[I]=Ri(V)||Ni(V)?{type:V}:fo({},V);if(j){const Q=Z3(Boolean,j.type),te=Z3(String,j.type);j[0]=Q>-1,j[1]=te<0||Q<te,(Q>-1||pn(j,"default"))&&x.push(I)}}}const S=[_,x];return is(n)&&s.set(n,S),S}function q3(n){return n[0]!=="$"&&!av(n)}function H3(n){return n===null?"null":typeof n=="function"?n.name||"":typeof n=="object"&&n.constructor&&n.constructor.name||""}function W3(n,e){return H3(n)===H3(e)}function Z3(n,e){return Ri(e)?e.findIndex(r=>W3(r,n)):Ni(e)&&W3(e,n)?0:-1}const Hz=n=>n[0]==="_"||n==="$stable",rC=n=>Ri(n)?n.map(Jc):[Jc(n)],zG=(n,e,r)=>{if(e._n)return e;const s=vg((...c)=>rC(e(...c)),r);return s._c=!1,s},Wz=(n,e,r)=>{const s=n._ctx;for(const c in n){if(Hz(c))continue;const d=n[c];if(Ni(d))e[c]=zG(c,d,s);else if(d!=null){const _=rC(d);e[c]=()=>_}}},Zz=(n,e)=>{const r=rC(e);n.slots.default=()=>r},FG=(n,e)=>{const r=n.slots=jz();if(n.vnode.shapeFlag&32){const s=e._;s?(fo(r,e),ez(r,"_",s,!0)):Wz(e,r)}else e&&Zz(n,e)},NG=(n,e,r)=>{const{vnode:s,slots:c}=n;let d=!0,_=Xn;if(s.shapeFlag&32){const x=e._;x?r&&x===1?d=!1:(fo(c,e),!r&&x===1&&delete c._):(d=!e.$stable,Wz(e,c)),_=e}else e&&(Zz(n,e),_={default:1});if(d)for(const x in c)!Hz(x)&&_[x]==null&&delete c[x]};function QA(n,e,r,s,c=!1){if(Ri(n)){n.forEach((V,j)=>QA(V,e&&(Ri(e)?e[j]:e),r,s,c));return}if(cv(s)&&!c)return;const d=s.shapeFlag&4?ZT(s.component)||s.component.proxy:s.el,_=c?null:d,{i:x,r:l}=n,S=e&&e.r,D=x.refs===Xn?x.refs={}:x.refs,I=x.setupState;if(S!=null&&S!==l&&(Qs(S)?(D[S]=null,pn(I,S)&&(I[S]=null)):ya(S)&&(S.value=null)),Ni(l))Nd(l,x,12,[_,D]);else{const V=Qs(l),j=ya(l);if(V||j){const Q=()=>{if(n.f){const te=V?pn(I,l)?I[l]:D[l]:l.value;c?Ri(te)&&US(te,d):Ri(te)?te.includes(d)||te.push(d):V?(D[l]=[d],pn(I,l)&&(I[l]=D[l])):(l.value=[d],n.k&&(D[n.k]=l.value))}else V?(D[l]=_,pn(I,l)&&(I[l]=_)):j&&(l.value=_,n.k&&(D[n.k]=_))};_?(Q.id=-1,La(Q,r)):Q()}}}const La=hG;function BG(n){return VG(n)}function VG(n,e){const r=tz();r.__VUE__=!0;const{insert:s,remove:c,patchProp:d,createElement:_,createText:x,createComment:l,setText:S,setElementText:D,parentNode:I,nextSibling:V,setScopeId:j=zl,insertStaticContent:Q}=n,te=(be,Ae,Ze,lt=null,Ee=null,Ft=null,ft=void 0,nt=null,Ot=!!Ae.dynamicChildren)=>{if(be===Ae)return;be&&!Py(be,Ae)&&(lt=yt(be),Xt(be,Ee,Ft,!0),be=null),Ae.patchFlag===-2&&(Ot=!1,Ae.dynamicChildren=null);const{type:Mt,ref:je,shapeFlag:re}=Ae;switch(Mt){case HT:ce(be,Ae,Ze,lt);break;case Xd:Ce(be,Ae,Ze,lt);break;case N4:be==null&&Me(Ae,Ze,lt,ft);break;case Zs:De(be,Ae,Ze,lt,Ee,Ft,ft,nt,Ot);break;default:re&1?Ge(be,Ae,Ze,lt,Ee,Ft,ft,nt,Ot):re&6?Se(be,Ae,Ze,lt,Ee,Ft,ft,nt,Ot):(re&64||re&128)&&Mt.process(be,Ae,Ze,lt,Ee,Ft,ft,nt,Ot,$t)}je!=null&&Ee&&QA(je,be&&be.ref,Ft,Ae||be,!Ae)},ce=(be,Ae,Ze,lt)=>{if(be==null)s(Ae.el=x(Ae.children),Ze,lt);else{const Ee=Ae.el=be.el;Ae.children!==be.children&&S(Ee,Ae.children)}},Ce=(be,Ae,Ze,lt)=>{be==null?s(Ae.el=l(Ae.children||""),Ze,lt):Ae.el=be.el},Me=(be,Ae,Ze,lt)=>{[be.el,be.anchor]=Q(be.children,Ae,Ze,lt,be.el,be.anchor)},Ie=({el:be,anchor:Ae},Ze,lt)=>{let Ee;for(;be&&be!==Ae;)Ee=V(be),s(be,Ze,lt),be=Ee;s(Ae,Ze,lt)},Te=({el:be,anchor:Ae})=>{let Ze;for(;be&&be!==Ae;)Ze=V(be),c(be),be=Ze;c(Ae)},Ge=(be,Ae,Ze,lt,Ee,Ft,ft,nt,Ot)=>{Ae.type==="svg"?ft="svg":Ae.type==="math"&&(ft="mathml"),be==null?$e(Ae,Ze,lt,Ee,Ft,ft,nt,Ot):_e(be,Ae,Ee,Ft,ft,nt,Ot)},$e=(be,Ae,Ze,lt,Ee,Ft,ft,nt)=>{let Ot,Mt;const{props:je,shapeFlag:re,transition:oe,dirs:xe}=be;if(Ot=be.el=_(be.type,Ft,je&&je.is,je),re&8?D(Ot,be.children):re&16&&pe(be.children,Ot,null,lt,Ee,F4(be,Ft),ft,nt),xe&&mp(be,null,lt,"created"),ue(Ot,be,be.scopeId,ft,lt),je){for(const Ke in je)Ke!=="value"&&!av(Ke)&&d(Ot,Ke,null,je[Ke],Ft,be.children,lt,Ee,qr);"value"in je&&d(Ot,"value",null,je.value,Ft),(Mt=je.onVnodeBeforeMount)&&Yc(Mt,lt,be)}xe&&mp(be,null,lt,"beforeMount");const Be=UG(Ee,oe);Be&&oe.beforeEnter(Ot),s(Ot,Ae,Ze),((Mt=je&&je.onVnodeMounted)||Be||xe)&&La(()=>{Mt&&Yc(Mt,lt,be),Be&&oe.enter(Ot),xe&&mp(be,null,lt,"mounted")},Ee)},ue=(be,Ae,Ze,lt,Ee)=>{if(Ze&&j(be,Ze),lt)for(let Ft=0;Ft<lt.length;Ft++)j(be,lt[Ft]);if(Ee){let Ft=Ee.subTree;if(Ae===Ft){const ft=Ee.vnode;ue(be,ft,ft.scopeId,ft.slotScopeIds,Ee.parent)}}},pe=(be,Ae,Ze,lt,Ee,Ft,ft,nt,Ot=0)=>{for(let Mt=Ot;Mt<be.length;Mt++){const je=be[Mt]=nt?Td(be[Mt]):Jc(be[Mt]);te(null,je,Ae,Ze,lt,Ee,Ft,ft,nt)}},_e=(be,Ae,Ze,lt,Ee,Ft,ft)=>{const nt=Ae.el=be.el;let{patchFlag:Ot,dynamicChildren:Mt,dirs:je}=Ae;Ot|=be.patchFlag&16;const re=be.props||Xn,oe=Ae.props||Xn;let xe;if(Ze&&_p(Ze,!1),(xe=oe.onVnodeBeforeUpdate)&&Yc(xe,Ze,Ae,be),je&&mp(Ae,be,Ze,"beforeUpdate"),Ze&&_p(Ze,!0),Mt?ge(be.dynamicChildren,Mt,nt,Ze,lt,F4(Ae,Ee),Ft):ft||Kt(be,Ae,nt,null,Ze,lt,F4(Ae,Ee),Ft,!1),Ot>0){if(Ot&16)Fe(nt,Ae,re,oe,Ze,lt,Ee);else if(Ot&2&&re.class!==oe.class&&d(nt,"class",null,oe.class,Ee),Ot&4&&d(nt,"style",re.style,oe.style,Ee),Ot&8){const Be=Ae.dynamicProps;for(let Ke=0;Ke<Be.length;Ke++){const ct=Be[Ke],zt=re[ct],st=oe[ct];(st!==zt||ct==="value")&&d(nt,ct,zt,st,Ee,be.children,Ze,lt,qr)}}Ot&1&&be.children!==Ae.children&&D(nt,Ae.children)}else!ft&&Mt==null&&Fe(nt,Ae,re,oe,Ze,lt,Ee);((xe=oe.onVnodeUpdated)||je)&&La(()=>{xe&&Yc(xe,Ze,Ae,be),je&&mp(Ae,be,Ze,"updated")},lt)},ge=(be,Ae,Ze,lt,Ee,Ft,ft)=>{for(let nt=0;nt<Ae.length;nt++){const Ot=be[nt],Mt=Ae[nt],je=Ot.el&&(Ot.type===Zs||!Py(Ot,Mt)||Ot.shapeFlag&70)?I(Ot.el):Ze;te(Ot,Mt,je,null,lt,Ee,Ft,ft,!0)}},Fe=(be,Ae,Ze,lt,Ee,Ft,ft)=>{if(Ze!==lt){if(Ze!==Xn)for(const nt in Ze)!av(nt)&&!(nt in lt)&&d(be,nt,Ze[nt],null,ft,Ae.children,Ee,Ft,qr);for(const nt in lt){if(av(nt))continue;const Ot=lt[nt],Mt=Ze[nt];Ot!==Mt&&nt!=="value"&&d(be,nt,Mt,Ot,ft,Ae.children,Ee,Ft,qr)}"value"in lt&&d(be,"value",Ze.value,lt.value,ft)}},De=(be,Ae,Ze,lt,Ee,Ft,ft,nt,Ot)=>{const Mt=Ae.el=be?be.el:x(""),je=Ae.anchor=be?be.anchor:x("");let{patchFlag:re,dynamicChildren:oe,slotScopeIds:xe}=Ae;xe&&(nt=nt?nt.concat(xe):xe),be==null?(s(Mt,Ze,lt),s(je,Ze,lt),pe(Ae.children||[],Ze,je,Ee,Ft,ft,nt,Ot)):re>0&&re&64&&oe&&be.dynamicChildren?(ge(be.dynamicChildren,oe,Ze,Ee,Ft,ft,nt),(Ae.key!=null||Ee&&Ae===Ee.subTree)&&Xz(be,Ae,!0)):Kt(be,Ae,Ze,je,Ee,Ft,ft,nt,Ot)},Se=(be,Ae,Ze,lt,Ee,Ft,ft,nt,Ot)=>{Ae.slotScopeIds=nt,be==null?Ae.shapeFlag&512?Ee.ctx.activate(Ae,Ze,lt,ft,Ot):pr(Ae,Ze,lt,Ee,Ft,ft,Ot):or(be,Ae,Ot)},pr=(be,Ae,Ze,lt,Ee,Ft,ft)=>{const nt=be.component=YG(be,lt,Ee);if(Lz(be)&&(nt.ctx.renderer=$t),QG(nt),nt.asyncDep){if(Ee&&Ee.registerDep(nt,Vt),!be.el){const Ot=nt.subTree=kn(Xd);Ce(null,Ot,Ae,Ze)}}else Vt(nt,be,Ae,Ze,Ee,Ft,ft)},or=(be,Ae,Ze)=>{const lt=Ae.component=be.component;if(aG(be,Ae,Ze))if(lt.asyncDep&&!lt.asyncResolved){Ht(lt,Ae,Ze);return}else lt.next=Ae,tG(lt.update),lt.effect.dirty=!0,lt.update();else Ae.el=be.el,lt.vnode=Ae},Vt=(be,Ae,Ze,lt,Ee,Ft,ft)=>{const nt=()=>{if(be.isMounted){let{next:je,bu:re,u:oe,parent:xe,vnode:Be}=be;{const Ct=Yz(be);if(Ct){je&&(je.el=Be.el,Ht(be,je,ft)),Ct.asyncDep.then(()=>{be.isUnmounted||nt()});return}}let Ke=je,ct;_p(be,!1),je?(je.el=Be.el,Ht(be,je,ft)):je=Be,re&&cw(re),(ct=je.props&&je.props.onVnodeBeforeUpdate)&&Yc(ct,xe,je,Be),_p(be,!0);const zt=O4(be),st=be.subTree;be.subTree=zt,te(st,zt,I(st.el),yt(st),be,Ee,Ft),je.el=zt.el,Ke===null&&lG(be,zt.el),oe&&La(oe,Ee),(ct=je.props&&je.props.onVnodeUpdated)&&La(()=>Yc(ct,xe,je,Be),Ee)}else{let je;const{el:re,props:oe}=Ae,{bm:xe,m:Be,parent:Ke}=be,ct=cv(Ae);if(_p(be,!1),xe&&cw(xe),!ct&&(je=oe&&oe.onVnodeBeforeMount)&&Yc(je,Ke,Ae),_p(be,!0),re&&Er){const zt=()=>{be.subTree=O4(be),Er(re,be.subTree,be,Ee,null)};ct?Ae.type.__asyncLoader().then(()=>!be.isUnmounted&&zt()):zt()}else{const zt=be.subTree=O4(be);te(null,zt,Ze,lt,be,Ee,Ft),Ae.el=zt.el}if(Be&&La(Be,Ee),!ct&&(je=oe&&oe.onVnodeMounted)){const zt=Ae;La(()=>Yc(je,Ke,zt),Ee)}(Ae.shapeFlag&256||Ke&&cv(Ke.vnode)&&Ke.vnode.shapeFlag&256)&&be.a&&La(be.a,Ee),be.isMounted=!0,Ae=Ze=lt=null}},Ot=be.effect=new GS(nt,zl,()=>JS(Mt),be.scope),Mt=be.update=()=>{Ot.dirty&&Ot.run()};Mt.id=be.uid,_p(be,!0),Mt()},Ht=(be,Ae,Ze)=>{Ae.component=be;const lt=be.vnode.props;be.vnode=Ae,be.next=null,OG(be,Ae.props,lt,Ze),NG(be,Ae.children,Ze),nf(),B3(be),sf()},Kt=(be,Ae,Ze,lt,Ee,Ft,ft,nt,Ot=!1)=>{const Mt=be&&be.children,je=be?be.shapeFlag:0,re=Ae.children,{patchFlag:oe,shapeFlag:xe}=Ae;if(oe>0){if(oe&128){We(Mt,re,Ze,lt,Ee,Ft,ft,nt,Ot);return}else if(oe&256){Tr(Mt,re,Ze,lt,Ee,Ft,ft,nt,Ot);return}}xe&8?(je&16&&qr(Mt,Ee,Ft),re!==Mt&&D(Ze,re)):je&16?xe&16?We(Mt,re,Ze,lt,Ee,Ft,ft,nt,Ot):qr(Mt,Ee,Ft,!0):(je&8&&D(Ze,""),xe&16&&pe(re,Ze,lt,Ee,Ft,ft,nt,Ot))},Tr=(be,Ae,Ze,lt,Ee,Ft,ft,nt,Ot)=>{be=be||ig,Ae=Ae||ig;const Mt=be.length,je=Ae.length,re=Math.min(Mt,je);let oe;for(oe=0;oe<re;oe++){const xe=Ae[oe]=Ot?Td(Ae[oe]):Jc(Ae[oe]);te(be[oe],xe,Ze,null,Ee,Ft,ft,nt,Ot)}Mt>je?qr(be,Ee,Ft,!0,!1,re):pe(Ae,Ze,lt,Ee,Ft,ft,nt,Ot,re)},We=(be,Ae,Ze,lt,Ee,Ft,ft,nt,Ot)=>{let Mt=0;const je=Ae.length;let re=be.length-1,oe=je-1;for(;Mt<=re&&Mt<=oe;){const xe=be[Mt],Be=Ae[Mt]=Ot?Td(Ae[Mt]):Jc(Ae[Mt]);if(Py(xe,Be))te(xe,Be,Ze,null,Ee,Ft,ft,nt,Ot);else break;Mt++}for(;Mt<=re&&Mt<=oe;){const xe=be[re],Be=Ae[oe]=Ot?Td(Ae[oe]):Jc(Ae[oe]);if(Py(xe,Be))te(xe,Be,Ze,null,Ee,Ft,ft,nt,Ot);else break;re--,oe--}if(Mt>re){if(Mt<=oe){const xe=oe+1,Be=xe<je?Ae[xe].el:lt;for(;Mt<=oe;)te(null,Ae[Mt]=Ot?Td(Ae[Mt]):Jc(Ae[Mt]),Ze,Be,Ee,Ft,ft,nt,Ot),Mt++}}else if(Mt>oe)for(;Mt<=re;)Xt(be[Mt],Ee,Ft,!0),Mt++;else{const xe=Mt,Be=Mt,Ke=new Map;for(Mt=Be;Mt<=oe;Mt++){const jr=Ae[Mt]=Ot?Td(Ae[Mt]):Jc(Ae[Mt]);jr.key!=null&&Ke.set(jr.key,Mt)}let ct,zt=0;const st=oe-Be+1;let Ct=!1,qt=0;const Wt=new Array(st);for(Mt=0;Mt<st;Mt++)Wt[Mt]=0;for(Mt=xe;Mt<=re;Mt++){const jr=be[Mt];if(zt>=st){Xt(jr,Ee,Ft,!0);continue}let Or;if(jr.key!=null)Or=Ke.get(jr.key);else for(ct=Be;ct<=oe;ct++)if(Wt[ct-Be]===0&&Py(jr,Ae[ct])){Or=ct;break}Or===void 0?Xt(jr,Ee,Ft,!0):(Wt[Or-Be]=Mt+1,Or>=qt?qt=Or:Ct=!0,te(jr,Ae[Or],Ze,null,Ee,Ft,ft,nt,Ot),zt++)}const Nt=Ct?jG(Wt):ig;for(ct=Nt.length-1,Mt=st-1;Mt>=0;Mt--){const jr=Be+Mt,Or=Ae[jr],ii=jr+1<je?Ae[jr+1].el:lt;Wt[Mt]===0?te(null,Or,Ze,ii,Ee,Ft,ft,nt,Ot):Ct&&(ct<0||Mt!==Nt[ct]?Sr(Or,Ze,ii,2):ct--)}}},Sr=(be,Ae,Ze,lt,Ee=null)=>{const{el:Ft,type:ft,transition:nt,children:Ot,shapeFlag:Mt}=be;if(Mt&6){Sr(be.component.subTree,Ae,Ze,lt);return}if(Mt&128){be.suspense.move(Ae,Ze,lt);return}if(Mt&64){ft.move(be,Ae,Ze,$t);return}if(ft===Zs){s(Ft,Ae,Ze);for(let re=0;re<Ot.length;re++)Sr(Ot[re],Ae,Ze,lt);s(be.anchor,Ae,Ze);return}if(ft===N4){Ie(be,Ae,Ze);return}if(lt!==2&&Mt&1&&nt)if(lt===0)nt.beforeEnter(Ft),s(Ft,Ae,Ze),La(()=>nt.enter(Ft),Ee);else{const{leave:re,delayLeave:oe,afterLeave:xe}=nt,Be=()=>s(Ft,Ae,Ze),Ke=()=>{re(Ft,()=>{Be(),xe&&xe()})};oe?oe(Ft,Be,Ke):Ke()}else s(Ft,Ae,Ze)},Xt=(be,Ae,Ze,lt=!1,Ee=!1)=>{const{type:Ft,props:ft,ref:nt,children:Ot,dynamicChildren:Mt,shapeFlag:je,patchFlag:re,dirs:oe}=be;if(nt!=null&&QA(nt,null,Ze,be,!0),je&256){Ae.ctx.deactivate(be);return}const xe=je&1&&oe,Be=!cv(be);let Ke;if(Be&&(Ke=ft&&ft.onVnodeBeforeUnmount)&&Yc(Ke,Ae,be),je&6)gi(be.component,Ze,lt);else{if(je&128){be.suspense.unmount(Ze,lt);return}xe&&mp(be,null,Ae,"beforeUnmount"),je&64?be.type.remove(be,Ae,Ze,Ee,$t,lt):Mt&&(Ft!==Zs||re>0&&re&64)?qr(Mt,Ae,Ze,!1,!0):(Ft===Zs&&re&384||!Ee&&je&16)&&qr(Ot,Ae,Ze),lt&&ei(be)}(Be&&(Ke=ft&&ft.onVnodeUnmounted)||xe)&&La(()=>{Ke&&Yc(Ke,Ae,be),xe&&mp(be,null,Ae,"unmounted")},Ze)},ei=be=>{const{type:Ae,el:Ze,anchor:lt,transition:Ee}=be;if(Ae===Zs){Fr(Ze,lt);return}if(Ae===N4){Te(be);return}const Ft=()=>{c(Ze),Ee&&!Ee.persisted&&Ee.afterLeave&&Ee.afterLeave()};if(be.shapeFlag&1&&Ee&&!Ee.persisted){const{leave:ft,delayLeave:nt}=Ee,Ot=()=>ft(Ze,Ft);nt?nt(be.el,Ft,Ot):Ot()}else Ft()},Fr=(be,Ae)=>{let Ze;for(;be!==Ae;)Ze=V(be),c(be),be=Ze;c(Ae)},gi=(be,Ae,Ze)=>{const{bum:lt,scope:Ee,update:Ft,subTree:ft,um:nt}=be;lt&&cw(lt),Ee.stop(),Ft&&(Ft.active=!1,Xt(ft,be,Ae,Ze)),nt&&La(nt,Ae),La(()=>{be.isUnmounted=!0},Ae),Ae&&Ae.pendingBranch&&!Ae.isUnmounted&&be.asyncDep&&!be.asyncResolved&&be.suspenseId===Ae.pendingId&&(Ae.deps--,Ae.deps===0&&Ae.resolve())},qr=(be,Ae,Ze,lt=!1,Ee=!1,Ft=0)=>{for(let ft=Ft;ft<be.length;ft++)Xt(be[ft],Ae,Ze,lt,Ee)},yt=be=>be.shapeFlag&6?yt(be.component.subTree):be.shapeFlag&128?be.suspense.next():V(be.anchor||be.el);let dt=!1;const jt=(be,Ae,Ze)=>{be==null?Ae._vnode&&Xt(Ae._vnode,null,null,!0):te(Ae._vnode||null,be,Ae,null,null,null,Ze),dt||(dt=!0,B3(),Rz(),dt=!1),Ae._vnode=be},$t={p:te,um:Xt,m:Sr,r:ei,mt:pr,mc:pe,pc:Kt,pbc:ge,n:yt,o:n};let Mr,Er;return{render:jt,hydrate:Mr,createApp:DG(jt,Mr)}}function F4({type:n,props:e},r){return r==="svg"&&n==="foreignObject"||r==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:r}function _p({effect:n,update:e},r){n.allowRecurse=e.allowRecurse=r}function UG(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function Xz(n,e,r=!1){const s=n.children,c=e.children;if(Ri(s)&&Ri(c))for(let d=0;d<s.length;d++){const _=s[d];let x=c[d];x.shapeFlag&1&&!x.dynamicChildren&&((x.patchFlag<=0||x.patchFlag===32)&&(x=c[d]=Td(c[d]),x.el=_.el),r||Xz(_,x)),x.type===HT&&(x.el=_.el)}}function jG(n){const e=n.slice(),r=[0];let s,c,d,_,x;const l=n.length;for(s=0;s<l;s++){const S=n[s];if(S!==0){if(c=r[r.length-1],n[c]<S){e[s]=c,r.push(s);continue}for(d=0,_=r.length-1;d<_;)x=d+_>>1,n[r[x]]<S?d=x+1:_=x;S<n[r[d]]&&(d>0&&(e[s]=r[d-1]),r[d]=s)}}for(d=r.length,_=r[d-1];d-- >0;)r[d]=_,_=e[_];return r}function Yz(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Yz(e)}const $G=n=>n.__isTeleport,Zs=Symbol.for("v-fgt"),HT=Symbol.for("v-txt"),Xd=Symbol.for("v-cmt"),N4=Symbol.for("v-stc"),dv=[];let gc=null;function li(n=!1){dv.push(gc=n?null:[])}function GG(){dv.pop(),gc=dv[dv.length-1]||null}let $v=1;function X3(n){$v+=n}function Qz(n){return n.dynamicChildren=$v>0?gc||ig:null,GG(),$v>0&&gc&&gc.push(n),n}function Ii(n,e,r,s,c,d){return Qz(Br(n,e,r,s,c,d,!0))}function Wg(n,e,r,s,c){return Qz(kn(n,e,r,s,c,!0))}function Nw(n){return n?n.__v_isVNode===!0:!1}function Py(n,e){return n.type===e.type&&n.key===e.key}const Kz=({key:n})=>n??null,dw=({ref:n,ref_key:e,ref_for:r})=>(typeof n=="number"&&(n=""+n),n!=null?Qs(n)||ya(n)||Ni(n)?{i:ho,r:n,k:e,f:!!r}:n:null);function Br(n,e=null,r=null,s=0,c=null,d=n===Zs?0:1,_=!1,x=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&Kz(e),ref:e&&dw(e),scopeId:GT,slotScopeIds:null,children:r,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:d,patchFlag:s,dynamicProps:c,dynamicChildren:null,appContext:null,ctx:ho};return x?(iC(l,r),d&128&&n.normalize(l)):r&&(l.shapeFlag|=Qs(r)?8:16),$v>0&&!_&&gc&&(l.patchFlag>0||d&6)&&l.patchFlag!==32&&gc.push(l),l}const kn=qG;function qG(n,e=null,r=null,s=0,c=null,d=!1){if((!n||n===cG)&&(n=Xd),Nw(n)){const x=bg(n,e,!0);return r&&iC(x,r),$v>0&&!d&&gc&&(x.shapeFlag&6?gc[gc.indexOf(n)]=x:gc.push(x)),x.patchFlag|=-2,x}if(tq(n)&&(n=n.__vccOpts),e){e=HG(e);let{class:x,style:l}=e;x&&!Qs(x)&&(e.class=Hg(x)),is(l)&&(xz(l)&&!Ri(l)&&(l=fo({},l)),e.style=$S(l))}const _=Qs(n)?1:uG(n)?128:$G(n)?64:is(n)?4:Ni(n)?2:0;return Br(n,e,r,s,c,_,d,!0)}function HG(n){return n?xz(n)||$z(n)?fo({},n):n:null}function bg(n,e,r=!1,s=!1){const{props:c,ref:d,patchFlag:_,children:x,transition:l}=n,S=e?WG(c||{},e):c,D={__v_isVNode:!0,__v_skip:!0,type:n.type,props:S,key:S&&Kz(S),ref:e&&e.ref?r&&d?Ri(d)?d.concat(dw(e)):[d,dw(e)]:dw(e):d,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:x,target:n.target,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==Zs?_===-1?16:_|16:_,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&bg(n.ssContent),ssFallback:n.ssFallback&&bg(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&s&&(D.transition=l.clone(D)),D}function au(n=" ",e=0){return kn(HT,null,n,e)}function Tc(n="",e=!1){return e?(li(),Wg(Xd,null,n)):kn(Xd,null,n)}function Jc(n){return n==null||typeof n=="boolean"?kn(Xd):Ri(n)?kn(Zs,null,n.slice()):typeof n=="object"?Td(n):kn(HT,null,String(n))}function Td(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:bg(n)}function iC(n,e){let r=0;const{shapeFlag:s}=n;if(e==null)e=null;else if(Ri(e))r=16;else if(typeof e=="object")if(s&65){const c=e.default;c&&(c._c&&(c._d=!1),iC(n,c()),c._c&&(c._d=!0));return}else{r=32;const c=e._;!c&&!$z(e)?e._ctx=ho:c===3&&ho&&(ho.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Ni(e)?(e={default:e,_ctx:ho},r=32):(e=String(e),s&64?(r=16,e=[au(e)]):r=8);n.children=e,n.shapeFlag|=r}function WG(...n){const e={};for(let r=0;r<n.length;r++){const s=n[r];for(const c in s)if(c==="class")e.class!==s.class&&(e.class=Hg([e.class,s.class]));else if(c==="style")e.style=$S([e.style,s.style]);else if(FT(c)){const d=e[c],_=s[c];_&&d!==_&&!(Ri(d)&&d.includes(_))&&(e[c]=d?[].concat(d,_):_)}else c!==""&&(e[c]=s[c])}return e}function Yc(n,e,r,s=null){wc(n,e,7,[r,s])}const ZG=Vz();let XG=0;function YG(n,e,r){const s=n.type,c=(e?e.appContext:n.appContext)||ZG,d={uid:XG++,vnode:n,type:s,parent:e,appContext:c,root:null,next:null,subTree:null,effect:null,update:null,scope:new nz(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(c.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:qz(s,c),emitsOptions:Mz(s,c),emit:null,emitted:null,propsDefaults:Xn,inheritAttrs:s.inheritAttrs,ctx:Xn,data:Xn,props:Xn,attrs:Xn,slots:Xn,refs:Xn,setupState:Xn,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:r,suspenseId:r?r.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return d.ctx={_:d},d.root=e?e.root:d,d.emit=nG.bind(null,d),n.ce&&n.ce(d),d}let Zo=null;const Jz=()=>Zo||ho;let Bw,KA;{const n=tz(),e=(r,s)=>{let c;return(c=n[r])||(c=n[r]=[]),c.push(s),d=>{c.length>1?c.forEach(_=>_(d)):c[0](d)}};Bw=e("__VUE_INSTANCE_SETTERS__",r=>Zo=r),KA=e("__VUE_SSR_SETTERS__",r=>WT=r)}const b1=n=>{const e=Zo;return Bw(n),n.scope.on(),()=>{n.scope.off(),Bw(e)}},Y3=()=>{Zo&&Zo.scope.off(),Bw(null)};function eF(n){return n.vnode.shapeFlag&4}let WT=!1;function QG(n,e=!1){e&&KA(e);const{props:r,children:s}=n.vnode,c=eF(n);LG(n,r,c,e),FG(n,s);const d=c?KG(n,e):void 0;return e&&KA(!1),d}function KG(n,e){const r=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,IG);const{setup:s}=r;if(s){const c=n.setupContext=s.length>1?eq(n):null,d=b1(n);nf();const _=Nd(s,n,0,[n.props,c]);if(sf(),d(),YO(_)){if(_.then(Y3,Y3),e)return _.then(x=>{Q3(n,x,e)}).catch(x=>{jT(x,n,0)});n.asyncDep=_}else Q3(n,_,e)}else tF(n,e)}function Q3(n,e,r){Ni(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:is(e)&&(n.setupState=Iz(e)),tF(n,r)}let K3;function tF(n,e,r){const s=n.type;if(!n.render){if(!e&&K3&&!s.render){const c=s.template||tC(n).template;if(c){const{isCustomElement:d,compilerOptions:_}=n.appContext.config,{delimiters:x,compilerOptions:l}=s,S=fo(fo({isCustomElement:d,delimiters:x},_),l);s.render=K3(c,S)}}n.render=s.render||zl}{const c=b1(n);nf();try{SG(n)}finally{sf(),c()}}}const JG={get(n,e){return Ga(n,"get",""),n[e]}};function eq(n){const e=r=>{n.exposed=r||{}};return{attrs:new Proxy(n.attrs,JG),slots:n.slots,emit:n.emit,expose:e}}function ZT(n){if(n.exposed)return n.exposeProxy||(n.exposeProxy=new Proxy(Iz(bz(n.exposed)),{get(e,r){if(r in e)return e[r];if(r in uv)return uv[r](n)},has(e,r){return r in e||r in uv}}))}function tq(n){return Ni(n)&&"__vccOpts"in n}const wo=(n,e)=>Y$(n,e,WT);function rF(n,e,r){const s=arguments.length;return s===2?is(e)&&!Ri(e)?Nw(e)?kn(n,null,[e]):kn(n,e):kn(n,null,e):(s>3?r=Array.prototype.slice.call(arguments,2):s===3&&Nw(r)&&(r=[r]),kn(n,e,r))}const rq="3.4.27";/**
* @vue/runtime-dom v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const iq="http://www.w3.org/2000/svg",nq="http://www.w3.org/1998/Math/MathML",Ed=typeof document<"u"?document:null,J3=Ed&&Ed.createElement("template"),sq={insert:(n,e,r)=>{e.insertBefore(n,r||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,r,s)=>{const c=e==="svg"?Ed.createElementNS(iq,n):e==="mathml"?Ed.createElementNS(nq,n):Ed.createElement(n,r?{is:r}:void 0);return n==="select"&&s&&s.multiple!=null&&c.setAttribute("multiple",s.multiple),c},createText:n=>Ed.createTextNode(n),createComment:n=>Ed.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Ed.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,r,s,c,d){const _=r?r.previousSibling:e.lastChild;if(c&&(c===d||c.nextSibling))for(;e.insertBefore(c.cloneNode(!0),r),!(c===d||!(c=c.nextSibling)););else{J3.innerHTML=s==="svg"?`<svg>${n}</svg>`:s==="mathml"?`<math>${n}</math>`:n;const x=J3.content;if(s==="svg"||s==="mathml"){const l=x.firstChild;for(;l.firstChild;)x.appendChild(l.firstChild);x.removeChild(l)}e.insertBefore(x,r)}return[_?_.nextSibling:e.firstChild,r?r.previousSibling:e.lastChild]}},oq=Symbol("_vtc");function aq(n,e,r){const s=n[oq];s&&(e=(e?[e,...s]:[...s]).join(" ")),e==null?n.removeAttribute("class"):r?n.setAttribute("class",e):n.className=e}const ek=Symbol("_vod"),lq=Symbol("_vsh"),cq=Symbol(""),uq=/(^|;)\s*display\s*:/;function hq(n,e,r){const s=n.style,c=Qs(r);let d=!1;if(r&&!c){if(e)if(Qs(e))for(const _ of e.split(";")){const x=_.slice(0,_.indexOf(":")).trim();r[x]==null&&fw(s,x,"")}else for(const _ in e)r[_]==null&&fw(s,_,"");for(const _ in r)_==="display"&&(d=!0),fw(s,_,r[_])}else if(c){if(e!==r){const _=s[cq];_&&(r+=";"+_),s.cssText=r,d=uq.test(r)}}else e&&n.removeAttribute("style");ek in n&&(n[ek]=d?s.display:"",n[lq]&&(s.display="none"))}const tk=/\s*!important$/;function fw(n,e,r){if(Ri(r))r.forEach(s=>fw(n,e,s));else if(r==null&&(r=""),e.startsWith("--"))n.setProperty(e,r);else{const s=dq(n,e);tk.test(r)?n.setProperty(qg(s),r.replace(tk,""),"important"):n[s]=r}}const rk=["Webkit","Moz","ms"],B4={};function dq(n,e){const r=B4[e];if(r)return r;let s=yg(e);if(s!=="filter"&&s in n)return B4[e]=s;s=JO(s);for(let c=0;c<rk.length;c++){const d=rk[c]+s;if(d in n)return B4[e]=d}return e}const ik="http://www.w3.org/1999/xlink";function fq(n,e,r,s,c){if(s&&e.startsWith("xlink:"))r==null?n.removeAttributeNS(ik,e.slice(6,e.length)):n.setAttributeNS(ik,e,r);else{const d=C$(e);r==null||d&&!rz(r)?n.removeAttribute(e):n.setAttribute(e,d?"":r)}}function pq(n,e,r,s,c,d,_){if(e==="innerHTML"||e==="textContent"){s&&_(s,c,d),n[e]=r??"";return}const x=n.tagName;if(e==="value"&&x!=="PROGRESS"&&!x.includes("-")){const S=x==="OPTION"?n.getAttribute("value")||"":n.value,D=r??"";(S!==D||!("_value"in n))&&(n.value=D),r==null&&n.removeAttribute(e),n._value=r;return}let l=!1;if(r===""||r==null){const S=typeof n[e];S==="boolean"?r=rz(r):r==null&&S==="string"?(r="",l=!0):S==="number"&&(r=0,l=!0)}try{n[e]=r}catch{}l&&n.removeAttribute(e)}function N_(n,e,r,s){n.addEventListener(e,r,s)}function mq(n,e,r,s){n.removeEventListener(e,r,s)}const nk=Symbol("_vei");function _q(n,e,r,s,c=null){const d=n[nk]||(n[nk]={}),_=d[e];if(s&&_)_.value=s;else{const[x,l]=gq(e);if(s){const S=d[e]=xq(s,c);N_(n,x,S,l)}else _&&(mq(n,x,_,l),d[e]=void 0)}}const sk=/(?:Once|Passive|Capture)$/;function gq(n){let e;if(sk.test(n)){e={};let s;for(;s=n.match(sk);)n=n.slice(0,n.length-s[0].length),e[s[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):qg(n.slice(2)),e]}let V4=0;const yq=Promise.resolve(),vq=()=>V4||(yq.then(()=>V4=0),V4=Date.now());function xq(n,e){const r=s=>{if(!s._vts)s._vts=Date.now();else if(s._vts<=r.attached)return;wc(bq(s,r.value),e,5,[s])};return r.value=n,r.attached=vq(),r}function bq(n,e){if(Ri(e)){const r=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{r.call(n),n._stopped=!0},e.map(s=>c=>!c._stopped&&s&&s(c))}else return e}const ok=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,wq=(n,e,r,s,c,d,_,x,l)=>{const S=c==="svg";e==="class"?aq(n,s,S):e==="style"?hq(n,r,s):FT(e)?VS(e)||_q(n,e,r,s,_):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Tq(n,e,s,S))?pq(n,e,s,d,_,x,l):(e==="true-value"?n._trueValue=s:e==="false-value"&&(n._falseValue=s),fq(n,e,s,S))};function Tq(n,e,r,s){if(s)return!!(e==="innerHTML"||e==="textContent"||e in n&&ok(e)&&Ni(r));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const c=n.tagName;if(c==="IMG"||c==="VIDEO"||c==="CANVAS"||c==="SOURCE")return!1}return ok(e)&&Qs(r)?!1:e in n}const ak=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Ri(e)?r=>cw(e,r):e};function Eq(n){n.target.composing=!0}function lk(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const U4=Symbol("_assign"),wg={created(n,{modifiers:{lazy:e,trim:r,number:s}},c){n[U4]=ak(c);const d=s||c.props&&c.props.type==="number";N_(n,e?"change":"input",_=>{if(_.target.composing)return;let x=n.value;r&&(x=x.trim()),d&&(x=UA(x)),n[U4](x)}),r&&N_(n,"change",()=>{n.value=n.value.trim()}),e||(N_(n,"compositionstart",Eq),N_(n,"compositionend",lk),N_(n,"change",lk))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,modifiers:{lazy:r,trim:s,number:c}},d){if(n[U4]=ak(d),n.composing)return;const _=(c||n.type==="number")&&!/^0\d/.test(n.value)?UA(n.value):n.value,x=e??"";_!==x&&(document.activeElement===n&&n.type!=="range"&&(r||s&&n.value.trim()===x)||(n.value=x))}},Aq=["ctrl","shift","alt","meta"],Iq={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>Aq.some(r=>n[`${r}Key`]&&!e.includes(r))},Nue=(n,e)=>{const r=n._withMods||(n._withMods={}),s=e.join(".");return r[s]||(r[s]=(c,...d)=>{for(let _=0;_<e.length;_++){const x=Iq[e[_]];if(x&&x(c,e))return}return n(c,...d)})},Sq=fo({patchProp:wq},sq);let ck;function Cq(){return ck||(ck=BG(Sq))}const Rq=(...n)=>{const e=Cq().createApp(...n),{mount:r}=e;return e.mount=s=>{const c=Mq(s);if(!c)return;const d=e._component;!Ni(d)&&!d.render&&!d.template&&(d.template=c.innerHTML),c.innerHTML="";const _=r(c,!1,Pq(c));return c instanceof Element&&(c.removeAttribute("v-cloak"),c.setAttribute("data-v-app","")),_},e};function Pq(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function Mq(n){return Qs(n)?document.querySelector(n):n}var kq=!1;/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */const Dq=Symbol();var uk;(function(n){n.direct="direct",n.patchObject="patch object",n.patchFunction="patch function"})(uk||(uk={}));function Lq(){const n=sz(!0),e=n.run(()=>mn({}));let r=[],s=[];const c=bz({install(d){c._a=d,d.provide(Dq,c),d.config.globalProperties.$pinia=c,s.forEach(_=>r.push(_)),s=[]},use(d){return!this._a&&!kq?s.push(d):r.push(d),this},_p:r,_a:null,_e:n,_s:new Map,state:e});return c}/*!
  * vue-router v4.3.2
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const B_=typeof document<"u";function Oq(n){return n.__esModule||n[Symbol.toStringTag]==="Module"}const Pn=Object.assign;function j4(n,e){const r={};for(const s in e){const c=e[s];r[s]=Sc(c)?c.map(n):n(c)}return r}const fv=()=>{},Sc=Array.isArray,iF=/#/g,zq=/&/g,Fq=/\//g,Nq=/=/g,Bq=/\?/g,nF=/\+/g,Vq=/%5B/g,Uq=/%5D/g,sF=/%5E/g,jq=/%60/g,oF=/%7B/g,$q=/%7C/g,aF=/%7D/g,Gq=/%20/g;function nC(n){return encodeURI(""+n).replace($q,"|").replace(Vq,"[").replace(Uq,"]")}function qq(n){return nC(n).replace(oF,"{").replace(aF,"}").replace(sF,"^")}function JA(n){return nC(n).replace(nF,"%2B").replace(Gq,"+").replace(iF,"%23").replace(zq,"%26").replace(jq,"`").replace(oF,"{").replace(aF,"}").replace(sF,"^")}function Hq(n){return JA(n).replace(Nq,"%3D")}function Wq(n){return nC(n).replace(iF,"%23").replace(Bq,"%3F")}function Zq(n){return n==null?"":Wq(n).replace(Fq,"%2F")}function Gv(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const Xq=/\/$/,Yq=n=>n.replace(Xq,"");function $4(n,e,r="/"){let s,c={},d="",_="";const x=e.indexOf("#");let l=e.indexOf("?");return x<l&&x>=0&&(l=-1),l>-1&&(s=e.slice(0,l),d=e.slice(l+1,x>-1?x:e.length),c=n(d)),x>-1&&(s=s||e.slice(0,x),_=e.slice(x,e.length)),s=eH(s??e,r),{fullPath:s+(d&&"?")+d+_,path:s,query:c,hash:Gv(_)}}function Qq(n,e){const r=e.query?n(e.query):"";return e.path+(r&&"?")+r+(e.hash||"")}function hk(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function Kq(n,e,r){const s=e.matched.length-1,c=r.matched.length-1;return s>-1&&s===c&&Tg(e.matched[s],r.matched[c])&&lF(e.params,r.params)&&n(e.query)===n(r.query)&&e.hash===r.hash}function Tg(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function lF(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const r in n)if(!Jq(n[r],e[r]))return!1;return!0}function Jq(n,e){return Sc(n)?dk(n,e):Sc(e)?dk(e,n):n===e}function dk(n,e){return Sc(e)?n.length===e.length&&n.every((r,s)=>r===e[s]):n.length===1&&n[0]===e}function eH(n,e){if(n.startsWith("/"))return n;if(!n)return e;const r=e.split("/"),s=n.split("/"),c=s[s.length-1];(c===".."||c===".")&&s.push("");let d=r.length-1,_,x;for(_=0;_<s.length;_++)if(x=s[_],x!==".")if(x==="..")d>1&&d--;else break;return r.slice(0,d).join("/")+"/"+s.slice(_).join("/")}var qv;(function(n){n.pop="pop",n.push="push"})(qv||(qv={}));var pv;(function(n){n.back="back",n.forward="forward",n.unknown=""})(pv||(pv={}));function tH(n){if(!n)if(B_){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),Yq(n)}const rH=/^[^#]+#/;function iH(n,e){return n.replace(rH,"#")+e}function nH(n,e){const r=document.documentElement.getBoundingClientRect(),s=n.getBoundingClientRect();return{behavior:e.behavior,left:s.left-r.left-(e.left||0),top:s.top-r.top-(e.top||0)}}const XT=()=>({left:window.scrollX,top:window.scrollY});function sH(n){let e;if("el"in n){const r=n.el,s=typeof r=="string"&&r.startsWith("#"),c=typeof r=="string"?s?document.getElementById(r.slice(1)):document.querySelector(r):r;if(!c)return;e=nH(c,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function fk(n,e){return(history.state?history.state.position-e:-1)+n}const eI=new Map;function oH(n,e){eI.set(n,e)}function aH(n){const e=eI.get(n);return eI.delete(n),e}let lH=()=>location.protocol+"//"+location.host;function cF(n,e){const{pathname:r,search:s,hash:c}=e,d=n.indexOf("#");if(d>-1){let x=c.includes(n.slice(d))?n.slice(d).length:1,l=c.slice(x);return l[0]!=="/"&&(l="/"+l),hk(l,"")}return hk(r,n)+s+c}function cH(n,e,r,s){let c=[],d=[],_=null;const x=({state:V})=>{const j=cF(n,location),Q=r.value,te=e.value;let ce=0;if(V){if(r.value=j,e.value=V,_&&_===Q){_=null;return}ce=te?V.position-te.position:0}else s(j);c.forEach(Ce=>{Ce(r.value,Q,{delta:ce,type:qv.pop,direction:ce?ce>0?pv.forward:pv.back:pv.unknown})})};function l(){_=r.value}function S(V){c.push(V);const j=()=>{const Q=c.indexOf(V);Q>-1&&c.splice(Q,1)};return d.push(j),j}function D(){const{history:V}=window;V.state&&V.replaceState(Pn({},V.state,{scroll:XT()}),"")}function I(){for(const V of d)V();d=[],window.removeEventListener("popstate",x),window.removeEventListener("beforeunload",D)}return window.addEventListener("popstate",x),window.addEventListener("beforeunload",D,{passive:!0}),{pauseListeners:l,listen:S,destroy:I}}function pk(n,e,r,s=!1,c=!1){return{back:n,current:e,forward:r,replaced:s,position:window.history.length,scroll:c?XT():null}}function uH(n){const{history:e,location:r}=window,s={value:cF(n,r)},c={value:e.state};c.value||d(s.value,{back:null,current:s.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function d(l,S,D){const I=n.indexOf("#"),V=I>-1?(r.host&&document.querySelector("base")?n:n.slice(I))+l:lH()+n+l;try{e[D?"replaceState":"pushState"](S,"",V),c.value=S}catch(j){console.error(j),r[D?"replace":"assign"](V)}}function _(l,S){const D=Pn({},e.state,pk(c.value.back,l,c.value.forward,!0),S,{position:c.value.position});d(l,D,!0),s.value=l}function x(l,S){const D=Pn({},c.value,e.state,{forward:l,scroll:XT()});d(D.current,D,!0);const I=Pn({},pk(s.value,l,null),{position:D.position+1},S);d(l,I,!1),s.value=l}return{location:s,state:c,push:x,replace:_}}function hH(n){n=tH(n);const e=uH(n),r=cH(n,e.state,e.location,e.replace);function s(d,_=!0){_||r.pauseListeners(),history.go(d)}const c=Pn({location:"",base:n,go:s,createHref:iH.bind(null,n)},e,r);return Object.defineProperty(c,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(c,"state",{enumerable:!0,get:()=>e.state.value}),c}function dH(n){return n=location.host?n||location.pathname+location.search:"",n.includes("#")||(n+="#"),hH(n)}function fH(n){return typeof n=="string"||n&&typeof n=="object"}function uF(n){return typeof n=="string"||typeof n=="symbol"}const yd={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},hF=Symbol("");var mk;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(mk||(mk={}));function Eg(n,e){return Pn(new Error,{type:n,[hF]:!0},e)}function Ju(n,e){return n instanceof Error&&hF in n&&(e==null||!!(n.type&e))}const _k="[^/]+?",pH={sensitive:!1,strict:!1,start:!0,end:!0},mH=/[.+*?^${}()[\]/\\]/g;function _H(n,e){const r=Pn({},pH,e),s=[];let c=r.start?"^":"";const d=[];for(const S of n){const D=S.length?[]:[90];r.strict&&!S.length&&(c+="/");for(let I=0;I<S.length;I++){const V=S[I];let j=40+(r.sensitive?.25:0);if(V.type===0)I||(c+="/"),c+=V.value.replace(mH,"\\$&"),j+=40;else if(V.type===1){const{value:Q,repeatable:te,optional:ce,regexp:Ce}=V;d.push({name:Q,repeatable:te,optional:ce});const Me=Ce||_k;if(Me!==_k){j+=10;try{new RegExp(`(${Me})`)}catch(Te){throw new Error(`Invalid custom RegExp for param "${Q}" (${Me}): `+Te.message)}}let Ie=te?`((?:${Me})(?:/(?:${Me}))*)`:`(${Me})`;I||(Ie=ce&&S.length<2?`(?:/${Ie})`:"/"+Ie),ce&&(Ie+="?"),c+=Ie,j+=20,ce&&(j+=-8),te&&(j+=-20),Me===".*"&&(j+=-50)}D.push(j)}s.push(D)}if(r.strict&&r.end){const S=s.length-1;s[S][s[S].length-1]+=.7000000000000001}r.strict||(c+="/?"),r.end?c+="$":r.strict&&(c+="(?:/|$)");const _=new RegExp(c,r.sensitive?"":"i");function x(S){const D=S.match(_),I={};if(!D)return null;for(let V=1;V<D.length;V++){const j=D[V]||"",Q=d[V-1];I[Q.name]=j&&Q.repeatable?j.split("/"):j}return I}function l(S){let D="",I=!1;for(const V of n){(!I||!D.endsWith("/"))&&(D+="/"),I=!1;for(const j of V)if(j.type===0)D+=j.value;else if(j.type===1){const{value:Q,repeatable:te,optional:ce}=j,Ce=Q in S?S[Q]:"";if(Sc(Ce)&&!te)throw new Error(`Provided param "${Q}" is an array but it is not repeatable (* or + modifiers)`);const Me=Sc(Ce)?Ce.join("/"):Ce;if(!Me)if(ce)V.length<2&&(D.endsWith("/")?D=D.slice(0,-1):I=!0);else throw new Error(`Missing required param "${Q}"`);D+=Me}}return D||"/"}return{re:_,score:s,keys:d,parse:x,stringify:l}}function gH(n,e){let r=0;for(;r<n.length&&r<e.length;){const s=e[r]-n[r];if(s)return s;r++}return n.length<e.length?n.length===1&&n[0]===80?-1:1:n.length>e.length?e.length===1&&e[0]===80?1:-1:0}function yH(n,e){let r=0;const s=n.score,c=e.score;for(;r<s.length&&r<c.length;){const d=gH(s[r],c[r]);if(d)return d;r++}if(Math.abs(c.length-s.length)===1){if(gk(s))return 1;if(gk(c))return-1}return c.length-s.length}function gk(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const vH={type:0,value:""},xH=/[a-zA-Z0-9_]/;function bH(n){if(!n)return[[]];if(n==="/")return[[vH]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(j){throw new Error(`ERR (${r})/"${S}": ${j}`)}let r=0,s=r;const c=[];let d;function _(){d&&c.push(d),d=[]}let x=0,l,S="",D="";function I(){S&&(r===0?d.push({type:0,value:S}):r===1||r===2||r===3?(d.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${S}) must be alone in its segment. eg: '/:ids+.`),d.push({type:1,value:S,regexp:D,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),S="")}function V(){S+=l}for(;x<n.length;){if(l=n[x++],l==="\\"&&r!==2){s=r,r=4;continue}switch(r){case 0:l==="/"?(S&&I(),_()):l===":"?(I(),r=1):V();break;case 4:V(),r=s;break;case 1:l==="("?r=2:xH.test(l)?V():(I(),r=0,l!=="*"&&l!=="?"&&l!=="+"&&x--);break;case 2:l===")"?D[D.length-1]=="\\"?D=D.slice(0,-1)+l:r=3:D+=l;break;case 3:I(),r=0,l!=="*"&&l!=="?"&&l!=="+"&&x--,D="";break;default:e("Unknown state");break}}return r===2&&e(`Unfinished custom RegExp for param "${S}"`),I(),_(),c}function wH(n,e,r){const s=_H(bH(n.path),r),c=Pn(s,{record:n,parent:e,children:[],alias:[]});return e&&!c.record.aliasOf==!e.record.aliasOf&&e.children.push(c),c}function TH(n,e){const r=[],s=new Map;e=xk({strict:!1,end:!0,sensitive:!1},e);function c(D){return s.get(D)}function d(D,I,V){const j=!V,Q=EH(D);Q.aliasOf=V&&V.record;const te=xk(e,D),ce=[Q];if("alias"in D){const Ie=typeof D.alias=="string"?[D.alias]:D.alias;for(const Te of Ie)ce.push(Pn({},Q,{components:V?V.record.components:Q.components,path:Te,aliasOf:V?V.record:Q}))}let Ce,Me;for(const Ie of ce){const{path:Te}=Ie;if(I&&Te[0]!=="/"){const Ge=I.record.path,$e=Ge[Ge.length-1]==="/"?"":"/";Ie.path=I.record.path+(Te&&$e+Te)}if(Ce=wH(Ie,I,te),V?V.alias.push(Ce):(Me=Me||Ce,Me!==Ce&&Me.alias.push(Ce),j&&D.name&&!vk(Ce)&&_(D.name)),Q.children){const Ge=Q.children;for(let $e=0;$e<Ge.length;$e++)d(Ge[$e],Ce,V&&V.children[$e])}V=V||Ce,(Ce.record.components&&Object.keys(Ce.record.components).length||Ce.record.name||Ce.record.redirect)&&l(Ce)}return Me?()=>{_(Me)}:fv}function _(D){if(uF(D)){const I=s.get(D);I&&(s.delete(D),r.splice(r.indexOf(I),1),I.children.forEach(_),I.alias.forEach(_))}else{const I=r.indexOf(D);I>-1&&(r.splice(I,1),D.record.name&&s.delete(D.record.name),D.children.forEach(_),D.alias.forEach(_))}}function x(){return r}function l(D){let I=0;for(;I<r.length&&yH(D,r[I])>=0&&(D.record.path!==r[I].record.path||!dF(D,r[I]));)I++;r.splice(I,0,D),D.record.name&&!vk(D)&&s.set(D.record.name,D)}function S(D,I){let V,j={},Q,te;if("name"in D&&D.name){if(V=s.get(D.name),!V)throw Eg(1,{location:D});te=V.record.name,j=Pn(yk(I.params,V.keys.filter(Me=>!Me.optional).concat(V.parent?V.parent.keys.filter(Me=>Me.optional):[]).map(Me=>Me.name)),D.params&&yk(D.params,V.keys.map(Me=>Me.name))),Q=V.stringify(j)}else if(D.path!=null)Q=D.path,V=r.find(Me=>Me.re.test(Q)),V&&(j=V.parse(Q),te=V.record.name);else{if(V=I.name?s.get(I.name):r.find(Me=>Me.re.test(I.path)),!V)throw Eg(1,{location:D,currentLocation:I});te=V.record.name,j=Pn({},I.params,D.params),Q=V.stringify(j)}const ce=[];let Ce=V;for(;Ce;)ce.unshift(Ce.record),Ce=Ce.parent;return{name:te,path:Q,params:j,matched:ce,meta:IH(ce)}}return n.forEach(D=>d(D)),{addRoute:d,resolve:S,removeRoute:_,getRoutes:x,getRecordMatcher:c}}function yk(n,e){const r={};for(const s of e)s in n&&(r[s]=n[s]);return r}function EH(n){return{path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:void 0,beforeEnter:n.beforeEnter,props:AH(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}}}function AH(n){const e={},r=n.props||!1;if("component"in n)e.default=r;else for(const s in n.components)e[s]=typeof r=="object"?r[s]:r;return e}function vk(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function IH(n){return n.reduce((e,r)=>Pn(e,r.meta),{})}function xk(n,e){const r={};for(const s in n)r[s]=s in e?e[s]:n[s];return r}function dF(n,e){return e.children.some(r=>r===n||dF(n,r))}function SH(n){const e={};if(n===""||n==="?")return e;const s=(n[0]==="?"?n.slice(1):n).split("&");for(let c=0;c<s.length;++c){const d=s[c].replace(nF," "),_=d.indexOf("="),x=Gv(_<0?d:d.slice(0,_)),l=_<0?null:Gv(d.slice(_+1));if(x in e){let S=e[x];Sc(S)||(S=e[x]=[S]),S.push(l)}else e[x]=l}return e}function bk(n){let e="";for(let r in n){const s=n[r];if(r=Hq(r),s==null){s!==void 0&&(e+=(e.length?"&":"")+r);continue}(Sc(s)?s.map(d=>d&&JA(d)):[s&&JA(s)]).forEach(d=>{d!==void 0&&(e+=(e.length?"&":"")+r,d!=null&&(e+="="+d))})}return e}function CH(n){const e={};for(const r in n){const s=n[r];s!==void 0&&(e[r]=Sc(s)?s.map(c=>c==null?null:""+c):s==null?s:""+s)}return e}const RH=Symbol(""),wk=Symbol(""),YT=Symbol(""),sC=Symbol(""),tI=Symbol("");function My(){let n=[];function e(s){return n.push(s),()=>{const c=n.indexOf(s);c>-1&&n.splice(c,1)}}function r(){n=[]}return{add:e,list:()=>n.slice(),reset:r}}function Ad(n,e,r,s,c,d=_=>_()){const _=s&&(s.enterCallbacks[c]=s.enterCallbacks[c]||[]);return()=>new Promise((x,l)=>{const S=V=>{V===!1?l(Eg(4,{from:r,to:e})):V instanceof Error?l(V):fH(V)?l(Eg(2,{from:e,to:V})):(_&&s.enterCallbacks[c]===_&&typeof V=="function"&&_.push(V),x())},D=d(()=>n.call(s&&s.instances[c],e,r,S));let I=Promise.resolve(D);n.length<3&&(I=I.then(S)),I.catch(V=>l(V))})}function G4(n,e,r,s,c=d=>d()){const d=[];for(const _ of n)for(const x in _.components){let l=_.components[x];if(!(e!=="beforeRouteEnter"&&!_.instances[x]))if(PH(l)){const D=(l.__vccOpts||l)[e];D&&d.push(Ad(D,r,s,_,x,c))}else{let S=l();d.push(()=>S.then(D=>{if(!D)return Promise.reject(new Error(`Couldn't resolve component "${x}" at "${_.path}"`));const I=Oq(D)?D.default:D;_.components[x]=I;const j=(I.__vccOpts||I)[e];return j&&Ad(j,r,s,_,x,c)()}))}}return d}function PH(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function Tk(n){const e=Fa(YT),r=Fa(sC),s=wo(()=>{const l=Hi(n.to);return e.resolve(l)}),c=wo(()=>{const{matched:l}=s.value,{length:S}=l,D=l[S-1],I=r.matched;if(!D||!I.length)return-1;const V=I.findIndex(Tg.bind(null,D));if(V>-1)return V;const j=Ek(l[S-2]);return S>1&&Ek(D)===j&&I[I.length-1].path!==j?I.findIndex(Tg.bind(null,l[S-2])):V}),d=wo(()=>c.value>-1&&DH(r.params,s.value.params)),_=wo(()=>c.value>-1&&c.value===r.matched.length-1&&lF(r.params,s.value.params));function x(l={}){return kH(l)?e[Hi(n.replace)?"replace":"push"](Hi(n.to)).catch(fv):Promise.resolve()}return{route:s,href:wo(()=>s.value.href),isActive:d,isExactActive:_,navigate:x}}const MH=Ro({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Tk,setup(n,{slots:e}){const r=UT(Tk(n)),{options:s}=Fa(YT),c=wo(()=>({[Ak(n.activeClass,s.linkActiveClass,"router-link-active")]:r.isActive,[Ak(n.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:r.isExactActive}));return()=>{const d=e.default&&e.default(r);return n.custom?d:rF("a",{"aria-current":r.isExactActive?n.ariaCurrentValue:null,href:r.href,onClick:r.navigate,class:c.value},d)}}}),fF=MH;function kH(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function DH(n,e){for(const r in e){const s=e[r],c=n[r];if(typeof s=="string"){if(s!==c)return!1}else if(!Sc(c)||c.length!==s.length||s.some((d,_)=>d!==c[_]))return!1}return!0}function Ek(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const Ak=(n,e,r)=>n??e??r,LH=Ro({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:r}){const s=Fa(tI),c=wo(()=>n.route||s.value),d=Fa(wk,0),_=wo(()=>{let S=Hi(d);const{matched:D}=c.value;let I;for(;(I=D[S])&&!I.components;)S++;return S}),x=wo(()=>c.value.matched[_.value]);hw(wk,wo(()=>_.value+1)),hw(RH,x),hw(tI,c);const l=mn();return Bd(()=>[l.value,x.value,n.name],([S,D,I],[V,j,Q])=>{D&&(D.instances[I]=S,j&&j!==D&&S&&S===V&&(D.leaveGuards.size||(D.leaveGuards=j.leaveGuards),D.updateGuards.size||(D.updateGuards=j.updateGuards))),S&&D&&(!j||!Tg(D,j)||!V)&&(D.enterCallbacks[I]||[]).forEach(te=>te(S))},{flush:"post"}),()=>{const S=c.value,D=n.name,I=x.value,V=I&&I.components[D];if(!V)return Ik(r.default,{Component:V,route:S});const j=I.props[D],Q=j?j===!0?S.params:typeof j=="function"?j(S):j:null,ce=rF(V,Pn({},Q,e,{onVnodeUnmounted:Ce=>{Ce.component.isUnmounted&&(I.instances[D]=null)},ref:l}));return Ik(r.default,{Component:ce,route:S})||ce}}});function Ik(n,e){if(!n)return null;const r=n(e);return r.length===1?r[0]:r}const pF=LH;function OH(n){const e=TH(n.routes,n),r=n.parseQuery||SH,s=n.stringifyQuery||bk,c=n.history,d=My(),_=My(),x=My(),l=Ez(yd);let S=yd;B_&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const D=j4.bind(null,yt=>""+yt),I=j4.bind(null,Zq),V=j4.bind(null,Gv);function j(yt,dt){let jt,$t;return uF(yt)?(jt=e.getRecordMatcher(yt),$t=dt):$t=yt,e.addRoute($t,jt)}function Q(yt){const dt=e.getRecordMatcher(yt);dt&&e.removeRoute(dt)}function te(){return e.getRoutes().map(yt=>yt.record)}function ce(yt){return!!e.getRecordMatcher(yt)}function Ce(yt,dt){if(dt=Pn({},dt||l.value),typeof yt=="string"){const Ae=$4(r,yt,dt.path),Ze=e.resolve({path:Ae.path},dt),lt=c.createHref(Ae.fullPath);return Pn(Ae,Ze,{params:V(Ze.params),hash:Gv(Ae.hash),redirectedFrom:void 0,href:lt})}let jt;if(yt.path!=null)jt=Pn({},yt,{path:$4(r,yt.path,dt.path).path});else{const Ae=Pn({},yt.params);for(const Ze in Ae)Ae[Ze]==null&&delete Ae[Ze];jt=Pn({},yt,{params:I(Ae)}),dt.params=I(dt.params)}const $t=e.resolve(jt,dt),Mr=yt.hash||"";$t.params=D(V($t.params));const Er=Qq(s,Pn({},yt,{hash:qq(Mr),path:$t.path})),be=c.createHref(Er);return Pn({fullPath:Er,hash:Mr,query:s===bk?CH(yt.query):yt.query||{}},$t,{redirectedFrom:void 0,href:be})}function Me(yt){return typeof yt=="string"?$4(r,yt,l.value.path):Pn({},yt)}function Ie(yt,dt){if(S!==yt)return Eg(8,{from:dt,to:yt})}function Te(yt){return ue(yt)}function Ge(yt){return Te(Pn(Me(yt),{replace:!0}))}function $e(yt){const dt=yt.matched[yt.matched.length-1];if(dt&&dt.redirect){const{redirect:jt}=dt;let $t=typeof jt=="function"?jt(yt):jt;return typeof $t=="string"&&($t=$t.includes("?")||$t.includes("#")?$t=Me($t):{path:$t},$t.params={}),Pn({query:yt.query,hash:yt.hash,params:$t.path!=null?{}:yt.params},$t)}}function ue(yt,dt){const jt=S=Ce(yt),$t=l.value,Mr=yt.state,Er=yt.force,be=yt.replace===!0,Ae=$e(jt);if(Ae)return ue(Pn(Me(Ae),{state:typeof Ae=="object"?Pn({},Mr,Ae.state):Mr,force:Er,replace:be}),dt||jt);const Ze=jt;Ze.redirectedFrom=dt;let lt;return!Er&&Kq(s,$t,jt)&&(lt=Eg(16,{to:Ze,from:$t}),Sr($t,$t,!0,!1)),(lt?Promise.resolve(lt):ge(Ze,$t)).catch(Ee=>Ju(Ee)?Ju(Ee,2)?Ee:We(Ee):Kt(Ee,Ze,$t)).then(Ee=>{if(Ee){if(Ju(Ee,2))return ue(Pn({replace:be},Me(Ee.to),{state:typeof Ee.to=="object"?Pn({},Mr,Ee.to.state):Mr,force:Er}),dt||Ze)}else Ee=De(Ze,$t,!0,be,Mr);return Fe(Ze,$t,Ee),Ee})}function pe(yt,dt){const jt=Ie(yt,dt);return jt?Promise.reject(jt):Promise.resolve()}function _e(yt){const dt=Fr.values().next().value;return dt&&typeof dt.runWithContext=="function"?dt.runWithContext(yt):yt()}function ge(yt,dt){let jt;const[$t,Mr,Er]=zH(yt,dt);jt=G4($t.reverse(),"beforeRouteLeave",yt,dt);for(const Ae of $t)Ae.leaveGuards.forEach(Ze=>{jt.push(Ad(Ze,yt,dt))});const be=pe.bind(null,yt,dt);return jt.push(be),qr(jt).then(()=>{jt=[];for(const Ae of d.list())jt.push(Ad(Ae,yt,dt));return jt.push(be),qr(jt)}).then(()=>{jt=G4(Mr,"beforeRouteUpdate",yt,dt);for(const Ae of Mr)Ae.updateGuards.forEach(Ze=>{jt.push(Ad(Ze,yt,dt))});return jt.push(be),qr(jt)}).then(()=>{jt=[];for(const Ae of Er)if(Ae.beforeEnter)if(Sc(Ae.beforeEnter))for(const Ze of Ae.beforeEnter)jt.push(Ad(Ze,yt,dt));else jt.push(Ad(Ae.beforeEnter,yt,dt));return jt.push(be),qr(jt)}).then(()=>(yt.matched.forEach(Ae=>Ae.enterCallbacks={}),jt=G4(Er,"beforeRouteEnter",yt,dt,_e),jt.push(be),qr(jt))).then(()=>{jt=[];for(const Ae of _.list())jt.push(Ad(Ae,yt,dt));return jt.push(be),qr(jt)}).catch(Ae=>Ju(Ae,8)?Ae:Promise.reject(Ae))}function Fe(yt,dt,jt){x.list().forEach($t=>_e(()=>$t(yt,dt,jt)))}function De(yt,dt,jt,$t,Mr){const Er=Ie(yt,dt);if(Er)return Er;const be=dt===yd,Ae=B_?history.state:{};jt&&($t||be?c.replace(yt.fullPath,Pn({scroll:be&&Ae&&Ae.scroll},Mr)):c.push(yt.fullPath,Mr)),l.value=yt,Sr(yt,dt,jt,be),We()}let Se;function pr(){Se||(Se=c.listen((yt,dt,jt)=>{if(!gi.listening)return;const $t=Ce(yt),Mr=$e($t);if(Mr){ue(Pn(Mr,{replace:!0}),$t).catch(fv);return}S=$t;const Er=l.value;B_&&oH(fk(Er.fullPath,jt.delta),XT()),ge($t,Er).catch(be=>Ju(be,12)?be:Ju(be,2)?(ue(be.to,$t).then(Ae=>{Ju(Ae,20)&&!jt.delta&&jt.type===qv.pop&&c.go(-1,!1)}).catch(fv),Promise.reject()):(jt.delta&&c.go(-jt.delta,!1),Kt(be,$t,Er))).then(be=>{be=be||De($t,Er,!1),be&&(jt.delta&&!Ju(be,8)?c.go(-jt.delta,!1):jt.type===qv.pop&&Ju(be,20)&&c.go(-1,!1)),Fe($t,Er,be)}).catch(fv)}))}let or=My(),Vt=My(),Ht;function Kt(yt,dt,jt){We(yt);const $t=Vt.list();return $t.length?$t.forEach(Mr=>Mr(yt,dt,jt)):console.error(yt),Promise.reject(yt)}function Tr(){return Ht&&l.value!==yd?Promise.resolve():new Promise((yt,dt)=>{or.add([yt,dt])})}function We(yt){return Ht||(Ht=!yt,pr(),or.list().forEach(([dt,jt])=>yt?jt(yt):dt()),or.reset()),yt}function Sr(yt,dt,jt,$t){const{scrollBehavior:Mr}=n;if(!B_||!Mr)return Promise.resolve();const Er=!jt&&aH(fk(yt.fullPath,0))||($t||!jt)&&history.state&&history.state.scroll||null;return KS().then(()=>Mr(yt,dt,Er)).then(be=>be&&sH(be)).catch(be=>Kt(be,yt,dt))}const Xt=yt=>c.go(yt);let ei;const Fr=new Set,gi={currentRoute:l,listening:!0,addRoute:j,removeRoute:Q,hasRoute:ce,getRoutes:te,resolve:Ce,options:n,push:Te,replace:Ge,go:Xt,back:()=>Xt(-1),forward:()=>Xt(1),beforeEach:d.add,beforeResolve:_.add,afterEach:x.add,onError:Vt.add,isReady:Tr,install(yt){const dt=this;yt.component("RouterLink",fF),yt.component("RouterView",pF),yt.config.globalProperties.$router=dt,Object.defineProperty(yt.config.globalProperties,"$route",{enumerable:!0,get:()=>Hi(l)}),B_&&!ei&&l.value===yd&&(ei=!0,Te(c.location).catch(Mr=>{}));const jt={};for(const Mr in yd)Object.defineProperty(jt,Mr,{get:()=>l.value[Mr],enumerable:!0});yt.provide(YT,dt),yt.provide(sC,yz(jt)),yt.provide(tI,l);const $t=yt.unmount;Fr.add(yt),yt.unmount=function(){Fr.delete(yt),Fr.size<1&&(S=yd,Se&&Se(),Se=null,l.value=yd,ei=!1,Ht=!1),$t()}}};function qr(yt){return yt.reduce((dt,jt)=>dt.then(()=>_e(jt)),Promise.resolve())}return gi}function zH(n,e){const r=[],s=[],c=[],d=Math.max(e.matched.length,n.matched.length);for(let _=0;_<d;_++){const x=e.matched[_];x&&(n.matched.find(S=>Tg(S,x))?s.push(x):r.push(x));const l=n.matched[_];l&&(e.matched.find(S=>Tg(S,l))||c.push(l))}return[r,s,c]}function FH(){return Fa(YT)}function mF(){return Fa(sC)}var Sk={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _F={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const br=function(n,e){if(!n)throw Zg(e)},Zg=function(n){return new Error("Firebase Database ("+_F.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gF=function(n){const e=[];let r=0;for(let s=0;s<n.length;s++){let c=n.charCodeAt(s);c<128?e[r++]=c:c<2048?(e[r++]=c>>6|192,e[r++]=c&63|128):(c&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(c=65536+((c&1023)<<10)+(n.charCodeAt(++s)&1023),e[r++]=c>>18|240,e[r++]=c>>12&63|128,e[r++]=c>>6&63|128,e[r++]=c&63|128):(e[r++]=c>>12|224,e[r++]=c>>6&63|128,e[r++]=c&63|128)}return e},NH=function(n){const e=[];let r=0,s=0;for(;r<n.length;){const c=n[r++];if(c<128)e[s++]=String.fromCharCode(c);else if(c>191&&c<224){const d=n[r++];e[s++]=String.fromCharCode((c&31)<<6|d&63)}else if(c>239&&c<365){const d=n[r++],_=n[r++],x=n[r++],l=((c&7)<<18|(d&63)<<12|(_&63)<<6|x&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const d=n[r++],_=n[r++];e[s++]=String.fromCharCode((c&15)<<12|(d&63)<<6|_&63)}}return e.join("")},QT={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let c=0;c<n.length;c+=3){const d=n[c],_=c+1<n.length,x=_?n[c+1]:0,l=c+2<n.length,S=l?n[c+2]:0,D=d>>2,I=(d&3)<<4|x>>4;let V=(x&15)<<2|S>>6,j=S&63;l||(j=64,_||(V=64)),s.push(r[D],r[I],r[V],r[j])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(gF(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):NH(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const r=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let c=0;c<n.length;){const d=r[n.charAt(c++)],x=c<n.length?r[n.charAt(c)]:0;++c;const S=c<n.length?r[n.charAt(c)]:64;++c;const I=c<n.length?r[n.charAt(c)]:64;if(++c,d==null||x==null||S==null||I==null)throw new BH;const V=d<<2|x>>4;if(s.push(V),S!==64){const j=x<<4&240|S>>2;if(s.push(j),I!==64){const Q=S<<6&192|I;s.push(Q)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class BH extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const yF=function(n){const e=gF(n);return QT.encodeByteArray(e,!0)},Vw=function(n){return yF(n).replace(/\./g,"")},Uw=function(n){try{return QT.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VH(n){return vF(void 0,n)}function vF(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const r=e;return new Date(r.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const r in e)!e.hasOwnProperty(r)||!UH(r)||(n[r]=vF(n[r],e[r]));return n}function UH(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jH(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $H=()=>jH().__FIREBASE_DEFAULTS__,GH=()=>{if(typeof process>"u"||typeof Sk>"u")return;const n=Sk.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},qH=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Uw(n[1]);return e&&JSON.parse(e)},KT=()=>{try{return $H()||GH()||qH()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},HH=n=>{var e,r;return(r=(e=KT())===null||e===void 0?void 0:e.emulatorHosts)===null||r===void 0?void 0:r[n]},WH=n=>{const e=HH(n);if(!e)return;const r=e.lastIndexOf(":");if(r<=0||r+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(r+1),10);return e[0]==="["?[e.substring(1,r-1),s]:[e.substring(0,r),s]},xF=()=>{var n;return(n=KT())===null||n===void 0?void 0:n.config},ZH=n=>{var e;return(e=KT())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hv{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}wrapCallback(e){return(r,s)=>{r?this.reject(r):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(r):e(r,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XH(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r={alg:"none",type:"JWT"},s=e||"demo-project",c=n.iat||0,d=n.sub||n.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const _=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:c,exp:c+3600,auth_time:c,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Vw(JSON.stringify(r)),Vw(JSON.stringify(_)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Co(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function oC(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Co())}function YH(){var n;const e=(n=KT())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function bF(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function wF(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function QH(){const n=Co();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function TF(){return _F.NODE_ADMIN===!0}function KH(){return!YH()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function aC(){try{return typeof indexedDB=="object"}catch{return!1}}function EF(){return new Promise((n,e)=>{try{let r=!0;const s="validate-browser-context-for-indexeddb-analytics-module",c=self.indexedDB.open(s);c.onsuccess=()=>{c.result.close(),r||self.indexedDB.deleteDatabase(s),n(!0)},c.onupgradeneeded=()=>{r=!1},c.onerror=()=>{var d;e(((d=c.error)===null||d===void 0?void 0:d.message)||"")}}catch(r){e(r)}})}function JH(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eW="FirebaseError";class Wl extends Error{constructor(e,r,s){super(r),this.code=e,this.customData=s,this.name=eW,Object.setPrototypeOf(this,Wl.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,lf.prototype.create)}}class lf{constructor(e,r,s){this.service=e,this.serviceName=r,this.errors=s}create(e,...r){const s=r[0]||{},c=`${this.service}/${e}`,d=this.errors[e],_=d?tW(d,s):"Error",x=`${this.serviceName}: ${_} (${c}).`;return new Wl(c,x,s)}}function tW(n,e){return n.replace(rW,(r,s)=>{const c=e[s];return c!=null?String(c):`<${s}?>`})}const rW=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wv(n){return JSON.parse(n)}function To(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AF=function(n){let e={},r={},s={},c="";try{const d=n.split(".");e=Wv(Uw(d[0])||""),r=Wv(Uw(d[1])||""),c=d[2],s=r.d||{},delete r.d}catch{}return{header:e,claims:r,data:s,signature:c}},iW=function(n){const e=AF(n),r=e.claims;return!!r&&typeof r=="object"&&r.hasOwnProperty("iat")},nW=function(n){const e=AF(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bh(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ag(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function rI(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function jw(n,e,r){const s={};for(const c in n)Object.prototype.hasOwnProperty.call(n,c)&&(s[c]=e.call(r,n[c],c,n));return s}function Zv(n,e){if(n===e)return!0;const r=Object.keys(n),s=Object.keys(e);for(const c of r){if(!s.includes(c))return!1;const d=n[c],_=e[c];if(Ck(d)&&Ck(_)){if(!Zv(d,_))return!1}else if(d!==_)return!1}for(const c of s)if(!r.includes(c))return!1;return!0}function Ck(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xg(n){const e=[];for(const[r,s]of Object.entries(n))Array.isArray(s)?s.forEach(c=>{e.push(encodeURIComponent(r)+"="+encodeURIComponent(c))}):e.push(encodeURIComponent(r)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function Hy(n){const e={};return n.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[c,d]=s.split("=");e[decodeURIComponent(c)]=decodeURIComponent(d)}}),e}function Wy(n){const e=n.indexOf("?");if(!e)return"";const r=n.indexOf("#",e);return n.substring(e,r>0?r:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sW{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,r){r||(r=0);const s=this.W_;if(typeof e=="string")for(let I=0;I<16;I++)s[I]=e.charCodeAt(r)<<24|e.charCodeAt(r+1)<<16|e.charCodeAt(r+2)<<8|e.charCodeAt(r+3),r+=4;else for(let I=0;I<16;I++)s[I]=e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3],r+=4;for(let I=16;I<80;I++){const V=s[I-3]^s[I-8]^s[I-14]^s[I-16];s[I]=(V<<1|V>>>31)&4294967295}let c=this.chain_[0],d=this.chain_[1],_=this.chain_[2],x=this.chain_[3],l=this.chain_[4],S,D;for(let I=0;I<80;I++){I<40?I<20?(S=x^d&(_^x),D=1518500249):(S=d^_^x,D=1859775393):I<60?(S=d&_|x&(d|_),D=2400959708):(S=d^_^x,D=3395469782);const V=(c<<5|c>>>27)+S+l+D+s[I]&4294967295;l=x,x=_,_=(d<<30|d>>>2)&4294967295,d=c,c=V}this.chain_[0]=this.chain_[0]+c&4294967295,this.chain_[1]=this.chain_[1]+d&4294967295,this.chain_[2]=this.chain_[2]+_&4294967295,this.chain_[3]=this.chain_[3]+x&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,r){if(e==null)return;r===void 0&&(r=e.length);const s=r-this.blockSize;let c=0;const d=this.buf_;let _=this.inbuf_;for(;c<r;){if(_===0)for(;c<=s;)this.compress_(e,c),c+=this.blockSize;if(typeof e=="string"){for(;c<r;)if(d[_]=e.charCodeAt(c),++_,++c,_===this.blockSize){this.compress_(d),_=0;break}}else for(;c<r;)if(d[_]=e[c],++_,++c,_===this.blockSize){this.compress_(d),_=0;break}}this.inbuf_=_,this.total_+=r}digest(){const e=[];let r=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let c=this.blockSize-1;c>=56;c--)this.buf_[c]=r&255,r/=256;this.compress_(this.buf_);let s=0;for(let c=0;c<5;c++)for(let d=24;d>=0;d-=8)e[s]=this.chain_[c]>>d&255,++s;return e}}function oW(n,e){const r=new aW(n,e);return r.subscribe.bind(r)}class aW{constructor(e,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(r=>{r.next(e)})}error(e){this.forEachObserver(r=>{r.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,r,s){let c;if(e===void 0&&r===void 0&&s===void 0)throw new Error("Missing Observer.");lW(e,["next","error","complete"])?c=e:c={next:e,error:r,complete:s},c.next===void 0&&(c.next=q4),c.error===void 0&&(c.error=q4),c.complete===void 0&&(c.complete=q4);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?c.error(this.finalError):c.complete()}catch{}}),this.observers.push(c),d}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,e)}sendOne(e,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{r(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function lW(n,e){if(typeof n!="object"||n===null)return!1;for(const r of e)if(r in n&&typeof n[r]=="function")return!0;return!1}function q4(){}function cW(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uW=function(n){const e=[];let r=0;for(let s=0;s<n.length;s++){let c=n.charCodeAt(s);if(c>=55296&&c<=56319){const d=c-55296;s++,br(s<n.length,"Surrogate pair missing trail surrogate.");const _=n.charCodeAt(s)-56320;c=65536+(d<<10)+_}c<128?e[r++]=c:c<2048?(e[r++]=c>>6|192,e[r++]=c&63|128):c<65536?(e[r++]=c>>12|224,e[r++]=c>>6&63|128,e[r++]=c&63|128):(e[r++]=c>>18|240,e[r++]=c>>12&63|128,e[r++]=c>>6&63|128,e[r++]=c&63|128)}return e},JT=function(n){let e=0;for(let r=0;r<n.length;r++){const s=n.charCodeAt(r);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,r++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hW=1e3,dW=2,fW=4*60*60*1e3,pW=.5;function Rk(n,e=hW,r=dW){const s=e*Math.pow(r,n),c=Math.round(pW*s*(Math.random()-.5)*2);return Math.min(fW,s+c)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function va(n){return n&&n._delegate?n._delegate:n}class xa{constructor(e,r,s){this.name=e,this.instanceFactory=r,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xp="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mW{constructor(e,r){this.name=e,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const r=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(r)){const s=new Hv;if(this.instancesDeferred.set(r,s),this.isInitialized(r)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:r});c&&s.resolve(c)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(e){var r;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),c=(r=e==null?void 0:e.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(d){if(c)return null;throw d}else{if(c)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(gW(e))try{this.getOrInitializeService({instanceIdentifier:xp})}catch{}for(const[r,s]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(r);try{const d=this.getOrInitializeService({instanceIdentifier:c});s.resolve(d)}catch{}}}}clearInstance(e=xp){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...e.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=xp){return this.instances.has(e)}getOptions(e=xp){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:r={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:s,options:r});for(const[d,_]of this.instancesDeferred.entries()){const x=this.normalizeInstanceIdentifier(d);s===x&&_.resolve(c)}return c}onInit(e,r){var s;const c=this.normalizeInstanceIdentifier(r),d=(s=this.onInitCallbacks.get(c))!==null&&s!==void 0?s:new Set;d.add(e),this.onInitCallbacks.set(c,d);const _=this.instances.get(c);return _&&e(_,c),()=>{d.delete(e)}}invokeOnInitCallbacks(e,r){const s=this.onInitCallbacks.get(r);if(s)for(const c of s)try{c(e,r)}catch{}}getOrInitializeService({instanceIdentifier:e,options:r={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:_W(e),options:r}),this.instances.set(e,s),this.instancesOptions.set(e,r),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=xp){return this.component?this.component.multipleInstances?e:xp:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function _W(n){return n===xp?void 0:n}function gW(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yW{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const r=this.getProvider(e.name);if(r.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);r.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const r=new mW(e,this);return this.providers.set(e,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ji;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Ji||(Ji={}));const vW={debug:Ji.DEBUG,verbose:Ji.VERBOSE,info:Ji.INFO,warn:Ji.WARN,error:Ji.ERROR,silent:Ji.SILENT},xW=Ji.INFO,bW={[Ji.DEBUG]:"log",[Ji.VERBOSE]:"log",[Ji.INFO]:"info",[Ji.WARN]:"warn",[Ji.ERROR]:"error"},wW=(n,e,...r)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),c=bW[e];if(c)console[c](`[${s}]  ${n.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Yg{constructor(e){this.name=e,this._logLevel=xW,this._logHandler=wW,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ji))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?vW[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ji.DEBUG,...e),this._logHandler(this,Ji.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ji.VERBOSE,...e),this._logHandler(this,Ji.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ji.INFO,...e),this._logHandler(this,Ji.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ji.WARN,...e),this._logHandler(this,Ji.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ji.ERROR,...e),this._logHandler(this,Ji.ERROR,...e)}}const TW=(n,e)=>e.some(r=>n instanceof r);let Pk,Mk;function EW(){return Pk||(Pk=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function AW(){return Mk||(Mk=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const IF=new WeakMap,iI=new WeakMap,SF=new WeakMap,H4=new WeakMap,lC=new WeakMap;function IW(n){const e=new Promise((r,s)=>{const c=()=>{n.removeEventListener("success",d),n.removeEventListener("error",_)},d=()=>{r(Vd(n.result)),c()},_=()=>{s(n.error),c()};n.addEventListener("success",d),n.addEventListener("error",_)});return e.then(r=>{r instanceof IDBCursor&&IF.set(r,n)}).catch(()=>{}),lC.set(e,n),e}function SW(n){if(iI.has(n))return;const e=new Promise((r,s)=>{const c=()=>{n.removeEventListener("complete",d),n.removeEventListener("error",_),n.removeEventListener("abort",_)},d=()=>{r(),c()},_=()=>{s(n.error||new DOMException("AbortError","AbortError")),c()};n.addEventListener("complete",d),n.addEventListener("error",_),n.addEventListener("abort",_)});iI.set(n,e)}let nI={get(n,e,r){if(n instanceof IDBTransaction){if(e==="done")return iI.get(n);if(e==="objectStoreNames")return n.objectStoreNames||SF.get(n);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Vd(n[e])},set(n,e,r){return n[e]=r,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function CW(n){nI=n(nI)}function RW(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...r){const s=n.call(W4(this),e,...r);return SF.set(s,e.sort?e.sort():[e]),Vd(s)}:AW().includes(n)?function(...e){return n.apply(W4(this),e),Vd(IF.get(this))}:function(...e){return Vd(n.apply(W4(this),e))}}function PW(n){return typeof n=="function"?RW(n):(n instanceof IDBTransaction&&SW(n),TW(n,EW())?new Proxy(n,nI):n)}function Vd(n){if(n instanceof IDBRequest)return IW(n);if(H4.has(n))return H4.get(n);const e=PW(n);return e!==n&&(H4.set(n,e),lC.set(e,n)),e}const W4=n=>lC.get(n);function CF(n,e,{blocked:r,upgrade:s,blocking:c,terminated:d}={}){const _=indexedDB.open(n,e),x=Vd(_);return s&&_.addEventListener("upgradeneeded",l=>{s(Vd(_.result),l.oldVersion,l.newVersion,Vd(_.transaction),l)}),r&&_.addEventListener("blocked",l=>r(l.oldVersion,l.newVersion,l)),x.then(l=>{d&&l.addEventListener("close",()=>d()),c&&l.addEventListener("versionchange",S=>c(S.oldVersion,S.newVersion,S))}).catch(()=>{}),x}const MW=["get","getKey","getAll","getAllKeys","count"],kW=["put","add","delete","clear"],Z4=new Map;function kk(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Z4.get(e))return Z4.get(e);const r=e.replace(/FromIndex$/,""),s=e!==r,c=kW.includes(r);if(!(r in(s?IDBIndex:IDBObjectStore).prototype)||!(c||MW.includes(r)))return;const d=async function(_,...x){const l=this.transaction(_,c?"readwrite":"readonly");let S=l.store;return s&&(S=S.index(x.shift())),(await Promise.all([S[r](...x),c&&l.done]))[0]};return Z4.set(e,d),d}CW(n=>({...n,get:(e,r,s)=>kk(e,r)||n.get(e,r,s),has:(e,r)=>!!kk(e,r)||n.has(e,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DW{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(LW(r)){const s=r.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(r=>r).join(" ")}}function LW(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const sI="@firebase/app",Dk="0.10.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hp=new Yg("@firebase/app"),OW="@firebase/app-compat",zW="@firebase/analytics-compat",FW="@firebase/analytics",NW="@firebase/app-check-compat",BW="@firebase/app-check",VW="@firebase/auth",UW="@firebase/auth-compat",jW="@firebase/database",$W="@firebase/database-compat",GW="@firebase/functions",qW="@firebase/functions-compat",HW="@firebase/installations",WW="@firebase/installations-compat",ZW="@firebase/messaging",XW="@firebase/messaging-compat",YW="@firebase/performance",QW="@firebase/performance-compat",KW="@firebase/remote-config",JW="@firebase/remote-config-compat",eZ="@firebase/storage",tZ="@firebase/storage-compat",rZ="@firebase/firestore",iZ="@firebase/vertexai-preview",nZ="@firebase/firestore-compat",sZ="firebase",oZ="10.12.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oI="[DEFAULT]",aZ={[sI]:"fire-core",[OW]:"fire-core-compat",[FW]:"fire-analytics",[zW]:"fire-analytics-compat",[BW]:"fire-app-check",[NW]:"fire-app-check-compat",[VW]:"fire-auth",[UW]:"fire-auth-compat",[jW]:"fire-rtdb",[$W]:"fire-rtdb-compat",[GW]:"fire-fn",[qW]:"fire-fn-compat",[HW]:"fire-iid",[WW]:"fire-iid-compat",[ZW]:"fire-fcm",[XW]:"fire-fcm-compat",[YW]:"fire-perf",[QW]:"fire-perf-compat",[KW]:"fire-rc",[JW]:"fire-rc-compat",[eZ]:"fire-gcs",[tZ]:"fire-gcs-compat",[rZ]:"fire-fst",[nZ]:"fire-fst-compat",[iZ]:"fire-vertex","fire-js":"fire-js",[sZ]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $w=new Map,lZ=new Map,aI=new Map;function Lk(n,e){try{n.container.addComponent(e)}catch(r){Hp.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,r)}}function qa(n){const e=n.name;if(aI.has(e))return Hp.debug(`There were multiple attempts to register component ${e}.`),!1;aI.set(e,n);for(const r of $w.values())Lk(r,n);for(const r of lZ.values())Lk(r,n);return!0}function eE(n,e){const r=n.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),n.container.getProvider(e)}function Fl(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cZ={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ud=new lf("app","Firebase",cZ);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uZ{constructor(e,r,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new xa("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ud.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cf=oZ;function RF(n,e={}){let r=n;typeof e!="object"&&(e={name:e});const s=Object.assign({name:oI,automaticDataCollectionEnabled:!1},e),c=s.name;if(typeof c!="string"||!c)throw Ud.create("bad-app-name",{appName:String(c)});if(r||(r=xF()),!r)throw Ud.create("no-options");const d=$w.get(c);if(d){if(Zv(r,d.options)&&Zv(s,d.config))return d;throw Ud.create("duplicate-app",{appName:c})}const _=new yW(c);for(const l of aI.values())_.addComponent(l);const x=new uZ(r,s,_);return $w.set(c,x),x}function PF(n=oI){const e=$w.get(n);if(!e&&n===oI&&xF())return RF();if(!e)throw Ud.create("no-app",{appName:n});return e}function Io(n,e,r){var s;let c=(s=aZ[n])!==null&&s!==void 0?s:n;r&&(c+=`-${r}`);const d=c.match(/\s|\//),_=e.match(/\s|\//);if(d||_){const x=[`Unable to register library "${c}" with version "${e}":`];d&&x.push(`library name "${c}" contains illegal characters (whitespace or "/")`),d&&_&&x.push("and"),_&&x.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Hp.warn(x.join(" "));return}qa(new xa(`${c}-version`,()=>({library:c,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hZ="firebase-heartbeat-database",dZ=1,Xv="firebase-heartbeat-store";let X4=null;function MF(){return X4||(X4=CF(hZ,dZ,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Xv)}catch(r){console.warn(r)}}}}).catch(n=>{throw Ud.create("idb-open",{originalErrorMessage:n.message})})),X4}async function fZ(n){try{const r=(await MF()).transaction(Xv),s=await r.objectStore(Xv).get(kF(n));return await r.done,s}catch(e){if(e instanceof Wl)Hp.warn(e.message);else{const r=Ud.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Hp.warn(r.message)}}}async function Ok(n,e){try{const s=(await MF()).transaction(Xv,"readwrite");await s.objectStore(Xv).put(e,kF(n)),await s.done}catch(r){if(r instanceof Wl)Hp.warn(r.message);else{const s=Ud.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});Hp.warn(s.message)}}}function kF(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pZ=1024,mZ=30*24*60*60*1e3;class _Z{constructor(e){this.container=e,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new yZ(r),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,r;const c=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=zk();if(!(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((r=this._heartbeatsCache)===null||r===void 0?void 0:r.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(_=>_.date===d)))return this._heartbeatsCache.heartbeats.push({date:d,agent:c}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(_=>{const x=new Date(_.date).valueOf();return Date.now()-x<=mZ}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const r=zk(),{heartbeatsToSend:s,unsentEntries:c}=gZ(this._heartbeatsCache.heartbeats),d=Vw(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=r,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}}function zk(){return new Date().toISOString().substring(0,10)}function gZ(n,e=pZ){const r=[];let s=n.slice();for(const c of n){const d=r.find(_=>_.agent===c.agent);if(d){if(d.dates.push(c.date),Fk(r)>e){d.dates.pop();break}}else if(r.push({agent:c.agent,dates:[c.date]}),Fk(r)>e){r.pop();break}s=s.slice(1)}return{heartbeatsToSend:r,unsentEntries:s}}class yZ{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return aC()?EF().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const r=await fZ(this.app);return r!=null&&r.heartbeats?r:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var r;if(await this._canUseIndexedDBPromise){const c=await this.read();return Ok(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:c.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var r;if(await this._canUseIndexedDBPromise){const c=await this.read();return Ok(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:c.lastSentHeartbeatDate,heartbeats:[...c.heartbeats,...e.heartbeats]})}else return}}function Fk(n){return Vw(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vZ(n){qa(new xa("platform-logger",e=>new DW(e),"PRIVATE")),qa(new xa("heartbeat",e=>new _Z(e),"PRIVATE")),Io(sI,Dk,n),Io(sI,Dk,"esm2017"),Io("fire-js","")}vZ("");function cC(n,e){var r={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(r[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(n);c<s.length;c++)e.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(n,s[c])&&(r[s[c]]=n[s[c]]);return r}function At(n,e,r,s){var c=arguments.length,d=c<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,r):s,_;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(n,e,r,s);else for(var x=n.length-1;x>=0;x--)(_=n[x])&&(d=(c<3?_(d):c>3?_(e,r,d):_(e,r))||d);return c>3&&d&&Object.defineProperty(e,r,d),d}function DF(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const xZ=DF,LF=new lf("auth","Firebase",DF());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gw=new Yg("@firebase/auth");function bZ(n,...e){Gw.logLevel<=Ji.WARN&&Gw.warn(`Auth (${cf}): ${n}`,...e)}function pw(n,...e){Gw.logLevel<=Ji.ERROR&&Gw.error(`Auth (${cf}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gl(n,...e){throw hC(n,...e)}function Ec(n,...e){return hC(n,...e)}function uC(n,e,r){const s=Object.assign(Object.assign({},xZ()),{[e]:r});return new lf("auth","Firebase",s).create(e,{appName:n.name})}function lu(n){return uC(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function OF(n,e,r){const s=r;if(!(e instanceof s))throw s.name!==e.constructor.name&&Gl(n,"argument-error"),uC(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function hC(n,...e){if(typeof n!="string"){const r=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(r,...s)}return LF.create(n,...e)}function Si(n,e,...r){if(!n)throw hC(e,...r)}function oh(n){const e="INTERNAL ASSERTION FAILED: "+n;throw pw(e),new Error(e)}function mh(n,e){n||oh(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lI(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function wZ(){return Nk()==="http:"||Nk()==="https:"}function Nk(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TZ(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(wZ()||bF()||"connection"in navigator)?navigator.onLine:!0}function EZ(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w1{constructor(e,r){this.shortDelay=e,this.longDelay=r,mh(r>e,"Short delay should be less than long delay!"),this.isMobile=oC()||wF()}get(){return TZ()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dC(n,e){mh(n.emulator,"Emulator should always be set here");const{url:r}=n.emulator;return e?`${r}${e.startsWith("/")?e.slice(1):e}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zF{static initialize(e,r,s){this.fetchImpl=e,r&&(this.headersImpl=r),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;oh("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;oh("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;oh("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AZ={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IZ=new w1(3e4,6e4);function uf(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function wh(n,e,r,s,c={}){return FF(n,c,async()=>{let d={},_={};s&&(e==="GET"?_=s:d={body:JSON.stringify(s)});const x=Xg(Object.assign({key:n.config.apiKey},_)).slice(1),l=await n._getAdditionalHeaders();return l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode),zF.fetch()(NF(n,n.config.apiHost,r,x),Object.assign({method:e,headers:l,referrerPolicy:"no-referrer"},d))})}async function FF(n,e,r){n._canInitEmulator=!1;const s=Object.assign(Object.assign({},AZ),e);try{const c=new CZ(n),d=await Promise.race([r(),c.promise]);c.clearNetworkTimeout();const _=await d.json();if("needConfirmation"in _)throw kb(n,"account-exists-with-different-credential",_);if(d.ok&&!("errorMessage"in _))return _;{const x=d.ok?_.errorMessage:_.error.message,[l,S]=x.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw kb(n,"credential-already-in-use",_);if(l==="EMAIL_EXISTS")throw kb(n,"email-already-in-use",_);if(l==="USER_DISABLED")throw kb(n,"user-disabled",_);const D=s[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(S)throw uC(n,D,S);Gl(n,D)}}catch(c){if(c instanceof Wl)throw c;Gl(n,"network-request-failed",{message:String(c)})}}async function T1(n,e,r,s,c={}){const d=await wh(n,e,r,s,c);return"mfaPendingCredential"in d&&Gl(n,"multi-factor-auth-required",{_serverResponse:d}),d}function NF(n,e,r,s){const c=`${e}${r}?${s}`;return n.config.emulator?dC(n.config,c):`${n.config.apiScheme}://${c}`}function SZ(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class CZ{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((r,s)=>{this.timer=setTimeout(()=>s(Ec(this.auth,"network-request-failed")),IZ.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function kb(n,e,r){const s={appName:n.name};r.email&&(s.email=r.email),r.phoneNumber&&(s.phoneNumber=r.phoneNumber);const c=Ec(n,e,s);return c.customData._tokenResponse=r,c}function Bk(n){return n!==void 0&&n.enterprise!==void 0}class RZ{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const r of this.recaptchaEnforcementState)if(r.provider&&r.provider===e)return SZ(r.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function PZ(n,e){return wh(n,"GET","/v2/recaptchaConfig",uf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MZ(n,e){return wh(n,"POST","/v1/accounts:delete",e)}async function BF(n,e){return wh(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mv(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function kZ(n,e=!1){const r=va(n),s=await r.getIdToken(e),c=fC(s);Si(c&&c.exp&&c.auth_time&&c.iat,r.auth,"internal-error");const d=typeof c.firebase=="object"?c.firebase:void 0,_=d==null?void 0:d.sign_in_provider;return{claims:c,token:s,authTime:mv(Y4(c.auth_time)),issuedAtTime:mv(Y4(c.iat)),expirationTime:mv(Y4(c.exp)),signInProvider:_||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function Y4(n){return Number(n)*1e3}function fC(n){const[e,r,s]=n.split(".");if(e===void 0||r===void 0||s===void 0)return pw("JWT malformed, contained fewer than 3 sections"),null;try{const c=Uw(r);return c?JSON.parse(c):(pw("Failed to decode base64 JWT payload"),null)}catch(c){return pw("Caught error parsing JWT payload as JSON",c==null?void 0:c.toString()),null}}function Vk(n){const e=fC(n);return Si(e,"internal-error"),Si(typeof e.exp<"u","internal-error"),Si(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ig(n,e,r=!1){if(r)return e;try{return await e}catch(s){throw s instanceof Wl&&DZ(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function DZ({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LZ{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var r;if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const c=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,c)}}schedule(e=!1){if(!this.isRunning)return;const r=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},r)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cI{constructor(e,r){this.createdAt=e,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=mv(this.lastLoginAt),this.creationTime=mv(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qw(n){var e;const r=n.auth,s=await n.getIdToken(),c=await Ig(n,BF(r,{idToken:s}));Si(c==null?void 0:c.users.length,r,"internal-error");const d=c.users[0];n._notifyReloadListener(d);const _=!((e=d.providerUserInfo)===null||e===void 0)&&e.length?VF(d.providerUserInfo):[],x=zZ(n.providerData,_),l=n.isAnonymous,S=!(n.email&&d.passwordHash)&&!(x!=null&&x.length),D=l?S:!1,I={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:x,metadata:new cI(d.createdAt,d.lastLoginAt),isAnonymous:D};Object.assign(n,I)}async function OZ(n){const e=va(n);await qw(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function zZ(n,e){return[...n.filter(s=>!e.some(c=>c.providerId===s.providerId)),...e]}function VF(n){return n.map(e=>{var{providerId:r}=e,s=cC(e,["providerId"]);return{providerId:r,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FZ(n,e){const r=await FF(n,{},async()=>{const s=Xg({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:c,apiKey:d}=n.config,_=NF(n,c,"/v1/token",`key=${d}`),x=await n._getAdditionalHeaders();return x["Content-Type"]="application/x-www-form-urlencoded",zF.fetch()(_,{method:"POST",headers:x,body:s})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function NZ(n,e){return wh(n,"POST","/v2/accounts:revokeToken",uf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class og{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Si(e.idToken,"internal-error"),Si(typeof e.idToken<"u","internal-error"),Si(typeof e.refreshToken<"u","internal-error");const r="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Vk(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,r)}updateFromIdToken(e){Si(e.length!==0,"internal-error");const r=Vk(e);this.updateTokensAndExpiration(e,null,r)}async getToken(e,r=!1){return!r&&this.accessToken&&!this.isExpired?this.accessToken:(Si(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,r){const{accessToken:s,refreshToken:c,expiresIn:d}=await FZ(e,r);this.updateTokensAndExpiration(s,c,Number(d))}updateTokensAndExpiration(e,r,s){this.refreshToken=r||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,r){const{refreshToken:s,accessToken:c,expirationTime:d}=r,_=new og;return s&&(Si(typeof s=="string","internal-error",{appName:e}),_.refreshToken=s),c&&(Si(typeof c=="string","internal-error",{appName:e}),_.accessToken=c),d&&(Si(typeof d=="number","internal-error",{appName:e}),_.expirationTime=d),_}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new og,this.toJSON())}_performRefresh(){return oh("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vd(n,e){Si(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ah{constructor(e){var{uid:r,auth:s,stsTokenManager:c}=e,d=cC(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new LZ(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=s,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new cI(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(e){const r=await Ig(this,this.stsTokenManager.getToken(this.auth,e));return Si(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r}getIdTokenResult(e){return kZ(this,e)}reload(){return OZ(this)}_assign(e){this!==e&&(Si(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(r=>Object.assign({},r)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const r=new ah(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(e){Si(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,r=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),r&&await qw(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Fl(this.auth.app))return Promise.reject(lu(this.auth));const e=await this.getIdToken();return await Ig(this,MZ(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,r){var s,c,d,_,x,l,S,D;const I=(s=r.displayName)!==null&&s!==void 0?s:void 0,V=(c=r.email)!==null&&c!==void 0?c:void 0,j=(d=r.phoneNumber)!==null&&d!==void 0?d:void 0,Q=(_=r.photoURL)!==null&&_!==void 0?_:void 0,te=(x=r.tenantId)!==null&&x!==void 0?x:void 0,ce=(l=r._redirectEventId)!==null&&l!==void 0?l:void 0,Ce=(S=r.createdAt)!==null&&S!==void 0?S:void 0,Me=(D=r.lastLoginAt)!==null&&D!==void 0?D:void 0,{uid:Ie,emailVerified:Te,isAnonymous:Ge,providerData:$e,stsTokenManager:ue}=r;Si(Ie&&ue,e,"internal-error");const pe=og.fromJSON(this.name,ue);Si(typeof Ie=="string",e,"internal-error"),vd(I,e.name),vd(V,e.name),Si(typeof Te=="boolean",e,"internal-error"),Si(typeof Ge=="boolean",e,"internal-error"),vd(j,e.name),vd(Q,e.name),vd(te,e.name),vd(ce,e.name),vd(Ce,e.name),vd(Me,e.name);const _e=new ah({uid:Ie,auth:e,email:V,emailVerified:Te,displayName:I,isAnonymous:Ge,photoURL:Q,phoneNumber:j,tenantId:te,stsTokenManager:pe,createdAt:Ce,lastLoginAt:Me});return $e&&Array.isArray($e)&&(_e.providerData=$e.map(ge=>Object.assign({},ge))),ce&&(_e._redirectEventId=ce),_e}static async _fromIdTokenResponse(e,r,s=!1){const c=new og;c.updateFromServerResponse(r);const d=new ah({uid:r.localId,auth:e,stsTokenManager:c,isAnonymous:s});return await qw(d),d}static async _fromGetAccountInfoResponse(e,r,s){const c=r.users[0];Si(c.localId!==void 0,"internal-error");const d=c.providerUserInfo!==void 0?VF(c.providerUserInfo):[],_=!(c.email&&c.passwordHash)&&!(d!=null&&d.length),x=new og;x.updateFromIdToken(s);const l=new ah({uid:c.localId,auth:e,stsTokenManager:x,isAnonymous:_}),S={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:d,metadata:new cI(c.createdAt,c.lastLoginAt),isAnonymous:!(c.email&&c.passwordHash)&&!(d!=null&&d.length)};return Object.assign(l,S),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uk=new Map;function lh(n){mh(n instanceof Function,"Expected a class definition");let e=Uk.get(n);return e?(mh(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Uk.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UF{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,r){this.storage[e]=r}async _get(e){const r=this.storage[e];return r===void 0?null:r}async _remove(e){delete this.storage[e]}_addListener(e,r){}_removeListener(e,r){}}UF.type="NONE";const jk=UF;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mw(n,e,r){return`firebase:${n}:${e}:${r}`}class ag{constructor(e,r,s){this.persistence=e,this.auth=r,this.userKey=s;const{config:c,name:d}=this.auth;this.fullUserKey=mw(this.userKey,c.apiKey,d),this.fullPersistenceKey=mw("persistence",c.apiKey,d),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ah._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const r=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,r)return this.setCurrentUser(r)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,r,s="authUser"){if(!r.length)return new ag(lh(jk),e,s);const c=(await Promise.all(r.map(async S=>{if(await S._isAvailable())return S}))).filter(S=>S);let d=c[0]||lh(jk);const _=mw(s,e.config.apiKey,e.name);let x=null;for(const S of r)try{const D=await S._get(_);if(D){const I=ah._fromJSON(e,D);S!==d&&(x=I),d=S;break}}catch{}const l=c.filter(S=>S._shouldAllowMigration);return!d._shouldAllowMigration||!l.length?new ag(d,e,s):(d=l[0],x&&await d._set(_,x.toJSON()),await Promise.all(r.map(async S=>{if(S!==d)try{await S._remove(_)}catch{}})),new ag(d,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $k(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(GF(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(jF(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(HF(e))return"Blackberry";if(WF(e))return"Webos";if(pC(e))return"Safari";if((e.includes("chrome/")||$F(e))&&!e.includes("edge/"))return"Chrome";if(qF(e))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(r);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function jF(n=Co()){return/firefox\//i.test(n)}function pC(n=Co()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function $F(n=Co()){return/crios\//i.test(n)}function GF(n=Co()){return/iemobile/i.test(n)}function qF(n=Co()){return/android/i.test(n)}function HF(n=Co()){return/blackberry/i.test(n)}function WF(n=Co()){return/webos/i.test(n)}function tE(n=Co()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function BZ(n=Co()){var e;return tE(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function VZ(){return QH()&&document.documentMode===10}function ZF(n=Co()){return tE(n)||qF(n)||WF(n)||HF(n)||/windows phone/i.test(n)||GF(n)}function UZ(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XF(n,e=[]){let r;switch(n){case"Browser":r=$k(Co());break;case"Worker":r=`${$k(Co())}-${n}`;break;default:r=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${r}/JsCore/${cf}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jZ{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,r){const s=d=>new Promise((_,x)=>{try{const l=e(d);_(l)}catch(l){x(l)}});s.onAbort=r,this.queue.push(s);const c=this.queue.length-1;return()=>{this.queue[c]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const r=[];try{for(const s of this.queue)await s(e),s.onAbort&&r.push(s.onAbort)}catch(s){r.reverse();for(const c of r)try{c()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $Z(n,e={}){return wh(n,"GET","/v2/passwordPolicy",uf(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GZ=6;class qZ{constructor(e){var r,s,c,d;const _=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(r=_.minPasswordLength)!==null&&r!==void 0?r:GZ,_.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=_.maxPasswordLength),_.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=_.containsLowercaseCharacter),_.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=_.containsUppercaseCharacter),_.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=_.containsNumericCharacter),_.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=_.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(c=(s=e.allowedNonAlphanumericCharacters)===null||s===void 0?void 0:s.join(""))!==null&&c!==void 0?c:"",this.forceUpgradeOnSignin=(d=e.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var r,s,c,d,_,x;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(r=l.meetsMinPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.meetsMaxPasswordLength)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(c=l.containsLowercaseLetter)!==null&&c!==void 0?c:!0),l.isValid&&(l.isValid=(d=l.containsUppercaseLetter)!==null&&d!==void 0?d:!0),l.isValid&&(l.isValid=(_=l.containsNumericCharacter)!==null&&_!==void 0?_:!0),l.isValid&&(l.isValid=(x=l.containsNonAlphanumericCharacter)!==null&&x!==void 0?x:!0),l}validatePasswordLengthOptions(e,r){const s=this.customStrengthOptions.minPasswordLength,c=this.customStrengthOptions.maxPasswordLength;s&&(r.meetsMinPasswordLength=e.length>=s),c&&(r.meetsMaxPasswordLength=e.length<=c)}validatePasswordCharacterOptions(e,r){this.updatePasswordCharacterOptionsStatuses(r,!1,!1,!1,!1);let s;for(let c=0;c<e.length;c++)s=e.charAt(c),this.updatePasswordCharacterOptionsStatuses(r,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,r,s,c,d){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=r)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=c)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HZ{constructor(e,r,s,c){this.app=e,this.heartbeatServiceProvider=r,this.appCheckServiceProvider=s,this.config=c,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Gk(this),this.idTokenSubscription=new Gk(this),this.beforeStateQueue=new jZ(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=LF,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=c.sdkClientVersion}_initializeWithPersistence(e,r){return r&&(this._popupRedirectResolver=lh(r)),this._initializationPromise=this.queue(async()=>{var s,c;if(!this._deleted&&(this.persistenceManager=await ag.create(this,e),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(r),this.lastNotifiedUid=((c=this.currentUser)===null||c===void 0?void 0:c.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const r=await BF(this,{idToken:e}),s=await ah._fromGetAccountInfoResponse(this,r,e);await this.directlySetCurrentUser(s)}catch(r){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",r),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var r;if(Fl(this.app)){const _=this.app.settings.authIdToken;return _?new Promise(x=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(_).then(x,x))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let c=s,d=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const _=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,x=c==null?void 0:c._redirectEventId,l=await this.tryRedirectSignIn(e);(!_||_===x)&&(l!=null&&l.user)&&(c=l.user,d=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(c)}catch(_){c=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(_))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return Si(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(e){let r=null;try{r=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return r}async reloadAndSetCurrentUserOrClear(e){try{await qw(e)}catch(r){if((r==null?void 0:r.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=EZ()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Fl(this.app))return Promise.reject(lu(this));const r=e?va(e):null;return r&&Si(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))}async _updateCurrentUser(e,r=!1){if(!this._deleted)return e&&Si(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),r||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Fl(this.app)?Promise.reject(lu(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Fl(this.app)?Promise.reject(lu(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(lh(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const r=this._getPasswordPolicyInternal();return r.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):r.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await $Z(this),r=new qZ(e);this.tenantId===null?this._projectPasswordPolicy=r:this._tenantPasswordPolicies[this.tenantId]=r}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new lf("auth","Firebase",e())}onAuthStateChanged(e,r,s){return this.registerStateListener(this.authStateSubscription,e,r,s)}beforeAuthStateChanged(e,r){return this.beforeStateQueue.pushCallback(e,r)}onIdTokenChanged(e,r,s){return this.registerStateListener(this.idTokenSubscription,e,r,s)}authStateReady(){return new Promise((e,r)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},r)}})}async revokeAccessToken(e){if(this.currentUser){const r=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:r};this.tenantId!=null&&(s.tenantId=this.tenantId),await NZ(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,r){const s=await this.getOrInitRedirectPersistenceManager(r);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const r=e&&lh(e)||this._popupRedirectResolver;Si(r,this,"argument-error"),this.redirectPersistenceManager=await ag.create(this,[lh(r._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var r,s;return this._isInitialized&&await this.queue(async()=>{}),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===e?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(r=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,r,s,c){if(this._deleted)return()=>{};const d=typeof r=="function"?r:r.next.bind(r);let _=!1;const x=this._isInitialized?Promise.resolve():this._initializationPromise;if(Si(x,this,"internal-error"),x.then(()=>{_||d(this.currentUser)}),typeof r=="function"){const l=e.addObserver(r,s,c);return()=>{_=!0,l()}}else{const l=e.addObserver(r);return()=>{_=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Si(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=XF(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const r={"X-Client-Version":this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const s=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());s&&(r["X-Firebase-Client"]=s);const c=await this._getAppCheckToken();return c&&(r["X-Firebase-AppCheck"]=c),r}async _getAppCheckToken(){var e;const r=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return r!=null&&r.error&&bZ(`Error while retrieving App Check token: ${r.error}`),r==null?void 0:r.token}}function Th(n){return va(n)}class Gk{constructor(e){this.auth=e,this.observer=null,this.addObserver=oW(r=>this.observer=r)}get next(){return Si(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rE={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function WZ(n){rE=n}function YF(n){return rE.loadJS(n)}function ZZ(){return rE.recaptchaEnterpriseScript}function XZ(){return rE.gapiScript}function YZ(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const QZ="recaptcha-enterprise",KZ="NO_RECAPTCHA";class JZ{constructor(e){this.type=QZ,this.auth=Th(e)}async verify(e="verify",r=!1){async function s(d){if(!r){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(_,x)=>{PZ(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)x(new Error("recaptcha Enterprise site key undefined"));else{const S=new RZ(l);return d.tenantId==null?d._agentRecaptchaConfig=S:d._tenantRecaptchaConfigs[d.tenantId]=S,_(S.siteKey)}}).catch(l=>{x(l)})})}function c(d,_,x){const l=window.grecaptcha;Bk(l)?l.enterprise.ready(()=>{l.enterprise.execute(d,{action:e}).then(S=>{_(S)}).catch(()=>{_(KZ)})}):x(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((d,_)=>{s(this.auth).then(x=>{if(!r&&Bk(window.grecaptcha))c(x,d,_);else{if(typeof window>"u"){_(new Error("RecaptchaVerifier is only supported in browser"));return}let l=ZZ();l.length!==0&&(l+=x),YF(l).then(()=>{c(x,d,_)}).catch(S=>{_(S)})}}).catch(x=>{_(x)})})}}async function qk(n,e,r,s=!1){const c=new JZ(n);let d;try{d=await c.verify(r)}catch{d=await c.verify(r,!0)}const _=Object.assign({},e);return s?Object.assign(_,{captchaResp:d}):Object.assign(_,{captchaResponse:d}),Object.assign(_,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(_,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),_}async function uI(n,e,r,s){var c;if(!((c=n._getRecaptchaConfig())===null||c===void 0)&&c.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const d=await qk(n,e,r,r==="getOobCode");return s(n,d)}else return s(n,e).catch(async d=>{if(d.code==="auth/missing-recaptcha-token"){console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const _=await qk(n,e,r,r==="getOobCode");return s(n,_)}else return Promise.reject(d)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eX(n,e){const r=eE(n,"auth");if(r.isInitialized()){const c=r.getImmediate(),d=r.getOptions();if(Zv(d,e??{}))return c;Gl(c,"already-initialized")}return r.initialize({options:e})}function tX(n,e){const r=(e==null?void 0:e.persistence)||[],s=(Array.isArray(r)?r:[r]).map(lh);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mC{constructor(e,r){this.providerId=e,this.signInMethod=r}toJSON(){return oh("not implemented")}_getIdTokenResponse(e){return oh("not implemented")}_linkToIdToken(e,r){return oh("not implemented")}_getReauthenticationResolver(e){return oh("not implemented")}}async function rX(n,e){return wh(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iX(n,e){return T1(n,"POST","/v1/accounts:signInWithPassword",uf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nX(n,e){return T1(n,"POST","/v1/accounts:signInWithEmailLink",uf(n,e))}async function sX(n,e){return T1(n,"POST","/v1/accounts:signInWithEmailLink",uf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yv extends mC{constructor(e,r,s,c=null){super("password",s),this._email=e,this._password=r,this._tenantId=c}static _fromEmailAndPassword(e,r){return new Yv(e,r,"password")}static _fromEmailAndCode(e,r,s=null){return new Yv(e,r,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e;if(r!=null&&r.email&&(r!=null&&r.password)){if(r.signInMethod==="password")return this._fromEmailAndPassword(r.email,r.password);if(r.signInMethod==="emailLink")return this._fromEmailAndCode(r.email,r.password,r.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const r={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return uI(e,r,"signInWithPassword",iX);case"emailLink":return nX(e,{email:this._email,oobCode:this._password});default:Gl(e,"internal-error")}}async _linkToIdToken(e,r){switch(this.signInMethod){case"password":const s={idToken:r,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return uI(e,s,"signUpPassword",rX);case"emailLink":return sX(e,{idToken:r,email:this._email,oobCode:this._password});default:Gl(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lg(n,e){return T1(n,"POST","/v1/accounts:signInWithIdp",uf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oX="http://localhost";class Wp extends mC{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const r=new Wp(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(r.idToken=e.idToken),e.accessToken&&(r.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(r.nonce=e.nonce),e.pendingToken&&(r.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(r.accessToken=e.oauthToken,r.secret=e.oauthTokenSecret):Gl("argument-error"),r}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:c}=r,d=cC(r,["providerId","signInMethod"]);if(!s||!c)return null;const _=new Wp(s,c);return _.idToken=d.idToken||void 0,_.accessToken=d.accessToken||void 0,_.secret=d.secret,_.nonce=d.nonce,_.pendingToken=d.pendingToken||null,_}_getIdTokenResponse(e){const r=this.buildRequest();return lg(e,r)}_linkToIdToken(e,r){const s=this.buildRequest();return s.idToken=r,lg(e,s)}_getReauthenticationResolver(e){const r=this.buildRequest();return r.autoCreate=!1,lg(e,r)}buildRequest(){const e={requestUri:oX,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),e.postBody=Xg(r)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aX(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function lX(n){const e=Hy(Wy(n)).link,r=e?Hy(Wy(e)).deep_link_id:null,s=Hy(Wy(n)).deep_link_id;return(s?Hy(Wy(s)).link:null)||s||r||e||n}class _C{constructor(e){var r,s,c,d,_,x;const l=Hy(Wy(e)),S=(r=l.apiKey)!==null&&r!==void 0?r:null,D=(s=l.oobCode)!==null&&s!==void 0?s:null,I=aX((c=l.mode)!==null&&c!==void 0?c:null);Si(S&&D&&I,"argument-error"),this.apiKey=S,this.operation=I,this.code=D,this.continueUrl=(d=l.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(_=l.languageCode)!==null&&_!==void 0?_:null,this.tenantId=(x=l.tenantId)!==null&&x!==void 0?x:null}static parseLink(e){const r=lX(e);try{return new _C(r)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qg{constructor(){this.providerId=Qg.PROVIDER_ID}static credential(e,r){return Yv._fromEmailAndPassword(e,r)}static credentialWithLink(e,r){const s=_C.parseLink(r);return Si(s,"argument-error"),Yv._fromEmailAndCode(e,s.code,s.tenantId)}}Qg.PROVIDER_ID="password";Qg.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Qg.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E1 extends iE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sd extends E1{constructor(){super("facebook.com")}static credential(e){return Wp._fromParams({providerId:Sd.PROVIDER_ID,signInMethod:Sd.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Sd.credentialFromTaggedObject(e)}static credentialFromError(e){return Sd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Sd.credential(e.oauthAccessToken)}catch{return null}}}Sd.FACEBOOK_SIGN_IN_METHOD="facebook.com";Sd.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh extends E1{constructor(){super("google.com"),this.addScope("profile")}static credential(e,r){return Wp._fromParams({providerId:nh.PROVIDER_ID,signInMethod:nh.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:r})}static credentialFromResult(e){return nh.credentialFromTaggedObject(e)}static credentialFromError(e){return nh.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:r,oauthAccessToken:s}=e;if(!r&&!s)return null;try{return nh.credential(r,s)}catch{return null}}}nh.GOOGLE_SIGN_IN_METHOD="google.com";nh.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cd extends E1{constructor(){super("github.com")}static credential(e){return Wp._fromParams({providerId:Cd.PROVIDER_ID,signInMethod:Cd.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Cd.credentialFromTaggedObject(e)}static credentialFromError(e){return Cd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Cd.credential(e.oauthAccessToken)}catch{return null}}}Cd.GITHUB_SIGN_IN_METHOD="github.com";Cd.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rd extends E1{constructor(){super("twitter.com")}static credential(e,r){return Wp._fromParams({providerId:Rd.PROVIDER_ID,signInMethod:Rd.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:r})}static credentialFromResult(e){return Rd.credentialFromTaggedObject(e)}static credentialFromError(e){return Rd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:r,oauthTokenSecret:s}=e;if(!r||!s)return null;try{return Rd.credential(r,s)}catch{return null}}}Rd.TWITTER_SIGN_IN_METHOD="twitter.com";Rd.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cX(n,e){return T1(n,"POST","/v1/accounts:signUp",uf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zp{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,r,s,c=!1){const d=await ah._fromIdTokenResponse(e,s,c),_=Hk(s);return new Zp({user:d,providerId:_,_tokenResponse:s,operationType:r})}static async _forOperation(e,r,s){await e._updateTokensIfNecessary(s,!0);const c=Hk(s);return new Zp({user:e,providerId:c,_tokenResponse:s,operationType:r})}}function Hk(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hw extends Wl{constructor(e,r,s,c){var d;super(r.code,r.message),this.operationType=s,this.user=c,Object.setPrototypeOf(this,Hw.prototype),this.customData={appName:e.name,tenantId:(d=e.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:r.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,r,s,c){return new Hw(e,r,s,c)}}function QF(n,e,r,s){return(e==="reauthenticate"?r._getReauthenticationResolver(n):r._getIdTokenResponse(n)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?Hw._fromErrorAndOperation(n,d,e,s):d})}async function uX(n,e,r=!1){const s=await Ig(n,e._linkToIdToken(n.auth,await n.getIdToken()),r);return Zp._forOperation(n,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hX(n,e,r=!1){const{auth:s}=n;if(Fl(s.app))return Promise.reject(lu(s));const c="reauthenticate";try{const d=await Ig(n,QF(s,c,e,n),r);Si(d.idToken,s,"internal-error");const _=fC(d.idToken);Si(_,s,"internal-error");const{sub:x}=_;return Si(n.uid===x,s,"user-mismatch"),Zp._forOperation(n,c,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&Gl(s,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KF(n,e,r=!1){if(Fl(n.app))return Promise.reject(lu(n));const s="signIn",c=await QF(n,s,e),d=await Zp._fromIdTokenResponse(n,s,c);return r||await n._updateCurrentUser(d.user),d}async function dX(n,e){return KF(Th(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JF(n){const e=Th(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Bue(n,e,r){if(Fl(n.app))return Promise.reject(lu(n));const s=Th(n),_=await uI(s,{returnSecureToken:!0,email:e,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",cX).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&JF(n),l}),x=await Zp._fromIdTokenResponse(s,"signIn",_);return await s._updateCurrentUser(x.user),x}function Vue(n,e,r){return Fl(n.app)?Promise.reject(lu(n)):dX(va(n),Qg.credential(e,r)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&JF(n),s})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fX(n,e){return wh(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uue(n,{displayName:e,photoURL:r}){if(e===void 0&&r===void 0)return;const s=va(n),d={idToken:await s.getIdToken(),displayName:e,photoUrl:r,returnSecureToken:!0},_=await Ig(s,fX(s.auth,d));s.displayName=_.displayName||null,s.photoURL=_.photoUrl||null;const x=s.providerData.find(({providerId:l})=>l==="password");x&&(x.displayName=s.displayName,x.photoURL=s.photoURL),await s._updateTokensIfNecessary(_)}function pX(n,e,r,s){return va(n).onIdTokenChanged(e,r,s)}const Ww="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eN{constructor(e,r){this.storageRetriever=e,this.type=r}_isAvailable(){try{return this.storage?(this.storage.setItem(Ww,"1"),this.storage.removeItem(Ww),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,r){return this.storage.setItem(e,JSON.stringify(r)),Promise.resolve()}_get(e){const r=this.storage.getItem(e);return Promise.resolve(r?JSON.parse(r):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mX(){const n=Co();return pC(n)||tE(n)}const _X=1e3,gX=10;class tN extends eN{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,r)=>this.onStorageEvent(e,r),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=mX()&&UZ(),this.fallbackToPolling=ZF(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){const s=this.storage.getItem(r),c=this.localCache[r];s!==c&&e(r,c,s)}}onStorageEvent(e,r=!1){if(!e.key){this.forAllChangedKeys((_,x,l)=>{this.notifyListeners(_,l)});return}const s=e.key;if(r?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const _=this.storage.getItem(s);if(e.newValue!==_)e.newValue!==null?this.storage.setItem(s,e.newValue):this.storage.removeItem(s);else if(this.localCache[s]===e.newValue&&!r)return}const c=()=>{const _=this.storage.getItem(s);!r&&this.localCache[s]===_||this.notifyListeners(s,_)},d=this.storage.getItem(s);VZ()&&d!==e.newValue&&e.newValue!==e.oldValue?setTimeout(c,gX):c()}notifyListeners(e,r){this.localCache[e]=r;const s=this.listeners[e];if(s)for(const c of Array.from(s))c(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,r,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:r,newValue:s}),!0)})},_X)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,r){await super._set(e,r),this.localCache[e]=JSON.stringify(r)}async _get(e){const r=await super._get(e);return this.localCache[e]=JSON.stringify(r),r}async _remove(e){await super._remove(e),delete this.localCache[e]}}tN.type="LOCAL";const yX=tN;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rN extends eN{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,r){}_removeListener(e,r){}}rN.type="SESSION";const iN=rN;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vX(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(r){return{fulfilled:!1,reason:r}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nE{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const r=this.receivers.find(c=>c.isListeningto(e));if(r)return r;const s=new nE(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const r=e,{eventId:s,eventType:c,data:d}=r.data,_=this.handlersMap[c];if(!(_!=null&&_.size))return;r.ports[0].postMessage({status:"ack",eventId:s,eventType:c});const x=Array.from(_).map(async S=>S(r.origin,d)),l=await vX(x);r.ports[0].postMessage({status:"done",eventId:s,eventType:c,response:l})}_subscribe(e,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(r)}_unsubscribe(e,r){this.handlersMap[e]&&r&&this.handlersMap[e].delete(r),(!r||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}nE.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gC(n="",e=10){let r="";for(let s=0;s<e;s++)r+=Math.floor(Math.random()*10);return n+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xX{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,r,s=50){const c=typeof MessageChannel<"u"?new MessageChannel:null;if(!c)throw new Error("connection_unavailable");let d,_;return new Promise((x,l)=>{const S=gC("",20);c.port1.start();const D=setTimeout(()=>{l(new Error("unsupported_event"))},s);_={messageChannel:c,onMessage(I){const V=I;if(V.data.eventId===S)switch(V.data.status){case"ack":clearTimeout(D),d=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),x(V.data.response);break;default:clearTimeout(D),clearTimeout(d),l(new Error("invalid_response"));break}}},this.handlers.add(_),c.port1.addEventListener("message",_.onMessage),this.target.postMessage({eventType:e,eventId:S,data:r},[c.port2])}).finally(()=>{_&&this.removeMessageHandler(_)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cu(){return window}function bX(n){cu().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nN(){return typeof cu().WorkerGlobalScope<"u"&&typeof cu().importScripts=="function"}async function wX(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function TX(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function EX(){return nN()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sN="firebaseLocalStorageDb",AX=1,Zw="firebaseLocalStorage",oN="fbase_key";class A1{constructor(e){this.request=e}toPromise(){return new Promise((e,r)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function sE(n,e){return n.transaction([Zw],e?"readwrite":"readonly").objectStore(Zw)}function IX(){const n=indexedDB.deleteDatabase(sN);return new A1(n).toPromise()}function hI(){const n=indexedDB.open(sN,AX);return new Promise((e,r)=>{n.addEventListener("error",()=>{r(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(Zw,{keyPath:oN})}catch(c){r(c)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(Zw)?e(s):(s.close(),await IX(),e(await hI()))})})}async function Wk(n,e,r){const s=sE(n,!0).put({[oN]:e,value:r});return new A1(s).toPromise()}async function SX(n,e){const r=sE(n,!1).get(e),s=await new A1(r).toPromise();return s===void 0?null:s.value}function Zk(n,e){const r=sE(n,!0).delete(e);return new A1(r).toPromise()}const CX=800,RX=3;class aN{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await hI(),this.db)}async _withRetries(e){let r=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(r++>RX)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return nN()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=nE._getInstance(EX()),this.receiver._subscribe("keyChanged",async(e,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(e,r)=>["keyChanged"])}async initializeSender(){var e,r;if(this.activeServiceWorker=await wX(),!this.activeServiceWorker)return;this.sender=new xX(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&!((e=s[0])===null||e===void 0)&&e.fulfilled&&!((r=s[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||TX()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await hI();return await Wk(e,Ww,"1"),await Zk(e,Ww),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,r){return this._withPendingWrite(async()=>(await this._withRetries(s=>Wk(s,e,r)),this.localCache[e]=r,this.notifyServiceWorker(e)))}async _get(e){const r=await this._withRetries(s=>SX(s,e));return this.localCache[e]=r,r}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(r=>Zk(r,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(c=>{const d=sE(c,!1).getAll();return new A1(d).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const r=[],s=new Set;if(e.length!==0)for(const{fbase_key:c,value:d}of e)s.add(c),JSON.stringify(this.localCache[c])!==JSON.stringify(d)&&(this.notifyListeners(c,d),r.push(c));for(const c of Object.keys(this.localCache))this.localCache[c]&&!s.has(c)&&(this.notifyListeners(c,null),r.push(c));return r}notifyListeners(e,r){this.localCache[e]=r;const s=this.listeners[e];if(s)for(const c of Array.from(s))c(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),CX)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}aN.type="LOCAL";const PX=aN;new w1(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yC(n,e){return e?lh(e):(Si(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vC extends mC{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return lg(e,this._buildIdpRequest())}_linkToIdToken(e,r){return lg(e,this._buildIdpRequest(r))}_getReauthenticationResolver(e){return lg(e,this._buildIdpRequest())}_buildIdpRequest(e){const r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(r.idToken=e),r}}function MX(n){return KF(n.auth,new vC(n),n.bypassAuthState)}function kX(n){const{auth:e,user:r}=n;return Si(r,e,"internal-error"),hX(r,new vC(n),n.bypassAuthState)}async function DX(n){const{auth:e,user:r}=n;return Si(r,e,"internal-error"),uX(r,new vC(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lN{constructor(e,r,s,c,d=!1){this.auth=e,this.resolver=s,this.user=c,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(r)?r:[r]}execute(){return new Promise(async(e,r)=>{this.pendingPromise={resolve:e,reject:r};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:r,sessionId:s,postBody:c,tenantId:d,error:_,type:x}=e;if(_){this.reject(_);return}const l={auth:this.auth,requestUri:r,sessionId:s,tenantId:d||void 0,postBody:c||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(x)(l))}catch(S){this.reject(S)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return MX;case"linkViaPopup":case"linkViaRedirect":return DX;case"reauthViaPopup":case"reauthViaRedirect":return kX;default:Gl(this.auth,"internal-error")}}resolve(e){mh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){mh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LX=new w1(2e3,1e4);async function OX(n,e,r){if(Fl(n.app))return Promise.reject(Ec(n,"operation-not-supported-in-this-environment"));const s=Th(n);OF(n,e,iE);const c=yC(s,r);return new Sp(s,"signInViaPopup",e,c).executeNotNull()}class Sp extends lN{constructor(e,r,s,c,d){super(e,r,c,d),this.provider=s,this.authWindow=null,this.pollId=null,Sp.currentPopupAction&&Sp.currentPopupAction.cancel(),Sp.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Si(e,this.auth,"internal-error"),e}async onExecution(){mh(this.filter.length===1,"Popup operations only handle one event");const e=gC();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(Ec(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Ec(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Sp.currentPopupAction=null}pollUserCancellation(){const e=()=>{var r,s;if(!((s=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ec(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,LX.get())};e()}}Sp.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zX="pendingRedirect",_w=new Map;class FX extends lN{constructor(e,r,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,s),this.eventId=null}async execute(){let e=_w.get(this.auth._key());if(!e){try{const s=await NX(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(r){e=()=>Promise.reject(r)}_w.set(this.auth._key(),e)}return this.bypassAuthState||_w.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const r=await this.auth._redirectUserForId(e.eventId);if(r)return this.user=r,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function NX(n,e){const r=uN(e),s=cN(n);if(!await s._isAvailable())return!1;const c=await s._get(r)==="true";return await s._remove(r),c}async function BX(n,e){return cN(n)._set(uN(e),"true")}function VX(n,e){_w.set(n._key(),e)}function cN(n){return lh(n._redirectPersistence)}function uN(n){return mw(zX,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UX(n,e,r){return jX(n,e,r)}async function jX(n,e,r){if(Fl(n.app))return Promise.reject(lu(n));const s=Th(n);OF(n,e,iE),await s._initializationPromise;const c=yC(s,r);return await BX(c,s),c._openRedirect(s,e,"signInViaRedirect")}async function $X(n,e){return await Th(n)._initializationPromise,hN(n,e,!1)}async function hN(n,e,r=!1){if(Fl(n.app))return Promise.reject(lu(n));const s=Th(n),c=yC(s,e),_=await new FX(s,c,r).execute();return _&&!r&&(delete _.user._redirectEventId,await s._persistUserIfCurrent(_.user),await s._setRedirectUser(null,e)),_}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GX=10*60*1e3;class qX{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let r=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(r=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!HX(e)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=e,r=!0)),r}sendToConsumer(e,r){var s;if(e.error&&!dN(e)){const c=((s=e.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";r.onError(Ec(this.auth,c))}else r.onAuthEvent(e)}isEventForConsumer(e,r){const s=r.eventId===null||!!e.eventId&&e.eventId===r.eventId;return r.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=GX&&this.cachedEventUids.clear(),this.cachedEventUids.has(Xk(e))}saveEventToCache(e){this.cachedEventUids.add(Xk(e)),this.lastProcessedEventTime=Date.now()}}function Xk(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function dN({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function HX(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return dN(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WX(n,e={}){return wh(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZX=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,XX=/^https?/;async function YX(n){if(n.config.emulator)return;const{authorizedDomains:e}=await WX(n);for(const r of e)try{if(QX(r))return}catch{}Gl(n,"unauthorized-domain")}function QX(n){const e=lI(),{protocol:r,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const _=new URL(n);return _.hostname===""&&s===""?r==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):r==="chrome-extension:"&&_.hostname===s}if(!XX.test(r))return!1;if(ZX.test(n))return s===n;const c=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+c+"|"+c+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KX=new w1(3e4,6e4);function Yk(){const n=cu().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let r=0;r<n.CP.length;r++)n.CP[r]=null}}function JX(n){return new Promise((e,r)=>{var s,c,d;function _(){Yk(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Yk(),r(Ec(n,"network-request-failed"))},timeout:KX.get()})}if(!((c=(s=cu().gapi)===null||s===void 0?void 0:s.iframes)===null||c===void 0)&&c.Iframe)e(gapi.iframes.getContext());else if(!((d=cu().gapi)===null||d===void 0)&&d.load)_();else{const x=YZ("iframefcb");return cu()[x]=()=>{gapi.load?_():r(Ec(n,"network-request-failed"))},YF(`${XZ()}?onload=${x}`).catch(l=>r(l))}}).catch(e=>{throw gw=null,e})}let gw=null;function eY(n){return gw=gw||JX(n),gw}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tY=new w1(5e3,15e3),rY="__/auth/iframe",iY="emulator/auth/iframe",nY={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},sY=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function oY(n){const e=n.config;Si(e.authDomain,n,"auth-domain-config-required");const r=e.emulator?dC(e,iY):`https://${n.config.authDomain}/${rY}`,s={apiKey:e.apiKey,appName:n.name,v:cf},c=sY.get(n.config.apiHost);c&&(s.eid=c);const d=n._getFrameworks();return d.length&&(s.fw=d.join(",")),`${r}?${Xg(s).slice(1)}`}async function aY(n){const e=await eY(n),r=cu().gapi;return Si(r,n,"internal-error"),e.open({where:document.body,url:oY(n),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:nY,dontclear:!0},s=>new Promise(async(c,d)=>{await s.restyle({setHideOnLeave:!1});const _=Ec(n,"network-request-failed"),x=cu().setTimeout(()=>{d(_)},tY.get());function l(){cu().clearTimeout(x),c(s)}s.ping(l).then(l,()=>{d(_)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lY={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},cY=500,uY=600,hY="_blank",dY="http://localhost";class Qk{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function fY(n,e,r,s=cY,c=uY){const d=Math.max((window.screen.availHeight-c)/2,0).toString(),_=Math.max((window.screen.availWidth-s)/2,0).toString();let x="";const l=Object.assign(Object.assign({},lY),{width:s.toString(),height:c.toString(),top:d,left:_}),S=Co().toLowerCase();r&&(x=$F(S)?hY:r),jF(S)&&(e=e||dY,l.scrollbars="yes");const D=Object.entries(l).reduce((V,[j,Q])=>`${V}${j}=${Q},`,"");if(BZ(S)&&x!=="_self")return pY(e||"",x),new Qk(null);const I=window.open(e||"",x,D);Si(I,n,"popup-blocked");try{I.focus()}catch{}return new Qk(I)}function pY(n,e){const r=document.createElement("a");r.href=n,r.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mY="__/auth/handler",_Y="emulator/auth/handler",gY=encodeURIComponent("fac");async function Kk(n,e,r,s,c,d){Si(n.config.authDomain,n,"auth-domain-config-required"),Si(n.config.apiKey,n,"invalid-api-key");const _={apiKey:n.config.apiKey,appName:n.name,authType:r,redirectUrl:s,v:cf,eventId:c};if(e instanceof iE){e.setDefaultLanguage(n.languageCode),_.providerId=e.providerId||"",rI(e.getCustomParameters())||(_.customParameters=JSON.stringify(e.getCustomParameters()));for(const[D,I]of Object.entries({}))_[D]=I}if(e instanceof E1){const D=e.getScopes().filter(I=>I!=="");D.length>0&&(_.scopes=D.join(","))}n.tenantId&&(_.tid=n.tenantId);const x=_;for(const D of Object.keys(x))x[D]===void 0&&delete x[D];const l=await n._getAppCheckToken(),S=l?`#${gY}=${encodeURIComponent(l)}`:"";return`${yY(n)}?${Xg(x).slice(1)}${S}`}function yY({config:n}){return n.emulator?dC(n,_Y):`https://${n.authDomain}/${mY}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q4="webStorageSupport";class vY{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=iN,this._completeRedirectFn=hN,this._overrideRedirectResult=VX}async _openPopup(e,r,s,c){var d;mh((d=this.eventManagers[e._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const _=await Kk(e,r,s,lI(),c);return fY(e,_,gC())}async _openRedirect(e,r,s,c){await this._originValidation(e);const d=await Kk(e,r,s,lI(),c);return bX(d),new Promise(()=>{})}_initialize(e){const r=e._key();if(this.eventManagers[r]){const{manager:c,promise:d}=this.eventManagers[r];return c?Promise.resolve(c):(mh(d,"If manager is not set, promise should be"),d)}const s=this.initAndGetManager(e);return this.eventManagers[r]={promise:s},s.catch(()=>{delete this.eventManagers[r]}),s}async initAndGetManager(e){const r=await aY(e),s=new qX(e);return r.register("authEvent",c=>(Si(c==null?void 0:c.authEvent,e,"invalid-auth-event"),{status:s.onEvent(c.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=r,s}_isIframeWebStorageSupported(e,r){this.iframes[e._key()].send(Q4,{type:Q4},c=>{var d;const _=(d=c==null?void 0:c[0])===null||d===void 0?void 0:d[Q4];_!==void 0&&r(!!_),Gl(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const r=e._key();return this.originValidationPromises[r]||(this.originValidationPromises[r]=YX(e)),this.originValidationPromises[r]}get _shouldInitProactively(){return ZF()||pC()||tE()}}const xY=vY;var Jk="@firebase/auth",eD="1.7.4";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bY{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const r=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,r),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const r=this.internalListeners.get(e);r&&(this.internalListeners.delete(e),r(),this.updateProactiveRefresh())}assertAuthConfigured(){Si(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wY(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function TY(n){qa(new xa("auth",(e,{options:r})=>{const s=e.getProvider("app").getImmediate(),c=e.getProvider("heartbeat"),d=e.getProvider("app-check-internal"),{apiKey:_,authDomain:x}=s.options;Si(_&&!_.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:_,authDomain:x,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:XF(n)},S=new HZ(s,c,d,l);return tX(S,r),S},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,r,s)=>{e.getProvider("auth-internal").initialize()})),qa(new xa("auth-internal",e=>{const r=Th(e.getProvider("auth").getImmediate());return(s=>new bY(s))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),Io(Jk,eD,wY(n)),Io(Jk,eD,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EY=5*60;ZH("authIdTokenMaxAge");function AY(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}WZ({loadJS(n){return new Promise((e,r)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=c=>{const d=Ec("internal-error");d.customData=c,r(d)},s.type="text/javascript",s.charset="UTF-8",AY().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});TY("Browser");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IY=new Map,SY={activated:!1,tokenObservers:[]};function Cc(n){return IY.get(n)||Object.assign({},SY)}const tD={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CY{constructor(e,r,s,c,d){if(this.operation=e,this.retryPolicy=r,this.getWaitDuration=s,this.lowerBound=c,this.upperBound=d,this.pending=null,this.nextErrorWaitInterval=c,c>d)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new Hv,this.pending.promise.catch(r=>{}),await RY(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new Hv,this.pending.promise.catch(r=>{}),await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(r){this.retryPolicy(r)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const r=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),r}}}function RY(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PY={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Xw=new lf("appCheck","AppCheck",PY);function fN(n){if(!Cc(n).activated)throw Xw.create("use-before-activation",{appName:n.name})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MY="firebase-app-check-database",kY=1,dI="firebase-app-check-store";let Db=null;function DY(){return Db||(Db=new Promise((n,e)=>{try{const r=indexedDB.open(MY,kY);r.onsuccess=s=>{n(s.target.result)},r.onerror=s=>{var c;e(Xw.create("storage-open",{originalErrorMessage:(c=s.target.error)===null||c===void 0?void 0:c.message}))},r.onupgradeneeded=s=>{const c=s.target.result;switch(s.oldVersion){case 0:c.createObjectStore(dI,{keyPath:"compositeKey"})}}}catch(r){e(Xw.create("storage-open",{originalErrorMessage:r==null?void 0:r.message}))}}),Db)}function LY(n,e){return OY(zY(n),e)}async function OY(n,e){const s=(await DY()).transaction(dI,"readwrite"),d=s.objectStore(dI).put({compositeKey:n,value:e});return new Promise((_,x)=>{d.onsuccess=l=>{_()},s.onerror=l=>{var S;x(Xw.create("storage-set",{originalErrorMessage:(S=l.target.error)===null||S===void 0?void 0:S.message}))}})}function zY(n){return`${n.options.appId}-${n.name}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fI=new Yg("@firebase/app-check");function rD(n,e){return aC()?LY(n,e).catch(r=>{fI.warn(`Failed to write token to IndexedDB. Error: ${r}`)}):Promise.resolve()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FY={error:"UNKNOWN_ERROR"};function NY(n){return QT.encodeString(JSON.stringify(n),!1)}async function pI(n,e=!1){const r=n.app;fN(r);const s=Cc(r);let c=s.token,d;if(c&&!Zy(c)&&(s.token=void 0,c=void 0),!c){const l=await s.cachedTokenPromise;l&&(Zy(l)?c=l:await rD(r,void 0))}if(!e&&c&&Zy(c))return{token:c.token};let _=!1;try{s.exchangeTokenPromise||(s.exchangeTokenPromise=s.provider.getToken().finally(()=>{s.exchangeTokenPromise=void 0}),_=!0),c=await Cc(r).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?fI.warn(l.message):fI.error(l),d=l}let x;return c?d?Zy(c)?x={token:c.token,internalError:d}:x=nD(d):(x={token:c.token},s.token=c,await rD(r,c)):x=nD(d),_&&jY(r,x),x}async function BY(n){const e=n.app;fN(e);const{provider:r}=Cc(e);{const{token:s}=await r.getToken();return{token:s}}}function VY(n,e,r,s){const{app:c}=n,d=Cc(c),_={next:r,error:s,type:e};if(d.tokenObservers=[...d.tokenObservers,_],d.token&&Zy(d.token)){const x=d.token;Promise.resolve().then(()=>{r({token:x.token}),iD(n)}).catch(()=>{})}d.cachedTokenPromise.then(()=>iD(n))}function pN(n,e){const r=Cc(n),s=r.tokenObservers.filter(c=>c.next!==e);s.length===0&&r.tokenRefresher&&r.tokenRefresher.isRunning()&&r.tokenRefresher.stop(),r.tokenObservers=s}function iD(n){const{app:e}=n,r=Cc(e);let s=r.tokenRefresher;s||(s=UY(n),r.tokenRefresher=s),!s.isRunning()&&r.isTokenAutoRefreshEnabled&&s.start()}function UY(n){const{app:e}=n;return new CY(async()=>{const r=Cc(e);let s;if(r.token?s=await pI(n,!0):s=await pI(n),s.error)throw s.error;if(s.internalError)throw s.internalError},()=>!0,()=>{const r=Cc(e);if(r.token){let s=r.token.issuedAtTimeMillis+(r.token.expireTimeMillis-r.token.issuedAtTimeMillis)*.5+3e5;const c=r.token.expireTimeMillis-5*60*1e3;return s=Math.min(s,c),Math.max(0,s-Date.now())}else return 0},tD.RETRIAL_MIN_WAIT,tD.RETRIAL_MAX_WAIT)}function jY(n,e){const r=Cc(n).tokenObservers;for(const s of r)try{s.type==="EXTERNAL"&&e.error!=null?s.error(e.error):s.next(e)}catch{}}function Zy(n){return n.expireTimeMillis-Date.now()>0}function nD(n){return{token:NY(FY),error:n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $Y{constructor(e,r){this.app=e,this.heartbeatServiceProvider=r}_delete(){const{tokenObservers:e}=Cc(this.app);for(const r of e)pN(this.app,r.next);return Promise.resolve()}}function GY(n,e){return new $Y(n,e)}function qY(n){return{getToken:e=>pI(n,e),getLimitedUseToken:()=>BY(n),addTokenListener:e=>VY(n,"INTERNAL",e),removeTokenListener:e=>pN(n.app,e)}}const HY="@firebase/app-check",WY="0.8.4",ZY="app-check",sD="app-check-internal";function XY(){qa(new xa(ZY,n=>{const e=n.getProvider("app").getImmediate(),r=n.getProvider("heartbeat");return GY(e,r)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,r)=>{n.getProvider(sD).initialize()})),qa(new xa(sD,n=>{const e=n.getProvider("app-check").getImmediate();return qY(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Io(HY,WY)}XY();var YY="firebase",QY="10.12.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Io(YY,QY,"app");const mN=Symbol("firebaseApp");function oE(n){return Jz()&&Fa(mN,null)||PF(n)}const ru=()=>{},KY=typeof window<"u";function xC(n,e){return e.split(".").reduce((r,s)=>r&&r[s],n)}function JY(n,e,r){const s=(""+e).split("."),c=s.pop(),d=s.reduce((_,x)=>_&&_[x],n);if(d!=null)return Array.isArray(d)?d.splice(Number(c),1,r):d[c]=r}function fm(n){return!!n&&typeof n=="object"}const eQ=Object.prototype;function tQ(n){return fm(n)&&Object.getPrototypeOf(n)===eQ}function bC(n){return fm(n)&&n.type==="document"}function rQ(n){return fm(n)&&n.type==="collection"}function iQ(n){return bC(n)||rQ(n)}function nQ(n){return fm(n)&&n.type==="query"}function sQ(n){return fm(n)&&"ref"in n}function oQ(n){return fm(n)&&typeof n.bucket=="string"}function aQ(n,e){let r;return()=>{if(!r)return r=!0,n(e())}}const lQ=Symbol.for("v-scx");function cQ(){return!!Fa(lQ,0)}const Lb=new WeakMap;function uQ(n,e){if(!Lb.has(n)){const r=sz(!0);Lb.set(n,r);const{unmount:s}=e;e.unmount=()=>{s.call(e),r.stop(),Lb.delete(n)}}return Lb.get(n)}const _N=new WeakMap;function wC(n){return _N.get(oE(n))}const Ob=new WeakMap;function gN(n){const e=oE(n);if(!Ob.has(e)){let r;const c=[new Promise(d=>{r=d}),d=>{Ob.set(e,d),r(d.value)}];Ob.set(e,c)}return Ob.get(e)}function hQ(n){const e=gN(n);return Array.isArray(e)?e[0]:Promise.resolve(e.value)}function dQ(n,e){pX(e,r=>{const s=gN();n.value=r,Array.isArray(s)&&s[1](n)})}var oD={};const aD="@firebase/database",lD="1.0.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yN="";function fQ(n){yN=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pQ{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,r){r==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),To(r))}get(e){const r=this.domStorage_.getItem(this.prefixedName_(e));return r==null?null:Wv(r)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mQ{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,r){r==null?delete this.cache_[e]:this.cache_[e]=r}get(e){return bh(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vN=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new pQ(e)}}catch{}return new mQ},Cp=vN("localStorage"),_Q=vN("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cg=new Yg("@firebase/database"),gQ=function(){let n=1;return function(){return n++}}(),xN=function(n){const e=uW(n),r=new sW;r.update(e);const s=r.digest();return QT.encodeByteArray(s)},I1=function(...n){let e="";for(let r=0;r<n.length;r++){const s=n[r];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=I1.apply(null,s):typeof s=="object"?e+=To(s):e+=s,e+=" "}return e};let _v=null,cD=!0;const yQ=function(n,e){br(!e,"Can't turn on custom loggers persistently."),cg.logLevel=Ji.VERBOSE,_v=cg.log.bind(cg)},Go=function(...n){if(cD===!0&&(cD=!1,_v===null&&_Q.get("logging_enabled")===!0&&yQ()),_v){const e=I1.apply(null,n);_v(e)}},S1=function(n){return function(...e){Go(n,...e)}},mI=function(...n){const e="FIREBASE INTERNAL ERROR: "+I1(...n);cg.error(e)},Xp=function(...n){const e=`FIREBASE FATAL ERROR: ${I1(...n)}`;throw cg.error(e),new Error(e)},fl=function(...n){const e="FIREBASE WARNING: "+I1(...n);cg.warn(e)},vQ=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&fl("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},bN=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},xQ=function(n){if(document.readyState==="complete")n();else{let e=!1;const r=function(){if(!document.body){setTimeout(r,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",r,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&r()}),window.attachEvent("onload",r))}},Sg="[MIN_NAME]",Yp="[MAX_NAME]",Kg=function(n,e){if(n===e)return 0;if(n===Sg||e===Yp)return-1;if(e===Sg||n===Yp)return 1;{const r=uD(n),s=uD(e);return r!==null?s!==null?r-s===0?n.length-e.length:r-s:-1:s!==null?1:n<e?-1:1}},bQ=function(n,e){return n===e?0:n<e?-1:1},ky=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+To(e))},TC=function(n){if(typeof n!="object"||n===null)return To(n);const e=[];for(const s in n)e.push(s);e.sort();let r="{";for(let s=0;s<e.length;s++)s!==0&&(r+=","),r+=To(e[s]),r+=":",r+=TC(n[e[s]]);return r+="}",r},wN=function(n,e){const r=n.length;if(r<=e)return[n];const s=[];for(let c=0;c<r;c+=e)c+e>r?s.push(n.substring(c,r)):s.push(n.substring(c,c+e));return s};function ql(n,e){for(const r in n)n.hasOwnProperty(r)&&e(r,n[r])}const TN=function(n){br(!bN(n),"Invalid JSON number");const e=11,r=52,s=(1<<e-1)-1;let c,d,_,x,l;n===0?(d=0,_=0,c=1/n===-1/0?1:0):(c=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(x=Math.min(Math.floor(Math.log(n)/Math.LN2),s),d=x+s,_=Math.round(n*Math.pow(2,r-x)-Math.pow(2,r))):(d=0,_=Math.round(n/Math.pow(2,1-s-r))));const S=[];for(l=r;l;l-=1)S.push(_%2?1:0),_=Math.floor(_/2);for(l=e;l;l-=1)S.push(d%2?1:0),d=Math.floor(d/2);S.push(c?1:0),S.reverse();const D=S.join("");let I="";for(l=0;l<64;l+=8){let V=parseInt(D.substr(l,8),2).toString(16);V.length===1&&(V="0"+V),I=I+V}return I.toLowerCase()},wQ=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},TQ=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"},EQ=new RegExp("^-?(0*)\\d{1,10}$"),AQ=-2147483648,IQ=2147483647,uD=function(n){if(EQ.test(n)){const e=Number(n);if(e>=AQ&&e<=IQ)return e}return null},C1=function(n){try{n()}catch(e){setTimeout(()=>{const r=e.stack||"";throw fl("Exception was thrown by user callback.",r),e},Math.floor(0))}},SQ=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},gv=function(n,e){const r=setTimeout(n,e);return typeof r=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(r):typeof r=="object"&&r.unref&&r.unref(),r};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CQ{constructor(e,r){this.appName_=e,this.appCheckProvider=r,this.appCheck=r==null?void 0:r.getImmediate({optional:!0}),this.appCheck||r==null||r.get().then(s=>this.appCheck=s)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((r,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(r,s):r(null)},0)})}addTokenChangeListener(e){var r;(r=this.appCheckProvider)===null||r===void 0||r.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){fl(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RQ{constructor(e,r,s){this.appName_=e,this.firebaseOptions_=r,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(c=>this.auth_=c)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(r=>r&&r.code==="auth/token-not-initialized"?(Go("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(r)):new Promise((r,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(r,s):r(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(r=>r.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(r=>r.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',fl(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EC="5",EN="v",AN="s",IN="r",SN="f",CN=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,RN="ls",PN="p",_I="ac",MN="websocket",kN="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PQ{constructor(e,r,s,c,d=!1,_="",x=!1,l=!1){this.secure=r,this.namespace=s,this.webSocketOnly=c,this.nodeAdmin=d,this.persistenceKey=_,this.includeNamespaceInQueryParams=x,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Cp.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Cp.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",r=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${r}`}}function MQ(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function DN(n,e,r){br(typeof e=="string","typeof type must == string"),br(typeof r=="object","typeof params must == object");let s;if(e===MN)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===kN)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);MQ(n)&&(r.ns=n.namespace);const c=[];return ql(r,(d,_)=>{c.push(d+"="+_)}),s+c.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kQ{constructor(){this.counters_={}}incrementCounter(e,r=1){bh(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=r}get(){return VH(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K4={},J4={};function AC(n){const e=n.toString();return K4[e]||(K4[e]=new kQ),K4[e]}function DQ(n,e){const r=n.toString();return J4[r]||(J4[r]=e()),J4[r]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LQ{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,r){this.closeAfterResponse=e,this.onClose=r,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,r){for(this.pendingResponses[e]=r;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let c=0;c<s.length;++c)s[c]&&C1(()=>{this.onMessage_(s[c])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hD="start",OQ="close",zQ="pLPCommand",FQ="pRTLPCB",LN="id",ON="pw",zN="ser",NQ="cb",BQ="seg",VQ="ts",UQ="d",jQ="dframe",FN=1870,NN=30,$Q=FN-NN,GQ=25e3,qQ=3e4;class Z_{constructor(e,r,s,c,d,_,x){this.connId=e,this.repoInfo=r,this.applicationId=s,this.appCheckToken=c,this.authToken=d,this.transportSessionId=_,this.lastSessionId=x,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=S1(e),this.stats_=AC(r),this.urlFn=l=>(this.appCheckToken&&(l[_I]=this.appCheckToken),DN(r,kN,l))}open(e,r){this.curSegmentNum=0,this.onDisconnect_=r,this.myPacketOrderer=new LQ(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(qQ)),xQ(()=>{if(this.isClosed_)return;this.scriptTagHolder=new IC((...d)=>{const[_,x,l,S,D]=d;if(this.incrementIncomingBytes_(d),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,_===hD)this.id=x,this.password=l;else if(_===OQ)x?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(x,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+_)},(...d)=>{const[_,x]=d;this.incrementIncomingBytes_(d),this.myPacketOrderer.handleResponse(_,x)},()=>{this.onClosed_()},this.urlFn);const s={};s[hD]="t",s[zN]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[NQ]=this.scriptTagHolder.uniqueCallbackIdentifier),s[EN]=EC,this.transportSessionId&&(s[AN]=this.transportSessionId),this.lastSessionId&&(s[RN]=this.lastSessionId),this.applicationId&&(s[PN]=this.applicationId),this.appCheckToken&&(s[_I]=this.appCheckToken),typeof location<"u"&&location.hostname&&CN.test(location.hostname)&&(s[IN]=SN);const c=this.urlFn(s);this.log_("Connecting via long-poll to "+c),this.scriptTagHolder.addTag(c,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Z_.forceAllow_=!0}static forceDisallow(){Z_.forceDisallow_=!0}static isAvailable(){return Z_.forceAllow_?!0:!Z_.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!wQ()&&!TQ()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const r=To(e);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);const s=yF(r),c=wN(s,$Q);for(let d=0;d<c.length;d++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,c.length,c[d]),this.curSegmentNum++}addDisconnectPingFrame(e,r){this.myDisconnFrame=document.createElement("iframe");const s={};s[jQ]="t",s[LN]=e,s[ON]=r,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const r=To(e).length;this.bytesReceived+=r,this.stats_.incrementCounter("bytes_received",r)}}class IC{constructor(e,r,s,c){this.onDisconnect=s,this.urlFn=c,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=gQ(),window[zQ+this.uniqueCallbackIdentifier]=e,window[FQ+this.uniqueCallbackIdentifier]=r,this.myIFrame=IC.createIFrame_();let d="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(d='<script>document.domain="'+document.domain+'";<\/script>');const _="<html><body>"+d+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(_),this.myIFrame.doc.close()}catch(x){Go("frame writing exception"),x.stack&&Go(x.stack),Go(x)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Go("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,r){for(this.myID=e,this.myPW=r,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[LN]=this.myID,e[ON]=this.myPW,e[zN]=this.currentSerial;let r=this.urlFn(e),s="",c=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+NN+s.length<=FN;){const _=this.pendingSegs.shift();s=s+"&"+BQ+c+"="+_.seg+"&"+VQ+c+"="+_.ts+"&"+UQ+c+"="+_.d,c++}return r=r+s,this.addLongPollTag_(r,this.currentSerial),!0}else return!1}enqueueSegment(e,r,s){this.pendingSegs.push({seg:e,ts:r,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,r){this.outstandingRequests.add(r);const s=()=>{this.outstandingRequests.delete(r),this.newRequest_()},c=setTimeout(s,Math.floor(GQ)),d=()=>{clearTimeout(c),s()};this.addTag(e,d)}addTag(e,r){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const c=s.readyState;(!c||c==="loaded"||c==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),r())},s.onerror=()=>{Go("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HQ=16384,WQ=45e3;let Yw=null;typeof MozWebSocket<"u"?Yw=MozWebSocket:typeof WebSocket<"u"&&(Yw=WebSocket);class _c{constructor(e,r,s,c,d,_,x){this.connId=e,this.applicationId=s,this.appCheckToken=c,this.authToken=d,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=S1(this.connId),this.stats_=AC(r),this.connURL=_c.connectionURL_(r,_,x,c,s),this.nodeAdmin=r.nodeAdmin}static connectionURL_(e,r,s,c,d){const _={};return _[EN]=EC,typeof location<"u"&&location.hostname&&CN.test(location.hostname)&&(_[IN]=SN),r&&(_[AN]=r),s&&(_[RN]=s),c&&(_[_I]=c),d&&(_[PN]=d),DN(e,MN,_)}open(e,r){this.onDisconnect=r,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Cp.set("previous_websocket_failure",!0);try{let s;TF(),this.mySock=new Yw(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const c=s.message||s.data;c&&this.log_(c),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const c=s.message||s.data;c&&this.log_(c),this.onClosed_()}}start(){}static forceDisallow(){_c.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const r=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(r);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&Yw!==null&&!_c.forceDisallow_}static previouslyFailed(){return Cp.isInMemoryStorage||Cp.get("previous_websocket_failure")===!0}markConnectionHealthy(){Cp.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const r=this.frames.join("");this.frames=null;const s=Wv(r);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(br(this.frames===null,"We already have a frame buffer"),e.length<=6){const r=Number(e);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const r=e.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{const s=this.extractFrameCount_(r);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const r=To(e);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);const s=wN(r,HQ);s.length>1&&this.sendString_(String(s.length));for(let c=0;c<s.length;c++)this.sendString_(s[c])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(WQ))}sendString_(e){try{this.mySock.send(e)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}_c.responsesRequiredToBeHealthy=2;_c.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qv{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Z_,_c]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const r=_c&&_c.isAvailable();let s=r&&!_c.previouslyFailed();if(e.webSocketOnly&&(r||fl("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[_c];else{const c=this.transports_=[];for(const d of Qv.ALL_TRANSPORTS)d&&d.isAvailable()&&c.push(d);Qv.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Qv.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZQ=6e4,XQ=5e3,YQ=10*1024,QQ=100*1024,eA="t",dD="d",KQ="s",fD="r",JQ="e",pD="o",mD="a",_D="n",gD="p",eK="h";class tK{constructor(e,r,s,c,d,_,x,l,S,D){this.id=e,this.repoInfo_=r,this.applicationId_=s,this.appCheckToken_=c,this.authToken_=d,this.onMessage_=_,this.onReady_=x,this.onDisconnect_=l,this.onKill_=S,this.lastSessionId=D,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=S1("c:"+this.id+":"),this.transportManager_=new Qv(r),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const r=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(r,s)},Math.floor(0));const c=e.healthyTimeout||0;c>0&&(this.healthyTimeout_=gv(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>QQ?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>YQ?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(c)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return r=>{e===this.conn_?this.onConnectionLost_(r):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return r=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(r):e===this.secondaryConn_?this.onSecondaryMessageReceived_(r):this.log_("message on old connection"))}}sendRequest(e){const r={t:"d",d:e};this.sendData_(r)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(eA in e){const r=e[eA];r===mD?this.upgradeIfSecondaryHealthy_():r===fD?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):r===pD&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const r=ky("t",e),s=ky("d",e);if(r==="c")this.onSecondaryControl_(s);else if(r==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+r)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:gD,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:mD,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:_D,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const r=ky("t",e),s=ky("d",e);r==="c"?this.onControl_(s):r==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const r=ky(eA,e);if(dD in e){const s=e[dD];if(r===eK){const c=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(c.h=this.repoInfo_.host),this.onHandshake_(c)}else if(r===_D){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let c=0;c<this.pendingDataMessages.length;++c)this.onDataMessage_(this.pendingDataMessages[c]);this.pendingDataMessages=[],this.tryCleanupConnection()}else r===KQ?this.onConnectionShutdown_(s):r===fD?this.onReset_(s):r===JQ?mI("Server Error: "+s):r===pD?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):mI("Unknown control packet command: "+r)}}onHandshake_(e){const r=e.ts,s=e.v,c=e.h;this.sessionId=e.s,this.repoInfo_.host=c,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,r),EC!==s&&fl("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const r=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(r,s),gv(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(ZQ))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,r){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(r,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):gv(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(XQ))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:gD,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Cp.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BN{put(e,r,s,c){}merge(e,r,s,c){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,r,s){}onDisconnectMerge(e,r,s){}onDisconnectCancel(e,r){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VN{constructor(e){this.allowedEvents_=e,this.listeners_={},br(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...r){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let c=0;c<s.length;c++)s[c].callback.apply(s[c].context,r)}}on(e,r,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:r,context:s});const c=this.getInitialEvent(e);c&&r.apply(s,c)}off(e,r,s){this.validateEventType_(e);const c=this.listeners_[e]||[];for(let d=0;d<c.length;d++)if(c[d].callback===r&&(!s||s===c[d].context)){c.splice(d,1);return}}validateEventType_(e){br(this.allowedEvents_.find(r=>r===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qw extends VN{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!oC()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Qw}getInitialEvent(e){return br(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yD=32,vD=768;class Qn{constructor(e,r){if(r===void 0){this.pieces_=e.split("/");let s=0;for(let c=0;c<this.pieces_.length;c++)this.pieces_[c].length>0&&(this.pieces_[s]=this.pieces_[c],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=r}toString(){let e="";for(let r=this.pieceNum_;r<this.pieces_.length;r++)this.pieces_[r]!==""&&(e+="/"+this.pieces_[r]);return e||"/"}}function Dn(){return new Qn("")}function hn(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Yd(n){return n.pieces_.length-n.pieceNum_}function Yn(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new Qn(n.pieces_,e)}function UN(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function rK(n){let e="";for(let r=n.pieceNum_;r<n.pieces_.length;r++)n.pieces_[r]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[r])));return e||"/"}function jN(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function $N(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let r=n.pieceNum_;r<n.pieces_.length-1;r++)e.push(n.pieces_[r]);return new Qn(e,0)}function uo(n,e){const r=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)r.push(n.pieces_[s]);if(e instanceof Qn)for(let s=e.pieceNum_;s<e.pieces_.length;s++)r.push(e.pieces_[s]);else{const s=e.split("/");for(let c=0;c<s.length;c++)s[c].length>0&&r.push(s[c])}return new Qn(r,0)}function sn(n){return n.pieceNum_>=n.pieces_.length}function Nl(n,e){const r=hn(n),s=hn(e);if(r===null)return e;if(r===s)return Nl(Yn(n),Yn(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function GN(n,e){if(Yd(n)!==Yd(e))return!1;for(let r=n.pieceNum_,s=e.pieceNum_;r<=n.pieces_.length;r++,s++)if(n.pieces_[r]!==e.pieces_[s])return!1;return!0}function yc(n,e){let r=n.pieceNum_,s=e.pieceNum_;if(Yd(n)>Yd(e))return!1;for(;r<n.pieces_.length;){if(n.pieces_[r]!==e.pieces_[s])return!1;++r,++s}return!0}class iK{constructor(e,r){this.errorPrefix_=r,this.parts_=jN(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=JT(this.parts_[s]);qN(this)}}function nK(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=JT(e),qN(n)}function sK(n){const e=n.parts_.pop();n.byteLength_-=JT(e),n.parts_.length>0&&(n.byteLength_-=1)}function qN(n){if(n.byteLength_>vD)throw new Error(n.errorPrefix_+"has a key path longer than "+vD+" bytes ("+n.byteLength_+").");if(n.parts_.length>yD)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+yD+") or object contains a cycle "+bp(n))}function bp(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SC extends VN{constructor(){super(["visible"]);let e,r;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(r="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(r="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(r="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(r="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,r&&document.addEventListener(r,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}static getInstance(){return new SC}getInitialEvent(e){return br(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dy=1e3,oK=60*5*1e3,xD=30*1e3,aK=1.3,lK=3e4,cK="server_kill",bD=3;class dh extends BN{constructor(e,r,s,c,d,_,x,l){if(super(),this.repoInfo_=e,this.applicationId_=r,this.onDataUpdate_=s,this.onConnectStatus_=c,this.onServerInfoUpdate_=d,this.authTokenProvider_=_,this.appCheckTokenProvider_=x,this.authOverride_=l,this.id=dh.nextPersistentConnectionId_++,this.log_=S1("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Dy,this.maxReconnectDelay_=oK,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!TF())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");SC.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Qw.getInstance().on("online",this.onOnline_,this)}sendRequest(e,r,s){const c=++this.requestNumber_,d={r:c,a:e,b:r};this.log_(To(d)),br(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(d),s&&(this.requestCBHash_[c]=s)}get(e){this.initConnection_();const r=new Hv,c={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:_=>{const x=_.d;_.s==="ok"?r.resolve(x):r.reject(x)}};this.outstandingGets_.push(c),this.outstandingGetCount_++;const d=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(d),r.promise}listen(e,r,s,c){this.initConnection_();const d=e._queryIdentifier,_=e._path.toString();this.log_("Listen called for "+_+" "+d),this.listens.has(_)||this.listens.set(_,new Map),br(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),br(!this.listens.get(_).has(d),"listen() called twice for same path/queryId.");const x={onComplete:c,hashFn:r,query:e,tag:s};this.listens.get(_).set(d,x),this.connected_&&this.sendListen_(x)}sendGet_(e){const r=this.outstandingGets_[e];this.sendRequest("g",r.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(s)})}sendListen_(e){const r=e.query,s=r._path.toString(),c=r._queryIdentifier;this.log_("Listen on "+s+" for "+c);const d={p:s},_="q";e.tag&&(d.q=r._queryObject,d.t=e.tag),d.h=e.hashFn(),this.sendRequest(_,d,x=>{const l=x.d,S=x.s;dh.warnOnListenWarnings_(l,r),(this.listens.get(s)&&this.listens.get(s).get(c))===e&&(this.log_("listen response",x),S!=="ok"&&this.removeListen_(s,c),e.onComplete&&e.onComplete(S,l))})}static warnOnListenWarnings_(e,r){if(e&&typeof e=="object"&&bh(e,"w")){const s=Ag(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const c='".indexOn": "'+r._queryParams.getIndex().toString()+'"',d=r._path.toString();fl(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${c} at ${d} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||nW(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=xD)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,r=iW(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(r,s,c=>{const d=c.s,_=c.d||"error";this.authToken_===e&&(d==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(d,_))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const r=e.s,s=e.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,s)})}unlisten(e,r){const s=e._path.toString(),c=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+c),br(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,c)&&this.connected_&&this.sendUnlisten_(s,c,e._queryObject,r)}sendUnlisten_(e,r,s,c){this.log_("Unlisten on "+e+" for "+r);const d={p:e},_="n";c&&(d.q=s,d.t=c),this.sendRequest(_,d)}onDisconnectPut(e,r,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,r,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:r,onComplete:s})}onDisconnectMerge(e,r,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,r,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:r,onComplete:s})}onDisconnectCancel(e,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(e,r,s,c){const d={p:r,d:s};this.log_("onDisconnect "+e,d),this.sendRequest(e,d,_=>{c&&setTimeout(()=>{c(_.s,_.d)},Math.floor(0))})}put(e,r,s,c){this.putInternal("p",e,r,s,c)}merge(e,r,s,c){this.putInternal("m",e,r,s,c)}putInternal(e,r,s,c,d){this.initConnection_();const _={p:r,d:s};d!==void 0&&(_.h=d),this.outstandingPuts_.push({action:e,request:_,onComplete:c}),this.outstandingPutCount_++;const x=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(x):this.log_("Buffering put: "+r)}sendPut_(e){const r=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,c=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(r,s,d=>{this.log_(r+" response",d),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),c&&c(d.s,d.d)})}reportStats(e){if(this.connected_){const r={c:e};this.log_("reportStats",r),this.sendRequest("s",r,s=>{if(s.s!=="ok"){const d=s.d;this.log_("reportStats","Error sending stats: "+d)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+To(e));const r=e.r,s=this.requestCBHash_[r];s&&(delete this.requestCBHash_[r],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,r){this.log_("handleServerMessage",e,r),e==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):e==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):e==="c"?this.onListenRevoked_(r.p,r.q):e==="ac"?this.onAuthRevoked_(r.s,r.d):e==="apc"?this.onAppCheckRevoked_(r.s,r.d):e==="sd"?this.onSecurityDebugPacket_(r):mI("Unrecognized action received from server: "+To(e)+`
Are you using the latest client?`)}onReady_(e,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){br(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Dy,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Dy,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>lK&&(this.reconnectDelay_=Dy),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let r=Math.max(0,this.reconnectDelay_-e);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*aK)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),c=this.id+":"+dh.nextConnectionId_++,d=this.lastSessionId;let _=!1,x=null;const l=function(){x?x.close():(_=!0,s())},S=function(I){br(x,"sendRequest call when we're not connected not allowed."),x.sendRequest(I)};this.realtime_={close:l,sendRequest:S};const D=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[I,V]=await Promise.all([this.authTokenProvider_.getToken(D),this.appCheckTokenProvider_.getToken(D)]);_?Go("getToken() completed but was canceled"):(Go("getToken() completed. Creating connection."),this.authToken_=I&&I.accessToken,this.appCheckToken_=V&&V.token,x=new tK(c,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,r,s,j=>{fl(j+" ("+this.repoInfo_.toString()+")"),this.interrupt(cK)},d))}catch(I){this.log_("Failed to get token: "+I),_||(this.repoInfo_.nodeAdmin&&fl(I),l())}}}interrupt(e){Go("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Go("Resuming connection for reason: "+e),delete this.interruptReasons_[e],rI(this.interruptReasons_)&&(this.reconnectDelay_=Dy,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const r=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const r=this.outstandingPuts_[e];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,r){let s;r?s=r.map(d=>TC(d)).join("$"):s="default";const c=this.removeListen_(e,s);c&&c.onComplete&&c.onComplete("permission_denied")}removeListen_(e,r){const s=new Qn(e).toString();let c;if(this.listens.has(s)){const d=this.listens.get(s);c=d.get(r),d.delete(r),d.size===0&&this.listens.delete(s)}else c=void 0;return c}onAuthRevoked_(e,r){Go("Auth token revoked: "+e+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=bD&&(this.reconnectDelay_=xD,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,r){Go("App check token revoked: "+e+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=bD&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const r of e.values())this.sendListen_(r);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let r="js";e["sdk."+r+"."+yN.replace(/\./g,"-")]=1,oC()?e["framework.cordova"]=1:wF()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Qw.getInstance().currentlyOnline();return rI(this.interruptReasons_)&&e}}dh.nextPersistentConnectionId_=0;dh.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e,r){this.name=e,this.node=r}static Wrap(e,r){return new dn(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aE{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,r){const s=new dn(Sg,e),c=new dn(Sg,r);return this.compare(s,c)!==0}minPost(){return dn.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zb;class HN extends aE{static get __EMPTY_NODE(){return zb}static set __EMPTY_NODE(e){zb=e}compare(e,r){return Kg(e.name,r.name)}isDefinedOn(e){throw Zg("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,r){return!1}minPost(){return dn.MIN}maxPost(){return new dn(Yp,zb)}makePost(e,r){return br(typeof e=="string","KeyIndex indexValue must always be a string."),new dn(e,zb)}toString(){return".key"}}const ug=new HN;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fb=class{constructor(e,r,s,c,d=null){this.isReverse_=c,this.resultGenerator_=d,this.nodeStack_=[];let _=1;for(;!e.isEmpty();)if(e=e,_=r?s(e.key,r):1,c&&(_*=-1),_<0)this.isReverse_?e=e.left:e=e.right;else if(_===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),r;if(this.resultGenerator_?r=this.resultGenerator_(e.key,e.value):r={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return r}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},al=class Xy{constructor(e,r,s,c,d){this.key=e,this.value=r,this.color=s??Xy.RED,this.left=c??iu.EMPTY_NODE,this.right=d??iu.EMPTY_NODE}copy(e,r,s,c,d){return new Xy(e??this.key,r??this.value,s??this.color,c??this.left,d??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,r,s){let c=this;const d=s(e,c.key);return d<0?c=c.copy(null,null,null,c.left.insert(e,r,s),null):d===0?c=c.copy(null,r,null,null,null):c=c.copy(null,null,null,null,c.right.insert(e,r,s)),c.fixUp_()}removeMin_(){if(this.left.isEmpty())return iu.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,r){let s,c;if(s=this,r(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,r),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),r(e,s.key)===0){if(s.right.isEmpty())return iu.EMPTY_NODE;c=s.right.min_(),s=s.copy(c.key,c.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,r))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Xy.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Xy.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};al.RED=!0;al.BLACK=!1;class uK{copy(e,r,s,c,d){return this}insert(e,r,s){return new al(e,r,null)}remove(e,r){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let iu=class yw{constructor(e,r=yw.EMPTY_NODE){this.comparator_=e,this.root_=r}insert(e,r){return new yw(this.comparator_,this.root_.insert(e,r,this.comparator_).copy(null,null,al.BLACK,null,null))}remove(e){return new yw(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,al.BLACK,null,null))}get(e){let r,s=this.root_;for(;!s.isEmpty();){if(r=this.comparator_(e,s.key),r===0)return s.value;r<0?s=s.left:r>0&&(s=s.right)}return null}getPredecessorKey(e){let r,s=this.root_,c=null;for(;!s.isEmpty();)if(r=this.comparator_(e,s.key),r===0){if(s.left.isEmpty())return c?c.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else r<0?s=s.left:r>0&&(c=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Fb(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,r){return new Fb(this.root_,e,this.comparator_,!1,r)}getReverseIteratorFrom(e,r){return new Fb(this.root_,e,this.comparator_,!0,r)}getReverseIterator(e){return new Fb(this.root_,null,this.comparator_,!0,e)}};iu.EMPTY_NODE=new uK;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hK(n,e){return Kg(n.name,e.name)}function CC(n,e){return Kg(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gI;function dK(n){gI=n}const WN=function(n){return typeof n=="number"?"number:"+TN(n):"string:"+n},ZN=function(n){if(n.isLeafNode()){const e=n.val();br(typeof e=="string"||typeof e=="number"||typeof e=="object"&&bh(e,".sv"),"Priority must be a string or number.")}else br(n===gI||n.isEmpty(),"priority of unexpected type.");br(n===gI||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wD;class ao{constructor(e,r=ao.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=r,this.lazyHash_=null,br(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),ZN(this.priorityNode_)}static set __childrenNodeConstructor(e){wD=e}static get __childrenNodeConstructor(){return wD}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ao(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:ao.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return sn(e)?this:hn(e)===".priority"?this.priorityNode_:ao.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,r){return null}updateImmediateChild(e,r){return e===".priority"?this.updatePriority(r):r.isEmpty()&&e!==".priority"?this:ao.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,r).updatePriority(this.priorityNode_)}updateChild(e,r){const s=hn(e);return s===null?r:r.isEmpty()&&s!==".priority"?this:(br(s!==".priority"||Yd(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,ao.__childrenNodeConstructor.EMPTY_NODE.updateChild(Yn(e),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,r){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+WN(this.priorityNode_.val())+":");const r=typeof this.value_;e+=r+":",r==="number"?e+=TN(this.value_):e+=this.value_,this.lazyHash_=xN(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ao.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ao.__childrenNodeConstructor?-1:(br(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const r=typeof e.value_,s=typeof this.value_,c=ao.VALUE_TYPE_ORDER.indexOf(r),d=ao.VALUE_TYPE_ORDER.indexOf(s);return br(c>=0,"Unknown leaf type: "+r),br(d>=0,"Unknown leaf type: "+s),c===d?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:d-c}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const r=e;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}ao.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let XN,YN;function fK(n){XN=n}function pK(n){YN=n}class mK extends aE{compare(e,r){const s=e.node.getPriority(),c=r.node.getPriority(),d=s.compareTo(c);return d===0?Kg(e.name,r.name):d}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,r){return!e.getPriority().equals(r.getPriority())}minPost(){return dn.MIN}maxPost(){return new dn(Yp,new ao("[PRIORITY-POST]",YN))}makePost(e,r){const s=XN(e);return new dn(r,new ao("[PRIORITY-POST]",s))}toString(){return".priority"}}const Yo=new mK;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _K=Math.log(2);class gK{constructor(e){const r=d=>parseInt(Math.log(d)/_K,10),s=d=>parseInt(Array(d+1).join("1"),2);this.count=r(e+1),this.current_=this.count-1;const c=s(this.count);this.bits_=e+1&c}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Kw=function(n,e,r,s){n.sort(e);const c=function(l,S){const D=S-l;let I,V;if(D===0)return null;if(D===1)return I=n[l],V=r?r(I):I,new al(V,I.node,al.BLACK,null,null);{const j=parseInt(D/2,10)+l,Q=c(l,j),te=c(j+1,S);return I=n[j],V=r?r(I):I,new al(V,I.node,al.BLACK,Q,te)}},d=function(l){let S=null,D=null,I=n.length;const V=function(Q,te){const ce=I-Q,Ce=I;I-=Q;const Me=c(ce+1,Ce),Ie=n[ce],Te=r?r(Ie):Ie;j(new al(Te,Ie.node,te,null,Me))},j=function(Q){S?(S.left=Q,S=Q):(D=Q,S=Q)};for(let Q=0;Q<l.count;++Q){const te=l.nextBitIsOne(),ce=Math.pow(2,l.count-(Q+1));te?V(ce,al.BLACK):(V(ce,al.BLACK),V(ce,al.RED))}return D},_=new gK(n.length),x=d(_);return new iu(s||e,x)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tA;const M_={};class ch{constructor(e,r){this.indexes_=e,this.indexSet_=r}static get Default(){return br(M_&&Yo,"ChildrenNode.ts has not been loaded"),tA=tA||new ch({".priority":M_},{".priority":Yo}),tA}get(e){const r=Ag(this.indexes_,e);if(!r)throw new Error("No index defined for "+e);return r instanceof iu?r:null}hasIndex(e){return bh(this.indexSet_,e.toString())}addIndex(e,r){br(e!==ug,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let c=!1;const d=r.getIterator(dn.Wrap);let _=d.getNext();for(;_;)c=c||e.isDefinedOn(_.node),s.push(_),_=d.getNext();let x;c?x=Kw(s,e.getCompare()):x=M_;const l=e.toString(),S=Object.assign({},this.indexSet_);S[l]=e;const D=Object.assign({},this.indexes_);return D[l]=x,new ch(D,S)}addToIndexes(e,r){const s=jw(this.indexes_,(c,d)=>{const _=Ag(this.indexSet_,d);if(br(_,"Missing index implementation for "+d),c===M_)if(_.isDefinedOn(e.node)){const x=[],l=r.getIterator(dn.Wrap);let S=l.getNext();for(;S;)S.name!==e.name&&x.push(S),S=l.getNext();return x.push(e),Kw(x,_.getCompare())}else return M_;else{const x=r.get(e.name);let l=c;return x&&(l=l.remove(new dn(e.name,x))),l.insert(e,e.node)}});return new ch(s,this.indexSet_)}removeFromIndexes(e,r){const s=jw(this.indexes_,c=>{if(c===M_)return c;{const d=r.get(e.name);return d?c.remove(new dn(e.name,d)):c}});return new ch(s,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ly;class Sn{constructor(e,r,s){this.children_=e,this.priorityNode_=r,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&ZN(this.priorityNode_),this.children_.isEmpty()&&br(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Ly||(Ly=new Sn(new iu(CC),null,ch.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ly}updatePriority(e){return this.children_.isEmpty()?this:new Sn(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const r=this.children_.get(e);return r===null?Ly:r}}getChild(e){const r=hn(e);return r===null?this:this.getImmediateChild(r).getChild(Yn(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,r){if(br(r,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(r);{const s=new dn(e,r);let c,d;r.isEmpty()?(c=this.children_.remove(e),d=this.indexMap_.removeFromIndexes(s,this.children_)):(c=this.children_.insert(e,r),d=this.indexMap_.addToIndexes(s,this.children_));const _=c.isEmpty()?Ly:this.priorityNode_;return new Sn(c,_,d)}}updateChild(e,r){const s=hn(e);if(s===null)return r;{br(hn(e)!==".priority"||Yd(e)===1,".priority must be the last token in a path");const c=this.getImmediateChild(s).updateChild(Yn(e),r);return this.updateImmediateChild(s,c)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const r={};let s=0,c=0,d=!0;if(this.forEachChild(Yo,(_,x)=>{r[_]=x.val(e),s++,d&&Sn.INTEGER_REGEXP_.test(_)?c=Math.max(c,Number(_)):d=!1}),!e&&d&&c<2*s){const _=[];for(const x in r)_[x]=r[x];return _}else return e&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+WN(this.getPriority().val())+":"),this.forEachChild(Yo,(r,s)=>{const c=s.hash();c!==""&&(e+=":"+r+":"+c)}),this.lazyHash_=e===""?"":xN(e)}return this.lazyHash_}getPredecessorChildName(e,r,s){const c=this.resolveIndex_(s);if(c){const d=c.getPredecessorKey(new dn(e,r));return d?d.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const r=this.resolveIndex_(e);if(r){const s=r.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const r=this.getFirstChildName(e);return r?new dn(r,this.children_.get(r)):null}getLastChildName(e){const r=this.resolveIndex_(e);if(r){const s=r.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const r=this.getLastChildName(e);return r?new dn(r,this.children_.get(r)):null}forEachChild(e,r){const s=this.resolveIndex_(e);return s?s.inorderTraversal(c=>r(c.name,c.node)):this.children_.inorderTraversal(r)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,r){const s=this.resolveIndex_(r);if(s)return s.getIteratorFrom(e,c=>c);{const c=this.children_.getIteratorFrom(e.name,dn.Wrap);let d=c.peek();for(;d!=null&&r.compare(d,e)<0;)c.getNext(),d=c.peek();return c}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,r){const s=this.resolveIndex_(r);if(s)return s.getReverseIteratorFrom(e,c=>c);{const c=this.children_.getReverseIteratorFrom(e.name,dn.Wrap);let d=c.peek();for(;d!=null&&r.compare(d,e)>0;)c.getNext(),d=c.peek();return c}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===R1?-1:0}withIndex(e){if(e===ug||this.indexMap_.hasIndex(e))return this;{const r=this.indexMap_.addIndex(e,this.children_);return new Sn(this.children_,this.priorityNode_,r)}}isIndexed(e){return e===ug||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const r=e;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){const s=this.getIterator(Yo),c=r.getIterator(Yo);let d=s.getNext(),_=c.getNext();for(;d&&_;){if(d.name!==_.name||!d.node.equals(_.node))return!1;d=s.getNext(),_=c.getNext()}return d===null&&_===null}else return!1;else return!1}}resolveIndex_(e){return e===ug?null:this.indexMap_.get(e.toString())}}Sn.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class yK extends Sn{constructor(){super(new iu(CC),Sn.EMPTY_NODE,ch.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Sn.EMPTY_NODE}isEmpty(){return!1}}const R1=new yK;Object.defineProperties(dn,{MIN:{value:new dn(Sg,Sn.EMPTY_NODE)},MAX:{value:new dn(Yp,R1)}});HN.__EMPTY_NODE=Sn.EMPTY_NODE;ao.__childrenNodeConstructor=Sn;dK(R1);pK(R1);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vK=!0;function qo(n,e=null){if(n===null)return Sn.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),br(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const r=n;return new ao(r,qo(e))}if(!(n instanceof Array)&&vK){const r=[];let s=!1;if(ql(n,(_,x)=>{if(_.substring(0,1)!=="."){const l=qo(x);l.isEmpty()||(s=s||!l.getPriority().isEmpty(),r.push(new dn(_,l)))}}),r.length===0)return Sn.EMPTY_NODE;const d=Kw(r,hK,_=>_.name,CC);if(s){const _=Kw(r,Yo.getCompare());return new Sn(d,qo(e),new ch({".priority":_},{".priority":Yo}))}else return new Sn(d,qo(e),ch.Default)}else{let r=Sn.EMPTY_NODE;return ql(n,(s,c)=>{if(bh(n,s)&&s.substring(0,1)!=="."){const d=qo(c);(d.isLeafNode()||!d.isEmpty())&&(r=r.updateImmediateChild(s,d))}}),r.updatePriority(qo(e))}}fK(qo);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xK extends aE{constructor(e){super(),this.indexPath_=e,br(!sn(e)&&hn(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,r){const s=this.extractChild(e.node),c=this.extractChild(r.node),d=s.compareTo(c);return d===0?Kg(e.name,r.name):d}makePost(e,r){const s=qo(e),c=Sn.EMPTY_NODE.updateChild(this.indexPath_,s);return new dn(r,c)}maxPost(){const e=Sn.EMPTY_NODE.updateChild(this.indexPath_,R1);return new dn(Yp,e)}toString(){return jN(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bK extends aE{compare(e,r){const s=e.node.compareTo(r.node);return s===0?Kg(e.name,r.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,r){return!e.equals(r)}minPost(){return dn.MIN}maxPost(){return dn.MAX}makePost(e,r){const s=qo(e);return new dn(r,s)}toString(){return".value"}}const wK=new bK;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TK(n){return{type:"value",snapshotNode:n}}function EK(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function AK(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function TD(n,e,r){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:r}}function IK(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RC{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Yo}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return br(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return br(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Sg}hasEnd(){return this.endSet_}getIndexEndValue(){return br(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return br(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Yp}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return br(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Yo}copy(){const e=new RC;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function ED(n){const e={};if(n.isDefault())return e;let r;if(n.index_===Yo?r="$priority":n.index_===wK?r="$value":n.index_===ug?r="$key":(br(n.index_ instanceof xK,"Unrecognized index type!"),r=n.index_.toString()),e.orderBy=To(r),n.startSet_){const s=n.startAfterSet_?"startAfter":"startAt";e[s]=To(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+To(n.indexStartName_))}if(n.endSet_){const s=n.endBeforeSet_?"endBefore":"endAt";e[s]=To(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+To(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function AD(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let r=n.viewFrom_;r===""&&(n.isViewFromLeft()?r="l":r="r"),e.vf=r}return n.index_!==Yo&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jw extends BN{constructor(e,r,s,c){super(),this.repoInfo_=e,this.onDataUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=c,this.log_=S1("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,r){return r!==void 0?"tag$"+r:(br(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,r,s,c){const d=e._path.toString();this.log_("Listen called for "+d+" "+e._queryIdentifier);const _=Jw.getListenId_(e,s),x={};this.listens_[_]=x;const l=ED(e._queryParams);this.restRequest_(d+".json",l,(S,D)=>{let I=D;if(S===404&&(I=null,S=null),S===null&&this.onDataUpdate_(d,I,!1,s),Ag(this.listens_,_)===x){let V;S?S===401?V="permission_denied":V="rest_error:"+S:V="ok",c(V,null)}})}unlisten(e,r){const s=Jw.getListenId_(e,r);delete this.listens_[s]}get(e){const r=ED(e._queryParams),s=e._path.toString(),c=new Hv;return this.restRequest_(s+".json",r,(d,_)=>{let x=_;d===404&&(x=null,d=null),d===null?(this.onDataUpdate_(s,x,!1,null),c.resolve(x)):c.reject(new Error(x))}),c.promise}refreshAuthToken(e){}restRequest_(e,r={},s){return r.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([c,d])=>{c&&c.accessToken&&(r.auth=c.accessToken),d&&d.token&&(r.ac=d.token);const _=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Xg(r);this.log_("Sending REST request for "+_);const x=new XMLHttpRequest;x.onreadystatechange=()=>{if(s&&x.readyState===4){this.log_("REST Response for "+_+" received. status:",x.status,"response:",x.responseText);let l=null;if(x.status>=200&&x.status<300){try{l=Wv(x.responseText)}catch{fl("Failed to parse JSON response for "+_+": "+x.responseText)}s(null,l)}else x.status!==401&&x.status!==404&&fl("Got unsuccessful REST response for "+_+" Status: "+x.status),s(x.status);s=null}},x.open("GET",_,!0),x.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SK{constructor(){this.rootNode_=Sn.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,r){this.rootNode_=this.rootNode_.updateChild(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eT(){return{value:null,children:new Map}}function QN(n,e,r){if(sn(e))n.value=r,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,r);else{const s=hn(e);n.children.has(s)||n.children.set(s,eT());const c=n.children.get(s);e=Yn(e),QN(c,e,r)}}function yI(n,e,r){n.value!==null?r(e,n.value):CK(n,(s,c)=>{const d=new Qn(e.toString()+"/"+s);yI(c,d,r)})}function CK(n,e){n.children.forEach((r,s)=>{e(s,r)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RK{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),r=Object.assign({},e);return this.last_&&ql(this.last_,(s,c)=>{r[s]=r[s]-c}),this.last_=e,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ID=10*1e3,PK=30*1e3,MK=5*60*1e3;class kK{constructor(e,r){this.server_=r,this.statsToReport_={},this.statsListener_=new RK(e);const s=ID+(PK-ID)*Math.random();gv(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),r={};let s=!1;ql(e,(c,d)=>{d>0&&bh(this.statsToReport_,c)&&(r[c]=d,s=!0)}),s&&this.server_.reportStats(r),gv(this.reportStats_.bind(this),Math.floor(Math.random()*2*MK))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nu;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(nu||(nu={}));function KN(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function JN(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function eB(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tT{constructor(e,r,s){this.path=e,this.affectedTree=r,this.revert=s,this.type=nu.ACK_USER_WRITE,this.source=KN()}operationForChild(e){if(sn(this.path)){if(this.affectedTree.value!=null)return br(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const r=this.affectedTree.subtree(new Qn(e));return new tT(Dn(),r,this.revert)}}else return br(hn(this.path)===e,"operationForChild called for unrelated child."),new tT(Yn(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qp{constructor(e,r,s){this.source=e,this.path=r,this.snap=s,this.type=nu.OVERWRITE}operationForChild(e){return sn(this.path)?new Qp(this.source,Dn(),this.snap.getImmediateChild(e)):new Qp(this.source,Yn(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kv{constructor(e,r,s){this.source=e,this.path=r,this.children=s,this.type=nu.MERGE}operationForChild(e){if(sn(this.path)){const r=this.children.subtree(new Qn(e));return r.isEmpty()?null:r.value?new Qp(this.source,Dn(),r.value):new Kv(this.source,Dn(),r)}else return br(hn(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Kv(this.source,Yn(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC{constructor(e,r,s){this.node_=e,this.fullyInitialized_=r,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(sn(e))return this.isFullyInitialized()&&!this.filtered_;const r=hn(e);return this.isCompleteForChild(r)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function DK(n,e,r,s){const c=[],d=[];return e.forEach(_=>{_.type==="child_changed"&&n.index_.indexedValueChanged(_.oldSnap,_.snapshotNode)&&d.push(IK(_.childName,_.snapshotNode))}),Oy(n,c,"child_removed",e,s,r),Oy(n,c,"child_added",e,s,r),Oy(n,c,"child_moved",d,s,r),Oy(n,c,"child_changed",e,s,r),Oy(n,c,"value",e,s,r),c}function Oy(n,e,r,s,c,d){const _=s.filter(x=>x.type===r);_.sort((x,l)=>OK(n,x,l)),_.forEach(x=>{const l=LK(n,x,d);c.forEach(S=>{S.respondsTo(x.type)&&e.push(S.createEvent(l,n.query_))})})}function LK(n,e,r){return e.type==="value"||e.type==="child_removed"||(e.prevName=r.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function OK(n,e,r){if(e.childName==null||r.childName==null)throw Zg("Should only compare child_ events.");const s=new dn(e.childName,e.snapshotNode),c=new dn(r.childName,r.snapshotNode);return n.index_.compare(s,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tB(n,e){return{eventCache:n,serverCache:e}}function yv(n,e,r,s){return tB(new PC(e,r,s),n.serverCache)}function rB(n,e,r,s){return tB(n.eventCache,new PC(e,r,s))}function vI(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Kp(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rA;const zK=()=>(rA||(rA=new iu(bQ)),rA);class Zn{constructor(e,r=zK()){this.value=e,this.children=r}static fromObject(e){let r=new Zn(null);return ql(e,(s,c)=>{r=r.set(new Qn(s),c)}),r}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,r){if(this.value!=null&&r(this.value))return{path:Dn(),value:this.value};if(sn(e))return null;{const s=hn(e),c=this.children.get(s);if(c!==null){const d=c.findRootMostMatchingPathAndValue(Yn(e),r);return d!=null?{path:uo(new Qn(s),d.path),value:d.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(sn(e))return this;{const r=hn(e),s=this.children.get(r);return s!==null?s.subtree(Yn(e)):new Zn(null)}}set(e,r){if(sn(e))return new Zn(r,this.children);{const s=hn(e),d=(this.children.get(s)||new Zn(null)).set(Yn(e),r),_=this.children.insert(s,d);return new Zn(this.value,_)}}remove(e){if(sn(e))return this.children.isEmpty()?new Zn(null):new Zn(null,this.children);{const r=hn(e),s=this.children.get(r);if(s){const c=s.remove(Yn(e));let d;return c.isEmpty()?d=this.children.remove(r):d=this.children.insert(r,c),this.value===null&&d.isEmpty()?new Zn(null):new Zn(this.value,d)}else return this}}get(e){if(sn(e))return this.value;{const r=hn(e),s=this.children.get(r);return s?s.get(Yn(e)):null}}setTree(e,r){if(sn(e))return r;{const s=hn(e),d=(this.children.get(s)||new Zn(null)).setTree(Yn(e),r);let _;return d.isEmpty()?_=this.children.remove(s):_=this.children.insert(s,d),new Zn(this.value,_)}}fold(e){return this.fold_(Dn(),e)}fold_(e,r){const s={};return this.children.inorderTraversal((c,d)=>{s[c]=d.fold_(uo(e,c),r)}),r(e,this.value,s)}findOnPath(e,r){return this.findOnPath_(e,Dn(),r)}findOnPath_(e,r,s){const c=this.value?s(r,this.value):!1;if(c)return c;if(sn(e))return null;{const d=hn(e),_=this.children.get(d);return _?_.findOnPath_(Yn(e),uo(r,d),s):null}}foreachOnPath(e,r){return this.foreachOnPath_(e,Dn(),r)}foreachOnPath_(e,r,s){if(sn(e))return this;{this.value&&s(r,this.value);const c=hn(e),d=this.children.get(c);return d?d.foreachOnPath_(Yn(e),uo(r,c),s):new Zn(null)}}foreach(e){this.foreach_(Dn(),e)}foreach_(e,r){this.children.inorderTraversal((s,c)=>{c.foreach_(uo(e,s),r)}),this.value&&r(e,this.value)}foreachChild(e){this.children.inorderTraversal((r,s)=>{s.value&&e(r,s.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ac{constructor(e){this.writeTree_=e}static empty(){return new Ac(new Zn(null))}}function vv(n,e,r){if(sn(e))return new Ac(new Zn(r));{const s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){const c=s.path;let d=s.value;const _=Nl(c,e);return d=d.updateChild(_,r),new Ac(n.writeTree_.set(c,d))}else{const c=new Zn(r),d=n.writeTree_.setTree(e,c);return new Ac(d)}}}function SD(n,e,r){let s=n;return ql(r,(c,d)=>{s=vv(s,uo(e,c),d)}),s}function CD(n,e){if(sn(e))return Ac.empty();{const r=n.writeTree_.setTree(e,new Zn(null));return new Ac(r)}}function xI(n,e){return pm(n,e)!=null}function pm(n,e){const r=n.writeTree_.findRootMostValueAndPath(e);return r!=null?n.writeTree_.get(r.path).getChild(Nl(r.path,e)):null}function RD(n){const e=[],r=n.writeTree_.value;return r!=null?r.isLeafNode()||r.forEachChild(Yo,(s,c)=>{e.push(new dn(s,c))}):n.writeTree_.children.inorderTraversal((s,c)=>{c.value!=null&&e.push(new dn(s,c.value))}),e}function jd(n,e){if(sn(e))return n;{const r=pm(n,e);return r!=null?new Ac(new Zn(r)):new Ac(n.writeTree_.subtree(e))}}function bI(n){return n.writeTree_.isEmpty()}function Cg(n,e){return iB(Dn(),n.writeTree_,e)}function iB(n,e,r){if(e.value!=null)return r.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((c,d)=>{c===".priority"?(br(d.value!==null,"Priority writes must always be leaf nodes"),s=d.value):r=iB(uo(n,c),d,r)}),!r.getChild(n).isEmpty()&&s!==null&&(r=r.updateChild(uo(n,".priority"),s)),r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nB(n,e){return cB(e,n)}function FK(n,e,r,s,c){br(s>n.lastWriteId,"Stacking an older write on top of newer ones"),c===void 0&&(c=!0),n.allWrites.push({path:e,snap:r,writeId:s,visible:c}),c&&(n.visibleWrites=vv(n.visibleWrites,e,r)),n.lastWriteId=s}function NK(n,e){for(let r=0;r<n.allWrites.length;r++){const s=n.allWrites[r];if(s.writeId===e)return s}return null}function BK(n,e){const r=n.allWrites.findIndex(x=>x.writeId===e);br(r>=0,"removeWrite called with nonexistent writeId.");const s=n.allWrites[r];n.allWrites.splice(r,1);let c=s.visible,d=!1,_=n.allWrites.length-1;for(;c&&_>=0;){const x=n.allWrites[_];x.visible&&(_>=r&&VK(x,s.path)?c=!1:yc(s.path,x.path)&&(d=!0)),_--}if(c){if(d)return UK(n),!0;if(s.snap)n.visibleWrites=CD(n.visibleWrites,s.path);else{const x=s.children;ql(x,l=>{n.visibleWrites=CD(n.visibleWrites,uo(s.path,l))})}return!0}else return!1}function VK(n,e){if(n.snap)return yc(n.path,e);for(const r in n.children)if(n.children.hasOwnProperty(r)&&yc(uo(n.path,r),e))return!0;return!1}function UK(n){n.visibleWrites=sB(n.allWrites,jK,Dn()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function jK(n){return n.visible}function sB(n,e,r){let s=Ac.empty();for(let c=0;c<n.length;++c){const d=n[c];if(e(d)){const _=d.path;let x;if(d.snap)yc(r,_)?(x=Nl(r,_),s=vv(s,x,d.snap)):yc(_,r)&&(x=Nl(_,r),s=vv(s,Dn(),d.snap.getChild(x)));else if(d.children){if(yc(r,_))x=Nl(r,_),s=SD(s,x,d.children);else if(yc(_,r))if(x=Nl(_,r),sn(x))s=SD(s,Dn(),d.children);else{const l=Ag(d.children,hn(x));if(l){const S=l.getChild(Yn(x));s=vv(s,Dn(),S)}}}else throw Zg("WriteRecord should have .snap or .children")}}return s}function oB(n,e,r,s,c){if(!s&&!c){const d=pm(n.visibleWrites,e);if(d!=null)return d;{const _=jd(n.visibleWrites,e);if(bI(_))return r;if(r==null&&!xI(_,Dn()))return null;{const x=r||Sn.EMPTY_NODE;return Cg(_,x)}}}else{const d=jd(n.visibleWrites,e);if(!c&&bI(d))return r;if(!c&&r==null&&!xI(d,Dn()))return null;{const _=function(S){return(S.visible||c)&&(!s||!~s.indexOf(S.writeId))&&(yc(S.path,e)||yc(e,S.path))},x=sB(n.allWrites,_,e),l=r||Sn.EMPTY_NODE;return Cg(x,l)}}}function $K(n,e,r){let s=Sn.EMPTY_NODE;const c=pm(n.visibleWrites,e);if(c)return c.isLeafNode()||c.forEachChild(Yo,(d,_)=>{s=s.updateImmediateChild(d,_)}),s;if(r){const d=jd(n.visibleWrites,e);return r.forEachChild(Yo,(_,x)=>{const l=Cg(jd(d,new Qn(_)),x);s=s.updateImmediateChild(_,l)}),RD(d).forEach(_=>{s=s.updateImmediateChild(_.name,_.node)}),s}else{const d=jd(n.visibleWrites,e);return RD(d).forEach(_=>{s=s.updateImmediateChild(_.name,_.node)}),s}}function GK(n,e,r,s,c){br(s||c,"Either existingEventSnap or existingServerSnap must exist");const d=uo(e,r);if(xI(n.visibleWrites,d))return null;{const _=jd(n.visibleWrites,d);return bI(_)?c.getChild(r):Cg(_,c.getChild(r))}}function qK(n,e,r,s){const c=uo(e,r),d=pm(n.visibleWrites,c);if(d!=null)return d;if(s.isCompleteForChild(r)){const _=jd(n.visibleWrites,c);return Cg(_,s.getNode().getImmediateChild(r))}else return null}function HK(n,e){return pm(n.visibleWrites,e)}function WK(n,e,r,s,c,d,_){let x;const l=jd(n.visibleWrites,e),S=pm(l,Dn());if(S!=null)x=S;else if(r!=null)x=Cg(l,r);else return[];if(x=x.withIndex(_),!x.isEmpty()&&!x.isLeafNode()){const D=[],I=_.getCompare(),V=d?x.getReverseIteratorFrom(s,_):x.getIteratorFrom(s,_);let j=V.getNext();for(;j&&D.length<c;)I(j,s)!==0&&D.push(j),j=V.getNext();return D}else return[]}function ZK(){return{visibleWrites:Ac.empty(),allWrites:[],lastWriteId:-1}}function wI(n,e,r,s){return oB(n.writeTree,n.treePath,e,r,s)}function aB(n,e){return $K(n.writeTree,n.treePath,e)}function PD(n,e,r,s){return GK(n.writeTree,n.treePath,e,r,s)}function rT(n,e){return HK(n.writeTree,uo(n.treePath,e))}function XK(n,e,r,s,c,d){return WK(n.writeTree,n.treePath,e,r,s,c,d)}function MC(n,e,r){return qK(n.writeTree,n.treePath,e,r)}function lB(n,e){return cB(uo(n.treePath,e),n.writeTree)}function cB(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YK{constructor(){this.changeMap=new Map}trackChildChange(e){const r=e.type,s=e.childName;br(r==="child_added"||r==="child_changed"||r==="child_removed","Only child changes supported for tracking"),br(s!==".priority","Only non-priority child changes can be tracked.");const c=this.changeMap.get(s);if(c){const d=c.type;if(r==="child_added"&&d==="child_removed")this.changeMap.set(s,TD(s,e.snapshotNode,c.snapshotNode));else if(r==="child_removed"&&d==="child_added")this.changeMap.delete(s);else if(r==="child_removed"&&d==="child_changed")this.changeMap.set(s,AK(s,c.oldSnap));else if(r==="child_changed"&&d==="child_added")this.changeMap.set(s,EK(s,e.snapshotNode));else if(r==="child_changed"&&d==="child_changed")this.changeMap.set(s,TD(s,e.snapshotNode,c.oldSnap));else throw Zg("Illegal combination of changes: "+e+" occurred after "+c)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QK{getCompleteChild(e){return null}getChildAfterChild(e,r,s){return null}}const uB=new QK;class kC{constructor(e,r,s=null){this.writes_=e,this.viewCache_=r,this.optCompleteServerCache_=s}getCompleteChild(e){const r=this.viewCache_.eventCache;if(r.isCompleteForChild(e))return r.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new PC(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return MC(this.writes_,e,s)}}getChildAfterChild(e,r,s){const c=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Kp(this.viewCache_),d=XK(this.writes_,c,r,1,s,e);return d.length===0?null:d[0]}}function KK(n,e){br(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),br(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function JK(n,e,r,s,c){const d=new YK;let _,x;if(r.type===nu.OVERWRITE){const S=r;S.source.fromUser?_=TI(n,e,S.path,S.snap,s,c,d):(br(S.source.fromServer,"Unknown source."),x=S.source.tagged||e.serverCache.isFiltered()&&!sn(S.path),_=iT(n,e,S.path,S.snap,s,c,x,d))}else if(r.type===nu.MERGE){const S=r;S.source.fromUser?_=tJ(n,e,S.path,S.children,s,c,d):(br(S.source.fromServer,"Unknown source."),x=S.source.tagged||e.serverCache.isFiltered(),_=EI(n,e,S.path,S.children,s,c,x,d))}else if(r.type===nu.ACK_USER_WRITE){const S=r;S.revert?_=nJ(n,e,S.path,s,c,d):_=rJ(n,e,S.path,S.affectedTree,s,c,d)}else if(r.type===nu.LISTEN_COMPLETE)_=iJ(n,e,r.path,s,d);else throw Zg("Unknown operation type: "+r.type);const l=d.getChanges();return eJ(e,_,l),{viewCache:_,changes:l}}function eJ(n,e,r){const s=e.eventCache;if(s.isFullyInitialized()){const c=s.getNode().isLeafNode()||s.getNode().isEmpty(),d=vI(n);(r.length>0||!n.eventCache.isFullyInitialized()||c&&!s.getNode().equals(d)||!s.getNode().getPriority().equals(d.getPriority()))&&r.push(TK(vI(e)))}}function hB(n,e,r,s,c,d){const _=e.eventCache;if(rT(s,r)!=null)return e;{let x,l;if(sn(r))if(br(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const S=Kp(e),D=S instanceof Sn?S:Sn.EMPTY_NODE,I=aB(s,D);x=n.filter.updateFullNode(e.eventCache.getNode(),I,d)}else{const S=wI(s,Kp(e));x=n.filter.updateFullNode(e.eventCache.getNode(),S,d)}else{const S=hn(r);if(S===".priority"){br(Yd(r)===1,"Can't have a priority with additional path components");const D=_.getNode();l=e.serverCache.getNode();const I=PD(s,r,D,l);I!=null?x=n.filter.updatePriority(D,I):x=_.getNode()}else{const D=Yn(r);let I;if(_.isCompleteForChild(S)){l=e.serverCache.getNode();const V=PD(s,r,_.getNode(),l);V!=null?I=_.getNode().getImmediateChild(S).updateChild(D,V):I=_.getNode().getImmediateChild(S)}else I=MC(s,S,e.serverCache);I!=null?x=n.filter.updateChild(_.getNode(),S,I,D,c,d):x=_.getNode()}}return yv(e,x,_.isFullyInitialized()||sn(r),n.filter.filtersNodes())}}function iT(n,e,r,s,c,d,_,x){const l=e.serverCache;let S;const D=_?n.filter:n.filter.getIndexedFilter();if(sn(r))S=D.updateFullNode(l.getNode(),s,null);else if(D.filtersNodes()&&!l.isFiltered()){const j=l.getNode().updateChild(r,s);S=D.updateFullNode(l.getNode(),j,null)}else{const j=hn(r);if(!l.isCompleteForPath(r)&&Yd(r)>1)return e;const Q=Yn(r),ce=l.getNode().getImmediateChild(j).updateChild(Q,s);j===".priority"?S=D.updatePriority(l.getNode(),ce):S=D.updateChild(l.getNode(),j,ce,Q,uB,null)}const I=rB(e,S,l.isFullyInitialized()||sn(r),D.filtersNodes()),V=new kC(c,I,d);return hB(n,I,r,c,V,x)}function TI(n,e,r,s,c,d,_){const x=e.eventCache;let l,S;const D=new kC(c,e,d);if(sn(r))S=n.filter.updateFullNode(e.eventCache.getNode(),s,_),l=yv(e,S,!0,n.filter.filtersNodes());else{const I=hn(r);if(I===".priority")S=n.filter.updatePriority(e.eventCache.getNode(),s),l=yv(e,S,x.isFullyInitialized(),x.isFiltered());else{const V=Yn(r),j=x.getNode().getImmediateChild(I);let Q;if(sn(V))Q=s;else{const te=D.getCompleteChild(I);te!=null?UN(V)===".priority"&&te.getChild($N(V)).isEmpty()?Q=te:Q=te.updateChild(V,s):Q=Sn.EMPTY_NODE}if(j.equals(Q))l=e;else{const te=n.filter.updateChild(x.getNode(),I,Q,V,D,_);l=yv(e,te,x.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function MD(n,e){return n.eventCache.isCompleteForChild(e)}function tJ(n,e,r,s,c,d,_){let x=e;return s.foreach((l,S)=>{const D=uo(r,l);MD(e,hn(D))&&(x=TI(n,x,D,S,c,d,_))}),s.foreach((l,S)=>{const D=uo(r,l);MD(e,hn(D))||(x=TI(n,x,D,S,c,d,_))}),x}function kD(n,e,r){return r.foreach((s,c)=>{e=e.updateChild(s,c)}),e}function EI(n,e,r,s,c,d,_,x){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,S;sn(r)?S=s:S=new Zn(null).setTree(r,s);const D=e.serverCache.getNode();return S.children.inorderTraversal((I,V)=>{if(D.hasChild(I)){const j=e.serverCache.getNode().getImmediateChild(I),Q=kD(n,j,V);l=iT(n,l,new Qn(I),Q,c,d,_,x)}}),S.children.inorderTraversal((I,V)=>{const j=!e.serverCache.isCompleteForChild(I)&&V.value===null;if(!D.hasChild(I)&&!j){const Q=e.serverCache.getNode().getImmediateChild(I),te=kD(n,Q,V);l=iT(n,l,new Qn(I),te,c,d,_,x)}}),l}function rJ(n,e,r,s,c,d,_){if(rT(c,r)!=null)return e;const x=e.serverCache.isFiltered(),l=e.serverCache;if(s.value!=null){if(sn(r)&&l.isFullyInitialized()||l.isCompleteForPath(r))return iT(n,e,r,l.getNode().getChild(r),c,d,x,_);if(sn(r)){let S=new Zn(null);return l.getNode().forEachChild(ug,(D,I)=>{S=S.set(new Qn(D),I)}),EI(n,e,r,S,c,d,x,_)}else return e}else{let S=new Zn(null);return s.foreach((D,I)=>{const V=uo(r,D);l.isCompleteForPath(V)&&(S=S.set(D,l.getNode().getChild(V)))}),EI(n,e,r,S,c,d,x,_)}}function iJ(n,e,r,s,c){const d=e.serverCache,_=rB(e,d.getNode(),d.isFullyInitialized()||sn(r),d.isFiltered());return hB(n,_,r,s,uB,c)}function nJ(n,e,r,s,c,d){let _;if(rT(s,r)!=null)return e;{const x=new kC(s,e,c),l=e.eventCache.getNode();let S;if(sn(r)||hn(r)===".priority"){let D;if(e.serverCache.isFullyInitialized())D=wI(s,Kp(e));else{const I=e.serverCache.getNode();br(I instanceof Sn,"serverChildren would be complete if leaf node"),D=aB(s,I)}D=D,S=n.filter.updateFullNode(l,D,d)}else{const D=hn(r);let I=MC(s,D,e.serverCache);I==null&&e.serverCache.isCompleteForChild(D)&&(I=l.getImmediateChild(D)),I!=null?S=n.filter.updateChild(l,D,I,Yn(r),x,d):e.eventCache.getNode().hasChild(D)?S=n.filter.updateChild(l,D,Sn.EMPTY_NODE,Yn(r),x,d):S=l,S.isEmpty()&&e.serverCache.isFullyInitialized()&&(_=wI(s,Kp(e)),_.isLeafNode()&&(S=n.filter.updateFullNode(S,_,d)))}return _=e.serverCache.isFullyInitialized()||rT(s,Dn())!=null,yv(e,S,_,n.filter.filtersNodes())}}function sJ(n,e){const r=Kp(n.viewCache_);return r&&(n.query._queryParams.loadsAllData()||!sn(e)&&!r.getImmediateChild(hn(e)).isEmpty())?r.getChild(e):null}function DD(n,e,r,s){e.type===nu.MERGE&&e.source.queryId!==null&&(br(Kp(n.viewCache_),"We should always have a full cache before handling merges"),br(vI(n.viewCache_),"Missing event cache, even though we have a server cache"));const c=n.viewCache_,d=JK(n.processor_,c,e,r,s);return KK(n.processor_,d.viewCache),br(d.viewCache.serverCache.isFullyInitialized()||!c.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=d.viewCache,oJ(n,d.changes,d.viewCache.eventCache.getNode())}function oJ(n,e,r,s){const c=n.eventRegistrations_;return DK(n.eventGenerator_,e,r,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let LD;function aJ(n){br(!LD,"__referenceConstructor has already been defined"),LD=n}function DC(n,e,r,s){const c=e.source.queryId;if(c!==null){const d=n.views.get(c);return br(d!=null,"SyncTree gave us an op for an invalid query."),DD(d,e,r,s)}else{let d=[];for(const _ of n.views.values())d=d.concat(DD(_,e,r,s));return d}}function LC(n,e){let r=null;for(const s of n.views.values())r=r||sJ(s,e);return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let OD;function lJ(n){br(!OD,"__referenceConstructor has already been defined"),OD=n}class zD{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Zn(null),this.pendingWriteTree_=ZK(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function cJ(n,e,r,s,c){return FK(n.pendingWriteTree_,e,r,s,c),c?cE(n,new Qp(KN(),e,r)):[]}function X_(n,e,r=!1){const s=NK(n.pendingWriteTree_,e);if(BK(n.pendingWriteTree_,e)){let d=new Zn(null);return s.snap!=null?d=d.set(Dn(),!0):ql(s.children,_=>{d=d.set(new Qn(_),!0)}),cE(n,new tT(s.path,d,r))}else return[]}function lE(n,e,r){return cE(n,new Qp(JN(),e,r))}function uJ(n,e,r){const s=Zn.fromObject(r);return cE(n,new Kv(JN(),e,s))}function hJ(n,e,r,s){const c=mB(n,s);if(c!=null){const d=_B(c),_=d.path,x=d.queryId,l=Nl(_,e),S=new Qp(eB(x),l,r);return gB(n,_,S)}else return[]}function dJ(n,e,r,s){const c=mB(n,s);if(c){const d=_B(c),_=d.path,x=d.queryId,l=Nl(_,e),S=Zn.fromObject(r),D=new Kv(eB(x),l,S);return gB(n,_,D)}else return[]}function dB(n,e,r){const c=n.pendingWriteTree_,d=n.syncPointTree_.findOnPath(e,(_,x)=>{const l=Nl(_,e),S=LC(x,l);if(S)return S});return oB(c,e,d,r,!0)}function cE(n,e){return fB(e,n.syncPointTree_,null,nB(n.pendingWriteTree_,Dn()))}function fB(n,e,r,s){if(sn(n.path))return pB(n,e,r,s);{const c=e.get(Dn());r==null&&c!=null&&(r=LC(c,Dn()));let d=[];const _=hn(n.path),x=n.operationForChild(_),l=e.children.get(_);if(l&&x){const S=r?r.getImmediateChild(_):null,D=lB(s,_);d=d.concat(fB(x,l,S,D))}return c&&(d=d.concat(DC(c,n,s,r))),d}}function pB(n,e,r,s){const c=e.get(Dn());r==null&&c!=null&&(r=LC(c,Dn()));let d=[];return e.children.inorderTraversal((_,x)=>{const l=r?r.getImmediateChild(_):null,S=lB(s,_),D=n.operationForChild(_);D&&(d=d.concat(pB(D,x,l,S)))}),c&&(d=d.concat(DC(c,n,s,r))),d}function mB(n,e){return n.tagToQueryMap.get(e)}function _B(n){const e=n.indexOf("$");return br(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new Qn(n.substr(0,e))}}function gB(n,e,r){const s=n.syncPointTree_.get(e);br(s,"Missing sync point for query tag that we're tracking");const c=nB(n.pendingWriteTree_,e);return DC(s,r,c,null)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OC{constructor(e){this.node_=e}getImmediateChild(e){const r=this.node_.getImmediateChild(e);return new OC(r)}node(){return this.node_}}class zC{constructor(e,r){this.syncTree_=e,this.path_=r}getImmediateChild(e){const r=uo(this.path_,e);return new zC(this.syncTree_,r)}node(){return dB(this.syncTree_,this.path_)}}const fJ=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},FD=function(n,e,r){if(!n||typeof n!="object")return n;if(br(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return pJ(n[".sv"],e,r);if(typeof n[".sv"]=="object")return mJ(n[".sv"],e);br(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},pJ=function(n,e,r){switch(n){case"timestamp":return r.timestamp;default:br(!1,"Unexpected server value: "+n)}},mJ=function(n,e,r){n.hasOwnProperty("increment")||br(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const s=n.increment;typeof s!="number"&&br(!1,"Unexpected increment value: "+s);const c=e.node();if(br(c!==null&&typeof c<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!c.isLeafNode())return s;const _=c.getValue();return typeof _!="number"?s:_+s},_J=function(n,e,r,s){return FC(e,new zC(r,n),s)},gJ=function(n,e,r){return FC(n,new OC(e),r)};function FC(n,e,r){const s=n.getPriority().val(),c=FD(s,e.getImmediateChild(".priority"),r);let d;if(n.isLeafNode()){const _=n,x=FD(_.getValue(),e,r);return x!==_.getValue()||c!==_.getPriority().val()?new ao(x,qo(c)):n}else{const _=n;return d=_,c!==_.getPriority().val()&&(d=d.updatePriority(new ao(c))),_.forEachChild(Yo,(x,l)=>{const S=FC(l,e.getImmediateChild(x),r);S!==l&&(d=d.updateImmediateChild(x,S))}),d}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NC{constructor(e="",r=null,s={children:{},childCount:0}){this.name=e,this.parent=r,this.node=s}}function BC(n,e){let r=e instanceof Qn?e:new Qn(e),s=n,c=hn(r);for(;c!==null;){const d=Ag(s.node.children,c)||{children:{},childCount:0};s=new NC(c,s,d),r=Yn(r),c=hn(r)}return s}function Jg(n){return n.node.value}function yB(n,e){n.node.value=e,AI(n)}function vB(n){return n.node.childCount>0}function yJ(n){return Jg(n)===void 0&&!vB(n)}function uE(n,e){ql(n.node.children,(r,s)=>{e(new NC(r,n,s))})}function xB(n,e,r,s){r&&!s&&e(n),uE(n,c=>{xB(c,e,!0,s)}),r&&s&&e(n)}function vJ(n,e,r){let s=n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function P1(n){return new Qn(n.parent===null?n.name:P1(n.parent)+"/"+n.name)}function AI(n){n.parent!==null&&xJ(n.parent,n.name,n)}function xJ(n,e,r){const s=yJ(r),c=bh(n.node.children,e);s&&c?(delete n.node.children[e],n.node.childCount--,AI(n)):!s&&!c&&(n.node.children[e]=r.node,n.node.childCount++,AI(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bJ=/[\[\].#$\/\u0000-\u001F\u007F]/,wJ=/[\[\].#$\u0000-\u001F\u007F]/,iA=10*1024*1024,bB=function(n){return typeof n=="string"&&n.length!==0&&!bJ.test(n)},TJ=function(n){return typeof n=="string"&&n.length!==0&&!wJ.test(n)},EJ=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),TJ(n)},wB=function(n,e,r){const s=r instanceof Qn?new iK(r,n):r;if(e===void 0)throw new Error(n+"contains undefined "+bp(s));if(typeof e=="function")throw new Error(n+"contains a function "+bp(s)+" with contents = "+e.toString());if(bN(e))throw new Error(n+"contains "+e.toString()+" "+bp(s));if(typeof e=="string"&&e.length>iA/3&&JT(e)>iA)throw new Error(n+"contains a string greater than "+iA+" utf8 bytes "+bp(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let c=!1,d=!1;if(ql(e,(_,x)=>{if(_===".value")c=!0;else if(_!==".priority"&&_!==".sv"&&(d=!0,!bB(_)))throw new Error(n+" contains an invalid key ("+_+") "+bp(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);nK(s,_),wB(n,x,s),sK(s)}),c&&d)throw new Error(n+' contains ".value" child '+bp(s)+" in addition to actual children.")}},AJ=function(n,e){const r=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!bB(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||r.length!==0&&!EJ(r))throw new Error(cW(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IJ{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function SJ(n,e){let r=null;for(let s=0;s<e.length;s++){const c=e[s],d=c.getPath();r!==null&&!GN(d,r.path)&&(n.eventLists_.push(r),r=null),r===null&&(r={events:[],path:d}),r.events.push(c)}r&&n.eventLists_.push(r)}function mm(n,e,r){SJ(n,r),CJ(n,s=>yc(s,e)||yc(e,s))}function CJ(n,e){n.recursionDepth_++;let r=!0;for(let s=0;s<n.eventLists_.length;s++){const c=n.eventLists_[s];if(c){const d=c.path;e(d)?(RJ(n.eventLists_[s]),n.eventLists_[s]=null):r=!1}}r&&(n.eventLists_=[]),n.recursionDepth_--}function RJ(n){for(let e=0;e<n.events.length;e++){const r=n.events[e];if(r!==null){n.events[e]=null;const s=r.getEventRunner();_v&&Go("event: "+r.toString()),C1(s)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PJ="repo_interrupt",MJ=25;class kJ{constructor(e,r,s,c){this.repoInfo_=e,this.forceRestClient_=r,this.authTokenProvider_=s,this.appCheckProvider_=c,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new IJ,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=eT(),this.transactionQueueTree_=new NC,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function DJ(n,e,r){if(n.stats_=AC(n.repoInfo_),n.forceRestClient_||SQ())n.server_=new Jw(n.repoInfo_,(s,c,d,_)=>{ND(n,s,c,d,_)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>BD(n,!0),0);else{if(typeof r<"u"&&r!==null){if(typeof r!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{To(r)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new dh(n.repoInfo_,e,(s,c,d,_)=>{ND(n,s,c,d,_)},s=>{BD(n,s)},s=>{OJ(n,s)},n.authTokenProvider_,n.appCheckProvider_,r),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=DQ(n.repoInfo_,()=>new kK(n.stats_,n.server_)),n.infoData_=new SK,n.infoSyncTree_=new zD({startListening:(s,c,d,_)=>{let x=[];const l=n.infoData_.getNode(s._path);return l.isEmpty()||(x=lE(n.infoSyncTree_,s._path,l),setTimeout(()=>{_("ok")},0)),x},stopListening:()=>{}}),VC(n,"connected",!1),n.serverSyncTree_=new zD({startListening:(s,c,d,_)=>(n.server_.listen(s,d,c,(x,l)=>{const S=_(x,l);mm(n.eventQueue_,s._path,S)}),[]),stopListening:(s,c)=>{n.server_.unlisten(s,c)}})}function LJ(n){const r=n.infoData_.getNode(new Qn(".info/serverTimeOffset")).val()||0;return new Date().getTime()+r}function TB(n){return fJ({timestamp:LJ(n)})}function ND(n,e,r,s,c){n.dataUpdateCount++;const d=new Qn(e);r=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,r):r;let _=[];if(c)if(s){const l=jw(r,S=>qo(S));_=dJ(n.serverSyncTree_,d,l,c)}else{const l=qo(r);_=hJ(n.serverSyncTree_,d,l,c)}else if(s){const l=jw(r,S=>qo(S));_=uJ(n.serverSyncTree_,d,l)}else{const l=qo(r);_=lE(n.serverSyncTree_,d,l)}let x=d;_.length>0&&(x=jC(n,d)),mm(n.eventQueue_,x,_)}function BD(n,e){VC(n,"connected",e),e===!1&&FJ(n)}function OJ(n,e){ql(e,(r,s)=>{VC(n,r,s)})}function VC(n,e,r){const s=new Qn("/.info/"+e),c=qo(r);n.infoData_.updateSnapshot(s,c);const d=lE(n.infoSyncTree_,s,c);mm(n.eventQueue_,s,d)}function zJ(n){return n.nextWriteId_++}function FJ(n){EB(n,"onDisconnectEvents");const e=TB(n),r=eT();yI(n.onDisconnect_,Dn(),(c,d)=>{const _=_J(c,d,n.serverSyncTree_,e);QN(r,c,_)});let s=[];yI(r,Dn(),(c,d)=>{s=s.concat(lE(n.serverSyncTree_,c,d));const _=UJ(n,c);jC(n,_)}),n.onDisconnect_=eT(),mm(n.eventQueue_,Dn(),s)}function NJ(n){n.persistentConnection_&&n.persistentConnection_.interrupt(PJ)}function EB(n,...e){let r="";n.persistentConnection_&&(r=n.persistentConnection_.id+":"),Go(r,...e)}function AB(n,e,r){return dB(n.serverSyncTree_,e,r)||Sn.EMPTY_NODE}function UC(n,e=n.transactionQueueTree_){if(e||hE(n,e),Jg(e)){const r=SB(n,e);br(r.length>0,"Sending zero length transaction queue"),r.every(c=>c.status===0)&&BJ(n,P1(e),r)}else vB(e)&&uE(e,r=>{UC(n,r)})}function BJ(n,e,r){const s=r.map(S=>S.currentWriteId),c=AB(n,e,s);let d=c;const _=c.hash();for(let S=0;S<r.length;S++){const D=r[S];br(D.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),D.status=1,D.retryCount++;const I=Nl(e,D.path);d=d.updateChild(I,D.currentOutputSnapshotRaw)}const x=d.val(!0),l=e;n.server_.put(l.toString(),x,S=>{EB(n,"transaction put response",{path:l.toString(),status:S});let D=[];if(S==="ok"){const I=[];for(let V=0;V<r.length;V++)r[V].status=2,D=D.concat(X_(n.serverSyncTree_,r[V].currentWriteId)),r[V].onComplete&&I.push(()=>r[V].onComplete(null,!0,r[V].currentOutputSnapshotResolved)),r[V].unwatcher();hE(n,BC(n.transactionQueueTree_,e)),UC(n,n.transactionQueueTree_),mm(n.eventQueue_,e,D);for(let V=0;V<I.length;V++)C1(I[V])}else{if(S==="datastale")for(let I=0;I<r.length;I++)r[I].status===3?r[I].status=4:r[I].status=0;else{fl("transaction at "+l.toString()+" failed: "+S);for(let I=0;I<r.length;I++)r[I].status=4,r[I].abortReason=S}jC(n,e)}},_)}function jC(n,e){const r=IB(n,e),s=P1(r),c=SB(n,r);return VJ(n,c,s),s}function VJ(n,e,r){if(e.length===0)return;const s=[];let c=[];const _=e.filter(x=>x.status===0).map(x=>x.currentWriteId);for(let x=0;x<e.length;x++){const l=e[x],S=Nl(r,l.path);let D=!1,I;if(br(S!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)D=!0,I=l.abortReason,c=c.concat(X_(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=MJ)D=!0,I="maxretry",c=c.concat(X_(n.serverSyncTree_,l.currentWriteId,!0));else{const V=AB(n,l.path,_);l.currentInputSnapshot=V;const j=e[x].update(V.val());if(j!==void 0){wB("transaction failed: Data returned ",j,l.path);let Q=qo(j);typeof j=="object"&&j!=null&&bh(j,".priority")||(Q=Q.updatePriority(V.getPriority()));const ce=l.currentWriteId,Ce=TB(n),Me=gJ(Q,V,Ce);l.currentOutputSnapshotRaw=Q,l.currentOutputSnapshotResolved=Me,l.currentWriteId=zJ(n),_.splice(_.indexOf(ce),1),c=c.concat(cJ(n.serverSyncTree_,l.path,Me,l.currentWriteId,l.applyLocally)),c=c.concat(X_(n.serverSyncTree_,ce,!0))}else D=!0,I="nodata",c=c.concat(X_(n.serverSyncTree_,l.currentWriteId,!0))}mm(n.eventQueue_,r,c),c=[],D&&(e[x].status=2,function(V){setTimeout(V,Math.floor(0))}(e[x].unwatcher),e[x].onComplete&&(I==="nodata"?s.push(()=>e[x].onComplete(null,!1,e[x].currentInputSnapshot)):s.push(()=>e[x].onComplete(new Error(I),!1,null))))}hE(n,n.transactionQueueTree_);for(let x=0;x<s.length;x++)C1(s[x]);UC(n,n.transactionQueueTree_)}function IB(n,e){let r,s=n.transactionQueueTree_;for(r=hn(e);r!==null&&Jg(s)===void 0;)s=BC(s,r),e=Yn(e),r=hn(e);return s}function SB(n,e){const r=[];return CB(n,e,r),r.sort((s,c)=>s.order-c.order),r}function CB(n,e,r){const s=Jg(e);if(s)for(let c=0;c<s.length;c++)r.push(s[c]);uE(e,c=>{CB(n,c,r)})}function hE(n,e){const r=Jg(e);if(r){let s=0;for(let c=0;c<r.length;c++)r[c].status!==2&&(r[s]=r[c],s++);r.length=s,yB(e,r.length>0?r:void 0)}uE(e,s=>{hE(n,s)})}function UJ(n,e){const r=P1(IB(n,e)),s=BC(n.transactionQueueTree_,e);return vJ(s,c=>{nA(n,c)}),nA(n,s),xB(s,c=>{nA(n,c)}),r}function nA(n,e){const r=Jg(e);if(r){const s=[];let c=[],d=-1;for(let _=0;_<r.length;_++)r[_].status===3||(r[_].status===1?(br(d===_-1,"All SENT items should be at beginning of queue."),d=_,r[_].status=3,r[_].abortReason="set"):(br(r[_].status===0,"Unexpected transaction status in abort"),r[_].unwatcher(),c=c.concat(X_(n.serverSyncTree_,r[_].currentWriteId,!0)),r[_].onComplete&&s.push(r[_].onComplete.bind(null,new Error("set"),!1,null))));d===-1?yB(e,void 0):r.length=d+1,mm(n.eventQueue_,P1(e),c);for(let _=0;_<s.length;_++)C1(s[_])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jJ(n){let e="";const r=n.split("/");for(let s=0;s<r.length;s++)if(r[s].length>0){let c=r[s];try{c=decodeURIComponent(c.replace(/\+/g," "))}catch{}e+="/"+c}return e}function $J(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const r of n.split("&")){if(r.length===0)continue;const s=r.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):fl(`Invalid query segment '${r}' in query '${n}'`)}return e}const VD=function(n,e){const r=GJ(n),s=r.namespace;r.domain==="firebase.com"&&Xp(r.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&r.domain!=="localhost"&&Xp("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),r.secure||vQ();const c=r.scheme==="ws"||r.scheme==="wss";return{repoInfo:new PQ(r.host,r.secure,s,c,e,"",s!==r.subdomain),path:new Qn(r.pathString)}},GJ=function(n){let e="",r="",s="",c="",d="",_=!0,x="https",l=443;if(typeof n=="string"){let S=n.indexOf("//");S>=0&&(x=n.substring(0,S-1),n=n.substring(S+2));let D=n.indexOf("/");D===-1&&(D=n.length);let I=n.indexOf("?");I===-1&&(I=n.length),e=n.substring(0,Math.min(D,I)),D<I&&(c=jJ(n.substring(D,I)));const V=$J(n.substring(Math.min(n.length,I)));S=e.indexOf(":"),S>=0?(_=x==="https"||x==="wss",l=parseInt(e.substring(S+1),10)):S=e.length;const j=e.slice(0,S);if(j.toLowerCase()==="localhost")r="localhost";else if(j.split(".").length<=2)r=j;else{const Q=e.indexOf(".");s=e.substring(0,Q).toLowerCase(),r=e.substring(Q+1),d=s}"ns"in V&&(d=V.ns)}return{host:e,port:l,domain:r,subdomain:s,secure:_,scheme:x,pathString:c,namespace:d}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $C{constructor(e,r,s,c){this._repo=e,this._path=r,this._queryParams=s,this._orderByCalled=c}get key(){return sn(this._path)?null:UN(this._path)}get ref(){return new e0(this._repo,this._path)}get _queryIdentifier(){const e=AD(this._queryParams),r=TC(e);return r==="{}"?"default":r}get _queryObject(){return AD(this._queryParams)}isEqual(e){if(e=va(e),!(e instanceof $C))return!1;const r=this._repo===e._repo,s=GN(this._path,e._path),c=this._queryIdentifier===e._queryIdentifier;return r&&s&&c}toJSON(){return this.toString()}toString(){return this._repo.toString()+rK(this._path)}}class e0 extends $C{constructor(e,r){super(e,r,new RC,!1)}get parent(){const e=$N(this._path);return e===null?null:new e0(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}aJ(e0);lJ(e0);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qJ="FIREBASE_DATABASE_EMULATOR_HOST",II={};let HJ=!1;function WJ(n,e,r,s,c){let d=s||n.options.databaseURL;d===void 0&&(n.options.projectId||Xp("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Go("Using default host for project ",n.options.projectId),d=`${n.options.projectId}-default-rtdb.firebaseio.com`);let _=VD(d,c),x=_.repoInfo,l;typeof process<"u"&&oD&&(l=oD[qJ]),l?(d=`http://${l}?ns=${x.namespace}`,_=VD(d,c),x=_.repoInfo):_.repoInfo.secure;const S=new RQ(n.name,n.options,e);AJ("Invalid Firebase Database URL",_),sn(_.path)||Xp("Database URL must point to the root of a Firebase Database (not including a child path).");const D=XJ(x,n,S,new CQ(n.name,r));return new YJ(D,n)}function ZJ(n,e){const r=II[e];(!r||r[n.key]!==n)&&Xp(`Database ${e}(${n.repoInfo_}) has already been deleted.`),NJ(n),delete r[n.key]}function XJ(n,e,r,s){let c=II[e.name];c||(c={},II[e.name]=c);let d=c[n.toURLString()];return d&&Xp("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),d=new kJ(n,HJ,r,s),c[n.toURLString()]=d,d}class YJ{constructor(e,r){this._repoInternal=e,this.app=r,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(DJ(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new e0(this._repo,Dn())),this._rootInternal}_delete(){return this._rootInternal!==null&&(ZJ(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Xp("Cannot call "+e+" on a deleted database.")}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QJ(n){fQ(cf),qa(new xa("database",(e,{instanceIdentifier:r})=>{const s=e.getProvider("app").getImmediate(),c=e.getProvider("auth-internal"),d=e.getProvider("app-check-internal");return WJ(s,c,d,r)},"PUBLIC").setMultipleInstances(!0)),Io(aD,lD,n),Io(aD,lD,"esm2017")}dh.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};dh.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};QJ();var UD=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var zp,RB;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(ue,pe){function _e(){}_e.prototype=pe.prototype,ue.D=pe.prototype,ue.prototype=new _e,ue.prototype.constructor=ue,ue.C=function(ge,Fe,De){for(var Se=Array(arguments.length-2),pr=2;pr<arguments.length;pr++)Se[pr-2]=arguments[pr];return pe.prototype[Fe].apply(ge,Se)}}function r(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(s,r),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function c(ue,pe,_e){_e||(_e=0);var ge=Array(16);if(typeof pe=="string")for(var Fe=0;16>Fe;++Fe)ge[Fe]=pe.charCodeAt(_e++)|pe.charCodeAt(_e++)<<8|pe.charCodeAt(_e++)<<16|pe.charCodeAt(_e++)<<24;else for(Fe=0;16>Fe;++Fe)ge[Fe]=pe[_e++]|pe[_e++]<<8|pe[_e++]<<16|pe[_e++]<<24;pe=ue.g[0],_e=ue.g[1],Fe=ue.g[2];var De=ue.g[3],Se=pe+(De^_e&(Fe^De))+ge[0]+3614090360&4294967295;pe=_e+(Se<<7&4294967295|Se>>>25),Se=De+(Fe^pe&(_e^Fe))+ge[1]+3905402710&4294967295,De=pe+(Se<<12&4294967295|Se>>>20),Se=Fe+(_e^De&(pe^_e))+ge[2]+606105819&4294967295,Fe=De+(Se<<17&4294967295|Se>>>15),Se=_e+(pe^Fe&(De^pe))+ge[3]+3250441966&4294967295,_e=Fe+(Se<<22&4294967295|Se>>>10),Se=pe+(De^_e&(Fe^De))+ge[4]+4118548399&4294967295,pe=_e+(Se<<7&4294967295|Se>>>25),Se=De+(Fe^pe&(_e^Fe))+ge[5]+1200080426&4294967295,De=pe+(Se<<12&4294967295|Se>>>20),Se=Fe+(_e^De&(pe^_e))+ge[6]+2821735955&4294967295,Fe=De+(Se<<17&4294967295|Se>>>15),Se=_e+(pe^Fe&(De^pe))+ge[7]+4249261313&4294967295,_e=Fe+(Se<<22&4294967295|Se>>>10),Se=pe+(De^_e&(Fe^De))+ge[8]+1770035416&4294967295,pe=_e+(Se<<7&4294967295|Se>>>25),Se=De+(Fe^pe&(_e^Fe))+ge[9]+2336552879&4294967295,De=pe+(Se<<12&4294967295|Se>>>20),Se=Fe+(_e^De&(pe^_e))+ge[10]+4294925233&4294967295,Fe=De+(Se<<17&4294967295|Se>>>15),Se=_e+(pe^Fe&(De^pe))+ge[11]+2304563134&4294967295,_e=Fe+(Se<<22&4294967295|Se>>>10),Se=pe+(De^_e&(Fe^De))+ge[12]+1804603682&4294967295,pe=_e+(Se<<7&4294967295|Se>>>25),Se=De+(Fe^pe&(_e^Fe))+ge[13]+4254626195&4294967295,De=pe+(Se<<12&4294967295|Se>>>20),Se=Fe+(_e^De&(pe^_e))+ge[14]+2792965006&4294967295,Fe=De+(Se<<17&4294967295|Se>>>15),Se=_e+(pe^Fe&(De^pe))+ge[15]+1236535329&4294967295,_e=Fe+(Se<<22&4294967295|Se>>>10),Se=pe+(Fe^De&(_e^Fe))+ge[1]+4129170786&4294967295,pe=_e+(Se<<5&4294967295|Se>>>27),Se=De+(_e^Fe&(pe^_e))+ge[6]+3225465664&4294967295,De=pe+(Se<<9&4294967295|Se>>>23),Se=Fe+(pe^_e&(De^pe))+ge[11]+643717713&4294967295,Fe=De+(Se<<14&4294967295|Se>>>18),Se=_e+(De^pe&(Fe^De))+ge[0]+3921069994&4294967295,_e=Fe+(Se<<20&4294967295|Se>>>12),Se=pe+(Fe^De&(_e^Fe))+ge[5]+3593408605&4294967295,pe=_e+(Se<<5&4294967295|Se>>>27),Se=De+(_e^Fe&(pe^_e))+ge[10]+38016083&4294967295,De=pe+(Se<<9&4294967295|Se>>>23),Se=Fe+(pe^_e&(De^pe))+ge[15]+3634488961&4294967295,Fe=De+(Se<<14&4294967295|Se>>>18),Se=_e+(De^pe&(Fe^De))+ge[4]+3889429448&4294967295,_e=Fe+(Se<<20&4294967295|Se>>>12),Se=pe+(Fe^De&(_e^Fe))+ge[9]+568446438&4294967295,pe=_e+(Se<<5&4294967295|Se>>>27),Se=De+(_e^Fe&(pe^_e))+ge[14]+3275163606&4294967295,De=pe+(Se<<9&4294967295|Se>>>23),Se=Fe+(pe^_e&(De^pe))+ge[3]+4107603335&4294967295,Fe=De+(Se<<14&4294967295|Se>>>18),Se=_e+(De^pe&(Fe^De))+ge[8]+1163531501&4294967295,_e=Fe+(Se<<20&4294967295|Se>>>12),Se=pe+(Fe^De&(_e^Fe))+ge[13]+2850285829&4294967295,pe=_e+(Se<<5&4294967295|Se>>>27),Se=De+(_e^Fe&(pe^_e))+ge[2]+4243563512&4294967295,De=pe+(Se<<9&4294967295|Se>>>23),Se=Fe+(pe^_e&(De^pe))+ge[7]+1735328473&4294967295,Fe=De+(Se<<14&4294967295|Se>>>18),Se=_e+(De^pe&(Fe^De))+ge[12]+2368359562&4294967295,_e=Fe+(Se<<20&4294967295|Se>>>12),Se=pe+(_e^Fe^De)+ge[5]+4294588738&4294967295,pe=_e+(Se<<4&4294967295|Se>>>28),Se=De+(pe^_e^Fe)+ge[8]+2272392833&4294967295,De=pe+(Se<<11&4294967295|Se>>>21),Se=Fe+(De^pe^_e)+ge[11]+1839030562&4294967295,Fe=De+(Se<<16&4294967295|Se>>>16),Se=_e+(Fe^De^pe)+ge[14]+4259657740&4294967295,_e=Fe+(Se<<23&4294967295|Se>>>9),Se=pe+(_e^Fe^De)+ge[1]+2763975236&4294967295,pe=_e+(Se<<4&4294967295|Se>>>28),Se=De+(pe^_e^Fe)+ge[4]+1272893353&4294967295,De=pe+(Se<<11&4294967295|Se>>>21),Se=Fe+(De^pe^_e)+ge[7]+4139469664&4294967295,Fe=De+(Se<<16&4294967295|Se>>>16),Se=_e+(Fe^De^pe)+ge[10]+3200236656&4294967295,_e=Fe+(Se<<23&4294967295|Se>>>9),Se=pe+(_e^Fe^De)+ge[13]+681279174&4294967295,pe=_e+(Se<<4&4294967295|Se>>>28),Se=De+(pe^_e^Fe)+ge[0]+3936430074&4294967295,De=pe+(Se<<11&4294967295|Se>>>21),Se=Fe+(De^pe^_e)+ge[3]+3572445317&4294967295,Fe=De+(Se<<16&4294967295|Se>>>16),Se=_e+(Fe^De^pe)+ge[6]+76029189&4294967295,_e=Fe+(Se<<23&4294967295|Se>>>9),Se=pe+(_e^Fe^De)+ge[9]+3654602809&4294967295,pe=_e+(Se<<4&4294967295|Se>>>28),Se=De+(pe^_e^Fe)+ge[12]+3873151461&4294967295,De=pe+(Se<<11&4294967295|Se>>>21),Se=Fe+(De^pe^_e)+ge[15]+530742520&4294967295,Fe=De+(Se<<16&4294967295|Se>>>16),Se=_e+(Fe^De^pe)+ge[2]+3299628645&4294967295,_e=Fe+(Se<<23&4294967295|Se>>>9),Se=pe+(Fe^(_e|~De))+ge[0]+4096336452&4294967295,pe=_e+(Se<<6&4294967295|Se>>>26),Se=De+(_e^(pe|~Fe))+ge[7]+1126891415&4294967295,De=pe+(Se<<10&4294967295|Se>>>22),Se=Fe+(pe^(De|~_e))+ge[14]+2878612391&4294967295,Fe=De+(Se<<15&4294967295|Se>>>17),Se=_e+(De^(Fe|~pe))+ge[5]+4237533241&4294967295,_e=Fe+(Se<<21&4294967295|Se>>>11),Se=pe+(Fe^(_e|~De))+ge[12]+1700485571&4294967295,pe=_e+(Se<<6&4294967295|Se>>>26),Se=De+(_e^(pe|~Fe))+ge[3]+2399980690&4294967295,De=pe+(Se<<10&4294967295|Se>>>22),Se=Fe+(pe^(De|~_e))+ge[10]+4293915773&4294967295,Fe=De+(Se<<15&4294967295|Se>>>17),Se=_e+(De^(Fe|~pe))+ge[1]+2240044497&4294967295,_e=Fe+(Se<<21&4294967295|Se>>>11),Se=pe+(Fe^(_e|~De))+ge[8]+1873313359&4294967295,pe=_e+(Se<<6&4294967295|Se>>>26),Se=De+(_e^(pe|~Fe))+ge[15]+4264355552&4294967295,De=pe+(Se<<10&4294967295|Se>>>22),Se=Fe+(pe^(De|~_e))+ge[6]+2734768916&4294967295,Fe=De+(Se<<15&4294967295|Se>>>17),Se=_e+(De^(Fe|~pe))+ge[13]+1309151649&4294967295,_e=Fe+(Se<<21&4294967295|Se>>>11),Se=pe+(Fe^(_e|~De))+ge[4]+4149444226&4294967295,pe=_e+(Se<<6&4294967295|Se>>>26),Se=De+(_e^(pe|~Fe))+ge[11]+3174756917&4294967295,De=pe+(Se<<10&4294967295|Se>>>22),Se=Fe+(pe^(De|~_e))+ge[2]+718787259&4294967295,Fe=De+(Se<<15&4294967295|Se>>>17),Se=_e+(De^(Fe|~pe))+ge[9]+3951481745&4294967295,ue.g[0]=ue.g[0]+pe&4294967295,ue.g[1]=ue.g[1]+(Fe+(Se<<21&4294967295|Se>>>11))&4294967295,ue.g[2]=ue.g[2]+Fe&4294967295,ue.g[3]=ue.g[3]+De&4294967295}s.prototype.u=function(ue,pe){pe===void 0&&(pe=ue.length);for(var _e=pe-this.blockSize,ge=this.B,Fe=this.h,De=0;De<pe;){if(Fe==0)for(;De<=_e;)c(this,ue,De),De+=this.blockSize;if(typeof ue=="string"){for(;De<pe;)if(ge[Fe++]=ue.charCodeAt(De++),Fe==this.blockSize){c(this,ge),Fe=0;break}}else for(;De<pe;)if(ge[Fe++]=ue[De++],Fe==this.blockSize){c(this,ge),Fe=0;break}}this.h=Fe,this.o+=pe},s.prototype.v=function(){var ue=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);ue[0]=128;for(var pe=1;pe<ue.length-8;++pe)ue[pe]=0;var _e=8*this.o;for(pe=ue.length-8;pe<ue.length;++pe)ue[pe]=_e&255,_e/=256;for(this.u(ue),ue=Array(16),pe=_e=0;4>pe;++pe)for(var ge=0;32>ge;ge+=8)ue[_e++]=this.g[pe]>>>ge&255;return ue};function d(ue,pe){var _e=x;return Object.prototype.hasOwnProperty.call(_e,ue)?_e[ue]:_e[ue]=pe(ue)}function _(ue,pe){this.h=pe;for(var _e=[],ge=!0,Fe=ue.length-1;0<=Fe;Fe--){var De=ue[Fe]|0;ge&&De==pe||(_e[Fe]=De,ge=!1)}this.g=_e}var x={};function l(ue){return-128<=ue&&128>ue?d(ue,function(pe){return new _([pe|0],0>pe?-1:0)}):new _([ue|0],0>ue?-1:0)}function S(ue){if(isNaN(ue)||!isFinite(ue))return I;if(0>ue)return ce(S(-ue));for(var pe=[],_e=1,ge=0;ue>=_e;ge++)pe[ge]=ue/_e|0,_e*=4294967296;return new _(pe,0)}function D(ue,pe){if(ue.length==0)throw Error("number format error: empty string");if(pe=pe||10,2>pe||36<pe)throw Error("radix out of range: "+pe);if(ue.charAt(0)=="-")return ce(D(ue.substring(1),pe));if(0<=ue.indexOf("-"))throw Error('number format error: interior "-" character');for(var _e=S(Math.pow(pe,8)),ge=I,Fe=0;Fe<ue.length;Fe+=8){var De=Math.min(8,ue.length-Fe),Se=parseInt(ue.substring(Fe,Fe+De),pe);8>De?(De=S(Math.pow(pe,De)),ge=ge.j(De).add(S(Se))):(ge=ge.j(_e),ge=ge.add(S(Se)))}return ge}var I=l(0),V=l(1),j=l(16777216);n=_.prototype,n.m=function(){if(te(this))return-ce(this).m();for(var ue=0,pe=1,_e=0;_e<this.g.length;_e++){var ge=this.i(_e);ue+=(0<=ge?ge:4294967296+ge)*pe,pe*=4294967296}return ue},n.toString=function(ue){if(ue=ue||10,2>ue||36<ue)throw Error("radix out of range: "+ue);if(Q(this))return"0";if(te(this))return"-"+ce(this).toString(ue);for(var pe=S(Math.pow(ue,6)),_e=this,ge="";;){var Fe=Te(_e,pe).g;_e=Ce(_e,Fe.j(pe));var De=((0<_e.g.length?_e.g[0]:_e.h)>>>0).toString(ue);if(_e=Fe,Q(_e))return De+ge;for(;6>De.length;)De="0"+De;ge=De+ge}},n.i=function(ue){return 0>ue?0:ue<this.g.length?this.g[ue]:this.h};function Q(ue){if(ue.h!=0)return!1;for(var pe=0;pe<ue.g.length;pe++)if(ue.g[pe]!=0)return!1;return!0}function te(ue){return ue.h==-1}n.l=function(ue){return ue=Ce(this,ue),te(ue)?-1:Q(ue)?0:1};function ce(ue){for(var pe=ue.g.length,_e=[],ge=0;ge<pe;ge++)_e[ge]=~ue.g[ge];return new _(_e,~ue.h).add(V)}n.abs=function(){return te(this)?ce(this):this},n.add=function(ue){for(var pe=Math.max(this.g.length,ue.g.length),_e=[],ge=0,Fe=0;Fe<=pe;Fe++){var De=ge+(this.i(Fe)&65535)+(ue.i(Fe)&65535),Se=(De>>>16)+(this.i(Fe)>>>16)+(ue.i(Fe)>>>16);ge=Se>>>16,De&=65535,Se&=65535,_e[Fe]=Se<<16|De}return new _(_e,_e[_e.length-1]&-2147483648?-1:0)};function Ce(ue,pe){return ue.add(ce(pe))}n.j=function(ue){if(Q(this)||Q(ue))return I;if(te(this))return te(ue)?ce(this).j(ce(ue)):ce(ce(this).j(ue));if(te(ue))return ce(this.j(ce(ue)));if(0>this.l(j)&&0>ue.l(j))return S(this.m()*ue.m());for(var pe=this.g.length+ue.g.length,_e=[],ge=0;ge<2*pe;ge++)_e[ge]=0;for(ge=0;ge<this.g.length;ge++)for(var Fe=0;Fe<ue.g.length;Fe++){var De=this.i(ge)>>>16,Se=this.i(ge)&65535,pr=ue.i(Fe)>>>16,or=ue.i(Fe)&65535;_e[2*ge+2*Fe]+=Se*or,Me(_e,2*ge+2*Fe),_e[2*ge+2*Fe+1]+=De*or,Me(_e,2*ge+2*Fe+1),_e[2*ge+2*Fe+1]+=Se*pr,Me(_e,2*ge+2*Fe+1),_e[2*ge+2*Fe+2]+=De*pr,Me(_e,2*ge+2*Fe+2)}for(ge=0;ge<pe;ge++)_e[ge]=_e[2*ge+1]<<16|_e[2*ge];for(ge=pe;ge<2*pe;ge++)_e[ge]=0;return new _(_e,0)};function Me(ue,pe){for(;(ue[pe]&65535)!=ue[pe];)ue[pe+1]+=ue[pe]>>>16,ue[pe]&=65535,pe++}function Ie(ue,pe){this.g=ue,this.h=pe}function Te(ue,pe){if(Q(pe))throw Error("division by zero");if(Q(ue))return new Ie(I,I);if(te(ue))return pe=Te(ce(ue),pe),new Ie(ce(pe.g),ce(pe.h));if(te(pe))return pe=Te(ue,ce(pe)),new Ie(ce(pe.g),pe.h);if(30<ue.g.length){if(te(ue)||te(pe))throw Error("slowDivide_ only works with positive integers.");for(var _e=V,ge=pe;0>=ge.l(ue);)_e=Ge(_e),ge=Ge(ge);var Fe=$e(_e,1),De=$e(ge,1);for(ge=$e(ge,2),_e=$e(_e,2);!Q(ge);){var Se=De.add(ge);0>=Se.l(ue)&&(Fe=Fe.add(_e),De=Se),ge=$e(ge,1),_e=$e(_e,1)}return pe=Ce(ue,Fe.j(pe)),new Ie(Fe,pe)}for(Fe=I;0<=ue.l(pe);){for(_e=Math.max(1,Math.floor(ue.m()/pe.m())),ge=Math.ceil(Math.log(_e)/Math.LN2),ge=48>=ge?1:Math.pow(2,ge-48),De=S(_e),Se=De.j(pe);te(Se)||0<Se.l(ue);)_e-=ge,De=S(_e),Se=De.j(pe);Q(De)&&(De=V),Fe=Fe.add(De),ue=Ce(ue,Se)}return new Ie(Fe,ue)}n.A=function(ue){return Te(this,ue).h},n.and=function(ue){for(var pe=Math.max(this.g.length,ue.g.length),_e=[],ge=0;ge<pe;ge++)_e[ge]=this.i(ge)&ue.i(ge);return new _(_e,this.h&ue.h)},n.or=function(ue){for(var pe=Math.max(this.g.length,ue.g.length),_e=[],ge=0;ge<pe;ge++)_e[ge]=this.i(ge)|ue.i(ge);return new _(_e,this.h|ue.h)},n.xor=function(ue){for(var pe=Math.max(this.g.length,ue.g.length),_e=[],ge=0;ge<pe;ge++)_e[ge]=this.i(ge)^ue.i(ge);return new _(_e,this.h^ue.h)};function Ge(ue){for(var pe=ue.g.length+1,_e=[],ge=0;ge<pe;ge++)_e[ge]=ue.i(ge)<<1|ue.i(ge-1)>>>31;return new _(_e,ue.h)}function $e(ue,pe){var _e=pe>>5;pe%=32;for(var ge=ue.g.length-_e,Fe=[],De=0;De<ge;De++)Fe[De]=0<pe?ue.i(De+_e)>>>pe|ue.i(De+_e+1)<<32-pe:ue.i(De+_e);return new _(Fe,ue.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,RB=s,_.prototype.add=_.prototype.add,_.prototype.multiply=_.prototype.j,_.prototype.modulo=_.prototype.A,_.prototype.compare=_.prototype.l,_.prototype.toNumber=_.prototype.m,_.prototype.toString=_.prototype.toString,_.prototype.getBits=_.prototype.i,_.fromNumber=S,_.fromString=D,zp=_}).apply(typeof UD<"u"?UD:typeof self<"u"?self:typeof window<"u"?window:{});var Nb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var PB,MB,Yy,kB,vw,SI,DB,LB,OB;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(M,q,ee){return M==Array.prototype||M==Object.prototype||(M[q]=ee.value),M};function r(M){M=[typeof globalThis=="object"&&globalThis,M,typeof window=="object"&&window,typeof self=="object"&&self,typeof Nb=="object"&&Nb];for(var q=0;q<M.length;++q){var ee=M[q];if(ee&&ee.Math==Math)return ee}throw Error("Cannot find global object")}var s=r(this);function c(M,q){if(q)e:{var ee=s;M=M.split(".");for(var ve=0;ve<M.length-1;ve++){var ht=M[ve];if(!(ht in ee))break e;ee=ee[ht]}M=M[M.length-1],ve=ee[M],q=q(ve),q!=ve&&q!=null&&e(ee,M,{configurable:!0,writable:!0,value:q})}}function d(M,q){M instanceof String&&(M+="");var ee=0,ve=!1,ht={next:function(){if(!ve&&ee<M.length){var Pt=ee++;return{value:q(Pt,M[Pt]),done:!1}}return ve=!0,{done:!0,value:void 0}}};return ht[Symbol.iterator]=function(){return ht},ht}c("Array.prototype.values",function(M){return M||function(){return d(this,function(q,ee){return ee})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var _=_||{},x=this||self;function l(M){var q=typeof M;return q=q!="object"?q:M?Array.isArray(M)?"array":q:"null",q=="array"||q=="object"&&typeof M.length=="number"}function S(M){var q=typeof M;return q=="object"&&M!=null||q=="function"}function D(M,q,ee){return M.call.apply(M.bind,arguments)}function I(M,q,ee){if(!M)throw Error();if(2<arguments.length){var ve=Array.prototype.slice.call(arguments,2);return function(){var ht=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(ht,ve),M.apply(q,ht)}}return function(){return M.apply(q,arguments)}}function V(M,q,ee){return V=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?D:I,V.apply(null,arguments)}function j(M,q){var ee=Array.prototype.slice.call(arguments,1);return function(){var ve=ee.slice();return ve.push.apply(ve,arguments),M.apply(this,ve)}}function Q(M,q){function ee(){}ee.prototype=q.prototype,M.aa=q.prototype,M.prototype=new ee,M.prototype.constructor=M,M.Qb=function(ve,ht,Pt){for(var ur=Array(arguments.length-2),an=2;an<arguments.length;an++)ur[an-2]=arguments[an];return q.prototype[ht].apply(ve,ur)}}function te(M){const q=M.length;if(0<q){const ee=Array(q);for(let ve=0;ve<q;ve++)ee[ve]=M[ve];return ee}return[]}function ce(M,q){for(let ee=1;ee<arguments.length;ee++){const ve=arguments[ee];if(l(ve)){const ht=M.length||0,Pt=ve.length||0;M.length=ht+Pt;for(let ur=0;ur<Pt;ur++)M[ht+ur]=ve[ur]}else M.push(ve)}}class Ce{constructor(q,ee){this.i=q,this.j=ee,this.h=0,this.g=null}get(){let q;return 0<this.h?(this.h--,q=this.g,this.g=q.next,q.next=null):q=this.i(),q}}function Me(M){return/^[\s\xa0]*$/.test(M)}function Ie(){var M=x.navigator;return M&&(M=M.userAgent)?M:""}function Te(M){return Te[" "](M),M}Te[" "]=function(){};var Ge=Ie().indexOf("Gecko")!=-1&&!(Ie().toLowerCase().indexOf("webkit")!=-1&&Ie().indexOf("Edge")==-1)&&!(Ie().indexOf("Trident")!=-1||Ie().indexOf("MSIE")!=-1)&&Ie().indexOf("Edge")==-1;function $e(M,q,ee){for(const ve in M)q.call(ee,M[ve],ve,M)}function ue(M,q){for(const ee in M)q.call(void 0,M[ee],ee,M)}function pe(M){const q={};for(const ee in M)q[ee]=M[ee];return q}const _e="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ge(M,q){let ee,ve;for(let ht=1;ht<arguments.length;ht++){ve=arguments[ht];for(ee in ve)M[ee]=ve[ee];for(let Pt=0;Pt<_e.length;Pt++)ee=_e[Pt],Object.prototype.hasOwnProperty.call(ve,ee)&&(M[ee]=ve[ee])}}function Fe(M){var q=1;M=M.split(":");const ee=[];for(;0<q&&M.length;)ee.push(M.shift()),q--;return M.length&&ee.push(M.join(":")),ee}function De(M){x.setTimeout(()=>{throw M},0)}function Se(){var M=Tr;let q=null;return M.g&&(q=M.g,M.g=M.g.next,M.g||(M.h=null),q.next=null),q}class pr{constructor(){this.h=this.g=null}add(q,ee){const ve=or.get();ve.set(q,ee),this.h?this.h.next=ve:this.g=ve,this.h=ve}}var or=new Ce(()=>new Vt,M=>M.reset());class Vt{constructor(){this.next=this.g=this.h=null}set(q,ee){this.h=q,this.g=ee,this.next=null}reset(){this.next=this.g=this.h=null}}let Ht,Kt=!1,Tr=new pr,We=()=>{const M=x.Promise.resolve(void 0);Ht=()=>{M.then(Sr)}};var Sr=()=>{for(var M;M=Se();){try{M.h.call(M.g)}catch(ee){De(ee)}var q=or;q.j(M),100>q.h&&(q.h++,M.next=q.g,q.g=M)}Kt=!1};function Xt(){this.s=this.s,this.C=this.C}Xt.prototype.s=!1,Xt.prototype.ma=function(){this.s||(this.s=!0,this.N())},Xt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ei(M,q){this.type=M,this.g=this.target=q,this.defaultPrevented=!1}ei.prototype.h=function(){this.defaultPrevented=!0};var Fr=function(){if(!x.addEventListener||!Object.defineProperty)return!1;var M=!1,q=Object.defineProperty({},"passive",{get:function(){M=!0}});try{const ee=()=>{};x.addEventListener("test",ee,q),x.removeEventListener("test",ee,q)}catch{}return M}();function gi(M,q){if(ei.call(this,M?M.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,M){var ee=this.type=M.type,ve=M.changedTouches&&M.changedTouches.length?M.changedTouches[0]:null;if(this.target=M.target||M.srcElement,this.g=q,q=M.relatedTarget){if(Ge){e:{try{Te(q.nodeName);var ht=!0;break e}catch{}ht=!1}ht||(q=null)}}else ee=="mouseover"?q=M.fromElement:ee=="mouseout"&&(q=M.toElement);this.relatedTarget=q,ve?(this.clientX=ve.clientX!==void 0?ve.clientX:ve.pageX,this.clientY=ve.clientY!==void 0?ve.clientY:ve.pageY,this.screenX=ve.screenX||0,this.screenY=ve.screenY||0):(this.clientX=M.clientX!==void 0?M.clientX:M.pageX,this.clientY=M.clientY!==void 0?M.clientY:M.pageY,this.screenX=M.screenX||0,this.screenY=M.screenY||0),this.button=M.button,this.key=M.key||"",this.ctrlKey=M.ctrlKey,this.altKey=M.altKey,this.shiftKey=M.shiftKey,this.metaKey=M.metaKey,this.pointerId=M.pointerId||0,this.pointerType=typeof M.pointerType=="string"?M.pointerType:qr[M.pointerType]||"",this.state=M.state,this.i=M,M.defaultPrevented&&gi.aa.h.call(this)}}Q(gi,ei);var qr={2:"touch",3:"pen",4:"mouse"};gi.prototype.h=function(){gi.aa.h.call(this);var M=this.i;M.preventDefault?M.preventDefault():M.returnValue=!1};var yt="closure_listenable_"+(1e6*Math.random()|0),dt=0;function jt(M,q,ee,ve,ht){this.listener=M,this.proxy=null,this.src=q,this.type=ee,this.capture=!!ve,this.ha=ht,this.key=++dt,this.da=this.fa=!1}function $t(M){M.da=!0,M.listener=null,M.proxy=null,M.src=null,M.ha=null}function Mr(M){this.src=M,this.g={},this.h=0}Mr.prototype.add=function(M,q,ee,ve,ht){var Pt=M.toString();M=this.g[Pt],M||(M=this.g[Pt]=[],this.h++);var ur=be(M,q,ve,ht);return-1<ur?(q=M[ur],ee||(q.fa=!1)):(q=new jt(q,this.src,Pt,!!ve,ht),q.fa=ee,M.push(q)),q};function Er(M,q){var ee=q.type;if(ee in M.g){var ve=M.g[ee],ht=Array.prototype.indexOf.call(ve,q,void 0),Pt;(Pt=0<=ht)&&Array.prototype.splice.call(ve,ht,1),Pt&&($t(q),M.g[ee].length==0&&(delete M.g[ee],M.h--))}}function be(M,q,ee,ve){for(var ht=0;ht<M.length;++ht){var Pt=M[ht];if(!Pt.da&&Pt.listener==q&&Pt.capture==!!ee&&Pt.ha==ve)return ht}return-1}var Ae="closure_lm_"+(1e6*Math.random()|0),Ze={};function lt(M,q,ee,ve,ht){if(Array.isArray(q)){for(var Pt=0;Pt<q.length;Pt++)lt(M,q[Pt],ee,ve,ht);return null}return ee=oe(ee),M&&M[yt]?M.K(q,ee,S(ve)?!!ve.capture:!!ve,ht):Ee(M,q,ee,!1,ve,ht)}function Ee(M,q,ee,ve,ht,Pt){if(!q)throw Error("Invalid event type");var ur=S(ht)?!!ht.capture:!!ht,an=je(M);if(an||(M[Ae]=an=new Mr(M)),ee=an.add(q,ee,ve,ur,Pt),ee.proxy)return ee;if(ve=Ft(),ee.proxy=ve,ve.src=M,ve.listener=ee,M.addEventListener)Fr||(ht=ur),ht===void 0&&(ht=!1),M.addEventListener(q.toString(),ve,ht);else if(M.attachEvent)M.attachEvent(Ot(q.toString()),ve);else if(M.addListener&&M.removeListener)M.addListener(ve);else throw Error("addEventListener and attachEvent are unavailable.");return ee}function Ft(){function M(ee){return q.call(M.src,M.listener,ee)}const q=Mt;return M}function ft(M,q,ee,ve,ht){if(Array.isArray(q))for(var Pt=0;Pt<q.length;Pt++)ft(M,q[Pt],ee,ve,ht);else ve=S(ve)?!!ve.capture:!!ve,ee=oe(ee),M&&M[yt]?(M=M.i,q=String(q).toString(),q in M.g&&(Pt=M.g[q],ee=be(Pt,ee,ve,ht),-1<ee&&($t(Pt[ee]),Array.prototype.splice.call(Pt,ee,1),Pt.length==0&&(delete M.g[q],M.h--)))):M&&(M=je(M))&&(q=M.g[q.toString()],M=-1,q&&(M=be(q,ee,ve,ht)),(ee=-1<M?q[M]:null)&&nt(ee))}function nt(M){if(typeof M!="number"&&M&&!M.da){var q=M.src;if(q&&q[yt])Er(q.i,M);else{var ee=M.type,ve=M.proxy;q.removeEventListener?q.removeEventListener(ee,ve,M.capture):q.detachEvent?q.detachEvent(Ot(ee),ve):q.addListener&&q.removeListener&&q.removeListener(ve),(ee=je(q))?(Er(ee,M),ee.h==0&&(ee.src=null,q[Ae]=null)):$t(M)}}}function Ot(M){return M in Ze?Ze[M]:Ze[M]="on"+M}function Mt(M,q){if(M.da)M=!0;else{q=new gi(q,this);var ee=M.listener,ve=M.ha||M.src;M.fa&&nt(M),M=ee.call(ve,q)}return M}function je(M){return M=M[Ae],M instanceof Mr?M:null}var re="__closure_events_fn_"+(1e9*Math.random()>>>0);function oe(M){return typeof M=="function"?M:(M[re]||(M[re]=function(q){return M.handleEvent(q)}),M[re])}function xe(){Xt.call(this),this.i=new Mr(this),this.M=this,this.F=null}Q(xe,Xt),xe.prototype[yt]=!0,xe.prototype.removeEventListener=function(M,q,ee,ve){ft(this,M,q,ee,ve)};function Be(M,q){var ee,ve=M.F;if(ve)for(ee=[];ve;ve=ve.F)ee.push(ve);if(M=M.M,ve=q.type||q,typeof q=="string")q=new ei(q,M);else if(q instanceof ei)q.target=q.target||M;else{var ht=q;q=new ei(ve,M),ge(q,ht)}if(ht=!0,ee)for(var Pt=ee.length-1;0<=Pt;Pt--){var ur=q.g=ee[Pt];ht=Ke(ur,ve,!0,q)&&ht}if(ur=q.g=M,ht=Ke(ur,ve,!0,q)&&ht,ht=Ke(ur,ve,!1,q)&&ht,ee)for(Pt=0;Pt<ee.length;Pt++)ur=q.g=ee[Pt],ht=Ke(ur,ve,!1,q)&&ht}xe.prototype.N=function(){if(xe.aa.N.call(this),this.i){var M=this.i,q;for(q in M.g){for(var ee=M.g[q],ve=0;ve<ee.length;ve++)$t(ee[ve]);delete M.g[q],M.h--}}this.F=null},xe.prototype.K=function(M,q,ee,ve){return this.i.add(String(M),q,!1,ee,ve)},xe.prototype.L=function(M,q,ee,ve){return this.i.add(String(M),q,!0,ee,ve)};function Ke(M,q,ee,ve){if(q=M.i.g[String(q)],!q)return!0;q=q.concat();for(var ht=!0,Pt=0;Pt<q.length;++Pt){var ur=q[Pt];if(ur&&!ur.da&&ur.capture==ee){var an=ur.listener,fs=ur.ha||ur.src;ur.fa&&Er(M.i,ur),ht=an.call(fs,ve)!==!1&&ht}}return ht&&!ve.defaultPrevented}function ct(M,q,ee){if(typeof M=="function")ee&&(M=V(M,ee));else if(M&&typeof M.handleEvent=="function")M=V(M.handleEvent,M);else throw Error("Invalid listener argument");return 2147483647<Number(q)?-1:x.setTimeout(M,q||0)}function zt(M){M.g=ct(()=>{M.g=null,M.i&&(M.i=!1,zt(M))},M.l);const q=M.h;M.h=null,M.m.apply(null,q)}class st extends Xt{constructor(q,ee){super(),this.m=q,this.l=ee,this.h=null,this.i=!1,this.g=null}j(q){this.h=arguments,this.g?this.i=!0:zt(this)}N(){super.N(),this.g&&(x.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ct(M){Xt.call(this),this.h=M,this.g={}}Q(Ct,Xt);var qt=[];function Wt(M){$e(M.g,function(q,ee){this.g.hasOwnProperty(ee)&&nt(q)},M),M.g={}}Ct.prototype.N=function(){Ct.aa.N.call(this),Wt(this)},Ct.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Nt=x.JSON.stringify,jr=x.JSON.parse,Or=class{stringify(M){return x.JSON.stringify(M,void 0)}parse(M){return x.JSON.parse(M,void 0)}};function ii(){}ii.prototype.h=null;function mr(M){return M.h||(M.h=M.i())}function ni(){}var Kr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ti(){ei.call(this,"d")}Q(Ti,ei);function Zi(){ei.call(this,"c")}Q(Zi,ei);var mi={},Ln=null;function fn(){return Ln=Ln||new xe}mi.La="serverreachability";function hs(M){ei.call(this,mi.La,M)}Q(hs,ei);function wr(M){const q=fn();Be(q,new hs(q))}mi.STAT_EVENT="statevent";function _r(M,q){ei.call(this,mi.STAT_EVENT,M),this.stat=q}Q(_r,ei);function Xe(M){const q=fn();Be(q,new _r(q,M))}mi.Ma="timingevent";function Ve(M,q){ei.call(this,mi.Ma,M),this.size=q}Q(Ve,ei);function tt(M,q){if(typeof M!="function")throw Error("Fn must not be null and must be a function");return x.setTimeout(function(){M()},q)}function ut(){this.g=!0}ut.prototype.xa=function(){this.g=!1};function _t(M,q,ee,ve,ht,Pt){M.info(function(){if(M.g)if(Pt)for(var ur="",an=Pt.split("&"),fs=0;fs<an.length;fs++){var ki=an[fs].split("=");if(1<ki.length){var ns=ki[0];ki=ki[1];var ps=ns.split("_");ur=2<=ps.length&&ps[1]=="type"?ur+(ns+"="+ki+"&"):ur+(ns+"=redacted&")}}else ur=null;else ur=Pt;return"XMLHTTP REQ ("+ve+") [attempt "+ht+"]: "+q+`
`+ee+`
`+ur})}function Lt(M,q,ee,ve,ht,Pt,ur){M.info(function(){return"XMLHTTP RESP ("+ve+") [ attempt "+ht+"]: "+q+`
`+ee+`
`+Pt+" "+ur})}function bt(M,q,ee,ve){M.info(function(){return"XMLHTTP TEXT ("+q+"): "+Bt(M,ee)+(ve?" "+ve:"")})}function Rt(M,q){M.info(function(){return"TIMEOUT: "+q})}ut.prototype.info=function(){};function Bt(M,q){if(!M.g)return q;if(!q)return null;try{var ee=JSON.parse(q);if(ee){for(M=0;M<ee.length;M++)if(Array.isArray(ee[M])){var ve=ee[M];if(!(2>ve.length)){var ht=ve[1];if(Array.isArray(ht)&&!(1>ht.length)){var Pt=ht[0];if(Pt!="noop"&&Pt!="stop"&&Pt!="close")for(var ur=1;ur<ht.length;ur++)ht[ur]=""}}}}return Nt(ee)}catch{return q}}var It={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ar={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},gr;function Yt(){}Q(Yt,ii),Yt.prototype.g=function(){return new XMLHttpRequest},Yt.prototype.i=function(){return{}},gr=new Yt;function Ir(M,q,ee,ve){this.j=M,this.i=q,this.l=ee,this.R=ve||1,this.U=new Ct(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ei}function Ei(){this.i=null,this.g="",this.h=!1}var _i={},yi={};function fi(M,q,ee){M.L=1,M.v=Au(Ns(q)),M.m=ee,M.P=!0,kr(M,null)}function kr(M,q){M.F=Date.now(),Fi(M),M.A=Ns(M.v);var ee=M.A,ve=M.R;Array.isArray(ve)||(ve=[String(ve)]),Cu(ee.i,"t",ve),M.C=0,ee=M.j.J,M.h=new Ei,M.g=Xa(M.j,ee?q:null,!M.m),0<M.O&&(M.M=new st(V(M.Y,M,M.g),M.O)),q=M.U,ee=M.g,ve=M.ca;var ht="readystatechange";Array.isArray(ht)||(ht&&(qt[0]=ht.toString()),ht=qt);for(var Pt=0;Pt<ht.length;Pt++){var ur=lt(ee,ht[Pt],ve||q.handleEvent,!1,q.h||q);if(!ur)break;q.g[ur.key]=ur}q=M.H?pe(M.H):{},M.m?(M.u||(M.u="POST"),q["Content-Type"]="application/x-www-form-urlencoded",M.g.ea(M.A,M.u,M.m,q)):(M.u="GET",M.g.ea(M.A,M.u,null,q)),wr(),_t(M.i,M.u,M.A,M.l,M.R,M.m)}Ir.prototype.ca=function(M){M=M.target;const q=this.M;q&&ta(M)==3?q.j():this.Y(M)},Ir.prototype.Y=function(M){try{if(M==this.g)e:{const ps=ta(this.g);var q=this.g.Ba();const ra=this.g.Z();if(!(3>ps)&&(ps!=3||this.g&&(this.h.h||this.g.oa()||_o(this.g)))){this.J||ps!=4||q==7||(q==8||0>=ra?wr(3):wr(2)),ds(this);var ee=this.g.Z();this.X=ee;t:if(Bn(this)){var ve=_o(this.g);M="";var ht=ve.length,Pt=ta(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){wa(this),On(this);var ur="";break t}this.h.i=new x.TextDecoder}for(q=0;q<ht;q++)this.h.h=!0,M+=this.h.i.decode(ve[q],{stream:!(Pt&&q==ht-1)});ve.length=0,this.h.g+=M,this.C=0,ur=this.h.g}else ur=this.g.oa();if(this.o=ee==200,Lt(this.i,this.u,this.A,this.l,this.R,ps,ee),this.o){if(this.T&&!this.K){t:{if(this.g){var an,fs=this.g;if((an=fs.g?fs.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Me(an)){var ki=an;break t}}ki=null}if(ee=ki)bt(this.i,this.l,ee,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Vr(this,ee);else{this.o=!1,this.s=3,Xe(12),wa(this),On(this);break e}}if(this.P){ee=!0;let yo;for(;!this.J&&this.C<ur.length;)if(yo=Ss(this,ur),yo==yi){ps==4&&(this.s=4,Xe(14),ee=!1),bt(this.i,this.l,null,"[Incomplete Response]");break}else if(yo==_i){this.s=4,Xe(15),bt(this.i,this.l,ur,"[Invalid Chunk]"),ee=!1;break}else bt(this.i,this.l,yo,null),Vr(this,yo);if(Bn(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ps!=4||ur.length!=0||this.h.h||(this.s=1,Xe(16),ee=!1),this.o=this.o&&ee,!ee)bt(this.i,this.l,ur,"[Invalid Chunked Response]"),wa(this),On(this);else if(0<ur.length&&!this.W){this.W=!0;var ns=this.j;ns.g==this&&ns.ba&&!ns.M&&(ns.j.info("Great, no buffering proxy detected. Bytes received: "+ur.length),Ql(ns),ns.M=!0,Xe(11))}}else bt(this.i,this.l,ur,null),Vr(this,ur);ps==4&&wa(this),this.o&&!this.J&&(ps==4?eo(this.j,this):(this.o=!1,Fi(this)))}else Em(this.g),ee==400&&0<ur.indexOf("Unknown SID")?(this.s=3,Xe(12)):(this.s=0,Xe(13)),wa(this),On(this)}}}catch{}finally{}};function Bn(M){return M.g?M.u=="GET"&&M.L!=2&&M.j.Ca:!1}function Ss(M,q){var ee=M.C,ve=q.indexOf(`
`,ee);return ve==-1?yi:(ee=Number(q.substring(ee,ve)),isNaN(ee)?_i:(ve+=1,ve+ee>q.length?yi:(q=q.slice(ve,ve+ee),M.C=ve+ee,q)))}Ir.prototype.cancel=function(){this.J=!0,wa(this)};function Fi(M){M.S=Date.now()+M.I,_n(M,M.I)}function _n(M,q){if(M.B!=null)throw Error("WatchDog timer not null");M.B=tt(V(M.ba,M),q)}function ds(M){M.B&&(x.clearTimeout(M.B),M.B=null)}Ir.prototype.ba=function(){this.B=null;const M=Date.now();0<=M-this.S?(Rt(this.i,this.A),this.L!=2&&(wr(),Xe(17)),wa(this),this.s=2,On(this)):_n(this,this.S-M)};function On(M){M.j.G==0||M.J||eo(M.j,M)}function wa(M){ds(M);var q=M.M;q&&typeof q.ma=="function"&&q.ma(),M.M=null,Wt(M.U),M.g&&(q=M.g,M.g=null,q.abort(),q.ma())}function Vr(M,q){try{var ee=M.j;if(ee.G!=0&&(ee.g==M||Ah(ee.h,M))){if(!M.K&&Ah(ee.h,M)&&ee.G==3){try{var ve=ee.Da.g.parse(q)}catch{ve=null}if(Array.isArray(ve)&&ve.length==3){var ht=ve;if(ht[0]==0){e:if(!ee.u){if(ee.g)if(ee.g.F+3e3<M.F)ko(ee),Mu(ee);else break e;Aa(ee),Xe(18)}}else ee.za=ht[1],0<ee.za-ee.T&&37500>ht[2]&&ee.F&&ee.v==0&&!ee.C&&(ee.C=tt(V(ee.Za,ee),6e3));if(1>=Wa(ee.h)&&ee.ca){try{ee.ca()}catch{}ee.ca=void 0}}else Ia(ee,11)}else if((M.K||ee.g==M)&&ko(ee),!Me(q))for(ht=ee.Da.g.parse(q),q=0;q<ht.length;q++){let ki=ht[q];if(ee.T=ki[0],ki=ki[1],ee.G==2)if(ki[0]=="c"){ee.K=ki[1],ee.ia=ki[2];const ns=ki[3];ns!=null&&(ee.la=ns,ee.j.info("VER="+ee.la));const ps=ki[4];ps!=null&&(ee.Aa=ps,ee.j.info("SVER="+ee.Aa));const ra=ki[5];ra!=null&&typeof ra=="number"&&0<ra&&(ve=1.5*ra,ee.L=ve,ee.j.info("backChannelRequestTimeoutMs_="+ve)),ve=ee;const yo=M.g;if(yo){const Sa=yo.g?yo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Sa){var Pt=ve.h;Pt.g||Sa.indexOf("spdy")==-1&&Sa.indexOf("quic")==-1&&Sa.indexOf("h2")==-1||(Pt.j=Pt.l,Pt.g=new Set,Pt.h&&(bu(Pt,Pt.h),Pt.h=null))}if(ve.D){const ec=yo.g?yo.g.getResponseHeader("X-HTTP-Session-Id"):null;ec&&(ve.ya=ec,En(ve.I,ve.D,ec))}}ee.G=3,ee.l&&ee.l.ua(),ee.ba&&(ee.R=Date.now()-M.F,ee.j.info("Handshake RTT: "+ee.R+"ms")),ve=ee;var ur=M;if(ve.qa=zc(ve,ve.J?ve.ia:null,ve.W),ur.K){df(ve.h,ur);var an=ur,fs=ve.L;fs&&(an.I=fs),an.B&&(ds(an),Fi(an)),ve.g=ur}else gn(ve);0<ee.i.length&&Ea(ee)}else ki[0]!="stop"&&ki[0]!="close"||Ia(ee,7);else ee.G==3&&(ki[0]=="stop"||ki[0]=="close"?ki[0]=="stop"?Ia(ee,7):Pu(ee):ki[0]!="noop"&&ee.l&&ee.l.ta(ki),ee.v=0)}}wr(4)}catch{}}var Js=class{constructor(M,q){this.g=M,this.map=q}};function Vn(M){this.l=M||10,x.PerformanceNavigationTiming?(M=x.performance.getEntriesByType("navigation"),M=0<M.length&&(M[0].nextHopProtocol=="hq"||M[0].nextHopProtocol=="h2")):M=!!(x.chrome&&x.chrome.loadTimes&&x.chrome.loadTimes()&&x.chrome.loadTimes().wasFetchedViaSpdy),this.j=M?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Fs(M){return M.h?!0:M.g?M.g.size>=M.j:!1}function Wa(M){return M.h?1:M.g?M.g.size:0}function Ah(M,q){return M.h?M.h==q:M.g?M.g.has(q):!1}function bu(M,q){M.g?M.g.add(q):M.h=q}function df(M,q){M.h&&M.h==q?M.h=null:M.g&&M.g.has(q)&&M.g.delete(q)}Vn.prototype.cancel=function(){if(this.i=ff(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const M of this.g.values())M.cancel();this.g.clear()}};function ff(M){if(M.h!=null)return M.i.concat(M.h.D);if(M.g!=null&&M.g.size!==0){let q=M.i;for(const ee of M.g.values())q=q.concat(ee.D);return q}return te(M.i)}function xm(M){if(M.V&&typeof M.V=="function")return M.V();if(typeof Map<"u"&&M instanceof Map||typeof Set<"u"&&M instanceof Set)return Array.from(M.values());if(typeof M=="string")return M.split("");if(l(M)){for(var q=[],ee=M.length,ve=0;ve<ee;ve++)q.push(M[ve]);return q}q=[],ee=0;for(ve in M)q[ee++]=M[ve];return q}function bm(M){if(M.na&&typeof M.na=="function")return M.na();if(!M.V||typeof M.V!="function"){if(typeof Map<"u"&&M instanceof Map)return Array.from(M.keys());if(!(typeof Set<"u"&&M instanceof Set)){if(l(M)||typeof M=="string"){var q=[];M=M.length;for(var ee=0;ee<M;ee++)q.push(ee);return q}q=[],ee=0;for(const ve in M)q[ee++]=ve;return q}}}function pf(M,q){if(M.forEach&&typeof M.forEach=="function")M.forEach(q,void 0);else if(l(M)||typeof M=="string")Array.prototype.forEach.call(M,q,void 0);else for(var ee=bm(M),ve=xm(M),ht=ve.length,Pt=0;Pt<ht;Pt++)q.call(void 0,ve[Pt],ee&&ee[Pt],M)}var wu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Hr(M,q){if(M){M=M.split("&");for(var ee=0;ee<M.length;ee++){var ve=M[ee].indexOf("="),ht=null;if(0<=ve){var Pt=M[ee].substring(0,ve);ht=M[ee].substring(ve+1)}else Pt=M[ee];q(Pt,ht?decodeURIComponent(ht.replace(/\+/g," ")):"")}}}function Za(M){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,M instanceof Za){this.h=M.h,Tu(this,M.j),this.o=M.o,this.g=M.g,Eu(this,M.s),this.l=M.l;var q=M.i,ee=new Su;ee.i=q.i,q.g&&(ee.g=new Map(q.g),ee.h=q.h),mf(this,ee),this.m=M.m}else M&&(q=String(M).match(wu))?(this.h=!1,Tu(this,q[1]||"",!0),this.o=Pc(q[2]||""),this.g=Pc(q[3]||"",!0),Eu(this,q[4]),this.l=Pc(q[5]||"",!0),mf(this,q[6]||"",!0),this.m=Pc(q[7]||"")):(this.h=!1,this.i=new Su(null,this.h))}Za.prototype.toString=function(){var M=[],q=this.j;q&&M.push(Mc(q,Iu,!0),":");var ee=this.g;return(ee||q=="file")&&(M.push("//"),(q=this.o)&&M.push(Mc(q,Iu,!0),"@"),M.push(encodeURIComponent(String(ee)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ee=this.s,ee!=null&&M.push(":",String(ee))),(ee=this.l)&&(this.g&&ee.charAt(0)!="/"&&M.push("/"),M.push(Mc(ee,ee.charAt(0)=="/"?Ih:a0,!0))),(ee=this.i.toString())&&M.push("?",ee),(ee=this.m)&&M.push("#",Mc(ee,c0)),M.join("")};function Ns(M){return new Za(M)}function Tu(M,q,ee){M.j=ee?Pc(q,!0):q,M.j&&(M.j=M.j.replace(/:$/,""))}function Eu(M,q){if(q){if(q=Number(q),isNaN(q)||0>q)throw Error("Bad port number "+q);M.s=q}else M.s=null}function mf(M,q,ee){q instanceof Su?(M.i=q,_f(M.i,M.h)):(ee||(q=Mc(q,l0)),M.i=new Su(q,M.h))}function En(M,q,ee){M.i.set(q,ee)}function Au(M){return En(M,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),M}function Pc(M,q){return M?q?decodeURI(M.replace(/%25/g,"%2525")):decodeURIComponent(M):""}function Mc(M,q,ee){return typeof M=="string"?(M=encodeURI(M).replace(q,wm),ee&&(M=M.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),M):null}function wm(M){return M=M.charCodeAt(0),"%"+(M>>4&15).toString(16)+(M&15).toString(16)}var Iu=/[#\/\?@]/g,a0=/[#\?:]/g,Ih=/[#\?]/g,l0=/[#\?@]/g,c0=/#/g;function Su(M,q){this.h=this.g=null,this.i=M||null,this.j=!!q}function hr(M){M.g||(M.g=new Map,M.h=0,M.i&&Hr(M.i,function(q,ee){M.add(decodeURIComponent(q.replace(/\+/g," ")),ee)}))}n=Su.prototype,n.add=function(M,q){hr(this),this.i=null,M=$r(this,M);var ee=this.g.get(M);return ee||this.g.set(M,ee=[]),ee.push(q),this.h+=1,this};function Sh(M,q){hr(M),q=$r(M,q),M.g.has(q)&&(M.i=null,M.h-=M.g.get(q).length,M.g.delete(q))}function Dr(M,q){return hr(M),q=$r(M,q),M.g.has(q)}n.forEach=function(M,q){hr(this),this.g.forEach(function(ee,ve){ee.forEach(function(ht){M.call(q,ht,ve,this)},this)},this)},n.na=function(){hr(this);const M=Array.from(this.g.values()),q=Array.from(this.g.keys()),ee=[];for(let ve=0;ve<q.length;ve++){const ht=M[ve];for(let Pt=0;Pt<ht.length;Pt++)ee.push(q[ve])}return ee},n.V=function(M){hr(this);let q=[];if(typeof M=="string")Dr(this,M)&&(q=q.concat(this.g.get($r(this,M))));else{M=Array.from(this.g.values());for(let ee=0;ee<M.length;ee++)q=q.concat(M[ee])}return q},n.set=function(M,q){return hr(this),this.i=null,M=$r(this,M),Dr(this,M)&&(this.h-=this.g.get(M).length),this.g.set(M,[q]),this.h+=1,this},n.get=function(M,q){return M?(M=this.V(M),0<M.length?String(M[0]):q):q};function Cu(M,q,ee){Sh(M,q),0<ee.length&&(M.i=null,M.g.set($r(M,q),te(ee)),M.h+=ee.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const M=[],q=Array.from(this.g.keys());for(var ee=0;ee<q.length;ee++){var ve=q[ee];const Pt=encodeURIComponent(String(ve)),ur=this.V(ve);for(ve=0;ve<ur.length;ve++){var ht=Pt;ur[ve]!==""&&(ht+="="+encodeURIComponent(String(ur[ve]))),M.push(ht)}}return this.i=M.join("&")};function $r(M,q){return q=String(q),M.j&&(q=q.toLowerCase()),q}function _f(M,q){q&&!M.j&&(hr(M),M.i=null,M.g.forEach(function(ee,ve){var ht=ve.toLowerCase();ve!=ht&&(Sh(this,ve),Cu(this,ht,ee))},M)),M.j=q}function gf(M,q){const ee=new ut;if(x.Image){const ve=new Image;ve.onload=j(ws,ee,"TestLoadImage: loaded",!0,q,ve),ve.onerror=j(ws,ee,"TestLoadImage: error",!1,q,ve),ve.onabort=j(ws,ee,"TestLoadImage: abort",!1,q,ve),ve.ontimeout=j(ws,ee,"TestLoadImage: timeout",!1,q,ve),x.setTimeout(function(){ve.ontimeout&&ve.ontimeout()},1e4),ve.src=M}else q(!1)}function Cr(M,q){const ee=new ut,ve=new AbortController,ht=setTimeout(()=>{ve.abort(),ws(ee,"TestPingServer: timeout",!1,q)},1e4);fetch(M,{signal:ve.signal}).then(Pt=>{clearTimeout(ht),Pt.ok?ws(ee,"TestPingServer: ok",!0,q):ws(ee,"TestPingServer: server error",!1,q)}).catch(()=>{clearTimeout(ht),ws(ee,"TestPingServer: error",!1,q)})}function ws(M,q,ee,ve,ht){try{ht&&(ht.onload=null,ht.onerror=null,ht.onabort=null,ht.ontimeout=null),ve(ee)}catch{}}function u0(){this.g=new Or}function Zl(M,q,ee){const ve=ee||"";try{pf(M,function(ht,Pt){let ur=ht;S(ht)&&(ur=Nt(ht)),q.push(ve+Pt+"="+encodeURIComponent(ur))})}catch(ht){throw q.push(ve+"type="+encodeURIComponent("_badmap")),ht}}function kc(M){this.l=M.Ub||null,this.j=M.eb||!1}Q(kc,ii),kc.prototype.g=function(){return new Xl(this.l,this.j)},kc.prototype.i=function(M){return function(){return M}}({});function Xl(M,q){xe.call(this),this.D=M,this.o=q,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}Q(Xl,xe),n=Xl.prototype,n.open=function(M,q){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=M,this.A=q,this.readyState=1,Yl(this)},n.send=function(M){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const q={headers:this.u,method:this.B,credentials:this.m,cache:void 0};M&&(q.body=M),(this.D||x).fetch(new Request(this.A,q)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ut(this)),this.readyState=0},n.Sa=function(M){if(this.g&&(this.l=M,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=M.headers,this.readyState=2,Yl(this)),this.g&&(this.readyState=3,Yl(this),this.g)))if(this.responseType==="arraybuffer")M.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof x.ReadableStream<"u"&&"body"in M){if(this.j=M.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Po(this)}else M.text().then(this.Ra.bind(this),this.ga.bind(this))};function Po(M){M.j.read().then(M.Pa.bind(M)).catch(M.ga.bind(M))}n.Pa=function(M){if(this.g){if(this.o&&M.value)this.response.push(M.value);else if(!this.o){var q=M.value?M.value:new Uint8Array(0);(q=this.v.decode(q,{stream:!M.done}))&&(this.response=this.responseText+=q)}M.done?Ut(this):Yl(this),this.readyState==3&&Po(this)}},n.Ra=function(M){this.g&&(this.response=this.responseText=M,Ut(this))},n.Qa=function(M){this.g&&(this.response=M,Ut(this))},n.ga=function(){this.g&&Ut(this)};function Ut(M){M.readyState=4,M.l=null,M.j=null,M.v=null,Yl(M)}n.setRequestHeader=function(M,q){this.u.append(M,q)},n.getResponseHeader=function(M){return this.h&&this.h.get(M.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const M=[],q=this.h.entries();for(var ee=q.next();!ee.done;)ee=ee.value,M.push(ee[0]+": "+ee[1]),ee=q.next();return M.join(`\r
`)};function Yl(M){M.onreadystatechange&&M.onreadystatechange.call(M)}Object.defineProperty(Xl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(M){this.m=M?"include":"same-origin"}});function Ch(M){let q="";return $e(M,function(ee,ve){q+=ve,q+=":",q+=ee,q+=`\r
`}),q}function ui(M,q,ee){e:{for(ve in ee){var ve=!1;break e}ve=!0}ve||(ee=Ch(ee),typeof M=="string"?ee!=null&&encodeURIComponent(String(ee)):En(M,q,ee))}function Ui(M){xe.call(this),this.headers=new Map,this.o=M||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}Q(Ui,xe);var Tm=/^https?$/i,Rh=["POST","PUT"];n=Ui.prototype,n.Ha=function(M){this.J=M},n.ea=function(M,q,ee,ve){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+M);q=q?q.toUpperCase():"GET",this.D=M,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():gr.g(),this.v=this.o?mr(this.o):mr(gr),this.g.onreadystatechange=V(this.Ea,this);try{this.B=!0,this.g.open(q,String(M),!0),this.B=!1}catch(Pt){yf(this,Pt);return}if(M=ee||"",ee=new Map(this.headers),ve)if(Object.getPrototypeOf(ve)===Object.prototype)for(var ht in ve)ee.set(ht,ve[ht]);else if(typeof ve.keys=="function"&&typeof ve.get=="function")for(const Pt of ve.keys())ee.set(Pt,ve.get(Pt));else throw Error("Unknown input type for opt_headers: "+String(ve));ve=Array.from(ee.keys()).find(Pt=>Pt.toLowerCase()=="content-type"),ht=x.FormData&&M instanceof x.FormData,!(0<=Array.prototype.indexOf.call(Rh,q,void 0))||ve||ht||ee.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Pt,ur]of ee)this.g.setRequestHeader(Pt,ur);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ta(this),this.u=!0,this.g.send(M),this.u=!1}catch(Pt){yf(this,Pt)}};function yf(M,q){M.h=!1,M.g&&(M.j=!0,M.g.abort(),M.j=!1),M.l=q,M.m=5,Mo(M),yl(M)}function Mo(M){M.A||(M.A=!0,Be(M,"complete"),Be(M,"error"))}n.abort=function(M){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=M||7,Be(this,"complete"),Be(this,"abort"),yl(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),yl(this,!0)),Ui.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?ti(this):this.bb())},n.bb=function(){ti(this)};function ti(M){if(M.h&&typeof _<"u"&&(!M.v[1]||ta(M)!=4||M.Z()!=2)){if(M.u&&ta(M)==4)ct(M.Ea,0,M);else if(Be(M,"readystatechange"),ta(M)==4){M.h=!1;try{const ur=M.Z();e:switch(ur){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var q=!0;break e;default:q=!1}var ee;if(!(ee=q)){var ve;if(ve=ur===0){var ht=String(M.D).match(wu)[1]||null;!ht&&x.self&&x.self.location&&(ht=x.self.location.protocol.slice(0,-1)),ve=!Tm.test(ht?ht.toLowerCase():"")}ee=ve}if(ee)Be(M,"complete"),Be(M,"success");else{M.m=6;try{var Pt=2<ta(M)?M.g.statusText:""}catch{Pt=""}M.l=Pt+" ["+M.Z()+"]",Mo(M)}}finally{yl(M)}}}}function yl(M,q){if(M.g){Ta(M);const ee=M.g,ve=M.v[0]?()=>{}:null;M.g=null,M.v=null,q||Be(M,"ready");try{ee.onreadystatechange=ve}catch{}}}function Ta(M){M.I&&(x.clearTimeout(M.I),M.I=null)}n.isActive=function(){return!!this.g};function ta(M){return M.g?M.g.readyState:0}n.Z=function(){try{return 2<ta(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(M){if(this.g){var q=this.g.responseText;return M&&q.indexOf(M)==0&&(q=q.substring(M.length)),jr(q)}};function _o(M){try{if(!M.g)return null;if("response"in M.g)return M.g.response;switch(M.H){case"":case"text":return M.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in M.g)return M.g.mozResponseArrayBuffer}return null}catch{return null}}function Em(M){const q={};M=(M.g&&2<=ta(M)&&M.g.getAllResponseHeaders()||"").split(`\r
`);for(let ve=0;ve<M.length;ve++){if(Me(M[ve]))continue;var ee=Fe(M[ve]);const ht=ee[0];if(ee=ee[1],typeof ee!="string")continue;ee=ee.trim();const Pt=q[ht]||[];q[ht]=Pt,Pt.push(ee)}ue(q,function(ve){return ve.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function pi(M,q,ee){return ee&&ee.internalChannelParams&&ee.internalChannelParams[M]||q}function Ru(M){this.Aa=0,this.i=[],this.j=new ut,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=pi("failFast",!1,M),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=pi("baseRetryDelayMs",5e3,M),this.cb=pi("retryDelaySeedMs",1e4,M),this.Wa=pi("forwardChannelMaxRetries",2,M),this.wa=pi("forwardChannelRequestTimeoutMs",2e4,M),this.pa=M&&M.xmlHttpFactory||void 0,this.Xa=M&&M.Tb||void 0,this.Ca=M&&M.useFetchStreams||!1,this.L=void 0,this.J=M&&M.supportsCrossDomainXhr||!1,this.K="",this.h=new Vn(M&&M.concurrentRequestLimit),this.Da=new u0,this.P=M&&M.fastHandshake||!1,this.O=M&&M.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=M&&M.Rb||!1,M&&M.xa&&this.j.xa(),M&&M.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&M&&M.detectBufferingProxy||!1,this.ja=void 0,M&&M.longPollingTimeout&&0<M.longPollingTimeout&&(this.ja=M.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Ru.prototype,n.la=8,n.G=1,n.connect=function(M,q,ee,ve){Xe(0),this.W=M,this.H=q||{},ee&&ve!==void 0&&(this.H.OSID=ee,this.H.OAID=ve),this.F=this.X,this.I=zc(this,null,this.W),Ea(this)};function Pu(M){if(Ph(M),M.G==3){var q=M.U++,ee=Ns(M.I);if(En(ee,"SID",M.K),En(ee,"RID",q),En(ee,"TYPE","terminate"),go(M,ee),q=new Ir(M,M.j,q),q.L=2,q.v=Au(Ns(ee)),ee=!1,x.navigator&&x.navigator.sendBeacon)try{ee=x.navigator.sendBeacon(q.v.toString(),"")}catch{}!ee&&x.Image&&(new Image().src=q.v,ee=!0),ee||(q.g=Xa(q.j,null),q.g.ea(q.v)),q.F=Date.now(),Fi(q)}Du(M)}function Mu(M){M.g&&(Ql(M),M.g.cancel(),M.g=null)}function Ph(M){Mu(M),M.u&&(x.clearTimeout(M.u),M.u=null),ko(M),M.h.cancel(),M.s&&(typeof M.s=="number"&&x.clearTimeout(M.s),M.s=null)}function Ea(M){if(!Fs(M.h)&&!M.s){M.s=!0;var q=M.Ga;Ht||We(),Kt||(Ht(),Kt=!0),Tr.add(q,M),M.B=0}}function Dc(M,q){return Wa(M.h)>=M.h.j-(M.s?1:0)?!1:M.s?(M.i=q.D.concat(M.i),!0):M.G==1||M.G==2||M.B>=(M.Va?0:M.Wa)?!1:(M.s=tt(V(M.Ga,M,q),ku(M,M.B)),M.B++,!0)}n.Ga=function(M){if(this.s)if(this.s=null,this.G==1){if(!M){this.U=Math.floor(1e5*Math.random()),M=this.U++;const ht=new Ir(this,this.j,M);let Pt=this.o;if(this.S&&(Pt?(Pt=pe(Pt),ge(Pt,this.S)):Pt=this.S),this.m!==null||this.O||(ht.H=Pt,Pt=null),this.P)e:{for(var q=0,ee=0;ee<this.i.length;ee++){t:{var ve=this.i[ee];if("__data__"in ve.map&&(ve=ve.map.__data__,typeof ve=="string")){ve=ve.length;break t}ve=void 0}if(ve===void 0)break;if(q+=ve,4096<q){q=ee;break e}if(q===4096||ee===this.i.length-1){q=ee+1;break e}}q=1e3}else q=1e3;q=Mh(this,ht,q),ee=Ns(this.I),En(ee,"RID",M),En(ee,"CVER",22),this.D&&En(ee,"X-HTTP-Session-Id",this.D),go(this,ee),Pt&&(this.O?q="headers="+encodeURIComponent(String(Ch(Pt)))+"&"+q:this.m&&ui(ee,this.m,Pt)),bu(this.h,ht),this.Ua&&En(ee,"TYPE","init"),this.P?(En(ee,"$req",q),En(ee,"SID","null"),ht.T=!0,fi(ht,ee,null)):fi(ht,ee,q),this.G=2}}else this.G==3&&(M?Lc(this,M):this.i.length==0||Fs(this.h)||Lc(this))};function Lc(M,q){var ee;q?ee=q.l:ee=M.U++;const ve=Ns(M.I);En(ve,"SID",M.K),En(ve,"RID",ee),En(ve,"AID",M.T),go(M,ve),M.m&&M.o&&ui(ve,M.m,M.o),ee=new Ir(M,M.j,ee,M.B+1),M.m===null&&(ee.H=M.o),q&&(M.i=q.D.concat(M.i)),q=Mh(M,ee,1e3),ee.I=Math.round(.5*M.wa)+Math.round(.5*M.wa*Math.random()),bu(M.h,ee),fi(ee,ve,q)}function go(M,q){M.H&&$e(M.H,function(ee,ve){En(q,ve,ee)}),M.l&&pf({},function(ee,ve){En(q,ve,ee)})}function Mh(M,q,ee){ee=Math.min(M.i.length,ee);var ve=M.l?V(M.l.Na,M.l,M):null;e:{var ht=M.i;let Pt=-1;for(;;){const ur=["count="+ee];Pt==-1?0<ee?(Pt=ht[0].g,ur.push("ofs="+Pt)):Pt=0:ur.push("ofs="+Pt);let an=!0;for(let fs=0;fs<ee;fs++){let ki=ht[fs].g;const ns=ht[fs].map;if(ki-=Pt,0>ki)Pt=Math.max(0,ht[fs].g-100),an=!1;else try{Zl(ns,ur,"req"+ki+"_")}catch{ve&&ve(ns)}}if(an){ve=ur.join("&");break e}}}return M=M.i.splice(0,ee),q.D=M,ve}function gn(M){if(!M.g&&!M.u){M.Y=1;var q=M.Fa;Ht||We(),Kt||(Ht(),Kt=!0),Tr.add(q,M),M.v=0}}function Aa(M){return M.g||M.u||3<=M.v?!1:(M.Y++,M.u=tt(V(M.Fa,M),ku(M,M.v)),M.v++,!0)}n.Fa=function(){if(this.u=null,Oc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var M=2*this.R;this.j.info("BP detection timer enabled: "+M),this.A=tt(V(this.ab,this),M)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Xe(10),Mu(this),Oc(this))};function Ql(M){M.A!=null&&(x.clearTimeout(M.A),M.A=null)}function Oc(M){M.g=new Ir(M,M.j,"rpc",M.Y),M.m===null&&(M.g.H=M.o),M.g.O=0;var q=Ns(M.qa);En(q,"RID","rpc"),En(q,"SID",M.K),En(q,"AID",M.T),En(q,"CI",M.F?"0":"1"),!M.F&&M.ja&&En(q,"TO",M.ja),En(q,"TYPE","xmlhttp"),go(M,q),M.m&&M.o&&ui(q,M.m,M.o),M.L&&(M.g.I=M.L);var ee=M.g;M=M.ia,ee.L=1,ee.v=Au(Ns(q)),ee.m=null,ee.P=!0,kr(ee,M)}n.Za=function(){this.C!=null&&(this.C=null,Mu(this),Aa(this),Xe(19))};function ko(M){M.C!=null&&(x.clearTimeout(M.C),M.C=null)}function eo(M,q){var ee=null;if(M.g==q){ko(M),Ql(M),M.g=null;var ve=2}else if(Ah(M.h,q))ee=q.D,df(M.h,q),ve=1;else return;if(M.G!=0){if(q.o)if(ve==1){ee=q.m?q.m.length:0,q=Date.now()-q.F;var ht=M.B;ve=fn(),Be(ve,new Ve(ve,ee)),Ea(M)}else gn(M);else if(ht=q.s,ht==3||ht==0&&0<q.X||!(ve==1&&Dc(M,q)||ve==2&&Aa(M)))switch(ee&&0<ee.length&&(q=M.h,q.i=q.i.concat(ee)),ht){case 1:Ia(M,5);break;case 4:Ia(M,10);break;case 3:Ia(M,6);break;default:Ia(M,2)}}}function ku(M,q){let ee=M.Ta+Math.floor(Math.random()*M.cb);return M.isActive()||(ee*=2),ee*q}function Ia(M,q){if(M.j.info("Error code "+q),q==2){var ee=V(M.fb,M),ve=M.Xa;const ht=!ve;ve=new Za(ve||"//www.google.com/images/cleardot.gif"),x.location&&x.location.protocol=="http"||Tu(ve,"https"),Au(ve),ht?gf(ve.toString(),ee):Cr(ve.toString(),ee)}else Xe(2);M.G=0,M.l&&M.l.sa(q),Du(M),Ph(M)}n.fb=function(M){M?(this.j.info("Successfully pinged google.com"),Xe(2)):(this.j.info("Failed to ping google.com"),Xe(1))};function Du(M){if(M.G=0,M.ka=[],M.l){const q=ff(M.h);(q.length!=0||M.i.length!=0)&&(ce(M.ka,q),ce(M.ka,M.i),M.h.i.length=0,te(M.i),M.i.length=0),M.l.ra()}}function zc(M,q,ee){var ve=ee instanceof Za?Ns(ee):new Za(ee);if(ve.g!="")q&&(ve.g=q+"."+ve.g),Eu(ve,ve.s);else{var ht=x.location;ve=ht.protocol,q=q?q+"."+ht.hostname:ht.hostname,ht=+ht.port;var Pt=new Za(null);ve&&Tu(Pt,ve),q&&(Pt.g=q),ht&&Eu(Pt,ht),ee&&(Pt.l=ee),ve=Pt}return ee=M.D,q=M.ya,ee&&q&&En(ve,ee,q),En(ve,"VER",M.la),go(M,ve),ve}function Xa(M,q,ee){if(q&&!M.J)throw Error("Can't create secondary domain capable XhrIo object.");return q=M.Ca&&!M.pa?new Ui(new kc({eb:ee})):new Ui(M.pa),q.Ha(M.J),q}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Kl(){}n=Kl.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Jl(){}Jl.prototype.g=function(M,q){return new Bs(M,q)};function Bs(M,q){xe.call(this),this.g=new Ru(q),this.l=M,this.h=q&&q.messageUrlParams||null,M=q&&q.messageHeaders||null,q&&q.clientProtocolHeaderRequired&&(M?M["X-Client-Protocol"]="webchannel":M={"X-Client-Protocol":"webchannel"}),this.g.o=M,M=q&&q.initMessageHeaders||null,q&&q.messageContentType&&(M?M["X-WebChannel-Content-Type"]=q.messageContentType:M={"X-WebChannel-Content-Type":q.messageContentType}),q&&q.va&&(M?M["X-WebChannel-Client-Profile"]=q.va:M={"X-WebChannel-Client-Profile":q.va}),this.g.S=M,(M=q&&q.Sb)&&!Me(M)&&(this.g.m=M),this.v=q&&q.supportsCrossDomainXhr||!1,this.u=q&&q.sendRawJson||!1,(q=q&&q.httpSessionIdParam)&&!Me(q)&&(this.g.D=q,M=this.h,M!==null&&q in M&&(M=this.h,q in M&&delete M[q])),this.j=new bl(this)}Q(Bs,xe),Bs.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Bs.prototype.close=function(){Pu(this.g)},Bs.prototype.o=function(M){var q=this.g;if(typeof M=="string"){var ee={};ee.__data__=M,M=ee}else this.u&&(ee={},ee.__data__=Nt(M),M=ee);q.i.push(new Js(q.Ya++,M)),q.G==3&&Ea(q)},Bs.prototype.N=function(){this.g.l=null,delete this.j,Pu(this.g),delete this.g,Bs.aa.N.call(this)};function vl(M){Ti.call(this),M.__headers__&&(this.headers=M.__headers__,this.statusCode=M.__status__,delete M.__headers__,delete M.__status__);var q=M.__sm__;if(q){e:{for(const ee in q){M=ee;break e}M=void 0}(this.i=M)&&(M=this.i,q=q!==null&&M in q?q[M]:void 0),this.data=q}else this.data=M}Q(vl,Ti);function xl(){Zi.call(this),this.status=1}Q(xl,Zi);function bl(M){this.g=M}Q(bl,Kl),bl.prototype.ua=function(){Be(this.g,"a")},bl.prototype.ta=function(M){Be(this.g,new vl(M))},bl.prototype.sa=function(M){Be(this.g,new xl)},bl.prototype.ra=function(){Be(this.g,"b")},Jl.prototype.createWebChannel=Jl.prototype.g,Bs.prototype.send=Bs.prototype.o,Bs.prototype.open=Bs.prototype.m,Bs.prototype.close=Bs.prototype.close,OB=function(){return new Jl},LB=function(){return fn()},DB=mi,SI={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},It.NO_ERROR=0,It.TIMEOUT=8,It.HTTP_ERROR=6,vw=It,ar.COMPLETE="complete",kB=ar,ni.EventType=Kr,Kr.OPEN="a",Kr.CLOSE="b",Kr.ERROR="c",Kr.MESSAGE="d",xe.prototype.listen=xe.prototype.K,Yy=ni,MB=kc,Ui.prototype.listenOnce=Ui.prototype.L,Ui.prototype.getLastError=Ui.prototype.Ka,Ui.prototype.getLastErrorCode=Ui.prototype.Ba,Ui.prototype.getStatus=Ui.prototype.Z,Ui.prototype.getResponseJson=Ui.prototype.Oa,Ui.prototype.getResponseText=Ui.prototype.oa,Ui.prototype.send=Ui.prototype.ea,Ui.prototype.setWithCredentials=Ui.prototype.Ha,PB=Ui}).apply(typeof Nb<"u"?Nb:typeof self<"u"?self:typeof window<"u"?window:{});const jD="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}jo.UNAUTHENTICATED=new jo(null),jo.GOOGLE_CREDENTIALS=new jo("google-credentials-uid"),jo.FIRST_PARTY=new jo("first-party-uid"),jo.MOCK_USER=new jo("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let t0="10.12.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jp=new Yg("@firebase/firestore");function zy(){return Jp.logLevel}function Nr(n,...e){if(Jp.logLevel<=Ji.DEBUG){const r=e.map(GC);Jp.debug(`Firestore (${t0}): ${n}`,...r)}}function _h(n,...e){if(Jp.logLevel<=Ji.ERROR){const r=e.map(GC);Jp.error(`Firestore (${t0}): ${n}`,...r)}}function Rg(n,...e){if(Jp.logLevel<=Ji.WARN){const r=e.map(GC);Jp.warn(`Firestore (${t0}): ${n}`,...r)}}function GC(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(r){return JSON.stringify(r)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ci(n="Unexpected state"){const e=`FIRESTORE (${t0}) INTERNAL ASSERTION FAILED: `+n;throw _h(e),new Error(e)}function qn(n,e){n||Ci()}function zi(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Jr extends Wl{constructor(e,r){super(e,r),this.code=e,this.message=r,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fh{constructor(){this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zB{constructor(e,r){this.user=r,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class KJ{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,r){e.enqueueRetryable(()=>r(jo.UNAUTHENTICATED))}shutdown(){}}class JJ{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,r){this.changeListener=r,e.enqueueRetryable(()=>r(this.token.user))}shutdown(){this.changeListener=null}}class eee{constructor(e){this.t=e,this.currentUser=jo.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,r){let s=this.i;const c=l=>this.i!==s?(s=this.i,r(l)):Promise.resolve();let d=new fh;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new fh,e.enqueueRetryable(()=>c(this.currentUser))};const _=()=>{const l=d;e.enqueueRetryable(async()=>{await l.promise,await c(this.currentUser)})},x=l=>{Nr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.o),_()};this.t.onInit(l=>x(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?x(l):(Nr("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new fh)}},0),_()}getToken(){const e=this.i,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(s=>this.i!==e?(Nr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(qn(typeof s.accessToken=="string"),new zB(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return qn(e===null||typeof e=="string"),new jo(e)}}class tee{constructor(e,r,s){this.l=e,this.h=r,this.P=s,this.type="FirstParty",this.user=jo.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class ree{constructor(e,r,s){this.l=e,this.h=r,this.P=s}getToken(){return Promise.resolve(new tee(this.l,this.h,this.P))}start(e,r){e.enqueueRetryable(()=>r(jo.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class iee{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class nee{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,r){const s=d=>{d.error!=null&&Nr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const _=d.token!==this.R;return this.R=d.token,Nr("FirebaseAppCheckTokenProvider",`Received ${_?"new":"existing"} token.`),_?r(d.token):Promise.resolve()};this.o=d=>{e.enqueueRetryable(()=>s(d))};const c=d=>{Nr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>c(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?c(d):Nr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(r=>r?(qn(typeof r.token=="string"),this.R=r.token,new iee(r.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function see(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),r=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(r);else for(let s=0;s<n;s++)r[s]=Math.floor(256*Math.random());return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FB{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=Math.floor(256/e.length)*e.length;let s="";for(;s.length<20;){const c=see(40);for(let d=0;d<c.length;++d)s.length<20&&c[d]<r&&(s+=e.charAt(c[d]%e.length))}return s}}function wn(n,e){return n<e?-1:n>e?1:0}function Pg(n,e,r){return n.length===e.length&&n.every((s,c)=>r(s,e[c]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs{constructor(e,r){if(this.seconds=e,this.nanoseconds=r,r<0)throw new Jr(tr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new Jr(tr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(e<-62135596800)throw new Jr(tr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Jr(tr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return zs.fromMillis(Date.now())}static fromDate(e){return zs.fromMillis(e.getTime())}static fromMillis(e){const r=Math.floor(e/1e3),s=Math.floor(1e6*(e-1e3*r));return new zs(r,s)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?wn(this.nanoseconds,e.nanoseconds):wn(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Oi(e)}static min(){return new Oi(new zs(0,0))}static max(){return new Oi(new zs(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jv{constructor(e,r,s){r===void 0?r=0:r>e.length&&Ci(),s===void 0?s=e.length-r:s>e.length-r&&Ci(),this.segments=e,this.offset=r,this.len=s}get length(){return this.len}isEqual(e){return Jv.comparator(this,e)===0}child(e){const r=this.segments.slice(this.offset,this.limit());return e instanceof Jv?e.forEach(s=>{r.push(s)}):r.push(e),this.construct(r)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}forEach(e){for(let r=this.offset,s=this.limit();r<s;r++)e(this.segments[r])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,r){const s=Math.min(e.length,r.length);for(let c=0;c<s;c++){const d=e.get(c),_=r.get(c);if(d<_)return-1;if(d>_)return 1}return e.length<r.length?-1:e.length>r.length?1:0}}class ts extends Jv{construct(e,r,s){return new ts(e,r,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const r=[];for(const s of e){if(s.indexOf("//")>=0)throw new Jr(tr.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);r.push(...s.split("/").filter(c=>c.length>0))}return new ts(r)}static emptyPath(){return new ts([])}}const oee=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Eo extends Jv{construct(e,r,s){return new Eo(e,r,s)}static isValidIdentifier(e){return oee.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Eo.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Eo(["__name__"])}static fromServerFormat(e){const r=[];let s="",c=0;const d=()=>{if(s.length===0)throw new Jr(tr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);r.push(s),s=""};let _=!1;for(;c<e.length;){const x=e[c];if(x==="\\"){if(c+1===e.length)throw new Jr(tr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[c+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Jr(tr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=l,c+=2}else x==="`"?(_=!_,c++):x!=="."||_?(s+=x,c++):(d(),c++)}if(d(),_)throw new Jr(tr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Eo(r)}static emptyPath(){return new Eo([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ci{constructor(e){this.path=e}static fromPath(e){return new ci(ts.fromString(e))}static fromName(e){return new ci(ts.fromString(e).popFirst(5))}static empty(){return new ci(ts.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ts.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,r){return ts.comparator(e.path,r.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ci(new ts(e.slice()))}}function aee(n,e){const r=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,c=Oi.fromTimestamp(s===1e9?new zs(r+1,0):new zs(r,s));return new Qd(c,ci.empty(),e)}function lee(n){return new Qd(n.readTime,n.key,-1)}class Qd{constructor(e,r,s){this.readTime=e,this.documentKey=r,this.largestBatchId=s}static min(){return new Qd(Oi.min(),ci.empty(),-1)}static max(){return new Qd(Oi.max(),ci.empty(),-1)}}function cee(n,e){let r=n.readTime.compareTo(e.readTime);return r!==0?r:(r=ci.comparator(n.documentKey,e.documentKey),r!==0?r:wn(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uee="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class hee{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M1(n){if(n.code!==tr.FAILED_PRECONDITION||n.message!==uee)throw n;Nr("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(r=>{this.isDone=!0,this.result=r,this.nextCallback&&this.nextCallback(r)},r=>{this.isDone=!0,this.error=r,this.catchCallback&&this.catchCallback(r)})}catch(e){return this.next(void 0,e)}next(e,r){return this.callbackAttached&&Ci(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(r,this.error):this.wrapSuccess(e,this.result):new rr((s,c)=>{this.nextCallback=d=>{this.wrapSuccess(e,d).next(s,c)},this.catchCallback=d=>{this.wrapFailure(r,d).next(s,c)}})}toPromise(){return new Promise((e,r)=>{this.next(e,r)})}wrapUserFunction(e){try{const r=e();return r instanceof rr?r:rr.resolve(r)}catch(r){return rr.reject(r)}}wrapSuccess(e,r){return e?this.wrapUserFunction(()=>e(r)):rr.resolve(r)}wrapFailure(e,r){return e?this.wrapUserFunction(()=>e(r)):rr.reject(r)}static resolve(e){return new rr((r,s)=>{r(e)})}static reject(e){return new rr((r,s)=>{s(e)})}static waitFor(e){return new rr((r,s)=>{let c=0,d=0,_=!1;e.forEach(x=>{++c,x.next(()=>{++d,_&&d===c&&r()},l=>s(l))}),_=!0,d===c&&r()})}static or(e){let r=rr.resolve(!1);for(const s of e)r=r.next(c=>c?rr.resolve(c):s());return r}static forEach(e,r){const s=[];return e.forEach((c,d)=>{s.push(r.call(this,c,d))}),this.waitFor(s)}static mapArray(e,r){return new rr((s,c)=>{const d=e.length,_=new Array(d);let x=0;for(let l=0;l<d;l++){const S=l;r(e[S]).next(D=>{_[S]=D,++x,x===d&&s(_)},D=>c(D))}})}static doWhile(e,r){return new rr((s,c)=>{const d=()=>{e()===!0?r().next(()=>{d()},c):s()};d()})}}function dee(n){const e=n.match(/Android ([\d.]+)/i),r=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(r)}function k1(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qC{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=s=>this.ie(s),this.se=s=>r.writeSequenceNumber(s))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}qC.oe=-1;function dE(n){return n==null}function nT(n){return n===0&&1/n==-1/0}function fee(n){return typeof n=="number"&&Number.isInteger(n)&&!nT(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $D(n){let e=0;for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&e++;return e}function r0(n,e){for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&e(r,n[r])}function NB(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class us{constructor(e,r){this.comparator=e,this.root=r||bo.EMPTY}insert(e,r){return new us(this.comparator,this.root.insert(e,r,this.comparator).copy(null,null,bo.BLACK,null,null))}remove(e){return new us(this.comparator,this.root.remove(e,this.comparator).copy(null,null,bo.BLACK,null,null))}get(e){let r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return r.value;s<0?r=r.left:s>0&&(r=r.right)}return null}indexOf(e){let r=0,s=this.root;for(;!s.isEmpty();){const c=this.comparator(e,s.key);if(c===0)return r+s.left.size;c<0?s=s.left:(r+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((r,s)=>(e(r,s),!1))}toString(){const e=[];return this.inorderTraversal((r,s)=>(e.push(`${r}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Bb(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Bb(this.root,e,this.comparator,!1)}getReverseIterator(){return new Bb(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Bb(this.root,e,this.comparator,!0)}}class Bb{constructor(e,r,s,c){this.isReverse=c,this.nodeStack=[];let d=1;for(;!e.isEmpty();)if(d=r?s(e.key,r):1,r&&c&&(d*=-1),d<0)e=this.isReverse?e.left:e.right;else{if(d===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const r={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return r}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class bo{constructor(e,r,s,c,d){this.key=e,this.value=r,this.color=s??bo.RED,this.left=c??bo.EMPTY,this.right=d??bo.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,r,s,c,d){return new bo(e??this.key,r??this.value,s??this.color,c??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,r,s){let c=this;const d=s(e,c.key);return c=d<0?c.copy(null,null,null,c.left.insert(e,r,s),null):d===0?c.copy(null,r,null,null,null):c.copy(null,null,null,null,c.right.insert(e,r,s)),c.fixUp()}removeMin(){if(this.left.isEmpty())return bo.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,r){let s,c=this;if(r(e,c.key)<0)c.left.isEmpty()||c.left.isRed()||c.left.left.isRed()||(c=c.moveRedLeft()),c=c.copy(null,null,null,c.left.remove(e,r),null);else{if(c.left.isRed()&&(c=c.rotateRight()),c.right.isEmpty()||c.right.isRed()||c.right.left.isRed()||(c=c.moveRedRight()),r(e,c.key)===0){if(c.right.isEmpty())return bo.EMPTY;s=c.right.min(),c=c.copy(s.key,s.value,null,null,c.right.removeMin())}c=c.copy(null,null,null,null,c.right.remove(e,r))}return c.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,bo.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,bo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ci();const e=this.left.check();if(e!==this.right.check())throw Ci();return e+(this.isRed()?0:1)}}bo.EMPTY=null,bo.RED=!0,bo.BLACK=!1;bo.EMPTY=new class{constructor(){this.size=0}get key(){throw Ci()}get value(){throw Ci()}get color(){throw Ci()}get left(){throw Ci()}get right(){throw Ci()}copy(e,r,s,c,d){return this}insert(e,r,s){return new bo(e,r)}remove(e,r){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class So{constructor(e){this.comparator=e,this.data=new us(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((r,s)=>(e(r),!1))}forEachInRange(e,r){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const c=s.getNext();if(this.comparator(c.key,e[1])>=0)return;r(c.key)}}forEachWhile(e,r){let s;for(s=r!==void 0?this.data.getIteratorFrom(r):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const r=this.data.getIteratorFrom(e);return r.hasNext()?r.getNext().key:null}getIterator(){return new GD(this.data.getIterator())}getIteratorFrom(e){return new GD(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let r=this;return r.size<e.size&&(r=e,e=this),e.forEach(s=>{r=r.add(s)}),r}isEqual(e){if(!(e instanceof So)||this.size!==e.size)return!1;const r=this.data.getIterator(),s=e.data.getIterator();for(;r.hasNext();){const c=r.getNext().key,d=s.getNext().key;if(this.comparator(c,d)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(r=>{e.push(r)}),e}toString(){const e=[];return this.forEach(r=>e.push(r)),"SortedSet("+e.toString()+")"}copy(e){const r=new So(this.comparator);return r.data=e,r}}class GD{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vc{constructor(e){this.fields=e,e.sort(Eo.comparator)}static empty(){return new vc([])}unionWith(e){let r=new So(Eo.comparator);for(const s of this.fields)r=r.add(s);for(const s of e)r=r.add(s);return new vc(r.toArray())}covers(e){for(const r of this.fields)if(r.isPrefixOf(e))return!0;return!1}isEqual(e){return Pg(this.fields,e.fields,(r,s)=>r.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BB extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo{constructor(e){this.binaryString=e}static fromBase64String(e){const r=function(c){try{return atob(c)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new BB("Invalid base64 string: "+d):d}}(e);return new Jo(r)}static fromUint8Array(e){const r=function(c){let d="";for(let _=0;_<c.length;++_)d+=String.fromCharCode(c[_]);return d}(e);return new Jo(r)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(r){return btoa(r)}(this.binaryString)}toUint8Array(){return function(r){const s=new Uint8Array(r.length);for(let c=0;c<r.length;c++)s[c]=r.charCodeAt(c);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return wn(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Jo.EMPTY_BYTE_STRING=new Jo("");const pee=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Kd(n){if(qn(!!n),typeof n=="string"){let e=0;const r=pee.exec(n);if(qn(!!r),r[1]){let c=r[1];c=(c+"000000000").substr(0,9),e=Number(c)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:Ls(n.seconds),nanos:Ls(n.nanos)}}function Ls(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function em(n){return typeof n=="string"?Jo.fromBase64String(n):Jo.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HC(n){var e,r;return((r=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="server_timestamp"}function WC(n){const e=n.mapValue.fields.__previous_value__;return HC(e)?WC(e):e}function e1(n){const e=Kd(n.mapValue.fields.__local_write_time__.timestampValue);return new zs(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mee{constructor(e,r,s,c,d,_,x,l,S){this.databaseId=e,this.appId=r,this.persistenceKey=s,this.host=c,this.ssl=d,this.forceLongPolling=_,this.autoDetectLongPolling=x,this.longPollingOptions=l,this.useFetchStreams=S}}class t1{constructor(e,r){this.projectId=e,this.database=r||"(default)"}static empty(){return new t1("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof t1&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vb={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function tm(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?HC(n)?4:_ee(n)?9007199254740991:10:Ci()}function _u(n,e){if(n===e)return!0;const r=tm(n);if(r!==tm(e))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return e1(n).isEqual(e1(e));case 3:return function(c,d){if(typeof c.timestampValue=="string"&&typeof d.timestampValue=="string"&&c.timestampValue.length===d.timestampValue.length)return c.timestampValue===d.timestampValue;const _=Kd(c.timestampValue),x=Kd(d.timestampValue);return _.seconds===x.seconds&&_.nanos===x.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(c,d){return em(c.bytesValue).isEqual(em(d.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(c,d){return Ls(c.geoPointValue.latitude)===Ls(d.geoPointValue.latitude)&&Ls(c.geoPointValue.longitude)===Ls(d.geoPointValue.longitude)}(n,e);case 2:return function(c,d){if("integerValue"in c&&"integerValue"in d)return Ls(c.integerValue)===Ls(d.integerValue);if("doubleValue"in c&&"doubleValue"in d){const _=Ls(c.doubleValue),x=Ls(d.doubleValue);return _===x?nT(_)===nT(x):isNaN(_)&&isNaN(x)}return!1}(n,e);case 9:return Pg(n.arrayValue.values||[],e.arrayValue.values||[],_u);case 10:return function(c,d){const _=c.mapValue.fields||{},x=d.mapValue.fields||{};if($D(_)!==$D(x))return!1;for(const l in _)if(_.hasOwnProperty(l)&&(x[l]===void 0||!_u(_[l],x[l])))return!1;return!0}(n,e);default:return Ci()}}function r1(n,e){return(n.values||[]).find(r=>_u(r,e))!==void 0}function Mg(n,e){if(n===e)return 0;const r=tm(n),s=tm(e);if(r!==s)return wn(r,s);switch(r){case 0:case 9007199254740991:return 0;case 1:return wn(n.booleanValue,e.booleanValue);case 2:return function(d,_){const x=Ls(d.integerValue||d.doubleValue),l=Ls(_.integerValue||_.doubleValue);return x<l?-1:x>l?1:x===l?0:isNaN(x)?isNaN(l)?0:-1:1}(n,e);case 3:return qD(n.timestampValue,e.timestampValue);case 4:return qD(e1(n),e1(e));case 5:return wn(n.stringValue,e.stringValue);case 6:return function(d,_){const x=em(d),l=em(_);return x.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(d,_){const x=d.split("/"),l=_.split("/");for(let S=0;S<x.length&&S<l.length;S++){const D=wn(x[S],l[S]);if(D!==0)return D}return wn(x.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(d,_){const x=wn(Ls(d.latitude),Ls(_.latitude));return x!==0?x:wn(Ls(d.longitude),Ls(_.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(d,_){const x=d.values||[],l=_.values||[];for(let S=0;S<x.length&&S<l.length;++S){const D=Mg(x[S],l[S]);if(D)return D}return wn(x.length,l.length)}(n.arrayValue,e.arrayValue);case 10:return function(d,_){if(d===Vb.mapValue&&_===Vb.mapValue)return 0;if(d===Vb.mapValue)return 1;if(_===Vb.mapValue)return-1;const x=d.fields||{},l=Object.keys(x),S=_.fields||{},D=Object.keys(S);l.sort(),D.sort();for(let I=0;I<l.length&&I<D.length;++I){const V=wn(l[I],D[I]);if(V!==0)return V;const j=Mg(x[l[I]],S[D[I]]);if(j!==0)return j}return wn(l.length,D.length)}(n.mapValue,e.mapValue);default:throw Ci()}}function qD(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return wn(n,e);const r=Kd(n),s=Kd(e),c=wn(r.seconds,s.seconds);return c!==0?c:wn(r.nanos,s.nanos)}function kg(n){return CI(n)}function CI(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const s=Kd(r);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(r){return em(r).toBase64()}(n.bytesValue):"referenceValue"in n?function(r){return ci.fromName(r).toString()}(n.referenceValue):"geoPointValue"in n?function(r){return`geo(${r.latitude},${r.longitude})`}(n.geoPointValue):"arrayValue"in n?function(r){let s="[",c=!0;for(const d of r.values||[])c?c=!1:s+=",",s+=CI(d);return s+"]"}(n.arrayValue):"mapValue"in n?function(r){const s=Object.keys(r.fields||{}).sort();let c="{",d=!0;for(const _ of s)d?d=!1:c+=",",c+=`${_}:${CI(r.fields[_])}`;return c+"}"}(n.mapValue):Ci()}function RI(n){return!!n&&"integerValue"in n}function ZC(n){return!!n&&"arrayValue"in n}function HD(n){return!!n&&"nullValue"in n}function WD(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function xw(n){return!!n&&"mapValue"in n}function xv(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return r0(n.mapValue.fields,(r,s)=>e.mapValue.fields[r]=xv(s)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let r=0;r<(n.arrayValue.values||[]).length;++r)e.arrayValue.values[r]=xv(n.arrayValue.values[r]);return e}return Object.assign({},n)}function _ee(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ol{constructor(e){this.value=e}static empty(){return new Ol({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let r=this.value;for(let s=0;s<e.length-1;++s)if(r=(r.mapValue.fields||{})[e.get(s)],!xw(r))return null;return r=(r.mapValue.fields||{})[e.lastSegment()],r||null}}set(e,r){this.getFieldsMap(e.popLast())[e.lastSegment()]=xv(r)}setAll(e){let r=Eo.emptyPath(),s={},c=[];e.forEach((_,x)=>{if(!r.isImmediateParentOf(x)){const l=this.getFieldsMap(r);this.applyChanges(l,s,c),s={},c=[],r=x.popLast()}_?s[x.lastSegment()]=xv(_):c.push(x.lastSegment())});const d=this.getFieldsMap(r);this.applyChanges(d,s,c)}delete(e){const r=this.field(e.popLast());xw(r)&&r.mapValue.fields&&delete r.mapValue.fields[e.lastSegment()]}isEqual(e){return _u(this.value,e.value)}getFieldsMap(e){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let s=0;s<e.length;++s){let c=r.mapValue.fields[e.get(s)];xw(c)&&c.mapValue.fields||(c={mapValue:{fields:{}}},r.mapValue.fields[e.get(s)]=c),r=c}return r.mapValue.fields}applyChanges(e,r,s){r0(r,(c,d)=>e[c]=d);for(const c of s)delete e[c]}clone(){return new Ol(xv(this.value))}}function VB(n){const e=[];return r0(n.fields,(r,s)=>{const c=new Eo([r]);if(xw(s)){const d=VB(s.mapValue).fields;if(d.length===0)e.push(c);else for(const _ of d)e.push(c.child(_))}else e.push(c)}),new vc(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(e,r,s,c,d,_,x){this.key=e,this.documentType=r,this.version=s,this.readTime=c,this.createTime=d,this.data=_,this.documentState=x}static newInvalidDocument(e){return new Ho(e,0,Oi.min(),Oi.min(),Oi.min(),Ol.empty(),0)}static newFoundDocument(e,r,s,c){return new Ho(e,1,r,Oi.min(),s,c,0)}static newNoDocument(e,r){return new Ho(e,2,r,Oi.min(),Oi.min(),Ol.empty(),0)}static newUnknownDocument(e,r){return new Ho(e,3,r,Oi.min(),Oi.min(),Ol.empty(),2)}convertToFoundDocument(e,r){return!this.createTime.isEqual(Oi.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=r,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ol.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ol.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Oi.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ho&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ho(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sT{constructor(e,r){this.position=e,this.inclusive=r}}function ZD(n,e,r){let s=0;for(let c=0;c<n.position.length;c++){const d=e[c],_=n.position[c];if(d.field.isKeyField()?s=ci.comparator(ci.fromName(_.referenceValue),r.key):s=Mg(_,r.data.field(d.field)),d.dir==="desc"&&(s*=-1),s!==0)break}return s}function XD(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let r=0;r<n.position.length;r++)if(!_u(n.position[r],e.position[r]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oT{constructor(e,r="asc"){this.field=e,this.dir=r}}function gee(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UB{}class Xs extends UB{constructor(e,r,s){super(),this.field=e,this.op=r,this.value=s}static create(e,r,s){return e.isKeyField()?r==="in"||r==="not-in"?this.createKeyFieldInFilter(e,r,s):new vee(e,r,s):r==="array-contains"?new wee(e,s):r==="in"?new Tee(e,s):r==="not-in"?new Eee(e,s):r==="array-contains-any"?new Aee(e,s):new Xs(e,r,s)}static createKeyFieldInFilter(e,r,s){return r==="in"?new xee(e,s):new bee(e,s)}matches(e){const r=e.data.field(this.field);return this.op==="!="?r!==null&&this.matchesComparison(Mg(r,this.value)):r!==null&&tm(this.value)===tm(r)&&this.matchesComparison(Mg(r,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ci()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class gu extends UB{constructor(e,r){super(),this.filters=e,this.op=r,this.ae=null}static create(e,r){return new gu(e,r)}matches(e){return jB(this)?this.filters.find(r=>!r.matches(e))===void 0:this.filters.find(r=>r.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,r)=>e.concat(r.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function jB(n){return n.op==="and"}function $B(n){return yee(n)&&jB(n)}function yee(n){for(const e of n.filters)if(e instanceof gu)return!1;return!0}function PI(n){if(n instanceof Xs)return n.field.canonicalString()+n.op.toString()+kg(n.value);if($B(n))return n.filters.map(e=>PI(e)).join(",");{const e=n.filters.map(r=>PI(r)).join(",");return`${n.op}(${e})`}}function GB(n,e){return n instanceof Xs?function(s,c){return c instanceof Xs&&s.op===c.op&&s.field.isEqual(c.field)&&_u(s.value,c.value)}(n,e):n instanceof gu?function(s,c){return c instanceof gu&&s.op===c.op&&s.filters.length===c.filters.length?s.filters.reduce((d,_,x)=>d&&GB(_,c.filters[x]),!0):!1}(n,e):void Ci()}function qB(n){return n instanceof Xs?function(r){return`${r.field.canonicalString()} ${r.op} ${kg(r.value)}`}(n):n instanceof gu?function(r){return r.op.toString()+" {"+r.getFilters().map(qB).join(" ,")+"}"}(n):"Filter"}class vee extends Xs{constructor(e,r,s){super(e,r,s),this.key=ci.fromName(s.referenceValue)}matches(e){const r=ci.comparator(e.key,this.key);return this.matchesComparison(r)}}class xee extends Xs{constructor(e,r){super(e,"in",r),this.keys=HB("in",r)}matches(e){return this.keys.some(r=>r.isEqual(e.key))}}class bee extends Xs{constructor(e,r){super(e,"not-in",r),this.keys=HB("not-in",r)}matches(e){return!this.keys.some(r=>r.isEqual(e.key))}}function HB(n,e){var r;return(((r=e.arrayValue)===null||r===void 0?void 0:r.values)||[]).map(s=>ci.fromName(s.referenceValue))}class wee extends Xs{constructor(e,r){super(e,"array-contains",r)}matches(e){const r=e.data.field(this.field);return ZC(r)&&r1(r.arrayValue,this.value)}}class Tee extends Xs{constructor(e,r){super(e,"in",r)}matches(e){const r=e.data.field(this.field);return r!==null&&r1(this.value.arrayValue,r)}}class Eee extends Xs{constructor(e,r){super(e,"not-in",r)}matches(e){if(r1(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const r=e.data.field(this.field);return r!==null&&!r1(this.value.arrayValue,r)}}class Aee extends Xs{constructor(e,r){super(e,"array-contains-any",r)}matches(e){const r=e.data.field(this.field);return!(!ZC(r)||!r.arrayValue.values)&&r.arrayValue.values.some(s=>r1(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iee{constructor(e,r=null,s=[],c=[],d=null,_=null,x=null){this.path=e,this.collectionGroup=r,this.orderBy=s,this.filters=c,this.limit=d,this.startAt=_,this.endAt=x,this.ue=null}}function YD(n,e=null,r=[],s=[],c=null,d=null,_=null){return new Iee(n,e,r,s,c,d,_)}function XC(n){const e=zi(n);if(e.ue===null){let r=e.path.canonicalString();e.collectionGroup!==null&&(r+="|cg:"+e.collectionGroup),r+="|f:",r+=e.filters.map(s=>PI(s)).join(","),r+="|ob:",r+=e.orderBy.map(s=>function(d){return d.field.canonicalString()+d.dir}(s)).join(","),dE(e.limit)||(r+="|l:",r+=e.limit),e.startAt&&(r+="|lb:",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(s=>kg(s)).join(",")),e.endAt&&(r+="|ub:",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(s=>kg(s)).join(",")),e.ue=r}return e.ue}function YC(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let r=0;r<n.orderBy.length;r++)if(!gee(n.orderBy[r],e.orderBy[r]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let r=0;r<n.filters.length;r++)if(!GB(n.filters[r],e.filters[r]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!XD(n.startAt,e.startAt)&&XD(n.endAt,e.endAt)}function MI(n){return ci.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fE{constructor(e,r=null,s=[],c=[],d=null,_="F",x=null,l=null){this.path=e,this.collectionGroup=r,this.explicitOrderBy=s,this.filters=c,this.limit=d,this.limitType=_,this.startAt=x,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function See(n,e,r,s,c,d,_,x){return new fE(n,e,r,s,c,d,_,x)}function pE(n){return new fE(n)}function QD(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Cee(n){return n.collectionGroup!==null}function bv(n){const e=zi(n);if(e.ce===null){e.ce=[];const r=new Set;for(const d of e.explicitOrderBy)e.ce.push(d),r.add(d.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(_){let x=new So(Eo.comparator);return _.filters.forEach(l=>{l.getFlattenedFilters().forEach(S=>{S.isInequality()&&(x=x.add(S.field))})}),x})(e).forEach(d=>{r.has(d.canonicalString())||d.isKeyField()||e.ce.push(new oT(d,s))}),r.has(Eo.keyField().canonicalString())||e.ce.push(new oT(Eo.keyField(),s))}return e.ce}function uu(n){const e=zi(n);return e.le||(e.le=Ree(e,bv(n))),e.le}function Ree(n,e){if(n.limitType==="F")return YD(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(c=>{const d=c.dir==="desc"?"asc":"desc";return new oT(c.field,d)});const r=n.endAt?new sT(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new sT(n.startAt.position,n.startAt.inclusive):null;return YD(n.path,n.collectionGroup,e,n.filters,n.limit,r,s)}}function kI(n,e,r){return new fE(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,r,n.startAt,n.endAt)}function mE(n,e){return YC(uu(n),uu(e))&&n.limitType===e.limitType}function WB(n){return`${XC(uu(n))}|lt:${n.limitType}`}function V_(n){return`Query(target=${function(r){let s=r.path.canonicalString();return r.collectionGroup!==null&&(s+=" collectionGroup="+r.collectionGroup),r.filters.length>0&&(s+=`, filters: [${r.filters.map(c=>qB(c)).join(", ")}]`),dE(r.limit)||(s+=", limit: "+r.limit),r.orderBy.length>0&&(s+=`, orderBy: [${r.orderBy.map(c=>function(_){return`${_.field.canonicalString()} (${_.dir})`}(c)).join(", ")}]`),r.startAt&&(s+=", startAt: ",s+=r.startAt.inclusive?"b:":"a:",s+=r.startAt.position.map(c=>kg(c)).join(",")),r.endAt&&(s+=", endAt: ",s+=r.endAt.inclusive?"a:":"b:",s+=r.endAt.position.map(c=>kg(c)).join(",")),`Target(${s})`}(uu(n))}; limitType=${n.limitType})`}function _E(n,e){return e.isFoundDocument()&&function(s,c){const d=c.key.path;return s.collectionGroup!==null?c.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(d):ci.isDocumentKey(s.path)?s.path.isEqual(d):s.path.isImmediateParentOf(d)}(n,e)&&function(s,c){for(const d of bv(s))if(!d.field.isKeyField()&&c.data.field(d.field)===null)return!1;return!0}(n,e)&&function(s,c){for(const d of s.filters)if(!d.matches(c))return!1;return!0}(n,e)&&function(s,c){return!(s.startAt&&!function(_,x,l){const S=ZD(_,x,l);return _.inclusive?S<=0:S<0}(s.startAt,bv(s),c)||s.endAt&&!function(_,x,l){const S=ZD(_,x,l);return _.inclusive?S>=0:S>0}(s.endAt,bv(s),c))}(n,e)}function Pee(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function ZB(n){return(e,r)=>{let s=!1;for(const c of bv(n)){const d=Mee(c,e,r);if(d!==0)return d;s=s||c.field.isKeyField()}return 0}}function Mee(n,e,r){const s=n.field.isKeyField()?ci.comparator(e.key,r.key):function(d,_,x){const l=_.data.field(d),S=x.data.field(d);return l!==null&&S!==null?Mg(l,S):Ci()}(n.field,e,r);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return Ci()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0{constructor(e,r){this.mapKeyFn=e,this.equalsFn=r,this.inner={},this.innerSize=0}get(e){const r=this.mapKeyFn(e),s=this.inner[r];if(s!==void 0){for(const[c,d]of s)if(this.equalsFn(c,e))return d}}has(e){return this.get(e)!==void 0}set(e,r){const s=this.mapKeyFn(e),c=this.inner[s];if(c===void 0)return this.inner[s]=[[e,r]],void this.innerSize++;for(let d=0;d<c.length;d++)if(this.equalsFn(c[d][0],e))return void(c[d]=[e,r]);c.push([e,r]),this.innerSize++}delete(e){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return!1;for(let c=0;c<s.length;c++)if(this.equalsFn(s[c][0],e))return s.length===1?delete this.inner[r]:s.splice(c,1),this.innerSize--,!0;return!1}forEach(e){r0(this.inner,(r,s)=>{for(const[c,d]of s)e(c,d)})}isEmpty(){return NB(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kee=new us(ci.comparator);function gh(){return kee}const XB=new us(ci.comparator);function Qy(...n){let e=XB;for(const r of n)e=e.insert(r.key,r);return e}function YB(n){let e=XB;return n.forEach((r,s)=>e=e.insert(r,s.overlayedDocument)),e}function Rp(){return wv()}function QB(){return wv()}function wv(){return new i0(n=>n.toString(),(n,e)=>n.isEqual(e))}const Dee=new us(ci.comparator),Lee=new So(ci.comparator);function en(...n){let e=Lee;for(const r of n)e=e.add(r);return e}const Oee=new So(wn);function zee(){return Oee}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KB(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:nT(e)?"-0":e}}function JB(n){return{integerValue:""+n}}function Fee(n,e){return fee(e)?JB(e):KB(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gE{constructor(){this._=void 0}}function Nee(n,e,r){return n instanceof aT?function(c,d){const _={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:c.seconds,nanos:c.nanoseconds}}}};return d&&HC(d)&&(d=WC(d)),d&&(_.fields.__previous_value__=d),{mapValue:_}}(r,e):n instanceof Dg?t9(n,e):n instanceof i1?r9(n,e):function(c,d){const _=e9(c,d),x=KD(_)+KD(c.Pe);return RI(_)&&RI(c.Pe)?JB(x):KB(c.serializer,x)}(n,e)}function Bee(n,e,r){return n instanceof Dg?t9(n,e):n instanceof i1?r9(n,e):r}function e9(n,e){return n instanceof lT?function(s){return RI(s)||function(d){return!!d&&"doubleValue"in d}(s)}(e)?e:{integerValue:0}:null}class aT extends gE{}class Dg extends gE{constructor(e){super(),this.elements=e}}function t9(n,e){const r=i9(e);for(const s of n.elements)r.some(c=>_u(c,s))||r.push(s);return{arrayValue:{values:r}}}class i1 extends gE{constructor(e){super(),this.elements=e}}function r9(n,e){let r=i9(e);for(const s of n.elements)r=r.filter(c=>!_u(c,s));return{arrayValue:{values:r}}}class lT extends gE{constructor(e,r){super(),this.serializer=e,this.Pe=r}}function KD(n){return Ls(n.integerValue||n.doubleValue)}function i9(n){return ZC(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vee{constructor(e,r){this.field=e,this.transform=r}}function Uee(n,e){return n.field.isEqual(e.field)&&function(s,c){return s instanceof Dg&&c instanceof Dg||s instanceof i1&&c instanceof i1?Pg(s.elements,c.elements,_u):s instanceof lT&&c instanceof lT?_u(s.Pe,c.Pe):s instanceof aT&&c instanceof aT}(n.transform,e.transform)}class jee{constructor(e,r){this.version=e,this.transformResults=r}}class hu{constructor(e,r){this.updateTime=e,this.exists=r}static none(){return new hu}static exists(e){return new hu(void 0,e)}static updateTime(e){return new hu(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function bw(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class yE{}function n9(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new o9(n.key,hu.none()):new D1(n.key,n.data,hu.none());{const r=n.data,s=Ol.empty();let c=new So(Eo.comparator);for(let d of e.fields)if(!c.has(d)){let _=r.field(d);_===null&&d.length>1&&(d=d.popLast(),_=r.field(d)),_===null?s.delete(d):s.set(d,_),c=c.add(d)}return new _m(n.key,s,new vc(c.toArray()),hu.none())}}function $ee(n,e,r){n instanceof D1?function(c,d,_){const x=c.value.clone(),l=eL(c.fieldTransforms,d,_.transformResults);x.setAll(l),d.convertToFoundDocument(_.version,x).setHasCommittedMutations()}(n,e,r):n instanceof _m?function(c,d,_){if(!bw(c.precondition,d))return void d.convertToUnknownDocument(_.version);const x=eL(c.fieldTransforms,d,_.transformResults),l=d.data;l.setAll(s9(c)),l.setAll(x),d.convertToFoundDocument(_.version,l).setHasCommittedMutations()}(n,e,r):function(c,d,_){d.convertToNoDocument(_.version).setHasCommittedMutations()}(0,e,r)}function Tv(n,e,r,s){return n instanceof D1?function(d,_,x,l){if(!bw(d.precondition,_))return x;const S=d.value.clone(),D=tL(d.fieldTransforms,l,_);return S.setAll(D),_.convertToFoundDocument(_.version,S).setHasLocalMutations(),null}(n,e,r,s):n instanceof _m?function(d,_,x,l){if(!bw(d.precondition,_))return x;const S=tL(d.fieldTransforms,l,_),D=_.data;return D.setAll(s9(d)),D.setAll(S),_.convertToFoundDocument(_.version,D).setHasLocalMutations(),x===null?null:x.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(I=>I.field))}(n,e,r,s):function(d,_,x){return bw(d.precondition,_)?(_.convertToNoDocument(_.version).setHasLocalMutations(),null):x}(n,e,r)}function Gee(n,e){let r=null;for(const s of n.fieldTransforms){const c=e.data.field(s.field),d=e9(s.transform,c||null);d!=null&&(r===null&&(r=Ol.empty()),r.set(s.field,d))}return r||null}function JD(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(s,c){return s===void 0&&c===void 0||!(!s||!c)&&Pg(s,c,(d,_)=>Uee(d,_))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class D1 extends yE{constructor(e,r,s,c=[]){super(),this.key=e,this.value=r,this.precondition=s,this.fieldTransforms=c,this.type=0}getFieldMask(){return null}}class _m extends yE{constructor(e,r,s,c,d=[]){super(),this.key=e,this.data=r,this.fieldMask=s,this.precondition=c,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function s9(n){const e=new Map;return n.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const s=n.data.field(r);e.set(r,s)}}),e}function eL(n,e,r){const s=new Map;qn(n.length===r.length);for(let c=0;c<r.length;c++){const d=n[c],_=d.transform,x=e.data.field(d.field);s.set(d.field,Bee(_,x,r[c]))}return s}function tL(n,e,r){const s=new Map;for(const c of n){const d=c.transform,_=r.data.field(c.field);s.set(c.field,Nee(d,_,e))}return s}class o9 extends yE{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class qee extends yE{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hee{constructor(e,r,s,c){this.batchId=e,this.localWriteTime=r,this.baseMutations=s,this.mutations=c}applyToRemoteDocument(e,r){const s=r.mutationResults;for(let c=0;c<this.mutations.length;c++){const d=this.mutations[c];d.key.isEqual(e.key)&&$ee(d,e,s[c])}}applyToLocalView(e,r){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(r=Tv(s,e,r,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(r=Tv(s,e,r,this.localWriteTime));return r}applyToLocalDocumentSet(e,r){const s=QB();return this.mutations.forEach(c=>{const d=e.get(c.key),_=d.overlayedDocument;let x=this.applyToLocalView(_,d.mutatedFields);x=r.has(c.key)?null:x;const l=n9(_,x);l!==null&&s.set(c.key,l),_.isValidDocument()||_.convertToNoDocument(Oi.min())}),s}keys(){return this.mutations.reduce((e,r)=>e.add(r.key),en())}isEqual(e){return this.batchId===e.batchId&&Pg(this.mutations,e.mutations,(r,s)=>JD(r,s))&&Pg(this.baseMutations,e.baseMutations,(r,s)=>JD(r,s))}}class QC{constructor(e,r,s,c){this.batch=e,this.commitVersion=r,this.mutationResults=s,this.docVersions=c}static from(e,r,s){qn(e.mutations.length===s.length);let c=function(){return Dee}();const d=e.mutations;for(let _=0;_<d.length;_++)c=c.insert(d[_].key,s[_].version);return new QC(e,r,s,c)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wee{constructor(e,r){this.largestBatchId=e,this.mutation=r}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zee{constructor(e,r){this.count=e,this.unchangedNames=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ks,un;function Xee(n){switch(n){default:return Ci();case tr.CANCELLED:case tr.UNKNOWN:case tr.DEADLINE_EXCEEDED:case tr.RESOURCE_EXHAUSTED:case tr.INTERNAL:case tr.UNAVAILABLE:case tr.UNAUTHENTICATED:return!1;case tr.INVALID_ARGUMENT:case tr.NOT_FOUND:case tr.ALREADY_EXISTS:case tr.PERMISSION_DENIED:case tr.FAILED_PRECONDITION:case tr.ABORTED:case tr.OUT_OF_RANGE:case tr.UNIMPLEMENTED:case tr.DATA_LOSS:return!0}}function a9(n){if(n===void 0)return _h("GRPC error has no .code"),tr.UNKNOWN;switch(n){case ks.OK:return tr.OK;case ks.CANCELLED:return tr.CANCELLED;case ks.UNKNOWN:return tr.UNKNOWN;case ks.DEADLINE_EXCEEDED:return tr.DEADLINE_EXCEEDED;case ks.RESOURCE_EXHAUSTED:return tr.RESOURCE_EXHAUSTED;case ks.INTERNAL:return tr.INTERNAL;case ks.UNAVAILABLE:return tr.UNAVAILABLE;case ks.UNAUTHENTICATED:return tr.UNAUTHENTICATED;case ks.INVALID_ARGUMENT:return tr.INVALID_ARGUMENT;case ks.NOT_FOUND:return tr.NOT_FOUND;case ks.ALREADY_EXISTS:return tr.ALREADY_EXISTS;case ks.PERMISSION_DENIED:return tr.PERMISSION_DENIED;case ks.FAILED_PRECONDITION:return tr.FAILED_PRECONDITION;case ks.ABORTED:return tr.ABORTED;case ks.OUT_OF_RANGE:return tr.OUT_OF_RANGE;case ks.UNIMPLEMENTED:return tr.UNIMPLEMENTED;case ks.DATA_LOSS:return tr.DATA_LOSS;default:return Ci()}}(un=ks||(ks={}))[un.OK=0]="OK",un[un.CANCELLED=1]="CANCELLED",un[un.UNKNOWN=2]="UNKNOWN",un[un.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",un[un.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",un[un.NOT_FOUND=5]="NOT_FOUND",un[un.ALREADY_EXISTS=6]="ALREADY_EXISTS",un[un.PERMISSION_DENIED=7]="PERMISSION_DENIED",un[un.UNAUTHENTICATED=16]="UNAUTHENTICATED",un[un.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",un[un.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",un[un.ABORTED=10]="ABORTED",un[un.OUT_OF_RANGE=11]="OUT_OF_RANGE",un[un.UNIMPLEMENTED=12]="UNIMPLEMENTED",un[un.INTERNAL=13]="INTERNAL",un[un.UNAVAILABLE=14]="UNAVAILABLE",un[un.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yee(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qee=new zp([4294967295,4294967295],0);function rL(n){const e=Yee().encode(n),r=new RB;return r.update(e),new Uint8Array(r.digest())}function iL(n){const e=new DataView(n.buffer),r=e.getUint32(0,!0),s=e.getUint32(4,!0),c=e.getUint32(8,!0),d=e.getUint32(12,!0);return[new zp([r,s],0),new zp([c,d],0)]}class KC{constructor(e,r,s){if(this.bitmap=e,this.padding=r,this.hashCount=s,r<0||r>=8)throw new Ky(`Invalid padding: ${r}`);if(s<0)throw new Ky(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new Ky(`Invalid hash count: ${s}`);if(e.length===0&&r!==0)throw new Ky(`Invalid padding when bitmap length is 0: ${r}`);this.Ie=8*e.length-r,this.Te=zp.fromNumber(this.Ie)}Ee(e,r,s){let c=e.add(r.multiply(zp.fromNumber(s)));return c.compare(Qee)===1&&(c=new zp([c.getBits(0),c.getBits(1)],0)),c.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const r=rL(e),[s,c]=iL(r);for(let d=0;d<this.hashCount;d++){const _=this.Ee(s,c,d);if(!this.de(_))return!1}return!0}static create(e,r,s){const c=e%8==0?0:8-e%8,d=new Uint8Array(Math.ceil(e/8)),_=new KC(d,c,r);return s.forEach(x=>_.insert(x)),_}insert(e){if(this.Ie===0)return;const r=rL(e),[s,c]=iL(r);for(let d=0;d<this.hashCount;d++){const _=this.Ee(s,c,d);this.Ae(_)}}Ae(e){const r=Math.floor(e/8),s=e%8;this.bitmap[r]|=1<<s}}class Ky extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vE{constructor(e,r,s,c,d){this.snapshotVersion=e,this.targetChanges=r,this.targetMismatches=s,this.documentUpdates=c,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(e,r,s){const c=new Map;return c.set(e,L1.createSynthesizedTargetChangeForCurrentChange(e,r,s)),new vE(Oi.min(),c,new us(wn),gh(),en())}}class L1{constructor(e,r,s,c,d){this.resumeToken=e,this.current=r,this.addedDocuments=s,this.modifiedDocuments=c,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(e,r,s){return new L1(s,r,en(),en(),en())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ww{constructor(e,r,s,c){this.Re=e,this.removedTargetIds=r,this.key=s,this.Ve=c}}class l9{constructor(e,r){this.targetId=e,this.me=r}}class c9{constructor(e,r,s=Jo.EMPTY_BYTE_STRING,c=null){this.state=e,this.targetIds=r,this.resumeToken=s,this.cause=c}}class nL{constructor(){this.fe=0,this.ge=oL(),this.pe=Jo.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=en(),r=en(),s=en();return this.ge.forEach((c,d)=>{switch(d){case 0:e=e.add(c);break;case 2:r=r.add(c);break;case 1:s=s.add(c);break;default:Ci()}}),new L1(this.pe,this.ye,e,r,s)}ve(){this.we=!1,this.ge=oL()}Fe(e,r){this.we=!0,this.ge=this.ge.insert(e,r)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,qn(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Kee{constructor(e){this.Le=e,this.Be=new Map,this.ke=gh(),this.qe=sL(),this.Qe=new us(wn)}Ke(e){for(const r of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(r,e.Ve):this.Ue(r,e.key,e.Ve);for(const r of e.removedTargetIds)this.Ue(r,e.key,e.Ve)}We(e){this.forEachTarget(e,r=>{const s=this.Ge(r);switch(e.state){case 0:this.ze(r)&&s.De(e.resumeToken);break;case 1:s.Oe(),s.Se||s.ve(),s.De(e.resumeToken);break;case 2:s.Oe(),s.Se||this.removeTarget(r);break;case 3:this.ze(r)&&(s.Ne(),s.De(e.resumeToken));break;case 4:this.ze(r)&&(this.je(r),s.De(e.resumeToken));break;default:Ci()}})}forEachTarget(e,r){e.targetIds.length>0?e.targetIds.forEach(r):this.Be.forEach((s,c)=>{this.ze(c)&&r(c)})}He(e){const r=e.targetId,s=e.me.count,c=this.Je(r);if(c){const d=c.target;if(MI(d))if(s===0){const _=new ci(d.path);this.Ue(r,_,Ho.newNoDocument(_,Oi.min()))}else qn(s===1);else{const _=this.Ye(r);if(_!==s){const x=this.Ze(e),l=x?this.Xe(x,e,_):1;if(l!==0){this.je(r);const S=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(r,S)}}}}}Ze(e){const r=e.me.unchangedNames;if(!r||!r.bits)return null;const{bits:{bitmap:s="",padding:c=0},hashCount:d=0}=r;let _,x;try{_=em(s).toUint8Array()}catch(l){if(l instanceof BB)return Rg("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{x=new KC(_,c,d)}catch(l){return Rg(l instanceof Ky?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return x.Ie===0?null:x}Xe(e,r,s){return r.me.count===s-this.nt(e,r.targetId)?0:2}nt(e,r){const s=this.Le.getRemoteKeysForTarget(r);let c=0;return s.forEach(d=>{const _=this.Le.tt(),x=`projects/${_.projectId}/databases/${_.database}/documents/${d.path.canonicalString()}`;e.mightContain(x)||(this.Ue(r,d,null),c++)}),c}rt(e){const r=new Map;this.Be.forEach((d,_)=>{const x=this.Je(_);if(x){if(d.current&&MI(x.target)){const l=new ci(x.target.path);this.ke.get(l)!==null||this.it(_,l)||this.Ue(_,l,Ho.newNoDocument(l,e))}d.be&&(r.set(_,d.Ce()),d.ve())}});let s=en();this.qe.forEach((d,_)=>{let x=!0;_.forEachWhile(l=>{const S=this.Je(l);return!S||S.purpose==="TargetPurposeLimboResolution"||(x=!1,!1)}),x&&(s=s.add(d))}),this.ke.forEach((d,_)=>_.setReadTime(e));const c=new vE(e,r,this.Qe,this.ke,s);return this.ke=gh(),this.qe=sL(),this.Qe=new us(wn),c}$e(e,r){if(!this.ze(e))return;const s=this.it(e,r.key)?2:0;this.Ge(e).Fe(r.key,s),this.ke=this.ke.insert(r.key,r),this.qe=this.qe.insert(r.key,this.st(r.key).add(e))}Ue(e,r,s){if(!this.ze(e))return;const c=this.Ge(e);this.it(e,r)?c.Fe(r,1):c.Me(r),this.qe=this.qe.insert(r,this.st(r).delete(e)),s&&(this.ke=this.ke.insert(r,s))}removeTarget(e){this.Be.delete(e)}Ye(e){const r=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let r=this.Be.get(e);return r||(r=new nL,this.Be.set(e,r)),r}st(e){let r=this.qe.get(e);return r||(r=new So(wn),this.qe=this.qe.insert(e,r)),r}ze(e){const r=this.Je(e)!==null;return r||Nr("WatchChangeAggregator","Detected inactive target",e),r}Je(e){const r=this.Be.get(e);return r&&r.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new nL),this.Le.getRemoteKeysForTarget(e).forEach(r=>{this.Ue(e,r,null)})}it(e,r){return this.Le.getRemoteKeysForTarget(e).has(r)}}function sL(){return new us(ci.comparator)}function oL(){return new us(ci.comparator)}const Jee={asc:"ASCENDING",desc:"DESCENDING"},ete={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},tte={and:"AND",or:"OR"};class rte{constructor(e,r){this.databaseId=e,this.useProto3Json=r}}function DI(n,e){return n.useProto3Json||dE(e)?e:{value:e}}function cT(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function u9(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function ite(n,e){return cT(n,e.toTimestamp())}function du(n){return qn(!!n),Oi.fromTimestamp(function(r){const s=Kd(r);return new zs(s.seconds,s.nanos)}(n))}function JC(n,e){return LI(n,e).canonicalString()}function LI(n,e){const r=function(c){return new ts(["projects",c.projectId,"databases",c.database])}(n).child("documents");return e===void 0?r:r.child(e)}function h9(n){const e=ts.fromString(n);return qn(_9(e)),e}function OI(n,e){return JC(n.databaseId,e.path)}function sA(n,e){const r=h9(e);if(r.get(1)!==n.databaseId.projectId)throw new Jr(tr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+n.databaseId.projectId);if(r.get(3)!==n.databaseId.database)throw new Jr(tr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+n.databaseId.database);return new ci(f9(r))}function d9(n,e){return JC(n.databaseId,e)}function nte(n){const e=h9(n);return e.length===4?ts.emptyPath():f9(e)}function zI(n){return new ts(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function f9(n){return qn(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function aL(n,e,r){return{name:OI(n,e),fields:r.value.mapValue.fields}}function ste(n,e){let r;if("targetChange"in e){e.targetChange;const s=function(S){return S==="NO_CHANGE"?0:S==="ADD"?1:S==="REMOVE"?2:S==="CURRENT"?3:S==="RESET"?4:Ci()}(e.targetChange.targetChangeType||"NO_CHANGE"),c=e.targetChange.targetIds||[],d=function(S,D){return S.useProto3Json?(qn(D===void 0||typeof D=="string"),Jo.fromBase64String(D||"")):(qn(D===void 0||D instanceof Buffer||D instanceof Uint8Array),Jo.fromUint8Array(D||new Uint8Array))}(n,e.targetChange.resumeToken),_=e.targetChange.cause,x=_&&function(S){const D=S.code===void 0?tr.UNKNOWN:a9(S.code);return new Jr(D,S.message||"")}(_);r=new c9(s,c,d,x||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const c=sA(n,s.document.name),d=du(s.document.updateTime),_=s.document.createTime?du(s.document.createTime):Oi.min(),x=new Ol({mapValue:{fields:s.document.fields}}),l=Ho.newFoundDocument(c,d,_,x),S=s.targetIds||[],D=s.removedTargetIds||[];r=new ww(S,D,l.key,l)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const c=sA(n,s.document),d=s.readTime?du(s.readTime):Oi.min(),_=Ho.newNoDocument(c,d),x=s.removedTargetIds||[];r=new ww([],x,_.key,_)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const c=sA(n,s.document),d=s.removedTargetIds||[];r=new ww([],d,c,null)}else{if(!("filter"in e))return Ci();{e.filter;const s=e.filter;s.targetId;const{count:c=0,unchangedNames:d}=s,_=new Zee(c,d),x=s.targetId;r=new l9(x,_)}}return r}function ote(n,e){let r;if(e instanceof D1)r={update:aL(n,e.key,e.value)};else if(e instanceof o9)r={delete:OI(n,e.key)};else if(e instanceof _m)r={update:aL(n,e.key,e.data),updateMask:mte(e.fieldMask)};else{if(!(e instanceof qee))return Ci();r={verify:OI(n,e.key)}}return e.fieldTransforms.length>0&&(r.updateTransforms=e.fieldTransforms.map(s=>function(d,_){const x=_.transform;if(x instanceof aT)return{fieldPath:_.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(x instanceof Dg)return{fieldPath:_.field.canonicalString(),appendMissingElements:{values:x.elements}};if(x instanceof i1)return{fieldPath:_.field.canonicalString(),removeAllFromArray:{values:x.elements}};if(x instanceof lT)return{fieldPath:_.field.canonicalString(),increment:x.Pe};throw Ci()}(0,s))),e.precondition.isNone||(r.currentDocument=function(c,d){return d.updateTime!==void 0?{updateTime:ite(c,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:Ci()}(n,e.precondition)),r}function ate(n,e){return n&&n.length>0?(qn(e!==void 0),n.map(r=>function(c,d){let _=c.updateTime?du(c.updateTime):du(d);return _.isEqual(Oi.min())&&(_=du(d)),new jee(_,c.transformResults||[])}(r,e))):[]}function lte(n,e){return{documents:[d9(n,e.path)]}}function cte(n,e){const r={structuredQuery:{}},s=e.path;let c;e.collectionGroup!==null?(c=s,r.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(c=s.popLast(),r.structuredQuery.from=[{collectionId:s.lastSegment()}]),r.parent=d9(n,c);const d=function(S){if(S.length!==0)return m9(gu.create(S,"and"))}(e.filters);d&&(r.structuredQuery.where=d);const _=function(S){if(S.length!==0)return S.map(D=>function(V){return{field:U_(V.field),direction:dte(V.dir)}}(D))}(e.orderBy);_&&(r.structuredQuery.orderBy=_);const x=DI(n,e.limit);return x!==null&&(r.structuredQuery.limit=x),e.startAt&&(r.structuredQuery.startAt=function(S){return{before:S.inclusive,values:S.position}}(e.startAt)),e.endAt&&(r.structuredQuery.endAt=function(S){return{before:!S.inclusive,values:S.position}}(e.endAt)),{_t:r,parent:c}}function ute(n){let e=nte(n.parent);const r=n.structuredQuery,s=r.from?r.from.length:0;let c=null;if(s>0){qn(s===1);const D=r.from[0];D.allDescendants?c=D.collectionId:e=e.child(D.collectionId)}let d=[];r.where&&(d=function(I){const V=p9(I);return V instanceof gu&&$B(V)?V.getFilters():[V]}(r.where));let _=[];r.orderBy&&(_=function(I){return I.map(V=>function(Q){return new oT(j_(Q.field),function(ce){switch(ce){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Q.direction))}(V))}(r.orderBy));let x=null;r.limit&&(x=function(I){let V;return V=typeof I=="object"?I.value:I,dE(V)?null:V}(r.limit));let l=null;r.startAt&&(l=function(I){const V=!!I.before,j=I.values||[];return new sT(j,V)}(r.startAt));let S=null;return r.endAt&&(S=function(I){const V=!I.before,j=I.values||[];return new sT(j,V)}(r.endAt)),See(e,c,_,d,x,"F",l,S)}function hte(n,e){const r=function(c){switch(c){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ci()}}(e.purpose);return r==null?null:{"goog-listen-tags":r}}function p9(n){return n.unaryFilter!==void 0?function(r){switch(r.unaryFilter.op){case"IS_NAN":const s=j_(r.unaryFilter.field);return Xs.create(s,"==",{doubleValue:NaN});case"IS_NULL":const c=j_(r.unaryFilter.field);return Xs.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=j_(r.unaryFilter.field);return Xs.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const _=j_(r.unaryFilter.field);return Xs.create(_,"!=",{nullValue:"NULL_VALUE"});default:return Ci()}}(n):n.fieldFilter!==void 0?function(r){return Xs.create(j_(r.fieldFilter.field),function(c){switch(c){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ci()}}(r.fieldFilter.op),r.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(r){return gu.create(r.compositeFilter.filters.map(s=>p9(s)),function(c){switch(c){case"AND":return"and";case"OR":return"or";default:return Ci()}}(r.compositeFilter.op))}(n):Ci()}function dte(n){return Jee[n]}function fte(n){return ete[n]}function pte(n){return tte[n]}function U_(n){return{fieldPath:n.canonicalString()}}function j_(n){return Eo.fromServerFormat(n.fieldPath)}function m9(n){return n instanceof Xs?function(r){if(r.op==="=="){if(WD(r.value))return{unaryFilter:{field:U_(r.field),op:"IS_NAN"}};if(HD(r.value))return{unaryFilter:{field:U_(r.field),op:"IS_NULL"}}}else if(r.op==="!="){if(WD(r.value))return{unaryFilter:{field:U_(r.field),op:"IS_NOT_NAN"}};if(HD(r.value))return{unaryFilter:{field:U_(r.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:U_(r.field),op:fte(r.op),value:r.value}}}(n):n instanceof gu?function(r){const s=r.getFilters().map(c=>m9(c));return s.length===1?s[0]:{compositeFilter:{op:pte(r.op),filters:s}}}(n):Ci()}function mte(n){const e=[];return n.fields.forEach(r=>e.push(r.canonicalString())),{fieldPaths:e}}function _9(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Md{constructor(e,r,s,c,d=Oi.min(),_=Oi.min(),x=Jo.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=r,this.purpose=s,this.sequenceNumber=c,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=_,this.resumeToken=x,this.expectedCount=l}withSequenceNumber(e){return new Md(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,r){return new Md(this.target,this.targetId,this.purpose,this.sequenceNumber,r,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Md(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Md(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _te{constructor(e){this.ct=e}}function gte(n){const e=ute({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?kI(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yte{constructor(){this._n=new vte}addToCollectionParentIndex(e,r){return this._n.add(r),rr.resolve()}getCollectionParents(e,r){return rr.resolve(this._n.getEntries(r))}addFieldIndex(e,r){return rr.resolve()}deleteFieldIndex(e,r){return rr.resolve()}deleteAllFieldIndexes(e){return rr.resolve()}createTargetIndexes(e,r){return rr.resolve()}getDocumentsMatchingTarget(e,r){return rr.resolve(null)}getIndexType(e,r){return rr.resolve(0)}getFieldIndexes(e,r){return rr.resolve([])}getNextCollectionGroupToUpdate(e){return rr.resolve(null)}getMinOffset(e,r){return rr.resolve(Qd.min())}getMinOffsetFromCollectionGroup(e,r){return rr.resolve(Qd.min())}updateCollectionGroup(e,r,s){return rr.resolve()}updateIndexEntries(e,r){return rr.resolve()}}class vte{constructor(){this.index={}}add(e){const r=e.lastSegment(),s=e.popLast(),c=this.index[r]||new So(ts.comparator),d=!c.has(s);return this.index[r]=c.add(s),d}has(e){const r=e.lastSegment(),s=e.popLast(),c=this.index[r];return c&&c.has(s)}getEntries(e){return(this.index[e]||new So(ts.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lg{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new Lg(0)}static Ln(){return new Lg(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xte{constructor(){this.changes=new i0(e=>e.toString(),(e,r)=>e.isEqual(r)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,r){this.assertNotApplied(),this.changes.set(e,Ho.newInvalidDocument(e).setReadTime(r))}getEntry(e,r){this.assertNotApplied();const s=this.changes.get(r);return s!==void 0?rr.resolve(s):this.getFromCache(e,r)}getEntries(e,r){return this.getAllFromCache(e,r)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bte{constructor(e,r){this.overlayedDocument=e,this.mutatedFields=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wte{constructor(e,r,s,c){this.remoteDocumentCache=e,this.mutationQueue=r,this.documentOverlayCache=s,this.indexManager=c}getDocument(e,r){let s=null;return this.documentOverlayCache.getOverlay(e,r).next(c=>(s=c,this.remoteDocumentCache.getEntry(e,r))).next(c=>(s!==null&&Tv(s.mutation,c,vc.empty(),zs.now()),c))}getDocuments(e,r){return this.remoteDocumentCache.getEntries(e,r).next(s=>this.getLocalViewOfDocuments(e,s,en()).next(()=>s))}getLocalViewOfDocuments(e,r,s=en()){const c=Rp();return this.populateOverlays(e,c,r).next(()=>this.computeViews(e,r,c,s).next(d=>{let _=Qy();return d.forEach((x,l)=>{_=_.insert(x,l.overlayedDocument)}),_}))}getOverlayedDocuments(e,r){const s=Rp();return this.populateOverlays(e,s,r).next(()=>this.computeViews(e,r,s,en()))}populateOverlays(e,r,s){const c=[];return s.forEach(d=>{r.has(d)||c.push(d)}),this.documentOverlayCache.getOverlays(e,c).next(d=>{d.forEach((_,x)=>{r.set(_,x)})})}computeViews(e,r,s,c){let d=gh();const _=wv(),x=function(){return wv()}();return r.forEach((l,S)=>{const D=s.get(S.key);c.has(S.key)&&(D===void 0||D.mutation instanceof _m)?d=d.insert(S.key,S):D!==void 0?(_.set(S.key,D.mutation.getFieldMask()),Tv(D.mutation,S,D.mutation.getFieldMask(),zs.now())):_.set(S.key,vc.empty())}),this.recalculateAndSaveOverlays(e,d).next(l=>(l.forEach((S,D)=>_.set(S,D)),r.forEach((S,D)=>{var I;return x.set(S,new bte(D,(I=_.get(S))!==null&&I!==void 0?I:null))}),x))}recalculateAndSaveOverlays(e,r){const s=wv();let c=new us((_,x)=>_-x),d=en();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,r).next(_=>{for(const x of _)x.keys().forEach(l=>{const S=r.get(l);if(S===null)return;let D=s.get(l)||vc.empty();D=x.applyToLocalView(S,D),s.set(l,D);const I=(c.get(x.batchId)||en()).add(l);c=c.insert(x.batchId,I)})}).next(()=>{const _=[],x=c.getReverseIterator();for(;x.hasNext();){const l=x.getNext(),S=l.key,D=l.value,I=QB();D.forEach(V=>{if(!d.has(V)){const j=n9(r.get(V),s.get(V));j!==null&&I.set(V,j),d=d.add(V)}}),_.push(this.documentOverlayCache.saveOverlays(e,S,I))}return rr.waitFor(_)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,r){return this.remoteDocumentCache.getEntries(e,r).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,r,s,c){return function(_){return ci.isDocumentKey(_.path)&&_.collectionGroup===null&&_.filters.length===0}(r)?this.getDocumentsMatchingDocumentQuery(e,r.path):Cee(r)?this.getDocumentsMatchingCollectionGroupQuery(e,r,s,c):this.getDocumentsMatchingCollectionQuery(e,r,s,c)}getNextDocuments(e,r,s,c){return this.remoteDocumentCache.getAllFromCollectionGroup(e,r,s,c).next(d=>{const _=c-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,r,s.largestBatchId,c-d.size):rr.resolve(Rp());let x=-1,l=d;return _.next(S=>rr.forEach(S,(D,I)=>(x<I.largestBatchId&&(x=I.largestBatchId),d.get(D)?rr.resolve():this.remoteDocumentCache.getEntry(e,D).next(V=>{l=l.insert(D,V)}))).next(()=>this.populateOverlays(e,S,d)).next(()=>this.computeViews(e,l,S,en())).next(D=>({batchId:x,changes:YB(D)})))})}getDocumentsMatchingDocumentQuery(e,r){return this.getDocument(e,new ci(r)).next(s=>{let c=Qy();return s.isFoundDocument()&&(c=c.insert(s.key,s)),c})}getDocumentsMatchingCollectionGroupQuery(e,r,s,c){const d=r.collectionGroup;let _=Qy();return this.indexManager.getCollectionParents(e,d).next(x=>rr.forEach(x,l=>{const S=function(I,V){return new fE(V,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(r,l.child(d));return this.getDocumentsMatchingCollectionQuery(e,S,s,c).next(D=>{D.forEach((I,V)=>{_=_.insert(I,V)})})}).next(()=>_))}getDocumentsMatchingCollectionQuery(e,r,s,c){let d;return this.documentOverlayCache.getOverlaysForCollection(e,r.path,s.largestBatchId).next(_=>(d=_,this.remoteDocumentCache.getDocumentsMatchingQuery(e,r,s,d,c))).next(_=>{d.forEach((l,S)=>{const D=S.getKey();_.get(D)===null&&(_=_.insert(D,Ho.newInvalidDocument(D)))});let x=Qy();return _.forEach((l,S)=>{const D=d.get(l);D!==void 0&&Tv(D.mutation,S,vc.empty(),zs.now()),_E(r,S)&&(x=x.insert(l,S))}),x})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tte{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,r){return rr.resolve(this.cr.get(r))}saveBundleMetadata(e,r){return this.cr.set(r.id,function(c){return{id:c.id,version:c.version,createTime:du(c.createTime)}}(r)),rr.resolve()}getNamedQuery(e,r){return rr.resolve(this.lr.get(r))}saveNamedQuery(e,r){return this.lr.set(r.name,function(c){return{name:c.name,query:gte(c.bundledQuery),readTime:du(c.readTime)}}(r)),rr.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ete{constructor(){this.overlays=new us(ci.comparator),this.hr=new Map}getOverlay(e,r){return rr.resolve(this.overlays.get(r))}getOverlays(e,r){const s=Rp();return rr.forEach(r,c=>this.getOverlay(e,c).next(d=>{d!==null&&s.set(c,d)})).next(()=>s)}saveOverlays(e,r,s){return s.forEach((c,d)=>{this.ht(e,r,d)}),rr.resolve()}removeOverlaysForBatchId(e,r,s){const c=this.hr.get(s);return c!==void 0&&(c.forEach(d=>this.overlays=this.overlays.remove(d)),this.hr.delete(s)),rr.resolve()}getOverlaysForCollection(e,r,s){const c=Rp(),d=r.length+1,_=new ci(r.child("")),x=this.overlays.getIteratorFrom(_);for(;x.hasNext();){const l=x.getNext().value,S=l.getKey();if(!r.isPrefixOf(S.path))break;S.path.length===d&&l.largestBatchId>s&&c.set(l.getKey(),l)}return rr.resolve(c)}getOverlaysForCollectionGroup(e,r,s,c){let d=new us((S,D)=>S-D);const _=this.overlays.getIterator();for(;_.hasNext();){const S=_.getNext().value;if(S.getKey().getCollectionGroup()===r&&S.largestBatchId>s){let D=d.get(S.largestBatchId);D===null&&(D=Rp(),d=d.insert(S.largestBatchId,D)),D.set(S.getKey(),S)}}const x=Rp(),l=d.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((S,D)=>x.set(S,D)),!(x.size()>=c)););return rr.resolve(x)}ht(e,r,s){const c=this.overlays.get(s.key);if(c!==null){const _=this.hr.get(c.largestBatchId).delete(s.key);this.hr.set(c.largestBatchId,_)}this.overlays=this.overlays.insert(s.key,new Wee(r,s));let d=this.hr.get(r);d===void 0&&(d=en(),this.hr.set(r,d)),this.hr.set(r,d.add(s.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eR{constructor(){this.Pr=new So(lo.Ir),this.Tr=new So(lo.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,r){const s=new lo(e,r);this.Pr=this.Pr.add(s),this.Tr=this.Tr.add(s)}dr(e,r){e.forEach(s=>this.addReference(s,r))}removeReference(e,r){this.Ar(new lo(e,r))}Rr(e,r){e.forEach(s=>this.removeReference(s,r))}Vr(e){const r=new ci(new ts([])),s=new lo(r,e),c=new lo(r,e+1),d=[];return this.Tr.forEachInRange([s,c],_=>{this.Ar(_),d.push(_.key)}),d}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const r=new ci(new ts([])),s=new lo(r,e),c=new lo(r,e+1);let d=en();return this.Tr.forEachInRange([s,c],_=>{d=d.add(_.key)}),d}containsKey(e){const r=new lo(e,0),s=this.Pr.firstAfterOrEqual(r);return s!==null&&e.isEqual(s.key)}}class lo{constructor(e,r){this.key=e,this.pr=r}static Ir(e,r){return ci.comparator(e.key,r.key)||wn(e.pr,r.pr)}static Er(e,r){return wn(e.pr,r.pr)||ci.comparator(e.key,r.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ate{constructor(e,r){this.indexManager=e,this.referenceDelegate=r,this.mutationQueue=[],this.yr=1,this.wr=new So(lo.Ir)}checkEmpty(e){return rr.resolve(this.mutationQueue.length===0)}addMutationBatch(e,r,s,c){const d=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const _=new Hee(d,r,s,c);this.mutationQueue.push(_);for(const x of c)this.wr=this.wr.add(new lo(x.key,d)),this.indexManager.addToCollectionParentIndex(e,x.key.path.popLast());return rr.resolve(_)}lookupMutationBatch(e,r){return rr.resolve(this.Sr(r))}getNextMutationBatchAfterBatchId(e,r){const s=r+1,c=this.br(s),d=c<0?0:c;return rr.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return rr.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(e){return rr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,r){const s=new lo(r,0),c=new lo(r,Number.POSITIVE_INFINITY),d=[];return this.wr.forEachInRange([s,c],_=>{const x=this.Sr(_.pr);d.push(x)}),rr.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(e,r){let s=new So(wn);return r.forEach(c=>{const d=new lo(c,0),_=new lo(c,Number.POSITIVE_INFINITY);this.wr.forEachInRange([d,_],x=>{s=s.add(x.pr)})}),rr.resolve(this.Dr(s))}getAllMutationBatchesAffectingQuery(e,r){const s=r.path,c=s.length+1;let d=s;ci.isDocumentKey(d)||(d=d.child(""));const _=new lo(new ci(d),0);let x=new So(wn);return this.wr.forEachWhile(l=>{const S=l.key.path;return!!s.isPrefixOf(S)&&(S.length===c&&(x=x.add(l.pr)),!0)},_),rr.resolve(this.Dr(x))}Dr(e){const r=[];return e.forEach(s=>{const c=this.Sr(s);c!==null&&r.push(c)}),r}removeMutationBatch(e,r){qn(this.Cr(r.batchId,"removed")===0),this.mutationQueue.shift();let s=this.wr;return rr.forEach(r.mutations,c=>{const d=new lo(c.key,r.batchId);return s=s.delete(d),this.referenceDelegate.markPotentiallyOrphaned(e,c.key)}).next(()=>{this.wr=s})}Mn(e){}containsKey(e,r){const s=new lo(r,0),c=this.wr.firstAfterOrEqual(s);return rr.resolve(r.isEqual(c&&c.key))}performConsistencyCheck(e){return this.mutationQueue.length,rr.resolve()}Cr(e,r){return this.br(e)}br(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Sr(e){const r=this.br(e);return r<0||r>=this.mutationQueue.length?null:this.mutationQueue[r]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ite{constructor(e){this.vr=e,this.docs=function(){return new us(ci.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,r){const s=r.key,c=this.docs.get(s),d=c?c.size:0,_=this.vr(r);return this.docs=this.docs.insert(s,{document:r.mutableCopy(),size:_}),this.size+=_-d,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const r=this.docs.get(e);r&&(this.docs=this.docs.remove(e),this.size-=r.size)}getEntry(e,r){const s=this.docs.get(r);return rr.resolve(s?s.document.mutableCopy():Ho.newInvalidDocument(r))}getEntries(e,r){let s=gh();return r.forEach(c=>{const d=this.docs.get(c);s=s.insert(c,d?d.document.mutableCopy():Ho.newInvalidDocument(c))}),rr.resolve(s)}getDocumentsMatchingQuery(e,r,s,c){let d=gh();const _=r.path,x=new ci(_.child("")),l=this.docs.getIteratorFrom(x);for(;l.hasNext();){const{key:S,value:{document:D}}=l.getNext();if(!_.isPrefixOf(S.path))break;S.path.length>_.length+1||cee(lee(D),s)<=0||(c.has(D.key)||_E(r,D))&&(d=d.insert(D.key,D.mutableCopy()))}return rr.resolve(d)}getAllFromCollectionGroup(e,r,s,c){Ci()}Fr(e,r){return rr.forEach(this.docs,s=>r(s))}newChangeBuffer(e){return new Ste(this)}getSize(e){return rr.resolve(this.size)}}class Ste extends xte{constructor(e){super(),this.ar=e}applyChanges(e){const r=[];return this.changes.forEach((s,c)=>{c.isValidDocument()?r.push(this.ar.addEntry(e,c)):this.ar.removeEntry(s)}),rr.waitFor(r)}getFromCache(e,r){return this.ar.getEntry(e,r)}getAllFromCache(e,r){return this.ar.getEntries(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cte{constructor(e){this.persistence=e,this.Mr=new i0(r=>XC(r),YC),this.lastRemoteSnapshotVersion=Oi.min(),this.highestTargetId=0,this.Or=0,this.Nr=new eR,this.targetCount=0,this.Lr=Lg.Nn()}forEachTarget(e,r){return this.Mr.forEach((s,c)=>r(c)),rr.resolve()}getLastRemoteSnapshotVersion(e){return rr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return rr.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),rr.resolve(this.highestTargetId)}setTargetsMetadata(e,r,s){return s&&(this.lastRemoteSnapshotVersion=s),r>this.Or&&(this.Or=r),rr.resolve()}qn(e){this.Mr.set(e.target,e);const r=e.targetId;r>this.highestTargetId&&(this.Lr=new Lg(r),this.highestTargetId=r),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,r){return this.qn(r),this.targetCount+=1,rr.resolve()}updateTargetData(e,r){return this.qn(r),rr.resolve()}removeTargetData(e,r){return this.Mr.delete(r.target),this.Nr.Vr(r.targetId),this.targetCount-=1,rr.resolve()}removeTargets(e,r,s){let c=0;const d=[];return this.Mr.forEach((_,x)=>{x.sequenceNumber<=r&&s.get(x.targetId)===null&&(this.Mr.delete(_),d.push(this.removeMatchingKeysForTargetId(e,x.targetId)),c++)}),rr.waitFor(d).next(()=>c)}getTargetCount(e){return rr.resolve(this.targetCount)}getTargetData(e,r){const s=this.Mr.get(r)||null;return rr.resolve(s)}addMatchingKeys(e,r,s){return this.Nr.dr(r,s),rr.resolve()}removeMatchingKeys(e,r,s){this.Nr.Rr(r,s);const c=this.persistence.referenceDelegate,d=[];return c&&r.forEach(_=>{d.push(c.markPotentiallyOrphaned(e,_))}),rr.waitFor(d)}removeMatchingKeysForTargetId(e,r){return this.Nr.Vr(r),rr.resolve()}getMatchingKeysForTargetId(e,r){const s=this.Nr.gr(r);return rr.resolve(s)}containsKey(e,r){return rr.resolve(this.Nr.containsKey(r))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rte{constructor(e,r){this.Br={},this.overlays={},this.kr=new qC(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Cte(this),this.indexManager=new yte,this.remoteDocumentCache=function(c){return new Ite(c)}(s=>this.referenceDelegate.Kr(s)),this.serializer=new _te(r),this.$r=new Tte(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let r=this.overlays[e.toKey()];return r||(r=new Ete,this.overlays[e.toKey()]=r),r}getMutationQueue(e,r){let s=this.Br[e.toKey()];return s||(s=new Ate(r,this.referenceDelegate),this.Br[e.toKey()]=s),s}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,r,s){Nr("MemoryPersistence","Starting transaction:",e);const c=new Pte(this.kr.next());return this.referenceDelegate.Ur(),s(c).next(d=>this.referenceDelegate.Wr(c).next(()=>d)).toPromise().then(d=>(c.raiseOnCommittedEvent(),d))}Gr(e,r){return rr.or(Object.values(this.Br).map(s=>()=>s.containsKey(e,r)))}}class Pte extends hee{constructor(e){super(),this.currentSequenceNumber=e}}class tR{constructor(e){this.persistence=e,this.zr=new eR,this.jr=null}static Hr(e){return new tR(e)}get Jr(){if(this.jr)return this.jr;throw Ci()}addReference(e,r,s){return this.zr.addReference(s,r),this.Jr.delete(s.toString()),rr.resolve()}removeReference(e,r,s){return this.zr.removeReference(s,r),this.Jr.add(s.toString()),rr.resolve()}markPotentiallyOrphaned(e,r){return this.Jr.add(r.toString()),rr.resolve()}removeTarget(e,r){this.zr.Vr(r.targetId).forEach(c=>this.Jr.add(c.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,r.targetId).next(c=>{c.forEach(d=>this.Jr.add(d.toString()))}).next(()=>s.removeTargetData(e,r))}Ur(){this.jr=new Set}Wr(e){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return rr.forEach(this.Jr,s=>{const c=ci.fromPath(s);return this.Yr(e,c).next(d=>{d||r.removeEntry(c,Oi.min())})}).next(()=>(this.jr=null,r.apply(e)))}updateLimboDocument(e,r){return this.Yr(e,r).next(s=>{s?this.Jr.delete(r.toString()):this.Jr.add(r.toString())})}Kr(e){return 0}Yr(e,r){return rr.or([()=>rr.resolve(this.zr.containsKey(r)),()=>this.persistence.getTargetCache().containsKey(e,r),()=>this.persistence.Gr(e,r)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rR{constructor(e,r,s,c){this.targetId=e,this.fromCache=r,this.qi=s,this.Qi=c}static Ki(e,r){let s=en(),c=en();for(const d of r.docChanges)switch(d.type){case 0:s=s.add(d.doc.key);break;case 1:c=c.add(d.doc.key)}return new rR(e,r.fromCache,s,c)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mte{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kte{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return KH()?8:dee(Co())>0?6:4}()}initialize(e,r){this.zi=e,this.indexManager=r,this.$i=!0}getDocumentsMatchingQuery(e,r,s,c){const d={result:null};return this.ji(e,r).next(_=>{d.result=_}).next(()=>{if(!d.result)return this.Hi(e,r,c,s).next(_=>{d.result=_})}).next(()=>{if(d.result)return;const _=new Mte;return this.Ji(e,r,_).next(x=>{if(d.result=x,this.Ui)return this.Yi(e,r,_,x.size)})}).next(()=>d.result)}Yi(e,r,s,c){return s.documentReadCount<this.Wi?(zy()<=Ji.DEBUG&&Nr("QueryEngine","SDK will not create cache indexes for query:",V_(r),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),rr.resolve()):(zy()<=Ji.DEBUG&&Nr("QueryEngine","Query:",V_(r),"scans",s.documentReadCount,"local documents and returns",c,"documents as results."),s.documentReadCount>this.Gi*c?(zy()<=Ji.DEBUG&&Nr("QueryEngine","The SDK decides to create cache indexes for query:",V_(r),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,uu(r))):rr.resolve())}ji(e,r){if(QD(r))return rr.resolve(null);let s=uu(r);return this.indexManager.getIndexType(e,s).next(c=>c===0?null:(r.limit!==null&&c===1&&(r=kI(r,null,"F"),s=uu(r)),this.indexManager.getDocumentsMatchingTarget(e,s).next(d=>{const _=en(...d);return this.zi.getDocuments(e,_).next(x=>this.indexManager.getMinOffset(e,s).next(l=>{const S=this.Zi(r,x);return this.Xi(r,S,_,l.readTime)?this.ji(e,kI(r,null,"F")):this.es(e,S,r,l)}))})))}Hi(e,r,s,c){return QD(r)||c.isEqual(Oi.min())?rr.resolve(null):this.zi.getDocuments(e,s).next(d=>{const _=this.Zi(r,d);return this.Xi(r,_,s,c)?rr.resolve(null):(zy()<=Ji.DEBUG&&Nr("QueryEngine","Re-using previous result from %s to execute query: %s",c.toString(),V_(r)),this.es(e,_,r,aee(c,-1)).next(x=>x))})}Zi(e,r){let s=new So(ZB(e));return r.forEach((c,d)=>{_E(e,d)&&(s=s.add(d))}),s}Xi(e,r,s,c){if(e.limit===null)return!1;if(s.size!==r.size)return!0;const d=e.limitType==="F"?r.last():r.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(c)>0)}Ji(e,r,s){return zy()<=Ji.DEBUG&&Nr("QueryEngine","Using full collection scan to execute query:",V_(r)),this.zi.getDocumentsMatchingQuery(e,r,Qd.min(),s)}es(e,r,s,c){return this.zi.getDocumentsMatchingQuery(e,s,c).next(d=>(r.forEach(_=>{d=d.insert(_.key,_)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dte{constructor(e,r,s,c){this.persistence=e,this.ts=r,this.serializer=c,this.ns=new us(wn),this.rs=new i0(d=>XC(d),YC),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(s)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new wte(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",r=>e.collect(r,this.ns))}}function Lte(n,e,r,s){return new Dte(n,e,r,s)}async function g9(n,e){const r=zi(n);return await r.persistence.runTransaction("Handle user change","readonly",s=>{let c;return r.mutationQueue.getAllMutationBatches(s).next(d=>(c=d,r._s(e),r.mutationQueue.getAllMutationBatches(s))).next(d=>{const _=[],x=[];let l=en();for(const S of c){_.push(S.batchId);for(const D of S.mutations)l=l.add(D.key)}for(const S of d){x.push(S.batchId);for(const D of S.mutations)l=l.add(D.key)}return r.localDocuments.getDocuments(s,l).next(S=>({us:S,removedBatchIds:_,addedBatchIds:x}))})})}function Ote(n,e){const r=zi(n);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const c=e.batch.keys(),d=r.os.newChangeBuffer({trackRemovals:!0});return function(x,l,S,D){const I=S.batch,V=I.keys();let j=rr.resolve();return V.forEach(Q=>{j=j.next(()=>D.getEntry(l,Q)).next(te=>{const ce=S.docVersions.get(Q);qn(ce!==null),te.version.compareTo(ce)<0&&(I.applyToRemoteDocument(te,S),te.isValidDocument()&&(te.setReadTime(S.commitVersion),D.addEntry(te)))})}),j.next(()=>x.mutationQueue.removeMutationBatch(l,I))}(r,s,e,d).next(()=>d.apply(s)).next(()=>r.mutationQueue.performConsistencyCheck(s)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(s,c,e.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(x){let l=en();for(let S=0;S<x.mutationResults.length;++S)x.mutationResults[S].transformResults.length>0&&(l=l.add(x.batch.mutations[S].key));return l}(e))).next(()=>r.localDocuments.getDocuments(s,c))})}function y9(n){const e=zi(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",r=>e.Qr.getLastRemoteSnapshotVersion(r))}function zte(n,e){const r=zi(n),s=e.snapshotVersion;let c=r.ns;return r.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const _=r.os.newChangeBuffer({trackRemovals:!0});c=r.ns;const x=[];e.targetChanges.forEach((D,I)=>{const V=c.get(I);if(!V)return;x.push(r.Qr.removeMatchingKeys(d,D.removedDocuments,I).next(()=>r.Qr.addMatchingKeys(d,D.addedDocuments,I)));let j=V.withSequenceNumber(d.currentSequenceNumber);e.targetMismatches.get(I)!==null?j=j.withResumeToken(Jo.EMPTY_BYTE_STRING,Oi.min()).withLastLimboFreeSnapshotVersion(Oi.min()):D.resumeToken.approximateByteSize()>0&&(j=j.withResumeToken(D.resumeToken,s)),c=c.insert(I,j),function(te,ce,Ce){return te.resumeToken.approximateByteSize()===0||ce.snapshotVersion.toMicroseconds()-te.snapshotVersion.toMicroseconds()>=3e8?!0:Ce.addedDocuments.size+Ce.modifiedDocuments.size+Ce.removedDocuments.size>0}(V,j,D)&&x.push(r.Qr.updateTargetData(d,j))});let l=gh(),S=en();if(e.documentUpdates.forEach(D=>{e.resolvedLimboDocuments.has(D)&&x.push(r.persistence.referenceDelegate.updateLimboDocument(d,D))}),x.push(Fte(d,_,e.documentUpdates).next(D=>{l=D.cs,S=D.ls})),!s.isEqual(Oi.min())){const D=r.Qr.getLastRemoteSnapshotVersion(d).next(I=>r.Qr.setTargetsMetadata(d,d.currentSequenceNumber,s));x.push(D)}return rr.waitFor(x).next(()=>_.apply(d)).next(()=>r.localDocuments.getLocalViewOfDocuments(d,l,S)).next(()=>l)}).then(d=>(r.ns=c,d))}function Fte(n,e,r){let s=en(),c=en();return r.forEach(d=>s=s.add(d)),e.getEntries(n,s).next(d=>{let _=gh();return r.forEach((x,l)=>{const S=d.get(x);l.isFoundDocument()!==S.isFoundDocument()&&(c=c.add(x)),l.isNoDocument()&&l.version.isEqual(Oi.min())?(e.removeEntry(x,l.readTime),_=_.insert(x,l)):!S.isValidDocument()||l.version.compareTo(S.version)>0||l.version.compareTo(S.version)===0&&S.hasPendingWrites?(e.addEntry(l),_=_.insert(x,l)):Nr("LocalStore","Ignoring outdated watch update for ",x,". Current version:",S.version," Watch version:",l.version)}),{cs:_,ls:c}})}function Nte(n,e){const r=zi(n);return r.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=-1),r.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function Bte(n,e){const r=zi(n);return r.persistence.runTransaction("Allocate target","readwrite",s=>{let c;return r.Qr.getTargetData(s,e).next(d=>d?(c=d,rr.resolve(c)):r.Qr.allocateTargetId(s).next(_=>(c=new Md(e,_,"TargetPurposeListen",s.currentSequenceNumber),r.Qr.addTargetData(s,c).next(()=>c))))}).then(s=>{const c=r.ns.get(s.targetId);return(c===null||s.snapshotVersion.compareTo(c.snapshotVersion)>0)&&(r.ns=r.ns.insert(s.targetId,s),r.rs.set(e,s.targetId)),s})}async function FI(n,e,r){const s=zi(n),c=s.ns.get(e),d=r?"readwrite":"readwrite-primary";try{r||await s.persistence.runTransaction("Release target",d,_=>s.persistence.referenceDelegate.removeTarget(_,c))}catch(_){if(!k1(_))throw _;Nr("LocalStore",`Failed to update sequence numbers for target ${e}: ${_}`)}s.ns=s.ns.remove(e),s.rs.delete(c.target)}function lL(n,e,r){const s=zi(n);let c=Oi.min(),d=en();return s.persistence.runTransaction("Execute query","readwrite",_=>function(l,S,D){const I=zi(l),V=I.rs.get(D);return V!==void 0?rr.resolve(I.ns.get(V)):I.Qr.getTargetData(S,D)}(s,_,uu(e)).next(x=>{if(x)return c=x.lastLimboFreeSnapshotVersion,s.Qr.getMatchingKeysForTargetId(_,x.targetId).next(l=>{d=l})}).next(()=>s.ts.getDocumentsMatchingQuery(_,e,r?c:Oi.min(),r?d:en())).next(x=>(Vte(s,Pee(e),x),{documents:x,hs:d})))}function Vte(n,e,r){let s=n.ss.get(e)||Oi.min();r.forEach((c,d)=>{d.readTime.compareTo(s)>0&&(s=d.readTime)}),n.ss.set(e,s)}class cL{constructor(){this.activeTargetIds=zee()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ute{constructor(){this.no=new cL,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,r,s){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,r,s){this.ro[e]=r}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new cL,Promise.resolve()}handleUserChange(e,r,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jte{io(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uL{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){Nr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){Nr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ub=null;function oA(){return Ub===null?Ub=function(){return 268435456+Math.round(2147483648*Math.random())}():Ub++,"0x"+Ub.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $te={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gte{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}Ao(e){this.Ro=e}onMessage(e){this.Vo=e}close(){this.ho()}send(e){this.lo(e)}mo(){this.Io()}fo(){this.Eo()}po(e){this.Ro(e)}yo(e){this.Vo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vo="WebChannelConnection";class qte extends class{constructor(r){this.databaseInfo=r,this.databaseId=r.databaseId;const s=r.ssl?"https":"http",c=encodeURIComponent(this.databaseId.projectId),d=encodeURIComponent(this.databaseId.database);this.wo=s+"://"+r.host,this.So=`projects/${c}/databases/${d}`,this.bo=this.databaseId.database==="(default)"?`project_id=${c}`:`project_id=${c}&database_id=${d}`}get Do(){return!1}Co(r,s,c,d,_){const x=oA(),l=this.vo(r,s.toUriEncodedString());Nr("RestConnection",`Sending RPC '${r}' ${x}:`,l,c);const S={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(S,d,_),this.Mo(r,l,S,c).then(D=>(Nr("RestConnection",`Received RPC '${r}' ${x}: `,D),D),D=>{throw Rg("RestConnection",`RPC '${r}' ${x} failed with error: `,D,"url: ",l,"request:",c),D})}xo(r,s,c,d,_,x){return this.Co(r,s,c,d,_)}Fo(r,s,c){r["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+t0}(),r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((d,_)=>r[_]=d),c&&c.headers.forEach((d,_)=>r[_]=d)}vo(r,s){const c=$te[r];return`${this.wo}/v1/${s}:${c}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Mo(e,r,s,c){const d=oA();return new Promise((_,x)=>{const l=new PB;l.setWithCredentials(!0),l.listenOnce(kB.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case vw.NO_ERROR:const D=l.getResponseJson();Nr(Vo,`XHR for RPC '${e}' ${d} received:`,JSON.stringify(D)),_(D);break;case vw.TIMEOUT:Nr(Vo,`RPC '${e}' ${d} timed out`),x(new Jr(tr.DEADLINE_EXCEEDED,"Request time out"));break;case vw.HTTP_ERROR:const I=l.getStatus();if(Nr(Vo,`RPC '${e}' ${d} failed with status:`,I,"response text:",l.getResponseText()),I>0){let V=l.getResponseJson();Array.isArray(V)&&(V=V[0]);const j=V==null?void 0:V.error;if(j&&j.status&&j.message){const Q=function(ce){const Ce=ce.toLowerCase().replace(/_/g,"-");return Object.values(tr).indexOf(Ce)>=0?Ce:tr.UNKNOWN}(j.status);x(new Jr(Q,j.message))}else x(new Jr(tr.UNKNOWN,"Server responded with status "+l.getStatus()))}else x(new Jr(tr.UNAVAILABLE,"Connection failed."));break;default:Ci()}}finally{Nr(Vo,`RPC '${e}' ${d} completed.`)}});const S=JSON.stringify(c);Nr(Vo,`RPC '${e}' ${d} sending request:`,c),l.send(r,"POST",S,s,15)})}Oo(e,r,s){const c=oA(),d=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],_=OB(),x=LB(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},S=this.longPollingOptions.timeoutSeconds;S!==void 0&&(l.longPollingTimeout=Math.round(1e3*S)),this.useFetchStreams&&(l.xmlHttpFactory=new MB({})),this.Fo(l.initMessageHeaders,r,s),l.encodeInitMessageHeaders=!0;const D=d.join("");Nr(Vo,`Creating RPC '${e}' stream ${c}: ${D}`,l);const I=_.createWebChannel(D,l);let V=!1,j=!1;const Q=new Gte({lo:ce=>{j?Nr(Vo,`Not sending because RPC '${e}' stream ${c} is closed:`,ce):(V||(Nr(Vo,`Opening RPC '${e}' stream ${c} transport.`),I.open(),V=!0),Nr(Vo,`RPC '${e}' stream ${c} sending:`,ce),I.send(ce))},ho:()=>I.close()}),te=(ce,Ce,Me)=>{ce.listen(Ce,Ie=>{try{Me(Ie)}catch(Te){setTimeout(()=>{throw Te},0)}})};return te(I,Yy.EventType.OPEN,()=>{j||(Nr(Vo,`RPC '${e}' stream ${c} transport opened.`),Q.mo())}),te(I,Yy.EventType.CLOSE,()=>{j||(j=!0,Nr(Vo,`RPC '${e}' stream ${c} transport closed`),Q.po())}),te(I,Yy.EventType.ERROR,ce=>{j||(j=!0,Rg(Vo,`RPC '${e}' stream ${c} transport errored:`,ce),Q.po(new Jr(tr.UNAVAILABLE,"The operation could not be completed")))}),te(I,Yy.EventType.MESSAGE,ce=>{var Ce;if(!j){const Me=ce.data[0];qn(!!Me);const Ie=Me,Te=Ie.error||((Ce=Ie[0])===null||Ce===void 0?void 0:Ce.error);if(Te){Nr(Vo,`RPC '${e}' stream ${c} received error:`,Te);const Ge=Te.status;let $e=function(_e){const ge=ks[_e];if(ge!==void 0)return a9(ge)}(Ge),ue=Te.message;$e===void 0&&($e=tr.INTERNAL,ue="Unknown error status: "+Ge+" with message "+Te.message),j=!0,Q.po(new Jr($e,ue)),I.close()}else Nr(Vo,`RPC '${e}' stream ${c} received:`,Me),Q.yo(Me)}}),te(x,DB.STAT_EVENT,ce=>{ce.stat===SI.PROXY?Nr(Vo,`RPC '${e}' stream ${c} detected buffering proxy`):ce.stat===SI.NOPROXY&&Nr(Vo,`RPC '${e}' stream ${c} detected no buffering proxy`)}),setTimeout(()=>{Q.fo()},0),Q}}function aA(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xE(n){return new rte(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v9{constructor(e,r,s=1e3,c=1.5,d=6e4){this.oi=e,this.timerId=r,this.No=s,this.Lo=c,this.Bo=d,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(e){this.cancel();const r=Math.floor(this.ko+this.Uo()),s=Math.max(0,Date.now()-this.Qo),c=Math.max(0,r-s);c>0&&Nr("ExponentialBackoff",`Backing off for ${c} ms (base delay: ${this.ko} ms, delay with jitter: ${r} ms, last attempt: ${s} ms ago)`),this.qo=this.oi.enqueueAfterDelay(this.timerId,c,()=>(this.Qo=Date.now(),e())),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){this.qo!==null&&(this.qo.skipDelay(),this.qo=null)}cancel(){this.qo!==null&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x9{constructor(e,r,s,c,d,_,x,l){this.oi=e,this.Go=s,this.zo=c,this.connection=d,this.authCredentialsProvider=_,this.appCheckCredentialsProvider=x,this.listener=l,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new v9(e,r)}Zo(){return this.state===1||this.state===5||this.Xo()}Xo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.e_()}async stop(){this.Zo()&&await this.close(0)}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&this.Ho===null&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,()=>this.r_()))}i_(e){this.s_(),this.stream.send(e)}async r_(){if(this.Xo())return this.close(0)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}async close(e,r){this.s_(),this.o_(),this.Yo.cancel(),this.jo++,e!==4?this.Yo.reset():r&&r.code===tr.RESOURCE_EXHAUSTED?(_h(r.toString()),_h("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):r&&r.code===tr.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.__(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ao(r)}__(){}auth(){this.state=1;const e=this.a_(this.jo),r=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,c])=>{this.jo===r&&this.u_(s,c)},s=>{e(()=>{const c=new Jr(tr.UNKNOWN,"Fetching auth token failed: "+s.message);return this.c_(c)})})}u_(e,r){const s=this.a_(this.jo);this.stream=this.l_(e,r),this.stream.Po(()=>{s(()=>this.listener.Po())}),this.stream.To(()=>{s(()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,()=>(this.Xo()&&(this.state=3),Promise.resolve())),this.listener.To()))}),this.stream.Ao(c=>{s(()=>this.c_(c))}),this.stream.onMessage(c=>{s(()=>this.onMessage(c))})}e_(){this.state=5,this.Yo.$o(async()=>{this.state=0,this.start()})}c_(e){return Nr("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}a_(e){return r=>{this.oi.enqueueAndForget(()=>this.jo===e?r():(Nr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Hte extends x9{constructor(e,r,s,c,d,_){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,s,c,_),this.serializer=d}l_(e,r){return this.connection.Oo("Listen",e,r)}onMessage(e){this.Yo.reset();const r=ste(this.serializer,e),s=function(d){if(!("targetChange"in d))return Oi.min();const _=d.targetChange;return _.targetIds&&_.targetIds.length?Oi.min():_.readTime?du(_.readTime):Oi.min()}(e);return this.listener.h_(r,s)}P_(e){const r={};r.database=zI(this.serializer),r.addTarget=function(d,_){let x;const l=_.target;if(x=MI(l)?{documents:lte(d,l)}:{query:cte(d,l)._t},x.targetId=_.targetId,_.resumeToken.approximateByteSize()>0){x.resumeToken=u9(d,_.resumeToken);const S=DI(d,_.expectedCount);S!==null&&(x.expectedCount=S)}else if(_.snapshotVersion.compareTo(Oi.min())>0){x.readTime=cT(d,_.snapshotVersion.toTimestamp());const S=DI(d,_.expectedCount);S!==null&&(x.expectedCount=S)}return x}(this.serializer,e);const s=hte(this.serializer,e);s&&(r.labels=s),this.i_(r)}I_(e){const r={};r.database=zI(this.serializer),r.removeTarget=e,this.i_(r)}}class Wte extends x9{constructor(e,r,s,c,d,_){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,s,c,_),this.serializer=d,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(e,r){return this.connection.Oo("Write",e,r)}onMessage(e){if(qn(!!e.streamToken),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();const r=ate(e.writeResults,e.commitTime),s=du(e.commitTime);return this.listener.A_(s,r)}return qn(!e.writeResults||e.writeResults.length===0),this.T_=!0,this.listener.R_()}V_(){const e={};e.database=zI(this.serializer),this.i_(e)}d_(e){const r={streamToken:this.lastStreamToken,writes:e.map(s=>ote(this.serializer,s))};this.i_(r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zte extends class{}{constructor(e,r,s,c){super(),this.authCredentials=e,this.appCheckCredentials=r,this.connection=s,this.serializer=c,this.m_=!1}f_(){if(this.m_)throw new Jr(tr.FAILED_PRECONDITION,"The client has already been terminated.")}Co(e,r,s,c){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,_])=>this.connection.Co(e,LI(r,s),c,d,_)).catch(d=>{throw d.name==="FirebaseError"?(d.code===tr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new Jr(tr.UNKNOWN,d.toString())})}xo(e,r,s,c,d){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([_,x])=>this.connection.xo(e,LI(r,s),c,_,x,d)).catch(_=>{throw _.name==="FirebaseError"?(_.code===tr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),_):new Jr(tr.UNKNOWN,_.toString())})}terminate(){this.m_=!0,this.connection.terminate()}}class Xte{constructor(e,r){this.asyncQueue=e,this.onlineStateHandler=r,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){this.g_===0&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){this.state==="Online"?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,e==="Online"&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){const r=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(_h(r),this.y_=!1):Nr("OnlineStateTracker",r)}C_(){this.p_!==null&&(this.p_.cancel(),this.p_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yte{constructor(e,r,s,c,d){this.localStore=e,this.datastore=r,this.asyncQueue=s,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=d,this.O_.io(_=>{s.enqueueAndForget(async()=>{gm(this)&&(Nr("RemoteStore","Restarting streams for network reachability change."),await async function(l){const S=zi(l);S.M_.add(4),await O1(S),S.N_.set("Unknown"),S.M_.delete(4),await bE(S)}(this))})}),this.N_=new Xte(s,c)}}async function bE(n){if(gm(n))for(const e of n.x_)await e(!0)}async function O1(n){for(const e of n.x_)await e(!1)}function b9(n,e){const r=zi(n);r.F_.has(e.targetId)||(r.F_.set(e.targetId,e),oR(r)?sR(r):n0(r).Xo()&&nR(r,e))}function iR(n,e){const r=zi(n),s=n0(r);r.F_.delete(e),s.Xo()&&w9(r,e),r.F_.size===0&&(s.Xo()?s.n_():gm(r)&&r.N_.set("Unknown"))}function nR(n,e){if(n.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Oi.min())>0){const r=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(r)}n0(n).P_(e)}function w9(n,e){n.L_.xe(e),n0(n).I_(e)}function sR(n){n.L_=new Kee({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.F_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),n0(n).start(),n.N_.w_()}function oR(n){return gm(n)&&!n0(n).Zo()&&n.F_.size>0}function gm(n){return zi(n).M_.size===0}function T9(n){n.L_=void 0}async function Qte(n){n.N_.set("Online")}async function Kte(n){n.F_.forEach((e,r)=>{nR(n,e)})}async function Jte(n,e){T9(n),oR(n)?(n.N_.D_(e),sR(n)):n.N_.set("Unknown")}async function ere(n,e,r){if(n.N_.set("Online"),e instanceof c9&&e.state===2&&e.cause)try{await async function(c,d){const _=d.cause;for(const x of d.targetIds)c.F_.has(x)&&(await c.remoteSyncer.rejectListen(x,_),c.F_.delete(x),c.L_.removeTarget(x))}(n,e)}catch(s){Nr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),s),await uT(n,s)}else if(e instanceof ww?n.L_.Ke(e):e instanceof l9?n.L_.He(e):n.L_.We(e),!r.isEqual(Oi.min()))try{const s=await y9(n.localStore);r.compareTo(s)>=0&&await function(d,_){const x=d.L_.rt(_);return x.targetChanges.forEach((l,S)=>{if(l.resumeToken.approximateByteSize()>0){const D=d.F_.get(S);D&&d.F_.set(S,D.withResumeToken(l.resumeToken,_))}}),x.targetMismatches.forEach((l,S)=>{const D=d.F_.get(l);if(!D)return;d.F_.set(l,D.withResumeToken(Jo.EMPTY_BYTE_STRING,D.snapshotVersion)),w9(d,l);const I=new Md(D.target,l,S,D.sequenceNumber);nR(d,I)}),d.remoteSyncer.applyRemoteEvent(x)}(n,r)}catch(s){Nr("RemoteStore","Failed to raise snapshot:",s),await uT(n,s)}}async function uT(n,e,r){if(!k1(e))throw e;n.M_.add(1),await O1(n),n.N_.set("Offline"),r||(r=()=>y9(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Nr("RemoteStore","Retrying IndexedDB access"),await r(),n.M_.delete(1),await bE(n)})}function E9(n,e){return e().catch(r=>uT(n,r,e))}async function wE(n){const e=zi(n),r=Jd(e);let s=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;tre(e);)try{const c=await Nte(e.localStore,s);if(c===null){e.v_.length===0&&r.n_();break}s=c.batchId,rre(e,c)}catch(c){await uT(e,c)}A9(e)&&I9(e)}function tre(n){return gm(n)&&n.v_.length<10}function rre(n,e){n.v_.push(e);const r=Jd(n);r.Xo()&&r.E_&&r.d_(e.mutations)}function A9(n){return gm(n)&&!Jd(n).Zo()&&n.v_.length>0}function I9(n){Jd(n).start()}async function ire(n){Jd(n).V_()}async function nre(n){const e=Jd(n);for(const r of n.v_)e.d_(r.mutations)}async function sre(n,e,r){const s=n.v_.shift(),c=QC.from(s,e,r);await E9(n,()=>n.remoteSyncer.applySuccessfulWrite(c)),await wE(n)}async function ore(n,e){e&&Jd(n).E_&&await async function(s,c){if(function(_){return Xee(_)&&_!==tr.ABORTED}(c.code)){const d=s.v_.shift();Jd(s).t_(),await E9(s,()=>s.remoteSyncer.rejectFailedWrite(d.batchId,c)),await wE(s)}}(n,e),A9(n)&&I9(n)}async function hL(n,e){const r=zi(n);r.asyncQueue.verifyOperationInProgress(),Nr("RemoteStore","RemoteStore received new credentials");const s=gm(r);r.M_.add(3),await O1(r),s&&r.N_.set("Unknown"),await r.remoteSyncer.handleCredentialChange(e),r.M_.delete(3),await bE(r)}async function are(n,e){const r=zi(n);e?(r.M_.delete(2),await bE(r)):e||(r.M_.add(2),await O1(r),r.N_.set("Unknown"))}function n0(n){return n.B_||(n.B_=function(r,s,c){const d=zi(r);return d.f_(),new Hte(s,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,c)}(n.datastore,n.asyncQueue,{Po:Qte.bind(null,n),To:Kte.bind(null,n),Ao:Jte.bind(null,n),h_:ere.bind(null,n)}),n.x_.push(async e=>{e?(n.B_.t_(),oR(n)?sR(n):n.N_.set("Unknown")):(await n.B_.stop(),T9(n))})),n.B_}function Jd(n){return n.k_||(n.k_=function(r,s,c){const d=zi(r);return d.f_(),new Wte(s,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,c)}(n.datastore,n.asyncQueue,{Po:()=>Promise.resolve(),To:ire.bind(null,n),Ao:ore.bind(null,n),R_:nre.bind(null,n),A_:sre.bind(null,n)}),n.x_.push(async e=>{e?(n.k_.t_(),await wE(n)):(await n.k_.stop(),n.v_.length>0&&(Nr("RemoteStore",`Stopping write stream with ${n.v_.length} pending writes`),n.v_=[]))})),n.k_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aR{constructor(e,r,s,c,d){this.asyncQueue=e,this.timerId=r,this.targetTimeMs=s,this.op=c,this.removalCallback=d,this.deferred=new fh,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(_=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,r,s,c,d){const _=Date.now()+s,x=new aR(e,r,_,c,d);return x.start(s),x}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Jr(tr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function lR(n,e){if(_h("AsyncQueue",`${e}: ${n}`),k1(n))return new Jr(tr.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hg{constructor(e){this.comparator=e?(r,s)=>e(r,s)||ci.comparator(r.key,s.key):(r,s)=>ci.comparator(r.key,s.key),this.keyedMap=Qy(),this.sortedSet=new us(this.comparator)}static emptySet(e){return new hg(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const r=this.keyedMap.get(e);return r?this.sortedSet.indexOf(r):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((r,s)=>(e(r),!1))}add(e){const r=this.delete(e.key);return r.copy(r.keyedMap.insert(e.key,e),r.sortedSet.insert(e,null))}delete(e){const r=this.get(e);return r?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(r)):this}isEqual(e){if(!(e instanceof hg)||this.size!==e.size)return!1;const r=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;r.hasNext();){const c=r.getNext().key,d=s.getNext().key;if(!c.isEqual(d))return!1}return!0}toString(){const e=[];return this.forEach(r=>{e.push(r.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,r){const s=new hg;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=r,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dL{constructor(){this.q_=new us(ci.comparator)}track(e){const r=e.doc.key,s=this.q_.get(r);s?e.type!==0&&s.type===3?this.q_=this.q_.insert(r,e):e.type===3&&s.type!==1?this.q_=this.q_.insert(r,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.q_=this.q_.insert(r,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.q_=this.q_.insert(r,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.q_=this.q_.remove(r):e.type===1&&s.type===2?this.q_=this.q_.insert(r,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.q_=this.q_.insert(r,{type:2,doc:e.doc}):Ci():this.q_=this.q_.insert(r,e)}Q_(){const e=[];return this.q_.inorderTraversal((r,s)=>{e.push(s)}),e}}class Og{constructor(e,r,s,c,d,_,x,l,S){this.query=e,this.docs=r,this.oldDocs=s,this.docChanges=c,this.mutatedKeys=d,this.fromCache=_,this.syncStateChanged=x,this.excludesMetadataChanges=l,this.hasCachedResults=S}static fromInitialDocuments(e,r,s,c,d){const _=[];return r.forEach(x=>{_.push({type:0,doc:x})}),new Og(e,r,hg.emptySet(r),_,s,c,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&mE(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const r=this.docChanges,s=e.docChanges;if(r.length!==s.length)return!1;for(let c=0;c<r.length;c++)if(r[c].type!==s[c].type||!r[c].doc.isEqual(s[c].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lre{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}}class cre{constructor(){this.queries=new i0(e=>WB(e),mE),this.onlineState="Unknown",this.z_=new Set}}async function cR(n,e){const r=zi(n);let s=3;const c=e.query;let d=r.queries.get(c);d?!d.W_()&&e.G_()&&(s=2):(d=new lre,s=e.G_()?0:1);try{switch(s){case 0:d.K_=await r.onListen(c,!0);break;case 1:d.K_=await r.onListen(c,!1);break;case 2:await r.onFirstRemoteStoreListen(c)}}catch(_){const x=lR(_,`Initialization of query '${V_(e.query)}' failed`);return void e.onError(x)}r.queries.set(c,d),d.U_.push(e),e.j_(r.onlineState),d.K_&&e.H_(d.K_)&&hR(r)}async function uR(n,e){const r=zi(n),s=e.query;let c=3;const d=r.queries.get(s);if(d){const _=d.U_.indexOf(e);_>=0&&(d.U_.splice(_,1),d.U_.length===0?c=e.G_()?0:1:!d.W_()&&e.G_()&&(c=2))}switch(c){case 0:return r.queries.delete(s),r.onUnlisten(s,!0);case 1:return r.queries.delete(s),r.onUnlisten(s,!1);case 2:return r.onLastRemoteStoreUnlisten(s);default:return}}function ure(n,e){const r=zi(n);let s=!1;for(const c of e){const d=c.query,_=r.queries.get(d);if(_){for(const x of _.U_)x.H_(c)&&(s=!0);_.K_=c}}s&&hR(r)}function hre(n,e,r){const s=zi(n),c=s.queries.get(e);if(c)for(const d of c.U_)d.onError(r);s.queries.delete(e)}function hR(n){n.z_.forEach(e=>{e.next()})}var NI,fL;(fL=NI||(NI={})).J_="default",fL.Cache="cache";class dR{constructor(e,r,s){this.query=e,this.Y_=r,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=s||{}}H_(e){if(!this.options.includeMetadataChanges){const s=[];for(const c of e.docChanges)c.type!==3&&s.push(c);e=new Og(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let r=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),r=!0):this.ta(e,this.onlineState)&&(this.na(e),r=!0),this.X_=e,r}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let r=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),r=!0),r}ta(e,r){if(!e.fromCache||!this.G_())return!0;const s=r!=="Offline";return(!this.options.ra||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||r==="Offline")}ea(e){if(e.docChanges.length>0)return!0;const r=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!r)&&this.options.includeMetadataChanges===!0}na(e){e=Og.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==NI.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S9{constructor(e){this.key=e}}class C9{constructor(e){this.key=e}}class dre{constructor(e,r){this.query=e,this.la=r,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=en(),this.mutatedKeys=en(),this.Ia=ZB(e),this.Ta=new hg(this.Ia)}get Ea(){return this.la}da(e,r){const s=r?r.Aa:new dL,c=r?r.Ta:this.Ta;let d=r?r.mutatedKeys:this.mutatedKeys,_=c,x=!1;const l=this.query.limitType==="F"&&c.size===this.query.limit?c.last():null,S=this.query.limitType==="L"&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((D,I)=>{const V=c.get(D),j=_E(this.query,I)?I:null,Q=!!V&&this.mutatedKeys.has(V.key),te=!!j&&(j.hasLocalMutations||this.mutatedKeys.has(j.key)&&j.hasCommittedMutations);let ce=!1;V&&j?V.data.isEqual(j.data)?Q!==te&&(s.track({type:3,doc:j}),ce=!0):this.Ra(V,j)||(s.track({type:2,doc:j}),ce=!0,(l&&this.Ia(j,l)>0||S&&this.Ia(j,S)<0)&&(x=!0)):!V&&j?(s.track({type:0,doc:j}),ce=!0):V&&!j&&(s.track({type:1,doc:V}),ce=!0,(l||S)&&(x=!0)),ce&&(j?(_=_.add(j),d=te?d.add(D):d.delete(D)):(_=_.delete(D),d=d.delete(D)))}),this.query.limit!==null)for(;_.size>this.query.limit;){const D=this.query.limitType==="F"?_.last():_.first();_=_.delete(D.key),d=d.delete(D.key),s.track({type:1,doc:D})}return{Ta:_,Aa:s,Xi:x,mutatedKeys:d}}Ra(e,r){return e.hasLocalMutations&&r.hasCommittedMutations&&!r.hasLocalMutations}applyChanges(e,r,s,c){const d=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;const _=e.Aa.Q_();_.sort((D,I)=>function(j,Q){const te=ce=>{switch(ce){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ci()}};return te(j)-te(Q)}(D.type,I.type)||this.Ia(D.doc,I.doc)),this.Va(s),c=c!=null&&c;const x=r&&!c?this.ma():[],l=this.Pa.size===0&&this.current&&!c?1:0,S=l!==this.ha;return this.ha=l,_.length!==0||S?{snapshot:new Og(this.query,e.Ta,d,_,e.mutatedKeys,l===0,S,!1,!!s&&s.resumeToken.approximateByteSize()>0),fa:x}:{fa:x}}j_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new dL,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(r=>this.la=this.la.add(r)),e.modifiedDocuments.forEach(r=>{}),e.removedDocuments.forEach(r=>this.la=this.la.delete(r)),this.current=e.current)}ma(){if(!this.current)return[];const e=this.Pa;this.Pa=en(),this.Ta.forEach(s=>{this.ga(s.key)&&(this.Pa=this.Pa.add(s.key))});const r=[];return e.forEach(s=>{this.Pa.has(s)||r.push(new C9(s))}),this.Pa.forEach(s=>{e.has(s)||r.push(new S9(s))}),r}pa(e){this.la=e.hs,this.Pa=en();const r=this.da(e.documents);return this.applyChanges(r,!0)}ya(){return Og.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,this.ha===0,this.hasCachedResults)}}class fre{constructor(e,r,s){this.query=e,this.targetId=r,this.view=s}}class pre{constructor(e){this.key=e,this.wa=!1}}class mre{constructor(e,r,s,c,d,_){this.localStore=e,this.remoteStore=r,this.eventManager=s,this.sharedClientState=c,this.currentUser=d,this.maxConcurrentLimboResolutions=_,this.Sa={},this.ba=new i0(x=>WB(x),mE),this.Da=new Map,this.Ca=new Set,this.va=new us(ci.comparator),this.Fa=new Map,this.Ma=new eR,this.xa={},this.Oa=new Map,this.Na=Lg.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return this.La===!0}}async function _re(n,e,r=!0){const s=L9(n);let c;const d=s.ba.get(e);return d?(s.sharedClientState.addLocalQueryTarget(d.targetId),c=d.view.ya()):c=await R9(s,e,r,!0),c}async function gre(n,e){const r=L9(n);await R9(r,e,!0,!1)}async function R9(n,e,r,s){const c=await Bte(n.localStore,uu(e)),d=c.targetId,_=r?n.sharedClientState.addLocalQueryTarget(d):"not-current";let x;return s&&(x=await yre(n,e,d,_==="current",c.resumeToken)),n.isPrimaryClient&&r&&b9(n.remoteStore,c),x}async function yre(n,e,r,s,c){n.Ba=(I,V,j)=>async function(te,ce,Ce,Me){let Ie=ce.view.da(Ce);Ie.Xi&&(Ie=await lL(te.localStore,ce.query,!1).then(({documents:ue})=>ce.view.da(ue,Ie)));const Te=Me&&Me.targetChanges.get(ce.targetId),Ge=Me&&Me.targetMismatches.get(ce.targetId)!=null,$e=ce.view.applyChanges(Ie,te.isPrimaryClient,Te,Ge);return mL(te,ce.targetId,$e.fa),$e.snapshot}(n,I,V,j);const d=await lL(n.localStore,e,!0),_=new dre(e,d.hs),x=_.da(d.documents),l=L1.createSynthesizedTargetChangeForCurrentChange(r,s&&n.onlineState!=="Offline",c),S=_.applyChanges(x,n.isPrimaryClient,l);mL(n,r,S.fa);const D=new fre(e,r,_);return n.ba.set(e,D),n.Da.has(r)?n.Da.get(r).push(e):n.Da.set(r,[e]),S.snapshot}async function vre(n,e,r){const s=zi(n),c=s.ba.get(e),d=s.Da.get(c.targetId);if(d.length>1)return s.Da.set(c.targetId,d.filter(_=>!mE(_,e))),void s.ba.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(c.targetId),s.sharedClientState.isActiveQueryTarget(c.targetId)||await FI(s.localStore,c.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(c.targetId),r&&iR(s.remoteStore,c.targetId),BI(s,c.targetId)}).catch(M1)):(BI(s,c.targetId),await FI(s.localStore,c.targetId,!0))}async function xre(n,e){const r=zi(n),s=r.ba.get(e),c=r.Da.get(s.targetId);r.isPrimaryClient&&c.length===1&&(r.sharedClientState.removeLocalQueryTarget(s.targetId),iR(r.remoteStore,s.targetId))}async function bre(n,e,r){const s=Cre(n);try{const c=await function(_,x){const l=zi(_),S=zs.now(),D=x.reduce((j,Q)=>j.add(Q.key),en());let I,V;return l.persistence.runTransaction("Locally write mutations","readwrite",j=>{let Q=gh(),te=en();return l.os.getEntries(j,D).next(ce=>{Q=ce,Q.forEach((Ce,Me)=>{Me.isValidDocument()||(te=te.add(Ce))})}).next(()=>l.localDocuments.getOverlayedDocuments(j,Q)).next(ce=>{I=ce;const Ce=[];for(const Me of x){const Ie=Gee(Me,I.get(Me.key).overlayedDocument);Ie!=null&&Ce.push(new _m(Me.key,Ie,VB(Ie.value.mapValue),hu.exists(!0)))}return l.mutationQueue.addMutationBatch(j,S,Ce,x)}).next(ce=>{V=ce;const Ce=ce.applyToLocalDocumentSet(I,te);return l.documentOverlayCache.saveOverlays(j,ce.batchId,Ce)})}).then(()=>({batchId:V.batchId,changes:YB(I)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(c.batchId),function(_,x,l){let S=_.xa[_.currentUser.toKey()];S||(S=new us(wn)),S=S.insert(x,l),_.xa[_.currentUser.toKey()]=S}(s,c.batchId,r),await z1(s,c.changes),await wE(s.remoteStore)}catch(c){const d=lR(c,"Failed to persist write");r.reject(d)}}async function P9(n,e){const r=zi(n);try{const s=await zte(r.localStore,e);e.targetChanges.forEach((c,d)=>{const _=r.Fa.get(d);_&&(qn(c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size<=1),c.addedDocuments.size>0?_.wa=!0:c.modifiedDocuments.size>0?qn(_.wa):c.removedDocuments.size>0&&(qn(_.wa),_.wa=!1))}),await z1(r,s,e)}catch(s){await M1(s)}}function pL(n,e,r){const s=zi(n);if(s.isPrimaryClient&&r===0||!s.isPrimaryClient&&r===1){const c=[];s.ba.forEach((d,_)=>{const x=_.view.j_(e);x.snapshot&&c.push(x.snapshot)}),function(_,x){const l=zi(_);l.onlineState=x;let S=!1;l.queries.forEach((D,I)=>{for(const V of I.U_)V.j_(x)&&(S=!0)}),S&&hR(l)}(s.eventManager,e),c.length&&s.Sa.h_(c),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function wre(n,e,r){const s=zi(n);s.sharedClientState.updateQueryState(e,"rejected",r);const c=s.Fa.get(e),d=c&&c.key;if(d){let _=new us(ci.comparator);_=_.insert(d,Ho.newNoDocument(d,Oi.min()));const x=en().add(d),l=new vE(Oi.min(),new Map,new us(wn),_,x);await P9(s,l),s.va=s.va.remove(d),s.Fa.delete(e),fR(s)}else await FI(s.localStore,e,!1).then(()=>BI(s,e,r)).catch(M1)}async function Tre(n,e){const r=zi(n),s=e.batch.batchId;try{const c=await Ote(r.localStore,e);k9(r,s,null),M9(r,s),r.sharedClientState.updateMutationState(s,"acknowledged"),await z1(r,c)}catch(c){await M1(c)}}async function Ere(n,e,r){const s=zi(n);try{const c=await function(_,x){const l=zi(_);return l.persistence.runTransaction("Reject batch","readwrite-primary",S=>{let D;return l.mutationQueue.lookupMutationBatch(S,x).next(I=>(qn(I!==null),D=I.keys(),l.mutationQueue.removeMutationBatch(S,I))).next(()=>l.mutationQueue.performConsistencyCheck(S)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(S,D,x)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(S,D)).next(()=>l.localDocuments.getDocuments(S,D))})}(s.localStore,e);k9(s,e,r),M9(s,e),s.sharedClientState.updateMutationState(e,"rejected",r),await z1(s,c)}catch(c){await M1(c)}}function M9(n,e){(n.Oa.get(e)||[]).forEach(r=>{r.resolve()}),n.Oa.delete(e)}function k9(n,e,r){const s=zi(n);let c=s.xa[s.currentUser.toKey()];if(c){const d=c.get(e);d&&(r?d.reject(r):d.resolve(),c=c.remove(e)),s.xa[s.currentUser.toKey()]=c}}function BI(n,e,r=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Da.get(e))n.ba.delete(s),r&&n.Sa.ka(s,r);n.Da.delete(e),n.isPrimaryClient&&n.Ma.Vr(e).forEach(s=>{n.Ma.containsKey(s)||D9(n,s)})}function D9(n,e){n.Ca.delete(e.path.canonicalString());const r=n.va.get(e);r!==null&&(iR(n.remoteStore,r),n.va=n.va.remove(e),n.Fa.delete(r),fR(n))}function mL(n,e,r){for(const s of r)s instanceof S9?(n.Ma.addReference(s.key,e),Are(n,s)):s instanceof C9?(Nr("SyncEngine","Document no longer in limbo: "+s.key),n.Ma.removeReference(s.key,e),n.Ma.containsKey(s.key)||D9(n,s.key)):Ci()}function Are(n,e){const r=e.key,s=r.path.canonicalString();n.va.get(r)||n.Ca.has(s)||(Nr("SyncEngine","New document in limbo: "+r),n.Ca.add(s),fR(n))}function fR(n){for(;n.Ca.size>0&&n.va.size<n.maxConcurrentLimboResolutions;){const e=n.Ca.values().next().value;n.Ca.delete(e);const r=new ci(ts.fromString(e)),s=n.Na.next();n.Fa.set(s,new pre(r)),n.va=n.va.insert(r,s),b9(n.remoteStore,new Md(uu(pE(r.path)),s,"TargetPurposeLimboResolution",qC.oe))}}async function z1(n,e,r){const s=zi(n),c=[],d=[],_=[];s.ba.isEmpty()||(s.ba.forEach((x,l)=>{_.push(s.Ba(l,e,r).then(S=>{if((S||r)&&s.isPrimaryClient){const D=S&&!S.fromCache;s.sharedClientState.updateQueryState(l.targetId,D?"current":"not-current")}if(S){c.push(S);const D=rR.Ki(l.targetId,S);d.push(D)}}))}),await Promise.all(_),s.Sa.h_(c),await async function(l,S){const D=zi(l);try{await D.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>rr.forEach(S,V=>rr.forEach(V.qi,j=>D.persistence.referenceDelegate.addReference(I,V.targetId,j)).next(()=>rr.forEach(V.Qi,j=>D.persistence.referenceDelegate.removeReference(I,V.targetId,j)))))}catch(I){if(!k1(I))throw I;Nr("LocalStore","Failed to update sequence numbers: "+I)}for(const I of S){const V=I.targetId;if(!I.fromCache){const j=D.ns.get(V),Q=j.snapshotVersion,te=j.withLastLimboFreeSnapshotVersion(Q);D.ns=D.ns.insert(V,te)}}}(s.localStore,d))}async function Ire(n,e){const r=zi(n);if(!r.currentUser.isEqual(e)){Nr("SyncEngine","User change. New user:",e.toKey());const s=await g9(r.localStore,e);r.currentUser=e,function(d,_){d.Oa.forEach(x=>{x.forEach(l=>{l.reject(new Jr(tr.CANCELLED,_))})}),d.Oa.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await z1(r,s.us)}}function Sre(n,e){const r=zi(n),s=r.Fa.get(e);if(s&&s.wa)return en().add(s.key);{let c=en();const d=r.Da.get(e);if(!d)return c;for(const _ of d){const x=r.ba.get(_);c=c.unionWith(x.view.Ea)}return c}}function L9(n){const e=zi(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=P9.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Sre.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=wre.bind(null,e),e.Sa.h_=ure.bind(null,e.eventManager),e.Sa.ka=hre.bind(null,e.eventManager),e}function Cre(n){const e=zi(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Tre.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ere.bind(null,e),e}class _L{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=xE(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,r){return null}createIndexBackfillerScheduler(e,r){return null}createLocalStore(e){return Lte(this.persistence,new kte,e.initialUser,this.serializer)}createPersistence(e){return new Rte(tR.Hr,this.serializer)}createSharedClientState(e){return new Ute}async terminate(){var e,r;(e=this.gcScheduler)===null||e===void 0||e.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Rre{async initialize(e,r){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>pL(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ire.bind(null,this.syncEngine),await are(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new cre}()}createDatastore(e){const r=xE(e.databaseInfo.databaseId),s=function(d){return new qte(d)}(e.databaseInfo);return function(d,_,x,l){return new Zte(d,_,x,l)}(e.authCredentials,e.appCheckCredentials,s,r)}createRemoteStore(e){return function(s,c,d,_,x){return new Yte(s,c,d,_,x)}(this.localStore,this.datastore,e.asyncQueue,r=>pL(this.syncEngine,r,0),function(){return uL.D()?new uL:new jte}())}createSyncEngine(e,r){return function(c,d,_,x,l,S,D){const I=new mre(c,d,_,x,l,S);return D&&(I.La=!0),I}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}async terminate(){var e;await async function(s){const c=zi(s);Nr("RemoteStore","RemoteStore shutting down."),c.M_.add(5),await O1(c),c.O_.shutdown(),c.N_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pR{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):_h("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,r){this.muted||setTimeout(()=>{this.muted||e(r)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pre{constructor(e,r,s,c){this.authCredentials=e,this.appCheckCredentials=r,this.asyncQueue=s,this.databaseInfo=c,this.user=jo.UNAUTHENTICATED,this.clientId=FB.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(s,async d=>{Nr("FirestoreClient","Received user=",d.uid),await this.authCredentialListener(d),this.user=d}),this.appCheckCredentials.start(s,d=>(Nr("FirestoreClient","Received new app check token=",d),this.appCheckCredentialListener(d,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Jr(tr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new fh;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){const s=lR(r,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function lA(n,e){n.asyncQueue.verifyOperationInProgress(),Nr("FirestoreClient","Initializing OfflineComponentProvider");const r=n.configuration;await e.initialize(r);let s=r.initialUser;n.setCredentialChangeListener(async c=>{s.isEqual(c)||(await g9(e.localStore,c),s=c)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function gL(n,e){n.asyncQueue.verifyOperationInProgress();const r=await kre(n);Nr("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(r,n.configuration),n.setCredentialChangeListener(s=>hL(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,c)=>hL(e.remoteStore,c)),n._onlineComponents=e}function Mre(n){return n.name==="FirebaseError"?n.code===tr.FAILED_PRECONDITION||n.code===tr.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}async function kre(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Nr("FirestoreClient","Using user provided OfflineComponentProvider");try{await lA(n,n._uninitializedComponentsProvider._offline)}catch(e){const r=e;if(!Mre(r))throw r;Rg("Error using user provided cache. Falling back to memory cache: "+r),await lA(n,new _L)}}else Nr("FirestoreClient","Using default OfflineComponentProvider"),await lA(n,new _L);return n._offlineComponents}async function O9(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Nr("FirestoreClient","Using user provided OnlineComponentProvider"),await gL(n,n._uninitializedComponentsProvider._online)):(Nr("FirestoreClient","Using default OnlineComponentProvider"),await gL(n,new Rre))),n._onlineComponents}function Dre(n){return O9(n).then(e=>e.syncEngine)}async function hT(n){const e=await O9(n),r=e.eventManager;return r.onListen=_re.bind(null,e.syncEngine),r.onUnlisten=vre.bind(null,e.syncEngine),r.onFirstRemoteStoreListen=gre.bind(null,e.syncEngine),r.onLastRemoteStoreUnlisten=xre.bind(null,e.syncEngine),r}function Lre(n,e,r={}){const s=new fh;return n.asyncQueue.enqueueAndForget(async()=>function(d,_,x,l,S){const D=new pR({next:V=>{_.enqueueAndForget(()=>uR(d,I));const j=V.docs.has(x);!j&&V.fromCache?S.reject(new Jr(tr.UNAVAILABLE,"Failed to get document because the client is offline.")):j&&V.fromCache&&l&&l.source==="server"?S.reject(new Jr(tr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):S.resolve(V)},error:V=>S.reject(V)}),I=new dR(pE(x.path),D,{includeMetadataChanges:!0,ra:!0});return cR(d,I)}(await hT(n),n.asyncQueue,e,r,s)),s.promise}function Ore(n,e,r={}){const s=new fh;return n.asyncQueue.enqueueAndForget(async()=>function(d,_,x,l,S){const D=new pR({next:V=>{_.enqueueAndForget(()=>uR(d,I)),V.fromCache&&l.source==="server"?S.reject(new Jr(tr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):S.resolve(V)},error:V=>S.reject(V)}),I=new dR(x,D,{includeMetadataChanges:!0,ra:!0});return cR(d,I)}(await hT(n),n.asyncQueue,e,r,s)),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z9(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yL=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F9(n,e,r){if(!r)throw new Jr(tr.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function zre(n,e,r,s){if(e===!0&&s===!0)throw new Jr(tr.INVALID_ARGUMENT,`${n} and ${r} cannot be used together.`)}function vL(n){if(!ci.isDocumentKey(n))throw new Jr(tr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function xL(n){if(ci.isDocumentKey(n))throw new Jr(tr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function mR(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(s){return s.constructor?s.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ci()}function Ic(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Jr(tr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=mR(n);throw new Jr(tr.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${r}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bL{constructor(e){var r,s;if(e.host===void 0){if(e.ssl!==void 0)throw new Jr(tr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(r=e.ssl)===null||r===void 0||r;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Jr(tr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}zre("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=z9((s=e.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new Jr(tr.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new Jr(tr.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new Jr(tr.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,c){return s.timeoutSeconds===c.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class TE{constructor(e,r,s,c){this._authCredentials=e,this._appCheckCredentials=r,this._databaseId=s,this._app=c,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bL({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Jr(tr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new Jr(tr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bL(e),e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new KJ;switch(s.type){case"firstParty":return new ree(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new Jr(tr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(r){const s=yL.get(r);s&&(Nr("ComponentProvider","Removing Datastore"),yL.delete(r),s.terminate())}(this),Promise.resolve()}}function Fre(n,e,r,s={}){var c;const d=(n=Ic(n,TE))._getSettings(),_=`${e}:${r}`;if(d.host!=="firestore.googleapis.com"&&d.host!==_&&Rg("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},d),{host:_,ssl:!1})),s.mockUserToken){let x,l;if(typeof s.mockUserToken=="string")x=s.mockUserToken,l=jo.MOCK_USER;else{x=XH(s.mockUserToken,(c=n._app)===null||c===void 0?void 0:c.options.projectId);const S=s.mockUserToken.sub||s.mockUserToken.user_id;if(!S)throw new Jr(tr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new jo(S)}n._authCredentials=new JJ(new zB(x,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F1{constructor(e,r,s){this.converter=r,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new F1(this.firestore,e,this._query)}}class Na{constructor(e,r,s){this.converter=r,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new $d(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Na(this.firestore,e,this._key)}}class $d extends F1{constructor(e,r,s){super(e,r,pE(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Na(this.firestore,null,new ci(e))}withConverter(e){return new $d(this.firestore,e,this._path)}}function N9(n,e,...r){if(n=va(n),F9("collection","path",e),n instanceof TE){const s=ts.fromString(e,...r);return xL(s),new $d(n,null,s)}{if(!(n instanceof Na||n instanceof $d))throw new Jr(tr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(ts.fromString(e,...r));return xL(s),new $d(n.firestore,null,s)}}function B9(n,e,...r){if(n=va(n),arguments.length===1&&(e=FB.newId()),F9("doc","path",e),n instanceof TE){const s=ts.fromString(e,...r);return vL(s),new Na(n,null,new ci(s))}{if(!(n instanceof Na||n instanceof $d))throw new Jr(tr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(ts.fromString(e,...r));return vL(s),new Na(n.firestore,n instanceof $d?n.converter:null,new ci(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nre{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new v9(this,"async_queue_retry"),this.hu=()=>{const r=aA();r&&Nr("AsyncQueue","Visibility state changed to "+r.visibilityState),this.Yo.Wo()};const e=aA();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;const r=aA();r&&typeof r.removeEventListener=="function"&&r.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});const r=new fh;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(r.resolve,r.reject),r.promise)).then(()=>r.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}async Tu(){if(this.su.length!==0){try{await this.su[0](),this.su.shift(),this.Yo.reset()}catch(e){if(!k1(e))throw e;Nr("AsyncQueue","Operation failed with retryable error: "+e)}this.su.length>0&&this.Yo.$o(()=>this.Tu())}}Iu(e){const r=this.iu.then(()=>(this.uu=!0,e().catch(s=>{this.au=s,this.uu=!1;const c=function(_){let x=_.message||"";return _.stack&&(x=_.stack.includes(_.message)?_.stack:_.message+`
`+_.stack),x}(s);throw _h("INTERNAL UNHANDLED ERROR: ",c),s}).then(s=>(this.uu=!1,s))));return this.iu=r,r}enqueueAfterDelay(e,r,s){this.Pu(),this.lu.indexOf(e)>-1&&(r=0);const c=aR.createAndSchedule(this,e,r,s,d=>this.Eu(d));return this._u.push(c),c}Pu(){this.au&&Ci()}verifyOperationInProgress(){}async du(){let e;do e=this.iu,await e;while(e!==this.iu)}Au(e){for(const r of this._u)if(r.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((r,s)=>r.targetTimeMs-s.targetTimeMs);for(const r of this._u)if(r.skipDelay(),e!=="all"&&r.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){const r=this._u.indexOf(e);this._u.splice(r,1)}}function wL(n){return function(r,s){if(typeof r!="object"||r===null)return!1;const c=r;for(const d of s)if(d in c&&typeof c[d]=="function")return!0;return!1}(n,["next","error","complete"])}class rm extends TE{constructor(e,r,s,c){super(e,r,s,c),this.type="firestore",this._queue=function(){return new Nre}(),this._persistenceKey=(c==null?void 0:c.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||V9(this),this._firestoreClient.terminate()}}function Bre(n,e){const r=typeof n=="object"?n:PF(),s=typeof n=="string"?n:"(default)",c=eE(r,"firestore").getImmediate({identifier:s});if(!c._initialized){const d=WH("firestore");d&&Fre(c,...d)}return c}function EE(n){return n._firestoreClient||V9(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function V9(n){var e,r,s;const c=n._freezeSettings(),d=function(x,l,S,D){return new mee(x,l,S,D.host,D.ssl,D.experimentalForceLongPolling,D.experimentalAutoDetectLongPolling,z9(D.experimentalLongPollingOptions),D.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,c);n._firestoreClient=new Pre(n._authCredentials,n._appCheckCredentials,n._queue,d),!((r=c.localCache)===null||r===void 0)&&r._offlineComponentProvider&&(!((s=c.localCache)===null||s===void 0)&&s._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:c.localCache.kind,_offline:c.localCache._offlineComponentProvider,_online:c.localCache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zg{constructor(e){this._byteString=e}static fromBase64String(e){try{return new zg(Jo.fromBase64String(e))}catch(r){throw new Jr(tr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+r)}}static fromUint8Array(e){return new zg(Jo.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _R{constructor(...e){for(let r=0;r<e.length;++r)if(e[r].length===0)throw new Jr(tr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Eo(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AE{constructor(e,r){if(!isFinite(e)||e<-90||e>90)throw new Jr(tr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(r)||r<-180||r>180)throw new Jr(tr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=e,this._long=r}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return wn(this._lat,e._lat)||wn(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vre=/^__.*__$/;class Ure{constructor(e,r,s){this.data=e,this.fieldMask=r,this.fieldTransforms=s}toMutation(e,r){return this.fieldMask!==null?new _m(e,this.data,this.fieldMask,r,this.fieldTransforms):new D1(e,this.data,r,this.fieldTransforms)}}function U9(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ci()}}class IE{constructor(e,r,s,c,d,_){this.settings=e,this.databaseId=r,this.serializer=s,this.ignoreUndefinedProperties=c,d===void 0&&this.mu(),this.fieldTransforms=d||[],this.fieldMask=_||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new IE(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var r;const s=(r=this.path)===null||r===void 0?void 0:r.child(e),c=this.gu({path:s,yu:!1});return c.wu(e),c}Su(e){var r;const s=(r=this.path)===null||r===void 0?void 0:r.child(e),c=this.gu({path:s,yu:!1});return c.mu(),c}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return dT(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return this.fieldMask.find(r=>e.isPrefixOf(r))!==void 0||this.fieldTransforms.find(r=>e.isPrefixOf(r.field))!==void 0}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(e.length===0)throw this.Du("Document fields must not be empty");if(U9(this.fu)&&Vre.test(e))throw this.Du('Document fields cannot begin and end with "__"')}}class jre{constructor(e,r,s){this.databaseId=e,this.ignoreUndefinedProperties=r,this.serializer=s||xE(e)}Fu(e,r,s,c=!1){return new IE({fu:e,methodName:r,vu:s,path:Eo.emptyPath(),yu:!1,Cu:c},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function j9(n){const e=n._freezeSettings(),r=xE(n._databaseId);return new jre(n._databaseId,!!e.ignoreUndefinedProperties,r)}function $9(n,e,r,s,c,d={}){const _=n.Fu(d.merge||d.mergeFields?2:0,e,r,c);H9("Data must be an object, but it was:",_,s);const x=G9(s,_);let l,S;if(d.merge)l=new vc(_.fieldMask),S=_.fieldTransforms;else if(d.mergeFields){const D=[];for(const I of d.mergeFields){const V=Gre(e,I,r);if(!_.contains(V))throw new Jr(tr.INVALID_ARGUMENT,`Field '${V}' is specified in your field mask but missing from your input data.`);Hre(D,V)||D.push(V)}l=new vc(D),S=_.fieldTransforms.filter(I=>l.covers(I.field))}else l=null,S=_.fieldTransforms;return new Ure(new Ol(x),l,S)}function $re(n,e,r){return new IE({fu:3,vu:e.settings.vu,methodName:n._methodName,yu:r},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class yR extends gR{constructor(e,r){super(e),this.Mu=r}_toFieldTransform(e){const r=$re(this,e,!0),s=this.Mu.map(d=>vR(d,r)),c=new Dg(s);return new Vee(e.path,c)}isEqual(e){return e instanceof yR&&Zv(this.Mu,e.Mu)}}function vR(n,e){if(q9(n=va(n)))return H9("Unsupported field value:",e,n),G9(n,e);if(n instanceof gR)return function(s,c){if(!U9(c.fu))throw c.Du(`${s._methodName}() can only be used with update() and set()`);if(!c.path)throw c.Du(`${s._methodName}() is not currently supported inside arrays`);const d=s._toFieldTransform(c);d&&c.fieldTransforms.push(d)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.yu&&e.fu!==4)throw e.Du("Nested arrays are not supported");return function(s,c){const d=[];let _=0;for(const x of s){let l=vR(x,c.bu(_));l==null&&(l={nullValue:"NULL_VALUE"}),d.push(l),_++}return{arrayValue:{values:d}}}(n,e)}return function(s,c){if((s=va(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return Fee(c.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const d=zs.fromDate(s);return{timestampValue:cT(c.serializer,d)}}if(s instanceof zs){const d=new zs(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:cT(c.serializer,d)}}if(s instanceof AE)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof zg)return{bytesValue:u9(c.serializer,s._byteString)};if(s instanceof Na){const d=c.databaseId,_=s.firestore._databaseId;if(!_.isEqual(d))throw c.Du(`Document reference is for database ${_.projectId}/${_.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:JC(s.firestore._databaseId||c.databaseId,s._key.path)}}throw c.Du(`Unsupported field value: ${mR(s)}`)}(n,e)}function G9(n,e){const r={};return NB(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):r0(n,(s,c)=>{const d=vR(c,e.pu(s));d!=null&&(r[s]=d)}),{mapValue:{fields:r}}}function q9(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof zs||n instanceof AE||n instanceof zg||n instanceof Na||n instanceof gR)}function H9(n,e,r){if(!q9(r)||!function(c){return typeof c=="object"&&c!==null&&(Object.getPrototypeOf(c)===Object.prototype||Object.getPrototypeOf(c)===null)}(r)){const s=mR(r);throw s==="an object"?e.Du(n+" a custom object"):e.Du(n+" "+s)}}function Gre(n,e,r){if((e=va(e))instanceof _R)return e._internalPath;if(typeof e=="string")return W9(n,e);throw dT("Field path arguments must be of type string or ",n,!1,void 0,r)}const qre=new RegExp("[~\\*/\\[\\]]");function W9(n,e,r){if(e.search(qre)>=0)throw dT(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,r);try{return new _R(...e.split("."))._internalPath}catch{throw dT(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,r)}}function dT(n,e,r,s,c){const d=s&&!s.isEmpty(),_=c!==void 0;let x=`Function ${e}() called with invalid data`;r&&(x+=" (via `toFirestore()`)"),x+=". ";let l="";return(d||_)&&(l+=" (found",d&&(l+=` in field ${s}`),_&&(l+=` in document ${c}`),l+=")"),new Jr(tr.INVALID_ARGUMENT,x+n+l)}function Hre(n,e){return n.some(r=>r.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z9{constructor(e,r,s,c,d){this._firestore=e,this._userDataWriter=r,this._key=s,this._document=c,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new Na(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Wre(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const r=this._document.data.field(X9("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r)}}}class Wre extends Z9{data(){return super.data()}}function X9(n,e){return typeof e=="string"?W9(n,e):e instanceof _R?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y9(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Jr(tr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Zre{convertValue(e,r="none"){switch(tm(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ls(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,r);case 5:return e.stringValue;case 6:return this.convertBytes(em(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,r);case 10:return this.convertObject(e.mapValue,r);default:throw Ci()}}convertObject(e,r){return this.convertObjectMap(e.fields,r)}convertObjectMap(e,r="none"){const s={};return r0(e,(c,d)=>{s[c]=this.convertValue(d,r)}),s}convertGeoPoint(e){return new AE(Ls(e.latitude),Ls(e.longitude))}convertArray(e,r){return(e.values||[]).map(s=>this.convertValue(s,r))}convertServerTimestamp(e,r){switch(r){case"previous":const s=WC(e);return s==null?null:this.convertValue(s,r);case"estimate":return this.convertTimestamp(e1(e));default:return null}}convertTimestamp(e){const r=Kd(e);return new zs(r.seconds,r.nanos)}convertDocumentKey(e,r){const s=ts.fromString(e);qn(_9(s));const c=new t1(s.get(1),s.get(3)),d=new ci(s.popFirst(5));return c.isEqual(r)||_h(`Document ${d} contains a document reference within a different database (${c.projectId}/${c.database}) which is not supported. It will be treated as a reference in the current database (${r.projectId}/${r.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q9(n,e,r){let s;return s=n?n.toFirestore(e):e,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jy{constructor(e,r){this.hasPendingWrites=e,this.fromCache=r}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class K9 extends Z9{constructor(e,r,s,c,d,_){super(e,r,s,c,_),this._firestore=e,this._firestoreImpl=e,this.metadata=d}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const r=new Tw(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,r={}){if(this._document){const s=this._document.data.field(X9("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,r.serverTimestamps)}}}class Tw extends K9{data(e={}){return super.data(e)}}class J9{constructor(e,r,s,c){this._firestore=e,this._userDataWriter=r,this._snapshot=c,this.metadata=new Jy(c.hasPendingWrites,c.fromCache),this.query=s}get docs(){const e=[];return this.forEach(r=>e.push(r)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,r){this._snapshot.docs.forEach(s=>{e.call(r,new Tw(this._firestore,this._userDataWriter,s.key,s,new Jy(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const r=!!e.includeMetadataChanges;if(r&&this._snapshot.excludesMetadataChanges)throw new Jr(tr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===r||(this._cachedChanges=function(c,d){if(c._snapshot.oldDocs.isEmpty()){let _=0;return c._snapshot.docChanges.map(x=>{const l=new Tw(c._firestore,c._userDataWriter,x.doc.key,x.doc,new Jy(c._snapshot.mutatedKeys.has(x.doc.key),c._snapshot.fromCache),c.query.converter);return x.doc,{type:"added",doc:l,oldIndex:-1,newIndex:_++}})}{let _=c._snapshot.oldDocs;return c._snapshot.docChanges.filter(x=>d||x.type!==3).map(x=>{const l=new Tw(c._firestore,c._userDataWriter,x.doc.key,x.doc,new Jy(c._snapshot.mutatedKeys.has(x.doc.key),c._snapshot.fromCache),c.query.converter);let S=-1,D=-1;return x.type!==0&&(S=_.indexOf(x.doc.key),_=_.delete(x.doc.key)),x.type!==1&&(_=_.add(x.doc),D=_.indexOf(x.doc.key)),{type:Xre(x.type),doc:l,oldIndex:S,newIndex:D}})}}(this,r),this._cachedChangesIncludeMetadataChanges=r),this._cachedChanges}}function Xre(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ci()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e8(n){n=Ic(n,Na);const e=Ic(n.firestore,rm);return Lre(EE(e),n._key).then(r=>r8(e,n,r))}class xR extends Zre{constructor(e){super(),this.firestore=e}convertBytes(e){return new zg(e)}convertReference(e){const r=this.convertDocumentKey(e,this.firestore._databaseId);return new Na(this.firestore,null,r)}}function Yre(n){n=Ic(n,F1);const e=Ic(n.firestore,rm),r=EE(e),s=new xR(e);return Y9(n._query),Ore(r,n._query).then(c=>new J9(e,s,n,c))}function Qre(n,e,r){n=Ic(n,Na);const s=Ic(n.firestore,rm),c=Q9(n.converter,e);return t8(s,[$9(j9(s),"setDoc",n._key,c,n.converter!==null,r).toMutation(n._key,hu.none())])}function Kre(n,e){const r=Ic(n.firestore,rm),s=B9(n),c=Q9(n.converter,e);return t8(r,[$9(j9(n.firestore),"addDoc",s._key,c,n.converter!==null,{}).toMutation(s._key,hu.exists(!1))]).then(()=>s)}function bR(n,...e){var r,s,c;n=va(n);let d={includeMetadataChanges:!1,source:"default"},_=0;typeof e[_]!="object"||wL(e[_])||(d=e[_],_++);const x={includeMetadataChanges:d.includeMetadataChanges,source:d.source};if(wL(e[_])){const I=e[_];e[_]=(r=I.next)===null||r===void 0?void 0:r.bind(I),e[_+1]=(s=I.error)===null||s===void 0?void 0:s.bind(I),e[_+2]=(c=I.complete)===null||c===void 0?void 0:c.bind(I)}let l,S,D;if(n instanceof Na)S=Ic(n.firestore,rm),D=pE(n._key.path),l={next:I=>{e[_]&&e[_](r8(S,n,I))},error:e[_+1],complete:e[_+2]};else{const I=Ic(n,F1);S=Ic(I.firestore,rm),D=I._query;const V=new xR(S);l={next:j=>{e[_]&&e[_](new J9(S,V,I,j))},error:e[_+1],complete:e[_+2]},Y9(n._query)}return function(V,j,Q,te){const ce=new pR(te),Ce=new dR(j,ce,Q);return V.asyncQueue.enqueueAndForget(async()=>cR(await hT(V),Ce)),()=>{ce.$a(),V.asyncQueue.enqueueAndForget(async()=>uR(await hT(V),Ce))}}(EE(S),D,x,l)}function t8(n,e){return function(s,c){const d=new fh;return s.asyncQueue.enqueueAndForget(async()=>bre(await Dre(s),c,d)),d.promise}(EE(n),e)}function r8(n,e,r){const s=r.docs.get(e._key),c=new xR(n);return new K9(n,c,e._key,s,new Jy(r.hasPendingWrites,r.fromCache),e.converter)}function Jre(...n){return new yR("arrayUnion",n)}(function(e,r=!0){(function(c){t0=c})(cf),qa(new xa("firestore",(s,{instanceIdentifier:c,options:d})=>{const _=s.getProvider("app").getImmediate(),x=new rm(new eee(s.getProvider("auth-internal")),new nee(s.getProvider("app-check-internal")),function(S,D){if(!Object.prototype.hasOwnProperty.apply(S.options,["projectId"]))throw new Jr(tr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new t1(S.options.projectId,D)}(_,c),_);return d=Object.assign({useFetchStreams:r},d),x._setSettings(d),x},"PUBLIC").setMultipleInstances(!0)),Io(jD,"4.6.3",e),Io(jD,"4.6.3","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i8="firebasestorage.googleapis.com",eie="storageBucket",tie=2*60*1e3,rie=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xu extends Wl{constructor(e,r,s=0){super(cA(e),`Firebase Storage: ${r} (${cA(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,xu.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return cA(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var yu;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(yu||(yu={}));function cA(n){return"storage/"+n}function iie(){const n="An unknown error occurred, please check the error payload for server response.";return new xu(yu.UNKNOWN,n)}function nie(){return new xu(yu.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function sie(){return new xu(yu.CANCELED,"User canceled the upload/download.")}function oie(n){return new xu(yu.INVALID_URL,"Invalid URL '"+n+"'.")}function aie(n){return new xu(yu.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function TL(n){return new xu(yu.INVALID_ARGUMENT,n)}function n8(){return new xu(yu.APP_DELETED,"The Firebase app was deleted.")}function lie(n){return new xu(yu.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc{constructor(e,r){this.bucket=e,this.path_=r}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,r){let s;try{s=xc.makeFromUrl(e,r)}catch{return new xc(e,"")}if(s.path==="")return s;throw aie(e)}static makeFromUrl(e,r){let s=null;const c="([A-Za-z0-9.\\-_]+)";function d(Te){Te.path.charAt(Te.path.length-1)==="/"&&(Te.path_=Te.path_.slice(0,-1))}const _="(/(.*))?$",x=new RegExp("^gs://"+c+_,"i"),l={bucket:1,path:3};function S(Te){Te.path_=decodeURIComponent(Te.path)}const D="v[A-Za-z0-9_]+",I=r.replace(/[.]/g,"\\."),V="(/([^?#]*).*)?$",j=new RegExp(`^https?://${I}/${D}/b/${c}/o${V}`,"i"),Q={bucket:1,path:3},te=r===i8?"(?:storage.googleapis.com|storage.cloud.google.com)":r,ce="([^?#]*)",Ce=new RegExp(`^https?://${te}/${c}/${ce}`,"i"),Ie=[{regex:x,indices:l,postModify:d},{regex:j,indices:Q,postModify:S},{regex:Ce,indices:{bucket:1,path:2},postModify:S}];for(let Te=0;Te<Ie.length;Te++){const Ge=Ie[Te],$e=Ge.regex.exec(e);if($e){const ue=$e[Ge.indices.bucket];let pe=$e[Ge.indices.path];pe||(pe=""),s=new xc(ue,pe),Ge.postModify(s);break}}if(s==null)throw oie(e);return s}}class cie{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uie(n,e,r){let s=1,c=null,d=null,_=!1,x=0;function l(){return x===2}let S=!1;function D(...ce){S||(S=!0,e.apply(null,ce))}function I(ce){c=setTimeout(()=>{c=null,n(j,l())},ce)}function V(){d&&clearTimeout(d)}function j(ce,...Ce){if(S){V();return}if(ce){V(),D.call(null,ce,...Ce);return}if(l()||_){V(),D.call(null,ce,...Ce);return}s<64&&(s*=2);let Ie;x===1?(x=2,Ie=0):Ie=(s+Math.random())*1e3,I(Ie)}let Q=!1;function te(ce){Q||(Q=!0,V(),!S&&(c!==null?(ce||(x=2),clearTimeout(c),I(0)):ce||(x=1)))}return I(0),d=setTimeout(()=>{_=!0,te(!0)},r),te}function hie(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function die(n){return n!==void 0}function EL(n,e,r,s){if(s<e)throw TL(`Invalid value for '${n}'. Expected ${e} or greater.`);if(s>r)throw TL(`Invalid value for '${n}'. Expected ${r} or less.`)}function fie(n){const e=encodeURIComponent;let r="?";for(const s in n)if(n.hasOwnProperty(s)){const c=e(s)+"="+e(n[s]);r=r+c+"&"}return r=r.slice(0,-1),r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fT;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(fT||(fT={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pie(n,e){const r=n>=500&&n<600,c=[408,429].indexOf(n)!==-1,d=e.indexOf(n)!==-1;return r||c||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mie{constructor(e,r,s,c,d,_,x,l,S,D,I,V=!0){this.url_=e,this.method_=r,this.headers_=s,this.body_=c,this.successCodes_=d,this.additionalRetryCodes_=_,this.callback_=x,this.errorCallback_=l,this.timeout_=S,this.progressCallback_=D,this.connectionFactory_=I,this.retry=V,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((j,Q)=>{this.resolve_=j,this.reject_=Q,this.start_()})}start_(){const e=(s,c)=>{if(c){s(!1,new jb(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const _=x=>{const l=x.loaded,S=x.lengthComputable?x.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,S)};this.progressCallback_!==null&&d.addUploadProgressListener(_),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(_),this.pendingConnection_=null;const x=d.getErrorCode()===fT.NO_ERROR,l=d.getStatus();if(!x||pie(l,this.additionalRetryCodes_)&&this.retry){const D=d.getErrorCode()===fT.ABORT;s(!1,new jb(!1,null,D));return}const S=this.successCodes_.indexOf(l)!==-1;s(!0,new jb(S,d))})},r=(s,c)=>{const d=this.resolve_,_=this.reject_,x=c.connection;if(c.wasSuccessCode)try{const l=this.callback_(x,x.getResponse());die(l)?d(l):d()}catch(l){_(l)}else if(x!==null){const l=iie();l.serverResponse=x.getErrorText(),this.errorCallback_?_(this.errorCallback_(x,l)):_(l)}else if(c.canceled){const l=this.appDelete_?n8():sie();_(l)}else{const l=nie();_(l)}};this.canceled_?r(!1,new jb(!1,null,!0)):this.backoffId_=uie(e,r,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&hie(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class jb{constructor(e,r,s){this.wasSuccessCode=e,this.connection=r,this.canceled=!!s}}function _ie(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function gie(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function yie(n,e){e&&(n["X-Firebase-GMPID"]=e)}function vie(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function xie(n,e,r,s,c,d,_=!0){const x=fie(n.urlParams),l=n.url+x,S=Object.assign({},n.headers);return yie(S,e),_ie(S,r),gie(S,d),vie(S,s),new mie(l,n.method,S,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,c,_)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bie(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function wie(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pT{constructor(e,r){this._service=e,r instanceof xc?this._location=r:this._location=xc.makeFromUrl(r,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,r){return new pT(e,r)}get root(){const e=new xc(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return wie(this._location.path)}get storage(){return this._service}get parent(){const e=bie(this._location.path);if(e===null)return null;const r=new xc(this._location.bucket,e);return new pT(this._service,r)}_throwIfRoot(e){if(this._location.path==="")throw lie(e)}}function AL(n,e){const r=e==null?void 0:e[eie];return r==null?null:xc.makeFromBucketSpec(r,n)}class Tie{constructor(e,r,s,c,d){this.app=e,this._authProvider=r,this._appCheckProvider=s,this._url=c,this._firebaseVersion=d,this._bucket=null,this._host=i8,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=tie,this._maxUploadRetryTime=rie,this._requests=new Set,c!=null?this._bucket=xc.makeFromBucketSpec(c,this._host):this._bucket=AL(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=xc.makeFromBucketSpec(this._url,e):this._bucket=AL(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){EL("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){EL("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const r=await e.getToken();if(r!==null)return r.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new pT(this,e)}_makeRequest(e,r,s,c,d=!0){if(this._deleted)return new cie(n8());{const _=xie(e,this._appId,s,c,r,this._firebaseVersion,d);return this._requests.add(_),_.getPromise().then(()=>this._requests.delete(_),()=>this._requests.delete(_)),_}}async makeRequestWithTokens(e,r){const[s,c]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,r,s,c).getPromise()}}const IL="@firebase/storage",SL="0.12.5";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eie="storage";function Aie(n,{instanceIdentifier:e}){const r=n.getProvider("app").getImmediate(),s=n.getProvider("auth-internal"),c=n.getProvider("app-check-internal");return new Tie(r,s,c,e,cf)}function Iie(){qa(new xa(Eie,Aie,"PUBLIC").setMultipleInstances(!0)),Io(IL,SL,""),Io(IL,SL,"esm2017")}Iie();const uA=new WeakMap;function s8(n,e){return uA.has(e)||uA.set(e,{f:{},r:{},s:{},u:{}}),uA.get(e)}function Sie(n,e,r,s){if(!n)return r;const[c,d]=o8(n);if(!c)return r;const _=s8(void 0,s)[c]||{},x=e||d;return x&&x in _?_[x]:r}function Cie(n,e,r,s){if(!n)return;const[c,d]=o8(n);if(!c)return;const _=s8(void 0,s)[c],x=e||d;if(x)return r.then(l=>{_[x]=l}).catch(ru),x}function o8(n){return iQ(n)||nQ(n)?["f",n.path]:sQ(n)?["r",n.toString()]:oQ(n)?["s",n.toString()]:[]}const hA=new WeakMap;function Rie(n,e,r){const s=oE();hA.has(s)||hA.set(s,new Map);const c=hA.get(s),d=Cie(e,r,n,s);return d&&c.set(d,n),d?()=>c.delete(d):ru}const Pie={toFirestore(n){return n},fromFirestore(n,e){return n.exists()?Object.defineProperties(n.data(e),{id:{value:n.id}}):null}};function VI(n,e,r,s){if(!tQ(n))return[n,{}];const c=[{},{}],d=Object.keys(r).reduce((x,l)=>{const S=r[l];return x[S.path]=S.data(),x},{});function _(x,l,S,D){l=l||{};const[I,V]=D;Object.getOwnPropertyNames(x).forEach(j=>{const Q=Object.getOwnPropertyDescriptor(x,j);Q&&!Q.enumerable&&Object.defineProperty(I,j,Q)});for(const j in x){const Q=x[j];if(Q==null||Q instanceof Date||Q instanceof zs||Q instanceof AE)I[j]=Q;else if(bC(Q)){const te=S+j;I[j]=te in r?l[j]:Q.path,V[te]=Q.converter?Q:Q.withConverter(s.converter)}else if(Array.isArray(Q)){I[j]=Array(Q.length);for(let te=0;te<Q.length;te++){const ce=Q[te];ce&&ce.path in d&&(I[j][te]=d[ce.path])}_(Q,l[j]||I[j],S+j+".",[I[j],V])}else fm(Q)?(I[j]={},_(Q,l[j],S+j+".",[I[j],V])):I[j]=Q}}return _(n,e,"",c),c}const wR={reset:!1,wait:!0,maxRefDepth:2,converter:Pie,snapshotOptions:{serverTimestamps:"estimate"}};function mT(n){for(const e in n)n[e].unsub()}function UI(n,e,r,s,c,d,_,x,l){const[S,D]=VI(s.data(n.snapshotOptions),xC(e,r),c,n);d.set(e,r,S),jI(n,e,r,c,D,d,_,x,l)}function Mie({ref:n,target:e,path:r,depth:s,resolve:c,reject:d,ops:_},x){const l=Object.create(null);let S=ru;return x.once?e8(n).then(D=>{D.exists()?UI(x,e,r,D,l,_,s,c,d):(_.set(e,r,null),c())}).catch(d):S=bR(n,D=>{D.exists()?UI(x,e,r,D,l,_,s,c,d):(_.set(e,r,null),c())},d),()=>{S(),mT(l)}}function jI(n,e,r,s,c,d,_,x,l){const S=Object.keys(c);if(Object.keys(s).filter(te=>S.indexOf(te)<0).forEach(te=>{s[te].unsub(),delete s[te]}),!S.length||++_>n.maxRefDepth)return x(r);let I=0;const V=S.length,j=Object.create(null);function Q(te){te in j&&++I>=V&&x(r)}S.forEach(te=>{const ce=s[te],Ce=c[te],Me=`${r}.${te}`;if(j[Me]=!0,ce)if(ce.path!==Ce.path)ce.unsub();else return;s[te]={data:()=>xC(e,Me),unsub:Mie({ref:Ce,target:e,path:Me,depth:_,ops:d,resolve:Q.bind(null,Me),reject:l},n),path:Ce.path}})}function kie(n,e,r,s,c,d){const _=Object.assign({},wR,d),{snapshotListenOptions:x,snapshotOptions:l,wait:S,once:D}=_,I="value";let V=mn(S?[]:n.value);S||r.set(n,I,[]);const j=s;let Q,te=ru;const ce=[],Ce={added:({newIndex:Ie,doc:Te})=>{ce.splice(Ie,0,Object.create(null));const Ge=ce[Ie],[$e,ue]=VI(Te.data(l),void 0,Ge,_);r.add(th(V),Ie,$e),jI(_,V,`${I}.${Ie}`,Ge,ue,r,0,s.bind(null,Te),c)},modified:({oldIndex:Ie,newIndex:Te,doc:Ge})=>{const $e=th(V),ue=ce[Ie],pe=$e[Ie],[_e,ge]=VI(Ge.data(l),pe,ue,_);ce.splice(Te,0,ue),r.remove($e,Ie),r.add($e,Te,_e),jI(_,V,`${I}.${Te}`,ue,ge,r,0,s,c)},removed:({oldIndex:Ie})=>{const Te=th(V);r.remove(Te,Ie),mT(ce.splice(Ie,1)[0])}};function Me(Ie){const Te=Ie.docChanges(x);if(!Q&&Te.length){Q=!0;let Ge=0;const $e=Te.length,ue=Object.create(null);for(let pe=0;pe<$e;pe++)ue[Te[pe].doc.id]=!0;s=pe=>{pe&&pe.id in ue&&++Ge>=$e&&(S&&(r.set(n,I,th(V)),V=n),j(th(V)),s=ru)}}Te.forEach(Ge=>{Ce[Ge.type](Ge)}),Te.length||(S&&(r.set(n,I,th(V)),V=n),s(th(V)))}return D?Yre(e).then(Me).catch(c):te=bR(e,Me,c),Ie=>{if(te(),Ie){const Te=typeof Ie=="function"?Ie():[];r.set(n,I,Te)}ce.forEach(mT)}}function Die(n,e,r,s,c,d){const _=Object.assign({},wR,d),x="value",l=Object.create(null);s=aQ(s,()=>xC(n,x));let S=ru;function D(I){I.exists()?UI(_,n,x,I,l,r,0,s,c):(r.set(n,x,null),s(null))}return _.once?e8(e).then(D).catch(c):S=bR(e,D,c),I=>{if(S(),I){const V=typeof I=="function"?I():null;r.set(n,x,V)}mT(l)}}const CL=Symbol();function a8(n,e){let r=ru;const s=Object.assign({},wR,e),c=th(n),d=s.target||mn();cQ()&&(s.once=!0);const _=Sie(c,s.ssrKey,CL,oE()),x=_!==CL;x&&(d.value=_);let l=!x;const S=mn(!1),D=mn(),I=Ez(),V=oz();let j=ru;function Q(){let Ce=th(n);const Me=new Promise((Ie,Te)=>{if(r(s.reset),!Ce)return r=ru,Ie(null);S.value=l,l=!0,Ce.converter||(Ce=Ce.withConverter(s.converter)),r=(bC(Ce)?Die:kie)(d,Ce,Lie,Ie,Te,s)}).catch(Ie=>(I.value===Me&&(D.value=Ie),Promise.reject(Ie))).finally(()=>{I.value===Me&&(S.value=!1)});I.value=Me}let te=ru;(ya(n)||typeof n=="function")&&(te=Bd(n,Q)),Q(),c&&(j=Rie(I.value,c,s.ssrKey)),Jz()&&Fz(()=>I.value),V&&P$(ce);function ce(Ce=s.reset){te(),j(),r(Ce)}return Object.defineProperties(d,{error:{get:()=>D},data:{get:()=>d},pending:{get:()=>S},promise:{get:()=>I},stop:{get:()=>ce}})}const Lie={set:(n,e,r)=>JY(n,e,r),add:(n,e,r)=>n.splice(e,0,r),remove:(n,e)=>n.splice(e,1)};function Oie(n,e){return a8(n,{target:mn([]),...e})}function zie(n,e){return a8(n,e)}function Fie(n){return Nie({initialUser:n,dependencies:{popupRedirectResolver:xY,persistence:[PX,yX,iN]}})}const l8=Symbol("VueFireAuth");function Nie({dependencies:n,initialUser:e}){return(r,s)=>{const[c,d]=Bie(r,s,e,n);dQ(c,d)}}function Bie(n,e,r,s,c=eX(n,s)){const d=uQ(n,e).run(()=>mn(r));return _N.set(n,d),e.provide(l8,c),[d,c]}function Vie(n){return KY?Fa(l8):null}function Uie(n,{firebaseApp:e,modules:r=[]}){n.provide(mN,e);for(const s of r)s(e,n)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ea=n=>(e,r)=>{r!==void 0?r.addInitializer(()=>{customElements.define(n,e)}):customElements.define(n,e)};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ew=globalThis,TR=Ew.ShadowRoot&&(Ew.ShadyCSS===void 0||Ew.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,ER=Symbol(),RL=new WeakMap;let c8=class{constructor(e,r,s){if(this._$cssResult$=!0,s!==ER)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=r}get styleSheet(){let e=this.o;const r=this.t;if(TR&&e===void 0){const s=r!==void 0&&r.length===1;s&&(e=RL.get(r)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),s&&RL.set(r,e))}return e}toString(){return this.cssText}};const jie=n=>new c8(typeof n=="string"?n:n+"",void 0,ER),xs=(n,...e)=>{const r=n.length===1?n[0]:e.reduce((s,c,d)=>s+(_=>{if(_._$cssResult$===!0)return _.cssText;if(typeof _=="number")return _;throw Error("Value passed to 'css' function must be a 'css' function result: "+_+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(c)+n[d+1],n[0]);return new c8(r,n,ER)},$ie=(n,e)=>{if(TR)n.adoptedStyleSheets=e.map(r=>r instanceof CSSStyleSheet?r:r.styleSheet);else for(const r of e){const s=document.createElement("style"),c=Ew.litNonce;c!==void 0&&s.setAttribute("nonce",c),s.textContent=r.cssText,n.appendChild(s)}},PL=TR?n=>n:n=>n instanceof CSSStyleSheet?(e=>{let r="";for(const s of e.cssRules)r+=s.cssText;return jie(r)})(n):n;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:Gie,defineProperty:qie,getOwnPropertyDescriptor:Hie,getOwnPropertyNames:Wie,getOwnPropertySymbols:Zie,getPrototypeOf:Xie}=Object,Gd=globalThis,ML=Gd.trustedTypes,Yie=ML?ML.emptyScript:"",dA=Gd.reactiveElementPolyfillSupport,Ev=(n,e)=>n,_T={toAttribute(n,e){switch(e){case Boolean:n=n?Yie:null;break;case Object:case Array:n=n==null?n:JSON.stringify(n)}return n},fromAttribute(n,e){let r=n;switch(e){case Boolean:r=n!==null;break;case Number:r=n===null?null:Number(n);break;case Object:case Array:try{r=JSON.parse(n)}catch{r=null}}return r}},AR=(n,e)=>!Gie(n,e),kL={attribute:!0,type:String,converter:_T,reflect:!1,hasChanged:AR};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Gd.litPropertyMetadata??(Gd.litPropertyMetadata=new WeakMap);let $_=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,r=kL){if(r.state&&(r.attribute=!1),this._$Ei(),this.elementProperties.set(e,r),!r.noAccessor){const s=Symbol(),c=this.getPropertyDescriptor(e,s,r);c!==void 0&&qie(this.prototype,e,c)}}static getPropertyDescriptor(e,r,s){const{get:c,set:d}=Hie(this.prototype,e)??{get(){return this[r]},set(_){this[r]=_}};return{get(){return c==null?void 0:c.call(this)},set(_){const x=c==null?void 0:c.call(this);d.call(this,_),this.requestUpdate(e,x,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??kL}static _$Ei(){if(this.hasOwnProperty(Ev("elementProperties")))return;const e=Xie(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(Ev("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Ev("properties"))){const r=this.properties,s=[...Wie(r),...Zie(r)];for(const c of s)this.createProperty(c,r[c])}const e=this[Symbol.metadata];if(e!==null){const r=litPropertyMetadata.get(e);if(r!==void 0)for(const[s,c]of r)this.elementProperties.set(s,c)}this._$Eh=new Map;for(const[r,s]of this.elementProperties){const c=this._$Eu(r,s);c!==void 0&&this._$Eh.set(c,r)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const r=[];if(Array.isArray(e)){const s=new Set(e.flat(1/0).reverse());for(const c of s)r.unshift(PL(c))}else e!==void 0&&r.push(PL(e));return r}static _$Eu(e,r){const s=r.attribute;return s===!1?void 0:typeof s=="string"?s:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise(r=>this.enableUpdating=r),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(r=>r(this))}addController(e){var r;(this._$EO??(this._$EO=new Set)).add(e),this.renderRoot!==void 0&&this.isConnected&&((r=e.hostConnected)==null||r.call(e))}removeController(e){var r;(r=this._$EO)==null||r.delete(e)}_$E_(){const e=new Map,r=this.constructor.elementProperties;for(const s of r.keys())this.hasOwnProperty(s)&&(e.set(s,this[s]),delete this[s]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return $ie(e,this.constructor.elementStyles),e}connectedCallback(){var e;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$EO)==null||e.forEach(r=>{var s;return(s=r.hostConnected)==null?void 0:s.call(r)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$EO)==null||e.forEach(r=>{var s;return(s=r.hostDisconnected)==null?void 0:s.call(r)})}attributeChangedCallback(e,r,s){this._$AK(e,s)}_$EC(e,r){var d;const s=this.constructor.elementProperties.get(e),c=this.constructor._$Eu(e,s);if(c!==void 0&&s.reflect===!0){const _=(((d=s.converter)==null?void 0:d.toAttribute)!==void 0?s.converter:_T).toAttribute(r,s.type);this._$Em=e,_==null?this.removeAttribute(c):this.setAttribute(c,_),this._$Em=null}}_$AK(e,r){var d;const s=this.constructor,c=s._$Eh.get(e);if(c!==void 0&&this._$Em!==c){const _=s.getPropertyOptions(c),x=typeof _.converter=="function"?{fromAttribute:_.converter}:((d=_.converter)==null?void 0:d.fromAttribute)!==void 0?_.converter:_T;this._$Em=c,this[c]=x.fromAttribute(r,_.type),this._$Em=null}}requestUpdate(e,r,s){if(e!==void 0){if(s??(s=this.constructor.getPropertyOptions(e)),!(s.hasChanged??AR)(this[e],r))return;this.P(e,r,s)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(e,r,s){this._$AL.has(e)||this._$AL.set(e,r),s.reflect===!0&&this._$Em!==e&&(this._$Ej??(this._$Ej=new Set)).add(e)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(r){Promise.reject(r)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var s;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[d,_]of this._$Ep)this[d]=_;this._$Ep=void 0}const c=this.constructor.elementProperties;if(c.size>0)for(const[d,_]of c)_.wrapped!==!0||this._$AL.has(d)||this[d]===void 0||this.P(d,this[d],_)}let e=!1;const r=this._$AL;try{e=this.shouldUpdate(r),e?(this.willUpdate(r),(s=this._$EO)==null||s.forEach(c=>{var d;return(d=c.hostUpdate)==null?void 0:d.call(c)}),this.update(r)):this._$EU()}catch(c){throw e=!1,this._$EU(),c}e&&this._$AE(r)}willUpdate(e){}_$AE(e){var r;(r=this._$EO)==null||r.forEach(s=>{var c;return(c=s.hostUpdated)==null?void 0:c.call(s)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Ej&&(this._$Ej=this._$Ej.forEach(r=>this._$EC(r,this[r]))),this._$EU()}updated(e){}firstUpdated(e){}};$_.elementStyles=[],$_.shadowRootOptions={mode:"open"},$_[Ev("elementProperties")]=new Map,$_[Ev("finalized")]=new Map,dA==null||dA({ReactiveElement:$_}),(Gd.reactiveElementVersions??(Gd.reactiveElementVersions=[])).push("2.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Qie={attribute:!0,type:String,converter:_T,reflect:!1,hasChanged:AR},Kie=(n=Qie,e,r)=>{const{kind:s,metadata:c}=r;let d=globalThis.litPropertyMetadata.get(c);if(d===void 0&&globalThis.litPropertyMetadata.set(c,d=new Map),d.set(r.name,n),s==="accessor"){const{name:_}=r;return{set(x){const l=e.get.call(this);e.set.call(this,x),this.requestUpdate(_,l,n)},init(x){return x!==void 0&&this.P(_,void 0,n),x}}}if(s==="setter"){const{name:_}=r;return function(x){const l=this[_];e.call(this,x),this.requestUpdate(_,l,n)}}throw Error("Unsupported decorator location: "+s)};function lr(n){return(e,r)=>typeof r=="object"?Kie(n,e,r):((s,c,d)=>{const _=c.hasOwnProperty(d);return c.constructor.createProperty(d,_?{...s,wrapped:!0}:s),_?Object.getOwnPropertyDescriptor(c,d):void 0})(n,e,r)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Ks(n){return lr({...n,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const IR=(n,e,r)=>(r.configurable=!0,r.enumerable=!0,Reflect.decorate&&typeof e!="object"&&Object.defineProperty(n,e,r),r);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function _l(n,e){return(r,s,c)=>{const d=_=>{var x;return((x=_.renderRoot)==null?void 0:x.querySelector(n))??null};return IR(r,s,{get(){return d(this)}})}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function u8(n){return(e,r)=>IR(e,r,{async get(){var s;return await this.updateComplete,((s=this.renderRoot)==null?void 0:s.querySelector(n))??null}})}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function SE(n){return(e,r)=>{const{slot:s,selector:c}=n??{},d="slot"+(s?`[name=${s}]`:":not([name])");return IR(e,r,{get(){var l;const _=(l=this.renderRoot)==null?void 0:l.querySelector(d),x=(_==null?void 0:_.assignedElements(n))??[];return c===void 0?x:x.filter(S=>S.matches(c))}})}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Av=globalThis,gT=Av.trustedTypes,DL=gT?gT.createPolicy("lit-html",{createHTML:n=>n}):void 0,h8="$lit$",Pd=`lit$${Math.random().toFixed(9).slice(2)}$`,d8="?"+Pd,Jie=`<${d8}>`,im=document,n1=()=>im.createComment(""),s1=n=>n===null||typeof n!="object"&&typeof n!="function",f8=Array.isArray,ene=n=>f8(n)||typeof(n==null?void 0:n[Symbol.iterator])=="function",fA=`[ 	
\f\r]`,Fy=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,LL=/-->/g,OL=/>/g,gp=RegExp(`>|${fA}(?:([^\\s"'>=/]+)(${fA}*=${fA}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),zL=/'/g,FL=/"/g,p8=/^(?:script|style|textarea|title)$/i,tne=n=>(e,...r)=>({_$litType$:n,strings:e,values:r}),bi=tne(1),Bl=Symbol.for("lit-noChange"),Pr=Symbol.for("lit-nothing"),NL=new WeakMap,Pp=im.createTreeWalker(im,129);function m8(n,e){if(!Array.isArray(n)||!n.hasOwnProperty("raw"))throw Error("invalid template strings array");return DL!==void 0?DL.createHTML(e):e}const rne=(n,e)=>{const r=n.length-1,s=[];let c,d=e===2?"<svg>":"",_=Fy;for(let x=0;x<r;x++){const l=n[x];let S,D,I=-1,V=0;for(;V<l.length&&(_.lastIndex=V,D=_.exec(l),D!==null);)V=_.lastIndex,_===Fy?D[1]==="!--"?_=LL:D[1]!==void 0?_=OL:D[2]!==void 0?(p8.test(D[2])&&(c=RegExp("</"+D[2],"g")),_=gp):D[3]!==void 0&&(_=gp):_===gp?D[0]===">"?(_=c??Fy,I=-1):D[1]===void 0?I=-2:(I=_.lastIndex-D[2].length,S=D[1],_=D[3]===void 0?gp:D[3]==='"'?FL:zL):_===FL||_===zL?_=gp:_===LL||_===OL?_=Fy:(_=gp,c=void 0);const j=_===gp&&n[x+1].startsWith("/>")?" ":"";d+=_===Fy?l+Jie:I>=0?(s.push(S),l.slice(0,I)+h8+l.slice(I)+Pd+j):l+Pd+(I===-2?x:j)}return[m8(n,d+(n[r]||"<?>")+(e===2?"</svg>":"")),s]};let $I=class _8{constructor({strings:e,_$litType$:r},s){let c;this.parts=[];let d=0,_=0;const x=e.length-1,l=this.parts,[S,D]=rne(e,r);if(this.el=_8.createElement(S,s),Pp.currentNode=this.el.content,r===2){const I=this.el.content.firstChild;I.replaceWith(...I.childNodes)}for(;(c=Pp.nextNode())!==null&&l.length<x;){if(c.nodeType===1){if(c.hasAttributes())for(const I of c.getAttributeNames())if(I.endsWith(h8)){const V=D[_++],j=c.getAttribute(I).split(Pd),Q=/([.?@])?(.*)/.exec(V);l.push({type:1,index:d,name:Q[2],strings:j,ctor:Q[1]==="."?nne:Q[1]==="?"?sne:Q[1]==="@"?one:CE}),c.removeAttribute(I)}else I.startsWith(Pd)&&(l.push({type:6,index:d}),c.removeAttribute(I));if(p8.test(c.tagName)){const I=c.textContent.split(Pd),V=I.length-1;if(V>0){c.textContent=gT?gT.emptyScript:"";for(let j=0;j<V;j++)c.append(I[j],n1()),Pp.nextNode(),l.push({type:2,index:++d});c.append(I[V],n1())}}}else if(c.nodeType===8)if(c.data===d8)l.push({type:2,index:d});else{let I=-1;for(;(I=c.data.indexOf(Pd,I+1))!==-1;)l.push({type:7,index:d}),I+=Pd.length-1}d++}}static createElement(e,r){const s=im.createElement("template");return s.innerHTML=e,s}};function Fg(n,e,r=n,s){var _,x;if(e===Bl)return e;let c=s!==void 0?(_=r._$Co)==null?void 0:_[s]:r._$Cl;const d=s1(e)?void 0:e._$litDirective$;return(c==null?void 0:c.constructor)!==d&&((x=c==null?void 0:c._$AO)==null||x.call(c,!1),d===void 0?c=void 0:(c=new d(n),c._$AT(n,r,s)),s!==void 0?(r._$Co??(r._$Co=[]))[s]=c:r._$Cl=c),c!==void 0&&(e=Fg(n,c._$AS(n,e.values),c,s)),e}let ine=class{constructor(e,r){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=r}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:r},parts:s}=this._$AD,c=((e==null?void 0:e.creationScope)??im).importNode(r,!0);Pp.currentNode=c;let d=Pp.nextNode(),_=0,x=0,l=s[0];for(;l!==void 0;){if(_===l.index){let S;l.type===2?S=new SR(d,d.nextSibling,this,e):l.type===1?S=new l.ctor(d,l.name,l.strings,this,e):l.type===6&&(S=new ane(d,this,e)),this._$AV.push(S),l=s[++x]}_!==(l==null?void 0:l.index)&&(d=Pp.nextNode(),_++)}return Pp.currentNode=im,c}p(e){let r=0;for(const s of this._$AV)s!==void 0&&(s.strings!==void 0?(s._$AI(e,s,r),r+=s.strings.length-2):s._$AI(e[r])),r++}},SR=class g8{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this._$Cv}constructor(e,r,s,c){this.type=2,this._$AH=Pr,this._$AN=void 0,this._$AA=e,this._$AB=r,this._$AM=s,this.options=c,this._$Cv=(c==null?void 0:c.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const r=this._$AM;return r!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=r.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,r=this){e=Fg(this,e,r),s1(e)?e===Pr||e==null||e===""?(this._$AH!==Pr&&this._$AR(),this._$AH=Pr):e!==this._$AH&&e!==Bl&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):ene(e)?this.k(e):this._(e)}S(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.S(e))}_(e){this._$AH!==Pr&&s1(this._$AH)?this._$AA.nextSibling.data=e:this.T(im.createTextNode(e)),this._$AH=e}$(e){var d;const{values:r,_$litType$:s}=e,c=typeof s=="number"?this._$AC(e):(s.el===void 0&&(s.el=$I.createElement(m8(s.h,s.h[0]),this.options)),s);if(((d=this._$AH)==null?void 0:d._$AD)===c)this._$AH.p(r);else{const _=new ine(c,this),x=_.u(this.options);_.p(r),this.T(x),this._$AH=_}}_$AC(e){let r=NL.get(e.strings);return r===void 0&&NL.set(e.strings,r=new $I(e)),r}k(e){f8(this._$AH)||(this._$AH=[],this._$AR());const r=this._$AH;let s,c=0;for(const d of e)c===r.length?r.push(s=new g8(this.S(n1()),this.S(n1()),this,this.options)):s=r[c],s._$AI(d),c++;c<r.length&&(this._$AR(s&&s._$AB.nextSibling,c),r.length=c)}_$AR(e=this._$AA.nextSibling,r){var s;for((s=this._$AP)==null?void 0:s.call(this,!1,!0,r);e&&e!==this._$AB;){const c=e.nextSibling;e.remove(),e=c}}setConnected(e){var r;this._$AM===void 0&&(this._$Cv=e,(r=this._$AP)==null||r.call(this,e))}},CE=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,r,s,c,d){this.type=1,this._$AH=Pr,this._$AN=void 0,this.element=e,this.name=r,this._$AM=c,this.options=d,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=Pr}_$AI(e,r=this,s,c){const d=this.strings;let _=!1;if(d===void 0)e=Fg(this,e,r,0),_=!s1(e)||e!==this._$AH&&e!==Bl,_&&(this._$AH=e);else{const x=e;let l,S;for(e=d[0],l=0;l<d.length-1;l++)S=Fg(this,x[s+l],r,l),S===Bl&&(S=this._$AH[l]),_||(_=!s1(S)||S!==this._$AH[l]),S===Pr?e=Pr:e!==Pr&&(e+=(S??"")+d[l+1]),this._$AH[l]=S}_&&!c&&this.j(e)}j(e){e===Pr?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}},nne=class extends CE{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Pr?void 0:e}},sne=class extends CE{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Pr)}},one=class extends CE{constructor(e,r,s,c,d){super(e,r,s,c,d),this.type=5}_$AI(e,r=this){if((e=Fg(this,e,r,0)??Pr)===Bl)return;const s=this._$AH,c=e===Pr&&s!==Pr||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,d=e!==Pr&&(s===Pr||c);c&&this.element.removeEventListener(this.name,this,s),d&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var r;typeof this._$AH=="function"?this._$AH.call(((r=this.options)==null?void 0:r.host)??this.element,e):this._$AH.handleEvent(e)}},ane=class{constructor(e,r,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=r,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){Fg(this,e)}};const pA=Av.litHtmlPolyfillSupport;pA==null||pA($I,SR),(Av.litHtmlVersions??(Av.litHtmlVersions=[])).push("3.1.4");const y8=(n,e,r)=>{const s=(r==null?void 0:r.renderBefore)??e;let c=s._$litPart$;if(c===void 0){const d=(r==null?void 0:r.renderBefore)??null;s._$litPart$=c=new SR(e.insertBefore(n1(),d),d,void 0,r??{})}return c._$AI(n),c};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let Ys=class extends $_{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var r;const e=super.createRenderRoot();return(r=this.renderOptions).renderBefore??(r.renderBefore=e.firstChild),e}update(e){const r=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=y8(r,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return Bl}};var ZO;Ys._$litElement$=!0,Ys.finalized=!0,(ZO=globalThis.litElementHydrateSupport)==null||ZO.call(globalThis,{LitElement:Ys});const mA=globalThis.litElementPolyfillSupport;mA==null||mA({LitElement:Ys});(globalThis.litElementVersions??(globalThis.litElementVersions=[])).push("4.0.6");/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const v8=Symbol("attachableController");let Aw;Aw=new MutationObserver(n=>{var e;for(const r of n)(e=r.target[v8])==null||e.hostConnected()});class x8{get htmlFor(){return this.host.getAttribute("for")}set htmlFor(e){e===null?this.host.removeAttribute("for"):this.host.setAttribute("for",e)}get control(){return this.host.hasAttribute("for")?!this.htmlFor||!this.host.isConnected?null:this.host.getRootNode().querySelector(`#${this.htmlFor}`):this.currentControl||this.host.parentElement}set control(e){e?this.attach(e):this.detach()}constructor(e,r){this.host=e,this.onControlChange=r,this.currentControl=null,e.addController(this),e[v8]=this,Aw==null||Aw.observe(e,{attributeFilter:["for"]})}attach(e){e!==this.currentControl&&(this.setCurrentControl(e),this.host.removeAttribute("for"))}detach(){this.setCurrentControl(null),this.host.setAttribute("for","")}hostConnected(){this.setCurrentControl(this.control)}hostDisconnected(){this.setCurrentControl(null)}setCurrentControl(e){this.onControlChange(this.currentControl,e),this.currentControl=e}}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const lne=["focusin","focusout","pointerdown"];class CR extends Ys{constructor(){super(...arguments),this.visible=!1,this.inward=!1,this.attachableController=new x8(this,this.onControlChange.bind(this))}get htmlFor(){return this.attachableController.htmlFor}set htmlFor(e){this.attachableController.htmlFor=e}get control(){return this.attachableController.control}set control(e){this.attachableController.control=e}attach(e){this.attachableController.attach(e)}detach(){this.attachableController.detach()}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-hidden","true")}handleEvent(e){var r;if(!e[BL]){switch(e.type){default:return;case"focusin":this.visible=((r=this.control)==null?void 0:r.matches(":focus-visible"))??!1;break;case"focusout":case"pointerdown":this.visible=!1;break}e[BL]=!0}}onControlChange(e,r){for(const s of lne)e==null||e.removeEventListener(s,this),r==null||r.addEventListener(s,this)}update(e){e.has("visible")&&this.dispatchEvent(new Event("visibility-changed")),super.update(e)}}At([lr({type:Boolean,reflect:!0})],CR.prototype,"visible",void 0);At([lr({type:Boolean,reflect:!0})],CR.prototype,"inward",void 0);const BL=Symbol("handledByFocusRing");/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const cne=xs`:host{animation-delay:0s,calc(var(--md-focus-ring-duration, 600ms)*.25);animation-duration:calc(var(--md-focus-ring-duration, 600ms)*.25),calc(var(--md-focus-ring-duration, 600ms)*.75);animation-timing-function:cubic-bezier(0.2, 0, 0, 1);box-sizing:border-box;color:var(--md-focus-ring-color, var(--md-sys-color-secondary, #625b71));display:none;pointer-events:none;position:absolute}:host([visible]){display:flex}:host(:not([inward])){animation-name:outward-grow,outward-shrink;border-end-end-radius:calc(var(--md-focus-ring-shape-end-end, var(--md-focus-ring-shape, var(--md-sys-shape-corner-full, 9999px))) + var(--md-focus-ring-outward-offset, 2px));border-end-start-radius:calc(var(--md-focus-ring-shape-end-start, var(--md-focus-ring-shape, var(--md-sys-shape-corner-full, 9999px))) + var(--md-focus-ring-outward-offset, 2px));border-start-end-radius:calc(var(--md-focus-ring-shape-start-end, var(--md-focus-ring-shape, var(--md-sys-shape-corner-full, 9999px))) + var(--md-focus-ring-outward-offset, 2px));border-start-start-radius:calc(var(--md-focus-ring-shape-start-start, var(--md-focus-ring-shape, var(--md-sys-shape-corner-full, 9999px))) + var(--md-focus-ring-outward-offset, 2px));inset:calc(-1*var(--md-focus-ring-outward-offset, 2px));outline:var(--md-focus-ring-width, 3px) solid currentColor}:host([inward]){animation-name:inward-grow,inward-shrink;border-end-end-radius:calc(var(--md-focus-ring-shape-end-end, var(--md-focus-ring-shape, var(--md-sys-shape-corner-full, 9999px))) - var(--md-focus-ring-inward-offset, 0px));border-end-start-radius:calc(var(--md-focus-ring-shape-end-start, var(--md-focus-ring-shape, var(--md-sys-shape-corner-full, 9999px))) - var(--md-focus-ring-inward-offset, 0px));border-start-end-radius:calc(var(--md-focus-ring-shape-start-end, var(--md-focus-ring-shape, var(--md-sys-shape-corner-full, 9999px))) - var(--md-focus-ring-inward-offset, 0px));border-start-start-radius:calc(var(--md-focus-ring-shape-start-start, var(--md-focus-ring-shape, var(--md-sys-shape-corner-full, 9999px))) - var(--md-focus-ring-inward-offset, 0px));border:var(--md-focus-ring-width, 3px) solid currentColor;inset:var(--md-focus-ring-inward-offset, 0px)}@keyframes outward-grow{from{outline-width:0}to{outline-width:var(--md-focus-ring-active-width, 8px)}}@keyframes outward-shrink{from{outline-width:var(--md-focus-ring-active-width, 8px)}}@keyframes inward-grow{from{border-width:0}to{border-width:var(--md-focus-ring-active-width, 8px)}}@keyframes inward-shrink{from{border-width:var(--md-focus-ring-active-width, 8px)}}@media(prefers-reduced-motion){:host{animation:none}}
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let GI=class extends CR{};GI.styles=[cne];GI=At([ea("md-focus-ring")],GI);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Id={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},RR=n=>(...e)=>({_$litDirective$:n,values:e});let PR=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,r,s){this._$Ct=e,this._$AM=r,this._$Ci=s}_$AS(e,r){return this.update(e,r)}update(e,r){return this.render(...r)}};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const za=RR(class extends PR{constructor(n){var e;if(super(n),n.type!==Id.ATTRIBUTE||n.name!=="class"||((e=n.strings)==null?void 0:e.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(n){return" "+Object.keys(n).filter(e=>n[e]).join(" ")+" "}update(n,[e]){var s,c;if(this.st===void 0){this.st=new Set,n.strings!==void 0&&(this.nt=new Set(n.strings.join(" ").split(/\s/).filter(d=>d!=="")));for(const d in e)e[d]&&!((s=this.nt)!=null&&s.has(d))&&this.st.add(d);return this.render(e)}const r=n.element.classList;for(const d of this.st)d in e||(r.remove(d),this.st.delete(d));for(const d in e){const _=!!e[d];_===this.st.has(d)||(c=this.nt)!=null&&c.has(d)||(_?(r.add(d),this.st.add(d)):(r.remove(d),this.st.delete(d)))}return Bl}});/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const b8={STANDARD:"cubic-bezier(0.2, 0, 0, 1)",STANDARD_ACCELERATE:"cubic-bezier(.3,0,1,1)",STANDARD_DECELERATE:"cubic-bezier(0,0,0,1)",EMPHASIZED:"cubic-bezier(.3,0,0,1)",EMPHASIZED_ACCELERATE:"cubic-bezier(.3,0,.8,.15)",EMPHASIZED_DECELERATE:"cubic-bezier(.05,.7,.1,1)"};/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const une=450,VL=225,hne=.2,dne=10,fne=75,pne=.35,mne="::after",_ne="forwards";var ua;(function(n){n[n.INACTIVE=0]="INACTIVE",n[n.TOUCH_DELAY=1]="TOUCH_DELAY",n[n.HOLDING=2]="HOLDING",n[n.WAITING_FOR_CLICK=3]="WAITING_FOR_CLICK"})(ua||(ua={}));const gne=["click","contextmenu","pointercancel","pointerdown","pointerenter","pointerleave","pointerup"],yne=150,_A=window.matchMedia("(forced-colors: active)");class N1 extends Ys{constructor(){super(...arguments),this.disabled=!1,this.hovered=!1,this.pressed=!1,this.rippleSize="",this.rippleScale="",this.initialSize=0,this.state=ua.INACTIVE,this.checkBoundsAfterContextMenu=!1,this.attachableController=new x8(this,this.onControlChange.bind(this))}get htmlFor(){return this.attachableController.htmlFor}set htmlFor(e){this.attachableController.htmlFor=e}get control(){return this.attachableController.control}set control(e){this.attachableController.control=e}attach(e){this.attachableController.attach(e)}detach(){this.attachableController.detach()}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-hidden","true")}render(){const e={hovered:this.hovered,pressed:this.pressed};return bi`<div class="surface ${za(e)}"></div>`}update(e){e.has("disabled")&&this.disabled&&(this.hovered=!1,this.pressed=!1),super.update(e)}handlePointerenter(e){this.shouldReactToEvent(e)&&(this.hovered=!0)}handlePointerleave(e){this.shouldReactToEvent(e)&&(this.hovered=!1,this.state!==ua.INACTIVE&&this.endPressAnimation())}handlePointerup(e){if(this.shouldReactToEvent(e)){if(this.state===ua.HOLDING){this.state=ua.WAITING_FOR_CLICK;return}if(this.state===ua.TOUCH_DELAY){this.state=ua.WAITING_FOR_CLICK,this.startPressAnimation(this.rippleStartEvent);return}}}async handlePointerdown(e){if(this.shouldReactToEvent(e)){if(this.rippleStartEvent=e,!this.isTouch(e)){this.state=ua.WAITING_FOR_CLICK,this.startPressAnimation(e);return}this.checkBoundsAfterContextMenu&&!this.inBounds(e)||(this.checkBoundsAfterContextMenu=!1,this.state=ua.TOUCH_DELAY,await new Promise(r=>{setTimeout(r,yne)}),this.state===ua.TOUCH_DELAY&&(this.state=ua.HOLDING,this.startPressAnimation(e)))}}handleClick(){if(!this.disabled){if(this.state===ua.WAITING_FOR_CLICK){this.endPressAnimation();return}this.state===ua.INACTIVE&&(this.startPressAnimation(),this.endPressAnimation())}}handlePointercancel(e){this.shouldReactToEvent(e)&&this.endPressAnimation()}handleContextmenu(){this.disabled||(this.checkBoundsAfterContextMenu=!0,this.endPressAnimation())}determineRippleSize(){const{height:e,width:r}=this.getBoundingClientRect(),s=Math.max(e,r),c=Math.max(pne*s,fne),d=Math.floor(s*hne),x=Math.sqrt(r**2+e**2)+dne;this.initialSize=d,this.rippleScale=`${(x+c)/d}`,this.rippleSize=`${d}px`}getNormalizedPointerEventCoords(e){const{scrollX:r,scrollY:s}=window,{left:c,top:d}=this.getBoundingClientRect(),_=r+c,x=s+d,{pageX:l,pageY:S}=e;return{x:l-_,y:S-x}}getTranslationCoordinates(e){const{height:r,width:s}=this.getBoundingClientRect(),c={x:(s-this.initialSize)/2,y:(r-this.initialSize)/2};let d;return e instanceof PointerEvent?d=this.getNormalizedPointerEventCoords(e):d={x:s/2,y:r/2},d={x:d.x-this.initialSize/2,y:d.y-this.initialSize/2},{startPoint:d,endPoint:c}}startPressAnimation(e){var _;if(!this.mdRoot)return;this.pressed=!0,(_=this.growAnimation)==null||_.cancel(),this.determineRippleSize();const{startPoint:r,endPoint:s}=this.getTranslationCoordinates(e),c=`${r.x}px, ${r.y}px`,d=`${s.x}px, ${s.y}px`;this.growAnimation=this.mdRoot.animate({top:[0,0],left:[0,0],height:[this.rippleSize,this.rippleSize],width:[this.rippleSize,this.rippleSize],transform:[`translate(${c}) scale(1)`,`translate(${d}) scale(${this.rippleScale})`]},{pseudoElement:mne,duration:une,easing:b8.STANDARD,fill:_ne})}async endPressAnimation(){this.rippleStartEvent=void 0,this.state=ua.INACTIVE;const e=this.growAnimation;let r=1/0;if(typeof(e==null?void 0:e.currentTime)=="number"?r=e.currentTime:e!=null&&e.currentTime&&(r=e.currentTime.to("ms").value),r>=VL){this.pressed=!1;return}await new Promise(s=>{setTimeout(s,VL-r)}),this.growAnimation===e&&(this.pressed=!1)}shouldReactToEvent(e){if(this.disabled||!e.isPrimary||this.rippleStartEvent&&this.rippleStartEvent.pointerId!==e.pointerId)return!1;if(e.type==="pointerenter"||e.type==="pointerleave")return!this.isTouch(e);const r=e.buttons===1;return this.isTouch(e)||r}inBounds({x:e,y:r}){const{top:s,left:c,bottom:d,right:_}=this.getBoundingClientRect();return e>=c&&e<=_&&r>=s&&r<=d}isTouch({pointerType:e}){return e==="touch"}async handleEvent(e){if(!(_A!=null&&_A.matches))switch(e.type){case"click":this.handleClick();break;case"contextmenu":this.handleContextmenu();break;case"pointercancel":this.handlePointercancel(e);break;case"pointerdown":await this.handlePointerdown(e);break;case"pointerenter":this.handlePointerenter(e);break;case"pointerleave":this.handlePointerleave(e);break;case"pointerup":this.handlePointerup(e);break}}onControlChange(e,r){for(const s of gne)e==null||e.removeEventListener(s,this),r==null||r.addEventListener(s,this)}}At([lr({type:Boolean,reflect:!0})],N1.prototype,"disabled",void 0);At([Ks()],N1.prototype,"hovered",void 0);At([Ks()],N1.prototype,"pressed",void 0);At([_l(".surface")],N1.prototype,"mdRoot",void 0);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const vne=xs`:host{display:flex;margin:auto;pointer-events:none}:host([disabled]){display:none}@media(forced-colors: active){:host{display:none}}:host,.surface{border-radius:inherit;position:absolute;inset:0;overflow:hidden}.surface{-webkit-tap-highlight-color:rgba(0,0,0,0)}.surface::before,.surface::after{content:"";opacity:0;position:absolute}.surface::before{background-color:var(--md-ripple-hover-color, var(--md-sys-color-on-surface, #1d1b20));inset:0;transition:opacity 15ms linear,background-color 15ms linear}.surface::after{background:radial-gradient(closest-side, var(--md-ripple-pressed-color, var(--md-sys-color-on-surface, #1d1b20)) max(100% - 70px, 65%), transparent 100%);transform-origin:center center;transition:opacity 375ms linear}.hovered::before{background-color:var(--md-ripple-hover-color, var(--md-sys-color-on-surface, #1d1b20));opacity:var(--md-ripple-hover-opacity, 0.08)}.pressed::after{opacity:var(--md-ripple-pressed-opacity, 0.12);transition-duration:105ms}
`;/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let qI=class extends N1{};qI.styles=[vne];qI=At([ea("md-ripple")],qI);/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const w8=Symbol.for(""),xne=n=>{if((n==null?void 0:n.r)===w8)return n==null?void 0:n._$litStatic$},yT=(n,...e)=>({_$litStatic$:e.reduce((r,s,c)=>r+(d=>{if(d._$litStatic$!==void 0)return d._$litStatic$;throw Error(`Value passed to 'literal' function must be a 'literal' result: ${d}. Use 'unsafeStatic' to pass non-literal values, but
            take care to ensure page security.`)})(s)+n[c+1],n[0]),r:w8}),UL=new Map,bne=n=>(e,...r)=>{const s=r.length;let c,d;const _=[],x=[];let l,S=0,D=!1;for(;S<s;){for(l=e[S];S<s&&(d=r[S],(c=xne(d))!==void 0);)l+=c+e[++S],D=!0;S!==s&&x.push(d),_.push(l),S++}if(S===s&&_.push(e[s]),D){const I=_.join("$$lit$$");(e=UL.get(I))===void 0&&(_.raw=_,UL.set(I,e=_)),r=x}return n(e,...r)},T8=bne(bi);/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const E8=["role","ariaAtomic","ariaAutoComplete","ariaBusy","ariaChecked","ariaColCount","ariaColIndex","ariaColSpan","ariaCurrent","ariaDisabled","ariaExpanded","ariaHasPopup","ariaHidden","ariaInvalid","ariaKeyShortcuts","ariaLabel","ariaLevel","ariaLive","ariaModal","ariaMultiLine","ariaMultiSelectable","ariaOrientation","ariaPlaceholder","ariaPosInSet","ariaPressed","ariaReadOnly","ariaRequired","ariaRoleDescription","ariaRowCount","ariaRowIndex","ariaRowSpan","ariaSelected","ariaSetSize","ariaSort","ariaValueMax","ariaValueMin","ariaValueNow","ariaValueText"];E8.map(A8);function A8(n){return n.replace("aria","aria-").replace(/Elements?/g,"").toLowerCase()}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ym(n){for(const e of E8)n.createProperty(e,{attribute:A8(e),reflect:!0});n.addInitializer(e=>{const r={hostConnected(){e.setAttribute("role","presentation")}};e.addController(r)})}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const pa=Symbol("internals"),gA=Symbol("privateInternals");function s0(n){class e extends n{get[pa](){return this[gA]||(this[gA]=this.attachInternals()),this[gA]}}return e}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function I8(n){n.addInitializer(e=>{const r=e;r.addEventListener("click",async s=>{const{type:c,[pa]:d}=r,{form:_}=d;if(!(!_||c==="button")&&(await new Promise(x=>{setTimeout(x)}),!s.defaultPrevented)){if(c==="reset"){_.reset();return}_.addEventListener("submit",x=>{Object.defineProperty(x,"submitter",{configurable:!0,enumerable:!0,get:()=>r})},{capture:!0,once:!0}),d.setFormValue(r.value),_.requestSubmit()}})})}/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function jL(n,e=!0){return e&&getComputedStyle(n).getPropertyValue("direction").trim()==="rtl"}/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const wne=s0(Ys);class po extends wne{constructor(){super(...arguments),this.disabled=!1,this.flipIconInRtl=!1,this.href="",this.target="",this.ariaLabelSelected="",this.toggle=!1,this.selected=!1,this.type="submit",this.value="",this.flipIcon=jL(this,this.flipIconInRtl)}get name(){return this.getAttribute("name")??""}set name(e){this.setAttribute("name",e)}get form(){return this[pa].form}get labels(){return this[pa].labels}willUpdate(){this.href&&(this.disabled=!1)}render(){const e=this.href?yT`div`:yT`button`,{ariaLabel:r,ariaHasPopup:s,ariaExpanded:c}=this,d=r&&this.ariaLabelSelected,_=this.toggle?this.selected:Pr;let x=Pr;return this.href||(x=d&&this.selected?this.ariaLabelSelected:r),T8`<${e}
        class="icon-button ${za(this.getRenderClasses())}"
        id="button"
        aria-label="${x||Pr}"
        aria-haspopup="${!this.href&&s||Pr}"
        aria-expanded="${!this.href&&c||Pr}"
        aria-pressed="${_}"
        ?disabled="${!this.href&&this.disabled}"
        @click="${this.handleClick}">
        ${this.renderFocusRing()}
        ${this.renderRipple()}
        ${this.selected?Pr:this.renderIcon()}
        ${this.selected?this.renderSelectedIcon():Pr}
        ${this.renderTouchTarget()}
        ${this.href&&this.renderLink()}
  </${e}>`}renderLink(){const{ariaLabel:e}=this;return bi`
      <a
        class="link"
        id="link"
        href="${this.href}"
        target="${this.target||Pr}"
        aria-label="${e||Pr}"></a>
    `}getRenderClasses(){return{"flip-icon":this.flipIcon,selected:this.toggle&&this.selected}}renderIcon(){return bi`<span class="icon"><slot></slot></span>`}renderSelectedIcon(){return bi`<span class="icon icon--selected"
      ><slot name="selected"><slot></slot></slot
    ></span>`}renderTouchTarget(){return bi`<span class="touch"></span>`}renderFocusRing(){return bi`<md-focus-ring
      part="focus-ring"
      for=${this.href?"link":"button"}></md-focus-ring>`}renderRipple(){return bi`<md-ripple
      for=${this.href?"link":Pr}
      ?disabled="${!this.href&&this.disabled}"></md-ripple>`}connectedCallback(){this.flipIcon=jL(this,this.flipIconInRtl),super.connectedCallback()}async handleClick(e){await 0,!(!this.toggle||this.disabled||e.defaultPrevented)&&(this.selected=!this.selected,this.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0})))}}ym(po),I8(po);po.formAssociated=!0;po.shadowRootOptions={mode:"open",delegatesFocus:!0};At([lr({type:Boolean,reflect:!0})],po.prototype,"disabled",void 0);At([lr({type:Boolean,attribute:"flip-icon-in-rtl"})],po.prototype,"flipIconInRtl",void 0);At([lr()],po.prototype,"href",void 0);At([lr()],po.prototype,"target",void 0);At([lr({attribute:"aria-label-selected"})],po.prototype,"ariaLabelSelected",void 0);At([lr({type:Boolean})],po.prototype,"toggle",void 0);At([lr({type:Boolean,reflect:!0})],po.prototype,"selected",void 0);At([lr()],po.prototype,"type",void 0);At([lr({reflect:!0})],po.prototype,"value",void 0);At([Ks()],po.prototype,"flipIcon",void 0);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const RE=xs`:host{display:inline-flex;outline:none;-webkit-tap-highlight-color:rgba(0,0,0,0);height:var(--_container-height);width:var(--_container-width);justify-content:center}:host([touch-target=wrapper]){margin:max(0px,(48px - var(--_container-height))/2) max(0px,(48px - var(--_container-width))/2)}md-focus-ring{--md-focus-ring-shape-start-start: var(--_container-shape-start-start);--md-focus-ring-shape-start-end: var(--_container-shape-start-end);--md-focus-ring-shape-end-end: var(--_container-shape-end-end);--md-focus-ring-shape-end-start: var(--_container-shape-end-start)}:host([disabled]){pointer-events:none}.icon-button{place-items:center;background:none;border:none;box-sizing:border-box;cursor:pointer;display:flex;place-content:center;outline:none;padding:0;position:relative;text-decoration:none;user-select:none;z-index:0;flex:1;border-start-start-radius:var(--_container-shape-start-start);border-start-end-radius:var(--_container-shape-start-end);border-end-start-radius:var(--_container-shape-end-start);border-end-end-radius:var(--_container-shape-end-end)}.icon ::slotted(*){font-size:var(--_icon-size);height:var(--_icon-size);width:var(--_icon-size);font-weight:inherit}md-ripple{z-index:-1;border-start-start-radius:var(--_container-shape-start-start);border-start-end-radius:var(--_container-shape-start-end);border-end-start-radius:var(--_container-shape-end-start);border-end-end-radius:var(--_container-shape-end-end)}.flip-icon .icon{transform:scaleX(-1)}.icon{display:inline-flex}.link{height:100%;outline:none;position:absolute;width:100%}.touch{position:absolute;height:max(48px,100%);width:max(48px,100%)}:host([touch-target=none]) .touch{display:none}@media(forced-colors: active){:host([disabled]){--_disabled-icon-opacity: 1}}
`;/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Tne=xs`:host{--_disabled-icon-color: var(--md-icon-button-disabled-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-icon-opacity: var(--md-icon-button-disabled-icon-opacity, 0.38);--_icon-size: var(--md-icon-button-icon-size, 24px);--_selected-focus-icon-color: var(--md-icon-button-selected-focus-icon-color, var(--md-sys-color-primary, #6750a4));--_selected-hover-icon-color: var(--md-icon-button-selected-hover-icon-color, var(--md-sys-color-primary, #6750a4));--_selected-hover-state-layer-color: var(--md-icon-button-selected-hover-state-layer-color, var(--md-sys-color-primary, #6750a4));--_selected-hover-state-layer-opacity: var(--md-icon-button-selected-hover-state-layer-opacity, 0.08);--_selected-icon-color: var(--md-icon-button-selected-icon-color, var(--md-sys-color-primary, #6750a4));--_selected-pressed-icon-color: var(--md-icon-button-selected-pressed-icon-color, var(--md-sys-color-primary, #6750a4));--_selected-pressed-state-layer-color: var(--md-icon-button-selected-pressed-state-layer-color, var(--md-sys-color-primary, #6750a4));--_selected-pressed-state-layer-opacity: var(--md-icon-button-selected-pressed-state-layer-opacity, 0.12);--_state-layer-height: var(--md-icon-button-state-layer-height, 40px);--_state-layer-shape: var(--md-icon-button-state-layer-shape, var(--md-sys-shape-corner-full, 9999px));--_state-layer-width: var(--md-icon-button-state-layer-width, 40px);--_focus-icon-color: var(--md-icon-button-focus-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-icon-color: var(--md-icon-button-hover-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-state-layer-color: var(--md-icon-button-hover-state-layer-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-state-layer-opacity: var(--md-icon-button-hover-state-layer-opacity, 0.08);--_icon-color: var(--md-icon-button-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_pressed-icon-color: var(--md-icon-button-pressed-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_pressed-state-layer-color: var(--md-icon-button-pressed-state-layer-color, var(--md-sys-color-on-surface-variant, #49454f));--_pressed-state-layer-opacity: var(--md-icon-button-pressed-state-layer-opacity, 0.12);--_container-shape-start-start: 0;--_container-shape-start-end: 0;--_container-shape-end-end: 0;--_container-shape-end-start: 0;--_container-height: 0;--_container-width: 0;height:var(--_state-layer-height);width:var(--_state-layer-width)}:host([touch-target=wrapper]){margin:max(0px,(48px - var(--_state-layer-height))/2) max(0px,(48px - var(--_state-layer-width))/2)}md-focus-ring{--md-focus-ring-shape-start-start: var(--_state-layer-shape);--md-focus-ring-shape-start-end: var(--_state-layer-shape);--md-focus-ring-shape-end-end: var(--_state-layer-shape);--md-focus-ring-shape-end-start: var(--_state-layer-shape)}.standard{background-color:rgba(0,0,0,0);color:var(--_icon-color);--md-ripple-hover-color: var(--_hover-state-layer-color);--md-ripple-hover-opacity: var(--_hover-state-layer-opacity);--md-ripple-pressed-color: var(--_pressed-state-layer-color);--md-ripple-pressed-opacity: var(--_pressed-state-layer-opacity)}.standard:hover{color:var(--_hover-icon-color)}.standard:focus{color:var(--_focus-icon-color)}.standard:active{color:var(--_pressed-icon-color)}.standard:disabled{color:var(--_disabled-icon-color)}md-ripple{border-radius:var(--_state-layer-shape)}.standard:disabled .icon{opacity:var(--_disabled-icon-opacity)}.selected{--md-ripple-hover-color: var(--_selected-hover-state-layer-color);--md-ripple-hover-opacity: var(--_selected-hover-state-layer-opacity);--md-ripple-pressed-color: var(--_selected-pressed-state-layer-color);--md-ripple-pressed-opacity: var(--_selected-pressed-state-layer-opacity)}.selected:not(:disabled){color:var(--_selected-icon-color)}.selected:not(:disabled):hover{color:var(--_selected-hover-icon-color)}.selected:not(:disabled):focus{color:var(--_selected-focus-icon-color)}.selected:not(:disabled):active{color:var(--_selected-pressed-icon-color)}
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let HI=class extends po{getRenderClasses(){return{...super.getRenderClasses(),standard:!0}}};HI.styles=[RE,Tne];HI=At([ea("md-icon-button")],HI);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ene=xs`:host{--_container-color: var(--md-filled-tonal-icon-button-container-color, var(--md-sys-color-secondary-container, #e8def8));--_container-height: var(--md-filled-tonal-icon-button-container-height, 40px);--_container-width: var(--md-filled-tonal-icon-button-container-width, 40px);--_disabled-container-color: var(--md-filled-tonal-icon-button-disabled-container-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-container-opacity: var(--md-filled-tonal-icon-button-disabled-container-opacity, 0.12);--_disabled-icon-color: var(--md-filled-tonal-icon-button-disabled-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-icon-opacity: var(--md-filled-tonal-icon-button-disabled-icon-opacity, 0.38);--_focus-icon-color: var(--md-filled-tonal-icon-button-focus-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_hover-icon-color: var(--md-filled-tonal-icon-button-hover-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_hover-state-layer-color: var(--md-filled-tonal-icon-button-hover-state-layer-color, var(--md-sys-color-on-secondary-container, #1d192b));--_hover-state-layer-opacity: var(--md-filled-tonal-icon-button-hover-state-layer-opacity, 0.08);--_icon-color: var(--md-filled-tonal-icon-button-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_icon-size: var(--md-filled-tonal-icon-button-icon-size, 24px);--_pressed-icon-color: var(--md-filled-tonal-icon-button-pressed-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_pressed-state-layer-color: var(--md-filled-tonal-icon-button-pressed-state-layer-color, var(--md-sys-color-on-secondary-container, #1d192b));--_pressed-state-layer-opacity: var(--md-filled-tonal-icon-button-pressed-state-layer-opacity, 0.12);--_selected-container-color: var(--md-filled-tonal-icon-button-selected-container-color, var(--md-sys-color-secondary-container, #e8def8));--_toggle-selected-focus-icon-color: var(--md-filled-tonal-icon-button-toggle-selected-focus-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_toggle-selected-hover-icon-color: var(--md-filled-tonal-icon-button-toggle-selected-hover-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_toggle-selected-hover-state-layer-color: var(--md-filled-tonal-icon-button-toggle-selected-hover-state-layer-color, var(--md-sys-color-on-secondary-container, #1d192b));--_toggle-selected-icon-color: var(--md-filled-tonal-icon-button-toggle-selected-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_toggle-selected-pressed-icon-color: var(--md-filled-tonal-icon-button-toggle-selected-pressed-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_toggle-selected-pressed-state-layer-color: var(--md-filled-tonal-icon-button-toggle-selected-pressed-state-layer-color, var(--md-sys-color-on-secondary-container, #1d192b));--_unselected-container-color: var(--md-filled-tonal-icon-button-unselected-container-color, var(--md-sys-color-surface-container-highest, #e6e0e9));--_toggle-focus-icon-color: var(--md-filled-tonal-icon-button-toggle-focus-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_toggle-hover-icon-color: var(--md-filled-tonal-icon-button-toggle-hover-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_toggle-hover-state-layer-color: var(--md-filled-tonal-icon-button-toggle-hover-state-layer-color, var(--md-sys-color-on-surface-variant, #49454f));--_toggle-icon-color: var(--md-filled-tonal-icon-button-toggle-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_toggle-pressed-icon-color: var(--md-filled-tonal-icon-button-toggle-pressed-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_toggle-pressed-state-layer-color: var(--md-filled-tonal-icon-button-toggle-pressed-state-layer-color, var(--md-sys-color-on-surface-variant, #49454f));--_container-shape-start-start: var(--md-filled-tonal-icon-button-container-shape-start-start, var(--md-filled-tonal-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-start-end: var(--md-filled-tonal-icon-button-container-shape-start-end, var(--md-filled-tonal-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-end: var(--md-filled-tonal-icon-button-container-shape-end-end, var(--md-filled-tonal-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-start: var(--md-filled-tonal-icon-button-container-shape-end-start, var(--md-filled-tonal-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)))}.icon-button{color:var(--_icon-color);--md-ripple-hover-color: var(--_hover-state-layer-color);--md-ripple-hover-opacity: var(--_hover-state-layer-opacity);--md-ripple-pressed-color: var(--_pressed-state-layer-color);--md-ripple-pressed-opacity: var(--_pressed-state-layer-opacity)}.icon-button:hover{color:var(--_hover-icon-color)}.icon-button:focus{color:var(--_focus-icon-color)}.icon-button:active{color:var(--_pressed-icon-color)}.icon-button:disabled{color:var(--_disabled-icon-color)}.icon-button::before{background-color:var(--_container-color);border-radius:inherit;content:"";inset:0;position:absolute;z-index:-1}.icon-button:disabled::before{background-color:var(--_disabled-container-color);opacity:var(--_disabled-container-opacity)}.icon-button:disabled .icon{opacity:var(--_disabled-icon-opacity)}.toggle-filled-tonal{--md-ripple-hover-color: var(--_toggle-hover-state-layer-color);--md-ripple-pressed-color: var(--_toggle-pressed-state-layer-color)}.toggle-filled-tonal:not(:disabled){color:var(--_toggle-icon-color)}.toggle-filled-tonal:not(:disabled):hover{color:var(--_toggle-hover-icon-color)}.toggle-filled-tonal:not(:disabled):focus{color:var(--_toggle-focus-icon-color)}.toggle-filled-tonal:not(:disabled):active{color:var(--_toggle-pressed-icon-color)}.toggle-filled-tonal:not(:disabled)::before{background-color:var(--_unselected-container-color)}.selected{--md-ripple-hover-color: var(--_toggle-selected-hover-state-layer-color);--md-ripple-pressed-color: var(--_toggle-selected-pressed-state-layer-color)}.selected:not(:disabled){color:var(--_toggle-selected-icon-color)}.selected:not(:disabled):hover{color:var(--_toggle-selected-hover-icon-color)}.selected:not(:disabled):focus{color:var(--_toggle-selected-focus-icon-color)}.selected:not(:disabled):active{color:var(--_toggle-selected-pressed-icon-color)}.selected:not(:disabled)::before{background-color:var(--_selected-container-color)}
`;/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let WI=class extends po{getRenderClasses(){return{...super.getRenderClasses(),"filled-tonal":!0,"toggle-filled-tonal":this.toggle}}};WI.styles=[RE,Ene];WI=At([ea("md-filled-tonal-icon-button")],WI);/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ane extends Ys{render(){return bi`<slot></slot>`}connectedCallback(){if(super.connectedCallback(),this.getAttribute("aria-hidden")==="false"){this.removeAttribute("aria-hidden");return}this.setAttribute("aria-hidden","true")}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ine=xs`:host{font-size:var(--md-icon-size, 24px);width:var(--md-icon-size, 24px);height:var(--md-icon-size, 24px);color:inherit;font-variation-settings:inherit;font-weight:400;font-family:var(--md-icon-font, Material Symbols Outlined);display:inline-flex;font-style:normal;place-items:center;place-content:center;line-height:1;overflow:hidden;letter-spacing:normal;text-transform:none;user-select:none;white-space:nowrap;word-wrap:normal;flex-shrink:0;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;-moz-osx-font-smoothing:grayscale}::slotted(svg){fill:currentColor}::slotted(*){height:100%;width:100%}
`;/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let ZI=class extends Ane{};ZI.styles=[Ine];ZI=At([ea("md-icon")],ZI);const gl=(n,e)=>{const r=n.__vccOpts||n;for(const[s,c]of e)r[s]=c;return r};/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Sne extends Ys{connectedCallback(){super.connectedCallback(),this.setAttribute("aria-hidden","true")}render(){return bi`<span class="shadow"></span>`}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Cne=xs`:host,.shadow,.shadow::before,.shadow::after{border-radius:inherit;inset:0;position:absolute;transition-duration:inherit;transition-property:inherit;transition-timing-function:inherit}:host{display:flex;pointer-events:none;transition-property:box-shadow,opacity}.shadow::before,.shadow::after{content:"";transition-property:box-shadow,opacity;--_level: var(--md-elevation-level, 0);--_shadow-color: var(--md-elevation-shadow-color, var(--md-sys-color-shadow, #000))}.shadow::before{box-shadow:0px calc(1px*(clamp(0,var(--_level),1) + clamp(0,var(--_level) - 3,1) + 2*clamp(0,var(--_level) - 4,1))) calc(1px*(2*clamp(0,var(--_level),1) + clamp(0,var(--_level) - 2,1) + clamp(0,var(--_level) - 4,1))) 0px var(--_shadow-color);opacity:.3}.shadow::after{box-shadow:0px calc(1px*(clamp(0,var(--_level),1) + clamp(0,var(--_level) - 1,1) + 2*clamp(0,var(--_level) - 2,3))) calc(1px*(3*clamp(0,var(--_level),2) + 2*clamp(0,var(--_level) - 2,3))) calc(1px*(clamp(0,var(--_level),4) + 2*clamp(0,var(--_level) - 4,1))) var(--_shadow-color);opacity:.15}
`;/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let XI=class extends Sne{};XI.styles=[Cne];XI=At([ea("md-elevation")],XI);const Rne=Ro({__name:"App",setup(n){const e=FH(),r=mF(),s=wC();return Bd(s,async(c,d)=>{if(!c&&d&&r.meta.requiresAuth)return e.push({name:"login"});if(c&&typeof r.query.redirect=="string")return e.push(r.query.redirect)}),(c,d)=>(li(),Ii("main",null,[(li(),Wg(Hi(pF),{key:c.$route.fullPath}))]))}}),Pne="modulepreload",Mne=function(n){return"/"+n},$L={},kne=function(e,r,s){let c=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),_=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));c=Promise.all(r.map(x=>{if(x=Mne(x),x in $L)return;$L[x]=!0;const l=x.endsWith(".css"),S=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${x}"]${S}`))return;const D=document.createElement("link");if(D.rel=l?"stylesheet":Pne,l||(D.as="script",D.crossOrigin=""),D.href=x,_&&D.setAttribute("nonce",_),document.head.appendChild(D),l)return new Promise((I,V)=>{D.addEventListener("load",I),D.addEventListener("error",()=>V(new Error(`Unable to preload CSS for ${x}`)))})}))}return c.then(()=>e()).catch(d=>{const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=d,window.dispatchEvent(_),!_.defaultPrevented)throw d})};class k_{constructor({name:e,date:r,time:s,description:c,imageUrl:d,id:_,mapData:x,position:l,maxParticipants:S}){Xc(this,"_id");Xc(this,"_name");Xc(this,"_date");Xc(this,"_description");Xc(this,"_imageUrl");Xc(this,"_time");Xc(this,"_mapData");Xc(this,"_position");Xc(this,"_maxParticipants");this._id=_||Dne(12),this._name=e,this._date=r,this._description=c,this._imageUrl=d,this._time=s||[],this._mapData=x||null,this._position=l,this._maxParticipants=S||null}get id(){return this._id}set id(e){this._id=e}get name(){return this._name}set name(e){this._name=e}get date(){return this._date}set date(e){this._date=e}get description(){return this._description}set description(e){this._description=e}get imageUrl(){return this._imageUrl}set imageUrl(e){this._imageUrl=e}get time(){return this._time}set time(e){this._time=e}get mapData(){return this._mapData}set mapData(e){this._mapData=e}get position(){return this._position}set position(e){this._position=e}get maxParticipants(){return this._maxParticipants}set maxParticipants(e){this._maxParticipants=e}}function Dne(n){let e="";const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=r.length;for(let c=0;c<n;c++)e+=r.charAt(Math.floor(Math.random()*s));return e}const S8=[new k_({position:{lat:40.524368,lon:16.062254},id:"viaferrata_16-06",name:"Via ferrata Pietrapertosa e Castelmezzano",description:`<p>
                    Via ferrata a Pietrapertosa e Castelmezzano, domenica 16 Giugno 2024.
                </p>
                <p>
                    Programma:
                <ul>
                    <li>08:00 - Partenza da Tricarico</li>
                    <li>08:30 - Arrivo a Pietrapertosa e noleggio attrezzatura</li>
                    <li>09:00 - Percorso delle 7 pietre</li>
                    <li>10:00 - Partenza Salemm</li>
                    <li>13:30 - Pranzo a Castelmezzano</li>
                    <li>15:30 - Avvicinamento Marcirosa</li>
                    <li>16:00 - Partenza Marcirosa</li>
                    <li>19:00 - Arrivo a Pietrapertosa</li>
                    <li>19:30 - Rientro a Tricarico</li>
                </ul>

                </p>

                <p> 
                La via ferrata Salemm ha una lunghezza di circa 1.731 metri ed un dislivello di circa 249 metri.
                <br/>
                La via ferrata Marcirosa ha una lunghezza di 1.778 metri ed un dislivello di circa 331 metri
                </p>

                <p>
                    Sar necessario noleggiare l'attrezzatura per la via ferrata. Il costo  di 20 a persona.
                </p>`,imageUrl:"https://i0.wp.com/cyclinginlove.com/wp-content/uploads/2019/09/da-pietrapetosa-a-castelmezzano_vie-ferrate-in-basilicata_piccole-dolomiti-lucane_volo-angelo-castelmezzano_cammino-delle-delle-sette-pietre.jpg?fit=1280%2C570&ssl=1",date:new Date("2024-06-16"),mapData:{type:"FeatureCollection",features:[{type:"Feature",properties:{name:"Piccole Dolomiti Lucane. Ferrate Marcirosa e Salemm"},geometry:{type:"MultiLineString",coordinates:[[[16.046383,40.52455],[16.046322,40.524551],[16.04636,40.524515],[16.046382,40.524465],[16.046415,40.524416],[16.046471,40.524393],[16.04649,40.524345],[16.046452,40.524388],[16.046408,40.524429],[16.046461,40.524396],[16.046514,40.52437],[16.046572,40.524359],[16.046616,40.524324],[16.046576,40.524286],[16.046537,40.52425],[16.046554,40.524201],[16.046601,40.524159],[16.04666,40.524127],[16.046726,40.524109],[16.046787,40.524108],[16.046856,40.524113],[16.046919,40.524124],[16.046988,40.524138],[16.047051,40.524148],[16.04712,40.524148],[16.04718,40.524144],[16.047243,40.524153],[16.047334,40.524131],[16.047373,40.524085],[16.047401,40.524043],[16.047422,40.523996],[16.047429,40.523938],[16.047402,40.523883],[16.04738,40.52384],[16.047365,40.523792],[16.047353,40.523741],[16.04735,40.523688],[16.047372,40.523645],[16.047385,40.523592],[16.047416,40.523539],[16.047402,40.523479],[16.04737,40.52344],[16.04735,40.523392],[16.047338,40.523342],[16.047338,40.523296],[16.047282,40.523272],[16.047233,40.523211],[16.047216,40.523157],[16.047204,40.52311],[16.047197,40.52306],[16.047181,40.523013],[16.047208,40.522969],[16.047222,40.522922],[16.047248,40.522878],[16.047264,40.522835],[16.047287,40.522794],[16.047299,40.522747],[16.047297,40.5227],[16.047237,40.52267],[16.047261,40.522621],[16.047274,40.522575],[16.047298,40.522523],[16.047312,40.522478],[16.047334,40.522429],[16.047369,40.52239],[16.047387,40.522341],[16.047321,40.522355],[16.047285,40.522392],[16.047242,40.522425],[16.047238,40.522471],[16.047184,40.522502],[16.047125,40.522483],[16.047117,40.522434],[16.047127,40.52239],[16.047112,40.522342],[16.047114,40.522296],[16.047147,40.522254],[16.047195,40.522216],[16.047255,40.522208],[16.047314,40.522198],[16.047339,40.522157],[16.047381,40.522123],[16.04742,40.522084],[16.04748,40.522069],[16.047529,40.522037],[16.04758,40.522002],[16.04763,40.521971],[16.047674,40.521929],[16.04773,40.521911],[16.047763,40.521862],[16.047703,40.521872],[16.047649,40.521844],[16.047675,40.521803],[16.047718,40.521769],[16.047764,40.521735],[16.047813,40.521704],[16.04787,40.521666],[16.047916,40.521617],[16.04795,40.521562],[16.047973,40.52152],[16.047915,40.521491],[16.047855,40.521528],[16.047886,40.521567],[16.047955,40.521581],[16.048025,40.521603],[16.048086,40.521629],[16.048141,40.521659],[16.048192,40.521699],[16.048251,40.521725],[16.048299,40.521759],[16.048343,40.521795],[16.048405,40.521814],[16.048448,40.521861],[16.048445,40.521912],[16.048438,40.521959],[16.048405,40.521998],[16.048411,40.522047],[16.048427,40.522092],[16.04843,40.522141],[16.048356,40.52215],[16.048331,40.522191],[16.048341,40.522242],[16.048368,40.522288],[16.048381,40.522334],[16.048405,40.522376],[16.04845,40.522408],[16.048492,40.522442],[16.048558,40.522458],[16.0486,40.522426],[16.048613,40.522372],[16.048599,40.52232],[16.048573,40.522276],[16.048576,40.522229],[16.048594,40.522183],[16.048603,40.522136],[16.048631,40.522177],[16.048664,40.522225],[16.048696,40.522288],[16.048703,40.522341],[16.04873,40.522384],[16.048753,40.522433],[16.048762,40.522488],[16.048806,40.522529],[16.048762,40.52256],[16.04875,40.522605],[16.048749,40.522652],[16.048791,40.522696],[16.048852,40.522713],[16.048914,40.522691],[16.048958,40.522643],[16.048983,40.522594],[16.049008,40.522552],[16.049038,40.522496],[16.049091,40.522452],[16.049158,40.522428],[16.049214,40.522387],[16.049262,40.52242],[16.04929,40.522476],[16.049302,40.52252],[16.049354,40.522548],[16.049384,40.522592],[16.049441,40.522613],[16.049475,40.522654],[16.049519,40.522691],[16.04955,40.522737],[16.049565,40.522788],[16.049561,40.522835],[16.049539,40.522884],[16.049524,40.522935],[16.049531,40.522991],[16.049541,40.523037],[16.049544,40.523089],[16.049534,40.523138],[16.049512,40.523182],[16.049493,40.523229],[16.04947,40.523273],[16.049477,40.523332],[16.049502,40.523381],[16.049536,40.523429],[16.04954,40.523482],[16.049492,40.523517],[16.049431,40.523557],[16.049375,40.523595],[16.049324,40.523624],[16.049281,40.523666],[16.049259,40.523708],[16.049272,40.523753],[16.049234,40.523806],[16.049288,40.523833],[16.04936,40.523854],[16.049419,40.52387],[16.049481,40.523884],[16.04951,40.523931],[16.049562,40.523954],[16.049615,40.523979],[16.049641,40.524021],[16.049662,40.524072],[16.049671,40.524124],[16.049687,40.524171],[16.049704,40.52422],[16.049713,40.524276],[16.049734,40.524321],[16.049791,40.524345],[16.04983,40.524383],[16.049838,40.524435],[16.049804,40.524478],[16.04983,40.524525],[16.049869,40.524562],[16.049905,40.524602],[16.04995,40.524636],[16.049995,40.524673],[16.050003,40.524722],[16.05003,40.524767],[16.050089,40.52479],[16.050153,40.524801],[16.050228,40.524841],[16.050258,40.524881],[16.050282,40.524924],[16.050304,40.524967],[16.050311,40.525019],[16.050307,40.525079],[16.050303,40.525129],[16.050244,40.525137],[16.050302,40.525148],[16.050357,40.525191],[16.050358,40.525238],[16.050333,40.525303],[16.050302,40.525345],[16.050243,40.525344],[16.050236,40.525396],[16.050247,40.525441],[16.050266,40.525486],[16.050289,40.525532],[16.05033,40.525566],[16.050365,40.525605],[16.050335,40.525552],[16.050393,40.525566],[16.050331,40.525561],[16.050291,40.525524],[16.050313,40.525473],[16.050362,40.525448],[16.050417,40.525425],[16.050473,40.525444],[16.050524,40.525467],[16.050584,40.525456],[16.050648,40.525451],[16.050713,40.525436],[16.050757,40.525402],[16.050814,40.525387],[16.050847,40.525427],[16.050838,40.525472],[16.05088,40.525506],[16.050947,40.525523],[16.051016,40.525506],[16.051073,40.525483],[16.05112,40.525443],[16.051166,40.525413],[16.05123,40.525415],[16.051278,40.525442],[16.051328,40.525415],[16.051389,40.525412],[16.051424,40.525375],[16.051483,40.525361],[16.051545,40.525355],[16.051605,40.525345],[16.051651,40.525313],[16.051694,40.525345],[16.05174,40.525395],[16.051701,40.525432],[16.05164,40.525443],[16.051692,40.525417],[16.051643,40.52539],[16.051658,40.525344],[16.051694,40.525304],[16.051725,40.525264],[16.051675,40.525301],[16.051733,40.525279],[16.051786,40.525258],[16.051846,40.525259],[16.051901,40.52528],[16.051961,40.525292],[16.052014,40.525313],[16.052067,40.525334],[16.052124,40.525351],[16.052155,40.52531],[16.05222,40.525303],[16.052266,40.525275],[16.052326,40.525258],[16.052364,40.525222],[16.052424,40.525225],[16.052479,40.525204],[16.052522,40.525171],[16.052581,40.525155],[16.052583,40.52511],[16.052597,40.525063],[16.052588,40.525006],[16.052588,40.524961],[16.052615,40.524915],[16.052654,40.524877],[16.052717,40.524856],[16.052773,40.524836],[16.052845,40.524837],[16.052904,40.524856],[16.05295,40.524886],[16.053017,40.524888],[16.05308,40.52488],[16.053119,40.524844],[16.05318,40.524858],[16.053235,40.524834],[16.053287,40.524859],[16.053284,40.524918],[16.053337,40.524944],[16.053381,40.524977],[16.053443,40.524953],[16.053505,40.524958],[16.053443,40.524944],[16.053502,40.524938],[16.05355,40.524911],[16.053609,40.524917],[16.053658,40.524948],[16.053718,40.524959],[16.053746,40.525004],[16.053804,40.524993],[16.053858,40.525013],[16.053918,40.525008],[16.053976,40.525028],[16.054039,40.525012],[16.054103,40.525025],[16.054152,40.524997],[16.054212,40.525005],[16.054275,40.525005],[16.054316,40.524972],[16.05437,40.524999],[16.054429,40.524992],[16.054491,40.524995],[16.054546,40.525013],[16.054607,40.525004],[16.054669,40.525002],[16.05472,40.525045],[16.054724,40.525093],[16.054755,40.525054],[16.054822,40.525036],[16.054875,40.525074],[16.054924,40.5251],[16.054943,40.525146],[16.054991,40.525177],[16.055025,40.525139],[16.055053,40.525099],[16.055055,40.525053],[16.05505,40.525007],[16.055011,40.524971],[16.054966,40.524935],[16.054941,40.524892],[16.054943,40.524837],[16.05494,40.52478],[16.05492,40.524735],[16.054871,40.524709],[16.054862,40.524656],[16.054823,40.524621],[16.054768,40.524599],[16.054709,40.524587],[16.054671,40.524539],[16.054624,40.524511],[16.054622,40.524452],[16.054621,40.524403],[16.054631,40.524352],[16.054637,40.524305],[16.05468,40.524257],[16.054731,40.524229],[16.054778,40.524191],[16.054825,40.524153],[16.054855,40.524199],[16.054843,40.524249],[16.054841,40.524307],[16.0549,40.524287],[16.054961,40.524302],[16.055019,40.524329],[16.055079,40.52434],[16.055127,40.524308],[16.055188,40.524312],[16.055192,40.524264],[16.055244,40.524228],[16.055302,40.524245],[16.055248,40.524266],[16.055211,40.524223],[16.055269,40.52424],[16.055327,40.524252],[16.055369,40.524285],[16.055397,40.524326],[16.055422,40.52437],[16.05547,40.524344],[16.05541,40.524339],[16.055394,40.524383],[16.055455,40.524383],[16.05542,40.524346],[16.055457,40.524384],[16.055507,40.52436],[16.055549,40.524326],[16.055591,40.524291],[16.055596,40.524238],[16.055607,40.524193],[16.055624,40.52415],[16.055661,40.524113],[16.055638,40.52407],[16.055703,40.524056],[16.055756,40.524086],[16.055797,40.524124],[16.055848,40.524153],[16.055911,40.524168],[16.055965,40.524145],[16.055989,40.524087],[16.055997,40.524038],[16.055932,40.524036],[16.055985,40.524016],[16.056004,40.523971],[16.056022,40.523928],[16.055989,40.523887],[16.055984,40.523838],[16.055929,40.523811],[16.055912,40.523764],[16.055912,40.523718],[16.055972,40.523694],[16.056029,40.523678],[16.056013,40.523633],[16.056025,40.523583],[16.056025,40.523531],[16.056045,40.523483],[16.056096,40.523448],[16.056158,40.523426],[16.056213,40.523405],[16.056259,40.523373],[16.056297,40.523335],[16.056343,40.523304],[16.05639,40.523266],[16.056443,40.523239],[16.056491,40.523209],[16.056552,40.523178],[16.056598,40.523134],[16.056649,40.523109],[16.056719,40.523102],[16.056779,40.523082],[16.056846,40.523081],[16.056895,40.523043],[16.056937,40.523005],[16.056986,40.522966],[16.05704,40.522941],[16.057089,40.522913],[16.057135,40.522879],[16.057189,40.522852],[16.057225,40.522809],[16.057289,40.522806],[16.057303,40.522758],[16.05736,40.522716],[16.057413,40.522677],[16.057463,40.522648],[16.057514,40.522615],[16.057576,40.522581],[16.057609,40.522534],[16.057645,40.522492],[16.057675,40.522451],[16.05772,40.522422],[16.057781,40.522397],[16.057823,40.522359],[16.057868,40.522328],[16.057913,40.522278],[16.057932,40.522209],[16.05796,40.522164],[16.058009,40.522139],[16.058067,40.522098],[16.058126,40.522081],[16.058188,40.522076],[16.058171,40.522023],[16.058169,40.521978],[16.058227,40.52194],[16.058282,40.521915],[16.05835,40.521907],[16.058394,40.521873],[16.058445,40.521846],[16.058493,40.521817],[16.058535,40.52178],[16.058583,40.52174],[16.058644,40.521737],[16.058709,40.521734],[16.058775,40.521732],[16.058837,40.521731],[16.058901,40.521724],[16.058956,40.521699],[16.058982,40.521657],[16.059023,40.521615],[16.059038,40.521661],[16.059098,40.52167],[16.059158,40.521654],[16.059176,40.52161],[16.059222,40.521565],[16.059255,40.521522],[16.059291,40.521476],[16.059352,40.521435],[16.059413,40.521421],[16.059468,40.521399],[16.05953,40.521386],[16.05958,40.521354],[16.059645,40.521364],[16.0597,40.521345],[16.059735,40.521308],[16.059765,40.521348],[16.059811,40.521381],[16.05987,40.521398],[16.059867,40.521443],[16.059922,40.521482],[16.059983,40.521483],[16.060048,40.52148],[16.060107,40.5215],[16.060107,40.521452],[16.060155,40.521402],[16.060214,40.521368],[16.060258,40.521334],[16.06032,40.521294],[16.060373,40.521319],[16.060391,40.521369],[16.060401,40.52142],[16.060451,40.521394],[16.060469,40.521348],[16.060468,40.521303],[16.060512,40.521339],[16.060517,40.521394],[16.060574,40.521382],[16.060628,40.521354],[16.060629,40.521308],[16.06059,40.521268],[16.060635,40.521239],[16.060661,40.521281],[16.060703,40.521317],[16.060754,40.521341],[16.060814,40.521352],[16.060879,40.521367],[16.06094,40.521371],[16.060984,40.521338],[16.060997,40.521293],[16.060964,40.521253],[16.060975,40.521208],[16.061039,40.521197],[16.06109,40.52117],[16.061113,40.521127],[16.061177,40.521123],[16.061238,40.52112],[16.061278,40.521161],[16.061251,40.521205],[16.061235,40.521251],[16.061177,40.521262],[16.061133,40.521231],[16.061134,40.521281],[16.061105,40.521234],[16.061117,40.521188],[16.061058,40.521196],[16.061013,40.521225],[16.060953,40.521247],[16.060891,40.521257],[16.060928,40.521297],[16.060974,40.521334],[16.061012,40.521299],[16.060995,40.52135],[16.060963,40.521388],[16.060903,40.521375],[16.060834,40.521365],[16.060773,40.521366],[16.060714,40.521349],[16.060658,40.521323],[16.060595,40.52128],[16.060613,40.521331],[16.060621,40.521378],[16.060561,40.521383],[16.060516,40.521351],[16.060469,40.521321],[16.060411,40.521333],[16.060436,40.52138],[16.060434,40.521426],[16.060385,40.521384],[16.060332,40.521356],[16.060286,40.521397],[16.060249,40.521439],[16.060207,40.521478],[16.060161,40.521515],[16.06015,40.521564],[16.060094,40.521594],[16.060037,40.521573],[16.05998,40.521556],[16.059938,40.521521],[16.059883,40.521492],[16.059844,40.521455],[16.05982,40.521413],[16.059775,40.521379],[16.059728,40.521345],[16.059672,40.521316],[16.059644,40.521266],[16.059668,40.521215],[16.05963,40.521172],[16.059591,40.52113],[16.059562,40.521087],[16.059528,40.521047],[16.059492,40.521007],[16.05952,40.520964],[16.059521,40.520917],[16.05951,40.520866],[16.0595,40.52082],[16.059519,40.520775],[16.05956,40.520737],[16.059571,40.520686],[16.059573,40.520634],[16.059612,40.520595],[16.059604,40.520547],[16.059607,40.520502],[16.05963,40.520457],[16.059655,40.520416],[16.059685,40.520373],[16.059726,40.52034],[16.059766,40.520303],[16.059805,40.520261],[16.059843,40.520223],[16.05988,40.520177],[16.059918,40.520142],[16.059965,40.5201],[16.059996,40.520055],[16.060008,40.519996],[16.059998,40.51994],[16.060002,40.519893],[16.060015,40.519848],[16.060024,40.519801],[16.060041,40.519747],[16.060038,40.519695],[16.060057,40.51965],[16.060104,40.519619],[16.060167,40.51964],[16.060224,40.519618],[16.060289,40.51959],[16.060334,40.519556],[16.060342,40.519511],[16.060373,40.519468],[16.060409,40.519431],[16.060468,40.519405],[16.060505,40.519366],[16.060564,40.51934],[16.060625,40.519344],[16.060682,40.519363],[16.060743,40.519351],[16.060792,40.519315],[16.060851,40.519295],[16.06091,40.519283],[16.060974,40.519285],[16.061026,40.51926],[16.061089,40.519285],[16.061148,40.51927],[16.06122,40.519272],[16.061276,40.519235],[16.06132,40.519191],[16.061349,40.51913],[16.061392,40.519085],[16.061442,40.519044],[16.061497,40.519026],[16.061534,40.518986],[16.061558,40.518939],[16.061629,40.518933],[16.061691,40.518919],[16.061737,40.51889],[16.06179,40.518866],[16.061846,40.518844],[16.061899,40.518818],[16.061946,40.518784],[16.062004,40.518795],[16.062066,40.51879],[16.062131,40.518784],[16.062176,40.518741],[16.062216,40.518704],[16.062262,40.518668],[16.062303,40.518626],[16.062334,40.518587],[16.062365,40.518541],[16.062395,40.518493],[16.062441,40.518462],[16.062496,40.518436],[16.062556,40.518421],[16.06263,40.518407],[16.062694,40.518393],[16.062749,40.518412],[16.062738,40.518363],[16.062775,40.518322],[16.062808,40.518284],[16.06286,40.518243],[16.062915,40.51822],[16.062958,40.518186],[16.062995,40.51815],[16.063046,40.518124],[16.063116,40.5181],[16.063172,40.518068],[16.063224,40.518043],[16.063294,40.518024],[16.063322,40.517984],[16.063342,40.517937],[16.063375,40.517894],[16.063394,40.517849],[16.06339,40.517802],[16.063369,40.517756],[16.063336,40.517713],[16.063327,40.517663],[16.0633,40.517616],[16.063284,40.517567],[16.06327,40.51752],[16.063245,40.517562],[16.06321,40.517523],[16.063218,40.517478],[16.06319,40.517434],[16.063159,40.517385],[16.063137,40.517336],[16.063105,40.517283],[16.063065,40.517235],[16.063038,40.517193],[16.06301,40.517149],[16.062984,40.517106],[16.062945,40.517071],[16.06291,40.517031],[16.062853,40.517016],[16.062904,40.516985],[16.062901,40.516937],[16.062898,40.516891],[16.06289,40.516829],[16.062896,40.516779],[16.062914,40.516732],[16.062923,40.516685],[16.062863,40.51668],[16.062885,40.516727],[16.062922,40.516767],[16.06296,40.516804],[16.062979,40.516851],[16.062973,40.516904],[16.062949,40.516955],[16.062899,40.516927],[16.062881,40.516883],[16.06288,40.516827],[16.062897,40.51678],[16.062896,40.516723],[16.062881,40.516666],[16.06287,40.516713],[16.062887,40.516763],[16.062884,40.516814],[16.062913,40.516857],[16.062936,40.516902],[16.062951,40.516947],[16.062957,40.516992],[16.06293,40.517032],[16.062972,40.517071],[16.062999,40.517111],[16.063014,40.517168],[16.063027,40.517218],[16.063044,40.517267],[16.063074,40.517308],[16.063108,40.517346],[16.063146,40.517386],[16.063194,40.51742],[16.063233,40.517456],[16.063251,40.517507],[16.063286,40.517553],[16.06331,40.517597],[16.063336,40.517644],[16.063373,40.517689],[16.063387,40.517737],[16.063398,40.517783],[16.063401,40.517834],[16.063391,40.517883],[16.063383,40.517931],[16.063367,40.517979],[16.063335,40.518031],[16.063274,40.518053],[16.063212,40.51805],[16.063152,40.518061],[16.063106,40.518096],[16.063084,40.518144],[16.063055,40.518188],[16.063003,40.518217],[16.062956,40.518254],[16.06291,40.518285],[16.062854,40.518302],[16.062792,40.518316],[16.062743,40.518349],[16.062694,40.518378],[16.06264,40.5184],[16.062579,40.51841],[16.062518,40.518428],[16.062466,40.518459],[16.062416,40.518489],[16.062365,40.51852],[16.062316,40.518546],[16.062262,40.518575],[16.062207,40.518596],[16.062154,40.518623],[16.062091,40.518632],[16.062036,40.518658],[16.061997,40.518699],[16.061953,40.518732],[16.061901,40.518768],[16.061865,40.518804],[16.061828,40.518844],[16.061779,40.518881],[16.06177,40.518834],[16.061806,40.518794],[16.061828,40.518749],[16.061882,40.518728],[16.061937,40.518699],[16.061995,40.518685],[16.062041,40.518649],[16.062106,40.518636],[16.062169,40.518603],[16.062199,40.518557],[16.062147,40.518534],[16.062092,40.518555],[16.062127,40.518592],[16.06215,40.518549],[16.062198,40.518516],[16.062217,40.51847],[16.062262,40.518425],[16.062291,40.518385],[16.062329,40.518339],[16.062358,40.518291],[16.0624,40.518256],[16.062454,40.518231],[16.062509,40.518204],[16.06256,40.518161],[16.062596,40.51812],[16.062643,40.518081],[16.062648,40.518034],[16.062638,40.517989],[16.06259,40.517958],[16.06254,40.517924],[16.06247,40.517905],[16.062431,40.517866],[16.062408,40.517824],[16.062386,40.517781],[16.062364,40.517731],[16.062342,40.517688],[16.062314,40.517648],[16.062258,40.517621],[16.062196,40.517634],[16.062135,40.51764],[16.062082,40.517616],[16.062041,40.517581],[16.061986,40.51756],[16.061935,40.517528],[16.061907,40.517483],[16.061846,40.517463],[16.061793,40.51744],[16.061787,40.517488],[16.061776,40.517533],[16.061765,40.51758],[16.06173,40.517617],[16.061729,40.517677],[16.061751,40.517719],[16.061754,40.517765],[16.061757,40.517812],[16.061769,40.517859],[16.061776,40.51791],[16.061761,40.517957],[16.061703,40.517987],[16.061645,40.518],[16.061595,40.518031],[16.06154,40.518064],[16.061485,40.518082],[16.061408,40.518102],[16.061342,40.518106],[16.061276,40.518095],[16.061216,40.518092],[16.061153,40.51811],[16.061096,40.518136],[16.061064,40.518183],[16.061091,40.518227],[16.061026,40.518214],[16.061,40.518263],[16.061046,40.518313],[16.061111,40.518297],[16.061055,40.518269],[16.060996,40.51828],[16.060927,40.518283],[16.060859,40.518283],[16.060793,40.518293],[16.060744,40.518319],[16.060692,40.518353],[16.060638,40.518392],[16.060592,40.518424],[16.060536,40.518451],[16.06047,40.518464],[16.060424,40.518495],[16.060388,40.518535],[16.060338,40.518565],[16.060285,40.518587],[16.060235,40.518614],[16.060184,40.518645],[16.060123,40.518672],[16.060069,40.5187],[16.059997,40.518731],[16.059943,40.518757],[16.059884,40.518783],[16.059825,40.5188],[16.059756,40.518798],[16.059681,40.518784],[16.059621,40.51877],[16.059563,40.518759],[16.059498,40.518743],[16.059421,40.518725],[16.059356,40.518711],[16.059294,40.518704],[16.059226,40.518679],[16.059169,40.518666],[16.0591,40.518651],[16.059051,40.518626],[16.058995,40.518602],[16.058939,40.518576],[16.058892,40.518546],[16.058826,40.518516],[16.058767,40.518493],[16.058704,40.518473],[16.058616,40.518451],[16.058543,40.518438],[16.058484,40.518424],[16.058417,40.518414],[16.058352,40.518419],[16.058286,40.518451],[16.058247,40.518487],[16.058203,40.518521],[16.058148,40.518548],[16.058083,40.518573],[16.058006,40.518605],[16.057955,40.518632],[16.0579,40.518656],[16.057848,40.518678],[16.057791,40.518705],[16.05773,40.518738],[16.057673,40.518757],[16.057622,40.518783],[16.057569,40.518807],[16.057517,40.518833],[16.057455,40.518842],[16.057403,40.518872],[16.057336,40.518903],[16.057283,40.518933],[16.057234,40.518967],[16.057171,40.518967],[16.057158,40.518921],[16.0571,40.51891],[16.057046,40.518878],[16.057077,40.518835],[16.05706,40.518786],[16.057009,40.518757],[16.056946,40.518729],[16.056887,40.518712],[16.056827,40.518697],[16.056769,40.518685],[16.056697,40.518666],[16.056643,40.518646],[16.056583,40.518648],[16.056521,40.518649],[16.056461,40.518656],[16.056402,40.518657],[16.056338,40.518669],[16.056279,40.518675],[16.056218,40.518681],[16.056158,40.51869],[16.056098,40.518708],[16.056052,40.518742],[16.056016,40.51878],[16.056,40.518823],[16.056005,40.518879],[16.056015,40.518924],[16.056013,40.518979],[16.056024,40.519042],[16.056028,40.5191],[16.056006,40.519143],[16.055983,40.519193],[16.055982,40.519242],[16.055961,40.519287],[16.055906,40.519319],[16.055859,40.519363],[16.055838,40.519412],[16.055805,40.519452],[16.055758,40.519484],[16.055711,40.519512],[16.05566,40.519546],[16.055594,40.519582],[16.055541,40.519603],[16.055486,40.519631],[16.05542,40.519657],[16.055362,40.519672],[16.055298,40.519682],[16.055229,40.519691],[16.055177,40.519713],[16.055125,40.519736],[16.055069,40.51977],[16.055009,40.519774],[16.054937,40.519759],[16.054877,40.519728],[16.054865,40.519774],[16.054878,40.519827],[16.054842,40.519872],[16.054848,40.51992],[16.054897,40.519948],[16.054835,40.519948],[16.054821,40.519904],[16.054756,40.519893],[16.054697,40.519878],[16.054639,40.519857],[16.054591,40.519829],[16.05453,40.519811],[16.054467,40.519797],[16.054398,40.519776],[16.054347,40.519745],[16.054269,40.519713],[16.054212,40.519685],[16.054155,40.519661],[16.054096,40.519635],[16.054036,40.519615],[16.053979,40.519595],[16.053925,40.519553],[16.053879,40.519518],[16.053824,40.519498],[16.053756,40.519481],[16.053688,40.519487],[16.053624,40.519505],[16.053533,40.519517],[16.053471,40.519508],[16.053408,40.519501],[16.05333,40.519495],[16.053256,40.519517],[16.053176,40.519545],[16.053108,40.519542],[16.053053,40.519519],[16.052982,40.519514],[16.052929,40.519539],[16.052885,40.519573],[16.052819,40.519611],[16.052755,40.519634],[16.0527,40.519661],[16.052649,40.519693],[16.052598,40.519726],[16.052555,40.51976],[16.052524,40.519805],[16.052484,40.519855],[16.052424,40.519888],[16.052387,40.519926],[16.052365,40.51997],[16.052339,40.520012],[16.05229,40.520039],[16.052235,40.520075],[16.052209,40.520122],[16.052162,40.520163],[16.052108,40.520189],[16.052055,40.52021],[16.052002,40.520235],[16.051981,40.52028],[16.051937,40.520324],[16.051885,40.520357],[16.051834,40.520389],[16.05177,40.520415],[16.051715,40.520446],[16.051662,40.520476],[16.051624,40.520519],[16.051579,40.520557],[16.051533,40.520587],[16.051484,40.520614],[16.051425,40.520644],[16.051364,40.520662],[16.0513,40.520663],[16.051241,40.52066],[16.051181,40.520663],[16.05113,40.520688],[16.051068,40.520699],[16.050996,40.520718],[16.050941,40.520739],[16.050882,40.520736],[16.050816,40.520744],[16.050728,40.520747],[16.050686,40.520784],[16.050636,40.520813],[16.050582,40.520838],[16.050535,40.520873],[16.050487,40.520906],[16.05042,40.520931],[16.050364,40.520956],[16.050311,40.520987],[16.050265,40.521022],[16.050227,40.52106],[16.050174,40.521103],[16.050123,40.52113],[16.050067,40.521148],[16.049983,40.521168],[16.049919,40.521189],[16.049858,40.521206],[16.049772,40.521215],[16.049707,40.521243],[16.049695,40.521288],[16.049689,40.521335],[16.049681,40.521383],[16.049651,40.521423],[16.049613,40.521468],[16.049589,40.521509],[16.049527,40.521534],[16.049476,40.521565],[16.049459,40.521619],[16.049448,40.521667],[16.049411,40.521703],[16.049351,40.521708],[16.049277,40.52168],[16.049226,40.521651],[16.049163,40.521634],[16.049184,40.521678],[16.049213,40.521724],[16.049199,40.521779],[16.049177,40.521825],[16.049162,40.521879],[16.04912,40.521928],[16.049118,40.521974],[16.049141,40.52202],[16.04911,40.52207],[16.049083,40.52211],[16.049049,40.522149],[16.049019,40.52219],[16.048991,40.522231],[16.04897,40.522273],[16.048964,40.522321],[16.048961,40.522373],[16.049,40.522443],[16.049058,40.522429],[16.049116,40.522412],[16.04916,40.522378],[16.049209,40.522423],[16.049244,40.522471],[16.049297,40.522508],[16.049328,40.522548],[16.049384,40.522591],[16.04944,40.522615],[16.049463,40.522662],[16.049499,40.522714],[16.049536,40.522772],[16.049562,40.522814],[16.049546,40.522867],[16.04953,40.522916],[16.049536,40.522962],[16.04955,40.523011],[16.049566,40.523075],[16.049572,40.523129],[16.049585,40.523174],[16.049569,40.523224],[16.049552,40.523268],[16.049583,40.523319],[16.049606,40.523362],[16.049606,40.523412],[16.0496,40.523463],[16.049568,40.523515],[16.049533,40.523565],[16.04951,40.523607],[16.049481,40.523646],[16.049437,40.523689],[16.04938,40.523736],[16.049327,40.523759],[16.049351,40.523801],[16.049363,40.523852],[16.049377,40.523896],[16.049417,40.523931],[16.049451,40.523974],[16.049483,40.524021],[16.049504,40.524071],[16.049569,40.524079],[16.049607,40.524132],[16.049625,40.524179],[16.04965,40.524232],[16.049668,40.524279],[16.049693,40.524321],[16.049743,40.524348],[16.049792,40.524374],[16.049848,40.524396],[16.04988,40.524437],[16.049898,40.524486],[16.049881,40.524534],[16.049933,40.524568],[16.049963,40.524614],[16.049974,40.524665],[16.049998,40.524711],[16.05004,40.524763],[16.050091,40.524791],[16.050146,40.52483],[16.050188,40.52488],[16.050206,40.52493],[16.050203,40.524982],[16.050214,40.52503],[16.050221,40.5251],[16.050232,40.525157],[16.050241,40.525225],[16.050235,40.525272],[16.050218,40.52534],[16.050206,40.525387],[16.050222,40.525433],[16.050252,40.525484],[16.05032,40.525515],[16.050363,40.525551],[16.05042,40.52552],[16.050481,40.525534],[16.050549,40.525528],[16.050613,40.525531],[16.050667,40.525509],[16.050722,40.525485],[16.0508,40.52551],[16.050876,40.52552],[16.050937,40.525536],[16.050993,40.525553],[16.051029,40.525594],[16.051072,40.525632],[16.051131,40.525649],[16.051214,40.525654],[16.051273,40.525673],[16.051277,40.525721],[16.051297,40.525662],[16.051209,40.525502],[16.051236,40.525582],[16.051264,40.525647],[16.051313,40.525673],[16.051383,40.525679],[16.051342,40.525752],[16.051279,40.525773],[16.051339,40.52578],[16.051283,40.525797],[16.051215,40.525818],[16.051191,40.52587],[16.051163,40.525915],[16.051128,40.525954],[16.051104,40.525996],[16.051094,40.526049],[16.051059,40.526091],[16.051015,40.526137],[16.050976,40.526183],[16.050969,40.526231],[16.050929,40.526266],[16.050974,40.526227],[16.050932,40.526278],[16.050879,40.526301],[16.050938,40.526292],[16.050953,40.526336],[16.050969,40.526384],[16.050976,40.526429],[16.051004,40.526469],[16.051012,40.526519],[16.051037,40.526561],[16.051024,40.526608],[16.050961,40.526618],[16.050968,40.526665],[16.050984,40.52671],[16.050938,40.526744],[16.050944,40.526796],[16.050964,40.526842],[16.050951,40.526888],[16.050919,40.526929],[16.050882,40.526971],[16.05083,40.526997],[16.050771,40.527015],[16.050719,40.527043],[16.050668,40.527071],[16.050617,40.52711],[16.050678,40.527107],[16.05066,40.52715],[16.05071,40.527181],[16.050751,40.527145],[16.050811,40.527158],[16.050821,40.527207],[16.050821,40.527256],[16.050793,40.527303],[16.050765,40.527348],[16.050754,40.527394],[16.05072,40.527432],[16.050661,40.527423],[16.050596,40.52743],[16.050528,40.527419],[16.050468,40.527434],[16.050458,40.527479],[16.050513,40.52746],[16.050566,40.527489],[16.050572,40.527534],[16.050565,40.527585],[16.050573,40.527639],[16.050635,40.527656],[16.050694,40.527674],[16.050745,40.527696],[16.050764,40.527741],[16.050809,40.527771],[16.050802,40.527816],[16.050802,40.527864],[16.050788,40.52791],[16.050779,40.527961],[16.050747,40.527999],[16.050722,40.528054],[16.050664,40.528068],[16.050609,40.528049],[16.050589,40.528006],[16.050538,40.528035],[16.050502,40.528073],[16.050475,40.528113],[16.050445,40.528158],[16.050451,40.528206],[16.050431,40.528253],[16.050483,40.528281],[16.050528,40.528313],[16.050592,40.528331],[16.050581,40.528377],[16.050553,40.528419],[16.0505,40.528439],[16.05046,40.528481],[16.050434,40.528522],[16.050489,40.528549],[16.050551,40.528552],[16.050624,40.528542],[16.050693,40.528533],[16.050749,40.528518],[16.050815,40.528521],[16.050876,40.528531],[16.050911,40.528579],[16.050947,40.528622],[16.051046,40.528631],[16.051255,40.528645],[16.051373,40.528642],[16.051565,40.528613],[16.051636,40.528592],[16.051698,40.528568],[16.051142,40.528574],[16.051064,40.528595],[16.05096,40.528604],[16.051016,40.52863],[16.05109,40.528643],[16.051178,40.528641],[16.051447,40.528635],[16.051515,40.52857],[16.05152,40.52852],[16.051317,40.528537],[16.051244,40.528551],[16.051339,40.528584],[16.051291,40.52855],[16.051252,40.528502],[16.051182,40.528486],[16.051112,40.528485],[16.05105,40.528465],[16.050971,40.528461],[16.050917,40.52848],[16.050853,40.528506],[16.050803,40.528531],[16.050777,40.528584],[16.050786,40.528634],[16.050806,40.528678],[16.050736,40.528677],[16.050684,40.528705],[16.050745,40.5287],[16.050706,40.528735],[16.050722,40.528784],[16.050662,40.52879],[16.050726,40.528789],[16.050767,40.528824],[16.050811,40.528855],[16.050761,40.528893],[16.050731,40.528946],[16.050735,40.528999],[16.050674,40.529033],[16.050606,40.529032],[16.050602,40.529078],[16.050582,40.529016],[16.05058,40.528955],[16.050616,40.528992],[16.050641,40.529035],[16.050594,40.529068],[16.050562,40.529027],[16.050616,40.529045],[16.050619,40.528999],[16.050625,40.529046],[16.050693,40.529064],[16.050754,40.529086],[16.050816,40.529102],[16.050877,40.529111],[16.050938,40.529102],[16.05092,40.529148],[16.050847,40.529212],[16.0509,40.529238],[16.050952,40.529266],[16.050908,40.529296],[16.050935,40.529337],[16.050939,40.529383],[16.05096,40.529426],[16.050989,40.529465],[16.051044,40.529487],[16.051092,40.529515],[16.051149,40.529528],[16.051199,40.52956],[16.05124,40.529595],[16.051243,40.52964],[16.051264,40.529684],[16.051292,40.529726],[16.051261,40.529768],[16.051264,40.529813],[16.051273,40.529861],[16.051265,40.529906],[16.051269,40.529957],[16.051338,40.529943],[16.051369,40.529904],[16.05142,40.529928],[16.051424,40.529976],[16.05143,40.530025],[16.051445,40.530071],[16.051448,40.530119],[16.051422,40.530162],[16.051425,40.53021],[16.051343,40.530222],[16.051263,40.530211],[16.051211,40.530239],[16.051168,40.530276],[16.051134,40.530332],[16.051123,40.530378],[16.051152,40.530426],[16.051153,40.530471],[16.051102,40.530497],[16.051026,40.530486],[16.050966,40.530467],[16.050906,40.53047],[16.05085,40.530499],[16.05079,40.530516],[16.05083,40.530552],[16.050771,40.530544],[16.050735,40.530581],[16.050694,40.530614],[16.050661,40.530659],[16.050594,40.53066],[16.050533,40.530671],[16.050495,40.530707],[16.050432,40.5307],[16.050373,40.530711],[16.050376,40.530759],[16.050399,40.530802],[16.050358,40.530839],[16.050407,40.530866],[16.050468,40.530855],[16.05053,40.53087],[16.050556,40.530915],[16.050598,40.530948],[16.050657,40.530986],[16.05064,40.531031],[16.050694,40.531062],[16.050677,40.531109],[16.050678,40.531155],[16.050727,40.531185],[16.050689,40.531221],[16.050645,40.531253],[16.050585,40.531268],[16.050523,40.531263],[16.050453,40.531255],[16.050404,40.531228],[16.050464,40.531213],[16.050515,40.531238],[16.050455,40.531232],[16.050505,40.53126],[16.050526,40.531209],[16.050467,40.531208],[16.050527,40.531214],[16.050489,40.531248],[16.050445,40.531207],[16.0505,40.531239],[16.050442,40.531248],[16.050389,40.531225],[16.050356,40.531187],[16.050346,40.53114],[16.050289,40.531118],[16.050241,40.531152],[16.050191,40.531127],[16.050129,40.531131],[16.050077,40.531108],[16.050015,40.531126],[16.049952,40.531134],[16.049897,40.531159],[16.049872,40.531208],[16.049854,40.531254],[16.049828,40.531299],[16.049826,40.531344],[16.049806,40.531387],[16.049801,40.531435],[16.049793,40.53148],[16.049773,40.531525],[16.049778,40.531571],[16.049789,40.531616],[16.049804,40.531663],[16.049844,40.531704],[16.049834,40.531749],[16.049773,40.531777],[16.049714,40.531785],[16.049656,40.531761],[16.049614,40.5318],[16.049544,40.531786],[16.049488,40.531801],[16.049432,40.531817],[16.049372,40.531835],[16.049297,40.531837],[16.049237,40.53183],[16.049172,40.531817],[16.049108,40.531815],[16.049043,40.531818],[16.048978,40.53181],[16.048918,40.531815],[16.048859,40.531825],[16.048805,40.531849],[16.048757,40.531889],[16.048697,40.531904],[16.048663,40.531943],[16.048621,40.531982],[16.048572,40.532013],[16.048503,40.532051],[16.048453,40.532078],[16.048405,40.532108],[16.048379,40.532152],[16.048344,40.532191],[16.048286,40.532212],[16.048218,40.532215],[16.048153,40.532221],[16.048086,40.532234],[16.048023,40.532256],[16.047958,40.532268],[16.047896,40.532293],[16.047853,40.532325],[16.047882,40.532284],[16.047893,40.532239],[16.047916,40.532189],[16.047969,40.532165],[16.048034,40.53215],[16.048097,40.532143],[16.048151,40.532123],[16.048224,40.532084],[16.048276,40.532059],[16.04829,40.532008],[16.048244,40.531976],[16.048311,40.531969],[16.04837,40.531951],[16.048408,40.531897],[16.048393,40.531847],[16.048414,40.531801],[16.048426,40.531753],[16.048448,40.53171],[16.048472,40.531664],[16.04849,40.531615],[16.048498,40.53157],[16.048515,40.531524],[16.048585,40.531537],[16.048656,40.531525],[16.048679,40.531472],[16.048693,40.531424],[16.048679,40.531378],[16.048712,40.531339],[16.04876,40.531367],[16.04881,40.531337],[16.048866,40.53132],[16.048933,40.531312],[16.048998,40.531308],[16.048978,40.531265],[16.048914,40.531277],[16.048867,40.531244],[16.048813,40.531214],[16.048762,40.531185],[16.048702,40.531161],[16.048638,40.531164],[16.048576,40.531162],[16.048524,40.531137],[16.048504,40.531089],[16.048443,40.531103],[16.048401,40.53107],[16.048356,40.531033],[16.048357,40.531083],[16.048298,40.531108],[16.048236,40.531117],[16.048236,40.531071],[16.048175,40.531063],[16.048121,40.531039],[16.04808,40.531072],[16.048035,40.531103],[16.047976,40.531093],[16.047928,40.531066],[16.047863,40.531059],[16.047855,40.531014],[16.047797,40.531041],[16.04776,40.531083],[16.047691,40.531094],[16.047634,40.531129],[16.047577,40.531142],[16.047518,40.531115],[16.047472,40.531081],[16.047426,40.531051],[16.047361,40.531048],[16.047301,40.531068],[16.047244,40.531084],[16.047175,40.531106],[16.0471,40.531119],[16.047036,40.531109],[16.046966,40.531096],[16.04691,40.531072],[16.046868,40.531024],[16.046865,40.530978],[16.04682,40.530948],[16.046787,40.530908],[16.046723,40.530899],[16.046663,40.530869],[16.046598,40.530841],[16.046558,40.530801],[16.046525,40.53076],[16.046585,40.530754],[16.046561,40.530806],[16.046512,40.530772],[16.04645,40.530744],[16.046406,40.530776],[16.046465,40.530774],[16.046469,40.530729],[16.046431,40.530803],[16.046339,40.530884],[16.046241,40.531019],[16.046191,40.531372],[16.046206,40.531435],[16.046255,40.531332],[16.046302,40.531202],[16.04634,40.531048],[16.046388,40.531002],[16.046411,40.530948],[16.046435,40.530893],[16.046456,40.530835],[16.046525,40.530638],[16.046469,40.530597],[16.046465,40.530544],[16.046471,40.530496],[16.046487,40.530446],[16.046513,40.53039],[16.046532,40.530343],[16.04659,40.530329],[16.046651,40.530339],[16.046713,40.530336],[16.046694,40.530381],[16.046653,40.530344],[16.046602,40.530315],[16.046585,40.530268],[16.046632,40.53024],[16.046644,40.530196],[16.046612,40.530152],[16.046547,40.530121],[16.046471,40.5301],[16.046407,40.530082],[16.046348,40.530064],[16.046283,40.530052],[16.046226,40.530014],[16.046163,40.530002],[16.046091,40.530021],[16.046026,40.530028],[16.045966,40.53001],[16.045903,40.529999],[16.045824,40.529986],[16.045797,40.529931],[16.045774,40.529887],[16.045706,40.529892],[16.045642,40.529898],[16.045593,40.529862],[16.045543,40.529834],[16.045484,40.52983],[16.045414,40.529824],[16.045352,40.529831],[16.045289,40.529824],[16.04523,40.529803],[16.045184,40.529763],[16.045133,40.529738],[16.045116,40.52969],[16.045099,40.529645],[16.045085,40.529591],[16.045083,40.529536],[16.045098,40.529485],[16.045105,40.529437],[16.045091,40.529389],[16.045081,40.529329],[16.045082,40.529284],[16.045087,40.529238],[16.045105,40.529182],[16.045145,40.529145],[16.045198,40.529113],[16.045189,40.529066],[16.045252,40.529045],[16.045297,40.529014],[16.045337,40.528977],[16.045385,40.528937],[16.045438,40.528903],[16.045486,40.528876],[16.045529,40.528843],[16.045597,40.528819],[16.045656,40.528801],[16.04571,40.528781],[16.045757,40.528741],[16.045799,40.528704],[16.045844,40.528669],[16.045887,40.528624],[16.045919,40.528585],[16.045956,40.528547],[16.046018,40.528515],[16.046078,40.528492],[16.046147,40.52848],[16.046211,40.52847],[16.046272,40.528454],[16.046342,40.528439],[16.046408,40.528436],[16.046477,40.528419],[16.04653,40.528395],[16.046585,40.528368],[16.046634,40.528335],[16.046678,40.528299],[16.046721,40.528262],[16.046778,40.528216],[16.046825,40.528181],[16.046871,40.528151],[16.046875,40.528098],[16.046906,40.528047],[16.046921,40.528004],[16.046925,40.527955],[16.046927,40.5279],[16.046916,40.527852],[16.046903,40.5278],[16.046903,40.527755],[16.04691,40.527707],[16.046923,40.527656],[16.046936,40.5276],[16.046966,40.52756],[16.047008,40.527524],[16.04706,40.527492],[16.04711,40.527467],[16.047148,40.527429],[16.047157,40.527384],[16.047171,40.527338],[16.047218,40.527307],[16.047275,40.52729],[16.047344,40.527255],[16.047401,40.527223],[16.04744,40.527188],[16.04747,40.527137],[16.0475,40.527088],[16.047508,40.527035],[16.047518,40.526986],[16.047536,40.526934],[16.047541,40.526888],[16.047576,40.526831],[16.04761,40.526782],[16.047628,40.526736],[16.047647,40.526688],[16.04767,40.526641],[16.047689,40.526596],[16.047701,40.526543],[16.047684,40.526496],[16.047651,40.526454],[16.047602,40.52642],[16.047523,40.526403],[16.047461,40.526394],[16.047398,40.526373],[16.04735,40.526339],[16.047271,40.526318],[16.047206,40.526295],[16.047137,40.52628],[16.047081,40.526254],[16.047025,40.526238],[16.046952,40.526219],[16.046894,40.526202],[16.046806,40.526175],[16.046734,40.526135],[16.046677,40.526104],[16.046625,40.526082],[16.046543,40.526048],[16.046481,40.526023],[16.046419,40.526008],[16.046366,40.525978],[16.046311,40.525953],[16.046261,40.525925],[16.046226,40.525879],[16.046207,40.52583],[16.04618,40.525787],[16.046144,40.525751],[16.04609,40.525723],[16.046034,40.525693],[16.046002,40.52565],[16.045945,40.525607],[16.045917,40.525556],[16.04589,40.525505],[16.045892,40.525445],[16.045907,40.525383],[16.045923,40.525333],[16.045946,40.525289],[16.04596,40.525218],[16.045984,40.52517],[16.046018,40.525132],[16.046058,40.52509],[16.04608,40.525044],[16.046112,40.525],[16.046141,40.52495],[16.046171,40.524893],[16.04621,40.524855],[16.046231,40.52481],[16.04622,40.524751],[16.046207,40.524705],[16.046221,40.524651],[16.046258,40.52461],[16.046298,40.52457],[16.046314,40.524509],[16.046284,40.524467],[16.046271,40.524419],[16.04623,40.524386]]]}}]}}),new k_({position:{lat:40.416466,lon:15.820195},id:"volturino_23-06",name:"Escursione Monte Volturino",description:`<p>
                    Escursione sul monte Volturino, domenica 16 Giugno 2024.
                </p>
                <p>
                    Programma:
                <ul>
                    <li>09:00 - Partenza da Tricarico</li>
                    <li>10:15 - Arrivo al Piano dellImperatore</li>
                    <li>10:30 - Inizio salita</li>
                    <li>12:30 - Arrivo in vetta</li>
                    <li>13:00 - Pranzo</li>
                    <li>15:00 - Inizio discesa</li>
                    <li>17:00 - Arrivo al Piano dellImperatore</li>
                    <li>18:00 - Rientro a Tricarico</li>
                </ul>

                </p>

                <p>
                    Altre informazioni utili:
                    <br>
                    L'altitudine in vetta  di 1835 m, l'altitudine nel punto di partenza  di 1560 m. Gli orari -
                    soprattutto quelli che riguardano la durata di salita, discesa e pranzo - sono una stima e perci
                    potrebbero variare.
                </p>`,imageUrl:"/img/volturino.jpg",date:new Date("2024-06-23"),mapData:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[[15.820195,40.406247,1563.647],[15.819528,40.406275,1566.695],[15.819461,40.406559,1566.094],[15.819525,40.406562,1566.696],[15.819327,40.406447,1569.134],[15.818799,40.406278,1572.742],[15.818256,40.406375,1582.526],[15.818162,40.406308,1585.826],[15.818183,40.406178,1588.647],[15.818048,40.406062,1591.911],[15.817741,40.405858,1598.308],[15.817385,40.405728,1605.034],[15.817184,40.405725,1608.444],[15.816699,40.405921,1615.192],[15.816533,40.406015,1618.411],[15.816415,40.406306,1625.193],[15.816129,40.406688,1638.641],[15.816068,40.406902,1640.799],[15.815846,40.40707,1645.043],[15.815634,40.407538,1649.236],[15.815206,40.40804,1658.417],[15.815106,40.408459,1668.118],[15.814998,40.408365,1671.508],[15.8149,40.408361,1674.285],[15.814695,40.408773,1686.195],[15.814387,40.409024,1693.183],[15.814387,40.409102,1695.972],[15.814048,40.409362,1707.714],[15.813754,40.409444,1711.172],[15.813484,40.409718,1716.91],[15.813139,40.410238,1730.084],[15.812845,40.410437,1739.178],[15.812722,40.4106,1748.633],[15.812669,40.410761,1751.926],[15.812696,40.410836,1755.608],[15.812425,40.410926,1764.499],[15.812313,40.411211,1774.239],[15.812138,40.411333,1784.257],[15.811948,40.411653,1793.466],[15.811683,40.411711,1800.188],[15.811552,40.411643,1799.216],[15.811483,40.411718,1800.134],[15.811091,40.411842,1815.998],[15.810854,40.412135,1826.951],[15.810681,40.412255,1834.201],[15.810207,40.412294,1844.911],[15.809882,40.412253,1846.408],[15.809565,40.412255,1854.077],[15.809577,40.412244,1850.167],[15.809573,40.412242,1855.945],[15.809553,40.412243,1844.384],[15.809521,40.412315,1854.096],[15.809595,40.412254,1848.354],[15.809595,40.412254,1852.562],[15.809596,40.412254,1844.386],[15.809596,40.412254,1854.422],[15.809595,40.412254,1846.762],[15.809595,40.412255,1851.908],[15.81003,40.411861,1835.208],[15.810233,40.411551,1828.434],[15.810518,40.410887,1826.084],[15.810905,40.410549,1807.782],[15.811202,40.410224,1797.791],[15.811401,40.409951,1792.513],[15.811474,40.409682,1787.311],[15.811992,40.409132,1781.599],[15.812078,40.408953,1779.183],[15.812137,40.408447,1776.016],[15.812261,40.408187,1770.276],[15.812223,40.408164,1771.413],[15.812402,40.407841,1762.308],[15.812823,40.407403,1755.043],[15.813072,40.407429,1748.673],[15.813054,40.407392,1747.751],[15.81321,40.407499,1743.42],[15.813808,40.407284,1728.552],[15.813802,40.407455,1724.84],[15.813981,40.407593,1714.198],[15.814292,40.407336,1707.712],[15.814288,40.407176,1707.748],[15.814637,40.406865,1698.661],[15.814674,40.406994,1695.917],[15.814954,40.406863,1687.308],[15.815113,40.406885,1681.866],[15.815097,40.407006,1675.786],[15.815547,40.406579,1670.984],[15.815661,40.406364,1669.073],[15.815772,40.406236,1662.375],[15.815862,40.40594,1658.413],[15.8158,40.40553,1654.421],[15.81646,40.404835,1622.725],[15.816724,40.404717,1615.157],[15.817368,40.40476,1600.8],[15.818006,40.405181,1595.02],[15.818632,40.405504,1592.508],[15.818992,40.405799,1581.627],[15.819086,40.405916,1580.067],[15.819087,40.406059,1578.575],[15.819445,40.406011,1575.234],[15.819857,40.406108,1568.136],[15.82014,40.406239,1566.914],[15.820184,40.406211,1565.162],[15.820225,40.406284,1568.576]]},properties:{}}]}}),new k_({position:{lat:40.64801,lon:16.059105},id:"paintball_20-06",name:"Partita a Paintball",description:`<p>
                    Partita a paintball, 4 giocatori.
                </p>
                <p>
                    20 Giugno
                    <br/>
                    Orario: 19:00 - 20:30
                </p>

                <p>
                    <b>Nota</b>:
                    <br>
                    <ul>
                        <li>L'orario non  modificabile (non  possibile giocare dopo il tramonto)</li>
                        <li>Verr fornita l'attrezzatura minima (casco, fucile e paintballs). Sono consigliati pantaloni lunghi.</li>
                        <li>Il costo delle paintballs  di 5 /200 paintballs. Non ci sono altri costi.</li>
                    </ul>
                </p>`,imageUrl:"/img/paintball.jpg",date:new Date("2024-06-20"),time:["19:00"],maxParticipants:4}),new k_({position:{lat:40.671264,lon:16.596083},id:"matera_14-07",name:"A matera col piumino",description:`<p>
                    Giornata a matera e giro col piumino
                </p>
                <p>
                    Il prossimo dovrebbe essere un fine settimana particolarmente caldo e le previsioni segnalano massime a Matera di 38 gradi. Essendo la temperatura esterna maggiore di quella corporea, potrebbe essere una buona occasione per testare la tenuta dei nostri piumini utilizzati finora solo nel periodo invernale.
                    <br/>
                    Orario: 11:00 - 16:30
                </p>

                <p>
                    <b>Programma</b>:
                    <br>
                    <ul>
                        <li><b>12:00</b> - Arrivo a Matera</li>
                        <li><b>13:00</b> - Pranzo da qualche parte</li>
                        <li><b>14:00</b> - Giro con i piumini</li>
                    </ul>
                </p>`,imageUrl:"/img/matera_piumini.webp",date:new Date("2024-07-14")}),new k_({position:{lat:40.64801,lon:16.059105},id:"paintball_13-07",name:"Partita a Paintball",description:`<p>
                    Partita a paintball, 4 giocatori.
                </p>
                <p>
                    20 Giugno
                    <br/>
                    Orario: slot di 2 ore tra le 10:00 e le 20:30
                </p>

                <p>
                    <b>Nota</b>:
                    <br>
                    <ul>
                        <li>L'orario non  modificabile (non  possibile giocare dopo il tramonto)</li>
                        <li>Verr fornita l'attrezzatura minima (casco, fucile e paintballs). Sono consigliati pantaloni lunghi.</li>
                        <li>Il costo delle paintballs  di 5 /200 paintballs. Non ci sono altri costi.</li>
                    </ul>
                </p>`,imageUrl:"/img/paintball.jpg",date:new Date("2024-07-13"),time:["10:00","11:00","16:00","17:00","18:00"],maxParticipants:4}),new k_({position:{lat:40.64801,lon:16.059105},id:"paintball_day_13-07",name:"Giornata Paintball",description:`<p>
                    Intera giornata a tema paintball. Partite a paintball mattina e pomeriggio e pausa pranzo con carne arrosto.
                </p>
                <p>
                    13 Luglio
                    <br/>
                    Orario: 10:00 - 20:00
                </p>

                <p>
                    <b>Programma</b>:
                    <br>
                    <ul>
                        <li>Partita a paintball in mattinata</li>
                        <li>Pranzo con carne arrosto e riposo nelle ore pi calde</li>
                        <li>Partita nel pomeriggio</li>
                    </ul>
                </p>`,imageUrl:"/img/paintball_day.webp",date:new Date("2024-07-14"),maxParticipants:4})],Lne={class:"events-list"},One={key:0,class:"no-events"},zne={class:"event-card"},Fne={class:"name"},Nne={class:"date"},Bne={key:0,class:"max-participants"},Vne={key:1,class:"times"},Une={class:"time"},jne=Ro({__name:"EventsList",setup(n){const e=new Date,r=S8.filter(s=>s.date>e);return(s,c)=>(li(),Ii("div",Lne,[Hi(r).length===0?(li(),Ii("div",One," Non ci sono eventi al momento ")):Tc("",!0),(li(!0),Ii(Zs,null,qp(Hi(r),d=>(li(),Wg(Hi(fF),{to:`/event/${d.id}`,key:d.id},{default:vg(()=>[Br("div",zne,[Br("div",Fne,Mn(d.name),1),Br("div",Nne,Mn(d.date.toLocaleDateString()),1),d.maxParticipants?(li(),Ii("div",Bne,Mn(d.maxParticipants),1)):Tc("",!0),d.time&&d.time.length>0?(li(),Ii("div",Vne,[(li(!0),Ii(Zs,null,qp(d.time,_=>(li(),Ii("div",Une,Mn(_),1))),256))])):Tc("",!0)])]),_:2},1032,["to"]))),128))]))}}),$ne=gl(jne,[["__scopeId","data-v-6863a988"]]),Gne=n=>(of("data-v-db6797bd"),n=n(),af(),n),qne={class:"home"},Hne=Gne(()=>Br("div",{class:"title"}," Prossimi eventi ",-1)),Wne=Ro({__name:"HomeView",setup(n){return(e,r)=>(li(),Ii("div",qne,[Hne,kn($ne,{class:"event-list"})]))}}),Zne=gl(Wne,[["__scopeId","data-v-db6797bd"]]);var Xne=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Yne(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var C8={exports:{}};(function(n,e){var r={};(function(s,c){n.exports=c()})(Xne,function(){var s,c,d;function _(l,S){if(!s)s=S;else if(!c)c=S;else{var D="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",I={};s(I),d=S(I),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([D],{type:"text/javascript"})))}}_(["exports"],function(l){var S="3.4.0";let D;const I={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(D==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{D=r.API_URL_REGEX!=null?new RegExp(r.API_URL_REGEX):i}catch{D=i}}return D},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!I.API_URL)return null;try{const i=new URL(I.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function V(i){return I.API_URL_REGEX.test(i)}function j(i){return i.indexOf("mapbox:")===0}function Q(i){return I.API_CDN_URL_REGEX.test(i)}function te(i){return I.API_SPRITE_REGEX.test(i)}function ce(i){return I.API_STYLE_REGEX.test(i)&&!te(i)}const Ce={create:"create",load:"load",fullLoad:"fullLoad"};function Me(i){const t=i.name.split("?")[0];return Q(t)&&t.includes("mapbox-gl.js")?"javascript":Q(t)&&t.includes("mapbox-gl.css")?"css":function(o){return I.API_FONTS_REGEX.test(o)}(t)?"fontRange":te(t)?"sprite":ce(t)?"style":function(o){return I.API_TILEJSON_REGEX.test(o)}(t)?"tilejson":"other"}function Ie(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Te={},Ge={};Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.setMatrixArrayType=function(i){Ge.ARRAY_TYPE=ue=i},Ge.toRadian=function(i){return i*_e},Ge.equals=function(i,t){return Math.abs(i-t)<=$e*Math.max(1,Math.abs(i),Math.abs(t))},Ge.RANDOM=Ge.ARRAY_TYPE=Ge.EPSILON=void 0;var $e=1e-6;Ge.EPSILON=$e;var ue=typeof Float32Array<"u"?Float32Array:Array;Ge.ARRAY_TYPE=ue;var pe=Math.random;Ge.RANDOM=pe;var _e=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var ge={};function Fe(i){return Fe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fe(i)}Object.defineProperty(ge,"__esModule",{value:!0}),ge.create=function(){var i=new De.ARRAY_TYPE(4);return De.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i},ge.clone=function(i){var t=new De.ARRAY_TYPE(4);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t},ge.copy=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i},ge.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i},ge.fromValues=function(i,t,o,u){var f=new De.ARRAY_TYPE(4);return f[0]=i,f[1]=t,f[2]=o,f[3]=u,f},ge.set=function(i,t,o,u,f){return i[0]=t,i[1]=o,i[2]=u,i[3]=f,i},ge.transpose=function(i,t){if(i===t){var o=t[1];i[1]=t[2],i[2]=o}else i[0]=t[0],i[1]=t[2],i[2]=t[1],i[3]=t[3];return i},ge.invert=function(i,t){var o=t[0],u=t[1],f=t[2],p=t[3],y=o*p-f*u;return y?(i[0]=p*(y=1/y),i[1]=-u*y,i[2]=-f*y,i[3]=o*y,i):null},ge.adjoint=function(i,t){var o=t[0];return i[0]=t[3],i[1]=-t[1],i[2]=-t[2],i[3]=o,i},ge.determinant=function(i){return i[0]*i[3]-i[2]*i[1]},ge.multiply=pr,ge.rotate=function(i,t,o){var u=t[0],f=t[1],p=t[2],y=t[3],b=Math.sin(o),T=Math.cos(o);return i[0]=u*T+p*b,i[1]=f*T+y*b,i[2]=u*-b+p*T,i[3]=f*-b+y*T,i},ge.scale=function(i,t,o){var u=t[1],f=t[2],p=t[3],y=o[0],b=o[1];return i[0]=t[0]*y,i[1]=u*y,i[2]=f*b,i[3]=p*b,i},ge.fromRotation=function(i,t){var o=Math.sin(t),u=Math.cos(t);return i[0]=u,i[1]=o,i[2]=-o,i[3]=u,i},ge.fromScaling=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=t[1],i},ge.str=function(i){return"mat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},ge.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},ge.LDU=function(i,t,o,u){return i[2]=u[2]/u[0],o[0]=u[0],o[1]=u[1],o[3]=u[3]-i[2]*o[1],[i,t,o]},ge.add=function(i,t,o){return i[0]=t[0]+o[0],i[1]=t[1]+o[1],i[2]=t[2]+o[2],i[3]=t[3]+o[3],i},ge.subtract=or,ge.exactEquals=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]},ge.equals=function(i,t){var o=i[0],u=i[1],f=i[2],p=i[3],y=t[0],b=t[1],T=t[2],A=t[3];return Math.abs(o-y)<=De.EPSILON*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(u-b)<=De.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(f-T)<=De.EPSILON*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(p-A)<=De.EPSILON*Math.max(1,Math.abs(p),Math.abs(A))},ge.multiplyScalar=function(i,t,o){return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i},ge.multiplyScalarAndAdd=function(i,t,o,u){return i[0]=t[0]+o[0]*u,i[1]=t[1]+o[1]*u,i[2]=t[2]+o[2]*u,i[3]=t[3]+o[3]*u,i},ge.sub=ge.mul=void 0;var De=function(i,t){if(i&&i.__esModule)return i;if(i===null||Fe(i)!=="object"&&typeof i!="function")return{default:i};var o=Se(void 0);if(o&&o.has(i))return o.get(i);var u={},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var y=f?Object.getOwnPropertyDescriptor(i,p):null;y&&(y.get||y.set)?Object.defineProperty(u,p,y):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ge);function Se(i){if(typeof WeakMap!="function")return null;var t=new WeakMap,o=new WeakMap;return(Se=function(u){return u?o:t})(i)}function pr(i,t,o){var u=t[0],f=t[1],p=t[2],y=t[3],b=o[0],T=o[1],A=o[2],R=o[3];return i[0]=u*b+p*T,i[1]=f*b+y*T,i[2]=u*A+p*R,i[3]=f*A+y*R,i}function or(i,t,o){return i[0]=t[0]-o[0],i[1]=t[1]-o[1],i[2]=t[2]-o[2],i[3]=t[3]-o[3],i}ge.mul=pr,ge.sub=or;var Vt={};function Ht(i){return Ht=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ht(i)}Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.create=function(){var i=new Kt.ARRAY_TYPE(6);return Kt.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[4]=0,i[5]=0),i[0]=1,i[3]=1,i},Vt.clone=function(i){var t=new Kt.ARRAY_TYPE(6);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t},Vt.copy=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i},Vt.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i},Vt.fromValues=function(i,t,o,u,f,p){var y=new Kt.ARRAY_TYPE(6);return y[0]=i,y[1]=t,y[2]=o,y[3]=u,y[4]=f,y[5]=p,y},Vt.set=function(i,t,o,u,f,p,y){return i[0]=t,i[1]=o,i[2]=u,i[3]=f,i[4]=p,i[5]=y,i},Vt.invert=function(i,t){var o=t[0],u=t[1],f=t[2],p=t[3],y=t[4],b=t[5],T=o*p-u*f;return T?(i[0]=p*(T=1/T),i[1]=-u*T,i[2]=-f*T,i[3]=o*T,i[4]=(f*b-p*y)*T,i[5]=(u*y-o*b)*T,i):null},Vt.determinant=function(i){return i[0]*i[3]-i[1]*i[2]},Vt.multiply=We,Vt.rotate=function(i,t,o){var u=t[0],f=t[1],p=t[2],y=t[3],b=t[4],T=t[5],A=Math.sin(o),R=Math.cos(o);return i[0]=u*R+p*A,i[1]=f*R+y*A,i[2]=u*-A+p*R,i[3]=f*-A+y*R,i[4]=b,i[5]=T,i},Vt.scale=function(i,t,o){var u=t[1],f=t[2],p=t[3],y=t[4],b=t[5],T=o[0],A=o[1];return i[0]=t[0]*T,i[1]=u*T,i[2]=f*A,i[3]=p*A,i[4]=y,i[5]=b,i},Vt.translate=function(i,t,o){var u=t[0],f=t[1],p=t[2],y=t[3],b=t[4],T=t[5],A=o[0],R=o[1];return i[0]=u,i[1]=f,i[2]=p,i[3]=y,i[4]=u*A+p*R+b,i[5]=f*A+y*R+T,i},Vt.fromRotation=function(i,t){var o=Math.sin(t),u=Math.cos(t);return i[0]=u,i[1]=o,i[2]=-o,i[3]=u,i[4]=0,i[5]=0,i},Vt.fromScaling=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=t[1],i[4]=0,i[5]=0,i},Vt.fromTranslation=function(i,t){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=t[0],i[5]=t[1],i},Vt.str=function(i){return"mat2d("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+")"},Vt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],1)},Vt.add=function(i,t,o){return i[0]=t[0]+o[0],i[1]=t[1]+o[1],i[2]=t[2]+o[2],i[3]=t[3]+o[3],i[4]=t[4]+o[4],i[5]=t[5]+o[5],i},Vt.subtract=Sr,Vt.multiplyScalar=function(i,t,o){return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i[4]=t[4]*o,i[5]=t[5]*o,i},Vt.multiplyScalarAndAdd=function(i,t,o,u){return i[0]=t[0]+o[0]*u,i[1]=t[1]+o[1]*u,i[2]=t[2]+o[2]*u,i[3]=t[3]+o[3]*u,i[4]=t[4]+o[4]*u,i[5]=t[5]+o[5]*u,i},Vt.exactEquals=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]},Vt.equals=function(i,t){var o=i[0],u=i[1],f=i[2],p=i[3],y=i[4],b=i[5],T=t[0],A=t[1],R=t[2],P=t[3],L=t[4],z=t[5];return Math.abs(o-T)<=Kt.EPSILON*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(u-A)<=Kt.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(f-R)<=Kt.EPSILON*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(p-P)<=Kt.EPSILON*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(y-L)<=Kt.EPSILON*Math.max(1,Math.abs(y),Math.abs(L))&&Math.abs(b-z)<=Kt.EPSILON*Math.max(1,Math.abs(b),Math.abs(z))},Vt.sub=Vt.mul=void 0;var Kt=function(i,t){if(i&&i.__esModule)return i;if(i===null||Ht(i)!=="object"&&typeof i!="function")return{default:i};var o=Tr(void 0);if(o&&o.has(i))return o.get(i);var u={},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var y=f?Object.getOwnPropertyDescriptor(i,p):null;y&&(y.get||y.set)?Object.defineProperty(u,p,y):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ge);function Tr(i){if(typeof WeakMap!="function")return null;var t=new WeakMap,o=new WeakMap;return(Tr=function(u){return u?o:t})(i)}function We(i,t,o){var u=t[0],f=t[1],p=t[2],y=t[3],b=t[4],T=t[5],A=o[0],R=o[1],P=o[2],L=o[3],z=o[4],N=o[5];return i[0]=u*A+p*R,i[1]=f*A+y*R,i[2]=u*P+p*L,i[3]=f*P+y*L,i[4]=u*z+p*N+b,i[5]=f*z+y*N+T,i}function Sr(i,t,o){return i[0]=t[0]-o[0],i[1]=t[1]-o[1],i[2]=t[2]-o[2],i[3]=t[3]-o[3],i[4]=t[4]-o[4],i[5]=t[5]-o[5],i}Vt.mul=We,Vt.sub=Sr;var Xt={};function ei(i){return ei=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ei(i)}Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.create=function(){var i=new Fr.ARRAY_TYPE(9);return Fr.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i},Xt.fromMat4=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[4],i[4]=t[5],i[5]=t[6],i[6]=t[8],i[7]=t[9],i[8]=t[10],i},Xt.clone=function(i){var t=new Fr.ARRAY_TYPE(9);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t},Xt.copy=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i},Xt.fromValues=function(i,t,o,u,f,p,y,b,T){var A=new Fr.ARRAY_TYPE(9);return A[0]=i,A[1]=t,A[2]=o,A[3]=u,A[4]=f,A[5]=p,A[6]=y,A[7]=b,A[8]=T,A},Xt.set=function(i,t,o,u,f,p,y,b,T,A){return i[0]=t,i[1]=o,i[2]=u,i[3]=f,i[4]=p,i[5]=y,i[6]=b,i[7]=T,i[8]=A,i},Xt.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Xt.transpose=function(i,t){if(i===t){var o=t[1],u=t[2],f=t[5];i[1]=t[3],i[2]=t[6],i[3]=o,i[5]=t[7],i[6]=u,i[7]=f}else i[0]=t[0],i[1]=t[3],i[2]=t[6],i[3]=t[1],i[4]=t[4],i[5]=t[7],i[6]=t[2],i[7]=t[5],i[8]=t[8];return i},Xt.invert=function(i,t){var o=t[0],u=t[1],f=t[2],p=t[3],y=t[4],b=t[5],T=t[6],A=t[7],R=t[8],P=R*y-b*A,L=-R*p+b*T,z=A*p-y*T,N=o*P+u*L+f*z;return N?(i[0]=P*(N=1/N),i[1]=(-R*u+f*A)*N,i[2]=(b*u-f*y)*N,i[3]=L*N,i[4]=(R*o-f*T)*N,i[5]=(-b*o+f*p)*N,i[6]=z*N,i[7]=(-A*o+u*T)*N,i[8]=(y*o-u*p)*N,i):null},Xt.adjoint=function(i,t){var o=t[0],u=t[1],f=t[2],p=t[3],y=t[4],b=t[5],T=t[6],A=t[7],R=t[8];return i[0]=y*R-b*A,i[1]=f*A-u*R,i[2]=u*b-f*y,i[3]=b*T-p*R,i[4]=o*R-f*T,i[5]=f*p-o*b,i[6]=p*A-y*T,i[7]=u*T-o*A,i[8]=o*y-u*p,i},Xt.determinant=function(i){var t=i[3],o=i[4],u=i[5],f=i[6],p=i[7],y=i[8];return i[0]*(y*o-u*p)+i[1]*(-y*t+u*f)+i[2]*(p*t-o*f)},Xt.multiply=qr,Xt.translate=function(i,t,o){var u=t[0],f=t[1],p=t[2],y=t[3],b=t[4],T=t[5],A=t[6],R=t[7],P=t[8],L=o[0],z=o[1];return i[0]=u,i[1]=f,i[2]=p,i[3]=y,i[4]=b,i[5]=T,i[6]=L*u+z*y+A,i[7]=L*f+z*b+R,i[8]=L*p+z*T+P,i},Xt.rotate=function(i,t,o){var u=t[0],f=t[1],p=t[2],y=t[3],b=t[4],T=t[5],A=t[6],R=t[7],P=t[8],L=Math.sin(o),z=Math.cos(o);return i[0]=z*u+L*y,i[1]=z*f+L*b,i[2]=z*p+L*T,i[3]=z*y-L*u,i[4]=z*b-L*f,i[5]=z*T-L*p,i[6]=A,i[7]=R,i[8]=P,i},Xt.scale=function(i,t,o){var u=o[0],f=o[1];return i[0]=u*t[0],i[1]=u*t[1],i[2]=u*t[2],i[3]=f*t[3],i[4]=f*t[4],i[5]=f*t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i},Xt.fromTranslation=function(i,t){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=t[0],i[7]=t[1],i[8]=1,i},Xt.fromRotation=function(i,t){var o=Math.sin(t),u=Math.cos(t);return i[0]=u,i[1]=o,i[2]=0,i[3]=-o,i[4]=u,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Xt.fromScaling=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=t[1],i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Xt.fromMat2d=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=0,i[3]=t[2],i[4]=t[3],i[5]=0,i[6]=t[4],i[7]=t[5],i[8]=1,i},Xt.fromQuat=function(i,t){var o=t[0],u=t[1],f=t[2],p=t[3],y=o+o,b=u+u,T=f+f,A=o*y,R=u*y,P=u*b,L=f*y,z=f*b,N=f*T,U=p*y,H=p*b,W=p*T;return i[0]=1-P-N,i[3]=R-W,i[6]=L+H,i[1]=R+W,i[4]=1-A-N,i[7]=z-U,i[2]=L-H,i[5]=z+U,i[8]=1-A-P,i},Xt.normalFromMat4=function(i,t){var o=t[0],u=t[1],f=t[2],p=t[3],y=t[4],b=t[5],T=t[6],A=t[7],R=t[8],P=t[9],L=t[10],z=t[11],N=t[12],U=t[13],H=t[14],W=t[15],ie=o*b-u*y,le=o*T-f*y,se=o*A-p*y,we=u*T-f*b,he=u*A-p*b,Pe=f*A-p*T,Le=R*U-P*N,qe=R*H-L*N,ot=R*W-z*N,Ye=P*H-L*U,mt=P*W-z*U,pt=L*W-z*H,at=ie*pt-le*mt+se*Ye+we*ot-he*qe+Pe*Le;return at?(i[0]=(b*pt-T*mt+A*Ye)*(at=1/at),i[1]=(T*ot-y*pt-A*qe)*at,i[2]=(y*mt-b*ot+A*Le)*at,i[3]=(f*mt-u*pt-p*Ye)*at,i[4]=(o*pt-f*ot+p*qe)*at,i[5]=(u*ot-o*mt-p*Le)*at,i[6]=(U*Pe-H*he+W*we)*at,i[7]=(H*se-N*Pe-W*le)*at,i[8]=(N*he-U*se+W*ie)*at,i):null},Xt.projection=function(i,t,o){return i[0]=2/t,i[1]=0,i[2]=0,i[3]=0,i[4]=-2/o,i[5]=0,i[6]=-1,i[7]=1,i[8]=1,i},Xt.str=function(i){return"mat3("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+")"},Xt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},Xt.add=function(i,t,o){return i[0]=t[0]+o[0],i[1]=t[1]+o[1],i[2]=t[2]+o[2],i[3]=t[3]+o[3],i[4]=t[4]+o[4],i[5]=t[5]+o[5],i[6]=t[6]+o[6],i[7]=t[7]+o[7],i[8]=t[8]+o[8],i},Xt.subtract=yt,Xt.multiplyScalar=function(i,t,o){return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i[4]=t[4]*o,i[5]=t[5]*o,i[6]=t[6]*o,i[7]=t[7]*o,i[8]=t[8]*o,i},Xt.multiplyScalarAndAdd=function(i,t,o,u){return i[0]=t[0]+o[0]*u,i[1]=t[1]+o[1]*u,i[2]=t[2]+o[2]*u,i[3]=t[3]+o[3]*u,i[4]=t[4]+o[4]*u,i[5]=t[5]+o[5]*u,i[6]=t[6]+o[6]*u,i[7]=t[7]+o[7]*u,i[8]=t[8]+o[8]*u,i},Xt.exactEquals=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]},Xt.equals=function(i,t){var o=i[0],u=i[1],f=i[2],p=i[3],y=i[4],b=i[5],T=i[6],A=i[7],R=i[8],P=t[0],L=t[1],z=t[2],N=t[3],U=t[4],H=t[5],W=t[6],ie=t[7],le=t[8];return Math.abs(o-P)<=Fr.EPSILON*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(u-L)<=Fr.EPSILON*Math.max(1,Math.abs(u),Math.abs(L))&&Math.abs(f-z)<=Fr.EPSILON*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(p-N)<=Fr.EPSILON*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(y-U)<=Fr.EPSILON*Math.max(1,Math.abs(y),Math.abs(U))&&Math.abs(b-H)<=Fr.EPSILON*Math.max(1,Math.abs(b),Math.abs(H))&&Math.abs(T-W)<=Fr.EPSILON*Math.max(1,Math.abs(T),Math.abs(W))&&Math.abs(A-ie)<=Fr.EPSILON*Math.max(1,Math.abs(A),Math.abs(ie))&&Math.abs(R-le)<=Fr.EPSILON*Math.max(1,Math.abs(R),Math.abs(le))},Xt.sub=Xt.mul=void 0;var Fr=function(i,t){if(i&&i.__esModule)return i;if(i===null||ei(i)!=="object"&&typeof i!="function")return{default:i};var o=gi(void 0);if(o&&o.has(i))return o.get(i);var u={},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var y=f?Object.getOwnPropertyDescriptor(i,p):null;y&&(y.get||y.set)?Object.defineProperty(u,p,y):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ge);function gi(i){if(typeof WeakMap!="function")return null;var t=new WeakMap,o=new WeakMap;return(gi=function(u){return u?o:t})(i)}function qr(i,t,o){var u=t[0],f=t[1],p=t[2],y=t[3],b=t[4],T=t[5],A=t[6],R=t[7],P=t[8],L=o[0],z=o[1],N=o[2],U=o[3],H=o[4],W=o[5],ie=o[6],le=o[7],se=o[8];return i[0]=L*u+z*y+N*A,i[1]=L*f+z*b+N*R,i[2]=L*p+z*T+N*P,i[3]=U*u+H*y+W*A,i[4]=U*f+H*b+W*R,i[5]=U*p+H*T+W*P,i[6]=ie*u+le*y+se*A,i[7]=ie*f+le*b+se*R,i[8]=ie*p+le*T+se*P,i}function yt(i,t,o){return i[0]=t[0]-o[0],i[1]=t[1]-o[1],i[2]=t[2]-o[2],i[3]=t[3]-o[3],i[4]=t[4]-o[4],i[5]=t[5]-o[5],i[6]=t[6]-o[6],i[7]=t[7]-o[7],i[8]=t[8]-o[8],i}Xt.mul=qr,Xt.sub=yt;var dt={};function jt(i){return jt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jt(i)}Object.defineProperty(dt,"__esModule",{value:!0}),dt.create=function(){var i=new $t.ARRAY_TYPE(16);return $t.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},dt.clone=function(i){var t=new $t.ARRAY_TYPE(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},dt.copy=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},dt.fromValues=function(i,t,o,u,f,p,y,b,T,A,R,P,L,z,N,U){var H=new $t.ARRAY_TYPE(16);return H[0]=i,H[1]=t,H[2]=o,H[3]=u,H[4]=f,H[5]=p,H[6]=y,H[7]=b,H[8]=T,H[9]=A,H[10]=R,H[11]=P,H[12]=L,H[13]=z,H[14]=N,H[15]=U,H},dt.set=function(i,t,o,u,f,p,y,b,T,A,R,P,L,z,N,U,H){return i[0]=t,i[1]=o,i[2]=u,i[3]=f,i[4]=p,i[5]=y,i[6]=b,i[7]=T,i[8]=A,i[9]=R,i[10]=P,i[11]=L,i[12]=z,i[13]=N,i[14]=U,i[15]=H,i},dt.identity=Er,dt.transpose=function(i,t){if(i===t){var o=t[1],u=t[2],f=t[3],p=t[6],y=t[7],b=t[11];i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=o,i[6]=t[9],i[7]=t[13],i[8]=u,i[9]=p,i[11]=t[14],i[12]=f,i[13]=y,i[14]=b}else i[0]=t[0],i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=t[1],i[5]=t[5],i[6]=t[9],i[7]=t[13],i[8]=t[2],i[9]=t[6],i[10]=t[10],i[11]=t[14],i[12]=t[3],i[13]=t[7],i[14]=t[11],i[15]=t[15];return i},dt.invert=function(i,t){var o=t[0],u=t[1],f=t[2],p=t[3],y=t[4],b=t[5],T=t[6],A=t[7],R=t[8],P=t[9],L=t[10],z=t[11],N=t[12],U=t[13],H=t[14],W=t[15],ie=o*b-u*y,le=o*T-f*y,se=o*A-p*y,we=u*T-f*b,he=u*A-p*b,Pe=f*A-p*T,Le=R*U-P*N,qe=R*H-L*N,ot=R*W-z*N,Ye=P*H-L*U,mt=P*W-z*U,pt=L*W-z*H,at=ie*pt-le*mt+se*Ye+we*ot-he*qe+Pe*Le;return at?(i[0]=(b*pt-T*mt+A*Ye)*(at=1/at),i[1]=(f*mt-u*pt-p*Ye)*at,i[2]=(U*Pe-H*he+W*we)*at,i[3]=(L*he-P*Pe-z*we)*at,i[4]=(T*ot-y*pt-A*qe)*at,i[5]=(o*pt-f*ot+p*qe)*at,i[6]=(H*se-N*Pe-W*le)*at,i[7]=(R*Pe-L*se+z*le)*at,i[8]=(y*mt-b*ot+A*Le)*at,i[9]=(u*ot-o*mt-p*Le)*at,i[10]=(N*he-U*se+W*ie)*at,i[11]=(P*se-R*he-z*ie)*at,i[12]=(b*qe-y*Ye-T*Le)*at,i[13]=(o*Ye-u*qe+f*Le)*at,i[14]=(U*le-N*we-H*ie)*at,i[15]=(R*we-P*le+L*ie)*at,i):null},dt.adjoint=function(i,t){var o=t[0],u=t[1],f=t[2],p=t[3],y=t[4],b=t[5],T=t[6],A=t[7],R=t[8],P=t[9],L=t[10],z=t[11],N=t[12],U=t[13],H=t[14],W=t[15];return i[0]=b*(L*W-z*H)-P*(T*W-A*H)+U*(T*z-A*L),i[1]=-(u*(L*W-z*H)-P*(f*W-p*H)+U*(f*z-p*L)),i[2]=u*(T*W-A*H)-b*(f*W-p*H)+U*(f*A-p*T),i[3]=-(u*(T*z-A*L)-b*(f*z-p*L)+P*(f*A-p*T)),i[4]=-(y*(L*W-z*H)-R*(T*W-A*H)+N*(T*z-A*L)),i[5]=o*(L*W-z*H)-R*(f*W-p*H)+N*(f*z-p*L),i[6]=-(o*(T*W-A*H)-y*(f*W-p*H)+N*(f*A-p*T)),i[7]=o*(T*z-A*L)-y*(f*z-p*L)+R*(f*A-p*T),i[8]=y*(P*W-z*U)-R*(b*W-A*U)+N*(b*z-A*P),i[9]=-(o*(P*W-z*U)-R*(u*W-p*U)+N*(u*z-p*P)),i[10]=o*(b*W-A*U)-y*(u*W-p*U)+N*(u*A-p*b),i[11]=-(o*(b*z-A*P)-y*(u*z-p*P)+R*(u*A-p*b)),i[12]=-(y*(P*H-L*U)-R*(b*H-T*U)+N*(b*L-T*P)),i[13]=o*(P*H-L*U)-R*(u*H-f*U)+N*(u*L-f*P),i[14]=-(o*(b*H-T*U)-y*(u*H-f*U)+N*(u*T-f*b)),i[15]=o*(b*L-T*P)-y*(u*L-f*P)+R*(u*T-f*b),i},dt.determinant=function(i){var t=i[0],o=i[1],u=i[2],f=i[3],p=i[4],y=i[5],b=i[6],T=i[7],A=i[8],R=i[9],P=i[10],L=i[11],z=i[12],N=i[13],U=i[14],H=i[15];return(t*y-o*p)*(P*H-L*U)-(t*b-u*p)*(R*H-L*N)+(t*T-f*p)*(R*U-P*N)+(o*b-u*y)*(A*H-L*z)-(o*T-f*y)*(A*U-P*z)+(u*T-f*b)*(A*N-R*z)},dt.multiply=be,dt.translate=function(i,t,o){var u,f,p,y,b,T,A,R,P,L,z,N,U=o[0],H=o[1],W=o[2];return t===i?(i[12]=t[0]*U+t[4]*H+t[8]*W+t[12],i[13]=t[1]*U+t[5]*H+t[9]*W+t[13],i[14]=t[2]*U+t[6]*H+t[10]*W+t[14],i[15]=t[3]*U+t[7]*H+t[11]*W+t[15]):(f=t[1],p=t[2],y=t[3],b=t[4],T=t[5],A=t[6],R=t[7],P=t[8],L=t[9],z=t[10],N=t[11],i[0]=u=t[0],i[1]=f,i[2]=p,i[3]=y,i[4]=b,i[5]=T,i[6]=A,i[7]=R,i[8]=P,i[9]=L,i[10]=z,i[11]=N,i[12]=u*U+b*H+P*W+t[12],i[13]=f*U+T*H+L*W+t[13],i[14]=p*U+A*H+z*W+t[14],i[15]=y*U+R*H+N*W+t[15]),i},dt.scale=function(i,t,o){var u=o[0],f=o[1],p=o[2];return i[0]=t[0]*u,i[1]=t[1]*u,i[2]=t[2]*u,i[3]=t[3]*u,i[4]=t[4]*f,i[5]=t[5]*f,i[6]=t[6]*f,i[7]=t[7]*f,i[8]=t[8]*p,i[9]=t[9]*p,i[10]=t[10]*p,i[11]=t[11]*p,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},dt.rotate=function(i,t,o,u){var f,p,y,b,T,A,R,P,L,z,N,U,H,W,ie,le,se,we,he,Pe,Le,qe,ot,Ye,mt=u[0],pt=u[1],at=u[2],wt=Math.hypot(mt,pt,at);return wt<$t.EPSILON?null:(mt*=wt=1/wt,pt*=wt,at*=wt,f=Math.sin(o),p=Math.cos(o),T=t[1],A=t[2],R=t[3],L=t[5],z=t[6],N=t[7],H=t[9],W=t[10],ie=t[11],le=mt*mt*(y=1-p)+p,he=mt*pt*y-at*f,Pe=pt*pt*y+p,Le=at*pt*y+mt*f,qe=mt*at*y+pt*f,ot=pt*at*y-mt*f,Ye=at*at*y+p,i[0]=(b=t[0])*le+(P=t[4])*(se=pt*mt*y+at*f)+(U=t[8])*(we=at*mt*y-pt*f),i[1]=T*le+L*se+H*we,i[2]=A*le+z*se+W*we,i[3]=R*le+N*se+ie*we,i[4]=b*he+P*Pe+U*Le,i[5]=T*he+L*Pe+H*Le,i[6]=A*he+z*Pe+W*Le,i[7]=R*he+N*Pe+ie*Le,i[8]=b*qe+P*ot+U*Ye,i[9]=T*qe+L*ot+H*Ye,i[10]=A*qe+z*ot+W*Ye,i[11]=R*qe+N*ot+ie*Ye,t!==i&&(i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i)},dt.rotateX=function(i,t,o){var u=Math.sin(o),f=Math.cos(o),p=t[4],y=t[5],b=t[6],T=t[7],A=t[8],R=t[9],P=t[10],L=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=p*f+A*u,i[5]=y*f+R*u,i[6]=b*f+P*u,i[7]=T*f+L*u,i[8]=A*f-p*u,i[9]=R*f-y*u,i[10]=P*f-b*u,i[11]=L*f-T*u,i},dt.rotateY=function(i,t,o){var u=Math.sin(o),f=Math.cos(o),p=t[0],y=t[1],b=t[2],T=t[3],A=t[8],R=t[9],P=t[10],L=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=p*f-A*u,i[1]=y*f-R*u,i[2]=b*f-P*u,i[3]=T*f-L*u,i[8]=p*u+A*f,i[9]=y*u+R*f,i[10]=b*u+P*f,i[11]=T*u+L*f,i},dt.rotateZ=function(i,t,o){var u=Math.sin(o),f=Math.cos(o),p=t[0],y=t[1],b=t[2],T=t[3],A=t[4],R=t[5],P=t[6],L=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=p*f+A*u,i[1]=y*f+R*u,i[2]=b*f+P*u,i[3]=T*f+L*u,i[4]=A*f-p*u,i[5]=R*f-y*u,i[6]=P*f-b*u,i[7]=L*f-T*u,i},dt.fromTranslation=function(i,t){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,i},dt.fromScaling=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},dt.fromRotation=function(i,t,o){var u,f,p,y=o[0],b=o[1],T=o[2],A=Math.hypot(y,b,T);return A<$t.EPSILON?null:(y*=A=1/A,b*=A,T*=A,u=Math.sin(t),f=Math.cos(t),i[0]=y*y*(p=1-f)+f,i[1]=b*y*p+T*u,i[2]=T*y*p-b*u,i[3]=0,i[4]=y*b*p-T*u,i[5]=b*b*p+f,i[6]=T*b*p+y*u,i[7]=0,i[8]=y*T*p+b*u,i[9]=b*T*p-y*u,i[10]=T*T*p+f,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)},dt.fromXRotation=function(i,t){var o=Math.sin(t),u=Math.cos(t);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=u,i[6]=o,i[7]=0,i[8]=0,i[9]=-o,i[10]=u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},dt.fromYRotation=function(i,t){var o=Math.sin(t),u=Math.cos(t);return i[0]=u,i[1]=0,i[2]=-o,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=o,i[9]=0,i[10]=u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},dt.fromZRotation=function(i,t){var o=Math.sin(t),u=Math.cos(t);return i[0]=u,i[1]=o,i[2]=0,i[3]=0,i[4]=-o,i[5]=u,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},dt.fromRotationTranslation=Ae,dt.fromQuat2=function(i,t){var o=new $t.ARRAY_TYPE(3),u=-t[0],f=-t[1],p=-t[2],y=t[3],b=t[4],T=t[5],A=t[6],R=t[7],P=u*u+f*f+p*p+y*y;return P>0?(o[0]=2*(b*y+R*u+T*p-A*f)/P,o[1]=2*(T*y+R*f+A*u-b*p)/P,o[2]=2*(A*y+R*p+b*f-T*u)/P):(o[0]=2*(b*y+R*u+T*p-A*f),o[1]=2*(T*y+R*f+A*u-b*p),o[2]=2*(A*y+R*p+b*f-T*u)),Ae(i,t,o),i},dt.getTranslation=function(i,t){return i[0]=t[12],i[1]=t[13],i[2]=t[14],i},dt.getScaling=Ze,dt.getRotation=function(i,t){var o=new $t.ARRAY_TYPE(3);Ze(o,t);var u=1/o[0],f=1/o[1],p=1/o[2],y=t[0]*u,b=t[1]*f,T=t[2]*p,A=t[4]*u,R=t[5]*f,P=t[6]*p,L=t[8]*u,z=t[9]*f,N=t[10]*p,U=y+R+N,H=0;return U>0?(H=2*Math.sqrt(U+1),i[3]=.25*H,i[0]=(P-z)/H,i[1]=(L-T)/H,i[2]=(b-A)/H):y>R&&y>N?(H=2*Math.sqrt(1+y-R-N),i[3]=(P-z)/H,i[0]=.25*H,i[1]=(b+A)/H,i[2]=(L+T)/H):R>N?(H=2*Math.sqrt(1+R-y-N),i[3]=(L-T)/H,i[0]=(b+A)/H,i[1]=.25*H,i[2]=(P+z)/H):(H=2*Math.sqrt(1+N-y-R),i[3]=(b-A)/H,i[0]=(L+T)/H,i[1]=(P+z)/H,i[2]=.25*H),i},dt.fromRotationTranslationScale=function(i,t,o,u){var f=t[0],p=t[1],y=t[2],b=t[3],T=f+f,A=p+p,R=y+y,P=f*T,L=f*A,z=f*R,N=p*A,U=p*R,H=y*R,W=b*T,ie=b*A,le=b*R,se=u[0],we=u[1],he=u[2];return i[0]=(1-(N+H))*se,i[1]=(L+le)*se,i[2]=(z-ie)*se,i[3]=0,i[4]=(L-le)*we,i[5]=(1-(P+H))*we,i[6]=(U+W)*we,i[7]=0,i[8]=(z+ie)*he,i[9]=(U-W)*he,i[10]=(1-(P+N))*he,i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i},dt.fromRotationTranslationScaleOrigin=function(i,t,o,u,f){var p=t[0],y=t[1],b=t[2],T=t[3],A=p+p,R=y+y,P=b+b,L=p*A,z=p*R,N=p*P,U=y*R,H=y*P,W=b*P,ie=T*A,le=T*R,se=T*P,we=u[0],he=u[1],Pe=u[2],Le=f[0],qe=f[1],ot=f[2],Ye=(1-(U+W))*we,mt=(z+se)*we,pt=(N-le)*we,at=(z-se)*he,wt=(1-(L+W))*he,xt=(H+ie)*he,St=(N+le)*Pe,Et=(H-ie)*Pe,gt=(1-(L+U))*Pe;return i[0]=Ye,i[1]=mt,i[2]=pt,i[3]=0,i[4]=at,i[5]=wt,i[6]=xt,i[7]=0,i[8]=St,i[9]=Et,i[10]=gt,i[11]=0,i[12]=o[0]+Le-(Ye*Le+at*qe+St*ot),i[13]=o[1]+qe-(mt*Le+wt*qe+Et*ot),i[14]=o[2]+ot-(pt*Le+xt*qe+gt*ot),i[15]=1,i},dt.fromQuat=function(i,t){var o=t[0],u=t[1],f=t[2],p=t[3],y=o+o,b=u+u,T=f+f,A=o*y,R=u*y,P=u*b,L=f*y,z=f*b,N=f*T,U=p*y,H=p*b,W=p*T;return i[0]=1-P-N,i[1]=R+W,i[2]=L-H,i[3]=0,i[4]=R-W,i[5]=1-A-N,i[6]=z+U,i[7]=0,i[8]=L+H,i[9]=z-U,i[10]=1-A-P,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},dt.frustum=function(i,t,o,u,f,p,y){var b=1/(o-t),T=1/(f-u),A=1/(p-y);return i[0]=2*p*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*p*T,i[6]=0,i[7]=0,i[8]=(o+t)*b,i[9]=(f+u)*T,i[10]=(y+p)*A,i[11]=-1,i[12]=0,i[13]=0,i[14]=y*p*2*A,i[15]=0,i},dt.perspectiveNO=lt,dt.perspectiveZO=function(i,t,o,u,f){var p,y=1/Math.tan(t/2);return i[0]=y/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,f!=null&&f!==1/0?(i[10]=f*(p=1/(u-f)),i[14]=f*u*p):(i[10]=-1,i[14]=-u),i},dt.perspectiveFromFieldOfView=function(i,t,o,u){var f=Math.tan(t.upDegrees*Math.PI/180),p=Math.tan(t.downDegrees*Math.PI/180),y=Math.tan(t.leftDegrees*Math.PI/180),b=Math.tan(t.rightDegrees*Math.PI/180),T=2/(y+b),A=2/(f+p);return i[0]=T,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=A,i[6]=0,i[7]=0,i[8]=-(y-b)*T*.5,i[9]=(f-p)*A*.5,i[10]=u/(o-u),i[11]=-1,i[12]=0,i[13]=0,i[14]=u*o/(o-u),i[15]=0,i},dt.orthoNO=Ee,dt.orthoZO=function(i,t,o,u,f,p,y){var b=1/(t-o),T=1/(u-f),A=1/(p-y);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*T,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=A,i[11]=0,i[12]=(t+o)*b,i[13]=(f+u)*T,i[14]=p*A,i[15]=1,i},dt.lookAt=function(i,t,o,u){var f,p,y,b,T,A,R,P,L,z,N=t[0],U=t[1],H=t[2],W=u[0],ie=u[1],le=u[2],se=o[0],we=o[1],he=o[2];return Math.abs(N-se)<$t.EPSILON&&Math.abs(U-we)<$t.EPSILON&&Math.abs(H-he)<$t.EPSILON?Er(i):(R=N-se,P=U-we,L=H-he,f=ie*(L*=z=1/Math.hypot(R,P,L))-le*(P*=z),p=le*(R*=z)-W*L,y=W*P-ie*R,(z=Math.hypot(f,p,y))?(f*=z=1/z,p*=z,y*=z):(f=0,p=0,y=0),b=P*y-L*p,T=L*f-R*y,A=R*p-P*f,(z=Math.hypot(b,T,A))?(b*=z=1/z,T*=z,A*=z):(b=0,T=0,A=0),i[0]=f,i[1]=b,i[2]=R,i[3]=0,i[4]=p,i[5]=T,i[6]=P,i[7]=0,i[8]=y,i[9]=A,i[10]=L,i[11]=0,i[12]=-(f*N+p*U+y*H),i[13]=-(b*N+T*U+A*H),i[14]=-(R*N+P*U+L*H),i[15]=1,i)},dt.targetTo=function(i,t,o,u){var f=t[0],p=t[1],y=t[2],b=u[0],T=u[1],A=u[2],R=f-o[0],P=p-o[1],L=y-o[2],z=R*R+P*P+L*L;z>0&&(R*=z=1/Math.sqrt(z),P*=z,L*=z);var N=T*L-A*P,U=A*R-b*L,H=b*P-T*R;return(z=N*N+U*U+H*H)>0&&(N*=z=1/Math.sqrt(z),U*=z,H*=z),i[0]=N,i[1]=U,i[2]=H,i[3]=0,i[4]=P*H-L*U,i[5]=L*N-R*H,i[6]=R*U-P*N,i[7]=0,i[8]=R,i[9]=P,i[10]=L,i[11]=0,i[12]=f,i[13]=p,i[14]=y,i[15]=1,i},dt.str=function(i){return"mat4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+", "+i[9]+", "+i[10]+", "+i[11]+", "+i[12]+", "+i[13]+", "+i[14]+", "+i[15]+")"},dt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])},dt.add=function(i,t,o){return i[0]=t[0]+o[0],i[1]=t[1]+o[1],i[2]=t[2]+o[2],i[3]=t[3]+o[3],i[4]=t[4]+o[4],i[5]=t[5]+o[5],i[6]=t[6]+o[6],i[7]=t[7]+o[7],i[8]=t[8]+o[8],i[9]=t[9]+o[9],i[10]=t[10]+o[10],i[11]=t[11]+o[11],i[12]=t[12]+o[12],i[13]=t[13]+o[13],i[14]=t[14]+o[14],i[15]=t[15]+o[15],i},dt.subtract=Ft,dt.multiplyScalar=function(i,t,o){return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i[4]=t[4]*o,i[5]=t[5]*o,i[6]=t[6]*o,i[7]=t[7]*o,i[8]=t[8]*o,i[9]=t[9]*o,i[10]=t[10]*o,i[11]=t[11]*o,i[12]=t[12]*o,i[13]=t[13]*o,i[14]=t[14]*o,i[15]=t[15]*o,i},dt.multiplyScalarAndAdd=function(i,t,o,u){return i[0]=t[0]+o[0]*u,i[1]=t[1]+o[1]*u,i[2]=t[2]+o[2]*u,i[3]=t[3]+o[3]*u,i[4]=t[4]+o[4]*u,i[5]=t[5]+o[5]*u,i[6]=t[6]+o[6]*u,i[7]=t[7]+o[7]*u,i[8]=t[8]+o[8]*u,i[9]=t[9]+o[9]*u,i[10]=t[10]+o[10]*u,i[11]=t[11]+o[11]*u,i[12]=t[12]+o[12]*u,i[13]=t[13]+o[13]*u,i[14]=t[14]+o[14]*u,i[15]=t[15]+o[15]*u,i},dt.exactEquals=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},dt.equals=function(i,t){var o=i[0],u=i[1],f=i[2],p=i[3],y=i[4],b=i[5],T=i[6],A=i[7],R=i[8],P=i[9],L=i[10],z=i[11],N=i[12],U=i[13],H=i[14],W=i[15],ie=t[0],le=t[1],se=t[2],we=t[3],he=t[4],Pe=t[5],Le=t[6],qe=t[7],ot=t[8],Ye=t[9],mt=t[10],pt=t[11],at=t[12],wt=t[13],xt=t[14],St=t[15];return Math.abs(o-ie)<=$t.EPSILON*Math.max(1,Math.abs(o),Math.abs(ie))&&Math.abs(u-le)<=$t.EPSILON*Math.max(1,Math.abs(u),Math.abs(le))&&Math.abs(f-se)<=$t.EPSILON*Math.max(1,Math.abs(f),Math.abs(se))&&Math.abs(p-we)<=$t.EPSILON*Math.max(1,Math.abs(p),Math.abs(we))&&Math.abs(y-he)<=$t.EPSILON*Math.max(1,Math.abs(y),Math.abs(he))&&Math.abs(b-Pe)<=$t.EPSILON*Math.max(1,Math.abs(b),Math.abs(Pe))&&Math.abs(T-Le)<=$t.EPSILON*Math.max(1,Math.abs(T),Math.abs(Le))&&Math.abs(A-qe)<=$t.EPSILON*Math.max(1,Math.abs(A),Math.abs(qe))&&Math.abs(R-ot)<=$t.EPSILON*Math.max(1,Math.abs(R),Math.abs(ot))&&Math.abs(P-Ye)<=$t.EPSILON*Math.max(1,Math.abs(P),Math.abs(Ye))&&Math.abs(L-mt)<=$t.EPSILON*Math.max(1,Math.abs(L),Math.abs(mt))&&Math.abs(z-pt)<=$t.EPSILON*Math.max(1,Math.abs(z),Math.abs(pt))&&Math.abs(N-at)<=$t.EPSILON*Math.max(1,Math.abs(N),Math.abs(at))&&Math.abs(U-wt)<=$t.EPSILON*Math.max(1,Math.abs(U),Math.abs(wt))&&Math.abs(H-xt)<=$t.EPSILON*Math.max(1,Math.abs(H),Math.abs(xt))&&Math.abs(W-St)<=$t.EPSILON*Math.max(1,Math.abs(W),Math.abs(St))},dt.sub=dt.mul=dt.ortho=dt.perspective=void 0;var $t=function(i,t){if(i&&i.__esModule)return i;if(i===null||jt(i)!=="object"&&typeof i!="function")return{default:i};var o=Mr(void 0);if(o&&o.has(i))return o.get(i);var u={},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var y=f?Object.getOwnPropertyDescriptor(i,p):null;y&&(y.get||y.set)?Object.defineProperty(u,p,y):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ge);function Mr(i){if(typeof WeakMap!="function")return null;var t=new WeakMap,o=new WeakMap;return(Mr=function(u){return u?o:t})(i)}function Er(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function be(i,t,o){var u=t[0],f=t[1],p=t[2],y=t[3],b=t[4],T=t[5],A=t[6],R=t[7],P=t[8],L=t[9],z=t[10],N=t[11],U=t[12],H=t[13],W=t[14],ie=t[15],le=o[0],se=o[1],we=o[2],he=o[3];return i[0]=le*u+se*b+we*P+he*U,i[1]=le*f+se*T+we*L+he*H,i[2]=le*p+se*A+we*z+he*W,i[3]=le*y+se*R+we*N+he*ie,i[4]=(le=o[4])*u+(se=o[5])*b+(we=o[6])*P+(he=o[7])*U,i[5]=le*f+se*T+we*L+he*H,i[6]=le*p+se*A+we*z+he*W,i[7]=le*y+se*R+we*N+he*ie,i[8]=(le=o[8])*u+(se=o[9])*b+(we=o[10])*P+(he=o[11])*U,i[9]=le*f+se*T+we*L+he*H,i[10]=le*p+se*A+we*z+he*W,i[11]=le*y+se*R+we*N+he*ie,i[12]=(le=o[12])*u+(se=o[13])*b+(we=o[14])*P+(he=o[15])*U,i[13]=le*f+se*T+we*L+he*H,i[14]=le*p+se*A+we*z+he*W,i[15]=le*y+se*R+we*N+he*ie,i}function Ae(i,t,o){var u=t[0],f=t[1],p=t[2],y=t[3],b=u+u,T=f+f,A=p+p,R=u*b,P=u*T,L=u*A,z=f*T,N=f*A,U=p*A,H=y*b,W=y*T,ie=y*A;return i[0]=1-(z+U),i[1]=P+ie,i[2]=L-W,i[3]=0,i[4]=P-ie,i[5]=1-(R+U),i[6]=N+H,i[7]=0,i[8]=L+W,i[9]=N-H,i[10]=1-(R+z),i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i}function Ze(i,t){var o=t[4],u=t[5],f=t[6],p=t[8],y=t[9],b=t[10];return i[0]=Math.hypot(t[0],t[1],t[2]),i[1]=Math.hypot(o,u,f),i[2]=Math.hypot(p,y,b),i}function lt(i,t,o,u,f){var p,y=1/Math.tan(t/2);return i[0]=y/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,f!=null&&f!==1/0?(i[10]=(f+u)*(p=1/(u-f)),i[14]=2*f*u*p):(i[10]=-1,i[14]=-2*u),i}function Ee(i,t,o,u,f,p,y){var b=1/(t-o),T=1/(u-f),A=1/(p-y);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*T,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*A,i[11]=0,i[12]=(t+o)*b,i[13]=(f+u)*T,i[14]=(y+p)*A,i[15]=1,i}function Ft(i,t,o){return i[0]=t[0]-o[0],i[1]=t[1]-o[1],i[2]=t[2]-o[2],i[3]=t[3]-o[3],i[4]=t[4]-o[4],i[5]=t[5]-o[5],i[6]=t[6]-o[6],i[7]=t[7]-o[7],i[8]=t[8]-o[8],i[9]=t[9]-o[9],i[10]=t[10]-o[10],i[11]=t[11]-o[11],i[12]=t[12]-o[12],i[13]=t[13]-o[13],i[14]=t[14]-o[14],i[15]=t[15]-o[15],i}dt.perspective=lt,dt.ortho=Ee,dt.mul=be,dt.sub=Ft;var ft={},nt={};function Ot(i){return Ot=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ot(i)}Object.defineProperty(nt,"__esModule",{value:!0}),nt.create=re,nt.clone=function(i){var t=new Mt.ARRAY_TYPE(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t},nt.length=oe,nt.fromValues=function(i,t,o){var u=new Mt.ARRAY_TYPE(3);return u[0]=i,u[1]=t,u[2]=o,u},nt.copy=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i},nt.set=function(i,t,o,u){return i[0]=t,i[1]=o,i[2]=u,i},nt.add=function(i,t,o){return i[0]=t[0]+o[0],i[1]=t[1]+o[1],i[2]=t[2]+o[2],i},nt.subtract=xe,nt.multiply=Be,nt.divide=Ke,nt.ceil=function(i,t){return i[0]=Math.ceil(t[0]),i[1]=Math.ceil(t[1]),i[2]=Math.ceil(t[2]),i},nt.floor=function(i,t){return i[0]=Math.floor(t[0]),i[1]=Math.floor(t[1]),i[2]=Math.floor(t[2]),i},nt.min=function(i,t,o){return i[0]=Math.min(t[0],o[0]),i[1]=Math.min(t[1],o[1]),i[2]=Math.min(t[2],o[2]),i},nt.max=function(i,t,o){return i[0]=Math.max(t[0],o[0]),i[1]=Math.max(t[1],o[1]),i[2]=Math.max(t[2],o[2]),i},nt.round=function(i,t){return i[0]=Math.round(t[0]),i[1]=Math.round(t[1]),i[2]=Math.round(t[2]),i},nt.scale=function(i,t,o){return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i},nt.scaleAndAdd=function(i,t,o,u){return i[0]=t[0]+o[0]*u,i[1]=t[1]+o[1]*u,i[2]=t[2]+o[2]*u,i},nt.distance=ct,nt.squaredDistance=zt,nt.squaredLength=st,nt.negate=function(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i},nt.inverse=function(i,t){return i[0]=1/t[0],i[1]=1/t[1],i[2]=1/t[2],i},nt.normalize=function(i,t){var o=t[0],u=t[1],f=t[2],p=o*o+u*u+f*f;return p>0&&(p=1/Math.sqrt(p)),i[0]=t[0]*p,i[1]=t[1]*p,i[2]=t[2]*p,i},nt.dot=Ct,nt.cross=function(i,t,o){var u=t[0],f=t[1],p=t[2],y=o[0],b=o[1],T=o[2];return i[0]=f*T-p*b,i[1]=p*y-u*T,i[2]=u*b-f*y,i},nt.lerp=function(i,t,o,u){var f=t[0],p=t[1],y=t[2];return i[0]=f+u*(o[0]-f),i[1]=p+u*(o[1]-p),i[2]=y+u*(o[2]-y),i},nt.hermite=function(i,t,o,u,f,p){var y=p*p,b=y*(2*p-3)+1,T=y*(p-2)+p,A=y*(p-1),R=y*(3-2*p);return i[0]=t[0]*b+o[0]*T+u[0]*A+f[0]*R,i[1]=t[1]*b+o[1]*T+u[1]*A+f[1]*R,i[2]=t[2]*b+o[2]*T+u[2]*A+f[2]*R,i},nt.bezier=function(i,t,o,u,f,p){var y=1-p,b=y*y,T=p*p,A=b*y,R=3*p*b,P=3*T*y,L=T*p;return i[0]=t[0]*A+o[0]*R+u[0]*P+f[0]*L,i[1]=t[1]*A+o[1]*R+u[1]*P+f[1]*L,i[2]=t[2]*A+o[2]*R+u[2]*P+f[2]*L,i},nt.random=function(i,t){t=t||1;var o=2*Mt.RANDOM()*Math.PI,u=2*Mt.RANDOM()-1,f=Math.sqrt(1-u*u)*t;return i[0]=Math.cos(o)*f,i[1]=Math.sin(o)*f,i[2]=u*t,i},nt.transformMat4=function(i,t,o){var u=t[0],f=t[1],p=t[2],y=o[3]*u+o[7]*f+o[11]*p+o[15];return i[0]=(o[0]*u+o[4]*f+o[8]*p+o[12])/(y=y||1),i[1]=(o[1]*u+o[5]*f+o[9]*p+o[13])/y,i[2]=(o[2]*u+o[6]*f+o[10]*p+o[14])/y,i},nt.transformMat3=function(i,t,o){var u=t[0],f=t[1],p=t[2];return i[0]=u*o[0]+f*o[3]+p*o[6],i[1]=u*o[1]+f*o[4]+p*o[7],i[2]=u*o[2]+f*o[5]+p*o[8],i},nt.transformQuat=function(i,t,o){var u=o[0],f=o[1],p=o[2],y=t[0],b=t[1],T=t[2],A=f*T-p*b,R=p*y-u*T,P=u*b-f*y,L=f*P-p*R,z=p*A-u*P,N=u*R-f*A,U=2*o[3];return R*=U,P*=U,z*=2,N*=2,i[0]=y+(A*=U)+(L*=2),i[1]=b+R+z,i[2]=T+P+N,i},nt.rotateX=function(i,t,o,u){var f=[],p=[];return f[0]=t[0]-o[0],f[1]=t[1]-o[1],f[2]=t[2]-o[2],p[0]=f[0],p[1]=f[1]*Math.cos(u)-f[2]*Math.sin(u),p[2]=f[1]*Math.sin(u)+f[2]*Math.cos(u),i[0]=p[0]+o[0],i[1]=p[1]+o[1],i[2]=p[2]+o[2],i},nt.rotateY=function(i,t,o,u){var f=[],p=[];return f[0]=t[0]-o[0],f[1]=t[1]-o[1],f[2]=t[2]-o[2],p[0]=f[2]*Math.sin(u)+f[0]*Math.cos(u),p[1]=f[1],p[2]=f[2]*Math.cos(u)-f[0]*Math.sin(u),i[0]=p[0]+o[0],i[1]=p[1]+o[1],i[2]=p[2]+o[2],i},nt.rotateZ=function(i,t,o,u){var f=[],p=[];return f[0]=t[0]-o[0],f[1]=t[1]-o[1],f[2]=t[2]-o[2],p[0]=f[0]*Math.cos(u)-f[1]*Math.sin(u),p[1]=f[0]*Math.sin(u)+f[1]*Math.cos(u),p[2]=f[2],i[0]=p[0]+o[0],i[1]=p[1]+o[1],i[2]=p[2]+o[2],i},nt.angle=function(i,t){var o=i[0],u=i[1],f=i[2],p=t[0],y=t[1],b=t[2],T=Math.sqrt(o*o+u*u+f*f)*Math.sqrt(p*p+y*y+b*b),A=T&&Ct(i,t)/T;return Math.acos(Math.min(Math.max(A,-1),1))},nt.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i},nt.str=function(i){return"vec3("+i[0]+", "+i[1]+", "+i[2]+")"},nt.exactEquals=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]},nt.equals=function(i,t){var o=i[0],u=i[1],f=i[2],p=t[0],y=t[1],b=t[2];return Math.abs(o-p)<=Mt.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(u-y)<=Mt.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(f-b)<=Mt.EPSILON*Math.max(1,Math.abs(f),Math.abs(b))},nt.forEach=nt.sqrLen=nt.len=nt.sqrDist=nt.dist=nt.div=nt.mul=nt.sub=void 0;var Mt=function(i,t){if(i&&i.__esModule)return i;if(i===null||Ot(i)!=="object"&&typeof i!="function")return{default:i};var o=je(void 0);if(o&&o.has(i))return o.get(i);var u={},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var y=f?Object.getOwnPropertyDescriptor(i,p):null;y&&(y.get||y.set)?Object.defineProperty(u,p,y):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ge);function je(i){if(typeof WeakMap!="function")return null;var t=new WeakMap,o=new WeakMap;return(je=function(u){return u?o:t})(i)}function re(){var i=new Mt.ARRAY_TYPE(3);return Mt.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function oe(i){return Math.hypot(i[0],i[1],i[2])}function xe(i,t,o){return i[0]=t[0]-o[0],i[1]=t[1]-o[1],i[2]=t[2]-o[2],i}function Be(i,t,o){return i[0]=t[0]*o[0],i[1]=t[1]*o[1],i[2]=t[2]*o[2],i}function Ke(i,t,o){return i[0]=t[0]/o[0],i[1]=t[1]/o[1],i[2]=t[2]/o[2],i}function ct(i,t){return Math.hypot(t[0]-i[0],t[1]-i[1],t[2]-i[2])}function zt(i,t){var o=t[0]-i[0],u=t[1]-i[1],f=t[2]-i[2];return o*o+u*u+f*f}function st(i){var t=i[0],o=i[1],u=i[2];return t*t+o*o+u*u}function Ct(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}nt.sub=xe,nt.mul=Be,nt.div=Ke,nt.dist=ct,nt.sqrDist=zt,nt.len=oe,nt.sqrLen=st;var qt,Wt=(qt=re(),function(i,t,o,u,f,p){var y,b;for(t||(t=3),o||(o=0),b=u?Math.min(u*t+o,i.length):i.length,y=o;y<b;y+=t)qt[0]=i[y],qt[1]=i[y+1],qt[2]=i[y+2],f(qt,qt,p),i[y]=qt[0],i[y+1]=qt[1],i[y+2]=qt[2];return i});nt.forEach=Wt;var Nt={};function jr(i){return jr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jr(i)}Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.create=mr,Nt.clone=function(i){var t=new Or.ARRAY_TYPE(4);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t},Nt.fromValues=function(i,t,o,u){var f=new Or.ARRAY_TYPE(4);return f[0]=i,f[1]=t,f[2]=o,f[3]=u,f},Nt.copy=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i},Nt.set=function(i,t,o,u,f){return i[0]=t,i[1]=o,i[2]=u,i[3]=f,i},Nt.add=function(i,t,o){return i[0]=t[0]+o[0],i[1]=t[1]+o[1],i[2]=t[2]+o[2],i[3]=t[3]+o[3],i},Nt.subtract=ni,Nt.multiply=Kr,Nt.divide=Ti,Nt.ceil=function(i,t){return i[0]=Math.ceil(t[0]),i[1]=Math.ceil(t[1]),i[2]=Math.ceil(t[2]),i[3]=Math.ceil(t[3]),i},Nt.floor=function(i,t){return i[0]=Math.floor(t[0]),i[1]=Math.floor(t[1]),i[2]=Math.floor(t[2]),i[3]=Math.floor(t[3]),i},Nt.min=function(i,t,o){return i[0]=Math.min(t[0],o[0]),i[1]=Math.min(t[1],o[1]),i[2]=Math.min(t[2],o[2]),i[3]=Math.min(t[3],o[3]),i},Nt.max=function(i,t,o){return i[0]=Math.max(t[0],o[0]),i[1]=Math.max(t[1],o[1]),i[2]=Math.max(t[2],o[2]),i[3]=Math.max(t[3],o[3]),i},Nt.round=function(i,t){return i[0]=Math.round(t[0]),i[1]=Math.round(t[1]),i[2]=Math.round(t[2]),i[3]=Math.round(t[3]),i},Nt.scale=function(i,t,o){return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i},Nt.scaleAndAdd=function(i,t,o,u){return i[0]=t[0]+o[0]*u,i[1]=t[1]+o[1]*u,i[2]=t[2]+o[2]*u,i[3]=t[3]+o[3]*u,i},Nt.distance=Zi,Nt.squaredDistance=mi,Nt.length=Ln,Nt.squaredLength=fn,Nt.negate=function(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i[3]=-t[3],i},Nt.inverse=function(i,t){return i[0]=1/t[0],i[1]=1/t[1],i[2]=1/t[2],i[3]=1/t[3],i},Nt.normalize=function(i,t){var o=t[0],u=t[1],f=t[2],p=t[3],y=o*o+u*u+f*f+p*p;return y>0&&(y=1/Math.sqrt(y)),i[0]=o*y,i[1]=u*y,i[2]=f*y,i[3]=p*y,i},Nt.dot=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},Nt.cross=function(i,t,o,u){var f=o[0]*u[1]-o[1]*u[0],p=o[0]*u[2]-o[2]*u[0],y=o[0]*u[3]-o[3]*u[0],b=o[1]*u[2]-o[2]*u[1],T=o[1]*u[3]-o[3]*u[1],A=o[2]*u[3]-o[3]*u[2],R=t[0],P=t[1],L=t[2],z=t[3];return i[0]=P*A-L*T+z*b,i[1]=-R*A+L*y-z*p,i[2]=R*T-P*y+z*f,i[3]=-R*b+P*p-L*f,i},Nt.lerp=function(i,t,o,u){var f=t[0],p=t[1],y=t[2],b=t[3];return i[0]=f+u*(o[0]-f),i[1]=p+u*(o[1]-p),i[2]=y+u*(o[2]-y),i[3]=b+u*(o[3]-b),i},Nt.random=function(i,t){var o,u,f,p,y,b;t=t||1;do y=(o=2*Or.RANDOM()-1)*o+(u=2*Or.RANDOM()-1)*u;while(y>=1);do b=(f=2*Or.RANDOM()-1)*f+(p=2*Or.RANDOM()-1)*p;while(b>=1);var T=Math.sqrt((1-y)/b);return i[0]=t*o,i[1]=t*u,i[2]=t*f*T,i[3]=t*p*T,i},Nt.transformMat4=function(i,t,o){var u=t[0],f=t[1],p=t[2],y=t[3];return i[0]=o[0]*u+o[4]*f+o[8]*p+o[12]*y,i[1]=o[1]*u+o[5]*f+o[9]*p+o[13]*y,i[2]=o[2]*u+o[6]*f+o[10]*p+o[14]*y,i[3]=o[3]*u+o[7]*f+o[11]*p+o[15]*y,i},Nt.transformQuat=function(i,t,o){var u=t[0],f=t[1],p=t[2],y=o[0],b=o[1],T=o[2],A=o[3],R=A*u+b*p-T*f,P=A*f+T*u-y*p,L=A*p+y*f-b*u,z=-y*u-b*f-T*p;return i[0]=R*A+z*-y+P*-T-L*-b,i[1]=P*A+z*-b+L*-y-R*-T,i[2]=L*A+z*-T+R*-b-P*-y,i[3]=t[3],i},Nt.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=0,i},Nt.str=function(i){return"vec4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},Nt.exactEquals=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]},Nt.equals=function(i,t){var o=i[0],u=i[1],f=i[2],p=i[3],y=t[0],b=t[1],T=t[2],A=t[3];return Math.abs(o-y)<=Or.EPSILON*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(u-b)<=Or.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(f-T)<=Or.EPSILON*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(p-A)<=Or.EPSILON*Math.max(1,Math.abs(p),Math.abs(A))},Nt.forEach=Nt.sqrLen=Nt.len=Nt.sqrDist=Nt.dist=Nt.div=Nt.mul=Nt.sub=void 0;var Or=function(i,t){if(i&&i.__esModule)return i;if(i===null||jr(i)!=="object"&&typeof i!="function")return{default:i};var o=ii(void 0);if(o&&o.has(i))return o.get(i);var u={},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var y=f?Object.getOwnPropertyDescriptor(i,p):null;y&&(y.get||y.set)?Object.defineProperty(u,p,y):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ge);function ii(i){if(typeof WeakMap!="function")return null;var t=new WeakMap,o=new WeakMap;return(ii=function(u){return u?o:t})(i)}function mr(){var i=new Or.ARRAY_TYPE(4);return Or.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function ni(i,t,o){return i[0]=t[0]-o[0],i[1]=t[1]-o[1],i[2]=t[2]-o[2],i[3]=t[3]-o[3],i}function Kr(i,t,o){return i[0]=t[0]*o[0],i[1]=t[1]*o[1],i[2]=t[2]*o[2],i[3]=t[3]*o[3],i}function Ti(i,t,o){return i[0]=t[0]/o[0],i[1]=t[1]/o[1],i[2]=t[2]/o[2],i[3]=t[3]/o[3],i}function Zi(i,t){return Math.hypot(t[0]-i[0],t[1]-i[1],t[2]-i[2],t[3]-i[3])}function mi(i,t){var o=t[0]-i[0],u=t[1]-i[1],f=t[2]-i[2],p=t[3]-i[3];return o*o+u*u+f*f+p*p}function Ln(i){return Math.hypot(i[0],i[1],i[2],i[3])}function fn(i){var t=i[0],o=i[1],u=i[2],f=i[3];return t*t+o*o+u*u+f*f}Nt.sub=ni,Nt.mul=Kr,Nt.div=Ti,Nt.dist=Zi,Nt.sqrDist=mi,Nt.len=Ln,Nt.sqrLen=fn;var hs=function(){var i=mr();return function(t,o,u,f,p,y){var b,T;for(o||(o=4),u||(u=0),T=f?Math.min(f*o+u,t.length):t.length,b=u;b<T;b+=o)i[0]=t[b],i[1]=t[b+1],i[2]=t[b+2],i[3]=t[b+3],p(i,i,y),t[b]=i[0],t[b+1]=i[1],t[b+2]=i[2],t[b+3]=i[3];return t}}();function wr(i){return wr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wr(i)}Nt.forEach=hs,Object.defineProperty(ft,"__esModule",{value:!0}),ft.create=Lt,ft.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i},ft.setAxisAngle=bt,ft.getAxisAngle=function(i,t){var o=2*Math.acos(t[3]),u=Math.sin(o/2);return u>_r.EPSILON?(i[0]=t[0]/u,i[1]=t[1]/u,i[2]=t[2]/u):(i[0]=1,i[1]=0,i[2]=0),o},ft.getAngle=function(i,t){var o=Ir(i,t);return Math.acos(2*o*o-1)},ft.multiply=Rt,ft.rotateX=function(i,t,o){o*=.5;var u=t[0],f=t[1],p=t[2],y=t[3],b=Math.sin(o),T=Math.cos(o);return i[0]=u*T+y*b,i[1]=f*T+p*b,i[2]=p*T-f*b,i[3]=y*T-u*b,i},ft.rotateY=function(i,t,o){o*=.5;var u=t[0],f=t[1],p=t[2],y=t[3],b=Math.sin(o),T=Math.cos(o);return i[0]=u*T-p*b,i[1]=f*T+y*b,i[2]=p*T+u*b,i[3]=y*T-f*b,i},ft.rotateZ=function(i,t,o){o*=.5;var u=t[0],f=t[1],p=t[2],y=t[3],b=Math.sin(o),T=Math.cos(o);return i[0]=u*T+f*b,i[1]=f*T-u*b,i[2]=p*T+y*b,i[3]=y*T-p*b,i},ft.calculateW=function(i,t){var o=t[0],u=t[1],f=t[2];return i[0]=o,i[1]=u,i[2]=f,i[3]=Math.sqrt(Math.abs(1-o*o-u*u-f*f)),i},ft.exp=Bt,ft.ln=It,ft.pow=function(i,t,o){return It(i,t),Yt(i,i,o),Bt(i,i),i},ft.slerp=ar,ft.random=function(i){var t=_r.RANDOM(),o=_r.RANDOM(),u=_r.RANDOM(),f=Math.sqrt(1-t),p=Math.sqrt(t);return i[0]=f*Math.sin(2*Math.PI*o),i[1]=f*Math.cos(2*Math.PI*o),i[2]=p*Math.sin(2*Math.PI*u),i[3]=p*Math.cos(2*Math.PI*u),i},ft.invert=function(i,t){var o=t[0],u=t[1],f=t[2],p=t[3],y=o*o+u*u+f*f+p*p,b=y?1/y:0;return i[0]=-o*b,i[1]=-u*b,i[2]=-f*b,i[3]=p*b,i},ft.conjugate=function(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i[3]=t[3],i},ft.fromMat3=gr,ft.fromEuler=function(i,t,o,u){var f=.5*Math.PI/180;t*=f,o*=f,u*=f;var p=Math.sin(t),y=Math.cos(t),b=Math.sin(o),T=Math.cos(o),A=Math.sin(u),R=Math.cos(u);return i[0]=p*T*R-y*b*A,i[1]=y*b*R+p*T*A,i[2]=y*T*A-p*b*R,i[3]=y*T*R+p*b*A,i},ft.str=function(i){return"quat("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},ft.setAxes=ft.sqlerp=ft.rotationTo=ft.equals=ft.exactEquals=ft.normalize=ft.sqrLen=ft.squaredLength=ft.len=ft.length=ft.lerp=ft.dot=ft.scale=ft.mul=ft.add=ft.set=ft.copy=ft.fromValues=ft.clone=void 0;var _r=_t(Ge),Xe=_t(Xt),Ve=_t(nt),tt=_t(Nt);function ut(i){if(typeof WeakMap!="function")return null;var t=new WeakMap,o=new WeakMap;return(ut=function(u){return u?o:t})(i)}function _t(i,t){if(i&&i.__esModule)return i;if(i===null||wr(i)!=="object"&&typeof i!="function")return{default:i};var o=ut(t);if(o&&o.has(i))return o.get(i);var u={},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var y=f?Object.getOwnPropertyDescriptor(i,p):null;y&&(y.get||y.set)?Object.defineProperty(u,p,y):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}function Lt(){var i=new _r.ARRAY_TYPE(4);return _r.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function bt(i,t,o){o*=.5;var u=Math.sin(o);return i[0]=u*t[0],i[1]=u*t[1],i[2]=u*t[2],i[3]=Math.cos(o),i}function Rt(i,t,o){var u=t[0],f=t[1],p=t[2],y=t[3],b=o[0],T=o[1],A=o[2],R=o[3];return i[0]=u*R+y*b+f*A-p*T,i[1]=f*R+y*T+p*b-u*A,i[2]=p*R+y*A+u*T-f*b,i[3]=y*R-u*b-f*T-p*A,i}function Bt(i,t){var o=t[0],u=t[1],f=t[2],p=t[3],y=Math.sqrt(o*o+u*u+f*f),b=Math.exp(p),T=y>0?b*Math.sin(y)/y:0;return i[0]=o*T,i[1]=u*T,i[2]=f*T,i[3]=b*Math.cos(y),i}function It(i,t){var o=t[0],u=t[1],f=t[2],p=t[3],y=Math.sqrt(o*o+u*u+f*f),b=y>0?Math.atan2(y,p)/y:0;return i[0]=o*b,i[1]=u*b,i[2]=f*b,i[3]=.5*Math.log(o*o+u*u+f*f+p*p),i}function ar(i,t,o,u){var f,p,y,b,T,A=t[0],R=t[1],P=t[2],L=t[3],z=o[0],N=o[1],U=o[2],H=o[3];return(p=A*z+R*N+P*U+L*H)<0&&(p=-p,z=-z,N=-N,U=-U,H=-H),1-p>_r.EPSILON?(f=Math.acos(p),y=Math.sin(f),b=Math.sin((1-u)*f)/y,T=Math.sin(u*f)/y):(b=1-u,T=u),i[0]=b*A+T*z,i[1]=b*R+T*N,i[2]=b*P+T*U,i[3]=b*L+T*H,i}function gr(i,t){var o,u=t[0]+t[4]+t[8];if(u>0)o=Math.sqrt(u+1),i[3]=.5*o,i[0]=(t[5]-t[7])*(o=.5/o),i[1]=(t[6]-t[2])*o,i[2]=(t[1]-t[3])*o;else{var f=0;t[4]>t[0]&&(f=1),t[8]>t[3*f+f]&&(f=2);var p=(f+1)%3,y=(f+2)%3;o=Math.sqrt(t[3*f+f]-t[3*p+p]-t[3*y+y]+1),i[f]=.5*o,i[3]=(t[3*p+y]-t[3*y+p])*(o=.5/o),i[p]=(t[3*p+f]+t[3*f+p])*o,i[y]=(t[3*y+f]+t[3*f+y])*o}return i}ft.clone=tt.clone,ft.fromValues=tt.fromValues,ft.copy=tt.copy,ft.set=tt.set,ft.add=tt.add,ft.mul=Rt;var Yt=tt.scale;ft.scale=Yt;var Ir=tt.dot;ft.dot=Ir,ft.lerp=tt.lerp;var Ei=tt.length;ft.length=Ei,ft.len=Ei;var _i=tt.squaredLength;ft.squaredLength=_i,ft.sqrLen=_i;var yi=tt.normalize;ft.normalize=yi,ft.exactEquals=tt.exactEquals,ft.equals=tt.equals;var fi,kr,Bn,Ss=(fi=Ve.create(),kr=Ve.fromValues(1,0,0),Bn=Ve.fromValues(0,1,0),function(i,t,o){var u=Ve.dot(t,o);return u<-.999999?(Ve.cross(fi,kr,t),Ve.len(fi)<1e-6&&Ve.cross(fi,Bn,t),Ve.normalize(fi,fi),bt(i,fi,Math.PI),i):u>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Ve.cross(fi,t,o),i[0]=fi[0],i[1]=fi[1],i[2]=fi[2],i[3]=1+u,yi(i,i))});ft.rotationTo=Ss;var Fi,_n,ds=(Fi=Lt(),_n=Lt(),function(i,t,o,u,f,p){return ar(Fi,t,f,p),ar(_n,o,u,p),ar(i,Fi,_n,2*p*(1-p)),i});ft.sqlerp=ds;var On,wa=(On=Xe.create(),function(i,t,o,u){return On[0]=o[0],On[3]=o[1],On[6]=o[2],On[1]=u[0],On[4]=u[1],On[7]=u[2],On[2]=-t[0],On[5]=-t[1],On[8]=-t[2],yi(i,gr(i,On))});ft.setAxes=wa;var Vr={};function Js(i){return Js=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Js(i)}Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.create=function(){var i=new Vn.ARRAY_TYPE(8);return Vn.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0),i[3]=1,i},Vr.clone=function(i){var t=new Vn.ARRAY_TYPE(8);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t},Vr.fromValues=function(i,t,o,u,f,p,y,b){var T=new Vn.ARRAY_TYPE(8);return T[0]=i,T[1]=t,T[2]=o,T[3]=u,T[4]=f,T[5]=p,T[6]=y,T[7]=b,T},Vr.fromRotationTranslationValues=function(i,t,o,u,f,p,y){var b=new Vn.ARRAY_TYPE(8);b[0]=i,b[1]=t,b[2]=o,b[3]=u;var T=.5*f,A=.5*p,R=.5*y;return b[4]=T*u+A*o-R*t,b[5]=A*u+R*i-T*o,b[6]=R*u+T*t-A*i,b[7]=-T*i-A*t-R*o,b},Vr.fromRotationTranslation=df,Vr.fromTranslation=function(i,t){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=.5*t[0],i[5]=.5*t[1],i[6]=.5*t[2],i[7]=0,i},Vr.fromRotation=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},Vr.fromMat4=function(i,t){var o=Fs.create();Wa.getRotation(o,t);var u=new Vn.ARRAY_TYPE(3);return Wa.getTranslation(u,t),df(i,o,u),i},Vr.copy=ff,Vr.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},Vr.set=function(i,t,o,u,f,p,y,b,T){return i[0]=t,i[1]=o,i[2]=u,i[3]=f,i[4]=p,i[5]=y,i[6]=b,i[7]=T,i},Vr.getDual=function(i,t){return i[0]=t[4],i[1]=t[5],i[2]=t[6],i[3]=t[7],i},Vr.setDual=function(i,t){return i[4]=t[0],i[5]=t[1],i[6]=t[2],i[7]=t[3],i},Vr.getTranslation=function(i,t){var o=t[4],u=t[5],f=t[6],p=t[7],y=-t[0],b=-t[1],T=-t[2],A=t[3];return i[0]=2*(o*A+p*y+u*T-f*b),i[1]=2*(u*A+p*b+f*y-o*T),i[2]=2*(f*A+p*T+o*b-u*y),i},Vr.translate=function(i,t,o){var u=t[0],f=t[1],p=t[2],y=t[3],b=.5*o[0],T=.5*o[1],A=.5*o[2],R=t[4],P=t[5],L=t[6],z=t[7];return i[0]=u,i[1]=f,i[2]=p,i[3]=y,i[4]=y*b+f*A-p*T+R,i[5]=y*T+p*b-u*A+P,i[6]=y*A+u*T-f*b+L,i[7]=-u*b-f*T-p*A+z,i},Vr.rotateX=function(i,t,o){var u=-t[0],f=-t[1],p=-t[2],y=t[3],b=t[4],T=t[5],A=t[6],R=t[7],P=b*y+R*u+T*p-A*f,L=T*y+R*f+A*u-b*p,z=A*y+R*p+b*f-T*u,N=R*y-b*u-T*f-A*p;return Fs.rotateX(i,t,o),i[4]=P*(y=i[3])+N*(u=i[0])+L*(p=i[2])-z*(f=i[1]),i[5]=L*y+N*f+z*u-P*p,i[6]=z*y+N*p+P*f-L*u,i[7]=N*y-P*u-L*f-z*p,i},Vr.rotateY=function(i,t,o){var u=-t[0],f=-t[1],p=-t[2],y=t[3],b=t[4],T=t[5],A=t[6],R=t[7],P=b*y+R*u+T*p-A*f,L=T*y+R*f+A*u-b*p,z=A*y+R*p+b*f-T*u,N=R*y-b*u-T*f-A*p;return Fs.rotateY(i,t,o),i[4]=P*(y=i[3])+N*(u=i[0])+L*(p=i[2])-z*(f=i[1]),i[5]=L*y+N*f+z*u-P*p,i[6]=z*y+N*p+P*f-L*u,i[7]=N*y-P*u-L*f-z*p,i},Vr.rotateZ=function(i,t,o){var u=-t[0],f=-t[1],p=-t[2],y=t[3],b=t[4],T=t[5],A=t[6],R=t[7],P=b*y+R*u+T*p-A*f,L=T*y+R*f+A*u-b*p,z=A*y+R*p+b*f-T*u,N=R*y-b*u-T*f-A*p;return Fs.rotateZ(i,t,o),i[4]=P*(y=i[3])+N*(u=i[0])+L*(p=i[2])-z*(f=i[1]),i[5]=L*y+N*f+z*u-P*p,i[6]=z*y+N*p+P*f-L*u,i[7]=N*y-P*u-L*f-z*p,i},Vr.rotateByQuatAppend=function(i,t,o){var u=o[0],f=o[1],p=o[2],y=o[3],b=t[0],T=t[1],A=t[2],R=t[3];return i[0]=b*y+R*u+T*p-A*f,i[1]=T*y+R*f+A*u-b*p,i[2]=A*y+R*p+b*f-T*u,i[3]=R*y-b*u-T*f-A*p,i[4]=(b=t[4])*y+(R=t[7])*u+(T=t[5])*p-(A=t[6])*f,i[5]=T*y+R*f+A*u-b*p,i[6]=A*y+R*p+b*f-T*u,i[7]=R*y-b*u-T*f-A*p,i},Vr.rotateByQuatPrepend=function(i,t,o){var u=t[0],f=t[1],p=t[2],y=t[3],b=o[0],T=o[1],A=o[2],R=o[3];return i[0]=u*R+y*b+f*A-p*T,i[1]=f*R+y*T+p*b-u*A,i[2]=p*R+y*A+u*T-f*b,i[3]=y*R-u*b-f*T-p*A,i[4]=u*(R=o[7])+y*(b=o[4])+f*(A=o[6])-p*(T=o[5]),i[5]=f*R+y*T+p*b-u*A,i[6]=p*R+y*A+u*T-f*b,i[7]=y*R-u*b-f*T-p*A,i},Vr.rotateAroundAxis=function(i,t,o,u){if(Math.abs(u)<Vn.EPSILON)return ff(i,t);var f=Math.hypot(o[0],o[1],o[2]);u*=.5;var p=Math.sin(u),y=p*o[0]/f,b=p*o[1]/f,T=p*o[2]/f,A=Math.cos(u),R=t[0],P=t[1],L=t[2],z=t[3];i[0]=R*A+z*y+P*T-L*b,i[1]=P*A+z*b+L*y-R*T,i[2]=L*A+z*T+R*b-P*y,i[3]=z*A-R*y-P*b-L*T;var N=t[4],U=t[5],H=t[6],W=t[7];return i[4]=N*A+W*y+U*T-H*b,i[5]=U*A+W*b+H*y-N*T,i[6]=H*A+W*T+N*b-U*y,i[7]=W*A-N*y-U*b-H*T,i},Vr.add=function(i,t,o){return i[0]=t[0]+o[0],i[1]=t[1]+o[1],i[2]=t[2]+o[2],i[3]=t[3]+o[3],i[4]=t[4]+o[4],i[5]=t[5]+o[5],i[6]=t[6]+o[6],i[7]=t[7]+o[7],i},Vr.multiply=xm,Vr.scale=function(i,t,o){return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i[4]=t[4]*o,i[5]=t[5]*o,i[6]=t[6]*o,i[7]=t[7]*o,i},Vr.lerp=function(i,t,o,u){var f=1-u;return bm(t,o)<0&&(u=-u),i[0]=t[0]*f+o[0]*u,i[1]=t[1]*f+o[1]*u,i[2]=t[2]*f+o[2]*u,i[3]=t[3]*f+o[3]*u,i[4]=t[4]*f+o[4]*u,i[5]=t[5]*f+o[5]*u,i[6]=t[6]*f+o[6]*u,i[7]=t[7]*f+o[7]*u,i},Vr.invert=function(i,t){var o=wu(t);return i[0]=-t[0]/o,i[1]=-t[1]/o,i[2]=-t[2]/o,i[3]=t[3]/o,i[4]=-t[4]/o,i[5]=-t[5]/o,i[6]=-t[6]/o,i[7]=t[7]/o,i},Vr.conjugate=function(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i[3]=t[3],i[4]=-t[4],i[5]=-t[5],i[6]=-t[6],i[7]=t[7],i},Vr.normalize=function(i,t){var o=wu(t);if(o>0){o=Math.sqrt(o);var u=t[0]/o,f=t[1]/o,p=t[2]/o,y=t[3]/o,b=t[4],T=t[5],A=t[6],R=t[7],P=u*b+f*T+p*A+y*R;i[0]=u,i[1]=f,i[2]=p,i[3]=y,i[4]=(b-u*P)/o,i[5]=(T-f*P)/o,i[6]=(A-p*P)/o,i[7]=(R-y*P)/o}return i},Vr.str=function(i){return"quat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+")"},Vr.exactEquals=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]},Vr.equals=function(i,t){var o=i[0],u=i[1],f=i[2],p=i[3],y=i[4],b=i[5],T=i[6],A=i[7],R=t[0],P=t[1],L=t[2],z=t[3],N=t[4],U=t[5],H=t[6],W=t[7];return Math.abs(o-R)<=Vn.EPSILON*Math.max(1,Math.abs(o),Math.abs(R))&&Math.abs(u-P)<=Vn.EPSILON*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(f-L)<=Vn.EPSILON*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(p-z)<=Vn.EPSILON*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(y-N)<=Vn.EPSILON*Math.max(1,Math.abs(y),Math.abs(N))&&Math.abs(b-U)<=Vn.EPSILON*Math.max(1,Math.abs(b),Math.abs(U))&&Math.abs(T-H)<=Vn.EPSILON*Math.max(1,Math.abs(T),Math.abs(H))&&Math.abs(A-W)<=Vn.EPSILON*Math.max(1,Math.abs(A),Math.abs(W))},Vr.sqrLen=Vr.squaredLength=Vr.len=Vr.length=Vr.dot=Vr.mul=Vr.setReal=Vr.getReal=void 0;var Vn=bu(Ge),Fs=bu(ft),Wa=bu(dt);function Ah(i){if(typeof WeakMap!="function")return null;var t=new WeakMap,o=new WeakMap;return(Ah=function(u){return u?o:t})(i)}function bu(i,t){if(i&&i.__esModule)return i;if(i===null||Js(i)!=="object"&&typeof i!="function")return{default:i};var o=Ah(t);if(o&&o.has(i))return o.get(i);var u={},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var y=f?Object.getOwnPropertyDescriptor(i,p):null;y&&(y.get||y.set)?Object.defineProperty(u,p,y):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}function df(i,t,o){var u=.5*o[0],f=.5*o[1],p=.5*o[2],y=t[0],b=t[1],T=t[2],A=t[3];return i[0]=y,i[1]=b,i[2]=T,i[3]=A,i[4]=u*A+f*T-p*b,i[5]=f*A+p*y-u*T,i[6]=p*A+u*b-f*y,i[7]=-u*y-f*b-p*T,i}function ff(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i}function xm(i,t,o){var u=t[0],f=t[1],p=t[2],y=t[3],b=o[4],T=o[5],A=o[6],R=o[7],P=t[4],L=t[5],z=t[6],N=t[7],U=o[0],H=o[1],W=o[2],ie=o[3];return i[0]=u*ie+y*U+f*W-p*H,i[1]=f*ie+y*H+p*U-u*W,i[2]=p*ie+y*W+u*H-f*U,i[3]=y*ie-u*U-f*H-p*W,i[4]=u*R+y*b+f*A-p*T+P*ie+N*U+L*W-z*H,i[5]=f*R+y*T+p*b-u*A+L*ie+N*H+z*U-P*W,i[6]=p*R+y*A+u*T-f*b+z*ie+N*W+P*H-L*U,i[7]=y*R-u*b-f*T-p*A+N*ie-P*U-L*H-z*W,i}Vr.getReal=Fs.copy,Vr.setReal=Fs.copy,Vr.mul=xm;var bm=Fs.dot;Vr.dot=bm;var pf=Fs.length;Vr.length=pf,Vr.len=pf;var wu=Fs.squaredLength;Vr.squaredLength=wu,Vr.sqrLen=wu;var Hr={};function Za(i){return Za=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Za(i)}Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.create=Eu,Hr.clone=function(i){var t=new Ns.ARRAY_TYPE(2);return t[0]=i[0],t[1]=i[1],t},Hr.fromValues=function(i,t){var o=new Ns.ARRAY_TYPE(2);return o[0]=i,o[1]=t,o},Hr.copy=function(i,t){return i[0]=t[0],i[1]=t[1],i},Hr.set=function(i,t,o){return i[0]=t,i[1]=o,i},Hr.add=function(i,t,o){return i[0]=t[0]+o[0],i[1]=t[1]+o[1],i},Hr.subtract=mf,Hr.multiply=En,Hr.divide=Au,Hr.ceil=function(i,t){return i[0]=Math.ceil(t[0]),i[1]=Math.ceil(t[1]),i},Hr.floor=function(i,t){return i[0]=Math.floor(t[0]),i[1]=Math.floor(t[1]),i},Hr.min=function(i,t,o){return i[0]=Math.min(t[0],o[0]),i[1]=Math.min(t[1],o[1]),i},Hr.max=function(i,t,o){return i[0]=Math.max(t[0],o[0]),i[1]=Math.max(t[1],o[1]),i},Hr.round=function(i,t){return i[0]=Math.round(t[0]),i[1]=Math.round(t[1]),i},Hr.scale=function(i,t,o){return i[0]=t[0]*o,i[1]=t[1]*o,i},Hr.scaleAndAdd=function(i,t,o,u){return i[0]=t[0]+o[0]*u,i[1]=t[1]+o[1]*u,i},Hr.distance=Pc,Hr.squaredDistance=Mc,Hr.length=wm,Hr.squaredLength=Iu,Hr.negate=function(i,t){return i[0]=-t[0],i[1]=-t[1],i},Hr.inverse=function(i,t){return i[0]=1/t[0],i[1]=1/t[1],i},Hr.normalize=function(i,t){var o=t[0],u=t[1],f=o*o+u*u;return f>0&&(f=1/Math.sqrt(f)),i[0]=t[0]*f,i[1]=t[1]*f,i},Hr.dot=function(i,t){return i[0]*t[0]+i[1]*t[1]},Hr.cross=function(i,t,o){var u=t[0]*o[1]-t[1]*o[0];return i[0]=i[1]=0,i[2]=u,i},Hr.lerp=function(i,t,o,u){var f=t[0],p=t[1];return i[0]=f+u*(o[0]-f),i[1]=p+u*(o[1]-p),i},Hr.random=function(i,t){t=t||1;var o=2*Ns.RANDOM()*Math.PI;return i[0]=Math.cos(o)*t,i[1]=Math.sin(o)*t,i},Hr.transformMat2=function(i,t,o){var u=t[0],f=t[1];return i[0]=o[0]*u+o[2]*f,i[1]=o[1]*u+o[3]*f,i},Hr.transformMat2d=function(i,t,o){var u=t[0],f=t[1];return i[0]=o[0]*u+o[2]*f+o[4],i[1]=o[1]*u+o[3]*f+o[5],i},Hr.transformMat3=function(i,t,o){var u=t[0],f=t[1];return i[0]=o[0]*u+o[3]*f+o[6],i[1]=o[1]*u+o[4]*f+o[7],i},Hr.transformMat4=function(i,t,o){var u=t[0],f=t[1];return i[0]=o[0]*u+o[4]*f+o[12],i[1]=o[1]*u+o[5]*f+o[13],i},Hr.rotate=function(i,t,o,u){var f=t[0]-o[0],p=t[1]-o[1],y=Math.sin(u),b=Math.cos(u);return i[0]=f*b-p*y+o[0],i[1]=f*y+p*b+o[1],i},Hr.angle=function(i,t){var o=i[0],u=i[1],f=t[0],p=t[1],y=Math.sqrt(o*o+u*u)*Math.sqrt(f*f+p*p);return Math.acos(Math.min(Math.max(y&&(o*f+u*p)/y,-1),1))},Hr.zero=function(i){return i[0]=0,i[1]=0,i},Hr.str=function(i){return"vec2("+i[0]+", "+i[1]+")"},Hr.exactEquals=function(i,t){return i[0]===t[0]&&i[1]===t[1]},Hr.equals=function(i,t){var o=i[0],u=i[1],f=t[0],p=t[1];return Math.abs(o-f)<=Ns.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(u-p)<=Ns.EPSILON*Math.max(1,Math.abs(u),Math.abs(p))},Hr.forEach=Hr.sqrLen=Hr.sqrDist=Hr.dist=Hr.div=Hr.mul=Hr.sub=Hr.len=void 0;var Ns=function(i,t){if(i&&i.__esModule)return i;if(i===null||Za(i)!=="object"&&typeof i!="function")return{default:i};var o=Tu(void 0);if(o&&o.has(i))return o.get(i);var u={},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var y=f?Object.getOwnPropertyDescriptor(i,p):null;y&&(y.get||y.set)?Object.defineProperty(u,p,y):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ge);function Tu(i){if(typeof WeakMap!="function")return null;var t=new WeakMap,o=new WeakMap;return(Tu=function(u){return u?o:t})(i)}function Eu(){var i=new Ns.ARRAY_TYPE(2);return Ns.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0),i}function mf(i,t,o){return i[0]=t[0]-o[0],i[1]=t[1]-o[1],i}function En(i,t,o){return i[0]=t[0]*o[0],i[1]=t[1]*o[1],i}function Au(i,t,o){return i[0]=t[0]/o[0],i[1]=t[1]/o[1],i}function Pc(i,t){return Math.hypot(t[0]-i[0],t[1]-i[1])}function Mc(i,t){var o=t[0]-i[0],u=t[1]-i[1];return o*o+u*u}function wm(i){return Math.hypot(i[0],i[1])}function Iu(i){var t=i[0],o=i[1];return t*t+o*o}Hr.len=wm,Hr.sub=mf,Hr.mul=En,Hr.div=Au,Hr.dist=Pc,Hr.sqrDist=Mc,Hr.sqrLen=Iu;var a0=function(){var i=Eu();return function(t,o,u,f,p,y){var b,T;for(o||(o=2),u||(u=0),T=f?Math.min(f*o+u,t.length):t.length,b=u;b<T;b+=o)i[0]=t[b],i[1]=t[b+1],p(i,i,y),t[b]=i[0],t[b+1]=i[1];return t}}();function Ih(i){return Ih=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ih(i)}Hr.forEach=a0,Object.defineProperty(Te,"__esModule",{value:!0}),l.aa=Te.vec4=l.Q=Te.vec3=Te.vec2=Te.quat2=l.bl=Te.quat=l.a9=Te.mat4=l.ct=Te.mat3=Te.mat2d=l.b7=Te.mat2=Te.glMatrix=void 0;var l0=ws(Ge);Te.glMatrix=l0;var c0=ws(ge);l.b7=Te.mat2=c0;var Su=ws(Vt);Te.mat2d=Su;var hr=ws(Xt);l.ct=Te.mat3=hr;var Sh=ws(dt);l.a9=Te.mat4=Sh;var Dr=ws(ft);l.bl=Te.quat=Dr;var Cu=ws(Vr);Te.quat2=Cu;var $r=ws(Hr);Te.vec2=$r;var _f=ws(nt);l.Q=Te.vec3=_f;var gf=ws(Nt);function Cr(i){if(typeof WeakMap!="function")return null;var t=new WeakMap,o=new WeakMap;return(Cr=function(u){return u?o:t})(i)}function ws(i,t){if(i&&i.__esModule)return i;if(i===null||Ih(i)!=="object"&&typeof i!="function")return{default:i};var o=Cr(t);if(o&&o.has(i))return o.get(i);var u={},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var y=f?Object.getOwnPropertyDescriptor(i,p):null;y&&(y.get||y.set)?Object.defineProperty(u,p,y):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}l.aa=Te.vec4=gf;var u0=Zl;function Zl(i,t,o,u){this.cx=3*i,this.bx=3*(o-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(u-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=o,this.p2y=u}Zl.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var o=i,u=0;u<8;u++){var f=this.sampleCurveX(o)-i;if(Math.abs(f)<t)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=f/p}var y=0,b=1;for(o=i,u=0;u<20&&(f=this.sampleCurveX(o),!(Math.abs(f-i)<t));u++)i>f?y=o:b=o,o=.5*(b-y)+y;return o},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var kc=Ie(u0),Xl=Po;function Po(i,t){this.x=i,this.y=t}Po.prototype={clone:function(){return new Po(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,o=i.y-this.y;return t*t+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),o=Math.sin(i),u=o*this.x+t*this.y;return this.x=t*this.x-o*this.y,this.y=u,this},_rotateAround:function(i,t){var o=Math.cos(i),u=Math.sin(i),f=t.y+u*(this.x-t.x)+o*(this.y-t.y);return this.x=t.x+o*(this.x-t.x)-u*(this.y-t.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Po.convert=function(i){return i instanceof Po?i:Array.isArray(i)?new Po(i[0],i[1]):i};var Ut=Ie(Xl);const Yl=Math.PI/180,Ch=180/Math.PI;function ui(i){return i*Yl}function Ui(i){return i*Ch}const Tm=[[0,0],[1,0],[1,1],[0,1]];function Rh(i){if(i<=0)return 0;if(i>=1)return 1;const t=i*i,o=t*i;return 4*(i<.5?o:3*(i-t)+o-.75)}function yf(i,t,o,u){const f=new kc(i,t,o,u);return function(p){return f.solve(p)}}const Mo=yf(.25,.1,.25,1);function ti(i,t,o){return Math.min(o,Math.max(t,i))}function yl(i,t,o){return(o=ti((o-i)/(t-i),0,1))*o*(3-2*o)}function Ta(i,t,o){const u=o-t,f=((i-t)%u+u)%u+t;return f===t?o:f}function ta(i,t,o){if(!i.length)return o(null,[]);let u=i.length;const f=new Array(i.length);let p=null;i.forEach((y,b)=>{t(y,(T,A)=>{T&&(p=T),f[b]=A,--u==0&&o(p,f)})})}function _o(i,...t){for(const o of t)for(const u in o)i[u]=o[u];return i}let Em=1;function pi(){return Em++}function Ru(){return function i(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Pu(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Mu(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Ph(i,t){i.forEach(o=>{t[o]&&(t[o]=t[o].bind(t))})}function Ea(i,t){return i.indexOf(t,i.length-t.length)!==-1}function Dc(i,t,o){const u={};for(const f in i)u[f]=t.call(this,i[f],f,i);return u}function Lc(i,t,o){const u={};for(const f in i)t.call(this,i[f],f,i)&&(u[f]=i[f]);return u}function go(i){return Array.isArray(i)?i.map(go):typeof i=="object"&&i?Dc(i,go):i}const Mh={};function gn(i){Mh[i]||(typeof console<"u"&&console.warn(i),Mh[i]=!0)}function Aa(i,t,o){return(o.y-i.y)*(t.x-i.x)>(t.y-i.y)*(o.x-i.x)}function Ql(i){let t=0;for(let o,u,f=0,p=i.length,y=p-1;f<p;y=f++)o=i[f],u=i[y],t+=(u.x-o.x)*(o.y+u.y);return t}function Oc([i,t,o]){const u=ui(t+90),f=ui(o);return{x:i*Math.cos(u)*Math.sin(f),y:i*Math.sin(u)*Math.sin(f),z:i*Math.cos(f),azimuthal:t,polar:o}}function ko(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function eo(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,u,f,p)=>{const y=f||p;return t[u]=!y||y.toLowerCase(),""}),t["max-age"]){const o=parseInt(t["max-age"],10);isNaN(o)?delete t["max-age"]:t["max-age"]=o}return t}let ku,Ia,Du,zc,Xa,Kl,Jl=null;function Bs(i){try{const t=self[i];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function vl(i,t){return[i[4*t],i[4*t+1],i[4*t+2],i[4*t+3]]}function xl(i,t,o,u){for(;t<o;){const f=t+o>>1;i[f]<u?t=f+1:o=f}return t}function bl(i,t,o,u){for(;t<o;){const f=t+o>>1;i[f]<=u?t=f+1:o=f}return t}function M(i){return i>0?1/(1.001-i):1+i}function q(i){return i>0?1-1/(1.001-i):-i}function ee(){return ku==null&&(ku=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ku}const ve={now:()=>zc!==void 0?zc:performance.now(),setNow(i){zc=i},restoreNow(){zc=void 0},frame(i){const t=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(i,t=0){const{width:o,height:u}=i;Xa||(Xa=document.createElement("canvas"));const f=Xa.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(o>Xa.width||u>Xa.height)&&(Xa.width=o,Xa.height=u),f.clearRect(-t,-t,o+2*t,u+2*t),f.drawImage(i,0,0,o,u),f.getImageData(-t,-t,o+2*t,u+2*t)},resolveURL:i=>(Ia||(Ia=document.createElement("a")),Ia.href=i,Ia.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Du==null&&(Du=window.matchMedia("(prefers-reduced-motion: reduce)")),Du.matches)},hasCanvasFingerprintNoise(){if(Kl!==void 0)return Kl;if(!ee())return Kl=!1,!1;const i=new OffscreenCanvas(85,1),t=i.getContext("2d",{willReadFrequently:!0});let o=0;for(let f=0;f<i.width;++f)t.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,t.fillRect(f,0,1,1);const u=t.getImageData(0,0,i.width,i.height);o=0;for(let f=0;f<u.data.length;++f)if(f%4!=3&&o++!==u.data[f])return Kl=!0,!0;return Kl=!1,!1}};function ht(i,t){const o=i.indexOf("?");if(o<0)return`${i}?${new URLSearchParams(t).toString()}`;const u=new URLSearchParams(i.slice(o));for(const f in t)u.set(f,t[f]);return`${i.slice(0,o)}?${u.toString()}`}function Pt(i,t={persistentParams:[]}){const o=i.indexOf("?");if(o<0)return i;const u=new URLSearchParams,f=new URLSearchParams(i.slice(o));for(const y of t.persistentParams){const b=f.get(y);b&&u.set(y,b)}const p=u.toString();return`${i.slice(0,o)}${p.length>0?`?${p}`:""}`}const ur="mapbox-tiles";let an=500,fs=50,ki,ns;function ps(){try{return caches}catch{}}function ra(){const i=ps();i&&!ki&&(ki=i.open(ur))}let yo=1/0;const Sa={supported:!1,testSupport:function(i){!h0&&kh&&(V1?j1(i):ec=i)}};let ec,kh,h0=!1,V1=!1;const U1=typeof self<"u"?self:{};function j1(i){const t=i.createTexture();i.bindTexture(i.TEXTURE_2D,t);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,kh),i.isContextLost())return;Sa.supported=!0}catch{}i.deleteTexture(t),h0=!0}U1.document&&(kh=U1.document.createElement("img"),kh.onload=function(){ec&&j1(ec),ec=null,V1=!0},kh.onerror=function(){h0=!0,ec=null},kh.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Am={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Am);class Im extends Error{constructor(t,o,u){o===401&&V(u)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=o,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Dh=ko()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,vf=function(i,t){if(!(/^file:/.test(o=i.url)||/^file:/.test(Dh())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,f){const p=new AbortController,y=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Dh(),referrerPolicy:u.referrerPolicy,signal:p.signal});let b=!1,T=!1;const A=(R=y.url).indexOf("sku=")>0&&V(R);var R;u.type==="json"&&y.headers.set("Accept","application/json");const P=(z,N,U)=>{if(T)return;if(z&&z.message!=="SecurityError"&&gn(z.toString()),N&&U)return L(N);const H=Date.now();fetch(y).then(W=>{if(W.ok){const ie=A?W.clone():null;return L(W,ie,H)}return f(new Im(W.statusText,W.status,u.url))}).catch(W=>{W.name!=="AbortError"&&f(new Error(`${W.message} ${u.url}`))})},L=(z,N,U)=>{(u.type==="arrayBuffer"?z.arrayBuffer():u.type==="json"?z.json():z.text()).then(H=>{T||(N&&U&&function(W,ie,le){if(ra(),!ki)return;const se=eo(ie.headers.get("Cache-Control")||"");if(se["no-store"])return;const we={status:ie.status,statusText:ie.statusText,headers:new Headers};ie.headers.forEach((Le,qe)=>we.headers.set(qe,Le)),se["max-age"]&&we.headers.set("Expires",new Date(le+1e3*se["max-age"]).toUTCString());const he=we.headers.get("Expires");if(!he||new Date(he).getTime()-le<42e4)return;let Pe=Pt(W.url,{persistentParams:["language","worldview"]});if(ie.status===206){const Le=W.headers.get("Range");if(!Le)return;we.status=200,Pe=ht(Pe,{range:Le})}(function(Le,qe){if(ns===void 0)try{new Response(new ReadableStream),ns=!0}catch{ns=!1}ns?qe(Le.body):Le.blob().then(qe)})(ie,Le=>{const qe=new Response(Le,we);ra(),ki&&ki.then(ot=>ot.put(Pe,qe)).catch(ot=>gn(ot.message))})}(y,N,U),b=!0,f(null,H,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(H=>{T||f(new Error(H.message))})};return A?function(z,N){if(ra(),!ki)return N(null);ki.then(U=>{let H=Pt(z.url,{persistentParams:["language","worldview"]});const W=z.headers.get("Range");W&&(H=ht(H,{range:W})),U.match(H).then(ie=>{const le=function(se){if(!se)return!1;const we=new Date(se.headers.get("Expires")||0),he=eo(se.headers.get("Cache-Control")||"");return we>Date.now()&&!he["no-cache"]}(ie);U.delete(H),le&&U.put(H,ie.clone()),N(null,ie,le)}).catch(N)}).catch(N)}(y,P):P(null,null),{cancel:()=>{T=!0,b||p.abort()}}}(i,t);if(ko()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t,void 0,!0)}var o;return function(u,f){const p=new XMLHttpRequest;p.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const y in u.headers)p.setRequestHeader(y,u.headers[y]);return u.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=u.credentials==="include",p.onerror=()=>{f(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let y=p.response;if(u.type==="json")try{y=JSON.parse(p.response)}catch(b){return f(b)}f(null,y,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else f(new Im(p.statusText,p.status,u.url))},p.send(u.body),{cancel:()=>p.abort()}}(i,t)},xf=function(i,t){return vf(_o(i,{type:"arrayBuffer"}),t)};function d0(i){const t=document.createElement("a");return t.href=i,t.protocol===location.protocol&&t.host===location.host}const $1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Sm,bf;Sm=[],bf=0;const f0=function(i,t){if(Sa.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),bf>=I.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:i,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Sm.push(p),p}bf++;let o=!1;const u=()=>{if(!o)for(o=!0,bf--;Sm.length&&bf<I.MAX_PARALLEL_IMAGE_REQUESTS;){const p=Sm.shift(),{requestParameters:y,callback:b,cancelled:T}=p;T||(p.cancel=f0(y,b).cancel)}},f=xf(i,(p,y,b,T)=>{u(),p?t(p):y&&(self.createImageBitmap?function(A,R){const P=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(P).then(L=>{R(null,L)}).catch(L=>{R(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(A,R)=>t(A,R,b,T)):function(A,R){const P=new Image;P.onload=()=>{R(null,P),URL.revokeObjectURL(P.src),P.onload=null,requestAnimationFrame(()=>{P.src=$1})},P.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new Blob([new Uint8Array(A)],{type:"image/png"});P.src=A.byteLength?URL.createObjectURL(L):$1}(y,(A,R)=>t(A,R,b,T)))});return{cancel:()=>{f.cancel(),u()}}},wf="01",Cm="NO_ACCESS_TOKEN",p0=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ya(i){const t=i.match(p0);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Lh(i){const t=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${t}`}const Tf="mapbox.eventData";function m0(i){if(!i)return null;const t=i.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(t[1]).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Oh{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const o=m0(I.ACCESS_TOKEN);let u="";return u=o&&o.u?btoa(encodeURIComponent(o.u).replace(/%([0-9A-F]{2})/g,(f,p)=>String.fromCharCode(+("0x"+p)))):I.ACCESS_TOKEN||"",t?`${Tf}.${t}:${u}`:`${Tf}:${u}`}fetchEventData(){const t=Bs("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{const f=localStorage.getItem(o);f&&(this.eventData=JSON.parse(f));const p=localStorage.getItem(u);p&&(this.anonId=p)}catch{gn("Unable to read from LocalStorage")}}saveEventData(){const t=Bs("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid"),f=this.anonId;if(t&&f)try{localStorage.setItem(u,f),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch{gn("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,o,u,f){if(!I.EVENTS_URL)return;const p=Ya(I.EVENTS_URL);p.params.push(`access_token=${f||I.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(t).toISOString()},b=o?_o(y,o):y,T={url:Lh(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=function(A,R){return vf(_o(A,{method:"POST"}),R)}(T,A=>{this.pendingRequest=null,u(A),this.saveEventData(),this.processRequests(f)})}queueRequest(t,o){this.queue.push(t),this.processRequests(o)}}const Rm=new class extends Oh{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,t){I.EVENTS_URL&&I.ACCESS_TOKEN&&Array.isArray(i)&&i.some(o=>j(o)||V(o))&&this.queueRequest(Date.now(),t)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=m0(I.ACCESS_TOKEN),o=t?t.u:I.ACCESS_TOKEN;let u=o!==this.eventData.tokenU;Mu(this.anonId)||(this.anonId=Ru(),u=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),y=new Date(f),b=(f-this.eventData.lastSuccess)/864e5;u=u||b>=1||b<-1||p.getDate()!==y.getDate()}else u=!0;u?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:wf,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=f,this.eventData.tokenU=o)},i):this.processRequests()}},Do=Rm.postTurnstileEvent.bind(Rm),Fc=new class extends Oh{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,t,o,u){this.skuToken=t,this.errorCb=u,I.EVENTS_URL&&(o||I.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(Cm)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),Mu(this.anonId)||(this.anonId=Ru()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:wf,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},i))}remove(){this.errorCb=null}},Lo=Fc.postMapLoadEvent.bind(Fc),G1=new class extends Oh{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(i){let t=this.mapInstanceIdMap.get(i);return t||(t=Ru(),this.mapInstanceIdMap.set(i,t)),t}getEventId(i){const t=this.eventIdPerMapInstanceMap.get(i)||0;return this.eventIdPerMapInstanceMap.set(i,t+1),t}postStyleLoadEvent(i,t){const{map:o,style:u,importedStyles:f}=t;if(!I.EVENTS_URL||!i&&!I.ACCESS_TOKEN)return;const p=this.getMapInstanceId(o),y={mapInstanceId:p,eventId:this.getEventId(p),style:u};f.length&&(y.importedStyles=f),this.queueRequest({timestamp:Date.now(),payload:y},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:o}=this.queue.shift();this.postEvent(t,o,()=>{},i)}},$E=G1.postStyleLoadEvent.bind(G1),q1=new class extends Oh{constructor(){super("gljs.performance")}postPerformanceEvent(i,t){I.EVENTS_URL&&(i||I.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:o}=this.queue.shift(),u=function(f){const p=performance.getEntriesByType("resource"),y=performance.getEntriesByType("mark"),b=function(z){const N={};if(z){for(const U in z)if(U!=="other")for(const H of z[U]){const W=`${U}ResolveRangeMin`,ie=`${U}ResolveRangeMax`,le=`${U}RequestCount`,se=`${U}RequestCachedCount`;N[W]=Math.min(N[W]||1/0,H.startTime),N[ie]=Math.max(N[ie]||-1/0,H.responseEnd);const we=he=>{N[he]===void 0&&(N[he]=0),++N[he]};H.transferSize!==void 0&&H.transferSize===0&&we(se),we(le)}}return N}(function(z,N){const U={};if(z)for(const H of z){const W=N(H);U[W]===void 0&&(U[W]=[]),U[W].push(H)}return U}(p,Me)),T=window.devicePixelRatio,A=navigator.connection||navigator.mozConnection||navigator.webkitConnection,R=A?A.effectiveType:void 0,P={counters:[],metadata:[],attributes:[]},L=(z,N,U)=>{U!=null&&z.push({name:N,value:U.toString()})};for(const z in b)L(P.counters,z,b[z]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(L(P.counters,"interactionRangeMin",f.interactionRange[0]),L(P.counters,"interactionRangeMax",f.interactionRange[1])),y)for(const z of Object.keys(Ce)){const N=Ce[z],U=y.find(H=>H.name===N);U&&L(P.counters,N,U.startTime)}return L(P.counters,"visibilityHidden",f.visibilityHidden),L(P.attributes,"style",function(z){if(z)for(const N of z){const U=N.name.split("?")[0];if(ce(U)){const H=U.split("/").slice(-2);if(H.length===2)return`mapbox://styles/${H[0]}/${H[1]}`}}}(p)),L(P.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),L(P.attributes,"fogEnabled",f.fogEnabled?"true":"false"),L(P.attributes,"projection",f.projection),L(P.attributes,"zoom",f.zoom),L(P.metadata,"devicePixelRatio",T),L(P.metadata,"connectionEffectiveType",R),L(P.metadata,"navigatorUserAgent",navigator.userAgent),L(P.metadata,"screenWidth",window.screen.width),L(P.metadata,"screenHeight",window.screen.height),L(P.metadata,"windowWidth",window.innerWidth),L(P.metadata,"windowHeight",window.innerHeight),L(P.metadata,"mapWidth",f.width/T),L(P.metadata,"mapHeight",f.height/T),L(P.metadata,"webglRenderer",f.renderer),L(P.metadata,"webglVendor",f.vendor),L(P.metadata,"sdkVersion",S),L(P.metadata,"sdkIdentifier","mapbox-gl-js"),P}(o);for(const f of u.metadata);for(const f of u.counters);for(const f of u.attributes);this.postEvent(t,u,()=>{},i)}},Pm=q1.postPerformanceEvent.bind(q1),Mm=new class extends Oh{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,t,o,u){if(!I.API_URL||!I.SESSION_PATH)return;const f=Ya(I.API_URL+I.SESSION_PATH);f.params.push(`sku=${t||""}`),f.params.push(`access_token=${u||I.ACCESS_TOKEN||""}`);const p={url:Lh(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(y,b){return vf(_o(y,{method:"GET"}),b)}(p,y=>{this.pendingRequest=null,o(y),this.saveEventData(),this.processRequests(u)})}getSessionAPI(i,t,o,u){this.skuToken=t,this.errorCb=u,I.SESSION_PATH&&I.API_URL&&(o||I.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(Cm)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||this.getSession(o,this.skuToken,u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},i)}remove(){this.errorCb=null}},_0=Mm.getSessionAPI.bind(Mm),km=new Set;var wl={exports:{}},H1={exports:{}};H1.exports=function(i,t){var o,u,f,p,y,b,T,A;for(u=i.length-(o=3&i.length),f=t,y=3432918353,b=461845907,A=0;A<u;)T=255&i.charCodeAt(A)|(255&i.charCodeAt(++A))<<8|(255&i.charCodeAt(++A))<<16|(255&i.charCodeAt(++A))<<24,++A,f=27492+(65535&(p=5*(65535&(f=(f^=T=(65535&(T=(T=(65535&T)*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(T=0,o){case 3:T^=(255&i.charCodeAt(A+2))<<16;case 2:T^=(255&i.charCodeAt(A+1))<<8;case 1:f^=T=(65535&(T=(T=(65535&(T^=255&i.charCodeAt(A)))*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295}return f^=i.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0};var GE=H1.exports,g0={exports:{}};g0.exports=function(i,t){for(var o,u=i.length,f=t^u,p=0;u>=4;)o=1540483477*(65535&(o=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(o>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),u-=4,++p;switch(u){case 3:f^=(255&i.charCodeAt(p+2))<<16;case 2:f^=(255&i.charCodeAt(p+1))<<8;case 1:f=1540483477*(65535&(f^=255&i.charCodeAt(p)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};var y0=GE,Qa=g0.exports;wl.exports=y0,wl.exports.murmur3=y0,wl.exports.murmur2=Qa;var Ef=Ie(wl.exports);function v0(i,t,o){o[i]&&o[i].indexOf(t)!==-1||(o[i]=o[i]||[],o[i].push(t))}function Dm(i,t,o){if(o&&o[i]){const u=o[i].indexOf(t);u!==-1&&o[i].splice(u,1)}}class Nc{constructor(t,o={}){_o(this,o),this.type=t}}class Lm extends Nc{constructor(t,o={}){super("error",_o({error:t},o))}}class Lu{on(t,o){return this._listeners=this._listeners||{},v0(t,o,this._listeners),this}off(t,o){return Dm(t,o,this._listeners),Dm(t,o,this._oneTimeListeners),this}once(t,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},v0(t,o,this._oneTimeListeners),this):new Promise(u=>this.once(t,u))}fire(t,o){typeof t=="string"&&(t=new Nc(t,o||{}));const u=t.type;if(this.listens(u)){t.target=this;const f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const b of f)b.call(this,t);const p=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const b of p)Dm(u,b,this._oneTimeListeners),b.call(this,t);const y=this._eventedParent;y&&(_o(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(t))}else t instanceof Lm&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,o){return this._eventedParent=t,this._eventedParentData=o,this}}l.z=void 0;var x0={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Af(i){return(i=Math.round(i))<0?0:i>255?255:i}function Om(i){return Af(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function If(i){return(t=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:t>1?1:t;var t}function zm(i,t,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?i+(t-i)*o*6:2*o<1?t:3*o<2?i+(t-i)*(2/3-o)*6:i}try{l.z={}.parseCSSColor=function(i){var t,o=i.replace(/ /g,"").toLowerCase();if(o in x0)return x0[o].slice();if(o[0]==="#")return o.length===4?(t=parseInt(o.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:o.length===7&&(t=parseInt(o.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var u=o.indexOf("("),f=o.indexOf(")");if(u!==-1&&f+1===o.length){var p=o.substr(0,u),y=o.substr(u+1,f-(u+1)).split(","),b=1;switch(p){case"rgba":if(y.length!==4)return null;b=If(y.pop());case"rgb":return y.length!==3?null:[Om(y[0]),Om(y[1]),Om(y[2]),b];case"hsla":if(y.length!==4)return null;b=If(y.pop());case"hsl":if(y.length!==3)return null;var T=(parseFloat(y[0])%360+360)%360/360,A=If(y[1]),R=If(y[2]),P=R<=.5?R*(A+1):R+A-R*A,L=2*R-P;return[Af(255*zm(L,P,T+1/3)),Af(255*zm(L,P,T)),Af(255*zm(L,P,T-1/3)),b];default:return null}}return null}}catch{}class Bi{constructor(t,o,u,f=1){this.r=t,this.g=o,this.b=u,this.a=f}static parse(t){if(!t)return;if(t instanceof Bi)return t;if(typeof t!="string")return;const o=l.z(t);return o?new Bi(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[t,o,u,f]=this.toArray();return`rgba(${Math.round(t)},${Math.round(o)},${Math.round(u)},${f})`}toArray(){const{r:t,g:o,b:u,a:f}=this;return f===0?[0,0,0,0]:[255*t/f,255*o/f,255*u/f,f]}toArray01(){const{r:t,g:o,b:u,a:f}=this;return f===0?[0,0,0,0]:[t/f,o/f,u/f,f]}toArray01Scaled(t){const{r:o,g:u,b:f,a:p}=this;return p===0?[0,0,0]:[o/p*t,u/p*t,f/p*t]}toArray01PremultipliedAlpha(){const{r:t,g:o,b:u,a:f}=this;return[t,o,u,f]}toArray01Linear(){const{r:t,g:o,b:u,a:f}=this;return f===0?[0,0,0,0]:[Math.pow(t/f,2.2),Math.pow(o/f,2.2),Math.pow(u/f,2.2),f]}}function ri(i,t,o){return i*(1-o)+t*o}function Sf(i,t,o){return i.map((u,f)=>ri(u,t[f],o))}Bi.black=new Bi(0,0,0,1),Bi.white=new Bi(1,1,1,1),Bi.transparent=new Bi(0,0,0,0),Bi.red=new Bi(1,0,0,1),Bi.blue=new Bi(0,0,1,1);var Cf=Object.freeze({__proto__:null,array:Sf,color:function(i,t,o){return new Bi(ri(i.r,t.r,o),ri(i.g,t.g,o),ri(i.b,t.b,o),ri(i.a,t.a,o))},number:ri});function Fm(i,...t){for(const o of t)for(const u in o)i[u]=o[u];return i}class Ka extends Error{constructor(t,o){super(o),this.message=o,this.key=t}}class Bc{constructor(t,o=[]){this.parent=t,this.bindings={};for(const[u,f]of o)this.bindings[u]=f}concat(t){return new Bc(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const si={kind:"null"},Jt={kind:"number"},Di={kind:"string"},Li={kind:"boolean"},ia={kind:"color"},zh={kind:"object"},wi={kind:"value"},Rf={kind:"collator"},Fh={kind:"formatted"},Nh={kind:"resolvedImage"};function Ts(i,t){return{kind:"array",itemType:i,N:t}}function zn(i){if(i.kind==="array"){const t=zn(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const W1=[si,Jt,Di,Li,ia,Fh,zh,Ts(wi),Nh];function Pf(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Pf(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const o of W1)if(!Pf(o,t))return null}}return`Expected ${zn(i)} but found ${zn(t)} instead.`}function Mf(i,t){return t.some(o=>o.kind===i.kind)}function Ou(i,t){return t.some(o=>o==="null"?i===null:o==="array"?Array.isArray(i):o==="object"?i&&!Array.isArray(i)&&typeof i=="object":o===typeof i)}class b0{constructor(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,o){return this.collator.compare(t,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Nm{constructor(t,o,u,f,p){this.text=t.normalize?t.normalize():t,this.image=o,this.scale=u,this.fontStack=f,this.textColor=p}}class Vs{constructor(t){this.sections=t}static fromString(t){return new Vs([new Nm(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.namePrimary.length!==0)}static factory(t){return t instanceof Vs?t:Vs.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const o of this.sections){if(o.image){t.push(["image",o.image.namePrimary]);continue}t.push(o.text);const u={};o.fontStack&&(u["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(u["font-scale"]=o.scale),o.textColor&&(u["text-color"]=["rgba"].concat(o.textColor.toArray())),t.push(u)}return t}}class na{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,o){return t?new na({namePrimary:t,nameSecondary:o,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Z1(i,t,o,u){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[i,t,o,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[i,t,o,u]:[i,t,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Bh(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Bi||i instanceof b0||i instanceof Vs||i instanceof na)return!0;if(Array.isArray(i)){for(const t of i)if(!Bh(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!Bh(i[t]))return!1;return!0}return!1}function Kn(i){if(i===null)return si;if(typeof i=="string")return Di;if(typeof i=="boolean")return Li;if(typeof i=="number")return Jt;if(i instanceof Bi)return ia;if(i instanceof b0)return Rf;if(i instanceof Vs)return Fh;if(i instanceof na)return Nh;if(Array.isArray(i)){const t=i.length;let o;for(const u of i){const f=Kn(u);if(o){if(o===f)continue;o=wi;break}o=f}return Ts(o||wi,t)}return zh}function Ca(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof Bi||i instanceof Vs||i instanceof na?i.toString():JSON.stringify(i)}class Tl{constructor(t,o){this.type=t,this.value=o}static parse(t,o){if(t.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Bh(t[1]))return o.error("invalid value");const u=t[1];let f=Kn(u);const p=o.expectedType;return f.kind!=="array"||f.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(f=p),new Tl(f,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Bi?["rgba"].concat(this.value.toArray()):this.value instanceof Vs?this.value.serialize():this.value}}class ms{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Bm={string:Di,number:Jt,boolean:Li,object:zh};class Ja{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");let u,f=1;const p=t[0];if(p==="array"){let b,T;if(t.length>2){const A=t[1];if(typeof A!="string"||!(A in Bm)||A==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=Bm[A],f++}else b=wi;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);T=t[2],f++}u=Ts(b,T)}else u=Bm[p];const y=[];for(;f<t.length;f++){const b=o.parse(t[f],f,wi);if(!b)return null;y.push(b)}return new Ja(u,y)}evaluate(t){for(let o=0;o<this.args.length;o++){const u=this.args[o].evaluate(t);if(!Pf(this.type,Kn(u)))return u;if(o===this.args.length-1)throw new ms(`Expected value to be of type ${zn(this.type)}, but found ${zn(Kn(u))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,o=[t.kind];if(t.kind==="array"){const u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);const f=t.N;(typeof f=="number"||this.args.length>1)&&o.push(f)}}return o.concat(this.args.map(u=>u.serialize()))}}class kf{constructor(t){this.type=Fh,this.sections=t}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");const u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");const f=[];let p=!1;for(let y=1;y<=t.length-1;++y){const b=t[y];if(p&&typeof b=="object"&&!Array.isArray(b)){p=!1;let T=null;if(b["font-scale"]&&(T=o.parse(b["font-scale"],1,Jt),!T))return null;let A=null;if(b["text-font"]&&(A=o.parse(b["text-font"],1,Ts(Di)),!A))return null;let R=null;if(b["text-color"]&&(R=o.parse(b["text-color"],1,ia),!R))return null;const P=f[f.length-1];P.scale=T,P.font=A,P.textColor=R}else{const T=o.parse(t[y],1,wi);if(!T)return null;const A=T.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,f.push({content:T,scale:null,font:null,textColor:null})}}return new kf(f)}evaluate(t){return new Vs(this.sections.map(o=>{const u=o.content.evaluate(t);return Kn(u)===Nh?new Nm("",u,null,null,null):new Nm(Ca(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))}eachChild(t){for(const o of this.sections)t(o.content),o.scale&&t(o.scale),o.font&&t(o.font),o.textColor&&t(o.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const o of this.sections){t.push(o.content.serialize());const u={};o.scale&&(u["font-scale"]=o.scale.serialize()),o.font&&(u["text-font"]=o.font.serialize()),o.textColor&&(u["text-color"]=o.textColor.serialize()),t.push(u)}return t}}class Vh{constructor(t,o){this.type=Nh,this.inputPrimary=t,this.inputSecondary=o}static parse(t,o){if(t.length<2)return o.error("Expected two or more arguments.");const u=o.parse(t[1],1,Di);if(!u)return o.error("No image name provided.");if(t.length===2)return new Vh(u);const f=o.parse(t[2],1,Di);return f?new Vh(u,f):o.error("Secondary image variant is not a string.")}evaluate(t){const o=na.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(o.namePrimary)>-1,o.nameSecondary&&o.available&&t.availableImages&&(o.available=t.availableImages.indexOf(o.nameSecondary)>-1)),o}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Vc(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}const qE={"to-boolean":Li,"to-color":ia,"to-number":Jt,"to-string":Di};class tc{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");const u=t[0],f=[];let p=si;if(u==="to-array"){if(!Array.isArray(t[1]))return null;const y=t[1].length;if(o.expectedType){if(o.expectedType.kind!=="array")return o.error(`Expected ${o.expectedType.kind} but found array.`);p=Ts(o.expectedType.itemType,y)}else{if(!(y>0&&Bh(t[1][0])))return null;p=Ts(Kn(t[1][0]),y)}for(let b=0;b<y;b++){const T=t[1][b];let A;if(Vc(T)==="array")A=o.parse(T,void 0,p.itemType);else{const R=Vc(T);if(R!==p.itemType.kind)return o.error(`Expected ${p.itemType.kind} but found ${R}.`);A=o.registry.literal.parse(["literal",T===void 0?null:T],o)}if(!A)return null;f.push(A)}}else{if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");p=qE[u];for(let y=1;y<t.length;y++){const b=o.parse(t[y],y,wi);if(!b)return null;f.push(b)}}return new tc(p,f)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let o,u;for(const f of this.args){if(o=f.evaluate(t),u=null,o instanceof Bi)return o;if(typeof o=="string"){const p=t.parseColor(o);if(p)return p}else if(Array.isArray(o)&&(u=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Z1(o[0],o[1],o[2],o[3]),!u))return new Bi(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new ms(u||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const u of this.args){if(o=u.evaluate(t),o===null)return 0;const f=Number(o);if(!isNaN(f))return f}throw new ms(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?Vs.fromString(Ca(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?na.fromString(Ca(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(o=>o.evaluate(t)):Ca(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new kf([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Vh(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{t.push(o.serialize())}),t}}const HE=["Unknown","Point","LineString","Polygon"];class w0{constructor(t,o){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=o}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?HE[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:u,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*o-t[0])+this.featureDistanceData.bearing[1]*(f*o-t[1])}return 0}parseColor(t){let o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=Bi.parse(t)),o}getConfig(t){return this.options?this.options.get(t):null}}class Oo{constructor(t,o,u,f,p){this.name=t,this.type=o,this._evaluate=u,this.args=f,this._overloadIndex=p}evaluate(t){if(!this._evaluate){const o=Oo.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,o){const u=t[0],f=Oo.definitions[u];if(!f)return o.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(f)?f[0]:f.type,y=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,b=[];let T=null,A=-1;for(const[R,P]of y){if(Array.isArray(R)&&R.length!==t.length-1)continue;b.push(R),A++,T=new Zm(o.registry,o.path,null,o.scope,void 0,o._scope,o.options);const L=[];let z=!1;for(let N=1;N<t.length;N++){const U=t[N],H=Array.isArray(R)?R[N-1]:R.type,W=T.parse(U,1+L.length,H);if(!W){z=!0;break}L.push(W)}if(!z)if(Array.isArray(R)&&R.length!==L.length)T.error(`Expected ${R.length} arguments, but found ${L.length} instead.`);else{for(let N=0;N<L.length;N++){const U=Array.isArray(R)?R[N]:R.type,H=L[N];T.concat(N+1).checkSubtype(U,H.type)}if(T.errors.length===0)return new Oo(u,p,P,L,A)}}if(b.length===1)o.errors.push(...T.errors);else{const R=(b.length?b:y.map(([L])=>L)).map(WE).join(" | "),P=[];for(let L=1;L<t.length;L++){const z=o.parse(t[L],1+P.length);if(!z)return null;P.push(zn(z.type))}o.error(`Expected arguments of type ${R}, but found (${P.join(", ")}) instead.`)}return null}static register(t,o){Oo.definitions=o;for(const u in o)t[u]=Oo}}function WE(i){return Array.isArray(i)?`(${i.map(zn).join(", ")})`:`(${zn(i.type)}...)`}class Df{constructor(t,o,u){this.type=Rf,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o}static parse(t,o){if(t.length!==2)return o.error("Expected one argument.");const u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");const f=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Li);if(!f)return null;const p=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Li);if(!p)return null;let y=null;return u.locale&&(y=o.parse(u.locale,1,Di),!y)?null:new Df(f,p,y)}evaluate(t){return new b0(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var T0={exports:{}};T0.exports=function(){function i(u,f,p,y,b){for(;y>p;){if(y-p>600){var T=y-p+1,A=f-p+1,R=Math.log(T),P=.5*Math.exp(2*R/3),L=.5*Math.sqrt(R*P*(T-P)/T)*(A-T/2<0?-1:1);i(u,f,Math.max(p,Math.floor(f-A*P/T+L)),Math.min(y,Math.floor(f+(T-A)*P/T+L)),b)}var z=u[f],N=p,U=y;for(t(u,p,f),b(u[y],z)>0&&t(u,p,y);N<U;){for(t(u,N,U),N++,U--;b(u[N],z)<0;)N++;for(;b(u[U],z)>0;)U--}b(u[p],z)===0?t(u,p,U):t(u,++U,y),U<=f&&(p=U+1),f<=U&&(y=U-1)}}function t(u,f,p){var y=u[f];u[f]=u[p],u[p]=y}function o(u,f){return u<f?-1:u>f?1:0}return function(u,f,p,y,b){i(u,f,p||0,y||u.length-1,b||o)}}();var X1=Ie(T0.exports);function ZE(i){let t=0;for(let o,u,f=0,p=i.length,y=p-1;f<p;y=f++)o=i[f],u=i[y],t+=(u.x-o.x)*(o.y+u.y);return t}function Lf(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function Of(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function XE(i,t,o){const u=i[0]-t[0],f=i[1]-t[1],p=i[0]-o[0],y=i[1]-o[1];return u*y-p*f==0&&u*p<=0&&f*y<=0}function zu(i,t,o=!1){let u=!1;for(let b=0,T=t.length;b<T;b++){const A=t[b];for(let R=0,P=A.length,L=P-1;R<P;L=R++){const z=A[L],N=A[R];if(XE(i,z,N))return o;(p=z)[1]>(f=i)[1]!=(y=N)[1]>f[1]&&f[0]<(y[0]-p[0])*(f[1]-p[1])/(y[1]-p[1])+p[0]&&(u=!u)}}var f,p,y;return u}function E0(i,t,o,u){const f=u[0]-o[0],p=u[1]-o[1],y=(i[0]-o[0])*p-f*(i[1]-o[1]),b=(t[0]-o[0])*p-f*(t[1]-o[1]);return y>0&&b<0||y<0&&b>0}function Uh(i,t,o,u){return(f=[u[0]-o[0],u[1]-o[1]])[0]*(p=[t[0]-i[0],t[1]-i[1]])[1]-f[1]*p[0]!=0&&!(!E0(i,t,o,u)||!E0(o,u,i,t));var f,p}const Uc=8192;function YE(i,t){const o=(180+i[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,f=Math.pow(2,t.z);return[Math.round(o*f*Uc),Math.round(u*f*Uc)]}function QE(i,t){for(let o=0;o<t.length;o++)if(zu(i,t[o]))return!0;return!1}function A0(i,t,o){for(const u of o)for(let f=0,p=u.length,y=p-1;f<p;y=f++)if(Uh(i,t,u[y],u[f]))return!0;return!1}function Vm(i,t){for(let o=0;o<i.length;++o)if(!zu(i[o],t))return!1;for(let o=0;o<i.length-1;++o)if(A0(i[o],i[o+1],t))return!1;return!0}function Y1(i,t){for(let o=0;o<t.length;o++)if(Vm(i,t[o]))return!0;return!1}function I0(i,t,o){const u=[];for(let f=0;f<i.length;f++){const p=[];for(let y=0;y<i[f].length;y++){const b=YE(i[f][y],o);Lf(t,b),p.push(b)}u.push(p)}return u}function zf(i,t,o){const u=[];for(let f=0;f<i.length;f++){const p=I0(i[f],t,o);u.push(p)}return u}function S0(i,t,o,u){if(i[0]<o[0]||i[0]>o[2]){const f=.5*u;let p=i[0]-o[0]>f?-u:o[0]-i[0]>f?u:0;p===0&&(p=i[0]-o[2]>f?-u:o[2]-i[0]>f?u:0),i[0]+=p}Lf(t,i)}function Ff(i,t,o,u){const f=Math.pow(2,u.z)*Uc,p=[u.x*Uc,u.y*Uc],y=[];if(!i)return y;for(const b of i)for(const T of b){const A=[T.x+p[0],T.y+p[1]];S0(A,t,o,f),y.push(A)}return y}function C0(i,t,o,u){const f=Math.pow(2,u.z)*Uc,p=[u.x*Uc,u.y*Uc],y=[];if(!i)return y;for(const T of i){const A=[];for(const R of T){const P=[R.x+p[0],R.y+p[1]];Lf(t,P),A.push(P)}y.push(A)}if(t[2]-t[0]<=f/2){(b=t)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const T of y)for(const A of T)S0(A,t,o,f)}var b;return y}class Fu{constructor(t,o){this.type=Li,this.geojson=t,this.geometries=o}static parse(t,o){if(t.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Bh(t[1])){const u=t[1];if(u.type==="FeatureCollection")for(let f=0;f<u.features.length;++f){const p=u.features[f].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Fu(u,u.features[f].geometry)}else if(u.type==="Feature"){const f=u.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Fu(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Fu(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){const f=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const b=I0(u.coordinates,p,y),T=Ff(o.geometry(),f,p,y);if(!Of(f,p))return!1;for(const A of T)if(!zu(A,b))return!1}if(u.type==="MultiPolygon"){const b=zf(u.coordinates,p,y),T=Ff(o.geometry(),f,p,y);if(!Of(f,p))return!1;for(const A of T)if(!QE(A,b))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){const f=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const b=I0(u.coordinates,p,y),T=C0(o.geometry(),f,p,y);if(!Of(f,p))return!1;for(const A of T)if(!Vm(A,b))return!1}if(u.type==="MultiPolygon"){const b=zf(u.coordinates,p,y),T=C0(o.geometry(),f,p,y);if(!Of(f,p))return!1;for(const A of T)if(!Y1(A,b))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Q1={exports:{}};(function(i,t){i.exports=function(){var o={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},u=1/298.257223563,f=u*(2-u),p=Math.PI/180,y=function(P,L){if(P===void 0)throw new Error("No latitude given.");if(L&&!o[L])throw new Error("Unknown unit "+L+". Use one of: "+Object.keys(o).join(", "));var z=6378.137*p*(L?o[L]:1),N=Math.cos(P*p),U=1/(1-f*(1-N*N)),H=Math.sqrt(U);this.kx=z*H*N,this.ky=z*H*U*(1-f)},b={units:{configurable:!0}};function T(P,L){return P[0]===L[0]&&P[1]===L[1]}function A(P,L,z){var N=R(L[0]-P[0]);return[P[0]+N*z,P[1]+(L[1]-P[1])*z]}function R(P){for(;P<-180;)P+=360;for(;P>180;)P-=360;return P}return y.fromTile=function(P,L,z){var N=Math.PI*(1-2*(P+.5)/Math.pow(2,L)),U=Math.atan(.5*(Math.exp(N)-Math.exp(-N)))/p;return new y(U,z)},b.units.get=function(){return o},y.prototype.distance=function(P,L){var z=R(P[0]-L[0])*this.kx,N=(P[1]-L[1])*this.ky;return Math.sqrt(z*z+N*N)},y.prototype.bearing=function(P,L){var z=R(L[0]-P[0])*this.kx;return Math.atan2(z,(L[1]-P[1])*this.ky)/p},y.prototype.destination=function(P,L,z){var N=z*p;return this.offset(P,Math.sin(N)*L,Math.cos(N)*L)},y.prototype.offset=function(P,L,z){return[P[0]+L/this.kx,P[1]+z/this.ky]},y.prototype.lineDistance=function(P){for(var L=0,z=0;z<P.length-1;z++)L+=this.distance(P[z],P[z+1]);return L},y.prototype.area=function(P){for(var L=0,z=0;z<P.length;z++)for(var N=P[z],U=0,H=N.length,W=H-1;U<H;W=U++)L+=R(N[U][0]-N[W][0])*(N[U][1]+N[W][1])*(z?-1:1);return Math.abs(L)/2*this.kx*this.ky},y.prototype.along=function(P,L){var z=0;if(L<=0)return P[0];for(var N=0;N<P.length-1;N++){var U=P[N],H=P[N+1],W=this.distance(U,H);if((z+=W)>L)return A(U,H,(L-(z-W))/W)}return P[P.length-1]},y.prototype.pointToSegmentDistance=function(P,L,z){var N=L[0],U=L[1],H=R(z[0]-N)*this.kx,W=(z[1]-U)*this.ky,ie=0;return H===0&&W===0||((ie=(R(P[0]-N)*this.kx*H+(P[1]-U)*this.ky*W)/(H*H+W*W))>1?(N=z[0],U=z[1]):ie>0&&(N+=H/this.kx*ie,U+=W/this.ky*ie)),H=R(P[0]-N)*this.kx,W=(P[1]-U)*this.ky,Math.sqrt(H*H+W*W)},y.prototype.pointOnLine=function(P,L){for(var z,N,U,H,W=1/0,ie=0;ie<P.length-1;ie++){var le=P[ie][0],se=P[ie][1],we=R(P[ie+1][0]-le)*this.kx,he=(P[ie+1][1]-se)*this.ky,Pe=0;we===0&&he===0||((Pe=(R(L[0]-le)*this.kx*we+(L[1]-se)*this.ky*he)/(we*we+he*he))>1?(le=P[ie+1][0],se=P[ie+1][1]):Pe>0&&(le+=we/this.kx*Pe,se+=he/this.ky*Pe));var Le=(we=R(L[0]-le)*this.kx)*we+(he=(L[1]-se)*this.ky)*he;Le<W&&(W=Le,z=le,N=se,U=ie,H=Pe)}return{point:[z,N],index:U,t:Math.max(0,Math.min(1,H))}},y.prototype.lineSlice=function(P,L,z){var N=this.pointOnLine(z,P),U=this.pointOnLine(z,L);if(N.index>U.index||N.index===U.index&&N.t>U.t){var H=N;N=U,U=H}var W=[N.point],ie=N.index+1,le=U.index;!T(z[ie],W[0])&&ie<=le&&W.push(z[ie]);for(var se=ie+1;se<=le;se++)W.push(z[se]);return T(z[le],U.point)||W.push(U.point),W},y.prototype.lineSliceAlong=function(P,L,z){for(var N=0,U=[],H=0;H<z.length-1;H++){var W=z[H],ie=z[H+1],le=this.distance(W,ie);if((N+=le)>P&&U.length===0&&U.push(A(W,ie,(P-(N-le))/le)),N>=L)return U.push(A(W,ie,(L-(N-le))/le)),U;N>P&&U.push(ie)}return U},y.prototype.bufferPoint=function(P,L){var z=L/this.ky,N=L/this.kx;return[P[0]-N,P[1]-z,P[0]+N,P[1]+z]},y.prototype.bufferBBox=function(P,L){var z=L/this.ky,N=L/this.kx;return[P[0]-N,P[1]-z,P[2]+N,P[3]+z]},y.prototype.insideBBox=function(P,L){return R(P[0]-L[0])>=0&&R(P[0]-L[2])<=0&&P[1]>=L[1]&&P[1]<=L[3]},Object.defineProperties(y,b),y}()})(Q1);var Nf=Ie(Q1.exports),Um={exports:{}};(function(i,t){i.exports=function(){var o=function(f,p){if(f===void 0&&(f=[]),p===void 0&&(p=u),this.data=f,this.length=this.data.length,this.compare=p,this.length>0)for(var y=(this.length>>1)-1;y>=0;y--)this._down(y)};function u(f,p){return f<p?-1:f>p?1:0}return o.prototype.push=function(f){this.data.push(f),this.length++,this._up(this.length-1)},o.prototype.pop=function(){if(this.length!==0){var f=this.data[0],p=this.data.pop();return this.length--,this.length>0&&(this.data[0]=p,this._down(0)),f}},o.prototype.peek=function(){return this.data[0]},o.prototype._up=function(f){for(var p=this.data,y=this.compare,b=p[f];f>0;){var T=f-1>>1,A=p[T];if(y(b,A)>=0)break;p[f]=A,f=T}p[f]=b},o.prototype._down=function(f){for(var p=this.data,y=this.compare,b=this.length>>1,T=p[f];f<b;){var A=1+(f<<1),R=p[A],P=A+1;if(P<this.length&&y(p[P],R)<0&&(A=P,R=p[P]),y(R,T)>=0)break;p[f]=R,f=A}p[f]=T},o}()})(Um);var jm=Ie(Um.exports),Gt=8192;function Nu(i,t){return t.dist-i.dist}const R0=100,P0=50;function K1(i){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==i.length)return!1;for(let o=0;o<t.length;o++)if(t[o]!==i[o])return!1;return!0}function $m(i){return i[1]-i[0]+1}function rc(i,t){const o=i[1]>=i[0]&&i[1]<t;return o||console.warn("Distance Expression: Index is out of range"),o}function Gm(i,t){if(i[0]>i[1])return[null,null];const o=$m(i);if(t){if(o===2)return[i,null];const u=Math.floor(o/2);return[[i[0],i[0]+u],[i[0]+u,i[1]]]}{if(o===1)return[i,null];const u=Math.floor(o/2)-1;return[[i[0],i[0]+u],[i[0]+u+1,i[1]]]}}function ic(i,t){const o=[1/0,1/0,-1/0,-1/0];if(!rc(t,i.length))return o;for(let u=t[0];u<=t[1];++u)Lf(o,i[u]);return o}function qm(i){const t=[1/0,1/0,-1/0,-1/0];for(let o=0;o<i.length;++o)for(let u=0;u<i[o].length;++u)Lf(t,i[o][u]);return t}function jh(i,t,o){if(K1(i)||K1(t))return NaN;let u=0,f=0;return i[2]<t[0]&&(u=t[0]-i[2]),i[0]>t[2]&&(u=i[0]-t[2]),i[1]>t[3]&&(f=i[1]-t[3]),i[3]<t[1]&&(f=t[1]-i[3]),o.distance([0,0],[u,f])}function KE(i){return 360*i-180}function JE(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function M0(i,t){const o=Math.pow(2,t.z),u=(i.y/Gt+t.y)/o;return[KE((i.x/Gt+t.x)/o),JE(u)]}function e5(i,t){const o=[];for(let u=0;u<i.length;++u)o.push(M0(i[u],t));return o}function J1(i,t,o){const u=o.pointOnLine(t,i).point;return o.distance(i,u)}function ex(i,t,o,u,f){const p=o.slice(u[0],u[1]+1);let y=1/0;for(let b=t[0];b<=t[1];++b)if((y=Math.min(y,J1(i[b],p,f)))===0)return 0;return y}function k0(i,t,o,u,f){const p=Math.min(f.pointToSegmentDistance(i,o,u),f.pointToSegmentDistance(t,o,u)),y=Math.min(f.pointToSegmentDistance(o,i,t),f.pointToSegmentDistance(u,i,t));return Math.min(p,y)}function $h(i,t,o,u,f){if(!rc(t,i.length)||!rc(u,o.length))return NaN;let p=1/0;for(let y=t[0];y<t[1];++y)for(let b=u[0];b<u[1];++b){if(Uh(i[y],i[y+1],o[b],o[b+1]))return 0;p=Math.min(p,k0(i[y],i[y+1],o[b],o[b+1],f))}return p}function tx(i,t,o,u,f){if(!rc(t,i.length)||!rc(u,o.length))return NaN;let p=1/0;for(let y=t[0];y<=t[1];++y)for(let b=u[0];b<=u[1];++b)if((p=Math.min(p,f.distance(i[y],o[b])))===0)return p;return p}function rx(i,t,o){if(zu(i,t,!0))return 0;let u=1/0;for(const f of t){const p=f.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(f[0]!==f[p-1]&&(u=Math.min(u,o.pointToSegmentDistance(i,f[p-1],f[0])))===0||(u=Math.min(u,J1(i,f,o)))===0)return u}return u}function Hm(i,t,o,u){if(!rc(t,i.length))return NaN;for(let p=t[0];p<=t[1];++p)if(zu(i[p],o,!0))return 0;let f=1/0;for(let p=t[0];p<t[1];++p)for(const y of o)for(let b=0,T=y.length,A=T-1;b<T;A=b++){if(Uh(i[p],i[p+1],y[A],y[b]))return 0;f=Math.min(f,k0(i[p],i[p+1],y[A],y[b],u))}return f}function ix(i,t){for(const o of i)for(let u=0;u<=o.length-1;++u)if(zu(o[u],t,!0))return!0;return!1}function t5(i,t,o,u=1/0){const f=qm(i),p=qm(t);if(u!==1/0&&jh(f,p,o)>=u)return u;if(Of(f,p)){if(ix(i,t))return 0}else if(ix(t,i))return 0;let y=u;for(const b of i)for(let T=0,A=b.length,R=A-1;T<A;R=T++)for(const P of t)for(let L=0,z=P.length,N=z-1;L<z;N=L++){if(Uh(b[R],b[T],P[N],P[L]))return 0;y=Math.min(y,k0(b[R],b[T],P[N],P[L],o))}return y}function el(i,t,o,u,f,p,y){if(p===null||y===null)return;const b=jh(ic(u,p),ic(f,y),o);b<t&&i.push({dist:b,range1:p,range2:y})}function nx(i,t,o,u,f=1/0){let p=Math.min(u.distance(i[0],o[0][0]),f);if(p===0)return p;const y=new jm([{dist:0,range1:[0,i.length-1],range2:[0,0]}],Nu),b=t?P0:R0,T=qm(o);for(;y.length;){const A=y.pop();if(A.dist>=p)continue;const R=A.range1;if($m(R)<=b){if(!rc(R,i.length))return NaN;if(t){const P=Hm(i,R,o,u);if((p=Math.min(p,P))===0)return p}else for(let P=R[0];P<=R[1];++P){const L=rx(i[P],o,u);if((p=Math.min(p,L))===0)return p}}else{const P=Gm(R,t);if(P[0]!==null){const L=jh(ic(i,P[0]),T,u);L<p&&y.push({dist:L,range1:P[0],range2:[0,0]})}if(P[1]!==null){const L=jh(ic(i,P[1]),T,u);L<p&&y.push({dist:L,range1:P[1],range2:[0,0]})}}}return p}function Bu(i,t,o,u,f,p=1/0){let y=Math.min(p,f.distance(i[0],o[0]));if(y===0)return y;const b=new jm([{dist:0,range1:[0,i.length-1],range2:[0,o.length-1]}],Nu),T=t?P0:R0,A=u?P0:R0;for(;b.length;){const R=b.pop();if(R.dist>=y)continue;const P=R.range1,L=R.range2;if($m(P)<=T&&$m(L)<=A){if(!rc(P,i.length)||!rc(L,o.length))return NaN;if(t&&u?y=Math.min(y,$h(i,P,o,L,f)):t||u?t&&!u?y=Math.min(y,ex(o,L,i,P,f)):!t&&u&&(y=Math.min(y,ex(i,P,o,L,f))):y=Math.min(y,tx(i,P,o,L,f)),y===0)return y}else{const z=Gm(P,t),N=Gm(L,u);el(b,y,f,i,o,z[0],N[0]),el(b,y,f,i,o,z[0],N[1]),el(b,y,f,i,o,z[1],N[0]),el(b,y,f,i,o,z[1],N[1])}}return y}function D0(i,t,o,u,f=1/0){let p=f;const y=ic(i,[0,i.length-1]);for(const b of o)if(!(p!==1/0&&jh(y,ic(b,[0,b.length-1]),u)>=p)&&(p=Math.min(p,Bu(i,t,b,!0,u,p)),p===0))return p;return p}function Wm(i,t,o,u,f=1/0){let p=f;const y=ic(i,[0,i.length-1]);for(const b of o){if(p!==1/0&&jh(y,qm(b),u)>=p)continue;const T=nx(i,t,b,u,p);if(isNaN(T))return T;if((p=Math.min(p,T))===0)return p}return p}function L0(i){return i==="Point"||i==="MultiPoint"||i==="LineString"||i==="MultiLineString"||i==="Polygon"||i==="MultiPolygon"}class Vu{constructor(t,o){this.type=Jt,this.geojson=t,this.geometries=o}static parse(t,o){if(t.length!==2)return o.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(Bh(t[1])){const u=t[1];if(u.type==="FeatureCollection"){for(let f=0;f<u.features.length;++f)if(L0(u.features[f].geometry.type))return new Vu(u,u.features[f].geometry)}else if(u.type==="Feature"){if(L0(u.geometry.type))return new Vu(u,u.geometry)}else if(L0(u.type))return new Vu(u,u)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const o=t.geometry(),u=t.canonicalID();if(o!=null&&u!=null){if(t.geometryType()==="Point")return function(f,p,y){const b=[];for(const A of f)for(const R of A)b.push(M0(R,p));const T=new Nf(b[0][1],"meters");return y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString"?Bu(b,!1,y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",T):y.type==="MultiLineString"?D0(b,!1,y.coordinates,T):y.type==="Polygon"||y.type==="MultiPolygon"?Wm(b,!1,y.type==="Polygon"?[y.coordinates]:y.coordinates,T):null}(o,u,this.geometries);if(t.geometryType()==="LineString")return function(f,p,y){const b=[];for(const A of f){const R=[];for(const P of A)R.push(M0(P,p));b.push(R)}const T=new Nf(b[0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return D0(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",b,T);if(y.type==="MultiLineString"){let A=1/0;for(let R=0;R<y.coordinates.length;R++){const P=D0(y.coordinates[R],!0,b,T,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}if(y.type==="Polygon"||y.type==="MultiPolygon"){let A=1/0;for(let R=0;R<b.length;R++){const P=Wm(b[R],!0,y.type==="Polygon"?[y.coordinates]:y.coordinates,T,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}return null}(o,u,this.geometries);if(t.geometryType()==="Polygon")return function(f,p,y){const b=[];for(const A of function(R,P){const L=R.length;if(L<=1)return[R];const z=[];let N,U;for(let H=0;H<L;H++){const W=ZE(R[H]);W!==0&&(R[H].area=Math.abs(W),U===void 0&&(U=W<0),U===W<0?(N&&z.push(N),N=[R[H]]):N.push(R[H]))}return N&&z.push(N),z}(f)){const R=[];for(let P=0;P<A.length;++P)R.push(e5(A[P],p));b.push(R)}const T=new Nf(b[0][0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return Wm(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",b,T);if(y.type==="MultiLineString"){let A=1/0;for(let R=0;R<y.coordinates.length;R++){const P=Wm(y.coordinates[R],!0,b,T,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}return y.type==="Polygon"||y.type==="MultiPolygon"?function(A,R,P){let L=1/0;for(const z of A)for(const N of R){const U=t5(z,N,P,L);if(isNaN(U))return U;if((L=Math.min(L,U))===0)return L}return L}(y.type==="Polygon"?[y.coordinates]:y.coordinates,b,T):null}(o,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function O0(i,t){switch(i){case"string":return Ca(t);case"number":return+t;case"boolean":return!!t;case"color":return Bi.parse(t);case"formatted":return Vs.fromString(Ca(t));case"resolvedImage":return na.fromString(Ca(t))}return t}function z0(i,t,o,u){return u!==void 0&&(i=u*Math.round(i/u)),t!==void 0&&i<t&&(i=t),o!==void 0&&i>o&&(i=o),i}class jc{constructor(t,o,u){this.type=t,this.key=o,this.scope=u}static parse(t,o){let u=o.expectedType;if(u==null&&(u=wi),t.length<2||t.length>3)return o.error("Invalid number of arguments for 'config' expression.");const f=o.parse(t[1],1);if(!(f instanceof Tl))return o.error("Key name of 'config' expression must be a string literal.");if(t.length>=3){const p=o.parse(t[2],2);return p instanceof Tl?new jc(u,Ca(f.value),Ca(p.value)):o.error("Scope of 'config' expression must be a string literal.")}return new jc(u,Ca(f.value))}evaluate(t){const o=[this.key,this.scope,t.scope].filter(Boolean).join(""),u=t.getConfig(o);if(!u)return null;const{type:f,value:p,values:y,minValue:b,maxValue:T,stepValue:A}=u,R=u.default.evaluate(t);let P=R;if(p){const L=t.scope;t.scope=(L||"").split("").slice(1).join(""),P=p.evaluate(t),t.scope=L}return f&&(P=O0(f,P)),P===void 0||b===void 0&&T===void 0&&A===void 0||(typeof P=="number"?P=z0(P,b,T,A):Array.isArray(P)&&(P=P.map(L=>typeof L=="number"?z0(L,b,T,A):L))),p!==void 0&&P!==void 0&&y&&!y.includes(P)&&(P=R,f&&(P=O0(f,P))),(f&&f!==this.type||P!==void 0&&Kn(P)!==this.type)&&(P=O0(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.key),t}}function $c(i){if(i instanceof Oo&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Fu||i instanceof Vu)return!1;let t=!0;return i.eachChild(o=>{t&&!$c(o)&&(t=!1)}),t}function Bf(i){if(i instanceof Oo&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(o=>{t&&!Bf(o)&&(t=!1)}),t}function Vf(i){if(i instanceof jc)return!1;let t=!0;return i.eachChild(o=>{t&&!Vf(o)&&(t=!1)}),t}function Uf(i,t){if(i instanceof Oo&&t.indexOf(i.name)>=0)return!1;let o=!0;return i.eachChild(u=>{o&&!Uf(u,t)&&(o=!1)}),o}class sa{constructor(t,o){this.type=o.type,this.name=t,this.boundExpression=o}static parse(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const u=t[1];return o.scope.has(u)?new sa(u,o.scope.get(u)):o.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Zm{constructor(t,o=[],u,f=new Bc,p=[],y,b){this.registry=t,this.path=o,this.key=o.map(T=>`[${T}]`).join(""),this.scope=f,this.errors=p,this.expectedType=u,this._scope=y,this.options=b}parse(t,o,u,f,p={}){return o||u?this.concat(o,u,f)._parse(t,p):this._parse(t,p)}_parse(t,o){function u(f,p,y){return y==="assert"?new Ja(p,[f]):y==="coerce"?new tc(p,[f]):f}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(f){let p=f.parse(t,this);if(!p)return null;if(this.expectedType){const y=this.expectedType,b=p.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||b.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(y,b))return null}else p=u(p,y,o.typeAnnotation||"coerce");else p=u(p,y,o.typeAnnotation||"assert")}if(!(p instanceof Tl)&&p.type.kind!=="resolvedImage"&&Xm(p)){const y=new w0(this._scope,this.options);try{p=new Tl(p.type,p.evaluate(y))}catch(b){return this.error(b.message),null}}return p}return tc.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,o,u){const f=typeof t=="number"?this.path.concat(t):this.path,p=u?this.scope.concat(u):this.scope;return new Zm(this.registry,f,o||null,p,this.errors,this._scope,this.options)}error(t,...o){const u=`${this.key}${o.map(f=>`[${f}]`).join("")}`;this.errors.push(new Ka(u,t))}checkSubtype(t,o){const u=Pf(t,o);return u&&this.error(u),u}}function Xm(i){if(i instanceof sa)return Xm(i.boundExpression);if(i instanceof Oo&&i.name==="error"||i instanceof Df||i instanceof Fu||i instanceof Vu||i instanceof jc)return!1;const t=i instanceof tc||i instanceof Ja;let o=!0;return i.eachChild(u=>{o=t?o&&Xm(u):o&&u instanceof Tl}),!!o&&$c(i)&&Uf(i,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ym(i,t){const o=i.length-1;let u,f,p=0,y=o,b=0;for(;p<=y;)if(b=Math.floor((p+y)/2),u=i[b],f=i[b+1],u<=t){if(b===o||t<f)return b;p=b+1}else{if(!(u>t))throw new ms("Input is not a number.");y=b-1}return 0}class jf{constructor(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(const[f,p]of u)this.labels.push(f),this.outputs.push(p)}static parse(t,o){if(t.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");const u=o.parse(t[1],1,Jt);if(!u)return null;const f=[];let p=null;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(let y=1;y<t.length;y+=2){const b=y===1?-1/0:t[y],T=t[y+1],A=y,R=y+1;if(typeof b!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(f.length&&f[f.length-1][0]>=b)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const P=o.parse(T,R,p);if(!P)return null;p=p||P.type,f.push([b,P])}return new jf(p,u,f)}evaluate(t){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);const f=this.input.evaluate(t);if(f<=o[0])return u[0].evaluate(t);const p=o.length;return f>=o[p-1]?u[p-1].evaluate(t):u[Ym(o,f)].evaluate(t)}eachChild(t){t(this.input);for(const o of this.outputs)t(o)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t}}const sx=.95047,ox=1.08883,Qm=4/29,Uu=6/29,ax=3*Uu*Uu,lx=Uu*Uu*Uu,r5=Math.PI/180,cx=180/Math.PI;function Gh(i){return i>lx?Math.pow(i,1/3):i/ax+Qm}function F0(i){return i>Uu?i*i*i:ax*(i-Qm)}function N0(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function B0(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ux(i){const t=B0(i.r),o=B0(i.g),u=B0(i.b),f=Gh((.4124564*t+.3575761*o+.1804375*u)/sx),p=Gh((.2126729*t+.7151522*o+.072175*u)/1);return{l:116*p-16,a:500*(f-p),b:200*(p-Gh((.0193339*t+.119192*o+.9503041*u)/ox)),alpha:i.a}}function hx(i){let t=(i.l+16)/116,o=isNaN(i.a)?t:t+i.a/500,u=isNaN(i.b)?t:t-i.b/200;return t=1*F0(t),o=sx*F0(o),u=ox*F0(u),new Bi(N0(3.2404542*o-1.5371385*t-.4985314*u),N0(-.969266*o+1.8760108*t+.041556*u),N0(.0556434*o-.2040259*t+1.0572252*u),i.alpha)}function Km(i,t,o){const u=t-i;return i+o*(u>180||u<-180?u-360*Math.round(u/360):u)}const Gc={forward:ux,reverse:hx,interpolate:function(i,t,o){return{l:ri(i.l,t.l,o),a:ri(i.a,t.a,o),b:ri(i.b,t.b,o),alpha:ri(i.alpha,t.alpha,o)}}},Us={forward:function(i){const{l:t,a:o,b:u}=ux(i),f=Math.atan2(u,o)*cx;return{h:f<0?f+360:f,c:Math.sqrt(o*o+u*u),l:t,alpha:i.a}},reverse:function(i){const t=i.h*r5,o=i.c;return hx({l:i.l,a:Math.cos(t)*o,b:Math.sin(t)*o,alpha:i.alpha})},interpolate:function(i,t,o){return{h:Km(i.h,t.h,o),c:ri(i.c,t.c,o),l:ri(i.l,t.l,o),alpha:ri(i.alpha,t.alpha,o)}}};var $f=Object.freeze({__proto__:null,hcl:Us,lab:Gc});class oa{constructor(t,o,u,f,p){this.type=t,this.operator=o,this.interpolation=u,this.input=f,this.labels=[],this.outputs=[];for(const[y,b]of p)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(t,o,u,f){let p=0;if(t.name==="exponential")p=V0(o,t.base,u,f);else if(t.name==="linear")p=V0(o,1,u,f);else if(t.name==="cubic-bezier"){const y=t.controlPoints;p=new kc(y[0],y[1],y[2],y[3]).solve(V0(o,1,u,f))}return p}static parse(t,o){let[u,f,p,...y]=t;if(!Array.isArray(f)||f.length===0)return o.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const A=f[1];if(typeof A!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:A}}else{if(f[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const A=f.slice(1);if(A.length!==4||A.some(R=>typeof R!="number"||R<0||R>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:A}}}if(t.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(p=o.parse(p,2,Jt),!p)return null;const b=[];let T=null;u==="interpolate-hcl"||u==="interpolate-lab"?T=ia:o.expectedType&&o.expectedType.kind!=="value"&&(T=o.expectedType);for(let A=0;A<y.length;A+=2){const R=y[A],P=y[A+1],L=A+3,z=A+4;if(typeof R!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(b.length&&b[b.length-1][0]>=R)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const N=o.parse(P,z,T);if(!N)return null;T=T||N.type,b.push([R,N])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new oa(T,u,f,p,b):o.error(`Type ${zn(T)} is not interpolatable.`)}evaluate(t){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);const f=this.input.evaluate(t);if(f<=o[0])return u[0].evaluate(t);const p=o.length;if(f>=o[p-1])return u[p-1].evaluate(t);const y=Ym(o,f),b=oa.interpolationFactor(this.interpolation,f,o[y],o[y+1]),T=u[y].evaluate(t),A=u[y+1].evaluate(t);return this.operator==="interpolate"?Cf[this.type.kind.toLowerCase()](T,A,b):this.operator==="interpolate-hcl"?Us.reverse(Us.interpolate(Us.forward(T),Us.forward(A),b)):Gc.reverse(Gc.interpolate(Gc.forward(T),Gc.forward(A),b))}eachChild(t){t(this.input);for(const o of this.outputs)t(o)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,t,this.input.serialize()];for(let u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o}}function V0(i,t,o,u){const f=u-o,p=i-o;return f===0?0:t===1?p/f:(Math.pow(t,p)-1)/(Math.pow(t,f)-1)}class Jm{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expectected at least one argument.");let u=null;const f=o.expectedType;f&&f.kind!=="value"&&(u=f);const p=[];for(const b of t.slice(1)){const T=o.parse(b,1+p.length,u,void 0,{typeAnnotation:"omit"});if(!T)return null;u=u||T.type,p.push(T)}const y=f&&p.some(b=>Pf(f,b.type));return new Jm(y?wi:u,p)}evaluate(t){let o,u=null,f=0;for(const p of this.args){if(f++,u=p.evaluate(t),u&&u instanceof na&&!u.available&&(o||(o=u),u=null,f===this.args.length))return o;if(u!==null)break}return u}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(o=>{t.push(o.serialize())}),t}}class e_{constructor(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const o of this.bindings)t(o[1]);t(this.result)}static parse(t,o){if(t.length<4)return o.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const u=[];for(let p=1;p<t.length-1;p+=2){const y=t[p];if(typeof y!="string")return o.error(`Expected string, but found ${typeof y} instead.`,p);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);const b=o.parse(t[p+1],p+1);if(!b)return null;u.push([y,b])}const f=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return f?new e_(u,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[o,u]of this.bindings)t.push(o,u.serialize());return t.push(this.result.serialize()),t}}class Gf{constructor(t,o,u){this.type=t,this.index=o,this.input=u}static parse(t,o){if(t.length!==3)return o.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=o.parse(t[1],1,Jt),f=o.parse(t[2],2,Ts(o.expectedType||wi));return u&&f?new Gf(f.type.itemType,u,f):null}evaluate(t){const o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new ms(`Array index out of bounds: ${o} < 0.`);if(o>=u.length)throw new ms(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o!==Math.floor(o))throw new ms(`Array index must be an integer, but found ${o} instead.`);return u[o]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class U0{constructor(t,o){this.type=Li,this.needle=t,this.haystack=o}static parse(t,o){if(t.length!==3)return o.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=o.parse(t[1],1,wi),f=o.parse(t[2],2,wi);return u&&f?Mf(u.type,[Li,Di,Jt,si,wi])?new U0(u,f):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${zn(u.type)} instead`):null}evaluate(t){const o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(u==null)return!1;if(!Ou(o,["boolean","string","number","null"]))throw new ms(`Expected first argument to be of type boolean, string, number or null, but found ${zn(Kn(o))} instead.`);if(!Ou(u,["string","array"]))throw new ms(`Expected second argument to be of type array or string, but found ${zn(Kn(u))} instead.`);return u.indexOf(o)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class qh{constructor(t,o,u){this.type=Jt,this.needle=t,this.haystack=o,this.fromIndex=u}static parse(t,o){if(t.length<=2||t.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=o.parse(t[1],1,wi),f=o.parse(t[2],2,wi);if(!u||!f)return null;if(!Mf(u.type,[Li,Di,Jt,si,wi]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${zn(u.type)} instead`);if(t.length===4){const p=o.parse(t[3],3,Jt);return p?new qh(u,f,p):null}return new qh(u,f)}evaluate(t){const o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!Ou(o,["boolean","string","number","null"]))throw new ms(`Expected first argument to be of type boolean, string, number or null, but found ${zn(Kn(o))} instead.`);if(!Ou(u,["string","array"]))throw new ms(`Expected second argument to be of type array or string, but found ${zn(Kn(u))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(t);return u.indexOf(o,f)}return u.indexOf(o)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class j0{constructor(t,o,u,f,p,y){this.inputType=t,this.type=o,this.input=u,this.cases=f,this.outputs=p,this.otherwise=y}static parse(t,o){if(t.length<5)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return o.error("Expected an even number of arguments.");let u,f;o.expectedType&&o.expectedType.kind!=="value"&&(f=o.expectedType);const p={},y=[];for(let A=2;A<t.length-1;A+=2){let R=t[A];const P=t[A+1];Array.isArray(R)||(R=[R]);const L=o.concat(A);if(R.length===0)return L.error("Expected at least one branch label.");for(const N of R){if(typeof N!="number"&&typeof N!="string")return L.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return L.error("Numeric branch labels must be integer values.");if(u){if(L.checkSubtype(u,Kn(N)))return null}else u=Kn(N);if(p[String(N)]!==void 0)return L.error("Branch labels must be unique.");p[String(N)]=y.length}const z=o.parse(P,A,f);if(!z)return null;f=f||z.type,y.push(z)}const b=o.parse(t[1],1,wi);if(!b)return null;const T=o.parse(t[t.length-1],t.length-1,f);return T?b.type.kind!=="value"&&o.concat(1).checkSubtype(u,b.type)?null:new j0(u,f,b,p,y,T):null}evaluate(t){const o=this.input.evaluate(t);return(Kn(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),u=[],f={};for(const y of o){const b=f[this.cases[y]];b===void 0?(f[this.cases[y]]=u.length,u.push([this.cases[y],[y]])):u[b][1].push(y)}const p=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,b]of u)t.push(b.length===1?p(b[0]):b.map(p)),t.push(this.outputs[y].serialize());return t.push(this.otherwise.serialize()),t}}class $0{constructor(t,o,u){this.type=t,this.branches=o,this.otherwise=u}static parse(t,o){if(t.length<4)return o.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return o.error("Expected an odd number of arguments.");let u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);const f=[];for(let y=1;y<t.length-1;y+=2){const b=o.parse(t[y],y,Li);if(!b)return null;const T=o.parse(t[y+1],y+1,u);if(!T)return null;f.push([b,T]),u=u||T.type}const p=o.parse(t[t.length-1],t.length-1,u);return p?new $0(u,f,p):null}evaluate(t){for(const[o,u]of this.branches)if(o.evaluate(t))return u.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[o,u]of this.branches)t(o),t(u);t(this.otherwise)}outputDefined(){return this.branches.every(([t,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(o=>{t.push(o.serialize())}),t}}class Hh{constructor(t,o,u,f){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=f}static parse(t,o){if(t.length<=2||t.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=o.parse(t[1],1,wi),f=o.parse(t[2],2,Jt);if(!u||!f)return null;if(!Mf(u.type,[Ts(wi),Di,wi]))return o.error(`Expected first argument to be of type array or string, but found ${zn(u.type)} instead`);if(t.length===4){const p=o.parse(t[3],3,Jt);return p?new Hh(u.type,u,f,p):null}return new Hh(u.type,u,f)}evaluate(t){const o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!Ou(o,["string","array"]))throw new ms(`Expected first argument to be of type array or string, but found ${zn(Kn(o))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(t);return o.slice(u,f)}return o.slice(u)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function dx(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function G0(i,t,o,u){return u.compare(t,o)===0}function ju(i,t,o){const u=i!=="=="&&i!=="!=";return class R8{constructor(p,y,b){this.type=Li,this.lhs=p,this.rhs=y,this.collator=b,this.hasUntypedArgument=p.type.kind==="value"||y.type.kind==="value"}static parse(p,y){if(p.length!==3&&p.length!==4)return y.error("Expected two or three arguments.");const b=p[0];let T=y.parse(p[1],1,wi);if(!T)return null;if(!dx(b,T.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${zn(T.type)}'.`);let A=y.parse(p[2],2,wi);if(!A)return null;if(!dx(b,A.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${zn(A.type)}'.`);if(T.type.kind!==A.type.kind&&T.type.kind!=="value"&&A.type.kind!=="value")return y.error(`Cannot compare types '${zn(T.type)}' and '${zn(A.type)}'.`);u&&(T.type.kind==="value"&&A.type.kind!=="value"?T=new Ja(A.type,[T]):T.type.kind!=="value"&&A.type.kind==="value"&&(A=new Ja(T.type,[A])));let R=null;if(p.length===4){if(T.type.kind!=="string"&&A.type.kind!=="string"&&T.type.kind!=="value"&&A.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(R=y.parse(p[3],3,Rf),!R)return null}return new R8(T,A,R)}evaluate(p){const y=this.lhs.evaluate(p),b=this.rhs.evaluate(p);if(u&&this.hasUntypedArgument){const T=Kn(y),A=Kn(b);if(T.kind!==A.kind||T.kind!=="string"&&T.kind!=="number")throw new ms(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${T.kind}, ${A.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const T=Kn(y),A=Kn(b);if(T.kind!=="string"||A.kind!=="string")return t(p,y,b)}return this.collator?o(p,y,b,this.collator.evaluate(p)):t(p,y,b)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[i];return this.eachChild(y=>{p.push(y.serialize())}),p}}}const i5=ju("==",function(i,t,o){return t===o},G0),q0=ju("!=",function(i,t,o){return t!==o},function(i,t,o,u){return!G0(0,t,o,u)}),t_=ju("<",function(i,t,o){return t<o},function(i,t,o,u){return u.compare(t,o)<0}),fx=ju(">",function(i,t,o){return t>o},function(i,t,o,u){return u.compare(t,o)>0}),n5=ju("<=",function(i,t,o){return t<=o},function(i,t,o,u){return u.compare(t,o)<=0}),px=ju(">=",function(i,t,o){return t>=o},function(i,t,o,u){return u.compare(t,o)>=0});class H0{constructor(t,o,u,f,p,y){this.type=Di,this.number=t,this.locale=o,this.currency=u,this.unit=f,this.minFractionDigits=p,this.maxFractionDigits=y}static parse(t,o){if(t.length!==3)return o.error("Expected two arguments.");const u=o.parse(t[1],1,Jt);if(!u)return null;const f=t[2];if(typeof f!="object"||Array.isArray(f))return o.error("NumberFormat options argument must be an object.");let p=null;if(f.locale&&(p=o.parse(f.locale,1,Di),!p))return null;let y=null;if(f.currency&&(y=o.parse(f.currency,1,Di),!y))return null;let b=null;if(f.unit&&(b=o.parse(f.unit,1,Di),!b))return null;let T=null;if(f["min-fraction-digits"]&&(T=o.parse(f["min-fraction-digits"],1,Jt),!T))return null;let A=null;return f["max-fraction-digits"]&&(A=o.parse(f["max-fraction-digits"],1,Jt),!A)?null:new H0(u,p,y,b,T,A)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class qf{constructor(t){this.type=Jt,this.input=t}static parse(t,o){if(t.length!==2)return o.error(`Expected 1 argument, but found ${t.length-1} instead.`);const u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${zn(u.type)} instead.`):new qf(u):null}evaluate(t){const o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new ms(`Expected value to be of type string or array, but found ${zn(Kn(o))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(o=>{t.push(o.serialize())}),t}}function mx(i){return function(){i=1831565813+(i|=0)|0;let t=Math.imul(i^i>>>15,1|i);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const Wh={"==":i5,"!=":q0,">":fx,"<":t_,">=":px,"<=":n5,array:Ja,at:Gf,boolean:Ja,case:$0,coalesce:Jm,collator:Df,format:kf,image:Vh,in:U0,"index-of":qh,interpolate:oa,"interpolate-hcl":oa,"interpolate-lab":oa,length:qf,let:e_,literal:Tl,match:j0,number:Ja,"number-format":H0,object:Ja,slice:Hh,step:jf,string:Ja,"to-boolean":tc,"to-color":tc,"to-number":tc,"to-string":tc,var:sa,within:Fu,distance:Vu,config:jc};function _x(i,[t,o,u,f]){t=t.evaluate(i),o=o.evaluate(i),u=u.evaluate(i);const p=f?f.evaluate(i):1,y=Z1(t,o,u,p);if(y)throw new ms(y);return new Bi(t/255*p,o/255*p,u/255*p,p)}function gx(i,[t,o,u,f]){t=t.evaluate(i),o=o.evaluate(i),u=u.evaluate(i);const p=f?f.evaluate(i):1,y=function(A,R,P,L){return typeof A=="number"&&A>=0&&A<=360?typeof R=="number"&&R>=0&&R<=100&&typeof P=="number"&&P>=0&&P<=100?L===void 0||typeof L=="number"&&L>=0&&L<=1?null:`Invalid hsla value [${[A,R,P,L].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof L=="number"?[A,R,P,L]:[A,R,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof L=="number"?[A,R,P,L]:[A,R,P]).join(", ")}]: 'h' must be between 0 and 360.`}(t,o,u,p);if(y)throw new ms(y);const b=`hsla(${t}, ${o}%, ${u}%, ${p})`,T=Bi.parse(b);if(!T)throw new ms(`Failed to parse HSLA color: ${b}`);return T}function W0(i,t){return i in t}function Z0(i,t){const o=t[i];return o===void 0?null:o}function $u(i){return{type:i}}function yx(i){return{result:"success",value:i}}function Gu(i){return{result:"error",value:i}}function vx(i,t){return!!i&&!!i.parameters&&i.parameters.indexOf(t)>-1}function r_(i){return i["property-type"]==="data-driven"}function xx(i){return vx(i.expression,"measure-light")}function bx(i){return vx(i.expression,"zoom")}function Zh(i){return!!i.expression&&i.expression.interpolated}function X0(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function s5(i){return i}function Hf(i,t){const o=t.type==="color",u=i.stops&&typeof i.stops[0][0]=="object",f=u||!(u||i.property!==void 0),p=i.type||(Zh(t)?"exponential":"interval");if(o&&((i=Fm({},i)).stops&&(i.stops=i.stops.map(A=>[A[0],Bi.parse(A[1])])),i.default=Bi.parse(i.default?i.default:t.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!$f[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let y,b,T;if(p==="exponential")y=Y0;else if(p==="interval")y=o5;else if(p==="categorical"){y=wx,b=Object.create(null);for(const A of i.stops)b[A[0]]=A[1];T=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);y=Tx}if(u){const A={},R=[];for(let z=0;z<i.stops.length;z++){const N=i.stops[z],U=N[0].zoom;A[U]===void 0&&(A[U]={zoom:U,type:i.type,property:i.property,default:i.default,stops:[]},R.push(U)),A[U].stops.push([N[0].value,N[1]])}const P=[];for(const z of R)P.push([A[z].zoom,Hf(A[z],t)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:oa.interpolationFactor.bind(void 0,L),zoomStops:P.map(z=>z[0]),evaluate:({zoom:z},N)=>Y0({stops:P,base:i.base},t,z).evaluate(z,N)}}if(f){const A=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:oa.interpolationFactor.bind(void 0,A),zoomStops:i.stops.map(R=>R[0]),evaluate:({zoom:R})=>y(i,t,R,b,T)}}return{kind:"source",evaluate(A,R){const P=R&&R.properties?R.properties[i.property]:void 0;return P===void 0?Wf(i.default,t.default):y(i,t,P,b,T)}}}function Wf(i,t,o){return i!==void 0?i:t!==void 0?t:o!==void 0?o:void 0}function wx(i,t,o,u,f){return Wf(typeof o===f?u[o]:void 0,i.default,t.default)}function o5(i,t,o){if(Vc(o)!=="number")return Wf(i.default,t.default);const u=i.stops.length;if(u===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[u-1][0])return i.stops[u-1][1];const f=Ym(i.stops.map(p=>p[0]),o);return i.stops[f][1]}function Y0(i,t,o){const u=i.base!==void 0?i.base:1;if(Vc(o)!=="number")return Wf(i.default,t.default);const f=i.stops.length;if(f===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[f-1][0])return i.stops[f-1][1];const p=Ym(i.stops.map(R=>R[0]),o),y=function(R,P,L,z){const N=z-L,U=R-L;return N===0?0:P===1?U/N:(Math.pow(P,U)-1)/(Math.pow(P,N)-1)}(o,u,i.stops[p][0],i.stops[p+1][0]),b=i.stops[p][1],T=i.stops[p+1][1];let A=Cf[t.type]||s5;if(i.colorSpace&&i.colorSpace!=="rgb"){const R=$f[i.colorSpace];A=(P,L)=>R.reverse(R.interpolate(R.forward(P),R.forward(L),y))}return typeof b.evaluate=="function"?{evaluate(...R){const P=b.evaluate.apply(void 0,R),L=T.evaluate.apply(void 0,R);if(P!==void 0&&L!==void 0)return A(P,L,y)}}:A(b,T,y)}function Tx(i,t,o){return t.type==="color"?o=Bi.parse(o):t.type==="formatted"?o=Vs.fromString(o.toString()):t.type==="resolvedImage"?o=na.fromString(o.toString()):Vc(o)===t.type||t.type==="enum"&&t.values[o]||(o=void 0),Wf(o,i.default,t.default)}Oo.register(Wh,{error:[{kind:"error"},[Di],(i,[t])=>{throw new ms(t.evaluate(i))}],typeof:[Di,[wi],(i,[t])=>zn(Kn(t.evaluate(i)))],"to-rgba":[Ts(Jt,4),[ia],(i,[t])=>t.evaluate(i).toArray()],rgb:[ia,[Jt,Jt,Jt],_x],rgba:[ia,[Jt,Jt,Jt,Jt],_x],hsl:[ia,[Jt,Jt,Jt],gx],hsla:[ia,[Jt,Jt,Jt,Jt],gx],has:{type:Li,overloads:[[[Di],(i,[t])=>W0(t.evaluate(i),i.properties())],[[Di,zh],(i,[t,o])=>W0(t.evaluate(i),o.evaluate(i))]]},get:{type:wi,overloads:[[[Di],(i,[t])=>Z0(t.evaluate(i),i.properties())],[[Di,zh],(i,[t,o])=>Z0(t.evaluate(i),o.evaluate(i))]]},"feature-state":[wi,[Di],(i,[t])=>Z0(t.evaluate(i),i.featureState||{})],properties:[zh,[],i=>i.properties()],"geometry-type":[Di,[],i=>i.geometryType()],id:[wi,[],i=>i.id()],zoom:[Jt,[],i=>i.globals.zoom],pitch:[Jt,[],i=>i.globals.pitch||0],"distance-from-center":[Jt,[],i=>i.distanceFromCenter()],"measure-light":[Jt,[Di],(i,[t])=>i.measureLight(t.evaluate(i))],"heatmap-density":[Jt,[],i=>i.globals.heatmapDensity||0],"line-progress":[Jt,[],i=>i.globals.lineProgress||0],"raster-value":[Jt,[],i=>i.globals.rasterValue||0],"raster-particle-speed":[Jt,[],i=>i.globals.rasterParticleSpeed||0],"sky-radial-progress":[Jt,[],i=>i.globals.skyRadialProgress||0],accumulated:[wi,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Jt,$u(Jt),(i,t)=>{let o=0;for(const u of t)o+=u.evaluate(i);return o}],"*":[Jt,$u(Jt),(i,t)=>{let o=1;for(const u of t)o*=u.evaluate(i);return o}],"-":{type:Jt,overloads:[[[Jt,Jt],(i,[t,o])=>t.evaluate(i)-o.evaluate(i)],[[Jt],(i,[t])=>-t.evaluate(i)]]},"/":[Jt,[Jt,Jt],(i,[t,o])=>t.evaluate(i)/o.evaluate(i)],"%":[Jt,[Jt,Jt],(i,[t,o])=>t.evaluate(i)%o.evaluate(i)],ln2:[Jt,[],()=>Math.LN2],pi:[Jt,[],()=>Math.PI],e:[Jt,[],()=>Math.E],"^":[Jt,[Jt,Jt],(i,[t,o])=>Math.pow(t.evaluate(i),o.evaluate(i))],sqrt:[Jt,[Jt],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[Jt,[Jt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[Jt,[Jt],(i,[t])=>Math.log(t.evaluate(i))],log2:[Jt,[Jt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[Jt,[Jt],(i,[t])=>Math.sin(t.evaluate(i))],cos:[Jt,[Jt],(i,[t])=>Math.cos(t.evaluate(i))],tan:[Jt,[Jt],(i,[t])=>Math.tan(t.evaluate(i))],asin:[Jt,[Jt],(i,[t])=>Math.asin(t.evaluate(i))],acos:[Jt,[Jt],(i,[t])=>Math.acos(t.evaluate(i))],atan:[Jt,[Jt],(i,[t])=>Math.atan(t.evaluate(i))],min:[Jt,$u(Jt),(i,t)=>Math.min(...t.map(o=>o.evaluate(i)))],max:[Jt,$u(Jt),(i,t)=>Math.max(...t.map(o=>o.evaluate(i)))],abs:[Jt,[Jt],(i,[t])=>Math.abs(t.evaluate(i))],round:[Jt,[Jt],(i,[t])=>{const o=t.evaluate(i);return o<0?-Math.round(-o):Math.round(o)}],floor:[Jt,[Jt],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[Jt,[Jt],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Li,[Di,wi],(i,[t,o])=>i.properties()[t.value]===o.value],"filter-id-==":[Li,[wi],(i,[t])=>i.id()===t.value],"filter-type-==":[Li,[Di],(i,[t])=>i.geometryType()===t.value],"filter-<":[Li,[Di,wi],(i,[t,o])=>{const u=i.properties()[t.value],f=o.value;return typeof u==typeof f&&u<f}],"filter-id-<":[Li,[wi],(i,[t])=>{const o=i.id(),u=t.value;return typeof o==typeof u&&o<u}],"filter->":[Li,[Di,wi],(i,[t,o])=>{const u=i.properties()[t.value],f=o.value;return typeof u==typeof f&&u>f}],"filter-id->":[Li,[wi],(i,[t])=>{const o=i.id(),u=t.value;return typeof o==typeof u&&o>u}],"filter-<=":[Li,[Di,wi],(i,[t,o])=>{const u=i.properties()[t.value],f=o.value;return typeof u==typeof f&&u<=f}],"filter-id-<=":[Li,[wi],(i,[t])=>{const o=i.id(),u=t.value;return typeof o==typeof u&&o<=u}],"filter->=":[Li,[Di,wi],(i,[t,o])=>{const u=i.properties()[t.value],f=o.value;return typeof u==typeof f&&u>=f}],"filter-id->=":[Li,[wi],(i,[t])=>{const o=i.id(),u=t.value;return typeof o==typeof u&&o>=u}],"filter-has":[Li,[wi],(i,[t])=>t.value in i.properties()],"filter-has-id":[Li,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Li,[Ts(Di)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Li,[Ts(wi)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Li,[Di,Ts(wi)],(i,[t,o])=>o.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Li,[Di,Ts(wi)],(i,[t,o])=>function(u,f,p,y){for(;p<=y;){const b=p+y>>1;if(f[b]===u)return!0;f[b]>u?y=b-1:p=b+1}return!1}(i.properties()[t.value],o.value,0,o.value.length-1)],all:{type:Li,overloads:[[[Li,Li],(i,[t,o])=>t.evaluate(i)&&o.evaluate(i)],[$u(Li),(i,t)=>{for(const o of t)if(!o.evaluate(i))return!1;return!0}]]},any:{type:Li,overloads:[[[Li,Li],(i,[t,o])=>t.evaluate(i)||o.evaluate(i)],[$u(Li),(i,t)=>{for(const o of t)if(o.evaluate(i))return!0;return!1}]]},"!":[Li,[Li],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Li,[Di],(i,[t])=>{const o=i.globals&&i.globals.isSupportedScript;return!o||o(t.evaluate(i))}],upcase:[Di,[Di],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[Di,[Di],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[Di,$u(wi),(i,t)=>t.map(o=>Ca(o.evaluate(i))).join("")],"resolved-locale":[Di,[Rf],(i,[t])=>t.evaluate(i).resolvedLocale()],random:[Jt,[Jt,Jt,wi],(i,t)=>{const[o,u,f]=t.map(y=>y.evaluate(i));if(o>u||o===u)return o;let p;if(typeof f=="string")p=function(y){let b=0;if(y.length===0)return b;for(let T=0;T<y.length;T++)b=(b<<5)-b+y.charCodeAt(T),b|=0;return b}(f);else{if(typeof f!="number")throw new ms(`Invalid seed input: ${f}`);p=f}return o+mx(p)()*(u-o)}]});class i_{constructor(t,o,u,f){this.expression=t,this._warningHistory={},this._evaluator=new w0(u,f),this._defaultValue=o?function(p){return p.type==="color"&&(X0(p.default)||Array.isArray(p.default))?new Bi(0,0,0,0):p.type==="color"?Bi.parse(p.default)||null:p.default===void 0?null:p.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(t,o,u,f,p,y,b,T){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=f||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(t,o,u,f,p,y,b,T){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new ms(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function n_(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Wh}function Xh(i,t,o,u){const f=new Zm(Wh,[],t?function(y){const b={color:ia,string:Di,number:Jt,enum:Di,boolean:Li,formatted:Fh,resolvedImage:Nh};return y.type==="array"?Ts(b[y.value]||wi,y.length):b[y.type]}(t):void 0,void 0,void 0,o,u),p=f.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?yx(new i_(p,t,o,u)):Gu(f.errors)}class Zf{constructor(t,o,u){this.kind=t,this._styleExpression=o,this.isLightConstant=u,this.isStateDependent=t!=="constant"&&!Bf(o.expression),this.isConfigDependent=!Vf(o.expression)}evaluateWithoutErrorHandling(t,o,u,f,p,y){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,f,p,y)}evaluate(t,o,u,f,p,y){return this._styleExpression.evaluate(t,o,u,f,p,y)}}class Xf{constructor(t,o,u,f,p){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!Bf(o.expression),this.isLightConstant=p,this.isConfigDependent=!Vf(o.expression),this.interpolationType=f}evaluateWithoutErrorHandling(t,o,u,f,p,y){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,f,p,y)}evaluate(t,o,u,f,p,y){return this._styleExpression.evaluate(t,o,u,f,p,y)}interpolationFactor(t,o,u){return this.interpolationType?oa.interpolationFactor(this.interpolationType,t,o,u):0}}function Ex(i,t,o,u){if((i=Xh(i,t,o,u)).result==="error")return i;const f=i.value.expression,p=$c(f);if(!p&&!r_(t))return Gu([new Ka("","data expressions not supported")]);const y=Uf(f,["zoom","pitch","distance-from-center"]);if(!y&&!bx(t))return Gu([new Ka("","zoom expressions not supported")]);const b=Uf(f,["measure-light"]);if(!b&&!xx(t))return Gu([new Ka("","measure-light expression not supported")]);const T=t.expression&&t.expression.relaxZoomRestriction,A=s_(f);return A||y||T?A instanceof Ka?Gu([A]):A instanceof oa&&!Zh(t)?Gu([new Ka("",'"interpolate" expressions cannot be used with this property')]):yx(A?new Xf(p?"camera":"composite",i.value,A.labels,A instanceof oa?A.interpolation:void 0,b):new Zf(p?"constant":"source",i.value,b)):Gu([new Ka("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Yf{constructor(t,o){this._parameters=t,this._specification=o,Fm(this,Hf(this._parameters,this._specification))}static deserialize(t){return new Yf(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function s_(i){let t=null;if(i instanceof e_)t=s_(i.result);else if(i instanceof Jm){for(const o of i.args)if(t=s_(o),t)break}else(i instanceof jf||i instanceof oa)&&i.input instanceof Oo&&i.input.name==="zoom"&&(t=i);return t instanceof Ka||i.eachChild(o=>{const u=s_(o);u instanceof Ka?t=u:t&&u&&t!==u&&(t=new Ka("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var Ax=El,qc=3;function El(i,t,o){var u=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var f=new Int32Array(this.arrayBuffer);i=f[0],this.d=(t=f[1])+2*(o=f[2]);for(var p=0;p<this.d*this.d;p++){var y=f[qc+p],b=f[qc+p+1];u.push(y===b?null:f.subarray(y,b))}var T=f[qc+u.length+1];this.keys=f.subarray(f[qc+u.length],T),this.bboxes=f.subarray(T),this.insert=this._insertReadonly}else{this.d=t+2*o;for(var A=0;A<this.d*this.d;A++)u.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=i,this.padding=o,this.scale=t/i,this.uid=0;var R=o/t*i;this.min=-R,this.max=i+R}El.prototype.insert=function(i,t,o,u,f){this._forEachCell(t,o,u,f,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(f)},El.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},El.prototype._insertCell=function(i,t,o,u,f,p){this.cells[f].push(p)},El.prototype.query=function(i,t,o,u,f){var p=this.min,y=this.max;if(i<=p&&t<=p&&y<=o&&y<=u&&!f)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(i,t,o,u,this._queryCell,b,{},f),b},El.prototype._queryCell=function(i,t,o,u,f,p,y,b){var T=this.cells[f];if(T!==null)for(var A=this.keys,R=this.bboxes,P=0;P<T.length;P++){var L=T[P];if(y[L]===void 0){var z=4*L;(b?b(R[z+0],R[z+1],R[z+2],R[z+3]):i<=R[z+2]&&t<=R[z+3]&&o>=R[z+0]&&u>=R[z+1])?(y[L]=!0,p.push(A[L])):y[L]=!1}}},El.prototype._forEachCell=function(i,t,o,u,f,p,y,b){for(var T=this._convertToCellCoord(i),A=this._convertToCellCoord(t),R=this._convertToCellCoord(o),P=this._convertToCellCoord(u),L=T;L<=R;L++)for(var z=A;z<=P;z++){var N=this.d*z+L;if((!b||b(this._convertFromCellCoord(L),this._convertFromCellCoord(z),this._convertFromCellCoord(L+1),this._convertFromCellCoord(z+1)))&&f.call(this,i,t,o,u,N,p,y,b))return}},El.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},El.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},El.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,t=qc+this.cells.length+1+1,o=0,u=0;u<this.cells.length;u++)o+=this.cells[u].length;var f=new Int32Array(t+o+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var p=t,y=0;y<i.length;y++){var b=i[y];f[qc+y]=p,f.set(b,p),p+=b.length}return f[qc+i.length]=p,f.set(this.keys,p),f[qc+i.length+1]=p+=this.keys.length,f.set(this.bboxes,p),p+=this.bboxes.length,f.buffer};var Yh=Ie(Ax);const o_={};function er(i,t,o={}){Object.defineProperty(i,"_classRegistryKey",{value:t,writeable:!1}),o_[t]={klass:i,omit:o.omit||[]}}er(Object,"Object"),Yh.serialize=function(i,t){const o=i.toArrayBuffer();return t&&t.add(o),{buffer:o}},Yh.deserialize=function(i){return new Yh(i.buffer)},Object.defineProperty(Yh,"name",{value:"Grid"}),er(Yh,"Grid"),er(Bi,"Color"),er(Error,"Error"),er(Vs,"Formatted"),er(Nm,"FormattedSection"),er(Im,"AJAXError"),er(na,"ResolvedImage"),er(Yf,"StylePropertyFunction"),er(i_,"StyleExpression",{omit:["_evaluator"]}),er(Xf,"ZoomDependentExpression"),er(Zf,"ZoomConstantExpression"),er(Oo,"CompoundExpression",{omit:["_evaluate"]});for(const i in Wh)o_[Wh[i]._classRegistryKey]||er(Wh[i],`Expression${i}`);function Ix(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Sx(i){return self.ImageBitmap&&i instanceof ImageBitmap}function Qf(i,t){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Ix(i)||Sx(i))return t&&t.add(i),i;if(ArrayBuffer.isView(i)){const o=i;return t&&t.add(o.buffer),o}if(i instanceof ImageData)return t&&t.add(i.data.buffer),i;if(Array.isArray(i)){const o=[];for(const u of i)o.push(Qf(u,t));return o}if(i instanceof Map){const o={$name:"Map"};for(const[u,f]of i.entries())o[u]=Qf(f);return o}if(typeof i=="object"){const o=i.constructor,u=o._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const f=o.serialize?o.serialize(i,t):{};if(!o.serialize){for(const p in i)i.hasOwnProperty(p)&&(o_[u].omit.indexOf(p)>=0||(f[p]=Qf(i[p],t)));i instanceof Error&&(f.message=i.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(f.$name=u),f}throw new Error("can't serialize object of type "+typeof i)}function m(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Ix(i)||Sx(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(m);if(typeof i=="object"){const t=i.$name||"Object";if(t==="Map"){const f=new Map;for(const p of Object.keys(i))p!=="$name"&&f.set(p,m(i[p]));return f}const{klass:o}=o_[t];if(!o)throw new Error(`can't deserialize unregistered class ${t}`);if(o.deserialize)return o.deserialize(i);const u=Object.create(o.prototype);for(const f of Object.keys(i))f!=="$name"&&(u[f]=m(i[f]));return u}throw new Error("can't deserialize object of type "+typeof i)}const a={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519,"CJK Unified Ideographs Extension B":i=>i>=131072&&i<=173791};function h(i){for(const t of i)if(w(t.charCodeAt(0)))return!0;return!1}function g(i){for(const t of i)if(!v(t.charCodeAt(0)))return!1;return!0}function v(i){return!(a.Arabic(i)||a["Arabic Supplement"](i)||a["Arabic Extended-A"](i)||a["Arabic Presentation Forms-A"](i)||a["Arabic Presentation Forms-B"](i))}function w(i){return!(i!==746&&i!==747&&(i<4352||!(a["Bopomofo Extended"](i)||a.Bopomofo(i)||a["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||a["CJK Compatibility Ideographs"](i)||a["CJK Compatibility"](i)||a["CJK Radicals Supplement"](i)||a["CJK Strokes"](i)||!(!a["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||a["CJK Unified Ideographs Extension A"](i)||a["CJK Unified Ideographs"](i)||a["Enclosed CJK Letters and Months"](i)||a["Hangul Compatibility Jamo"](i)||a["Hangul Jamo Extended-A"](i)||a["Hangul Jamo Extended-B"](i)||a["Hangul Jamo"](i)||a["Hangul Syllables"](i)||a.Hiragana(i)||a["Ideographic Description Characters"](i)||a.Kanbun(i)||a["Kangxi Radicals"](i)||a["Katakana Phonetic Extensions"](i)||a.Katakana(i)&&i!==12540||!(!a["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!a["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||a["Unified Canadian Aboriginal Syllabics"](i)||a["Unified Canadian Aboriginal Syllabics Extended"](i)||a["Vertical Forms"](i)||a["Yijing Hexagram Symbols"](i)||a["Yi Syllables"](i)||a["Yi Radicals"](i))))}function E(i){return!(w(i)||function(t){return!!(a["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||a["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||a["Letterlike Symbols"](t)||a["Number Forms"](t)||a["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||a["Control Pictures"](t)&&t!==9251||a["Optical Character Recognition"](t)||a["Enclosed Alphanumerics"](t)||a["Geometric Shapes"](t)||a["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||a["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||a["CJK Symbols and Punctuation"](t)||a.Katakana(t)||a["Private Use Area"](t)||a["CJK Compatibility Forms"](t)||a["Small Form Variants"](t)||a["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}function C(i){return i>=1424&&i<=2303||a["Arabic Presentation Forms-A"](i)||a["Arabic Presentation Forms-B"](i)}function k(i,t){return!(!t&&C(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||a.Khmer(i))}function O(i){for(const t of i)if(C(t.charCodeAt(0)))return!0;return!1}const F="deferred",B="loading",$="loaded";let G=null,X="unavailable",Z=null;const Y=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(X="error"),G&&G(i)};function K(){ne.fire(new Nc("pluginStateChange",{pluginStatus:X,pluginURL:Z}))}const ne=new Lu,fe=function(){return X},de=function(){if(X!==F||!Z)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");X=B,K(),Z&&xf({url:Z},i=>{i?Y(i):(X=$,K())})},ye={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>X===$||ye.applyArabicShaping!=null,isLoading:()=>X===B,setState(i){X=i.pluginStatus,Z=i.pluginURL},isParsed:()=>ye.applyArabicShaping!=null&&ye.processBidirectionalText!=null&&ye.processStyledBidirectionalText!=null,getPluginURL:()=>Z};class J{constructor(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(o,u){for(const f of o)if(!k(f.charCodeAt(0),u))return!1;return!0}(t,ye.isLoaded())}}class ae{constructor(t,o,u,f){this.property=t,this.value=o,this.expression=function(p,y,b,T){if(X0(p))return new Yf(p,y);if(n_(p)||Array.isArray(p)&&p.length>0){const A=Ex(p,y,b,T);if(A.result==="error")throw new Error(A.value.map(R=>`${R.key}: ${R.message}`).join(", "));return A.value}{let A=p;return typeof p=="string"&&y.type==="color"&&(A=Bi.parse(p)),{kind:"constant",isConfigDependent:!1,evaluate:()=>A}}}(o===void 0?t.specification.default:o,t.specification,u,f)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)}}class ke{constructor(t,o,u){this.property=t,this.value=new ae(t,void 0,o,u)}transitioned(t,o){return new Ne(this.property,this.value,o,_o({},t.transition,this.transition),t.now)}untransitioned(){return new Ne(this.property,this.value,null,{},0)}}class Re{constructor(t,o,u){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=o,this._options=u,this.isConfigDependent=!1}getValue(t){return go(this._values[t].value.value)}setValue(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new ke(this._values[t].property,this._scope,this._options)),this._values[t].value=new ae(this._values[t].property,o===null?void 0:go(o),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,o){o&&(this._options=o);const u=this._properties.properties;if(t)for(const f in t){const p=t[f];if(Ea(f,"-transition")){const y=f.slice(0,-11);u[y]&&this.setTransition(y,p)}else u[f]&&this.setValue(f,p)}}getTransition(t){return go(this._values[t].transition)}setTransition(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new ke(this._values[t].property)),this._values[t].transition=go(o)||void 0}serialize(){const t={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(t[o]=u);const f=this.getTransition(o);f!==void 0&&(t[`${o}-transition`]=f)}return t}transitioned(t,o){const u=new et(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].transitioned(t,o._values[f]);return u}untransitioned(){const t=new et(this._properties);for(const o of Object.keys(this._values))t._values[o]=this._values[o].untransitioned();return t}}class Ne{constructor(t,o,u,f,p){const y=f.delay||0,b=f.duration||0;p=p||0,this.property=t,this.value=o,this.begin=p+y,this.end=this.begin+b,t.specification.transition&&(f.delay||f.duration)&&(this.prior=u)}possiblyEvaluate(t,o,u){const f=t.now||0,p=this.value.possiblyEvaluate(t,o,u),y=this.prior;if(y){if(f>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(f<this.begin)return y.possiblyEvaluate(t,o,u);{const b=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(t,o,u),p,Rh(b))}}return p}}class et{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,o,u){const f=new it(this._properties);for(const p of Object.keys(this._values))f._values[p]=this._values[p].possiblyEvaluate(t,o,u);return f}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ze{constructor(t,o,u){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=o,this._options=u,this.isConfigDependent=!1}getValue(t){return go(this._values[t].value)}setValue(t,o){this._values[t]=new ae(this._values[t].property,o===null?void 0:go(o),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){const t={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(t[o]=u)}return t}possiblyEvaluate(t,o,u){const f=new it(this._properties);for(const p of Object.keys(this._values))f._values[p]=this._values[p].possiblyEvaluate(t,o,u);return f}}class Qe{constructor(t,o,u){this.property=t,this.value=o,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,o,u,f){return this.property.evaluate(this.value,this.parameters,t,o,u,f)}}class it{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Oe{constructor(t){this.specification=t}possiblyEvaluate(t,o){return t.expression.evaluate(o)}interpolate(t,o,u){const f=Cf[this.specification.type];return f?f(t,o,u):t}}class He{constructor(t,o){this.specification=t,this.overrides=o}possiblyEvaluate(t,o,u,f){return new Qe(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,f)}:t.expression,o)}interpolate(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new Qe(this,{kind:"constant",value:void 0},t.parameters);const f=Cf[this.specification.type];return f?new Qe(this,{kind:"constant",value:f(t.value.value,o.value.value,u)},t.parameters):t}evaluate(t,o,u,f,p,y){return t.kind==="constant"?t.value:t.evaluate(o,u,f,p,y)}}class Tt{constructor(t){this.specification=t}possiblyEvaluate(t,o,u,f){return!!t.expression.evaluate(o,null,{},u,f)}interpolate(){return!1}}class Ue{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new J(0,{});for(const u in t){const f=t[u];f.specification.overridable&&this.overridableProperties.push(u);const p=this.defaultPropertyValues[u]=new ae(f,void 0),y=this.defaultTransitionablePropertyValues[u]=new ke(f);this.defaultTransitioningPropertyValues[u]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=p.possiblyEvaluate(o)}}}function Je(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function rt(i){if(Array.isArray(i))return i.map(rt);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const o in i)t[o]=rt(i[o]);return t}return Je(i)}er(He,"DataDrivenProperty"),er(Oe,"DataConstantProperty"),er(Tt,"ColorRampProperty");var me=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function vt(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!vt(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function Zt(i,t="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};vt(i)||(i=vi(i));const o=i;let u=!0;try{u=function(A){if(!cr(A))return A;let R=rt(A);return fr(R),R=ir(R),R}(o)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(o,null,2)}
        `)}const f=me[`filter_${t}`],p=Xh(u,f);let y=null;if(p.result==="error")throw new Error(p.value.map(A=>`${A.key}: ${A.message}`).join(", "));y=(A,R,P)=>p.value.evaluate(A,R,{},P);let b=null,T=null;if(u!==o){const A=Xh(o,f);if(A.result==="error")throw new Error(A.value.map(R=>`${R.key}: ${R.message}`).join(", "));b=(R,P,L,z,N)=>A.value.evaluate(R,P,{},L,void 0,void 0,z,N),T=!$c(A.value.expression)}return{filter:y,dynamicFilter:b||void 0,needGeometry:zr(u),needFeature:!!T}}function ir(i){if(!Array.isArray(i))return i;const t=function(o){if(vr.has(o[0])){for(let u=1;u<o.length;u++)if(cr(o[u]))return!0}return o}(i);return t===!0?t:t.map(o=>ir(o))}function fr(i){let t=!1;const o=[];if(i[0]==="case"){for(let u=1;u<i.length-1;u+=2)t=t||cr(i[u]),o.push(i[u+1]);o.push(i[i.length-1])}else if(i[0]==="match"){t=t||cr(i[1]);for(let u=2;u<i.length-1;u+=2)o.push(i[u+1]);o.push(i[i.length-1])}else if(i[0]==="step"){t=t||cr(i[1]);for(let u=1;u<i.length-1;u+=2)o.push(i[u+1])}t&&(i.length=0,i.push("any",...o));for(let u=1;u<i.length;u++)fr(i[u])}function cr(i){if(!Array.isArray(i))return!1;if((t=i[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let o=1;o<i.length;o++)if(cr(i[o]))return!0;return!1}const vr=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function hi(i,t){return i<t?-1:i>t?1:0}function zr(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(zr(i[t]))return!0;return!1}function vi(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?di(i[1],i[2],"=="):t==="!="?Jn(di(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?di(i[1],i[2],t):t==="any"?(o=i.slice(1),["any"].concat(o.map(vi))):t==="all"?["all"].concat(i.slice(1).map(vi)):t==="none"?["all"].concat(i.slice(1).map(vi).map(Jn)):t==="in"?yn(i[1],i.slice(2)):t==="!in"?Jn(yn(i[1],i.slice(2))):t==="has"?Vi(i[1]):t!=="!has"||Jn(Vi(i[1]));var o}function di(i,t,o){switch(i){case"$type":return[`filter-type-${o}`,t];case"$id":return[`filter-id-${o}`,t];default:return[`filter-${o}`,i,t]}}function yn(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(o=>typeof o!=typeof t[0])?["filter-in-large",i,["literal",t.sort(hi)]]:["filter-in-small",i,["literal",t]]}}function Vi(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Jn(i){return["!",i]}const Un="";function Yi(i,t){return t?`${i}${Un}${t}`:i}const ji="-transition",Xr=new Set(["fill","line","background","hillshade","raster"]);class Qr extends Lu{constructor(t,o,u,f){if(super(),this.id=t.id,this.fqid=Yi(this.id,u),this.type=t.type,this.scope=u,this.options=f,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),t.slot&&(this.slot=t.slot),o.layout&&(this._unevaluatedLayout=new ze(o.layout,this.scope,f),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),o.paint)){this._transitionablePaint=new Re(o.paint,this.scope,f);for(const p in t.paint)this.setPaintProperty(p,t.paint[p]);for(const p in t.layout)this.setLayoutProperty(p,t.layout[p]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new it(o.paint)}}onAdd(t){}onRemove(t){}isDraped(t){return Xr.has(this.type)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,o){if(this.type==="custom"&&t==="visibility")return void(this.visibility=o);const u=this._unevaluatedLayout;u._properties.properties[t]&&(u.setValue(t,o),this.isConfigDependent=this.isConfigDependent||u.isConfigDependent,t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return Ea(t,ji)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,o){const u=this._transitionablePaint,f=u._properties.properties;if(Ea(t,ji)){const P=t.slice(0,-11);return f[P]&&u.setTransition(P,o||void 0),!1}if(!f[t])return!1;const p=u._values[t],y=p.value.isDataDriven(),b=p.value;u.setValue(t,o),this.isConfigDependent=this.isConfigDependent||u.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);const T=u._values[t].value,A=T.isDataDriven(),R=Ea(t,"pattern")||t==="line-dasharray";return A||y||R||this._handleOverridablePaintPropertyUpdate(t,b,T)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,o){return null}_handleOverridablePaintPropertyUpdate(t,o,u){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,o)}serialize(){return Lc({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,o)=>!(t===void 0||o==="layout"&&!Object.keys(t).length||o==="paint"&&!Object.keys(t).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const o=this.paint.get(t);if(o instanceof Qe&&r_(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Zt(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(t){}queryIntersectsFeature(t,o,u,f,p,y,b,T,A){}queryIntersectsMatchingFeature(t,o,u,f){}}const ln={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qi{constructor(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class oi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,o){return t._trim(),o&&(t.isTransferred=!0,o.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Gr(i,t=1){let o=0,u=0;return{members:i.map(f=>{const p=ln[f.type].BYTES_PER_ELEMENT,y=o=vo(o,Math.max(t,p)),b=f.components||1;return u=Math.max(u,p),o+=p*b,{name:f.name,type:f.type,components:b,offset:y}}),size:vo(o,Math.max(u,t)),alignment:t}}function vo(i,t){return Math.ceil(i/t)*t}class js extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,o)}emplace(t,o,u){const f=2*t;return this.int16[f+0]=o,this.int16[f+1]=u,t}}js.prototype.bytesPerElement=4,er(js,"StructArrayLayout2i4");class _s extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,o,u)}emplace(t,o,u,f){const p=3*t;return this.int16[p+0]=o,this.int16[p+1]=u,this.int16[p+2]=f,t}}_s.prototype.bytesPerElement=6,er(_s,"StructArrayLayout3i6");class $s extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,u,f)}emplace(t,o,u,f,p){const y=4*t;return this.int16[y+0]=o,this.int16[y+1]=u,this.int16[y+2]=f,this.int16[y+3]=p,t}}$s.prototype.bytesPerElement=8,er($s,"StructArrayLayout4i8");class xo extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,o,u,f,p)}emplace(t,o,u,f,p,y){const b=5*t;return this.int16[b+0]=o,this.int16[b+1]=u,this.int16[b+2]=f,this.int16[b+3]=p,this.int16[b+4]=y,t}}xo.prototype.bytesPerElement=10,er(xo,"StructArrayLayout5i10");class to extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,u,f,p,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,t,o,u,f,p,y,b)}emplace(t,o,u,f,p,y,b,T){const A=6*t,R=12*t,P=3*t;return this.int16[A+0]=o,this.int16[A+1]=u,this.uint8[R+4]=f,this.uint8[R+5]=p,this.uint8[R+6]=y,this.uint8[R+7]=b,this.float32[P+2]=T,t}}to.prototype.bytesPerElement=12,er(to,"StructArrayLayout2i4ub1f12");class gs extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,u,f)}emplace(t,o,u,f,p){const y=4*t;return this.float32[y+0]=o,this.float32[y+1]=u,this.float32[y+2]=f,this.float32[y+3]=p,t}}gs.prototype.bytesPerElement=16,er(gs,"StructArrayLayout4f16");class Cs extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,o)}emplace(t,o,u){const f=2*t;return this.float32[f+0]=o,this.float32[f+1]=u,t}}Cs.prototype.bytesPerElement=8,er(Cs,"StructArrayLayout2f8");class Rs extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,o,u,f,p)}emplace(t,o,u,f,p,y){const b=6*t,T=3*t;return this.uint16[b+0]=o,this.uint16[b+1]=u,this.uint16[b+2]=f,this.uint16[b+3]=p,this.float32[T+2]=y,t}}Rs.prototype.bytesPerElement=12,er(Rs,"StructArrayLayout4ui1f12");class Al extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,u,f)}emplace(t,o,u,f,p){const y=4*t;return this.uint16[y+0]=o,this.uint16[y+1]=u,this.uint16[y+2]=f,this.uint16[y+3]=p,t}}Al.prototype.bytesPerElement=8,er(Al,"StructArrayLayout4ui8");class tl extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,u,f,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,t,o,u,f,p,y)}emplace(t,o,u,f,p,y,b){const T=6*t;return this.int16[T+0]=o,this.int16[T+1]=u,this.int16[T+2]=f,this.int16[T+3]=p,this.int16[T+4]=y,this.int16[T+5]=b,t}}tl.prototype.bytesPerElement=12,er(tl,"StructArrayLayout6i12");class Il extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,u,f,p,y,b,T,A,R,P,L){const z=this.length;return this.resize(z+1),this.emplace(z,t,o,u,f,p,y,b,T,A,R,P,L)}emplace(t,o,u,f,p,y,b,T,A,R,P,L,z){const N=12*t;return this.int16[N+0]=o,this.int16[N+1]=u,this.int16[N+2]=f,this.int16[N+3]=p,this.uint16[N+4]=y,this.uint16[N+5]=b,this.uint16[N+6]=T,this.uint16[N+7]=A,this.int16[N+8]=R,this.int16[N+9]=P,this.int16[N+10]=L,this.int16[N+11]=z,t}}Il.prototype.bytesPerElement=24,er(Il,"StructArrayLayout4i4ui4i24");class Sl extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,u,f,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,t,o,u,f,p,y)}emplace(t,o,u,f,p,y,b){const T=10*t,A=5*t;return this.int16[T+0]=o,this.int16[T+1]=u,this.int16[T+2]=f,this.float32[A+2]=p,this.float32[A+3]=y,this.float32[A+4]=b,t}}Sl.prototype.bytesPerElement=20,er(Sl,"StructArrayLayout3i3f20");class Hc extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint32[1*t+0]=o,t}}Hc.prototype.bytesPerElement=4,er(Hc,"StructArrayLayout1ul4");class Ra extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,o)}emplace(t,o,u){const f=2*t;return this.uint16[f+0]=o,this.uint16[f+1]=u,t}}Ra.prototype.bytesPerElement=4,er(Ra,"StructArrayLayout2ui4");class Kf extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,u,f,p,y,b,T,A,R,P,L,z){const N=this.length;return this.resize(N+1),this.emplace(N,t,o,u,f,p,y,b,T,A,R,P,L,z)}emplace(t,o,u,f,p,y,b,T,A,R,P,L,z,N){const U=20*t,H=10*t;return this.int16[U+0]=o,this.int16[U+1]=u,this.int16[U+2]=f,this.int16[U+3]=p,this.int16[U+4]=y,this.float32[H+3]=b,this.float32[H+4]=T,this.float32[H+5]=A,this.float32[H+6]=R,this.int16[U+14]=P,this.uint32[H+8]=L,this.uint16[U+18]=z,this.uint16[U+19]=N,t}}Kf.prototype.bytesPerElement=40,er(Kf,"StructArrayLayout5i4f1i1ul2ui40");class Qh extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,u,f,p,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,t,o,u,f,p,y,b)}emplace(t,o,u,f,p,y,b,T){const A=8*t;return this.int16[A+0]=o,this.int16[A+1]=u,this.int16[A+2]=f,this.int16[A+4]=p,this.int16[A+5]=y,this.int16[A+6]=b,this.int16[A+7]=T,t}}Qh.prototype.bytesPerElement=16,er(Qh,"StructArrayLayout3i2i2i16");class Jf extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,o,u,f,p)}emplace(t,o,u,f,p,y){const b=4*t,T=8*t;return this.float32[b+0]=o,this.float32[b+1]=u,this.float32[b+2]=f,this.int16[T+6]=p,this.int16[T+7]=y,t}}Jf.prototype.bytesPerElement=16,er(Jf,"StructArrayLayout2f1f2i16");class nc extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,u,f)}emplace(t,o,u,f,p){const y=12*t,b=3*t;return this.uint8[y+0]=o,this.uint8[y+1]=u,this.float32[b+1]=f,this.float32[b+2]=p,t}}nc.prototype.bytesPerElement=12,er(nc,"StructArrayLayout2ub2f12");class ys extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,o,u)}emplace(t,o,u,f){const p=3*t;return this.uint16[p+0]=o,this.uint16[p+1]=u,this.uint16[p+2]=f,t}}ys.prototype.bytesPerElement=6,er(ys,"StructArrayLayout3ui6");class ep extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,o,u,f,p,y,b,T,A,R,P,L,z,N,U,H,W,ie,le,se,we){const he=this.length;return this.resize(he+1),this.emplace(he,t,o,u,f,p,y,b,T,A,R,P,L,z,N,U,H,W,ie,le,se,we)}emplace(t,o,u,f,p,y,b,T,A,R,P,L,z,N,U,H,W,ie,le,se,we,he){const Pe=30*t,Le=15*t,qe=60*t;return this.int16[Pe+0]=o,this.int16[Pe+1]=u,this.int16[Pe+2]=f,this.float32[Le+2]=p,this.float32[Le+3]=y,this.uint16[Pe+8]=b,this.uint16[Pe+9]=T,this.uint32[Le+5]=A,this.uint32[Le+6]=R,this.uint32[Le+7]=P,this.uint16[Pe+16]=L,this.uint16[Pe+17]=z,this.uint16[Pe+18]=N,this.float32[Le+10]=U,this.float32[Le+11]=H,this.uint8[qe+48]=W,this.uint8[qe+49]=ie,this.uint8[qe+50]=le,this.uint32[Le+13]=se,this.int16[Pe+28]=we,this.uint8[qe+58]=he,t}}ep.prototype.bytesPerElement=60,er(ep,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class a5 extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,o,u,f,p,y,b,T,A,R,P,L,z,N,U,H,W,ie,le,se,we,he,Pe,Le,qe,ot,Ye,mt,pt,at,wt,xt){const St=this.length;return this.resize(St+1),this.emplace(St,t,o,u,f,p,y,b,T,A,R,P,L,z,N,U,H,W,ie,le,se,we,he,Pe,Le,qe,ot,Ye,mt,pt,at,wt,xt)}emplace(t,o,u,f,p,y,b,T,A,R,P,L,z,N,U,H,W,ie,le,se,we,he,Pe,Le,qe,ot,Ye,mt,pt,at,wt,xt,St){const Et=20*t,gt=40*t,nr=80*t;return this.float32[Et+0]=o,this.float32[Et+1]=u,this.int16[gt+4]=f,this.int16[gt+5]=p,this.int16[gt+6]=y,this.int16[gt+7]=b,this.int16[gt+8]=T,this.int16[gt+9]=A,this.int16[gt+10]=R,this.int16[gt+11]=P,this.int16[gt+12]=L,this.uint16[gt+13]=z,this.uint16[gt+14]=N,this.uint16[gt+15]=U,this.uint16[gt+16]=H,this.uint16[gt+17]=W,this.uint16[gt+18]=ie,this.uint16[gt+19]=le,this.uint16[gt+20]=se,this.uint16[gt+21]=we,this.uint16[gt+22]=he,this.uint16[gt+23]=Pe,this.uint16[gt+24]=Le,this.uint16[gt+25]=qe,this.uint16[gt+26]=ot,this.uint16[gt+27]=Ye,this.uint32[Et+14]=mt,this.float32[Et+15]=pt,this.float32[Et+16]=at,this.float32[Et+17]=wt,this.float32[Et+18]=xt,this.uint8[nr+76]=St,t}}a5.prototype.bytesPerElement=80,er(a5,"StructArrayLayout2f9i15ui1ul4f1ub80");class Q0 extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.float32[1*t+0]=o,t}}Q0.prototype.bytesPerElement=4,er(Q0,"StructArrayLayout1f4");class tp extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,o,u,f,p)}emplace(t,o,u,f,p,y){const b=5*t;return this.float32[b+0]=o,this.float32[b+1]=u,this.float32[b+2]=f,this.float32[b+3]=p,this.float32[b+4]=y,t}}tp.prototype.bytesPerElement=20,er(tp,"StructArrayLayout5f20");class l5 extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,u,f,p,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,t,o,u,f,p,y,b)}emplace(t,o,u,f,p,y,b,T){const A=7*t;return this.float32[A+0]=o,this.float32[A+1]=u,this.float32[A+2]=f,this.float32[A+3]=p,this.float32[A+4]=y,this.float32[A+5]=b,this.float32[A+6]=T,t}}l5.prototype.bytesPerElement=28,er(l5,"StructArrayLayout7f28");class c5 extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,u,f)}emplace(t,o,u,f,p){const y=6*t;return this.uint32[3*t+0]=o,this.uint16[y+2]=u,this.uint16[y+3]=f,this.uint16[y+4]=p,t}}c5.prototype.bytesPerElement=12,er(c5,"StructArrayLayout1ul3ui12");class u5 extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint16[1*t+0]=o,t}}u5.prototype.bytesPerElement=2,er(u5,"StructArrayLayout1ui2");class rp extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,o,u)}emplace(t,o,u,f){const p=3*t;return this.float32[p+0]=o,this.float32[p+1]=u,this.float32[p+2]=f,t}}rp.prototype.bytesPerElement=12,er(rp,"StructArrayLayout3f12");class h5 extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,u,f,p,y,b,T,A,R,P,L,z,N,U,H){const W=this.length;return this.resize(W+1),this.emplace(W,t,o,u,f,p,y,b,T,A,R,P,L,z,N,U,H)}emplace(t,o,u,f,p,y,b,T,A,R,P,L,z,N,U,H,W){const ie=16*t;return this.float32[ie+0]=o,this.float32[ie+1]=u,this.float32[ie+2]=f,this.float32[ie+3]=p,this.float32[ie+4]=y,this.float32[ie+5]=b,this.float32[ie+6]=T,this.float32[ie+7]=A,this.float32[ie+8]=R,this.float32[ie+9]=P,this.float32[ie+10]=L,this.float32[ie+11]=z,this.float32[ie+12]=N,this.float32[ie+13]=U,this.float32[ie+14]=H,this.float32[ie+15]=W,t}}h5.prototype.bytesPerElement=64,er(h5,"StructArrayLayout16f64");class Cx extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,u,f,p,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,t,o,u,f,p,y,b)}emplace(t,o,u,f,p,y,b,T){const A=10*t,R=5*t;return this.uint16[A+0]=o,this.uint16[A+1]=u,this.uint16[A+2]=f,this.uint16[A+3]=p,this.float32[R+2]=y,this.float32[R+3]=b,this.float32[R+4]=T,t}}Cx.prototype.bytesPerElement=20,er(Cx,"StructArrayLayout4ui3f20");class d5 extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.int16[1*t+0]=o,t}}d5.prototype.bytesPerElement=2,er(d5,"StructArrayLayout1i2");class f5 extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint8[1*t+0]=o,t}}f5.prototype.bytesPerElement=1,er(f5,"StructArrayLayout1ub1");class c6 extends Qi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}c6.prototype.size=40;class u6 extends Kf{get(t){return new c6(this,t)}}er(u6,"CollisionBoxArray");class h6 extends Qi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}h6.prototype.size=60;class d6 extends ep{get(t){return new h6(this,t)}}er(d6,"PlacedSymbolArray");class f6 extends Qi{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}f6.prototype.size=80;class p6 extends a5{get(t){return new f6(this,t)}}er(p6,"SymbolInstanceArray");class m6 extends Q0{getoffsetX(t){return this.float32[1*t+0]}}er(m6,"GlyphOffsetArray");class _6 extends js{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}er(_6,"SymbolLineVertexArray");class g6 extends Qi{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}g6.prototype.size=12;class y6 extends c5{get(t){return new g6(this,t)}}er(y6,"FeatureIndexArray");class v6 extends Ra{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}er(v6,"FillExtrusionCentroidArray");const OU=Gr([{name:"a_pos",components:2,type:"Int16"}],4),zU=Gr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class jn{constructor(t=[]){this.segments=t}_prepareSegment(t,o,u,f){let p=this.segments[this.segments.length-1];return t>jn.MAX_VERTEX_ARRAY_LENGTH&&gn(`Max vertices per segment is ${jn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!p||p.vertexLength+t>jn.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==f)&&(p={vertexOffset:o,primitiveOffset:u,vertexLength:0,primitiveLength:0},f!==void 0&&(p.sortKey=f),this.segments.push(p)),p}prepareSegment(t,o,u,f){return this._prepareSegment(t,o.length,u.length,f)}get(){return this.segments}destroy(){for(const t of this.segments)for(const o in t.vaos)t.vaos[o].destroy()}static simpleSegment(t,o,u,f){return new jn([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:f,vaos:{},sortKey:0}])}}function x6(i,t){return 256*(i=ti(Math.floor(i),0,255))+ti(Math.floor(t),0,255)}jn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,er(jn,"SegmentVector");const FU=Gr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),NU=Gr([{name:"a_dash",components:4,type:"Uint16"}]);class K0{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,o,u,f){this.ids.push(b6(t)),this.positions.push(o,u,f)}eachPosition(t,o){const u=b6(t);let f=0,p=this.ids.length-1;for(;f<p;){const y=f+p>>1;this.ids[y]>=u?p=y:f=y+1}for(;this.ids[f]===u;)o(this.positions[3*f],this.positions[3*f+1],this.positions[3*f+2]),f++}static serialize(t,o){const u=new Float64Array(t.ids),f=new Uint32Array(t.positions);return p5(u,f,0,u.length-1),o&&(o.add(u.buffer),o.add(f.buffer)),{ids:u,positions:f}}static deserialize(t){const o=new K0;let u;o.ids=t.ids,o.positions=t.positions;for(const f of o.ids)f!==u&&o.uniqueIds.push(f),u=f;return o.indexed=!0,o}}function b6(i){const t=+i;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Ef(String(i))}function p5(i,t,o,u){for(;o<u;){const f=i[o+u>>1];let p=o-1,y=u+1;for(;;){do p++;while(i[p]<f);do y--;while(i[y]>f);if(p>=y)break;Rx(i,p,y),Rx(t,3*p,3*y),Rx(t,3*p+1,3*y+1),Rx(t,3*p+2,3*y+2)}y-o<u-y?(p5(i,t,o,y),o=y+1):(p5(i,t,y+1,u),u=y)}}function Rx(i,t,o){const u=i[t];i[t]=i[o],i[o]=u}er(K0,"FeaturePositionMap");class qu{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,o),this.initialized=!0),!!this.location}set(t,o,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Px extends qu{constructor(t){super(t),this.current=0}set(t,o,u){this.fetchUniformLocation(t,o)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class zo extends qu{constructor(t){super(t),this.current=0}set(t,o,u){this.fetchUniformLocation(t,o)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Kh extends qu{constructor(t){super(t),this.current=[0,0]}set(t,o,u){this.fetchUniformLocation(t,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class m5 extends qu{constructor(t){super(t),this.current=[0,0,0]}set(t,o,u){this.fetchUniformLocation(t,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class w6 extends qu{constructor(t){super(t),this.current=[0,0,0,0]}set(t,o,u){this.fetchUniformLocation(t,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class T6 extends qu{constructor(t){super(t),this.current=Bi.transparent}set(t,o,u){this.fetchUniformLocation(t,o)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const BU=new Float32Array(16);class J0 extends qu{constructor(t){super(t),this.current=BU}set(t,o,u){if(this.fetchUniformLocation(t,o)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let f=1;f<16;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const VU=new Float32Array(9),UU=new Float32Array(4);class _5 extends qu{constructor(t){super(t),this.current=UU}set(t,o,u){if(this.fetchUniformLocation(t,o)){for(let f=0;f<4;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function g5(i){return[x6(255*i.r,255*i.g),x6(255*i.b,255*i.a)]}class ey{constructor(t,o,u){this.value=t,this.uniformNames=o.map(f=>`u_${f}`),this.type=u}setUniform(t,o,u,f,p){o.set(t,p,f.constantOr(this.value))}getBinding(t,o){return this.type==="color"?new T6(t):new zo(t)}}class a_{constructor(t,o){this.uniformNames=o.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,o,u,f,p){const y=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;y&&o.set(t,p,y)}getBinding(t,o){return o==="u_pattern"||o==="u_dash"?new w6(t):new zo(t)}}class Hu{constructor(t,o,u,f){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(p=>({name:`a_${p}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,o,u,f,p,y,b){const T=this.paintVertexArray.length,A=this.expression.evaluate(new J(0,{brightness:y}),o,{},p,f,b);this.paintVertexArray.resize(t),this._setPaintValue(T,t,A)}updatePaintArray(t,o,u,f,p,y,b){const T=this.expression.evaluate({zoom:0,brightness:b},u,f,void 0,p);this._setPaintValue(t,o,T)}_setPaintValue(t,o,u){if(this.type==="color"){const f=g5(u);for(let p=t;p<o;p++)this.paintVertexArray.emplace(p,f[0],f[1])}else{for(let f=t;f<o;f++)this.paintVertexArray.emplace(f,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class sc{constructor(t,o,u,f,p,y){this.expression=t,this.uniformNames=o.map(b=>`u_${b}_t`),this.type=u,this.useIntegerZoom=f,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=o.map(b=>({name:`a_${b}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(t,o,u,f,p,y,b){const T=this.expression.evaluate(new J(this.zoom,{brightness:y}),o,{},p,f,b),A=this.expression.evaluate(new J(this.zoom+1,{brightness:y}),o,{},p,f,b),R=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(R,t,T,A)}updatePaintArray(t,o,u,f,p,y,b){const T=this.expression.evaluate({zoom:this.zoom,brightness:b},u,f,void 0,p),A=this.expression.evaluate({zoom:this.zoom+1,brightness:b},u,f,void 0,p);this._setPaintValue(t,o,T,A)}_setPaintValue(t,o,u,f){if(this.type==="color"){const p=g5(u),y=g5(f);for(let b=t;b<o;b++)this.paintVertexArray.emplace(b,p[0],p[1],y[0],y[1])}else{for(let p=t;p<o;p++)this.paintVertexArray.emplace(p,u,f);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(f))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,o,u,f,p){const y=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,b=ti(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);o.set(t,p,b)}getBinding(t,o){return new zo(t)}}class Jh{constructor(t,o,u,f,p){this.expression=t,this.layerId=p,this.paintVertexAttributes=(u==="array"?NU:FU).members;for(let y=0;y<o.length;++y);this.paintVertexArray=new f}populatePaintArray(t,o,u){const f=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(f,t,o.patterns&&o.patterns[this.layerId],u)}updatePaintArray(t,o,u,f,p,y,b){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(t,o,u,f){if(!f||!u)return;const p=f[u];if(!p)return;const{tl:y,br:b,pixelRatio:T}=p;for(let A=t;A<o;A++)this.paintVertexArray.emplace(A,y[0],y[1],b[0],b[1],T)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ip{constructor(t,o,u=()=>!0){this.binders={},this._buffers=[];const f=[];for(const p in t.paint._values){const y=t.paint.get(p);if(!u(p)||!(y instanceof Qe&&r_(y.property.specification)))continue;const b=$U(p,t.type),T=y.value,A=y.property.specification.type,R=!!y.property.useIntegerZoom,P=p==="line-dasharray"||p.endsWith("pattern"),L=p==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(T.kind!=="constant"||L)if(T.kind==="source"||L||P){const z=E6(p,A,"source");this.binders[p]=P?new Jh(T,b,A,z,t.id):new Hu(T,b,A,z),f.push(`/a_${p}`)}else{const z=E6(p,A,"composite");this.binders[p]=new sc(T,b,A,R,o,z),f.push(`/z_${p}`)}else this.binders[p]=P?new a_(T.value,b):new ey(T.value,b,A),f.push(`/u_${p}`)}this.cacheKey=f.sort().join("")}getMaxValue(t){const o=this.binders[t];return o instanceof Hu||o instanceof sc?o.maxValue:0}populatePaintArrays(t,o,u,f,p,y,b){for(const T in this.binders){const A=this.binders[T];(A instanceof Hu||A instanceof sc||A instanceof Jh)&&A.populatePaintArray(t,o,u,f,p,y,b)}}setConstantPatternPositions(t){for(const o in this.binders){const u=this.binders[o];u instanceof a_&&u.setConstantPatternPositions(t)}}updatePaintArrays(t,o,u,f,p,y,b,T){let A=!1;const R=Object.keys(t),P=R.length!==0,L=P?R:o.uniqueIds;for(const z in this.binders){const N=this.binders[z];if((N instanceof Hu||N instanceof sc||N instanceof Jh)&&(N.expression.isStateDependent===!0||N.expression.isLightConstant===!1)){const U=p.paint.get(z);N.expression=U.value;for(const H of L){const W=t[H.toString()];o.eachPosition(H,(ie,le,se)=>{const we=f.feature(ie);N.updatePaintArray(le,se,we,W,y,b,T)})}if(!P)for(const H of u.uniqueIds){const W=t[H.toString()];u.eachPosition(H,(ie,le,se)=>{const we=f.feature(ie);N.updatePaintArray(le,se,we,W,y,b,T)})}A=!0}}return A}defines(){const t=[];for(const o in this.binders){const u=this.binders[o];(u instanceof ey||u instanceof a_)&&t.push(...u.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return t}getBinderAttributes(){const t=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof Hu||u instanceof sc||u instanceof Jh)for(let f=0;f<u.paintVertexAttributes.length;f++)t.push(u.paintVertexAttributes[f].name)}return t}getBinderUniforms(){const t=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof ey||u instanceof a_||u instanceof sc)for(const f of u.uniformNames)t.push(f)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof ey||f instanceof a_||f instanceof sc)for(const p of f.uniformNames)o.push({name:p,property:u,binding:f.getBinding(t,p)})}return o}setUniforms(t,o,u,f,p){for(const{name:y,property:b,binding:T}of u)this.binders[b].setUniform(t,T,p,f.get(b),y)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const o=this.binders[t];(o instanceof Hu||o instanceof sc||o instanceof Jh)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const o in this.binders){const u=this.binders[o];(u instanceof Hu||u instanceof sc||u instanceof Jh)&&u.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const o=this.binders[t];(o instanceof Hu||o instanceof sc||o instanceof Jh)&&o.destroy()}}}class ed{constructor(t,o,u=()=>!0){this.programConfigurations={};for(const f of t)this.programConfigurations[f.id]=new ip(f,o,u);this.needsUpload=!1,this._featureMap=new K0,this._featureMapWithoutIds=new K0,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,o,u,f,p,y,b,T){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(t,o,f,p,y,b,T);o.id!==void 0?this._featureMap.add(o.id,u,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,o,u,f,p,y){for(const b of u)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,o,b,f,p,y||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const jU={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function $U(i,t){return jU[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}const GU={"line-pattern":{source:Rs,composite:Rs},"fill-pattern":{source:Rs,composite:Rs},"fill-extrusion-pattern":{source:Rs,composite:Rs},"line-dasharray":{source:Al,composite:Al}},qU={color:{source:Cs,composite:gs},number:{source:Q0,composite:Cs}};function E6(i,t,o){const u=GU[i];return u&&u[o]||qU[t][o]}er(ey,"ConstantBinder"),er(a_,"PatternConstantBinder"),er(Hu,"SourceExpressionBinder"),er(Jh,"PatternCompositeBinder"),er(sc,"CompositeExpressionBinder"),er(ip,"ProgramConfiguration",{omit:["_buffers"]}),er(ed,"ProgramConfigurationSet");const Fo=Gt/Math.PI/2,y5=5,A6=6,HU=16383,l_=64,v5=[l_,32,16],Cl=-Fo,Rl=Fo;function c_(i,t,o,u=Fo){return o=ui(o),[i*Math.sin(o)*u,-t*u,i*Math.cos(o)*u]}function np(i,t,o){return c_(Math.cos(ui(i)),Math.sin(ui(i)),t,o)}const u_=63710088e-1,x5=2*Math.PI*u_;class Ai{constructor(t,o){if(isNaN(t)||isNaN(o))throw new Error(`Invalid LngLat object: (${t}, ${o})`);if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ai(Ta(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const o=Math.PI/180,u=this.lat*o,f=t.lat*o,p=Math.sin(u)*Math.sin(f)+Math.cos(u)*Math.cos(f)*Math.cos((t.lng-this.lng)*o);return u_*Math.acos(Math.min(p,1))}toBounds(t=0){const o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new td({lng:this.lng-u,lat:this.lat-o},{lng:this.lng+u,lat:this.lat+o})}toEcef(t){return np(this.lat,this.lng,Fo+t*Fo/u_)}static convert(t){if(t instanceof Ai)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ai(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ai(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class td{constructor(t,o){if(t)if(o)this.setSouthWest(t).setNorthEast(o);else if(t.length===4){const u=t;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=t;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(t){return this._ne=t instanceof Ai?new Ai(t.lng,t.lat):Ai.convert(t),this}setSouthWest(t){return this._sw=t instanceof Ai?new Ai(t.lng,t.lat):Ai.convert(t),this}extend(t){const o=this._sw,u=this._ne;let f,p;if(t instanceof Ai)f=t,p=t;else{if(!(t instanceof td))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(td.convert(t)):this.extend(Ai.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(Ai.convert(t)):this;if(f=t._sw,p=t._ne,!f||!p)return this}return o||u?(o.lng=Math.min(f.lng,o.lng),o.lat=Math.min(f.lat,o.lat),u.lng=Math.max(p.lng,u.lng),u.lat=Math.max(p.lat,u.lat)):(this._sw=new Ai(f.lng,f.lat),this._ne=new Ai(p.lng,p.lat)),this}getCenter(){return new Ai((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ai(this.getWest(),this.getNorth())}getSouthEast(){return new Ai(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:o,lat:u}=Ai.convert(t);let f=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&f}static convert(t){return!t||t instanceof td?t:new td(t)}}var I6={};(function(i,t){(function(o){function u(p,y,b){var T=f(256*p,256*(y=Math.pow(2,b)-y-1),b),A=f(256*(p+1),256*(y+1),b);return T[0]+","+T[1]+","+A[0]+","+A[1]}function f(p,y,b){var T=2*Math.PI*6378137/256/Math.pow(2,b);return[p*T-2*Math.PI*6378137/2,y*T-2*Math.PI*6378137/2]}o.getURL=function(p,y,b,T,A,R){return R=R||{},p+"?"+["bbox="+u(b,T,A),"format="+(R.format||"image/png"),"service="+(R.service||"WMS"),"version="+(R.version||"1.1.1"),"request="+(R.request||"GetMap"),"srs="+(R.srs||"EPSG:3857"),"width="+(R.width||256),"height="+(R.height||256),"layers="+y].join("&")},o.getTileBBox=u,o.getMercCoords=f,Object.defineProperty(o,"__esModule",{value:!0})})(t)})(0,I6);var WU=I6;class sp{constructor(t,o,u){this.z=t,this.x=o,this.y=u,this.key=ty(0,t,t,o,u)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,o){const u=WU.getTileBBox(this.x,this.y,this.z),f=function(p,y,b){let T,A="";for(let R=p;R>0;R--)T=1<<R-1,A+=(y&T?1:0)+(b&T?2:0);return A}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class S6{constructor(t,o){this.wrap=t,this.canonical=o,this.key=ty(t,o.z,o.z,o.x,o.y)}}class ro{constructor(t,o,u,f,p){this.overscaledZ=t,this.wrap=o,this.canonical=new sp(u,+f,+p),this.key=o===0&&t===u?this.canonical.key:ty(o,t,u,f,p)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const o=this.canonical.z-t;return t>this.canonical.z?new ro(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ro(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(t,o=!0){if(this.overscaledZ===t&&o)return this.key;if(t>this.canonical.z)return ty(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-t;return ty(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o}children(t){if(this.overscaledZ>=t)return[new ro(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,u=2*this.canonical.x,f=2*this.canonical.y;return[new ro(o,this.wrap,o,u,f),new ro(o,this.wrap,o,u+1,f),new ro(o,this.wrap,o,u,f+1),new ro(o,this.wrap,o,u+1,f+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new ro(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new ro(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new S6(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ty(i,t,o,u,f){const p=1<<Math.min(o,22);let y=p*(f%p)+u%p;return i&&o<22&&(y+=p*p*((i<0?-2*i-1:2*i)%(1<<2*(22-o)))),16*(32*y+o)+(t-o)}const ZU=[i=>{let t=i.canonical.x-1,o=i.wrap;return t<0&&(t=(1<<i.canonical.z)-1,o--),new ro(i.overscaledZ,o,i.canonical.z,t,i.canonical.y)},i=>{let t=i.canonical.x+1,o=i.wrap;return t===1<<i.canonical.z&&(t=0,o++),new ro(i.overscaledZ,o,i.canonical.z,t,i.canonical.y)},i=>new ro(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,(i.canonical.y===0?1<<i.canonical.z:i.canonical.y)-1),i=>new ro(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y===(1<<i.canonical.z)-1?0:i.canonical.y+1)];er(sp,"CanonicalTileID"),er(ro,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const XU=0,YU=25.5;function b5(i){return x5*Math.cos(i*Math.PI/180)}function rd(i){return(180+i)/360}function Wu(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function No(i,t){return i/b5(t)}function Pa(i){return 360*i-180}function Gs(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function C6(i,t){return i*b5(Gs(t))}const $n=85.051129;function R6(i){return Math.cos(ui(ti(i,-$n,$n)))}function op(i,t){const o=ti(t,XU,YU),u=Math.pow(2,o);return R6(i)*x5/(512*u)}function P6(i){return 1/Math.cos(i*Math.PI/180)}function Mx(i,t=0){const o=Math.exp(Math.PI*(1-(i.y+t/Gt)/(1<<i.z)*2));return 80150034*o/(o*o+1)/Gt/(1<<i.z)}class io{constructor(t,o,u=0){this.x=+t,this.y=+o,this.z=+u}static fromLngLat(t,o=0){const u=Ai.convert(t);return new io(rd(u.lng),Wu(u.lat),No(o,u.lat))}toLngLat(){return new Ai(Pa(this.x),Gs(this.y))}toAltitude(){return C6(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/x5*P6(Gs(this.y))}}function w5(i,t,o,u,f,p,y,b,T){const A=(t+u)/2,R=(o+f)/2,P=new Ut(A,R);b(P),function(L,z,N,U,H,W){const ie=N-H,le=U-W;return Math.abs((U-z)*ie-(N-L)*le)/Math.hypot(ie,le)}(P.x,P.y,p.x,p.y,y.x,y.y)>=T?(w5(i,t,o,A,R,p,P,b,T),w5(i,A,R,u,f,P,y,b,T)):i.push(y)}function M6(i,t,o){let u=i[0],f=u.x,p=u.y;t(u);const y=[u];for(let b=1;b<i.length;b++){const T=i[b],{x:A,y:R}=T;t(T),w5(y,f,p,A,R,u,T,t,o),f=A,p=R,u=T}return y}function T5(i,t,o,u){if(u(t,o)){const f=t.add(o)._mult(.5);T5(i,t,f,u),T5(i,f,o,u)}else i.push(o)}function QU(i,t){let o=i[0];const u=[o];for(let f=1;f<i.length;f++){const p=i[f];T5(u,o,p,t),o=p}return u}const E5=Math.pow(2,14)-1,k6=-E5-1;function KU(i,t){const o=Math.round(i.x*t),u=Math.round(i.y*t);return i.x=ti(o,k6,E5),i.y=ti(u,k6,E5),(o<i.x||o>i.x+1||u<i.y||u>i.y+1)&&gn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function Zu(i,t,o){const u=i.loadGeometry(),f=i.extent,p=Gt/f;if(t&&o&&o.projection.isReprojectedInTileSpace){const y=1<<t.z,{scale:b,x:T,y:A,projection:R}=o,P=L=>{const z=Pa((t.x+L.x/f)/y),N=Gs((t.y+L.y/f)/y),U=R.project(z,N);L.x=(U.x*b-T)*f,L.y=(U.y*b-A)*f};for(let L=0;L<u.length;L++)if(i.type!==1)u[L]=M6(u[L],P,1);else{const z=[];for(const N of u[L])N.x<0||N.x>=f||N.y<0||N.y>=f||(P(N),z.push(N));u[L]=z}}for(const y of u)for(const b of y)KU(b,p);return u}function id(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Zu(i):[]}}function kx(i,t,o,u,f){i.emplaceBack(2*t+(u+1)/2,2*o+(f+1)/2)}function Dx(i,t,o){i.emplaceBack(t.x,t.y,t.z,o[0]*16384,o[1]*16384,o[2]*16384)}class A5{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new js,this.indexArray=new ys,this.segments=new jn,this.programConfigurations=new ed(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,u,f){const p=this.layers[0],y=[];let b=null;p.type==="circle"&&(b=p.layout.get("circle-sort-key"));for(const{feature:A,id:R,index:P,sourceLayerIndex:L}of t){const z=this.layers[0]._featureFilter.needGeometry,N=id(A,z);if(!this.layers[0]._featureFilter.filter(new J(this.zoom),N,u))continue;const U=b?b.evaluate(N,{},u):void 0,H={id:R,properties:A.properties,type:A.type,sourceLayerIndex:L,index:P,geometry:z?N.geometry:Zu(A,u,f),patterns:{},sortKey:U};y.push(H)}b&&y.sort((A,R)=>A.sortKey-R.sortKey);let T=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new tl,T=f.projection);for(const A of y){const{geometry:R,index:P,sourceLayerIndex:L}=A,z=t[P].feature;this.addFeature(A,R,P,o.availableImages,u,T,o.brightness),o.featureIndex.insert(z,R,P,L,this.index)}}update(t,o,u,f,p){const y=Object.keys(t).length!==0;y&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,o,y?this.stateDependentLayers:this.layers,u,f,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,OU.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,zU.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,o,u,f,p,y,b){for(const T of o)for(const A of T){const R=A.x,P=A.y;if(R<0||R>=Gt||P<0||P>=Gt)continue;if(y){const N=y.projectTilePoint(R,P,p),U=y.upVector(p,R,P),H=this.globeExtVertexArray;Dx(H,N,U),Dx(H,N,U),Dx(H,N,U),Dx(H,N,U)}const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),z=L.vertexLength;kx(this.layoutVertexArray,R,P,-1,-1),kx(this.layoutVertexArray,R,P,1,-1),kx(this.layoutVertexArray,R,P,1,1),kx(this.layoutVertexArray,R,P,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+2,z+3),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},f,p,b)}}function I5(i,t){for(let o=0;o<i.length;o++)if(ap(t,i[o]))return!0;for(let o=0;o<t.length;o++)if(ap(i,t[o]))return!0;return!!S5(i,t)}function JU(i,t,o){return!!ap(i,t)||!!C5(t,i,o)}function D6(i,t){if(i.length===1)return O6(t,i[0]);for(let o=0;o<t.length;o++){const u=t[o];for(let f=0;f<u.length;f++)if(ap(i,u[f]))return!0}for(let o=0;o<i.length;o++)if(O6(t,i[o]))return!0;for(let o=0;o<t.length;o++)if(S5(i,t[o]))return!0;return!1}function e7(i,t,o){if(i.length>1){if(S5(i,t))return!0;for(let u=0;u<t.length;u++)if(C5(t[u],i,o))return!0}for(let u=0;u<i.length;u++)if(C5(i[u],t,o))return!0;return!1}function S5(i,t){if(i.length===0||t.length===0)return!1;for(let o=0;o<i.length-1;o++){const u=i[o],f=i[o+1];for(let p=0;p<t.length-1;p++)if(t7(u,f,t[p],t[p+1]))return!0}return!1}function t7(i,t,o,u){return Aa(i,o,u)!==Aa(t,o,u)&&Aa(i,t,o)!==Aa(i,t,u)}function C5(i,t,o){const u=o*o;if(t.length===1)return i.distSqr(t[0])<u;for(let f=1;f<t.length;f++)if(L6(i,t[f-1],t[f])<u)return!0;return!1}function L6(i,t,o){const u=t.distSqr(o);if(u===0)return i.distSqr(t);const f=((i.x-t.x)*(o.x-t.x)+(i.y-t.y)*(o.y-t.y))/u;return i.distSqr(f<0?t:f>1?o:o.sub(t)._mult(f)._add(t))}function O6(i,t){let o,u,f,p=!1;for(let y=0;y<i.length;y++){o=i[y];for(let b=0,T=o.length-1;b<o.length;T=b++)u=o[b],f=o[T],u.y>t.y!=f.y>t.y&&t.x<(f.x-u.x)*(t.y-u.y)/(f.y-u.y)+u.x&&(p=!p)}return p}function ap(i,t){let o=!1;for(let u=0,f=i.length-1;u<i.length;f=u++){const p=i[u],y=i[f];p.y>t.y!=y.y>t.y&&t.x<(y.x-p.x)*(t.y-p.y)/(y.y-p.y)+p.x&&(o=!o)}return o}function z6(i,t,o,u,f){for(const y of i)if(t<=y.x&&o<=y.y&&u>=y.x&&f>=y.y)return!0;const p=[new Ut(t,o),new Ut(t,f),new Ut(u,f),new Ut(u,o)];if(i.length>2){for(const y of p)if(ap(i,y))return!0}for(let y=0;y<i.length-1;y++)if(r7(i[y],i[y+1],p))return!0;return!1}function r7(i,t,o){const u=o[0],f=o[2];if(i.x<u.x&&t.x<u.x||i.x>f.x&&t.x>f.x||i.y<u.y&&t.y<u.y||i.y>f.y&&t.y>f.y)return!1;const p=Aa(i,t,o[0]);return p!==Aa(i,t,o[1])||p!==Aa(i,t,o[2])||p!==Aa(i,t,o[3])}function h_(i,t,o,u,f,p){let y=t.y-i.y,b=i.x-t.x;if(p=p||0){const T=y*y+b*b;if(T===0)return!0;const A=Math.sqrt(T);y/=A,b/=A}return!((o.x-i.x)*y+(o.y-i.y)*b-p<0||(u.x-i.x)*y+(u.y-i.y)*b-p<0||(f.x-i.x)*y+(f.y-i.y)*b-p<0)}function R5(i,t,o,u,f,p,y){return!(h_(i,t,u,f,p,y)||h_(t,o,u,f,p,y)||h_(o,i,u,f,p,y)||h_(u,f,i,t,o,y)||h_(f,p,i,t,o,y)||h_(p,u,i,t,o,y))}function d_(i,t,o){const u=t.paint.get(i).value;return u.kind==="constant"?u.value:o.programConfigurations.get(t.id).getMaxValue(i)}function Lx(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function F6(i,t,o,u,f){if(!t[0]&&!t[1])return i;const p=Ut.convert(t)._mult(f);o==="viewport"&&p._rotate(-u);const y=[];for(let b=0;b<i.length;b++)y.push(i[b].sub(p));return y}function N6(i,t,o,u){const f=Ut.convert(i)._mult(u);return t==="viewport"&&f._rotate(-o),f}er(A5,"CircleBucket",{omit:["layers"]});const i7=new Ue({"circle-sort-key":new He(me.layout_circle["circle-sort-key"]),visibility:new Oe(me.layout_circle.visibility)});var n7={paint:new Ue({"circle-radius":new He(me.paint_circle["circle-radius"]),"circle-color":new He(me.paint_circle["circle-color"]),"circle-blur":new He(me.paint_circle["circle-blur"]),"circle-opacity":new He(me.paint_circle["circle-opacity"]),"circle-translate":new Oe(me.paint_circle["circle-translate"]),"circle-translate-anchor":new Oe(me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Oe(me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Oe(me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new He(me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new He(me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new He(me.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Oe(me.paint_circle["circle-emissive-strength"])}),layout:i7};class P5{constructor(t,o){this.pos=t,this.dir=o}intersectsPlane(t,o,u){const f=l.Q.dot(o,this.dir);if(Math.abs(f)<1e-6)return!1;const p=((t[0]-this.pos[0])*o[0]+(t[1]-this.pos[1])*o[1]+(t[2]-this.pos[2])*o[2])/f;return u[0]=this.pos[0]+this.dir[0]*p,u[1]=this.pos[1]+this.dir[1]*p,u[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(t,o,u){if(l.Q.equals(this.pos,t)||o===0)return u[0]=u[1]=u[2]=0,!1;const[f,p,y]=this.dir,b=this.pos[0]-t[0],T=this.pos[1]-t[1],A=this.pos[2]-t[2],R=f*f+p*p+y*y,P=2*(b*f+T*p+A*y),L=P*P-4*R*(b*b+T*T+A*A-o*o);if(L<0){const z=Math.max(-P/2,0),N=b+f*z,U=T+p*z,H=A+y*z,W=Math.hypot(N,U,H);return u[0]=N*o/W,u[1]=U*o/W,u[2]=H*o/W,!1}{const z=(-P-Math.sqrt(L))/(2*R);if(z<0){const N=Math.hypot(b,T,A);return u[0]=b*o/N,u[1]=T*o/N,u[2]=A*o/N,!1}return u[0]=b+f*z,u[1]=T+p*z,u[2]=A+y*z,!0}}}class M5{constructor(t,o,u,f,p){this.TL=t,this.TR=o,this.BR=u,this.BL=f,this.horizon=p}static fromInvProjectionMatrix(t,o,u){const f=[-1,1,1],p=[1,1,1],y=[1,-1,1],b=[-1,-1,1],T=l.Q.transformMat4(f,f,t),A=l.Q.transformMat4(p,p,t),R=l.Q.transformMat4(y,y,t),P=l.Q.transformMat4(b,b,t);return new M5(T,A,R,P,o/u)}}function ry(i,t,o){let u=1/0,f=-1/0;const p=[];for(const y of i){l.Q.sub(p,y,t);const b=l.Q.dot(p,o);u=Math.min(u,b),f=Math.max(f,b)}return[u,f]}function B6(i,t){let o=!0;for(let u=0;u<i.planes.length;u++){const f=i.planes[u];let p=0;for(let y=0;y<t.length;y++)p+=l.Q.dot(f,t[y])+f[3]>=0;if(p===0)return 0;p!==t.length&&(o=!1)}return o?2:1}function V6(i,t){for(const o of i.projections){const u=ry(t,i.points[0],o.axis);if(o.projection[1]<u[0]||o.projection[0]>u[1])return 0}return 1}function U6(i,t){let o=0;const u=[0,0,0,0];for(let f=0;f<i.length;f++)u[0]=i[f][0],u[1]=i[f][1],u[2]=i[f][2],u[3]=1,l.aa.dot(u,t)>=0&&o++;return o}class k5{constructor(t,o){this.points=t||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=vn.fromPoints(this.points),this.projections=[],this.frustumEdges=[l.Q.sub([],this.points[2],this.points[3]),l.Q.sub([],this.points[0],this.points[3]),l.Q.sub([],this.points[4],this.points[0]),l.Q.sub([],this.points[5],this.points[1]),l.Q.sub([],this.points[6],this.points[2]),l.Q.sub([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const f=[0,-u[2],u[1]],p=[u[2],0,-u[0]];this.projections.push({axis:f,projection:ry(this.points,this.points[0],f)}),this.projections.push({axis:p,projection:ry(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(t,o,u,f){const p=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const R=l.aa.transformMat4([],A,t),P=1/R[3]/o*p;return l.aa.mul(R,R,[P,P,f?1/R[3]:P,P])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const R=l.Q.sub([],y[A[0]],y[A[1]]),P=l.Q.sub([],y[A[2]],y[A[1]]),L=l.Q.normalize([],l.Q.cross([],R,P)),z=-l.Q.dot(L,y[A[1]]);return L.concat(z)}),T=[];for(let A=0;A<y.length;A++)T.push([y[A][0],y[A][1],y[A][2]]);return new k5(T,b)}intersectsPrecise(t,o,u){for(let f=0;f<o.length;f++)if(!U6(t,o[f]))return 0;for(let f=0;f<this.planes.length;f++)if(!U6(t,this.planes[f]))return 0;for(const f of u)for(const p of this.frustumEdges){const y=l.Q.cross([],f,p),b=l.Q.length(y);if(b===0)continue;l.Q.scale(y,y,1/b);const T=ry(this.points,this.points[0],y),A=ry(t,this.points[0],y);if(T[0]>A[1]||A[0]>T[1])return 0}return 1}}class vn{static fromPoints(t){const o=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const f of t)l.Q.min(o,o,f),l.Q.max(u,u,f);return new vn(o,u)}static fromTileIdAndHeight(t,o,u){const f=1<<t.canonical.z,p=t.canonical.x,y=t.canonical.y;return new vn([p/f,y/f,o],[(p+1)/f,(y+1)/f,u])}static applyTransform(t,o){const u=t.getCorners();for(let f=0;f<u.length;++f)l.Q.transformMat4(u[f],u[f],o);return vn.fromPoints(u)}static projectAabbCorners(t,o){const u=t.getCorners();for(let f=0;f<u.length;++f)l.Q.transformMat4(u[f],u[f],o);return u}constructor(t,o){this.min=t,this.max=o,this.center=l.Q.scale([],l.Q.add([],this.min,this.max),.5)}quadrant(t){const o=[t%2==0,t<2],u=l.Q.clone(this.min),f=l.Q.clone(this.max);for(let p=0;p<o.length;p++)u[p]=o[p]?this.min[p]:this.center[p],f[p]=o[p]?this.center[p]:this.max[p];return f[2]=this.max[2],new vn(u,f)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,o=this.max;return[[t[0],t[1],t[2]],[o[0],t[1],t[2]],[o[0],o[1],t[2]],[t[0],o[1],t[2]],[t[0],t[1],o[2]],[o[0],t[1],o[2]],[o[0],o[1],o[2]],[t[0],o[1],o[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?B6(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?B6(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,o){return o||this.intersects(t)?V6(t,this.getCorners()):0}intersectsPreciseFlat(t,o){return o||this.intersectsFlat(t)?V6(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let o=0;o<3;++o)if(this.min[o]>t.max[o]||t.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],t.min[o]),this.max[o]=Math.max(this.max[o],t.max[o])}encapsulatePoint(t){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],t[o]),this.max[o]=Math.max(this.max[o],t[o])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}er(vn,"Aabb");const s7=Gr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ox}=s7,o7=Gr([{name:"a_pos_3",components:3,type:"Int16"}]);var j6=Gr([{name:"a_pos",type:"Int16",components:2}]);function zx(i){return i*Fo/u_}const a7=[new vn([Cl,Cl,Cl],[Rl,Rl,Rl]),new vn([Cl,Cl,Cl],[0,0,Rl]),new vn([0,Cl,Cl],[Rl,0,Rl]),new vn([Cl,0,Cl],[0,Rl,Rl]),new vn([0,0,Cl],[Rl,Rl,Rl])];function $6(i,t,o,u=!0){const f=l.Q.scale([],i._camera.position,i.worldSize),p=[t,o,1,1];l.aa.transformMat4(p,p,i.pixelMatrixInverse),l.aa.scale(p,p,1/p[3]);const y=l.Q.sub([],p,f),b=l.Q.normalize([],y),T=i.globeMatrix,A=[T[12],T[13],T[14]],R=l.Q.sub([],A,f),P=l.Q.length(R),L=l.Q.normalize([],R),z=i.worldSize/(2*Math.PI),N=l.Q.dot(L,b),U=Math.asin(z/P);if(U<Math.acos(N)){if(!u)return null;const Ye=[],mt=[];l.Q.scale(Ye,b,P/N),l.Q.normalize(mt,l.Q.sub(mt,Ye,R)),l.Q.normalize(b,l.Q.add(b,R,l.Q.scale(b,mt,Math.tan(U)*P)))}const H=[];new P5(f,b).closestPointOnSphere(A,z,H);const W=l.Q.normalize([],vl(T,0)),ie=l.Q.normalize([],vl(T,1)),le=l.Q.normalize([],vl(T,2)),se=l.Q.dot(W,H),we=l.Q.dot(ie,H),he=l.Q.dot(le,H),Pe=Ui(Math.asin(-we/z));let Le=Ui(Math.atan2(se,he));Le=i.center.lng+function(Ye,mt){const pt=(mt-Ye+180)%360-180;return pt<-180?pt+360:pt}(i.center.lng,Le);const qe=rd(Le),ot=ti(Wu(Pe),0,1);return new io(qe,ot)}class l7{constructor(t,o,u){this.a=l.Q.sub([],t,u),this.b=l.Q.sub([],o,u),this.center=u;const f=l.Q.normalize([],this.a),p=l.Q.normalize([],this.b);this.angle=Math.acos(l.Q.dot(f,p))}}function D5(i,t){if(i.angle===0)return null;let o;return o=i.a[t]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[t]/i.a[t]/Math.sin(i.angle)-1/Math.tan(i.angle)),o<0||o>1?null:function(u,f,p,y){const b=Math.sin(p);return u*(Math.sin((1-y)*p)/b)+f*(Math.sin(y*p)/b)}(i.a[t],i.b[t],i.angle,ti(o,0,1))+i.center[t]}function Wc(i){if(i.z<=1)return a7[i.z+2*i.y+i.x];const t=L5(Fx(i));return vn.fromPoints(t)}function Xu(i,t,o){return l.Q.scale(i,i,1-o),l.Q.scaleAndAdd(i,i,t,o)}function G6(i,t,o){for(const u of i)l.Q.transformMat4(u,u,t),l.Q.scale(u,u,o)}function q6(i,t,o,u){const f=t/i.worldSize,p=i.globeMatrix;if(o.z<=1){const qe=Wc(o).getCorners();return G6(qe,p,f),vn.fromPoints(qe)}const y=Fx(o,u),b=L5(y,Fo+zx(i._tileCoverLift));G6(b,p,f);const T=Number.MAX_VALUE,A=[-T,-T,-T],R=[T,T,T];if(y.contains(i.center)){for(const Ye of b)l.Q.min(R,R,Ye),l.Q.max(A,A,Ye);A[2]=0;const qe=i.point,ot=[qe.x*f,qe.y*f,0];return l.Q.min(R,R,ot),l.Q.max(A,A,ot),new vn(R,A)}if(i._tileCoverLift>0){for(const qe of b)l.Q.min(R,R,qe),l.Q.max(A,A,qe);return new vn(R,A)}const P=[p[12]*f,p[13]*f,p[14]*f],L=y.getCenter(),z=ti(i.center.lat,-$n,$n),N=ti(L.lat,-$n,$n),U=rd(i.center.lng),H=Wu(z);let W=U-rd(L.lng);const ie=H-Wu(N);W>.5?W-=1:W<-.5&&(W+=1);let le=0;if(Math.abs(W)>Math.abs(ie))le=W>=0?1:3;else{le=ie>=0?0:2;const qe=[p[4]*f,p[5]*f,p[6]*f],ot=-Math.sin(ui(ie>=0?y.getSouth():y.getNorth()))*Fo;l.Q.scaleAndAdd(P,P,qe,ot)}const se=b[le],we=b[(le+1)%4],he=new l7(se,we,P),Pe=[D5(he,0)||se[0],D5(he,1)||se[1],D5(he,2)||se[2]],Le=nd(i.zoom);if(Le>0){const qe=function({x:Ye,y:mt,z:pt},at,wt,xt,St){const Et=1/(1<<pt);let gt=Ye*Et,nr=gt+Et,Qt=mt*Et,kt=Qt+Et,xr=0;const dr=(gt+nr)/2-xt;return dr>.5?xr=-1:dr<-.5&&(xr=1),gt=((gt+xr)*at-(xt*=at))*wt+xt,nr=((nr+xr)*at-xt)*wt+xt,Qt=(Qt*at-(St*=at))*wt+St,kt=(kt*at-St)*wt+St,[[gt,kt,0],[nr,kt,0],[nr,Qt,0],[gt,Qt,0]]}(o,t,i._pixelsPerMercatorPixel,U,H);for(let Ye=0;Ye<b.length;Ye++)Xu(b[Ye],qe[Ye],Le);const ot=l.Q.add([],qe[le],qe[(le+1)%4]);l.Q.scale(ot,ot,.5),Xu(Pe,ot,Le)}for(const qe of b)l.Q.min(R,R,qe),l.Q.max(A,A,qe);return R[2]=Math.min(se[2],we[2]),l.Q.min(R,R,Pe),l.Q.max(A,A,Pe),new vn(R,A)}function Fx({x:i,y:t,z:o},u=!1){const f=1/(1<<o),p=new Ai(Pa(i*f),t===(1<<o)-1&&u?-90:Gs((t+1)*f)),y=new Ai(Pa((i+1)*f),t===0&&u?90:Gs(t*f));return new td(p,y)}function L5(i,t=Fo){const o=ui(i.getNorth()),u=ui(i.getSouth()),f=Math.cos(o),p=Math.cos(u),y=Math.sin(o),b=Math.sin(u),T=i.getWest(),A=i.getEast();return[c_(p,b,T,t),c_(p,b,A,t),c_(f,y,A,t),c_(f,y,T,t)]}function iy(i,t,o,u){const f=1<<o.z,p=(i/Gt+o.x)/f;return np(Gs((t/Gt+o.y)/f),Pa(p),u)}function Nx({min:i,max:t}){return HU/Math.max(t[0]-i[0],t[1]-i[1],t[2]-i[2])}const H6=new Float64Array(16);function Bx(i){const t=Nx(i),o=l.a9.fromScaling(H6,[t,t,t]);return l.a9.translate(o,o,l.Q.negate([],i.min))}function O5(i){const t=l.a9.fromTranslation(H6,i.min),o=1/Nx(i);return l.a9.scale(t,t,[o,o,o])}function z5(i){const t=Gt/(2*Math.PI);return i/(2*Math.PI)/t}function W6(i,t){return Gt/(512*Math.pow(2,i))*Nx(Wc(t))}function Z6(i,t,o,u,f){const p=z5(o),y=[i,t,-o/(2*Math.PI)],b=l.a9.identity(new Float64Array(16));return l.a9.translate(b,b,y),l.a9.scale(b,b,[p,p,p]),l.a9.rotateX(b,b,ui(-f)),l.a9.rotateY(b,b,ui(-u)),b}function nd(i){return yl(y5,A6,i)}function X6(i,t){const o=np(t.lat,t.lng),u=function(p){const y=np(p._center.lat,p._center.lng),b=l.Q.fromValues(0,1,0);let T=l.Q.cross([],b,y);const A=l.a9.fromRotation([],-p.angle,y);T=l.Q.transformMat4(T,T,A),l.a9.fromRotation(A,-p._pitch,T);const R=l.Q.normalize([],y);return l.Q.scale(R,R,zx(p.cameraToCenterDistance/p.pixelsPerMeter)),l.Q.transformMat4(R,R,A),l.Q.add([],y,R)}(i),f=l.Q.subtract([],u,o);return l.Q.angle(f,o)}function F5(i,t){return X6(i,t)>Math.PI/2*1.01}const Y6=ui(85),c7=Math.cos(Y6),u7=Math.sin(Y6),h7=l.a9.create(),Q6=i=>{const t=[];return i.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),i.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function K6(i,t,o,u,f,p,y,b,T){if(p&&i.queryGeometry.isAboveHorizon)return!1;p&&(T*=i.pixelToTileUnitsFactor);const A=i.tileID.canonical,R=o.projection.upVectorScale(A,o.center.lat,o.worldSize).metersToTile;for(const P of t)for(const L of P){const z=L.add(b),N=f&&o.elevation?o.elevation.exaggeration()*f.getElevationAt(z.x,z.y,!0):0,U=o.projection.projectTilePoint(z.x,z.y,A);if(N>0){const le=o.projection.upVector(A,z.x,z.y);U.x+=le[0]*R*N,U.y+=le[1]*R*N,U.z+=le[2]*R*N}const H=p?z:d7(U.x,U.y,U.z,u),W=p?i.tilespaceRays.map(le=>p7(le,N)):i.queryGeometry.screenGeometry,ie=l.aa.transformMat4([],[U.x,U.y,U.z,1],u);if(!y&&p?T*=ie[3]/o.cameraToCenterDistance:y&&!p&&(T*=o.cameraToCenterDistance/ie[3]),p){const le=Gs((L.y/Gt+A.y)/(1<<A.z));T/=o.projection.pixelsPerMeter(le,1)/No(1,le)}if(JU(W,H,T))return!0}return!1}function d7(i,t,o,u){const f=l.aa.transformMat4([],[i,t,o,1],u);return new Ut(f[0]/f[3],f[1]/f[3])}const J6=l.Q.fromValues(0,0,0),f7=l.Q.fromValues(0,0,1);function p7(i,t){const o=l.Q.create();return J6[2]=t,i.intersectsPlane(J6,f7,o),new Ut(o[0],o[1])}class eP extends A5{}function tP(i,{width:t,height:o},u,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==t*o*u)throw new RangeError("mismatched image size")}else f=new Uint8Array(t*o*u);return i.width=t,i.height=o,i.data=f,i}function rP(i,t,o){const{width:u,height:f}=t;u===i.width&&f===i.height||(N5(i,t,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,u),height:Math.min(i.height,f)},o),i.width=u,i.height=f,i.data=t.data)}function N5(i,t,o,u,f,p,y){if(f.width===0||f.height===0)return t;if(f.width>i.width||f.height>i.height||o.x>i.width-f.width||o.y>i.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>t.width||f.height>t.height||u.x>t.width-f.width||u.y>t.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const b=i.data,T=t.data,A=p===4&&y;for(let R=0;R<f.height;R++){const P=((o.y+R)*i.width+o.x)*p,L=((u.y+R)*t.width+u.x)*p;if(A)for(let z=0;z<f.width;z++){const N=P+z*p+3,U=L+z*p;T[U+0]=255,T[U+1]=255,T[U+2]=255,T[U+3]=b[N]}else for(let z=0;z<f.width*p;z++)T[L+z]=b[P+z]}return t}er(eP,"HeatmapBucket",{omit:["layers"]});class sd{constructor(t,o){tP(this,t,1,o)}resize(t){rP(this,new sd(t),1)}clone(){return new sd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,o,u,f,p){N5(t,o,u,f,p,1)}}class rl{constructor(t,o){tP(this,t,4,o)}resize(t){rP(this,new rl(t),4)}replace(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new rl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,o,u,f,p,y){N5(t,o,u,f,p,4,y)}}class iP{constructor(t,o){this.width=t.width,this.height=t.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}er(sd,"AlphaImage"),er(rl,"RGBAImage");const m7=new Ue({visibility:new Oe(me.layout_heatmap.visibility)});var _7={paint:new Ue({"heatmap-radius":new He(me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new He(me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Oe(me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Tt(me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Oe(me.paint_heatmap["heatmap-opacity"])}),layout:m7};function ny(i){const t={},o=i.resolution||256,u=i.clips?i.clips.length:1,f=i.image||new rl({width:o,height:u}),p=(y,b,T)=>{t[i.evaluationKey]=T;const A=i.expression.evaluate(t);A&&(f.data[y+b+0]=Math.floor(255*A.r/A.a),f.data[y+b+1]=Math.floor(255*A.g/A.a),f.data[y+b+2]=Math.floor(255*A.b/A.a),f.data[y+b+3]=Math.floor(255*A.a))};if(i.clips)for(let y=0,b=0;y<u;++y,b+=4*o)for(let T=0,A=0;T<o;T++,A+=4){const R=T/(o-1),{start:P,end:L}=i.clips[y];p(b,A,P*(1-R)+L*R)}else for(let y=0,b=0;y<o;y++,b+=4)p(0,b,y/(o-1));return f}const g7=new Ue({visibility:new Oe(me.layout_hillshade.visibility)});var y7={paint:new Ue({"hillshade-illumination-direction":new Oe(me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Oe(me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Oe(me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Oe(me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Oe(me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Oe(me.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Oe(me.paint_hillshade["hillshade-emissive-strength"])}),layout:g7};const v7=Gr([{name:"a_pos",components:2,type:"Int16"}],4),{members:x7}=v7;var B5={exports:{}};function Vx(i,t,o){o=o||2;var u,f,p,y,b,T,A,R=t&&t.length,P=R?t[0]*o:i.length,L=nP(i,0,P,o,!0),z=[];if(!L||L.next===L.prev)return z;if(R&&(L=function(U,H,W,ie){var le,se,we,he=[];for(le=0,se=H.length;le<se;le++)(we=nP(U,H[le]*ie,le<se-1?H[le+1]*ie:U.length,ie,!1))===we.next&&(we.steiner=!0),he.push(C7(we));for(he.sort(A7),le=0;le<he.length;le++)W=I7(he[le],W);return W}(i,t,L,o)),i.length>80*o){u=p=i[0],f=y=i[1];for(var N=o;N<P;N+=o)(b=i[N])<u&&(u=b),(T=i[N+1])<f&&(f=T),b>p&&(p=b),T>y&&(y=T);A=(A=Math.max(p-u,y-f))!==0?32767/A:0}return sy(L,z,o,u,f,A,0),z}function nP(i,t,o,u,f){var p,y;if(f===j5(i,t,o,u)>0)for(p=t;p<o;p+=u)y=aP(p,i[p],i[p+1],y);else for(p=o-u;p>=t;p-=u)y=aP(p,i[p],i[p+1],y);return y&&Ux(y,y.next)&&(ay(y),y=y.next),y}function lp(i,t){if(!i)return i;t||(t=i);var o,u=i;do if(o=!1,u.steiner||!Ux(u,u.next)&&ss(u.prev,u,u.next)!==0)u=u.next;else{if(ay(u),(u=t=u.prev)===u.next)break;o=!0}while(o||u!==t);return t}function sy(i,t,o,u,f,p,y){if(i){!y&&p&&function(R,P,L,z){var N=R;do N.z===0&&(N.z=V5(N.x,N.y,P,L,z)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==R);N.prevZ.nextZ=null,N.prevZ=null,function(U){var H,W,ie,le,se,we,he,Pe,Le=1;do{for(W=U,U=null,se=null,we=0;W;){for(we++,ie=W,he=0,H=0;H<Le&&(he++,ie=ie.nextZ);H++);for(Pe=Le;he>0||Pe>0&&ie;)he!==0&&(Pe===0||!ie||W.z<=ie.z)?(le=W,W=W.nextZ,he--):(le=ie,ie=ie.nextZ,Pe--),se?se.nextZ=le:U=le,le.prevZ=se,se=le;W=ie}se.nextZ=null,Le*=2}while(we>1)}(N)}(i,u,f,p);for(var b,T,A=i;i.prev!==i.next;)if(b=i.prev,T=i.next,p?w7(i,u,f,p):b7(i))t.push(b.i/o|0),t.push(i.i/o|0),t.push(T.i/o|0),ay(i),i=T.next,A=T.next;else if((i=T)===A){y?y===1?sy(i=T7(lp(i),t,o),t,o,u,f,p,2):y===2&&E7(i,t,o,u,f,p):sy(lp(i),t,o,u,f,p,1);break}}}function b7(i){var t=i.prev,o=i,u=i.next;if(ss(t,o,u)>=0)return!1;for(var f=t.x,p=o.x,y=u.x,b=t.y,T=o.y,A=u.y,R=f<p?f<y?f:y:p<y?p:y,P=b<T?b<A?b:A:T<A?T:A,L=f>p?f>y?f:y:p>y?p:y,z=b>T?b>A?b:A:T>A?T:A,N=u.next;N!==t;){if(N.x>=R&&N.x<=L&&N.y>=P&&N.y<=z&&f_(f,b,p,T,y,A,N.x,N.y)&&ss(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function w7(i,t,o,u){var f=i.prev,p=i,y=i.next;if(ss(f,p,y)>=0)return!1;for(var b=f.x,T=p.x,A=y.x,R=f.y,P=p.y,L=y.y,z=b<T?b<A?b:A:T<A?T:A,N=R<P?R<L?R:L:P<L?P:L,U=b>T?b>A?b:A:T>A?T:A,H=R>P?R>L?R:L:P>L?P:L,W=V5(z,N,t,o,u),ie=V5(U,H,t,o,u),le=i.prevZ,se=i.nextZ;le&&le.z>=W&&se&&se.z<=ie;){if(le.x>=z&&le.x<=U&&le.y>=N&&le.y<=H&&le!==f&&le!==y&&f_(b,R,T,P,A,L,le.x,le.y)&&ss(le.prev,le,le.next)>=0||(le=le.prevZ,se.x>=z&&se.x<=U&&se.y>=N&&se.y<=H&&se!==f&&se!==y&&f_(b,R,T,P,A,L,se.x,se.y)&&ss(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;le&&le.z>=W;){if(le.x>=z&&le.x<=U&&le.y>=N&&le.y<=H&&le!==f&&le!==y&&f_(b,R,T,P,A,L,le.x,le.y)&&ss(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;se&&se.z<=ie;){if(se.x>=z&&se.x<=U&&se.y>=N&&se.y<=H&&se!==f&&se!==y&&f_(b,R,T,P,A,L,se.x,se.y)&&ss(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function T7(i,t,o){var u=i;do{var f=u.prev,p=u.next.next;!Ux(f,p)&&sP(f,u,u.next,p)&&oy(f,p)&&oy(p,f)&&(t.push(f.i/o|0),t.push(u.i/o|0),t.push(p.i/o|0),ay(u),ay(u.next),u=i=p),u=u.next}while(u!==i);return lp(u)}function E7(i,t,o,u,f,p){var y=i;do{for(var b=y.next.next;b!==y.prev;){if(y.i!==b.i&&R7(y,b)){var T=oP(y,b);return y=lp(y,y.next),T=lp(T,T.next),sy(y,t,o,u,f,p,0),void sy(T,t,o,u,f,p,0)}b=b.next}y=y.next}while(y!==i)}function A7(i,t){return i.x-t.x}function I7(i,t){var o=function(f,p){var y,b=p,T=f.x,A=f.y,R=-1/0;do{if(A<=b.y&&A>=b.next.y&&b.next.y!==b.y){var P=b.x+(A-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(P<=T&&P>R&&(R=P,y=b.x<b.next.x?b:b.next,P===T))return y}b=b.next}while(b!==p);if(!y)return null;var L,z=y,N=y.x,U=y.y,H=1/0;b=y;do T>=b.x&&b.x>=N&&T!==b.x&&f_(A<U?T:R,A,N,U,A<U?R:T,A,b.x,b.y)&&(L=Math.abs(A-b.y)/(T-b.x),oy(b,f)&&(L<H||L===H&&(b.x>y.x||b.x===y.x&&S7(y,b)))&&(y=b,H=L)),b=b.next;while(b!==z);return y}(i,t);if(!o)return t;var u=oP(o,i);return lp(u,u.next),lp(o,o.next)}function S7(i,t){return ss(i.prev,i,t.prev)<0&&ss(t.next,i,i.next)<0}function V5(i,t,o,u,f){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-o)*f|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-u)*f|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function C7(i){var t=i,o=i;do(t.x<o.x||t.x===o.x&&t.y<o.y)&&(o=t),t=t.next;while(t!==i);return o}function f_(i,t,o,u,f,p,y,b){return(f-y)*(t-b)>=(i-y)*(p-b)&&(i-y)*(u-b)>=(o-y)*(t-b)&&(o-y)*(p-b)>=(f-y)*(u-b)}function R7(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(o,u){var f=o;do{if(f.i!==o.i&&f.next.i!==o.i&&f.i!==u.i&&f.next.i!==u.i&&sP(f,f.next,o,u))return!0;f=f.next}while(f!==o);return!1}(i,t)&&(oy(i,t)&&oy(t,i)&&function(o,u){var f=o,p=!1,y=(o.x+u.x)/2,b=(o.y+u.y)/2;do f.y>b!=f.next.y>b&&f.next.y!==f.y&&y<(f.next.x-f.x)*(b-f.y)/(f.next.y-f.y)+f.x&&(p=!p),f=f.next;while(f!==o);return p}(i,t)&&(ss(i.prev,i,t.prev)||ss(i,t.prev,t))||Ux(i,t)&&ss(i.prev,i,i.next)>0&&ss(t.prev,t,t.next)>0)}function ss(i,t,o){return(t.y-i.y)*(o.x-t.x)-(t.x-i.x)*(o.y-t.y)}function Ux(i,t){return i.x===t.x&&i.y===t.y}function sP(i,t,o,u){var f=$x(ss(i,t,o)),p=$x(ss(i,t,u)),y=$x(ss(o,u,i)),b=$x(ss(o,u,t));return f!==p&&y!==b||!(f!==0||!jx(i,o,t))||!(p!==0||!jx(i,u,t))||!(y!==0||!jx(o,i,u))||!(b!==0||!jx(o,t,u))}function jx(i,t,o){return t.x<=Math.max(i.x,o.x)&&t.x>=Math.min(i.x,o.x)&&t.y<=Math.max(i.y,o.y)&&t.y>=Math.min(i.y,o.y)}function $x(i){return i>0?1:i<0?-1:0}function oy(i,t){return ss(i.prev,i,i.next)<0?ss(i,t,i.next)>=0&&ss(i,i.prev,t)>=0:ss(i,t,i.prev)<0||ss(i,i.next,t)<0}function oP(i,t){var o=new U5(i.i,i.x,i.y),u=new U5(t.i,t.x,t.y),f=i.next,p=t.prev;return i.next=t,t.prev=i,o.next=f,f.prev=o,u.next=o,o.prev=u,p.next=u,u.prev=p,u}function aP(i,t,o,u){var f=new U5(i,t,o);return u?(f.next=u.next,f.prev=u,u.next.prev=f,u.next=f):(f.prev=f,f.next=f),f}function ay(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function U5(i,t,o){this.i=i,this.x=t,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function j5(i,t,o,u){for(var f=0,p=t,y=o-u;p<o;p+=u)f+=(i[y]-i[p])*(i[p+1]+i[y+1]),y=p;return f}B5.exports=Vx,B5.exports.default=Vx,Vx.deviation=function(i,t,o,u){var f=t&&t.length,p=Math.abs(j5(i,0,f?t[0]*o:i.length,o));if(f)for(var y=0,b=t.length;y<b;y++)p-=Math.abs(j5(i,t[y]*o,y<b-1?t[y+1]*o:i.length,o));var T=0;for(y=0;y<u.length;y+=3){var A=u[y]*o,R=u[y+1]*o,P=u[y+2]*o;T+=Math.abs((i[A]-i[P])*(i[R+1]-i[A+1])-(i[A]-i[R])*(i[P+1]-i[A+1]))}return p===0&&T===0?0:Math.abs((T-p)/p)},Vx.flatten=function(i){for(var t=i[0][0].length,o={vertices:[],holes:[],dimensions:t},u=0,f=0;f<i.length;f++){for(var p=0;p<i[f].length;p++)for(var y=0;y<t;y++)o.vertices.push(i[f][p][y]);f>0&&o.holes.push(u+=i[f-1].length)}return o};var Gx=Ie(B5.exports);function $5(i,t){const o=i.length;if(o<=1)return[i];const u=[];let f,p;for(let y=0;y<o;y++){const b=Ql(i[y]);b!==0&&(i[y].area=Math.abs(b),p===void 0&&(p=b<0),p===b<0?(f&&u.push(f),f=[i[y]]):f.push(i[y]))}if(f&&u.push(f),t>1)for(let y=0;y<u.length;y++)u[y].length<=t||(X1(u[y],t,1,u[y].length-1,P7),u[y]=u[y].slice(0,t));return u}function P7(i,t){return t.area-i.area}function G5(i,t,o){const u=o.patternDependencies;let f=!1;for(const p of t){const y=p.paint.get(`${i}-pattern`);y.isConstant()||(f=!0);const b=y.constantOr(null);b&&(f=!0,u[b]=!0)}return f}function q5(i,t,o,u,f){const p=f.patternDependencies;for(const y of t){const b=y.paint.get(`${i}-pattern`).value;if(b.kind!=="constant"){let T=b.evaluate({zoom:u},o,{},f.availableImages);T=T&&T.name?T.name:T,p[T]=!0,o.patterns[y.id]=T}}return o}class H5{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new js,this.indexArray=new ys,this.indexArray2=new Ra,this.programConfigurations=new ed(t.layers,t.zoom),this.segments=new jn,this.segments2=new jn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=t.projection}populate(t,o,u,f){this.hasPattern=G5("fill",this.layers,o);const p=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:b,id:T,index:A,sourceLayerIndex:R}of t){const P=this.layers[0]._featureFilter.needGeometry,L=id(b,P);if(!this.layers[0]._featureFilter.filter(new J(this.zoom),L,u))continue;const z=p?p.evaluate(L,{},u,o.availableImages):void 0,N={id:T,properties:b.properties,type:b.type,sourceLayerIndex:R,index:A,geometry:P?L.geometry:Zu(b,u,f),patterns:{},sortKey:z};y.push(N)}p&&y.sort((b,T)=>b.sortKey-T.sortKey);for(const b of y){const{geometry:T,index:A,sourceLayerIndex:R}=b;if(this.hasPattern){const P=q5("fill",this.layers,b,this.zoom,o);this.patternFeatures.push(P)}else this.addFeature(b,T,A,u,{},o.availableImages,o.brightness);o.featureIndex.insert(t[A].feature,T,A,R,this.index)}}update(t,o,u,f,p){const y=Object.keys(t).length!==0;y&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,o,y?this.stateDependentLayers:this.layers,u,f,p)}addFeatures(t,o,u,f,p,y){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,o,u,f,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,x7),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,o,u,f,p,y=[],b){for(const T of $5(o,500)){let A=0;for(const U of T)A+=U.length;const R=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray),P=R.vertexLength,L=[],z=[];for(const U of T){if(U.length===0)continue;U!==T[0]&&z.push(L.length/2);const H=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),W=H.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(W+U.length-1,W),L.push(U[0].x),L.push(U[0].y);for(let ie=1;ie<U.length;ie++)this.layoutVertexArray.emplaceBack(U[ie].x,U[ie].y),this.indexArray2.emplaceBack(W+ie-1,W+ie),L.push(U[ie].x),L.push(U[ie].y);H.vertexLength+=U.length,H.primitiveLength+=U.length}const N=Gx(L,z);for(let U=0;U<N.length;U+=3)this.indexArray.emplaceBack(P+N[U],P+N[U+1],P+N[U+2]);R.vertexLength+=A,R.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,p,y,f,b)}}er(H5,"FillBucket",{omit:["layers","patternFeatures"]});const M7=new Ue({"fill-sort-key":new He(me.layout_fill["fill-sort-key"]),visibility:new Oe(me.layout_fill.visibility)});var k7={paint:new Ue({"fill-antialias":new Oe(me.paint_fill["fill-antialias"]),"fill-opacity":new He(me.paint_fill["fill-opacity"]),"fill-color":new He(me.paint_fill["fill-color"]),"fill-outline-color":new He(me.paint_fill["fill-outline-color"]),"fill-translate":new Oe(me.paint_fill["fill-translate"]),"fill-translate-anchor":new Oe(me.paint_fill["fill-translate-anchor"]),"fill-pattern":new He(me.paint_fill["fill-pattern"]),"fill-emissive-strength":new Oe(me.paint_fill["fill-emissive-strength"])}),layout:M7};const D7=Gr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),L7=Gr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),O7=Gr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),z7=Gr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),F7=Gr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:N7}=D7;var qx={},B7=Xl,lP=p_;function p_(i,t,o,u,f){this.properties={},this.extent=o,this.type=0,this._pbf=i,this._geometry=-1,this._keys=u,this._values=f,i.readFields(V7,this,t)}function V7(i,t,o){i==1?t.id=o.readVarint():i==2?function(u,f){for(var p=u.readVarint()+u.pos;u.pos<p;){var y=f._keys[u.readVarint()],b=f._values[u.readVarint()];f.properties[y]=b}}(o,t):i==3?t.type=o.readVarint():i==4&&(t._geometry=o.pos)}function U7(i){for(var t,o,u=0,f=0,p=i.length,y=p-1;f<p;y=f++)u+=((o=i[y]).x-(t=i[f]).x)*(t.y+o.y);return u}p_.types=["Unknown","Point","LineString","Polygon"],p_.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,o=i.readVarint()+i.pos,u=1,f=0,p=0,y=0,b=[];i.pos<o;){if(f<=0){var T=i.readVarint();u=7&T,f=T>>3}if(f--,u===1||u===2)p+=i.readSVarint(),y+=i.readSVarint(),u===1&&(t&&b.push(t),t=[]),t.push(new B7(p,y));else{if(u!==7)throw new Error("unknown command "+u);t&&t.push(t[0].clone())}}return t&&b.push(t),b},p_.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,o=1,u=0,f=0,p=0,y=1/0,b=-1/0,T=1/0,A=-1/0;i.pos<t;){if(u<=0){var R=i.readVarint();o=7&R,u=R>>3}if(u--,o===1||o===2)(f+=i.readSVarint())<y&&(y=f),f>b&&(b=f),(p+=i.readSVarint())<T&&(T=p),p>A&&(A=p);else if(o!==7)throw new Error("unknown command "+o)}return[y,T,b,A]},p_.prototype.toGeoJSON=function(i,t,o){var u,f,p=this.extent*Math.pow(2,o),y=this.extent*i,b=this.extent*t,T=this.loadGeometry(),A=p_.types[this.type];function R(z){for(var N=0;N<z.length;N++){var U=z[N];z[N]=[360*(U.x+y)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+b)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(u=0;u<T.length;u++)P[u]=T[u][0];R(T=P);break;case 2:for(u=0;u<T.length;u++)R(T[u]);break;case 3:for(T=function(z){var N=z.length;if(N<=1)return[z];for(var U,H,W=[],ie=0;ie<N;ie++){var le=U7(z[ie]);le!==0&&(H===void 0&&(H=le<0),H===le<0?(U&&W.push(U),U=[z[ie]]):U.push(z[ie]))}return U&&W.push(U),W}(T),u=0;u<T.length;u++)for(f=0;f<T[u].length;f++)R(T[u][f])}T.length===1?T=T[0]:A="Multi"+A;var L={type:"Feature",geometry:{type:A,coordinates:T},properties:this.properties};return"id"in this&&(L.id=this.id),L};var j7=lP,cP=uP;function uP(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields($7,this,t),this.length=this._features.length}function $7(i,t,o){i===15?t.version=o.readVarint():i===1?t.name=o.readString():i===5?t.extent=o.readVarint():i===2?t._features.push(o.pos):i===3?t._keys.push(o.readString()):i===4&&t._values.push(function(u){for(var f=null,p=u.readVarint()+u.pos;u.pos<p;){var y=u.readVarint()>>3;f=y===1?u.readString():y===2?u.readFloat():y===3?u.readDouble():y===4?u.readVarint64():y===5?u.readVarint():y===6?u.readSVarint():y===7?u.readBoolean():null}return f}(o))}uP.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new j7(this._pbf,t,this.extent,this._keys,this._values)};var G7=cP;function q7(i,t,o){if(i===3){var u=new G7(o,o.readVarint()+o.pos);u.length&&(t[u.name]=u)}}var W5=qx.VectorTile=function(i,t){this.layers=i.readFields(q7,{},t)},Hx=qx.VectorTileFeature=lP;function Wx(i,t,o,u){const f=[],p=u===0?(y,b,T,A,R,P)=>{y.push(new Ut(P,T+(P-b)/(A-b)*(R-T)))}:(y,b,T,A,R,P)=>{y.push(new Ut(b+(P-T)/(R-T)*(A-b),P))};for(const y of i){const b=[];for(const T of y){if(T.length<=2)continue;const A=[];for(let L=0;L<T.length-1;L++){const z=T[L].x,N=T[L].y,U=T[L+1].x,H=T[L+1].y,W=u===0?z:N,ie=u===0?U:H;W<t?ie>t&&p(A,z,N,U,H,t):W>o?ie<o&&p(A,z,N,U,H,o):A.push(T[L]),ie<t&&W>=t&&p(A,z,N,U,H,t),ie>o&&W<=o&&p(A,z,N,U,H,o)}let R=T[T.length-1];const P=u===0?R.x:R.y;P>=t&&P<=o&&A.push(R),A.length&&(R=A[A.length-1],A[0].x===R.x&&A[0].y===R.y||A.push(A[0]),b.push(A))}b.length&&f.push(b)}return f}function Zx(i,t){return i.x-t.x||i.y-t.y}function hP(i,t){return Zx(i.min,t.min)===0&&Zx(i.max,t.max)===0}function dP(i,t){return!(i.min.x>t.max.x||i.max.x<t.min.x||i.min.y>t.max.y||i.max.y<t.min.y)}function fP(i,t,o){const u=1/Gt,f=1/(1<<o.canonical.z),p=(t.x*u+o.canonical.x)*f+o.wrap,y=(t.y*u+o.canonical.y)*f;return{min:new Ut((i.x*u+o.canonical.x)*f+o.wrap,(i.y*u+o.canonical.y)*f),max:new Ut(p,y)}}function H7(i,t,o){const u=1<<o.canonical.z,f=((t.x-o.wrap)*u-o.canonical.x)*Gt,p=(t.y*u-o.canonical.y)*Gt;return{min:new Ut(((i.x-o.wrap)*u-o.canonical.x)*Gt,(i.y*u-o.canonical.y)*Gt),max:new Ut(f,p)}}function pP(i,t,o,u,f,p,y){const b=i.indices,T=i.vertices,A=[];for(let R=u;R<u+f;R+=3){const P=t[o[R+0]+p],L=t[o[R+1]+p],z=t[o[R+2]+p],N=Math.min(P.x,L.x,z.x),U=Math.max(P.x,L.x,z.x),H=Math.min(P.y,L.y,z.y),W=Math.max(P.y,L.y,z.y);A.length=0,i.grid.query(new Ut(N,H),new Ut(U,W),A);for(let ie=0;ie<A.length;ie++){const le=A[ie];if(R5(T[b[3*le+0]],T[b[3*le+1]],T[b[3*le+2]],P,L,z,y))return!0}}return!1}function mP(i,t,o,u){if(!i||!o)return!1;let f=i.vertices;if(!t.canonical.equals(u.canonical)||t.wrap!==u.wrap){if(o.vertices.length<i.vertices.length)return mP(o,u,i,t);const p=t.canonical,y=u.canonical,b=Math.pow(2,y.z-p.z);f=i.vertices.map(T=>new Ut((T.x+p.x*Gt)*b-y.x*Gt,(T.y+p.y*Gt)*b-y.y*Gt))}return pP(o,f,i.indices,0,i.indices.length,0,0)}qx.VectorTileLayer=cP;class _P{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,o){const u=this.toIdx(t,o);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(t,o){return this.leaves[this.toIdx(t,o)]}toIdx(t,o){return o*this.size+t}}function gP(i,t,o,u){let f=0,p=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(u[y])<1e-15){if(o[y]<i[y]||o[y]>t[y])return null}else{const b=1/u[y];let T=(i[y]-o[y])*b,A=(t[y]-o[y])*b;if(T>A){const R=T;T=A,A=R}if(T>f&&(f=T),A<p&&(p=A),f>p)return null}return f}function yP(i,t,o,u,f,p,y,b,T,A,R){const P=u-i,L=f-t,z=p-o,N=y-i,U=b-t,H=T-o,W=R[1]*H-R[2]*U,ie=R[2]*N-R[0]*H,le=R[0]*U-R[1]*N,se=P*W+L*ie+z*le;if(Math.abs(se)<1e-15)return null;const we=1/se,he=A[0]-i,Pe=A[1]-t,Le=A[2]-o,qe=(he*W+Pe*ie+Le*le)*we;if(qe<0||qe>1)return null;const ot=Pe*z-Le*L,Ye=Le*P-he*z,mt=he*L-Pe*P,pt=(R[0]*ot+R[1]*Ye+R[2]*mt)*we;return pt<0||qe+pt>1?null:(N*ot+U*Ye+H*mt)*we}function vP(i,t,o){return(i-t)/(o-t)}function xP(i,t,o,u,f,p,y,b,T){const A=1<<o,R=p-u,P=y-f,L=(i+1)/A*R+u,z=(t+0)/A*P+f,N=(t+1)/A*P+f;b[0]=(i+0)/A*R+u,b[1]=z,T[0]=L,T[1]=N}class bP{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(p){const y=Math.ceil(Math.log2(p.dim/8)),b=[];let T=Math.ceil(Math.pow(2,y));const A=1/T,R=(z,N,U,H,W)=>{const ie=H?1:0,le=(z+1)*U-ie,se=N*U,we=(N+1)*U-ie;W[0]=z*U,W[1]=se,W[2]=le,W[3]=we};let P=new _P(T);const L=[];for(let z=0;z<T*T;z++){R(z%T,Math.floor(z/T),A,!1,L);const N=od(L[0],L[1],p),U=od(L[2],L[1],p),H=od(L[2],L[3],p),W=od(L[0],L[3],p);P.minimums.push(Math.min(N,U,H,W)),P.maximums.push(Math.max(N,U,H,W)),P.leaves.push(1)}for(b.push(P),T/=2;T>=1;T/=2){const z=b[b.length-1];P=new _P(T);for(let N=0;N<T*T;N++){R(N%T,Math.floor(N/T),2,!0,L);const U=z.getElevation(L[0],L[1]),H=z.getElevation(L[2],L[1]),W=z.getElevation(L[2],L[3]),ie=z.getElevation(L[0],L[3]),le=z.isLeaf(L[0],L[1]),se=z.isLeaf(L[2],L[1]),we=z.isLeaf(L[2],L[3]),he=z.isLeaf(L[0],L[3]),Pe=Math.min(U.min,H.min,W.min,ie.min),Le=Math.max(U.max,H.max,W.max,ie.max),qe=le&&se&&we&&he;P.maximums.push(Le),P.minimums.push(Pe),P.leaves.push(Le-Pe<=5&&qe?1:0)}b.push(P)}return b}(this.dem),u=o.length-1,f=o[u];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(o,0,0,u,0)}raycastRoot(t,o,u,f,p,y,b=1){return gP([t,o,-100],[u,f,this.maximums[0]*b],p,y)}raycast(t,o,u,f,p,y,b=1){if(!this.nodeCount)return null;const T=this.raycastRoot(t,o,u,f,p,y,b);if(T==null)return null;const A=[],R=[],P=[],L=[],z=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:N,t:U,nodex:H,nodey:W,depth:ie}=z.pop();if(this.leaves[N]){xP(H,W,ie,t,o,u,f,P,L);const se=1<<ie,we=(H+0)/se,he=(H+1)/se,Pe=(W+0)/se,Le=(W+1)/se,qe=od(we,Pe,this.dem)*b,ot=od(he,Pe,this.dem)*b,Ye=od(he,Le,this.dem)*b,mt=od(we,Le,this.dem)*b,pt=yP(P[0],P[1],qe,L[0],P[1],ot,L[0],L[1],Ye,p,y),at=yP(L[0],L[1],Ye,P[0],L[1],mt,P[0],P[1],qe,p,y),wt=Math.min(pt!==null?pt:Number.MAX_VALUE,at!==null?at:Number.MAX_VALUE);if(wt!==Number.MAX_VALUE)return wt;{const xt=l.Q.scaleAndAdd([],p,y,U);if(wP(qe,ot,mt,Ye,vP(xt[0],P[0],L[0]),vP(xt[1],P[1],L[1]))>=xt[2])return U}continue}let le=0;for(let se=0;se<this._siblingOffset.length;se++){xP((H<<1)+this._siblingOffset[se][0],(W<<1)+this._siblingOffset[se][1],ie+1,t,o,u,f,P,L),P[2]=-100,L[2]=this.maximums[this.childOffsets[N]+se]*b;const we=gP(P,L,p,y);if(we!=null){const he=we;A[se]=he;let Pe=!1;for(let Le=0;Le<le&&!Pe;Le++)he>=A[R[Le]]&&(R.splice(Le,0,se),Pe=!0);Pe||(R[le]=se),le++}}for(let se=0;se<le;se++){const we=R[se];z.push({idx:this.childOffsets[N]+we,t:A[we],nodex:(H<<1)+this._siblingOffset[we][0],nodey:(W<<1)+this._siblingOffset[we][1],depth:ie+1})}}return null}_addNode(t,o,u){return this.minimums.push(t),this.maximums.push(o),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(t,o,u,f,p){if(t[f].isLeaf(o,u)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const y=f-1,b=t[y];let T=0,A=0;for(let R=0;R<this._siblingOffset.length;R++){const P=2*o+this._siblingOffset[R][0],L=2*u+this._siblingOffset[R][1],z=b.getElevation(P,L),N=b.isLeaf(P,L),U=this._addNode(z.min,z.max,N);N&&(T|=1<<R),A||(A=U)}for(let R=0;R<this._siblingOffset.length;R++)T&1<<R||this._construct(t,2*o+this._siblingOffset[R][0],2*u+this._siblingOffset[R][1],y,A+R)}}function wP(i,t,o,u,f,p){return ri(ri(i,o,p),ri(t,u,p),f)}function od(i,t,o){const u=o.dim,f=ti(i*u-.5,0,u-1),p=ti(t*u-.5,0,u-1),y=Math.floor(f),b=Math.floor(p),T=Math.min(y+1,u-1),A=Math.min(b+1,u-1);return wP(o.get(y,b),o.get(T,b),o.get(y,A),o.get(T,A),f-y,p-b)}const W7={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Z7(i,t,o){return(256*i*256+256*t+o)/10-1e4}function X7(i,t,o){return 256*i+t+o/256-32768}class Xx{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,o,u,f=!1){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return gn(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const p=this.dim=o.height-2,y=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=f,this._modifiedForSources={},!f){for(let T=0;T<p;T++)y[this._idx(-1,T)]=y[this._idx(0,T)],y[this._idx(p,T)]=y[this._idx(p-1,T)],y[this._idx(T,-1)]=y[this._idx(T,0)],y[this._idx(T,p)]=y[this._idx(T,p-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(p,-1)]=y[this._idx(p-1,0)],y[this._idx(-1,p)]=y[this._idx(0,p-1)],y[this._idx(p,p)]=y[this._idx(p-1,p-1)]}const b=u==="terrarium"?X7:Z7;for(let T=0;T<y.length;++T){const A=4*T;this.floatView[T]=b(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}this._timestamp=ve.now()}_buildQuadTree(){this._tree=new bP(this)}get(t,o,u=!1){u&&(t=ti(t,-1,this.dim),o=ti(o,-1,this.dim));const f=this._idx(t,o);return this.floatView[f]}set(t,o,u){const f=this._idx(t,o),p=this.floatView[f];return this.floatView[f]=u,u-p}static getUnpackVector(t){return W7[t]}_idx(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)}static pack(t,o){const u=[0,0,0,0],f=Xx.getUnpackVector(o);let p=Math.floor((t+f[3])/f[2]);return u[2]=p%256,p=Math.floor(p/256),u[1]=p%256,p=Math.floor(p/256),u[0]=p,u}getPixels(){return new iP({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let f=o*this.dim,p=o*this.dim+this.dim,y=u*this.dim,b=u*this.dim+this.dim;switch(o){case-1:f=p-1;break;case 1:p=f+1}switch(u){case-1:y=b-1;break;case 1:b=y+1}const T=-o*this.dim,A=-u*this.dim;for(let R=y;R<b;R++)for(let P=f;P<p;P++){const L=4*this._idx(P,R),z=4*this._idx(P+T,R+A);this.pixels[L+0]=t.pixels[z+0],this.pixels[L+1]=t.pixels[z+1],this.pixels[L+2]=t.pixels[z+2],this.pixels[L+3]=t.pixels[z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}er(Xx,"DEMData"),er(bP,"DemMinMaxQuadTree",{omit:["dem"]});class m_{constructor(t,o,u){this._demTile=t,this._dem=this._demTile.dem,this._scale=o,this._offset=u}static create(t,o,u){const f=u||t.findDEMTileFor(o);if(!f||!f.dem)return;const p=f.dem,y=f.tileID,b=1<<o.canonical.z-y.canonical.z;return new m_(f,p.dim/Gt/b,[(o.canonical.x/b-y.canonical.x)*p.dim,(o.canonical.y/b-y.canonical.y)*p.dim])}tileCoordToPixel(t,o){const u=o*this._scale+this._offset[1],f=Math.floor(t*this._scale+this._offset[0]),p=Math.floor(u);return new Ut(f,p)}getElevationAt(t,o,u,f){const p=t*this._scale+this._offset[0],y=o*this._scale+this._offset[1],b=Math.floor(p),T=Math.floor(y),A=this._dem;return f=!!f,u?ri(ri(A.get(b,T,f),A.get(b,T+1,f),y-T),ri(A.get(b+1,T,f),A.get(b+1,T+1,f),y-T),p-b):A.get(b,T,f)}getElevationAtPixel(t,o,u){return this._dem.get(t,o,!!u)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*No(1,t)*this._dem.stride}}const Y7=Hx.types,Q7=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],K7=["fill-extrusion-flood-light-ground-radius"],J7=Math.pow(2,13),e2=Math.pow(2,15)-1,TP=new Ut(0,1),ad=2147483648;function ly(i,t,o,u,f,p,y,b){i.emplaceBack((t<<1)+y,(o<<1)+p,(Math.floor(u*J7)<<1)+f,Math.round(b))}function Yx(i,t,o,u,f,p){i.emplaceBack(t.x,t.y,(o.x<<1)+u,(o.y<<1)+f,p)}function cy(i,t,o){i.emplaceBack(t.x,t.y,t.z,o[0]*16384,o[1]*16384,o[2]*16384)}class EP{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class AP{constructor(){this.centroidXY=new Ut(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ut(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ut(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ut(this.max.x-this.min.x,this.max.y-this.min.y)}}class IP{constructor(){this.acc=new Ut(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,o){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=o.x,t.min.y=t.max.y=o.y)}appendEdge(t,o,u){this.accCount++,this.acc._add(o);let f=!!this.borders;o.x<t.min.x?(t.min.x=o.x,f=!0):o.x>t.max.x&&(t.max.x=o.x,f=!0),o.y<t.min.y?(t.min.y=o.y,f=!0):o.y>t.max.y&&(t.max.y=o.y,f=!0),((o.x===0||o.x===Gt)&&o.x===u.x)!=((o.y===0||o.y===Gt)&&o.y===u.y)&&this.processBorderOverlap(o,u),f&&this.checkBorderIntersection(o,u)}checkBorderIntersection(t,o){o.x<0!=t.x<0&&this.addBorderIntersection(0,ri(o.y,t.y,(0-o.x)/(t.x-o.x))),o.x>Gt!=t.x>Gt&&this.addBorderIntersection(1,ri(o.y,t.y,(Gt-o.x)/(t.x-o.x))),o.y<0!=t.y<0&&this.addBorderIntersection(2,ri(o.x,t.x,(0-o.y)/(t.y-o.y))),o.y>Gt!=t.y>Gt&&this.addBorderIntersection(3,ri(o.x,t.x,(Gt-o.y)/(t.y-o.y)))}addBorderIntersection(t,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[t];o<u[0]&&(u[0]=o),o>u[1]&&(u[1]=o)}processBorderOverlap(t,o){if(t.x===o.x){if(t.y===o.y)return;const u=t.x===0?0:1;this.addBorderIntersection(u,o.y),this.addBorderIntersection(u,t.y)}else{const u=t.y===0?2:3;this.addBorderIntersection(u,o.x),this.addBorderIntersection(u,t.x)}}centroid(){return this.accCount===0?new Ut(0,0):new Ut(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,o)=>t+ +(o[0]!==Number.MAX_VALUE),0):0}}function SP(i,t){const o=i.add(t)._unit(),u=ti(i.x*o.x+i.y*o.y,-1,1);var f,p,y;return f=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(f)))/4*e2*((p=i).x*(y=t).y-p.y*y.x<0?-1:1)}const t2=[i=>i.x<0,i=>i.x>Gt,i=>i.y<0,i=>i.y>Gt];function r2(i,t,o,u){const f=[4];if(u===0)return f;o._mult(u);const p=i.sub(o),y=t.sub(o),b=[i,t,p,y];for(let T=0;T<4;T++)for(const A of b)if(t2[T](A)){f.push(T);break}return f}class CP{constructor(t){this.vertexArray=new xo,this.indexArray=new ys,this.programConfigurations=new ed(t.layers,t.zoom,o=>K7.includes(o)),this._segments=new jn,this.hiddenByLandmarkVertexArray=new f5,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new jn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,o,u,f=!1){const p=t.length;if(p>2){let y=Math.max(0,this._segments.get().length-1);const b=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[y].length);let T;y!==this._segments.get().length-1&&(y++,this._segmentToGroundQuads[y]=[],this._segmentToRegionTriCounts[y]=[0,0,0,0,0]);{const A=t[0],R=t[1];T=SP(A.sub(t[p-1])._perp()._unit(),R.sub(A)._perp()._unit())}for(let A=0;A<p;A++){const R=A===p-1?0:A+1,P=t[A],L=t[R],z=t[R===p-1?0:R+1],N=L.sub(P)._perp()._unit(),U=SP(N,z.sub(L)._perp()._unit()),H=T,W=U;if(Z5(P,L,o)||f&&MP(P,o)&&MP(L,o)){T=U;continue}const ie=b.vertexLength;Yx(this.vertexArray,P,L,1,1,H),Yx(this.vertexArray,P,L,1,0,H),Yx(this.vertexArray,P,L,0,1,W),Yx(this.vertexArray,P,L,0,0,W),b.vertexLength+=4;const le=r2(P,L,N,u);for(const se of le)this._segmentToGroundQuads[y].push({id:ie,region:se}),this._segmentToRegionTriCounts[y][se]+=2,b.primitiveLength+=2;T=U}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),o=t.length;for(let u=0;u<o;u++)this._segmentToGroundQuads[u].sort((f,p)=>f.region-p.region);for(let u=0;u<o;u++){const f=this._segmentToGroundQuads[u],p=t[u],y=this._segmentToRegionTriCounts[u];y.reduce((T,A)=>T+A,0);let b=0;for(let T=0;T<=4;T++){const A=y[T];if(A!==0){let R=this.regionSegments[T];R||(R=this.regionSegments[T]=new jn);const P={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+b,vertexLength:p.vertexLength,primitiveLength:A};R.get().push(P)}b+=A}for(let T=0;T<f.length;T++){const A=f[T].id;this.indexArray.emplaceBack(A,A+1,A+3),this.indexArray.emplaceBack(A,A+3,A+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,o,u,f,p,y){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,o,u,f,p,y)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,L7.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,o,u,f,p,y){this.hasData()&&this.programConfigurations.updatePaintArrays(t,o,u,f,p,y)}updateHiddenByLandmark(t){if(!this.hasData())return;const o=t.groundVertexCount+t.groundVertexArrayOffset;if(t.groundVertexCount===0)return;const u=t.flags&ad?1:0;for(let f=t.groundVertexArrayOffset;f<o;++f)this.hiddenByLandmarkVertexArray.emplace(f,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,z7.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const o=this.regionSegments[t];o&&o.destroy()}}}}class Qx{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ys,this.footprintVertices=new js,this.footprintSegments=[],this.layoutVertexArray=new $s,this.centroidVertexArray=new v6,this.indexArray=new ys,this.programConfigurations=new ed(t.layers,t.zoom,o=>Q7.includes(o)),this.segments=new jn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new CP(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(t,o,u,f){this.features=[],this.hasPattern=G5("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Mx(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:p,id:y,index:b,sourceLayerIndex:T}of t){const A=this.layers[0]._featureFilter.needGeometry,R=id(p,A);if(!this.layers[0]._featureFilter.filter(new J(this.zoom),R,u))continue;const P={id:y,sourceLayerIndex:T,index:b,geometry:A?R.geometry:Zu(p,u,f),properties:p.properties,type:p.type,patterns:{}},L=this.layoutVertexArray.length;this.hasPattern?this.features.push(q5("fill-extrusion",this.layers,P,this.zoom,o)):this.addFeature(P,P.geometry,b,u,{},o.availableImages,f,o.brightness),o.featureIndex.insert(p,P.geometry,b,T,this.index,L)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,o,u,f,p,y){for(const b of this.features){const{geometry:T}=b;this.addFeature(b,T,b.index,o,u,f,p,y)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,o,u,f,p){const y=Object.keys(t).length!==0;if(y&&!this.stateDependentLayers.length)return;const b=y?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,o,b,u,f,p),this.groundEffect.update(t,o,b,u,f,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,N7),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,F7.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,O7.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,o,u,f,p,y,b,T){const A=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,R=[new Ut(0,0),new Ut(Gt,Gt)],P=b.projection,L=P.name==="globe",z=Y7[t.type]==="Polygon",N=new IP;N.centroidDataIndex=this.centroidData.length;const U=new AP,H=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},f)<=0,W=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},f);U.height=W,U.vertexArrayOffset=this.layoutVertexArray.length,U.groundVertexArrayOffset=this.groundEffect.vertexArray.length,L&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new tl);const ie=$5(o,500);for(let Le=ie.length-1;Le>=0;Le--){const qe=ie[Le];(qe.length===0||(le=qe[0]).every(ot=>ot.x<=0)||le.every(ot=>ot.x>=Gt)||le.every(ot=>ot.y<=0)||le.every(ot=>ot.y>=Gt))&&ie.splice(Le,1)}var le;let se;if(L)se=OP(ie,R,f);else{se=[];for(const Le of ie)se.push({polygon:Le,bounds:R})}const we=z?this.edgeRadius:0,he=we>0&&this.zoom<17,Pe=(Le,qe)=>{if(Le.length===0)return!1;const ot=Le[Le.length-1];return qe.x===ot.x&&qe.y===ot.y};for(const{polygon:Le,bounds:qe}of se){let ot=0,Ye=0;for(const wt of Le)z&&!wt[0].equals(wt[wt.length-1])&&wt.push(wt[0]),Ye+=z?wt.length-1:wt.length;const mt=this.segments.prepareSegment((z?5:4)*Ye,this.layoutVertexArray,this.indexArray);U.footprintSegIdx<0&&(U.footprintSegIdx=this.footprintSegments.length),U.polygonSegIdx<0&&(U.polygonSegIdx=this.polygonSegments.length);const pt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},at=new EP;if(at.vertexOffset=this.footprintVertices.length,at.indexOffset=3*this.footprintIndices.length,at.ringIndices=[],z){const wt=[],xt=[];ot=mt.vertexLength;for(let Et=0;Et<Le.length;Et++){const gt=Le[Et];gt.length&&Et!==0&&xt.push(wt.length/2);const nr=[];let Qt,kt;Qt=gt[1].sub(gt[0])._perp()._unit(),at.ringIndices.push(gt.length-1);for(let xr=1;xr<gt.length;xr++){const dr=gt[xr],sr=gt[xr===gt.length-1?1:xr+1],Dt=dr.clone();if(we){kt=sr.sub(dr)._perp()._unit();const yr=Qt.add(kt)._unit(),Wr=we*Math.min(4,1/(Qt.x*yr.x+Qt.y*yr.y));Dt.x+=Wr*yr.x,Dt.y+=Wr*yr.y,Dt.x=Math.round(Dt.x),Dt.y=Math.round(Dt.y),Qt=kt}!H||we!==0&&!he||Pe(nr,Dt)||nr.push(Dt),ly(this.layoutVertexArray,Dt.x,Dt.y,0,0,1,1,0),mt.vertexLength++,this.footprintVertices.emplaceBack(dr.x,dr.y),wt.push(dr.x,dr.y),L&&cy(this.layoutVertexExtArray,P.projectTilePoint(Dt.x,Dt.y,f),P.upVector(f,Dt.x,Dt.y))}H&&(we===0||he)&&(nr.length!==0&&Pe(nr,nr[0])&&nr.pop(),this.groundEffect.addData(nr,qe,A))}const St=Gx(wt,xt);for(let Et=0;Et<St.length;Et+=3)this.footprintIndices.emplaceBack(at.vertexOffset+St[Et+0],at.vertexOffset+St[Et+1],at.vertexOffset+St[Et+2]),this.indexArray.emplaceBack(ot+St[Et],ot+St[Et+2],ot+St[Et+1]),mt.primitiveLength++;at.indexCount+=St.length,at.vertexCount+=this.footprintVertices.length-at.vertexOffset}for(let wt=0;wt<Le.length;wt++){const xt=Le[wt];N.startRing(U,xt[0]);let St=xt.length>4&&kP(xt[xt.length-2],xt[0],xt[1]),Et=we?i2(xt[xt.length-2],xt[0],xt[1],we):0;const gt=[];let nr,Qt,kt;Qt=xt[1].sub(xt[0])._perp()._unit();let xr=!0;for(let dr=1,sr=0;dr<xt.length;dr++){let Dt=xt[dr-1],yr=xt[dr];const Wr=xt[dr===xt.length-1?1:dr+1];if(N.appendEdge(U,yr,Dt),Z5(yr,Dt,qe)){we&&(Qt=Wr.sub(yr)._perp()._unit(),xr=!xr);continue}const Rr=yr.sub(Dt)._perp(),Yr=Rr.x/(Math.abs(Rr.x)+Math.abs(Rr.y)),Zr=Rr.y>0?1:0,ai=Dt.dist(yr);if(sr+ai>32768&&(sr=0),we){kt=Wr.sub(yr)._perp()._unit();let Pi=PP(Dt,yr,Wr,RP(Qt,kt),we);isNaN(Pi)&&(Pi=0);const xi=yr.sub(Dt)._unit();Dt=Dt.add(xi.mult(Et))._round(),yr=yr.add(xi.mult(-Pi))._round(),Et=Pi,Qt=kt,H&&this.zoom>=17&&(Pe(gt,Dt)||gt.push(Dt),Pe(gt,yr)||gt.push(yr))}const Ar=mt.vertexLength,Gi=xt.length>4&&kP(Dt,yr,Wr);let $i=DP(sr,St,xr);if(ly(this.layoutVertexArray,Dt.x,Dt.y,Yr,Zr,0,0,$i),ly(this.layoutVertexArray,Dt.x,Dt.y,Yr,Zr,0,1,$i),sr+=ai,$i=DP(sr,Gi,!xr),St=Gi,ly(this.layoutVertexArray,yr.x,yr.y,Yr,Zr,0,0,$i),ly(this.layoutVertexArray,yr.x,yr.y,Yr,Zr,0,1,$i),mt.vertexLength+=4,this.indexArray.emplaceBack(Ar+0,Ar+1,Ar+2),this.indexArray.emplaceBack(Ar+1,Ar+3,Ar+2),mt.primitiveLength+=2,we){const Pi=ot+(dr===1?xt.length-2:dr-2),xi=dr===1?ot:Pi+1;if(this.indexArray.emplaceBack(Ar+1,Pi,Ar+3),this.indexArray.emplaceBack(Pi,xi,Ar+3),mt.primitiveLength+=2,nr===void 0&&(nr=Ar),!Z5(Wr,xt[dr],qe)){const Mi=dr===xt.length-1?nr:mt.vertexLength;this.indexArray.emplaceBack(Ar+2,Ar+3,Mi),this.indexArray.emplaceBack(Ar+3,Mi+1,Mi),this.indexArray.emplaceBack(Ar+3,xi,Mi+1),mt.primitiveLength+=3}xr=!xr}if(L){const Pi=this.layoutVertexExtArray,xi=P.projectTilePoint(Dt.x,Dt.y,f),Mi=P.projectTilePoint(yr.x,yr.y,f),cn=P.upVector(f,Dt.x,Dt.y),Ki=P.upVector(f,yr.x,yr.y);cy(Pi,xi,cn),cy(Pi,xi,cn),cy(Pi,Mi,Ki),cy(Pi,Mi,Ki)}}z&&(ot+=xt.length-1),H&&we&&this.zoom>=17&&(gt.length!==0&&Pe(gt,gt[0])&&gt.pop(),this.groundEffect.addData(gt,qe,A,we>0))}this.footprintSegments.push(at),pt.triangleCount=this.indexArray.length-pt.triangleArrayOffset,this.polygonSegments.push(pt),++U.footprintSegLen,++U.polygonSegLen}if(U.vertexCount=this.layoutVertexArray.length-U.vertexArrayOffset,U.groundVertexCount=this.groundEffect.vertexArray.length-U.groundVertexArrayOffset,U.vertexCount!==0){if(U.centroidXY=N.borders?TP:this.encodeCentroid(N,U),this.centroidData.push(U),N.borders){this.featuresOnBorder.push(N);const Le=this.featuresOnBorder.length-1;for(let qe=0;qe<N.borders.length;qe++)N.borders[qe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[qe].push(Le)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,p,y,f,T),this.groundEffect.addPaintPropertiesData(t,u,p,y,f,T),this.maxHeight=Math.max(this.maxHeight,W)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((o,u)=>this.featuresOnBorder[o].borders[t][0]-this.featuresOnBorder[u].borders[t][0])}splitToSubtiles(){const t=[];for(let b=0;b<this.centroidData.length;b++){const T=this.centroidData[b],A=+(T.min.y+T.max.y>Gt),R=2*A+(+(T.min.x+T.max.x>Gt)^A);for(let P=0;P<T.polygonSegLen;P++){const L=T.polygonSegIdx+P;t.push({centroidIdx:b,subtile:R,polygonSegmentIdx:L,triangleSegmentIdx:this.polygonSegments[L].triangleSegIdx})}}const o=new ys;t.sort((b,T)=>b.triangleSegmentIdx===T.triangleSegmentIdx?b.subtile-T.subtile:b.triangleSegmentIdx-T.triangleSegmentIdx);let u=0,f=0,p=0;for(const b of t){if(b.triangleSegmentIdx!==u)break;p++}const y=t.length;for(;f!==t.length;){u=t[f].triangleSegmentIdx;let b=0,T=f,A=f;for(let R=T;R<p&&t[R].subtile===b;R++)A++;for(;T!==p;){const R=t[T];b=R.subtile;const P=this.centroidData[R.centroidIdx].min.clone(),L=this.centroidData[R.centroidIdx].max.clone(),z={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let N=T;N<A;N++){const U=t[N],H=this.polygonSegments[U.polygonSegmentIdx],W=this.centroidData[U.centroidIdx].min,ie=this.centroidData[U.centroidIdx].max,le=this.indexArray.uint16;for(let se=H.triangleArrayOffset;se<H.triangleArrayOffset+H.triangleCount;se++)o.emplaceBack(le[3*se],le[3*se+1],le[3*se+2]);z.primitiveLength+=H.triangleCount,P.x=Math.min(P.x,W.x),P.y=Math.min(P.y,W.y),L.x=Math.max(L.x,ie.x),L.y=Math.max(L.y,ie.y)}z.primitiveLength>0&&this.triangleSubSegments.push({segment:z,min:P,max:L}),T=A;for(let N=T;N<p&&t[N].subtile===t[T].subtile;N++)A++}f=p;for(let R=f;R<y&&t[R].triangleSegmentIdx===t[f].triangleSegmentIdx;R++)p++}o._trim(),this.indexArray=o}getVisibleSegments(t,o,u){let f=0,p=0;const y=1<<t.canonical.z;if(o){const U=o.getMinMaxForTile(t);U&&(f=U.min,p=U.max)}p+=this.maxHeight;const b=t.toUnwrapped();let T;const A=[b.canonical.x/y+b.wrap,b.canonical.y/y],R=[(b.canonical.x+1)/y+b.wrap,(b.canonical.y+1)/y],P=new jn,L=(U,H,W)=>[U[0]*(1-W[0])+H[0]*W[0],U[1]*(1-W[1])+H[1]*W[1]],z=[],N=[];for(const U of this.triangleSubSegments){z[0]=U.min.x/Gt,z[1]=U.min.y/Gt,N[0]=U.max.x/Gt,N[1]=U.max.y/Gt;const H=L(A,R,z),W=L(A,R,N);if(new vn([H[0],H[1],f],[W[0],W[1],p]).intersectsPrecise(u)===0){T&&(P.segments.push(T),T=void 0);continue}const ie=U.segment;T&&T.vertexOffset!==ie.vertexOffset&&(P.segments.push(T),T=void 0),T?(T.vertexLength+=ie.vertexLength,T.primitiveLength+=ie.primitiveLength):T={vertexOffset:ie.vertexOffset,primitiveLength:ie.primitiveLength,vertexLength:ie.vertexLength,primitiveOffset:ie.primitiveOffset,sortKey:void 0,vaos:{}}}return T&&P.segments.push(T),P}encodeCentroid(t,o){const u=t.centroid(),f=o.span(),p=Math.min(7,Math.round(f.x*this.tileToMeter/10)),y=Math.min(7,Math.round(f.y*this.tileToMeter/10));return new Ut(ti(u.x,1,Gt-1)<<3|p,ti(u.y,1,Gt-1)<<3|y)}encodeBorderCentroid(t){if(!t.borders)return new Ut(0,0);const o=t.borders,u=Number.MAX_VALUE;if(o[0][0]!==u||o[1][0]!==u){const f=o[0][0]!==u?0:1;return new Ut(6|(o[0][0]!==u?0:65528),(o[f][0]+o[f][1])/2<<3|6)}{const f=o[2][0]!==u?2:3;return new Ut((o[f][0]+o[f][1])/2<<3|6,6|(o[2][0]!==u?0:65528))}}showCentroid(t){const o=this.centroidData[t.centroidDataIndex];o.flags&=ad,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const o=t.vertexArrayOffset,u=t.vertexCount+t.vertexArrayOffset,f=t.flags&ad?TP:t.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==f.y||p!==f.x){for(let y=o;y<u;++y)this.centroidVertexArray.emplace(y,f.x,f.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(t.toUnwrapped());if(function(p,y){if(p.length!==y.length)return!1;for(let b=0;b<p.length;b++)if(p[b].sourceId!==y[b].sourceId||!hP(p[b],y[b]))return!1;return!0}(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const p of this.centroidData)p.flags&=2147483647;const f=[];for(const p of this.activeReplacements){const y=Math.pow(2,p.footprintTileId.canonical.z-t.canonical.z);for(const b of this.centroidData)if(!(b.flags&ad||p.min.x>b.max.x||b.min.x>p.max.x||p.min.y>b.max.y||b.min.y>p.max.y))for(let T=0;T<b.footprintSegLen;T++){const A=this.footprintSegments[b.footprintSegIdx+T];if(f.length=0,n2(this.footprintVertices,A.vertexOffset,A.vertexCount,p.footprintTileId.canonical,t.canonical,f),pP(p.footprint,f,this.footprintIndices.uint16,A.indexOffset,A.indexCount,-A.vertexOffset,-y)){b.flags|=ad;break}}}for(const p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,o,u){let f=!1;for(let p=0;p<u.footprintSegLen;p++){const y=this.footprintSegments[u.footprintSegIdx+p];let b=0;for(const T of y.ringIndices){for(let A=b,R=T+b-1;A<T+b;R=A++){const P=this.footprintVertices.int16[2*(A+y.vertexOffset)+0],L=this.footprintVertices.int16[2*(A+y.vertexOffset)+1],z=this.footprintVertices.int16[2*(R+y.vertexOffset)+1];L>o!=z>o&&t<(this.footprintVertices.int16[2*(R+y.vertexOffset)+0]-P)*(o-L)/(z-L)+P&&(f=!f)}b=T}}return f}getHeightAtTileCoord(t,o){let u=Number.NEGATIVE_INFINITY,f=!0;const p=4*(t+Gt)*Gt+(o+Gt);if(this.partLookup.hasOwnProperty(p)){const y=this.partLookup[p];return y?{height:y.height,hidden:!!(y.flags&ad)}:void 0}for(const y of this.centroidData)t>y.max.x||y.min.x>t||o>y.max.y||y.min.y>o||this.footprintContainsPoint(t,o,y)&&y&&y.height>u&&(u=y.height,this.partLookup[p]=y,f=!!(y.flags&ad));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:f};this.partLookup[p]=void 0}}function RP(i,t){const o=i.add(t)._unit();return i.x*o.x+i.y*o.y}function i2(i,t,o,u){const f=t.sub(i)._perp()._unit(),p=o.sub(t)._perp()._unit();return PP(i,t,o,RP(f,p),u)}function PP(i,t,o,u,f){const p=Math.sqrt(1-u*u);return Math.min(i.dist(t)/3,t.dist(o)/3,f*p/u)}function Z5(i,t,o){return i.x<o[0].x&&t.x<o[0].x||i.x>o[1].x&&t.x>o[1].x||i.y<o[0].y&&t.y<o[0].y||i.y>o[1].y&&t.y>o[1].y}function MP(i,t){return i.x<t[0].x||i.x>t[1].x||i.y<t[0].y||i.y>t[1].y}function kP(i,t,o){if(i.x<0||i.x>=Gt||t.x<0||t.x>=Gt||o.x<0||o.x>=Gt)return!1;const u=o.sub(t),f=u.perp(),p=i.sub(t);return(u.x*p.x+u.y*p.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(p.x*p.x+p.y*p.y))>-.866&&f.x*p.x+f.y*p.y<0}function DP(i,t,o){const u=t?2|i:-3&i;return o?1|u:-2&u}function LP(){const i=Math.PI/32,t=Math.tan(i),o=u_;return o*Math.sqrt(1+2*t*t)-o}function OP(i,t,o){const u=1<<o.z,f=Pa(o.x/u),p=Pa((o.x+1)/u),y=Gs(o.y/u),b=Gs((o.y+1)/u);return function(T,A,R,P,L=0,z){const N=[];if(!T.length||!R||!P)return N;const U=(he,Pe)=>{for(const Le of he)N.push({polygon:Le,bounds:Pe})},H=Math.ceil(Math.log2(R)),W=Math.ceil(Math.log2(P)),ie=H-W,le=[];for(let he=0;he<Math.abs(ie);he++)le.push(ie>0?0:1);for(let he=0;he<Math.min(H,W);he++)le.push(0),le.push(1);let se=T;if(se=Wx(se,A[0].y-L,A[1].y+L,1),se=Wx(se,A[0].x-L,A[1].x+L,0),!se.length)return N;const we=[];for(le.length?we.push({polygons:se,bounds:A,depth:0}):U(se,A);we.length;){const he=we.pop(),Pe=he.depth,Le=le[Pe],qe=he.bounds[0],ot=he.bounds[1],Ye=Le===0?qe.x:qe.y,mt=Le===0?ot.x:ot.y,pt=z?z(Le,Ye,mt):.5*(Ye+mt),at=Wx(he.polygons,Ye-L,pt+L,Le),wt=Wx(he.polygons,pt-L,mt+L,Le);if(at.length){const xt=[qe,new Ut(Le===0?pt:ot.x,Le===1?pt:ot.y)];le.length>Pe+1?we.push({polygons:at,bounds:xt,depth:Pe+1}):U(at,xt)}if(wt.length){const xt=[new Ut(Le===0?pt:qe.x,Le===1?pt:qe.y),ot];le.length>Pe+1?we.push({polygons:wt,bounds:xt,depth:Pe+1}):U(wt,xt)}}return N}(i,t,Math.ceil((p-f)/11.25),Math.ceil((y-b)/11.25),1,(T,A,R)=>{if(T===0)return .5*(A+R);{const P=Gs((o.y+A/Gt)/u);return(Wu(.5*(Gs((o.y+R/Gt)/u)+P))*u-o.y)*Gt}})}function n2(i,t,o,u,f,p){const y=Math.pow(2,u.z-f.z);for(let b=0;b<o;b++){let T=i.int16[2*(b+t)+0],A=i.int16[2*(b+t)+1];T=(T+f.x*Gt)*y-u.x*Gt,A=(A+f.y*Gt)*y-u.y*Gt,p.push(new Ut(T,A))}}er(Qx,"FillExtrusionBucket",{omit:["layers","features"]}),er(AP,"PartData"),er(EP,"FootprintSegment"),er(IP,"BorderCentroidData"),er(CP,"GroundEffect");const s2=new Ue({visibility:new Oe(me["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Oe(me["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var o2={paint:new Ue({"fill-extrusion-opacity":new Oe(me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new He(me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Oe(me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Oe(me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new He(me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new He(me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new He(me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Oe(me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Oe(me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Oe(me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Oe(me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Oe(me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Oe(me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Oe(me["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Oe(me["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new He(me["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new He(me["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Oe(me["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Oe(me["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Oe(me["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Oe(me["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Oe(me["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:s2};class __ extends Ut{constructor(t,o,u){super(t,o),this.z=u}}function uy(i,t){return i.x*t.x+i.y*t.y}function zP(i,t){if(i.length===1){let o=0;const u=t[o++];let f;for(;!f||u.equals(f);)if(f=t[o++],!f)return 1/0;for(;o<t.length;o++){const p=t[o],y=i[0],b=f.sub(u),T=p.sub(u),A=y.sub(u),R=uy(b,b),P=uy(b,T),L=uy(T,T),z=uy(A,b),N=uy(A,T),U=R*L-P*P,H=(L*z-P*N)/U,W=(R*N-P*z)/U,ie=u.z*(1-H-W)+f.z*H+p.z*W;if(isFinite(ie))return ie}return 1/0}{let o=1/0;for(const u of t)o=Math.min(o,u.z);return o}}function FP(i,t,o,u,f,p,y,b){const T=y*f.getElevationAt(i,t,!0,!0),A=p[0]!==0,R=A?p[1]===0?y*(p[0]/7-450):y*function(P,L,z){const N=Math.floor(L[0]/8),U=Math.floor(L[1]/8),H=10*(L[0]-8*N),W=10*(L[1]-8*U),ie=P.getElevationAt(N,U,!0,!0),le=P.getMeterToDEM(z),se=Math.floor(.5*(H*le-1)),we=Math.floor(.5*(W*le-1)),he=P.tileCoordToPixel(N,U),Pe=2*se+1,Le=2*we+1,qe=function(wt,xt,St,Et,gt){return[wt.getElevationAtPixel(xt,St,!0),wt.getElevationAtPixel(xt+gt,St,!0),wt.getElevationAtPixel(xt,St+gt,!0),wt.getElevationAtPixel(xt+Et,St+gt,!0)]}(P,he.x-se,he.y-we,Pe,Le),ot=Math.abs(qe[0]-qe[1]),Ye=Math.abs(qe[2]-qe[3]),mt=Math.abs(qe[0]-qe[2])+Math.abs(qe[1]-qe[3]),pt=Math.min(.25,.5*le*(ot+Ye)/Pe),at=Math.min(.25,.5*le*mt/Le);return ie+Math.max(pt*H,at*W)}(f,p,b):T;return{base:T+(o===0)?-1:o,top:A?Math.max(R+u,T+o+2):T+u}}const a2=Gr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:l2}=a2,c2=Gr([{name:"a_packed",components:4,type:"Float32"}]),{members:u2}=c2,h2=Gr([{name:"a_pattern_data",components:2,type:"Float32"}]),{members:d2}=h2;class NP{constructor(t,o){this.width=t,this.height=o,this.nextRow=0,this.image=new sd({width:t,height:o}),this.positions={},this.uploaded=!1}getDash(t,o){const u=this.getKey(t,o);return this.positions[u]}trim(){const t=this.width,o=this.height=Pu(this.nextRow);this.image.resize({width:t,height:o})}getKey(t,o){return t.join(",")+o}getDashRanges(t,o,u){const f=[];let p=t.length%2==1?-t[t.length-1]*u:0,y=t[0]*u,b=!0;f.push({left:p,right:y,isDash:b,zeroLength:t[0]===0});let T=t[0];for(let A=1;A<t.length;A++){b=!b;const R=t[A];p=T*u,T+=R,y=T*u,f.push({left:p,right:y,isDash:b,zeroLength:R===0})}return f}addRoundDash(t,o,u){const f=o/2;for(let p=-u;p<=u;p++){const y=this.width*(this.nextRow+u+p);let b=0,T=t[b];for(let A=0;A<this.width;A++){A/T.right>1&&(T=t[++b]);const R=Math.abs(A-T.left),P=Math.abs(A-T.right),L=Math.min(R,P);let z;const N=p/u*(f+1);if(T.isDash){const U=f-Math.abs(N);z=Math.sqrt(L*L+U*U)}else z=f-Math.sqrt(L*L+N*N);this.image.data[y+A]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(t,o){for(let T=t.length-1;T>=0;--T){const A=t[T],R=t[T+1];A.zeroLength?t.splice(T,1):R&&R.isDash===A.isDash&&(R.left=A.left,t.splice(T,1))}const u=t[0],f=t[t.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);const p=this.width*this.nextRow;let y=0,b=t[y];for(let T=0;T<this.width;T++){T/b.right>1&&(b=t[++y]);const A=Math.abs(T-b.left),R=Math.abs(T-b.right),P=Math.min(A,R);this.image.data[p+T]=Math.max(0,Math.min(255,(b.isDash?P:-P)+o+128))}}addDash(t,o){const u=this.getKey(t,o);if(this.positions[u])return this.positions[u];const f=o==="round",p=f?7:0,y=2*p+1;if(this.nextRow+y>this.height)return gn("LineAtlas out of space"),null;t.length===0&&t.push(1);let b=0;for(let R=0;R<t.length;R++)t[R]<0&&(gn("Negative value is found in line dasharray, replacing values with 0"),t[R]=0),b+=t[R];if(b!==0){const R=this.width/b,P=this.getDashRanges(t,this.width,R);f?this.addRoundDash(P,R,p):this.addRegularDash(P,o==="square"?.5*R:0)}const T=this.nextRow+p;this.nextRow+=y;const A={tl:[T,p],br:[b,0]};return this.positions[u]=A,A}}er(NP,"LineAtlas");const f2=Hx.types,p2=Math.cos(Math.PI/180*37.5),m2=Math.cos(Math.PI/180*5);class X5{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new to,this.layoutVertexArray2=new gs,this.patternVertexArray=new Cs,this.indexArray=new ys,this.programConfigurations=new ed(t.layers,t.zoom),this.segments=new jn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,u,f){this.hasPattern=G5("line",this.layers,o);const p=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:R,id:P,index:L,sourceLayerIndex:z}of t){const N=this.layers[0]._featureFilter.needGeometry,U=id(R,N);if(!this.layers[0]._featureFilter.filter(new J(this.zoom),U,u))continue;const H=p?p.evaluate(U,{},u):void 0,W={id:P,properties:R.properties,type:R.type,sourceLayerIndex:z,index:L,geometry:N?U.geometry:Zu(R,u,f),patterns:{},sortKey:H};y.push(W)}p&&y.sort((R,P)=>R.sortKey-P.sortKey);const{lineAtlas:b,featureIndex:T}=o,A=this.addConstantDashes(b);for(const R of y){const{geometry:P,index:L,sourceLayerIndex:z}=R;if(A&&this.addFeatureDashes(R,b),this.hasPattern){const N=q5("line",this.layers,R,this.zoom,o);this.patternFeatures.push(N)}else this.addFeature(R,P,L,u,b.positions,o.availableImages,o.brightness);T.insert(t[L].feature,P,L,z,this.index)}}addConstantDashes(t){let o=!1;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,p=u.layout.get("line-cap").value;if(f.kind!=="constant"||p.kind!=="constant")o=!0;else{const y=p.value,b=f.value;if(!b)continue;t.addDash(b,y)}}return o}addFeatureDashes(t,o){const u=this.zoom;for(const f of this.layers){const p=f.paint.get("line-dasharray").value,y=f.layout.get("line-cap").value;if(p.kind==="constant"&&y.kind==="constant")continue;let b,T;if(p.kind==="constant"){if(b=p.value,!b)continue}else b=p.evaluate({zoom:u},t);T=y.kind==="constant"?y.value:y.evaluate({zoom:u},t),o.addDash(b,T),t.patterns[f.id]=o.getKey(b,T)}}update(t,o,u,f,p){const y=Object.keys(t).length!==0;y&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,o,y?this.stateDependentLayers:this.layers,u,f,p)}addFeatures(t,o,u,f,p,y){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,o,u,f,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,u2)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,d2)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,l2),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,o,u,f,p,y,b){const T=this.layers[0].layout,A=T.get("line-join").evaluate(t,{}),R=T.get("line-cap").evaluate(t,{}),P=T.get("line-miter-limit"),L=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const z of o)this.addLine(z,t,A,R,P,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,p,y,f,b)}addLine(t,o,u,f,p,y){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0;const b=u==="none";if(this.patternJoinNone=this.hasPattern&&b,this.segmentStart=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<t.length-1;ie++)this.totalDistance+=t[ie].dist(t[ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=f2[o.type]==="Polygon";let A=t.length;for(;A>=2&&t[A-1].equals(t[A-2]);)A--;let R=0;for(;R<A-1&&t[R].equals(t[R+1]);)R++;if(A<(T?3:2))return;u==="bevel"&&(p=1.05);const P=this.overscaling<=16?15*Gt/(512*this.overscaling):0,L=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let z,N,U,H,W;this.e1=this.e2=-1,T&&(z=t[A-2],W=t[R].sub(z)._unit()._perp());for(let ie=R;ie<A;ie++){if(U=ie===A-1?T?t[R+1]:void 0:t[ie+1],U&&t[ie].equals(U))continue;W&&(H=W),z&&(N=z),z=t[ie],W=U?U.sub(z)._unit()._perp():H,H=H||W;const le=N&&U;let se=le?u:T||b?"butt":f;const we=H.x*W.x+H.y*W.y;if(b){const mt=function(pt){if(pt.patternJoinNone){const at=pt.segmentPoints.length/2,wt=pt.lineSoFar-pt.segmentStart;for(let xt=0;xt<at;++xt){const St=pt.segmentPoints[2*xt+1],Et=Math.round(pt.segmentPoints[2*xt])+.5+.25*St;pt.patternVertexArray.emplaceBack(Et,wt),pt.patternVertexArray.emplaceBack(Et,wt)}pt.segmentPoints=[],pt.segmentStart=pt.lineSoFar}pt.e1=pt.e2=-1};if(le&&we<m2){this.updateDistance(N,z),this.addCurrentVertex(z,H,1,1,L),mt(this),this.addCurrentVertex(z,W,-1,-1,L);continue}if(N){if(!U){this.updateDistance(N,z),this.addCurrentVertex(z,H,1,1,L),mt(this);continue}se="miter"}}let he=H.add(W);he.x===0&&he.y===0||he._unit();const Pe=he.x*W.x+he.y*W.y,Le=Pe!==0?1/Pe:1/0,qe=2*Math.sqrt(2-2*Pe),ot=Pe<p2&&N&&U,Ye=H.x*W.y-H.y*W.x>0;if(ot&&ie>R){const mt=z.dist(N);if(mt>2*P){const pt=z.sub(z.sub(N)._mult(P/mt)._round());this.updateDistance(N,pt),this.addCurrentVertex(pt,H,0,0,L),N=pt}}if(le&&se==="round"&&(Le<y?se="miter":Le<=2&&(se="fakeround")),se==="miter"&&Le>p&&(se="bevel"),se==="bevel"&&(Le>2&&(se="flipbevel"),Le<p&&(se="miter")),N&&this.updateDistance(N,z),se==="miter")he._mult(Le),this.addCurrentVertex(z,he,0,0,L);else if(se==="flipbevel"){if(Le>100)he=W.mult(-1);else{const mt=Le*H.add(W).mag()/H.sub(W).mag();he._perp()._mult(mt*(Ye?-1:1))}this.addCurrentVertex(z,he,0,0,L),this.addCurrentVertex(z,he.mult(-1),0,0,L)}else if(se==="bevel"||se==="fakeround"){const mt=-Math.sqrt(Le*Le-1),pt=Ye?mt:0,at=Ye?0:mt;if(N&&this.addCurrentVertex(z,H,pt,at,L),se==="fakeround"){const wt=Math.round(180*qe/Math.PI/20);for(let xt=1;xt<wt;xt++){let St=xt/wt;if(St!==.5){const gt=St-.5;St+=St*gt*(St-1)*((1.0904+we*(we*(3.55645-1.43519*we)-3.2452))*gt*gt+(.848013+we*(.215638*we-1.06021)))}const Et=W.sub(H)._mult(St)._add(H)._unit()._mult(Ye?-1:1);this.addHalfVertex(z,Et.x,Et.y,!1,Ye,0,L)}}U&&this.addCurrentVertex(z,W,-pt,-at,L)}else se==="butt"?this.addCurrentVertex(z,he,0,0,L):se==="square"?(N||this.addCurrentVertex(z,he,-1,-1,L),this.addCurrentVertex(z,he,0,0,L),N&&this.addCurrentVertex(z,he,1,1,L)):se==="round"&&(N&&(this.addCurrentVertex(z,H,0,0,L),this.addCurrentVertex(z,H,1,1,L,!0)),U&&(this.addCurrentVertex(z,W,-1,-1,L,!0),this.addCurrentVertex(z,W,0,0,L)));if(ot&&ie<A-1){const mt=z.dist(U);if(mt>2*P){const pt=z.add(U.sub(z)._mult(P/mt)._round());this.updateDistance(z,pt),this.addCurrentVertex(pt,W,0,0,L),z=pt}}}}addCurrentVertex(t,o,u,f,p,y=!1){const b=o.y*f-o.x,T=-o.y-o.x*f;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,y,!1,u,p),this.addHalfVertex(t,b,T,y,!0,-f,p),this.patternJoinNone&&this.segmentPoints.push(this.lineSoFar-this.segmentStart,u)}addHalfVertex({x:t,y:o},u,f,p,y,b,T){this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(o<<1)+(y?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const A=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),T.primitiveLength++),y?this.e2=A:this.e1=A}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,o){this.distance+=t.dist(o),this.updateScaledDistance()}}er(X5,"LineBucket",{omit:["layers","patternFeatures"]});const _2=new Ue({"line-cap":new He(me.layout_line["line-cap"]),"line-join":new He(me.layout_line["line-join"]),"line-miter-limit":new Oe(me.layout_line["line-miter-limit"]),"line-round-limit":new Oe(me.layout_line["line-round-limit"]),"line-sort-key":new He(me.layout_line["line-sort-key"]),visibility:new Oe(me.layout_line.visibility)});var BP={paint:new Ue({"line-opacity":new He(me.paint_line["line-opacity"]),"line-color":new He(me.paint_line["line-color"]),"line-translate":new Oe(me.paint_line["line-translate"]),"line-translate-anchor":new Oe(me.paint_line["line-translate-anchor"]),"line-width":new He(me.paint_line["line-width"]),"line-gap-width":new He(me.paint_line["line-gap-width"]),"line-offset":new He(me.paint_line["line-offset"]),"line-blur":new He(me.paint_line["line-blur"]),"line-dasharray":new He(me.paint_line["line-dasharray"]),"line-pattern":new He(me.paint_line["line-pattern"]),"line-gradient":new Tt(me.paint_line["line-gradient"]),"line-trim-offset":new Oe(me.paint_line["line-trim-offset"]),"line-emissive-strength":new Oe(me.paint_line["line-emissive-strength"]),"line-border-width":new He(me.paint_line["line-border-width"]),"line-border-color":new He(me.paint_line["line-border-color"])}),layout:_2};function VP(i,t,o){return t*(Gt/(i.tileSize*Math.pow(2,o-i.tileID.overscaledZ)))}function UP(i,t){return 1/VP(i,1,t.tileZoom)}function jP(i,t,o,u){return i.translatePosMatrix(u||t.tileID.projMatrix,t,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const $P=i=>{const t=[];GP(i)&&t.push("RENDER_LINE_DASH"),i.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const o=i.paint.get("line-trim-offset");o[0]===0&&o[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),i.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER");const u=i.layout.get("line-join").constantOr("miter")==="none",f=!!i.paint.get("line-pattern").constantOr(1);return u&&f&&t.push("LINE_JOIN_NONE"),t};function GP(i){const t=i.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}const qP=new class extends He{possiblyEvaluate(i,t){return t=new J(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(i,t)}evaluate(i,t,o,u){return t=_o({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(i,t,o,u)}}(BP.paint.properties["line-width"].specification);function HP(i,t){return t>0?t+2*i:i}qP.useIntegerZoom=!0;const g2=Gr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),y2=Gr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),v2=Gr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Gr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const x2=Gr([{name:"a_z_offset",components:1,type:"Float32"}],4),b2=Gr([{name:"a_texb",components:2,type:"Uint16"}]),w2=Gr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),T2=Gr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Gr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const WP=Gr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),E2=Gr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Gr([{name:"triangle",components:3,type:"Uint16"}]),Gr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Gr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Gr([{type:"Float32",name:"offsetX"}]),Gr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var qs=24;const oc=128;function Y5(i,t){const{expression:o}=t;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new J(i+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:f}=o;let p=0;for(;p<u.length&&u[p]<=i;)p++;p=Math.max(0,p-1);let y=p;for(;y<u.length&&u[y]<i+1;)y++;y=Math.min(u.length-1,y);const b=u[p],T=u[y];return o.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:T,interpolationType:f}:{kind:"camera",minZoom:b,maxZoom:T,minSize:o.evaluate(new J(b)),maxSize:o.evaluate(new J(T)),interpolationType:f}}}function Kx(i,{uSize:t,uSizeT:o},{lowerSize:u,upperSize:f}){return i.kind==="source"?u/oc:i.kind==="composite"?ri(u/oc,f/oc,o):t}function g_(i,t){let o=0,u=0;if(i.kind==="constant")u=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:f,minZoom:p,maxZoom:y}=i,b=f?ti(oa.interpolationFactor(f,t,p,y),0,1):0;i.kind==="camera"?u=ri(i.minSize,i.maxSize,b):o=b}return{uSizeT:o,uSize:u}}var A2=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:oc,evaluateSizeForFeature:Kx,evaluateSizeForZoom:g_,getSizeData:Y5});function I2(i,t,o){return i.sections.forEach(u=>{u.text=function(f,p,y){const b=p.layout.get("text-transform").evaluate(y,{});return b==="uppercase"?f=f.toLocaleUpperCase():b==="lowercase"&&(f=f.toLocaleLowerCase()),ye.applyArabicShaping&&(f=ye.applyArabicShaping(f)),f}(u.text,t,o)}),i}const hy={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function S2(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}function C2(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}var R2={read:function(i,t,o,u,f){var p,y,b=8*f-u-1,T=(1<<b)-1,A=T>>1,R=-7,P=o?f-1:0,L=o?-1:1,z=i[t+P];for(P+=L,p=z&(1<<-R)-1,z>>=-R,R+=b;R>0;p=256*p+i[t+P],P+=L,R-=8);for(y=p&(1<<-R)-1,p>>=-R,R+=u;R>0;y=256*y+i[t+P],P+=L,R-=8);if(p===0)p=1-A;else{if(p===T)return y?NaN:1/0*(z?-1:1);y+=Math.pow(2,u),p-=A}return(z?-1:1)*y*Math.pow(2,p-u)},write:function(i,t,o,u,f,p){var y,b,T,A=8*p-f-1,R=(1<<A)-1,P=R>>1,L=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=u?0:p-1,N=u?1:-1,U=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(b=isNaN(t)?1:0,y=R):(y=Math.floor(Math.log(t)/Math.LN2),t*(T=Math.pow(2,-y))<1&&(y--,T*=2),(t+=y+P>=1?L/T:L*Math.pow(2,1-P))*T>=2&&(y++,T/=2),y+P>=R?(b=0,y=R):y+P>=1?(b=(t*T-1)*Math.pow(2,f),y+=P):(b=t*Math.pow(2,P-1)*Math.pow(2,f),y=0));f>=8;i[o+z]=255&b,z+=N,b/=256,f-=8);for(y=y<<f|b,A+=f;A>0;i[o+z]=255&y,z+=N,y/=256,A-=8);i[o+z-N]|=128*U}},ZP=xn,Jx=R2;function xn(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}xn.Varint=0,xn.Fixed64=1,xn.Bytes=2,xn.Fixed32=5;var Q5=4294967296,XP=1/Q5,YP=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Yu(i){return i.type===xn.Bytes?i.readVarint()+i.pos:i.pos+1}function y_(i,t,o){return o?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function QP(i,t,o){var u=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));o.realloc(u);for(var f=o.pos-1;f>=i;f--)o.buf[f+u]=o.buf[f]}function P2(i,t){for(var o=0;o<i.length;o++)t.writeVarint(i[o])}function M2(i,t){for(var o=0;o<i.length;o++)t.writeSVarint(i[o])}function k2(i,t){for(var o=0;o<i.length;o++)t.writeFloat(i[o])}function D2(i,t){for(var o=0;o<i.length;o++)t.writeDouble(i[o])}function L2(i,t){for(var o=0;o<i.length;o++)t.writeBoolean(i[o])}function O2(i,t){for(var o=0;o<i.length;o++)t.writeFixed32(i[o])}function z2(i,t){for(var o=0;o<i.length;o++)t.writeSFixed32(i[o])}function F2(i,t){for(var o=0;o<i.length;o++)t.writeFixed64(i[o])}function N2(i,t){for(var o=0;o<i.length;o++)t.writeSFixed64(i[o])}function eb(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function v_(i,t,o){i[o]=t,i[o+1]=t>>>8,i[o+2]=t>>>16,i[o+3]=t>>>24}function KP(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}xn.prototype={destroy:function(){this.buf=null},readFields:function(i,t,o){for(o=o||this.length;this.pos<o;){var u=this.readVarint(),f=u>>3,p=this.pos;this.type=7&u,i(f,t,this),this.pos===p&&this.skip(u)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=eb(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=KP(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=eb(this.buf,this.pos)+eb(this.buf,this.pos+4)*Q5;return this.pos+=8,i},readSFixed64:function(){var i=eb(this.buf,this.pos)+KP(this.buf,this.pos+4)*Q5;return this.pos+=8,i},readFloat:function(){var i=Jx.read(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Jx.read(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,o,u=this.buf;return t=127&(o=u[this.pos++]),o<128?t:(t|=(127&(o=u[this.pos++]))<<7,o<128?t:(t|=(127&(o=u[this.pos++]))<<14,o<128?t:(t|=(127&(o=u[this.pos++]))<<21,o<128?t:function(f,p,y){var b,T,A=y.buf;if(b=(112&(T=A[y.pos++]))>>4,T<128||(b|=(127&(T=A[y.pos++]))<<3,T<128)||(b|=(127&(T=A[y.pos++]))<<10,T<128)||(b|=(127&(T=A[y.pos++]))<<17,T<128)||(b|=(127&(T=A[y.pos++]))<<24,T<128)||(b|=(1&(T=A[y.pos++]))<<31,T<128))return y_(f,b,p);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(o=u[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&YP?function(o,u,f){return YP.decode(o.subarray(u,f))}(this.buf,t,i):function(o,u,f){for(var p="",y=u;y<f;){var b,T,A,R=o[y],P=null,L=R>239?4:R>223?3:R>191?2:1;if(y+L>f)break;L===1?R<128&&(P=R):L===2?(192&(b=o[y+1]))==128&&(P=(31&R)<<6|63&b)<=127&&(P=null):L===3?(T=o[y+2],(192&(b=o[y+1]))==128&&(192&T)==128&&((P=(15&R)<<12|(63&b)<<6|63&T)<=2047||P>=55296&&P<=57343)&&(P=null)):L===4&&(T=o[y+2],A=o[y+3],(192&(b=o[y+1]))==128&&(192&T)==128&&(192&A)==128&&((P=(15&R)<<18|(63&b)<<12|(63&T)<<6|63&A)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,L=1):P>65535&&(P-=65536,p+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),p+=String.fromCharCode(P),y+=L}return p}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==xn.Bytes)return i.push(this.readVarint(t));var o=Yu(this);for(i=i||[];this.pos<o;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==xn.Bytes)return i.push(this.readSVarint());var t=Yu(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==xn.Bytes)return i.push(this.readBoolean());var t=Yu(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==xn.Bytes)return i.push(this.readFloat());var t=Yu(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==xn.Bytes)return i.push(this.readDouble());var t=Yu(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==xn.Bytes)return i.push(this.readFixed32());var t=Yu(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==xn.Bytes)return i.push(this.readSFixed32());var t=Yu(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==xn.Bytes)return i.push(this.readFixed64());var t=Yu(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==xn.Bytes)return i.push(this.readSFixed64());var t=Yu(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===xn.Varint)for(;this.buf[this.pos++]>127;);else if(t===xn.Bytes)this.pos=this.readVarint()+this.pos;else if(t===xn.Fixed32)this.pos+=4;else{if(t!==xn.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var o=new Uint8Array(t);o.set(this.buf),this.buf=o,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),v_(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),v_(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),v_(this.buf,-1&i,this.pos),v_(this.buf,Math.floor(i*XP),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),v_(this.buf,-1&i,this.pos),v_(this.buf,Math.floor(i*XP),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,o){var u,f;if(t>=0?(u=t%4294967296|0,f=t/4294967296|0):(f=~(-t/4294967296),4294967295^(u=~(-t%4294967296))?u=u+1|0:(u=0,f=f+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(p,y,b){b.buf[b.pos++]=127&p|128,p>>>=7,b.buf[b.pos++]=127&p|128,p>>>=7,b.buf[b.pos++]=127&p|128,p>>>=7,b.buf[b.pos++]=127&p|128,b.buf[b.pos]=127&(p>>>=7)}(u,0,o),function(p,y){var b=(7&p)<<4;y.buf[y.pos++]|=b|((p>>>=3)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p)))))}(f,o)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(u,f,p){for(var y,b,T=0;T<f.length;T++){if((y=f.charCodeAt(T))>55295&&y<57344){if(!b){y>56319||T+1===f.length?(u[p++]=239,u[p++]=191,u[p++]=189):b=y;continue}if(y<56320){u[p++]=239,u[p++]=191,u[p++]=189,b=y;continue}y=b-55296<<10|y-56320|65536,b=null}else b&&(u[p++]=239,u[p++]=191,u[p++]=189,b=null);y<128?u[p++]=y:(y<2048?u[p++]=y>>6|192:(y<65536?u[p++]=y>>12|224:(u[p++]=y>>18|240,u[p++]=y>>12&63|128),u[p++]=y>>6&63|128),u[p++]=63&y|128)}return p}(this.buf,i,this.pos);var o=this.pos-t;o>=128&&QP(t,o,this),this.pos=t-1,this.writeVarint(o),this.pos+=o},writeFloat:function(i){this.realloc(4),Jx.write(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Jx.write(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var o=0;o<t;o++)this.buf[this.pos++]=i[o]},writeRawMessage:function(i,t){this.pos++;var o=this.pos;i(t,this);var u=this.pos-o;u>=128&&QP(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeMessage:function(i,t,o){this.writeTag(i,xn.Bytes),this.writeRawMessage(t,o)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,P2,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,M2,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,L2,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,k2,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,D2,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,O2,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,z2,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,F2,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,N2,t)},writeBytesField:function(i,t){this.writeTag(i,xn.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,xn.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,xn.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,xn.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,xn.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,xn.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,xn.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,xn.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,xn.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,xn.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var x_=Ie(ZP);const K5=3;function B2(i,t,o){t.glyphs=[],i===1&&o.readMessage(V2,t)}function V2(i,t,o){if(i===3){const{id:u,bitmap:f,width:p,height:y,left:b,top:T,advance:A}=o.readMessage(U2,{});t.glyphs.push({id:u,bitmap:new sd({width:p+2*K5,height:y+2*K5},f),metrics:{width:p,height:y,left:b,top:T,advance:A}})}else i===4?t.ascender=o.readSVarint():i===5&&(t.descender=o.readSVarint())}function U2(i,t,o){i===1?t.id=o.readVarint():i===2?t.bitmap=o.readBytes():i===3?t.width=o.readVarint():i===4?t.height=o.readVarint():i===5?t.left=o.readSVarint():i===6?t.top=o.readSVarint():i===7&&(t.advance=o.readVarint())}const JP=K5,il={horizontal:1,vertical:2,horizontalOnly:3};class dy{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,o){const u=new dy;return u.scale=t||1,u.fontStack=o,u}static forImage(t){const o=new dy;return o.imageName=t,o}}class b_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,o){const u=new b_;for(let f=0;f<t.sections.length;f++){const p=t.sections[f];p.image?u.addImageSection(p):u.addTextSection(p,o)}return u}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(o,u){let f="";for(let p=0;p<o.length;p++){const y=o.charCodeAt(p+1)||null,b=o.charCodeAt(p-1)||null;f+=!u&&(y&&E(y)&&!hy[o[p+1]]||b&&E(b)&&!hy[o[p-1]])||!hy[o[p]]?o[p]:hy[o[p]]}return f}(this.text,t)}trim(){let t=0;for(let u=0;u<this.text.length&&tb[this.text.charCodeAt(u)];u++)t++;let o=this.text.length;for(let u=this.text.length-1;u>=0&&u>=t&&tb[this.text.charCodeAt(u)];u--)o--;this.text=this.text.substring(t,o),this.sectionIndex=this.sectionIndex.slice(t,o)}substring(t,o){const u=new b_;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,o)=>Math.max(t,this.sections[o].scale),0)}addTextSection(t,o){this.text+=t.text,this.sections.push(dy.forText(t.scale,t.fontStack||o));const u=this.sections.length-1;for(let f=0;f<t.text.length;++f)this.sectionIndex.push(u)}addImageSection(t){const o=t.image?t.image.namePrimary:"";if(o.length===0)return void gn("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(dy.forImage(o)),this.sectionIndex.push(this.sections.length-1)):gn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function J5(i,t,o,u,f,p,y,b,T,A,R,P,L,z,N){const U=b_.fromFeature(i,f);P===il.vertical&&U.verticalizePunctuation(L);let H=[];const W=function(he,Pe,Le,qe,ot,Ye){if(!he)return[];const mt=[],pt=function(St,Et,gt,nr,Qt,kt){let xr=0;for(let dr=0;dr<St.length();dr++){const sr=St.getSection(dr);xr+=eM(St.getCodePoint(dr),sr,nr,Qt,Et,kt)}return xr/Math.max(1,Math.ceil(xr/gt))}(he,Pe,Le,qe,ot,Ye),at=he.text.indexOf("")>=0;let wt=0;for(let St=0;St<he.length();St++){const Et=he.getSection(St),gt=he.getCodePoint(St);if(tb[gt]||(wt+=eM(gt,Et,qe,ot,Pe,Ye)),St<he.length()-1){const nr=!((xt=gt)<11904||!(a["Bopomofo Extended"](xt)||a.Bopomofo(xt)||a["CJK Compatibility Forms"](xt)||a["CJK Compatibility Ideographs"](xt)||a["CJK Compatibility"](xt)||a["CJK Radicals Supplement"](xt)||a["CJK Strokes"](xt)||a["CJK Symbols and Punctuation"](xt)||a["CJK Unified Ideographs Extension A"](xt)||a["CJK Unified Ideographs"](xt)||a["Enclosed CJK Letters and Months"](xt)||a["Halfwidth and Fullwidth Forms"](xt)||a.Hiragana(xt)||a["Ideographic Description Characters"](xt)||a["Kangxi Radicals"](xt)||a["Katakana Phonetic Extensions"](xt)||a.Katakana(xt)||a["Vertical Forms"](xt)||a["Yi Radicals"](xt)||a["Yi Syllables"](xt)));(j2[gt]||nr||Et.imageName)&&mt.push(rM(St+1,wt,pt,mt,$2(gt,he.getCodePoint(St+1),nr&&at),!1))}}var xt;return iM(rM(he.length(),wt,pt,mt,0,!0))}(U,A,p,t,u,z),{processBidirectionalText:ie,processStyledBidirectionalText:le}=ye;if(ie&&U.sections.length===1){const he=ie(U.toString(),W);for(const Pe of he){const Le=new b_;Le.text=Pe,Le.sections=U.sections;for(let qe=0;qe<Pe.length;qe++)Le.sectionIndex.push(0);H.push(Le)}}else if(le){const he=le(U.text,U.sectionIndex,W);for(const Pe of he){const Le=new b_;Le.text=Pe[0],Le.sectionIndex=Pe[1],Le.sections=U.sections,H.push(Le)}}else H=function(he,Pe){const Le=[],qe=he.text;let ot=0;for(const Ye of Pe)Le.push(he.substring(ot,Ye)),ot=Ye;return ot<qe.length&&Le.push(he.substring(ot,qe.length)),Le}(U,W);const se=[],we={positionedLines:se,text:U.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(he,Pe,Le,qe,ot,Ye,mt,pt,at,wt,xt,St){let Et=0,gt=0,nr=0;const Qt=pt==="right"?1:pt==="left"?0:.5;let kt=!1;for(const Wr of ot){const Rr=Wr.getSections();for(const Yr of Rr){if(Yr.imageName)continue;const Zr=Pe[Yr.fontStack];if(Zr&&(kt=Zr.ascender!==void 0&&Zr.descender!==void 0,!kt))break}if(!kt)break}let xr=0;for(const Wr of ot){Wr.trim();const Rr=Wr.getMaxScale(),Yr=(Rr-1)*qs,Zr={positionedGlyphs:[],lineOffset:0};he.positionedLines[xr]=Zr;const ai=Zr.positionedGlyphs;let Ar=0;if(!Wr.length()){gt+=Ye,++xr;continue}let Gi=0,$i=0;for(let xi=0;xi<Wr.length();xi++){const Mi=Wr.getSection(xi),cn=Wr.getSectionIndex(xi),Ki=Wr.getCodePoint(xi);let Rn=Mi.scale,An=null,no=null,Fn=null,bn=qs,es=0;const Ps=!(at===il.horizontal||!xt&&!w(Ki)||xt&&(tb[Ki]||(dr=Ki,a.Arabic(dr)||a["Arabic Supplement"](dr)||a["Arabic Extended-A"](dr)||a["Arabic Presentation Forms-A"](dr)||a["Arabic Presentation Forms-B"](dr))));if(Mi.imageName){const Ms=qe[Mi.imageName];if(!Ms)continue;Fn=Mi.imageName,he.iconsInText=he.iconsInText||!0,no=Ms.paddedRect;const rn=Ms.displaySize;Rn=Rn*qs/St,An={width:rn[0],height:rn[1],left:0,top:-JP,advance:Ps?rn[1]:rn[0],localGlyph:!1},es=kt?-An.height*Rn:Rr*qs-17-rn[1]*Rn,bn=An.advance;const Bo=(Ps?rn[0]:rn[1])*Rn-qs*Rr;Bo>0&&Bo>Ar&&(Ar=Bo)}else{const Ms=Le[Mi.fontStack];if(!Ms)continue;Ms[Ki]&&(no=Ms[Ki]);const rn=Pe[Mi.fontStack];if(!rn)continue;const Bo=rn.glyphs[Ki];if(!Bo)continue;if(An=Bo.metrics,bn=Ki!==8203?qs:0,kt){const Ku=rn.ascender!==void 0?Math.abs(rn.ascender):0,Pl=rn.descender!==void 0?Math.abs(rn.descender):0,dc=(Ku+Pl)*Rn;Gi<dc&&(Gi=dc,$i=(Ku-Pl)/2*Rn),es=-Ku*Rn}else es=(Rr-Rn)*qs-17}Ps?(he.verticalizable=!0,ai.push({glyph:Ki,imageName:Fn,x:Et,y:gt+es,vertical:Ps,scale:Rn,localGlyph:An.localGlyph,fontStack:Mi.fontStack,sectionIndex:cn,metrics:An,rect:no}),Et+=bn*Rn+wt):(ai.push({glyph:Ki,imageName:Fn,x:Et,y:gt+es,vertical:Ps,scale:Rn,localGlyph:An.localGlyph,fontStack:Mi.fontStack,sectionIndex:cn,metrics:An,rect:no}),Et+=An.advance*Rn+wt)}ai.length!==0&&(nr=Math.max(Et-wt,nr),kt?nM(ai,Qt,Ar,$i,Ye*Rr/2):nM(ai,Qt,Ar,0,Ye/2)),Et=0;const Pi=Ye*Rr+Ar;Zr.lineOffset=Math.max(Ar,Yr),gt+=Pi,++xr}var dr;const sr=gt,{horizontalAlign:Dt,verticalAlign:yr}=e4(mt);(function(Wr,Rr,Yr,Zr,ai,Ar){const Gi=(Rr-Yr)*ai,$i=-Ar*Zr;for(const Pi of Wr)for(const xi of Pi.positionedGlyphs)xi.x+=Gi,xi.y+=$i})(he.positionedLines,Qt,Dt,yr,nr,sr),he.top+=-yr*sr,he.bottom=he.top+sr,he.left+=-Dt*nr,he.right=he.left+nr,he.hasBaseline=kt}(we,t,o,u,H,y,b,T,P,A,L,N),!function(he){for(const Pe of he)if(Pe.positionedGlyphs.length!==0)return!1;return!0}(se)&&we}const tb={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},j2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function eM(i,t,o,u,f,p){if(t.imageName){const y=u[t.imageName];return y?y.displaySize[0]*t.scale*qs/p+f:0}{const y=o[t.fontStack],b=y&&y.glyphs[i];return b?b.metrics.advance*t.scale+f:0}}function tM(i,t,o,u){const f=Math.pow(i-t,2);return u?i<t?f/2:2*f:f+Math.abs(o)*o}function $2(i,t,o){let u=0;return i===10&&(u-=1e4),o&&(u+=150),i!==40&&i!==65288||(u+=50),t!==41&&t!==65289||(u+=50),u}function rM(i,t,o,u,f,p){let y=null,b=tM(t,o,f,p);for(const T of u){const A=tM(t-T.x,o,f,p)+T.badness;A<=b&&(y=T,b=A)}return{index:i,x:t,priorBreak:y,badness:b}}function iM(i){return i?iM(i.priorBreak).concat(i.index):[]}function e4(i){let t=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:t,verticalAlign:o}}function nM(i,t,o,u,f){if(!(t||o||u||f))return;const p=i.length-1,y=i[p],b=(y.x+y.metrics.advance*y.scale)*t;for(let T=0;T<=p;T++)i[T].x-=b,i[T].y+=o+u+f}function G2(i,t,o,u){const{horizontalAlign:f,verticalAlign:p}=e4(u),y=o[0]-i.displaySize[0]*f,b=o[1]-i.displaySize[1]*p;return{imagePrimary:i,imageSecondary:t,top:b,bottom:b+i.displaySize[1],left:y,right:y+i.displaySize[0]}}function sM(i,t,o,u,f,p){const y=i.imagePrimary;let b;if(y.content){const H=y.content,W=y.pixelRatio||1;b=[H[0]/W,H[1]/W,y.displaySize[0]-H[2]/W,y.displaySize[1]-H[3]/W]}const T=t.left*p,A=t.right*p;let R,P,L,z;o==="width"||o==="both"?(z=f[0]+T-u[3],P=f[0]+A+u[1]):(z=f[0]+(T+A-y.displaySize[0])/2,P=z+y.displaySize[0]);const N=t.top*p,U=t.bottom*p;return o==="height"||o==="both"?(R=f[1]+N-u[0],L=f[1]+U+u[2]):(R=f[1]+(N+U-y.displaySize[1])/2,L=R+y.displaySize[1]),{imagePrimary:y,imageSecondary:void 0,top:R,right:P,bottom:L,left:z,collisionPadding:b}}class Qu extends Ut{constructor(t,o,u,f,p){super(t,o),this.angle=f,this.z=u,p!==void 0&&(this.segment=p)}clone(){return new Qu(this.x,this.y,this.z,this.angle,this.segment)}}function oM(i,t,o,u,f){if(t.segment===void 0)return!0;let p=t,y=t.segment+1,b=0;for(;b>-o/2;){if(y--,y<0)return!1;b-=i[y].dist(p),p=i[y]}b+=i[y].dist(i[y+1]),y++;const T=[];let A=0;for(;b<o/2;){const R=i[y],P=i[y+1];if(!P)return!1;let L=i[y-1].angleTo(R)-R.angleTo(P);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:L}),A+=L;b-T[0].distance>u;)A-=T.shift().angleDelta;if(A>f)return!1;y++,b+=R.dist(P)}return!0}function aM(i){let t=0;for(let o=0;o<i.length-1;o++)t+=i[o].dist(i[o+1]);return t}function lM(i,t,o){return i?.6*t*o:0}function cM(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function q2(i,t,o,u,f,p){const y=lM(o,f,p),b=cM(o,u)*p;let T=0;const A=aM(i)/2;for(let R=0;R<i.length-1;R++){const P=i[R],L=i[R+1],z=P.dist(L);if(T+z>A){const N=(A-T)/z,U=ri(P.x,L.x,N),H=ri(P.y,L.y,N),W=new Qu(U,H,0,L.angleTo(P),R);return!y||oM(i,W,b,y,t)?W:void 0}T+=z}}function H2(i,t,o,u,f,p,y,b,T){const A=lM(u,p,y),R=cM(u,f),P=R*y,L=i[0].x===0||i[0].x===T||i[0].y===0||i[0].y===T;return t-P<t/4&&(t=P+t/4),uM(i,L?t/2*b%t:(R/2+2*p)*y*b%t,t,A,o,P,L,!1,T)}function uM(i,t,o,u,f,p,y,b,T){const A=p/2,R=aM(i);let P=0,L=t-o,z=[];for(let N=0;N<i.length-1;N++){const U=i[N],H=i[N+1],W=U.dist(H),ie=H.angleTo(U);for(;L+o<P+W;){L+=o;const le=(L-P)/W,se=ri(U.x,H.x,le),we=ri(U.y,H.y,le);if(se>=0&&se<T&&we>=0&&we<T&&L-A>=0&&L+A<=R){const he=new Qu(se,we,0,ie,N);u&&!oM(i,he,p,u,f)||z.push(he)}}P+=W}return b||z.length||y||(z=uM(i,P/2,o,u,f,p,y,!0,T)),z}function hM(i,t,o,u,f){const p=[];for(let y=0;y<i.length;y++){const b=i[y];let T;for(let A=0;A<b.length-1;A++){let R=b[A],P=b[A+1];R.x<t&&P.x<t||(R.x<t?R=new Ut(t,R.y+(t-R.x)/(P.x-R.x)*(P.y-R.y))._round():P.x<t&&(P=new Ut(t,R.y+(t-R.x)/(P.x-R.x)*(P.y-R.y))._round()),R.y<o&&P.y<o||(R.y<o?R=new Ut(R.x+(o-R.y)/(P.y-R.y)*(P.x-R.x),o)._round():P.y<o&&(P=new Ut(R.x+(o-R.y)/(P.y-R.y)*(P.x-R.x),o)._round()),R.x>=u&&P.x>=u||(R.x>=u?R=new Ut(u,R.y+(u-R.x)/(P.x-R.x)*(P.y-R.y))._round():P.x>=u&&(P=new Ut(u,R.y+(u-R.x)/(P.x-R.x)*(P.y-R.y))._round()),R.y>=f&&P.y>=f||(R.y>=f?R=new Ut(R.x+(f-R.y)/(P.y-R.y)*(P.x-R.x),f)._round():P.y>=f&&(P=new Ut(R.x+(f-R.y)/(P.y-R.y)*(P.x-R.x),f)._round()),T&&R.equals(T[T.length-1])||(T=[R],p.push(T)),T.push(P)))))}}return p}function dM(i){let t=0,o=0;for(const y of i)t+=y.w*y.h,o=Math.max(o,y.w);i.sort((y,b)=>b.h-y.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),o),h:1/0}];let f=0,p=0;for(const y of i)for(let b=u.length-1;b>=0;b--){const T=u[b];if(!(y.w>T.w||y.h>T.h)){if(y.x=T.x,y.y=T.y,p=Math.max(p,y.y+y.h),f=Math.max(f,y.x+y.w),y.w===T.w&&y.h===T.h){const A=u.pop();b<u.length&&(u[b]=A)}else y.h===T.h?(T.x+=y.w,T.w-=y.w):y.w===T.w?(T.y+=y.h,T.h-=y.h):(u.push({x:T.x+y.w,y:T.y,w:T.w-y.w,h:y.h}),T.y+=y.h,T.h-=y.h);break}}return{w:f,h:p,fill:t/(f*p)||0}}er(Qu,"Anchor");const Ma=1;class t4{constructor(t,{pixelRatio:o,version:u,stretchX:f,stretchY:p,content:y}){this.paddedRect=t,this.pixelRatio=o,this.stretchX=f,this.stretchY=p,this.content=y,this.version=u}get tl(){return[this.paddedRect.x+Ma,this.paddedRect.y+Ma]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ma,this.paddedRect.y+this.paddedRect.h-Ma]}get displaySize(){return[(this.paddedRect.w-2*Ma)/this.pixelRatio,(this.paddedRect.h-2*Ma)/this.pixelRatio]}}class fM{constructor(t,o){const u={},f={};this.haveRenderCallbacks=[];const p=[];this.addImages(t,u,p),this.addImages(o,f,p);const{w:y,h:b}=dM(p),T=new rl({width:y||1,height:b||1});for(const A in t){const R=t[A],P=u[A].paddedRect;rl.copy(R.data,T,{x:0,y:0},{x:P.x+Ma,y:P.y+Ma},R.data,R.sdf)}for(const A in o){const R=o[A],P=f[A].paddedRect,L=P.x+Ma,z=P.y+Ma,N=R.data.width,U=R.data.height;rl.copy(R.data,T,{x:0,y:0},{x:L,y:z},R.data),rl.copy(R.data,T,{x:0,y:U-1},{x:L,y:z-1},{width:N,height:1}),rl.copy(R.data,T,{x:0,y:0},{x:L,y:z+U},{width:N,height:1}),rl.copy(R.data,T,{x:N-1,y:0},{x:L-1,y:z},{width:1,height:U}),rl.copy(R.data,T,{x:0,y:0},{x:L+N,y:z},{width:1,height:U})}this.image=T,this.iconPositions=u,this.patternPositions=f}addImages(t,o,u){for(const f in t){const p=t[f],y={x:0,y:0,w:p.data.width+2*Ma,h:p.data.height+2*Ma};u.push(y),o[f]=new t4(y,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(t,o,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>t.hasImage(f,u)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const f in t.getUpdatedImages(u))this.patchUpdatedImage(this.iconPositions[f],t.getImage(f,u),o),this.patchUpdatedImage(this.patternPositions[f],t.getImage(f,u),o)}patchUpdatedImage(t,o,u){if(!t||!o||t.version===o.version)return;t.version=o.version;const[f,p]=t.tl,y=!!Object.keys(this.patternPositions).length;u.update(o.data,{useMipmap:y},{x:f,y:p})}}er(t4,"ImagePosition"),er(fM,"ImageAtlas");const fy=1e20;function pM(i,t,o,u,f,p,y,b,T){for(let A=t;A<t+u;A++)mM(i,o*p+A,p,f,y,b,T);for(let A=o;A<o+f;A++)mM(i,A*p+t,1,u,y,b,T)}function mM(i,t,o,u,f,p,y){p[0]=0,y[0]=-fy,y[1]=fy,f[0]=i[t];for(let b=1,T=0,A=0;b<u;b++){f[b]=i[t+b*o];const R=b*b;do{const P=p[T];A=(f[b]-f[P]+R-P*P)/(b-P)/2}while(A<=y[T]&&--T>-1);T++,p[T]=b,y[T]=A,y[T+1]=fy}for(let b=0,T=0;b<u;b++){for(;y[T+1]<b;)T++;const A=p[T],R=b-A;i[t+b*o]=f[A]+R*R}}const ac=2,r4={none:0,ideographs:1,all:2};class w_{constructor(t,o,u){this.requestManager=t,this.localGlyphMode=o,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,o){this.urls[o]=t}getGlyphs(t,o,u){const f=[],p=this.urls[o]||I.GLYPHS_URL;for(const y in t)for(const b of t[y])f.push({stack:y,id:b});ta(f,({stack:y,id:b},T)=>{let A=this.entries[y];A||(A=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let R=A.glyphs[b];if(R!==void 0)return void T(null,{stack:y,id:b,glyph:R});if(R=this._tinySDF(A,y,b),R)return A.glyphs[b]=R,void T(null,{stack:y,id:b,glyph:R});const P=Math.floor(b/256);if(256*P>65535)return void T(new Error("glyphs > 65535 not supported"));if(A.ranges[P])return void T(null,{stack:y,id:b,glyph:R});let L=A.requests[P];L||(L=A.requests[P]=[],w_.loadGlyphRange(y,P,p,this.requestManager,(z,N)=>{if(N){A.ascender=N.ascender,A.descender=N.descender;for(const U in N.glyphs)this._doesCharSupportLocalGlyph(+U)||(A.glyphs[+U]=N.glyphs[+U]);A.ranges[P]=!0}for(const U of L)U(z,N);delete A.requests[P]})),L.push((z,N)=>{z?T(z):N&&T(null,{stack:y,id:b,glyph:N.glyphs[b]||null})})},(y,b)=>{if(y)u(y);else if(b){const T={};for(const{stack:A,id:R,glyph:P}of b)T[A]===void 0&&(T[A]={}),T[A].glyphs===void 0&&(T[A].glyphs={}),T[A].glyphs[R]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},T[A].ascender=this.entries[A].ascender,T[A].descender=this.entries[A].descender;u(null,T)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==r4.none&&(this.localGlyphMode===r4.all?!!this.localFontFamily:!!this.localFontFamily&&(a["CJK Unified Ideographs"](t)||a["Hangul Syllables"](t)||a.Hiragana(t)||a.Katakana(t)||a["CJK Symbols and Punctuation"](t)||a["CJK Unified Ideographs Extension A"](t)||a["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,o,u){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(u))return;let p=t.tinySDF;if(!p){let U="400";/bold/i.test(o)?U="900":/medium/i.test(o)?U="500":/light/i.test(o)&&(U="200"),p=t.tinySDF=new w_.TinySDF({fontFamily:f,fontWeight:U,fontSize:24*ac,buffer:3*ac,radius:8*ac}),p.fontWeight=U}if(this.localGlyphs[p.fontWeight][u])return this.localGlyphs[p.fontWeight][u];const y=String.fromCodePoint(u),{data:b,width:T,height:A,glyphWidth:R,glyphHeight:P,glyphLeft:L,glyphTop:z,glyphAdvance:N}=p.draw(y);return this.localGlyphs[p.fontWeight][u]={id:u,bitmap:new sd({width:T,height:A},b),metrics:{width:R/ac,height:P/ac,left:L/ac,top:z/ac-27,advance:N/ac,localGlyph:!0}}}}w_.loadGlyphRange=function(i,t,o,u,f){const p=256*t,y=p+255,b=u.transformRequest(u.normalizeGlyphsURL(o).replace("{fontstack}",i).replace("{range}",`${p}-${y}`),Am.Glyphs);xf(b,(T,A)=>{if(T)f(T);else if(A){const R={},P=function(L){return new x_(L).readFields(B2,{})}(A);for(const L of P.glyphs)R[L.id]=L;f(null,{glyphs:R,ascender:P.ascender,descender:P.descender})}})},w_.TinySDF=class{constructor({fontSize:i=24,buffer:t=3,radius:o=8,cutoff:u=.25,fontFamily:f="sans-serif",fontWeight:p="normal",fontStyle:y="normal"}={}){this.buffer=t,this.cutoff=u,this.radius=o;const b=this.size=i+4*t,T=this._createCanvas(b),A=this.ctx=T.getContext("2d",{willReadFrequently:!0});A.font=`${y} ${p} ${i}px ${f}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(i){const t=document.createElement("canvas");return t.width=t.height=i,t}draw(i){const{width:t,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:f,actualBoundingBoxRight:p}=this.ctx.measureText(i),y=Math.ceil(o),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-f))),T=Math.min(this.size-this.buffer,y+Math.ceil(u)),A=b+2*this.buffer,R=T+2*this.buffer,P=Math.max(A*R,0),L=new Uint8ClampedArray(P),z={data:L,width:A,height:R,glyphWidth:b,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:t};if(b===0||T===0)return z;const{ctx:N,buffer:U,gridInner:H,gridOuter:W}=this;N.clearRect(U,U,b,T),N.fillText(i,U,U+y);const ie=N.getImageData(U,U,b,T);W.fill(fy,0,P),H.fill(0,0,P);for(let le=0;le<T;le++)for(let se=0;se<b;se++){const we=ie.data[4*(le*b+se)+3]/255;if(we===0)continue;const he=(le+U)*A+se+U;if(we===1)W[he]=0,H[he]=fy;else{const Pe=.5-we;W[he]=Pe>0?Pe*Pe:0,H[he]=Pe<0?Pe*Pe:0}}pM(W,0,0,A,R,A,this.f,this.v,this.z),pM(H,U,U,b,T,A,this.f,this.v,this.z);for(let le=0;le<P;le++){const se=Math.sqrt(W[le])-Math.sqrt(H[le]);L[le]=Math.round(255-255*(se/this.radius+this.cutoff))}return z}};const ld=Ma;function _M(i,t,o,u){const f=[],p=i.imagePrimary,y=p.pixelRatio,b=p.paddedRect.w-2*ld,T=p.paddedRect.h-2*ld,A=i.right-i.left,R=i.bottom-i.top,P=p.stretchX||[[0,b]],L=p.stretchY||[[0,T]],z=(Ye,mt)=>Ye+mt[1]-mt[0],N=P.reduce(z,0),U=L.reduce(z,0),H=b-N,W=T-U;let ie=0,le=N,se=0,we=U,he=0,Pe=H,Le=0,qe=W;if(p.content&&u){const Ye=p.content;ie=rb(P,0,Ye[0]),se=rb(L,0,Ye[1]),le=rb(P,Ye[0],Ye[2]),we=rb(L,Ye[1],Ye[3]),he=Ye[0]-ie,Le=Ye[1]-se,Pe=Ye[2]-Ye[0]-le,qe=Ye[3]-Ye[1]-we}const ot=(Ye,mt,pt,at)=>{const wt=ib(Ye.stretch-ie,le,A,i.left),xt=nb(Ye.fixed-he,Pe,Ye.stretch,N),St=ib(mt.stretch-se,we,R,i.top),Et=nb(mt.fixed-Le,qe,mt.stretch,U),gt=ib(pt.stretch-ie,le,A,i.left),nr=nb(pt.fixed-he,Pe,pt.stretch,N),Qt=ib(at.stretch-se,we,R,i.top),kt=nb(at.fixed-Le,qe,at.stretch,U),xr=new Ut(wt,St),dr=new Ut(gt,St),sr=new Ut(gt,Qt),Dt=new Ut(wt,Qt),yr=new Ut(xt/y,Et/y),Wr=new Ut(nr/y,kt/y),Rr=t*Math.PI/180;if(Rr){const $i=Math.sin(Rr),Pi=Math.cos(Rr),xi=[Pi,-$i,$i,Pi];xr._matMult(xi),dr._matMult(xi),Dt._matMult(xi),sr._matMult(xi)}const Yr=Ye.stretch+Ye.fixed,Zr=pt.stretch+pt.fixed,ai=mt.stretch+mt.fixed,Ar=at.stretch+at.fixed,Gi=i.imageSecondary;return{tl:xr,tr:dr,bl:Dt,br:sr,texPrimary:{x:p.paddedRect.x+ld+Yr,y:p.paddedRect.y+ld+ai,w:Zr-Yr,h:Ar-ai},texSecondary:Gi?{x:Gi.paddedRect.x+ld+Yr,y:Gi.paddedRect.y+ld+ai,w:Zr-Yr,h:Ar-ai}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yr,pixelOffsetBR:Wr,minFontScaleX:Pe/y/A,minFontScaleY:qe/y/R,isSDF:o}};if(u&&(p.stretchX||p.stretchY)){const Ye=gM(P,H,N),mt=gM(L,W,U);for(let pt=0;pt<Ye.length-1;pt++){const at=Ye[pt],wt=Ye[pt+1];for(let xt=0;xt<mt.length-1;xt++)f.push(ot(at,mt[xt],wt,mt[xt+1]))}}else f.push(ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:T+1}));return f}function rb(i,t,o){let u=0;for(const f of i)u+=Math.max(t,Math.min(o,f[1]))-Math.max(t,Math.min(o,f[0]));return u}function gM(i,t,o){const u=[{fixed:-ld,stretch:0}];for(const[f,p]of i){const y=u[u.length-1];u.push({fixed:f-y.stretch,stretch:y.stretch}),u.push({fixed:f-y.stretch,stretch:y.stretch+(p-f)})}return u.push({fixed:t+ld,stretch:o}),u}function ib(i,t,o,u){return i/t*o+u}function nb(i,t,o,u){return i-t*o/u}function W2(i,t,o,u){const f=t+i.positionedLines[u].lineOffset;return u===0?o+f/2:o+(f+(t+i.positionedLines[u-1].lineOffset))/2}function Z2(i,t=1,o=!1){let u=1/0,f=1/0,p=-1/0,y=-1/0;const b=i[0];for(let z=0;z<b.length;z++){const N=b[z];(!z||N.x<u)&&(u=N.x),(!z||N.y<f)&&(f=N.y),(!z||N.x>p)&&(p=N.x),(!z||N.y>y)&&(y=N.y)}const T=Math.min(p-u,y-f);let A=T/2;const R=new jm([],X2);if(T===0)return new Ut(u,f);for(let z=u;z<p;z+=T)for(let N=f;N<y;N+=T)R.push(new T_(z+A,N+A,A,i));let P=function(z){let N=0,U=0,H=0;const W=z[0];for(let ie=0,le=W.length,se=le-1;ie<le;se=ie++){const we=W[ie],he=W[se],Pe=we.x*he.y-he.x*we.y;U+=(we.x+he.x)*Pe,H+=(we.y+he.y)*Pe,N+=3*Pe}return new T_(U/N,H/N,0,z)}(i),L=R.length;for(;R.length;){const z=R.pop();(z.d>P.d||!P.d)&&(P=z,o&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,L)),z.max-P.d<=t||(A=z.h/2,R.push(new T_(z.p.x-A,z.p.y-A,A,i)),R.push(new T_(z.p.x+A,z.p.y-A,A,i)),R.push(new T_(z.p.x-A,z.p.y+A,A,i)),R.push(new T_(z.p.x+A,z.p.y+A,A,i)),L+=4)}return o&&(console.log(`num probes: ${L}`),console.log(`best distance: ${P.d}`)),P.p}function X2(i,t){return t.max-i.max}class T_{constructor(t,o,u,f){this.p=new Ut(t,o),this.h=u,this.d=function(p,y){let b=!1,T=1/0;for(let A=0;A<y.length;A++){const R=y[A];for(let P=0,L=R.length,z=L-1;P<L;z=P++){const N=R[P],U=R[z];N.y>p.y!=U.y>p.y&&p.x<(U.x-N.x)*(p.y-N.y)/(U.y-N.y)+N.x&&(b=!b),T=Math.min(T,L6(p,N,U))}}return(b?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const i4=Number.POSITIVE_INFINITY,Y2=Math.sqrt(2);function yM(i,[t,o]){let u=0,f=0;if(o===i4){t<0&&(t=0);const p=t/Y2;switch(i){case"top-right":case"top-left":f=p-7;break;case"bottom-right":case"bottom-left":f=7-p;break;case"bottom":f=7-t;break;case"top":f=t-7}switch(i){case"top-right":case"bottom-right":u=-p;break;case"top-left":case"bottom-left":u=p;break;case"left":u=t;break;case"right":u=-t}}else{switch(t=Math.abs(t),o=Math.abs(o),i){case"top-right":case"top-left":case"top":f=o-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-o}switch(i){case"top-right":case"bottom-right":case"right":u=-t;break;case"top-left":case"bottom-left":case"left":u=t}}return[u,f]}function n4(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Q2(i,t,o,u,f,p,y,b,T,A,R,P,L,z,N){let U=p.textMaxSize.evaluate(t,{},P);U===void 0&&(U=y);const H=i.layers[0].layout,W=H.get("icon-offset").evaluate(t,{},P),ie=xM(o.horizontal)||o.vertical,le=L.name==="globe",se=qs,we=y/se,he=i.tilePixelRatio*U/se,Pe=(wt=i.overscaling,i.zoom>18&&wt>2&&(wt>>=1),Math.max(Gt/(512*wt),1)*H.get("symbol-spacing")),Le=H.get("text-padding")*i.tilePixelRatio,qe=H.get("icon-padding")*i.tilePixelRatio,ot=ui(H.get("text-max-angle")),Ye=H.get("text-rotation-alignment")==="map"&&H.get("symbol-placement")!=="point",mt=H.get("icon-rotation-alignment")==="map"&&H.get("symbol-placement")!=="point",pt=H.get("symbol-placement"),at=Pe/2;var wt;const xt=H.get("icon-text-fit").evaluate(t,{},P),St=H.get("icon-text-fit-padding").evaluate(t,{},P),Et=xt!=="none";let gt;i.hasAnyIconTextFit===!1&&Et&&(i.hasAnyIconTextFit=!0),u&&Et&&(i.allowVerticalPlacement&&o.vertical&&(gt=sM(u,o.vertical,xt,St,W,we)),ie&&(u=sM(u,ie,xt,St,W,we)));const nr=(Qt,kt,xr)=>{if(kt.x<0||kt.x>=Gt||kt.y<0||kt.y>=Gt)return;let dr=null;if(le){const{x:sr,y:Dt,z:yr}=L.projectTilePoint(kt.x,kt.y,xr);dr={anchor:new Qu(sr,Dt,yr,0,void 0),up:L.upVector(xr,kt.x,kt.y)}}(function(sr,Dt,yr,Wr,Rr,Yr,Zr,ai,Ar,Gi,$i,Pi,xi,Mi,cn,Ki,Rn,An,no,Fn,bn,es,Ps,Ms,rn,Bo,Ku){const Pl=sr.addToLineVertexArray(Dt,Wr);let dc,pd,md,dp,w3,T3,E3,A3=0,I3=0,S3=0,C3=0,S4=-1,C4=-1;const Zc={};let R3=Ef("");const fp=yr?yr.anchor:Dt,R4=Ar.layout.get("icon-text-fit").evaluate(bn,{},rn)!=="none";let P4=0,M4=0;if(Ar._unevaluatedLayout.getValue("text-radial-offset")===void 0?[P4,M4]=Ar.layout.get("text-offset").evaluate(bn,{},rn).map(ka=>ka*qs):(P4=Ar.layout.get("text-radial-offset").evaluate(bn,{},rn)*qs,M4=i4),sr.allowVerticalPlacement&&Rr.vertical){const ka=Rr.vertical;if(cn)T3=s4(ka),ai&&(E3=s4(ai));else{const Da=Ar.layout.get("text-rotate").evaluate(bn,{},rn)+90;md=sb(Gi,fp,Dt,$i,Pi,xi,ka,Mi,Da,Ki),ai&&(dp=sb(Gi,fp,Dt,$i,Pi,xi,ai,An,Da))}}if(Yr){const ka=Ar.layout.get("icon-rotate").evaluate(bn,{},rn),Da=_M(Yr,ka,Ps,R4),P_=ai?_M(ai,ka,Ps,R4):void 0;pd=sb(Gi,fp,Dt,$i,Pi,xi,Yr,An,ka),A3=4*Da.length;const P3=sr.iconSizeData;let pp=null;P3.kind==="source"?(pp=[oc*Ar.layout.get("icon-size").evaluate(bn,{},rn)],pp[0]>cd&&gn(`${sr.layerIds[0]}: Value for "icon-size" is >= ${py}. Reduce your "icon-size".`)):P3.kind==="composite"&&(pp=[oc*es.compositeIconSizes[0].evaluate(bn,{},rn),oc*es.compositeIconSizes[1].evaluate(bn,{},rn)],(pp[0]>cd||pp[1]>cd)&&gn(`${sr.layerIds[0]}: Value for "icon-size" is >= ${py}. Reduce your "icon-size".`)),sr.addSymbols(sr.icon,Da,pp,Fn,no,bn,!1,yr,Dt,Pl.lineStartIndex,Pl.lineLength,-1,Ms,rn,Bo,Ku),S4=sr.icon.placedSymbolArray.length-1,P_&&(I3=4*P_.length,sr.addSymbols(sr.icon,P_,pp,Fn,no,bn,il.vertical,yr,Dt,Pl.lineStartIndex,Pl.lineLength,-1,Ms,rn,Bo,Ku),C4=sr.icon.placedSymbolArray.length-1)}for(const ka in Rr.horizontal){const Da=Rr.horizontal[ka];dc||(R3=Ef(Da.text),cn?w3=s4(Da):dc=sb(Gi,fp,Dt,$i,Pi,xi,Da,Mi,Ar.layout.get("text-rotate").evaluate(bn,{},rn),Ki));const P_=Da.positionedLines.length===1;if(S3+=vM(sr,yr,Dt,Da,Zr,Ar,cn,bn,Ki,Pl,Rr.vertical?il.horizontal:il.horizontalOnly,P_?Object.keys(Rr.horizontal):[ka],Zc,S4,es,Ms,rn,Bo),P_)break}Rr.vertical&&(C3+=vM(sr,yr,Dt,Rr.vertical,Zr,Ar,cn,bn,Ki,Pl,il.vertical,["vertical"],Zc,C4,es,Ms,rn,Bo));let _d=-1;const k4=(ka,Da)=>ka?Math.max(ka,Da):Da;_d=k4(w3,_d),_d=k4(T3,_d),_d=k4(E3,_d);const m$=_d>-1?1:0;sr.glyphOffsetArray.length>=65535&&gn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),bn.sortKey!==void 0&&sr.addToSortKeyRanges(sr.symbolInstances.length,bn.sortKey),sr.symbolInstances.emplaceBack(Dt.x,Dt.y,fp.x,fp.y,fp.z,Zc.right>=0?Zc.right:-1,Zc.center>=0?Zc.center:-1,Zc.left>=0?Zc.left:-1,Zc.vertical>=0?Zc.vertical:-1,S4,C4,R3,dc!==void 0?dc:sr.collisionBoxArray.length,dc!==void 0?dc+1:sr.collisionBoxArray.length,md!==void 0?md:sr.collisionBoxArray.length,md!==void 0?md+1:sr.collisionBoxArray.length,pd!==void 0?pd:sr.collisionBoxArray.length,pd!==void 0?pd+1:sr.collisionBoxArray.length,dp||sr.collisionBoxArray.length,dp?dp+1:sr.collisionBoxArray.length,$i,S3,C3,A3,I3,m$,0,P4,M4,_d,0,R4?1:0)})(i,kt,dr,Qt,o,u,f,gt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,Le,Ye,T,0,qe,mt,W,t,p,A,R,P,z,N)};if(pt==="line")for(const Qt of hM(t.geometry,0,0,Gt,Gt)){const kt=H2(Qt,Pe,ot,o.vertical||ie,u,se,he,i.overscaling,Gt);for(const xr of kt)ie&&K2(i,ie.text,at,xr)||nr(Qt,xr,P)}else if(pt==="line-center"){for(const Qt of t.geometry)if(Qt.length>1){const kt=q2(Qt,ot,o.vertical||ie,u,se,he);kt&&nr(Qt,kt,P)}}else if(t.type==="Polygon")for(const Qt of $5(t.geometry,0)){const kt=Z2(Qt,16);nr(Qt[0],new Qu(kt.x,kt.y,0,0,void 0),P)}else if(t.type==="LineString")for(const Qt of t.geometry)nr(Qt,new Qu(Qt[0].x,Qt[0].y,0,0,void 0),P);else if(t.type==="Point")for(const Qt of t.geometry)for(const kt of Qt)nr([kt],new Qu(kt.x,kt.y,0,0,void 0),P)}const py=255,cd=py*oc;function vM(i,t,o,u,f,p,y,b,T,A,R,P,L,z,N,U,H,W){const ie=function(we,he,Pe,Le,qe,ot,Ye,mt){const pt=[];if(he.positionedLines.length===0)return pt;const at=Le.layout.get("text-rotate").evaluate(ot,{})*Math.PI/180,wt=function(nr){const Qt=nr[0],kt=nr[1],xr=Qt*kt;return xr>0?[Qt,-kt]:xr<0?[-Qt,kt]:Qt===0?[kt,Qt]:[kt,-Qt]}(Pe);let xt=Math.abs(he.top-he.bottom);for(const nr of he.positionedLines)xt-=nr.lineOffset;const St=he.positionedLines.length,Et=xt/St;let gt=he.top-Pe[1];for(let nr=0;nr<St;++nr){const Qt=he.positionedLines[nr];gt=W2(he,Et,gt,nr);for(const kt of Qt.positionedGlyphs){if(!kt.rect)continue;const xr=kt.rect||{};let dr=JP+1,sr=!0,Dt=1,yr=0;if(kt.imageName){const Fn=Ye[kt.imageName];if(!Fn)continue;if(Fn.sdf){gn("SDF images are not supported in formatted text and will be ignored.");continue}sr=!1,Dt=Fn.pixelRatio,dr=Ma/Dt}const Wr=(qe||mt)&&kt.vertical,Rr=kt.metrics.advance*kt.scale/2,Yr=kt.metrics,Zr=kt.rect;if(Zr===null)continue;mt&&he.verticalizable&&(yr=kt.imageName?Rr-kt.metrics.width*kt.scale/2:0);const ai=qe?[kt.x+Rr,kt.y]:[0,0];let Ar=[0,0],Gi=[0,0],$i=!1;qe||(Wr?(Gi=[kt.x+Rr+wt[0],kt.y+wt[1]-yr],$i=!0):Ar=[kt.x+Rr+Pe[0],kt.y+Pe[1]-yr]);const Pi=Zr.w*kt.scale/(Dt*(kt.localGlyph?ac:1)),xi=Zr.h*kt.scale/(Dt*(kt.localGlyph?ac:1));let Mi,cn,Ki,Rn;if(Wr){const Fn=kt.y-gt,bn=new Ut(-Rr,Rr-Fn),es=-Math.PI/2,Ps=new Ut(...Gi);Mi=new Ut(-Rr+Ar[0],Ar[1]),Mi._rotateAround(es,bn)._add(Ps),Mi.x+=-Fn+Rr,Mi.y-=(Yr.left-dr)*kt.scale;const Ms=kt.imageName?Yr.advance*kt.scale:qs*kt.scale,rn=String.fromCodePoint(kt.glyph);S2(rn)?Mi.x+=(1-dr)*kt.scale:C2(rn)?Mi.x+=Ms-Yr.height*kt.scale+(-dr-1)*kt.scale:Mi.x+=kt.imageName||Yr.width+2*dr===Zr.w&&Yr.height+2*dr===Zr.h?(Ms-xi)/2:(Ms-(Yr.height+2*dr)*kt.scale)/2,cn=new Ut(Mi.x,Mi.y-Pi),Ki=new Ut(Mi.x+xi,Mi.y),Rn=new Ut(Mi.x+xi,Mi.y-Pi)}else{const Fn=(Yr.left-dr)*kt.scale-Rr+Ar[0],bn=(-Yr.top-dr)*kt.scale+Ar[1],es=Fn+Pi,Ps=bn+xi;Mi=new Ut(Fn,bn),cn=new Ut(es,bn),Ki=new Ut(Fn,Ps),Rn=new Ut(es,Ps)}if(at){let Fn;Fn=qe?new Ut(0,0):$i?new Ut(wt[0],wt[1]):new Ut(Pe[0],Pe[1]),Mi._rotateAround(at,Fn),cn._rotateAround(at,Fn),Ki._rotateAround(at,Fn),Rn._rotateAround(at,Fn)}const An=new Ut(0,0),no=new Ut(0,0);pt.push({tl:Mi,tr:cn,bl:Ki,br:Rn,texPrimary:xr,texSecondary:void 0,writingMode:he.writingMode,glyphOffset:ai,sectionIndex:kt.sectionIndex,isSDF:sr,pixelOffsetTL:An,pixelOffsetBR:no,minFontScaleX:0,minFontScaleY:0})}}return pt}(0,u,T,p,y,b,f,i.allowVerticalPlacement),le=i.textSizeData;let se=null;le.kind==="source"?(se=[oc*p.layout.get("text-size").evaluate(b,{},H)],se[0]>cd&&gn(`${i.layerIds[0]}: Value for "text-size" is >= ${py}. Reduce your "text-size".`)):le.kind==="composite"&&(se=[oc*N.compositeTextSizes[0].evaluate(b,{},H),oc*N.compositeTextSizes[1].evaluate(b,{},H)],(se[0]>cd||se[1]>cd)&&gn(`${i.layerIds[0]}: Value for "text-size" is >= ${py}. Reduce your "text-size".`)),i.addSymbols(i.text,ie,se,T,y,b,R,t,o,A.lineStartIndex,A.lineLength,z,U,H,W,!1);for(const we of P)L[we]=i.text.placedSymbolArray.length-1;return 4*ie.length}function xM(i){for(const t in i)return i[t];return null}function sb(i,t,o,u,f,p,y,b,T,A){let R=y.top,P=y.bottom,L=y.left,z=y.right;const N=y.collisionPadding;if(N&&(L-=N[0],R-=N[1],z+=N[2],P+=N[3]),T){const U=new Ut(L,R),H=new Ut(z,R),W=new Ut(L,P),ie=new Ut(z,P),le=ui(T);let se=new Ut(0,0);A&&(se=new Ut(A[0],A[1])),U._rotateAround(le,se),H._rotateAround(le,se),W._rotateAround(le,se),ie._rotateAround(le,se),L=Math.min(U.x,H.x,W.x,ie.x),z=Math.max(U.x,H.x,W.x,ie.x),R=Math.min(U.y,H.y,W.y,ie.y),P=Math.max(U.y,H.y,W.y,ie.y)}return i.emplaceBack(t.x,t.y,t.z,o.x,o.y,L,R,z,P,b,u,f,p),i.length-1}function s4(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const t=i.bottom-i.top;return t>0?Math.max(10,t):null}function K2(i,t,o,u){const f=i.compareText;if(t in f){const p=f[t];for(let y=p.length-1;y>=0;y--)if(u.dist(p[y])<o)return!0}else f[t]=[];return f[t].push(u),!1}function bM(i,t){const o=i.fovAboveCenter,u=i.elevation?i.elevation.getMinElevationBelowMSL()*t:0,f=(i._camera.position[2]*i.worldSize-u)/Math.cos(i._pitch),p=Math.sin(o)*f/Math.sin(Math.max(Math.PI/2-i._pitch-o,.01)),y=Math.sin(i._pitch)*p+f;return Math.min(1.01*y,f*(1/i._horizonShift))}function my(i,t){if(!t.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:t};const o=Math.pow(2,-i.z),u=i.x*o,f=(i.x+1)*o,p=i.y*o,y=(i.y+1)*o,b=Pa(u),T=Pa(f),A=Gs(p),R=Gs(y),P=t.project(b,A),L=t.project(T,A),z=t.project(T,R),N=t.project(b,R);let U=Math.min(P.x,L.x,z.x,N.x),H=Math.min(P.y,L.y,z.y,N.y),W=Math.max(P.x,L.x,z.x,N.x),ie=Math.max(P.y,L.y,z.y,N.y);const le=o/16;function se(he,Pe,Le,qe,ot,Ye){const mt=(Le+ot)/2,pt=(qe+Ye)/2,at=t.project(Pa(mt),Gs(pt)),wt=Math.max(0,U-at.x,H-at.y,at.x-W,at.y-ie);U=Math.min(U,at.x),W=Math.max(W,at.x),H=Math.min(H,at.y),ie=Math.max(ie,at.y),wt>le&&(se(he,at,Le,qe,mt,pt),se(at,Pe,mt,pt,ot,Ye))}se(P,L,u,p,f,p),se(L,z,f,p,f,y),se(z,N,f,y,u,y),se(N,P,u,y,u,p),U-=le,H-=le,W+=le,ie+=le;const we=1/Math.max(W-U,ie-H);return{scale:we,x:U*we,y:H*we,x2:W*we,y2:ie*we,projection:t}}function wM(i,{x:t,y:o},u=0){return new Ut(((t-u)*i.scale-i.x)*Gt,(o*i.scale-i.y)*Gt)}const J2=l.a9.identity(new Float32Array(16));class ud{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,o){return{x:0,y:0,z:0}}unproject(t,o){return new Ai(0,0)}projectTilePoint(t,o,u){return{x:t,y:o,z:0}}locationPoint(t,o,u=!0){return t._coordinatePoint(t.locationCoordinate(o),u)}pixelsPerMeter(t,o){return No(1,t)*o}pixelSpaceConversion(t,o,u){return 1}farthestPixelDistance(t){return bM(t,t.pixelsPerMeter)}pointCoordinate(t,o,u,f){const p=t.horizonLineFromTop(!1),y=new Ut(o,Math.max(p,u));return t.rayIntersectionCoordinate(t.pointRayIntersection(y,f))}pointCoordinate3D(t,o,u){const f=new Ut(o,u);if(t.elevation)return t.elevation.pointCoordinate(f);{const p=this.pointCoordinate(t,f.x,f.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(t,o){if(t.elevation)return!this.pointCoordinate3D(t,o.x,o.y);const u=t.horizonLineFromTop();return o.y<u}createInversionMatrix(t,o){return J2}createTileMatrix(t,o,u){let f,p,y;const b=u.canonical,T=l.a9.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=my(b,this);f=1,p=A.x+u.wrap*A.scale,y=A.y,l.a9.scale(T,T,[f/A.scale,f/A.scale,t.pixelsPerMeter/o])}else f=o/t.zoomScale(b.z),p=(b.x+Math.pow(2,b.z)*u.wrap)*f,y=b.y*f;return l.a9.translate(T,T,[p,y,0]),l.a9.scale(T,T,[f/Gt,f/Gt,1]),T}upVector(t,o,u){return[0,0,1]}upVectorScale(t,o,u){return{metersToTile:1}}}class ej extends ud{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[o,u]=this.parallels=t.parallels||[29.5,45.5],f=Math.sin(ui(o));this.n=(f+Math.sin(ui(u)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(t,o){const{n:u,c:f,r0:p}=this,y=ui(t-this.center[0]),b=ui(o),T=Math.sqrt(f-2*u*Math.sin(b))/u;return{x:T*Math.sin(y*u),y:T*Math.cos(y*u)-p,z:0}}unproject(t,o){const{n:u,c:f,r0:p}=this,y=p+o;let b=Math.atan2(t,Math.abs(y))*Math.sign(y);y*u<0&&(b-=Math.PI*Math.sign(t)*Math.sign(y));const T=ui(this.center[0])*u;b=Ta(b,-Math.PI-T,Math.PI-T);const A=ti(Ui(b/u)+this.center[0],-180,180),R=Math.asin(ti((f-(t*t+y*y)*u*u)/(2*u),-1,1)),P=ti(Ui(R),-$n,$n);return new Ai(A,P)}}const _y=1.340264,gy=-.081106,yy=893e-6,vy=.003796,ob=Math.sqrt(3)/2;class tj extends ud{project(t,o){o=o/180*Math.PI,t=t/180*Math.PI;const u=Math.asin(ob*Math.sin(o)),f=u*u,p=f*f*f;return{x:.5*(t*Math.cos(u)/(ob*(_y+3*gy*f+p*(7*yy+9*vy*f)))/Math.PI+.5),y:1-.5*(u*(_y+gy*f+p*(yy+vy*f))/Math.PI+1),z:0}}unproject(t,o){t=(2*t-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,f=u*u,p=f*f*f;for(let R,P,L,z=0;z<12&&(P=u*(_y+gy*f+p*(yy+vy*f))-o,L=_y+3*gy*f+p*(7*yy+9*vy*f),R=P/L,u=ti(u-R,-Math.PI/3,Math.PI/3),f=u*u,p=f*f*f,!(Math.abs(R)<1e-12));++z);const y=ob*t*(_y+3*gy*f+p*(7*yy+9*vy*f))/Math.cos(u),b=Math.asin(Math.sin(u)/ob),T=ti(180*y/Math.PI,-180,180),A=ti(180*b/Math.PI,-$n,$n);return new Ai(T,A)}}class rj extends ud{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,o){return{x:.5+t/360,y:.5-o/360,z:0}}unproject(t,o){const u=360*(t-.5),f=ti(360*(.5-o),-$n,$n);return new Ai(u,f)}}const E_=Math.PI/2;function ab(i){return Math.tan((E_+i)/2)}class ij extends ud{constructor(t){super(t),this.center=t.center||[0,30];const[o,u]=this.parallels=t.parallels||[30,30];let f=ui(o),p=ui(u);this.southernCenter=f+p<0,this.southernCenter&&(f=-f,p=-p);const y=Math.cos(f),b=ab(f);this.n=f===p?Math.sin(f):Math.log(y/Math.cos(p))/Math.log(ab(p)/b),this.f=y*Math.pow(ab(f),this.n)/this.n}project(t,o){o=ui(o),this.southernCenter&&(o=-o),t=ui(t-this.center[0]);const u=1e-6,{n:f,f:p}=this;p>0?o<-E_+u&&(o=-E_+u):o>E_-u&&(o=E_-u);const y=p/Math.pow(ab(o),f);let b=y*Math.sin(f*t),T=p-y*Math.cos(f*t);return b=.5*(b/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:b,y:this.southernCenter?T:1-T,z:0}}unproject(t,o){t=(2*t-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:u,f}=this,p=f-o,y=Math.sign(p),b=Math.sign(u)*Math.sqrt(t*t+p*p);let T=Math.atan2(t,Math.abs(p))*y;p*u<0&&(T-=Math.PI*Math.sign(t)*y);const A=ti(Ui(T/u)+this.center[0],-180,180),R=ti(Ui(2*Math.atan(Math.pow(f/b,1/u))-E_),-$n,$n);return new Ai(A,this.southernCenter?-R:R)}}class TM extends ud{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,o){return{x:rd(t),y:Wu(o),z:0}}unproject(t,o){const u=Pa(t),f=Gs(o);return new Ai(u,f)}}const EM=ui($n);class nj extends ud{project(t,o){const u=(o=ui(o))*o,f=u*u;return{x:.5*((t=ui(t))*(.8707-.131979*u+f*(f*(.003971*u-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+u*(.015085+f*(.028874*u-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(t,o){t=(2*t-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,f=25,p=0,y=u*u;do{y=u*u;const A=y*y;p=(u*(1.007226+y*(.015085+A*(.028874*y-.044475-.005916*A)))-o)/(1.007226+y*(.045255+A*(.259866*y-.311325-.005916*11*A))),u=ti(u-p,-EM,EM)}while(Math.abs(p)>1e-6&&--f>0);y=u*u;const b=ti(Ui(t/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),T=Ui(u);return new Ai(b,T)}}const AM=ui($n);class sj extends ud{project(t,o){o=ui(o),t=ui(t);const u=Math.cos(o),f=2/Math.PI,p=Math.acos(u*Math.cos(t/2)),y=Math.sin(p)/p,b=.5*(t*f+2*u*Math.sin(t/2)/y)||0,T=.5*(o+Math.sin(o)/y)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(t,o){let u=t=(2*t-.5)*Math.PI,f=o=(2*(1-o)-1)*Math.PI,p=25;const y=1e-6;let b=0,T=0;do{const A=Math.cos(f),R=Math.sin(f),P=2*R*A,L=R*R,z=A*A,N=Math.cos(u/2),U=Math.sin(u/2),H=2*N*U,W=U*U,ie=1-z*N*N,le=ie?1/ie:0,se=ie?Math.acos(A*N)*Math.sqrt(1/ie):0,we=.5*(2*se*A*U+2*u/Math.PI)-t,he=.5*(se*R+f)-o,Pe=.5*le*(z*W+se*A*N*L)+1/Math.PI,Le=le*(H*P/4-se*R*U),qe=.125*le*(P*U-se*R*z*H),ot=.5*le*(L*N+se*W*A)+.5,Ye=Le*qe-ot*Pe;b=(he*Le-we*ot)/Ye,T=(we*qe-he*Pe)/Ye,u=ti(u-b,-Math.PI,Math.PI),f=ti(f-T,-AM,AM)}while((Math.abs(b)>y||Math.abs(T)>y)&&--p>0);return new Ai(Ui(u),Ui(f))}}class IM extends ud{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ui(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,o){const{scale:u,cosPhi:f}=this;return{x:ui(t)*f*u+.5,y:-Math.sin(ui(o))/f*u+.5,z:0}}unproject(t,o){const{scale:u,cosPhi:f}=this,p=-(o-.5)/u,y=ti(Ui((t-.5)/u)/f,-180,180),b=Math.asin(ti(p*f,-1,1)),T=ti(Ui(b),-$n,$n);return new Ai(y,T)}}class oj extends TM{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,o,u){const f=iy(t,o,u),p=Bx(Wc(u));return l.Q.transformMat4(f,f,p),{x:f[0],y:f[1],z:f[2]}}locationPoint(t,o){const u=np(o.lat,o.lng),f=l.Q.normalize([],u),p=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(o),t._centerAltitude):t._centerAltitude,y=No(1,0)*Gt*p;l.Q.scaleAndAdd(u,u,f,y);const b=l.a9.identity(new Float64Array(16));return l.a9.multiply(b,t.pixelMatrix,t.globeMatrix),l.Q.transformMat4(u,u,b),new Ut(u[0],u[1])}pixelsPerMeter(t,o){return No(1,0)*o}pixelSpaceConversion(t,o,u){const f=No(1,t)*o,p=ri(No(1,45)*o,f,u);return this.pixelsPerMeter(t,o)/p}createTileMatrix(t,o,u){const f=O5(Wc(u.canonical));return l.a9.multiply(new Float64Array(16),t.globeMatrix,f)}createInversionMatrix(t,o){const{center:u}=t,f=Bx(Wc(o));return l.a9.rotateY(f,f,ui(u.lng)),l.a9.rotateX(f,f,ui(u.lat)),l.a9.scale(f,f,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(t,o,u,f){return $6(t,o,u,!0)||new io(0,0)}pointCoordinate3D(t,o,u){const f=this.pointCoordinate(t,o,u,0);return[f.x,f.y,f.z]}isPointAboveHorizon(t,o){return!$6(t,o.x,o.y,!1)}farthestPixelDistance(t){const o=function(f,p){const y=f.cameraToCenterDistance,b=f._centerAltitude*p,T=f._camera,A=f._camera.forward(),R=l.Q.add([],l.Q.scale([],A,-y),[0,0,b]),P=f.worldSize/(2*Math.PI),L=[0,0,-P],z=f.width/f.height,N=Math.tan(f.fovAboveCenter),U=l.Q.scale([],T.up(),N),H=l.Q.scale([],T.right(),N*z),W=l.Q.normalize([],l.Q.add([],l.Q.add([],A,U),H)),ie=[];let le;if(new P5(R,W).closestPointOnSphere(L,P,ie)){const se=l.Q.add([],ie,L),we=l.Q.sub([],se,R);le=Math.cos(f.fovAboveCenter)*l.Q.length(we)}else{const se=l.Q.sub([],R,L),we=l.Q.sub([],L,R);l.Q.normalize(we,we);const he=l.Q.length(se)-P;le=Math.sqrt(he*(he+2*P));const Pe=Math.acos(le/(P+he))-Math.acos(l.Q.dot(A,we));le*=Math.cos(Pe)}return 1.01*le}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),u=nd(t.zoom);if(u>0){const f=bM(t,No(1,t.center.lat)*t.worldSize),p=t.worldSize/(2*Math.PI),y=Math.max(t.width,t.height)/t.worldSize*Math.PI;return ri(o,f+p*(1-Math.cos(y)),Math.pow(u,10))}return o}upVector(t,o,u){return iy(o,u,t,1)}upVectorScale(t){return{metersToTile:zx(Nx(Wc(t)))}}}function SM(i){const t=i.parallels,o=!!t&&Math.abs(t[0]+t[1])<.01;switch(i.name){case"mercator":return new TM(i);case"equirectangular":return new rj(i);case"naturalEarth":return new nj(i);case"equalEarth":return new tj(i);case"winkelTripel":return new sj(i);case"albers":return o?new IM(i):new ej(i);case"lambertConformalConic":return o?new IM(i):new ij(i);case"globe":return new oj(i)}throw new Error(`Invalid projection name: ${i.name}`)}const aj=Hx.types,lj=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function lb(i,t,o,u,f,p,y,b,T,A,R,P,L){const z=b?Math.min(cd,Math.round(b[0])):0,N=b?Math.min(cd,Math.round(b[1])):0;i.emplaceBack(t,o,Math.round(32*u),Math.round(32*f),p,y,(z<<1)+(T?1:0),N,16*A,16*R,256*P,256*L)}function cb(i,t,o){i.emplaceBack(t,o)}function ub(i,t,o,u,f,p,y){i.emplaceBack(t,o,u,f,p,y)}function hb(i,t,o,u,f){i.emplaceBack(t,o,u,f),i.emplaceBack(t,o,u,f),i.emplaceBack(t,o,u,f),i.emplaceBack(t,o,u,f)}function cj(i){for(const t of i.sections)if(O(t.text))return!0;return!1}class o4{constructor(t){this.layoutVertexArray=new Il,this.indexArray=new ys,this.programConfigurations=t,this.segments=new jn,this.dynamicLayoutVertexArray=new gs,this.opacityVertexArray=new Hc,this.placedSymbolArray=new d6,this.iconTransitioningVertexArray=new Ra,this.globeExtVertexArray=new Sl,this.zOffsetVertexArray=new Q0}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,o,u,f,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,g2.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,v2.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,lj,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,b2.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,y2.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,x2.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||f)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}er(o4,"SymbolBuffers");class a4{constructor(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new jn,this.collisionVertexArray=new nc,this.collisionVertexArrayExt=new gs}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,w2.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,T2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}er(a4,"CollisionBuffers");class db{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(y=>y.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=l.a9.identity([]),this.placementViewportMatrix=l.a9.identity([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Y5(this.zoom,o["text-size"]),this.iconSizeData=Y5(this.zoom,o["icon-size"]);const u=this.layers[0].layout,f=u.get("symbol-sort-key"),p=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(y=>il[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=u.get("symbol-z-elevate")}createArrays(){this.text=new o4(new ed(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new o4(new ed(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new m6,this.lineVertexArray=new _6,this.symbolInstances=new p6}calculateGlyphDependencies(t,o,u,f,p){for(let y=0;y<t.length;y++){const b=t.codePointAt(y);if(b===void 0)break;if(o[b]=!0,f&&p&&b<=65535){const T=hy[t.charAt(y)];T&&(o[T.charCodeAt(0)]=!0)}}}populate(t,o,u,f){const p=this.layers[0],y=p.layout,b=this.projection.name==="globe",T=y.get("text-font"),A=y.get("text-field"),R=y.get("icon-image"),P=(A.value.kind!=="constant"||A.value.value instanceof Vs&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),L=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,z=y.get("symbol-sort-key");if(this.features=[],!P&&!L)return;const N=o.iconDependencies,U=o.glyphDependencies,H=o.availableImages,W=new J(this.zoom);for(const{feature:ie,id:le,index:se,sourceLayerIndex:we}of t){const he=p._featureFilter.needGeometry,Pe=id(ie,he);if(!p._featureFilter.filter(W,Pe,u))continue;if(he||(Pe.geometry=Zu(ie,u,f)),b&&ie.type!==1&&u.z<=5){const Ye=Pe.geometry,mt=.98078528056,pt=(at,wt)=>{const xt=iy(at.x,at.y,u,1),St=iy(wt.x,wt.y,u,1);return l.Q.dot(xt,St)<mt};for(let at=0;at<Ye.length;at++)Ye[at]=QU(Ye[at],pt)}let Le,qe;if(P){const Ye=p.getValueAndResolveTokens("text-field",Pe,u,H),mt=Vs.factory(Ye);cj(mt)&&(this.hasRTLText=!0),(!this.hasRTLText||fe()==="unavailable"||this.hasRTLText&&ye.isParsed())&&(Le=I2(mt,p,Pe))}if(L){const Ye=p.getValueAndResolveTokens("icon-image",Pe,u,H);qe=Ye instanceof na?Ye:na.fromString(Ye)}if(!Le&&!qe)continue;const ot=this.sortFeaturesByKey?z.evaluate(Pe,{},u):void 0;if(this.features.push({id:le,text:Le,icon:qe,index:se,sourceLayerIndex:we,geometry:Pe.geometry,properties:ie.properties,type:aj[ie.type],sortKey:ot}),qe&&(N[qe.namePrimary]=!0,qe.nameSecondary&&(N[qe.nameSecondary]=!0)),Le){const Ye=T.evaluate(Pe,{},u).join(","),mt=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(il.vertical)>=0;for(const pt of Le.sections)if(pt.image)N[pt.image.namePrimary]=!0;else{const at=h(Le.toString()),wt=pt.fontStack||Ye,xt=U[wt]=U[wt]||{};this.calculateGlyphDependencies(pt.text,xt,mt,this.allowVerticalPlacement,at)}}}y.get("symbol-placement")==="line"&&(this.features=function(ie){const le={},se={},we=[];let he=0;function Pe(Ye){we.push(ie[Ye]),he++}function Le(Ye,mt,pt){const at=se[Ye];return delete se[Ye],se[mt]=at,we[at].geometry[0].pop(),we[at].geometry[0]=we[at].geometry[0].concat(pt[0]),at}function qe(Ye,mt,pt){const at=le[mt];return delete le[mt],le[Ye]=at,we[at].geometry[0].shift(),we[at].geometry[0]=pt[0].concat(we[at].geometry[0]),at}function ot(Ye,mt,pt){const at=pt?mt[0][mt[0].length-1]:mt[0][0];return`${Ye}:${at.x}:${at.y}`}for(let Ye=0;Ye<ie.length;Ye++){const mt=ie[Ye],pt=mt.geometry,at=mt.text?mt.text.toString():null;if(!at){Pe(Ye);continue}const wt=ot(at,pt),xt=ot(at,pt,!0);if(wt in se&&xt in le&&se[wt]!==le[xt]){const St=qe(wt,xt,pt),Et=Le(wt,xt,we[St].geometry);delete le[wt],delete se[xt],se[ot(at,we[Et].geometry,!0)]=Et,we[St].geometry=null}else wt in se?Le(wt,xt,pt):xt in le?qe(wt,xt,pt):(Pe(Ye),le[wt]=he-1,se[xt]=he-1)}return we.filter(Ye=>Ye.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ie,le)=>ie.sortKey-le.sortKey)}update(t,o,u,f,p){const y=Object.keys(t).length!==0;if(y&&!this.stateDependentLayers.length)return;const b=y?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,o,b,u,f,p),this.icon.programConfigurations.updatePaintArrays(t,o,b,u,f,p)}updateZOffset(){const t=(p,y,b)=>{u+=y,u>p.length&&p.resize(u);for(let T=-y;T<0;T++)p.emplace(T+u,b)},o=(p,y,b)=>{f+=y,f>p.length&&p.resize(f);for(let T=-y;T<0;T++)p.emplace(T+f,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,f=0;for(let p=0;p<this.symbolInstances.length;p++){const y=this.symbolInstances.get(p),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:T,numIconVertices:A}=y,R=y.zOffset,P=A>0;if((b>0||T>0)&&(t(this.text.zOffsetVertexArray,b,R),t(this.text.zOffsetVertexArray,T,R)),P){const{placedIconSymbolIndex:L,verticalPlacedIconSymbolIndex:z}=y;L>=0&&o(this.icon.zOffsetVertexArray,A,R),z>=0&&o(this.icon.zOffsetVertexArray,y.numVerticalIconVertices,R)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=SM(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,o){const u=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:f,y:p}of o)this.lineVertexArray.emplaceBack(f,p);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(t,o,u,f,p,y,b,T,A,R,P,L,z,N,U,H){const W=t.indexArray,ie=t.layoutVertexArray,le=t.globeExtVertexArray,se=t.segments.prepareSegment(4*o.length,ie,W,this.canOverlap?y.sortKey:void 0),we=this.glyphOffsetArray.length,he=se.vertexLength,Pe=this.allowVerticalPlacement&&b===il.vertical?Math.PI/2:0,Le=y.text&&y.text.sections;for(let ot=0;ot<o.length;ot++){const{tl:Ye,tr:mt,bl:pt,br:at,texPrimary:wt,texSecondary:xt,pixelOffsetTL:St,pixelOffsetBR:Et,minFontScaleX:gt,minFontScaleY:nr,glyphOffset:Qt,isSDF:kt,sectionIndex:xr}=o[ot],dr=se.vertexLength,sr=Qt[1];if(lb(ie,A.x,A.y,Ye.x,sr+Ye.y,wt.x,wt.y,u,kt,St.x,St.y,gt,nr),lb(ie,A.x,A.y,mt.x,sr+mt.y,wt.x+wt.w,wt.y,u,kt,Et.x,St.y,gt,nr),lb(ie,A.x,A.y,pt.x,sr+pt.y,wt.x,wt.y+wt.h,u,kt,St.x,Et.y,gt,nr),lb(ie,A.x,A.y,at.x,sr+at.y,wt.x+wt.w,wt.y+wt.h,u,kt,Et.x,Et.y,gt,nr),T){const{x:Dt,y:yr,z:Wr}=T.anchor,[Rr,Yr,Zr]=T.up;ub(le,Dt,yr,Wr,Rr,Yr,Zr),ub(le,Dt,yr,Wr,Rr,Yr,Zr),ub(le,Dt,yr,Wr,Rr,Yr,Zr),ub(le,Dt,yr,Wr,Rr,Yr,Zr),hb(t.dynamicLayoutVertexArray,Dt,yr,Wr,Pe)}else hb(t.dynamicLayoutVertexArray,A.x,A.y,A.z,Pe);if(H){const Dt=xt||wt;cb(t.iconTransitioningVertexArray,Dt.x,Dt.y),cb(t.iconTransitioningVertexArray,Dt.x+Dt.w,Dt.y),cb(t.iconTransitioningVertexArray,Dt.x,Dt.y+Dt.h),cb(t.iconTransitioningVertexArray,Dt.x+Dt.w,Dt.y+Dt.h)}W.emplaceBack(dr,dr+1,dr+2),W.emplaceBack(dr+1,dr+2,dr+3),se.vertexLength+=4,se.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qt[0]),ot!==o.length-1&&xr===o[ot+1].sectionIndex||t.programConfigurations.populatePaintArrays(ie.length,y,y.index,{},z,N,U,Le&&Le[xr])}const qe=T?T.anchor:A;t.placedSymbolArray.emplaceBack(qe.x,qe.y,qe.z,A.x,A.y,we,this.glyphOffsetArray.length-we,he,R,P,A.segment,u?u[0]:0,u?u[1]:0,f[0],f[1],b,0,!1,0,L,0)}_commitLayoutVertex(t,o,u,f,p,y,b){t.emplaceBack(o,u,f,p,y,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(t,o,u,f,p,y,b){const T=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),A=T.vertexLength,R=b.tileAnchorX,P=b.tileAnchorY;for(let z=0;z<4;z++)u.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,o,t.padding,b.zOffset),this._commitLayoutVertex(u.layoutVertexArray,f,p,y,R,P,new Ut(t.x1,t.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,p,y,R,P,new Ut(t.x2,t.y1)),this._commitLayoutVertex(u.layoutVertexArray,f,p,y,R,P,new Ut(t.x2,t.y2)),this._commitLayoutVertex(u.layoutVertexArray,f,p,y,R,P,new Ut(t.x1,t.y2)),T.vertexLength+=4;const L=u.indexArray;L.emplaceBack(A,A+1),L.emplaceBack(A+1,A+2),L.emplaceBack(A+2,A+3),L.emplaceBack(A+3,A),T.primitiveLength+=4}_addTextDebugCollisionBoxes(t,o,u,f,p,y){for(let b=f;b<p;b++){const T=u.get(b),A=this.getSymbolInstanceTextSize(t,y,o,b);this._addCollisionDebugVertices(T,A,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(t,o,u,f,p,y){for(let b=f;b<p;b++){const T=u.get(b),A=this.getSymbolInstanceIconSize(t,o,y.placedIconSymbolIndex);this._addCollisionDebugVertices(T,A,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}generateCollisionDebugBuffers(t,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new a4(Qh,WP.members,Ra),this.iconCollisionBox=new a4(Qh,WP.members,Ra);const u=g_(this.iconSizeData,t),f=g_(this.textSizeData,t);for(let p=0;p<this.symbolInstances.length;p++){const y=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(f,t,o,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(f,t,o,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,t,o,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,t,o,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(t,o,u,f){const p=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:f),y=Kx(this.textSizeData,t,p)/qs;return this.tilePixelRatio*y}getSymbolInstanceIconSize(t,o,u){const f=this.icon.placedSymbolArray.get(u),p=Kx(this.iconSizeData,t,f);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(t,o,u,f){t.emplaceBack(o,-u,-u,f),t.emplaceBack(o,u,-u,f),t.emplaceBack(o,u,u,f),t.emplaceBack(o,-u,u,f)}_updateTextDebugCollisionBoxes(t,o,u,f,p,y){for(let b=f;b<p;b++){const T=u.get(b),A=this.getSymbolInstanceTextSize(t,y,o,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,A,T.padding,y.zOffset)}}_updateIconDebugCollisionBoxes(t,o,u,f,p,y){for(let b=f;b<p;b++){const T=u.get(b),A=this.getSymbolInstanceIconSize(t,o,y.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,A,T.padding,y.zOffset)}}updateCollisionDebugBuffers(t,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=g_(this.iconSizeData,t),f=g_(this.textSizeData,t);for(let p=0;p<this.symbolInstances.length;p++){const y=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(f,t,o,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(f,t,o,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(u,t,o,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._updateIconDebugCollisionBoxes(u,t,o,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,o,u,f,p,y,b,T,A){const R={};if(o<u){const{x1:P,y1:L,x2:z,y2:N,padding:U,projectedAnchorX:H,projectedAnchorY:W,projectedAnchorZ:ie,tileAnchorX:le,tileAnchorY:se,featureIndex:we}=t.get(o);R.textBox={x1:P,y1:L,x2:z,y2:N,padding:U,projectedAnchorX:H,projectedAnchorY:W,projectedAnchorZ:ie,tileAnchorX:le,tileAnchorY:se},R.textFeatureIndex=we}if(f<p){const{x1:P,y1:L,x2:z,y2:N,padding:U,projectedAnchorX:H,projectedAnchorY:W,projectedAnchorZ:ie,tileAnchorX:le,tileAnchorY:se,featureIndex:we}=t.get(f);R.verticalTextBox={x1:P,y1:L,x2:z,y2:N,padding:U,projectedAnchorX:H,projectedAnchorY:W,projectedAnchorZ:ie,tileAnchorX:le,tileAnchorY:se},R.verticalTextFeatureIndex=we}if(y<b){const{x1:P,y1:L,x2:z,y2:N,padding:U,projectedAnchorX:H,projectedAnchorY:W,projectedAnchorZ:ie,tileAnchorX:le,tileAnchorY:se,featureIndex:we}=t.get(y);R.iconBox={x1:P,y1:L,x2:z,y2:N,padding:U,projectedAnchorX:H,projectedAnchorY:W,projectedAnchorZ:ie,tileAnchorX:le,tileAnchorY:se},R.iconFeatureIndex=we}if(T<A){const{x1:P,y1:L,x2:z,y2:N,padding:U,projectedAnchorX:H,projectedAnchorY:W,projectedAnchorZ:ie,tileAnchorX:le,tileAnchorY:se,featureIndex:we}=t.get(T);R.verticalIconBox={x1:P,y1:L,x2:z,y2:N,padding:U,projectedAnchorX:H,projectedAnchorY:W,projectedAnchorZ:ie,tileAnchorX:le,tileAnchorY:se},R.verticalIconFeatureIndex=we}return R}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,o){const u=t.placedSymbolArray.get(o),f=u.vertexStartIndex+4*u.numGlyphs;for(let p=u.vertexStartIndex;p<f;p+=4)t.indexArray.emplaceBack(p,p+1,p+2),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(t),u=Math.cos(t),f=[],p=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);const T=this.symbolInstances.get(b);f.push(0|Math.round(o*T.tileAnchorX+u*T.tileAnchorY)),p.push(T.featureIndex)}return y.sort((b,T)=>f[b]-f[T]||p[T]-p[b]),y}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,o){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const u=this.symbolInstances.get(o);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:A}=u;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),p>=0&&p!==f&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&y!==p&&y!==f&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}er(db,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),db.addDynamicAttributes=hb;const uj=new Ue({"symbol-placement":new Oe(me.layout_symbol["symbol-placement"]),"symbol-spacing":new Oe(me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Oe(me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new He(me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Oe(me.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Oe(me.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Oe(me.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Oe(me.layout_symbol["icon-ignore-placement"]),"icon-optional":new Oe(me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Oe(me.layout_symbol["icon-rotation-alignment"]),"icon-size":new He(me.layout_symbol["icon-size"]),"icon-text-fit":new He(me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new He(me.layout_symbol["icon-text-fit-padding"]),"icon-image":new He(me.layout_symbol["icon-image"]),"icon-rotate":new He(me.layout_symbol["icon-rotate"]),"icon-padding":new Oe(me.layout_symbol["icon-padding"]),"icon-keep-upright":new Oe(me.layout_symbol["icon-keep-upright"]),"icon-offset":new He(me.layout_symbol["icon-offset"]),"icon-anchor":new He(me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Oe(me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Oe(me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Oe(me.layout_symbol["text-rotation-alignment"]),"text-field":new He(me.layout_symbol["text-field"]),"text-font":new He(me.layout_symbol["text-font"]),"text-size":new He(me.layout_symbol["text-size"]),"text-max-width":new He(me.layout_symbol["text-max-width"]),"text-line-height":new He(me.layout_symbol["text-line-height"]),"text-letter-spacing":new He(me.layout_symbol["text-letter-spacing"]),"text-justify":new He(me.layout_symbol["text-justify"]),"text-radial-offset":new He(me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Oe(me.layout_symbol["text-variable-anchor"]),"text-anchor":new He(me.layout_symbol["text-anchor"]),"text-max-angle":new Oe(me.layout_symbol["text-max-angle"]),"text-writing-mode":new Oe(me.layout_symbol["text-writing-mode"]),"text-rotate":new He(me.layout_symbol["text-rotate"]),"text-padding":new Oe(me.layout_symbol["text-padding"]),"text-keep-upright":new Oe(me.layout_symbol["text-keep-upright"]),"text-transform":new He(me.layout_symbol["text-transform"]),"text-offset":new He(me.layout_symbol["text-offset"]),"text-allow-overlap":new Oe(me.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Oe(me.layout_symbol["text-ignore-placement"]),"text-optional":new Oe(me.layout_symbol["text-optional"]),visibility:new Oe(me.layout_symbol.visibility)});var l4={paint:new Ue({"icon-opacity":new He(me.paint_symbol["icon-opacity"]),"icon-emissive-strength":new He(me.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new He(me.paint_symbol["text-emissive-strength"]),"icon-color":new He(me.paint_symbol["icon-color"]),"icon-halo-color":new He(me.paint_symbol["icon-halo-color"]),"icon-halo-width":new He(me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new He(me.paint_symbol["icon-halo-blur"]),"icon-translate":new Oe(me.paint_symbol["icon-translate"]),"icon-translate-anchor":new Oe(me.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new He(me.paint_symbol["icon-image-cross-fade"]),"text-opacity":new He(me.paint_symbol["text-opacity"]),"text-color":new He(me.paint_symbol["text-color"],{runtimeType:ia,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new He(me.paint_symbol["text-halo-color"]),"text-halo-width":new He(me.paint_symbol["text-halo-width"]),"text-halo-blur":new He(me.paint_symbol["text-halo-blur"]),"text-translate":new Oe(me.paint_symbol["text-translate"]),"text-translate-anchor":new Oe(me.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Oe(me.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Oe(me.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Oe(me.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Oe(me.paint_symbol["icon-color-brightness-max"])}),layout:uj};class CM{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:si,this.defaultValue=t}evaluate(t){if(t.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}er(CM,"FormatSectionOverride",{omit:["defaultValue"]});class fb extends Qr{constructor(t,o,u){super(t,l4,o,u),this._colorAdjustmentMatrix=l.a9.identity([])}recalculate(t,o){super.recalculate(t,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const f=[];for(const p of u)f.indexOf(p)<0&&f.push(p);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,o,u,f){return this._saturation===t&&this._contrast===o&&this._brightnessMin===u&&this._brightnessMax===f||(this._colorAdjustmentMatrix=function(p,y,b,T){p=q(p),y=M(y);const A=l.a9.create(),R=p/3,P=1-2*R,L=[P,R,R,0,R,P,R,0,R,R,P,0,0,0,0,1],z=.5-.5*y,N=T-b;return l.a9.multiply(A,[N,0,0,0,0,N,0,0,0,0,N,0,b,b,b,1],[y,0,0,0,0,y,0,0,0,0,y,0,z,z,z,1]),l.a9.multiply(A,A,L),A}(t,o,u,f),this._saturation=t,this._contrast=o,this._brightnessMin=u,this._brightnessMax=f),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,o,u,f){const p=this.layout.get(t).evaluate(o,{},u,f),y=this._unevaluatedLayout._values[t];return y.isDataDriven()||n_(y.value)||!p?p:function(b,T){return T.replace(/{([^{}]+)}/g,(A,R)=>R in b?String(b[R]):"")}(o.properties,p)}createBucket(t){return new db(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of l4.paint.overridableProperties){if(!fb.hasPaintOverride(this.layout,t))continue;const o=this.paint.get(t),u=new CM(o),f=new i_(u,o.property.specification,this.scope,this.options);let p=null;p=o.value.kind==="constant"||o.value.kind==="source"?new Zf("source",f):new Xf("composite",f,o.value.zoomStops,o.value._interpolationType),this.paint._values[t]=new Qe(o.property,p,o.parameters)}}_handleOverridablePaintPropertyUpdate(t,o,u){return!(!this.layout||o.isDataDriven()||u.isDataDriven())&&fb.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,o){const u=t.get("text-field"),f=l4.paint.properties[o];let p=!1;const y=b=>{for(const T of b)if(f.overrides&&f.overrides.hasOverride(T))return void(p=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Vs)y(u.value.value.sections);else if(u.value.kind==="source"){const b=A=>{p||(A instanceof Tl&&Kn(A.value)===Fh?y(A.value.sections):A instanceof kf?y(A.sections):A.eachChild(b))},T=u.value;T._styleExpression&&b(T._styleExpression.expression)}return p}getProgramIds(){const t=this.paint.get("icon-opacity").constantOr(1)!==0,o=this.paint.get("text-opacity").constantOr(1)!==0,u=[];return t&&u.push("symbolIcon"),o&&u.push("symbolSDF"),u}getDefaultProgramParams(t,o){return{config:new ip(this,o),overrideFog:!1}}}const hj=new Ue({visibility:new Oe(me.layout_background.visibility)});var dj={paint:new Ue({"background-color":new Oe(me.paint_background["background-color"]),"background-pattern":new Oe(me.paint_background["background-pattern"]),"background-opacity":new Oe(me.paint_background["background-opacity"]),"background-emissive-strength":new Oe(me.paint_background["background-emissive-strength"])}),layout:hj};const fj=new Ue({visibility:new Oe(me.layout_raster.visibility)});var pj={paint:new Ue({"raster-opacity":new Oe(me.paint_raster["raster-opacity"]),"raster-color":new Tt(me.paint_raster["raster-color"]),"raster-color-mix":new Oe(me.paint_raster["raster-color-mix"]),"raster-color-range":new Oe(me.paint_raster["raster-color-range"]),"raster-hue-rotate":new Oe(me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Oe(me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Oe(me.paint_raster["raster-brightness-max"]),"raster-saturation":new Oe(me.paint_raster["raster-saturation"]),"raster-contrast":new Oe(me.paint_raster["raster-contrast"]),"raster-resampling":new Oe(me.paint_raster["raster-resampling"]),"raster-fade-duration":new Oe(me.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Oe(me.paint_raster["raster-emissive-strength"]),"raster-array-band":new Oe(me.paint_raster["raster-array-band"]),"raster-elevation":new Oe(me.paint_raster["raster-elevation"])}),layout:fj},c4=Gr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class u4{constructor(t,o,u,f){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,f)}update(t,o,u){const{width:f,height:p}=t,{context:y}=this,{gl:b}=y;if(b.bindTexture(b.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!o||o.premultiply!==!1)),u||this.size&&this.size[0]===f&&this.size[1]===p){const{x:T,y:A}=u||{x:0,y:0};if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap)b.texSubImage2D(b.TEXTURE_2D,0,T,A,b.RGBA,b.UNSIGNED_BYTE,t);else{let R=this.format,P=b.UNSIGNED_BYTE;this.format===b.R32F&&(R=b.RED,P=b.FLOAT),b.texSubImage2D(b.TEXTURE_2D,0,T,A,f,p,R,P,t.data)}}else if(this.size=[f,p],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap){let T=this.format;this.format===b.R8&&(T=b.RED),b.texImage2D(b.TEXTURE_2D,0,this.format,T,b.UNSIGNED_BYTE,t)}else{let T=this.format,A=this.format,R=b.UNSIGNED_BYTE;this.format===b.DEPTH_COMPONENT&&(T=b.DEPTH_COMPONENT16,R=b.UNSIGNED_SHORT),this.format===b.R8&&(A=b.RED),this.format===b.R32F&&(R=b.FLOAT,A=b.RED),b.texImage2D(b.TEXTURE_2D,0,T,f,p,0,A,R,t.data)}this.useMipmap=!!(o&&o.useMipmap),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(t,o,u=!1){const{context:f}=this,{gl:p}=f;p.bindTexture(p.TEXTURE_2D,this.texture),t!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!u?t===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),o!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(t,o,u,f){const{context:p}=this,{gl:y}=p;y.bindTexture(y.TEXTURE_2D,this.texture),o!==this.magFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,o),this.magFilter=o),t!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap?t===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),u!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,u),this.wrapS=u),f!==this.wrapT&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,f),this.wrapT=f)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class pb{constructor(t,o){this.context=t,this.texture=o}bind(t,o){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),t!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,t),this.minFilter=t),o!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,o),this.wrapS=o)}}function mb(i,t,o,u,f,p,y,b){const T=[i,t,1,o,u,1,f,p,1],A=[y,b,1],R=l.ct.adjoint([],T),[P,L,z]=l.Q.transformMat3(A,A,R);return l.ct.multiply(T,T,[P,0,0,0,L,0,0,0,z])}function RM(i,t,o,u,f,p,y,b){const T=function(A,R,P,L,z,N,U,H){const W=mb(0,0,1,0,1,1,0,1),ie=mb(A,R,P,L,z,N,U,H),le=l.ct.adjoint([],W);return l.ct.multiply(ie,ie,le)}(i,t,o,u,f,p,y,b);return[T[2]/T[8]/Gt,T[5]/T[8]/Gt]}function _b(i){return[i[0],Math.min(Math.max(i[1],-$n),$n)]}class PM extends Lu{constructor(t,o,u,f){super(),this.id=t,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(f),this.options=o,this._dirty=!1}load(t,o){if(this._loaded=o||!1,this.fire(new Nc("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=f0(this.map._requestManager.transformRequest(this.url,Am.Image),(u,f)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new Lm(u)):f&&(this.image=f instanceof HTMLImageElement?ve.getImageData(f):f,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new pb(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Nc("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof pb||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=t[0][1],u=t[0][1];for(const p of t)p[1]>u&&(u=p[1]),p[1]<o&&(o=p[1]);const f=(u+o)/2;if(f>$n?this.onNorthPole=!0:f<-$n&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=t.map(io.fromLngLat);this.tileID=function(y){let b=1/0,T=1/0,A=-1/0,R=-1/0;for(const U of y)b=Math.min(b,U.x),T=Math.min(T,U.y),A=Math.max(A,U.x),R=Math.max(R,U.y);const P=Math.max(A-b,R-T),L=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),z=Math.pow(2,L);let N=Math.floor((b+A)/2*z);return N>1&&(N-=1),new sp(L,N,Math.floor((T+R)/2*z))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Nc("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const W in this.tiles){const ie=this.tiles[W];ie.state!=="loaded"&&(ie.state="loaded",ie.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=my(new sp(0,0,0),this.map.transform.projection),u=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(W){const ie=W[1].x-W[0].x,le=W[1].y-W[0].y,se=W[2].x-W[1].x,we=W[2].y-W[1].y,he=W[3].x-W[2].x,Pe=W[3].y-W[2].y,Le=W[0].x-W[3].x,qe=W[0].y-W[3].y,ot=ie*we-se*le,Ye=se*Pe-he*we,mt=he*qe-Le*Pe,pt=Le*le-ie*qe;return ot>0&&Ye>0&&mt>0&&pt>0||ot<0&&Ye<0&&mt<0&&pt<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const f=my(this.tileID,this.map.transform.projection),[p,y,b,T]=this.coordinates.map(W=>{const ie=f.projection.project(W[0],W[1]);return wM(f,ie)._round()});this.perspectiveTransform=RM(p.x,p.y,y.x,y.y,b.x,b.y,T.x,T.y);const A=this._boundsArray=new $s;A.emplaceBack(p.x,p.y,0,0),A.emplaceBack(y.x,y.y,Gt,0),A.emplaceBack(T.x,T.y,0,Gt),A.emplaceBack(b.x,b.y,Gt,Gt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(A,c4.members),this.boundsSegments=jn.simpleSegment(0,0,4,2);const R=[],P=[_b((L=this.coordinates)[0]),_b(L[1]),_b(L[2]),_b(L[3])];var L;const[z,N,U,H]=function(W){let ie=W[0][0],le=ie,se=W[0][1],we=se;for(let he=1;he<W.length;he++)W[he][0]<ie?ie=W[he][0]:W[he][0]>le&&(le=W[he][0]),W[he][1]<se?se=W[he][1]:W[he][1]>we&&(we=W[he][1]);return[ie,se,le-ie,we-se]}(P);{const W=new $s,[ie,le,se,we]=function(St){let Et=St[0].x,gt=Et,nr=St[0].y,Qt=nr;for(let kt=1;kt<St.length;kt++)St[kt].x<Et?Et=St[kt].x:St[kt].x>gt&&(gt=St[kt].x),St[kt].y<nr?nr=St[kt].y:St[kt].y>Qt&&(Qt=St[kt].y);return[Et,nr,gt-Et,Qt-nr]}(u),he=St=>[(St.x-ie)/se,(St.y-le)/we],[Pe,Le,qe,ot]=u.map(he),Ye=function(St,Et,gt,nr,Qt,kt,xr,dr){const sr=mb(0,0,1,0,1,1,0,1),Dt=mb(St,Et,gt,nr,Qt,kt,xr,dr),yr=l.ct.adjoint([],Dt);return l.ct.multiply(sr,sr,yr)}(Pe[0],Pe[1],Le[0],Le[1],qe[0],qe[1],ot[0],ot[1]);this.elevatedGlobePerspectiveTransform=RM(Pe[0],Pe[1],Le[0],Le[1],qe[0],qe[1],ot[0],ot[1]);const mt=(St,Et)=>{R.push(St.lng);const gt=Math.round((St.lng-z)/U*Gt),nr=Math.round((St.lat-N)/H*Gt),Qt=he(Et),kt=l.Q.transformMat3([],[Qt[0],Qt[1],1],Ye),xr=Math.round(kt[0]/kt[2]*Gt),dr=Math.round(kt[1]/kt[2]*Gt);W.emplaceBack(gt,nr,xr,dr)},pt=u[3].x-u[0].x,at=u[3].y-u[0].y,wt=u[2].x-u[1].x,xt=u[2].y-u[1].y;for(let St=0;St<65;St++){const Et=St/64,gt=[u[0].x+Et*pt,u[0].y+Et*at],nr=[u[1].x+Et*wt,u[1].y+Et*xt],Qt=nr[0]-gt[0],kt=nr[1]-gt[1];for(let xr=0;xr<65;xr++){const dr=xr/64,sr={x:gt[0]+Qt*dr,y:gt[1]+kt*dr,z:0};mt(o.projection.unproject(sr.x,sr.y),sr)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(W,c4.members)}{this.maxLongitudeTriangleSize=0;let W=[],ie=new ys;const le=(se,we,he)=>{ie.emplaceBack(se,we,he);const Pe=R[se],Le=R[we],qe=R[he],ot=Math.min(Math.min(Pe,Le),qe),Ye=Math.max(Math.max(Pe,Le),qe)-ot;Ye>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ye),W.push(ot+Ye/2)};for(let se=0;se<64;se++)for(let we=0;we<64;we++){const he=65*se+we,Pe=he+1,Le=he+65,qe=Le+1;le(he,Le,Pe),le(Pe,Le,qe)}[W,ie]=function(se,we){const he=Array.from({length:se.length},(qe,ot)=>ot);he.sort((qe,ot)=>se[qe]-se[ot]);const Pe=[],Le=new ys;for(let qe=0;qe<he.length;qe++){const ot=he[qe];Pe.push(se[ot]);const Ye=3*ot,mt=Ye+1;Le.emplaceBack(we.uint16[Ye],we.uint16[mt],we.uint16[mt+1])}return[Pe,Le]}(W,ie),this.elevatedGlobeTrianglesCenterLongitudes=W,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(ie)}this.elevatedGlobeSegments=jn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,U/Gt,0,H/Gt,0,0,N,z,0])}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const o=this.map.painter.context,u=o.gl;!this._dirty||this.texture instanceof pb||(this.texture?this.texture.update(this.image):(this.texture=new u4(o,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(o)}loadTile(t,o){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},o(null)):(t.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let f=((R,P)=>R+360*Math.round((P-R)/360))(t+180,u[0]);const p=new jn,y=(R,P)=>{p.segments.push({vertexOffset:0,primitiveOffset:R,vertexLength:o.segments[0].vertexLength,primitiveLength:P,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-f)<=b){const R=bl(u,0,u.length,f+b);return R===u.length||y(R,xl(u,R+1,u.length,f+360-b)-R),p}f<u[0]&&(f+=360);const T=xl(u,0,u.length,f-b);if(T===u.length)return y(0,u.length),p;y(0,T-0);const A=bl(u,T+1,u.length,f+b);return A!==u.length&&y(A,u.length-A),p}}const mj=(Math.pow(256,2)-1)/16907520;class MM extends Qr{constructor(t,o,u){super(t,pj,o,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof PM&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;const o=this._transitionablePaint._values["raster-color"].value.expression,[u,f]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(f)||u===this._curRampRange[0]&&f===this._curRampRange[1]||(this.colorRamp=ny({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:f}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,f])}}const _j=new Ue({visibility:new Oe(me["layout_raster-particle"].visibility)});var gj={paint:new Ue({"raster-particle-array-band":new Oe(me["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Oe(me["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Tt(me["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Oe(me["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Oe(me["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Oe(me["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Oe(me["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:_j};class kM extends Qr{constructor(t,o,u){super(t,gj,o,u),this._updateColorRamp(),this.lastInvalidatedAt=ve.now()}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=ny({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ve.now()}}class yj extends Qr{constructor(t,o){super(t,{},o),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}const vj=new Ue({visibility:new Oe(me.layout_sky.visibility)});var xj={paint:new Ue({"sky-type":new Oe(me.paint_sky["sky-type"]),"sky-atmosphere-sun":new Oe(me.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Oe(me.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Oe(me.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Oe(me.paint_sky["sky-gradient-radius"]),"sky-gradient":new Tt(me.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Oe(me.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Oe(me.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Oe(me.paint_sky["sky-opacity"])}),layout:vj};function h4(i,t,o){const u=[0,0,1],f=l.bl.identity([]);return l.bl.rotateY(f,f,o?-ui(i)+Math.PI:ui(i)),l.bl.rotateX(f,f,-ui(t)),l.Q.transformQuat(u,u,f),l.Q.normalize(u,u)}var bj={paint:new Ue({})};function DM(i,t){const o=gb(i.projection,i.zoom,i.width,i.height),u=function(p,y,b,T,A){const R=new Ai(b.lng-180*hd,b.lat),P=new Ai(b.lng+180*hd,b.lat),L=p.project(R.lng,R.lat),z=p.project(P.lng,P.lat),N=-Math.atan2(z.y-L.y,z.x-L.x),U=io.fromLngLat(b);U.y=ti(U.y,-1+hd,1-hd);const H=U.toLngLat(),W=p.project(H.lng,H.lat),ie=io.fromLngLat(H);ie.x+=hd;const le=ie.toLngLat(),se=p.project(le.lng,le.lat),we=zM(se.x-W.x,se.y-W.y,N),he=io.fromLngLat(H);he.y+=hd;const Pe=he.toLngLat(),Le=p.project(Pe.lng,Pe.lat),qe=zM(Le.x-W.x,Le.y-W.y,N),ot=Math.abs(we.x)/Math.abs(qe.y),Ye=l.a9.identity([]);l.a9.rotateZ(Ye,Ye,-N*(1-(A?0:T)));const mt=l.a9.identity([]);return l.a9.scale(mt,mt,[1,1-(1-ot)*T,1]),mt[4]=-qe.x/qe.y*T,l.a9.rotateZ(mt,mt,N),l.a9.multiply(mt,Ye,mt),mt}(i.projection,0,i.center,o,t),f=LM(i);return l.a9.scale(u,u,[f,f,1]),u}function LM(i){const t=i.projection,o=gb(i.projection,i.zoom,i.width,i.height),u=OM(t,i.center),f=OM(t,Ai.convert(t.center));return Math.pow(2,u*o+(1-o)*f)}function gb(i,t,o,u,f=1/0){const p=i.range;if(!p)return 0;const y=Math.min(f,Math.max(o,u)),b=Math.log(y/1024)/Math.LN2;return yl(p[0]+b,p[1]+b,t)}const hd=1/4e4;function OM(i,t){const o=ti(t.lat,-$n,$n),u=new Ai(t.lng-180*hd,o),f=new Ai(t.lng+180*hd,o),p=i.project(u.lng,o),y=i.project(f.lng,o),b=io.fromLngLat(u),T=io.fromLngLat(f),A=y.x-p.x,R=y.y-p.y,P=T.x-b.x,L=T.y-b.y,z=Math.sqrt((P*P+L*L)/(A*A+R*R));return Math.log(z)/Math.LN2}function zM(i,t,o){const u=Math.cos(o),f=Math.sin(o);return{x:i*u-t*f,y:i*f+t*u}}function FM(i,t,o){l.a9.identity(i),l.a9.rotateZ(i,i,ui(t[2])),l.a9.rotateX(i,i,ui(t[0])),l.a9.rotateY(i,i,ui(t[1])),l.a9.scale(i,i,o),l.a9.multiply(i,i,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function yb(i,t,o,u,f,p,y,b){const T=[o[0]-t[0],o[1]-t[1],0],A=[u[0]-t[0],u[1]-t[1],0];if(l.Q.length(T)<1e-12||l.Q.length(A)<1e-12)return l.bl.identity(i);const R=l.Q.cross([],T,A);l.Q.normalize(R,R),l.Q.subtract(A,u,t),T[2]=(p-f)*b,A[2]=(y-f)*b;const P=T;return l.Q.cross(P,T,A),l.Q.normalize(P,P),l.bl.rotationTo(i,R,P)}function d4(i,t,o=!1){const u=nd(t.zoom),f=function(p,y,b){const T=y.worldSize,A=[p[12],p[13],p[14]],R=Gs(A[1]/T),P=Pa(A[0]/T),L=l.a9.identity([]),z=No(1,R)*T,N=No(1,0)*T*op(R,y.zoom),U=1/z5(T);let H=N*U;if(b){const se=gb(y.projection,y.zoom,y.width,y.height,1024);H=U*y.projection.pixelSpaceConversion(y.center.lat,T,se)}const W=np(R,P);l.Q.add(W,W,l.Q.scale([],l.Q.normalize([],W),z*H*A[2]));const ie=function(se){const we=[se[0],se[1],se[2]];let he=[0,1,0];const Pe=l.Q.cross([],he,we);return l.Q.cross(he,we,Pe),l.Q.squaredLength(he)===0&&(he=[0,1,0],l.Q.cross(Pe,we,he)),l.Q.normalize(Pe,Pe),l.Q.normalize(he,he),l.Q.normalize(we,we),[Pe[0],Pe[1],Pe[2],0,he[0],he[1],he[2],0,we[0],we[1],we[2],0,se[0],se[1],se[2],1]}(W);l.a9.scale(L,L,[H,H,H*z]),l.a9.translate(L,L,[-A[0],-A[1],-A[2]]);const le=l.a9.multiply([],y.globeMatrix,ie);return l.a9.multiply(le,le,L),l.a9.multiply(le,le,p),le}(i,t,o);if(u>0){const p=function(y,b){const T=b.worldSize,A=No(1,0)*T*op(b.center.lat,b.zoom)/z5(T),R=No(1,b.center.lat)*T,P=l.a9.identity([]);return l.a9.rotateY(P,P,ui(b.center.lng)),l.a9.rotateX(P,P,ui(b.center.lat)),l.a9.translate(P,P,[0,0,Fo]),l.a9.scale(P,P,[A,A,A*R]),l.a9.translate(P,P,[b.point.x-.5*T,b.point.y-.5*T,0]),l.a9.multiply(P,P,y),l.a9.multiply(P,b.globeMatrix,P)}(i,t);return function(y,b,T){const A=(N,U,H)=>{const W=l.Q.length(N),ie=l.Q.length(U),le=Xu(N,U,H);return l.Q.scale(le,le,1/l.Q.length(le)*ri(W,ie,H))},R=A([y[0],y[1],y[2]],[b[0],b[1],b[2]],T),P=A([y[4],y[5],y[6]],[b[4],b[5],b[6]],T),L=A([y[8],y[9],y[10]],[b[8],b[9],b[10]],T),z=Xu([y[12],y[13],y[14]],[b[12],b[13],b[14]],T);return[R[0],R[1],R[2],0,P[0],P[1],P[2],0,L[0],L[1],L[2],0,z[0],z[1],z[2],1]}(f,p,u)}return f}function NM(i,t,o,u){const f=vn.projectAabbCorners(u,o);let p=Number.MAX_VALUE,y=-1;for(let A=0;A<f.length;++A){const R=f[A];R[0]=(.5*R[0]+.5)*t.width,R[1]=(.5-.5*R[1])*t.height,R[2]<p&&(y=A,p=R[2])}const b=A=>new Ut(f[A][0],f[A][1]);let T;switch(y){case 0:case 6:T=[b(1),b(5),b(4),b(7),b(3),b(2),b(1)];break;case 1:case 7:T=[b(0),b(4),b(5),b(6),b(2),b(3),b(0)];break;case 3:case 5:T=[b(1),b(0),b(4),b(7),b(6),b(2),b(1)];break;default:T=[b(1),b(5),b(6),b(7),b(3),b(0),b(1)]}if(I5(i,T))return p}const wj=Gr([{name:"a_pos_3f",components:3,type:"Float32"}]),Tj=Gr([{name:"a_color_3f",components:3,type:"Float32"}]),Ej=Gr([{name:"a_color_4f",components:4,type:"Float32"}]),Aj=Gr([{name:"a_uv_2f",components:2,type:"Float32"}]),Ij=Gr([{name:"a_normal_3f",components:3,type:"Float32"}]),Sj=Gr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Cj=Gr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class vb{constructor(t,o,u,f){this.message=(t?`${t}: `:"")+u,f&&(this.identifier=f),o!=null&&o.__line__&&(this.line=o.__line__)}}function BM(i,t){const o=i.indexOf("://")===-1;try{return new URL(i,o&&t?"http://example.com":void 0),!0}catch{return!1}}class VM{constructor(t,o){this.feature=t,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class UM{constructor(){this.instancedDataArray=new h5,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class f4{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1}populate(t,o,u,f){this.tileToMeter=Mx(u);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:y,id:b,index:T,sourceLayerIndex:A}of t){const R=b??(y.properties&&y.properties.hasOwnProperty("id")?y.properties.id:void 0),P=id(y,p);if(!this.layers[0]._featureFilter.filter(new J(this.zoom),P,u))continue;const L={id:R,sourceLayerIndex:A,index:T,geometry:p?P.geometry:Zu(y,u,f),properties:y.properties,type:y.type,patterns:{}},z=this.addFeature(L,L.geometry,P);z&&o.featureIndex.insert(y,L.geometry,T,A,this.index,this.instancesPerModel[z].instancedDataArray.length,Gt/32)}this.lookup=null}update(t,o,u,f){for(const p in this.instancesPerModel){const y=this.instancesPerModel[p];for(const b in t)y.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(y.features[y.idToFeaturesIndex[b]],t[b],y,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];for(const f of u.features){const p=this.layers[0],y=f.feature,b=this.canonical,T=p.paint.get("model-rotation").evaluate(y,{},b),A=p.paint.get("model-scale").evaluate(y,{},b),R=p.paint.get("model-translation").evaluate(y,{},b);l.Q.exactEquals(f.rotation,T)&&l.Q.exactEquals(f.scale,A)&&l.Q.exactEquals(f.translation,R)||(this.evaluate(f,f.featureStates,u,!0),t=!0)}}return t}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=t.createVertexBuffer(u.instancedDataArray,Sj.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const t=this.layers[0].modelManager;if(t&&this.modelUris)for(const o of this.modelUris)t.removeModel(o,"")}addFeature(t,o,u){const f=this.layers[0],p=f.layout.get("model-id").evaluate(u,{},this.canonical);if(!p)return gn(`modelId is not evaluated for layer ${f.id} and it is not going to get rendered.`),p;BM(p,!1)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new UM);const y=this.instancesPerModel[p],b=y.instancedDataArray,T=new VM(u,b.length);for(const A of o)for(const R of A){if(R.x<0||R.x>=Gt||R.y<0||R.y>=Gt)continue;const P=(this.lookupDim-1)/Gt,L=this.lookupDim*(R.y*P|0)+R.x*P|0;if(this.lookup){if(this.lookup[L]!==0)continue;this.lookup[L]=1}this.instanceCount++;const z=b.length;b.resize(z+1),y.instancesEvaluatedElevation.push(0),b.float32[16*z]=R.x,b.float32[16*z+1]=R.y}return T.instancedDataCount=y.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(t.id&&(y.idToFeaturesIndex[t.id]=y.features.length),y.features.push(T),this.evaluate(T,{},y,!1)),p}getModelUris(){return this.modelUris}evaluate(t,o,u,f){const p=this.layers[0],y=t.feature,b=this.canonical,T=t.rotation=p.paint.get("model-rotation").evaluate(y,o,b),A=t.scale=p.paint.get("model-scale").evaluate(y,o,b),R=t.translation=p.paint.get("model-translation").evaluate(y,o,b),P=p.paint.get("model-color").evaluate(y,o,b);P.a=p.paint.get("model-color-mix-intensity").evaluate(y,o,b);const L=[];this.maxVerticalOffset<R[2]&&(this.maxVerticalOffset=R[2]),this.maxScale=Math.max(Math.max(this.maxScale,A[0]),Math.max(A[1],A[2])),FM(L,T,A);const z=Math.round(100*P.a)+P.b/1.05;for(let N=0;N<t.instancedDataCount;++N){const U=t.instancedDataOffset+N,H=16*U,W=u.instancedDataArray.float32;let ie=0;f&&(ie=W[H+6]-u.instancesEvaluatedElevation[U]);const le=0|W[H+1];W[H]=(0|W[H])+P.r/1.05,W[H+1]=le+P.g/1.05,W[H+2]=z,W[H+3]=1/(b.z>10?this.tileToMeter:Mx(b,le)),W[H+4]=R[0],W[H+5]=R[1],W[H+6]=R[2]+ie,W[H+7]=L[0],W[H+8]=L[1],W[H+9]=L[2],W[H+10]=L[4],W[H+11]=L[5],W[H+12]=L[6],W[H+13]=L[8],W[H+14]=L[9],W[H+15]=L[10],u.instancesEvaluatedElevation[U]=R[2]}}}er(f4,"ModelBucket",{omit:["layers"]}),er(UM,"PerModelAttributes"),er(VM,"ModelFeature");const Rj=new Ue({visibility:new Oe(me.layout_model.visibility),"model-id":new He(me.layout_model["model-id"])});var Pj={paint:new Ue({"model-opacity":new Oe(me.paint_model["model-opacity"]),"model-rotation":new He(me.paint_model["model-rotation"]),"model-scale":new He(me.paint_model["model-scale"]),"model-translation":new He(me.paint_model["model-translation"]),"model-color":new He(me.paint_model["model-color"]),"model-color-mix-intensity":new He(me.paint_model["model-color-mix-intensity"]),"model-type":new Oe(me.paint_model["model-type"]),"model-cast-shadows":new Oe(me.paint_model["model-cast-shadows"]),"model-receive-shadows":new Oe(me.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Oe(me.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new He(me.paint_model["model-emissive-strength"]),"model-roughness":new He(me.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new He(me.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Oe(me.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Oe(me.paint_model["model-front-cutoff"])}),layout:Rj};const cp=64,A_={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function jM(i,t,o,u,f,p,y,b,T,A=!1){const R=o.zoom,P=o.project(u),L=op(u.lat,R),z=1/L;l.a9.identity(i),l.a9.translate(i,i,[P.x+y[0]*z,P.y+y[1]*z,y[2]]);let N=1,U=1;const H=o.worldSize;if(A){if(o.projection.name==="mercator"){let se=0;o.elevation&&(se=o.elevation.getAtPointOrZero(new io(P.x/H,P.y/H),0));const we=l.aa.transformMat4([],[P.x,P.y,se,1],o.projMatrix)[3]/o.cameraToCenterDistance;N=we,U=we*op(o.center.lat,R)}else if(o.projection.name==="globe"){const se=d4(i,o),we=l.a9.multiply([],o.projMatrix,se),he=[0,0,0,1];l.aa.transformMat4(he,he,we);const Pe=he[3]/o.cameraToCenterDistance,Le=nd(R),qe=o.projection.pixelsPerMeter(u.lat,H)*op(u.lat,R),ot=o.projection.pixelsPerMeter(o.center.lat,H)*op(o.center.lat,R);N=Pe/ri(qe,R6(o.center.lat),Le),U=Pe*L/qe,N*=ot,U*=ot}}else N=z;l.a9.scale(i,i,[N,N,U]);const W=[...i],ie=t.orientation,le=[];if(FM(le,[ie[0]+f[0],ie[1]+f[1],ie[2]+f[2]],p),l.a9.multiply(i,W,le),b&&o.elevation){let se=0;const we=[];if(T&&o.elevation){se=function(Le,qe,ot,Ye,mt){const pt=qe.elevation;if(!pt)return 0;const at=vn.projectAabbCorners(ot,Ye),wt=No(1,mt.lat)*qe.worldSize,xt=function(yr,Wr){const Rr=[0,0,1],Yr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Zr of Yr){const ai=yr[Zr.corners[0]],Ar=yr[Zr.corners[1]],Gi=yr[Zr.corners[2]],$i=[Ar[0]-ai[0],Ar[1]-ai[1],Wr*(Ar[2]-ai[2])],Pi=l.Q.cross($i,$i,[Gi[0]-ai[0],Gi[1]-ai[1],Wr*(Gi[2]-ai[2])]);l.Q.normalize(Pi,Pi),Zr.dotProductWithUp=l.Q.dot(Pi,Rr)}return Yr.sort((Zr,ai)=>Zr.dotProductWithUp-ai.dotProductWithUp),Yr[0].corners}(at,wt),St=at[xt[0]],Et=at[xt[1]],gt=at[xt[2]],nr=at[xt[3]],Qt=pt.getAtPointOrZero(new io(St[0]/qe.worldSize,St[1]/qe.worldSize),0),kt=pt.getAtPointOrZero(new io(Et[0]/qe.worldSize,Et[1]/qe.worldSize),0),xr=pt.getAtPointOrZero(new io(gt[0]/qe.worldSize,gt[1]/qe.worldSize),0),dr=pt.getAtPointOrZero(new io(nr[0]/qe.worldSize,nr[1]/qe.worldSize),0),sr=(Qt+dr)/2,Dt=(kt+xr)/2;return sr>Dt?kt<xr?yb(Le,Et,nr,St,kt,dr,Qt,wt):yb(Le,gt,St,nr,xr,Qt,dr,wt):Qt<dr?yb(Le,St,Et,gt,Qt,kt,xr,wt):yb(Le,nr,gt,Et,dr,xr,kt,wt),Math.max(sr,Dt)}(we,o,t.aabb,i,u);const he=l.a9.fromQuat([],we),Pe=l.a9.multiply([],he,le);l.a9.multiply(i,W,Pe)}else se=o.elevation.getAtPointOrZero(new io(P.x/H,P.y/H),0);se!==0&&(i[14]+=se)}}function xy(i,t,o=!1){i.uploaded||(i.gfxTexture=new u4(t,i.image,o?t.gl.R8:t.gl.RGBA,{useMipmap:i.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),i.uploaded=!0,i.image=null)}function Mj(i,t,o){i.indexBuffer=t.createIndexBuffer(i.indexArray,!1,!0),i.vertexBuffer=t.createVertexBuffer(i.vertexArray,wj.members,!1,!0),i.normalArray&&(i.normalBuffer=t.createVertexBuffer(i.normalArray,Ij.members,!1,!0)),i.texcoordArray&&(i.texcoordBuffer=t.createVertexBuffer(i.texcoordArray,Aj.members,!1,!0)),i.colorArray&&(i.colorBuffer=t.createVertexBuffer(i.colorArray,(i.colorArray.bytesPerElement===12?Tj:Ej).members,!1,!0)),i.featureArray&&(i.pbrBuffer=t.createVertexBuffer(i.featureArray,Cj.members,!0)),i.segments=jn.simpleSegment(0,0,i.vertexArray.length,i.indexArray.length);const u=i.material;u.pbrMetallicRoughness.baseColorTexture&&xy(u.pbrMetallicRoughness.baseColorTexture,t),u.pbrMetallicRoughness.metallicRoughnessTexture&&xy(u.pbrMetallicRoughness.metallicRoughnessTexture,t),u.normalTexture&&xy(u.normalTexture,t),u.occlusionTexture&&xy(u.occlusionTexture,t,o),u.emissionTexture&&xy(u.emissionTexture,t)}function p4(i,t,o){if(i.meshes)for(const u of i.meshes)Mj(u,t,o);if(i.children)for(const u of i.children)p4(u,t,o)}function xb(i){if(i.meshes)for(const t of i.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(i.children)for(const t of i.children)xb(t)}function m4(i){if(i.meshes)for(const o of i.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((t=o.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(i.children)for(const o of i.children)m4(o)}class kj{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Dj{constructor(){this.tasks={},this.taskQueue=[],Ph(["process"],this),this.invoker=new kj(this.process),this.nextId=0}add(t,o){const u=this.nextId++,f=function({type:p,isSymbolTile:y,zoom:b}){return b=b||0,p==="message"?0:p!=="maybePrepare"||y?p!=="parseTile"||y?p==="parseTile"&&y?300-b:p==="maybePrepare"&&y?400-b:500:200-b:100-b}(o);if(f===0){ko();try{t()}finally{}return null}return this.tasks[u]={fn:t,metadata:o,priority:f,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){ko();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const o=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let t=null,o=1/0;for(let f=0;f<this.taskQueue.length;f++){const p=this.tasks[this.taskQueue[f]];p.priority<o&&(o=p.priority,t=f)}if(t===null)return null;const u=this.taskQueue[t];return this.taskQueue.splice(t,1),u}remove(){this.invoker.remove()}}class $M{constructor(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Ph(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Dj}send(t,o,u,f,p=!1,y){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=y,this.callbacks[b]=u);const T=new Set;return this.target.postMessage({id:b,type:t,hasCallback:!!u,targetMapId:f,mustQueue:p,sourceMapId:this.mapId,data:Qf(o,T)},T),{cancel:()=>{u&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(t){const o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const f=this.cancelCallbacks[u];delete this.cancelCallbacks[u],f&&f.cancel()}else if(o.mustQueue||ko()){const f=this.callbacks[u],p=this.scheduler.add(()=>this.processTask(u,o),f&&f.metadata||{type:"message"});p&&(this.cancelCallbacks[u]=p)}else this.processTask(u,o)}processTask(t,o){if(delete this.cancelCallbacks[t],o.type==="<response>"){const u=this.callbacks[t];delete this.callbacks[t],u&&(o.error?u(m(o.error)):u(null,m(o.data)))}else{const u=new Set,f=o.hasCallback?(y,b)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:y?Qf(y):null,data:Qf(b,u)},u)}:y=>{},p=m(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,p,f);else if(this.parent.getWorkerSource){const y=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,y[0],p.source,p.scope)[y[1]](p,f)}else f(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class I_{constructor(t,o){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=pi();const u=this.workerPool.acquire(this.id);for(let f=0;f<u.length;f++){const p=new I_.Actor(u[f],o,this.id);p.name=`Worker ${f}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,o,u){ta(this.actors,(f,p)=>{f.send(t,o,p)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}I_.Actor=$M;var by={workerUrl:"",workerClass:null,workerParams:void 0};function Lj(){return by.workerClass!=null?new by.workerClass:new self.Worker(by.workerUrl,by.workerParams)}const _4="mapboxgl_preloaded_worker_pool";class wy{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<wy.workerCount;)this.workers.push(new Lj);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[_4]}numActive(){return Object.keys(this.active).length}}let Ty;function bb(){return Ty||(Ty=new wy),Ty}wy.workerCount=2;let wb,g4,lc,S_,y4,C_=null;function GM(){return ko()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:g4||I.DRACO_URL}function qM(){if(ko()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(S_)return S_;const i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return S_=WebAssembly.validate(i)?I.MESHOPT_SIMD_URL:I.MESHOPT_URL,S_}const Tb={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Oj={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Ey={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function HM(i,t,o){const u=o.json.bufferViews.length,f=o.buffers.length;t.bufferView=u,o.json.bufferViews[u]={buffer:f,byteLength:i.byteLength},o.buffers[f]=i}const v4="KHR_draco_mesh_compression";function zj(i,t){const o=i.extensions&&i.extensions[v4];if(!o)return;const u=new lc.Decoder,f=YM(t,o.bufferView),p=new lc.Mesh;if(!u.DecodeArrayToMesh(f,f.byteLength,p))throw new Error("Failed to decode Draco mesh");const y=t.json.accessors[i.indices],b=Tb[y.componentType],T=y.count*b.BYTES_PER_ELEMENT,A=lc._malloc(T);b===Uint16Array?u.GetTrianglesUInt16Array(p,T,A):u.GetTrianglesUInt32Array(p,T,A),HM(lc.memory.buffer.slice(A,A+T),y,t),lc._free(A);for(const R of Object.keys(o.attributes)){const P=u.GetAttributeByUniqueId(p,o.attributes[R]),L=t.json.accessors[i.attributes[R]],z=Oj[L.componentType],N=L.count*Ey[L.type]*Tb[L.componentType].BYTES_PER_ELEMENT,U=lc._malloc(N);u.GetAttributeDataArrayForAllPoints(p,P,lc[z],N,U),HM(lc.memory.buffer.slice(U,U+N),L,t),lc._free(U)}u.destroy(),p.destroy(),delete i.extensions[v4]}const Eb="EXT_meshopt_compression";function Fj(i,t){if(!i.extensions||!i.extensions[Eb])return;const o=i.extensions[Eb],u=new Uint8Array(t.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),f=new Uint8Array(o.count*o.byteStride);y4.decodeGltfBuffer(f,o.count,o.byteStride,u,o.mode,o.filter),i.buffer=t.buffers.length,i.byteOffset=0,t.buffers[i.buffer]=f.buffer,delete i.extensions[Eb]}const WM=1179937895,ZM=new TextDecoder("utf8");function XM(i,t){return new URL(i,t).href}function Nj(i,t,o,u){return fetch(XM(i.uri,u)).then(f=>f.arrayBuffer()).then(f=>{t.buffers[o]=f})}function YM(i,t){const o=i.json.bufferViews[t];return new Uint8Array(i.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function Bj(i,t,o,u){if(i.uri){const f=XM(i.uri,u);return fetch(f).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{t.images[o]=p})}if(i.bufferView!==void 0){const f=YM(t,i.bufferView),p=new Blob([f],{type:i.mimeType});return createImageBitmap(p).then(y=>{t.images[o]=y})}}function QM(i,t=0,o){const u={json:null,images:[],buffers:[]};if(new Uint32Array(i,t,1)[0]===WM){const R=new Uint32Array(i,t);let P=2;const L=(R[P++]>>2)-3,z=R[P++]>>2;if(P++,u.json=JSON.parse(ZM.decode(R.subarray(P,P+z))),P+=z,P<L){const N=R[P++];P++;const U=t+(P<<2);u.buffers[0]=i.slice(U,U+N)}}else u.json=JSON.parse(ZM.decode(new Uint8Array(i,t)));const{buffers:f,images:p,meshes:y,extensionsUsed:b,bufferViews:T}=u.json;let A=Promise.resolve();if(f){const R=[];for(let P=0;P<f.length;P++){const L=f[P];L.uri?R.push(Nj(L,u,P,o)):u.buffers[P]||(u.buffers[P]=null)}A=Promise.all(R)}return A.then(()=>{const R=[],P=b&&b.includes(v4),L=b&&b.includes(Eb);if(P&&R.push(function(){if(!lc)return wb||(wb=function(z){let N,U=null;function H(){N=new Uint8Array(U.buffer)}function W(){throw new Error("Unexpected Draco error.")}const ie={a:{a:W,d:function(le,se,we){return N.copyWithin(le,se,se+we)},c:function(le){const se=N.length,we=Math.max(le>>>0,Math.ceil(1.2*se)),he=Math.ceil((we-se)/65536);try{return U.grow(he),H(),!0}catch{return!1}},b:W}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(z,ie):z.then(le=>le.arrayBuffer()).then(le=>WebAssembly.instantiate(le,ie))).then(le=>{const{Rb:se,Qb:we,P:he,T:Pe,X:Le,Ja:qe,La:ot,Qa:Ye,Va:mt,Wa:pt,eb:at,jb:wt,f:xt,e:St,yb:Et,zb:gt,Ab:nr,Bb:Qt,Db:kt,Gb:xr}=le.instance.exports;U=St;const dr=(()=>{let sr=0,Dt=0,yr=0,Wr=0;return Rr=>{yr&&(se(Wr),se(sr),Dt+=yr,yr=sr=0),sr||(Dt+=128,sr=we(Dt));const Yr=Rr.length+7&-8;let Zr=sr;Yr>=Dt&&(yr=Yr,Zr=Wr=we(Yr));for(let ai=0;ai<Rr.length;ai++)N[Zr+ai]=Rr[ai];return Zr}})();return H(),xt(),{memory:St,_free:se,_malloc:we,Mesh:class{constructor(){this.ptr=he()}destroy(){Pe(this.ptr)}},Decoder:class{constructor(){this.ptr=qe()}destroy(){wt(this.ptr)}DecodeArrayToMesh(sr,Dt,yr){const Wr=dr(sr),Rr=ot(this.ptr,Wr,Dt,yr.ptr);return!!Le(Rr)}GetAttributeByUniqueId(sr,Dt){return{ptr:Ye(this.ptr,sr.ptr,Dt)}}GetTrianglesUInt16Array(sr,Dt,yr){mt(this.ptr,sr.ptr,Dt,yr)}GetTrianglesUInt32Array(sr,Dt,yr){pt(this.ptr,sr.ptr,Dt,yr)}GetAttributeDataArrayForAllPoints(sr,Dt,yr,Wr,Rr){at(this.ptr,sr.ptr,Dt.ptr,yr,Wr,Rr)}},DT_INT8:Et(),DT_UINT8:gt(),DT_INT16:nr(),DT_UINT16:Qt(),DT_UINT32:kt(),DT_FLOAT32:xr()}})}(fetch(GM())),wb.then(z=>{lc=z,wb=void 0}))}()),L&&R.push(function(){if(y4)return;const z=function(N){let U;const H=WebAssembly.instantiateStreaming(N,{}).then(le=>{U=le.instance,U.exports.__wasm_call_ctors()}),W={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ie={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:H,supported:!0,decodeGltfBuffer(le,se,we,he,Pe,Le){(function(qe,ot,Ye,mt,pt,at,wt){const xt=qe.exports.sbrk,St=mt+3&-4,Et=xt(St*pt),gt=xt(at.length),nr=new Uint8Array(qe.exports.memory.buffer);nr.set(at,gt);const Qt=ot(Et,mt,pt,gt,at.length);if(Qt===0&&wt&&wt(Et,St,pt),Ye.set(nr.subarray(Et,Et+mt*pt)),xt(Et-xt(0)),Qt!==0)throw new Error(`Malformed buffer data: ${Qt}`)})(U,U.exports[ie[Pe]],le,se,we,he,U.exports[W[Le]])}}}(fetch(qM()));return z.ready.then(()=>{y4=z})}()),p)for(let z=0;z<p.length;z++)R.push(Bj(p[z],u,z,o));return(R.length?Promise.all(R):Promise.resolve()).then(()=>{if(P&&y)for(const{primitives:z}of y)for(const N of z)zj(N,u);if(L&&y&&T)for(const z of T)Fj(z,u);return u})})}class KM{constructor(t,o,u,f){if(this.triangleCount=o.length/3,this.min=new Ut(0,0),this.max=new Ut(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0)return;const[p,y]=[t[0].clone(),t[0].clone()];for(let P=1;P<t.length;++P){const L=t[P];p.x=Math.min(p.x,L.x),p.y=Math.min(p.y,L.y),y.x=Math.max(y.x,L.x),y.y=Math.max(y.y,L.y)}if(f){const P=Math.ceil(Math.max(y.x-p.x,y.y-p.y)/f);u=Math.max(u,P)}if(u===0)return;this.min=p,this.max=y;const b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);const T=Math.max(b.x,b.y)/u;this.cellsX=Math.max(1,Math.ceil(b.x/T)),this.cellsY=Math.max(1,Math.ceil(b.y/T)),this.xScale=1/T,this.yScale=1/T;const A=[];for(let P=0;P<this.triangleCount;P++){const L=t[o[3*P+0]].sub(this.min),z=t[o[3*P+1]].sub(this.min),N=t[o[3*P+2]].sub(this.min),U=dd(Math.floor(Math.min(L.x,z.x,N.x)),this.xScale,this.cellsX),H=dd(Math.floor(Math.max(L.x,z.x,N.x)),this.xScale,this.cellsX),W=dd(Math.floor(Math.min(L.y,z.y,N.y)),this.yScale,this.cellsY),ie=dd(Math.floor(Math.max(L.y,z.y,N.y)),this.yScale,this.cellsY),le=new Ut(0,0),se=new Ut(0,0),we=new Ut(0,0),he=new Ut(0,0);for(let Pe=W;Pe<=ie;++Pe){le.y=se.y=Pe*T,we.y=he.y=(Pe+1)*T;for(let Le=U;Le<=H;++Le)le.x=we.x=Le*T,se.x=he.x=(Le+1)*T,(R5(L,z,N,le,se,he)||R5(L,z,N,le,he,we))&&A.push({cellIdx:Pe*this.cellsX+Le,triIdx:P})}}if(A.length===0)return;A.sort((P,L)=>P.cellIdx-L.cellIdx||P.triIdx-L.triIdx);let R=0;for(;R<A.length;){const P=A[R].cellIdx,L={start:this.payload.length,len:0};for(;R<A.length&&A[R].cellIdx===P;)++L.len,this.payload.push(A[R++].triIdx);this.cells[P]=L}}query(t,o,u){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>o.x||t.y>this.max.y||this.min.y>o.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let T=0;T<this.lookup.length;T++)this.lookup[T]=0;const f=dd(t.x-this.min.x,this.xScale,this.cellsX),p=dd(o.x-this.min.x,this.xScale,this.cellsX),y=dd(t.y-this.min.y,this.yScale,this.cellsY),b=dd(o.y-this.min.y,this.yScale,this.cellsY);for(let T=y;T<=b;T++)for(let A=f;A<=p;A++){const R=this.cells[T*this.cellsX+A];if(R)for(let P=0;P<R.len;P++){const L=this.payload[R.start+P],z=Math.floor(L/8),N=1<<L%8;if(!(this.lookup[z]&N)&&(this.lookup[z]|=N,u.push(L),u.length===this.triangleCount))return}}}}function dd(i,t,o){return Math.max(0,Math.min(o-1,Math.floor(i*t)))}function up(i,t){const o=i.json.bufferViews[t.bufferView],u=Tb[t.componentType];return new u(i.buffers[o.buffer],(t.byteOffset||0)+(o.byteOffset||0),t.count*(o.byteStride&&o.byteStride!==Ey[t.type]*u.BYTES_PER_ELEMENT?o.byteStride/u.BYTES_PER_ELEMENT:Ey[t.type]))}function x4(i,t,o,u){const f=Tb[t.componentType],p=function(R){switch(R){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(f),y=i.json.bufferViews[t.bufferView],b=y.byteStride?y.byteStride/f.BYTES_PER_ELEMENT:Ey[t.type],T=o.float32,A=T.length/o.capacity;for(let R=0,P=0;R<t.count*b;R+=b,P+=A)for(let L=0;L<A;L++)T[P+L]=u[R+L]*p;o._trim()}function Vj(i,t,o){const u=i.indices,f=i.attributes,p={};p.indexArray=new ys;const y=t.json.accessors[u],b=y.count/3;p.indexArray.reserve(b);const T=up(t,y);for(let L=0;L<b;L++)p.indexArray.emplaceBack(T[3*L],T[3*L+1],T[3*L+2]);p.indexArray._trim(),p.vertexArray=new rp;const A=t.json.accessors[f.POSITION];p.vertexArray.reserve(A.count);const R=up(t,A);for(let L=0;L<A.count;L++)p.vertexArray.emplaceBack(R[3*L],R[3*L+1],R[3*L+2]);if(p.vertexArray._trim(),p.aabb=new vn(A.min,A.max),p.centroid=function(L,z){const N=[0,0,0],U=L.length;if(U>0){for(let H=0;H<U;H++){const W=3*L[H];N[0]+=z[W],N[1]+=z[W+1],N[2]+=z[W+2]}N[0]/=U,N[1]/=U,N[2]/=U}return N}(T,R),f.COLOR_0!==void 0){const L=t.json.accessors[f.COLOR_0],z=Ey[L.type],N=up(t,L);p.colorArray=z===3?new rp:new gs,p.colorArray.resize(L.count),x4(t,L,p.colorArray,N)}if(f.NORMAL!==void 0){p.normalArray=new rp;const L=t.json.accessors[f.NORMAL];p.normalArray.resize(L.count);const z=up(t,L);x4(t,L,p.normalArray,z)}if(f.TEXCOORD_0!==void 0&&o.length>0){p.texcoordArray=new Cs;const L=t.json.accessors[f.TEXCOORD_0];p.texcoordArray.resize(L.count);const z=up(t,L);x4(t,L,p.texcoordArray,z)}if(f._FEATURE_ID_RGBA4444!==void 0){const L=t.json.accessors[f._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=up(t,L))}f._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(up(t,t.json.accessors[f._FEATURE_RGBA4444]).buffer));const P=i.material;return p.material=function(L,z){const{emissiveFactor:N=[0,0,0],alphaMode:U="OPAQUE",alphaCutoff:H=.5,normalTexture:W,occlusionTexture:ie,emissiveTexture:le,doubleSided:se}=L,{baseColorFactor:we=[1,1,1,1],metallicFactor:he=1,roughnessFactor:Pe=1,baseColorTexture:Le,metallicRoughnessTexture:qe}=L.pbrMetallicRoughness||{},ot=ie?z[ie.index]:void 0;if(ie&&ie.extensions&&ie.extensions.KHR_texture_transform&&ot){const Ye=ie.extensions.KHR_texture_transform;ot.offsetScale=[Ye.offset[0],Ye.offset[1],Ye.scale[0],Ye.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Bi(...we),metallicFactor:he,roughnessFactor:Pe,baseColorTexture:Le?z[Le.index]:void 0,metallicRoughnessTexture:qe?z[qe.index]:void 0},doubleSided:se,emissiveFactor:N,alphaMode:U,alphaCutoff:H,normalTexture:W?z[W.index]:void 0,occlusionTexture:ot,emissionTexture:le?z[le.index]:void 0,defined:L.defined===void 0}}(P!==void 0?t.json.materials[P]:{defined:!1},o),p}function JM(i,t,o){const{matrix:u,rotation:f,translation:p,scale:y,mesh:b,extras:T,children:A}=i,R={};if(R.matrix=u||l.a9.fromRotationTranslationScale([],f||[0,0,0,1],p||[0,0,0],y||[1,1,1]),b!==void 0){R.meshes=o[b];const P=R.anchor=[0,0];for(const L of R.meshes){const{min:z,max:N}=L.aabb;P[0]+=z[0]+N[0],P[1]+=z[1]+N[1]}P[0]=Math.floor(P[0]/R.meshes.length/2),P[1]=Math.floor(P[1]/R.meshes.length/2)}if(T&&(T.id&&(R.id=T.id),T.lights&&(R.lights=function(P){if(!P.length)return[];const L=function(W){const ie=atob(W),le=new Uint8Array(ie.length);for(let se=0;se<ie.length;se++)le[se]=ie.codePointAt(se);return le}(P),z=[],N=L.length/24,U=new Uint16Array(L.buffer),H=new Float32Array(L.buffer);for(let W=0;W<N;W++){const ie=U[2*W*6]/30,le=U[2*W*6+1]/30,se=U[2*W*6+10]/100,we=H[6*W+1],he=H[6*W+2],Pe=H[6*W+3],Le=H[6*W+4],qe=Pe-we,ot=Le-he,Ye=Math.hypot(qe,ot);z.push({pos:[we+.5*qe,he+.5*ot,le],normal:[ot/Ye,-qe/Ye,0],width:Ye,height:ie,depth:se,points:[we,he,Pe,Le]})}return z}(T.lights))),A){const P=[];for(const L of A)P.push(JM(t.json.nodes[L],t,o));R.children=P}return R}function Uj(i){if(i.vertices.length===0||i.indices.length===0)return null;const t=new KM(i.vertices,i.indices,8,256),[o,u]=[t.min.clone(),t.max.clone()];return{vertices:i.vertices,indices:i.indices,grid:t,min:o,max:u}}function jj(i){if(!i.extras||!i.extras.ground)return null;const t=i.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const o=t[0];if(!o||!Array.isArray(o)||o.length===0)return null;const u=[];for(const y of o){if(!Array.isArray(y)||y.length!==2)continue;const b=y[0],T=y[1];typeof b=="number"&&typeof T=="number"&&u.push(new Ut(b,T))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let f=0;for(let y=0;y<u.length;y++){const b=u[y],T=u[(y+1)%u.length],A=u[(y+2)%u.length];f+=(b.x-T.x)*(A.y-T.y)-(A.x-T.x)*(b.y-T.y)}f>0&&u.reverse();const p=Gx(u.flatMap(y=>[y.x,y.y]),[]);return p.length===0?null:{vertices:u,indices:p}}function $j(i,t){const o=[],u=[];let f=0;const p=[];for(const y of i){f=o.length;const b=y.vertexArray.float32,T=y.indexArray.uint16;for(let A=0;A<y.vertexArray.length;A++)p[0]=b[3*A+0],p[1]=b[3*A+1],p[2]=b[3*A+2],l.Q.transformMat4(p,p,t),o.push(new Ut(p[0],p[1]));for(let A=0;A<3*y.indexArray.length;A++)u.push(T[A]+f)}if(u.length%3!=0)return null;for(let y=0;y<u.length;y+=3){const b=o[u[y+0]],T=o[u[y+1]],A=o[u[y+2]];(b.x-T.x)*(A.y-T.y)-(A.x-T.x)*(b.y-T.y)>0&&([u[y+1],u[y+2]]=[u[y+2],u[y+1]])}return{vertices:o,indices:u}}function e3(i){const t=function(T,A){const R=[],P=WebGL2RenderingContext;if(T.json.textures)for(const L of T.json.textures){const z={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};L.sampler!==void 0&&Object.assign(z,T.json.samplers[L.sampler]),R.push({image:A[L.source],sampler:z,uploaded:!1})}return R}(i,i.images),o=function(T,A){const R=[];for(const P of T.json.meshes){const L=[];for(const z of P.primitives)L.push(Vj(z,T,A));R.push(L)}return R}(i,t),{scenes:u,scene:f,nodes:p}=i.json,y=u?u[f||0].nodes:p,b=[];for(const T of y)b.push(JM(p[T],i,o));return function(T,A,R){const P={},L=new Set;for(let z=0;z<T.length;z++){const N=R[A[z]];if(!N.extras)continue;const U=N.extras["mapbox:footprint:version"],H=N.extras["mapbox:footprint:id"];(U||H)&&L.add(z),U==="1.0.0"&&H&&(P[H]=z)}for(let z=0;z<T.length;z++){if(L.has(z))continue;const N=T[z],U=R[A[z]];if(!U.extras)continue;let H=null;N.id in P&&(H=$j(T[P[N.id]].meshes,N.matrix)),H||(H=jj(U)),H&&(N.footprint=Uj(H))}if(L.size>0){const z=Array.from(L.values()).sort((N,U)=>N-U);for(let N=z.length-1;N>=0;N--)T.splice(z[N],1)}}(b,y,i.json.nodes),b}function Gj(i){i.heightmap=new Float32Array(4096),i.heightmap.fill(-1);const t=i.vertexArray.float32,o=i.aabb.min[0]-1,u=i.aabb.min[1]-1,f=cp/(i.aabb.max[0]-o+2),p=cp/(i.aabb.max[1]-u+2);for(let y=0;y<t.length;y+=3){const b=t[y+2],T=(t[y+0]-o)*f|0,A=(t[y+1]-u)*p|0;b>i.heightmap[A*cp+T]&&(i.heightmap[A*cp+T]=b)}}function qj(i,t){const o={};o.indexArray=new ys,o.indexArray.reserve(4*i.length),o.vertexArray=new rp,o.vertexArray.reserve(10*i.length),o.colorArray=new gs,o.vertexArray.reserve(10*i.length);let u=0;for(const y of i){const b=Math.min(10,Math.max(4,1.3*y.height))*t,T=[-y.normal[1],y.normal[0],0],A=Math.min(.29,.1*y.width/y.depth),R=y.width-2*y.depth*t*(A+.01),P=l.Q.scaleAndAdd([],y.pos,T,R/2),L=l.Q.scaleAndAdd([],y.pos,T,-R/2),z=[P[0],P[1],P[2]+y.height],N=[L[0],L[1],L[2]+y.height],U=l.Q.scaleAndAdd([],y.normal,T,A);l.Q.scale(U,U,b);const H=l.Q.scaleAndAdd([],y.normal,T,-A);l.Q.scale(H,H,b),l.Q.add(U,P,U),l.Q.add(H,L,H),P[2]+=.1,L[2]+=.1,o.vertexArray.emplaceBack(U[0],U[1],U[2]),o.vertexArray.emplaceBack(H[0],H[1],H[2]),o.vertexArray.emplaceBack(P[0],P[1],P[2]),o.vertexArray.emplaceBack(L[0],L[1],L[2]),o.vertexArray.emplaceBack(z[0],z[1],z[2]),o.vertexArray.emplaceBack(N[0],N[1],N[2]),o.vertexArray.emplaceBack(P[0],P[1],P[2]),o.vertexArray.emplaceBack(L[0],L[1],L[2]),o.vertexArray.emplaceBack(U[0],U[1],U[2]),o.vertexArray.emplaceBack(H[0],H[1],H[2]);const W=R/b/2;o.colorArray.emplaceBack(-W-A,-1,W,.8),o.colorArray.emplaceBack(W+A,-1,W,.8),o.colorArray.emplaceBack(-W,0,W,1.3),o.colorArray.emplaceBack(W,0,W,1.3),o.colorArray.emplaceBack(W+A,-.8,W,.7),o.colorArray.emplaceBack(W+A,-.8,W,.7),o.colorArray.emplaceBack(0,0,W,1.3),o.colorArray.emplaceBack(0,0,W,1.3),o.colorArray.emplaceBack(W+A,-1.2,W,.8),o.colorArray.emplaceBack(W+A,-1.2,W,.8),o.indexArray.emplaceBack(6+u,4+u,8+u),o.indexArray.emplaceBack(7+u,9+u,5+u),o.indexArray.emplaceBack(0+u,1+u,2+u),o.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const f={defined:!0,emissiveFactor:[0,0,0]},p={};return p.baseColorFactor=Bi.white,f.pbrMetallicRoughness=p,o.material=f,o.aabb=new vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}er(KM,"TriangleGridIndex");class t3{constructor(t){this._stringToNumber={},this._numberToString=[];for(let o=0;o<t.length;o++){const u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const Hj=["tile","layer","source","sourceLayer","state"];class r3{constructor(t,o,u,f,p){this.type="Feature",this._vectorTileFeature=t,this._z=o,this._x=u,this._y=f,this.properties=t.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(const o of Hj)this[o]!==void 0&&(t[o]=this[o]);return t}}class i3{constructor(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Yh(Gt,16,0),this.featureIndexArray=new y6,this.promoteId=o,this.is3DTile=!1}insert(t,o,u,f,p,y=0,b=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,f,p,y);const A=this.grid;for(let R=0;R<o.length;R++){const P=o[R],L=[1/0,1/0,-1/0,-1/0];for(let z=0;z<P.length;z++){const N=P[z];L[0]=Math.min(L[0],N.x),L[1]=Math.min(L[1],N.y),L[2]=Math.max(L[2],N.x),L[3]=Math.max(L[3],N.y)}b!==0&&(L[0]-=b,L[1]-=b,L[2]+=b,L[3]+=b),L[0]<Gt&&L[1]<Gt&&L[2]>=0&&L[3]>=0&&A.insert(T,L[0],L[1],L[2],L[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new W5(new x_(this.rawTileData)).layers,this.sourceLayerCoder=new t3(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,o,u,f){this.loadVTLayers();const p=t.params||{},y=Zt(p.filter),b=t.tileResult,T=t.transform,A=b.bufferedTilespaceBounds,R=this.grid.query(A.min.x,A.min.y,A.max.x,A.max.y,(N,U,H,W)=>z6(b.bufferedTilespaceGeometry,N,U,H,W));R.sort(Wj);let P=null;T.elevation&&R.length>0&&(P=m_.create(T.elevation,this.tileID));const L={};let z;for(let N=0;N<R.length;N++){const U=R[N];if(U===z)continue;z=U;const H=this.featureIndexArray.get(U);let W=null;if(this.is3DTile){const ie=this.bucketLayerIDs[0][0],le=o[ie];if(le.type!=="model")continue;const{queryFeature:se,intersectionZ:we}=le.queryIntersectsMatchingFeature(b,H.featureIndex,y,T);se&&this.appendToResult(L,ie,H.featureIndex,se,we)}else this.loadMatchingFeature(L,H,y,p.layers,p.availableImages,o,u,f,(ie,le,se,we=0)=>(W||(W=Zu(ie,this.tileID.canonical,t.tileTransform)),le.queryIntersectsFeature(b,ie,se,W,this.z,t.transform,t.pixelPosMatrix,P,we)))}return L}loadMatchingFeature(t,o,u,f,p,y,b,T,A){const{featureIndex:R,bucketIndex:P,sourceLayerIndex:L,layoutVertexArrayOffset:z}=o,N=this.bucketLayerIDs[P];if(f&&!function(ie,le){for(let se=0;se<ie.length;se++)if(le.indexOf(ie[se])>=0)return!0;return!1}(f,N))return;const U=this.sourceLayerCoder.decode(L),H=this.vtLayers[U].feature(R);if(u.needGeometry){const ie=id(H,!0);if(!u.filter(new J(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!u.filter(new J(this.tileID.overscaledZ),H))return;const W=this.getId(H,U);for(let ie=0;ie<N.length;ie++){const le=N[ie];if(f&&f.indexOf(le)<0)continue;const se=y[le];if(!se)continue;let we={};W!==void 0&&T&&(we=T.getState(se.sourceLayer||"_geojsonTileLayer",W));const he=!A||A(H,se,we,z);if(!he)continue;const Pe=new r3(H,this.z,this.x,this.y,W),Le=_o({},b[le]);Le.paint=n3(Le.paint,se.paint,H,we,p),Le.layout=n3(Le.layout,se.layout,H,we,p),Pe.layer=Le,this.appendToResult(t,le,R,Pe,he)}}appendToResult(t,o,u,f,p){let y=t[o];y===void 0&&(y=t[o]=[]),y.push({featureIndex:u,feature:f,intersectionZ:p})}lookupSymbolFeatures(t,o,u,f,p,y,b,T){const A={};this.loadVTLayers();const R=Zt(p);for(const P of t)this.loadMatchingFeature(A,{bucketIndex:u,sourceLayerIndex:f,featureIndex:P,layoutVertexArrayOffset:0},R,y,b,T,o);return A}loadFeature(t){const{featureIndex:o,sourceLayerIndex:u}=t;this.loadVTLayers();const f=this.sourceLayerCoder.decode(u),p=this.vtFeatures[f];if(p[o])return p[o];const y=this.vtLayers[f].feature(o);return p[o]=y,y}hasLayer(t){for(const o of this.bucketLayerIDs)for(const u of o)if(t===u)return!0;return!1}getId(t,o){let u=t.id;if(this.promoteId){const f=typeof this.promoteId=="string"?this.promoteId:this.promoteId[o];f!=null&&(u=t.properties[f]),typeof u=="boolean"&&(u=Number(u))}return u}}function n3(i,t,o,u,f){return Dc(i,(p,y)=>{const b=t instanceof it?t.get(y):null;return b&&b.evaluate?b.evaluate(o,u,f):b})}function Wj(i,t){return t-i}er(i3,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const b4=new Float32Array(262144),hp=new Uint8Array(262144);function s3(i){let t=0;if(i.meshes)for(const o of i.meshes)t=Math.max(t,o.aabb.max[2]);if(i.children)for(const o of i.children)t=Math.max(t,s3(o));return t}function o3(i,t,o){if(i.meshes)for(const u of i.meshes)u.aabb.min[0]!==1/0&&o.insert(t,u.aabb.min[0],u.aabb.min[1],u.aabb.max[0],u.aabb.max[1]);if(i.children)for(const u of i.children)o3(u,t,o)}const a3=["","wall","door","roof","window","lamp","logo"];class l3{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:s3(t)}}}getLocalBounds(){if(!this.node.meshes)return new vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const o=new vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==t&&o.encapsulate(u.aabb),t++;this.aabb=vn.applyTransform(o,this.node.matrix)}return this.aabb}}class Ab{constructor(t,o,u,f,p,y){this.id=o,this.modelTraits|=A_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=A_.HasMapboxMeshFeatures),f&&(this.modelTraits|=A_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const b of t)this.nodesInfo.push(new l3(b)),o3(b,y.featureIndexArray.length,y.grid),y.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,y.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const u of o){const f=u.node;this.uploaded?this.updatePbrBuffer(f):p4(f,t,!0)}for(const u of o)xb(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let o=!1;if(!t.meshes)return o;for(const u of t.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),o=!0);return o}needsReEvaluation(t,o,u){const f=t.transform.projectionOptions,p=t.style.getBrightness(),y=this.brightness!==p;return!!(!this.uploaded||this.dirty||f.name!==this.projection.name||Ay(u.paint.get("model-color").value,y)||Ay(u.paint.get("model-color-mix-intensity").value,y)||Ay(u.paint.get("model-roughness").value,y)||Ay(u.paint.get("model-emissive-strength").value,y)||Ay(u.paint.get("model-height-based-emissive-strength-multiplier").value,y))&&(this.projection=f,this.brightness=p,!0)}evaluateScale(t,o){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const u=this.getNodesInfo(),f=this.id.canonical;for(const p of u){const y=p.feature;p.evaluatedScale=o.paint.get("model-scale").evaluate(y,{},f)}}evaluate(t){const o=this.getNodesInfo();for(const u of o){if(!u.node.meshes)continue;const f=u.feature,p=u.node.meshes&&u.node.meshes[0].featureData,y=u.evaluatedColor[2],b=u.evaluatedRMEA[2],T=this.id.canonical;if(u.hasTranslucentParts=!1,p){for(let A=0;A<a3.length;A++){const R=a3[A];R.length&&(f.properties.part=R);const P=t.paint.get("model-color").evaluate(f,{},T),L=t.paint.get("model-color-mix-intensity").evaluate(f,{},T);u.evaluatedColor[A]=[P.r,P.g,P.b,L],u.evaluatedRMEA[A][0]=t.paint.get("model-roughness").evaluate(f,{},T),u.evaluatedRMEA[A][2]=t.paint.get("model-emissive-strength").evaluate(f,{},T),u.evaluatedRMEA[A][3]=P.a,u.emissionHeightBasedParams[A]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(f,{},T),!u.hasTranslucentParts&&P.a<1&&(u.hasTranslucentParts=!0)}delete f.properties.part,Xj(u,y!==u.evaluatedColor[2]||b!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(f,{},T);u.evaluatedScale=t.paint.get("model-scale").evaluate(f,{},T),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,o,u,f){const p=t.findDEMTileFor(u);if(p&&(p.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const y=m_.create(t,u,p);if(!y)return;this.modelTraits&A_.HasMapboxMeshFeatures&&this.updateDEM(t,y,u,f);for(const b of this.getNodesInfo()){const T=b.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const A=T.footprint.vertices;let R=y.getElevationAt(A[0].x,A[0].y,!0,!0);for(let P=1;P<A.length;P++)R=Math.min(R,y.getElevationAt(A[P].x,A[P].y,!0,!0));T.elevation=R}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=o}}updateDEM(t,o,u,f){let p=o._dem._modifiedForSources[f];if(p===void 0&&(o._dem._modifiedForSources[f]=[],p=o._dem._modifiedForSources[f]),p.includes(u.canonical))return;const y=o._dem.dim;p.push(u.canonical);let b=!1;for(const T of this.getNodesInfo()){const A=T.node;if(!A.footprint||!A.footprint.grid)continue;const R=A.footprint.grid,P=o.tileCoordToPixel(R.min.x,R.min.y),L=o.tileCoordToPixel(R.max.x,R.max.y),z=Math.min(Math.min(y-L.y,P.x),Math.min(P.y,y-L.x));if(z<0)continue;const N=ti(z,2,5);let U=Math.max(0,P.x-N),H=Math.max(0,P.y-N),W=Math.min(L.x+N,y-1),ie=Math.min(L.y+N,y-1);for(let he=H;he<=ie;++he)for(let Pe=U;Pe<=W;++Pe)hp[he*y+Pe]=255;let le=0,se=0;for(let he=0;he<R.cellsY;++he)for(let Pe=0;Pe<R.cellsX;++Pe){if(!R.cells[he*R.cellsX+Pe])continue;const Le=o.tileCoordToPixel(R.min.x+Pe/R.xScale,R.min.y+he/R.yScale),qe=o.tileCoordToPixel(R.min.x+(Pe+1)/R.xScale,R.min.y+(he+1)/R.yScale);for(let ot=Le.y;ot<=Math.min(qe.y+1,y-1);++ot)for(let Ye=Le.x;Ye<=Math.min(qe.x+1,y-1);++Ye)hp[ot*y+Ye]===255&&(hp[ot*y+Ye]=0,le+=o.getElevationAtPixel(Ye,ot),se++)}const we=le/se;U=Math.max(1,P.x-N),H=Math.max(1,P.y-N),W=Math.min(L.x+N,y-2),ie=Math.min(L.y+N,y-2),b=!0;for(let he=H;he<=ie;++he)for(let Pe=U;Pe<=W;++Pe)hp[he*y+Pe]===0&&(b4[he*y+Pe]=o._dem.set(Pe,he,we));for(let he=1;he<N;++he){U=Math.max(1,P.x-he),H=Math.max(1,P.y-he),W=Math.min(L.x+he,y-2),ie=Math.min(L.y+he,y-2);for(let Pe=H;Pe<=ie;++Pe)for(let Le=U;Le<=W;++Le){const qe=Pe*y+Le;if(hp[qe]===255){let ot=0,Ye=0,mt=-1,pt=-1;for(let at=-1;at<=1;++at)for(let wt=-1;wt<=1;++wt){const xt=(Pe+at)*y+Le+wt;if(hp[xt]>=he)continue;const St=b4[xt],Et=Math.abs(St);Et>Ye&&(ot=St,Ye=Et,mt=wt,pt=at)}if(Ye>.1){const at=1-(he+.5*Math.abs(mt*pt))/N;let wt=o._dem.get(Le,Pe)+ot*at;const xt=o._dem.get(Le+mt,Pe+pt),St=o._dem.get(Le-mt,Pe-pt,!0);(wt-xt)*(wt-St)>0&&(wt=(xt+St)/2),b4[qe]=o._dem.set(Le,Pe,wt),hp[qe]=he}}}}}b&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=ve.now())}getNodesInfo(){return this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const o of t)xb(o.node),m4(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(t.toUnwrapped()),f=this.getNodesInfo();for(let p=0;p<this.nodesInfo.length;p++){const y=f[p].node;f[p].hiddenByReplacement=!!y.footprint&&!u.find(b=>b.footprint===y.footprint)}}getHeightAtTileCoord(t,o){const u=this.getNodesInfo(),f=[],p=[0,0,0];for(let y=0;y<this.nodesInfo.length;y++){const b=u[y],T=b.node.meshes[0],A=vn.applyTransform(T.aabb,b.node.matrix);if(t<A.min[0]||o<A.min[1]||t>A.max[0]||o>A.max[1])continue;const R=(t-T.aabb.min[0])/(T.aabb.max[0]-T.aabb.min[0])*cp|0,P=Math.min(63,(o-T.aabb.min[1])/(T.aabb.max[1]-T.aabb.min[1])*cp|0)*cp+Math.min(63,R);if(p[2]=T.heightmap[P],l.Q.transformMat4(p,p,b.node.matrix),!(T.heightmap[P]<0&&b.node.footprint))return b.hiddenByReplacement?void 0:{height:p[2],maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};if(b.node.footprint.grid.query(new Ut(t,o),new Ut(t,o),f),f.length>0)return{height:void 0,maxHeight:b.feature.properties.height,hidden:b.hiddenByReplacement,verticalScale:b.evaluatedScale[2]}}}}function Ay(i,t){return!i.isLightConstant&&t}function Zj(i,t,o,u,f,p,y,b){let T=(61440&t|(61440&t)>>4)>>8,A=(3840&t|(3840&t)>>4)>>4,R=240&t|(240&t)>>4;o[3]>0&&(T=ri(T,255*o[0],o[3]),A=ri(A,255*o[1],o[3]),R=ri(R,255*o[2],o[3]));const P=T<<8|A,L=R<<8|Math.floor(255*u[3]),z=function(he){const Pe=ti(he,0,2);return Math.min(Math.round(.5*Pe*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],N=ti(f[0],0,1),U=ti(f[1],0,1),H=ti(f[2],0,1),W=ti(f[3],0,1);let ie,le,se,we;if(N!==U&&y!==p&&U!==N){const he=y-p;le=1/(he*(U-N)),se=-(p+he*N)/(he*(U-N));const Pe=ti(f[4],-1,1);we=Math.pow(10,Pe),ie=255*H<<8|255*W}else ie=65535,le=0,se=1,we=1;if(i.emplaceBack(P,L,z,ie,le,se,we),b){const he=b.length;b.clear();for(let Pe=0;Pe<he;Pe++)b.emplaceBack(P,L,z,ie,le,se,we)}}function Xj(i,t,o){const u=i.node;let f=0;const p=o&A_.HasMeshoptCompression;for(const y of u.meshes){if(u.lights&&u.lightMeshIndex===f||!y.featureData)continue;y.featureArray=new Cx,y.featureArray.reserve(y.featureData.length);let b=t;for(const T of y.featureData){const A=p?65535&T:T>>16&65535,R=p?T>>16&65535:65535&T,P=(15&R)<8?15&R:0,L=i.evaluatedRMEA[P],z=i.evaluatedColor[P],N=i.emissionHeightBasedParams[P];let U;if(b&&P===2&&u.lights&&(U=new Cx,U.resize(10*u.lights.length)),Zj(y.featureArray,A,z,L,N,y.aabb.min[2],y.aabb.max[2],U),U&&b){b=!1;const H=u.meshes[u.lightMeshIndex];H.featureArray=U,H.featureArray._trim()}}y.featureArray._trim(),f++}}function c3(i,t,o,u){const f=1<<i.z;t.lat=Gs((u/Gt+i.y)/f),t.lng=Pa((o/Gt+i.x)/f)}er(Ab,"Tiled3dModelBucket",{omit:["layers"]}),er(l3,"Tiled3dModelFeature");const Yj={circle:class extends Qr{constructor(i,t,o){super(i,n7,t,o)}createBucket(i){return new A5(i)}queryRadius(i){const t=i;return d_("circle-radius",this,t)+d_("circle-stroke-width",this,t)+Lx(this.paint.get("circle-translate"))}queryIntersectsFeature(i,t,o,u,f,p,y,b){const T=N6(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(t,o)+this.paint.get("circle-stroke-width").evaluate(t,o);return K6(i,u,p,y,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,A)}getProgramIds(){return["circle"]}getDefaultProgramParams(i,t){const o=Q6(this);return{config:new ip(this,t),defines:o,overrideFog:!1}}},heatmap:class extends Qr{createBucket(i){return new eP(i)}constructor(i,t,o){super(i,_7,t,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ny({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return d_("heatmap-radius",this,i)}queryIntersectsFeature(i,t,o,u,f,p,y,b){const T=this.paint.get("heatmap-radius").evaluate(t,o);return K6(i,u,p,y,b,!0,!0,new Ut(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(i,t){return i==="heatmap"?{config:new ip(this,t),overrideFog:!1}:{}}},hillshade:class extends Qr{constructor(i,t,o){super(i,y7,t,o)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(i,t){return{overrideFog:!1}}},fill:class extends Qr{constructor(i,t,o){super(i,k7,t,o)}getProgramIds(){const i=this.paint.get("fill-pattern"),t=i&&i.constantOr(1),o=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(i,t){return{config:new ip(this,t),overrideFog:!1}}recalculate(i,t){super.recalculate(i,t);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new H5(i)}queryRadius(){return Lx(this.paint.get("fill-translate"))}queryIntersectsFeature(i,t,o,u,f,p){return!i.queryGeometry.isAboveHorizon&&D6(F6(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends Qr{constructor(i,t,o){super(i,o2,t,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new Qx(i)}queryRadius(){return Lx(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(i,t,o,u,f,p,y,b,T){const A=N6(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(t,o),P=this.paint.get("fill-extrusion-base").evaluate(t,o),L=[0,0],z=b&&p.elevation,N=p.elevation?p.elevation.exaggeration():1,U=i.tile.getBucket(this);if(z&&U instanceof Qx){const se=U.centroidVertexArray,we=T+1;we<se.length&&(L[0]=se.geta_centroid_pos0(we),L[1]=se.geta_centroid_pos1(we))}if(L[0]===0&&L[1]===1)return!1;p.projection.name==="globe"&&(u=OP([u],[new Ut(0,0),new Ut(Gt,Gt)],i.tileID.canonical).map(se=>se.polygon).flat());const H=z?b:null,[W,ie]=function(se,we,he,Pe,Le,qe,ot,Ye,mt,pt,at){return se.projection.name==="globe"?function(wt,xt,St,Et,gt,nr,Qt,kt,xr,dr,sr){const Dt=[],yr=[],Wr=wt.projection.upVectorScale(sr,wt.center.lat,wt.worldSize).metersToTile,Rr=[0,0,0,1],Yr=[0,0,0,1],Zr=(Ar,Gi,$i,Pi)=>{Ar[0]=Gi,Ar[1]=$i,Ar[2]=Pi,Ar[3]=1},ai=LP();St>0&&(St+=ai),Et+=ai;for(const Ar of xt){const Gi=[],$i=[];for(const Pi of Ar){const xi=Pi.x+gt.x,Mi=Pi.y+gt.y,cn=wt.projection.projectTilePoint(xi,Mi,sr),Ki=wt.projection.upVector(sr,Pi.x,Pi.y);let Rn=St,An=Et;if(Qt){const no=FP(xi,Mi,St,Et,Qt,kt,xr,dr);Rn+=no.base,An+=no.top}St!==0?Zr(Rr,cn.x+Ki[0]*Wr*Rn,cn.y+Ki[1]*Wr*Rn,cn.z+Ki[2]*Wr*Rn):Zr(Rr,cn.x,cn.y,cn.z),Zr(Yr,cn.x+Ki[0]*Wr*An,cn.y+Ki[1]*Wr*An,cn.z+Ki[2]*Wr*An),l.Q.transformMat4(Rr,Rr,nr),l.Q.transformMat4(Yr,Yr,nr),Gi.push(new __(Rr[0],Rr[1],Rr[2])),$i.push(new __(Yr[0],Yr[1],Yr[2]))}Dt.push(Gi),yr.push($i)}return[Dt,yr]}(se,we,he,Pe,Le,qe,ot,Ye,mt,pt,at):ot?function(wt,xt,St,Et,gt,nr,Qt,kt,xr){const dr=[],sr=[],Dt=[0,0,0,1];for(const yr of wt){const Wr=[],Rr=[];for(const Yr of yr){const Zr=Yr.x+Et.x,ai=Yr.y+Et.y,Ar=FP(Zr,ai,xt,St,nr,Qt,kt,xr);Dt[0]=Zr,Dt[1]=ai,Dt[2]=Ar.base,Dt[3]=1,l.aa.transformMat4(Dt,Dt,gt),Dt[3]=Math.max(Dt[3],1e-5);const Gi=new __(Dt[0]/Dt[3],Dt[1]/Dt[3],Dt[2]/Dt[3]);Dt[0]=Zr,Dt[1]=ai,Dt[2]=Ar.top,Dt[3]=1,l.aa.transformMat4(Dt,Dt,gt),Dt[3]=Math.max(Dt[3],1e-5);const $i=new __(Dt[0]/Dt[3],Dt[1]/Dt[3],Dt[2]/Dt[3]);Wr.push(Gi),Rr.push($i)}dr.push(Wr),sr.push(Rr)}return[dr,sr]}(we,he,Pe,Le,qe,ot,Ye,mt,pt):function(wt,xt,St,Et,gt){const nr=[],Qt=[],kt=gt[8]*xt,xr=gt[9]*xt,dr=gt[10]*xt,sr=gt[11]*xt,Dt=gt[8]*St,yr=gt[9]*St,Wr=gt[10]*St,Rr=gt[11]*St;for(const Yr of wt){const Zr=[],ai=[];for(const Ar of Yr){const Gi=Ar.x+Et.x,$i=Ar.y+Et.y,Pi=gt[0]*Gi+gt[4]*$i+gt[12],xi=gt[1]*Gi+gt[5]*$i+gt[13],Mi=gt[2]*Gi+gt[6]*$i+gt[14],cn=gt[3]*Gi+gt[7]*$i+gt[15],Ki=Pi+kt,Rn=xi+xr,An=Mi+dr,no=Math.max(cn+sr,1e-5),Fn=Pi+Dt,bn=xi+yr,es=Mi+Wr,Ps=Math.max(cn+Rr,1e-5);Zr.push(new __(Ki/no,Rn/no,An/no)),ai.push(new __(Fn/Ps,bn/Ps,es/Ps))}nr.push(Zr),Qt.push(ai)}return[nr,Qt]}(we,he,Pe,Le,qe)}(p,u,P,R,A,y,H,L,N,p.center.lat,i.tileID.canonical),le=i.queryGeometry;return function(se,we,he){let Pe=1/0;D6(he,we)&&(Pe=zP(he,we[0]));for(let Le=0;Le<we.length;Le++){const qe=we[Le],ot=se[Le];for(let Ye=0;Ye<qe.length-1;Ye++){const mt=qe[Ye],pt=[mt,qe[Ye+1],ot[Ye+1],ot[Ye],mt];I5(he,pt)&&(Pe=Math.min(Pe,zP(he,pt)))}}return Pe!==1/0&&Pe}(W,ie,le.isPointQuery()?le.screenBounds:le.screenGeometry)}},line:class extends Qr{constructor(i,t,o){super(i,BP,t,o),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof jf,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(i,t){super.recalculate(i,t),this.paint._values["line-floorwidth"]=qP.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new X5(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(i,t){const o=$P(this);return{config:new ip(this,t),defines:o,overrideFog:!1}}queryRadius(i){const t=i,o=HP(d_("line-width",this,t),d_("line-gap-width",this,t)),u=d_("line-offset",this,t);return o/2+Math.abs(u)+Lx(this.paint.get("line-translate"))}queryIntersectsFeature(i,t,o,u,f,p){if(i.queryGeometry.isAboveHorizon)return!1;const y=F6(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),b=i.pixelToTileUnitsFactor/2*HP(this.paint.get("line-width").evaluate(t,o),this.paint.get("line-gap-width").evaluate(t,o)),T=this.paint.get("line-offset").evaluate(t,o);return T&&(u=function(A,R){const P=[],L=new Ut(0,0);for(let z=0;z<A.length;z++){const N=A[z],U=[];for(let H=0;H<N.length;H++){const W=N[H],ie=N[H+1],le=H===0?L:W.sub(N[H-1])._unit()._perp(),se=H===N.length-1?L:ie.sub(W)._unit()._perp(),we=le._add(se)._unit();we._mult(1/(we.x*se.x+we.y*se.y)),U.push(we._mult(R)._add(W))}P.push(U)}return P}(u,T*i.pixelToTileUnitsFactor)),function(A,R,P){for(let L=0;L<R.length;L++){const z=R[L];if(A.length>=3){for(let N=0;N<z.length;N++)if(ap(A,z[N]))return!0}if(e7(A,z,P))return!0}return!1}(y,u,b)}isTileClipped(){return!0}},symbol:fb,background:class extends Qr{constructor(i,t,o){super(i,dj,t,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(i,t){return{overrideFog:!1}}},raster:MM,"raster-particle":kM,sky:class extends Qr{constructor(i,t,o){super(i,xj,t,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ny({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(i,t){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),f=!u,p=i.style.light,y=p.properties.get("position");return f&&p.properties.get("anchor")==="viewport"&&gn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?h4(y.azimuthal,90-y.polar,t):h4(u[0],90-u[1],t)}const o=this.paint.get("sky-gradient-center");return h4(o[0],90-o[1],t)}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}},slot:class extends Qr{constructor(i,t,o){super(i,bj,t)}},model:class extends Qr{constructor(i,t,o){super(i,Pj,t,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new f4(i)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(i){return i instanceof Ab?Gt-1:0}queryIntersectsFeature(i,t,o,u,f,p){if(!this.modelManager)return!1;const y=this.modelManager,b=i.tile.getBucket(this);if(!(b&&b instanceof f4))return!1;const T=b;for(const A in T.instancesPerModel){const R=T.instancesPerModel[A],P=t.id!==void 0?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(R.idToFeaturesIndex.hasOwnProperty(P)){const L=R.features[R.idToFeaturesIndex[P]],z=y.getModel(A,this.scope);if(!z)return!1;let N=l.a9.create();const U=new Ai(0,0),H=T.canonical;let W=Number.MAX_VALUE;for(let ie=0;ie<L.instancedDataCount;++ie){const le=16*(L.instancedDataOffset+ie),se=R.instancedDataArray.float32,we=[se[le+4],se[le+5],se[le+6]];c3(H,U,se[le],0|se[le+1]),jM(N,z,p,U,L.rotation,L.scale,we,!1,!1,!1),p.projection.name==="globe"&&(N=d4(N,p));const he=l.a9.multiply([],p.projMatrix,N),Pe=i.queryGeometry,Le=NM(Pe.isPointQuery()?Pe.screenBounds:Pe.screenGeometry,p,he,z.aabb);Le!=null&&(W=Math.min(Le,W))}return W!==Number.MAX_VALUE&&W}}return!1}_handleOverridablePaintPropertyUpdate(i,t,o){return!(!this.layout||t.isDataDriven()||o.isDataDriven()||i!=="model-color"&&i!=="model-color-mix-intensity"&&i!=="model-rotation"&&i!=="model-scale"&&i!=="model-translation"&&i!=="model-emissive-strength")}_isPropertyZoomDependent(i){const t=this._transitionablePaint._values[i];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof Xf}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(i,t,o,u){const f=i.tile,p=f.getBucket(this);let y=null,b=Number.MAX_VALUE;if(!(p&&p instanceof Ab))return{queryFeature:y,intersectionZ:b};const T=p.getNodesInfo()[t];if(T.hiddenByReplacement||!T.node.meshes||!o.filter(new J(f.tileID.overscaledZ),T.feature,f.tileID.canonical))return{queryFeature:y,intersectionZ:b};const A=T.node,R=u.calculatePosMatrix(f.tileID.toUnwrapped(),u.worldSize),P=T.evaluatedScale;let L=0;u.elevation&&A.elevation&&(L=A.elevation*u.elevation.exaggeration()),l.a9.translate(R,R,[(A.anchor?A.anchor[0]:0)*(P[0]-1),(A.anchor?A.anchor[1]:0)*(P[1]-1),L]),l.a9.scale(R,R,P),l.a9.multiply(R,R,A.matrix);const z=i.queryGeometry,N=z.isPointQuery()?z.screenBounds:z.screenGeometry,U=function(W){const ie=l.a9.multiply([],R,W.matrix),le=l.a9.multiply(ie,u.expandedFarZProjMatrix,ie);for(let se=0;se<W.meshes.length;++se){const we=W.meshes[se];if(se===W.lightMeshIndex)continue;const he=NM(N,u,le,we.aabb);he!=null&&(b=Math.min(he,b))}if(W.children)for(const se of W.children)U(se)};if(U(A),b===Number.MAX_VALUE)return{queryFeature:y,intersectionZ:b};const H=new Ai(0,0);return c3(f.tileID.canonical,H,T.node.anchor[0],T.node.anchor[1]),y={type:"Feature",geometry:{type:"Point",coordinates:[H.lng,H.lat]},properties:T.feature.properties,id:T.feature.id,state:{},layer:this.serialize()},{queryFeature:y,intersectionZ:b}}}},Ur={read:function(i,t){return i.readFields(Ur._readField,{header_length:0,x:0,y:0,z:0,layers:[]},t)},_readField:function(i,t,o){i===1?t.header_length=o.readFixed32():i===2?t.x=o.readVarint():i===3?t.y=o.readVarint():i===4?t.z=o.readVarint():i===5&&t.layers.push(Ur.Layer.read(o,o.readVarint()+o.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};Ur.Filter.read=function(i,t){return i.readFields(Ur.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},t)},Ur.Filter._readField=function(i,t,o){i===1?(t.delta_filter=Ur.Filter.Delta.read(o,o.readVarint()+o.pos),t.filter="delta_filter"):i===2?(t.zigzag_filter=Ur.Filter.Zigzag.read(o,o.readVarint()+o.pos),t.filter="zigzag_filter"):i===3?(t.bitshuffle_filter=Ur.Filter.BitShuffle.read(o,o.readVarint()+o.pos),t.filter="bitshuffle_filter"):i===4&&(t.byteshuffle_filter=Ur.Filter.ByteShuffle.read(o,o.readVarint()+o.pos),t.filter="byteshuffle_filter")},Ur.Filter.Delta={},Ur.Filter.Delta.read=function(i,t){return i.readFields(Ur.Filter.Delta._readField,{block_size:0},t)},Ur.Filter.Delta._readField=function(i,t,o){i===1&&(t.block_size=o.readVarint())},Ur.Filter.Zigzag={},Ur.Filter.Zigzag.read=function(i,t){return i.readFields(Ur.Filter.Zigzag._readField,{},t)},Ur.Filter.Zigzag._readField=function(i,t,o){},Ur.Filter.BitShuffle={},Ur.Filter.BitShuffle.read=function(i,t){return i.readFields(Ur.Filter.BitShuffle._readField,{},t)},Ur.Filter.BitShuffle._readField=function(i,t,o){},Ur.Filter.ByteShuffle={},Ur.Filter.ByteShuffle.read=function(i,t){return i.readFields(Ur.Filter.ByteShuffle._readField,{},t)},Ur.Filter.ByteShuffle._readField=function(i,t,o){},Ur.Codec={},Ur.Codec.read=function(i,t){return i.readFields(Ur.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},t)},Ur.Codec._readField=function(i,t,o){i===1?(t.gzip_data=Ur.Codec.GzipData.read(o,o.readVarint()+o.pos),t.codec="gzip_data"):i===2?(t.jpeg_image=Ur.Codec.JpegImage.read(o,o.readVarint()+o.pos),t.codec="jpeg_image"):i===3?(t.webp_image=Ur.Codec.WebpImage.read(o,o.readVarint()+o.pos),t.codec="webp_image"):i===4&&(t.png_image=Ur.Codec.PngImage.read(o,o.readVarint()+o.pos),t.codec="png_image")},Ur.Codec.GzipData={},Ur.Codec.GzipData.read=function(i,t){return i.readFields(Ur.Codec.GzipData._readField,{},t)},Ur.Codec.GzipData._readField=function(i,t,o){},Ur.Codec.JpegImage={},Ur.Codec.JpegImage.read=function(i,t){return i.readFields(Ur.Codec.JpegImage._readField,{},t)},Ur.Codec.JpegImage._readField=function(i,t,o){},Ur.Codec.WebpImage={},Ur.Codec.WebpImage.read=function(i,t){return i.readFields(Ur.Codec.WebpImage._readField,{},t)},Ur.Codec.WebpImage._readField=function(i,t,o){},Ur.Codec.PngImage={},Ur.Codec.PngImage.read=function(i,t){return i.readFields(Ur.Codec.PngImage._readField,{},t)},Ur.Codec.PngImage._readField=function(i,t,o){},Ur.DataIndexEntry={},Ur.DataIndexEntry.read=function(i,t){return i.readFields(Ur.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},t)},Ur.DataIndexEntry._readField=function(i,t,o){i===1?t.first_byte=o.readFixed64():i===2?t.last_byte=o.readFixed64():i===3?t.filters.push(Ur.Filter.read(o,o.readVarint()+o.pos)):i===4?t.codec=Ur.Codec.read(o,o.readVarint()+o.pos):i===5?t.offset=o.readFloat():i===6?t.scale=o.readFloat():i===7&&t.bands.push(o.readString())},Ur.Layer={},Ur.Layer.read=function(i,t){return i.readFields(Ur.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},t)},Ur.Layer._readField=function(i,t,o){i===1?t.version=o.readVarint():i===2?t.name=o.readString():i===3?t.units=o.readString():i===4?t.tilesize=o.readVarint():i===5?t.buffer=o.readVarint():i===6?t.pixel_format=o.readVarint():i===7&&t.data_index.push(Ur.DataIndexEntry.read(o,o.readVarint()+o.pos))};const cc={read:function(i,t){return i.readFields(cc._readField,{uint32_values:null,values:null,fixed32_values:null},t)},_readField:function(i,t,o){i===2?(t.uint32_values=cc.Uint32Values.read(o,o.readVarint()+o.pos),t.values="uint32_values"):i===3&&(t.fixed32_values=cc.Fixed32Values.read(o,o.readVarint()+o.pos),t.values="fixed32_values")},Uint32Values:{}};cc.Uint32Values.read=function(i,t){return i.readFields(cc.Uint32Values._readField,{values:[]},t)},cc.Uint32Values._readField=function(i,t,o){i===1&&(t.readValuesInto=function(u){if(u.type!==2)throw new Error(`Unsupported pbf type "${u.type}"`);const f=function(y){return y.type===2?y.readVarint()+y.pos:y.pos+1}(u),p=u.pos;return u.pos=f,function(y){u.pos=p;let b=0;for(;u.pos<f;){const T=u.readVarint();y[b++]=T}return y}}(o))},cc.Fixed32Values={},cc.Fixed32Values.read=function(i,t){return i.readFields(cc.Fixed32Values._readField,{values:[]},t)},cc.Fixed32Values._readField=function(i,t,o){throw new Error("Not implemented")};/**
 * tiny-lru
 *
 * @copyright 2024 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.2.6
 */class Qj{constructor(t=0,o=0,u=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=u,this.size=0,this.ttl=o}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const o=this.items[t];delete this.items[t],this.size--,o.prev!==null&&(o.prev.next=o.next),o.next!==null&&(o.next.prev=o.prev),this.first===o&&(this.first=o.next),this.last===o&&(this.last=o.prev)}return this}entries(t=this.keys()){return t.map(o=>[o,this.get(o)])}evict(t=!1){if(t||this.size>0){const o=this.first;delete this.items[o.key],--this.size==0?(this.first=null,this.last=null):(this.first=o.next,this.first.prev=null)}return this}expiresAt(t){let o;return this.has(t)&&(o=this.items[t].expiry),o}get(t){let o;if(this.has(t)){const u=this.items[t];this.ttl>0&&u.expiry<=Date.now()?this.delete(t):(o=u.value,this.set(t,o,!0))}return o}has(t){return t in this.items}keys(){const t=[];let o=this.first;for(;o!==null;)t.push(o.key),o=o.next;return t}set(t,o,u=!1,f=this.resetTtl){let p;if(u||this.has(t)){if(p=this.items[t],p.value=o,u===!1&&f&&(p.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==p){const y=this.last,b=p.next,T=p.prev;this.first===p&&(this.first=p.next),p.next=null,p.prev=this.last,y.next=p,T!==null&&(T.next=b),b!==null&&(b.prev=T)}}else this.max>0&&this.size===this.max&&this.evict(!0),p=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:o},++this.size==1?this.first=p:this.last.next=p;return this.last=p,this}values(t=this.keys()){return t.map(o=>this.get(o))}}function Kj(i,t){if(t.length!==4)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let o=t[3];for(let u=2;u>=1;u--){const f=u===1?1:0,p=u===2?1:0;for(let y=0;y<t[0];y++){const b=t[1]*y;for(let T=f;T<t[1];T++){const A=t[2]*(T+b);for(let R=p;R<t[2];R++){const P=t[3]*(R+A);for(let L=0;L<t[3];L++){const z=P+L;i[z]+=i[z-o]}}}}o*=t[u]}return i}function Jj(i){for(let t=0,o=i.length;t<o;t++)i[t]=i[t]>>>1^-(1&i[t]);return i}function e$(i,t){switch(t){case"uint32":return i;case"uint16":for(let o=0;o<i.length;o+=2){const u=i[o],f=i[o+1];i[o]=(240&u)>>4|(61440&u)>>8|(240&f)<<4|61440&f,i[o+1]=15&u|(3840&u)>>4|(15&f)<<8|(3840&f)<<4}return i;case"uint8":for(let o=0;o<i.length;o+=4){const u=i[o],f=i[o+1],p=i[o+2],y=i[o+3];i[o+0]=(192&u)>>6|(192&f)>>4|(192&p)>>2|192&y,i[o+1]=(48&u)>>4|(48&f)>>2|48&p|(48&y)<<2,i[o+2]=(12&u)>>2|12&f|(12&p)<<2|(12&y)<<4,i[o+3]=3&u|(3&f)<<2|(3&p)<<4|(3&y)<<6}return i;default:throw new Error(`Invalid pixel format, "${t}"`)}}class fd extends Error{constructor(t){super(t),this.name="MRTError"}}var nl=Uint8Array,Iy=Uint16Array,t$=Int32Array,u3=new nl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),h3=new nl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),r$=new nl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d3=function(i,t){for(var o=new Iy(31),u=0;u<31;++u)o[u]=t+=1<<i[u-1];var f=new t$(o[30]);for(u=1;u<30;++u)for(var p=o[u];p<o[u+1];++p)f[p]=p-o[u]<<5|u;return{b:o,r:f}},f3=d3(u3,2),p3=f3.b,i$=f3.r;p3[28]=258,i$[258]=28;for(var n$=d3(h3,0).b,m3=new Iy(32768),Hn=0;Hn<32768;++Hn){var R_=(43690&Hn)>>1|(21845&Hn)<<1;m3[Hn]=((65280&(R_=(61680&(R_=(52428&R_)>>2|(13107&R_)<<2))>>4|(3855&R_)<<4))>>8|(255&R_)<<8)>>1}var Sy=function(i,t,o){for(var u=i.length,f=0,p=new Iy(t);f<u;++f)i[f]&&++p[i[f]-1];var y,b=new Iy(t);for(f=1;f<t;++f)b[f]=b[f-1]+p[f-1]<<1;{y=new Iy(1<<t);var T=15-t;for(f=0;f<u;++f)if(i[f])for(var A=f<<4|i[f],R=t-i[f],P=b[i[f]-1]++<<R,L=P|(1<<R)-1;P<=L;++P)y[m3[P]>>T]=A}return y},Cy=new nl(288);for(Hn=0;Hn<144;++Hn)Cy[Hn]=8;for(Hn=144;Hn<256;++Hn)Cy[Hn]=9;for(Hn=256;Hn<280;++Hn)Cy[Hn]=7;for(Hn=280;Hn<288;++Hn)Cy[Hn]=8;var _3=new nl(32);for(Hn=0;Hn<32;++Hn)_3[Hn]=5;var s$=Sy(Cy,9),o$=Sy(_3,5),w4=function(i){for(var t=i[0],o=1;o<i.length;++o)i[o]>t&&(t=i[o]);return t},uc=function(i,t,o){var u=t/8|0;return(i[u]|i[u+1]<<8)>>(7&t)&o},T4=function(i,t){var o=t/8|0;return(i[o]|i[o+1]<<8|i[o+2]<<16)>>(7&t)},a$=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],hc=function(i,t,o){var u=new Error(t||a$[i]);if(u.code=i,Error.captureStackTrace&&Error.captureStackTrace(u,hc),!o)throw u;return u},l$=new nl(0),c$=typeof TextDecoder<"u"&&new TextDecoder;try{c$.decode(l$,{stream:!0})}catch{}const u$={gzip_data:"gzip"},h$={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},d$={uint32:1,uint16:2,uint8:4},f$={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class g3{constructor(t=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){return this.layers[t]}getHeaderLength(t){const o=new Uint8Array(t),u=new DataView(t);if(o[0]!==13)throw new fd("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(t){const o=new Uint8Array(t),u=this.getHeaderLength(t);if(o.length<u)throw new fd(`Expected header with length >= ${u} but got buffer of length ${o.length}`);const f=new x_(o.subarray(0,u)),p=Ur.read(f);if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new fd(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const y of p.layers)this.layers[y.name]=new p$(y,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const o=[],u=this.getLayer(t.layerName);for(let f=0;f<u.dataIndex.length;f++){const p=u.dataIndex[f],y=p.first_byte-t.firstByte,b=p.last_byte+1-t.firstByte;if(f<t.firstBlock||f>t.lastBlock||u._blocksInProgress.has(f))continue;const T={layerName:u.name,firstByte:y,lastByte:b,pixelFormat:u.pixelFormat,blockIndex:f,blockShape:[p.bands.length].concat(u.bandShape),buffer:u.buffer,codec:p.codec.codec,filters:p.filters.map(A=>A.filter)};u._blocksInProgress.add(f),o.push(T)}return new y3(o,()=>{o.forEach(f=>u._blocksInProgress.delete(f.blockIndex))},(f,p)=>{if(o.forEach(y=>u._blocksInProgress.delete(y.blockIndex)),f)throw f;p.forEach(y=>{this.getLayer(y.layerName).processDecodedData(y)})})}}class p${constructor({version:t,name:o,units:u,tilesize:f,pixel_format:p,buffer:y,data_index:b},T){if(this.version=t,this.version!==1)throw new fd(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=o,this.units=u,this.tileSize=f,this.buffer=y,this.pixelFormat=h$[p],this.dataIndex=b,this.bandShape=[f+2*y,f+2*y,d$[this.pixelFormat]],this._decodedBlocks=function(A=1e3,R=0,P=!1){if(isNaN(A)||A<0)throw new TypeError("Invalid max value");if(isNaN(R)||R<0)throw new TypeError("Invalid ttl value");if(typeof P!="boolean")throw new TypeError("Invalid resetTtl value");return new Qj(A,R,P)}(T?T.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(t){const o=t.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.set(o,t.data)}getBlockForBand(t){let o=0;switch(typeof t){case"string":for(const[u,f]of this.dataIndex.entries()){for(const[p,y]of f.bands.entries())if(y===t)return{bandIndex:o+p,blockIndex:u,blockBandIndex:p};o+=f.bands.length}break;case"number":for(const[u,f]of this.dataIndex.entries()){if(t>=o&&t<o+f.bands.length)return{bandIndex:t,blockIndex:u,blockBandIndex:t-o};o+=f.bands.length}break;default:throw new fd(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}throw new fd(`Band not found: ${JSON.stringify(t)}`)}getDataRange(t){let o=1/0,u=-1/0,f=1/0,p=-1/0;for(const y of t){const{blockIndex:b}=this.getBlockForBand(y);if(b<0)throw new fd(`Invalid band: ${JSON.stringify(y)}`);const T=this.dataIndex[b];f=Math.min(f,b),p=Math.max(p,b),o=Math.min(o,T.first_byte),u=Math.max(u,T.last_byte)}return{layerName:this.name,firstByte:o,lastByte:u,firstBlock:f,lastBlock:p}}hasBand(t){const{blockIndex:o}=this.getBlockForBand(t);return o>=0}hasDataForBand(t){const{blockIndex:o}=this.getBlockForBand(t);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(t){const{blockIndex:o,blockBandIndex:u}=this.getBlockForBand(t),f=this._decodedBlocks.get(o.toString());if(!f)throw new fd(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[o],y=this.bandShape.reduce((A,R)=>A*R,1),b=u*y,T=f.subarray(b,b+y);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:p.offset,scale:p.scale}}}class y3{constructor(t,o,u){this.tasks=t,this._onCancel=o,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,o){this._finalized||(this._onComplete(t,o),this._finalized=!0)}}g3.performDecoding=function(i,t){return Promise.all(t.tasks.map(o=>{const{layerName:u,firstByte:f,lastByte:p,pixelFormat:y,blockShape:b,blockIndex:T,filters:A,codec:R}=o,P=new Uint8Array(i).subarray(f,p+1),L=new Uint32Array(b[0]*b[1]*b[2]);let z;if(R!=="gzip_data")throw new Error(`Unhandled codec: ${R}`);return z=function(N,U){if(!globalThis.DecompressionStream&&U==="gzip_data")return Promise.resolve(((le=function(he){he[0]==31&&he[1]==139&&he[2]==8||hc(6,"invalid gzip data");var Pe=he[3],Le=10;4&Pe&&(Le+=2+(he[10]|he[11]<<8));for(var qe=(Pe>>3&1)+(Pe>>4&1);qe>0;qe-=!he[Le++]);return Le+(2&Pe)}(ie=N))+8>ie.length&&hc(6,"invalid gzip data"),function(he,Pe,Le,qe){var ot=he.length;if(!ot||Pe.f&&!Pe.l)return Le||new nl(0);var Ye=!Le,mt=Ye||Pe.i!=2,pt=Pe.i;Ye&&(Le=new nl(3*ot));var at,wt,xt=function(pd){var md=Le.length;if(pd>md){var dp=new nl(Math.max(2*md,pd));dp.set(Le),Le=dp}},St=Pe.f||0,Et=Pe.p||0,gt=Pe.b||0,nr=Pe.l,Qt=Pe.d,kt=Pe.m,xr=Pe.n,dr=8*ot;do{if(!nr){St=uc(he,Et,1);var sr=uc(he,Et+1,3);if(Et+=3,!sr){var Dt=he[(xi=4+((Et+7)/8|0))-4]|he[xi-3]<<8,yr=xi+Dt;if(yr>ot){pt&&hc(0);break}mt&&xt(gt+Dt),Le.set(he.subarray(xi,yr),gt),Pe.b=gt+=Dt,Pe.p=Et=8*yr,Pe.f=St;continue}if(sr==1)nr=s$,Qt=o$,kt=9,xr=5;else if(sr==2){var Wr=uc(he,Et,31)+257,Rr=uc(he,Et+10,15)+4,Yr=Wr+uc(he,Et+5,31)+1;Et+=14;for(var Zr=new nl(Yr),ai=new nl(19),Ar=0;Ar<Rr;++Ar)ai[r$[Ar]]=uc(he,Et+3*Ar,7);Et+=3*Rr;var Gi=w4(ai),$i=(1<<Gi)-1,Pi=Sy(ai,Gi);for(Ar=0;Ar<Yr;){var xi,Mi=Pi[uc(he,Et,$i)];if(Et+=15&Mi,(xi=Mi>>4)<16)Zr[Ar++]=xi;else{var cn=0,Ki=0;for(xi==16?(Ki=3+uc(he,Et,3),Et+=2,cn=Zr[Ar-1]):xi==17?(Ki=3+uc(he,Et,7),Et+=3):xi==18&&(Ki=11+uc(he,Et,127),Et+=7);Ki--;)Zr[Ar++]=cn}}var Rn=Zr.subarray(0,Wr),An=Zr.subarray(Wr);kt=w4(Rn),xr=w4(An),nr=Sy(Rn,kt),Qt=Sy(An,xr)}else hc(1);if(Et>dr){pt&&hc(0);break}}mt&&xt(gt+131072);for(var no=(1<<kt)-1,Fn=(1<<xr)-1,bn=Et;;bn=Et){var es=(cn=nr[T4(he,Et)&no])>>4;if((Et+=15&cn)>dr){pt&&hc(0);break}if(cn||hc(2),es<256)Le[gt++]=es;else{if(es==256){bn=Et,nr=null;break}var Ps=es-254;es>264&&(Ps=uc(he,Et,(1<<(Bo=u3[Ar=es-257]))-1)+p3[Ar],Et+=Bo);var Ms=Qt[T4(he,Et)&Fn],rn=Ms>>4;if(Ms||hc(3),Et+=15&Ms,An=n$[rn],rn>3){var Bo=h3[rn];An+=T4(he,Et)&(1<<Bo)-1,Et+=Bo}if(Et>dr){pt&&hc(0);break}mt&&xt(gt+131072);var Ku=gt+Ps;if(gt<An){var Pl=0-An,dc=Math.min(An,Ku);for(Pl+gt<0&&hc(3);gt<dc;++gt)Le[gt]=(void 0)[Pl+gt]}for(;gt<Ku;++gt)Le[gt]=Le[gt-An]}}Pe.l=nr,Pe.p=bn,Pe.b=gt,Pe.f=St,nr&&(St=1,Pe.m=kt,Pe.d=Qt,Pe.n=xr)}while(!St);return gt!=Le.length&&Ye?(at=Le,((wt=gt)==null||wt>at.length)&&(wt=at.length),new nl(at.subarray(0,wt))):Le.subarray(0,gt)}(ie.subarray(le,-8),{i:2},new nl(((H=ie)[(W=H.length)-4]|H[W-3]<<8|H[W-2]<<16|H[W-1]<<24)>>>0))));var H,W,ie,le;const se=u$[U];if(!se)throw new Error(`Unhandled codec: ${U}`);const we=new globalThis.DecompressionStream(se);return new Response(new Blob([N]).stream().pipeThrough(we)).arrayBuffer().then(he=>new Uint8Array(he))}(P,R).then(N=>{const U=cc.read(new x_(N));if(U.values==="uint32_values")return U.uint32_values.readValuesInto(L),new f$[y](L.buffer);throw new Error(`Unhandled numeric data "${U.values}"`)}),z.then(N=>{for(let U=A.length-1;U>=0;U--)switch(A[U]){case"delta_filter":Kj(N,b);break;case"zigzag_filter":Jj(N);break;case"bitshuffle_filter":e$(N,y);break;default:throw new Error(`Unhandled filter "${A[U]}"`)}return{layerName:u,blockIndex:T,data:N}}).catch(N=>{throw N})}))},er(y3,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const v3=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class E4{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,u]=new Uint8Array(t,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=u>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const p=v3[15&u];if(!p)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(t,2,1),[b]=new Uint32Array(t,4,1);return new E4(b,y,p,t)}constructor(t,o=64,u=Float64Array,f){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=u,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const p=v3.indexOf(this.ArrayType),y=2*t*this.ArrayType.BYTES_PER_ELEMENT,b=t*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-b%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${u}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+b+T,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+y+b+T),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+b+T,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=t)}add(t,o){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=t,this.coords[this._pos++]=o,u}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return A4(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,o,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:y,nodeSize:b}=this,T=[0,p.length-1,0],A=[];for(;T.length;){const R=T.pop()||0,P=T.pop()||0,L=T.pop()||0;if(P-L<=b){for(let H=L;H<=P;H++){const W=y[2*H],ie=y[2*H+1];W>=t&&W<=u&&ie>=o&&ie<=f&&A.push(p[H])}continue}const z=L+P>>1,N=y[2*z],U=y[2*z+1];N>=t&&N<=u&&U>=o&&U<=f&&A.push(p[z]),(R===0?t<=N:o<=U)&&(T.push(L),T.push(z-1),T.push(1-R)),(R===0?u>=N:f>=U)&&(T.push(z+1),T.push(P),T.push(1-R))}return A}within(t,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:p,nodeSize:y}=this,b=[0,f.length-1,0],T=[],A=u*u;for(;b.length;){const R=b.pop()||0,P=b.pop()||0,L=b.pop()||0;if(P-L<=y){for(let H=L;H<=P;H++)b3(p[2*H],p[2*H+1],t,o)<=A&&T.push(f[H]);continue}const z=L+P>>1,N=p[2*z],U=p[2*z+1];b3(N,U,t,o)<=A&&T.push(f[z]),(R===0?t-u<=N:o-u<=U)&&(b.push(L),b.push(z-1),b.push(1-R)),(R===0?t+u>=N:o+u>=U)&&(b.push(z+1),b.push(P),b.push(1-R))}return T}}function A4(i,t,o,u,f,p){if(f-u<=o)return;const y=u+f>>1;x3(i,t,y,u,f,p),A4(i,t,o,u,y-1,1-p),A4(i,t,o,y+1,f,1-p)}function x3(i,t,o,u,f,p){for(;f>u;){if(f-u>600){const A=f-u+1,R=o-u+1,P=Math.log(A),L=.5*Math.exp(2*P/3),z=.5*Math.sqrt(P*L*(A-L)/A)*(R-A/2<0?-1:1);x3(i,t,o,Math.max(u,Math.floor(o-R*L/A+z)),Math.min(f,Math.floor(o+(A-R)*L/A+z)),p)}const y=t[2*o+p];let b=u,T=f;for(Ry(i,t,u,o),t[2*f+p]>y&&Ry(i,t,u,f);b<T;){for(Ry(i,t,b,T),b++,T--;t[2*b+p]<y;)b++;for(;t[2*T+p]>y;)T--}t[2*u+p]===y?Ry(i,t,u,T):(T++,Ry(i,t,T,f)),T<=o&&(u=T+1),o<=T&&(f=T-1)}}function Ry(i,t,o,u){I4(i,o,u),I4(t,2*o,2*u),I4(t,2*o+1,2*u+1)}function I4(i,t,o){const u=i[t];i[t]=i[o],i[o]=u}function b3(i,t,o,u){const f=i-o,p=t-u;return f*f+p*p}l.$=class{constructor(i){this.specification=i}possiblyEvaluate(i,t){return function([o,u]){const f=Oc([1,o,u]);return{x:f.x,y:f.y,z:f.z}}(i.expression.evaluate(t))}interpolate(i,t,o){return{x:ri(i.x,t.x,o),y:ri(i.y,t.y,o),z:ri(i.z,t.z,o)}}},l.A=vt,l.B=X0,l.C=Oo,l.D=xx,l.E=Lu,l.F=function(i){const t=i.value;let o=[];if(!t)return o;const u=Vc(t);return u!=="string"?(o=o.concat([new vb(i.key,t,`string expected, "${u}" found`)]),o):(BM(t,!0)||(o=o.concat([new vb(i.key,t,`invalid url "${t}"`)])),o)},l.G=me,l.H=Ue,l.I=t4,l.J=Oe,l.K=class{constructor(i){this.specification=i}possiblyEvaluate(i,t){return Oc(i.expression.evaluate(t))}interpolate(i,t,o){return{x:ri(i.x,t.x,o),y:ri(i.y,t.y,o),z:ri(i.z,t.z,o),azimuthal:ri(i.azimuthal,t.azimuthal,o),polar:ri(i.polar,t.polar,o)}}},l.L=Re,l.M=class{constructor(i,t,o,u){this.id=i,this.position=t!=null?new Ai(t[0],t[1]):new Ai(0,0),this.orientation=o??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(i,t){if(l.a9.multiply(i.matrix,t,i.matrix),i.meshes)for(const o of i.meshes){const u=vn.applyTransform(o.aabb,i.matrix);this.aabb.encapsulate(u)}if(i.children)for(const o of i.children)this._applyTransformations(o,i.matrix)}computeBoundsAndApplyParent(){const i=l.a9.identity([]);for(const t of this.nodes)this._applyTransformations(t,i)}computeModelMatrix(i,t,o,u,f,p,y=!1){jM(this.matrix,this,i.transform,this.position,t,o,u,f,p,y)}upload(i){if(!this.uploaded){for(const t of this.nodes)p4(t,i);for(const t of this.nodes)xb(t);this.uploaded=!0}}destroy(){for(const i of this.nodes)m4(i)}},l.N=J,l.O=io,l.P=Ut,l.R=Am,l.S=yl,l.T=u4,l.U=it,l.V=vb,l.W=nd,l.X=ri,l.Y=Gt,l.Z=Xf,l._=Sf,l.a=Lm,l.a$=Ph,l.a0=function(i,t,o=0,u=!0){const f=new Ut(o,o),p=i.sub(f),y=t.add(f),b=[p,new Ut(y.x,p.y),y,new Ut(p.x,y.y)];return u&&b.push(p.clone()),b},l.a1=function(i,t){const o=[];for(let u=0;u<i.length;u++){const f=Ta(u-1,-1,i.length-1),p=Ta(u+1,-1,i.length-1),y=i[u],b=i[p],T=i[f].sub(y).unit(),A=b.sub(y).unit(),R=A.angleWithSep(T.x,T.y),P=T.add(A).unit().mult(-1*t/Math.sin(R/2));o.push(y.add(P))}return o},l.a2=wM,l.a3=z6,l.a4=function(i,t,o=0){return l.Q.fromValues(((t.x-o)*i.scale-i.x)*Gt,(t.y*i.scale-i.y)*Gt,C6(t.z,t.y))},l.a5=P5,l.a6=VP,l.a7=function(i){let t=1/0,o=1/0,u=-1/0,f=-1/0;for(const p of i)t=Math.min(t,p.x),o=Math.min(o,p.y),u=Math.max(u,p.x),f=Math.max(f,p.y);return{min:new Ut(t,o),max:new Ut(u,f)}},l.a8=rd,l.aA=Bi,l.aB=Gr,l.aC=mx,l.aD=d5,l.aE=jn,l.aF=pi,l.aG=u6,l.aH=db,l.aI=function(){ye.isLoading()||ye.isLoaded()||fe()!=="deferred"||de()},l.aJ=Zt,l.aK=id,l.aL=r3,l.aM=eo,l.aN=X5,l.aO=H5,l.aP=Zu,l.aQ=js,l.aR=u5,l.aS=j6,l.aT=Gx,l.aU=c4,l.aV=function(i,t){const o=nd(t.zoom);if(o===0)return Wc(i);const u=Fx(i),f=L5(u),p=rd(u.getWest())*t.worldSize,y=rd(u.getEast())*t.worldSize,b=Wu(u.getNorth())*t.worldSize,T=Wu(u.getSouth())*t.worldSize,A=[p,b,0],R=[y,b,0],P=[p,T,0],L=[y,T,0],z=l.a9.invert([],t.globeMatrix);return l.Q.transformMat4(A,A,z),l.Q.transformMat4(R,R,z),l.Q.transformMat4(P,P,z),l.Q.transformMat4(L,L,z),f[0]=Xu(f[0],P,o),f[1]=Xu(f[1],L,o),f[2]=Xu(f[2],R,o),f[3]=Xu(f[3],A,o),vn.fromPoints(f)},l.aW=Bx,l.aX=iy,l.aY=Xu,l.aZ=_s,l.a_=o7,l.ab=ap,l.ac=M6,l.ad=ti,l.ae=Fo,l.af=function(i,t){const o={};for(let u=0;u<t.length;u++){const f=t[u];f in i&&(o[f]=i[f])}return o},l.ag=td,l.ah=Wu,l.ai=class{constructor(i){this.entries={},this.scheduler=i}request(i,t,o,u){const f=this.entries[i]=this.entries[i]||{callbacks:[]};if(f.result){const[p,y]=f.result;return this.scheduler?this.scheduler.add(()=>{u(p,y)},t):u(p,y),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=o((p,y)=>{f.result=[p,y];for(const b of f.callbacks)this.scheduler?this.scheduler.add(()=>{b(p,y)},t):b(p,y);setTimeout(()=>delete this.entries[i],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(p=>p!==u),f.callbacks.length||(f.cancel(),delete this.entries[i]))}}},l.aj=Yi,l.ak=function(i,t,o){const u=JSON.stringify(i.request);return i.data&&(this.deduped.entries[u]={result:[null,i.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},f=>{const p=xf(i.request,(y,b,T,A)=>{y?f(y):b&&f(null,{vectorTile:o?void 0:new W5(new x_(b)),rawData:b,cacheControl:T,expires:A})});return()=>{p.cancel(),f()}},t)},l.al=function(i){yo++,yo>fs&&(i.getActor().send("enforceCacheSizeLimit",an),yo=0)},l.am=Do,l.an=ee,l.ao=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},l.ap=ro,l.aq=MM,l.ar=kM,l.as=PM,l.at=function(i,t){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){t(null,o)};for(let u=0;u<i.length;u++){const f=document.createElement("source");d0(i[u])||(o.crossOrigin="Anonymous"),f.src=i[u],o.appendChild(f)}return{cancel:()=>{}}},l.au=pb,l.av=my,l.aw=Pa,l.ax=Gs,l.ay=$s,l.az=ys,l.b=Nc,l.b$=w_,l.b0=g3,l.b1=xf,l.b2=function(i){const t=[];for(const o in i)t.push(i[o]);return t},l.b3=function(i,t){const o=[];for(const u in i)u in t||o.push(u);return o},l.b4=ta,l.b5=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.b6=function(i,t){const{x:o,y:u}=i.point,f=Z6(o,u,i.worldSize/i._pixelsPerMercatorPixel,0,0);return l.a9.multiply(f,f,O5(Wc(t)))},l.b8=g_,l.b9=il,l.bA=A6,l.bB=function(i){const t=l.a9.identity(new Float64Array(16));l.a9.multiply(t,i.pixelMatrix,i.globeMatrix);const o=[0,Cl,0],u=[0,Rl,0];return l.Q.transformMat4(o,o,t),l.Q.transformMat4(u,u,t),[o[0]>0&&o[0]<=i.width&&o[1]>0&&o[1]<=i.height&&!F5(i,new Ai(i.center.lat,90)),u[0]>0&&u[0]<=i.width&&u[1]>0&&u[1]<=i.height&&!F5(i,new Ai(i.center.lat,-90))]},l.bC=function(i,t){const{scale:o}=i.tileTransform,u=o*Gt/(i.tileSize*Math.pow(2,t.zoom-i.tileID.overscaledZ+i.tileID.canonical.z));return l.b7.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[u,u])},l.bD=gb,l.bE=DM,l.bF=function(i){const t=DM(i,!0);return l.b7.invert([],[t[0],t[1],t[4],t[5]])},l.bG=M5,l.bH=function(i){const{x:t,y:o}=i.point,{lng:u,lat:f}=i._center;return Z6(t,o,i.worldSize,u,f)},l.bI=Ui,l.bJ=y5,l.bK=function(i){const t=Math.round((i+45+360)%360/90)%4;return Tm[t]},l.bL=45,l.bM=b5,l.bN=J0,l.bO=Kh,l.bP=m5,l.bQ=zo,l.bR=Px,l.bS=w6,l.bT=function(i,t,o){const u=Math.sqrt(i*i+t*t+o*o),f=u>0?Math.acos(o/u)*Ch:0;let p=i!==0||t!==0?Math.atan2(-t,-i)*Ch+90:0;return p<0&&(p+=360),[u,p,f]},l.bU=Mx,l.bV=vn,l.bW=Oc,l.bX=function(i){return[Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2)]},l.bY=function(i){return i({pluginStatus:X,pluginURL:Z}),ne.on("pluginStateChange",i),i},l.bZ=I_,l.b_=bb,l.ba=Kx,l.bb=function(i,t,o,u,f){const p=5*t+2;i.float32[p+0]=o,i.float32[p+1]=u,i.float32[p+2]=f},l.bc=hb,l.bd=hM,l.be=I5,l.bf=qs,l.bg=n4,l.bh=yM,l.bi=e4,l.bj=E4,l.bk=Ta,l.bm=ui,l.bn=vl,l.bo=No,l.bp=function(i,t,o){i[4*t+0]=o[0],i[4*t+1]=o[1],i[4*t+2]=o[2],i[4*t+3]=o[3]},l.bq=Ai,l.br=SM,l.bs=S6,l.bt=k5,l.bu=LM,l.bv=sp,l.bw=q6,l.bx=function(i,t,o,u,f,p,y,b,T){if(T.name==="globe")return q6(i,t,new sp(o,u,f),!1);const A=my({z:o,x:u,y:f},T);return new vn([(p+A.x/A.scale)*t,t*(A.y/A.scale),y],[(p+A.x2/A.scale)*t,t*(A.y2/A.scale),b])},l.by=function(i,t,o){let u=0;for(let f=0;f<2;++f)i[f]>0&&(u+=(i[f]-0)*(i[f]-0)),t[f]<0&&(u+=(0-t[f])*(0-t[f]));return u},l.bz=$n,l.c=e3,l.c$=[1,1,1],l.c0=r4,l.c1=Dh,l.c2=Y,l.c3=j,l.c4=Pt,l.c5=Ef,l.c6=go,l.c7=function(i,t,o){return i.type==="custom"?new yj(i,t):new Yj[i.type](i,t,o)},l.c8=function(i){const t=i.indexOf(Un);return t>=0?i.slice(0,t):i},l.c9=function(i){return i.indexOf(Un)>=0},l.cA=i=>({u_matrix:new J0(i),u_pixels_to_tile_units:new _5(i),u_device_pixel_ratio:new zo(i),u_units_to_pixels:new Kh(i),u_dash_image:new Px(i),u_gradient_image:new Px(i),u_image_height:new zo(i),u_texsize:new Kh(i),u_tile_units_to_pixels:new zo(i),u_alpha_discard_threshold:new zo(i),u_trim_offset:new Kh(i),u_emissive_strength:new zo(i)}),l.cB=i=>({u_matrix:new J0(i),u_texsize:new Kh(i),u_pixels_to_tile_units:new _5(i),u_device_pixel_ratio:new zo(i),u_image:new Px(i),u_units_to_pixels:new Kh(i),u_tile_units_to_pixels:new zo(i),u_alpha_discard_threshold:new zo(i),u_trim_offset:new Kh(i)}),l.cC=Jf,l.cD=E2,l.cE=A2,l.cF=Q6,l.cG=(i,t,o,u,f,p)=>{const y=i.transform,b=y.projection.name==="globe";let T;if(p.paint.get("circle-pitch-alignment")==="map")if(b){const R=W6(y.zoom,t.canonical)*y._pixelsPerMercatorPixel;T=Float32Array.from([R,0,0,R])}else T=y.calculatePixelsToTileUnitsMatrix(o);else T=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:i.transform.getCameraToCenterDistance(y.projection),u_matrix:i.translatePosMatrix(t.projMatrix,o,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ve.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:h7,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(b){A.u_inv_rot_matrix=u,A.u_merc_center=f,A.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],A.u_zoom_transition=nd(y.zoom);const R=f[0]*Gt,P=f[1]*Gt;A.u_up_dir=y.projection.upVector(new sp(0,0,0),R,P)}return A},l.cH=$P,l.cI=(i,t,o,u,f,p)=>{const y=i.transform;return{u_matrix:jP(i,t,o,u),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:y.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:f,u_image:0,u_tile_units_to_pixels:UP(t,y),u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:p}},l.cJ=(i,t,o,u,f,p,y)=>{const b=i.transform,T=b.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:jP(i,t,o,u),u_pixels_to_tile_units:T,u_device_pixel_ratio:p,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:GP(o)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:UP(t,i.transform),u_alpha_discard_threshold:0,u_trim_offset:y,u_emissive_strength:o.paint.get("line-emissive-strength")}},l.cK=Pu,l.cL=ny,l.cM=LP,l.cN=ZU,l.cO=Qx,l.cP=ad,l.cQ=450,l.cR=7,l.cS=mj,l.cT=256,l.cU=O5,l.cV=rp,l.cW=tp,l.cX=l5,l.cY=function(i,t,o,u,f){return ti((i-t)/(o-t)*(f-u)+u,u,f)},l.cZ=op,l.c_=d4,l.ca=function(i){const t=i.indexOf(Un);return t>=0?i.slice(t+1):""},l.cb=function(i){const t=[],o=i.id;return o===void 0&&t.push({message:`layers.${o}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${o}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),t},l.cc=Lc,l.cd=ne,l.ce=vf,l.cf=T6,l.cg=class extends qu{constructor(i){super(i),this.current=VU}set(i,t,o){if(this.fetchUniformLocation(i,t)){for(let u=0;u<9;u++)if(o[u]!==this.current[u]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},l.ch=Rh,l.ci=function(i,t,o){const u=nd(o.zoom),f=i.style.map._antialias,p=t.options.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return u===0&&!f&&!p},l.cj=function(i){const t=i.pixelsPerMeter,o=t/No(1,i.center.lat),u=l.a9.identity(new Float64Array(16));return l.a9.translate(u,u,[i.point.x,i.point.y,0]),l.a9.scale(u,u,[o,o,t]),Float32Array.from(u)},l.ck=Fx,l.cl=function(i){const t=$n-5;i=ti(i,-t,t)/t*90;const o=Math.pow(Math.abs(Math.sin(ui(i))),3);return Math.round(o*(v5.length-1))},l.cm=function(i,t,o,u){const f=t.getNorth(),p=t.getSouth(),y=t.getWest(),b=t.getEast(),T=1<<i.z,A=b-y,R=f-p,P=A/l_,L=-R/v5[o],z=[0,P,0,L,0,0,f,y,0];if(i.z>0){const N=180/u;l.ct.multiply(z,z,[N/A+1,0,0,0,N/R+1,0,-.5*N/P,.5*N/L,1])}return z[2]=T,z[5]=i.x,z[8]=i.y,z},l.cn=Wc,l.co=function(i,t,o){const u=l.a9.identity(new Float64Array(16)),f=(t/(1<<i)-.5)*Math.PI*2;return l.a9.rotateY(u,o.globeMatrix,f),Float32Array.from(u)},l.cp=class{isDataAvailableAtPoint(i){const t=this._source();if(this.isUsingMockSource()||!t||i.y<0||i.y>1)return!1;const o=t.getSource().maxzoom,u=1<<o,f=Math.floor(i.x),p=Math.floor((i.x-f)*u),y=Math.floor(i.y*u),b=this.findDEMTileFor(new ro(o,f,o,p,y));return!(!b||!b.dem)}getAtPointOrZero(i,t=0){return this.getAtPoint(i,t)||0}getAtPoint(i,t,o=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const u=this._source();if(!u||i.y<0||i.y>1)return t;const f=u.getSource().maxzoom,p=1<<f,y=Math.floor(i.x),b=i.x-y,T=new ro(f,y,f,Math.floor(b*p),Math.floor(i.y*p)),A=this.findDEMTileFor(T);if(!A||!A.dem)return t;const R=A.dem,P=1<<A.tileID.canonical.z,L=(b*P-A.tileID.canonical.x)*R.dim,z=(i.y*P-A.tileID.canonical.y)*R.dim,N=Math.floor(L),U=Math.floor(z);return(o?this.exaggeration():1)*ri(ri(R.get(N,U),R.get(N,U+1),z-U),ri(R.get(N+1,U),R.get(N+1,U+1),z-U),L-N)}getAtTileOffset(i,t,o){const u=1<<i.canonical.z;return this.getAtPointOrZero(new io(i.wrap+(i.canonical.x+t/Gt)/u,(i.canonical.y+o/Gt)/u))}getAtTileOffsetFunc(i,t,o,u){return f=>{const p=this.getAtTileOffset(i,f.x,f.y),y=u.upVector(i.canonical,f.x,f.y),b=u.upVectorScale(i.canonical,t,o).metersToTile;return l.Q.scale(y,y,p*b),y}}getForTilePoints(i,t,o,u){if(this.isUsingMockSource())return!1;const f=m_.create(this,i,u);return!!f&&(t.forEach(p=>{p[2]=this.exaggeration()*f.getElevationAt(p[0],p[1],o)}),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(i);if(!t||!t.dem)return null;const o=t.dem.tree,u=t.tileID,f=1<<i.canonical.z-u.canonical.z;let p=i.canonical.x/f-u.canonical.x,y=i.canonical.y/f-u.canonical.y,b=0;for(let T=0;T<i.canonical.z-u.canonical.z&&!o.leaves[b];T++){p*=2,y*=2;const A=2*Math.floor(y)+Math.floor(p);b=o.childOffsets[b]+A,p%=1,y%=1}return{min:this.exaggeration()*o.minimums[b],max:this.exaggeration()*o.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,t,o){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const i=this.visibleDemTiles;if(i.length===0)return null;let t=!1,o=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const f of i){const p=this.getMinMaxForTile(f.tileID);p&&(o=Math.min(o,p.min),u=Math.max(u,p.max),t=!0)}return t?{min:o,max:u}:null}},l.cq=zx,l.cr=iP,l.cs=function(i,t){return[Math.pow(i[0],2.2)*t,Math.pow(i[1],2.2)*t,Math.pow(i[2],2.2)*t]},l.cu=W6,l.cv=q,l.cw=M,l.cx=256,l.cy=function(i,t){const o=[0,0,0],u=Bx(Wc(t.canonical));return l.Q.transformMat4(o,o,u),l.Q.transformMat4(o,o,i),o},l.cz=i=>({u_camera_to_center_distance:new zo(i),u_extrude_scale:new _5(i),u_device_pixel_ratio:new zo(i),u_matrix:new J0(i),u_inv_rot_matrix:new J0(i),u_merc_center:new Kh(i),u_tile_id:new m5(i),u_zoom_transition:new zo(i),u_up_dir:new m5(i),u_emissive_strength:new zo(i)}),l.d=f0,l.d$=$M,l.d0=m_,l.d1=A_,l.d2=Ra,l.d3=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(i){const t=fP(new Ut(0,0),new Ut(Gt,Gt),i),o=[];for(const u of this._activeRegions){if(u.hiddenByOverlap||!dP(t,u))continue;const f=H7(u.min,u.max,i);o.push({min:f.min,max:f.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId})}return o}setSources(i){this._setSources(i.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const o=[];for(const u of t.cache.getVisibleCoordinates()){const f=t.cache.getTile(u).buckets[t.layer];if(f)for(const p of f.getNodesInfo()){const y=p.node;y.footprint&&o.push({footprint:y.footprint,id:u.toUnwrapped()})}}return o}})))}_addSource(i){const t=i.getFootprints();if(t.length!==0){for(const o of t){if(!o.footprint)continue;const u=fP(o.footprint.min,o.footprint.max,o.id);this._activeRegions.push({min:u.min,max:u.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:o.id,footprint:o.footprint})}this._sourceIds.push(i.getSourceId())}}_computeReplacement(){this._activeRegions.sort((t,o)=>t.priority-o.priority||Zx(t.min,o.min)||Zx(t.max,o.max));let i=this._activeRegions.length!==this._prevRegions.length;if(!i){let t=0,o=0;for(;!i&&t!==this._activeRegions.length;){const u=this._activeRegions[t],f=this._prevRegions[o];i=u.priority!==f.priority||!hP(u,f),++t,++o}}if(i){++this._updateTime;const t=o=>{const u=this._activeRegions;if(o>=u.length)return o;const f=u[o].priority;for(;o<u.length&&u[o].priority===f;)++o;return o};if(this._sourceIds.length>1){let o=0,u=t(o);for(;o!==u;){let f=o;const p=o;for(;f!==u;){const y=this._activeRegions[f];y.hiddenByOverlap=!1;for(let b=0;b<p;b++){const T=this._activeRegions[b];if(!T.hiddenByOverlap&&dP(y,T)&&(y.hiddenByOverlap=mP(y.footprint,y.tileId,T.footprint,T.tileId),y.hiddenByOverlap))break}++f}o=u,u=t(o)}}}}_setSources(i){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=i.length-1;t>=0;t--)this._addSource(i[t]);this._computeReplacement()}},l.d4=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy()}_fillGridMeshWithLods(i,t){const o=new js,u=new ys,f=[],p=i+1+2,y=t[0]+1,b=t[0]+1+(1+t.length),T=(A,R,P)=>{let L=A===p-1?A-2:A===0?A:A-1;return L+=P?24575:0,[L,R]};for(let A=0;A<p;++A)o.emplaceBack(...T(A,0,!0));for(let A=0;A<y;++A)for(let R=0;R<p;++R)o.emplaceBack(...T(R,A,(R===0||R===p-1)&&!0));for(let A=0;A<t.length;++A){const R=t[A];for(let P=0;P<p;++P)o.emplaceBack(...T(P,R,!0))}for(let A=0;A<t.length;++A){const R=u.length,P=t[A]+1+2,L=new ys;for(let U=0;U<P-1;U++){const H=U===P-2,W=H?p*(b-t.length+A-U):p;for(let ie=0;ie<p-1;ie++){const le=U*p+ie;U===0||H||ie===0||ie===p-2?(L.emplaceBack(le+1,le,le+W),L.emplaceBack(le+W,le+W+1,le+1)):(u.emplaceBack(le+1,le,le+W),u.emplaceBack(le+W,le+W+1,le+1))}}const z=jn.simpleSegment(0,R,o.length,u.length-R);for(let U=0;U<L.uint16.length;U+=3)u.emplaceBack(L.uint16[U],L.uint16[U+1],L.uint16[U+2]);const N=jn.simpleSegment(0,R,o.length,u.length-R);f.push({withoutSkirts:z,withSkirts:N})}return{vertices:o,indices:u,segments:f}}_createGrid(i){const t=this._fillGridMeshWithLods(l_,v5);this._gridSegments=t.segments,this._gridBuffer=i.createVertexBuffer(t.vertices,j6.members),this._gridIndexBuffer=i.createIndexBuffer(t.indices,!0)}_createPoles(i){const t=new ys;for(let y=0;y<=l_;y++)t.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=i.createIndexBuffer(t,!0);const o=new tp,u=new tp,f=new tp,p=new tp;this._poleSegments=[];for(let y=0,b=0;y<y5;y++){const T=360/(1<<y);o.emplaceBack(0,-Fo,0,.5,0),u.emplaceBack(0,-Fo,0,.5,1),f.emplaceBack(0,-Fo,0,.5,.5),p.emplaceBack(0,-Fo,0,.5,.5);for(let A=0;A<=l_;A++){let R=A/l_,P=0;const L=ri(0,T,R),[z,N,U]=c_(c7,u7,L,Fo);o.emplaceBack(z,N,U,R,P),u.emplaceBack(z,N,U,R,1-P);const H=ui(L);R=.5+.5*Math.sin(H),P=.5+.5*Math.cos(H),f.emplaceBack(z,N,U,R,P),p.emplaceBack(z,N,U,R,1-P)}this._poleSegments.push(jn.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(o,Ox,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(u,Ox,!1),this._texturedPoleNorthVertexBuffer=i.createVertexBuffer(f,Ox,!1),this._texturedPoleSouthVertexBuffer=i.createVertexBuffer(p,Ox,!1)}getGridBuffers(i,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}},l.d5=function(i){return km.has(i)},l.d6=yf,l.d7=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},l.d8=Mo,l.d9=P6,l.dA=wy,l.dB=function(i){const t=ps();if(!t)return;const o=t.delete(ur);i&&o.catch(i).then(()=>i())},l.dC=by,l.dD=GM,l.dE=function(i){g4=ve.resolveURL(i),C_||(C_=new I_(bb(),new Lu)),C_.broadcast("setDracoUrl",g4)},l.dF=qM,l.dG=function(i){S_=ve.resolveURL(i),C_||(C_=new I_(bb(),new Lu)),C_.broadcast("setMeshoptUrl",S_)},l.dH=er,l.dI=sd,l.dJ=ac,l.dK=t3,l.dL=i3,l.dM=NP,l.dN=Dc,l.dO=fM,l.dP=function(i,t,o,u,f,p,y,b,T,A,R){i.createArrays(),i.tilePixelRatio=Gt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const P=i.layers[0].layout,L=i.layers[0]._unevaluatedLayout._values,z={};if(i.textSizeData.kind==="composite"){const{minZoom:W,maxZoom:ie}=i.textSizeData;z.compositeTextSizes=[L["text-size"].possiblyEvaluate(new J(W),b),L["text-size"].possiblyEvaluate(new J(ie),b)]}if(i.iconSizeData.kind==="composite"){const{minZoom:W,maxZoom:ie}=i.iconSizeData;z.compositeIconSizes=[L["icon-size"].possiblyEvaluate(new J(W),b),L["icon-size"].possiblyEvaluate(new J(ie),b)]}z.layoutTextSize=L["text-size"].possiblyEvaluate(new J(T+1),b),z.layoutIconSize=L["icon-size"].possiblyEvaluate(new J(T+1),b),z.textMaxSize=L["text-size"].possiblyEvaluate(new J(18),b);const N=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",U=P.get("text-size");let H=!1;for(const W of i.features)if(W.icon&&W.icon.nameSecondary){H=!0;break}for(const W of i.features){const ie=P.get("text-font").evaluate(W,{},b).join(","),le=U.evaluate(W,{},b),se=z.layoutTextSize.evaluate(W,{},b),we=(z.layoutIconSize.evaluate(W,{},b),{horizontal:{},vertical:void 0}),he=W.text;let Pe,Le=[0,0];if(he){const Ye=he.toString(),mt=P.get("text-letter-spacing").evaluate(W,{},b)*qs,pt=P.get("text-line-height").evaluate(W,{},b)*qs,at=g(Ye)?mt:0,wt=P.get("text-anchor").evaluate(W,{},b),xt=P.get("text-variable-anchor");if(!xt){const Qt=P.get("text-radial-offset").evaluate(W,{},b);Le=Qt?yM(wt,[Qt*qs,i4]):P.get("text-offset").evaluate(W,{},b).map(kt=>kt*qs)}let St=N?"center":P.get("text-justify").evaluate(W,{},b);const Et=P.get("symbol-placement")==="point",gt=Et?P.get("text-max-width").evaluate(W,{},b)*qs:1/0,nr=Qt=>{i.allowVerticalPlacement&&h(Ye)&&(we.vertical=J5(he,t,o,f,ie,gt,pt,wt,Qt,at,Le,il.vertical,!0,se,le))};if(!N&&xt){const Qt=St==="auto"?xt.map(xr=>n4(xr)):[St];let kt=!1;for(let xr=0;xr<Qt.length;xr++){const dr=Qt[xr];if(!we.horizontal[dr])if(kt)we.horizontal[dr]=we.horizontal[0];else{const sr=J5(he,t,o,f,ie,gt,pt,"center",dr,at,Le,il.horizontal,!1,se,le);sr&&(we.horizontal[dr]=sr,kt=sr.positionedLines.length===1)}}nr("left")}else{if(St==="auto"&&(St=n4(wt)),Et||P.get("text-writing-mode").indexOf("horizontal")>=0||!h(Ye)){const Qt=J5(he,t,o,f,ie,gt,pt,wt,St,at,Le,il.horizontal,!1,se,le);Qt&&(we.horizontal[St]=Qt)}nr(Et?"left":St)}}let qe=!1;if(W.icon&&W.icon.namePrimary){const Ye=u[W.icon.namePrimary];Ye&&(Pe=G2(f[W.icon.namePrimary],W.icon.nameSecondary?f[W.icon.nameSecondary]:void 0,P.get("icon-offset").evaluate(W,{},b),P.get("icon-anchor").evaluate(W,{},b)),qe=Ye.sdf,i.sdfIcons===void 0?i.sdfIcons=Ye.sdf:i.sdfIcons!==Ye.sdf&&gn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ye.pixelRatio!==i.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const ot=xM(we.horizontal)||we.vertical;i.iconsInText||(i.iconsInText=!!ot&&ot.iconsInText),(ot||Pe)&&Q2(i,W,we,Pe,u,z,se,0,Le,qe,y,b,A,R,H)}p&&i.generateCollisionDebugBuffers(T,i.collisionBoxArray)},l.dQ=W5,l.dR=x_,l.dS=Xx,l.dT=Hx,l.dU=qx,l.dV=Xl,l.dW=ZP,l.dX=Ie,l.dY=function(i){let t=0;if(new Uint32Array(i,0,1)[0]!==WM){const o=new Uint32Array(i,0,7),[,,u,f,p,y]=o;t=o.byteLength+f+p+y+p,(u!==i.byteLength||t>=i.byteLength)&&gn("Invalid b3dm header information.")}return QM(i,t)},l.dZ=function(i,t){const o=e3(i);for(const u of o){for(const f of u.meshes)Gj(f);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(qj(u.lights,t)))}return o},l.d_=Ab,l.da=np,l.db=function([i,t,o]){const u=Math.hypot(i,t,o),f=Math.atan2(i,o),p=.5*Math.PI-Math.acos(-t/u);return new Ai(Ui(f),Ui(p))},l.dc=u_,l.dd=I,l.de=F5,l.df=X6,l.dg=function(i){const t=[0,0,0],o=l.a9.identity(new Float64Array(16));return l.a9.multiply(o,i.pixelMatrix,i.globeMatrix),l.Q.transformMat4(t,t,o),new Ut(t[0],t[1])},l.dh=function(i){const t=i.navigator?i.navigator.userAgent:null;return!!function(o){if(Jl==null){const u=o.navigator?o.navigator.userAgent:null;Jl=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Jl}(i)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},l.di=class{constructor(i,t,o){this._transformRequestFn=i,this._customAccessToken=t,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){const i=function(){let t="";for(let o=0;o<10;o++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",wf,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,t){return this._transformRequestFn&&this._transformRequestFn(i,t)||{url:i}}normalizeStyleURL(i,t){if(!j(i))return i;const o=Ya(i);return o.params.push(`sdk=js-${S}`),o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||t)}normalizeGlyphsURL(i,t){if(!j(i))return i;const o=Ya(i);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||t)}normalizeModelURL(i,t){if(!j(i))return i;const o=Ya(i);return o.path=`/models/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||t)}normalizeSourceURL(i,t,o,u){if(!j(i))return i;const f=Ya(i);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),o&&f.params.push(`language=${o}`),u&&f.params.push(`worldview=${u}`),this._makeAPIURL(f,this._customAccessToken||t)}normalizeSpriteURL(i,t,o,u){const f=Ya(i);return j(i)?(f.path=`/styles/v1${f.path}/sprite${t}${o}`,this._makeAPIURL(f,this._customAccessToken||u)):(f.path+=`${t}${o}`,Lh(f))}normalizeTileURL(i,t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!j(i))return i;const u=Ya(i);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||o&&u.authority!=="raster"&&o===512?"@2x":""}${Sa.supported?".webp":"$1"}`),u.authority==="raster"?u.path=`/${I.RASTER_URL_PREFIX}${u.path}`:u.authority==="rasterarrays"?u.path=`/${I.RASTERARRAYS_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${I.TILE_URL_VERSION}${u.path}`);const f=this._customAccessToken||function(p){for(const y of p){const b=y.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(u.params)||I.ACCESS_TOKEN;return I.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,f)}canonicalizeTileURL(i,t){const o=Ya(i);if(!o.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!o.path.match(/\.[\w]+$/))return i;let u="mapbox://";o.path.match(/^\/raster\/v1\//)?u+=`raster/${o.path.replace(`/${I.RASTER_URL_PREFIX}/`,"")}`:o.path.match(/^\/rasterarrays\/v1\//)?u+=`rasterarrays/${o.path.replace(`/${I.RASTERARRAYS_URL_PREFIX}/`,"")}`:u+=`tiles/${o.path.replace(`/${I.TILE_URL_VERSION}/`,"")}`;let f=o.params;return t&&(f=f.filter(p=>!p.match(/^access_token=/))),f.length&&(u+=`?${f.join("&")}`),u}canonicalizeTileset(i,t){const o=!!t&&j(t),u=[];for(const f of i.tiles||[])V(f)?u.push(this.canonicalizeTileURL(f,o)):u.push(f);return u}_makeAPIURL(i,t){const o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=Ya(I.API_URL);if(i.protocol=u.protocol,i.authority=u.authority,i.protocol==="http"){const f=i.params.indexOf("secure");f>=0&&i.params.splice(f,1)}if(u.path!=="/"&&(i.path=`${u.path}${i.path}`),!I.REQUIRE_ACCESS_TOKEN)return Lh(i);if(t=t||I.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if(t[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return i.params=i.params.filter(f=>f.indexOf("access_token")===-1),i.params.push(`access_token=${t||""}`),Lh(i)}},l.dj=function(i,t){t?km.add(i):km.delete(i)},l.dk=Sa,l.dl=Pm,l.dm=_0,l.dn=Cm,l.dp=Lo,l.dq=$E,l.dr=function(i){km.delete(i)},l.ds=Mm,l.dt=Fc,l.du=S,l.dv=function(i,t){an=i,fs=t},l.dw=function(i,t,o=!1){if(X===F||X===B||X===$)throw new Error("setRTLTextPlugin cannot be called multiple times.");Z=ve.resolveURL(i),X=F,G=t,K(),o||de()},l.dx=fe,l.dy=function(){bb().acquire(_4)},l.dz=function(){const i=Ty;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(_4),Ty=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},l.e=_o,l.e0=ye,l.e1=function(i){ra(),ki&&ki.then(t=>{t.keys().then(o=>{for(let u=0;u<o.length-i;u++)t.delete(o[u])})})},l.f=ve,l.g=function(i,t){return vf(_o(i,{type:"json"}),t)},l.h=rl,l.i=class extends vb{},l.j=Vc,l.k=Fm,l.l=function(i){return fetch(i).then(t=>t.arrayBuffer()).then(t=>QM(t,0,i))},l.m=r_,l.n=bx,l.o=n_,l.p=dM,l.q=rt,l.r=Ex,l.s=Zh,l.t=Xh,l.u=Je,l.v=Bf,l.w=gn,l.x=Uf,l.y=$c}),_(["./shared"],function(l){function S(je){const re=je?je.url.toString():void 0;return re?performance.getEntriesByName(re):[]}function D(je){if(typeof je=="number"||typeof je=="boolean"||typeof je=="string"||je==null)return JSON.stringify(je);if(Array.isArray(je)){let oe="[";for(const xe of je)oe+=`${D(xe)},`;return`${oe}]`}let re="{";for(const oe of Object.keys(je).sort())re+=`${oe}:${D(je[oe])},`;return`${re}}`}function I(je){let re="";for(const oe of l.b5)re+=`/${D(je[oe])}`;return re}class V{constructor(re){this.keyCache={},this._layers={},this._layerConfigs={},re&&this.replace(re)}replace(re,oe){this._layerConfigs={},this._layers={},this.update(re,[],oe)}update(re,oe,xe){this._options=xe;for(const Ke of re)this._layerConfigs[Ke.id]=Ke,(this._layers[Ke.id]=l.c7(Ke,this.scope,this._options)).compileFilter(),this.keyCache[Ke.id]&&delete this.keyCache[Ke.id];for(const Ke of oe)delete this.keyCache[Ke],delete this._layerConfigs[Ke],delete this._layers[Ke];this.familiesBySource={};const Be=function(Ke,ct){const zt={};for(let Ct=0;Ct<Ke.length;Ct++){const qt=ct&&ct[Ke[Ct].id]||I(Ke[Ct]);ct&&(ct[Ke[Ct].id]=qt);let Wt=zt[qt];Wt||(Wt=zt[qt]=[]),Wt.push(Ke[Ct])}const st=[];for(const Ct in zt)st.push(zt[Ct]);return st}(l.b2(this._layerConfigs),this.keyCache);for(const Ke of Be){const ct=Ke.map(Nt=>this._layers[Nt.id]),zt=ct[0];if(zt.visibility==="none")continue;const st=zt.source||"";let Ct=this.familiesBySource[st];Ct||(Ct=this.familiesBySource[st]={});const qt=zt.sourceLayer||"_geojsonTileLayer";let Wt=Ct[qt];Wt||(Wt=Ct[qt]=[]),Wt.push(ct)}}}const j=1*l.dJ;class Q{constructor(re){const oe={},xe=[];for(const zt in re){const st=re[zt],Ct=oe[zt]={};for(const qt in st.glyphs){const Wt=st.glyphs[+qt];if(!Wt||Wt.bitmap.width===0||Wt.bitmap.height===0)continue;const Nt=Wt.metrics.localGlyph?j:1,jr={x:0,y:0,w:Wt.bitmap.width+2*Nt,h:Wt.bitmap.height+2*Nt};xe.push(jr),Ct[qt]=jr}}const{w:Be,h:Ke}=l.p(xe),ct=new l.dI({width:Be||1,height:Ke||1});for(const zt in re){const st=re[zt];for(const Ct in st.glyphs){const qt=st.glyphs[+Ct];if(!qt||qt.bitmap.width===0||qt.bitmap.height===0)continue;const Wt=oe[zt][Ct],Nt=qt.metrics.localGlyph?j:1;l.dI.copy(qt.bitmap,ct,{x:0,y:0},{x:Wt.x+Nt,y:Wt.y+Nt},qt.bitmap)}}this.image=ct,this.positions=oe}}l.dH(Q,"GlyphAtlas");class te{constructor(re){this.tileID=new l.ap(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.tileZoom=re.tileZoom,this.uid=re.uid,this.zoom=re.zoom,this.canonical=re.tileID.canonical,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.scope=re.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=re.showCollisionBoxes,this.collectResourceTiming=!!re.collectResourceTiming,this.promoteId=re.promoteId,this.isSymbolTile=re.isSymbolTile,this.tileTransform=l.av(re.tileID.canonical,re.projection),this.projection=re.projection,this.brightness=re.brightness,this.extraShadowCaster=!!re.extraShadowCaster}parse(re,oe,xe,Be,Ke){this.status="parsing",this.data=re,this.collisionBoxArray=new l.aG;const ct=new l.dK(Object.keys(re.layers).sort()),zt=new l.dL(this.tileID,this.promoteId);zt.bucketLayerIDs=[];const st={},Ct=new l.dM(256,256),qt={featureIndex:zt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Ct,availableImages:xe,brightness:this.brightness},Wt=oe.familiesBySource[this.source];for(const Kr in Wt){const Ti=re.layers[Kr];if(!Ti)continue;let Zi=!1,mi=!1,Ln=!1;for(const wr of Wt[Kr])wr[0].type==="symbol"?Zi=!0:mi=!0,wr[0].is3D()&&wr[0].type!=="model"&&(Ln=!0);if(this.extraShadowCaster&&!Ln||this.isSymbolTile===!0&&!Zi||this.isSymbolTile===!1&&!mi)continue;Ti.version===1&&l.w(`Vector tile source "${this.source}" layer "${Kr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const fn=ct.encode(Kr),hs=[];for(let wr=0;wr<Ti.length;wr++){const _r=Ti.feature(wr),Xe=zt.getId(_r,Kr);hs.push({feature:_r,id:Xe,index:wr,sourceLayerIndex:fn})}for(const wr of Wt[Kr]){const _r=wr[0];(!this.extraShadowCaster||_r.is3D()&&_r.type!=="model")&&(this.isSymbolTile!==void 0&&_r.type==="symbol"!==this.isSymbolTile||_r.minzoom&&this.zoom<Math.floor(_r.minzoom)||_r.maxzoom&&this.zoom>=_r.maxzoom||_r.visibility!=="none"&&(ce(wr,this.zoom,qt.brightness,xe),(st[_r.id]=_r.createBucket({index:zt.bucketLayerIDs.length,layers:wr,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:fn,sourceID:this.source,projection:this.projection.spec})).populate(hs,qt,this.tileID.canonical,this.tileTransform),zt.bucketLayerIDs.push(wr.map(Xe=>Xe.id))))}}let Nt,jr,Or,ii;Ct.trim();const mr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ni=()=>{if(Nt)return this.status="done",Ke(Nt);if(this.extraShadowCaster)this.status="done",Ke(null,{buckets:l.b2(st).filter(Kr=>!Kr.isEmpty()),featureIndex:zt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:qt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(jr&&Or&&ii){const Kr=new Q(jr),Ti=new l.dO(Or,ii);for(const Zi in st){const mi=st[Zi];mi instanceof l.aH?(ce(mi.layers,this.zoom,qt.brightness,xe),l.dP(mi,jr,Kr.positions,Or,Ti.iconPositions,this.showCollisionBoxes,xe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):mi.hasPattern&&(mi instanceof l.aN||mi instanceof l.aO||mi instanceof l.cO)&&(ce(mi.layers,this.zoom,qt.brightness,xe),mi.addFeatures(qt,this.tileID.canonical,Ti.patternPositions,xe,this.tileTransform,this.brightness))}this.status="done",Ke(null,{buckets:l.b2(st).filter(Zi=>!Zi.isEmpty()),featureIndex:zt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Kr.image,lineAtlas:Ct,imageAtlas:Ti,brightness:qt.brightness})}};if(!this.extraShadowCaster){const Kr=l.dN(qt.glyphDependencies,mi=>Object.keys(mi).map(Number));Object.keys(Kr).length?Be.send("getGlyphs",{uid:this.uid,stacks:Kr,scope:this.scope},(mi,Ln)=>{Nt||(Nt=mi,jr=Ln,ni())},void 0,!1,mr):jr={};const Ti=Object.keys(qt.iconDependencies);Ti.length?Be.send("getImages",{icons:Ti,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(mi,Ln)=>{Nt||(Nt=mi,Or=Ln,ni())},void 0,!1,mr):Or={};const Zi=Object.keys(qt.patternDependencies);Zi.length?Be.send("getImages",{icons:Zi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(mi,Ln)=>{Nt||(Nt=mi,ii=Ln,ni())},void 0,!1,mr):ii={}}ni()}}function ce(je,re,oe,xe){const Be=new l.N(re,{brightness:oe});for(const Ke of je)Ke.recalculate(Be,xe)}class Ce extends l.E{constructor(re,oe,xe,Be,Ke,ct){super(),this.actor=re,this.layerIndex=oe,this.availableImages=xe,this.loadVectorData=Ke||l.ak,this.loading={},this.loaded={},this.deduped=new l.ai(re.scheduler),this.isSpriteLoaded=Be,this.scheduler=re.scheduler,this.brightness=ct}loadTile(re,oe){const xe=re.uid,Be=re&&re.request,Ke=Be&&Be.collectResourceTiming,ct=this.loading[xe]=new te(re);ct.abort=this.loadVectorData(re,(zt,st)=>{const Ct=!this.loading[xe];if(delete this.loading[xe],Ct||zt||!st)return ct.status="done",Ct||(this.loaded[xe]=ct),oe(zt);const qt=st.rawData,Wt={};st.expires&&(Wt.expires=st.expires),st.cacheControl&&(Wt.cacheControl=st.cacheControl),ct.vectorTile=st.vectorTile||new l.dQ(new l.dR(qt));const Nt=()=>{ct.parse(ct.vectorTile,this.layerIndex,this.availableImages,this.actor,(jr,Or)=>{if(jr||!Or)return oe(jr);const ii={};if(Ke){const mr=S(Be);mr.length>0&&(ii.resourceTiming=JSON.parse(JSON.stringify(mr)))}oe(null,l.e({rawTileData:qt.slice(0)},Or,Wt,ii))})};this.isSpriteLoaded?Nt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Nt,{type:"parseTile",isSymbolTile:re.isSymbolTile,zoom:re.tileZoom}):Nt()}),this.loaded=this.loaded||{},this.loaded[xe]=ct})}reloadTile(re,oe){const xe=this.loaded,Be=re.uid,Ke=this;if(xe&&xe[Be]){const ct=xe[Be];ct.showCollisionBoxes=re.showCollisionBoxes,ct.projection=re.projection,ct.brightness=re.brightness,ct.tileTransform=l.av(re.tileID.canonical,re.projection),ct.extraShadowCaster=re.extraShadowCaster;const zt=(st,Ct)=>{const qt=ct.reloadCallback;qt&&(delete ct.reloadCallback,ct.parse(ct.vectorTile,Ke.layerIndex,this.availableImages,Ke.actor,qt)),oe(st,Ct)};ct.status==="parsing"?ct.reloadCallback=zt:ct.status==="done"&&(ct.vectorTile?ct.parse(ct.vectorTile,this.layerIndex,this.availableImages,this.actor,zt):zt())}else oe(null,void 0)}abortTile(re,oe){const xe=re.uid,Be=this.loading[xe];Be&&(Be.abort&&Be.abort(),delete this.loading[xe]),oe()}removeTile(re,oe){const xe=this.loaded,Be=re.uid;xe&&xe[Be]&&delete xe[Be],oe()}}class Me{loadTile(re,oe){const{uid:xe,encoding:Be,rawImageData:Ke,padding:ct}=re,zt=ImageBitmap&&Ke instanceof ImageBitmap?this.getImageData(Ke,ct):Ke;oe(null,new l.dS(xe,zt,Be,ct<1))}getImageData(re,oe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(re.width,re.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=re.width,this.offscreenCanvas.height=re.height,this.offscreenCanvasContext.drawImage(re,0,0,re.width,re.height);const xe=this.offscreenCanvasContext.getImageData(-oe,-oe,re.width+2*oe,re.height+2*oe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),xe}}class Ie{decodeRasterArray({task:re,buffer:oe},xe){l.b0.performDecoding(oe,re).then(Be=>{xe(null,Be)},Be=>{xe(Be)})}}const Te=l.dT.prototype.toGeoJSON;let Ge=class{constructor(je){this._feature=je,this.extent=l.Y,this.type=je.type,this.properties=je.tags,"id"in je&&!isNaN(je.id)&&(this.id=parseInt(je.id,10))}loadGeometry(){if(this._feature.type===1){const je=[];for(const re of this._feature.geometry)je.push([new l.P(re[0],re[1])]);return je}{const je=[];for(const re of this._feature.geometry){const oe=[];for(const xe of re)oe.push(new l.P(xe[0],xe[1]));je.push(oe)}return je}}toGeoJSON(je,re,oe){return Te.call(this,je,re,oe)}},$e=class{constructor(je){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.Y,this.length=je.length,this._features=je}feature(je){return new Ge(this._features[je])}};var ue={exports:{}},pe=l.dV,_e=l.dU.VectorTileFeature,ge=Fe;function Fe(je,re){this.options=re||{},this.features=je,this.length=je.length}function De(je,re){this.id=typeof je.id=="number"?je.id:void 0,this.type=je.type,this.rawGeometry=je.type===1?[je.geometry]:je.geometry,this.properties=je.tags,this.extent=re||4096}Fe.prototype.feature=function(je){return new De(this.features[je],this.options.extent)},De.prototype.loadGeometry=function(){var je=this.rawGeometry;this.geometry=[];for(var re=0;re<je.length;re++){for(var oe=je[re],xe=[],Be=0;Be<oe.length;Be++)xe.push(new pe(oe[Be][0],oe[Be][1]));this.geometry.push(xe)}return this.geometry},De.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var je=this.geometry,re=1/0,oe=-1/0,xe=1/0,Be=-1/0,Ke=0;Ke<je.length;Ke++)for(var ct=je[Ke],zt=0;zt<ct.length;zt++){var st=ct[zt];re=Math.min(re,st.x),oe=Math.max(oe,st.x),xe=Math.min(xe,st.y),Be=Math.max(Be,st.y)}return[re,xe,oe,Be]},De.prototype.toGeoJSON=_e.prototype.toGeoJSON;var Se=l.dW,pr=ge;function or(je){var re=new Se;return function(oe,xe){for(var Be in oe.layers)xe.writeMessage(3,Vt,oe.layers[Be])}(je,re),re.finish()}function Vt(je,re){var oe;re.writeVarintField(15,je.version||1),re.writeStringField(1,je.name||""),re.writeVarintField(5,je.extent||4096);var xe={keys:[],values:[],keycache:{},valuecache:{}};for(oe=0;oe<je.length;oe++)xe.feature=je.feature(oe),re.writeMessage(2,Ht,xe);var Be=xe.keys;for(oe=0;oe<Be.length;oe++)re.writeStringField(3,Be[oe]);var Ke=xe.values;for(oe=0;oe<Ke.length;oe++)re.writeMessage(4,Xt,Ke[oe])}function Ht(je,re){var oe=je.feature;oe.id!==void 0&&re.writeVarintField(1,oe.id),re.writeMessage(2,Kt,je),re.writeVarintField(3,oe.type),re.writeMessage(4,Sr,oe)}function Kt(je,re){var oe=je.feature,xe=je.keys,Be=je.values,Ke=je.keycache,ct=je.valuecache;for(var zt in oe.properties){var st=oe.properties[zt],Ct=Ke[zt];if(st!==null){Ct===void 0&&(xe.push(zt),Ke[zt]=Ct=xe.length-1),re.writeVarint(Ct);var qt=typeof st;qt!=="string"&&qt!=="boolean"&&qt!=="number"&&(st=JSON.stringify(st));var Wt=qt+":"+st,Nt=ct[Wt];Nt===void 0&&(Be.push(st),ct[Wt]=Nt=Be.length-1),re.writeVarint(Nt)}}}function Tr(je,re){return(re<<3)+(7&je)}function We(je){return je<<1^je>>31}function Sr(je,re){for(var oe=je.loadGeometry(),xe=je.type,Be=0,Ke=0,ct=oe.length,zt=0;zt<ct;zt++){var st=oe[zt],Ct=1;xe===1&&(Ct=st.length),re.writeVarint(Tr(1,Ct));for(var qt=xe===3?st.length-1:st.length,Wt=0;Wt<qt;Wt++){Wt===1&&xe!==1&&re.writeVarint(Tr(2,qt-1));var Nt=st[Wt].x-Be,jr=st[Wt].y-Ke;re.writeVarint(We(Nt)),re.writeVarint(We(jr)),Be+=Nt,Ke+=jr}xe===3&&re.writeVarint(Tr(7,1))}}function Xt(je,re){var oe=typeof je;oe==="string"?re.writeStringField(1,je):oe==="boolean"?re.writeBooleanField(7,je):oe==="number"&&(je%1!=0?re.writeDoubleField(3,je):je<0?re.writeSVarintField(6,je):re.writeVarintField(5,je))}ue.exports=or,ue.exports.fromVectorTileJs=or,ue.exports.fromGeojsonVt=function(je,re){re=re||{};var oe={};for(var xe in je)oe[xe]=new pr(je[xe].features,re),oe[xe].name=xe,oe[xe].version=re.version,oe[xe].extent=re.extent;return or({layers:oe})},ue.exports.GeoJSONWrapper=pr;var ei=l.dX(ue.exports);const Fr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:je=>je},gi=Math.fround||(qr=new Float32Array(1),je=>(qr[0]=+je,qr[0]));var qr;const yt=3,dt=5,jt=6;class $t{constructor(re){this.options=Object.assign(Object.create(Fr),re),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(re){const{log:oe,minZoom:xe,maxZoom:Be}=this.options;oe&&console.time("total time");const Ke=`prepare ${re.length} points`;oe&&console.time(Ke),this.points=re;const ct=[];for(let st=0;st<re.length;st++){const Ct=re[st];if(!Ct.geometry)continue;const[qt,Wt]=Ct.geometry.coordinates,Nt=gi(be(qt)),jr=gi(Ae(Wt));ct.push(Nt,jr,1/0,st,-1,1),this.options.reduce&&ct.push(0)}let zt=this.trees[Be+1]=this._createTree(ct);oe&&console.timeEnd(Ke);for(let st=Be;st>=xe;st--){const Ct=+Date.now();zt=this.trees[st]=this._createTree(this._cluster(zt,st)),oe&&console.log("z%d: %d clusters in %dms",st,zt.numItems,+Date.now()-Ct)}return oe&&console.timeEnd("total time"),this}getClusters(re,oe){let xe=((re[0]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,re[1]));let Ke=re[2]===180?180:((re[2]+180)%360+360)%360-180;const ct=Math.max(-90,Math.min(90,re[3]));if(re[2]-re[0]>=360)xe=-180,Ke=180;else if(xe>Ke){const Wt=this.getClusters([xe,Be,180,ct],oe),Nt=this.getClusters([-180,Be,Ke,ct],oe);return Wt.concat(Nt)}const zt=this.trees[this._limitZoom(oe)],st=zt.range(be(xe),Ae(ct),be(Ke),Ae(Be)),Ct=zt.data,qt=[];for(const Wt of st){const Nt=this.stride*Wt;qt.push(Ct[Nt+dt]>1?Mr(Ct,Nt,this.clusterProps):this.points[Ct[Nt+yt]])}return qt}getChildren(re){const oe=this._getOriginId(re),xe=this._getOriginZoom(re),Be="No cluster with the specified id.",Ke=this.trees[xe];if(!Ke)throw new Error(Be);const ct=Ke.data;if(oe*this.stride>=ct.length)throw new Error(Be);const zt=this.options.radius/(this.options.extent*Math.pow(2,xe-1)),st=Ke.within(ct[oe*this.stride],ct[oe*this.stride+1],zt),Ct=[];for(const qt of st){const Wt=qt*this.stride;ct[Wt+4]===re&&Ct.push(ct[Wt+dt]>1?Mr(ct,Wt,this.clusterProps):this.points[ct[Wt+yt]])}if(Ct.length===0)throw new Error(Be);return Ct}getLeaves(re,oe,xe){const Be=[];return this._appendLeaves(Be,re,oe=oe||10,xe=xe||0,0),Be}getTile(re,oe,xe){const Be=this.trees[this._limitZoom(re)],Ke=Math.pow(2,re),{extent:ct,radius:zt}=this.options,st=zt/ct,Ct=(xe-st)/Ke,qt=(xe+1+st)/Ke,Wt={features:[]};return this._addTileFeatures(Be.range((oe-st)/Ke,Ct,(oe+1+st)/Ke,qt),Be.data,oe,xe,Ke,Wt),oe===0&&this._addTileFeatures(Be.range(1-st/Ke,Ct,1,qt),Be.data,Ke,xe,Ke,Wt),oe===Ke-1&&this._addTileFeatures(Be.range(0,Ct,st/Ke,qt),Be.data,-1,xe,Ke,Wt),Wt.features.length?Wt:null}getClusterExpansionZoom(re){let oe=this._getOriginZoom(re)-1;for(;oe<=this.options.maxZoom;){const xe=this.getChildren(re);if(oe++,xe.length!==1)break;re=xe[0].properties.cluster_id}return oe}_appendLeaves(re,oe,xe,Be,Ke){const ct=this.getChildren(oe);for(const zt of ct){const st=zt.properties;if(st&&st.cluster?Ke+st.point_count<=Be?Ke+=st.point_count:Ke=this._appendLeaves(re,st.cluster_id,xe,Be,Ke):Ke<Be?Ke++:re.push(zt),re.length===xe)break}return Ke}_createTree(re){const oe=new l.bj(re.length/this.stride|0,this.options.nodeSize,Float32Array);for(let xe=0;xe<re.length;xe+=this.stride)oe.add(re[xe],re[xe+1]);return oe.finish(),oe.data=re,oe}_addTileFeatures(re,oe,xe,Be,Ke,ct){for(const zt of re){const st=zt*this.stride,Ct=oe[st+dt]>1;let qt,Wt,Nt;if(Ct)qt=Er(oe,st,this.clusterProps),Wt=oe[st],Nt=oe[st+1];else{const ii=this.points[oe[st+yt]];qt=ii.properties;const[mr,ni]=ii.geometry.coordinates;Wt=be(mr),Nt=Ae(ni)}const jr={type:1,geometry:[[Math.round(this.options.extent*(Wt*Ke-xe)),Math.round(this.options.extent*(Nt*Ke-Be))]],tags:qt};let Or;Or=Ct||this.options.generateId?oe[st+yt]:this.points[oe[st+yt]].id,Or!==void 0&&(jr.id=Or),ct.features.push(jr)}}_limitZoom(re){return Math.max(this.options.minZoom,Math.min(Math.floor(+re),this.options.maxZoom+1))}_cluster(re,oe){const{radius:xe,extent:Be,reduce:Ke,minPoints:ct}=this.options,zt=xe/(Be*Math.pow(2,oe)),st=re.data,Ct=[],qt=this.stride;for(let Wt=0;Wt<st.length;Wt+=qt){if(st[Wt+2]<=oe)continue;st[Wt+2]=oe;const Nt=st[Wt],jr=st[Wt+1],Or=re.within(st[Wt],st[Wt+1],zt),ii=st[Wt+dt];let mr=ii;for(const ni of Or){const Kr=ni*qt;st[Kr+2]>oe&&(mr+=st[Kr+dt])}if(mr>ii&&mr>=ct){let ni,Kr=Nt*ii,Ti=jr*ii,Zi=-1;const mi=(Wt/qt<<5)+(oe+1)+this.points.length;for(const Ln of Or){const fn=Ln*qt;if(st[fn+2]<=oe)continue;st[fn+2]=oe;const hs=st[fn+dt];Kr+=st[fn]*hs,Ti+=st[fn+1]*hs,st[fn+4]=mi,Ke&&(ni||(ni=this._map(st,Wt,!0),Zi=this.clusterProps.length,this.clusterProps.push(ni)),Ke(ni,this._map(st,fn)))}st[Wt+4]=mi,Ct.push(Kr/mr,Ti/mr,1/0,mi,-1,mr),Ke&&Ct.push(Zi)}else{for(let ni=0;ni<qt;ni++)Ct.push(st[Wt+ni]);if(mr>1)for(const ni of Or){const Kr=ni*qt;if(!(st[Kr+2]<=oe)){st[Kr+2]=oe;for(let Ti=0;Ti<qt;Ti++)Ct.push(st[Kr+Ti])}}}}return Ct}_getOriginId(re){return re-this.points.length>>5}_getOriginZoom(re){return(re-this.points.length)%32}_map(re,oe,xe){if(re[oe+dt]>1){const ct=this.clusterProps[re[oe+jt]];return xe?Object.assign({},ct):ct}const Be=this.points[re[oe+yt]].properties,Ke=this.options.map(Be);return xe&&Ke===Be?Object.assign({},Ke):Ke}}function Mr(je,re,oe){return{type:"Feature",id:je[re+yt],properties:Er(je,re,oe),geometry:{type:"Point",coordinates:[(xe=je[re],360*(xe-.5)),Ze(je[re+1])]}};var xe}function Er(je,re,oe){const xe=je[re+dt],Be=xe>=1e4?`${Math.round(xe/1e3)}k`:xe>=1e3?Math.round(xe/100)/10+"k":xe,Ke=je[re+jt],ct=Ke===-1?{}:Object.assign({},oe[Ke]);return Object.assign(ct,{cluster:!0,cluster_id:je[re+yt],point_count:xe,point_count_abbreviated:Be})}function be(je){return je/360+.5}function Ae(je){const re=Math.sin(je*Math.PI/180),oe=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return oe<0?0:oe>1?1:oe}function Ze(je){const re=(180-360*je)*Math.PI/180;return 360*Math.atan(Math.exp(re))/Math.PI-90}var lt={exports:{}};lt.exports=function(){function je(Xe,Ve,tt,ut){for(var _t,Lt=ut,bt=tt-Ve>>1,Rt=tt-Ve,Bt=Xe[Ve],It=Xe[Ve+1],ar=Xe[tt],gr=Xe[tt+1],Yt=Ve+3;Yt<tt;Yt+=3){var Ir=re(Xe[Yt],Xe[Yt+1],Bt,It,ar,gr);if(Ir>Lt)_t=Yt,Lt=Ir;else if(Ir===Lt){var Ei=Math.abs(Yt-bt);Ei<Rt&&(_t=Yt,Rt=Ei)}}Lt>ut&&(_t-Ve>3&&je(Xe,Ve,_t,ut),Xe[_t+2]=Lt,tt-_t>3&&je(Xe,_t,tt,ut))}function re(Xe,Ve,tt,ut,_t,Lt){var bt=_t-tt,Rt=Lt-ut;if(bt!==0||Rt!==0){var Bt=((Xe-tt)*bt+(Ve-ut)*Rt)/(bt*bt+Rt*Rt);Bt>1?(tt=_t,ut=Lt):Bt>0&&(tt+=bt*Bt,ut+=Rt*Bt)}return(bt=Xe-tt)*bt+(Rt=Ve-ut)*Rt}function oe(Xe,Ve,tt,ut){var _t={id:Xe===void 0?null:Xe,type:Ve,geometry:tt,tags:ut,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Lt){var bt=Lt.geometry,Rt=Lt.type;if(Rt==="Point"||Rt==="MultiPoint"||Rt==="LineString")xe(Lt,bt);else if(Rt==="Polygon"||Rt==="MultiLineString")for(var Bt=0;Bt<bt.length;Bt++)xe(Lt,bt[Bt]);else if(Rt==="MultiPolygon")for(Bt=0;Bt<bt.length;Bt++)for(var It=0;It<bt[Bt].length;It++)xe(Lt,bt[Bt][It])}(_t),_t}function xe(Xe,Ve){for(var tt=0;tt<Ve.length;tt+=3)Xe.minX=Math.min(Xe.minX,Ve[tt]),Xe.minY=Math.min(Xe.minY,Ve[tt+1]),Xe.maxX=Math.max(Xe.maxX,Ve[tt]),Xe.maxY=Math.max(Xe.maxY,Ve[tt+1])}function Be(Xe,Ve,tt,ut){if(Ve.geometry){var _t=Ve.geometry.coordinates,Lt=Ve.geometry.type,bt=Math.pow(tt.tolerance/((1<<tt.maxZoom)*tt.extent),2),Rt=[],Bt=Ve.id;if(tt.promoteId?Bt=Ve.properties[tt.promoteId]:tt.generateId&&(Bt=ut||0),Lt==="Point")Ke(_t,Rt);else if(Lt==="MultiPoint")for(var It=0;It<_t.length;It++)Ke(_t[It],Rt);else if(Lt==="LineString")ct(_t,Rt,bt,!1);else if(Lt==="MultiLineString"){if(tt.lineMetrics){for(It=0;It<_t.length;It++)ct(_t[It],Rt=[],bt,!1),Xe.push(oe(Bt,"LineString",Rt,Ve.properties));return}zt(_t,Rt,bt,!1)}else if(Lt==="Polygon")zt(_t,Rt,bt,!0);else{if(Lt!=="MultiPolygon"){if(Lt==="GeometryCollection"){for(It=0;It<Ve.geometry.geometries.length;It++)Be(Xe,{id:Bt,geometry:Ve.geometry.geometries[It],properties:Ve.properties},tt,ut);return}throw new Error("Input data is not a valid GeoJSON object.")}for(It=0;It<_t.length;It++){var ar=[];zt(_t[It],ar,bt,!0),Rt.push(ar)}}Xe.push(oe(Bt,Lt,Rt,Ve.properties))}}function Ke(Xe,Ve){Ve.push(st(Xe[0])),Ve.push(Ct(Xe[1])),Ve.push(0)}function ct(Xe,Ve,tt,ut){for(var _t,Lt,bt=0,Rt=0;Rt<Xe.length;Rt++){var Bt=st(Xe[Rt][0]),It=Ct(Xe[Rt][1]);Ve.push(Bt),Ve.push(It),Ve.push(0),Rt>0&&(bt+=ut?(_t*It-Bt*Lt)/2:Math.sqrt(Math.pow(Bt-_t,2)+Math.pow(It-Lt,2))),_t=Bt,Lt=It}var ar=Ve.length-3;Ve[2]=1,je(Ve,0,ar,tt),Ve[ar+2]=1,Ve.size=Math.abs(bt),Ve.start=0,Ve.end=Ve.size}function zt(Xe,Ve,tt,ut){for(var _t=0;_t<Xe.length;_t++){var Lt=[];ct(Xe[_t],Lt,tt,ut),Ve.push(Lt)}}function st(Xe){return Xe/360+.5}function Ct(Xe){var Ve=Math.sin(Xe*Math.PI/180),tt=.5-.25*Math.log((1+Ve)/(1-Ve))/Math.PI;return tt<0?0:tt>1?1:tt}function qt(Xe,Ve,tt,ut,_t,Lt,bt,Rt){if(ut/=Ve,Lt>=(tt/=Ve)&&bt<ut)return Xe;if(bt<tt||Lt>=ut)return null;for(var Bt=[],It=0;It<Xe.length;It++){var ar=Xe[It],gr=ar.geometry,Yt=ar.type,Ir=_t===0?ar.minX:ar.minY,Ei=_t===0?ar.maxX:ar.maxY;if(Ir>=tt&&Ei<ut)Bt.push(ar);else if(!(Ei<tt||Ir>=ut)){var _i=[];if(Yt==="Point"||Yt==="MultiPoint")Wt(gr,_i,tt,ut,_t);else if(Yt==="LineString")Nt(gr,_i,tt,ut,_t,!1,Rt.lineMetrics);else if(Yt==="MultiLineString")Or(gr,_i,tt,ut,_t,!1);else if(Yt==="Polygon")Or(gr,_i,tt,ut,_t,!0);else if(Yt==="MultiPolygon")for(var yi=0;yi<gr.length;yi++){var fi=[];Or(gr[yi],fi,tt,ut,_t,!0),fi.length&&_i.push(fi)}if(_i.length){if(Rt.lineMetrics&&Yt==="LineString"){for(yi=0;yi<_i.length;yi++)Bt.push(oe(ar.id,Yt,_i[yi],ar.tags));continue}Yt!=="LineString"&&Yt!=="MultiLineString"||(_i.length===1?(Yt="LineString",_i=_i[0]):Yt="MultiLineString"),Yt!=="Point"&&Yt!=="MultiPoint"||(Yt=_i.length===3?"Point":"MultiPoint"),Bt.push(oe(ar.id,Yt,_i,ar.tags))}}}return Bt.length?Bt:null}function Wt(Xe,Ve,tt,ut,_t){for(var Lt=0;Lt<Xe.length;Lt+=3){var bt=Xe[Lt+_t];bt>=tt&&bt<=ut&&(Ve.push(Xe[Lt]),Ve.push(Xe[Lt+1]),Ve.push(Xe[Lt+2]))}}function Nt(Xe,Ve,tt,ut,_t,Lt,bt){for(var Rt,Bt,It=jr(Xe),ar=_t===0?mr:ni,gr=Xe.start,Yt=0;Yt<Xe.length-3;Yt+=3){var Ir=Xe[Yt],Ei=Xe[Yt+1],_i=Xe[Yt+2],yi=Xe[Yt+3],fi=Xe[Yt+4],kr=_t===0?Ir:Ei,Bn=_t===0?yi:fi,Ss=!1;bt&&(Rt=Math.sqrt(Math.pow(Ir-yi,2)+Math.pow(Ei-fi,2))),kr<tt?Bn>tt&&(Bt=ar(It,Ir,Ei,yi,fi,tt),bt&&(It.start=gr+Rt*Bt)):kr>ut?Bn<ut&&(Bt=ar(It,Ir,Ei,yi,fi,ut),bt&&(It.start=gr+Rt*Bt)):ii(It,Ir,Ei,_i),Bn<tt&&kr>=tt&&(Bt=ar(It,Ir,Ei,yi,fi,tt),Ss=!0),Bn>ut&&kr<=ut&&(Bt=ar(It,Ir,Ei,yi,fi,ut),Ss=!0),!Lt&&Ss&&(bt&&(It.end=gr+Rt*Bt),Ve.push(It),It=jr(Xe)),bt&&(gr+=Rt)}var Fi=Xe.length-3;Ir=Xe[Fi],Ei=Xe[Fi+1],_i=Xe[Fi+2],(kr=_t===0?Ir:Ei)>=tt&&kr<=ut&&ii(It,Ir,Ei,_i),Fi=It.length-3,Lt&&Fi>=3&&(It[Fi]!==It[0]||It[Fi+1]!==It[1])&&ii(It,It[0],It[1],It[2]),It.length&&Ve.push(It)}function jr(Xe){var Ve=[];return Ve.size=Xe.size,Ve.start=Xe.start,Ve.end=Xe.end,Ve}function Or(Xe,Ve,tt,ut,_t,Lt){for(var bt=0;bt<Xe.length;bt++)Nt(Xe[bt],Ve,tt,ut,_t,Lt,!1)}function ii(Xe,Ve,tt,ut){Xe.push(Ve),Xe.push(tt),Xe.push(ut)}function mr(Xe,Ve,tt,ut,_t,Lt){var bt=(Lt-Ve)/(ut-Ve);return Xe.push(Lt),Xe.push(tt+(_t-tt)*bt),Xe.push(1),bt}function ni(Xe,Ve,tt,ut,_t,Lt){var bt=(Lt-tt)/(_t-tt);return Xe.push(Ve+(ut-Ve)*bt),Xe.push(Lt),Xe.push(1),bt}function Kr(Xe,Ve){for(var tt=[],ut=0;ut<Xe.length;ut++){var _t,Lt=Xe[ut],bt=Lt.type;if(bt==="Point"||bt==="MultiPoint"||bt==="LineString")_t=Ti(Lt.geometry,Ve);else if(bt==="MultiLineString"||bt==="Polygon"){_t=[];for(var Rt=0;Rt<Lt.geometry.length;Rt++)_t.push(Ti(Lt.geometry[Rt],Ve))}else if(bt==="MultiPolygon")for(_t=[],Rt=0;Rt<Lt.geometry.length;Rt++){for(var Bt=[],It=0;It<Lt.geometry[Rt].length;It++)Bt.push(Ti(Lt.geometry[Rt][It],Ve));_t.push(Bt)}tt.push(oe(Lt.id,bt,_t,Lt.tags))}return tt}function Ti(Xe,Ve){var tt=[];tt.size=Xe.size,Xe.start!==void 0&&(tt.start=Xe.start,tt.end=Xe.end);for(var ut=0;ut<Xe.length;ut+=3)tt.push(Xe[ut]+Ve,Xe[ut+1],Xe[ut+2]);return tt}function Zi(Xe,Ve){if(Xe.transformed)return Xe;var tt,ut,_t,Lt=1<<Xe.z,bt=Xe.x,Rt=Xe.y;for(tt=0;tt<Xe.features.length;tt++){var Bt=Xe.features[tt],It=Bt.geometry,ar=Bt.type;if(Bt.geometry=[],ar===1)for(ut=0;ut<It.length;ut+=2)Bt.geometry.push(mi(It[ut],It[ut+1],Ve,Lt,bt,Rt));else for(ut=0;ut<It.length;ut++){var gr=[];for(_t=0;_t<It[ut].length;_t+=2)gr.push(mi(It[ut][_t],It[ut][_t+1],Ve,Lt,bt,Rt));Bt.geometry.push(gr)}}return Xe.transformed=!0,Xe}function mi(Xe,Ve,tt,ut,_t,Lt){return[Math.round(tt*(Xe*ut-_t)),Math.round(tt*(Ve*ut-Lt))]}function Ln(Xe,Ve,tt,ut,_t){for(var Lt=Ve===_t.maxZoom?0:_t.tolerance/((1<<Ve)*_t.extent),bt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:tt,y:ut,z:Ve,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Rt=0;Rt<Xe.length;Rt++){bt.numFeatures++,fn(bt,Xe[Rt],Lt,_t);var Bt=Xe[Rt].minX,It=Xe[Rt].minY,ar=Xe[Rt].maxX,gr=Xe[Rt].maxY;Bt<bt.minX&&(bt.minX=Bt),It<bt.minY&&(bt.minY=It),ar>bt.maxX&&(bt.maxX=ar),gr>bt.maxY&&(bt.maxY=gr)}return bt}function fn(Xe,Ve,tt,ut){var _t=Ve.geometry,Lt=Ve.type,bt=[];if(Lt==="Point"||Lt==="MultiPoint")for(var Rt=0;Rt<_t.length;Rt+=3)bt.push(_t[Rt]),bt.push(_t[Rt+1]),Xe.numPoints++,Xe.numSimplified++;else if(Lt==="LineString")hs(bt,_t,Xe,tt,!1,!1);else if(Lt==="MultiLineString"||Lt==="Polygon")for(Rt=0;Rt<_t.length;Rt++)hs(bt,_t[Rt],Xe,tt,Lt==="Polygon",Rt===0);else if(Lt==="MultiPolygon")for(var Bt=0;Bt<_t.length;Bt++){var It=_t[Bt];for(Rt=0;Rt<It.length;Rt++)hs(bt,It[Rt],Xe,tt,!0,Rt===0)}if(bt.length){var ar=Ve.tags||null;if(Lt==="LineString"&&ut.lineMetrics){for(var gr in ar={},Ve.tags)ar[gr]=Ve.tags[gr];ar.mapbox_clip_start=_t.start/_t.size,ar.mapbox_clip_end=_t.end/_t.size}var Yt={geometry:bt,type:Lt==="Polygon"||Lt==="MultiPolygon"?3:Lt==="LineString"||Lt==="MultiLineString"?2:1,tags:ar};Ve.id!==null&&(Yt.id=Ve.id),Xe.features.push(Yt)}}function hs(Xe,Ve,tt,ut,_t,Lt){var bt=ut*ut;if(ut>0&&Ve.size<(_t?bt:ut))tt.numPoints+=Ve.length/3;else{for(var Rt=[],Bt=0;Bt<Ve.length;Bt+=3)(ut===0||Ve[Bt+2]>bt)&&(tt.numSimplified++,Rt.push(Ve[Bt]),Rt.push(Ve[Bt+1])),tt.numPoints++;_t&&function(It,ar){for(var gr=0,Yt=0,Ir=It.length,Ei=Ir-2;Yt<Ir;Ei=Yt,Yt+=2)gr+=(It[Yt]-It[Ei])*(It[Yt+1]+It[Ei+1]);if(gr>0===ar)for(Yt=0,Ir=It.length;Yt<Ir/2;Yt+=2){var _i=It[Yt],yi=It[Yt+1];It[Yt]=It[Ir-2-Yt],It[Yt+1]=It[Ir-1-Yt],It[Ir-2-Yt]=_i,It[Ir-1-Yt]=yi}}(Rt,Lt),Xe.push(Rt)}}function wr(Xe,Ve){var tt=(Ve=this.options=function(_t,Lt){for(var bt in Lt)_t[bt]=Lt[bt];return _t}(Object.create(this.options),Ve)).debug;if(tt&&console.time("preprocess data"),Ve.maxZoom<0||Ve.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ve.promoteId&&Ve.generateId)throw new Error("promoteId and generateId cannot be used together.");var ut=function(_t,Lt){var bt=[];if(_t.type==="FeatureCollection")for(var Rt=0;Rt<_t.features.length;Rt++)Be(bt,_t.features[Rt],Lt,Rt);else Be(bt,_t.type==="Feature"?_t:{geometry:_t},Lt);return bt}(Xe,Ve);this.tiles={},this.tileCoords=[],tt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ve.indexMaxZoom,Ve.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ut=function(_t,Lt){var bt=Lt.buffer/Lt.extent,Rt=_t,Bt=qt(_t,1,-1-bt,bt,0,-1,2,Lt),It=qt(_t,1,1-bt,2+bt,0,-1,2,Lt);return(Bt||It)&&(Rt=qt(_t,1,-bt,1+bt,0,-1,2,Lt)||[],Bt&&(Rt=Kr(Bt,1).concat(Rt)),It&&(Rt=Rt.concat(Kr(It,-1)))),Rt}(ut,Ve)).length&&this.splitTile(ut,0,0,0),tt&&(ut.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function _r(Xe,Ve,tt){return 32*((1<<Xe)*tt+Ve)+Xe}return wr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},wr.prototype.splitTile=function(Xe,Ve,tt,ut,_t,Lt,bt){for(var Rt=[Xe,Ve,tt,ut],Bt=this.options,It=Bt.debug;Rt.length;){ut=Rt.pop(),tt=Rt.pop(),Ve=Rt.pop(),Xe=Rt.pop();var ar=1<<Ve,gr=_r(Ve,tt,ut),Yt=this.tiles[gr];if(!Yt&&(It>1&&console.time("creation"),Yt=this.tiles[gr]=Ln(Xe,Ve,tt,ut,Bt),this.tileCoords.push({z:Ve,x:tt,y:ut}),It)){It>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ve,tt,ut,Yt.numFeatures,Yt.numPoints,Yt.numSimplified),console.timeEnd("creation"));var Ir="z"+Ve;this.stats[Ir]=(this.stats[Ir]||0)+1,this.total++}if(Yt.source=Xe,_t){if(Ve===Bt.maxZoom||Ve===_t)continue;var Ei=1<<_t-Ve;if(tt!==Math.floor(Lt/Ei)||ut!==Math.floor(bt/Ei))continue}else if(Ve===Bt.indexMaxZoom||Yt.numPoints<=Bt.indexMaxPoints)continue;if(Yt.source=null,Xe.length!==0){It>1&&console.time("clipping");var _i,yi,fi,kr,Bn,Ss,Fi=.5*Bt.buffer/Bt.extent,_n=.5-Fi,ds=.5+Fi,On=1+Fi;_i=yi=fi=kr=null,Bn=qt(Xe,ar,tt-Fi,tt+ds,0,Yt.minX,Yt.maxX,Bt),Ss=qt(Xe,ar,tt+_n,tt+On,0,Yt.minX,Yt.maxX,Bt),Xe=null,Bn&&(_i=qt(Bn,ar,ut-Fi,ut+ds,1,Yt.minY,Yt.maxY,Bt),yi=qt(Bn,ar,ut+_n,ut+On,1,Yt.minY,Yt.maxY,Bt),Bn=null),Ss&&(fi=qt(Ss,ar,ut-Fi,ut+ds,1,Yt.minY,Yt.maxY,Bt),kr=qt(Ss,ar,ut+_n,ut+On,1,Yt.minY,Yt.maxY,Bt),Ss=null),It>1&&console.timeEnd("clipping"),Rt.push(_i||[],Ve+1,2*tt,2*ut),Rt.push(yi||[],Ve+1,2*tt,2*ut+1),Rt.push(fi||[],Ve+1,2*tt+1,2*ut),Rt.push(kr||[],Ve+1,2*tt+1,2*ut+1)}}},wr.prototype.getTile=function(Xe,Ve,tt){var ut=this.options,_t=ut.extent,Lt=ut.debug;if(Xe<0||Xe>24)return null;var bt=1<<Xe,Rt=_r(Xe,Ve=(Ve%bt+bt)%bt,tt);if(this.tiles[Rt])return Zi(this.tiles[Rt],_t);Lt>1&&console.log("drilling down to z%d-%d-%d",Xe,Ve,tt);for(var Bt,It=Xe,ar=Ve,gr=tt;!Bt&&It>0;)It--,ar=Math.floor(ar/2),gr=Math.floor(gr/2),Bt=this.tiles[_r(It,ar,gr)];return Bt&&Bt.source?(Lt>1&&console.log("found parent tile z%d-%d-%d",It,ar,gr),Lt>1&&console.time("drilling down"),this.splitTile(Bt.source,It,ar,gr,Xe,Ve,tt),Lt>1&&console.timeEnd("drilling down"),this.tiles[Rt]?Zi(this.tiles[Rt],_t):null):null},function(Xe,Ve){return new wr(Xe,Ve)}}();var Ee=l.dX(lt.exports);function Ft(je,re){const oe=je.tileID.canonical;if(!this._geoJSONIndex)return re(null,null);const xe=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!xe)return re(null,null);const Be=new $e(xe.features);let Ke=ei(Be);Ke.byteOffset===0&&Ke.byteLength===Ke.buffer.byteLength||(Ke=new Uint8Array(Ke)),re(null,{vectorTile:Be,rawData:Ke.buffer})}class ft extends Ce{constructor(re,oe,xe,Be,Ke,ct){super(re,oe,xe,Be,Ft,ct),Ke&&(this.loadGeoJSON=Ke),this._featureMap=new Map}loadData(re,oe){const xe=re&&re.request,Be=xe&&xe.collectResourceTiming;this.loadGeoJSON(re,(Ke,ct)=>{if(Ke||!ct)return oe(Ke);if(typeof ct!="object")return oe(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));{try{if(re.filter){const st=l.t(re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(st.result==="error")throw new Error(st.value.map(Ct=>`${Ct.key}: ${Ct.message}`).join(", "));ct.features=ct.features.filter(Ct=>st.value.evaluate({zoom:0},Ct))}if(re.dynamic){ct.type==="Feature"&&(ct={type:"FeatureCollection",features:[ct]}),re.append||this._featureMap.clear();for(const st of ct.features||[]){const Ct=st.id;Ct!==void 0&&(st.geometry?this._featureMap.set(Ct,st):this._featureMap.delete(Ct))}ct.features=[...this._featureMap.values()]}this._geoJSONIndex=re.cluster?new $t(function({superclusterOptions:st,clusterProperties:Ct}){if(!Ct||!st)return st;const qt={},Wt={},Nt={accumulated:null,zoom:0},jr={properties:null},Or=Object.keys(Ct);for(const ii of Or){const[mr,ni]=Ct[ii],Kr=l.t(ni),Ti=l.t(typeof mr=="string"?[mr,["accumulated"],["get",ii]]:mr);qt[ii]=Kr.value,Wt[ii]=Ti.value}return st.map=ii=>{jr.properties=ii;const mr={};for(const ni of Or)mr[ni]=qt[ni].evaluate(Nt,jr);return mr},st.reduce=(ii,mr)=>{jr.properties=mr;for(const ni of Or)Nt.accumulated=ii[ni],ii[ni]=Wt[ni].evaluate(Nt,jr)},st}(re)).load(ct.features):Ee(ct,re.geojsonVtOptions)}catch(st){return oe(st)}this.loaded={};const zt={};if(Be){const st=S(xe);st&&(zt.resourceTiming={},zt.resourceTiming[re.source]=JSON.parse(JSON.stringify(st)))}oe(null,zt)}})}reloadTile(re,oe){const xe=this.loaded;return xe&&xe[re.uid]?super.reloadTile(re,oe):this.loadTile(re,oe)}loadGeoJSON(re,oe){if(re.request)l.g(re.request,oe);else{if(typeof re.data!="string")return oe(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));try{return oe(null,JSON.parse(re.data))}catch{return oe(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(re,oe){try{oe(null,this._geoJSONIndex.getClusterExpansionZoom(re.clusterId))}catch(xe){oe(xe)}}getClusterChildren(re,oe){try{oe(null,this._geoJSONIndex.getChildren(re.clusterId))}catch(xe){oe(xe)}}getClusterLeaves(re,oe){try{oe(null,this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset))}catch(xe){oe(xe)}}}class nt{constructor(re,oe){this.tileID=new l.ap(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.tileZoom=re.tileZoom,this.uid=re.uid,this.zoom=re.zoom,this.canonical=re.tileID.canonical,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=re.projection,this.brightness=oe}parse(re,oe,xe,Be){this.status="parsing";const Ke=new l.ap(xe.tileID.overscaledZ,xe.tileID.wrap,xe.tileID.canonical.z,xe.tileID.canonical.x,xe.tileID.canonical.y),ct={},zt=oe.familiesBySource[xe.source],st=new l.dL(Ke,xe.promoteId);return st.bucketLayerIDs=[],st.is3DTile=!0,l.dY(re).then(Ct=>{if(!Ct)return Be(new Error("Could not parse tile"));const qt=l.dZ(Ct,1/l.bU(xe.tileID.canonical)),Wt=Ct.json.extensionsUsed&&Ct.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ct.json.asset.extras&&Ct.json.asset.extras.MAPBOX_mesh_features,Nt=Ct.json.extensionsUsed&&Ct.json.extensionsUsed.includes("EXT_meshopt_compression"),jr=new l.N(this.zoom,{brightness:this.brightness});for(const Or in zt)for(const ii of zt[Or]){const mr=ii[0];st.bucketLayerIDs.push(ii.map(Kr=>Kr.id)),mr.recalculate(jr,[]);const ni=new l.d_(qt,Ke,Wt,Nt,this.brightness,st);Wt||(ni.needsUpload=!0),ct[mr.fqid]=ni,ni.evaluate(mr)}this.status="done",Be(null,{buckets:ct,featureIndex:st})}).catch(Ct=>Be(new Error(Ct.message)))}}class Ot{constructor(re,oe,xe,Be,Ke,ct){this.actor=re,this.layerIndex=oe,this.brightness=ct,this.loading={},this.loaded={}}loadTile(re,oe){const xe=re.uid,Be=this.loading[xe]=new nt(re,this.brightness);l.b1(re.request,(Ke,ct)=>{const zt=!this.loading[xe];return delete this.loading[xe],zt||Ke?(Be.status="done",zt||(this.loaded[xe]=Be),oe(Ke)):ct&&ct.byteLength!==0?void Be.parse(ct,this.layerIndex,re,(st,Ct)=>{Be.status="done",this.loaded=this.loaded||{},this.loaded[xe]=Be,st||!Ct?oe(st):oe(null,Ct)}):(Be.status="done",this.loaded[xe]=Be,oe())})}reloadTile(re,oe){const xe=this.loaded,Be=re.uid;if(xe&&xe[Be]){const Ke=xe[Be];Ke.projection=re.projection,Ke.brightness=re.brightness;const ct=(zt,st)=>{Ke.reloadCallback&&(delete Ke.reloadCallback,this.loadTile(re,oe)),oe(zt,st)};Ke.status==="parsing"?Ke.reloadCallback=ct:Ke.status==="done"&&this.loadTile(re,oe)}}abortTile(re,oe){const xe=re.uid;this.loading[xe]&&delete this.loading[xe],oe()}removeTile(re,oe){const xe=this.loaded,Be=re.uid;xe&&xe[Be]&&delete xe[Be],oe()}}class Mt{constructor(re){this.self=re,this.actor=new l.d$(re,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=l.br({name:"mercator"}),this.workerSourceTypes={vector:Ce,geojson:ft,"batched-model":Ot},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(oe,xe)=>{if(this.workerSourceTypes[oe])throw new Error(`Worker source with name "${oe}" already registered.`);this.workerSourceTypes[oe]=xe},this.self.registerRTLTextPlugin=oe=>{if(l.e0.isParsed())throw new Error("RTL text plugin already registered.");l.e0.applyArabicShaping=oe.applyArabicShaping,l.e0.processBidirectionalText=oe.processBidirectionalText,l.e0.processStyledBidirectionalText=oe.processStyledBidirectionalText}}clearCaches(re,oe,xe){delete this.layerIndexes[re],delete this.availableImages[re],delete this.workerSources[re],delete this.demWorkerSources[re],delete this.rasterArrayWorkerSource,xe()}checkIfReady(re,oe,xe){xe()}setReferrer(re,oe){this.referrer=oe}spriteLoaded(re,{scope:oe,isLoaded:xe}){if(this.isSpriteLoaded[re]||(this.isSpriteLoaded[re]={}),this.isSpriteLoaded[re][oe]=xe,this.workerSources[re]&&this.workerSources[re][oe])for(const Be in this.workerSources[re][oe]){const Ke=this.workerSources[re][oe][Be];for(const ct in Ke)Ke[ct]instanceof Ce&&(Ke[ct].isSpriteLoaded=xe,Ke[ct].fire(new l.b("isSpriteLoaded")))}}setImages(re,{scope:oe,images:xe},Be){if(this.availableImages[re]||(this.availableImages[re]={}),this.availableImages[re][oe]=xe,this.workerSources[re]&&this.workerSources[re][oe]){for(const Ke in this.workerSources[re][oe]){const ct=this.workerSources[re][oe][Ke];for(const zt in ct)ct[zt].availableImages=xe}Be()}else Be()}setProjection(re,oe){this.projections[re]=l.br(oe)}setBrightness(re,oe,xe){this.brightness=oe,xe()}setLayers(re,oe,xe){this.getLayerIndex(re,oe.scope).replace(oe.layers,oe.options),xe()}updateLayers(re,oe,xe){this.getLayerIndex(re,oe.scope).update(oe.layers,oe.removedIds,oe.options),xe()}loadTile(re,oe,xe){oe.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,oe.type,oe.source,oe.scope).loadTile(oe,xe)}loadDEMTile(re,oe,xe){this.getDEMWorkerSource(re,oe.source,oe.scope).loadTile(oe,xe)}decodeRasterArray(re,oe,xe){this.getRasterArrayWorkerSource().decodeRasterArray(oe,xe)}reloadTile(re,oe,xe){oe.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,oe.type,oe.source,oe.scope).reloadTile(oe,xe)}abortTile(re,oe,xe){this.getWorkerSource(re,oe.type,oe.source,oe.scope).abortTile(oe,xe)}removeTile(re,oe,xe){this.getWorkerSource(re,oe.type,oe.source,oe.scope).removeTile(oe,xe)}removeSource(re,oe,xe){if(!(this.workerSources[re]&&this.workerSources[re][oe.scope]&&this.workerSources[re][oe.scope][oe.type]&&this.workerSources[re][oe.scope][oe.type][oe.source]))return;const Be=this.workerSources[re][oe.scope][oe.type][oe.source];delete this.workerSources[re][oe.scope][oe.type][oe.source],Be.removeSource!==void 0?Be.removeSource(oe,xe):xe()}loadWorkerSource(re,oe,xe){try{this.self.importScripts(oe.url),xe()}catch(Be){xe(Be.toString())}}syncRTLPluginState(re,oe,xe){try{l.e0.setState(oe);const Be=l.e0.getPluginURL();if(l.e0.isLoaded()&&!l.e0.isParsed()&&Be!=null){this.self.importScripts(Be);const Ke=l.e0.isParsed();xe(Ke?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Be}`),Ke)}}catch(Be){xe(Be.toString())}}setDracoUrl(re,oe){this.dracoUrl=oe}getAvailableImages(re,oe){this.availableImages[re]||(this.availableImages[re]={});let xe=this.availableImages[re][oe];return xe||(xe=[]),xe}getLayerIndex(re,oe){this.layerIndexes[re]||(this.layerIndexes[re]={});let xe=this.layerIndexes[re][oe];return xe||(xe=this.layerIndexes[re][oe]=new V,xe.scope=oe),xe}getWorkerSource(re,oe,xe,Be){if(this.workerSources[re]||(this.workerSources[re]={}),this.workerSources[re][Be]||(this.workerSources[re][Be]={}),this.workerSources[re][Be][oe]||(this.workerSources[re][Be][oe]={}),this.isSpriteLoaded[re]||(this.isSpriteLoaded[re]={}),!this.workerSources[re][Be][oe][xe]){const Ke={send:(ct,zt,st,Ct,qt,Wt)=>{this.actor.send(ct,zt,st,re,qt,Wt)},scheduler:this.actor.scheduler};this.workerSources[re][Be][oe][xe]=new this.workerSourceTypes[oe](Ke,this.getLayerIndex(re,Be),this.getAvailableImages(re,Be),this.isSpriteLoaded[re][Be],void 0,this.brightness)}return this.workerSources[re][Be][oe][xe]}getDEMWorkerSource(re,oe,xe){return this.demWorkerSources[re]||(this.demWorkerSources[re]={}),this.demWorkerSources[re][xe]||(this.demWorkerSources[re][xe]={}),this.demWorkerSources[re][xe][oe]||(this.demWorkerSources[re][xe][oe]=new Me),this.demWorkerSources[re][xe][oe]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Ie),this.rasterArrayWorkerSource}enforceCacheSizeLimit(re,oe){l.e1(oe)}getWorkerPerformanceMetrics(re,oe,xe){xe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Mt(self)),Mt}),_(["./shared"],function(l){function S(m,a){if(Array.isArray(m)){if(!Array.isArray(a)||m.length!==a.length)return!1;for(let h=0;h<m.length;h++)if(!S(m[h],a[h]))return!1;return!0}if(typeof m=="object"&&m!==null&&a!==null){if(typeof a!="object"||Object.keys(m).length!==Object.keys(a).length)return!1;for(const h in m)if(!S(m[h],a[h]))return!1;return!0}return m===a}var D=I;function I(m){return!function(a){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,w=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(w);try{v=new Worker(E),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(E),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var w=v.getImageData(0,0,1,1);return w&&w.width===g.width}()?(V[h=a&&a.failIfMajorPerformanceCaveat]===void 0&&(V[h]=function(g){var v,w=function(E){var C=document.createElement("canvas"),k=Object.create(I.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=E,C.getContext("webgl2",k)}(g);if(!w)return!1;try{v=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!v||w.isContextLost())&&(w.shaderSource(v,"void main() {}"),w.compileShader(v),w.getShaderParameter(v,w.COMPILE_STATUS)===!0)}(h)),V[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var h}(m)}var V={};function j(m,a,h){const g=document.createElement(m);return a!=null&&(g.className=a),h&&h.appendChild(g),g}function Q(m,a,h){const g=document.createElementNS("http://www.w3.org/2000/svg",m);for(const v of Object.keys(a))g.setAttributeNS(null,v,String(a[v]));return h&&h.appendChild(g),g}I.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const te=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ce=te&&te.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ce;function Me(){te&&ce&&(Ce=te[ce],te[ce]="none")}function Ie(){te&&ce&&(te[ce]=Ce)}function Te(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",Te,!0)}function Ge(){window.addEventListener("click",Te,!0),window.setTimeout(()=>{window.removeEventListener("click",Te,!0)},0)}function $e(m,a){const h=m.getBoundingClientRect();return _e(m,h,a)}function ue(m,a){const h=m.getBoundingClientRect(),g=[];for(let v=0;v<a.length;v++)g.push(_e(m,h,a[v]));return g}function pe(m){return window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function _e(m,a,h){const g=m.offsetWidth===a.width?1:m.offsetWidth/a.width;return new l.P((h.clientX-a.left)*g,(h.clientY-a.top)*g)}class ge{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(a,h){this._updatedSourceCaches[a]=h,this.setDirty()}discardSourceCacheUpdate(a){delete this._updatedSourceCaches[a]}updateLayer(a){const h=a.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(a.id),this.setDirty()}removeLayer(a){const h=a.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][a.id]=a,this._updatedLayers[h].delete(a.id),this._updatedPaintProps.delete(a.fqid),this.setDirty()}getRemovedLayer(a){return this._removedLayers[a.scope]?this._removedLayers[a.scope][a.id]:null}discardLayerRemoval(a){this._removedLayers[a.scope]&&delete this._removedLayers[a.scope][a.id]}getLayerUpdatesByScope(){const a={};for(const h in this._updatedLayers)a[h]=a[h]||{},a[h].updatedIds=Array.from(this._updatedLayers[h].values());for(const h in this._removedLayers)a[h]=a[h]||{},a[h].removedIds=Object.keys(this._removedLayers[h]);return a}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(a){this._updatedPaintProps.add(a.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(a){this._updatedImages.add(a),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class Fe extends l.E{constructor(a){super(),this.requestManager=a,this.models={"":{}},this.numModelsLoading={}}loadModel(a,h){return l.l(this.requestManager.transformRequest(h,l.R.Model).url).then(g=>{if(!g)return;const v=l.c(g),w=new l.M(a,void 0,void 0,v);return w.computeBoundsAndApplyParent(),w}).catch(g=>{if(g&&g.status===404)return null;this.fire(new l.a(new Error(`Could not load model ${a} from ${h}: ${g.message}`)))})}load(a,h){this.models[h]||(this.models[h]={});const g=Object.keys(a);this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+g.length;const v=[];for(const w of g)v.push(this.loadModel(w,a[w]));Promise.allSettled(v).then(w=>{for(let E=0;E<w.length;E++){const{status:C,value:k}=w[E];C==="fulfilled"&&k&&(this.models[h][g[E]]={model:k,numReferences:1})}this.numModelsLoading[h]-=g.length,this.fire(new l.b("data",{dataType:"style"}))}).catch(w=>{this.fire(new l.a(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const a in this.numModelsLoading)if(this.numModelsLoading[a]>0)return!1;return!0}hasModel(a,h){return!!this.getModel(a,h)}getModel(a,h){return this.models[h]||(this.models[h]={}),this.models[h][a]?this.models[h][a].model:void 0}addModel(a,h,g){this.models[g]||(this.models[g]={}),this.hasModel(a,g)&&this.models[g][a].numReferences++,this.load({[a]:this.requestManager.normalizeModelURL(h)},g)}addModels(a,h){this.models[h]||(this.models[h]={});const g={};for(const v in a)this.models[h][v]={},g[v]=this.requestManager.normalizeModelURL(a[v]);this.load(g,h)}addModelsFromBucket(a,h){this.models[h]||(this.models[h]={});const g={};for(const v of a)this.hasModel(v,h)?this.models[h][v].numReferences++:g[v]=this.requestManager.normalizeModelURL(v);this.load(g,h)}removeModel(a,h){if(this.models[h]&&this.models[h][a]&&(this.models[h][a].numReferences--,this.models[h][a].numReferences===0)){const g=this.models[h][a].model;delete this.models[h][a],g.destroy()}}listModels(a){return this.models[a]||(this.models[a]={}),Object.keys(this.models[a])}upload(a,h){this.models[h]||(this.models[h]={});for(const g in this.models[h])this.models[h][g].model&&this.models[h][g].model.upload(a.context)}}class De{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,h,g){const v=String(h);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][v]=this.stateChanges[a][v]||{},l.e(this.stateChanges[a][v],g),this.deletedStates[a]===null){this.deletedStates[a]={};for(const w in this.state[a])w!==v&&(this.deletedStates[a][w]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][v]===null){this.deletedStates[a][v]={};for(const w in this.state[a][v])g[w]||(this.deletedStates[a][v][w]=null)}else for(const w in g)this.deletedStates[a]&&this.deletedStates[a][v]&&this.deletedStates[a][v][w]===null&&delete this.deletedStates[a][v][w]}removeFeatureState(a,h,g){if(this.deletedStates[a]===null)return;const v=String(h);if(this.deletedStates[a]=this.deletedStates[a]||{},g&&h!==void 0)this.deletedStates[a][v]!==null&&(this.deletedStates[a][v]=this.deletedStates[a][v]||{},this.deletedStates[a][v][g]=null);else if(h!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][v])for(g in this.deletedStates[a][v]={},this.stateChanges[a][v])this.deletedStates[a][v][g]=null;else this.deletedStates[a][v]=null;else this.deletedStates[a]=null}getState(a,h){const g=String(h),v=l.e({},(this.state[a]||{})[g],(this.stateChanges[a]||{})[g]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){const w=this.deletedStates[a][h];if(w===null)return{};for(const E in w)delete v[E]}return v}initializeTileState(a,h){a.setFeatureState(this.state,h)}coalesceChanges(a,h){const g={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const w={};for(const E in this.stateChanges[v])this.state[v][E]||(this.state[v][E]={}),l.e(this.state[v][E],this.stateChanges[v][E]),w[E]=this.state[v][E];g[v]=w}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const w={};if(this.deletedStates[v]===null)for(const E in this.state[v])w[E]={},this.state[v][E]={};else for(const E in this.deletedStates[v]){if(this.deletedStates[v][E]===null)this.state[v][E]={};else if(this.state[v][E])for(const C of Object.keys(this.deletedStates[v][E]))delete this.state[v][E][C];w[E]=this.state[v][E]}g[v]=g[v]||{},l.e(g[v],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const v in a)a[v].setFeatureState(g,h)}}function Se(m){const{userImage:a}=m;return!!(a&&a.render&&a.render())&&(m.data.replace(new Uint8Array(a.data.buffer)),!0)}class pr extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(a){this.images[a]={},this.loaded[a]=!1,this.updatedImages[a]={},this.patterns[a]={},this.callbackDispatchedThisFrame[a]={},this.atlasImage[a]=new l.h({width:1,height:1})}isLoaded(){for(const a in this.loaded)if(!this.loaded[a])return!1;return!0}setLoaded(a,h){if(this.loaded[h]!==a&&(this.loaded[h]=a,a)){for(const{ids:g,callback:v}of this.requestors)this._notify(g,h,v);this.requestors=[]}}hasImage(a,h){return!!this.getImage(a,h)}getImage(a,h){return this.images[h][a]}addImage(a,h,g){this._validate(a,g)&&(this.images[h][a]=g)}_validate(a,h){let g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new l.a(new Error(`Image "${a}" has invalid "stretchX" value`))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new l.a(new Error(`Image "${a}" has invalid "stretchY" value`))),g=!1),this._validateContent(h.content,h)||(this.fire(new l.a(new Error(`Image "${a}" has invalid "content" value`))),g=!1),g}_validateStretch(a,h){if(!a)return!0;let g=0;for(const v of a){if(v[0]<g||v[1]<v[0]||h<v[1])return!1;g=v[1]}return!0}_validateContent(a,h){return!(a&&(a.length!==4||a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,h,g){g.version=this.images[h][a].version+1,this.images[h][a]=g,this.updatedImages[h][a]=!0}removeImage(a,h){const g=this.images[h][a];delete this.images[h][a],delete this.patterns[h][a],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(a){return Object.keys(this.images[a])}getImages(a,h,g){let v=!0;const w=!!this.loaded[h];if(!w)for(const E of a)this.images[h][E]||(v=!1);w||v?this._notify(a,h,g):this.requestors.push({ids:a,scope:h,callback:g})}getUpdatedImages(a){return this.updatedImages[a]}_notify(a,h,g){const v={};for(const w of a){this.images[h][w]||this.fire(new l.b("styleimagemissing",{id:w}));const E=this.images[h][w];E?v[w]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)}:l.w(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,v)}getPixelSize(a){const{width:h,height:g}=this.atlasImage[a];return{width:h,height:g}}getPattern(a,h){const g=this.patterns[h][a],v=this.getImage(a,h);if(!v)return null;if(g&&g.position.version===v.version)return g.position;if(g)g.position.version=v.version;else{const w={w:v.data.width+2,h:v.data.height+2,x:0,y:0},E=new l.I(w,v);this.patterns[h][a]={bin:w,position:E}}return this._updatePatternAtlas(h),this.patterns[h][a].position}bind(a,h){const g=a.gl;let v=this.atlasTexture[h];v?this.dirty&&(v.update(this.atlasImage[h]),this.dirty=!1):(v=new l.T(a,this.atlasImage[h],g.RGBA),this.atlasTexture[h]=v),v.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(a){const h=[];for(const E in this.patterns[a])h.push(this.patterns[a][E].bin);const{w:g,h:v}=l.p(h),w=this.atlasImage[a];w.resize({width:g||1,height:v||1});for(const E in this.patterns[a]){const{bin:C}=this.patterns[a][E],k=C.x+1,O=C.y+1,F=this.images[a][E].data,B=F.width,$=F.height;l.h.copy(F,w,{x:0,y:0},{x:k,y:O},{width:B,height:$}),l.h.copy(F,w,{x:0,y:$-1},{x:k,y:O-1},{width:B,height:1}),l.h.copy(F,w,{x:0,y:0},{x:k,y:O+$},{width:B,height:1}),l.h.copy(F,w,{x:B-1,y:0},{x:k-1,y:O},{width:1,height:$}),l.h.copy(F,w,{x:0,y:0},{x:k+B,y:O},{width:1,height:$})}this.dirty=!0}beginFrame(){for(const a in this.images)this.callbackDispatchedThisFrame[a]={}}dispatchRenderCallbacks(a,h){for(const g of a){if(this.callbackDispatchedThisFrame[h][g])continue;this.callbackDispatchedThisFrame[h][g]=!0;const v=this.images[h][g];Se(v)&&this.updateImage(g,h,v)}}}function or(m){const a=m.key,h=m.value,g=m.valueSpec||{},v=m.objectElementValidators||{},w=m.style,E=m.styleSpec;let C=[];const k=l.j(h);if(k!=="object")return[new l.V(a,h,`object expected, ${k} found`)];for(const O in h){const F=O.split(".")[0];let B;v[F]?B=v[F]:g[F]?B=Ee:v["*"]?B=v["*"]:g["*"]&&(B=Ee),B?C=C.concat(B({key:(a&&`${a}.`)+O,value:h[O],valueSpec:g[F]||g["*"],style:w,styleSpec:E,object:h,objectKey:O},h)):C.push(new l.i(a,h[O],`unknown property "${O}"`))}for(const O in g)v[O]||g[O].required&&g[O].default===void 0&&h[O]===void 0&&C.push(new l.V(a,h,`missing required property "${O}"`));return C}function Vt(m){const a=m.value,h=m.valueSpec,g=m.style,v=m.styleSpec,w=m.key,E=m.arrayElementValidator||Ee;if(l.j(a)!=="array")return[new l.V(w,a,`array expected, ${l.j(a)} found`)];if(h.length&&a.length!==h.length)return[new l.V(w,a,`array length ${h.length} expected, length ${a.length} found`)];if(h["min-length"]&&a.length<h["min-length"])return[new l.V(w,a,`array length at least ${h["min-length"]} expected, length ${a.length} found`)];let C={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};v.$version<7&&(C.function=h.function),l.j(h.value)==="object"&&(C=h.value);let k=[];for(let O=0;O<a.length;O++)k=k.concat(E({array:a,arrayIndex:O,value:a[O],valueSpec:C,style:g,styleSpec:v,key:`${w}[${O}]`},!0));return k}function Ht(m){const a=m.key,h=m.value,g=m.valueSpec;let v=l.j(h);if(v==="number"&&h!=h&&(v="NaN"),v!=="number")return[new l.V(a,h,`number expected, ${v} found`)];if("minimum"in g){let w=g.minimum;if(l.j(g.minimum)==="array"&&(w=g.minimum[m.arrayIndex]),h<w)return[new l.V(a,h,`${h} is less than the minimum value ${w}`)]}if("maximum"in g){let w=g.maximum;if(l.j(g.maximum)==="array"&&(w=g.maximum[m.arrayIndex]),h>w)return[new l.V(a,h,`${h} is greater than the maximum value ${w}`)]}return[]}function Kt(m){const a=m.valueSpec,h=l.u(m.value.type);let g,v,w,E={};const C=h!=="categorical"&&m.value.property===void 0,k=!C,O=l.j(m.value.stops)==="array"&&l.j(m.value.stops[0])==="array"&&l.j(m.value.stops[0][0])==="object",F=or({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(G){if(h==="identity")return[new l.V(G.key,G.value,'identity function may not have a "stops" property')];let X=[];const Z=G.value;return X=X.concat(Vt({key:G.key,value:Z,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:B})),l.j(Z)==="array"&&Z.length===0&&X.push(new l.V(G.key,Z,"array must have at least one stop")),X},default:function(G){return Ee({key:G.key,value:G.value,valueSpec:a,style:G.style,styleSpec:G.styleSpec})}}});return h==="identity"&&C&&F.push(new l.V(m.key,m.value,'missing required property "property"')),h==="identity"||m.value.stops||F.push(new l.V(m.key,m.value,'missing required property "stops"')),h==="exponential"&&m.valueSpec.expression&&!l.s(m.valueSpec)&&F.push(new l.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(k&&!l.m(m.valueSpec)?F.push(new l.V(m.key,m.value,"property functions not supported")):C&&!l.n(m.valueSpec)&&F.push(new l.V(m.key,m.value,"zoom functions not supported"))),h!=="categorical"&&!O||m.value.property!==void 0||F.push(new l.V(m.key,m.value,'"property" property is required')),F;function B(G){let X=[];const Z=G.value,Y=G.key;if(l.j(Z)!=="array")return[new l.V(Y,Z,`array expected, ${l.j(Z)} found`)];if(Z.length!==2)return[new l.V(Y,Z,`array length 2 expected, length ${Z.length} found`)];if(O){if(l.j(Z[0])!=="object")return[new l.V(Y,Z,`object expected, ${l.j(Z[0])} found`)];if(Z[0].zoom===void 0)return[new l.V(Y,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new l.V(Y,Z,"object stop key must have value")];const K=l.u(Z[0].zoom);if(typeof K!="number")return[new l.V(Y,Z[0].zoom,"stop zoom values must be numbers")];if(w&&w>K)return[new l.V(Y,Z[0].zoom,"stop zoom values must appear in ascending order")];K!==w&&(w=K,v=void 0,E={}),X=X.concat(or({key:`${Y}[0]`,value:Z[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:Ht,value:$}}))}else X=X.concat($({key:`${Y}[0]`,value:Z[0],valueSpec:{},style:G.style,styleSpec:G.styleSpec},Z));return l.o(l.q(Z[1]))?X.concat([new l.V(`${Y}[1]`,Z[1],"expressions are not allowed in function stops.")]):X.concat(Ee({key:`${Y}[1]`,value:Z[1],valueSpec:a,style:G.style,styleSpec:G.styleSpec}))}function $(G,X){const Z=l.j(G.value),Y=l.u(G.value),K=G.value!==null?G.value:X;if(g){if(Z!==g)return[new l.V(G.key,K,`${Z} stop domain type must match previous stop domain type ${g}`)]}else g=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean"&&typeof Y!="number"&&typeof Y!="string"&&typeof Y!="boolean")return[new l.V(G.key,K,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&h!=="categorical"){let ne=`number expected, ${Z} found`;return l.m(a)&&h===void 0&&(ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new l.V(G.key,K,ne)]}return h!=="categorical"||Z!=="number"||typeof Y=="number"&&isFinite(Y)&&Math.floor(Y)===Y?h!=="categorical"&&Z==="number"&&typeof Y=="number"&&typeof v=="number"&&v!==void 0&&Y<v?[new l.V(G.key,K,"stop domain values must appear in ascending order")]:(v=Y,h==="categorical"&&Y in E?[new l.V(G.key,K,"stop domain values must be unique")]:(E[Y]=!0,[])):[new l.V(G.key,K,`integer expected, found ${String(Y)}`)]}}function Tr(m){const a=(m.expressionContext==="property"?l.r:l.t)(l.q(m.value),m.valueSpec);if(a.result==="error")return a.value.map(g=>new l.V(`${m.key}${g.key}`,m.value,g.message));const h=a.value.expression||a.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!h.outputDefined())return[new l.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!l.v(h))return[new l.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return We(h,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!l.x(h,["zoom","feature-state"]))return[new l.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!l.y(h))return[new l.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function We(m,a){const h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(a.valueSpec&&a.valueSpec.expression)for(const v of a.valueSpec.expression.parameters)h.delete(v);if(h.size===0)return[];const g=[];return m instanceof l.C&&h.has(m.name)?[new l.V(a.key,a.value,`["${m.name}"] expression is not supported in a filter for a ${a.object.type} layer with id: ${a.object.id}`)]:(m.eachChild(v=>{g.push(...We(v,a))}),g)}function Sr(m){const a=m.key,h=m.value,g=m.valueSpec,v=[];return Array.isArray(g.values)?g.values.indexOf(l.u(h))===-1&&v.push(new l.V(a,h,`expected one of [${g.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(g.values).indexOf(l.u(h))===-1&&v.push(new l.V(a,h,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(h)} found`)),v}function Xt(m){return l.A(l.q(m.value))?Tr(l.k({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):ei(m)}function ei(m){const a=m.value,h=m.key;if(l.j(a)!=="array")return[new l.V(h,a,`array expected, ${l.j(a)} found`)];const g=m.styleSpec;let v,w=[];if(a.length<1)return[new l.V(h,a,"filter array must have at least 1 element")];switch(w=w.concat(Sr({key:`${h}[0]`,value:a[0],valueSpec:g.filter_operator,style:m.style,styleSpec:m.styleSpec})),l.u(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&l.u(a[1])==="$type"&&w.push(new l.V(h,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&w.push(new l.V(h,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(v=l.j(a[1]),v!=="string"&&w.push(new l.V(`${h}[1]`,a[1],`string expected, ${v} found`)));for(let E=2;E<a.length;E++)v=l.j(a[E]),l.u(a[1])==="$type"?w=w.concat(Sr({key:`${h}[${E}]`,value:a[E],valueSpec:g.geometry_type,style:m.style,styleSpec:m.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&w.push(new l.V(`${h}[${E}]`,a[E],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let E=1;E<a.length;E++)w=w.concat(ei({key:`${h}[${E}]`,value:a[E],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":v=l.j(a[1]),a.length!==2?w.push(new l.V(h,a,`filter array for "${a[0]}" operator must have 2 elements`)):v!=="string"&&w.push(new l.V(`${h}[1]`,a[1],`string expected, ${v} found`))}return w}function Fr(m,a){const h=m.key,g=m.style,v=m.layer,w=m.styleSpec,E=m.value,C=m.objectKey,k=w[`${a}_${m.layerType}`];if(!k)return[];const O=C.match(/^(.*)-transition$/);if(a==="paint"&&O&&k[O[1]]&&k[O[1]].transition)return Ee({key:h,value:E,valueSpec:w.transition,style:g,styleSpec:w});const F=m.valueSpec||k[C];if(!F)return[new l.i(h,E,`unknown property "${C}"`)];let B;if(l.j(E)==="string"&&l.m(F)&&!F.tokens&&(B=/^{([^}]+)}$/.exec(E))){const G=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new l.V(h,E,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${G}.`)]}const $=[];if(m.layerType==="symbol")C!=="text-field"||!g||g.glyphs||g.imports||$.push(new l.V(h,E,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&l.B(l.q(E))&&l.u(E.type)==="identity"&&$.push(new l.V(h,E,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&a==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&l.m(F)&&(l.D(F)||l.n(F))){const G=l.r(l.q(E),F),X=G.value.expression||G.value._styleExpression.expression;X&&!l.x(X,["measure-light"])&&(C==="model-emissive-strength"&&l.y(X)&&l.v(X)||$.push(new l.V(h,E,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return $.concat(Ee({key:m.key,value:E,valueSpec:F,style:g,styleSpec:w,expressionContext:"property",propertyType:a,propertyKey:C}))}function gi(m){return Fr(m,"paint")}function qr(m){return Fr(m,"layout")}function yt(m){let a=[];const h=m.value,g=m.key,v=m.style,w=m.styleSpec;h.type||h.ref||a.push(new l.V(g,h,'either "type" or "ref" is required'));let E=l.u(h.type);const C=l.u(h.ref);if(h.id){const k=l.u(h.id);for(let O=0;O<m.arrayIndex;O++){const F=v.layers[O];l.u(F.id)===k&&a.push(new l.V(g,h.id,`duplicate layer id "${h.id}", previously used at line ${F.id.__line__}`))}}if("ref"in h){let k;["type","source","source-layer","filter","layout"].forEach(O=>{O in h&&a.push(new l.V(g,h[O],`"${O}" is prohibited for ref layers`))}),v.layers.forEach(O=>{l.u(O.id)===C&&(k=O)}),k?k.ref?a.push(new l.V(g,h.ref,"ref cannot reference another ref layer")):E=l.u(k.type):typeof C=="string"&&a.push(new l.V(g,h.ref,`ref layer "${C}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(h.source){const k=v.sources&&v.sources[h.source],O=k&&l.u(k.type);k?O==="vector"&&E==="raster"?a.push(new l.V(g,h.source,`layer "${h.id}" requires a raster source`)):O==="raster"&&E!=="raster"?a.push(new l.V(g,h.source,`layer "${h.id}" requires a vector source`)):O!=="vector"||h["source-layer"]?O==="raster-dem"&&E!=="hillshade"?a.push(new l.V(g,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="raster-array"||["raster","raster-particle"].includes(E)?E!=="line"||!h.paint||!h.paint["line-gradient"]&&!h.paint["line-trim-offset"]||O==="geojson"&&k.lineMetrics?E==="raster-particle"&&O!=="raster-array"&&a.push(new l.V(g,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):a.push(new l.V(g,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new l.V(g,h.source,"raster-array source can only be used with layer type 'raster'.")):a.push(new l.V(g,h,`layer "${h.id}" must specify a "source-layer"`)):a.push(new l.V(g,h.source,`source "${h.source}" not found`))}else a.push(new l.V(g,h,'missing required property "source"'));return a=a.concat(or({key:g,value:h,valueSpec:w.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ee({key:`${g}.type`,value:h.type,valueSpec:w.layer.type,style:m.style,styleSpec:m.styleSpec,object:h,objectKey:"type"}),filter:k=>Xt(l.k({layerType:E},k)),layout:k=>or({layer:h,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":O=>qr(l.k({layerType:E},O))}}),paint:k=>or({layer:h,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":O=>gi(l.k({layerType:E,layer:h},O))}})}})),a}function dt(m){const a=m.value,h=m.key,g=l.j(a);return g!=="string"?[new l.V(h,a,`string expected, ${g} found`)]:[]}const jt={promoteId:function({key:m,value:a}){if(l.j(a)==="string")return dt({key:m,value:a});{const h=[];for(const g in a)h.push(...dt({key:`${m}.${g}`,value:a[g]}));return h}}};function $t(m){const a=m.value,h=m.key,g=m.styleSpec,v=m.style;if(!a.type)return[new l.V(h,a,'"type" is required')];const w=l.u(a.type);let E=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&(a.url||a.tiles||E.push(new l.i(h,a,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(or({key:h,value:a,valueSpec:g[`source_${w.replace("-","_")}`],style:m.style,styleSpec:g,objectElementValidators:jt})),E;case"geojson":if(E=or({key:h,value:a,valueSpec:g.source_geojson,style:v,styleSpec:g,objectElementValidators:jt}),a.cluster)for(const C in a.clusterProperties){const[k,O]=a.clusterProperties[C],F=typeof k=="string"?[k,["accumulated"],["get",C]]:k;E.push(...Tr({key:`${h}.${C}.map`,value:O,expressionContext:"cluster-map"})),E.push(...Tr({key:`${h}.${C}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return E;case"video":return or({key:h,value:a,valueSpec:g.source_video,style:v,styleSpec:g});case"image":return or({key:h,value:a,valueSpec:g.source_image,style:v,styleSpec:g});case"canvas":return[new l.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Sr({key:`${h}.type`,value:a.type,valueSpec:{values:Mr(g)},style:v,styleSpec:g})}}function Mr(m){return m.source.reduce((a,h)=>{const g=m[h];return g.type.type==="enum"&&(a=a.concat(Object.keys(g.type.values))),a},[])}function Er(m){const a=m.value,h=m.styleSpec,g=h.light,v=m.style;let w=[];const E=l.j(a);if(a===void 0)return w;if(E!=="object")return w=w.concat([new l.V("light",a,`object expected, ${E} found`)]),w;for(const C in a){const k=C.match(/^(.*)-transition$/);w=w.concat(k&&g[k[1]]&&g[k[1]].transition?Ee({key:C,value:a[C],valueSpec:h.transition,style:v,styleSpec:h}):g[C]?Ee({key:C,value:a[C],valueSpec:g[C],style:v,styleSpec:h}):[new l.V(C,a[C],`unknown property "${C}"`)])}return w}function be(m){const a=m.value;let h=[];if(!a)return h;const g=l.j(a);if(g!=="object")return h=h.concat([new l.V("light-3d",a,`object expected, ${g} found`)]),h;const v=m.styleSpec,w=v["light-3d"],E=m.key,C=m.style,k=m.style.lights;for(const B of["type","id"])if(!(B in a))return h=h.concat([new l.V("light-3d",a,`missing property ${B} on light`)]),h;if(a.type&&k)for(let B=0;B<m.arrayIndex;B++){const $=l.u(a.type),G=k[B];l.u(G.type)===$&&h.push(new l.V(E,a.id,`duplicate light type "${a.type}", previously defined at line ${G.id.__line__}`))}const O=`properties_light_${a.type}`;if(!(O in v))return h=h.concat([new l.V("light-3d",a,`Invalid light type ${a.type}`)]),h;const F=v[O];for(const B in a)if(B==="properties"){const $=a[B],G=l.j($);if(G!=="object")return h=h.concat([new l.V("properties",$,`object expected, ${G} found`)]),h;for(const X in $)h=h.concat(F[X]?Ee({key:X,value:$[X],valueSpec:F[X],style:C,styleSpec:v}):[new l.i(m.key,$[X],`unknown property "${X}"`)])}else{const $=B.match(/^(.*)-transition$/);h=h.concat($&&w[$[1]]&&w[$[1]].transition?Ee({key:B,value:a[B],valueSpec:v.transition,style:C,styleSpec:v}):w[B]?Ee({key:B,value:a[B],valueSpec:w[B],style:C,styleSpec:v}):[new l.i(B,a[B],`unknown property "${B}"`)])}return h}function Ae(m){const a=m.value,h=m.key,g=m.style,v=m.styleSpec,w=v.terrain;let E=[];const C=l.j(a);if(a===void 0||C==="null")return E;if(C!=="object")return E=E.concat([new l.V("terrain",a,`object expected, ${C} found`)]),E;for(const k in a){const O=k.match(/^(.*)-transition$/);E=E.concat(O&&w[O[1]]&&w[O[1]].transition?Ee({key:k,value:a[k],valueSpec:v.transition,style:g,styleSpec:v}):w[k]?Ee({key:k,value:a[k],valueSpec:w[k],style:g,styleSpec:v}):[new l.i(k,a[k],`unknown property "${k}"`)])}if(a.source){const k=g.sources&&g.sources[a.source],O=k&&l.u(k.type);k?O!=="raster-dem"&&E.push(new l.V(h,a.source,`terrain cannot be used with a source of type ${String(O)}, it only be used with a "raster-dem" source type`)):E.push(new l.V(h,a.source,`source "${a.source}" not found`))}else E.push(new l.V(h,a,'terrain is missing required property "source"'));return E}function Ze(m){const a=m.value,h=m.style,g=m.styleSpec,v=g.fog;let w=[];const E=l.j(a);if(a===void 0)return w;if(E!=="object")return w=w.concat([new l.V("fog",a,`object expected, ${E} found`)]),w;for(const C in a){const k=C.match(/^(.*)-transition$/);w=w.concat(k&&v[k[1]]&&v[k[1]].transition?Ee({key:C,value:a[C],valueSpec:g.transition,style:h,styleSpec:g}):v[C]?Ee({key:C,value:a[C],valueSpec:v[C],style:h,styleSpec:g}):[new l.i(C,a[C],`unknown property "${C}"`)])}return w}const lt={"*":()=>[],array:Vt,boolean:function(m){const a=m.value,h=m.key,g=l.j(a);return g!=="boolean"?[new l.V(h,a,`boolean expected, ${g} found`)]:[]},number:Ht,color:function(m){const a=m.key,h=m.value,g=l.j(h);return g!=="string"?[new l.V(a,h,`color expected, ${g} found`)]:l.z(h)===null?[new l.V(a,h,`color expected, "${h}" found`)]:[]},enum:Sr,filter:Xt,function:Kt,layer:yt,object:or,source:$t,model:l.F,light:Er,"light-3d":be,terrain:Ae,fog:Ze,string:dt,formatted:function(m){return dt(m).length===0?[]:Tr(m)},resolvedImage:function(m){return dt(m).length===0?[]:Tr(m)},projection:function(m){const a=m.value,h=m.styleSpec,g=h.projection,v=m.style;let w=[];const E=l.j(a);if(E==="object")for(const C in a)w=w.concat(Ee({key:C,value:a[C],valueSpec:g[C],style:v,styleSpec:h}));else E!=="string"&&(w=w.concat([new l.V("projection",a,`object or string expected, ${E} found`)]));return w},import:function(m){const{value:a,styleSpec:h}=m,{data:g,...v}=a;Object.defineProperty(v,"__line__",{value:a.__line__,enumerable:!1});let w=or(l.k({},m,{value:v,valueSpec:h.import}));return l.u(v.id)===""&&w.push(new l.V(`${m.key}.id`,v,"import id can't be an empty string")),g&&(w=w.concat(ft(g,h,{key:`${m.key}.data`}))),w}};function Ee(m,a=!1){const h=m.value,g=m.valueSpec,v=m.styleSpec;if(g.expression&&l.B(l.u(h)))return Kt(m);if(g.expression&&l.o(l.q(h)))return Tr(m);if(g.type&&lt[g.type]){const w=lt[g.type](m);return a===!0&&w.length>0&&l.j(m.value)==="array"?Tr(m):w}return or(l.k({},m,{valueSpec:g.type?v[g.type]:g}))}function Ft(m){const a=m.value,h=m.key,g=dt(m);return g.length||(a.indexOf("{fontstack}")===-1&&g.push(new l.V(h,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&g.push(new l.V(h,a,'"glyphs" url must include a "{range}" token'))),g}function ft(m,a=l.G,h={}){return Ee({key:h.key||"",value:m,valueSpec:a.$root,styleSpec:a,style:m,objectElementValidators:{glyphs:Ft,"*":()=>[]}})}function nt(m,a=l.G){return st(ft(m,a))}const Ot=m=>st($t(m)),Mt=m=>st(Er(m)),je=m=>st(be(m)),re=m=>st(Ae(m)),oe=m=>st(Ze(m)),xe=m=>st(yt(m)),Be=m=>st(Xt(m)),Ke=m=>st(gi(m)),ct=m=>st(qr(m)),zt=m=>st(l.F(m));function st(m){return m.slice().sort((a,h)=>a.line&&h.line?a.line-h.line:0)}function Ct(m,a){let h=!1;if(a&&a.length)for(const g of a)g instanceof l.i?l.w(g.message):(m.fire(new l.a(new Error(g.message))),h=!0);return h}const qt=new l.H({anchor:new l.J(l.G.light.anchor),position:new l.K(l.G.light.position),color:new l.J(l.G.light.color),intensity:new l.J(l.G.light.intensity)});class Wt extends l.E{constructor(a,h="flat"){super(),this._transitionable=new l.L(qt),this.setLight(a,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,h,g={}){this._validate(Mt,a,g)||(this._transitionable.setTransitionOrValue(a),this.id=h)}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,g){return(!g||g.validate!==!1)&&Ct(this,a.call(nt,l.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.G})))}}const Nt=new l.H({source:new l.J(l.G.terrain.source),exaggeration:new l.J(l.G.terrain.exaggeration)});let jr=class extends l.E{constructor(m,a,h,g){super(),this.scope=h,this._transitionable=new l.L(Nt,h,g),this._transitionable.setTransitionOrValue(m,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(m,a){this._transitionable.setTransitionOrValue(m,a)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new l.N(m)).get("exaggeration")}isZoomDependent(){const m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof l.Z}};const Or=45,ii=65,mr=.05;function ni(m,a,h,g){const v=l.S(Or,ii,h),[w,E]=Kr(m,g);let C=1-Math.min(1,Math.exp((a-w)/(E-w)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*v*m.alpha}function Kr(m,a){const h=.5/Math.tan(.5*a);return[m.range[0]+h,m.range[1]+h]}function Ti(m,a,h,g,v){const w=l.Q.transformMat4([],[a,h,g],v.mercatorFogMatrix);return ni(m,l.Q.length(w),v.pitch,v._fov)}function Zi(m,a,h,g,v,w,E){const C=[[h,g,0],[v,g,0],[v,w,0],[h,w,0]];let k=Number.MAX_VALUE,O=-Number.MAX_VALUE;for(const F of C){const B=l.Q.transformMat4([],F,a),$=l.Q.length(B);k=Math.min(k,$),O=Math.max(O,$)}return[ni(m,k,E.pitch,E._fov),ni(m,O,E.pitch,E._fov)]}const mi=new l.H({range:new l.J(l.G.fog.range),color:new l.J(l.G.fog.color),"high-color":new l.J(l.G.fog["high-color"]),"space-color":new l.J(l.G.fog["space-color"]),"horizon-blend":new l.J(l.G.fog["horizon-blend"]),"star-intensity":new l.J(l.G.fog["star-intensity"]),"vertical-range":new l.J(l.G.fog["vertical-range"])});class Ln extends l.E{constructor(a,h,g,v){super(),this._transitionable=new l.L(mi,g,new Map(v)),this.set(a,v),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new l.U(mi)}get state(){const a=this._transform,h=a.projection.name==="globe",g=l.W(a.zoom),v=this.properties.get("range"),w=[.5,3];return{range:h?[l.X(w[0],v[0],g),l.X(w[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,h,g={}){if(this._validate(oe,a,g))return;const v=l.e({},a);for(const w of Object.keys(l.G.fog))v[w]===void 0&&(v[w]=l.G.fog[w].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:l.S(Or,ii,a))*h.a}getOpacityAtLatLng(a,h){return this._transform.projection.supportsFog?function(g,v,w){const E=l.O.fromLngLat(v),C=w.elevation?w.elevation.getAtPointOrZero(E):0;return Ti(g,E.x,E.y,C,w)}(this.state,a,h):0}getOpacityForTile(a){if(!this._transform.projection.supportsFog)return[1,1];const h=this._transform.calculateFogTileMatrix(a.toUnwrapped());return Zi(this.state,h,0,0,l.Y,l.Y,this._transform)}getOpacityForBounds(a,h,g,v,w){return this._transform.projection.supportsFog?Zi(this.state,a,h,g,v,w,this._transform):[1,1]}getFovAdjustedRange(a){return this._transform.projection.supportsFog?Kr(this.state,a):[0,1]}isVisibleOnFrustum(a){if(!this._transform.projection.supportsFog)return!1;const h=[4,5,6,7];for(const g of h){const v=a.points[g];let w;if(v[2]>=0)w=v;else{const E=a.points[g-4];w=l._(E,v,E[2]/(E[2]-v[2]))}if(Ti(this.state,w[0],w[1],0,this._transform)>=mr)return!0}return!1}updateConfig(a){this._transitionable.setTransitionOrValue(this._options,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,g){return(!g||g.validate!==!1)&&Ct(this,a.call(nt,l.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.G})))}}class fn extends l.E{constructor(a,h,g,v){super(),this.scope=g,this._options=a,this.properties=new l.U(h),this._transitionable=new l.L(h,g,new Map(v)),this._transitionable.setTransitionOrValue(a.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(a){this._transitionable.setTransitionOrValue(this._options.properties,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(a,h){this._options=a,this._transitionable.setTransitionOrValue(a.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const hs=new l.H({color:new l.J(l.G.properties_light_ambient.color),intensity:new l.J(l.G.properties_light_ambient.intensity)}),wr=new l.H({direction:new l.$(l.G.properties_light_directional.direction),color:new l.J(l.G.properties_light_directional.color),intensity:new l.J(l.G.properties_light_directional.intensity),"cast-shadows":new l.J(l.G.properties_light_directional["cast-shadows"]),"shadow-intensity":new l.J(l.G.properties_light_directional["shadow-intensity"])});class _r{constructor(a,h,g,v){this.screenBounds=a,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(a,h){let g,v;if(a instanceof l.P||typeof a[0]=="number"){const w=l.P.convert(a);g=[w],v=h.isPointAboveHorizon(w)}else{const w=l.P.convert(a[0]),E=l.P.convert(a[1]);g=[w,E],v=l.a0(w,E).every(C=>h.isPointAboveHorizon(C))}return new _r(g,h.getCameraPoint(),v,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return l.a0(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new l.P(1,1)):this.screenBounds[1],v=l.a0(h,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(v[3]=this.cameraPoint)),l.a1(v,a)}bufferedCameraGeometryGlobe(a){const h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new l.P(1,1)):this.screenBounds[1],v=l.a0(h,g,a),w=this.cameraPoint.clone();switch(3*((w.y>h.y)+(w.y>g.y))+((w.x>h.x)+(w.x>g.x))){case 0:v[0]=w,v[4]=w.clone();break;case 1:v.splice(1,0,w);break;case 2:v[1]=w;break;case 3:v.splice(4,0,w);break;case 5:v.splice(2,0,w);break;case 6:v[3]=w;break;case 7:v.splice(3,0,w);break;case 8:v[2]=w}return v}containsTile(a,h,g,v=0){const w=a.queryPadding/h._pixelsPerMercatorPixel+1,E=g?this._bufferedCameraMercator(w,h):this._bufferedScreenMercator(w,h);let C=a.tileID.wrap+(E.unwrapped?v:0);const k=E.polygon.map(Y=>l.a2(a.tileTransform,Y,C));if(!l.a3(k,0,0,l.Y,l.Y))return;C=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const O=this.screenGeometryMercator.polygon.map(Y=>l.a4(a.tileTransform,Y,C)),F=O.map(Y=>new l.P(Y[0],Y[1])),B=h.getFreeCameraOptions().position||new l.O(0,0,0),$=l.a4(a.tileTransform,B,C),G=O.map(Y=>{const K=l.Q.sub(Y,Y,$);return l.Q.normalize(K,K),new l.a5($,K)}),X=l.a6(a,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:G,bufferedTilespaceGeometry:k,bufferedTilespaceBounds:(Z=l.a7(k),Z.min.x=l.ad(Z.min.x,0,l.Y),Z.min.y=l.ad(Z.min.y,0,l.Y),Z.max.x=l.ad(Z.max.x,0,l.Y),Z.max.y=l.ad(Z.max.y,0,l.Y),Z),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:X};var Z}_bufferedScreenMercator(a,h){const g=tt(a);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),h):{polygon:this.bufferedScreenGeometry(a).map(w=>h.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(a,h){const g=tt(a);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),h):{polygon:this.bufferedCameraGeometry(a).map(w=>h.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(a,h){const g=function(w,E){const C=l.a9.multiply([],E.pixelMatrix,E.globeMatrix),k=[0,-l.ae,0,1],O=[0,l.ae,0,1],F=[0,0,0,1];l.aa.transformMat4(k,k,C),l.aa.transformMat4(O,O,C),l.aa.transformMat4(F,F,C);const B=new l.P(k[0]/k[3],k[1]/k[3]),$=new l.P(O[0]/O[3],O[1]/O[3]),G=l.ab(w,B)&&k[3]<F[3],X=l.ab(w,$)&&O[3]<F[3];if(!G&&!X)return null;const Z=function(ae,ke,Re){for(let Ne=1;Ne<ae.length;Ne++){const et=Ve(ke.pointCoordinate3D(ae[Ne-1]).x),ze=Ve(ke.pointCoordinate3D(ae[Ne]).x);if(Re<0){if(et<ze)return{idx:Ne,t:-et/(ze-1-et)}}else if(ze<et)return{idx:Ne,t:(1-et)/(ze+1-et)}}return null}(w,E,G?-1:1);if(!Z)return null;const{idx:Y,t:K}=Z;let ne=Y>1?Xe(w.slice(0,Y),E):[],fe=Y<w.length?Xe(w.slice(Y),E):[];ne=ne.map(ae=>new l.P(Ve(ae.x),ae.y)),fe=fe.map(ae=>new l.P(Ve(ae.x),ae.y));const de=[...ne];de.length===0&&de.push(fe[fe.length-1]);const ye=l.X(de[de.length-1].y,(fe.length===0?ne[0]:fe[0]).y,K);let J;return J=G?[new l.P(0,ye),new l.P(0,0),new l.P(1,0),new l.P(1,ye)]:[new l.P(1,ye),new l.P(1,1),new l.P(0,1),new l.P(0,ye)],de.push(...J),fe.length===0?de.push(ne[0]):de.push(...fe),{polygon:de.map(ae=>new l.O(ae.x,ae.y)),unwrapped:!1}}(a,h);if(g)return g;const v=function(w,E){let C=!1,k=-1/0,O=0;for(let B=0;B<w.length-1;B++)w[B].x>k&&(k=w[B].x,O=B);for(let B=0;B<w.length-1;B++){const $=(O+B)%(w.length-1),G=w[$],X=w[$+1];Math.abs(G.x-X.x)>.5&&(G.x<X.x?(G.x+=1,$===0&&(w[w.length-1].x+=1)):(X.x+=1,$+1===w.length-1&&(w[0].x+=1)),C=!0)}const F=l.a8(E.center.lng);return C&&F<Math.abs(F-1)&&w.forEach(B=>{B.x-=1}),{polygon:w,unwrapped:C}}(Xe(a,h).map(w=>new l.P(Ve(w.x),w.y)),h);return{polygon:v.polygon.map(w=>new l.O(w.x,w.y)),unwrapped:v.unwrapped}}}function Xe(m,a){return l.ac(m,h=>{const g=a.pointCoordinate3D(h);h.x=g.x,h.y=g.y},1/256)}function Ve(m){return m<0?1+m%1:m%1}function tt(m){return 100*m|0}function ut(m,a,h,g,v){const w=function(E,C){if(E)return v(E);if(C){m.url&&C.tiles&&m.tiles&&delete m.tiles;const k=l.af(l.e(C,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(k.vectorLayers=C.vector_layers,k.vectorLayerIds=k.vectorLayers.map(O=>O.id)),C.raster_layers&&(k.rasterLayers=C.raster_layers,k.rasterLayerIds=k.rasterLayers.map(O=>O.id)),k.tiles=a.canonicalizeTileset(k,m.url),v(null,k)}};return m.url?l.g(a.transformRequest(a.normalizeSourceURL(m.url,null,h,g),l.R.Source),w):l.f.frame(()=>w(null,m))}class _t{constructor(a,h,g){this.bounds=l.ag.convert(this.validateBounds(a)),this.minzoom=h||0,this.maxzoom=g||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const h=Math.pow(2,a.z),g=Math.floor(l.a8(this.bounds.getWest())*h),v=Math.floor(l.ah(this.bounds.getNorth())*h),w=Math.ceil(l.a8(this.bounds.getEast())*h),E=Math.ceil(l.ah(this.bounds.getSouth())*h);return a.x>=g&&a.x<w&&a.y>=v&&a.y<E}}class Lt extends l.E{constructor(a,h,g,v){if(super(),this.id=a,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.af(h,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new l.ai}load(a){this._loaded=!1,this.fire(new l.b("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=ut(this._options,this.map._requestManager,h,g,(v,w)=>{this._tileJSONRequest=null,this._loaded=!0,v?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),g&&g.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new l.a(v))):w&&(l.e(this,w),w.bounds&&(this.tileBounds=new _t(w.bounds,this.minzoom,this.maxzoom)),l.am(w.tiles,this.map._requestManager._customAccessToken),this.fire(new l.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.b("data",{dataType:"source",sourceDataType:"content"}))),a&&a(v)})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();const a=l.aj(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return l.e({},this._options)}loadTile(a,h){const g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(g,l.R.Tile),data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:l.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:a.isExtraShadowCaster};if(v.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired")a.state==="loading"?a.reloadCallback=h:a.request=a.actor.send("reloadTile",v,w.bind(this));else if(a.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",v,w.bind(this),void 0,!0);else{const E=l.ak.call({deduped:this._deduped},v,(C,k)=>{C||!k?w.call(this,C):(v.data={cacheControl:k.cacheControl,expires:k.expires,rawData:k.rawData.slice(0)},a.actor&&a.actor.send("loadTile",v,w.bind(this),void 0,!0))},!0);a.request={cancel:E}}function w(E,C){return delete a.request,a.aborted?h(null):E&&E.status!==404?h(E):(C&&C.resourceTiming&&(a.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&a.setExpiryData(C),a.loadVectorData(C,this.map.painter),l.al(this.dispatcher),h(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a){a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope}),a.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class bt extends l.E{constructor(a,h,g,v){super(),this.id=a,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},h),l.e(this,l.af(h,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new l.b("dataloading",{dataType:"source"})),this._tileJSONRequest=ut(this._options,this.map._requestManager,null,null,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new l.a(h)):g&&(l.e(this,g),g.bounds&&(this.tileBounds=new _t(g.bounds,this.minzoom,this.maxzoom)),l.am(g.tiles),this.fire(new l.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.b("data",{dataType:"source",sourceDataType:"content"}))),a&&a(h)})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();const a=l.aj(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return l.e({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,h){const g=l.f.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);a.request=l.d(this.map._requestManager.transformRequest(v,l.R.Tile),(w,E,C,k)=>(delete a.request,a.aborted?(a.state="unloaded",h(null)):w?(a.state="errored",h(w)):E?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:C,expires:k}),a.setTexture(E,this.map.painter),a.state="loaded",l.al(this.dispatcher),void h(null)):h(null)))}abortTile(a,h){a.request&&(a.request.cancel(),delete a.request),h()}unloadTile(a,h){a.texture&&a.texture instanceof l.T?(a.destroy(!0),a.texture&&a.texture instanceof l.T&&this.map.painter.saveTileTexture(a.texture)):a.destroy(),h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Rt extends bt{constructor(a,h,g,v){super(a,h,g,v),this.type="raster-array",this.maxzoom=22,this._options=l.e({type:"raster-array"},h)}triggerRepaint(a){const h=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);h&&h.enabled&&g&&h._clearRenderCacheForTile(g.id,a.tileID),this.map.triggerRepaint()}loadTile(a,h){const g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(g,l.R.Tile);a.requestParams=v,a.actor||(a.actor=this.dispatcher.getActor()),a.request=a.fetchHeader(void 0,(w,E,C,k)=>{if(delete a.request,a.aborted)return a.state="unloaded",h(null);if(w)return w.code===20?void 0:(a.state="errored",h(w));this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:C,expires:k}),a.state="empty",h(null)})}unloadTile(a){const h=a.texture;h&&h instanceof l.T?(a.destroy(!0),this.map.painter.saveTileTexture(h)):(a.destroy(),a.flushQueues(),a._isHeaderLoaded=!1,delete a._mrt,delete a.textureDescriptor),a.fbo&&(a.fbo.destroy(),delete a.fbo),delete a.request,delete a.requestParams,delete a.neighboringTiles,a.state="unloaded"}prepareTile(a,h,g){a._isHeaderLoaded&&(a.state!=="empty"&&(a.state="reloading"),a.fetchBand(h,g,(v,w)=>{if(v)return a.state="errored",this.fire(new l.a(v)),void this.triggerRepaint(a);w&&(a.setTexture(w,this.map.painter),a.state="loaded",this.triggerRepaint(a))}))}getInitialBand(a){if(!this.rasterLayers)return 0;const h=this.rasterLayers.find(({id:w})=>w===a),g=h&&h.fields,v=g&&g.bands&&g.bands;return v?v[0]:0}getTextureDescriptor(a,h,g){if(!a)return;const v=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let w=null;h instanceof l.aq?w=h.paint.get("raster-array-band"):h instanceof l.ar&&(w=h.paint.get("raster-particle-array-band"));const E=w||this.getInitialBand(v);if(E!=null)if(a.textureDescriptor){if(!a.updateNeeded(v,E)||g)return Object.assign({},a.textureDescriptor,{texture:a.texture})}else this.prepareTile(a,v,E)}}const Bt=32,It=33,ar=new Uint16Array(8184);for(let m=0;m<2046;m++){let a=m+2,h=0,g=0,v=0,w=0,E=0,C=0;for(1&a?v=w=E=Bt:h=g=C=Bt;(a>>=1)>1;){const O=h+v>>1,F=g+w>>1;1&a?(v=h,w=g,h=E,g=C):(h=v,g=w,v=E,w=C),E=O,C=F}const k=4*m;ar[k+0]=h,ar[k+1]=g,ar[k+2]=v,ar[k+3]=w}const gr=new Uint16Array(2178),Yt=new Uint8Array(1089),Ir=new Uint16Array(1089);function Ei(m){return m===0?-.03125:m===32?.03125:0}class _i{constructor(a,h,g,v){this.id=_i.uniqueIdxCounter,_i.uniqueIdxCounter++,this.context=a;const w=a.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||v||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){this.id=_i.uniqueIdxCounter,_i.uniqueIdxCounter++;const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}_i.uniqueIdxCounter=0;const yi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class fi{constructor(a,h,g,v,w,E){this.length=h.length,this.attributes=g,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.instanceCount=E,this.context=a;const C=a.gl;this.buffer=C.createBuffer(),a.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||w||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,h){for(let g=0;g<this.attributes.length;g++){const v=h.attributes[this.attributes[g].name];v!==void 0&&a.enableVertexAttribArray(v)}}setVertexAttribPointers(a,h,g){for(let v=0;v<this.attributes.length;v++){const w=this.attributes[v],E=h.attributes[w.name];E!==void 0&&a.vertexAttribPointer(E,w.components,a[yi[w.type]],!1,this.itemSize,w.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(a,h,g){for(let v=0;v<this.attributes.length;v++){const w=h.attributes[this.attributes[v].name];w!==void 0&&this.instanceCount&&this.instanceCount>0&&a.vertexAttribDivisor(w,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class kr{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Bn extends kr{getDefault(){return l.aA.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Ss extends kr{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Fi extends kr{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class _n extends kr{getDefault(){return[!0,!0,!0,!0]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class ds extends kr{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class On extends kr{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class wa extends kr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class Vr extends kr{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class Js extends kr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}}class Vn extends kr{getDefault(){return[0,1]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class Fs extends kr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}}class Wa extends kr{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Ah extends kr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}}class bu extends kr{getDefault(){const a=this.gl;return[a.ONE,a.ZERO,a.ONE,a.ZERO]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class df extends kr{getDefault(){return l.aA.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class ff extends kr{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(a,a),this.current=a,this.dirty=!1)}}class xm extends kr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}}class bm extends kr{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class pf extends kr{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let wu=class extends kr{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class Hr extends kr{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class Za extends kr{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Ns extends kr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Tu extends kr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Eu extends kr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class mf extends kr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class En extends kr{getDefault(){return null}set(a){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Au extends kr{getDefault(){return null}set(a){this.gl&&(a!==this.current||this.dirty)&&(this.gl.bindVertexArray(a),this.current=a,this.dirty=!1)}}class Pc extends kr{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class Mc extends kr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class wm extends kr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Iu extends kr{constructor(a,h){super(a),this.context=a,this.parent=h}getDefault(){return null}}class a0 extends Iu{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Ih extends Iu{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class l0 extends Iu{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class c0 extends Ih{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Su{constructor(a,h,g,v,w){this.context=a,this.width=h,this.height=g;const E=this.framebuffer=a.gl.createFramebuffer();v&&(this.colorAttachment=new a0(a,E)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new Ih(a,E):new l0(a,E))}destroy(){const a=this.context.gl;if(this.colorAttachment){const h=this.colorAttachment.get();h&&a.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const h=this.depthAttachment.get();h&&a.deleteRenderbuffer(h)}else{const h=this.depthAttachment.get();h&&a.deleteTexture(h)}a.deleteFramebuffer(this.framebuffer)}}class hr{constructor(a,h,g){this.func=a,this.mask=h,this.range=g}}hr.ReadOnly=!1,hr.ReadWrite=!0,hr.disabled=new hr(519,hr.ReadOnly,[0,1]);const Sh=7680;class Dr{constructor(a,h,g,v,w,E){this.test=a,this.ref=h,this.mask=g,this.fail=v,this.depthFail=w,this.pass=E}}Dr.disabled=new Dr({func:519,mask:0},0,0,Sh,Sh,Sh);const Cu=771;class $r{constructor(a,h,g,v){this.blendFunction=a,this.blendColor=h,this.mask=g,this.blendEquation=v}}$r.Replace=[1,0,1,0],$r.disabled=new $r($r.Replace,l.aA.transparent,[!1,!1,!1,!1]),$r.unblended=new $r($r.Replace,l.aA.transparent,[!0,!0,!0,!0]),$r.alphaBlended=new $r([1,Cu,1,Cu],l.aA.transparent,[!0,!0,!0,!0]),$r.multiply=new $r([774,0,774,0],l.aA.transparent,[!0,!0,!0,!0]);const _f=1029,gf=2305;class Cr{constructor(a,h,g){this.enable=a,this.mode=h,this.frontFace=g}}Cr.disabled=new Cr(!1,_f,gf),Cr.backCCW=new Cr(!0,_f,gf),Cr.backCW=new Cr(!0,_f,2304),Cr.frontCW=new Cr(!0,1028,2304),Cr.frontCCW=new Cr(!0,1028,gf);class ws{constructor(a,h){this.gl=a,this.clearColor=new Bn(this),this.clearDepth=new Ss(this),this.clearStencil=new Fi(this),this.colorMask=new _n(this),this.depthMask=new ds(this),this.stencilMask=new On(this),this.stencilFunc=new wa(this),this.stencilOp=new Vr(this),this.stencilTest=new Js(this),this.depthRange=new Vn(this),this.depthTest=new Fs(this),this.depthFunc=new Wa(this),this.blend=new Ah(this),this.blendFunc=new bu(this),this.blendColor=new df(this),this.blendEquation=new ff(this),this.cullFace=new xm(this),this.cullFaceSide=new bm(this),this.frontFace=new pf(this),this.program=new wu(this),this.activeTexture=new Hr(this),this.viewport=new Za(this),this.bindFramebuffer=new Ns(this),this.bindRenderbuffer=new Tu(this),this.bindTexture=new Eu(this),this.bindVertexBuffer=new mf(this),this.bindElementBuffer=new En(this),this.bindVertexArrayOES=new Au(this),this.pixelStoreUnpack=new Pc(this),this.pixelStoreUnpackPremultiplyAlpha=new Mc(this),this.pixelStoreUnpackFlipY=new wm(this),this.options=h?{...h}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=a.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),this.maxPointSize=a.getParameter(a.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,h,g){return new _i(this,a,h,g)}createVertexBuffer(a,h,g,v,w){return new fi(this,a,h,g,v,w)}createRenderbuffer(a,h,g){const v=this.gl,w=v.createRenderbuffer();return this.bindRenderbuffer.set(w),v.renderbufferStorage(v.RENDERBUFFER,a,h,g),this.bindRenderbuffer.set(null),w}createFramebuffer(a,h,g,v){return new Su(this,a,h,g,v)}clear({color:a,depth:h,stencil:g,colorMask:v}){const w=this.gl;let E=0;a&&(E|=w.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set(v||[!0,!0,!0,!0])),h!==void 0&&(E|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g!==void 0&&(E|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),w.clear(E)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){S(a.blendFunction,$r.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor),a.blendEquation?this.blendEquation.set(a.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(a.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var u0=l.aB([{name:"a_index",type:"Int16",components:1}]);const Zl=.15000000000000002;class kc{constructor(a,h,g,v){const w={width:g[0],height:g[1],data:null},E=a.gl;this.targetColorTexture=new l.T(a,w,E.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new l.T(a,w,E.RGBA,{useMipmap:!1}),this.context=a,this.setParticleTextureDimension(h,v),this.lastInvalidatedAt=0}setParticleTextureDimension(a,h){if(this.particleTextureDimension===h)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const g=this.context.gl,v=h*h,w=new Uint8Array(4*v),E=.7692307692307692,C=l.aC(a.key);for(let F=0;F<w.length;F+=4){const B=E*(C()+Zl),$=E*(C()+Zl),G=255*B%1,X=255*$%1,Z=G,Y=$-X/255,K=X;w[F+0]=Math.floor(255*(B-G/255)),w[F+1]=Math.floor(255*Z),w[F+2]=Math.floor(255*Y),w[F+3]=Math.floor(255*K)}const k=new l.h({width:h,height:h},w);this.particleTexture0=new l.T(this.context,k,g.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new l.T(this.context,k,g.RGBA,{premultiply:!1,useMipmap:!1});const O=new l.aD;O.reserve(v);for(let F=0;F<v;F++)O.emplaceBack(F);this.particleIndexBuffer=this.context.createVertexBuffer(O,u0.members,!0),this.particleSegment=l.aE.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h}update(a){return!(this.lastInvalidatedAt<a&&(this.lastInvalidatedAt=l.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}const Xl={type:2,extent:l.Y,loadGeometry:()=>[[new l.P(0,0),new l.P(l.Y+1,0),new l.P(l.Y+1,l.Y+1),new l.P(0,l.Y+1),new l.P(0,0)]]};class Po{constructor(a,h,g,v,w){this.tileID=a,this.uid=l.aF(),this.uses=0,this.tileSize=h,this.tileZoom=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,v&&v.style&&(this._lastUpdatedBrightness=v.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",v&&v.transform&&(this.projection=v.transform.projection)}registerFadeDuration(a){const h=a+this.timeAdded;h<l.f.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=l.av(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(a,h,g){if(this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(v,w){const E={};if(!w)return E;for(const C of v){const k=C.layerIds.map(O=>w.getLayer(O)).filter(Boolean);if(k.length!==0){C.layers=k,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(O=>k.filter(F=>F.id===O)[0]));for(const O of k)E[O.fqid]=C}}return E}(a.buckets,h.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const w=this.buckets[v];if(w instanceof l.aH){if(this.hasSymbolBuckets=!0,!g)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const w=this.buckets[v];if(w instanceof l.aH&&w.hasRTLText){this.hasRTLText=!0,l.aI();break}}this.queryPadding=0;for(const v in this.buckets){const w=this.buckets[v],E=h.style.getOwnLayer(v);if(!E)continue;const C=E.queryRadius(w);this.queryPadding=Math.max(this.queryPadding,C)}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage),a.lineAtlas&&(this.lineAtlas=a.lineAtlas),this._lastUpdatedBrightness=a.brightness}else this.collisionBoxArray=new l.aG}unloadVectorData(){if(this.hasData()){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(a){return this.buckets[a.fqid]}upload(a){for(const v in this.buckets){const w=this.buckets[v];w.uploadPending()&&w.upload(a)}const h=a.gl,g=this.imageAtlas;if(g&&!g.uploaded){const v=!!Object.keys(g.patternPositions).length;this.imageAtlasTexture=new l.T(a,g.image,h.RGBA,{useMipmap:v}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new l.T(a,this.glyphAtlasImage,h.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new l.T(a,this.lineAtlas.image,h.R8),this.lineAtlas.uploaded=!0)}prepare(a,h,g){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture,g),!h||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const v=h.style.getBrightness();(this._lastUpdatedBrightness||v)&&(this._lastUpdatedBrightness&&v&&Math.abs(this._lastUpdatedBrightness-v)<.001||(this._lastUpdatedBrightness=v,this.updateBuckets(void 0,h)))}queryRenderedFeatures(a,h,g,v,w,E,C,k){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:v,pixelPosMatrix:C,transform:E,params:w,tileTransform:this.tileTransform},a,h,g):{}}querySourceFeatures(a,h){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const v=g.loadVTLayers(),w=h?h.sourceLayer:"",E=v._geojsonTileLayer||v[w];if(!E)return;const C=l.aJ(h&&h.filter),{z:k,x:O,y:F}=this.tileID.canonical,B={z:k,x:O,y:F};for(let $=0;$<E.length;$++){const G=E.feature($);if(C.needGeometry){const Y=l.aK(G,!0);if(!C.filter(new l.N(this.tileID.overscaledZ),Y,this.tileID.canonical))continue}else if(!C.filter(new l.N(this.tileID.overscaledZ),G))continue;const X=g.getId(G,w),Z=new l.aL(G,k,O,F,X);Z.tile=B,a.push(Z)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const a in this.buckets)if(this.buckets[a].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(a){const h=this.expirationTime;if(a.cacheControl){const g=l.aM(a.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const g=Date.now();let v=!1;if(this.expirationTime>g)v=!1;else if(h)if(this.expirationTime<h)v=!0;else{const w=this.expirationTime-h;w?this.expirationTime=g+Math.max(w,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(a,h){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0&&h&&this.updateBuckets(a,h)}updateBuckets(a,h){if(!this.latestFeatureIndex)return;const g=this.latestFeatureIndex.loadVTLayers(),v=h.style.listImages(),w=h.style.getBrightness();for(const E in this.buckets){if(!h.style.hasLayer(E))continue;const C=this.buckets[E],k=C.layers[0].sourceLayer||"_geojsonTileLayer",O=g[k];let F={};if(a&&(F=a[k],!O||!F||Object.keys(F).length===0))continue;if(C.update(F,O,v,this.imageAtlas&&this.imageAtlas.patternPositions||{},w),C instanceof l.aN||C instanceof l.aO){const $=h.style.getOwnSourceCache(C.layers[0].source);h._terrain&&h._terrain.enabled&&$&&C.programConfigurations.needsUpload&&h._terrain._clearRenderCacheForTile($.id,this.tileID)}const B=h&&h.style&&h.style.getOwnLayer(E);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=l.f.now()+a}setTexture(a,h){const g=h.context,v=g.gl;this.texture=this.texture||h.getTileTexture(a.width),this.texture&&this.texture instanceof l.T?this.texture.update(a,{useMipmap:!0}):(this.texture=new l.T(g,a,v.RGBA,{useMipmap:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE))}setDependencies(a,h){const g={};for(const v of h)g[v]=!0;this.dependencies[a]=g}hasDependency(a,h){for(const g of a){const v=this.dependencies[g];if(v){for(const w of h)if(v[w])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(a,h){if(!h||h.name==="mercator"||this._tileDebugBuffer)return;const g=l.aP(Xl,this.tileID.canonical,this.tileTransform)[0],v=new l.aQ,w=new l.aR;for(let E=0;E<g.length;E++){const{x:C,y:k}=g[E];v.emplaceBack(C,k),w.emplaceBack(E)}w.emplaceBack(0),this._tileDebugIndexBuffer=a.createIndexBuffer(w),this._tileDebugBuffer=a.createVertexBuffer(v,l.aS.members),this._tileDebugSegments=l.aE.simpleSegment(0,0,v.length,w.length)}_makeTileBoundsBuffers(a,h){if(this._tileBoundsBuffer||!h||h.name==="mercator")return;const g=l.aP(Xl,this.tileID.canonical,this.tileTransform)[0];let v,w;if(this.isRaster){const E=function(C,k){const O=l.av(C,k),F=Math.pow(2,C.z);for(let Y=0;Y<It;Y++)for(let K=0;K<It;K++){const ne=l.aw((C.x+(K+Ei(K))/Bt)/F),fe=l.ax((C.y+(Y+Ei(Y))/Bt)/F),de=k.project(ne,fe),ye=Y*It+K;gr[2*ye+0]=Math.round((de.x*O.scale-O.x)*l.Y),gr[2*ye+1]=Math.round((de.y*O.scale-O.y)*l.Y)}Yt.fill(0),Ir.fill(0);for(let Y=2045;Y>=0;Y--){const K=4*Y,ne=ar[K+0],fe=ar[K+1],de=ar[K+2],ye=ar[K+3],J=ne+de>>1,ae=fe+ye>>1,ke=J+ae-fe,Re=ae+ne-J,Ne=fe*It+ne,et=ye*It+de,ze=ae*It+J,Qe=Math.hypot((gr[2*Ne+0]+gr[2*et+0])/2-gr[2*ze+0],(gr[2*Ne+1]+gr[2*et+1])/2-gr[2*ze+1])>=16;Yt[ze]=Yt[ze]||(Qe?1:0),Y<1022&&(Yt[ze]=Yt[ze]||Yt[(fe+Re>>1)*It+(ne+ke>>1)]||Yt[(ye+Re>>1)*It+(de+ke>>1)])}const B=new l.ay,$=new l.az;let G=0;function X(Y,K){const ne=K*It+Y;return Ir[ne]===0&&(B.emplaceBack(gr[2*ne+0],gr[2*ne+1],Y*l.Y/Bt,K*l.Y/Bt),Ir[ne]=++G),Ir[ne]-1}function Z(Y,K,ne,fe,de,ye){const J=Y+ne>>1,ae=K+fe>>1;if(Math.abs(Y-de)+Math.abs(K-ye)>1&&Yt[ae*It+J])Z(de,ye,Y,K,J,ae),Z(ne,fe,de,ye,J,ae);else{const ke=X(Y,K),Re=X(ne,fe),Ne=X(de,ye);$.emplaceBack(ke,Re,Ne)}}return Z(0,0,Bt,Bt,Bt,0),Z(Bt,Bt,0,0,0,Bt),{vertices:B,indices:$}}(this.tileID.canonical,h);v=E.vertices,w=E.indices}else{v=new l.ay,w=new l.az;for(const{x:C,y:k}of g)v.emplaceBack(C,k,0,0);const E=l.aT(v.int16,void 0,4);for(let C=0;C<E.length;C+=3)w.emplaceBack(E[C],E[C+1],E[C+2])}this._tileBoundsBuffer=a.createVertexBuffer(v,l.aU.members),this._tileBoundsIndexBuffer=a.createIndexBuffer(w),this._tileBoundsSegments=l.aE.simpleSegment(0,0,v.length,w.length)}_makeGlobeTileDebugBuffers(a,h){const g=h.projection;if(!g||g.name!=="globe"||h.freezeTileCoverage)return;const v=this.tileID.canonical,w=l.aV(v,h),E=l.aW(w),C=l.W(h.zoom);let k;C>0&&(k=l.a9.invert(new Float64Array(16),h.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(a,v,h,E,k,C),this._makeGlobeTileDebugTextBuffer(a,v,h,E,k,C)}_globePoint(a,h,g,v,w,E,C){let k=l.aX(a,h,g);if(E){const O=1<<g.z,F=l.a8(v.center.lng),B=l.ah(v.center.lat),$=(g.x+.5)/O-F;let G=0;$>.5?G=-1:$<-.5&&(G=1);let X=(a/l.Y+g.x)/O+G,Z=(h/l.Y+g.y)/O;X=(X-F)*v._pixelsPerMercatorPixel+F,Z=(Z-B)*v._pixelsPerMercatorPixel+B;const Y=[X*v.worldSize,Z*v.worldSize,0];l.Q.transformMat4(Y,Y,E),k=l.aY(k,Y,C)}return l.Q.transformMat4(k,k,w)}_makeGlobeTileDebugBorderBuffer(a,h,g,v,w,E){const C=new l.aQ,k=new l.aR,O=new l.aZ,F=($,G,X,Z,Y)=>{const K=(X-$)/(Y-1),ne=(Z-G)/(Y-1),fe=C.length;for(let de=0;de<Y;de++){const ye=$+de*K,J=G+de*ne;C.emplaceBack(ye,J);const ae=this._globePoint(ye,J,h,g,v,w,E);O.emplaceBack(ae[0],ae[1],ae[2]),k.emplaceBack(fe+de)}},B=l.Y;F(0,0,B,0,16),F(B,0,B,B,16),F(B,B,0,B,16),F(0,B,0,0,16),this._tileDebugIndexBuffer=a.createIndexBuffer(k),this._tileDebugBuffer=a.createVertexBuffer(C,l.aS.members),this._globeTileDebugBorderBuffer=a.createVertexBuffer(O,l.a_.members),this._tileDebugSegments=l.aE.simpleSegment(0,0,C.length,k.length)}_makeGlobeTileDebugTextBuffer(a,h,g,v,w,E){const C=l.Y/4,k=new l.aQ,O=new l.az,F=new l.aZ,B=25;O.reserve(32),k.reserve(B),F.reserve(B);const $=(G,X)=>B*G+X;for(let G=0;G<B;G++){const X=G*C;for(let Z=0;Z<B;Z++){const Y=Z*C;k.emplaceBack(Y,X);const K=this._globePoint(Y,X,h,g,v,w,E);F.emplaceBack(K[0],K[1],K[2])}}for(let G=0;G<4;G++)for(let X=0;X<4;X++){const Z=$(G,X),Y=$(G,X+1),K=$(G+1,X),ne=$(G+1,X+1);O.emplaceBack(Z,Y,K),O.emplaceBack(K,Y,ne)}this._tileDebugTextIndexBuffer=a.createIndexBuffer(O),this._tileDebugTextBuffer=a.createVertexBuffer(k,l.aS.members),this._globeTileDebugTextBuffer=a.createVertexBuffer(F,l.a_.members),this._tileDebugTextSegments=l.aE.simpleSegment(0,0,B,32)}destroy(a=!1){for(const h in this.buckets)this.buckets[h].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!a&&this.texture&&this.texture instanceof l.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const Ut={vector:Lt,raster:bt,"raster-dem":class extends bt{constructor(m,a,h,g){super(m,a,h,g),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(m,a){const h=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,w){v&&(m.state="errored",a(v)),w&&(m.dem=w,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",a(null))}m.request=l.d(this.map._requestManager.transformRequest(h,l.R.Tile),(function(v,w,E,C){if(delete m.request,m.aborted)m.state="unloaded",a(null);else if(v)m.state="errored",a(v);else if(w){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:E,expires:C});const k=ImageBitmap&&w instanceof ImageBitmap&&l.an(),O=1-(w.width-l.ao(w.width))/2;O<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const F=k?w:l.f.getImageData(w,O),B={uid:m.uid,coord:m.tileID,source:this.id,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:O};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",B,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const a=m.canonical,h=Math.pow(2,a.z),g=(a.x-1+h)%h,v=a.x===0?m.wrap-1:m.wrap,w=(a.x+1+h)%h,E=a.x+1===h?m.wrap+1:m.wrap,C={};return C[new l.ap(m.overscaledZ,v,a.z,g,a.y).key]={backfilled:!1},C[new l.ap(m.overscaledZ,E,a.z,w,a.y).key]={backfilled:!1},a.y>0&&(C[new l.ap(m.overscaledZ,v,a.z,g,a.y-1).key]={backfilled:!1},C[new l.ap(m.overscaledZ,m.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},C[new l.ap(m.overscaledZ,E,a.z,w,a.y-1).key]={backfilled:!1}),a.y+1<h&&(C[new l.ap(m.overscaledZ,v,a.z,g,a.y+1).key]={backfilled:!1},C[new l.ap(m.overscaledZ,m.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},C[new l.ap(m.overscaledZ,E,a.z,w,a.y+1).key]={backfilled:!1}),C}},"raster-array":Rt,geojson:class extends l.E{constructor(m,a,h,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(g),this._data=a.data,this._options=l.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.minzoom!==void 0&&(this.minzoom=a.minzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const v=l.Y/this.tileSize;this.workerOptions=l.e({source:this.id,scope:this.scope,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*v,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*v,extent:l.Y,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:l.Y,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*v,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter,dynamic:a.dynamic},a.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){return this._options.dynamic?(this._data=m,this._updateWorkerData(!0),this):this.fire(new l.a(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(m,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},a),this}getClusterChildren(m,a){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},a),this}getClusterLeaves(m,a,h,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:a,offset:h},g),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new l.b("dataloading",{dataType:"source"})),this._loaded=!1;const a=l.e({append:m},this.workerOptions);a.scope=this.scope;const h=this._data;typeof h=="string"?(a.request=this.map._requestManager.transformRequest(l.f.resolveURL(h),l.R.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,a,(g,v)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new l.a(g));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(w.resourceTiming=v.resourceTiming[this.id]),this.fire(new l.b("data",w)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,a){const h=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const g={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:l.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};m.request=this.actor.send(h,g,(v,w)=>(delete m.request,m.destroy(),m.aborted?a(null):v?a(v):(m.loadVectorData(w,this.map.painter,h==="reloadTile"),a(null))),void 0,h==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends l.as{constructor(m,a,h,g){super(m,a,h,g),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const a of m.urls)this.urls.push(this.map._requestManager.transformRequest(a,l.R.Source).url);l.at(this.urls,(a,h)=>{this._loaded=!0,a?this.fire(new l.a(a)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const a=this.video.seekable;m<a.start(0)||m>a.end(0)?this.fire(new l.a(new l.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,a=m.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new l.T(m,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:l.as,model:class extends l.E{constructor(m,a,h,g){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=a}load(){const m=[];for(const a in this._options.models){const h=this._options.models[a],g=l.l(this.map._requestManager.transformRequest(h.uri,l.R.Model).url).then(v=>{if(!v)return;const w=l.c(v),E=new l.M(a,h.position,h.orientation,w);E.computeBoundsAndApplyParent(),this.models.push(E)}).catch(v=>{this.fire(new l.a(new Error(`Could not load model ${a} from ${h.uri}: ${v.message}`)))});m.push(g)}return Promise.allSettled(m).then(()=>{this._loaded=!0,this.fire(new l.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(a=>{this.fire(new l.a(new Error(`Could not load models: ${a.message}`)))})}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,a){}serialize(){return{type:"model"}}},"batched-model":class extends l.E{constructor(m,a,h,g){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=a,this.tiles=this._options.tiles,this.maxzoom=a.maxzoom||19,this.minzoom=a.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(m){this.map=m,this.load()}load(m){this._loaded=!1,this.fire(new l.b("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=ut(this._options,this.map._requestManager,a,h,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new l.a(g))):v&&(l.e(this,v),v.bounds&&(this.tileBounds=new _t(v.bounds,this.minzoom,this.maxzoom)),l.am(v.tiles,this.map._requestManager._customAccessToken),this.fire(new l.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.b("data",{dataType:"source",sourceDataType:"content"}))),m&&m(g)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,a){const h=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(h,l.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=a;else{if(m.buckets){const w=Object.values(m.buckets);for(const E of w)E.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",g,v.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",g,v.bind(this),void 0,!0);function v(w,E){return m.aborted?a(null):w&&w.status!==404?a(w):(E&&(E.resourceTiming&&(m.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&m.setExpiryData(E),m.buckets={...m.buckets,...E.buckets},E.featureIndex&&(m.latestFeatureIndex=E.featureIndex)),m.state="loaded",void a(null))}}serialize(){return l.e({},this._options)}},canvas:class extends l.as{constructor(m,a,h,g){super(m,a,h,g),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(w=>typeof w!="number"))||this.fire(new l.a(new l.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.a(new l.V(`sources.${m}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new l.a(new l.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new l.a(new l.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.a(new l.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof l.au||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.T(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends l.E{constructor(m,a,h,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=a,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new l.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new l.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new _t(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),l.e(this,l.af(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return l.af(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new l.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new l.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:a,y:h,z:g}=m.canonical;return this._implementation.hasTile({x:a,y:h,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,a){const{x:h,y:g,z:v}=m.tileID.canonical,w=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:h,y:g,z:v},{signal:w.signal})).then((function(E){return delete m.request,m.aborted?(m.state="unloaded",a(null)):E===void 0?(m.state="errored",a(null)):E===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",a(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(E)?(this.loadTileData(m,E),m.state="loaded",void a(null)):(m.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(E=>{E.code!==20&&(m.state="errored",a(E))}),m.request.cancel=()=>w.abort()}loadTileData(m,a){m.setTexture(a,this._map.painter)}unloadTile(m,a){if(m.texture&&m.texture instanceof l.T?(m.destroy(!0),m.texture&&m.texture instanceof l.T&&this._map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:h,y:g,z:v}=m.tileID.canonical;this._implementation.unloadTile({x:h,y:g,z:v})}a()}abortTile(m,a){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=l.aj(this.id,this.scope);this._map.style.clearSource(m)}_update(){this.fire(new l.b("data",{dataType:"source",sourceDataType:"content"}))}}},Yl=function(m,a,h,g){const v=new Ut[a.type](m,a,h,g);if(v.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${v.id}`);return l.a$(["load","abort","unload","serialize","prepare"],v),v};function Ch(m,a){const h=l.a9.identity([]);return l.a9.scale(h,h,[.5*m.width,.5*-m.height,1]),l.a9.translate(h,h,[1,-1,0]),l.a9.multiply(h,h,m.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(h)}function ui(m,a,h,g,v,w,E,C=!1){const k=m.tilesIn(g,E,C);k.sort(Tm);const O=[];for(const B of k)O.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(a,h,m._state,B,v,w,Ch(m.transform,B.tile.tileID),C)});const F=function(B){const $={},G={};for(const X of B){const Z=X.queryResults,Y=X.wrappedTileID,K=G[Y]=G[Y]||{};for(const ne in Z){const fe=Z[ne],de=K[ne]=K[ne]||{},ye=$[ne]=$[ne]||[];for(const J of fe)de[J.featureIndex]||(de[J.featureIndex]=!0,ye.push(J))}}return $}(O);for(const B in F)F[B].forEach($=>{const G=$.feature,X=G.layer;X&&X.type!=="background"&&X.type!=="sky"&&X.type!=="slot"&&(G.source=X.source,X["source-layer"]&&(G.sourceLayer=X["source-layer"]),G.state=G.id!==void 0?m.getFeatureState(X["source-layer"],G.id):{})});return F}function Ui(m,a){const h=m.getRenderableIds().map(w=>m.getTileByID(w)),g=[],v={};for(let w=0;w<h.length;w++){const E=h[w],C=E.tileID.canonical.key;v[C]||(v[C]=!0,E.querySourceFeatures(g,a))}return g}function Tm(m,a){const h=m.tileID,g=a.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}class Rh extends Po{constructor(a,h,g,v,w){super(a,h,g,v,w),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(a,h){const g=h.context,v=g.gl;this.texture=this.texture||h.getTileTexture(a.width),this.texture&&this.texture instanceof l.T?this.texture.update(a,{useMipmap:!1,premultiply:!1}):this.texture=new l.T(g,a,v.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(a=16384,h){const g=this._mrt=new l.b0(30),v=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(a-1)}});return this.entireBuffer=null,this.request=l.b1(v,(w,E,C,k)=>{if(w)h(w);else try{const O=g.getHeaderLength(E);if(O>a)return void(this.request=this.fetchHeader(O,h));g.parseHeader(E),this._isHeaderLoaded=!0;let F=0;for(const B of Object.values(g.layers))F=Math.max(F,B.dataIndex[B.dataIndex.length-1].last_byte);E.byteLength>=F&&(this.entireBuffer=E),h(null,this.entireBuffer||E,C,k)}catch(O){h(O)}}),this.request}fetchBand(a,h,g){const v=this._mrt;if(!this._isHeaderLoaded||!v)return void g(new Error("Tile header is not ready"));const w=this.actor;if(!w)return void g(new Error("Can't fetch tile band without an actor"));let E;const C=(B,$)=>{E.complete(B,$),B?g(B):(this.updateTextureDescriptor(a,h),g(null,this.textureDescriptor&&this.textureDescriptor.img))},k=(B,$)=>{if(B)return g(B);const G=w.send("decodeRasterArray",{buffer:$,task:E},C,void 0,!0);this._workQueue.push(()=>{G&&G.cancel(),E.cancel()})},O=v.getLayer(a);if(!O)return void g(new Error(`Unknown sourceLayer "${a}"`));if(O.hasDataForBand(h))return this.updateTextureDescriptor(a,h),void g(null,this.textureDescriptor?this.textureDescriptor.img:null);const F=O.getDataRange([h]);if(E=v.createDecodingTask(F),!E||E.tasks.length)if(this.flushQueues(),this.entireBuffer)k(null,this.entireBuffer.slice(F.firstByte,F.lastByte+1));else{const B=Object.assign({},this.requestParams,{headers:{Range:`bytes=${F.firstByte}-${F.lastByte}`}}),$=l.b1(B,k);this._fetchQueue.push(()=>{$.cancel(),E.cancel()})}else g(null)}updateNeeded(a,h){return(!this.textureDescriptor||this.textureDescriptor.band!==h||this.textureDescriptor.layer!==a)&&this.state!=="errored"}updateTextureDescriptor(a,h){if(!this._mrt)return;const g=this._mrt.getLayer(a);if(!g||!g.hasBand(h)||!g.hasDataForBand(h))return;const{bytes:v,tileSize:w,buffer:E,offset:C,scale:k}=g.getBandView(h),O=w+2*E,F={data:v,width:O,height:O},B=this.texture;B&&B instanceof l.T&&B.update(F,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:a,band:h,img:F,buffer:E,offset:C,tileSize:w,format:g.pixelFormat,mix:[k,256*k,65536*k,16777216*k]}}}class yf{constructor(a,h){this.max=a,this.onRemove=h,this.reset()}reset(){for(const a in this.data)for(const h of this.data[a])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(a,h,g){const v=a.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const w={value:h,timeout:void 0};if(g!==void 0&&(w.timeout=setTimeout(()=>{this.remove(a,w)},g)),this.data[v].push(w),this.order.push(v),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const h=this.data[a].shift();return h.timeout&&clearTimeout(h.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),h.value}getByKey(a){const h=this.data[a];return h?h[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,h){if(!this.has(a))return this;const g=a.wrapped().key,v=h===void 0?0:this.data[g].indexOf(h),w=this.data[g][v];return this.data[g].splice(v,1),w.timeout&&clearTimeout(w.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(w.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(a){const h=[];for(const g in this.data)for(const v of this.data[g])a(v.value)||h.push(v);for(const g of h)this.remove(g.value.tileID,g)}}class Mo extends l.E{constructor(a,h,g){super(),this.id=a,this._onlySymbols=g,h.on("data",v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),h.on("error",()=>{this._sourceErrored=!0}),this._source=h,this._tiles={},this._cache=new yf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new De,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(a){this.map=a,this._minTileCacheSize=this._minTileCacheSize===void 0&&a?a._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&a?a._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const a in this._tiles){const h=this._tiles[a];if(h.state!=="errored"&&(h.state!=="loaded"||!h.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(a,h){return a.isSymbolTile=this._onlySymbols,a.isExtraShadowCaster=this._shadowCasterTiles[a.tileID.key],this._source.loadTile(a,h)}_unloadTile(a){if(this._source.unloadTile)return this._source.unloadTile(a,()=>{})}_abortTile(a){if(this._source.abortTile)return this._source.abortTile(a,()=>{})}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const g=this._tiles[h];g.upload(a),g.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return l.b2(this._tiles).map(a=>a.tileID).sort(ti).map(a=>a.key)}getRenderableIds(a,h){const g=[];for(const v in this._tiles)this._isIdRenderable(+v,a,h)&&g.push(this._tiles[v]);return a?g.sort((v,w)=>{const E=v.tileID,C=w.tileID,k=new l.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),O=new l.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-C.overscaledZ||O.y-k.y||O.x-k.x}).map(v=>v.tileID.key):g.map(v=>v.tileID).sort(ti).map(v=>v.key)}hasRenderableParent(a){const h=this.findLoadedParent(a,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(a,h,g){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(h||!this._tiles[a].holdingForFade())&&(g||!this._shadowCasterTiles[a])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(+a,"reloading")}}_reloadTile(a,h){const g=this._tiles[a];g&&(g.state!=="loading"&&(g.state=h),this._loadTile(g,this._tileLoaded.bind(this,g,a,h)))}_tileLoaded(a,h,g,v){if(v)if(a.state="errored",v.status!==404)this._source.fire(new l.a(v,{tile:a}));else{if(!(a.tileID.key in this._loadedParentTiles))return void this._source.fire(new l.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform)}else a.timeAdded=l.f.now(),g==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(h,a),this._source.type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new l.b("data",{dataType:"source",tile:a,coord:a.tileID,sourceCacheId:this.id}))}_backfillDEM(a){const h=this.getRenderableIds();for(let v=0;v<h.length;v++){const w=h[v];if(a.neighboringTiles&&a.neighboringTiles[w]){const E=this.getTileByID(w);g(a,E),g(E,a)}}function g(v,w){if(!v.dem||v.dem.borderReady)return;v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0;let E=w.tileID.canonical.x-v.tileID.canonical.x;const C=w.tileID.canonical.y-v.tileID.canonical.y,k=Math.pow(2,v.tileID.canonical.z),O=w.tileID.key;E===0&&C===0||Math.abs(C)>1||(Math.abs(E)>1&&(Math.abs(E+k)===1?E+=k:Math.abs(E-k)===1&&(E-=k)),w.dem&&v.dem&&(v.dem.backfillBorder(w.dem,E,C),v.neighboringTiles&&v.neighboringTiles[O]&&(v.neighboringTiles[O].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,h,g,v){for(const w in this._tiles){let E=this._tiles[w];if(v[w]||!E.hasData()||E.tileID.overscaledZ<=h||E.tileID.overscaledZ>g)continue;let C=E.tileID;for(;E&&E.tileID.overscaledZ>h+1;){const O=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[O.key],E&&E.hasData()&&(C=O)}let k=C;for(;k.overscaledZ>h;)if(k=k.scaledTo(k.overscaledZ-1),a[k.key]){v[C.key]=C;break}}}findLoadedParent(a,h){if(a.key in this._loadedParentTiles){const g=this._loadedParentTiles[a.key];return g&&g.tileID.overscaledZ>=h?g:null}for(let g=a.overscaledZ-1;g>=h;g--){const v=a.scaledTo(g),w=this._getLoadedTile(v);if(w)return w}}_getLoadedTile(a){const h=this._tiles[a.key];return h&&h.hasData()?h:this._cache.getByKey(this._source.reparseOverscaled?a.wrapped().key:a.canonical.key)}updateCacheSize(a,h){h=h||this._source.tileSize;const g=Math.ceil(a.width/h)+1,v=Math.ceil(a.height/h)+1,w=Math.floor(g*v*5),E=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,w):w,C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(C)}handleWrapJump(a){const h=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,h){const g={};for(const v in this._tiles){const w=this._tiles[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+h),g[w.tileID.key]=w}this._tiles=g;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(+v,this._tiles[v])}}update(a,h,g,v){if(this.transform=a,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!g)return;let w;if(this.updateCacheSize(a,h),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)w=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new l.ap(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y));else if(this.tileCoverLift!==0){const k=a.clone();k.tileCoverLift=this.tileCoverLift,w=k.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&a.projection.name==="globe"&&(w.push(new l.ap(1,0,1,0,0)),w.push(new l.ap(1,0,1,1,0)),w.push(new l.ap(1,0,1,0,1)),w.push(new l.ap(1,0,1,1,1)))}else w=a.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(w=w.filter(k=>this._source.hasTile(k)));else w=[];if(w.length>0&&this.castsShadows&&v&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!yl(this._source.type)){const k=a.coveringZoomLevel({tileSize:h||this._source.tileSize,roundZoom:this._source.roundZoom&&!g}),O=Math.min(k,this._source.maxzoom),F=a.extendTileCoverForShadows(w,v,O);for(const B of F)this._shadowCasterTiles[B.key]=!0,w.push(B)}const E=this._updateRetainedTiles(w);if(yl(this._source.type)&&w.length!==0){const k={},O={},F=Object.keys(E);for(const $ of F){const G=E[$],X=this._tiles[$];if(!X||X.fadeEndTime&&X.fadeEndTime<=l.f.now())continue;const Z=this.findLoadedParent(G,Math.max(G.overscaledZ-Mo.maxOverzooming,this._source.minzoom));Z&&(this._addTile(Z.tileID),k[Z.tileID.key]=Z.tileID),O[$]=G}const B=w[w.length-1].overscaledZ;for(const $ in this._tiles){const G=this._tiles[$];if(E[$]||!G.hasData())continue;let X=G.tileID;for(;X.overscaledZ>B;){X=X.scaledTo(X.overscaledZ-1);const Z=this._tiles[X.key];if(Z&&Z.hasData()&&O[X.key]){E[$]=G.tileID;break}}}for(const $ in k)E[$]||(this._coveredTiles[$]=!0,E[$]=k[$])}for(const k in E)this._tiles[k].clearFadeHold();const C=l.b3(this._tiles,E);for(const k of C){const O=this._tiles[k];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(+k)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(+a)}_updateRetainedTiles(a){const h={};if(a.length===0)return h;const g={},v=a.reduce((O,F)=>Math.min(O,F.overscaledZ),1/0),w=a[0].overscaledZ,E=Math.max(w-Mo.maxOverzooming,this._source.minzoom),C=Math.max(w+Mo.maxUnderzooming,this._source.minzoom),k={};for(const O of a){const F=this._addTile(O);h[O.key]=O,F.hasData()||v<this._source.maxzoom&&(k[O.key]=O)}this._retainLoadedChildren(k,v,C,h);for(const O of a){let F=this._tiles[O.key];if(F.hasData())continue;if(O.canonical.z>=this._source.maxzoom){const $=O.children(this._source.maxzoom)[0],G=this.getTile($);if(G&&G.hasData()){h[$.key]=$;continue}}else{const $=O.children(this._source.maxzoom);if(h[$[0].key]&&h[$[1].key]&&h[$[2].key]&&h[$[3].key])continue}let B=F.wasRequested();for(let $=O.overscaledZ-1;$>=E;--$){const G=O.scaledTo($);if(g[G.key]||(g[G.key]=!0,F=this.getTile(G),!F&&B&&(F=this._addTile(G)),F&&(h[G.key]=G,B=F.wasRequested(),F.hasData())))break}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const h=[];let g,v=this._tiles[a].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){g=this._loadedParentTiles[v.key];break}h.push(v.key);const w=v.scaledTo(v.overscaledZ-1);if(g=this._getLoadedTile(w),g)break;v=w}for(const w of h)this._loadedParentTiles[w]=g}}_addTile(a){let h=this._tiles[a.key];if(h)return h.isExtraShadowCaster!==!0||this._shadowCasterTiles[a.key]||this._reloadTile(a.key,"reloading"),h;h=this._cache.getAndRemove(a),h&&(this._setTileReloadTimer(a.key,h),h.tileID=a,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,h)));const g=!!h;if(!g){const v=this.map?this.map.painter:null,w=this._source.tileSize*a.overscaleFactor();h=this._source.type==="raster-array"?new Rh(a,w,this.transform.tileZoom,v,this._isRaster):new Po(a,w,this.transform.tileZoom,v,this._isRaster),this._loadTile(h,this._tileLoaded.bind(this,h,a.key,h.state))}return h?(h.uses++,this._tiles[a.key]=h,g||this._source.fire(new l.b("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null}_setTileReloadTimer(a,h){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const g=h.getExpiryTimeout();g&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},g))}_removeTile(a){const h=this._tiles[a];h&&(h.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),h.uses>0||(h.hasData()&&h.state!=="reloading"||h.state==="empty"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(+a);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(a,h,g){const v=[],w=this.transform;if(!w)return v;const E=w.projection.name==="globe",C=l.a8(w.center.lng);for(const k in this._tiles){const O=this._tiles[k];if(g&&O.clearQueryDebugViz(),O.holdingForFade())continue;let F;if(E){const B=O.tileID.canonical;if(B.z===0){const $=[Math.abs(l.ad(C,...Ta(B,-1))-C),Math.abs(l.ad(C,...Ta(B,1))-C)];F=[0,2*$.indexOf(Math.min(...$))-1]}else{const $=[Math.abs(l.ad(C,...Ta(B,-1))-C),Math.abs(l.ad(C,...Ta(B,0))-C),Math.abs(l.ad(C,...Ta(B,1))-C)];F=[$.indexOf(Math.min(...$))-1]}}else F=[0];for(const B of F){const $=a.containsTile(O,w,h,B);$&&v.push($)}}return v}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(a){return this._getRenderableCoordinates(a)}_getRenderableCoordinates(a,h){const g=this.getRenderableIds(a,h).map(w=>this._tiles[w].tileID),v=this.transform.projection.name==="globe";for(const w of g)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped()),w.expandedProjMatrix=v?this.transform.calculateProjMatrix(w.toUnwrapped(),!1,!0):w.projMatrix;return g}sortCoordinatesByDistance(a){const h=a.slice(),g=this.transform._camera.position,v=this.transform._camera.forward(),w={};for(const E of h){const C=1/(1<<E.canonical.z);w[E.key]=((E.canonical.x+.5)*C+E.wrap-g[0])*v[0]+((E.canonical.y+.5)*C-g[1])*v[1]-g[2]*v[2]}return h.sort((E,C)=>w[E.key]-w[C.key]),h}hasTransition(){if(this._source.hasTransition())return!0;if(yl(this._source.type))for(const a in this._tiles){const h=this._tiles[a];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=l.f.now())return!0}return!1}setFeatureState(a,h,g){this._state.updateState(a=a||"_geojsonTileLayer",h,g)}removeFeatureState(a,h,g){this._state.removeFeatureState(a=a||"_geojsonTileLayer",h,g)}getFeatureState(a,h){return this._state.getState(a=a||"_geojsonTileLayer",h)}setDependencies(a,h,g){const v=this._tiles[a];v&&v.setDependencies(h,g)}reloadTilesForDependencies(a,h){for(const g in this._tiles)this._tiles[g].hasDependency(a,h)&&this._reloadTile(+g,"reloading");this._cache.filter(g=>!g.hasDependency(a,h))}_preloadTiles(a,h){if(!this._sourceLoaded){const k=()=>{this._sourceLoaded&&(this._source.off("data",k),this._preloadTiles(a,h))};return void this._source.on("data",k)}const g=new Map,v=Array.isArray(a)?a:[a],w=this.map.painter.terrain,E=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const k of v){const O=k.coveringTiles({tileSize:E,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of O)g.set(F.key,F);this.usedForTerrain&&k.updateElevation(!1)}const C=Array.from(g.values());l.b4(C,(k,O)=>{const F=new Po(k,this._source.tileSize*k.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(F,B=>{this._source.type==="raster-dem"&&F.dem&&this._backfillDEM(F),O(B,F)})},h)}}function ti(m,a){const h=Math.abs(2*m.wrap)-+(m.wrap<0),g=Math.abs(2*a.wrap)-+(a.wrap<0);return m.overscaledZ-a.overscaledZ||g-h||a.canonical.y-m.canonical.y||a.canonical.x-m.canonical.x}function yl(m){return m==="raster"||m==="image"||m==="video"||m==="custom"}function Ta(m,a){const h=1<<m.z;return[m.x/h+a,(m.x+1)/h+a]}Mo.maxOverzooming=10,Mo.maxUnderzooming=3;class ta{constructor(a){this.style=a,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const a=!1,h=!1;for(const g in this.style._mergedLayers){const v=this.style._mergedLayers[g];if(v.type==="fill-extrusion")this.layers.push({layer:v,visible:a,visibilityChanged:h});else if(v.type==="model"){const w=this.style.getLayerSource(v);w&&w.type==="batched-model"&&this.layers.push({layer:v,visible:a,visibilityChanged:h})}}}onNewFrame(a){this.layersGotHidden=!1;for(const h of this.layers){const g=h.layer;let v=!1;g.type==="fill-extrusion"?v=!g.isHidden(a)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="model"&&(v=!g.isHidden(a)&&g.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!v&&h.visible,h.visible=v}}updateZOffset(a,h){this.currentBuildingBuckets=[];for(const v of this.layers){const w=v.layer,E=this.style.getLayerSourceCache(w);let C=1;w.type==="fill-extrusion"&&(C=v.visible?w.paint.get("fill-extrusion-vertical-scale"):0);let k=E?E.getTile(h):null;if(!k&&E&&h.canonical.z>E.getSource().minzoom){let O=h.scaledTo(Math.min(E.getSource().maxzoom,h.overscaledZ-1));for(;O.overscaledZ>=E.getSource().minzoom&&(k=E.getTile(O),!k&&O.overscaledZ!==0);)O=O.scaledTo(O.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:k?k.getBucket(w):null,tileID:k?k.tileID:h,verticalScale:C})}a.hasAnyZOffset=!1;let g=!1;for(let v=0;v<a.symbolInstances.length;v++){const w=a.symbolInstances.get(v),E=w.zOffset,C=this._getHeightAtTileOffset(h,w.tileAnchorX,w.tileAnchorY);w.zOffset=C!==Number.NEGATIVE_INFINITY?C:E,g||E===w.zOffset||(g=!0),a.hasAnyZOffset||w.zOffset===0||(a.hasAnyZOffset=!0)}g&&(a.zOffsetBuffersNeedUpload=!0,a.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(a,h,g,v){let w=h,E=g;if(a.canonical.z!==v.canonical.z){const C=v.canonical,k=1/(1<<a.canonical.z-C.z);w=(h+a.canonical.x*l.Y)*k-C.x*l.Y|0,E=(g+a.canonical.y*l.Y)*k-C.y*l.Y|0}return{tileX:w,tileY:E}}_getHeightAtTileOffset(a,h,g){let v,w;for(let E=0;E<this.layers.length;++E){if(this.layers[E].layer.type!=="fill-extrusion")continue;const{bucket:C,tileID:k,verticalScale:O}=this.currentBuildingBuckets[E];if(!C)continue;const{tileX:F,tileY:B}=this._mapCoordToOverlappingTile(a,h,g,k),$=C.getHeightAtTileCoord(F,B);$&&$.height!==void 0&&($.hidden?v=$.height:w=Math.max($.height*O,w||0))}if(w!==void 0)return w;for(let E=0;E<this.layers.length;++E){const C=this.layers[E];if(C.layer.type!=="model"||!C.visible)continue;const{bucket:k,tileID:O}=this.currentBuildingBuckets[E];if(!k)continue;const{tileX:F,tileY:B}=this._mapCoordToOverlappingTile(a,h,g,O),$=k.getHeightAtTileCoord(F,B);if($&&!$.hidden)return $.height===void 0&&v!==void 0?Math.min($.maxHeight,v)*$.verticalScale:$.height?$.height*$.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function _o(m,a){const h={};for(const g in m)g!=="ref"&&(h[g]=m[g]);return l.b5.forEach(g=>{g in a&&(h[g]=a[g])}),h}function Em(m){m=m.slice();const a=Object.create(null);for(let h=0;h<m.length;h++)a[m[h].id]=m[h];for(let h=0;h<m.length;h++)"ref"in m[h]&&(m[h]=_o(m[h],a[m[h].ref]));return m}const pi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Ru(m,a,h){h.push({command:pi.addSource,args:[m,a[m]]})}function Pu(m,a,h){a.push({command:pi.removeSource,args:[m]}),h[m]=!0}function Mu(m,a,h,g){Pu(m,h,g),Ru(m,a,h)}function Ph(m,a,h){let g;for(g in m[h])if(m[h].hasOwnProperty(g)&&g!=="data"&&!S(m[h][g],a[h][g]))return!1;for(g in a[h])if(a[h].hasOwnProperty(g)&&g!=="data"&&!S(m[h][g],a[h][g]))return!1;return!0}function Ea(m,a,h,g,v,w){let E;for(E in a=a||{},m=m||{})m.hasOwnProperty(E)&&(S(m[E],a[E])||h.push({command:w,args:[g,E,a[E],v]}));for(E in a)a.hasOwnProperty(E)&&!m.hasOwnProperty(E)&&(S(m[E],a[E])||h.push({command:w,args:[g,E,a[E],v]}))}function Dc(m){return m.id}function Lc(m,a){return m[a.id]=a,m}class go{constructor(a,h){this.reset(a,h)}reset(a,h){this.points=a||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=l.ad(a,0,1);let h=1,g=this._distances[h];const v=a*this.paddedLength+this.padding;for(;g<v&&h<this._distances.length;)g=this._distances[++h];const w=h-1,E=this._distances[w],C=g-E,k=C>0?(v-E)/C:0;return this.points[w].mult(1-k).add(this.points[h].mult(k))}}class Mh{constructor(a,h,g){const v=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(a/g),this.yCellCount=Math.ceil(h/g);for(let E=0;E<this.xCellCount*this.yCellCount;E++)v.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=h,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,h,g,v,w){this._forEachCell(h,g,v,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(w)}insertCircle(a,h,g,v){this._forEachCell(h-v,g-v,h+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(h),this.circles.push(g),this.circles.push(v)}_insertBoxCell(a,h,g,v,w,E){this.boxCells[w].push(E)}_insertCircleCell(a,h,g,v,w,E){this.circleCells[w].push(E)}_query(a,h,g,v,w,E){if(g<0||a>this.width||v<0||h>this.height)return!w&&[];const C=[];if(a<=0&&h<=0&&this.width<=g&&this.height<=v){if(w)return!0;for(let k=0;k<this.boxKeys.length;k++)C.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const O=this.circles[3*k],F=this.circles[3*k+1],B=this.circles[3*k+2];C.push({key:this.circleKeys[k],x1:O-B,y1:F-B,x2:O+B,y2:F+B})}return E?C.filter(E):C}return this._forEachCell(a,h,g,v,this._queryCell,C,{hitTest:w,seenUids:{box:{},circle:{}}},E),w?C.length>0:C}_queryCircle(a,h,g,v,w){const E=a-g,C=a+g,k=h-g,O=h+g;if(C<0||E>this.width||O<0||k>this.height)return!v&&[];const F=[];return this._forEachCell(E,k,C,O,this._queryCellCircle,F,{hitTest:v,circle:{x:a,y:h,radius:g},seenUids:{box:{},circle:{}}},w),v?F.length>0:F}query(a,h,g,v,w){return this._query(a,h,g,v,!1,w)}hitTest(a,h,g,v,w){return this._query(a,h,g,v,!0,w)}hitTestCircle(a,h,g,v){return this._queryCircle(a,h,g,!0,v)}_queryCell(a,h,g,v,w,E,C,k){const O=C.seenUids,F=this.boxCells[w];if(F!==null){const $=this.bboxes;for(const G of F)if(!O.box[G]){O.box[G]=!0;const X=4*G;if(a<=$[X+2]&&h<=$[X+3]&&g>=$[X+0]&&v>=$[X+1]&&(!k||k(this.boxKeys[G]))){if(C.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[G],x1:$[X],y1:$[X+1],x2:$[X+2],y2:$[X+3]})}}}const B=this.circleCells[w];if(B!==null){const $=this.circles;for(const G of B)if(!O.circle[G]){O.circle[G]=!0;const X=3*G;if(this._circleAndRectCollide($[X],$[X+1],$[X+2],a,h,g,v)&&(!k||k(this.circleKeys[G]))){if(C.hitTest)return E.push(!0),!0;{const Z=$[X],Y=$[X+1],K=$[X+2];E.push({key:this.circleKeys[G],x1:Z-K,y1:Y-K,x2:Z+K,y2:Y+K})}}}}}_queryCellCircle(a,h,g,v,w,E,C,k){const O=C.circle,F=C.seenUids,B=this.boxCells[w];if(B!==null){const G=this.bboxes;for(const X of B)if(!F.box[X]){F.box[X]=!0;const Z=4*X;if(this._circleAndRectCollide(O.x,O.y,O.radius,G[Z+0],G[Z+1],G[Z+2],G[Z+3])&&(!k||k(this.boxKeys[X])))return E.push(!0),!0}}const $=this.circleCells[w];if($!==null){const G=this.circles;for(const X of $)if(!F.circle[X]){F.circle[X]=!0;const Z=3*X;if(this._circlesCollide(G[Z],G[Z+1],G[Z+2],O.x,O.y,O.radius)&&(!k||k(this.circleKeys[X])))return E.push(!0),!0}}}_forEachCell(a,h,g,v,w,E,C,k){const O=this._convertToXCellCoord(a),F=this._convertToYCellCoord(h),B=this._convertToXCellCoord(g),$=this._convertToYCellCoord(v);for(let G=O;G<=B;G++)for(let X=F;X<=$;X++)if(w.call(this,a,h,g,v,this.xCellCount*X+G,E,C,k))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,h,g,v,w,E){const C=v-a,k=w-h,O=g+E;return O*O>C*C+k*k}_circleAndRectCollide(a,h,g,v,w,E,C){const k=(E-v)/2,O=Math.abs(a-(v+k));if(O>k+g)return!1;const F=(C-w)/2,B=Math.abs(h-(w+F));if(B>F+g)return!1;if(O<=k||B<=F)return!0;const $=O-k,G=B-F;return $*$+G*G<=g*g}}const gn={unknown:0,flipRequired:1,flipNotRequired:2},Aa=Math.tan(85*Math.PI/180);function Ql(m,a,h,g,v,w,E){const C=l.a9.create();if(h)if(w.name==="globe"){const k=l.b6(v,a);l.a9.multiply(C,C,k)}else{const k=l.b7.invert([],E);C[0]=k[0],C[1]=k[1],C[4]=k[2],C[5]=k[3],g||l.a9.rotateZ(C,C,v.angle)}else l.a9.multiply(C,v.labelPlaneMatrix,m);return C}function Oc(m,a,h,g,v,w,E){const C=Ql(m,a,h,g,v,w,E);return w.name==="globe"&&h||(C[2]=C[6]=C[10]=C[14]=0),C}function ko(m,a,h,g,v,w,E){if(h){if(w.name==="globe"){const C=Ql(m,a,h,g,v,w,E);return l.a9.invert(C,C),l.a9.multiply(C,m,C),C}{const C=l.a9.clone(m),k=l.a9.identity([]);return k[0]=E[0],k[1]=E[1],k[4]=E[2],k[5]=E[3],l.a9.multiply(C,C,k),g||l.a9.rotateZ(C,C,-v.angle),C}}return v.glCoordMatrix}function eo(m,a,h,g){const v=[m,a,h,1];h?l.aa.transformMat4(v,v,g):bl(v,v,g);const w=v[3];return v[0]/=w,v[1]/=w,v[2]/=w,v}function ku(m,a){return Math.min(.5+m/a*.5,1.5)}function Ia(m,a){const h=m[0]/m[3],g=m[1]/m[3];return h>=-a[0]&&h<=a[0]&&g>=-a[1]&&g<=a[1]}function Du(m,a,h,g,v,w,E,C,k,O){const F=h.transform,B=g?m.textSizeData:m.iconSizeData,$=l.b8(B,h.transform.zoom),G=F.projection.name==="globe",X=[256/h.width*2+1,256/h.height*2+1],Z=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;Z.clear();let Y=null;G&&(Y=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const K=m.lineVertexArray,ne=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,fe=h.transform.width/h.transform.height;let de,ye=!1;for(let J=0;J<ne.length;J++){const ae=ne.get(J),{numGlyphs:ke,writingMode:Re}=ae;if(Re!==l.b9.vertical||ye||de===l.b9.horizontal||(ye=!0),de=Re,(ae.hidden||Re===l.b9.vertical)&&!ye){xl(ke,Z);continue}ye=!1;const Ne=new l.P(ae.tileAnchorX,ae.tileAnchorY);let{x:et,y:ze,z:Qe}=F.projection.projectTilePoint(Ne.x,Ne.y,O.canonical);if(k){const[Zt,ir,fr]=k(Ne);et+=Zt,ze+=ir,Qe+=fr}const it=[et,ze,Qe,1];if(l.aa.transformMat4(it,it,a),!Ia(it,X)){xl(ke,Z);continue}const Oe=it[3],He=ku(h.transform.getCameraToCenterDistance(F.projection),Oe),Tt=l.ba(B,$,ae),Ue=E?Tt/He:Tt*He,Je=eo(et,ze,Qe,v);if(Je[3]<=0){xl(ke,Z);continue}let rt={};const me=E?null:k,vt=Kl(ae,Ue,!1,C,a,v,w,m.glyphOffsetArray,K,Z,Y,Je,Ne,rt,fe,me,F.projection,O,E);ye=vt.useVertical,me&&vt.needsFlipping&&(rt={}),(vt.notEnoughRoom||ye||vt.needsFlipping&&Kl(ae,Ue,!0,C,a,v,w,m.glyphOffsetArray,K,Z,Y,Je,Ne,rt,fe,me,F.projection,O,E).notEnoughRoom)&&xl(ke,Z)}g?(m.text.dynamicLayoutVertexBuffer.updateData(Z),Y&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(Y)):(m.icon.dynamicLayoutVertexBuffer.updateData(Z),Y&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(Y))}function zc(m,a,h,g,v,w,E,C,k,O,F,B,$,G,X,Z){const{lineStartIndex:Y,glyphStartIndex:K,segment:ne}=C,fe=K+C.numGlyphs,de=Y+C.lineLength,ye=a.getoffsetX(K),J=a.getoffsetX(fe-1),ae=vl(m*ye,h,g,v,w,E,ne,Y,de,k,O,F,B,$,!0,G,X,Z);if(!ae)return null;const ke=vl(m*J,h,g,v,w,E,ne,Y,de,k,O,F,B,$,!0,G,X,Z);return ke?{first:ae,last:ke}:null}function Xa(m,a,h,g){return m===l.b9.horizontal&&Math.abs(g)>Math.abs(h)?{useVertical:!0}:m===l.b9.vertical?g>0?{needsFlipping:!0}:null:a!==gn.unknown&&function(v,w){return v===0||Math.abs(w/v)>Aa}(h,g)?a===gn.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function Kl(m,a,h,g,v,w,E,C,k,O,F,B,$,G,X,Z,Y,K,ne){const fe=a/24,de=m.lineOffsetX*fe,ye=m.lineOffsetY*fe,{lineStartIndex:J,glyphStartIndex:ae,numGlyphs:ke,segment:Re,writingMode:Ne,flipState:et}=m,ze=J+m.lineLength,Qe=it=>{if(F){const[Ue,Je,rt]=it.up,me=O.length;l.bb(F,me+0,Ue,Je,rt),l.bb(F,me+1,Ue,Je,rt),l.bb(F,me+2,Ue,Je,rt),l.bb(F,me+3,Ue,Je,rt)}const[Oe,He,Tt]=it.point;l.bc(O,Oe,He,Tt,it.angle)};if(ke>1){const it=zc(fe,C,de,ye,h,B,$,m,k,w,G,Z,!1,Y,K,ne);if(!it)return{notEnoughRoom:!0};if(g&&!h){let[Oe,He,Tt]=it.first.point,[Ue,Je,rt]=it.last.point;[Oe,He]=eo(Oe,He,Tt,E),[Ue,Je]=eo(Ue,Je,rt,E);const me=Xa(Ne,et,(Ue-Oe)*X,Je-He);if(m.flipState=me&&me.needsFlipping?gn.flipRequired:gn.flipNotRequired,me)return me}Qe(it.first);for(let Oe=ae+1;Oe<ae+ke-1;Oe++){const He=vl(fe*C.getoffsetX(Oe),de,ye,h,B,$,Re,J,ze,k,w,G,Z,!1,!1,Y,K,ne);if(!He)return O.length-=4*(Oe-ae),{notEnoughRoom:!0};Qe(He)}Qe(it.last)}else{if(g&&!h){const Oe=eo($.x,$.y,0,v),He=J+Re+1,Tt=new l.P(k.getx(He),k.gety(He)),Ue=eo(Tt.x,Tt.y,0,v),Je=Ue[3]>0?Ue:Bs($,Tt,Oe,1,v,void 0,Y,K.canonical),rt=Xa(Ne,et,(Je[0]-Oe[0])*X,Je[1]-Oe[1]);if(m.flipState=rt&&rt.needsFlipping?gn.flipRequired:gn.flipNotRequired,rt)return rt}const it=vl(fe*C.getoffsetX(ae),de,ye,h,B,$,Re,J,ze,k,w,G,Z,!1,!1,Y,K,ne);if(!it)return{notEnoughRoom:!0};Qe(it)}return{}}function Jl(m,a,h,g,v){const{x:w,y:E,z:C}=g.projectTilePoint(m.x,m.y,a);if(!v)return eo(w,E,C,h);const[k,O,F]=v(m);return eo(w+k,E+O,C+F,h)}function Bs(m,a,h,g,v,w,E,C){const k=Jl(m.sub(a)._unit()._add(m),C,v,E,w);return l.Q.sub(k,h,k),l.Q.normalize(k,k),l.Q.scaleAndAdd(k,h,k,g)}function vl(m,a,h,g,v,w,E,C,k,O,F,B,$,G,X,Z,Y,K){const ne=g?m-a:m+a;let fe=ne>0?1:-1,de=0;g&&(fe*=-1,de=Math.PI),fe<0&&(de+=Math.PI);let ye=C+E+(fe>0?0:1)|0,J=v,ae=v,ke=0,Re=0;const Ne=Math.abs(ne),et=[],ze=[];let Qe=w,it=Qe;const Oe=()=>Bs(it,Qe,ae,Ne-ke+1,F,$,Z,Y.canonical);for(;ke+Re<=Ne;){if(ye+=fe,ye<C||ye>=k)return null;if(ae=J,it=Qe,et.push(ae),G&&ze.push(it),Qe=new l.P(O.getx(ye),O.gety(ye)),J=B[ye],!J){const ir=Jl(Qe,Y.canonical,F,Z,$);J=ir[3]>0?B[ye]=ir:Oe()}ke+=Re,Re=l.Q.distance(ae,J)}X&&$&&(B[ye]&&(J=Oe(),Re=l.Q.distance(ae,J)),B[ye]=J);const He=(Ne-ke)/Re,Tt=Qe.sub(it)._mult(He)._add(it),Ue=l.Q.sub([],J,ae),Je=l.Q.scaleAndAdd([],ae,Ue,He);let rt=[0,0,1],me=Ue[0],vt=Ue[1];if(K&&(rt=Z.upVector(Y.canonical,Tt.x,Tt.y),rt[0]!==0||rt[1]!==0||rt[2]!==1)){const ir=[rt[2],0,-rt[0]],fr=l.Q.cross([],rt,ir);l.Q.normalize(ir,ir),l.Q.normalize(fr,fr),me=l.Q.dot(Ue,ir),vt=l.Q.dot(Ue,fr)}if(h){const ir=l.Q.cross([],rt,Ue);l.Q.normalize(ir,ir),l.Q.scaleAndAdd(Je,Je,ir,h*fe)}const Zt=de+Math.atan2(vt,me);return et.push(Je),G&&ze.push(Tt),{point:Je,angle:Zt,path:et,tilePath:ze,up:rt}}function xl(m,a){const h=a.length,g=h+4*m;a.resize(g),a.float32.fill(-1/0,4*h,4*g)}function bl(m,a,h){const g=a[0],v=a[1];return m[0]=h[0]*g+h[4]*v+h[12],m[1]=h[1]*g+h[5]*v+h[13],m[3]=h[3]*g+h[7]*v+h[15],m}const M=100;class q{constructor(a,h,g=new Mh(a.width+200,a.height+200,25),v=new Mh(a.width+200,a.height+200,25)){this.transform=a,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+M,this.screenBottomBoundary=a.height+M,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=h}placeCollisionBox(a,h,g,v,w,E,C,k){let O=g.projectedAnchorX,F=g.projectedAnchorY,B=g.projectedAnchorZ;const $=g.elevation,G=g.tileID,X=a.getProjection();if($&&G){const[J,ae,ke]=X.upVector(G.canonical,g.tileAnchorX,g.tileAnchorY),Re=X.upVectorScale(G.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=J*$*Re,F+=ae*$*Re,B+=ke*$*Re}const Z=this.projectAndGetPerspectiveRatio(C,O,F,B,g.tileID,X.name==="globe"||!!$||this.transform.pitch>0,X),Y=E*Z.perspectiveRatio,K=(g.x1*h+v.x-g.padding)*Y+Z.point.x,ne=(g.y1*h+v.y-g.padding)*Y+Z.point.y,fe=(g.x2*h+v.x+g.padding)*Y+Z.point.x,de=(g.y2*h+v.y+g.padding)*Y+Z.point.y,ye=Z.perspectiveRatio<=.55||Z.occluded;return!this.isInsideGrid(K,ne,fe,de)||!w&&this.grid.hitTest(K,ne,fe,de,k)||ye?{box:[],offscreen:!1,occluded:Z.occluded}:{box:[K,ne,fe,de],offscreen:this.isOffscreen(K,ne,fe,de),occluded:!1}}placeCollisionCircles(a,h,g,v,w,E,C,k,O,F,B,$,G,X,Z){const Y=[],K=this.transform.elevation,ne=a.getProjection(),fe=K?K.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,ne):null,de=new l.P(g.tileAnchorX,g.tileAnchorY);let{x:ye,y:J,z:ae}=ne.projectTilePoint(de.x,de.y,Z.canonical);if(fe){const[Tt,Ue,Je]=fe(de);ye+=Tt,J+=Ue,ae+=Je}const ke=ne.name==="globe",Re=this.projectAndGetPerspectiveRatio(C,ye,J,ae,Z,ke||!!K||this.transform.pitch>0,ne),{perspectiveRatio:Ne}=Re,et=(B?E/Ne:E*Ne)/l.bf,ze=eo(ye,J,ae,k),Qe=Re.signedDistanceFromCamera>0?zc(et,w,g.lineOffsetX*et,g.lineOffsetY*et,!1,ze,de,g,v,k,{},K&&!B?fe:null,B&&!!K,ne,Z,B):null;let it=!1,Oe=!1,He=!0;if(Qe&&!Re.occluded){const Tt=.5*G*Ne+X,Ue=new l.P(-100,-100),Je=new l.P(this.screenRightBoundary,this.screenBottomBoundary),rt=new go,{first:me,last:vt}=Qe,Zt=me.path.length;let ir=[];for(let vr=Zt-1;vr>=1;vr--)ir.push(me.path[vr]);for(let vr=1;vr<vt.path.length;vr++)ir.push(vt.path[vr]);const fr=2.5*Tt;O&&(ir=ir.map(([vr,hi,zr],vi)=>(fe&&!ke&&(zr=fe(vi<Zt-1?me.tilePath[Zt-1-vi]:vt.tilePath[vi-Zt+2])[2]),eo(vr,hi,zr,O))),ir.some(vr=>vr[3]<=0)&&(ir=[]));let cr=[];if(ir.length>0){let vr=1/0,hi=-1/0,zr=1/0,vi=-1/0;for(const di of ir)vr=Math.min(vr,di[0]),zr=Math.min(zr,di[1]),hi=Math.max(hi,di[0]),vi=Math.max(vi,di[1]);hi>=Ue.x&&vr<=Je.x&&vi>=Ue.y&&zr<=Je.y&&(cr=[ir.map(di=>new l.P(di[0],di[1]))],(vr<Ue.x||hi>Je.x||zr<Ue.y||vi>Je.y)&&(cr=l.bd(cr,Ue.x,Ue.y,Je.x,Je.y)))}for(const vr of cr){rt.reset(vr,.25*Tt);let hi=0;hi=rt.length<=.5*Tt?1:Math.ceil(rt.paddedLength/fr)+1;for(let zr=0;zr<hi;zr++){const vi=zr/Math.max(hi-1,1),di=rt.lerp(vi),yn=di.x+M,Vi=di.y+M;Y.push(yn,Vi,Tt,0);const Jn=yn-Tt,Un=Vi-Tt,Yi=yn+Tt,ji=Vi+Tt;if(He=He&&this.isOffscreen(Jn,Un,Yi,ji),Oe=Oe||this.isInsideGrid(Jn,Un,Yi,ji),!h&&this.grid.hitTestCircle(yn,Vi,Tt,$)&&(it=!0,!F))return{circles:[],offscreen:!1,collisionDetected:it,occluded:!1}}}}return{circles:!F&&it||!Oe?[]:Y,offscreen:He,collisionDetected:it,occluded:Re.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let g=1/0,v=1/0,w=-1/0,E=-1/0;for(const F of a){const B=new l.P(F.x+M,F.y+M);g=Math.min(g,B.x),v=Math.min(v,B.y),w=Math.max(w,B.x),E=Math.max(E,B.y),h.push(B)}const C=this.grid.query(g,v,w,E).concat(this.ignoredGrid.query(g,v,w,E)),k={},O={};for(const F of C){const B=F.key;if(k[B.bucketInstanceId]===void 0&&(k[B.bucketInstanceId]={}),k[B.bucketInstanceId][B.featureIndex])continue;const $=[new l.P(F.x1,F.y1),new l.P(F.x2,F.y1),new l.P(F.x2,F.y2),new l.P(F.x1,F.y2)];l.be(h,$)&&(k[B.bucketInstanceId][B.featureIndex]=!0,O[B.bucketInstanceId]===void 0&&(O[B.bucketInstanceId]=[]),O[B.bucketInstanceId].push(B.featureIndex))}return O}insertCollisionBox(a,h,g,v,w){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:w},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,h,g,v,w){const E=h?this.ignoredGrid:this.grid,C={bucketInstanceId:g,featureIndex:v,collisionGroupID:w};for(let k=0;k<a.length;k+=4)E.insertCircle(C,a[k],a[k+1],a[k+2])}projectAndGetPerspectiveRatio(a,h,g,v,w,E,C){const k=[h,g,v,1];let O=!1;v||this.transform.pitch>0?(l.aa.transformMat4(k,k,a),this.fogState&&w&&C.name!=="globe"&&(O=function($,G,X,Z,Y,K){const ne=K.calculateFogTileMatrix(Y),fe=[G,X,Z];return l.Q.transformMat4(fe,fe,ne),ni($,l.Q.length(fe),K.pitch,K._fov)}(this.fogState,h,g,v,w.toUnwrapped(),this.transform)>.9)):bl(k,k,a);const F=k[3];return{point:new l.P((k[0]/F+1)/2*this.transform.width+M,(-k[1]/F+1)/2*this.transform.height+M),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/F*.5,1.5),signedDistanceFromCamera:F,occluded:E&&k[2]>F||O}}isOffscreen(a,h,g,v){return g<M||a>=this.screenRightBoundary||v<M||h>this.screenBottomBoundary}isInsideGrid(a,h,g,v){return g>=0&&a<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const a=l.a9.identity([]);return l.a9.translate(a,a,[-100,-100,0]),a}}function ee(m,a,h){const g=a.createTileMatrix(m,m.worldSize,h.toUnwrapped());return l.a9.multiply(new Float32Array(16),m.projMatrix,g)}function ve(m,a,h){if(a.projection.name===h.projection.name)return m.projMatrix;const g=h.clone();return g.setProjection(a.projection),ee(g,a.getProjection(),m)}function ht(m,a,h){return a.name===h.projection.name?m.projMatrix:ee(h,a,m)}class Pt{constructor(a,h,g,v){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?h:-h))):v&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class ur{constructor(a,h,g,v,w,E=!1){this.text=new Pt(a?a.text:null,h,g,w),this.icon=new Pt(a?a.icon:null,h,v,w),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class an{constructor(a,h,g,v=!1){this.text=a,this.icon=h,this.skipFade=g,this.clipped=v}}class fs{constructor(){this.invProjMatrix=l.a9.create(),this.viewportMatrix=l.a9.create(),this.circles=[]}}class ki{constructor(a,h,g,v,w){this.bucketInstanceId=a,this.featureIndex=h,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=w}}class ns{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const h=++this.maxGroupID;this.collisionGroups[a]={ID:h,predicate:g=>g.collisionGroupID===h}}return this.collisionGroups[a]}}function ps(m,a,h,g,v){const{horizontalAlign:w,verticalAlign:E}=l.bi(m),C=-(w-.5)*a,k=-(E-.5)*h,O=l.bh(m,g);return new l.P(C+O[0]*v,k+O[1]*v)}function ra(m,a,h,g,v){const w=new l.P(m,a);return h&&w._rotate(g?v:-v),w}class yo{constructor(a,h,g,v,w,E){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new q(this.transform,w),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new ns(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,h,g,v){const w=g.getBucket(h),E=g.latestFeatureIndex;if(!w||!E||h.fqid!==w.layerIds[0])return;const C=w.layers[0].layout,k=g.collisionBoxArray,O=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),F=g.tileSize/l.Y,B=g.tileID.toUnwrapped();this.transform.setProjection(w.projection);const $=(G=g.tileID,X=w.getProjection(),Z=this.transform,X.name===this.projection?Z.calculateProjMatrix(G.toUnwrapped()):ee(Z,X,G));var G,X,Z;const Y=C.get("text-pitch-alignment")==="map",K=C.get("text-rotation-alignment")==="map";h.compileFilter();const ne=h.dynamicFilter(),fe=h.dynamicFilterNeedsFeature(),de=this.transform.calculatePixelsToTileUnitsMatrix(g),ye=Oc($,g.tileID.canonical,Y,K,this.transform,w.getProjection(),de);let J=null;if(Y){const Re=ko($,g.tileID.canonical,Y,K,this.transform,w.getProjection(),de);J=l.a9.multiply([],this.transform.labelPlaneMatrix,Re)}let ae=null;ne&&g.latestFeatureIndex&&(ae={unwrappedTileID:B,dynamicFilter:ne,dynamicFilterNeedsFeature:fe,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new ki(w.bucketInstanceId,E,w.sourceLayerIndex,w.index,g.tileID);const ke={bucket:w,layout:C,posMatrix:$,textLabelPlaneMatrix:ye,labelToScreenMatrix:J,clippingData:ae,scale:O,textPixelRatio:F,holdingForFade:g.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:l.b8(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:l.b8(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(v)for(const Re of w.sortKeyRanges){const{sortKey:Ne,symbolInstanceStart:et,symbolInstanceEnd:ze}=Re;a.push({sortKey:Ne,symbolInstanceStart:et,symbolInstanceEnd:ze,parameters:ke})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:ke})}attemptAnchorPlacement(a,h,g,v,w,E,C,k,O,F,B,$,G,X,Z,Y,K,ne){const{textOffset0:fe,textOffset1:de,crossTileID:ye}=$,J=[fe,de],ae=ps(a,g,v,J,w),ke=this.collisionIndex.placeCollisionBox(X,w,h,ra(ae.x,ae.y,E,C,this.transform.angle),B,k,O,F.predicate);if(Y){const Re=X.getSymbolInstanceIconSize(ne,this.transform.zoom,$.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(X,Re,Y,ra(ae.x,ae.y,E,C,this.transform.angle),B,k,O,F.predicate).box.length===0)return}if(ke.box.length>0){let Re;return this.prevPlacement&&this.prevPlacement.variableOffsets[ye]&&this.prevPlacement.placements[ye]&&this.prevPlacement.placements[ye].text&&(Re=this.prevPlacement.variableOffsets[ye].anchor),this.variableOffsets[ye]={textOffset:J,width:g,height:v,anchor:a,textScale:w,prevAnchor:Re},this.markUsedJustification(X,a,$,Z),X.allowVerticalPlacement&&(this.markUsedOrientation(X,Z,$),this.placedOrientations[ye]=Z),{shift:ae,placedGlyphBoxes:ke}}}placeLayerBucketPart(a,h,g,v){const{bucket:w,layout:E,posMatrix:C,textLabelPlaneMatrix:k,labelToScreenMatrix:O,clippingData:F,textPixelRatio:B,holdingForFade:$,collisionBoxArray:G,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:Z,collisionGroup:Y}=a.parameters,K=E.get("text-optional"),ne=E.get("icon-optional"),fe=E.get("text-allow-overlap"),de=E.get("icon-allow-overlap"),ye=E.get("text-rotation-alignment")==="map",J=E.get("text-pitch-alignment")==="map",ae=E.get("symbol-z-order")==="viewport-y",ke=E.get("symbol-z-elevate");this.transform.setProjection(w.projection);let Re=fe&&(de||!w.hasIconData()||ne),Ne=de&&(fe||!w.hasTextData()||K);!w.collisionArrays&&G&&w.deserializeCollisionBoxes(G),g&&v&&w.updateCollisionDebugBuffers(this.transform.zoom,G);const et=(ze,Qe,it)=>{const{crossTileID:Oe,numVerticalGlyphVertices:He}=ze;if(F){const Yi={zoom:this.transform.zoom,pitch:this.transform.pitch};let ji=null;if(F.dynamicFilterNeedsFeature){const Xr=this.retainedQueryData[w.bucketInstanceId];ji=F.featureIndex.loadFeature({featureIndex:ze.featureIndex,bucketIndex:Xr.bucketIndex,sourceLayerIndex:Xr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,F.dynamicFilter)(Yi,ji,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new l.P(ze.tileAnchorX,ze.tileAnchorY),this.transform.calculateDistanceTileData(F.unwrappedTileID)))return this.placements[Oe]=new an(!1,!1,!1,!0),void h.add(Oe)}if(h.has(Oe))return;if($)return void(this.placements[Oe]=new an(!1,!1,!1));let Tt=!1,Ue=!1,Je=!0,rt=!1,me=!1,vt=null,Zt={box:null,offscreen:null,occluded:null},ir={box:null,offscreen:null,occluded:null},fr=null,cr=null,vr=null,hi=0,zr=0,vi=0;it.textFeatureIndex?hi=it.textFeatureIndex:ze.useRuntimeCollisionCircles&&(hi=ze.featureIndex),it.verticalTextFeatureIndex&&(zr=it.verticalTextFeatureIndex);const di=Yi=>{Yi.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const ji=this.transform.elevation;Yi.elevation=ze.zOffset+(ji?ji.getAtTileOffset(Yi.tileID,Yi.tileAnchorX,Yi.tileAnchorY):0)},yn=it.textBox;if(yn){di(yn);const Yi=Xr=>{let Qr=l.b9.horizontal;if(w.allowVerticalPlacement&&!Xr&&this.prevPlacement){const ln=this.prevPlacement.placedOrientations[Oe];ln&&(this.placedOrientations[Oe]=ln,Qr=ln,this.markUsedOrientation(w,Qr,ze))}return Qr},ji=(Xr,Qr)=>{if(w.allowVerticalPlacement&&He>0&&it.verticalTextBox){for(const ln of w.writingModes)if(ln===l.b9.vertical?(Zt=Qr(),ir=Zt):Zt=Xr(),Zt&&Zt.box&&Zt.box.length)break}else Zt=Xr()};if(E.get("text-variable-anchor")){let Xr=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Oe]){const Qi=this.prevPlacement.variableOffsets[Oe];Xr.indexOf(Qi.anchor)>0&&(Xr=Xr.filter(oi=>oi!==Qi.anchor),Xr.unshift(Qi.anchor))}const Qr=(Qi,oi,Gr)=>{const vo=w.getSymbolInstanceTextSize(X,ze,this.transform.zoom,Qe),js=(Qi.x2-Qi.x1)*vo+2*Qi.padding,_s=(Qi.y2-Qi.y1)*vo+2*Qi.padding,$s=ze.hasIconTextFit&&!de?oi:null;$s&&di($s);let xo={box:[],offscreen:!1,occluded:!1};const to=fe?2*Xr.length:Xr.length;for(let gs=0;gs<to;++gs){const Cs=this.attemptAnchorPlacement(Xr[gs%Xr.length],Qi,js,_s,vo,ye,J,B,C,Y,gs>=Xr.length,ze,Qe,w,Gr,$s,X,Z);if(Cs&&(xo=Cs.placedGlyphBoxes,xo&&xo.box&&xo.box.length)){Tt=!0,vt=Cs.shift;break}}return xo};ji(()=>Qr(yn,it.iconBox,l.b9.horizontal),()=>{const Qi=it.verticalTextBox;return Qi&&di(Qi),w.allowVerticalPlacement&&!(Zt&&Zt.box&&Zt.box.length)&&He>0&&Qi?Qr(Qi,it.verticalIconBox,l.b9.vertical):{box:null,offscreen:null,occluded:null}}),Zt&&(Tt=Zt.box,Je=Zt.offscreen,rt=Zt.occluded);const ln=Yi(!(!Zt||!Zt.box));if(!Tt&&this.prevPlacement){const Qi=this.prevPlacement.variableOffsets[Oe];Qi&&(this.variableOffsets[Oe]=Qi,this.markUsedJustification(w,Qi.anchor,ze,ln))}}else{const Xr=(Qr,ln)=>{const Qi=w.getSymbolInstanceTextSize(X,ze,this.transform.zoom,Qe),oi=this.collisionIndex.placeCollisionBox(w,Qi,Qr,new l.P(0,0),fe,B,C,Y.predicate);return oi&&oi.box&&oi.box.length&&(this.markUsedOrientation(w,ln,ze),this.placedOrientations[Oe]=ln),oi};ji(()=>Xr(yn,l.b9.horizontal),()=>{const Qr=it.verticalTextBox;return w.allowVerticalPlacement&&He>0&&Qr?(di(Qr),Xr(Qr,l.b9.vertical)):{box:null,offscreen:null,occluded:null}}),Yi(!!(Zt&&Zt.box&&Zt.box.length))}}if(fr=Zt,Tt=fr&&fr.box&&fr.box.length>0,Je=fr&&fr.offscreen,rt=fr&&fr.occluded,ze.useRuntimeCollisionCircles){const Yi=w.text.placedSymbolArray.get(ze.centerJustifiedTextSymbolIndex>=0?ze.centerJustifiedTextSymbolIndex:ze.verticalPlacedTextSymbolIndex),ji=l.ba(w.textSizeData,X,Yi),Xr=E.get("text-padding");cr=this.collisionIndex.placeCollisionCircles(w,fe,Yi,w.lineVertexArray,w.glyphOffsetArray,ji,C,k,O,g,J,Y.predicate,ze.collisionCircleDiameter*ji/l.bf,Xr,this.retainedQueryData[w.bucketInstanceId].tileID),Tt=fe||cr.circles.length>0&&!cr.collisionDetected,Je=Je&&cr.offscreen,rt=cr.occluded}if(it.iconFeatureIndex&&(vi=it.iconFeatureIndex),it.iconBox){const Yi=ji=>{di(ji);const Xr=ze.hasIconTextFit&&vt?ra(vt.x,vt.y,ye,J,this.transform.angle):new l.P(0,0),Qr=w.getSymbolInstanceIconSize(Z,this.transform.zoom,ze.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Qr,ji,Xr,de,B,C,Y.predicate)};ir&&ir.box&&ir.box.length&&it.verticalIconBox?(vr=Yi(it.verticalIconBox),Ue=vr.box.length>0):(vr=Yi(it.iconBox),Ue=vr.box.length>0),Je=Je&&vr.offscreen,me=vr.occluded}const Vi=K||ze.numHorizontalGlyphVertices===0&&He===0,Jn=ne||ze.numIconVertices===0;if(Vi||Jn?Jn?Vi||(Ue=Ue&&Tt):Tt=Ue&&Tt:Ue=Tt=Ue&&Tt,Tt&&fr&&fr.box&&this.collisionIndex.insertCollisionBox(fr.box,E.get("text-ignore-placement"),w.bucketInstanceId,ir&&ir.box&&zr?zr:hi,Y.ID),Ue&&vr&&this.collisionIndex.insertCollisionBox(vr.box,E.get("icon-ignore-placement"),w.bucketInstanceId,vi,Y.ID),cr&&(Tt&&this.collisionIndex.insertCollisionCircles(cr.circles,E.get("text-ignore-placement"),w.bucketInstanceId,hi,Y.ID),g)){const Yi=w.bucketInstanceId;let ji=this.collisionCircleArrays[Yi];ji===void 0&&(ji=this.collisionCircleArrays[Yi]=new fs);for(let Xr=0;Xr<cr.circles.length;Xr+=4)ji.circles.push(cr.circles[Xr+0]),ji.circles.push(cr.circles[Xr+1]),ji.circles.push(cr.circles[Xr+2]),ji.circles.push(cr.collisionDetected?1:0)}const Un=w.projection.name!=="globe";Re=Re&&(Un||!rt),Ne=Ne&&(Un||!me),this.placements[Oe]=new an(Tt||Re,Ue||Ne,Je||w.justReloaded),h.add(Oe)};if(ke&&this.buildingIndex&&(this.buildingIndex.updateZOffset(w,this.retainedQueryData[w.bucketInstanceId].tileID),w.updateZOffset()),ae){const ze=w.getSortedSymbolIndexes(this.transform.angle);for(let Qe=ze.length-1;Qe>=0;--Qe){const it=ze[Qe];et(w.symbolInstances.get(it),it,w.collisionArrays[it])}w.hasAnyZOffset&&l.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const ze=w.getSortedIndexesByZOffset();for(let Qe=0;Qe<ze.length;++Qe){const it=ze[Qe];et(w.symbolInstances.get(it),it,w.collisionArrays[it])}}else for(let ze=a.symbolInstanceStart;ze<a.symbolInstanceEnd;ze++)et(w.symbolInstances.get(ze),ze,w.collisionArrays[ze]);if(g&&w.bucketInstanceId in this.collisionCircleArrays){const ze=this.collisionCircleArrays[w.bucketInstanceId];l.a9.invert(ze.invProjMatrix,C),ze.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(a,h,g,v){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:k,crossTileID:O}=g,F=l.bg(h),B=v===l.b9.vertical?k:F==="left"?w:F==="center"?E:F==="right"?C:-1;w>=0&&(a.text.placedSymbolArray.get(w).crossTileID=B>=0&&w!==B?0:O),E>=0&&(a.text.placedSymbolArray.get(E).crossTileID=B>=0&&E!==B?0:O),C>=0&&(a.text.placedSymbolArray.get(C).crossTileID=B>=0&&C!==B?0:O),k>=0&&(a.text.placedSymbolArray.get(k).crossTileID=B>=0&&k!==B?0:O)}markUsedOrientation(a,h,g){const v=h===l.b9.horizontal||h===l.b9.horizontalOnly?h:0,w=h===l.b9.vertical?h:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:O}=g,F=a.text.placedSymbolArray;E>=0&&(F.get(E).placedOrientation=v),C>=0&&(F.get(C).placedOrientation=v),k>=0&&(F.get(k).placedOrientation=v),O>=0&&(F.get(O).placedOrientation=w)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let g=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const v=h?h.symbolFadeChange(a):1,w=h?h.opacities:{},E=h?h.variableOffsets:{},C=h?h.placedOrientations:{};for(const k in this.placements){const O=this.placements[k],F=w[k];F?(this.opacities[k]=new ur(F,v,O.text,O.icon,null,O.clipped),g=g||O.text!==F.text.placed||O.icon!==F.icon.placed):(this.opacities[k]=new ur(null,v,O.text,O.icon,O.skipFade,O.clipped),g=g||O.text||O.icon)}for(const k in w){const O=w[k];if(!this.opacities[k]){const F=new ur(O,v,!1,!1);F.isHidden()||(this.opacities[k]=F,g=g||O.text.placed||O.icon.placed)}}for(const k in E)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=E[k]);for(const k in C)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=C[k]);g?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:a)}updateLayerOpacities(a,h){const g=new Set;for(const v of h){const w=v.getBucket(a);w&&v.latestFeatureIndex&&a.fqid===w.layerIds[0]&&(this.updateBucketOpacities(w,g,v.collisionBoxArray),w.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(w,v.tileID),w.updateZOffset()))}}updateBucketOpacities(a,h,g){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const v=a.layers[0].layout,w=!!a.layers[0].dynamicFilter(),E=new ur(null,0,!1,!1,!0),C=v.get("text-allow-overlap"),k=v.get("icon-allow-overlap"),O=v.get("text-variable-anchor"),F=v.get("text-rotation-alignment")==="map",B=v.get("text-pitch-alignment")==="map",$=new ur(null,0,C&&(k||!a.hasIconData()||v.get("icon-optional")),k&&(C||!a.hasTextData()||v.get("text-optional")),!0);!a.collisionArrays&&g&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(g);const G=(Z,Y,K)=>{for(let ne=0;ne<Y/4;ne++)Z.opacityVertexArray.emplaceBack(K)};let X=0;for(let Z=0;Z<a.symbolInstances.length;Z++){const Y=a.symbolInstances.get(Z),{numHorizontalGlyphVertices:K,numVerticalGlyphVertices:ne,crossTileID:fe,numIconVertices:de}=Y,ye=h.has(fe);let J=this.opacities[fe];ye?J=E:J||(J=$,this.opacities[fe]=J),h.add(fe);const ae=K>0||ne>0,ke=de>0,Re=this.placedOrientations[fe],Ne=Re===l.b9.vertical,et=Re===l.b9.horizontal||Re===l.b9.horizontalOnly;if(!ae&&!ke||J.isHidden()||X++,ae){const ze=Im(J.text);G(a.text,K,Ne?Dh:ze),G(a.text,ne,et?Dh:ze);const Qe=J.text.isHidden(),{leftJustifiedTextSymbolIndex:it,centerJustifiedTextSymbolIndex:Oe,rightJustifiedTextSymbolIndex:He,verticalPlacedTextSymbolIndex:Tt}=Y,Ue=a.text.placedSymbolArray,Je=Qe||Ne?1:0;it>=0&&(Ue.get(it).hidden=Je),Oe>=0&&(Ue.get(Oe).hidden=Je),He>=0&&(Ue.get(He).hidden=Je),Tt>=0&&(Ue.get(Tt).hidden=Qe||et?1:0);const rt=this.variableOffsets[fe];rt&&this.markUsedJustification(a,rt.anchor,Y,Re);const me=this.placedOrientations[fe];me&&(this.markUsedJustification(a,"left",Y,me),this.markUsedOrientation(a,me,Y))}if(ke){const ze=Im(J.icon),{placedIconSymbolIndex:Qe,verticalPlacedIconSymbolIndex:it}=Y,Oe=a.icon.placedSymbolArray,He=J.icon.isHidden()?1:0;Qe>=0&&(G(a.icon,de,Ne?Dh:ze),Oe.get(Qe).hidden=He),it>=0&&(G(a.icon,Y.numVerticalIconVertices,et?Dh:ze),Oe.get(it).hidden=He)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const ze=a.collisionArrays[Z];if(ze){let Qe=new l.P(0,0),it=!0;if(ze.textBox||ze.verticalTextBox){if(O){const He=this.variableOffsets[fe];He?(Qe=ps(He.anchor,He.width,He.height,He.textOffset,He.textScale),F&&Qe._rotate(B?this.transform.angle:-this.transform.angle)):it=!1}w&&(it=!J.clipped),ze.textBox&&Sa(a.textCollisionBox.collisionVertexArray,J.text.placed,!it||Ne,Qe.x,Qe.y),ze.verticalTextBox&&Sa(a.textCollisionBox.collisionVertexArray,J.text.placed,!it||et,Qe.x,Qe.y)}const Oe=it&&!!(!et&&ze.verticalIconBox);ze.iconBox&&Sa(a.iconCollisionBox.collisionVertexArray,J.icon.placed,Oe,Y.hasIconTextFit?Qe.x:0,Y.hasIconTextFit?Qe.y:0),ze.verticalIconBox&&Sa(a.iconCollisionBox.collisionVertexArray,J.icon.placed,!Oe,Y.hasIconTextFit?Qe.x:0,Y.hasIconTextFit?Qe.y:0)}}}if(a.fullyClipped=X===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const Z=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=Z.invProjMatrix,a.placementViewportMatrix=Z.viewportMatrix,a.collisionCircleArray=Z.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,h){const g=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*g>a}setStale(){this.stale=!0}}function Sa(m,a,h,g,v){m.emplaceBack(a?1:0,h?1:0,g||0,v||0),m.emplaceBack(a?1:0,h?1:0,g||0,v||0),m.emplaceBack(a?1:0,h?1:0,g||0,v||0),m.emplaceBack(a?1:0,h?1:0,g||0,v||0)}const ec=Math.pow(2,25),kh=Math.pow(2,24),h0=Math.pow(2,17),V1=Math.pow(2,16),U1=Math.pow(2,9),j1=Math.pow(2,8),Am=Math.pow(2,1);function Im(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const a=m.placed?1:0,h=Math.floor(127*m.opacity);return h*ec+a*kh+h*h0+a*V1+h*U1+a*j1+h*Am+a}const Dh=0;class vf{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,h,g,v,w){const E=this._bucketParts;for(;this._currentTileIndex<a.length;)if(h.getBucketParts(E,v,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((C,k)=>C.sortKey-k.sortKey));this._currentPartIndex<E.length;){const C=E[this._currentPartIndex];if(h.placeLayerBucketPart(C,this._seenCrossTileIDs,g,C.symbolInstanceStart===0),this._currentPartIndex++,w())return!0}return!1}}class xf{constructor(a,h,g,v,w,E,C,k,O){this.placement=new yo(a,w,E,C,k,O),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(a,h,g,v){const w=l.f.now(),E=()=>{const C=l.f.now()-w;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=h[a[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=k)&&(!C.maxzoom||C.maxzoom>k)){const O=C,F=O.layout.get("symbol-z-elevate"),B=this._inProgressLayer=this._inProgressLayer||new vf(O),$=l.aj(C.source,C.scope);if(B.continuePlacement(F?v[$]:g[$],this.placement,this._showCollisionBoxes,C,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const d0=512/l.Y/2;class $1{constructor(a,h,g){this.tileID=a,this.bucketInstanceId=g,this.index=new l.bj(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=a.canonical.x*l.Y,w=a.canonical.y*l.Y;for(let E=0;E<h.length;E++){const{key:C,crossTileID:k,tileAnchorX:O,tileAnchorY:F}=h.get(E),B=Math.floor((v+O)*d0),$=Math.floor((w+F)*d0);this.index.add(B,$),this.keys.push(C),this.crossTileIDs.push(k)}this.index.finish()}findMatches(a,h,g){const v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),w=d0/Math.pow(2,h.canonical.z-this.tileID.canonical.z),E=h.canonical.x*l.Y,C=h.canonical.y*l.Y;for(let k=0;k<a.length;k++){const O=a.get(k);if(O.crossTileID)continue;const{key:F,tileAnchorX:B,tileAnchorY:$}=O,G=Math.floor((E+B)*w),X=Math.floor((C+$)*w),Z=this.index.range(G-v,X-v,G+v,X+v);for(const Y of Z){const K=this.crossTileIDs[Y];if(this.keys[Y]===F&&!g.has(K)){g.add(K),O.crossTileID=K;break}}}}}class Sm{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class bf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const h=Math.round((a-this.lng)/360);if(h!==0)for(const g in this.indexes){const v=this.indexes[g],w={};for(const E in v){const C=v[E];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+h),w[C.tileID.key]=C}this.indexes[g]=w}this.lng=a}addBucket(a,h,g){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let w=0;w<h.symbolInstances.length;w++)h.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const v=this.usedCrossTileIDs[a.overscaledZ];for(const w in this.indexes){const E=this.indexes[w];if(Number(w)>a.overscaledZ)for(const C in E){const k=E[C];k.tileID.isChildOf(a)&&k.findMatches(h.symbolInstances,a,v)}else{const C=E[a.scaledTo(Number(w)).key];C&&C.findMatches(h.symbolInstances,a,v)}}for(let w=0;w<h.symbolInstances.length;w++){const E=h.symbolInstances.get(w);E.crossTileID||(E.crossTileID=g.generate(),v.add(E.crossTileID))}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new $1(a,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(a,h){for(const g of h.crossTileIDs)this.usedCrossTileIDs[a].delete(g)}removeStaleBuckets(a){let h=!1;for(const g in this.indexes){const v=this.indexes[g];for(const w in v)a[v[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[w]),delete v[w],h=!0)}return h}}class f0{constructor(){this.layerIndexes={},this.crossTileIDs=new Sm,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,h,g,v){let w=this.layerIndexes[a.fqid];w===void 0&&(w=this.layerIndexes[a.fqid]=new bf);let E=!1;const C={};v.name!=="globe"&&w.handleWrapJump(g);for(const k of h){const O=k.getBucket(a);O&&a.fqid===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(k.tileID,O,this.crossTileIDs)&&(E=!0),C[O.bucketInstanceId]=!0)}return w.removeStaleBuckets(C)&&(E=!0),E}pruneUnusedLayers(a){const h={};a.forEach(g=>{h[g]=!0});for(const g in this.layerIndexes)h[g]||delete this.layerIndexes[g]}}class wf{constructor(a=0,h=0,g=0,v=0){if(isNaN(a)||a<0||isNaN(h)||h<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=h,this.left=g,this.right=v}interpolate(a,h,g){return h.top!=null&&a.top!=null&&(this.top=l.X(a.top,h.top,g)),h.bottom!=null&&a.bottom!=null&&(this.bottom=l.X(a.bottom,h.bottom,g)),h.left!=null&&a.left!=null&&(this.left=l.X(a.left,h.left,g)),h.right!=null&&a.right!=null&&(this.right=l.X(a.right,h.right,g)),this}getCenter(a,h){const g=l.ad((this.left+a-this.right)/2,0,a),v=l.ad((this.top+h-this.bottom)/2,0,h);return new l.P(g,v)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new wf(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Cm(m,a){const h=l.bn(m,3);l.a9.fromQuat(m,a),l.bp(m,3,h)}function p0(m,a){const h=l.bl.identity([]);return l.bl.rotateZ(h,h,-a),l.bl.rotateX(h,h,-m),h}function Ya(m,a){const h=[m[0],m[1],0],g=[a[0],a[1],0];if(l.Q.length(h)>=1e-15){const E=l.Q.normalize([],h);l.Q.scale(g,E,l.Q.dot(g,E)),a[0]=g[0],a[1]=g[1]}const v=l.Q.cross([],a,m);if(l.Q.len(v)<1e-15)return null;const w=Math.atan2(-v[1],v[0]);return p0(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),w)}class Lh{constructor(a,h){this.position=a,this.orientation=h}get position(){return this._position}set position(a){if(a){const h=a instanceof l.O?a:new l.O(a[0],a[1],a[2]);this._renderWorldCopies&&(h.x=l.bk(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(a,h){if(this.orientation=null,!this.position)return;const g=this.position,v=this._elevation?this._elevation.getAtPointOrZero(l.O.fromLngLat(a)):0,w=l.O.fromLngLat(a,v),E=[w.x-g.x,w.y-g.y,w.z-g.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Ya(E,h)}setPitchBearing(a,h){this.orientation=p0(l.bm(a),l.bm(-h))}}class Tf{constructor(a,h){this._transform=l.a9.identity([]),this.orientation=h,this.position=a}get mercatorPosition(){const a=this.position;return new l.O(a[0],a[1],a[2])}get position(){const a=l.bn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var h;a&&l.bp(this._transform,3,[(h=a)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||l.bl.identity([]),a&&Cm(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,h){this._orientation=p0(a,h),Cm(this._transform,this._orientation)}forward(){const a=l.bn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=l.bn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=l.bn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,h){const g=new Float64Array(16);return l.a9.invert(g,this.getWorldToCamera(a,h)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(a,h,g){const v=this.position;l.Q.scale(v,v,-a);const w=new Float64Array(16);return l.a9.fromScaling(w,[g,g,g]),l.a9.translate(w,w,v),w[10]*=h,w}getWorldToCamera(a,h){const g=new Float64Array(16),v=new Float64Array(4),w=this.position;return l.bl.conjugate(v,this._orientation),l.Q.scale(w,w,-a),l.a9.fromQuat(g,v),l.a9.translate(g,g,w),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=h,g[9]*=h,g[10]*=h,g[11]*=h,g}getCameraToClipPerspective(a,h,g,v){const w=new Float64Array(16);return l.a9.perspective(w,a,h,g,v),w}getCameraToClipOrthographic(a,h,g,v,w,E){const C=new Float64Array(16);return l.a9.ortho(C,a,h,g,v,w,E),C}getDistanceToElevation(a,h=!1){const g=a===0?0:l.bo(a,h?l.ax(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new Tf([...this.position],[...this.orientation])}}const m0=(m,a,h)=>(1-h)*m+h*a,Oh=m=>m*m*m*m*m;class Rm{constructor(a,h,g,v,w,E,C){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=a||0,this._maxZoom=h||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(E),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new l.bq(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new wf,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Tf,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const a=new Rm(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(a,h=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(a||g)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return l.af(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=l.br(this.projectionOptions);const g=!S(h,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(a){return this._orthographicProjectionAtLowPitch!==a&&(this._orthographicProjectionAtLowPitch=a,this._calcMatrices(),!0)}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=l.br({name:"mercator"});const h=a!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return l.bo(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return l.bk(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const h=-a*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=l.b7.create(),l.b7.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const h=l.ad(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=l.bm(a),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const h=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(a){this._tileCoverLift!==a&&(this._tileCoverLift=a)}_updateCameraOnTerrain(){const a=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&a===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||a===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const g=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=a||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let v=0,w=0;for(let E=0;E<h.length;E++){const C=new l.P(h[E][0]*this.width,g+h[E][1]*(this.height-g)),k=a.pointCoordinate(C);if(!k)continue;const O=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);v+=k[3]*O,w+=O}return w===0?NaN:v/w}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const a=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*h,v=this._mercatorZfromZoom(a),w=this._mercatorZfromZoom(this._maxZoom),E=Math.max(v-g,w);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let g;g=a.z<this._camera.position[2]?[h.x,h.y,h.z]:[a.x,a.y,a.z];const v=l.Q.length(l.Q.sub([],this._camera.position,g));return l.ad(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let h=!1;if(a.orientation&&!l.bl.exactEquals(a.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(a.orientation)),a.position){const g=[a.position.x,a.position.y,a.position.z];l.Q.exactEquals(g,this._camera.position)||(this._setCameraPosition(g),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,h=new Lh;return h.position=new l.O(a[0],a[1],a[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(a){if(!l.bl.length(a))return!1;l.bl.normalize(a,a);const h=l.Q.transformQuat([],[0,0,-1],a),g=l.Q.transformQuat([],[0,-1,0],a);if(g[2]<0)return!1;const v=Ya(h,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(a){const h=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;a[2]=l.ad(a[2],v/g,v/h),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,h,g){this._unmodified=!1,this._edgeInsets.interpolate(a,h,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const h=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(a){const h=[new l.bs(0,a)];if(this.renderWorldCopies){const g=this.pointCoordinate(new l.P(0,0)),v=this.pointCoordinate(new l.P(this.width,0)),w=this.pointCoordinate(new l.P(this.width,this.height)),E=this.pointCoordinate(new l.P(0,this.height)),C=Math.floor(Math.min(g.x,v.x,w.x,E.x)),k=Math.floor(Math.max(g.x,v.x,w.x,E.x)),O=1;for(let F=C-O;F<=k+O;F++)F!==0&&h.push(new l.bs(F,a))}return h}isLODDisabled(a){return(!a||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(a,h,g){let v=[];if(h[0]===0&&h[1]===0)return v;for(const E of a){const C=E.canonical,k=E.overscaledZ,O=E.wrap,F=1<<C.z,B=C.x+1<F,$=C.x>0,G=C.y+1<F,X=C.y>0,Z=E.wrap-($?0:1),Y=E.wrap+(B?0:1),K=$?C.x-1:F-1,ne=B?C.x+1:0;h[0]<0?(v.push(new l.ap(k,Y,C.z,ne,C.y)),h[1]<0&&G&&(v.push(new l.ap(k,O,C.z,C.x,C.y+1)),v.push(new l.ap(k,Y,C.z,ne,C.y+1))),h[1]>0&&X&&(v.push(new l.ap(k,O,C.z,C.x,C.y-1)),v.push(new l.ap(k,Y,C.z,ne,C.y-1)))):h[0]>0?(v.push(new l.ap(k,Z,C.z,K,C.y)),h[1]<0&&G&&(v.push(new l.ap(k,O,C.z,C.x,C.y+1)),v.push(new l.ap(k,Z,C.z,K,C.y+1))),h[1]>0&&X&&(v.push(new l.ap(k,O,C.z,C.x,C.y-1)),v.push(new l.ap(k,Z,C.z,K,C.y-1)))):h[1]<0&&G?v.push(new l.ap(k,O,C.z,C.x,C.y+1)):X&&v.push(new l.ap(k,O,C.z,C.x,C.y-1))}if(v.length>1){v.sort((k,O)=>k.overscaledZ-O.overscaledZ||k.wrap-O.wrap||k.canonical.z-O.canonical.z||k.canonical.x-O.canonical.x||k.canonical.y-O.canonical.y);let E=0,C=0;for(;C<v.length;)v[C].equals(v[E])?++C:v[++E]=v[C++];v.length=E+1}const w=[];for(const E of v)v.some(C=>E.isChildOf(C))||w.push(E);return v=w.filter(E=>!a.some(C=>!!(E.overscaledZ<g&&C.isChildOf(E))||E.equals(C)||E.isChildOf(C))),v}coveringTiles(a){let h=this.coveringZoomLevel(a);const g=h,v=this.elevation&&this.elevation.exaggeration(),w=v&&!a.isTerrainDEM,E=this.projection.name==="mercator";if(a.minzoom!==void 0&&h<a.minzoom)return[];a.maxzoom!==void 0&&h>a.maxzoom&&(h=a.maxzoom);const C=this.locationCoordinate(this.center),k=this.center.lat,O=1<<h,F=[O*C.x,O*C.y,0],B=this.projection.name==="globe",$=!B,G=l.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,$),X=B?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=O*l.bo(1,this.center.lat),Y=this._camera.position[2]/l.bo(1,this.center.lat),K=[O*X.x,O*X.y,Y*($?1:Z)],ne=B||v,fe=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),de=this.isLODDisabled(!0)?h:0;let ye;if(this._elevation&&a.isTerrainDEM)ye=1e4*this._elevation.exaggeration();else if(this._elevation){const Ue=this._elevation.getMinMaxForVisibleTiles();ye=Ue?Ue.max:this._centerAltitude}else ye=this._centerAltitude;const J=a.isTerrainDEM?-ye:this._elevation?this._elevation.getMinElevationBelowMSL():0,ae=this.projection.isReprojectedInTileSpace?l.bu(this):1,ke=Ue=>{const rt=new l.O(Ue.x+25e-6,Ue.y,Ue.z),me=new l.O(Ue.x,Ue.y+25e-6,Ue.z),vt=Ue.toLngLat(),Zt=rt.toLngLat(),ir=me.toLngLat(),fr=this.locationCoordinate(vt),cr=this.locationCoordinate(Zt),vr=this.locationCoordinate(ir),hi=Math.hypot(cr.x-fr.x,cr.y-fr.y),zr=Math.hypot(vr.x-fr.x,vr.y-fr.y);return Math.sqrt(hi*zr)*ae/25e-6},Re=Ue=>{const Je=ye,rt=J;return{aabb:l.bx(this,O,0,0,0,Ue,rt,Je,this.projection),zoom:0,x:0,y:0,minZ:rt,maxZ:Je,wrap:Ue,fullyVisible:!1}},Ne=[];let et=[];const ze=h,Qe=a.reparseOverscaled?g:h,it=Ue=>Ue*Ue,Oe=it((Y-this._centerAltitude)*Z),He=Ue=>{if(!this._elevation||!Ue.tileID||!E)return;const Je=this._elevation.getMinMaxForTile(Ue.tileID),rt=Ue.aabb;Je?(rt.min[2]=Je.min,rt.max[2]=Je.max,rt.center[2]=(rt.min[2]+rt.max[2])/2):(Ue.shouldSplit=Tt(Ue),Ue.shouldSplit||(rt.min[2]=rt.max[2]=rt.center[2]=this._centerAltitude))},Tt=Ue=>{if(Ue.zoom<de)return!0;if(Ue.zoom===ze)return!1;if(Ue.shouldSplit!=null)return Ue.shouldSplit;const Je=Ue.aabb.distanceX(K),rt=Ue.aabb.distanceY(K);let me=Oe,vt=1;if(B){me=it(Ue.aabb.distanceZ(K));const fr=Math.pow(2,Ue.zoom),cr=l.ax((Ue.y+1)/fr),vr=l.ax(Ue.y/fr),hi=Math.min(Math.max(k,cr),vr),zr=l.bM(hi)/l.bM(k);if(vt=hi===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,zr/this._mercatorScaleRatio),this.zoom<=l.bJ&&Ue.zoom===ze-1&&zr>=.9)return!0}else if(w&&(me=it(Ue.aabb.distanceZ(K)*Z)),this.projection.isReprojectedInTileSpace&&g<=5){const fr=Math.pow(2,Ue.zoom),cr=ke(new l.O((Ue.x+.5)/fr,(Ue.y+.5)/fr));vt=cr>.85?1:cr}const Zt=Je*Je+rt*rt+me,ir=it((1<<ze-Ue.zoom)*fe*vt*((fr,cr)=>{if(cr*it(.707)<fr)return 1;const vr=Math.sqrt(cr/fr);return vr/(1.4144271570014144+(Math.pow(1.1,vr-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(me,Oe),Zt));return Zt<ir};if(this.renderWorldCopies)for(let Ue=1;Ue<=3;Ue++)Ne.push(Re(-Ue)),Ne.push(Re(Ue));for(Ne.push(Re(0));Ne.length>0;){const Ue=Ne.pop(),Je=Ue.x,rt=Ue.y;let me=Ue.fullyVisible;const vt=()=>this.projection.name==="globe"&&(Ue.y===0||Ue.y===(1<<Ue.zoom)-1);if(!me){let Zt=ne?Ue.aabb.intersects(G):Ue.aabb.intersectsFlat(G);if(Zt===0&&vt()){const ir=new l.bv(Ue.zoom,Je,rt);Zt=l.bw(this,O,ir,!0).intersects(G)}if(Zt===0)continue;me=Zt===2}if(Ue.zoom!==ze&&Tt(Ue))for(let Zt=0;Zt<4;Zt++){const ir=(Je<<1)+Zt%2,fr=(rt<<1)+(Zt>>1),cr={aabb:E?Ue.aabb.quadrant(Zt):l.bx(this,O,Ue.zoom+1,ir,fr,Ue.wrap,Ue.minZ,Ue.maxZ,this.projection),zoom:Ue.zoom+1,x:ir,y:fr,wrap:Ue.wrap,fullyVisible:me,tileID:void 0,shouldSplit:void 0,minZ:Ue.minZ,maxZ:Ue.maxZ};w&&!B&&(cr.tileID=new l.ap(Ue.zoom+1===ze?Qe:Ue.zoom+1,Ue.wrap,Ue.zoom+1,ir,fr),He(cr)),Ne.push(cr)}else{const Zt=Ue.zoom===ze?Qe:Ue.zoom;if(a.minzoom&&a.minzoom>Zt)continue;if(!me){let vr=ne?Ue.aabb.intersectsPrecise(G):Ue.aabb.intersectsPreciseFlat(G);if(vr===0&&vt()){const hi=new l.bv(Ue.zoom,Je,rt);vr=l.bw(this,O,hi,!0).intersectsPrecise(G)}if(vr===0)continue}const ir=F[0]-(.5+Je+(Ue.wrap<<Ue.zoom))*(1<<h-Ue.zoom),fr=F[1]-.5-rt,cr=Ue.tileID?Ue.tileID:new l.ap(Zt,Ue.wrap,Ue.zoom,Je,rt);et.push({tileID:cr,distanceSq:ir*ir+fr*fr})}}if(this.fogCullDistSq){const Ue=this.fogCullDistSq,Je=this.horizonLineFromTop();et=et.filter(rt=>{const me=[0,0,0,1],vt=[l.Y,l.Y,0,1],Zt=this.calculateFogTileMatrix(rt.tileID.toUnwrapped());l.aa.transformMat4(me,me,Zt),l.aa.transformMat4(vt,vt,Zt);const ir=l.aa.min([],me,vt),fr=l.aa.max([],me,vt),cr=l.by(ir,fr);if(cr===0)return!0;let vr=!1;const hi=this._elevation;if(hi&&cr>Ue&&Je!==0){const zr=this.calculateProjMatrix(rt.tileID.toUnwrapped());let vi;a.isTerrainDEM||(vi=hi.getMinMaxForTile(rt.tileID)),vi||(vi={min:J,max:ye});const di=l.bK(this.rotation),yn=[di[0]*l.Y,di[1]*l.Y,vi.max];l.Q.transformMat4(yn,yn,zr),vr=(1-yn[1])*this.height*.5<Je}return cr<Ue||vr})}return et.sort((Ue,Je)=>Ue.distanceSq-Je.distanceSq).map(Ue=>Ue.tileID)}resize(a,h){this.width=a,this.height=h,this.pixelsToGLUnits=[2/a,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const h=l.ad(a.lat,-l.bz,l.bz),g=this.projection.project(a.lng,h);return new l.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/l.bo(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,h){let g,v;const w=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;g=(h.x-w.x)/C,v=(h.y-w.y)/C}else{const C=this.pointCoordinate(h),k=this.pointCoordinate(w);g=C.x-k.x,v=C.y-k.y}const E=this.locationCoordinate(a);this.setLocation(new l.O(E.x-g,E.y-v))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,h){const g=h?l.bo(h,a.lat):void 0,v=this.projection.project(a.lng,a.lat);return new l.O(v.x,v.y,g)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,h){const g=h??this._centerAltitude,v=[a.x,a.y,0,1],w=[a.x,a.y,1,1];l.aa.transformMat4(v,v,this.pixelMatrixInverse),l.aa.transformMat4(w,w,this.pixelMatrixInverse);const E=w[3];l.aa.scale(v,v,1/v[3]),l.aa.scale(w,w,1/E);const C=v[2],k=w[2];return{p0:v,p1:w,t:C===k?0:(g-C)/(k-C)}}screenPointToMercatorRay(a){const h=[a.x,a.y,0,1],g=[a.x,a.y,1,1];return l.aa.transformMat4(h,h,this.pixelMatrixInverse),l.aa.transformMat4(g,g,this.pixelMatrixInverse),l.aa.scale(h,h,1/h[3]),l.aa.scale(g,g,1/g[3]),h[2]=l.bo(h[2],this._center.lat)*this.worldSize,g[2]=l.bo(g[2],this._center.lat)*this.worldSize,l.aa.scale(h,h,1/this.worldSize),l.aa.scale(g,g,1/this.worldSize),new l.a5([h[0],h[1],h[2]],l.Q.normalize([],l.Q.sub([],g,h)))}rayIntersectionCoordinate(a){const{p0:h,p1:g,t:v}=a,w=l.bo(h[2],this._center.lat),E=l.bo(g[2],this._center.lat);return new l.O(l.X(h[0],g[0],v)/this.worldSize,l.X(h[1],g[1],v)/this.worldSize,l.X(w,E,v))}pointCoordinate(a,h=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,h)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let h=this.projection.pointCoordinate3D(this,a.x,a.y);if(h)return new l.O(h[0],h[1],h[2]);let g=0,v=this.horizonLineFromTop();if(a.y>v)return this.pointCoordinate(a);const w=.02*v,E=a.clone();for(let C=0;C<10&&v-g>w;C++){E.y=l.X(g,v,.66);const k=this.projection.pointCoordinate3D(this,E.x,E.y);k?(v=E.y,h=k):g=E.y}return h?new l.O(h[0],h[1],h[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=l.bA)return!this.isPointAboveHorizon(a);const h=this.pointCoordinate(a);return h.y>=0&&h.y<=1}_coordinatePoint(a,h){const g=h&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,v=[a.x*this.worldSize,a.y*this.worldSize,g+a.toAltitude(),1];return l.aa.transformMat4(v,v,this.pixelMatrix),v[3]>0?new l.P(v[0]/v[3],v[1]/v[3]):new l.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:h}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,w=this.pointLocation3D(new l.P(h,a)),E=this.pointLocation3D(new l.P(v,a)),C=this.pointLocation3D(new l.P(v,g)),k=this.pointLocation3D(new l.P(h,g));let O=Math.min(w.lng,E.lng,C.lng,k.lng),F=Math.max(w.lng,E.lng,C.lng,k.lng),B=Math.min(w.lat,E.lat,C.lat,k.lat),$=Math.max(w.lat,E.lat,C.lat,k.lat);const G=Math.pow(2,-this.zoom)/16*270,X=this.projection.name==="globe"?1:4,Z=(Y,K,ne,fe,de)=>{const ye=(Y+ne)/2,J=(K+fe)/2,ae=new l.P(ye,J),{lng:ke,lat:Re}=this.pointLocation3D(ae),Ne=Math.max(0,O-ke,B-Re,ke-F,Re-$);O=Math.min(O,ke),F=Math.max(F,ke),B=Math.min(B,Re),$=Math.max($,Re),(de<X||Ne>G)&&(Z(Y,K,ye,J,de+1),Z(ye,J,ne,fe,de+1))};if(Z(h,a,v,a,1),Z(v,a,v,g,1),Z(v,g,h,g,1),Z(h,g,h,a,1),this.projection.name==="globe"){const[Y,K]=l.bB(this);Y?($=90,F=180,O=-180):K&&(B=-90,F=180,O=-180)}return new l.ag(new l.bq(O,B),new l.bq(F,$))}_getBoundsRectangular(a,h){const{top:g,left:v}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,C=new l.P(v,g),k=new l.P(E,g),O=new l.P(E,w),F=new l.P(v,w);let B=this.pointCoordinate(C,a),$=this.pointCoordinate(k,a);const G=this.pointCoordinate(O,h),X=this.pointCoordinate(F,h),Z=(Y,K)=>(K.y-Y.y)/(K.x-Y.x);return B.y>1&&$.y>=0?B=new l.O((1-X.y)/Z(X,B)+X.x,1):B.y<0&&$.y<=1&&(B=new l.O(-X.y/Z(X,B)+X.x,0)),$.y>1&&B.y>=0?$=new l.O((1-G.y)/Z(G,$)+G.x,1):$.y<0&&B.y<=1&&($=new l.O(-G.y/Z(G,$)+G.x,0)),new l.ag().extend(this.coordinateLocation(B)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(G))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=a.visibleDemTiles.reduce((g,v)=>{if(v.dem){const w=v.dem.tree;g.min=Math.min(g.min,w.minimums[0]),g.max=Math.max(g.max,w.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*a.exaggeration(),h.max*a.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-h*(1-this._horizonShift);return a?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-l.bz,this.maxLat=l.bz,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=l.a8(this.minLng)*this.tileSize,this.worldMaxX=l.a8(this.maxLng)*this.tileSize,this.worldMinY=l.ah(this.maxLat)*this.tileSize,this.worldMaxY=l.ah(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,h){return this.projection.createTileMatrix(this,h,a)}calculateDistanceTileData(a){const h=a.key,g=this._distanceTileDataCache;if(g[h])return g[h];const v=a.canonical,w=1/this.height,E=this.cameraWorldSize,C=E/this.zoomScale(v.z),k=(v.x+Math.pow(2,v.z)*a.wrap)*C,O=v.y*C,F=this.point;F.x*=E/this.worldSize,F.y*=E/this.worldSize;const B=this.angle,$=Math.sin(-B),G=-Math.cos(-B);return g[h]={bearing:[$,G],center:[(F.x-k)*w,(F.y-O)*w],scale:C/l.Y*w},g[h]}calculateFogTileMatrix(a){const h=a.key,g=this._fogTileMatrixCache;if(g[h])return g[h];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return l.a9.multiply(v,this.worldToFogMatrix,v),g[h]=new Float32Array(v),g[h]}calculateProjMatrix(a,h=!1,g=!1){const v=a.key;let w;if(w=g?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,w[v])return w[v];const E=this.calculatePosMatrix(a,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,l.a9.multiply(E,C,E),w[v]=new Float32Array(E),w[v]}calculatePixelsToTileUnitsMatrix(a){const h=a.tileID.key,g=this._pixelsToTileUnitsCache;if(g[h])return g[h];const v=l.bC(a,this);return g[h]=v,g[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const a=1/this.worldSize,h=l.a9.fromScaling([],[a,a,a]);return l.a9.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const a=this._elevation;this._updateCameraState();const h=l.bo(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),v=this._camera.forward(),w=l.bo(1,this._center.lat);g[2]/=w,v[2]/=w,l.Q.normalize(v,v);const E=a.raycast(g,v,a.exaggeration());if(E){const C=l.Q.scaleAndAdd([],g,v,E),k=new l.O(C[0],C[1],l.bo(C[2],l.ax(C[1]))),O=(k.z+l.Q.length([k.x-g[0],k.y-g[1],k.z-g[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const h=this._elevation,g=l.bo(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),w=h.getAtPointOrZero(new l.O(...v)),E=this.pixelsPerMeter/this.worldSize*w,C=this._minimumHeightOverTerrain(),k=v[2]-E;if(k<=C)if(k<0||a){const O=this.locationCoordinate(this._center,this._centerAltitude),F=[v[0],v[1],O.z-v[2]],B=l.Q.length(F);F[2]-=(C-k)/this._pixelsPerMercatorPixel;const $=l.Q.length(F);if($===0)return;l.Q.scale(F,F,B/$*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],O.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const $=this.center;return $.lat=l.ad($.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&($.lng=l.ad($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}const h=this._unmodified,{x:g,y:v}=this.point;let w=0,E=g,C=v;const k=this.width/2,O=this.height/2,F=this.worldMinY*this.scale,B=this.worldMaxY*this.scale;if(v-O<F&&(C=F+O),v+O>B&&(C=B-O),B-F<this.height&&(w=Math.max(w,this.height/(B-F)),C=(B+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $=this.worldMinX*this.scale,G=this.worldMaxX*this.scale,X=this.worldSize/2-($+G)/2;E=(g+X+this.worldSize)%this.worldSize-X,E-k<$&&(E=$+k),E+k>G&&(E=G-k),G-$<this.width&&(w=Math.max(w,this.width/(G-$)),E=(G+$)/2)}E===g&&C===v||(this.center=this.unproject(new l.P(E,C))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,h=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=l.bo(1,this.center.lat)/l.bo(1,l.bL));const v=l.bD(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?g:1,E=this._camera.getWorldToCamera(this.worldSize,w);let C;const k=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(k[8]=2*-a.x/this.width,k[9]=2*a.y/this.height,this.isOrthographic){let Re=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ne=Re*this.aspect,et=-Ne,ze=-Re;Ne-=a.x,et-=a.x,Re+=a.y,ze+=a.y,C=this._camera.getCameraToClipOrthographic(et,Ne,ze,Re,this._nearZ,this._farZ),((Qe,it,Oe,He)=>{for(let Tt=0;Tt<16;Tt++)Qe[Tt]=m0(it[Tt],Oe[Tt],He)})(C,C,k,Oh(this.pitch>=15?1:this.pitch/15))}else C=k;const O=l.a9.mul([],k,E);let F=l.a9.mul([],C,E);if(this.projection.isReprojectedInTileSpace){const Re=this.locationCoordinate(this.center),Ne=l.a9.identity([]);l.a9.translate(Ne,Ne,[Re.x*this.worldSize,Re.y*this.worldSize,0]),l.a9.multiply(Ne,Ne,l.bE(this)),l.a9.translate(Ne,Ne,[-Re.x*this.worldSize,-Re.y*this.worldSize,0]),l.a9.multiply(F,F,Ne),l.a9.multiply(O,O,Ne),this.inverseAdjustmentMatrix=l.bF(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=l.a9.scale([],F,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=F,this.invProjMatrix=l.a9.invert(new Float64Array(16),this.projMatrix),h){const Re=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Re[8]=2*-a.x/this.width,Re[9]=2*a.y/this.height,this.expandedFarZProjMatrix=l.a9.mul([],Re,E)}else this.expandedFarZProjMatrix=this.projMatrix;const B=l.a9.invert([],C);this.frustumCorners=l.bG.fromInvProjectionMatrix(B,this.horizonLineFromTop(),this.height),this.cameraFrustum=l.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);const $=new Float32Array(16);l.a9.identity($),l.a9.scale($,$,[1,-1,1]),l.a9.rotateX($,$,this._pitch),l.a9.rotateZ($,$,this.angle);const G=l.a9.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=l.a9.clone(G);const X=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;G[8]=2*-a.x/this.width,G[9]=2*(a.y+X)/this.height,this.skyboxMatrix=l.a9.multiply($,G,$);const Z=this.point,Y=Z.x,K=Z.y,ne=this.width%2/2,fe=this.height%2/2,de=Math.cos(this.angle),ye=Math.sin(this.angle),J=Y-Math.round(Y)+de*ne+ye*fe,ae=K-Math.round(K)+de*fe+ye*ne,ke=new Float64Array(F);if(l.a9.translate(ke,ke,[J>.5?J-1:J,ae>.5?ae-1:ae,0]),this.alignedProjMatrix=ke,F=l.a9.create(),l.a9.scale(F,F,[this.width/2,-this.height/2,1]),l.a9.translate(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=l.a9.create(),l.a9.scale(F,F,[1,-1,1]),l.a9.translate(F,F,[-1,-1,0]),l.a9.scale(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=l.a9.multiply(new Float64Array(16),this.labelPlaneMatrix,O),this._calcFogMatrices(),this._distanceTileDataCache={},F=l.a9.invert(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=l.bH(this);const Re=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=l.Q.transformMat4(Re,Re,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,w=[a,a,h];l.Q.scale(w,w,v),l.Q.scale(g,g,-1),l.Q.multiply(g,g,w);const E=l.a9.create();l.a9.translate(E,E,g),l.a9.scale(E,E,w),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,h,v)}_computeCameraPosition(a){const h=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-a/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*w,v.y/this.worldSize-g[1]*w,a/this.worldSize*this._centerAltitude-g[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=a[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(w=Math.min((h-g)/v,1)),this._camera.position=l.Q.scaleAndAdd([],this._camera.position,a,w),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,h=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),w=l.bo(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(l.bm(this._maxPitch)),C=Math.max((a[2]-w)/Math.cos(g),E),k=this._zoomFromMercatorZ(C);l.Q.scaleAndAdd(a,a,h,C),this._pitch=l.ad(g,l.bm(this.minPitch),l.bm(this.maxPitch)),this.angle=l.bk(v,-Math.PI,Math.PI),this._setZoom(l.ad(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new l.O(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let h=0,g=l.bA,v=0,w=1/0;for(;g-h>1e-6&&g>h;){const E=h+.5*(g-h),C=this.tileSize*Math.pow(2,E),k=this.getCameraToCenterDistance(this.projection,E,C),O=this.scaleZoom(k/(a*this.tileSize)),F=Math.abs(E-O);F<w&&(w=F,v=E),E<O?h=E:g=E}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(l.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,h){const g=Math.min(a.x,h.x),v=Math.max(a.x,h.x),w=Math.min(a.y,h.y),E=Math.max(a.y,h.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new l.P(g,w),new l.P(v,E),new l.P(g,E),new l.P(v,w)],k=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const F of C){const B=this.pointRayIntersection(F);if(B.t<0)return!0;const $=this.rayIntersectionCoordinate(B);if($.x<k||$.y<0||$.x>O||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+l.bI(this.fovAboveCenter)>88||this.anyCornerOffEdge(new l.P(0,0),new l.P(this.width,this.height))}zoomDeltaToMovement(a,h){const g=l.Q.length(l.Q.sub([],this._camera.position,a)),v=this._zoomFromMercatorZ(g)+h;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const a=function([h,g,v],w){const E=[h,g,v,1];l.aa.transformMat4(E,E,w);const C=E[3]=Math.max(E[3],1e-6);return E[0]/=C,E[1]/=C,E[2]/=C,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new l.P(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,a))}}getCameraToCenterDistance(a,h=this.zoom,g=this.worldSize){const v=l.bD(a,h,this.width,this.height,1024),w=a.pixelSpaceConversion(this.center.lat,g,v);let E=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(E=m0(1,E,Oh(this.pitch>=15?1:this.pitch/15))),E}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&l.a9.multiply(a,a,this.globeMatrix),a}getFrustum(a){return l.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,this.projection.zAxisUnit==="meters")}}const Do={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},Fc=(m,a)=>{if(a>0&&m.terrain&&l.w("Cutoff is currently disabled on terrain"),a<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const h=m.transform,g=Math.max(Math.abs(h._zoom-(m.minCutoffZoom-1)),1),v=h.isLODDisabled(!1)?l.S(60,45,h.pitch):l.S(30,15,h.pitch),w=h._farZ-h._nearZ,E=a*h.height,C=((1-(k=v))*h.cameraToCenterDistance+k*(h._farZ+E))*g;var k;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(C-h._nearZ)/w,(C-E-h._nearZ)/w]}}},Lo={cascadeCount:2,shadowMapResolution:2048};class G1{constructor(a,h){this.aabb=a,this.lastCascade=h}}class $E{add(a,h){const g=this.receivers[a.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],h.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],h.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],h.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],h.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],h.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],h.max[2])):this.receivers[a.key]=new G1(h,null)}clear(){this.receivers={}}get(a){return this.receivers[a.key]}computeRequiredCascades(a,h,g){const v=l.bV.fromPoints(a.points);let w=0;for(const E in this.receivers){const C=this.receivers[E];if(!C||!v.intersectsAabb(C.aabb))continue;C.aabb.min=v.closestPoint(C.aabb.min),C.aabb.max=v.closestPoint(C.aabb.max);const k=C.aabb.getCorners();for(let O=0;O<g.length;O++){let F=!0;for(const B of k){const $=[B[0]*h,B[1]*h,B[2]];if(l.Q.transformMat4($,$,g[O].matrix),$[0]<-1||$[0]>1||$[1]<-1||$[1]>1){F=!1;break}}if(C.lastCascade=O,w=Math.max(w,O),F)break}}return w+1}}class q1{constructor(a){this.painter=a,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new $E,this._depthMode=new hr(a.context.gl.LEQUAL,hr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,a.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),a.tp.registerParameter(Lo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),a.tp.registerParameter(Lo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),a.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const a of this._cascades)a.texture.destroy(),a.framebuffer.destroy();this._cascades=[]}updateShadowParameters(a,h){const g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;const v=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||v<=0||(this._shadowLayerCount=g.style.order.reduce((X,Z)=>{const Y=g.style._mergedLayers[Z];return X+(Y.hasShadowPass()&&!Y.isHidden(a.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=g.context,E=Lo.shadowMapResolution,C=Lo.shadowMapResolution;if(this._cascades.length===0||Lo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let X=0;X<Lo.cascadeCount;++X){const Z=g._shadowMapDebug,Y=w.gl,K=w.createFramebuffer(E,C,Z,"texture"),ne=new l.T(w,{width:E,height:C,data:null},Y.DEPTH_COMPONENT);if(K.depthAttachment.set(ne.texture),Z){const fe=new l.T(w,{width:E,height:C,data:null},Y.RGBA);K.colorAttachment.set(fe.texture)}this._cascades.push({framebuffer:K,texture:ne,matrix:[],far:0,boundingSphereRadius:0,frustum:new l.bt,scale:0})}}this.shadowDirection=Mm(h);let k=0;if(a.elevation){const X=a.elevation,Z=[1e4,-1e4];X.visibleDemTiles.filter(Y=>Y.dem).forEach(Y=>{const K=Y.dem.tree;Z[0]=Math.min(Z[0],K.minimums[0]),Z[1]=Math.max(Z[1],K.maximums[0])}),Z[0]!==1e4&&(k=(Z[1]-Z[0])*X.exaggeration())}const O=1.5*a.cameraToCenterDistance,F=3*O,B=new Float64Array(16);for(let X=0;X<this._cascades.length;++X){const Z=this._cascades[X];let Y=a.height/50,K=1;Lo.cascadeCount===1?K=F:X===0?K=O:(Y=O,K=F);const[ne,fe]=km(a,this.shadowDirection,Y,K,Lo.shadowMapResolution,k);Z.scale=a.scale,Z.matrix=ne,Z.boundingSphereRadius=fe,l.a9.invert(B,Z.matrix),Z.frustum=l.bt.fromInvProjectionMatrix(B,1,0,!0),Z.far=K}const $=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[$].far,this._cascades[$].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Lo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Lo.shadowMapResolution,this._uniformValues.u_shadowmap_0=Do.ShadowMap0,this._uniformValues.u_shadowmap_1=Do.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const G=g.transform.elevation;for(const X of this._groundShadowTiles){let Z={min:0,max:0};if(G){const Y=G.getMinMaxForTile(X);Y&&(Z=Y)}this.addShadowReceiver(X.toUnwrapped(),Z.min,Z.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(a){this._enabled=a}drawShadowPass(a,h){if(!this.enabled)return;const g=this.painter,v=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),v.viewport.set([0,0,Lo.shadowMapResolution,Lo.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){g.currentShadowCascade=w,v.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),v.clear({color:l.aA.white,depth:1});for(const E of a.order){const C=a._mergedLayers[E];if(!C.hasShadowPass()||C.isHidden(g.transform.zoom))continue;const k=a.getLayerSourceCache(C),O=k?h[k.id]:void 0;(C.type==="model"||O&&O.length)&&g.renderLayer(g,k,C,O)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const a=this.painter,h=a.style,g=a.context,v=h.directionalLight,w=h.ambientLight;if(!v||!w)return;const E=[],C=Fc(a,a.longestCutoffRange);C.shouldRenderCutoff&&E.push("RENDER_CUTOFF");const k=_0(v,w),O=new hr(g.gl.LEQUAL,hr.ReadOnly,a.depthRangeFor3D);for(const F of this._groundShadowTiles){const B=F.toUnwrapped(),$=a.isTileAffectedByFog(F),G=a.getOrCreateProgram("groundShadow",{defines:E,overrideFog:$});this.setupShadows(B,G),a.uploadCommonUniforms(g,G,B,null,C);const X={u_matrix:a.transform.calculateProjMatrix(B),u_ground_shadow_factor:k};G.draw(a,g.gl.TRIANGLES,O,Dr.disabled,$r.multiply,Cr.disabled,X,"ground_shadow",a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments,{},a.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?$r.unblended:$r.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(a){const h=this.painter.transform,g=h.calculatePosMatrix(a,h.worldSize);return l.a9.multiply(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(a){return l.a9.multiply(a,this._cascades[this.painter.currentShadowCascade].matrix,a),Float32Array.from(a)}setupShadows(a,h,g,v=0){if(!this.enabled)return;const w=this.painter.transform,E=this.painter.context,C=E.gl,k=this._uniformValues,O=new Float64Array(16),F=w.calculatePosMatrix(a,w.worldSize);for(let B=0;B<this._cascades.length;B++)l.a9.multiply(O,this._cascades[B].matrix,F),k[B===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),E.activeTexture.set(C.TEXTURE0+Do.ShadowMap0+B),this._cascades[B].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=!!g,this.useNormalOffset){const B=l.bU(a.canonical),$=2/w.tileSize*l.Y/Lo.shadowMapResolution,G=$*this._cascades[0].boundingSphereRadius,X=$*this._cascades[this._cascades.length-1].boundingSphereRadius,Z=(g==="vector-tile"?1:3)/Math.pow(2,v-a.canonical.z-(1-w.zoom+Math.floor(w.zoom)));k.u_shadow_normal_offset=[B,G*Z,X*Z],k.u_shadow_bias=[6e-5,.0012,.012]}else k.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(E,k)}setupShadowsFromMatrix(a,h,g=!1){if(!this.enabled)return;const v=this.painter.context,w=v.gl,E=this._uniformValues,C=new Float64Array(16);for(let k=0;k<Lo.cascadeCount;k++)l.a9.multiply(C,this._cascades[k].matrix,a),E[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),v.activeTexture.set(w.TEXTURE0+Do.ShadowMap0+k),this._cascades[k].texture.bind(w.NEAREST,w.CLAMP_TO_EDGE);this.useNormalOffset=g,g?(E.u_shadow_normal_offset=[1,5,5],E.u_shadow_bias=[6e-5,.0012,.012]):E.u_shadow_bias=[36e-5,.0012,.012],h.setShadowUniformValues(v,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(a,h,g,v){if(v[2]>=0)return{};const w=function(k,O,F){const B=F/(1<<k.canonical.z);return new l.bV([k.canonical.x*B+k.wrap*F,k.canonical.y*B+k.wrap*F,0],[(k.canonical.x+1)*B+k.wrap*F,(k.canonical.y+1)*B+k.wrap*F,O])}(a,h,g).getCorners(),E=h/-v[2];v[0]<0?(l.Q.add(w[0],w[0],[v[0]*E,0,0]),l.Q.add(w[3],w[3],[v[0]*E,0,0])):v[0]>0&&(l.Q.add(w[1],w[1],[v[0]*E,0,0]),l.Q.add(w[2],w[2],[v[0]*E,0,0])),v[1]<0?(l.Q.add(w[0],w[0],[0,v[1]*E,0]),l.Q.add(w[1],w[1],[0,v[1]*E,0])):v[1]>0&&(l.Q.add(w[2],w[2],[0,v[1]*E,0]),l.Q.add(w[3],w[3],[0,v[1]*E,0]));const C={};return C.vertices=w,C.planes=[Pm(w[1],w[0],w[4]),Pm(w[2],w[1],w[5]),Pm(w[3],w[2],w[6]),Pm(w[0],w[3],w[7])],C}addShadowReceiver(a,h,g){this._receivers.add(a,l.bV.fromTileIdAndHeight(a,h,g))}getMaxCascadeForTile(a){const h=this._receivers.get(a);return h&&h.lastCascade?h.lastCascade:0}}function Pm(m,a,h){const g=l.Q.sub([],h,a),v=l.Q.sub([],m,a),w=l.Q.cross([],g,v),E=l.Q.length(w);return E===0?[0,0,1,0]:(l.Q.scale(w,w,1/E),[w[0],w[1],w[2],-l.Q.dot(w,a)])}function Mm(m){const a=m.properties.get("direction"),h=l.bT(a.x,a.y,a.z);h[2]=l.ad(h[2],0,75);const g=l.bW([h[0],h[1],h[2]]);return l.Q.fromValues(g.x,g.y,g.z)}function _0(m,a){const h=m.properties.get("color"),g=m.properties.get("intensity"),v=m.properties.get("direction"),w=[v.x,v.y,v.z],E=a.properties.get("color"),C=a.properties.get("intensity"),k=Math.max(l.Q.dot([0,0,1],w),0),O=[0,0,0];l.Q.scale(O,E.toArray01Linear().slice(0,3),C);const F=[0,0,0];return l.Q.scale(F,h.toArray01Linear().slice(0,3),k*g),l.bX([O[0]>0?O[0]/(O[0]+F[0]):0,O[1]>0?O[1]/(O[1]+F[1]):0,O[2]>0?O[2]/(O[2]+F[2]):0])}function km(m,a,h,g,v,w){const E=m.zoom,C=m.scale,k=m.worldSize,O=1/k,F=m.aspect,B=Math.sqrt(1+F*F)*Math.tan(.5*m.fovX),$=B*B,G=g-h,X=g+h;let Z,Y;$>G/X?(Z=g,Y=g*B):(Z=.5*X*(1+$),Y=.5*Math.sqrt(G*G+2*(g*g+h*h)*$+X*X*$*$));const K=m.projection.pixelsPerMeter(m.center.lat,k),ne=m._camera.getCameraToWorldMercator(),fe=[0,0,-Z*O];l.Q.transformMat4(fe,fe,ne);let de=Y*O;const ye=m._edgeInsets;if(!(ye.left===0&&ye.top===0&&ye.right===0&&ye.bottom===0||ye.left===ye.right&&ye.top===ye.bottom)){const me=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?K:1),vt=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,h,g);vt[8]=2*-m.centerOffset.x/m.width,vt[9]=2*m.centerOffset.y/m.height;const Zt=new Float64Array(16);l.a9.mul(Zt,vt,me);const ir=new Float64Array(16);l.a9.invert(ir,Zt);const fr=l.bt.fromInvProjectionMatrix(ir,k,E,!0);for(const cr of fr.points){const vr=((J=cr)[0]/=C,J[1]/=C,J[2]=l.bo(J[2],m._center.lat),J);de=Math.max(de,l.Q.len(l.Q.subtract([],fe,vr)))}}var J;de*=v/(v-1);const ae=Math.acos(a[2]),ke=Math.atan2(-a[0],-a[1]),Re=new Tf;Re.position=fe,Re.setPitchBearing(ae,ke);const Ne=Re.getWorldToCamera(k,K),et=de*k,ze=Math.min(m._mercatorZfromZoom(17)*k*-2,-2*et),Qe=Re.getCameraToClipOrthographic(-et,et,-et,et,ze,(et+w*K)/a[2]),it=new Float64Array(16);l.a9.multiply(it,Qe,Ne);const Oe=l.Q.fromValues(Math.floor(1e6*fe[0])/1e6*k,Math.floor(1e6*fe[1])/1e6*k,0),He=.5*v,Tt=[0,0,0];l.Q.transformMat4(Tt,Oe,it),l.Q.scale(Tt,Tt,He);const Ue=[Math.floor(Tt[0]),Math.floor(Tt[1]),Math.floor(Tt[2])],Je=[0,0,0];l.Q.sub(Je,Tt,Ue),l.Q.scale(Je,Je,-1/He);const rt=new Float64Array(16);return l.a9.identity(rt),l.a9.translate(rt,rt,Je),l.a9.multiply(it,rt,it),[it,et]}const wl=(m,a)=>Ct(m,a&&a.filter(h=>h.identifier!=="source.canvas")),H1=l.af(pi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),GE=l.af(pi,["setCenter","setZoom","setBearing","setPitch"]),g0={version:8,layers:[],sources:{}},y0={duration:300,delay:0};class Qa extends l.E{constructor(a,h={}){super(),this.map=a,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=l.e({},y0),this._buildingIndex=new ta(this),this.crossTileSymbolIndex=new f0,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=h.styleChanges||new ge,this.dispatcher=h.dispatcher?h.dispatcher:new l.bZ(l.b_(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new pr,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new l.b$(a._requestManager,h.localFontFamily?l.c0.all:h.localIdeographFontFamily?l.c0.ideographs:l.c0.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new Fe(a._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._config=h.config,this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",l.c1());const g=this;this._rtlTextPluginCallback=Qa.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(w,E)=>{if(l.c2(w),E&&E.every(C=>C))for(const C in g._sourceCaches){const k=g._sourceCaches[C],O=k.getSource().type;O!=="vector"&&O!=="geojson"||k.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const w=this.getOwnSource(v.sourceId);if(w&&w.vectorLayerIds)for(const E in this._layers){const C=this._layers[E];C.source===w.id&&this._validateLayer(C)}})}load(a){return a?(typeof a=="string"?this.loadURL(a):this.loadJSON(a),this):this}_getGlobalId(a){if(!a)return null;if(typeof a=="string"){if(l.c3(a))return a;const h=l.c4(a);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${l.c5(JSON.stringify(a))}`}_diffStyle(a,h,g){this.globalId=this._getGlobalId(a);const v=(w,E)=>{try{E(null,this.setState(w,g))}catch(C){E(C,!1)}};if(typeof a=="string"){const w=this.map._requestManager.normalizeStyleURL(a),E=this.map._requestManager.transformRequest(w,l.R.Style);l.g(E,(C,k)=>{C?this.fire(new l.a(C)):k&&v(k,h)})}else typeof a=="object"&&v(a,h)}loadURL(a,h={}){this.fire(new l.b("dataloading",{dataType:"style"}));const g=typeof h.validate=="boolean"?h.validate:!l.c3(a);this.globalId=this._getGlobalId(a),a=this.map._requestManager.normalizeStyleURL(a,h.accessToken),this.resolvedImports.add(a);const v=this.importsCache.get(a);if(v)return this._load(v,g);const w=this.map._requestManager.transformRequest(a,l.R.Style);this._request=l.g(w,(E,C)=>{if(this._request=null,E)this.fire(new l.a(E));else if(C)return this.importsCache.set(a,C),this._load(C,g)})}loadJSON(a,h={}){this.fire(new l.b("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(a),this._request=l.f.frame(()=>{this._request=null,this._load(a,h.validate!==!1)})}loadEmpty(){this.fire(new l.b("dataloading",{dataType:"style"})),this._load(g0,!1)}_loadImports(a,h,g){if(this.importDepth>=4)return l.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const w of a){const E=this._createFragmentStyle(w),C=new Promise(F=>{E.once("style.import.load",F),E.once("error",F)}).then(()=>this.mergeAll());if(v.push(C),this.resolvedImports.has(w.url)){E.loadEmpty();continue}const k=w.data||this.importsCache.get(w.url);k?(E.loadJSON(k,{validate:h}),this._isInternalStyle(k)&&(E.globalId=null)):w.url?E.loadURL(w.url,{validate:h}):E.loadEmpty();const O={style:E,id:w.id,config:w.config};if(g){const F=this.fragments.findIndex(({id:B})=>B===g);this.fragments=this.fragments.slice(0,F).concat(O).concat(this.fragments.slice(F))}else this.fragments.push(O)}return Promise.allSettled(v)}getImportGlobalIds(a=this,h=new Set){for(const g of a.fragments)g.style.globalId&&h.add(g.style.globalId),this.getImportGlobalIds(g.style,h);return[...h.values()]}_createFragmentStyle(a){const h=this.scope?l.aj(a.id,this.scope):a.id;let g;const v=this._initialConfig&&this._initialConfig[h];(a.config||v)&&(g=l.e({},a.config,v));const w=new Qa(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,configDependentLayers:this._configDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(a){return this.isRootStyle()&&(a.fragment||!!a.schema&&a.fragment!==!1)}_load(a,h){const g=a.schema;if(this._isInternalStyle(a)){const C=l.e({},g0,{imports:[{id:"basemap",data:a,url:""}]});return void this._load(C,h)}if(this.updateConfig(this._config,g),h&&wl(this,nt(a)))return;this._loaded=!0,this.stylesheet=l.c6(a);for(const C in a.sources)this.addSource(C,a.sources[C],{validate:!1,isInitialLoad:!0});a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(a.glyphs,this.scope);const v=Em(this.stylesheet.layers);if(this._order=v.map(C=>C.id),this.stylesheet.light&&l.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const C=this.stylesheet.lights[0];this.light=new Wt(C.properties,C.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Wt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const C of v){const k=l.c7(C,this.scope,this.options);k.isConfigDependent&&this._configDependentLayers.add(k.fqid),k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k,this._serializedLayers[k.id]=k.serialize();const O=this.getOwnLayerSourceCache(k),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();O&&k.canCastShadows()&&F&&(O.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const w=this.stylesheet.terrain;w&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=l.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?l.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(w,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new l.b("data",{dataType:"style"}));const E=this.isRootStyle();a.imports?this._loadImports(a.imports,h).then(()=>{this._reloadImports(),this.fire(new l.b(E?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new l.b(E?"style.load":"style.import.load")))}isRootStyle(){return this.importDepth===0}mergeAll(){let a,h,g,v,w,E,C,k;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(O=>{if(O.stylesheet){if(O.light!=null&&(a=O.light),O.stylesheet.lights)for(const F of O.stylesheet.lights)F.type==="ambient"&&O.ambientLight!=null&&(h=O.ambientLight),F.type==="directional"&&O.directionalLight!=null&&(g=O.directionalLight);v=this._prioritizeTerrain(v,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&O.fog!=null&&(w=O.fog),O.stylesheet.camera!=null&&(k=O.stylesheet.camera),O.stylesheet.projection!=null&&(E=O.stylesheet.projection),O.stylesheet.transition!=null&&(C=O.stylesheet.transition)}}),this.light=a,this.ambientLight=h,this.directionalLight=g,this.fog=w,v===null?delete this.terrain:this.terrain=v,this.camera=k||{"camera-projection":"perspective"},this.projection=E||{name:"mercator"},this.transition=l.e({},y0,C),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(a){const h=g=>{for(const v of g.fragments)h(v.style);a(g)};h(this)}_prioritizeTerrain(a,h,g){const v=a&&a.drapeRenderMode===0;return g===null?h&&h.drapeRenderMode===0?h:v?a:null:h!=null&&(!a||v||h&&h.drapeRenderMode===1)?h:a}mergeTerrain(){let a;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{a=this._prioritizeTerrain(a,h.terrain,h.stylesheet.terrain)}),a===null?delete this.terrain:this.terrain=a}mergeProjection(){let a;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(a=h.stylesheet.projection)}),this.projection=a||{name:"mercator"}}mergeSources(){const a={},h={},g={};this.forEachFragmentStyle(v=>{for(const w in v._sourceCaches){const E=l.aj(w,v.scope);a[E]=v._sourceCaches[w]}for(const w in v._otherSourceCaches){const E=l.aj(w,v.scope);h[E]=v._otherSourceCaches[w]}for(const w in v._symbolSourceCaches){const E=l.aj(w,v.scope);g[E]=v._symbolSourceCaches[w]}}),this._mergedSourceCaches=a,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=g}mergeLayers(){const a={},h=[],g={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(const E of w._order){const C=w._layers[E];if(C.type==="slot"){const k=l.c8(E);if(a[k])continue;a[k]=[]}C.slot&&a[C.slot]?a[C.slot].push(C):h.push(C)}}),this._mergedOrder=[];const v=(w=[])=>{for(const E of w)if(E.type==="slot"){const C=l.c8(E.id);a[C]&&v(a[C])}else{const C=l.aj(E.id,E.scope);this._mergedOrder.push(C),g[C]=E,E.is3D()&&(this._has3DLayers=!0),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0)}};v(h),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(a){return this.stylesheet.camera=l.e({},this.stylesheet.camera,a),this.camera=this.stylesheet.camera,this}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(a){this._spriteRequest=function(h,g,v){let w,E,C;const k=l.f.devicePixelRatio>1?"@2x":"";let O=l.g(g.transformRequest(g.normalizeSpriteURL(h,k,".json"),l.R.SpriteJSON),($,G)=>{O=null,C||(C=$,w=G,B())}),F=l.d(g.transformRequest(g.normalizeSpriteURL(h,k,".png"),l.R.SpriteImage),($,G)=>{F=null,C||(C=$,E=G,B())});function B(){if(C)v(C);else if(w&&E){const $=l.f.getImageData(E),G={};for(const X in w){const{width:Z,height:Y,x:K,y:ne,sdf:fe,pixelRatio:de,stretchX:ye,stretchY:J,content:ae}=w[X],ke=new l.h({width:Z,height:Y});l.h.copy($,ke,{x:K,y:ne},{x:0,y:0},{width:Z,height:Y}),G[X]={data:ke,pixelRatio:de,sdf:fe,stretchX:ye,stretchY:J,content:ae}}v(null,G)}}return{cancel(){O&&(O.cancel(),O=null),F&&(F.cancel(),F=null)}}}(a,this.map._requestManager,(h,g)=>{if(this._spriteRequest=null,h)this.fire(new l.a(h));else if(g)for(const v in g)this.imageManager.addImage(v,this.scope,g[v]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new l.b("data",{dataType:"style"}))})}_validateLayer(a){const h=this.getOwnSource(a.source);if(!h)return;const g=a.sourceLayer;g&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(g)===-1)&&this.fire(new l.a(new Error(`Source layer "${g}" does not exist on source "${h.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:a}of this.fragments)if(!a.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((a,h)=>{const g=this.fragments[h];return g&&g.style&&(a.data=g.style.serialize()),a})}_serializeSources(){const a={};for(const h in this._sourceCaches){const g=this._sourceCaches[h].getSource();a[g.id]||(a[g.id]=g.serialize())}return a}_serializeLayers(a){const h=[];for(const g of a){const v=this._layers[g];v&&v.type!=="custom"&&h.push(v.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(a){return!!this.terrain&&a.isDraped(this.getLayerSourceCache(a))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(a){const h=this.getOwnLayer(a);if(h)return h;this.fire(new l.a(new Error(`The layer '${a}' does not exist in the map's style.`)))}_checkSource(a){const h=this.getOwnSource(a);if(h)return h;this.fire(new l.a(new Error(`The source '${a}' does not exist in the map's style.`)))}update(a){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(a),this.directionalLight&&this.directionalLight.recalculate(a);const h=this.calculateLightsBrightness();a.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h));const g=this._changes.isDirty();if(this._changes.isDirty()){const w=this._changes.getLayerUpdatesByScope();for(const E in w){const{updatedIds:C,removedIds:k}=w[E];(C||k)&&this._updateWorkerLayers(E,C,k)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(a),this.light&&this.light.updateTransitions(a),this.ambientLight&&this.ambientLight.updateTransitions(a),this.directionalLight&&this.directionalLight.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._changes.reset()}const v={};for(const w in this._mergedSourceCaches){const E=this._mergedSourceCaches[w];v[w]=E.used,E.used=!1,E.tileCoverLift=0}for(const w of this._mergedOrder){const E=this._mergedLayers[w];if(E.recalculate(a,this._availableImages),!E.isHidden(a.zoom)){const C=this.getLayerSourceCache(E);C&&(C.used=!0,C.tileCoverLift=Math.max(C.tileCoverLift,E.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let C=E.minzoom||0;C<(E.maxzoom||25.5);C++){const k=this.map.painter;if(k){const O=E.getProgramIds();if(!O)continue;for(const F of O){const B=E.getDefaultProgramParams(F,a.zoom);B&&(k.style=this,this.fog&&(k._fogVisible=!0,B.overrideFog=!0,k.getOrCreateProgram(F,B)),k._fogVisible=!1,B.overrideFog=!1,k.getOrCreateProgram(F,B),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(B.overrideRtt=!0,k.getOrCreateProgram(F,B)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const w in v){const E=this._mergedSourceCaches[w];v[w]!==E.used&&E.getSource().fire(new l.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light&&this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new l.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=this._changes.getUpdatedImages();if(a.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a);this._changes.resetUpdatedImages()}}_updateWorkerLayers(a,h,g){const v=this.getFragmentStyle(a);v&&this.dispatcher.broadcast("updateLayers",{layers:h?v._serializeLayers(h):[],scope:a,removedIds:g||[],options:v.options})}setState(a,h){if(this._checkLoaded(),wl(this,nt(a)))return!1;(a=l.c6(a)).layers=Em(a.layers);const g=function(E,C){if(!E)return[{command:pi.setStyle,args:[C]}];let k=[];try{if(!S(E.version,C.version))return[{command:pi.setStyle,args:[C]}];S(E.center,C.center)||k.push({command:pi.setCenter,args:[C.center]}),S(E.zoom,C.zoom)||k.push({command:pi.setZoom,args:[C.zoom]}),S(E.bearing,C.bearing)||k.push({command:pi.setBearing,args:[C.bearing]}),S(E.pitch,C.pitch)||k.push({command:pi.setPitch,args:[C.pitch]}),S(E.sprite,C.sprite)||k.push({command:pi.setSprite,args:[C.sprite]}),S(E.glyphs,C.glyphs)||k.push({command:pi.setGlyphs,args:[C.glyphs]}),S(E.imports,C.imports)||function(G=[],X=[],Z){X=X||[];const Y=(G=G||[]).map(Dc),K=X.map(Dc),ne=G.reduce(Lc,{}),fe=X.reduce(Lc,{}),de=Y.slice();let ye,J,ae,ke;for(ye=0,J=0;ye<Y.length;ye++)ae=Y[ye],fe.hasOwnProperty(ae)?J++:(Z.push({command:pi.removeImport,args:[ae]}),de.splice(de.indexOf(ae,J),1));for(ye=0,J=0;ye<K.length;ye++)ae=K[K.length-1-ye],de[de.length-1-ye]!==ae&&(ne.hasOwnProperty(ae)?(Z.push({command:pi.removeImport,args:[ae]}),de.splice(de.lastIndexOf(ae,de.length-J),1)):J++,ke=de[de.length-ye],Z.push({command:pi.addImport,args:[fe[ae],ke]}),de.splice(de.length-ye,0,ae));for(const Re of X){const Ne=ne[Re.id];Ne&&!S(Ne,Re)&&Z.push({command:pi.updateImport,args:[Re.id,Re]})}}(E.imports,C.imports,k),S(E.transition,C.transition)||k.push({command:pi.setTransition,args:[C.transition]}),S(E.light,C.light)||k.push({command:pi.setLight,args:[C.light]}),S(E.fog,C.fog)||k.push({command:pi.setFog,args:[C.fog]}),S(E.projection,C.projection)||k.push({command:pi.setProjection,args:[C.projection]}),S(E.lights,C.lights)||k.push({command:pi.setLights,args:[C.lights]}),S(E.camera,C.camera)||k.push({command:pi.setCamera,args:[C.camera]});const O={},F=[];(function(G,X,Z,Y){let K;for(K in X=X||{},G=G||{})G.hasOwnProperty(K)&&(X.hasOwnProperty(K)||Pu(K,Z,Y));for(K in X){if(!X.hasOwnProperty(K))continue;const ne=X[K];G.hasOwnProperty(K)?S(G[K],ne)||(G[K].type==="geojson"&&ne.type==="geojson"&&Ph(G,X,K)?Z.push({command:pi.setGeoJSONSourceData,args:[K,ne.data]}):Mu(K,X,Z,Y)):Ru(K,X,Z)}})(E.sources,C.sources,F,O);const B=[];E.layers&&E.layers.forEach(G=>{G.source&&O[G.source]?k.push({command:pi.removeLayer,args:[G.id]}):B.push(G)});let $=E.terrain;$&&O[$.source]&&(k.push({command:pi.setTerrain,args:[void 0]}),$=void 0),k=k.concat(F),S($,C.terrain)||k.push({command:pi.setTerrain,args:[C.terrain]}),function(G,X,Z){X=X||[];const Y=(G=G||[]).map(Dc),K=X.map(Dc),ne=G.reduce(Lc,{}),fe=X.reduce(Lc,{}),de=Y.slice(),ye=Object.create(null);let J,ae,ke,Re,Ne,et,ze;for(J=0,ae=0;J<Y.length;J++)ke=Y[J],fe.hasOwnProperty(ke)?ae++:(Z.push({command:pi.removeLayer,args:[ke]}),de.splice(de.indexOf(ke,ae),1));for(J=0,ae=0;J<K.length;J++)ke=K[K.length-1-J],de[de.length-1-J]!==ke&&(ne.hasOwnProperty(ke)?(Z.push({command:pi.removeLayer,args:[ke]}),de.splice(de.lastIndexOf(ke,de.length-ae),1)):ae++,et=de[de.length-J],Z.push({command:pi.addLayer,args:[fe[ke],et]}),de.splice(de.length-J,0,ke),ye[ke]=!0);for(J=0;J<K.length;J++)if(ke=K[J],Re=ne[ke],Ne=fe[ke],!ye[ke]&&!S(Re,Ne))if(S(Re.source,Ne.source)&&S(Re["source-layer"],Ne["source-layer"])&&S(Re.type,Ne.type)){for(ze in Ea(Re.layout,Ne.layout,Z,ke,null,pi.setLayoutProperty),Ea(Re.paint,Ne.paint,Z,ke,null,pi.setPaintProperty),S(Re.slot,Ne.slot)||Z.push({command:pi.setSlot,args:[ke,Ne.slot]}),S(Re.filter,Ne.filter)||Z.push({command:pi.setFilter,args:[ke,Ne.filter]}),S(Re.minzoom,Ne.minzoom)&&S(Re.maxzoom,Ne.maxzoom)||Z.push({command:pi.setLayerZoomRange,args:[ke,Ne.minzoom,Ne.maxzoom]}),Re)Re.hasOwnProperty(ze)&&ze!=="layout"&&ze!=="paint"&&ze!=="filter"&&ze!=="metadata"&&ze!=="minzoom"&&ze!=="maxzoom"&&ze!=="slot"&&(ze.indexOf("paint.")===0?Ea(Re[ze],Ne[ze],Z,ke,ze.slice(6),pi.setPaintProperty):S(Re[ze],Ne[ze])||Z.push({command:pi.setLayerProperty,args:[ke,ze,Ne[ze]]}));for(ze in Ne)Ne.hasOwnProperty(ze)&&!Re.hasOwnProperty(ze)&&ze!=="layout"&&ze!=="paint"&&ze!=="filter"&&ze!=="metadata"&&ze!=="minzoom"&&ze!=="maxzoom"&&ze!=="slot"&&(ze.indexOf("paint.")===0?Ea(Re[ze],Ne[ze],Z,ke,ze.slice(6),pi.setPaintProperty):S(Re[ze],Ne[ze])||Z.push({command:pi.setLayerProperty,args:[ke,ze,Ne[ze]]}))}else Z.push({command:pi.removeLayer,args:[ke]}),et=de[de.lastIndexOf(ke)+1],Z.push({command:pi.addLayer,args:[Ne,et]})}(B,C.layers,k)}catch(O){console.warn("Unable to compute style diff:",O),k=[{command:pi.setStyle,args:[C]}]}return k}(this.serialize(),a).filter(E=>!(E.command in GE));if(g.length===0)return!1;const v=g.filter(E=>!(E.command in H1));if(v.length>0)throw new Error(`Unimplemented: ${v.map(E=>E.command).join(", ")}.`);const w=[];return g.forEach(E=>{w.push(this[E.command].apply(this,E.args))}),h&&Promise.all(w).then(h),this.stylesheet=a,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(a,h){return this.getImage(a)?this.fire(new l.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,this.scope,h),this._afterImageUpdated(a),this)}updateImage(a,h){this.imageManager.updateImage(a,this.scope,h)}getImage(a){return this.imageManager.getImage(a,this.scope)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a,this.scope),this._afterImageUpdated(a),this):this.fire(new l.a(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(a),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new l.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(a,h,g={}){return this._checkLoaded(),this._validate(zt,`models.${a}`,h,null,g)||(this.modelManager.addModel(a,h,this.scope),this._changes.setDirty()),this}hasModel(a){return this.modelManager.hasModel(a,this.scope)}removeModel(a){return this.hasModel(a)?(this.modelManager.removeModel(a,this.scope),this):this.fire(new l.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(a,h,g={}){if(this._checkLoaded(),this.getOwnSource(a)!==void 0)throw new Error(`There is already a source with ID "${a}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(Ot,`sources.${a}`,h,null,g))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const v=Yl(a,h,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));const w=E=>{const C=(E?"symbol:":"other:")+v.id,k=l.aj(C,this.scope),O=this._sourceCaches[C]=new Mo(k,v,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=O,O.onAdd(this.map)};w(!1),h.type!=="vector"&&h.type!=="geojson"||w(!0),v.onAdd&&v.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(a){this._checkLoaded();const h=this.getOwnSource(a);if(!h)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===a)return this.fire(new l.a(new Error(`Source "${a}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===a)return this.fire(new l.a(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const g=this.getOwnSourceCaches(a);for(const v of g){const w=l.c8(v.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(v.id),v.fire(new l.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(a,h){this._checkLoaded(),this.getOwnSource(a).setData(h),this._changes.setDirty()}getOwnSource(a){const h=this.getOwnSourceCache(a);return h&&h.getSource()}getOwnSources(){const a=[];for(const h in this._otherSourceCaches){const g=this.getOwnSourceCache(h);g&&a.push(g.getSource())}return a}areTilesLoaded(){const a=this._mergedSourceCaches;for(const h in a){const g=a[h]._tiles;for(const v in g){const w=g[v];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(a){if(this._checkLoaded(),!a)return delete this.ambientLight,void delete this.directionalLight;const h=this._getTransitionParameters();for(const v of a){if(this._validate(je,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(v),w.updateTransitions(h)}else this.ambientLight=new fn(v,hs,this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(v),w.updateTransitions(h)}else this.directionalLight=new fn(v,wr,this.scope,this.options)}}const g=new l.N(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const a=this.directionalLight,h=this.ambientLight;if(!a||!h)return;const g=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),v=a.properties.get("color").toArray01(),w=a.properties.get("intensity"),E=a.properties.get("direction"),C=1-l.bT(E.x,E.y,E.z)[2]/90,k=g(v)*w*C,O=h.properties.get("color").toArray01(),F=h.properties.get("intensity");return(k+g(O)*F)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const a=[];return this.directionalLight&&a.push(this.directionalLight.get()),this.ambientLight&&a.push(this.ambientLight.get()),a}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(a){if(!a)return this;if(l.c9(a)){const h=l.ca(a),g=this.fragments.find(({id:w})=>w===h);if(!g)throw new Error(`Style import not found: ${a}`);const v=l.c8(a);return g.style.getFragmentStyle(v)}{const h=this.fragments.find(({id:g})=>g===a);if(!h)throw new Error(`Style import not found: ${a}`);return h.style}}getConfigProperty(a,h){const g=this.getFragmentStyle(a);if(!g)return null;const v=l.aj(h,g.scope),w=g.options.get(v),E=w?w.value||w.default:null;return E?E.serialize():null}setConfigProperty(a,h,g){const v=this.getFragmentStyle(a);if(!v)return;const w=v.stylesheet.schema;if(!w||!w[h])return;const E=l.t(g);if(E.result!=="success")return void wl(this,E.value);const C=E.value.expression,k=l.aj(h,v.scope),O=v.options.get(k);if(!O)return;let F;const{minValue:B,maxValue:$,stepValue:G,type:X,values:Z}=w[h],Y=l.t(w[h].default);Y.result==="success"&&(F=Y.value.expression),F?(this.options.set(k,{...O,value:C,default:F,minValue:B,maxValue:$,stepValue:G,type:X,values:Z}),this.updateConfigDependencies()):this.fire(new l.a(new Error(`No schema defined for the config option "${h}" in the "${a}" fragment.`)))}getConfig(a){const h=this.getFragmentStyle(a);if(!h)return null;const g=h.stylesheet.schema;if(!g)return null;const v={};for(const w in g){const E=l.aj(w,h.scope),C=h.options.get(E),k=C?C.value||C.default:null;v[w]=k?k.serialize():null}return v}setConfig(a,h){const g=this.getFragmentStyle(a);g&&(g.updateConfig(h,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(a){const h=this.getFragmentStyle(a);return h?h.stylesheet.schema:null}setSchema(a,h){const g=this.getFragmentStyle(a);g&&(g.stylesheet.schema=h,g.updateConfig(g._config,h),this.updateConfigDependencies())}updateConfig(a,h){if(this._config=a,a||h)if(h)for(const g in h){let v,w;const E=l.t(h[g].default);if(E.result==="success"&&(v=E.value.expression),a&&a[g]!==void 0){const $=l.t(a[g]);$.result==="success"&&(w=$.value.expression)}const{minValue:C,maxValue:k,stepValue:O,type:F,values:B}=h[g];if(v){const $=l.aj(g,this.scope);this.options.set($,{default:v,value:w,minValue:C,maxValue:k,stepValue:O,type:F,values:B})}else this.fire(new l.a(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new l.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const a of this._configDependentLayers){const h=this.getLayer(a);h&&(h.possiblyEvaluateVisibility(),this._updateLayer(h))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(a,h,g={}){this._checkLoaded();const v=a.id;if(this._layers[v])return void this.fire(new l.a(new Error(`Layer with id "${v}" already exists on this map`)));let w;if(a.type==="custom"){if(wl(this,l.cb(a)))return;w=l.c7(a,this.scope,this.options)}else{if(typeof a.source=="object"&&(this.addSource(v,a.source),a=l.c6(a),a=l.e(a,{source:v})),this._validate(xe,`layers.${v}`,a,{arrayIndex:-1},g))return;w=l.c7(a,this.scope,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[w.id]=w.serialize()}w.isConfigDependent&&this._configDependentLayers.add(w.fqid);let E=this._order.length;if(h){const F=this._order.indexOf(h);if(F===-1)return void this.fire(new l.a(new Error(`Layer with id "${h}" does not exist on this map.`)));w.slot===this._layers[h].slot?E=F:l.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,v),this._layerOrderChanged=!0,this._layers[v]=w;const C=this.getOwnLayerSourceCache(w),k=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&w.canCastShadows()&&k&&(C.castsShadows=!0);const O=this._changes.getRemovedLayer(w);if(O&&w.source&&C&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const F=l.aj(w.source,w.scope);O.type!==w.type?this._changes.updateSourceCache(F,"clear"):(this._changes.updateSourceCache(F,"reload"),C.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(a,h){this._checkLoaded();const g=this._checkLayer(a);if(!g||a===h)return;const v=this._order.indexOf(a);this._order.splice(v,1);let w=this._order.length;if(h){const E=this._order.indexOf(h);if(E===-1)return void this.fire(new l.a(new Error(`Layer with id "${h}" does not exist on this map.`)));g.slot===this._layers[h].slot?w=E:l.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,a),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(a){this._checkLoaded();const h=this._checkLayer(a);if(!h)return;h.setEventedParent(null);const g=this._order.indexOf(a);this._order.splice(g,1),delete this._layers[a],delete this._serializedLayers[a],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._changes.removeLayer(h);const v=this.getOwnLayerSourceCache(h);if(v&&v.castsShadows){let w=!1;for(const E in this._layers)if(this._layers[E].source===h.source&&this._layers[E].canCastShadows()){w=!0;break}v.castsShadows=w}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(a){return this._layers[a]}hasLayer(a){return a in this._mergedLayers}hasLayerType(a){for(const h in this._layers)if(this._layers[h].type===a)return!0;return!1}setLayerZoomRange(a,h,g){this._checkLoaded();const v=this._checkLayer(a);v&&(v.minzoom===h&&v.maxzoom===g||(h!=null&&(v.minzoom=h),g!=null&&(v.maxzoom=g),this._updateLayer(v)))}setSlot(a,h){this._checkLoaded();const g=this._checkLayer(a);g&&g.slot!==h&&(g.slot=h,this._updateLayer(g))}setFilter(a,h,g={}){this._checkLoaded();const v=this._checkLayer(a);if(v&&!S(v.filter,h))return h==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(Be,`layers.${v.id}.filter`,h,{layerType:v.type},g)||(v.filter=l.c6(h),this._updateLayer(v)))}getFilter(a){const h=this._checkLayer(a);if(h)return l.c6(h.filter)}setLayoutProperty(a,h,g,v={}){this._checkLoaded();const w=this._checkLayer(a);if(w&&!S(w.getLayoutProperty(h),g)){if(g!=null&&(!v||v.validate!==!1)&&wl(w,ct.call(nt,{key:`layers.${a}.layout.${h}`,layerType:w.type,objectKey:h,value:g,styleSpec:l.G,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(h,g),w.isConfigDependent&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)}}getLayoutProperty(a,h){const g=this._checkLayer(a);if(g)return g.getLayoutProperty(h)}setPaintProperty(a,h,g,v={}){this._checkLoaded();const w=this._checkLayer(a);if(!w||S(w.getPaintProperty(h),g)||g!=null&&(!v||v.validate!==!1)&&wl(w,Ke.call(nt,{key:`layers.${a}.paint.${h}`,layerType:w.type,objectKey:h,value:g,styleSpec:l.G})))return;const E=w.setPaintProperty(h,g);w.isConfigDependent&&this._configDependentLayers.add(w.fqid),E&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(a,h){const g=this._checkLayer(a);if(g)return g.getPaintProperty(h)}setFeatureState(a,h){this._checkLoaded();const g=a.source,v=a.sourceLayer,w=this._checkSource(g);if(!w)return;const E=w.type;if(E==="geojson"&&v)return void this.fire(new l.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!v)return void this.fire(new l.a(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new l.a(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(g);for(const k of C)k.setFeatureState(v,a.id,h)}removeFeatureState(a,h){this._checkLoaded();const g=a.source,v=this._checkSource(g);if(!v)return;const w=v.type,E=w==="vector"?a.sourceLayer:void 0;if(w==="vector"&&!E)return void this.fire(new l.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new l.a(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(g);for(const k of C)k.removeFeatureState(E,a.id,h)}getFeatureState(a){this._checkLoaded();const h=a.source,g=a.sourceLayer,v=this._checkSource(h);if(v){if(v.type!=="vector"||g)return a.id===void 0&&this.fire(new l.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(g,a.id);this.fire(new l.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(a){return this.stylesheet.transition=l.e({},this.stylesheet.transition,a),this.transition=this.stylesheet.transition,this}getTransition(){return l.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const a=this.getTerrain(),h=a&&this.terrain&&this.terrain.scope===this.scope?a:this.stylesheet.terrain;return l.cc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateLayer(a){this._changes.updateLayer(a);const h=this.getLayerSourceCache(a),g=l.aj(a.source,a.scope),v=this._changes.getUpdatedSourceCaches();a.source&&!v[g]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),h.pause()),a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const h=C=>this._mergedLayers[C].type==="fill-extrusion"||this._mergedLayers[C].type==="model",g=this.order,v={},w=[];for(let C=g.length-1;C>=0;C--){const k=g[C];if(h(k)){v[k]=C;for(const O of a){const F=O[k];if(F)for(const B of F)w.push(B)}}}w.sort((C,k)=>k.intersectionZ-C.intersectionZ);const E=[];for(let C=g.length-1;C>=0;C--){const k=g[C];if(h(k))for(let O=w.length-1;O>=0;O--){const F=w[O].feature;if(v[F.layer.id]<C)break;E.push(F),w.pop()}else for(const O of a){const F=O[k];if(F)for(const B of F)E.push(B.feature)}}return E}queryRenderedFeatures(a,h,g){h&&h.filter&&this._validate(Be,"queryRenderedFeatures.filter",h.filter,null,h),h.scope=this.scope,h.availableImages=this._availableImages,h.serializedLayers=this._serializedLayers;const v={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new l.a(new Error("parameters.layers must be an Array."))),[];for(const O of h.layers){const F=this._mergedLayers[O];if(!F)return this.fire(new l.a(new Error(`The layer '${O}' does not exist in the map's style and cannot be queried for features.`))),[];v[F.source]=!0}}const w=[],E=h.serializedLayers||{},C=h&&h.layers?h.layers.some(O=>{const F=this.getLayer(O);return F&&F.is3D()}):this.has3DLayers(),k=_r.createFromScreenPoints(a,g);for(const O in this._mergedSourceCaches){const F=this._mergedSourceCaches[O].getSource();if(!F||F.scope!==h.scope)continue;const B=this._mergedSourceCaches[O].getSource().id;h.layers&&!v[B]||w.push(ui(this._mergedSourceCaches[O],this._mergedLayers,E,k,h,g,C,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(O,F,B,$,G,X,Z){const Y={},K=X.queryRenderedSymbols($),ne=[];for(const fe of Object.keys(K).map(Number))ne.push(Z[fe]);ne.sort(Tm);for(const fe of ne){const de=fe.featureIndex.lookupSymbolFeatures(K[fe.bucketInstanceId],F,fe.bucketIndex,fe.sourceLayerIndex,G.filter,G.layers,G.availableImages,O);for(const ye in de){const J=Y[ye]=Y[ye]||[],ae=de[ye];ae.sort((ke,Re)=>{const Ne=fe.featureSortOrder;if(Ne){const et=Ne.indexOf(ke.featureIndex);return Ne.indexOf(Re.featureIndex)-et}return Re.featureIndex-ke.featureIndex});for(const ke of ae)J.push(ke)}}for(const fe in Y)Y[fe].forEach(de=>{const ye=de.feature,J=B(O[fe]);if(!J)return;const ae=J.getFeatureState(ye.layer["source-layer"],ye.id);ye.source=ye.layer.source,ye.layer["source-layer"]&&(ye.sourceLayer=ye.layer["source-layer"]),ye.state=ae});return Y}(this._mergedLayers,E,this.getLayerSourceCache.bind(this),k.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(a,h){h&&h.filter&&this._validate(Be,"querySourceFeatures.filter",h.filter,null,h);const g=this.getOwnSourceCaches(a);let v=[];for(const w of g)v=v.concat(Ui(w,h));return v}addSourceType(a,h,g){return Qa.getSourceType(a)?g(new Error(`A source type called "${a}" already exists.`)):(Qa.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(a,h,g={}){this._checkLoaded();const v=this.light.getLight();let w=!1;for(const C in a)if(!S(a[C],v[C])){w=!0;break}if(!w)return;const E=this._getTransitionParameters();this.light.setLight(a,h,g),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,h=1){if(this._checkLoaded(),!a)return this.terrainSetForDrapingOnly()&&h!==0||delete this.terrain,a===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let g=a;const v=a.source==null;if(h===1){if(typeof g.source=="object"){const C="terrain-dem-src";this.addSource(C,g.source),g=l.c6(g),g=l.e(g,{source:C})}const w=l.e({},g),E={};if(this.terrain&&v){w.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(E.style=C.serialize())}if(this._validate(re,"terrain",w,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&h!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,h),this.fire(new l.b("data",{dataType:"style"}))}else{const w=this.terrain,E=w.get();for(const C of Object.keys(l.G.terrain))!g.hasOwnProperty(C)&&l.G.terrain[C].default&&(g[C]=l.G.terrain[C].default);for(const C in a)if(!S(a[C],E[C])){w.set(a,this.options),this.stylesheet.terrain=a;const k=this._getTransitionParameters({duration:0});w.updateTransitions(k),this.fire(new l.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const h=this.fog=new Ln(a,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();const g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog;if(!S(h.get(),a)){h.set(a,this.options),this.stylesheet.fog=h.get();const g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}}else this._createFog(a);this._markersNeedUpdate=!0}_getTransitionParameters(a){return{now:l.f.now(),transition:l.e(this.transition,a)}}updateDrapeFirstLayers(){if(!this.terrain)return;const a=[],h=[];for(const g in this._mergedLayers)this.isLayerDraped(this._mergedLayers[g])?a.push(g):h.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...h)}_createTerrain(a,h){const g=this.terrain=new jr(a,h,this.scope,this.options);h===1&&(this.stylesheet.terrain=a),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const v=this._getTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(const a in this._layers){const h=this._layers[a];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const h=this._layers[a];h.type==="symbol"&&this._updateLayer(h)}}_validate(a,h,g,v,w={}){if(w&&w.validate===!1)return!1;const E=l.e({},this.serialize());return wl(this,a.call(nt,l.e({key:h,style:E,value:g,styleSpec:l.G},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.cd.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._mergedLayers)this._mergedLayers[a].setEventedParent(null);for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles(),this._mergedSourceCaches[a].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(a){const h=this.getSourceCaches(a);for(const g of h)g.clearTiles()}clearSources(){for(const a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles()}reloadSource(a){const h=this.getSourceCaches(a);for(const g of h)g.resume(),g.reload()}reloadSources(){for(const a of this.getSources())a.reload&&a.reload()}updateSources(a){let h;this.directionalLight&&(h=Mm(this.directionalLight));for(const g in this._mergedSourceCaches)this._mergedSourceCaches[g].update(a,void 0,void 0,h)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const h=this._sourceCaches[a];h.resume(),h.reload()}}_updatePlacement(a,h,g,v,w=!1){let E=!1,C=!1;const k={},O={};for(const F of this._mergedOrder){const B=this._mergedLayers[F];if(B.type!=="symbol")continue;const $=l.aj(B.source,B.scope);let G=k[$];if(!G){const Z=this.getLayerSourceCache(B);if(!Z)continue;const Y=Z.getRenderableIds(!0).map(K=>Z.getTileByID(K));O[$]=Y.slice(),G=k[$]=Y.sort((K,ne)=>ne.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(ne.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer(B,G,a.center.lng,a.projection);E=E||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),w=w||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new l.b("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.f.now(),a.zoom))&&(this.pauseablePlacement=new xf(a,this._mergedOrder,w,h,g,v,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,k,O),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.f.now()),C=!0),E&&this.pauseablePlacement.placement.setStale()),C||E){this._buildingIndex.onNewFrame(a.zoom);for(const F of this._mergedOrder){const B=this._mergedLayers[F];B.type==="symbol"&&this.placement.updateLayerOpacities(B,k[l.aj(B.source,B.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.f.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}addImport(a,h){this._checkLoaded();const g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:w})=>w===a.id)!==-1)return void this.fire(new l.a(new Error(`Import with id '${a.id}' already exists in the map's style.`)));if(!h)return g.push(a),this._loadImports([a],!0);const v=g.findIndex(({id:w})=>w===h);return v===-1&&this.fire(new l.a(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,v).concat(a).concat(g.slice(v)),this._loadImports([a],!0,h)}updateImport(a,h){this._checkLoaded();const g=this.stylesheet.imports||[],v=this.getImportIndex(a);return v===-1?this:typeof h=="string"?(this.setImportUrl(a,h),this):(h.url&&h.url!==g[v].url&&this.setImportUrl(a,h.url),S(h.config,g[v].config)||this.setImportConfig(a,h.config),S(h.data,g[v].data)||this.setImportData(a,h.data),this)}moveImport(a,h){this._checkLoaded();let g=this.stylesheet.imports||[];const v=this.getImportIndex(a);if(v===-1)return this;const w=this.getImportIndex(h);if(w===-1)return this;const E=g[v],C=this.fragments[v];return g=g.filter(({id:k})=>k!==a),this.fragments=this.fragments.filter(({id:k})=>k!==a),this.stylesheet.imports=g.slice(0,w).concat(E).concat(g.slice(w)),this.fragments=this.fragments.slice(0,w).concat(C).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(a,h){this._checkLoaded();const g=this.stylesheet.imports||[],v=this.getImportIndex(a);if(v===-1)return this;g[v].url=h;const w=this.fragments[v];return w.style=this._createFragmentStyle(g[v]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(h),this}setImportData(a,h){this._checkLoaded();const g=this.getImportIndex(a),v=this.stylesheet.imports||[];return g===-1?this:h?(this.fragments[g].style.setState(h),this._reloadImports(),this):(delete v[g].data,this.setImportUrl(a,v[g].url))}setImportConfig(a,h){this._checkLoaded();const g=this.getImportIndex(a),v=this.stylesheet.imports||[];if(g===-1)return this;h?v[g].config=h:delete v[g].config;const w=this.fragments[g],E=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=h,w.style.updateConfig(h,E),this.updateConfigDependencies(),this}removeImport(a){this._checkLoaded();const h=this.stylesheet.imports||[],g=this.getImportIndex(a);g!==-1&&(h.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(a){const h=(this.stylesheet.imports||[]).findIndex(g=>g.id===a);return h===-1&&this.fire(new l.a(new Error(`Import '${a}' does not exist in the map's style and cannot be updated.`))),h}getLayer(a){return this._mergedLayers[a]}getSources(){const a=[];for(const h in this._mergedOtherSourceCaches){const g=this._mergedOtherSourceCaches[h];g&&a.push(g.getSource())}return a}getSource(a,h){const g=this.getSourceCache(a,h);return g&&g.getSource()}getLayerSource(a){const h=this.getLayerSourceCache(a);return h&&h.getSource()}getSourceCache(a,h){const g=l.aj(a,h);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(a){const h=l.aj(a.source,a.scope);return a.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(a){if(a==null)return Object.values(this._mergedSourceCaches);const h=[];return this._mergedOtherSourceCaches[a]&&h.push(this._mergedOtherSourceCaches[a]),this._mergedSymbolSourceCaches[a]&&h.push(this._mergedSymbolSourceCaches[a]),h}updateSourceCaches(){const a=this._changes.getUpdatedSourceCaches();for(const h in a){const g=a[h];g==="reload"?this.reloadSource(h):g==="clear"&&this.clearSource(h)}}updateLayers(a){const h=this._changes.getUpdatedPaintProperties();for(const g of h){const v=this.getLayer(g);v&&v.updateTransitions(a)}}getImages(a,h,g){this.imageManager.getImages(h.icons,h.scope,g),this._updateTilesForChangedImages();const v=w=>{w&&w.setDependencies(h.tileID.key,h.type,h.icons)};v(this._otherSourceCaches[h.source]),v(this._symbolSourceCaches[h.source])}getGlyphs(a,h,g){this.glyphManager.getGlyphs(h.stacks,h.scope,g)}getResource(a,h,g){return l.ce(h,g)}getOwnSourceCache(a){return this._otherSourceCaches[a]}getOwnLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}getOwnSourceCaches(a){const h=[];return this._otherSourceCaches[a]&&h.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&h.push(this._symbolSourceCaches[a]),h}_isSourceCacheLoaded(a){const h=this.getOwnSourceCaches(a);return h.length===0?(this.fire(new l.a(new Error(`There is no source with ID '${a}'`))),!1):h.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(a=>{a.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Qa.getSourceType=function(m){return Ut[m]},Qa.setSourceType=function(m,a){Ut[m]=a},Qa.registerForPluginStateChange=l.bY;var Ef=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,v0=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,Dm=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Nc="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Lm=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Lu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,x0=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Af=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Om=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,If=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,zm=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Bi=[];Bc(Ef,Bi),Bc(Dm,Bi),Bc(v0,Bi);const ri={"_prelude_fog.vertex.glsl":Lu,"_prelude_terrain.vertex.glsl":Lm,"_prelude_shadow.vertex.glsl":If,"_prelude_fog.fragment.glsl":x0,"_prelude_shadow.fragment.glsl":zm,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Af,"_prelude_raster_particle.glsl":Om},Sf={};si("",Lm),si(x0,Lu),si(zm,If),si(Af,""),si(Om,"");const Cf=si(v0,Dm),Fm=Ef;var Ka={background:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:si("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:si(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:si(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:si("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:si("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:si("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:si(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:si(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:si(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:si(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform mediump float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size.x/aspect;float segment_phase=pattern_len-mod((v_linesofar-v_pattern_data.x),pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in float a_linesofar;
#ifdef LINE_JOIN_NONE
in vec2 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform mediump float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width+=ANTIALIASING;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5/u_tile_units_to_pixels;v_linesofar+=line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:si("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:si("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:si(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:si(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:si(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:si(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:si("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:si(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Nc),skyboxGradient:si(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Nc),skyboxCapture:si(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:si(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:si(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:si(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:si(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Bc(m,a){const h=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of h)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=g.split(" ");for(const w of v)a.includes(w)||a.push(w)}}function si(m,a){const h=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let v=a.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(O=>{const F=O.split(" ");return F[F.length-1]}),v=[...new Set(v)]);const w={},E=[],C=[];if(m=m.replace(h,(O,F)=>(C.push(F),"")),(a=a.replace(h,(O,F)=>(E.push(F),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let k=[...Bi];Bc(m,k),Bc(a,k);for(const O of[...E,...C])ri[O]||console.error(`Undefined include: ${O}`),Sf[O]||(Sf[O]=[],Bc(ri[O],Sf[O])),k=[...k,...Sf[O]];return{fragmentSource:m=m.replace(g,(O,F,B,$,G)=>(w[G]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${G}
in ${B} ${$} ${G};
#else
uniform ${B} ${$} u_${G};
#endif
`:F==="initialize"?`
#ifdef HAS_UNIFORM_u_${G}
    ${B} ${$} ${G} = u_${G};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    in ${B} ${$} ${G};
#endif
`:F==="initialize-attribute"?"":void 0)),vertexSource:a=a.replace(g,(O,F,B,$,G)=>{const X=$==="float"?"vec2":$,Z=G.match(/color/)?"color":X;return F==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${G}
in ${B} ${$} a_${G};
#endif
`:w[G]?F==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${B} ${X} a_${G};
out ${B} ${$} ${G};
#else
uniform ${B} ${$} u_${G};
#endif
`:F==="initialize"?Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${B} ${$} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${Z}(a_${G}, u_${G}_t);
#else
    ${B} ${$} ${G} = u_${G};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    in ${B} ${$} a_${G};
    out ${B} ${$} ${G};
#endif
`:F==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    ${G} = a_${G};
#endif
`:void 0:F==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${B} ${X} a_${G};
#else
uniform ${B} ${$} u_${G};
#endif
`:F==="define-instanced"?Z==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${G}0;
in vec4 a_${G}1;
in vec4 a_${G}2;
in vec4 a_${G}3;
#else
uniform ${B} ${$} u_${G};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${B} ${X} a_${G};
#else
uniform ${B} ${$} u_${G};
#endif
`:F==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    ${B} ${$} ${G} = a_${G};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${B} ${$} ${G} = a_${G};
#else
    ${B} ${$} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${B} ${$} ${G} = unpack_mix_${Z}(a_${G}, u_${G}_t);
#else
    ${B} ${$} ${G} = u_${G};
#endif
`}),staticAttributes:v,usedDefines:k,vertexIncludes:E,fragmentIncludes:C}}class Jt{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,h,g,v,w,E,C,k){this.context=a;let O=this.boundPaintVertexBuffers.length!==v.length;for(let B=0;!O&&B<v.length;B++)this.boundPaintVertexBuffers[B]!==v[B]&&(O=!0);let F=this.boundDynamicVertexBuffers.length!==C.length;for(let B=0;!F&&B<C.length;B++)this.boundDynamicVertexBuffers[B]!==C[B]&&(F=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==g||O||F||this.boundIndexBuffer!==w||this.boundVertexOffset!==E)this.freshBind(h,g,v,w,E,C,k);else{a.bindVertexArrayOES.set(this.vao);for(const B of C)B&&(B.bind(),k&&B.instanceCount&&B.setVertexAttribDivisor(a.gl,h,k));w&&w.dynamicDraw&&w.bind()}}freshBind(a,h,g,v,w,E,C){const k=a.numAttributes,O=this.context,F=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=E,h.enableAttributes(F,a),h.bind(),h.setVertexAttribPointers(F,a,w);for(const B of g)B.enableAttributes(F,a),B.bind(),B.setVertexAttribPointers(F,a,w);for(const B of E)B&&(B.enableAttributes(F,a),B.bind(),B.setVertexAttribPointers(F,a,w),C&&B.instanceCount&&B.setVertexAttribDivisor(F,a,C));v&&v.bind(),O.currentNumAttributes=k}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Di(m,a){const h=Math.pow(2,a.canonical.z),g=a.canonical.y;return[new l.O(0,g/h).toLngLat().lat,new l.O(0,(g+1)/h).toLngLat().lat]}function Li(m,a,h,g,v,w,E){const C=m.context,k=C.gl,O=h.hillshadeFBO;if(!O)return;m.prepareDrawTile();const F=m.isTileAffectedByFog(a),B=m.getOrCreateProgram("hillshade",{overrideFog:F});C.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,O.colorAttachment.get());const $=((Y,K,ne,fe)=>{const de=ne.paint.get("hillshade-shadow-color"),ye=ne.paint.get("hillshade-highlight-color"),J=ne.paint.get("hillshade-accent-color"),ae=ne.paint.get("hillshade-emissive-strength");let ke=l.bm(ne.paint.get("hillshade-illumination-direction"));if(ne.paint.get("hillshade-illumination-anchor")==="viewport")ke-=Y.transform.angle;else if(Y.style&&Y.style.enable3dLights()&&Y.style.directionalLight){const Ne=Y.style.directionalLight.properties.get("direction"),et=l.bT(Ne.x,Ne.y,Ne.z);ke=l.bm(et[1])}const Re=!Y.options.moving;return{u_matrix:fe||Y.transform.calculateProjMatrix(K.tileID.toUnwrapped(),Re),u_image:0,u_latrange:Di(0,K.tileID),u_light:[ne.paint.get("hillshade-exaggeration"),ke],u_shadow:de,u_highlight:ye,u_emissive_strength:ae,u_accent:J}})(m,h,g,m.terrain?a.projMatrix:null);m.uploadCommonUniforms(C,B,a.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:X,tileBoundsSegments:Z}=m.getTileBoundsBuffers(h);B.draw(m,k.TRIANGLES,v,w,E,Cr.disabled,$,g.id,G,X,Z)}function ia(m,a,h){if(!a.needsDEMTextureUpload)return;const g=m.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||m.getTileTexture(h.stride);const w=h.getPixels();a.demTexture?a.demTexture.update(w,{premultiply:!1}):a.demTexture=new l.T(g,w,v.R32F,{premultiply:!1}),a.needsDEMTextureUpload=!1}function zh(m,a,h){const g=m.context,v=g.gl;if(!a.dem)return;const w=a.dem;if(g.activeTexture.set(v.TEXTURE1),ia(m,a,w),!a.demTexture)return;a.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const E=w.dim;g.activeTexture.set(v.TEXTURE0);let C=a.hillshadeFBO;if(!C){const $=new l.T(g,{width:E,height:E,data:null},v.RGBA);$.bind(v.LINEAR,v.CLAMP_TO_EDGE),C=a.hillshadeFBO=g.createFramebuffer(E,E,!0,"renderbuffer"),C.colorAttachment.set($.texture)}g.bindFramebuffer.set(C.framebuffer),g.viewport.set([0,0,E,E]);const{tileBoundsBuffer:k,tileBoundsIndexBuffer:O,tileBoundsSegments:F}=m.getMercatorTileBoundsBuffers(),B=[];m.linearFloatFilteringSupported()&&B.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:B}).draw(m,v.TRIANGLES,hr.disabled,Dr.disabled,$r.unblended,Cr.disabled,(($,G)=>{const X=G.stride,Z=l.a9.create();return l.a9.ortho(Z,0,l.Y,-l.Y,0,0,1),l.a9.translate(Z,Z,[0,-l.Y,0]),{u_matrix:Z,u_image:1,u_dimension:[X,X],u_zoom:$.overscaledZ}})(a.tileID,w),h.id,k,O,F),a.needsHillshadePrepare=!1}const wi=m=>({u_matrix:new l.bN(m),u_image0:new l.bR(m),u_skirt_height:new l.bQ(m),u_ground_shadow_factor:new l.bP(m)}),Rf=(m,a,h)=>({u_matrix:m,u_image0:0,u_skirt_height:a,u_ground_shadow_factor:h}),Fh=(m,a,h,g,v,w,E,C,k,O,F,B,$,G,X,Z)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:h,u_zoom_transition:v,u_merc_center:w,u_image0:0,u_frustum_tl:E,u_frustum_tr:C,u_frustum_br:k,u_frustum_bl:O,u_globe_pos:F,u_globe_radius:B,u_viewport:$,u_grid_matrix:Z?Float32Array.from(Z):new Float32Array(9),u_skirt_height:G,u_far_z_cutoff:X});function Nh(m,a){return m!=null&&a!=null&&!(!m.hasData()||!a.hasData())&&m.demTexture!=null&&a.demTexture!=null&&m.tileID.key!==a.tileID.key}const Ts=new class{constructor(){this.operations={}}newMorphing(m,a,h,g,v){if(m in this.operations){const w=this.operations[m];w.to.tileID.key!==h.tileID.key&&(w.queued=h)}else this.operations[m]={startTime:g,phase:0,duration:v,from:a,to:h,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const a=this.operations[m];return{from:a.from,to:a.to,phase:a.phase}}update(m){for(const a in this.operations){const h=this.operations[a];for(h.phase=(m-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,m)){delete this.operations[a];break}}}_nextOp(m,a){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=a,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},zn={0:null,1:"TERRAIN_VERTEX_MORPHING"};function W1(m,a,h){if(a===0)return 0;const g=a<1&&h===514?.25/a:1;return 6*Math.pow(1.5,22-m)*Math.max(a,1)*g}function Pf(m,a){const h=1<<m.z;return!a&&(m.x===0||m.x===h-1)||m.y===0||m.y===h-1}const Mf=m=>({u_matrix:m});function Ou(m,a,h,g,v){if(v>0){const w=l.f.now(),E=(w-m.timeAdded)/v,C=a?(w-a.timeAdded)/v:-1,k=h.getSource(),O=g.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),F=!a||Math.abs(a.tileID.overscaledZ-O)>Math.abs(m.tileID.overscaledZ-O),B=F&&m.refreshedUponExpiration?1:l.ad(F?E:1-C,0,1);return m.refreshedUponExpiration&&E>=1&&(m.refreshedUponExpiration=!1),a?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class b0 extends Mo{constructor(a){const h={type:"raster-dem",maxzoom:a.transform.maxZoom},g=new l.bZ(l.b_(),null),v=Yl("mock-dem",h,g,a.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,h){a.state="loaded",h(null)}}class Nm extends Mo{constructor(a){const h=Yl("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new l.bZ(l.b_(),null),a.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,h,g){if(a.freezeTileCoverage)return;this.transform=a;const v=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,E)=>{if(w[E.key]="",!this._tiles[E.key]){const C=new Po(E,this._source.tileSize*E.overscaleFactor(),a.tileZoom);C.state="loaded",this._tiles[E.key]=C}return w},{});for(const w in this._tiles)w in v||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(a){const h=this.proxyCachedFBO[a];if(h!==void 0){const g=Object.values(h);this.renderCachePool.push(...g),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Vs extends l.ap{constructor(a,h,g){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=h,this.projMatrix=g}}class na extends l.cp{constructor(a,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},a.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,v,w]=function(k){const O=new l.aQ,F=new l.az,B=131;O.reserve(17161),F.reserve(33800);const $=l.Y/128,G=l.Y+$/2,X=G+$;for(let Y=-$;Y<X;Y+=$)for(let K=-$;K<X;K+=$){const ne=K<0||K>G||Y<0||Y>G?24575:0,fe=l.ad(Math.round(K),0,l.Y),de=l.ad(Math.round(Y),0,l.Y);O.emplaceBack(fe+ne,de)}const Z=(Y,K)=>{const ne=K*B+Y;F.emplaceBack(ne+1,ne,ne+B),F.emplaceBack(ne+B,ne+B+1,ne+1)};for(let Y=1;Y<129;Y++)for(let K=1;K<129;K++)Z(K,Y);return[0,129].forEach(Y=>{for(let K=0;K<130;K++)Z(K,Y),Z(Y,K)}),[O,F,32768]}(),E=a.context;this.gridBuffer=E.createVertexBuffer(g,l.aS.members),this.gridIndexBuffer=E.createIndexBuffer(v),this.gridSegments=l.aE.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=l.aE.simpleSegment(0,0,g.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Nm(h.map),this.orthoMatrix=l.a9.create(),l.a9.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,l.Y,0,l.Y,0,1);const C=E.gl;this._overlapStencilMode=new Dr({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new b0(h.map),this._pendingGroundEffectLayers=[]}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),this._style=a,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(a,h,g){if(a&&a.terrain){this._style!==a&&(this.style=a,this._evaluationZoom=void 0);const v=a.terrain.properties,w=a.terrain.drapeRenderMode===0,E=a.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=l.f.now();const C=a.terrain&&a.terrain.scope,k=v.get("source"),O=w?this._mockSourceCache:a.getSourceCache(k,C);if(!O)return void l.w(`Couldn't find terrain source "${k}".`);if(this.sourceCache=O,this._exaggeration=E?this.calculateExaggeration(h):v.get("exaggeration"),!h.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;const F=()=>{this.sourceCache.used&&l.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const B=this.getScaledDemTileSize();this.sourceCache.update(h,B,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),h.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(a){const h=this._previousCameraAltitude,g=a.getFreeCameraOptions().position.z/a.pixelsPerMeter*a.worldSize;this._previousCameraAltitude=g;const v=h!=null?g-h:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;const w=a.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(w);let C=w-this._previousZoom;const k=this._previousUpdateTimestamp;let O=w;this._evaluationZoom!=null&&(O=this._evaluationZoom,Math.abs(w-O)>.5&&(C=.5*(w-O+C)),C*v<0&&(O+=C)),this._evaluationZoom=O;const F=E.getExaggeration(O),B=F===E.getExaggeration(Math.max(0,O-.1));if(B&&Math.abs(F-this._exaggeration)<.01)return F;let $=Math.min(.1,.00375*(this._updateTimestamp-k));return(B||F<.1||Math.abs(C)<1e-4)&&($=Math.min(.2,4*$)),l.X(this._exaggeration,F,$)}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(a){a.coord&&a.dataType==="source"?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._mergedSourceCaches)this._style._mergedSourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(l.O.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=h.getIds().map(k=>{const O=h.getTileByID(k).tileID;return O.projMatrix=g.calculateProjMatrix(O.toUnwrapped()),O});(function(k,O){const F=O.transform.pointCoordinate(O.transform.getCameraPoint()),B=new l.P(F.x,F.y);k.sort(($,G)=>{if(G.overscaledZ-$.overscaledZ)return G.overscaledZ-$.overscaledZ;const X=new l.P($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),Z=new l.P(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),Y=B.mult(1<<$.canonical.z);return Y.x-=.5,Y.y-=.5,Y.distSqr(X)-Y.distSqr(Z)})})(v,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},v.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const E=this._style._mergedSourceCaches;for(const k in E){const O=E[k];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,a[k],w),O.usedForTerrain))continue;const F=a[k];O.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[h.id]=v.map(k=>new Vs(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const O=this.terrainTileForTile[k.key];if(!O)continue;const F=O.tileID.key;F in C||(this._visibleDemTiles.push(O),C[F]=F)}}_assignTerrainTiles(a){this._initializing||a.forEach(h=>{if(this.terrainTileForTile[h.key])return;const g=this._findTileCoveringTileID(h,this.sourceCache);g&&(this.terrainTileForTile[h.key]=g)})}_prepareDEMTextures(){const a=this.painter.context,h=a.gl;for(const g in this.terrainTileForTile){const v=this.terrainTileForTile[g],w=v.dem;!w||v.demTexture&&!v.needsDEMTextureUpload||(a.activeTexture.set(h.TEXTURE1),ia(this.painter,v,w))}}_prepareDemTileUniforms(a,h,g,v){if(!h||h.demTexture==null)return!1;const w=a.tileID.canonical,E=Math.pow(2,h.tileID.canonical.z-w.z),C=v||"";return g[`u_dem_tl${C}`]=[w.x*E%1,w.y*E%1],g[`u_dem_scale${C}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,h=a.gl;if(!this._emptyDepthBufferTexture){const g=new l.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new l.T(a,g,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const h=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;const w=v.dem.tree.minimums[0];return w>0&&a++,g+w},0);return a?h/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,h=a.gl;a.activeTexture.set(h.TEXTURE2);const g=this._getLoadedAreaMinimum(),[v,w]=(()=>{const C=new l.cr({width:1,height:1},new Float32Array([g]));return[h.R32F,C]})();this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(w,{premultiply:!1}):E=this._emptyDEMTexture=new l.T(a,w,v,{premultiply:!1}),E}setupElevationDraw(a,h,g){const v=this.painter.context,w=v.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};E.u_exaggeration=this.exaggeration();let C=null,k=null,O=1;if(g&&g.morphing&&this._useVertexMorphing){const $=g.morphing.srcDemTile,G=g.morphing.dstDemTile;O=g.morphing.phase,$&&G&&(this._prepareDemTileUniforms(a,$,E,"_prev")&&(k=$),this._prepareDemTileUniforms(a,G,E)&&(C=G))}const F=$=>$&&$.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST,B=$=>{E.u_dem_size=$.size[0]===1?1:$.size[0]-2};if(k&&C)v.activeTexture.set(w.TEXTURE2),C.demTexture.bind(F(C),w.CLAMP_TO_EDGE),v.activeTexture.set(w.TEXTURE4),k.demTexture.bind(F(k),w.CLAMP_TO_EDGE),C.demTexture&&B(C.demTexture),E.u_dem_lerp=O;else{C=this.terrainTileForTile[a.tileID.key],v.activeTexture.set(w.TEXTURE2);const $=this._prepareDemTileUniforms(a,C,E)?C.demTexture:this.emptyDEMTexture;$.bind(F(C),w.CLAMP_TO_EDGE),B($)}if(v.activeTexture.set(w.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),this._depthFBO&&(E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&C){const $=(1<<C.tileID.canonical.z)*l.bo(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=$}if(g&&g.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),h.setTerrainUniformValues(v,E),this.painter.transform.projection.name==="globe"){const $=this.globeUniformValues(this.painter.transform,a.tileID.canonical,g&&g.useDenormalizedUpVectorScale);h.setGlobeUniformValues(v,$)}}globeUniformValues(a,h,g){const v=a.projection;return{u_tile_tl_up:v.upVector(h,0,0),u_tile_tr_up:v.upVector(h,l.Y,0),u_tile_br_up:v.upVector(h,l.Y,l.Y),u_tile_bl_up:v.upVector(h,0,l.Y),u_tile_up_scale:g?l.cq(1):v.upVectorScale(h,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const h=this.painter,g=this.painter.context;a.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,w,E,C,k){if(v.transform.projection.name==="globe")(function(O,F,B,$,G){const X=O.context,Z=X.gl;let Y,K;const ne=O.transform,fe=l.ci(O,X,ne),de=(Qe,it)=>{if(K===it)return;const Oe=[zn[it],"PROJECTION_GLOBE_VIEW"];fe&&Oe.push("CUSTOM_ANTIALIASING");const He=O.isTileAffectedByFog(Qe);Y=O.getOrCreateProgram("globeRaster",{defines:Oe,overrideFog:He}),K=it},ye=O.colorModeForRenderPass(),J=new hr(Z.LEQUAL,hr.ReadWrite,O.depthRangeFor3D);Ts.update(G);const ae=l.cj(ne),ke=[l.a8(ne.center.lng),l.ah(ne.center.lat)],Re=O.globeSharedBuffers,Ne=[ne.width*l.f.devicePixelRatio,ne.height*l.f.devicePixelRatio],et=Float32Array.from(ne.globeMatrix),ze={useDenormalizedUpVectorScale:!0};{const Qe=O.transform,it=W1(Qe.zoom,F.exaggeration(),F.sourceCache._source.tileSize);K=-1;const Oe=Z.TRIANGLES;for(const He of $){const Tt=B.getTile(He),Ue=Dr.disabled,Je=F.prevTerrainTileForTile[He.key],rt=F.terrainTileForTile[He.key];Nh(Je,rt)&&Ts.newMorphing(He.key,Je,rt,G,250),X.activeTexture.set(Z.TEXTURE0),Tt.texture&&Tt.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const me=Ts.getMorphValuesForProxy(He.key),vt=me?1:0;me&&l.k(ze,{morphing:{srcDemTile:me.from,dstDemTile:me.to,phase:l.ch(me.phase)}});const Zt=l.ck(He.canonical),ir=l.cl(Zt.getCenter().lat),fr=l.cm(He.canonical,Zt,ir,Qe.worldSize/Qe._pixelsPerMercatorPixel),cr=l.aW(l.cn(He.canonical)),vr=Fh(Qe.expandedFarZProjMatrix,et,ae,cr,l.W(Qe.zoom),ke,Qe.frustumCorners.TL,Qe.frustumCorners.TR,Qe.frustumCorners.BR,Qe.frustumCorners.BL,Qe.globeCenterInViewSpace,Qe.globeRadius,Ne,it,Qe._farZ,fr);if(de(He,vt),Y&&(F.setupElevationDraw(Tt,Y,ze),O.uploadCommonUniforms(X,Y,He.toUnwrapped()),Re)){const[hi,zr,vi]=Re.getGridBuffers(ir,it!==0);Y.draw(O,Oe,J,Ue,ye,Cr.backCCW,vr,"globe_raster",hi,zr,vi)}}}if(Re&&(O.renderDefaultNorthPole||O.renderDefaultSouthPole)){const Qe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];fe&&Qe.push("CUSTOM_ANTIALIASING"),Y=O.getOrCreateProgram("globeRaster",{defines:Qe});for(const it of $){const{x:Oe,y:He,z:Tt}=it.canonical,Ue=He===0,Je=He===(1<<Tt)-1,[rt,me,vt,Zt]=Re.getPoleBuffers(Tt,!1);if(Zt&&(Ue||Je)){const ir=B.getTile(it);X.activeTexture.set(Z.TEXTURE0),ir.texture&&ir.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let fr=l.co(Tt,Oe,ne);const cr=l.aW(l.cn(it.canonical)),vr=(hi,zr)=>hi.draw(O,Z.TRIANGLES,J,Dr.disabled,ye,Cr.disabled,Fh(ne.expandedFarZProjMatrix,fr,fr,cr,0,ke,ne.frustumCorners.TL,ne.frustumCorners.TR,ne.frustumCorners.BR,ne.frustumCorners.BL,ne.globeCenterInViewSpace,ne.globeRadius,Ne,0,ne._farZ),"globe_pole_raster",zr,vt,Zt);F.setupElevationDraw(ir,Y,ze),O.uploadCommonUniforms(X,Y,it.toUnwrapped()),Ue&&O.renderDefaultNorthPole&&vr(Y,rt),Je&&O.renderDefaultSouthPole&&(fr=l.a9.scale(l.a9.create(),fr,[1,-1,1]),vr(Y,me))}}}})(v,w,E,C,k);else{const O=v.context,F=O.gl;let B,$;const G=v.shadowRenderer,X=Fc(v,v.longestCutoffRange),Z=ye=>{if($===ye)return;const J=[];J.push(zn[ye]),X.shouldRenderCutoff&&J.push("RENDER_CUTOFF"),B=v.getOrCreateProgram("terrainRaster",{defines:J}),$=ye},Y=v.colorModeForRenderPass(),K=new hr(F.LEQUAL,hr.ReadWrite,v.depthRangeFor3D);Ts.update(k);const ne=v.transform,fe=W1(ne.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let de=[0,0,0];if(G){const ye=v.style.directionalLight,J=v.style.ambientLight;ye&&J&&(de=_0(ye,J))}{$=-1;const ye=F.TRIANGLES,[J,ae]=[w.gridIndexBuffer,w.gridSegments];for(const ke of C){const Re=E.getTile(ke),Ne=Dr.disabled,et=w.prevTerrainTileForTile[ke.key],ze=w.terrainTileForTile[ke.key];Nh(et,ze)&&Ts.newMorphing(ke.key,et,ze,k,250),O.activeTexture.set(F.TEXTURE0),Re.texture&&Re.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const Qe=Ts.getMorphValuesForProxy(ke.key),it=Qe?1:0;let Oe;Qe&&(Oe={morphing:{srcDemTile:Qe.from,dstDemTile:Qe.to,phase:l.ch(Qe.phase)}});const He=Rf(ke.projMatrix,Pf(ke.canonical,ne.renderWorldCopies)?fe/10:fe,de);if(Z(it),!B)continue;w.setupElevationDraw(Re,B,Oe);const Tt=ke.toUnwrapped();G&&G.setupShadows(Tt,B),v.uploadCommonUniforms(O,B,Tt,null,X),B.draw(v,ye,K,Ne,Y,Cr.backCCW,He,"terrain_raster",w.gridBuffer,J,ae)}}}}(h,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;const h=this.painter,g=this.painter.context,v=this.proxySourceCache,w=this.proxiedCoords[v.id],E=this._drapedRenderBatches.shift(),C=h.style.order,k=[];let O=0;for(const F of w){const B=v.getTileByID(F.proxyTileKey),$=v.proxyCachedFBO[F.key]?v.proxyCachedFBO[F.key][a]:void 0,G=$!==void 0?v.renderCache[$]:this.pool[O++],X=$!==void 0;if(B.texture=G.tex,X&&!G.dirty){k.push(B.tileID);continue}let Z;g.bindFramebuffer.set(G.fb.framebuffer),this.renderedToTile=!1,G.dirty&&(g.clear({color:l.aA.transparent,stencil:0}),G.dirty=!1);for(let Y=E.start;Y<=E.end;++Y){const K=h.style._mergedLayers[C[Y]];if(K.isHidden(h.transform.zoom))continue;const ne=h.style.getLayerSourceCache(K),fe=ne?this.proxyToSource[F.key][ne.id]:[F];if(!fe)continue;const de=fe;g.viewport.set([0,0,G.fb.width,G.fb.height]),Z!==(ne?ne.id:null)&&(this._setupStencil(G,fe,K,ne),Z=ne?ne.id:null),h.renderLayer(h,ne,K,de)}if(this._drapedRenderBatches.length===0)for(const Y of this._pendingGroundEffectLayers){const K=h.style._mergedLayers[C[Y]];if(K.isHidden(h.transform.zoom))continue;const ne=h.style.getLayerSourceCache(K),fe=ne?this.proxyToSource[F.key][ne.id]:[F];if(!fe)continue;const de=fe;g.viewport.set([0,0,G.fb.width,G.fb.height]),Z!==(ne?ne.id:null)&&(this._setupStencil(G,fe,K,ne),Z=ne?ne.id:null),h.renderLayer(h,ne,K,de)}this.renderedToTile?(G.dirty=!0,k.push(B.tileID)):X||--O,O===5&&(O=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),E.end+1}postRender(){}isLayerOrderingCorrect(a){const h=a.order.length;let g=-1,v=h;for(let w=0;w<h;++w)this._style.isLayerDraped(a._mergedLayers[a.order[w]])?g=Math.max(g,w):v=Math.min(v,w);return v>g}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{a=Math.min(a,h.dem.tree.minimums[0])}),a===0?a:(a-30)*this._exaggeration}raycast(a,h,g){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const E=w.tileID,C=1<<E.overscaledZ,{x:k,y:O}=E.canonical,F=k/C,B=(k+1)/C,$=O/C,G=(O+1)/C;return{minx:F,miny:$,maxx:B,maxy:G,t:w.dem.tree.raycastRoot(F,$,B,G,a,h,g),tile:w}});v.sort((w,E)=>(w.t!==null?w.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const w of v){if(w.t==null)return null;const E=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,a,h,g);if(E!=null)return E}return null}_createFBO(){const a=this.painter.context,h=a.gl,g=this.drapeBufferSize;a.activeTexture.set(h.TEXTURE0);const v=new l.T(a,{width:g[0],height:g[1],data:null},h.RGBA);v.bind(h.LINEAR,h.CLAMP_TO_EDGE);const w=a.createFramebuffer(g[0],g[1],!0,null);return w.colorAttachment.set(v.texture),w.depthAttachment=new c0(a,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:w,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const a in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const h=this._style._mergedLayers[a],g=h.isHidden(this.painter.transform.zoom);return h.type==="custom"?!g&&h.shouldRedrape():!g&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let a=!1;for(const g of this._style.getSources())if(g instanceof Lt){a=!0;break}if(!a)return;const h={};for(let g=0;g<this._style.order.length;++g){const v=this._style._mergedLayers[this._style.order[g]],w=this._style.getLayerSourceCache(v);if(w&&!h[w.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof l.Z){h[w.id]=!0;for(const E of this.proxyCoords){const C=this.proxyToSource[E.key][w.id];if(C)for(const k of C)this._clearRenderCacheForTile(w.id,k)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof bt){a=!0;break}if(!a)return;const h={};for(let g=0;g<this._style.order.length;++g){const v=this._style._mergedLayers[this._style.order[g]],w=this._style.getLayerSourceCache(v);if(!w||h[w.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const E=v.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const k=this.proxyToSource[C.key][w.id];if(k)for(const O of k){const F=Ou(w.getTile(O),w.findLoadedParent(O,0),w,this.painter.transform,E);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(w.id,O)}}}}_setupDrapedRenderBatches(){const a=this._style.order,h=a.length;if(h===0)return;const g=[];this._pendingGroundEffectLayers=[];let v,w=0,E=this._style._mergedLayers[a[w]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++w<h;)E=this._style._mergedLayers[a[w]];for(;w<h;++w){const C=this._style._mergedLayers[a[w]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?v===void 0&&(v=w):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),v!==void 0&&(g.push({start:v,end:w-1}),v=void 0)))}if(v!==void 0&&g.push({start:v,end:w-1}),g.length!==0){const C=g[g.length-1];this._pendingGroundEffectLayers.every(k=>k>C.end)||l.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(a){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const E=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let C=0;C<E.length;++C){const k=Object.values(E[C]);h.renderCachePool.push(...k)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,v=this._tilesDirty;for(let E=g.length-1;E>=0;E--){const C=g[E];if(h.getTileByID(C.key),h.proxyCachedFBO[C.key]!==void 0){const k=a[C.key],O=this.proxyToSource[C.key];let F=0;for(const B in O){const $=O[B],G=k[B];if(!G||G.length!==$.length||$.some((X,Z)=>X!==G[Z]||v[B]&&v[B].hasOwnProperty(X.key))){F=-1;break}++F}for(const B in h.proxyCachedFBO[C.key])h.renderCache[h.proxyCachedFBO[C.key][B]].dirty=F<0||F!==Object.values(k).length}}const w=[...this._drapedRenderBatches];w.sort((E,C)=>C.end-C.start-(E.end-E.start));for(const E of w)for(const C of g){if(h.proxyCachedFBO[C.key])continue;let k=h.renderCachePool.pop();k===void 0&&h.renderCache.length<50&&(k=h.renderCache.length,h.renderCache.push(this._createFBO())),k!==void 0&&(h.proxyCachedFBO[C.key]={},h.proxyCachedFBO[C.key][E.start]=k,h.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(a,h,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,E=w.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let C;if(g.isTileClipped())C=h.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):Dr.disabled}_renderTileClippingMasks(a,h){const g=this.painter,v=this.painter.context,w=v.gl;g._tileClippingMaskIDs={},v.setColorMode($r.disabled),v.setDepthMode(hr.disabled);const E=g.getOrCreateProgram("clippingMask");for(const C of a){const k=g._tileClippingMaskIDs[C.key]=--h;E.draw(g,w.TRIANGLES,hr.disabled,new Dr({func:w.ALWAYS,mask:0},k,255,w.KEEP,w.KEEP,w.REPLACE),$r.disabled,Cr.disabled,Mf(C.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(a){const h=this.painter.transform;if(a.x<0||a.x>h.width||a.y<0||a.y>h.height)return null;const g=[a.x,a.y,1,1];l.aa.transformMat4(g,g,h.pixelMatrixInverse),l.aa.scale(g,g,1/g[3]),g[0]/=h.worldSize,g[1]/=h.worldSize;const v=h._camera.position,w=l.bo(1,h.center.lat),E=[v[0],v[1],v[2]/w,0],C=l.Q.subtract([],g.slice(0,3),E);l.Q.normalize(C,C);const k=this.raycast(E,C,this._exaggeration);return k!==null&&k?(l.Q.scaleAndAdd(E,E,C,k),E[3]=E[2],E[2]*=w,E):null}drawDepth(){const a=this.painter,h=a.context,g=this.proxySourceCache,v=Math.ceil(a.width),w=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===w||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const E=h.gl,C=h.createFramebuffer(v,w,!0,"renderbuffer");h.activeTexture.set(E.TEXTURE0);const k=new l.T(h,{width:v,height:w,data:null},E.RGBA);k.bind(E.NEAREST,E.CLAMP_TO_EDGE),C.colorAttachment.set(k.texture);const O=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,v,w);C.depthAttachment.set(O),this._depthFBO=C,this._depthTexture=k}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,v,w]),function(E,C,k,O){if(E.transform.projection.name==="globe")return;const F=E.context,B=F.gl;F.clear({depth:1});const $=E.getOrCreateProgram("terrainDepth"),G=new hr(B.LESS,hr.ReadWrite,E.depthRangeFor3D);for(const X of O){const Z=k.getTile(X),Y=Rf(X.projMatrix,0,[0,0,0]);C.setupElevationDraw(Z,$),$.draw(E,B.TRIANGLES,G,Dr.disabled,$r.unblended,Cr.backCCW,Y,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(a,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,h,g){if(a.getSource()instanceof l.as)return this._setupProxiedCoordsForImageSource(a,h,g);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const v=this.proxiedCoords[a.id]=[],w=this.proxyCoords;for(let k=0;k<w.length;k++){const O=w[k],F=this._findTileCoveringTileID(O,a);if(F){const B=this._createProxiedId(O,F,g[O.key]&&g[O.key][a.id]);v.push(B),this.proxyToSource[O.key][a.id]=[B]}}let E=!1;const C=new Set;for(let k=0;k<h.length;k++){const O=a.getTile(h[k]);if(!O||!O.hasData())continue;const F=this._findTileCoveringTileID(O.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==O.tileID.canonical.z){const B=this.proxyToSource[F.tileID.key][a.id],$=this._createProxiedId(F.tileID,O,g[F.tileID.key]&&g[F.tileID.key][a.id]);B?B.splice(B.length-1,0,$):this.proxyToSource[F.tileID.key][a.id]=[$];const G=this.proxyToSource[F.tileID.key][a.id];C.has(G)||C.add(G),v.push($),E=!0}}if(this._sourceTilesOverlap[a.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(const k of C)k.sort((O,F)=>F.overscaledZ-O.overscaledZ)}_setupProxiedCoordsForImageSource(a,h,g){if(!a.getSource().loaded())return;const v=this.proxiedCoords[a.id]=[],w=this.proxyCoords,E=a.getSource(),C=E.tileID;if(!C)return;const k=new l.P(C.x,C.y)._div(1<<C.z),O=E.coordinates.map(l.O.fromLngLat).reduce((B,$)=>(B.min.x=Math.min(B.min.x,$.x-k.x),B.min.y=Math.min(B.min.y,$.y-k.y),B.max.x=Math.max(B.max.x,$.x-k.x),B.max.y=Math.max(B.max.y,$.y-k.y),B),{min:new l.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new l.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(B,$)=>{const G=B.wrap+B.canonical.x/(1<<B.canonical.z),X=B.canonical.y/(1<<B.canonical.z),Z=l.Y/(1<<B.canonical.z),Y=$.wrap+$.canonical.x/(1<<$.canonical.z),K=$.canonical.y/(1<<$.canonical.z);return G+Z<Y+O.min.x||G>Y+O.max.x||X+Z<K+O.min.y||X>K+O.max.y};for(let B=0;B<w.length;B++){const $=w[B];for(let G=0;G<h.length;G++){const X=a.getTile(h[G]);if(!X||!X.hasData()||F($,X.tileID))continue;const Z=this._createProxiedId($,X,g[$.key]&&g[$.key][a.id]),Y=this.proxyToSource[$.key][a.id];Y?Y.push(Z):this.proxyToSource[$.key][a.id]=[Z],v.push(Z)}}}_createProxiedId(a,h,g){let v=this.orthoMatrix;if(g){const w=g.find(E=>E.key===h.tileID.key);if(w)return w}if(h.tileID.key!==a.key){const w=a.canonical.z-h.tileID.canonical.z;let E,C,k;v=l.a9.create();const O=h.tileID.wrap-a.wrap<<a.overscaledZ;w>0?(E=l.Y>>w,C=E*((h.tileID.canonical.x<<w)-a.canonical.x+O),k=E*((h.tileID.canonical.y<<w)-a.canonical.y)):(E=l.Y<<-w,C=l.Y*(h.tileID.canonical.x-(a.canonical.x+O<<-w)),k=l.Y*(h.tileID.canonical.y-(a.canonical.y<<-w))),l.a9.ortho(v,0,E,0,E,0,1),l.a9.translate(v,v,[C,k,0])}return new Vs(h.tileID,a.key,v)}_findTileCoveringTileID(a,h){let g=h.getTile(a);if(g&&g.hasData())return g;const v=this._findCoveringTileCache[h.id],w=v[a.key];if(g=w?h.getTileByID(w):null,g&&g.hasData()||w===null)return g;let E=g?g.tileID:a,C=E.overscaledZ;const k=h.getSource().minzoom,O=[];if(!w){const B=h.getSource().maxzoom;if(a.canonical.z>=B){const $=a.canonical.z-B;h.getSource().reparseOverscaled?(C=Math.max(a.canonical.z+2,h.transform.tileZoom),E=new l.ap(C,a.wrap,B,a.canonical.x>>$,a.canonical.y>>$)):$!==0&&(C=B,E=new l.ap(C,a.wrap,B,a.canonical.x>>$,a.canonical.y>>$))}E.key!==a.key&&(O.push(E.key),g=h.getTile(E))}const F=B=>{O.forEach($=>{v[$]=B}),O.length=0};for(C-=1;C>=k&&(!g||!g.hasData());C--){g&&F(g.tileID.key);const B=E.calculateScaledKey(C);if(g=h.getTileByID(B),g&&g.hasData())break;const $=v[B];if($===null)break;$===void 0?O.push(B):g=h.getTileByID($)}return F(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,h){let g=this._tilesDirty[a];g||(g=this._tilesDirty[a]={}),g[h.key]=!0}}function Z1(m,a,h){const g=function(C,k,O){const F=l.Q.dot(k,C),B=l.Q.dot(O,[.2126,.7152,.0722]),$=(X,Z,Y)=>(1-Y)*X+Y*Z,G=$(1-.3*Math.min(B,1),1,Math.min(F+1,1));return $(.92,1,Math.asin(l.ad(k[2],-1,1))/Math.PI+.5)*G}(m,[0,0,1],a),v=[0,0,0];l.Q.scale(v,h.slice(0,3),g);const w=[0,0,0];l.Q.scale(w,a.slice(0,3),m[2]);const E=[0,0,0];return l.Q.add(E,v,w),l.bX(E)}const Bh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Kn=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Ca{static cacheKey(a,h,g,v){let w=`${h}${v?v.cacheKey:""}`;for(const E of g)a.usedDefines.includes(E)&&(w+=`/${E}`);return w}constructor(a,h,g,v,w,E){const C=a.gl;this.program=C.createProgram(),this.configuration=v,this.name=h,this.fixedDefines=[...E];const k=v?v.getBinderAttributes():[],O=(g.staticAttributes||[]).concat(k);let F=v?v.defines():[];F=F.concat(E.map(Y=>`#define ${Y}`));const B=`#version 300 es
`;let $=B+F.concat("precision mediump float;",Fm,Cf.fragmentSource).join(`
`);for(const Y of g.fragmentIncludes)$+=`
${ri[Y]}`;$+=`
${g.fragmentSource}`;let G=B+F.concat("precision highp float;",Fm,Cf.vertexSource).join(`
`);for(const Y of g.vertexIncludes)G+=`
${ri[Y]}`;G+=`
${g.vertexSource}`;const X=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(X,$),C.compileShader(X),C.attachShader(this.program,X);const Z=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(Z,G),C.compileShader(Z),C.attachShader(this.program,Z),this.attributes={},this.numAttributes=O.length;for(let Y=0;Y<this.numAttributes;Y++)if(O[Y]){const K=O[Y].startsWith("a_")?O[Y]:`a_${O[Y]}`;C.bindAttribLocation(this.program,Y,K),this.attributes[K]=Y}C.linkProgram(this.program),C.deleteShader(Z),C.deleteShader(X),this.fixedUniforms=w(a),this.binderUniforms=v?v.getUniforms(a):[],E.includes("TERRAIN")&&(this.terrainUniforms=(Y=>({u_dem:new l.bR(Y),u_dem_prev:new l.bR(Y),u_dem_tl:new l.bO(Y),u_dem_scale:new l.bQ(Y),u_dem_tl_prev:new l.bO(Y),u_dem_scale_prev:new l.bQ(Y),u_dem_size:new l.bQ(Y),u_dem_lerp:new l.bQ(Y),u_exaggeration:new l.bQ(Y),u_depth:new l.bR(Y),u_depth_size_inv:new l.bO(Y),u_meter_to_dem:new l.bQ(Y),u_label_plane_matrix_inv:new l.bN(Y)}))(a)),E.includes("GLOBE")&&(this.globeUniforms=(Y=>({u_tile_tl_up:new l.bP(Y),u_tile_tr_up:new l.bP(Y),u_tile_br_up:new l.bP(Y),u_tile_bl_up:new l.bP(Y),u_tile_up_scale:new l.bQ(Y)}))(a)),E.includes("FOG")&&(this.fogUniforms=(Y=>({u_fog_matrix:new l.bN(Y),u_fog_range:new l.bO(Y),u_fog_color:new l.bS(Y),u_fog_horizon_blend:new l.bQ(Y),u_fog_vertical_limit:new l.bO(Y),u_fog_temporal_offset:new l.bQ(Y),u_frustum_tl:new l.bP(Y),u_frustum_tr:new l.bP(Y),u_frustum_br:new l.bP(Y),u_frustum_bl:new l.bP(Y),u_globe_pos:new l.bP(Y),u_globe_radius:new l.bQ(Y),u_globe_transition:new l.bQ(Y),u_is_globe:new l.bR(Y),u_viewport:new l.bO(Y)}))(a)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Y=>({u_cutoff_params:new l.bS(Y)}))(a)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Y=>({u_lighting_ambient_color:new l.bP(Y),u_lighting_directional_dir:new l.bP(Y),u_lighting_directional_color:new l.bP(Y),u_ground_radiance:new l.bP(Y)}))(a)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Y=>({u_light_matrix_0:new l.bN(Y),u_light_matrix_1:new l.bN(Y),u_fade_range:new l.bO(Y),u_shadow_normal_offset:new l.bP(Y),u_shadow_intensity:new l.bQ(Y),u_shadow_texel_size:new l.bQ(Y),u_shadow_map_resolution:new l.bQ(Y),u_shadow_direction:new l.bP(Y),u_shadow_bias:new l.bP(Y),u_shadowmap_0:new l.bR(Y),u_shadowmap_1:new l.bR(Y)}))(a))}}setTerrainUniformValues(a,h){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in h)g[v]&&g[v].set(this.program,v,h[v])}}setGlobeUniformValues(a,h){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in h)g[v]&&g[v].set(this.program,v,h[v])}}setFogUniformValues(a,h){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in h)g[v].set(this.program,v,h[v])}}setCutoffUniformValues(a,h){if(!this.cutoffUniforms)return;const g=this.cutoffUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in h)g[v].set(this.program,v,h[v])}}setLightsUniformValues(a,h){if(!this.lightsUniforms)return;const g=this.lightsUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in h)g[v].set(this.program,v,h[v])}}setShadowUniformValues(a,h){if(this.failedToCreate||!this.shadowUniforms)return;const g=this.shadowUniforms;a.program.set(this.program);for(const v in h)g[v].set(this.program,v,h[v])}_drawDebugWireframe(a,h,g,v,w,E,C,k,O,F){const B=a.options.wireframe;if(B.terrain===!1&&B.layers2D===!1&&B.layers3D===!1)return;const $=a.context;if(!(!(!B.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!B.layers2D||a._terrain&&a._terrain.renderingToTexture||!Bh.includes(this.name))||!(!B.layers3D||!Kn.includes(this.name))))return;const G=$.gl,X=a.wireframeDebugCache.getLinesFromTrianglesBuffer(a.frameCounter,w,$);if(!X)return;const Z=[...this.fixedDefines];Z.push("DEBUG_WIREFRAME");const Y=a.getOrCreateProgram(this.name,{config:this.configuration,defines:Z});$.program.set(Y.program);const K=(de,ye,J)=>{if(ye[de]&&J[de])for(const ae in ye[de])J[de][ae]&&J[de][ae].set(J.program,ae,ye[de][ae].current)};O&&O.setUniforms(Y.program,$,Y.binderUniforms,C,{zoom:k}),K("fixedUniforms",this,Y),K("terrainUniforms",this,Y),K("globeUniforms",this,Y),K("fogUniforms",this,Y),K("lightsUniforms",this,Y),K("shadowUniforms",this,Y),X.bind(),$.setColorMode(new $r([G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ZERO,G.ONE],l.aA.transparent,[!0,!0,!0,!1])),$.setDepthMode(new hr(h.func===G.LESS?G.LEQUAL:h.func,hr.ReadOnly,h.range)),$.setStencilMode(Dr.disabled);const ne=3*E.primitiveLength*2,fe=3*E.primitiveOffset*2*2;F&&F>1?G.drawElementsInstanced(G.LINES,ne,G.UNSIGNED_SHORT,fe,F):G.drawElements(G.LINES,ne,G.UNSIGNED_SHORT,fe),w.bind(),$.program.set(this.program),$.setDepthMode(h),$.setStencilMode(g),$.setColorMode(v)}draw(a,h,g,v,w,E,C,k,O,F,B,$,G,X,Z,Y){const K=a.context,ne=K.gl;if(this.failedToCreate)return;K.program.set(this.program),K.setDepthMode(g),K.setStencilMode(v),K.setColorMode(w),K.setCullFace(E);for(const ye of Object.keys(this.fixedUniforms))this.fixedUniforms[ye].set(this.program,ye,C[ye]);X&&X.setUniforms(this.program,K,this.binderUniforms,$,{zoom:G});const fe={[ne.POINTS]:1,[ne.LINES]:2,[ne.TRIANGLES]:3,[ne.LINE_STRIP]:1}[h],de=Y&&Y>0?1:void 0;for(const ye of B.get()){const J=ye.vaos||(ye.vaos={});(J[k]||(J[k]=new Jt)).bind(K,this,O,X?X.getPaintVertexBuffers():[],F,ye.vertexOffset,Z||[],de),Y&&Y>1?ne.drawElementsInstanced(h,ye.primitiveLength*fe,ne.UNSIGNED_SHORT,ye.primitiveOffset*fe*2,Y):F?ne.drawElements(h,ye.primitiveLength*fe,ne.UNSIGNED_SHORT,ye.primitiveOffset*fe*2):ne.drawArrays(h,ye.vertexOffset,ye.vertexLength),h===ne.TRIANGLES&&F&&this._drawDebugWireframe(a,g,v,w,F,ye,$,G,X,Y)}}}function Tl(m,a){const h=Math.pow(2,a.tileID.overscaledZ),g=a.tileSize*Math.pow(2,m.transform.tileZoom)/h,v=g*(a.tileID.canonical.x+a.tileID.wrap*h),w=g*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture?a.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/l.a6(a,1,m.transform.tileZoom),u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const ms=l.a9.create(),Bm=(m,a,h,g,v,w,E,C,k,O,F,B,$,G,X,Z)=>{const Y=a.style.light,K=Y.properties.get("position"),ne=[K.x,K.y,K.z],fe=l.ct.create();Y.properties.get("anchor")==="viewport"&&(l.ct.fromRotation(fe,-a.transform.angle),l.Q.transformMat3(ne,ne,fe));const de=Y.properties.get("color"),ye=a.transform,J={u_matrix:m,u_lightpos:ne,u_lightintensity:Y.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_vertical_gradient:+h,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ms,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:w,u_flood_light_color:B,u_vertical_scale:$,u_flood_light_intensity:G,u_ground_shadow_factor:X,u_emissive_strength:Z};return ye.projection.name==="globe"&&(J.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],J.u_zoom_transition=k,J.u_inv_rot_matrix=F,J.u_merc_center=O,J.u_up_dir=ye.projection.upVector(new l.bv(0,0,0),O[0]*l.Y,O[1]*l.Y),J.u_height_lift=C),J},Ja=(m,a,h)=>({u_matrix:m,u_edge_radius:a,u_vertical_scale:h}),kf=(m,a,h,g,v,w,E,C,k,O,F,B,$,G)=>{const X=Bm(m,a,h,g,v,w,E,k,O,F,B,$,G,1,[0,0,0],0),Z={u_height_factor:-Math.pow(2,E.overscaledZ)/C.tileSize/8};return l.e(X,Tl(a,C),Z)},Vh=(m,a)=>({u_matrix:m,u_emissive_strength:a}),Vc=(m,a,h,g)=>l.e(Vh(m,a),Tl(h,g)),qE=(m,a,h)=>({u_matrix:m,u_world:h,u_emissive_strength:a}),tc=(m,a,h,g,v)=>l.e(Vc(m,a,h,g),{u_world:v}),HE=(m,a,h,g)=>{const v=l.Y/h.tileSize;return{u_matrix:m,u_camera_to_center_distance:a.getCameraToCenterDistance(g),u_extrude_scale:[a.pixelsToGLUnits[0]/v,a.pixelsToGLUnits[1]/v]}},w0=(m,a,h=1)=>({u_matrix:m,u_color:a,u_overlay:0,u_overlay_scale:h}),Oo=l.a9.create(),WE=(m,a,h,g,v,w,E)=>{const C=m.transform,k=C.projection.name==="globe",O=k?l.cu(C.zoom,a.canonical)*C._pixelsPerMercatorPixel:l.a6(h,1,w),F={u_matrix:a.projMatrix,u_extrude_scale:O,u_intensity:E,u_inv_rot_matrix:Oo,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){F.u_inv_rot_matrix=g,F.u_merc_center=v,F.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],F.u_zoom_transition=l.W(C.zoom);const B=v[0]*l.Y,$=v[1]*l.Y;F.u_up_dir=C.projection.upVector(new l.bv(0,0,0),B,$)}return F};function Df(m,[a,h,g,v],[w,E]){if(w===E)return[0,0,0,0];const C=255*(m-1)/(m*(E-w));return[a*C,h*C,g*C,v*C]}function T0(m,a,[h,g]){return h===g?0:.5/m+(a-h)*(m-1)/(m*(g-h))}const X1=(m,a,h,g,v,w,E,C,k,O,F,B,$,G,X,Z,Y,K,ne,fe,de)=>({u_matrix:m,u_normalize_matrix:a,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:w,u_scale_parent:O,u_fade_t:F.mix,u_opacity:F.opacity*B.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:B.paint.get("raster-brightness-min"),u_brightness_high:B.paint.get("raster-brightness-max"),u_saturation_factor:l.cv(B.paint.get("raster-saturation")),u_contrast_factor:l.cw(B.paint.get("raster-contrast")),u_spin_weights:ZE(B.paint.get("raster-hue-rotate")),u_perspective_transform:$,u_raster_elevation:G,u_zoom_transition:E,u_merc_center:C,u_cutoff_params:k,u_colorization_mix:Df(l.cx,Z,K),u_colorization_offset:T0(l.cx,Y,K),u_color_ramp:X,u_texture_offset:[fe/(ne+2*fe),ne/(ne+2*fe)],u_texture_res:[ne+2*fe,ne+2*fe],u_emissive_strength:de});function ZE(m){m*=Math.PI/180;const a=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*a-h+1)/3,(Math.sqrt(3)*a-h+1)/3]}const Lf=(m,a,h,g,v,w,E,C,k,O,F,B)=>({u_matrix:m,u_normalize_matrix:a,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:w,u_scale_parent:O,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:B,u_zoom_transition:E,u_merc_center:C,u_cutoff_params:k}),Of=(m,a,h,g,v,w,E,C,k,O)=>({u_particle_texture:m,u_particle_texture_side_len:a,u_tile_offset:h,u_velocity:g,u_color_ramp:w,u_velocity_res:v,u_max_speed:E,u_uv_offset:C,u_data_scale:k,u_data_offset:O,u_particle_pos_scale:1.3,u_particle_pos_offset:[Zl,Zl]}),XE=(m,a,h,g,v,w,E,C,k,O)=>({u_particle_texture:m,u_particle_texture_side_len:a,u_velocity:h,u_velocity_res:g,u_max_speed:v,u_speed_factor:w,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:k,u_data_offset:O,u_particle_pos_scale:1.3,u_particle_pos_offset:[Zl,Zl]}),zu=l.a9.create(),E0=(m,a,h,g,v,w,E,C,k,O,F,B,$,G,X,Z,Y,K)=>{const ne=v.transform,fe={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:ne.getCameraToCenterDistance(Z),u_rotate_symbol:+h,u_aspect_ratio:ne.width/ne.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:E,u_coord_matrix:C,u_is_text:+k,u_pitch_with_map:+g,u_texsize:O,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:zu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:zu,u_up_vector:[0,-1,0],u_color_adj_mat:Y,u_icon_transition:K||0};return Z.name==="globe"&&(fe.u_tile_id=[F.canonical.x,F.canonical.y,1<<F.canonical.z],fe.u_zoom_transition=B,fe.u_inv_rot_matrix=G,fe.u_merc_center=$,fe.u_camera_forward=ne._camera.forward(),fe.u_ecef_origin=l.cy(ne.globeMatrix,F.toUnwrapped()),fe.u_tile_matrix=Float32Array.from(ne.globeMatrix),fe.u_up_vector=X),fe},Uh=(m,a,h,g,v,w,E,C,k,O,F,B,$,G,X,Z,Y)=>l.e(E0(m,a,h,g,v,w,E,C,k,O,B,$,G,X,Z,Y),{u_gamma_scale:g?v.transform.getCameraToCenterDistance(Y)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:l.f.devicePixelRatio,u_is_halo:+F,undefined:void 0}),Uc=(m,a,h,g,v,w,E,C,k,O,F,B,$,G,X,Z)=>l.e(Uh(m,a,h,g,v,w,E,C,!0,k,!0,F,B,$,G,X,Z),{u_texsize_icon:O,u_texture_icon:1}),YE=(m,a,h,g)=>({u_matrix:m,u_emissive_strength:a,u_opacity:h,u_color:g}),QE=(m,a,h,g,v,w,E)=>l.e(function(C,k,O,F){const B=O.imageManager.getPattern(C.toString(),k),{width:$,height:G}=O.imageManager.getPixelSize(k),X=Math.pow(2,F.tileID.overscaledZ),Z=F.tileSize*Math.pow(2,O.transform.tileZoom)/X,Y=Z*(F.tileID.canonical.x+F.tileID.wrap*X),K=Z*F.tileID.canonical.y;return{u_image:0,u_pattern_tl:B.tl,u_pattern_br:B.br,u_texsize:[$,G],u_pattern_size:B.displaySize,u_tile_units_to_pixels:1/l.a6(F,1,O.transform.tileZoom),u_pixel_coord_upper:[Y>>16,K>>16],u_pixel_coord_lower:[65535&Y,65535&K]}}(v,w,g,E),{u_matrix:m,u_emissive_strength:a,u_opacity:h}),A0=new Float32Array(l.a9.identity([])),Vm=(m,a,h,g,v,w,E,C,k,O,F,B,$,G=[0,0,0],X)=>{const Z=v.style.light,Y=Z.properties.get("position"),K=[-Y.x,-Y.y,Y.z],ne=l.ct.create();Z.properties.get("anchor")==="viewport"&&(l.ct.fromRotation(ne,-v.transform.angle),l.Q.transformMat3(K,K,ne));const fe=F.alphaMode==="MASK",de=Z.properties.get("color"),ye=$.paint.get("model-ambient-occlusion-intensity"),J=$.paint.get("model-color").constantOr(l.aA.white),ae=$.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:m,u_lighting_matrix:a,u_normal_matrix:h,u_node_matrix:g||A0,u_lightpos:K,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_camera_pos:G,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+fe,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:[E.r,E.g,E.b,E.a],u_emissiveFactor:[C[0],C[1],C[2],1],u_metallicFactor:k,u_roughnessFactor:O,u_baseColorTexture:Do.BaseColor,u_metallicRoughnessTexture:Do.MetallicRoughness,u_normalTexture:Do.Normal,u_occlusionTexture:Do.Occlusion,u_emissionTexture:Do.Emission,u_color_mix:[J.r,J.g,J.b,ae],u_aoIntensity:ye,u_emissive_strength:B,u_occlusionTextureTransform:X||[0,0,0,0]}},Y1=(m,a=A0,h=A0)=>({u_matrix:m,u_instance:a,u_node_matrix:h}),I0={fillExtrusion:m=>({u_matrix:new l.bN(m),u_lightpos:new l.bP(m),u_lightintensity:new l.bQ(m),u_lightcolor:new l.bP(m),u_vertical_gradient:new l.bQ(m),u_opacity:new l.bQ(m),u_edge_radius:new l.bQ(m),u_ao:new l.bO(m),u_tile_id:new l.bP(m),u_zoom_transition:new l.bQ(m),u_inv_rot_matrix:new l.bN(m),u_merc_center:new l.bO(m),u_up_dir:new l.bP(m),u_height_lift:new l.bQ(m),u_flood_light_color:new l.bP(m),u_vertical_scale:new l.bQ(m),u_flood_light_intensity:new l.bQ(m),u_ground_shadow_factor:new l.bP(m),u_emissive_strength:new l.bQ(m)}),fillExtrusionDepth:m=>({u_matrix:new l.bN(m),u_edge_radius:new l.bQ(m),u_vertical_scale:new l.bQ(m)}),fillExtrusionPattern:m=>({u_matrix:new l.bN(m),u_lightpos:new l.bP(m),u_lightintensity:new l.bQ(m),u_lightcolor:new l.bP(m),u_vertical_gradient:new l.bQ(m),u_height_factor:new l.bQ(m),u_edge_radius:new l.bQ(m),u_ao:new l.bO(m),u_tile_id:new l.bP(m),u_zoom_transition:new l.bQ(m),u_inv_rot_matrix:new l.bN(m),u_merc_center:new l.bO(m),u_up_dir:new l.bP(m),u_height_lift:new l.bQ(m),u_image:new l.bR(m),u_texsize:new l.bO(m),u_pixel_coord_upper:new l.bO(m),u_pixel_coord_lower:new l.bO(m),u_tile_units_to_pixels:new l.bQ(m),u_opacity:new l.bQ(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new l.bN(m),u_opacity:new l.bQ(m),u_ao_pass:new l.bQ(m),u_meter_to_tile:new l.bQ(m),u_ao:new l.bO(m),u_flood_light_intensity:new l.bQ(m),u_flood_light_color:new l.bP(m),u_attenuation:new l.bQ(m),u_edge_radius:new l.bQ(m),u_fb:new l.bR(m),u_fb_size:new l.bQ(m)}),fill:m=>({u_matrix:new l.bN(m),u_emissive_strength:new l.bQ(m)}),fillPattern:m=>({u_matrix:new l.bN(m),u_emissive_strength:new l.bQ(m),u_image:new l.bR(m),u_texsize:new l.bO(m),u_pixel_coord_upper:new l.bO(m),u_pixel_coord_lower:new l.bO(m),u_tile_units_to_pixels:new l.bQ(m)}),fillOutline:m=>({u_matrix:new l.bN(m),u_emissive_strength:new l.bQ(m),u_world:new l.bO(m)}),fillOutlinePattern:m=>({u_matrix:new l.bN(m),u_emissive_strength:new l.bQ(m),u_world:new l.bO(m),u_image:new l.bR(m),u_texsize:new l.bO(m),u_pixel_coord_upper:new l.bO(m),u_pixel_coord_lower:new l.bO(m),u_tile_units_to_pixels:new l.bQ(m)}),circle:l.cz,collisionBox:m=>({u_matrix:new l.bN(m),u_camera_to_center_distance:new l.bQ(m),u_extrude_scale:new l.bO(m)}),collisionCircle:m=>({u_matrix:new l.bN(m),u_inv_matrix:new l.bN(m),u_camera_to_center_distance:new l.bQ(m),u_viewport_size:new l.bO(m)}),debug:m=>({u_color:new l.cf(m),u_matrix:new l.bN(m),u_overlay:new l.bR(m),u_overlay_scale:new l.bQ(m)}),clippingMask:m=>({u_matrix:new l.bN(m)}),heatmap:m=>({u_extrude_scale:new l.bQ(m),u_intensity:new l.bQ(m),u_matrix:new l.bN(m),u_inv_rot_matrix:new l.bN(m),u_merc_center:new l.bO(m),u_tile_id:new l.bP(m),u_zoom_transition:new l.bQ(m),u_up_dir:new l.bP(m)}),heatmapTexture:m=>({u_image:new l.bR(m),u_color_ramp:new l.bR(m),u_opacity:new l.bQ(m)}),hillshade:m=>({u_matrix:new l.bN(m),u_image:new l.bR(m),u_latrange:new l.bO(m),u_light:new l.bO(m),u_shadow:new l.cf(m),u_highlight:new l.cf(m),u_emissive_strength:new l.bQ(m),u_accent:new l.cf(m)}),hillshadePrepare:m=>({u_matrix:new l.bN(m),u_image:new l.bR(m),u_dimension:new l.bO(m),u_zoom:new l.bQ(m)}),line:l.cA,linePattern:l.cB,raster:m=>({u_matrix:new l.bN(m),u_normalize_matrix:new l.bN(m),u_globe_matrix:new l.bN(m),u_merc_matrix:new l.bN(m),u_grid_matrix:new l.cg(m),u_tl_parent:new l.bO(m),u_scale_parent:new l.bQ(m),u_fade_t:new l.bQ(m),u_opacity:new l.bQ(m),u_image0:new l.bR(m),u_image1:new l.bR(m),u_brightness_low:new l.bQ(m),u_brightness_high:new l.bQ(m),u_saturation_factor:new l.bQ(m),u_contrast_factor:new l.bQ(m),u_spin_weights:new l.bP(m),u_perspective_transform:new l.bO(m),u_raster_elevation:new l.bQ(m),u_zoom_transition:new l.bQ(m),u_merc_center:new l.bO(m),u_cutoff_params:new l.bS(m),u_colorization_mix:new l.bS(m),u_colorization_offset:new l.bQ(m),u_color_ramp:new l.bR(m),u_texture_offset:new l.bO(m),u_texture_res:new l.bO(m),u_emissive_strength:new l.bQ(m)}),rasterParticle:m=>({u_matrix:new l.bN(m),u_normalize_matrix:new l.bN(m),u_globe_matrix:new l.bN(m),u_merc_matrix:new l.bN(m),u_grid_matrix:new l.cg(m),u_tl_parent:new l.bO(m),u_scale_parent:new l.bQ(m),u_fade_t:new l.bQ(m),u_opacity:new l.bQ(m),u_image0:new l.bR(m),u_image1:new l.bR(m),u_raster_elevation:new l.bQ(m),u_zoom_transition:new l.bQ(m),u_merc_center:new l.bO(m),u_cutoff_params:new l.bS(m)}),rasterParticleTexture:m=>({u_texture:new l.bR(m),u_opacity:new l.bQ(m)}),rasterParticleDraw:m=>({u_particle_texture:new l.bR(m),u_particle_texture_side_len:new l.bQ(m),u_tile_offset:new l.bO(m),u_velocity:new l.bR(m),u_color_ramp:new l.bR(m),u_velocity_res:new l.bO(m),u_max_speed:new l.bQ(m),u_uv_offset:new l.bO(m),u_data_scale:new l.bS(m),u_data_offset:new l.bQ(m),u_particle_pos_scale:new l.bQ(m),u_particle_pos_offset:new l.bO(m)}),rasterParticleUpdate:m=>({u_particle_texture:new l.bR(m),u_particle_texture_side_len:new l.bQ(m),u_velocity:new l.bR(m),u_velocity_res:new l.bO(m),u_max_speed:new l.bQ(m),u_speed_factor:new l.bQ(m),u_reset_rate:new l.bQ(m),u_rand_seed:new l.bQ(m),u_uv_offset:new l.bO(m),u_data_scale:new l.bS(m),u_data_offset:new l.bQ(m),u_particle_pos_scale:new l.bQ(m),u_particle_pos_offset:new l.bO(m)}),symbolIcon:m=>({u_is_size_zoom_constant:new l.bR(m),u_is_size_feature_constant:new l.bR(m),u_size_t:new l.bQ(m),u_size:new l.bQ(m),u_camera_to_center_distance:new l.bQ(m),u_rotate_symbol:new l.bR(m),u_aspect_ratio:new l.bQ(m),u_fade_change:new l.bQ(m),u_matrix:new l.bN(m),u_label_plane_matrix:new l.bN(m),u_coord_matrix:new l.bN(m),u_is_text:new l.bR(m),u_pitch_with_map:new l.bR(m),u_texsize:new l.bO(m),u_tile_id:new l.bP(m),u_zoom_transition:new l.bQ(m),u_inv_rot_matrix:new l.bN(m),u_merc_center:new l.bO(m),u_camera_forward:new l.bP(m),u_tile_matrix:new l.bN(m),u_up_vector:new l.bP(m),u_ecef_origin:new l.bP(m),u_texture:new l.bR(m),u_icon_transition:new l.bQ(m),u_color_adj_mat:new l.bN(m)}),symbolSDF:m=>({u_is_size_zoom_constant:new l.bR(m),u_is_size_feature_constant:new l.bR(m),u_size_t:new l.bQ(m),u_size:new l.bQ(m),u_camera_to_center_distance:new l.bQ(m),u_rotate_symbol:new l.bR(m),u_aspect_ratio:new l.bQ(m),u_fade_change:new l.bQ(m),u_matrix:new l.bN(m),u_label_plane_matrix:new l.bN(m),u_coord_matrix:new l.bN(m),u_is_text:new l.bR(m),u_pitch_with_map:new l.bR(m),u_texsize:new l.bO(m),u_texture:new l.bR(m),u_gamma_scale:new l.bQ(m),u_device_pixel_ratio:new l.bQ(m),u_tile_id:new l.bP(m),u_zoom_transition:new l.bQ(m),u_inv_rot_matrix:new l.bN(m),u_merc_center:new l.bO(m),u_camera_forward:new l.bP(m),u_tile_matrix:new l.bN(m),u_up_vector:new l.bP(m),u_ecef_origin:new l.bP(m),u_is_halo:new l.bR(m)}),symbolTextAndIcon:m=>({u_is_size_zoom_constant:new l.bR(m),u_is_size_feature_constant:new l.bR(m),u_size_t:new l.bQ(m),u_size:new l.bQ(m),u_camera_to_center_distance:new l.bQ(m),u_rotate_symbol:new l.bR(m),u_aspect_ratio:new l.bQ(m),u_fade_change:new l.bQ(m),u_matrix:new l.bN(m),u_label_plane_matrix:new l.bN(m),u_coord_matrix:new l.bN(m),u_is_text:new l.bR(m),u_pitch_with_map:new l.bR(m),u_texsize:new l.bO(m),u_texsize_icon:new l.bO(m),u_texture:new l.bR(m),u_texture_icon:new l.bR(m),u_gamma_scale:new l.bQ(m),u_device_pixel_ratio:new l.bQ(m),u_is_halo:new l.bR(m)}),background:m=>({u_matrix:new l.bN(m),u_emissive_strength:new l.bQ(m),u_opacity:new l.bQ(m),u_color:new l.cf(m)}),backgroundPattern:m=>({u_matrix:new l.bN(m),u_emissive_strength:new l.bQ(m),u_opacity:new l.bQ(m),u_image:new l.bR(m),u_pattern_tl:new l.bO(m),u_pattern_br:new l.bO(m),u_texsize:new l.bO(m),u_pattern_size:new l.bO(m),u_pixel_coord_upper:new l.bO(m),u_pixel_coord_lower:new l.bO(m),u_tile_units_to_pixels:new l.bQ(m)}),terrainRaster:wi,terrainDepth:wi,skybox:m=>({u_matrix:new l.bN(m),u_sun_direction:new l.bP(m),u_cubemap:new l.bR(m),u_opacity:new l.bQ(m),u_temporal_offset:new l.bQ(m)}),skyboxGradient:m=>({u_matrix:new l.bN(m),u_color_ramp:new l.bR(m),u_center_direction:new l.bP(m),u_radius:new l.bQ(m),u_opacity:new l.bQ(m),u_temporal_offset:new l.bQ(m)}),skyboxCapture:m=>({u_matrix_3f:new l.cg(m),u_sun_direction:new l.bP(m),u_sun_intensity:new l.bQ(m),u_color_tint_r:new l.bS(m),u_color_tint_m:new l.bS(m),u_luminance:new l.bQ(m)}),globeRaster:m=>({u_proj_matrix:new l.bN(m),u_globe_matrix:new l.bN(m),u_normalize_matrix:new l.bN(m),u_merc_matrix:new l.bN(m),u_zoom_transition:new l.bQ(m),u_merc_center:new l.bO(m),u_image0:new l.bR(m),u_grid_matrix:new l.cg(m),u_skirt_height:new l.bQ(m),u_far_z_cutoff:new l.bQ(m),u_frustum_tl:new l.bP(m),u_frustum_tr:new l.bP(m),u_frustum_br:new l.bP(m),u_frustum_bl:new l.bP(m),u_globe_pos:new l.bP(m),u_globe_radius:new l.bQ(m),u_viewport:new l.bO(m)}),globeAtmosphere:m=>({u_frustum_tl:new l.bP(m),u_frustum_tr:new l.bP(m),u_frustum_br:new l.bP(m),u_frustum_bl:new l.bP(m),u_horizon:new l.bQ(m),u_transition:new l.bQ(m),u_fadeout_range:new l.bQ(m),u_color:new l.bS(m),u_high_color:new l.bS(m),u_space_color:new l.bS(m),u_temporal_offset:new l.bQ(m),u_horizon_angle:new l.bQ(m)}),model:m=>({u_matrix:new l.bN(m),u_lighting_matrix:new l.bN(m),u_normal_matrix:new l.bN(m),u_node_matrix:new l.bN(m),u_lightpos:new l.bP(m),u_lightintensity:new l.bQ(m),u_lightcolor:new l.bP(m),u_camera_pos:new l.bP(m),u_opacity:new l.bQ(m),u_baseColorFactor:new l.bS(m),u_emissiveFactor:new l.bS(m),u_metallicFactor:new l.bQ(m),u_roughnessFactor:new l.bQ(m),u_baseTextureIsAlpha:new l.bR(m),u_alphaMask:new l.bR(m),u_alphaCutoff:new l.bQ(m),u_baseColorTexture:new l.bR(m),u_metallicRoughnessTexture:new l.bR(m),u_normalTexture:new l.bR(m),u_occlusionTexture:new l.bR(m),u_emissionTexture:new l.bR(m),u_color_mix:new l.bS(m),u_aoIntensity:new l.bQ(m),u_emissive_strength:new l.bQ(m),u_occlusionTextureTransform:new l.bS(m)}),modelDepth:m=>({u_matrix:new l.bN(m),u_instance:new l.bN(m),u_node_matrix:new l.bN(m)}),groundShadow:m=>({u_matrix:new l.bN(m),u_ground_shadow_factor:new l.bP(m)}),stars:m=>({u_matrix:new l.bN(m),u_up:new l.bP(m),u_right:new l.bP(m),u_intensity_multiplier:new l.bQ(m)})};let zf;function S0(m,a,h,g,v,w,E){const C=m.context,k=C.gl,O=m.transform,F=m.getOrCreateProgram("collisionBox"),B=[];let $=0,G=0;for(let de=0;de<g.length;de++){const ye=g[de],J=a.getTile(ye),ae=J.getBucket(h);if(!ae)continue;const ke=ve(ye,ae,O);let Re=ke;v[0]===0&&v[1]===0||(Re=m.translatePosMatrix(ke,J,v,w));const Ne=E?ae.textCollisionBox:ae.iconCollisionBox,et=ae.collisionCircleArray;if(et.length>0){const ze=l.a9.create(),Qe=Re;l.a9.mul(ze,ae.placementInvProjMatrix,O.glCoordMatrix),l.a9.mul(ze,ze,ae.placementViewportMatrix),B.push({circleArray:et,circleOffset:G,transform:Qe,invTransform:ze,projection:ae.getProjection()}),$+=et.length/4,G=$}Ne&&(m.terrain&&m.terrain.setupElevationDraw(J,F),F.draw(m,k.LINES,hr.disabled,Dr.disabled,m.colorModeForRenderPass(),Cr.disabled,HE(Re,O,J,ae.getProjection()),h.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,null,O.zoom,null,[Ne.collisionVertexBuffer,Ne.collisionVertexBufferExt]))}if(!E||!B.length)return;const X=m.getOrCreateProgram("collisionCircle"),Z=new l.cC;Z.resize(4*$),Z._trim();let Y=0;for(const de of B)for(let ye=0;ye<de.circleArray.length/4;ye++){const J=4*ye,ae=de.circleArray[J+0],ke=de.circleArray[J+1],Re=de.circleArray[J+2],Ne=de.circleArray[J+3];Z.emplace(Y++,ae,ke,Re,Ne,0),Z.emplace(Y++,ae,ke,Re,Ne,1),Z.emplace(Y++,ae,ke,Re,Ne,2),Z.emplace(Y++,ae,ke,Re,Ne,3)}(!zf||zf.length<2*$)&&(zf=function(de){const ye=2*de,J=new l.az;J.resize(ye),J._trim();for(let ae=0;ae<ye;ae++){const ke=6*ae;J.uint16[ke+0]=4*ae+0,J.uint16[ke+1]=4*ae+1,J.uint16[ke+2]=4*ae+2,J.uint16[ke+3]=4*ae+2,J.uint16[ke+4]=4*ae+3,J.uint16[ke+5]=4*ae+0}return J}($));const K=C.createIndexBuffer(zf,!0),ne=C.createVertexBuffer(Z,l.cD.members,!0);for(const de of B){const ye={u_matrix:de.transform,u_inv_matrix:de.invTransform,u_camera_to_center_distance:(fe=O).getCameraToCenterDistance(de.projection),u_viewport_size:[fe.width,fe.height]};X.draw(m,k.TRIANGLES,hr.disabled,Dr.disabled,m.colorModeForRenderPass(),Cr.disabled,ye,h.id,ne,K,l.aE.simpleSegment(0,2*de.circleOffset,de.circleArray.length,de.circleArray.length/2),null,O.zoom)}var fe;ne.destroy(),K.destroy()}const Ff=l.a9.create();function C0(m){const a=m._camera.getWorldToCamera(m.worldSize,1),h=l.a9.multiply([],a,m.globeMatrix);l.a9.invert(h,h);const g=[0,0,0],v=[0,1,0,0];return l.aa.transformMat4(v,v,h),g[0]=v[0],g[1]=v[1],g[2]=v[2],l.Q.normalize(g,g),g}function Fu({width:m,height:a,anchor:h,textOffset:g,textScale:v},w){const{horizontalAlign:E,verticalAlign:C}=l.bi(h),k=-(E-.5)*m,O=-(C-.5)*a,F=l.bh(h,g);return new l.P((k/v+F[0])*w,(O/v+F[1])*w)}function Q1(m,a,h,g,v,w,E,C,k,O,F){const B=m.text.placedSymbolArray,$=m.text.dynamicLayoutVertexArray,G=m.icon.dynamicLayoutVertexArray,X={},Z=m.getProjection(),Y=ht(C,Z,w),K=w.elevation,ne=Z.upVectorScale(C.canonical,w.center.lat,w.worldSize).metersToTile;$.clear();for(let fe=0;fe<B.length;fe++){const de=B.get(fe),{tileAnchorX:ye,tileAnchorY:J,numGlyphs:ae}=de,ke=de.hidden||!de.crossTileID||m.allowVerticalPlacement&&!de.placedOrientation?null:g[de.crossTileID];if(ke){let Re=0,Ne=0,et=0;if(K){const rt=K?K.getAtTileOffset(C,ye,J):0,[me,vt,Zt]=Z.upVector(C.canonical,ye,J);Re=rt*me*ne,Ne=rt*vt*ne,et=rt*Zt*ne}let[ze,Qe,it,Oe]=eo(de.projectedAnchorX+Re,de.projectedAnchorY+Ne,de.projectedAnchorZ+et,h?Y:E);const He=ku(w.getCameraToCenterDistance(Z),Oe);let Tt=v.evaluateSizeForFeature(m.textSizeData,O,de)*He/l.bf;h&&(Tt*=m.tilePixelRatio/k);const Ue=Fu(ke,Tt);h?({x:ze,y:Qe,z:it}=Z.projectTilePoint(ye+Ue.x,J+Ue.y,C.canonical),[ze,Qe,it]=eo(ze+Re,Qe+Ne,it+et,E)):(a&&Ue._rotate(-w.angle),ze+=Ue.x,Qe+=Ue.y,it=0);const Je=m.allowVerticalPlacement&&de.placedOrientation===l.b9.vertical?Math.PI/2:0;for(let rt=0;rt<ae;rt++)l.bc($,ze,Qe,it,Je);F&&de.associatedIconIndex>=0&&(X[de.associatedIconIndex]={x:ze,y:Qe,z:it,angle:Je})}else xl(ae,$)}if(F){G.clear();const fe=m.icon.placedSymbolArray;for(let de=0;de<fe.length;de++){const ye=fe.get(de),{numGlyphs:J}=ye,ae=X[de];if(ye.hidden||!ae)xl(J,G);else{const{x:ke,y:Re,z:Ne,angle:et}=ae;for(let ze=0;ze<J;ze++)l.bc(G,ke,Re,Ne,et)}}m.icon.dynamicLayoutVertexBuffer.updateData(G)}m.text.dynamicLayoutVertexBuffer.updateData($)}function Nf(m,a,h,g,v,w,E={}){const C=h.paint.get("icon-translate"),k=h.paint.get("text-translate"),O=h.paint.get("icon-translate-anchor"),F=h.paint.get("text-translate-anchor"),B=h.layout.get("icon-rotation-alignment"),$=h.layout.get("text-rotation-alignment"),G=h.layout.get("icon-pitch-alignment"),X=h.layout.get("text-pitch-alignment"),Z=h.layout.get("icon-keep-upright"),Y=h.layout.get("text-keep-upright"),K=h.paint.get("icon-color-saturation"),ne=h.paint.get("icon-color-contrast"),fe=h.paint.get("icon-color-brightness-min"),de=h.paint.get("icon-color-brightness-max"),ye=m.context,J=ye.gl,ae=m.transform,ke=B==="map",Re=$==="map",Ne=G==="map",et=X==="map",ze=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Qe=!1;const it=m.depthModeForSublayer(0,hr.ReadOnly),Oe=[l.a8(ae.center.lng),l.ah(ae.center.lat)],He=h.layout.get("text-variable-anchor"),Tt=ae.projection.name==="globe",Ue=[],Je=[0,-1,0];for(const rt of g){const me=a.getTile(rt),vt=me.getBucket(h);if(!vt||vt.projection.name==="mercator"&&Tt||vt.fullyClipped)continue;const Zt=vt.projection.name==="globe",ir=Zt?l.W(ae.zoom):0,fr=ht(rt,vt.getProjection(),ae),cr=ae.calculatePixelsToTileUnitsMatrix(me),vr=He&&vt.hasTextData(),hi=vt.hasIconTextFit()&&vr&&vt.hasIconData(),zr=vt.getProjection().createInversionMatrix(ae,rt.canonical),vi=()=>{const Xr=ke&&h.layout.get("symbol-placement")!=="point",Qr=[],ln=Xr||hi,Qi=h.paint.get("icon-image-cross-fade").constantOr(0);m.terrainRenderModeElevated()&&Ne&&Qr.push("PITCH_WITH_MAP_TERRAIN"),Zt&&(Qr.push("PROJECTION_GLOBE_VIEW"),ln&&Qr.push("PROJECTED_POS_ON_VIEWPORT")),Qi>0&&Qr.push("ICON_TRANSITION"),vt.icon.zOffsetVertexBuffer&&Qr.push("Z_OFFSET"),K===0&&ne===0&&fe===0&&de===1||Qr.push("COLOR_ADJUSTMENT");const oi=vt.icon.programConfigurations.get(h.id),Gr=m.getOrCreateProgram(vt.sdfIcons?"symbolSDF":"symbolIcon",{config:oi,defines:Qr});let vo;const js=me.imageAtlasTexture?me.imageAtlasTexture.size:[0,0],_s=vt.iconSizeData,$s=l.b8(_s,ae.zoom),xo=Ne||ae.pitch!==0,to=Ql(fr,me.tileID.canonical,Ne,ke,ae,vt.getProjection(),cr),gs=ko(fr,me.tileID.canonical,Ne,ke,ae,vt.getProjection(),cr),Cs=m.translatePosMatrix(gs,me,C,O,!0),Rs=m.translatePosMatrix(fr,me,C,O),Al=ln?Ff:to,tl=ke&&!Ne&&!Xr;let Il=Je;!Tt&&!ae.mercatorFromTransition||ke||(Il=C0(ae));const Sl=Zt?Il:Je;if(vt.sdfIcons&&!vt.iconsInText)vo=Uh(_s.kind,$s,tl,Ne,m,Rs,Al,Cs,!1,js,!0,rt,ir,Oe,zr,Sl,vt.getProjection());else{const nc=h.getColorAdjustmentMatrix(K,ne,fe,de);vo=E0(_s.kind,$s,tl,Ne,m,Rs,Al,Cs,!1,js,rt,ir,Oe,zr,Sl,vt.getProjection(),nc,Qi)}const Hc=me.imageAtlasTexture?me.imageAtlasTexture:null,Ra=h.layout.get("icon-size").constantOr(0)!==1||vt.iconsNeedLinear,Kf=vt.sdfIcons||m.options.rotating||m.options.zooming||Ra||xo?J.LINEAR:J.NEAREST,Qh=vt.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,Jf=m.terrain&&Ne&&Xr?l.a9.invert(l.a9.create(),to):Ff;if(Xr&&vt.icon){const nc=ae.elevation,ys=nc?nc.getAtTileOffsetFunc(rt,ae.center.lat,ae.worldSize,vt.getProjection()):null,ep=Oc(fr,me.tileID.canonical,Ne,ke,ae,vt.getProjection(),cr);Du(vt,fr,m,!1,ep,gs,Ne,Z,ys,rt)}return{program:Gr,buffers:vt.icon,uniformValues:vo,atlasTexture:Hc,atlasTextureIcon:null,atlasInterpolation:Kf,atlasInterpolationIcon:null,isSDF:vt.sdfIcons,hasHalo:Qh,tile:me,labelPlaneMatrixInv:Jf}},di=()=>{const Xr=Re&&h.layout.get("symbol-placement")!=="point",Qr=[],ln=Xr||He||hi;m.terrainRenderModeElevated()&&et&&Qr.push("PITCH_WITH_MAP_TERRAIN"),Zt&&(Qr.push("PROJECTION_GLOBE_VIEW"),ln&&Qr.push("PROJECTED_POS_ON_VIEWPORT")),vt.text.zOffsetVertexBuffer&&Qr.push("Z_OFFSET");const Qi=vt.text.programConfigurations.get(h.id),oi=m.getOrCreateProgram(vt.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Qi,defines:Qr});let Gr,vo=[0,0],js=null;const _s=vt.textSizeData;vt.iconsInText&&(vo=me.imageAtlasTexture?me.imageAtlasTexture.size:[0,0],js=me.imageAtlasTexture?me.imageAtlasTexture:null,Gr=et||ae.pitch!==0||m.options.rotating||m.options.zooming||_s.kind==="composite"||_s.kind==="camera"?J.LINEAR:J.NEAREST);const $s=me.glyphAtlasTexture?me.glyphAtlasTexture.size:[0,0],xo=l.b8(_s,ae.zoom),to=Ql(fr,me.tileID.canonical,et,Re,ae,vt.getProjection(),cr),gs=ko(fr,me.tileID.canonical,et,Re,ae,vt.getProjection(),cr),Cs=m.translatePosMatrix(gs,me,k,F,!0),Rs=m.translatePosMatrix(fr,me,k,F),Al=ln?Ff:to,tl=Re&&!et&&!Xr;let Il=Je;!Tt&&!ae.mercatorFromTransition||Re||(Il=C0(ae));const Sl=Zt?Il:Je;let Hc;Hc=vt.iconsInText?Uc(_s.kind,xo,tl,et,m,Rs,Al,Cs,$s,vo,rt,ir,Oe,zr,Sl,vt.getProjection()):Uh(_s.kind,xo,tl,et,m,Rs,Al,Cs,!0,$s,!0,rt,ir,Oe,zr,Sl,vt.getProjection());const Ra=me.glyphAtlasTexture?me.glyphAtlasTexture:null,Kf=J.LINEAR,Qh=h.paint.get("text-halo-width").constantOr(1)!==0,Jf=m.terrain&&et&&Xr?l.a9.invert(l.a9.create(),to):Ff;if(Xr&&vt.text){const nc=ae.elevation,ys=nc?nc.getAtTileOffsetFunc(rt,ae.center.lat,ae.worldSize,vt.getProjection()):null,ep=Oc(fr,me.tileID.canonical,et,Re,ae,vt.getProjection(),cr);Du(vt,fr,m,!0,ep,gs,et,Y,ys,rt)}return{program:oi,buffers:vt.text,uniformValues:Hc,atlasTexture:Ra,atlasTextureIcon:js,atlasInterpolation:Kf,atlasInterpolationIcon:Gr,isSDF:!0,hasHalo:Qh,tile:me,labelPlaneMatrixInv:Jf}},yn=vt.icon.segments.get().length,Vi=vt.text.segments.get().length,Jn=yn&&!E.onlyText?vi():null,Un=Vi&&!E.onlyIcons?di():null,Yi=h.paint.get("icon-opacity").constantOr(1),ji=h.paint.get("text-opacity").constantOr(1);if(ze&&vt.canOverlap){Qe=!0;const Xr=Yi&&!E.onlyText?vt.icon.segments.get():[],Qr=ji&&!E.onlyIcons?vt.text.segments.get():[];for(const ln of Xr)Ue.push({segments:new l.aE([ln]),sortKey:ln.sortKey,state:Jn});for(const ln of Qr)Ue.push({segments:new l.aE([ln]),sortKey:ln.sortKey,state:Un})}else E.onlyText||Ue.push({segments:Yi?vt.icon.segments:new l.aE([]),sortKey:0,state:Jn}),E.onlyIcons||Ue.push({segments:ji?vt.text.segments:new l.aE([]),sortKey:0,state:Un})}Qe&&Ue.sort((rt,me)=>rt.sortKey-me.sortKey);for(const rt of Ue){const me=rt.state;if(me)if(m.terrain&&m.terrain.setupElevationDraw(me.tile,me.program,{useDepthForOcclusion:ae.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:me.labelPlaneMatrixInv}),ye.activeTexture.set(J.TEXTURE0),me.atlasTexture&&me.atlasTexture.bind(me.atlasInterpolation,J.CLAMP_TO_EDGE,!0),me.atlasTextureIcon&&(ye.activeTexture.set(J.TEXTURE1),me.atlasTextureIcon&&me.atlasTextureIcon.bind(me.atlasInterpolationIcon,J.CLAMP_TO_EDGE,!0)),m.uploadCommonLightUniforms(m.context,me.program),me.hasHalo){const vt=me.uniformValues;vt.u_is_halo=1,Um(me.buffers,rt.segments,h,m,me.program,it,v,w,vt,2),vt.u_is_halo=0}else{if(me.isSDF){const vt=me.uniformValues;me.hasHalo&&(vt.u_is_halo=1,Um(me.buffers,rt.segments,h,m,me.program,it,v,w,vt,1)),vt.u_is_halo=0}Um(me.buffers,rt.segments,h,m,me.program,it,v,w,me.uniformValues,1)}}}function Um(m,a,h,g,v,w,E,C,k,O){const F=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer];v.draw(g,g.context.gl.TRIANGLES,w,E,C,Cr.disabled,k,h.id,m.layoutVertexBuffer,m.indexBuffer,a,h.paint,g.transform.zoom,m.programConfigurations.get(h.id),F,O)}function jm(m,a,h,g,v,w,E){const C=m.context.gl,k=h.paint.get("fill-pattern"),O=k&&k.constantOr(1);let F,B,$,G,X;E?(B=O&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=C.LINES):(B=O?"fillPattern":"fill",F=C.TRIANGLES);for(const Z of g){const Y=a.getTile(Z);if(O&&!Y.patternsLoaded())continue;const K=Y.getBucket(h);if(!K)continue;m.prepareDrawTile();const ne=K.programConfigurations.get(h.id),fe=m.isTileAffectedByFog(Z),de=m.getOrCreateProgram(B,{config:ne,overrideFog:fe});O&&(m.context.activeTexture.set(C.TEXTURE0),Y.imageAtlasTexture&&Y.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ne.updatePaintBuffers());const ye=k.constantOr(null);if(ye&&Y.imageAtlas){const ke=Y.imageAtlas.patternPositions[ye.toString()];ke&&ne.setConstantPatternPositions(ke)}const J=m.translatePosMatrix(Z.projMatrix,Y,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),ae=h.paint.get("fill-emissive-strength");if(E){G=K.indexBuffer2,X=K.segments2;const ke=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];$=B==="fillOutlinePattern"&&O?tc(J,ae,m,Y,ke):qE(J,ae,ke)}else G=K.indexBuffer,X=K.segments,$=O?Vc(J,ae,m,Y):Vh(J,ae);m.uploadCommonUniforms(m.context,de,Z.toUnwrapped()),de.draw(m,F,v,m.stencilModeForClipping(Z),w,Cr.disabled,$,h.id,K.layoutVertexBuffer,G,X,h.paint,m.transform.zoom,ne,void 0)}}function Gt(m,a,h,g,v,w,E,C){h.resetLayerRenderingStats(m);const k=m.context,O=k.gl,F=m.transform,B=h.paint.get("fill-extrusion-pattern"),$=B.constantOr(1),G=h.paint.get("fill-extrusion-opacity"),X=m.style.enable3dLights(),Z=h.paint.get(X&&!$?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Y=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z],K=h.layout.get("fill-extrusion-edge-radius"),ne=K>0&&!h.paint.get("fill-extrusion-rounded-roof"),fe=ne?0:K,de=F.projection.name==="globe"?l.cM():0,ye=F.projection.name==="globe",J=ye?l.W(F.zoom):0,ae=[l.a8(F.center.lng),l.ah(F.center.lat)],ke=h.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),Re=h.paint.get("fill-extrusion-flood-light-intensity"),Ne=h.paint.get("fill-extrusion-vertical-scale"),et=Fc(m,h.paint.get("fill-extrusion-cutoff-fade-range")),ze=h.paint.get("fill-extrusion-emissive-strength"),Qe=[];let it;ye&&Qe.push("PROJECTION_GLOBE_VIEW"),Y[0]>0&&Qe.push("FAUX_AO"),ne&&Qe.push("ZERO_ROOF_RADIUS"),C&&Qe.push("HAS_CENTROID"),Re>0&&Qe.push("FLOOD_LIGHT"),et.shouldRenderCutoff&&Qe.push("RENDER_CUTOFF");const Oe=m.renderPass==="shadow",He=m.shadowRenderer,Tt=Oe&&!!He;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let Ue=[0,0,0];if(He){const me=m.style.directionalLight,vt=m.style.ambientLight;me&&vt&&(Ue=_0(me,vt)),it=Qe.concat(["SHADOWS_SINGLE_CASCADE"])}const Je=Tt?"fillExtrusionDepth":$?"fillExtrusionPattern":"fillExtrusion",rt=h.getLayerRenderingStats();for(const me of g){const vt=a.getTile(me),Zt=vt.getBucket(h);if(!Zt||Zt.projection.name!==F.projection.name)continue;let ir=!1;He&&(ir=He.getMaxCascadeForTile(me.toUnwrapped())===0);const fr=m.isTileAffectedByFog(me),cr=Zt.programConfigurations.get(h.id),vr=m.getOrCreateProgram(Je,{config:cr,defines:ir?it:Qe,overrideFog:fr});if(m.terrain&&m.terrain.setupElevationDraw(vt,vr,{useMeterToDem:!0}),!Zt.centroidVertexBuffer){const Vi=vr.attributes.a_centroid_pos;Vi!==void 0&&O.vertexAttrib2f(Vi,0,0)}!Oe&&He&&He.setupShadows(vt.tileID.toUnwrapped(),vr,"vector-tile",vt.tileID.overscaledZ),$&&(m.context.activeTexture.set(O.TEXTURE0),vt.imageAtlasTexture&&vt.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),cr.updatePaintBuffers());const hi=B.constantOr(null);if(hi&&vt.imageAtlas){const Vi=vt.imageAtlas.patternPositions[hi.toString()];Vi&&cr.setConstantPatternPositions(Vi)}const zr=h.paint.get("fill-extrusion-vertical-gradient");let vi;if(Oe&&He){if(rc(vt.tileID,Zt,m))continue;const Vi=He.calculateShadowPassMatrixFromTile(vt.tileID.toUnwrapped());vi=Ja(Vi,fe,Ne)}else{const Vi=m.translatePosMatrix(me.expandedProjMatrix,vt,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Jn=F.projection.createInversionMatrix(F,me.canonical);vi=$?kf(Vi,m,zr,G,Y,fe,me,vt,de,J,ae,Jn,ke,Ne):Bm(Vi,m,zr,G,Y,fe,me,de,J,ae,Jn,ke,Ne,Re,Ue,ze)}m.uploadCommonUniforms(k,vr,me.toUnwrapped(),null,et);let di=Zt.segments;if(F.projection.name==="mercator"&&!Oe&&(di=Zt.getVisibleSegments(vt.tileID,m.terrain,m.transform.getFrustum(0)),!di.get().length))continue;if(rt)if(Oe)for(const Vi of di.get())rt.numRenderedVerticesInShadowPass+=Vi.primitiveLength;else for(const Vi of di.get())rt.numRenderedVerticesInTransparentPass+=Vi.primitiveLength;const yn=[];(m.terrain||C)&&yn.push(Zt.centroidVertexBuffer),ye&&yn.push(Zt.layoutVertexExtBuffer),vr.draw(m,k.gl.TRIANGLES,v,w,E,Cr.backCCW,vi,h.id,Zt.layoutVertexBuffer,Zt.indexBuffer,di,h.paint,m.transform.zoom,cr,yn)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}function Nu(m,a,h,g,v,w,E,C,k,O,F,B,$,G,X,Z,Y,K,ne){const fe=m.context,de=fe.gl,ye=m.transform,J=m.transform.zoom,ae=[],ke=Fc(m,h.paint.get("fill-extrusion-cutoff-fade-range"));O==="clear"?(ae.push("CLEAR_SUBPASS"),ne&&(ae.push("CLEAR_FROM_TEXTURE"),fe.activeTexture.set(de.TEXTURE0),ne.bind(de.LINEAR,de.CLAMP_TO_EDGE))):O==="sdf"&&ae.push("SDF_SUBPASS"),Y&&ae.push("HAS_CENTROID"),ke.shouldRenderCutoff&&ae.push("RENDER_CUTOFF");const Re=h.layout.get("fill-extrusion-edge-radius"),Ne=(et,ze,Qe,it,Oe)=>{const He=ze.programConfigurations.get(h.id),Tt=m.isTileAffectedByFog(et),Ue=m.getOrCreateProgram("fillExtrusionGroundEffect",{config:He,defines:ae,overrideFog:Tt}),Je=((me,vt,Zt,ir,fr,cr,vr,hi,zr,vi,di)=>({u_matrix:vt,u_opacity:Zt,u_ao_pass:ir?1:0,u_meter_to_tile:fr,u_ao:cr,u_flood_light_intensity:vr,u_flood_light_color:hi,u_attenuation:zr,u_edge_radius:vi,u_fb:0,u_fb_size:di}))(0,it,F,k,Oe,[B,$*Oe],G,X,Z,J>=17?0:Re*Oe,ne?ne.size[0]:0),rt=[];Y&&rt.push(ze.hiddenByLandmarkVertexBuffer),m.uploadCommonUniforms(fe,Ue,et.toUnwrapped(),null,ke),Ue.draw(m,fe.gl.TRIANGLES,v,w,E,C,Je,h.id,ze.vertexBuffer,ze.indexBuffer,Qe,h.paint,J,He,rt)};for(const et of g){const ze=a.getTile(et),Qe=ze.getBucket(h);if(!Qe||Qe.projection.name!==ye.projection.name||!Qe.groundEffect||Qe.groundEffect&&!Qe.groundEffect.hasData())continue;const it=Qe.groundEffect,Oe=1/Qe.tileToMeter;{const He=m.translatePosMatrix(et.projMatrix,ze,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Tt=it.getDefaultSegment();Ne(et,it,Tt,He,Oe)}if(K)for(let He=0;He<4;He++){const Tt=l.cN[He](et),Ue=a.getTile(Tt);if(!Ue)continue;const Je=Ue.getBucket(h);if(!Je||Je.projection.name!==ye.projection.name||!Je.groundEffect||Je.groundEffect&&!Je.groundEffect.hasData())continue;const rt=Je.groundEffect;let me,vt;He===0?(me=[-l.Y,0,0],vt=1):He===1?(me=[l.Y,0,0],vt=0):He===2?(me=[0,-l.Y,0],vt=3):(me=[0,l.Y,0],vt=2);const Zt=rt.regionSegments[vt];if(!Zt)continue;const ir=new Float32Array(16);l.a9.translate(ir,et.projMatrix,me),Ne(et,rt,Zt,m.translatePosMatrix(ir,ze,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Oe)}}}function R0(m,a,h,g,v,w,E){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();const C=w?w.findDEMTileFor(h):null;if(!(C&&C.dem||E))return;const k=K=>new l.P(Math.ceil((K+l.cQ)*l.cR),0),O=K=>{const ne=a.getSource().minzoom,fe=ye=>{const J=a.getTileByID(ye);if(J&&J.hasData())return J.getBucket(v)},de=[0,-1,1];for(const ye of de){if(K.overscaledZ+ye<ne)continue;const J=fe(K.calculateScaledKey(K.overscaledZ+ye));if(J)return J}},F=[0,0,0],B=(K,ne)=>(F[0]=Math.min(K.min.y,ne.min.y),F[1]=Math.max(K.max.y,ne.max.y),F[2]=l.Y-ne.min.x>K.max.x?ne.min.x-l.Y:K.max.x,F),$=(K,ne)=>(F[0]=Math.min(K.min.x,ne.min.x),F[1]=Math.max(K.max.x,ne.max.x),F[2]=l.Y-ne.min.y>K.max.y?ne.min.y-l.Y:K.max.y,F),G=[(K,ne)=>B(K,ne),(K,ne)=>B(ne,K),(K,ne)=>$(K,ne),(K,ne)=>$(ne,K)],X=(K,ne,fe,de,ye,J,ae)=>{if(!w)return 0;const ke=[[J?fe:K,J?K:fe,0],[J?fe:ne,J?ne:fe,0]],Re=ae<0?l.Y+ae:ae,Ne=[J?Re:(K+ne)/2,J?(K+ne)/2:Re,0];return fe===0&&ae<0||fe!==0&&ae>0?w.getForTilePoints(ye,[Ne],!0,de):ke.push(Ne),w.getForTilePoints(h,ke,!0,C),Math.max(ke[0][2],ke[1][2],Ne[2])/w.exaggeration()};for(let K=0;K<4;K++){const ne=g.borderFeatureIndices[K];if(ne.length===0)continue;const fe=l.cN[K](h),de=O(fe);if(!(de&&de instanceof l.cO)||g.borderDoneWithNeighborZ[K]===de.canonical.z)continue;de.centroidVertexArray.length===0&&de.createCentroidsBuffer();const ye=w?w.findDEMTileFor(fe):null;if(!(ye&&ye.dem||E))continue;const J=(K<2?1:5)-K,ae=de.borderDoneWithNeighborZ[J]!==g.canonical.z,ke=de.borderFeatureIndices[J];let Re=0;if(g.canonical.z!==de.canonical.z){for(const Ne of ne)g.showCentroid(g.featuresOnBorder[Ne]);if(ae)for(const Ne of ke)de.showCentroid(de.featuresOnBorder[Ne]);g.borderDoneWithNeighborZ[K]=de.canonical.z,de.borderDoneWithNeighborZ[J]=g.canonical.z}for(const Ne of ne){const et=g.featuresOnBorder[Ne],ze=g.centroidData[et.centroidDataIndex],Qe=et.borders[K];let it;for(;Re<ke.length;){it=de.featuresOnBorder[ke[Re]];const Oe=it.borders[J];if(Oe[1]>Qe[0]+3||Oe[0]>Qe[0]-3)break;de.showCentroid(it),Re++}if(it&&Re<ke.length){const Oe=Re;let He=0;for(;!(it.borders[J][0]>Qe[1]-3)&&(He++,++Re!==ke.length);)it=de.featuresOnBorder[ke[Re]];if(it=de.featuresOnBorder[ke[Oe]],He>1){const Je=it.borders[J];Math.abs(Qe[0]-Je[0])<3&&Math.abs(Qe[1]-Je[1])<3&&(He=1,Re=Oe+1)}else if(He===0){g.showCentroid(et);continue}const Tt=de.centroidData[it.centroidDataIndex];E&&He===1&&(((Z=ze).flags|(Y=Tt).flags)&l.cP?(Z.flags|=l.cP,Y.flags|=l.cP):(Z.flags&=~l.cP,Y.flags&=~l.cP));const Ue=et.intersectsCount()>1||it.intersectsCount()>1;if(He>1)Re=Oe,ze.centroidXY=Tt.centroidXY=new l.P(0,0);else if(ye&&ye.dem&&!Ue){const Je=G[K](ze,Tt),rt=K%2?l.Y-1:0,me=X(Je[0],Math.min(l.Y-1,Je[1]),rt,ye,fe,K<2,Je[2]);ze.centroidXY=Tt.centroidXY=k(me)}else Ue?ze.centroidXY=Tt.centroidXY=new l.P(0,0):(ze.centroidXY=g.encodeBorderCentroid(et),Tt.centroidXY=de.encodeBorderCentroid(it));g.writeCentroidToBuffer(ze),de.writeCentroidToBuffer(Tt)}else g.showCentroid(et)}g.borderDoneWithNeighborZ[K]=de.canonical.z,de.borderDoneWithNeighborZ[J]=g.canonical.z}var Z,Y;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(m)}const P0=[1,0,0],K1=[0,1,0],$m=[0,0,1];function rc(m,a,h){const g=h.transform,v=h.shadowRenderer;if(!v)return!0;const w=m.toUnwrapped(),E=g.tileSize*v._cascades[h.currentShadowCascade].scale;let C=a.maxHeight;if(g.elevation){const Z=g.elevation.getMinMaxForTile(m);Z&&(C+=Z.max)}const k=[...v.shadowDirection];k[2]=-k[2];const O=v.computeSimplifiedTileShadowVolume(w,C,E,k);if(!O)return!1;const F=[P0,K1,$m,k,[k[0],0,k[2]],[0,k[1],k[2]]],B=g.projection.name==="globe",$=g.scaleZoom(E),G=l.bt.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,$,!B),X=v.getCurrentCascadeFrustum();return G.intersectsPrecise(O.vertices,O.planes,F)===0||X.intersectsPrecise(O.vertices,O.planes,F)===0}function Gm(m){return[m[0]*l.cS,m[1]*l.cS,m[2]*l.cS,0]}function ic(m,a,h,g,v,w,E,C,k){const O=g.getSource(),F=h.globeSharedBuffers;if(!F)return;let B,$,G;if(a&&(B=g.getTile(a)),O instanceof l.as?($=O.texture,G=l.co(0,0,h.transform)):B&&a&&($=B.texture,G=l.co(a.canonical.z,a.canonical.x,h.transform)),!$||!G)return;m||(G=l.a9.scale(l.a9.create(),G,[1,-1,1]));const X=h.context,Z=X.gl,Y=v.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR,K=h.colorModeForDrapableLayerRenderPass(w),ne=E.defines;ne.push("GLOBE_POLES");const fe=new hr(Z.LEQUAL,hr.ReadWrite,h.depthRangeFor3D),de=Float32Array.from(h.transform.expandedFarZProjMatrix),ye=Float32Array.from(l.aW(l.cn(new l.bv(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),X.activeTexture.set(Z.TEXTURE0),$.bind(Y,Z.CLAMP_TO_EDGE),X.activeTexture.set(Z.TEXTURE1),$.bind(Y,Z.CLAMP_TO_EDGE),$.useMipmap&&X.extTextureFilterAnisotropic&&h.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax);const[J,ae,ke,Re]=a?F.getPoleBuffers(a.canonical.z,!1):F.getPoleBuffers(0,!0),Ne=v.paint.get("raster-elevation");let et;m?(et=J,h.renderDefaultNorthPole=Ne!==0):(et=ae,h.renderDefaultSouthPole=Ne!==0);const ze=Gm(E.mix),Qe=((Oe,He,Tt,Ue,Je,rt,me,vt,Zt,ir,fr,cr,vr)=>X1(Oe,He,Tt,new Float32Array(16),new Float32Array(9),[0,0],Ue,[0,0],[0,0,0,0],1,{opacity:1,mix:0},rt,[0,0],vt,2,ir,fr,cr,1,0,vr))(de,ye,G,l.W(h.transform.zoom),0,v,0,Ne,0,ze,E.offset,E.range,w),it=h.getOrCreateProgram("raster",{defines:ne});h.uploadCommonUniforms(X,it,null),it.draw(h,Z.TRIANGLES,fe,k,K,C,Qe,v.id,et,ke,Re)}function qm(m){const a=m._nearZ,h=m.projection.farthestPixelDistance(m),g=h-a,v=.2*m.height,w=a+v;return[a,h,(w-v-a)/g,(w-a)/g]}function jh(m,a,h,g){if(m)return a instanceof Rt&&m instanceof Rh?a.getTextureDescriptor(m,h,!0):{texture:m.texture,mix:Gm(g.mix),offset:g.offset,buffer:0,tileSize:1}}function KE(m,a,h){if(!m)return null;const g=a.getTextureDescriptor(m,h,!0);if(!g)return null;let{texture:v,mix:w,offset:E,tileSize:C,buffer:k,format:O}=g;if(!v||!O)return null;let F=!1;return O==="uint32"&&(F=!0,w[3]=0,w=Df(l.cT,w,[0,h.paint.get("raster-particle-max-speed")]),E=T0(l.cT,E,[0,h.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[k/(C+2*k),C/(C+2*k)],tileSize:C,scalarData:F,scale:w,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[O]]}}function JE(m){const a=m._nearZ,h=m.projection.farthestPixelDistance(m),g=h-a,v=.2*m.height,w=a+v;return[a,h,(w-v-a)/g,(w-a)/g]}const M0=new l.aA(1,0,0,1),e5=new l.aA(0,1,0,1),J1=new l.aA(0,0,1,1),ex=new l.aA(1,0,1,1),k0=new l.aA(0,1,1,1);function $h(m,a,h,g,v,w,E){const C=m.context,k=m.transform,O=C.gl,F=k.projection.name==="globe",B=F?["PROJECTION_GLOBE_VIEW"]:[];let $=l.a9.clone(h.projMatrix);if(F&&l.W(k.zoom)>0){const ze=l.aV(h.canonical,k),Qe=l.cU(ze);$=l.a9.multiply(new Float32Array(16),k.globeMatrix,Qe),l.a9.multiply($,k.projMatrix,$)}const G=l.a9.create();G[12]+=2*v/(l.f.devicePixelRatio*k.width),G[13]+=2*w/(l.f.devicePixelRatio*k.height),l.a9.multiply($,G,$);const X=m.getOrCreateProgram("debug",{defines:B}),Z=a.getTileByID(h.key);m.terrain&&m.terrain.setupElevationDraw(Z,X);const Y=hr.disabled,K=Dr.disabled,ne=m.colorModeForRenderPass(),fe="$debug";C.activeTexture.set(O.TEXTURE0),m.emptyTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),F?Z._makeGlobeTileDebugBuffers(m.context,k):Z._makeDebugTileBoundsBuffers(m.context,k.projection);const de=Z._tileDebugBuffer||m.debugBuffer,ye=Z._tileDebugIndexBuffer||m.debugIndexBuffer,J=Z._tileDebugSegments||m.debugSegments;if(X.draw(m,O.LINE_STRIP,Y,K,ne,Cr.disabled,w0($,g),fe,de,ye,J,null,null,null,[Z._globeTileDebugBorderBuffer]),E){const ze=Z.latestRawTileData,Qe=Math.floor((ze&&ze.byteLength||0)/1024);let it=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(it+=` => ${h.overscaledZ}`),it+=` ${Z.state}`,it+=` ${Qe}kb`,function(Oe,He){Oe.initDebugOverlayCanvas();const Tt=Oe.debugOverlayCanvas,Ue=Oe.context.gl,Je=Oe.debugOverlayCanvas.getContext("2d");Je.clearRect(0,0,Tt.width,Tt.height),Je.shadowColor="white",Je.shadowBlur=2,Je.lineWidth=1.5,Je.strokeStyle="white",Je.textBaseline="top",Je.font="bold 36px Open Sans, sans-serif",Je.fillText(He,5,5),Je.strokeText(He,5,5),Oe.debugOverlayTexture.update(Tt),Oe.debugOverlayTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)}(m,it)}const ae=a.getTile(h).tileSize,ke=512/Math.min(ae,512)*(h.overscaledZ/k.zoom)*.5,Re=Z._tileDebugTextBuffer||m.debugBuffer,Ne=Z._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,et=Z._tileDebugTextSegments||m.debugSegments;X.draw(m,O.TRIANGLES,Y,K,$r.alphaBlended,Cr.disabled,w0($,l.aA.transparent,ke),fe,Re,Ne,et,null,null,null,[Z._globeTileDebugTextBuffer])}function tx(m,a,h,g){Hm(m,0,a+h/2,m.transform.width,h,g)}function rx(m,a,h,g){Hm(m,a-h/2,0,h,m.transform.height,g)}function Hm(m,a,h,g,v,w){const E=m.context,C=E.gl;C.enable(C.SCISSOR_TEST),C.scissor(a*l.f.devicePixelRatio,h*l.f.devicePixelRatio,g*l.f.devicePixelRatio,v*l.f.devicePixelRatio),E.clear({color:w}),C.disable(C.SCISSOR_TEST)}const ix=l.aB([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:t5}=ix;function el(m,a,h,g){m.emplaceBack(a,h,g)}class nx{constructor(a){this.vertexArray=new l.cV,this.indices=new l.az,el(this.vertexArray,-1,-1,1),el(this.vertexArray,1,-1,1),el(this.vertexArray,-1,1,1),el(this.vertexArray,1,1,1),el(this.vertexArray,-1,-1,-1),el(this.vertexArray,1,-1,-1),el(this.vertexArray,-1,1,-1),el(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,t5),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=l.aE.simpleSegment(0,0,36,12)}}function Bu(m,a,h,g,v,w){const E=m.context.gl,C=a.paint.get("sky-atmosphere-color"),k=a.paint.get("sky-atmosphere-halo-color"),O=a.paint.get("sky-atmosphere-sun-intensity"),F=((B,$,G,X,Z)=>({u_matrix_3f:B,u_sun_direction:$,u_sun_intensity:G,u_color_tint_r:[X.r,X.g,X.b,X.a],u_color_tint_m:[Z.r,Z.g,Z.b,Z.a],u_luminance:5e-5}))(l.ct.fromMat4(l.ct.create(),g),v,O,C,k);E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+w,a.skyboxTexture,0),h.draw(m,E.TRIANGLES,hr.disabled,Dr.disabled,$r.unblended,Cr.frontCW,F,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const D0=l.aB([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Wm{constructor(a){const h=new l.cW;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const g=new l.az;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(h,D0.members),this.indexBuffer=a.createIndexBuffer(g),this.segments=l.aE.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const L0=l.aB([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Vu{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class O0{constructor(a){this.colorModeAlphaBlendedWriteRGB=new $r([1,Cu,1,Cu],l.aA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new $r([1,0,1,0],l.aA.transparent,[!1,!1,!1,!0]),this.params=new Vu,this.updateNeeded=!0,a.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),a.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(a){const h=a.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Wm(h);const g=this.params.sizeRange,v=this.params.intensityRange,w=function(F){const B=l.aC(30),$=[];for(let G=0;G<F;++G){const X=2*Math.PI*B(),Z=Math.acos(1-2*B())-.5*Math.PI;$.push(l.Q.fromValues(Math.cos(Z)*Math.cos(X),Math.cos(Z)*Math.sin(X),Math.sin(Z)))}return $}(this.params.starsCount),E=l.aC(300),C=new l.cX,k=new l.az;let O=0;for(let F=0;F<w.length;++F){const B=l.Q.scale([],w[F],200),$=Math.max(0,1+.01*g*(1*E()-.5)),G=Math.max(0,1+.01*v*(1*E()-.5));C.emplaceBack(B[0],B[1],B[2],-1,-1,$,G),C.emplaceBack(B[0],B[1],B[2],1,-1,$,G),C.emplaceBack(B[0],B[1],B[2],1,1,$,G),C.emplaceBack(B[0],B[1],B[2],-1,1,$,G),k.emplaceBack(O+0,O+1,O+2),k.emplaceBack(O+0,O+2,O+3),O+=4}this.starsVx=h.createVertexBuffer(C,L0.members),this.starsIdx=h.createIndexBuffer(k),this.starsSegments=l.aE.simpleSegment(0,0,C.length,k.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(a,h){const g=a.context,v=g.gl,w=a.transform,E=new hr(v.LEQUAL,hr.ReadOnly,[0,1]),C=l.W(w.zoom),k=h.properties.get("color").toArray01(),O=h.properties.get("high-color").toArray01(),F=h.properties.get("space-color").toArray01PremultipliedAlpha(),B=5e-4,$=l.cY(h.properties.get("horizon-blend"),0,1,B,.25),G=l.ci(a,g,w)&&$===B?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,X=a.frameCounter/1e3%1,Z=l.Q.length(w.globeCenterInViewSpace),Y=Math.sqrt(Math.pow(Z,2)-Math.pow(G,2)),K=Math.acos(Y/Z),ne=fe=>{const de=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];fe&&de.push("ALPHA_PASS");const ye=a.getOrCreateProgram("globeAtmosphere",{defines:de}),J=((ke,Re,Ne,et,ze,Qe,it,Oe,He,Tt,Ue,Je)=>({u_frustum_tl:ke,u_frustum_tr:Re,u_frustum_br:Ne,u_frustum_bl:et,u_horizon:ze,u_transition:Qe,u_fadeout_range:it,u_color:Oe,u_high_color:He,u_space_color:Tt,u_temporal_offset:Ue,u_horizon_angle:Je}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,C,$,k,O,F,X,K);a.uploadCommonUniforms(g,ye);const ae=this.atmosphereBuffer;ae&&ye.draw(a,v.TRIANGLES,E,Dr.disabled,fe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Cr.backCW,J,fe?"atmosphere_glow_alpha":"atmosphere_glow",ae.vertexBuffer,ae.indexBuffer,ae.segments)};ne(!1),ne(!0)}drawStars(a,h){const g=l.ad(h.properties.get("star-intensity"),0,1);if(g===0)return;const v=a.context,w=v.gl,E=a.transform,C=a.getOrCreateProgram("stars"),k=l.bl.identity([]);l.bl.rotateX(k,k,-E._pitch),l.bl.rotateZ(k,k,-E.angle),l.bl.rotateX(k,k,l.bm(E._center.lat)),l.bl.rotateY(k,k,-l.bm(E._center.lng));const O=l.a9.fromQuat(new Float32Array(16),k),F=l.a9.multiply([],E.starsProjMatrix,O),B=l.ct.fromMat4([],O),$=l.ct.invert([],B),G=[0,1,0];l.Q.transformMat3(G,G,$),l.Q.scale(G,G,this.params.sizeMultiplier);const X=[1,0,0];l.Q.transformMat3(X,X,$),l.Q.scale(X,X,this.params.sizeMultiplier);const Z=(Y=G,K=X,ne=g,{u_matrix:Float32Array.from(F),u_up:Y,u_right:K,u_intensity_multiplier:ne});var Y,K,ne;a.uploadCommonUniforms(v,C),this.starsVx&&this.starsIdx&&C.draw(a,w.TRIANGLES,hr.disabled,Dr.disabled,this.colorModeAlphaBlendedWriteRGB,Cr.disabled,Z,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function z0(m,a){const h=[...m],g=a.cameraWorldSizeForFog/a.worldSize,v=l.a9.identity([]);return l.a9.scale(v,v,[g,g,1]),l.a9.multiply(h,v,h),l.a9.multiply(h,a.worldToFogMatrix,h),h}function jc(m,a,h,g){const v=h.material,w=g.context,{baseColorTexture:E,metallicRoughnessTexture:C}=v.pbrMetallicRoughness,{normalTexture:k,occlusionTexture:O,emissionTexture:F}=v;function B($,G,X){if($&&(m.push(G),w.activeTexture.set(w.gl.TEXTURE0+X),$.gfxTexture)){const{minFilter:Z,magFilter:Y,wrapS:K,wrapT:ne}=$.sampler;$.gfxTexture.bindExtraParam(Z,Y,K,ne)}}B(E,"HAS_TEXTURE_u_baseColorTexture",Do.BaseColor),B(C,"HAS_TEXTURE_u_metallicRoughnessTexture",Do.MetallicRoughness),B(k,"HAS_TEXTURE_u_normalTexture",Do.Normal),B(O,"HAS_TEXTURE_u_occlusionTexture",Do.Occlusion),B(F,"HAS_TEXTURE_u_emissionTexture",Do.Emission),h.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),a.push(h.texcoordBuffer)),h.colorBuffer&&(m.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),a.push(h.colorBuffer)),h.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),a.push(h.normalBuffer)),h.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),a.push(h.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||m.push("DIFFUSE_SHADED"),m.push("USE_STANDARD_DERIVATIVES")}function $c(m,a,h,g,v,w){const E=h.paint.get("model-opacity"),C=a.context,k=new hr(a.context.gl.LEQUAL,hr.ReadWrite,a.depthRangeFor3D),O=a.transform,F=m.mesh,B=F.material,$=B.pbrMetallicRoughness,G=a.style.fog;let X;X=a.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:l.a9.multiply([],g.zScaleMatrix,m.nodeModelMatrix),l.a9.multiply(X,g.negCameraPosMatrix,X);const Z=l.a9.invert([],X);l.a9.transpose(Z,Z);const Y=h.paint.get("model-emissive-strength").constantOr(0),K=Vm(new Float32Array(m.worldViewProjection),new Float32Array(X),new Float32Array(Z),null,a,E,$.baseColorFactor,B.emissiveFactor,$.metallicFactor,$.roughnessFactor,B,Y,h),ne={defines:[]},fe=[];jc(ne.defines,fe,F,a);const de=a.shadowRenderer;de&&(de.useNormalOffset=!1);let ye=null;if(G){const ke=z0(m.nodeModelMatrix,a.transform);if(ye=new Float32Array(ke),O.projection.name!=="globe"){const Re=F.aabb.min,Ne=F.aabb.max,[et,ze]=G.getOpacityForBounds(ke,Re[0],Re[1],Ne[0],Ne[1]);ne.overrideFog=et>=mr||ze>=mr}}const J=Fc(a,h.paint.get("model-cutoff-fade-range"));J.shouldRenderCutoff&&ne.defines.push("RENDER_CUTOFF");const ae=a.getOrCreateProgram("model",ne);a.uploadCommonUniforms(C,ae,null,ye,J),a.renderPass!=="shadow"&&de&&de.setupShadowsFromMatrix(m.nodeModelMatrix,ae),ae.draw(a,C.gl.TRIANGLES,k,v,w,F.material.doubleSided?Cr.disabled:Cr.backCCW,K,h.id,F.vertexBuffer,F.indexBuffer,F.segments,h.paint,a.transform.zoom,void 0,fe)}function Bf(m,a,h,g,v,w,E){let C;C=m.projection.name==="globe"?l.c_(h,m):[...h],l.a9.multiply(C,C,a.matrix);const k=l.a9.multiply([],g,C);if(a.meshes)for(const O of a.meshes){if(O.material.alphaMode!=="BLEND"){E.push({mesh:O,depth:0,modelIndex:v,worldViewProjection:k,nodeModelMatrix:C});continue}const F=l.Q.transformMat4([],O.centroid,k);F[2]>0&&w.push({mesh:O,depth:F[2],modelIndex:v,worldViewProjection:k,nodeModelMatrix:C})}if(a.children)for(const O of a.children)Bf(m,O,h,g,v,w,E)}function Vf(m,a,h,g){const v=h.shadowRenderer;if(!v)return;const w=v.getShadowPassDepthMode(),E=v.getShadowPassColorMode(),C=v.calculateShadowPassMatrixFromMatrix(a),k=Y1(C);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,w,Dr.disabled,E,Cr.backCCW,k,g.id,m.vertexBuffer,m.indexBuffer,m.segments,g.paint,h.transform.zoom,void 0,void 0)}function Uf(m,a,h){const g=a.updateZoomBasedPaintProperties(),v=function(w,E,C){let k,O,F,B=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&B>0){const $=w.terrain,G=$.findDEMTileFor(C);G&&G.dem?k=l.d0.create($,C,G):B=0}if(B===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),B===E.validForExaggeration&&(B===0||k&&k._demTile&&k._demTile.tileID===E.validForDEMTile.id&&k._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(const $ in E.instancesPerModel){const G=E.instancesPerModel[$];for(let X=0;X<G.instancedDataArray.length;++X){const Z=(k?B*k.getElevationAt(0|G.instancedDataArray.float32[16*X],0|G.instancedDataArray.float32[16*X+1],!0,!0):0)+G.instancesEvaluatedElevation[X];G.instancedDataArray.float32[16*X+6]=Z,O=O?Math.min(E.terrainElevationMin,Z):Z,F=F?Math.max(E.terrainElevationMax,Z):Z}}return E.terrainElevationMin=O||0,E.terrainElevationMax=F||0,E.validForExaggeration=B,E.validForDEMTile=k&&k._demTile?{id:k._demTile.tileID,timestamp:k._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,a,h);(g||v)&&(a.uploaded=!1,a.upload(m.context))}const sa={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new l.bV([0,0,0],[l.Y,l.Y,0])};function Zm(m,a){const h=1<<m.canonical.z,g=a.getFreeCameraOptions().position,v=a.elevation,w=m.canonical.x/h,E=(m.canonical.x+1)/h,C=m.canonical.y/h,k=(m.canonical.y+1)/h;let O=a._centerAltitude;if(v){const G=v.getMinMaxForTile(m);G&&G.max>O&&(O=G.max)}const F=l.ad(g.x,w,E)-g.x,B=l.ad(g.y,C,k)-g.y,$=l.bo(O,a.center.lat)-g.z;return a._zoomFromMercatorZ(Math.sqrt(F*F+B*B+$*$))}function Xm(m,a,h,g,v,w,E){const C=m.context,k=m.renderPass==="shadow",O=m.shadowRenderer,F=k&&O?O.getShadowPassDepthMode():new hr(C.gl.LEQUAL,hr.ReadWrite,m.depthRangeFor3D),B=m.isTileAffectedByFog(w);if(h.meshes)for(const $ of h.meshes){const G=["MODEL_POSITION_ON_GPU"],X=[];let Z,Y,K;g.instancedDataArray.length>20&&G.push("INSTANCED_ARRAYS");const ne=Fc(m,a.paint.get("model-cutoff-fade-range"));if(ne.shouldRenderCutoff&&G.push("RENDER_CUTOFF"),k&&O)Z=m.getOrCreateProgram("modelDepth",{defines:G}),Y=Y1(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(h.matrix)),K=O.getShadowPassColorMode();else{jc(G,X,$,m),Z=m.getOrCreateProgram("model",{defines:G,overrideFog:B});const de=$.material,ye=de.pbrMetallicRoughness,J=a.paint.get("model-opacity"),ae=a.paint.get("model-emissive-strength").constantOr(0);Y=Vm(w.expandedProjMatrix,Float32Array.from(h.matrix),new Float32Array(16),null,m,J,ye.baseColorFactor,de.emissiveFactor,ye.metallicFactor,ye.roughnessFactor,de,ae,a,v),O&&(E.shadowUniformsInitialized?Z.setShadowUniformValues(C,O.getShadowUniformValues()):(O.setupShadows(w.toUnwrapped(),Z,"model-tile",w.overscaledZ),E.shadowUniformsInitialized=!0)),K=ne.shouldRenderCutoff||J<1||de.alphaMode!=="OPAQUE"?$r.alphaBlended:$r.unblended}m.uploadCommonUniforms(C,Z,w.toUnwrapped(),null,ne);const fe=$.material.doubleSided?Cr.disabled:Cr.backCCW;if(g.instancedDataArray.length>20)X.push(g.instancedDataBuffer),Z.draw(m,C.gl.TRIANGLES,F,Dr.disabled,K,fe,Y,a.id,$.vertexBuffer,$.indexBuffer,$.segments,a.paint,m.transform.zoom,void 0,X,g.instancedDataArray.length);else{const de=k?"u_instance":"u_normal_matrix";for(let ye=0;ye<g.instancedDataArray.length;++ye)Y[de]=new Float32Array(g.instancedDataArray.arrayBuffer,64*ye,16),Z.draw(m,C.gl.TRIANGLES,F,Dr.disabled,K,fe,Y,a.id,$.vertexBuffer,$.indexBuffer,$.segments,a.paint,m.transform.zoom,void 0,X)}}if(h.children)for(const $ of h.children)Xm(m,a,$,g,v,w,E)}const Ym=[1,-1,1];function jf(m,a,h,g){if(!h.modelManager)return!0;const v=h.modelManager;if(!h.shadowRenderer)return!0;const w=h.shadowRenderer,E=a.aabb;let C=!0,k=m.maxHeight;if(k===0){let F=0;for(const B in m.instancesPerModel){const $=v.getModel(B,g);$?F=Math.max(F,Math.max(Math.max($.aabb.max[0],$.aabb.max[1]),$.aabb.max[2])):C=!1}k=m.maxScale*F*1.41+m.maxVerticalOffset,C&&(m.maxHeight=k)}E.max[2]=k,E.min[2]+=m.terrainElevationMin,E.max[2]+=m.terrainElevationMax,l.Q.transformMat4(E.min,E.min,a.tileMatrix),l.Q.transformMat4(E.max,E.max,a.tileMatrix);const O=E.intersects(w.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=O===2),O===0}class sx{}class ox{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(a,h,g){{const B=this._storage.get(h.id);if(B)return B.lastUsedFrameIdx=a,B.buf}const v=g.gl,w=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),E=new ArrayBuffer(w),C=new Int16Array(E);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));const k=new l.d2;for(let B=0;B<w/2;B+=3){const $=C[B],G=C[B+1],X=C[B+2];k.emplaceBack($,G),k.emplaceBack(G,X),k.emplaceBack(X,$)}const O=g.bindVertexArrayOES.current,F=new sx;return F.buf=new _i(g,k),F.lastUsedFrameIdx=a,this._storage.set(h.id,F),g.bindVertexArrayOES.set(O),F.buf}update(a){for(const[h,g]of this._storage)a-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(h))}destroy(){for(const[a,h]of this._storage)h.buf.destroy(),this._storage.delete(a)}}const Qm={symbol:function(m,a,h,g,v){if(m.renderPass!=="translucent")return;const w=Dr.disabled,E=m.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(O,F,B,$,G,X,Z){const Y=F.transform,K=G==="map",ne=X==="map";for(const fe of O){const de=$.getTile(fe),ye=de.getBucket(B);if(!ye||!ye.text||!ye.text.segments.get().length)continue;const J=l.b8(ye.textSizeData,Y.zoom),ae=ht(fe,ye.getProjection(),Y),ke=Y.calculatePixelsToTileUnitsMatrix(de),Re=Ql(ae,de.tileID.canonical,ne,K,Y,ye.getProjection(),ke),Ne=ye.hasIconTextFit()&&ye.hasIconData();if(J){const et=Math.pow(2,Y.zoom-de.tileID.overscaledZ);Q1(ye,K,ne,Z,l.cE,Y,Re,fe,et,J,Ne)}}}(g,m,h,a,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),v);const C=h.paint.get("icon-opacity").constantOr(1)!==0,k=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(C||k)?Nf(m,a,h,g,w,E):(C&&Nf(m,a,h,g,w,E,{onlyIcons:!0}),k&&Nf(m,a,h,g,w,E,{onlyText:!0})),a.map.showCollisionBoxes&&(S0(m,a,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),S0(m,a,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(m,a,h,g){if(m.renderPass!=="translucent")return;const v=h.paint.get("circle-opacity"),w=h.paint.get("circle-stroke-width"),E=h.paint.get("circle-stroke-opacity"),C=h.layout.get("circle-sort-key").constantOr(1)!==void 0,k=h.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(w.constantOr(1)===0||E.constantOr(1)===0))return;const O=m.context,F=O.gl,B=m.transform,$=m.depthModeForSublayer(0,hr.ReadOnly),G=Dr.disabled,X=m.colorModeForDrapableLayerRenderPass(k),Z=B.projection.name==="globe",Y=[l.a8(B.center.lng),l.ah(B.center.lat)],K=[];for(let fe=0;fe<g.length;fe++){const de=g[fe],ye=a.getTile(de),J=ye.getBucket(h);if(!J||J.projection.name!==B.projection.name)continue;const ae=J.programConfigurations.get(h.id),ke=l.cF(h),Re=m.isTileAffectedByFog(de);Z&&ke.push("PROJECTION_GLOBE_VIEW");const Ne=m.getOrCreateProgram("circle",{config:ae,defines:ke,overrideFog:Re}),et=J.layoutVertexBuffer,ze=J.globeExtVertexBuffer,Qe=J.indexBuffer,it=B.projection.createInversionMatrix(B,de.canonical),Oe={programConfiguration:ae,program:Ne,layoutVertexBuffer:et,globeExtVertexBuffer:ze,indexBuffer:Qe,uniformValues:l.cG(m,de,ye,it,Y,h),tile:ye};if(C){const He=J.segments.get();for(const Tt of He)K.push({segments:new l.aE([Tt]),sortKey:Tt.sortKey,state:Oe})}else K.push({segments:J.segments,sortKey:0,state:Oe})}C&&K.sort((fe,de)=>fe.sortKey-de.sortKey);const ne={useDepthForOcclusion:B.depthOcclusionForSymbolsAndCircles};for(const fe of K){const{programConfiguration:de,program:ye,layoutVertexBuffer:J,globeExtVertexBuffer:ae,indexBuffer:ke,uniformValues:Re,tile:Ne}=fe.state,et=fe.segments;m.terrain&&m.terrain.setupElevationDraw(Ne,ye,ne),m.uploadCommonUniforms(O,ye,Ne.tileID.toUnwrapped()),ye.draw(m,F.TRIANGLES,$,G,X,Cr.disabled,Re,h.id,J,ke,et,h.paint,B.zoom,de,[ae])}},heatmap:function(m,a,h,g){if(h.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const v=m.context,w=v.gl,E=Dr.disabled,C=new $r([w.ONE,w.ONE,w.ONE,w.ONE],l.aA.transparent,[!0,!0,!0,!0]);(function(G,X,Z,Y){const K=G.gl,ne=X.width*Y,fe=X.height*Y;G.activeTexture.set(K.TEXTURE1),G.viewport.set([0,0,ne,fe]);let de=Z.heatmapFbo;if(!de||de&&(de.width!==ne||de.height!==fe)){de&&de.destroy();const ye=K.createTexture();K.bindTexture(K.TEXTURE_2D,ye),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),de=Z.heatmapFbo=G.createFramebuffer(ne,fe,!0,null),function(J,ae,ke,Re,Ne,et){const ze=J.gl;ze.texImage2D(ze.TEXTURE_2D,0,J.extRenderToTextureHalfFloat?ze.RGBA16F:ze.RGBA,Ne,et,0,ze.RGBA,J.extRenderToTextureHalfFloat?ze.HALF_FLOAT:ze.UNSIGNED_BYTE,null),Re.colorAttachment.set(ke)}(G,0,ye,de,ne,fe)}else K.bindTexture(K.TEXTURE_2D,de.colorAttachment.get()),G.bindFramebuffer.set(de.framebuffer)})(v,m,h,m.transform.projection.name==="globe"?.5:.25),v.clear({color:l.aA.transparent});const k=m.transform,O=k.projection.name==="globe",F=O?["PROJECTION_GLOBE_VIEW"]:[],B=O?Cr.frontCCW:Cr.disabled,$=[l.a8(k.center.lng),l.ah(k.center.lat)];for(let G=0;G<g.length;G++){const X=g[G];if(a.hasRenderableParent(X))continue;const Z=a.getTile(X),Y=Z.getBucket(h);if(!Y||Y.projection.name!==k.projection.name)continue;const K=m.isTileAffectedByFog(X),ne=Y.programConfigurations.get(h.id),fe=m.getOrCreateProgram("heatmap",{config:ne,defines:F,overrideFog:K}),{zoom:de}=m.transform;m.terrain&&m.terrain.setupElevationDraw(Z,fe),m.uploadCommonUniforms(v,fe,X.toUnwrapped());const ye=k.projection.createInversionMatrix(k,X.canonical);fe.draw(m,w.TRIANGLES,hr.disabled,E,C,B,WE(m,X,Z,ye,$,de,h.paint.get("heatmap-intensity")),h.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,h.paint,m.transform.zoom,ne,O?[Y.globeExtVertexBuffer]:null)}v.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(v,w){const E=v.context,C=E.gl,k=w.heatmapFbo;if(!k)return;E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,k.colorAttachment.get()),E.activeTexture.set(C.TEXTURE1);let O=w.colorRampTexture;O||(O=w.colorRampTexture=new l.T(E,w.colorRamp,C.RGBA)),O.bind(C.LINEAR,C.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,C.TRIANGLES,hr.disabled,Dr.disabled,v.colorModeForRenderPass(),Cr.disabled,((F,B,$,G)=>({u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}))(0,w),w.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,w.paint,v.transform.zoom)}(m,h))},line:function(m,a,h,g){if(m.renderPass!=="translucent")return;const v=h.paint.get("line-opacity"),w=h.paint.get("line-width");if(v.constantOr(1)===0||w.constantOr(1)===0)return;const E=h.paint.get("line-emissive-strength"),C=m.depthModeForSublayer(0,hr.ReadOnly),k=m.colorModeForDrapableLayerRenderPass(E),O=m.terrain&&m.terrain.renderingToTexture?1:l.f.devicePixelRatio,F=h.paint.get("line-dasharray"),B=F.constantOr(1),$=h.layout.get("line-cap"),G=h.paint.get("line-pattern"),X=G.constantOr(1),Z=h.paint.get("line-opacity").constantOr(1)!==1;let Y=!X&&Z;const K=h.paint.get("line-gradient"),ne=X?"linePattern":"line",fe=m.context,de=fe.gl,ye=l.cH(h);m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(Y=!1);for(const J of g){const ae=a.getTile(J);if(X&&!ae.patternsLoaded())continue;const ke=ae.getBucket(h);if(!ke)continue;m.prepareDrawTile();const Re=ke.programConfigurations.get(h.id),Ne=m.isTileAffectedByFog(J),et=m.getOrCreateProgram(ne,{config:Re,defines:ye,overrideFog:Ne}),ze=G.constantOr(null);if(ze&&ae.imageAtlas){const rt=ae.imageAtlas.patternPositions[ze.toString()];rt&&Re.setConstantPatternPositions(rt)}const Qe=F.constantOr(null),it=$.constantOr(null);if(!X&&Qe&&it&&ae.lineAtlas){const rt=ae.lineAtlas.getDash(Qe,it);rt&&Re.setConstantPatternPositions(rt)}let[Oe,He]=h.paint.get("line-trim-offset");(it==="round"||it==="square")&&Oe!==He&&(Oe===0&&(Oe-=1),He===1&&(He+=1));const Tt=m.terrain?J.projMatrix:null,Ue=X?l.cI(m,ae,h,Tt,O,[Oe,He]):l.cJ(m,ae,h,Tt,ke.lineClipsArray.length,O,[Oe,He]);if(K){const rt=ke.gradients[h.id];let me=rt.texture;if(h.gradientVersion!==rt.version){let vt=256;if(h.stepInterpolant){const Zt=a.getSource().maxzoom,ir=J.canonical.z===Zt?Math.ceil(1<<m.transform.maxZoom-J.canonical.z):1;vt=l.ad(l.cK(ke.maxLineLength/l.Y*1024*ir),256,fe.maxTextureSize)}rt.gradient=l.cL({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:vt,image:rt.gradient||void 0,clips:ke.lineClipsArray}),rt.texture?rt.texture.update(rt.gradient):rt.texture=new l.T(fe,rt.gradient,de.RGBA),rt.version=h.gradientVersion,me=rt.texture}fe.activeTexture.set(de.TEXTURE1),me.bind(h.stepInterpolant?de.NEAREST:de.LINEAR,de.CLAMP_TO_EDGE)}B&&(fe.activeTexture.set(de.TEXTURE0),ae.lineAtlasTexture&&ae.lineAtlasTexture.bind(de.LINEAR,de.REPEAT),Re.updatePaintBuffers()),X&&(fe.activeTexture.set(de.TEXTURE0),ae.imageAtlasTexture&&ae.imageAtlasTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),Re.updatePaintBuffers()),m.uploadCommonUniforms(fe,et,J.toUnwrapped());const Je=rt=>{et.draw(m,de.TRIANGLES,C,rt,k,Cr.disabled,Ue,h.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,h.paint,m.transform.zoom,Re,[ke.layoutVertexBuffer2,ke.patternVertexBuffer])};if(Y){const rt=m.stencilModeForClipping(J).ref;rt===0&&m.terrain&&fe.clear({stencil:0});const me={func:de.EQUAL,mask:255};Ue.u_alpha_discard_threshold=.8,Je(new Dr(me,rt,255,de.KEEP,de.KEEP,de.INVERT)),Ue.u_alpha_discard_threshold=0,Je(new Dr(me,rt,255,de.KEEP,de.KEEP,de.KEEP))}else Je(m.stencilModeForClipping(J))}Y&&(m.resetStencilClippingMasks(),m.terrain&&fe.clear({stencil:0}))},fill:function(m,a,h,g){const v=h.paint.get("fill-color"),w=h.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const E=h.paint.get("fill-emissive-strength"),C=m.colorModeForDrapableLayerRenderPass(E),k=h.paint.get("fill-pattern"),O=m.opaquePassEnabledForLayer()&&!k.constantOr(1)&&v.constantOr(l.aA.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===O){const F=m.depthModeForSublayer(1,m.renderPass==="opaque"?hr.ReadWrite:hr.ReadOnly);jm(m,a,h,g,F,C,!1)}if(m.renderPass==="translucent"&&h.paint.get("fill-antialias")){const F=m.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,hr.ReadOnly);jm(m,a,h,g,F,C,!0)}},"fill-extrusion":function(m,a,h,g){const v=h.paint.get("fill-extrusion-opacity"),w=m.context,E=w.gl,C=m.terrain,k=C&&C.renderingToTexture;if(v===0)return;const O=m.conflationActive&&m.layerUsedInConflation(h,a.getSource());if(O&&function(F,B,$,G){for(const X of G){const Z=B.getTile(X).getBucket($);Z&&(Z.updateReplacement(X,F.replacementSource),Z.uploadCentroid(F.context))}}(m,a,h,g),C||O)for(const F of g){const B=a.getTile(F).getBucket(h);B&&R0(m.context,a,F,B,h,C,O)}if(m.renderPass==="shadow"&&m.shadowRenderer){const F=m.shadowRenderer;if(C&&v<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof l.Z)return;const B=F.getShadowPassDepthMode(),$=F.getShadowPassColorMode();Gt(m,a,h,g,B,Dr.disabled,$,O)}else if(m.renderPass==="translucent"){const F=!h.paint.get("fill-extrusion-pattern").constantOr(1),B=h.paint.get("fill-extrusion-color").constantOr(l.aA.white);if(!k&&B.a!==0){const $=new hr(m.context.gl.LEQUAL,hr.ReadWrite,m.depthRangeFor3D);v===1&&F?Gt(m,a,h,g,$,Dr.disabled,$r.unblended,O):(Gt(m,a,h,g,$,Dr.disabled,$r.disabled,O),Gt(m,a,h,g,$,m.stencilModeFor3D(),m.colorModeForRenderPass(),O),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&F&&(!C&&m.transform.projection.name!=="globe"||k)){const $=h.paint.get("fill-extrusion-opacity"),G=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),X=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Z=h.paint.get("fill-extrusion-flood-light-intensity"),Y=h.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),K=G>0&&X>0,ne=Z>0,fe=(ye,J,ae)=>(1-ae)*ye+ae*J,de=ye=>{const J=m.depthModeForSublayer(1,hr.ReadOnly,E.LEQUAL,!0),ae=h.paint.get(ye?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ke=fe(.1,3,ae),Re=m._showOverdrawInspector;if(!Re){const Ne=new Dr({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),et=new $r([E.ONE,E.ONE,E.ONE,E.ONE],l.aA.transparent,[!1,!1,!1,!0],E.MIN);Nu(m,a,h,g,J,Ne,et,Cr.disabled,ye,"sdf",$,G,X,Z,Y,ke,O,!1)}{const Ne=Re?Dr.disabled:new Dr({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),et=Re?m.colorModeForRenderPass():new $r([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],l.aA.transparent,[!0,!0,!0,!0]);Nu(m,a,h,g,J,Ne,et,Cr.disabled,ye,"color",$,G,X,Z,Y,ke,O,!1)}};if(k){const ye=(J,ae,ke)=>{const Re=m.depthModeForSublayer(1,hr.ReadOnly,E.LEQUAL,!1),Ne=h.paint.get(J?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),et=fe(.1,3,Ne);{const ze=new $r([E.ONE,E.ONE,E.ONE,E.ONE],l.aA.transparent,[!1,!1,!1,!0]);Nu(m,a,h,g,Re,Dr.disabled,ze,Cr.disabled,J,"clear",$,G,X,Z,Y,et,O,ae)}{const ze=new Dr({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Qe=new $r([E.ONE,E.ONE,E.ONE,E.ONE],l.aA.transparent,[!1,!1,!1,!0],E.MIN);Nu(m,a,h,g,Re,ze,Qe,Cr.disabled,J,"sdf",$,G,X,Z,Y,et,O,ae)}{const ze=J?E.ZERO:E.ONE_MINUS_DST_ALPHA,Qe=new Dr({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),it=new $r([ze,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],l.aA.transparent,[!0,!0,!0,!0]);Nu(m,a,h,g,Re,Qe,it,Cr.disabled,J,"color",$,G,X,Z,Y,et,O,ae)}{const ze=new $r([E.ONE,E.ONE,E.ONE,J?E.ZERO:E.ONE],l.aA.transparent,[!1,!1,!1,!0],J?E.FUNC_ADD:E.MAX);Nu(m,a,h,g,Re,Dr.disabled,ze,Cr.disabled,J,"clear",$,G,X,Z,Y,et,O,ae,ke)}};if(K||ne){let J;if(m.prepareDrawTile(),C){const ae=C.drapeBufferSize[0],ke=C.drapeBufferSize[1];J=C.framebufferCopyTexture,J&&(!J||J.size[0]===ae&&J.size[1]===ke)||(J&&J.destroy(),J=C.framebufferCopyTexture=new l.T(w,new l.h({width:ae,height:ke}),E.RGBA)),J.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexImage2D(E.TEXTURE_2D,0,E.RGBA,0,0,ae,ke,0)}K&&ye(!0,!1,J),ne&&ye(!1,!0,J)}}else K&&de(!0),ne&&de(!1)}}},hillshade:function(m,a,h,g){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;const v=m.context,w=m.terrain&&m.terrain.renderingToTexture,[E,C]=m.renderPass!=="translucent"||w?[{},g]:m.stencilConfigForOverlap(g);for(const k of C){const O=a.getTile(k);if(O.needsHillshadePrepare&&m.renderPass==="offscreen")zh(m,O,h);else if(m.renderPass==="translucent"){const F=m.depthModeForSublayer(0,hr.ReadOnly),B=h.paint.get("hillshade-emissive-strength"),$=m.colorModeForDrapableLayerRenderPass(B),G=w&&m.terrain?m.terrain.stencilModeForRTTOverlap(k):E[k.overscaledZ];Li(m,k,O,h,F,G,$)}}v.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,a,h,g,v,w){if(m.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;const E=m.transform.projection.name==="globe",C=h.paint.get("raster-elevation")!==0,k=C&&E;if(m.renderElevatedRasterBackface&&!k)return;const O=m.context,F=O.gl,B=a.getSource(),$=function(J,ae,ke,Re){const Ne=ae.paint.get("raster-color"),et=J.type==="raster-array",ze=[],Qe=ae.paint.get("raster-resampling"),it=ae.paint.get("raster-color-mix");let Oe=ae.paint.get("raster-color-range");const He=[it[0],it[1],it[2],0],Tt=it[3];let Ue=Qe==="nearest"?Re.NEAREST:Re.LINEAR;if(et&&(ze.push("RASTER_ARRAY"),Ne||ze.push("RASTER_COLOR"),Qe==="linear"&&ze.push("RASTER_ARRAY_LINEAR"),Ue=Re.NEAREST,!Oe&&J.rasterLayers)){const Je=J.rasterLayers.find(({id:rt})=>rt===ae.sourceLayer);Je&&Je.fields&&Je.fields.range&&(Oe=Je.fields.range)}if(Oe=Oe||[0,1],Ne){ze.push("RASTER_COLOR"),ke.activeTexture.set(Re.TEXTURE2),ae.updateColorRamp(Oe);let Je=ae.colorRampTexture;Je||(Je=ae.colorRampTexture=new l.T(ke,ae.colorRamp,Re.RGBA)),Je.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}return{mix:He,range:Oe,offset:Tt,defines:ze,resampling:Ue}}(B,h,O,F);if(B instanceof l.as&&!g.length&&!E)return;const G=h.paint.get("raster-emissive-strength"),X=m.colorModeForDrapableLayerRenderPass(G),Z=m.terrain&&m.terrain.renderingToTexture,Y=!m.options.moving,K=h.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;if(B instanceof l.as&&!g.length&&(B.onNorthPole||B.onSouthPole)){const J=C?m.stencilModeFor3D():Dr.disabled;return void ic(!!B.onNorthPole,null,m,a,h,G,$,Cr.disabled,J)}if(!g.length)return;const[ne,fe]=B instanceof l.as||Z?[{},g]:m.stencilConfigForOverlap(g),de=fe[fe.length-1].overscaledZ;k&&$.defines.push("PROJECTION_GLOBE_VIEW"),C&&$.defines.push("RENDER_CUTOFF");const ye=(J,ae,ke)=>{for(const Re of J){const Ne=Re.toUnwrapped(),et=a.getTile(Re);if(Z&&(!et||!et.hasData()))continue;O.activeTexture.set(F.TEXTURE0);const ze=jh(et,B,h,$);if(!ze||!ze.texture)continue;const{texture:Qe,mix:it,offset:Oe,tileSize:He,buffer:Tt}=ze;let Ue,Je;Z?(Ue=hr.disabled,Je=Re.projMatrix):C?(Ue=new hr(F.LEQUAL,hr.ReadWrite,m.depthRangeFor3D),Je=E?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(Ne,Y)):(Ue=m.depthModeForSublayer(Re.overscaledZ-de,h.paint.get("raster-opacity")===1?hr.ReadWrite:hr.ReadOnly,F.LESS),Je=m.transform.calculateProjMatrix(Ne,Y));const rt=m.terrain&&Z?m.terrain.stencilModeForRTTOverlap(Re):ne[Re.overscaledZ],me=w?0:h.paint.get("raster-fade-duration");et.registerFadeDuration(me);const vt=a.findLoadedParent(Re,0),Zt=Ou(et,vt,a,m.transform,me);let ir,fr;m.terrain&&m.terrain.prepareDrawTile(),O.activeTexture.set(F.TEXTURE0),Qe.bind(K,F.CLAMP_TO_EDGE),O.activeTexture.set(F.TEXTURE1),vt?(vt.texture&&vt.texture.bind(K,F.CLAMP_TO_EDGE),ir=Math.pow(2,vt.tileID.overscaledZ-et.tileID.overscaledZ),fr=[et.tileID.canonical.x*ir%1,et.tileID.canonical.y*ir%1]):Qe.bind(K,F.CLAMP_TO_EDGE),Qe.useMipmap&&O.extTextureFilterAnisotropic&&m.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);const cr=m.transform;let vr;const hi=C?qm(cr):[0,0,0,0];let zr,vi,di,yn,Vi,Jn=0;if(k&&B instanceof l.as&&B.coordinates.length>3)zr=Float32Array.from(l.aW(l.cn(new l.bv(0,0,0)))),vi=Float32Array.from(cr.globeMatrix),di=Float32Array.from(l.cj(cr)),yn=[l.a8(cr.center.lng),l.ah(cr.center.lat)],vr=B.elevatedGlobePerspectiveTransform,Vi=B.elevatedGlobeGridMatrix||new Float32Array(9);else if(k){const Xr=l.ck(Re.canonical);Jn=l.cl(Xr.getCenter().lat),zr=Float32Array.from(l.aW(l.cn(Re.canonical))),vi=Float32Array.from(cr.globeMatrix),di=Float32Array.from(l.cj(cr)),yn=[l.a8(cr.center.lng),l.ah(cr.center.lat)],vr=[0,0],Vi=Float32Array.from(l.cm(Re.canonical,Xr,Jn,cr.worldSize/cr._pixelsPerMercatorPixel))}else vr=B instanceof l.as?B.perspectiveTransform:[0,0],zr=new Float32Array(16),vi=new Float32Array(9),di=new Float32Array(16),yn=[0,0],Vi=new Float32Array(9);const Un=X1(Je,zr,vi,di,Vi,fr||[0,0],l.W(m.transform.zoom),yn,hi,ir||1,Zt,h,vr,C?h.paint.get("raster-elevation"):0,2,it,Oe,$.range,He,Tt,G),Yi=m.isTileAffectedByFog(Re),ji=m.getOrCreateProgram("raster",{defines:$.defines,overrideFog:Yi});if(m.uploadCommonUniforms(O,ji,Ne),B instanceof l.as){const Xr=B.elevatedGlobeVertexBuffer,Qr=B.elevatedGlobeIndexBuffer;if(Z||!E)B.boundsBuffer&&B.boundsSegments&&ji.draw(m,F.TRIANGLES,Ue,Dr.disabled,X,Cr.disabled,Un,h.id,B.boundsBuffer,m.quadTriangleIndexBuffer,B.boundsSegments);else if(Xr&&Qr){const ln=cr.zoom<=l.bJ?B.elevatedGlobeSegments:B.getSegmentsForLongitude(cr.center.lng);ln&&ji.draw(m,F.TRIANGLES,Ue,Dr.disabled,X,ae,Un,h.id,Xr,Qr,ln)}}else if(k){Ue=new hr(F.LEQUAL,hr.ReadOnly,m.depthRangeFor3D);const Xr=m.globeSharedBuffers;if(Xr){const[Qr,ln,Qi]=Xr.getGridBuffers(Jn,!1);ji.draw(m,F.TRIANGLES,Ue,ke||rt,m.colorModeForRenderPass(),ae,Un,h.id,Qr,ln,Qi)}}else{const{tileBoundsBuffer:Xr,tileBoundsIndexBuffer:Qr,tileBoundsSegments:ln}=m.getTileBoundsBuffers(et);ji.draw(m,F.TRIANGLES,Ue,rt,X,Cr.disabled,Un,h.id,Xr,Qr,ln)}}if(!(B instanceof l.as)&&k)for(const Re of J){const Ne=Re.canonical.y===(1<<Re.canonical.z)-1;Re.canonical.y===0&&ic(!0,Re,m,a,h,G,$,ae,ke||Dr.disabled),Ne&&ic(!1,Re,m,a,h,G,$,ae===Cr.frontCW?Cr.backCW:Cr.frontCW,ke||Dr.disabled)}};k?ye(fe,m.renderElevatedRasterBackface?Cr.backCW:Cr.frontCW,m.stencilModeFor3D()):ye(fe,Cr.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,a,h,g,v,w){m.renderPass==="offscreen"&&function(E,C,k,O){if(!O.length)return;const F=E.context,B=F.gl,$=C.getSource();if(!($ instanceof Rt))return;const G=Math.ceil(Math.sqrt(k.paint.get("raster-particle-count")));let X=k.particleFramebuffer;X?X.width!==G&&(X.destroy(),X=k.particleFramebuffer=F.createFramebuffer(G,G,!0,null)):X=k.particleFramebuffer=F.createFramebuffer(G,G,!0,null);const Z=[];for(const ne of O){const fe=C.getTile(ne);if(!(fe instanceof Rh))continue;const de=KE(fe,$,k);if(!de)continue;const ye=[fe.tileSize,fe.tileSize];let J=k.tileFramebuffer;J||(J=k.tileFramebuffer=F.createFramebuffer(ye[0],ye[1],!0,null));let ae=fe.rasterParticleState;ae||(ae=fe.rasterParticleState=new kc(F,ne,ye,G));const ke=ae.update(k.lastInvalidatedAt);ae.particleTextureDimension!==G&&ae.setParticleTextureDimension(ne,G);const Re=ae.targetColorTexture;ae.targetColorTexture=ae.backgroundColorTexture,ae.backgroundColorTexture=Re;const Ne=ae.particleTexture0;ae.particleTexture0=ae.particleTexture1,ae.particleTexture1=Ne,Z.push([ne,de,ae,ke])}if(Z.length===0)return;const Y=l.f.now(),K=k.previousDrawTimestamp?.001*(Y-k.previousDrawTimestamp):.0167;if(k.previousDrawTimestamp=Y,k.hasColorMap()){F.activeTexture.set(B.TEXTURE0+2);let ne=k.colorRampTexture;ne||(ne=k.colorRampTexture=new l.T(F,k.colorRamp,B.RGBA)),ne.bind(B.LINEAR,B.CLAMP_TO_EDGE)}F.bindFramebuffer.set(k.tileFramebuffer.framebuffer),function(ne,fe,de){const ye=ne.context,J=ye.gl,ae=fe.tileFramebuffer;ye.activeTexture.set(J.TEXTURE0);const ke={u_texture:0,u_opacity:1.05*(Ne=fe.paint.get("raster-particle-fade-opacity-factor"))/(Ne+.05)},Re=ne.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ne;for(const et of de){const[,,ze,Qe]=et;ae.colorAttachment.set(ze.targetColorTexture.texture),ye.viewport.set([0,0,ae.width,ae.height]),ye.clear({color:l.aA.transparent}),Qe&&(ze.backgroundColorTexture.bind(J.NEAREST,J.CLAMP_TO_EDGE),Re.draw(ne,J.TRIANGLES,hr.disabled,Dr.disabled,$r.alphaBlended,Cr.disabled,ke,fe.id,ne.viewportBuffer,ne.quadTriangleIndexBuffer,ne.viewportSegments))}}(E,k,Z),function(ne,fe,de,ye){const J=ne.context,ae=J.gl,ke=de.tileFramebuffer,Re=ne.transform.projection.name==="globe",Ne=de.paint.get("raster-particle-max-speed");for(const et of ye){const[ze,Qe,it]=et;J.activeTexture.set(ae.TEXTURE0+0),Qe.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),ke.colorAttachment.set(it.targetColorTexture.texture);const Oe=ne.getOrCreateProgram("rasterParticleDraw",{defines:Qe.defines,overrideFog:!1});J.activeTexture.set(ae.TEXTURE0+1);const He=Qe.scalarData?[]:[0,1,2,3].map(Je=>l.cN[Je](ze));He.push(ze);const Tt=ze.canonical.x,Ue=ze.canonical.y;for(const Je of He){const rt=fe.getTile(Re?Je.wrapped():Je);if(!rt)continue;const me=rt.rasterParticleState;if(!me)continue;const vt=Je.canonical.x+(1<<Je.canonical.z)*(Je.wrap-ze.wrap),Zt=Je.canonical.y;me.particleTexture0.bind(ae.NEAREST,ae.CLAMP_TO_EDGE);const ir=Of(1,me.particleTexture0.size[0],[vt-Tt,Zt-Ue],0,Qe.texture.size,2,Ne,Qe.textureOffset,Qe.scale,Qe.offset);Oe.draw(ne,ae.POINTS,hr.disabled,Dr.disabled,$r.alphaBlended,Cr.disabled,ir,de.id,me.particleIndexBuffer,void 0,me.particleSegment)}}}(E,C,k,Z),F.bindFramebuffer.set(k.particleFramebuffer.framebuffer),function(ne,fe,de,ye){const J=ne.context,ae=J.gl,ke=fe.paint.get("raster-particle-max-speed"),Re=ye*fe.paint.get("raster-particle-speed-factor")*.3,Ne=function(ze){return Math.pow(ze,6)}(.01+1*fe.paint.get("raster-particle-reset-rate-factor")),et=fe.particleFramebuffer;J.viewport.set([0,0,et.width,et.height]);for(const ze of de){const[,Qe,it]=ze;J.activeTexture.set(ae.TEXTURE0+0),Qe.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),J.activeTexture.set(ae.TEXTURE0+1);const Oe=it.particleTexture0;Oe.bind(ae.NEAREST,ae.CLAMP_TO_EDGE);const He=XE(1,Oe.size[0],0,Qe.texture.size,ke,Re,Ne,Qe.textureOffset,Qe.scale,Qe.offset);et.colorAttachment.set(it.particleTexture1.texture),J.clear({color:l.aA.transparent}),ne.getOrCreateProgram("rasterParticleUpdate",{defines:Qe.defines}).draw(ne,ae.TRIANGLES,hr.disabled,Dr.disabled,$r.unblended,Cr.disabled,He,fe.id,ne.viewportBuffer,ne.quadTriangleIndexBuffer,ne.viewportSegments)}}(E,k,Z,K)}(m,a,h,g),m.renderPass==="translucent"&&(function(E,C,k,O,F){const B=E.context,$=B.gl,G=!E.options.moving,X=E.transform.projection.name==="globe";if(!O.length)return;const[Z,Y]=E.stencilConfigForOverlap(O),K=[];X&&K.push("PROJECTION_GLOBE_VIEW");const ne=E.stencilModeFor3D();for(const fe of Y){const de=fe.toUnwrapped(),ye=C.getTile(fe);if(!ye.rasterParticleState)continue;const J=ye.rasterParticleState,ae=100;ye.registerFadeDuration(ae);const ke=C.findLoadedParent(fe,0),Re=Ou(ye,ke,C,E.transform,ae);let Ne,et;E.terrain&&E.terrain.prepareDrawTile(),B.activeTexture.set($.TEXTURE0),J.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),B.activeTexture.set($.TEXTURE1),ke&&ke.rasterParticleState?(ke.rasterParticleState.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),Ne=Math.pow(2,ke.tileID.overscaledZ-ye.tileID.overscaledZ),et=[ye.tileID.canonical.x*Ne%1,ye.tileID.canonical.y*Ne%1]):J.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE);const ze=X?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(de,G),Qe=E.transform,it=JE(Qe),Oe=l.ck(fe.canonical),He=l.cl(Oe.getCenter().lat);let Tt,Ue,Je,rt,me;X?(Tt=Float32Array.from(l.aW(l.cn(fe.canonical))),Ue=Float32Array.from(Qe.globeMatrix),Je=Float32Array.from(l.cj(Qe)),rt=[l.a8(Qe.center.lng),l.ah(Qe.center.lat)],me=Float32Array.from(l.cm(fe.canonical,Oe,He,Qe.worldSize/Qe._pixelsPerMercatorPixel))):(Tt=new Float32Array(16),Ue=new Float32Array(9),Je=new Float32Array(16),rt=[0,0],me=new Float32Array(9));const vt=Lf(ze,Tt,Ue,Je,me,et||[0,0],l.W(E.transform.zoom),rt,it,Ne||1,Re,250),Zt=E.isTileAffectedByFog(fe),ir=E.getOrCreateProgram("rasterParticle",{defines:K,overrideFog:Zt});if(E.uploadCommonUniforms(B,ir,de),X){const fr=new hr($.LEQUAL,hr.ReadWrite,E.depthRangeFor3D),cr=0,vr=E.globeSharedBuffers;if(vr){const[hi,zr,vi]=vr.getGridBuffers(He,cr!==0);ir.draw(E,$.TRIANGLES,fr,ne,$r.alphaBlended,Cr.backCCW,vt,k.id,hi,zr,vi)}}else{const fr=E.depthModeForSublayer(0,hr.ReadOnly),cr=Z[fe.overscaledZ],{tileBoundsBuffer:vr,tileBoundsIndexBuffer:hi,tileBoundsSegments:zr}=E.getTileBoundsBuffers(ye);ir.draw(E,$.TRIANGLES,fr,cr,$r.alphaBlended,Cr.disabled,vt,k.id,vr,hi,zr)}}E.resetStencilClippingMasks()}(m,a,h,g),m.style.map.triggerRepaint())},background:function(m,a,h,g){const v=h.paint.get("background-color"),w=h.paint.get("background-opacity"),E=h.paint.get("background-emissive-strength");if(w===0)return;const C=m.context,k=C.gl,O=m.transform,F=O.tileSize,B=h.paint.get("background-pattern");if(m.isPatternMissing(B,h.scope))return;const $=!B&&v.a===1&&w===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==$)return;const G=Dr.disabled,X=m.depthModeForSublayer(0,$==="opaque"?hr.ReadWrite:hr.ReadOnly),Z=m.colorModeForDrapableLayerRenderPass(E),Y=B?"backgroundPattern":"background";let K,ne=g;ne||(K=m.getBackgroundTiles(),ne=Object.values(K).map(fe=>fe.tileID)),B&&(C.activeTexture.set(k.TEXTURE0),m.imageManager.bind(m.context,h.scope));for(const fe of ne){const de=m.isTileAffectedByFog(fe),ye=m.getOrCreateProgram(Y,{overrideFog:de}),J=fe.toUnwrapped(),ae=g?fe.projMatrix:m.transform.calculateProjMatrix(J);m.prepareDrawTile();const ke=a?a.getTile(fe):K?K[fe.key]:new Po(fe,F,O.zoom,m),Re=B?QE(ae,E,w,m,B,h.scope,{tileID:fe,tileSize:F}):YE(ae,E,w,v);m.uploadCommonUniforms(C,ye,J);const{tileBoundsBuffer:Ne,tileBoundsIndexBuffer:et,tileBoundsSegments:ze}=m.getTileBoundsBuffers(ke);ye.draw(m,k.TRIANGLES,X,G,Z,Cr.disabled,Re,h.id,Ne,et,ze)}},sky:function(m,a,h){const g=m._atmosphere?l.W(m.transform.zoom):1,v=h.paint.get("sky-opacity")*g;if(v===0)return;const w=m.context,E=h.paint.get("sky-type"),C=new hr(w.gl.LEQUAL,hr.ReadOnly,[0,1]),k=m.frameCounter/1e3%1;E==="atmosphere"?m.renderPass==="offscreen"?h.needsSkyboxCapture(m)&&(function(O,F,B,$){const G=O.context,X=G.gl;let Z=F.skyboxFbo;if(!Z){Z=F.skyboxFbo=G.createFramebuffer(32,32,!0,null),F.skyboxGeometry=new nx(G),F.skyboxTexture=G.gl.createTexture(),X.bindTexture(X.TEXTURE_CUBE_MAP,F.skyboxTexture),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MAG_FILTER,X.LINEAR);for(let fe=0;fe<6;++fe)X.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+fe,0,X.RGBA,32,32,0,X.RGBA,X.UNSIGNED_BYTE,null)}G.bindFramebuffer.set(Z.framebuffer),G.viewport.set([0,0,32,32]);const Y=F.getCenter(O,!0),K=O.getOrCreateProgram("skyboxCapture"),ne=new Float64Array(16);l.a9.identity(ne),l.a9.rotateY(ne,ne,.5*-Math.PI),Bu(O,F,K,ne,Y,0),l.a9.identity(ne),l.a9.rotateY(ne,ne,.5*Math.PI),Bu(O,F,K,ne,Y,1),l.a9.identity(ne),l.a9.rotateX(ne,ne,.5*-Math.PI),Bu(O,F,K,ne,Y,2),l.a9.identity(ne),l.a9.rotateX(ne,ne,.5*Math.PI),Bu(O,F,K,ne,Y,3),l.a9.identity(ne),Bu(O,F,K,ne,Y,4),l.a9.identity(ne),l.a9.rotateY(ne,ne,Math.PI),Bu(O,F,K,ne,Y,5),G.viewport.set([0,0,O.width,O.height])}(m,h),h.markSkyboxValid(m)):m.renderPass==="sky"&&function(O,F,B,$,G){const X=O.context,Z=X.gl,Y=O.transform,K=O.getOrCreateProgram("skybox");X.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_CUBE_MAP,F.skyboxTexture);const ne=((fe,de,ye,J,ae)=>({u_matrix:fe,u_sun_direction:de,u_cubemap:0,u_opacity:J,u_temporal_offset:ae}))(Y.skyboxMatrix,F.getCenter(O,!1),0,$,G);O.uploadCommonUniforms(X,K),K.draw(O,Z.TRIANGLES,B,Dr.disabled,O.colorModeForRenderPass(),Cr.backCW,ne,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(m,h,C,v,k):E==="gradient"&&m.renderPass==="sky"&&function(O,F,B,$,G){const X=O.context,Z=X.gl,Y=O.transform,K=O.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new nx(X)),X.activeTexture.set(Z.TEXTURE0);let ne=F.colorRampTexture;ne||(ne=F.colorRampTexture=new l.T(X,F.colorRamp,Z.RGBA)),ne.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const fe=((de,ye,J,ae,ke)=>({u_matrix:de,u_color_ramp:0,u_center_direction:ye,u_radius:l.bm(J),u_opacity:ae,u_temporal_offset:ke}))(Y.skyboxMatrix,F.getCenter(O,!1),F.paint.get("sky-gradient-radius"),$,G);O.uploadCommonUniforms(X,K),K.draw(O,Z.TRIANGLES,B,Dr.disabled,O.colorModeForRenderPass(),Cr.backCW,fe,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(m,h,C,v,k)},debug:function(m,a,h,g,v,w){for(let E=0;E<h.length;E++)if(v){const O=new l.aA(g.r*.8,g.g*.8,g.b*.8,1);$h(m,a,h[E],g,-1,-1,w),$h(m,a,h[E],g,-1,1,w),$h(m,a,h[E],g,1,1,w),$h(m,a,h[E],g,1,-1,w),$h(m,a,h[E],O,0,0,w)}else $h(m,a,h[E],g,0,0,w)},custom:function(m,a,h,g){const v=m.context,w=h.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&h.isDraped(a)){if(m.renderPass==="offscreen"){const E=w.prerender;if(E){if(m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const C=m.transform.pointMerc;E.call(w,v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),l.W(m.transform.zoom),[C.x,C.y],m.transform.pixelsPerMeterRatio)}else E.call(w,v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const C=w.renderToTile;if(C){const k=g[0].canonical,O=new l.O(k.x+g[0].wrap*(1<<k.z),k.y,k.z);v.setDepthMode(hr.disabled),v.setStencilMode(Dr.disabled),v.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),C.call(w,v.gl,O),v.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),v.setStencilMode(Dr.disabled);const E=w.renderingMode==="3d"?new hr(m.context.gl.LEQUAL,hr.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,hr.ReadOnly);if(v.setDepthMode(E),m.transform.projection.name==="globe"){const C=m.transform.pointMerc;w.render(v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),l.W(m.transform.zoom),[C.x,C.y],m.transform.pixelsPerMeterRatio)}else w.render(v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState(),v.bindFramebuffer.set(null)}}else l.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,a,h,g){if(m.renderPass==="opaque")return;const v=h.paint.get("model-opacity");if(v===0)return;const w=h.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!w||m.terrain&&v<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof l.Z))return;const E=m.shadowRenderer,C=h.paint.get("model-receive-shadows");E&&(E.useNormalOffset=!0,C||(E.enabled=!1));const k=()=>{E&&(E.useNormalOffset=!0,C||(E.enabled=!0))},O=a.getSource();if(m.renderPass==="light-beam"&&O.type!=="batched-model")return;if(O.type==="vector"||O.type==="geojson")return function(K,ne,fe,de,ye){const J=K.transform;if(J.projection.name!=="mercator")return void l.w(`Drawing 3D models for ${J.projection.name} projection is not yet implemented`);const ae=J.getFreeCameraOptions().position;if(!K.modelManager)return;const ke=K.modelManager;fe.modelManager=ke;const Re=K.shadowRenderer;if(!fe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ne=fe._unevaluatedLayout._values["model-id"],et={...fe.layout.get("model-id").parameters};for(const ze of de){const Qe=ne.getTile(ze).getBucket(fe);if(!Qe||Qe.projection.name!==J.projection.name)continue;const it=Qe.getModelUris();it&&!Qe.modelsRequested&&(ke.addModelsFromBucket(it,ye),Qe.modelsRequested=!0);const Oe=Zm(ze,J);et.zoom=Oe;const He=Ne.possiblyEvaluate(et);if(Uf(K,Qe,ze),sa.shadowUniformsInitialized=!1,sa.useSingleShadowCascade=!!Re&&Re.getMaxCascadeForTile(ze.toUnwrapped())===0,K.renderPass==="shadow"&&Re){if(K.currentShadowCascade===1&&Qe.isInsideFirstShadowMapFrustum)continue;const Je=J.calculatePosMatrix(ze.toUnwrapped(),J.worldSize);if(sa.tileMatrix.set(Je),sa.shadowTileMatrix=Float32Array.from(Re.calculateShadowPassMatrixFromMatrix(Je)),sa.aabb.min.fill(0),sa.aabb.max[0]=sa.aabb.max[1]=l.Y,sa.aabb.max[2]=0,jf(Qe,sa,K,fe.scope))continue}const Tt=1<<ze.canonical.z,Ue=[((ae.x-ze.wrap)*Tt-ze.canonical.x)*l.Y,(ae.y*Tt-ze.canonical.y)*l.Y,ae.z*Tt*l.Y];for(let Je in Qe.instancesPerModel){const rt=Qe.instancesPerModel[Je];rt.features.length>0&&(Je=He.evaluate(rt.features[0].feature,{}));const me=ke.getModel(Je,ye);if(me&&me.uploaded)for(const vt of me.nodes)Xm(K,fe,vt,rt,Ue,ze,sa)}}}(m,a,h,g,O.type==="vector"?h.scope:""),void k();if(!O.loaded())return;if(O.type==="batched-model")return function(K,ne,fe,de){fe.resetLayerRenderingStats(K);const ye=K.context,J=K.transform,ae=K.style.fog,ke=K.shadowRenderer;if(J.projection.name!=="mercator")return void l.w(`Drawing 3D landmark models for ${J.projection.name} projection is not yet implemented`);const Re=K.transform.getFreeCameraOptions().position,Ne=l.Q.scale([],[Re.x,Re.y,Re.z],K.transform.worldSize);l.Q.negate(Ne,Ne);const et=l.a9.identity([]),ze=l.cZ(J.center.lat,J.zoom),Qe=l.a9.fromScaling([],[1,1,1/ze]);l.a9.translate(et,et,Ne);const it=fe.paint.get("model-opacity"),Oe=new hr(ye.gl.LEQUAL,hr.ReadWrite,K.depthRangeFor3D),He=new hr(ye.gl.LEQUAL,hr.ReadOnly,K.depthRangeFor3D),Tt=new l.bV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ue=K.renderPass==="shadow",Je=Ue&&ke?ke.getCurrentCascadeFrustum():J.getFrustum(J.scaleZoom(J.worldSize)),rt=fe.getLayerRenderingStats(),me=function(vt,Zt){for(const ir of de){const fr=ne.getTile(ir).getBucket(fe);if(!fr||!fr.uploaded)continue;let cr=!1;ke&&(cr=ke.getMaxCascadeForTile(ir.toUnwrapped())===0);const vr=J.calculatePosMatrix(ir.toUnwrapped(),J.worldSize),hi=fr.modelTraits;for(const zr of fr.getNodesInfo()){if(zr.hiddenByReplacement||!zr.node.meshes)continue;const vi=zr.evaluatedScale,di=zr.node;let yn=0;if(K.terrain&&di.elevation&&(yn=di.elevation*K.terrain.exaggeration()),vi[0]<=1&&vi[1]<=1&&vi[2]<=1&&(()=>{const oi=zr.getLocalBounds();return Tt.min=[...oi.min],Tt.max=[...oi.max],Tt.min[2]+=yn,Tt.max[2]+=yn,l.Q.transformMat4(Tt.min,Tt.min,vr),l.Q.transformMat4(Tt.max,Tt.max,vr),Tt})().intersects(Je)===0)continue;const Vi=[...vr];l.a9.translate(Vi,Vi,[(di.anchor?di.anchor[0]:0)*(vi[0]-1),(di.anchor?di.anchor[1]:0)*(vi[1]-1),yn]),l.Q.exactEquals(vi,l.c$)||l.a9.scale(Vi,Vi,vi);const Jn=l.a9.multiply([],Vi,di.matrix);let Un=l.a9.multiply([],Qe,Vi);l.a9.multiply(Un,et,Un);const Yi=l.a9.invert([],Un);l.a9.transpose(Yi,Yi),l.a9.scale(Yi,Yi,Ym),Un=l.a9.multiply(Un,Un,di.matrix);const ji=K.renderPass==="light-beam",Xr=l.a9.multiply([],J.expandedFarZProjMatrix,Jn),Qr=l.a9.multiply([],J.expandedFarZProjMatrix,Vi),ln=hi&l.d1.HasMapboxMeshFeatures,Qi=ln?0:zr.evaluatedRMEA[0][2];for(let oi=0;oi<di.meshes.length;++oi){const Gr=di.meshes[oi],vo=oi===di.lightMeshIndex;let js=Xr;if(vo){if(!ji&&!K.terrain&&K.shadowRenderer){K.currentLayer<K.firstLightBeamLayer&&(K.firstLightBeamLayer=K.currentLayer);continue}js=Qr}else if(ji)continue;const _s={defines:[]},$s=[];if(jc(_s.defines,$s,Gr,K),ln||_s.defines.push("DIFFUSE_SHADED"),cr&&_s.defines.push("SHADOWS_SINGLE_CASCADE"),rt&&(Ue?rt.numRenderedVerticesInShadowPass+=Gr.vertexArray.length:rt.numRenderedVerticesInTransparentPass+=Gr.vertexArray.length),Ue){Vf(Gr,Jn,K,fe);continue}let xo=null;if(ae){const tl=z0(Jn,K.transform);if(xo=new Float32Array(tl),J.projection.name!=="globe"){const Il=Gr.aabb.min,Sl=Gr.aabb.max,[Hc,Ra]=ae.getOpacityForBounds(tl,Il[0],Il[1],Sl[0],Sl[1]);_s.overrideFog=Hc>=mr||Ra>=mr}}const to=Gr.material;let gs;to.occlusionTexture&&to.occlusionTexture.offsetScale&&(gs=to.occlusionTexture.offsetScale,_s.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Ue&&ke&&(ke.useNormalOffset=!!Gr.normalBuffer);const Cs=K.getOrCreateProgram("model",_s);!Ue&&ke&&ke.setupShadowsFromMatrix(Vi,Cs,ke.useNormalOffset),K.uploadCommonUniforms(ye,Cs,null,xo);const Rs=to.pbrMetallicRoughness;Rs.metallicFactor=.9,Rs.roughnessFactor=.5;const Al=Vm(new Float32Array(js),new Float32Array(Un),new Float32Array(Yi),new Float32Array(di.matrix),K,it,Rs.baseColorFactor,to.emissiveFactor,Rs.metallicFactor,Rs.roughnessFactor,to,Qi,fe,[0,0,0],gs);Cs.draw(K,ye.gl.TRIANGLES,Zt&&!vo?Oe:He,Dr.disabled,vt?vo||it<1||zr.hasTranslucentParts?$r.alphaBlended:$r.unblended:$r.disabled,Cr.backCCW,Al,fe.id,Gr.vertexBuffer,Gr.indexBuffer,Gr.segments,fe.paint,K.transform.zoom,void 0,$s)}}}};(function(vt,Zt,ir,fr){const cr=vt.terrain?vt.terrain.exaggeration():0,vr=vt.transform.zoom;for(const hi of fr){const zr=Zt.getTile(hi).getBucket(ir);zr&&(vt.conflationActive&&zr.updateReplacement(hi,vt.replacementSource),zr.evaluateScale(vt,ir),vt.terrain&&cr>0&&zr.elevationUpdate(vt.terrain,cr,hi,ir.source),zr.needsReEvaluation(vt,vr,ir)&&zr.evaluate(ir))}})(K,ne,fe,de),it===1?me(!0,!0):(me(!1,!0),me(!0,!1))}(m,a,h,g),void k();const F=O.getModels(),B=[],$=m.transform.getFreeCameraOptions().position,G=l.Q.scale([],[$.x,$.y,$.z],m.transform.worldSize);l.Q.negate(G,G);const X=[],Z=[];let Y=0;for(const K of F){const ne=h.paint.get("model-rotation").constantOr(null),fe=h.paint.get("model-scale").constantOr(null),de=h.paint.get("model-translation").constantOr(null);K.computeModelMatrix(m,ne,fe,de,!0,!0,!1);const ye=l.a9.identity([]),J=l.cZ(K.position.lat,m.transform.zoom),ae=l.a9.fromScaling([],[1,1,1/J]);l.a9.translate(ye,ye,G),B.push({zScaleMatrix:ae,negCameraPosMatrix:ye});for(const ke of K.nodes)Bf(m.transform,ke,K.matrix,m.transform.expandedFarZProjMatrix,Y,X,Z);Y++}if(X.sort((K,ne)=>ne.depth-K.depth),m.renderPass!=="shadow"){if(v===1)for(const K of Z)$c(K,m,h,B[K.modelIndex],Dr.disabled,m.colorModeForRenderPass());else{for(const K of Z)$c(K,m,h,B[K.modelIndex],Dr.disabled,$r.disabled);for(const K of Z)$c(K,m,h,B[K.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(const K of X)$c(K,m,h,B[K.modelIndex],Dr.disabled,m.colorModeForRenderPass());k()}else{for(const K of Z)Vf(K.mesh,K.nodeModelMatrix,m,h);for(const K of X)Vf(K.mesh,K.nodeModelMatrix,m,h);k()}}},Uu={model:function(m,a,h){const g=a.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(h.modelManager&&h.modelManager.upload(h,g.type==="vector"?m.scope:""));if(g.type==="batched-model")return;const v=g.getModels();for(const w of v)w.upload(h.context)},raster:function(m,a,h){const g=a.getSource();if(!(g instanceof Rt&&g.loaded()))return;const v=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;const w=m.paint.get("raster-array-band")||g.getInitialBand(v);if(w==null)return;const E=a.getIds().map(C=>a.getTileByID(C));for(const C of E)C.updateNeeded(v,w)&&g.prepareTile(C,v,w)},"raster-particle":function(m,a,h){const g=a.getSource();if(!(g instanceof Rt&&g.loaded()))return;const v=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;const w=m.paint.get("raster-particle-array-band")||g.getInitialBand(v);if(w==null)return;const E=a.getIds().map(C=>a.getTileByID(C));for(const C of E)C.updateNeeded(v,w)&&g.prepareTile(C,v,w)}};class ax{constructor(a,h,g,v){this.context=new ws(a,h),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=new Date().getTime(),this._averageFPS=0,this._fpsHistory=[],this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const E of w)this._debugParams.enabledLayers[E]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const E of w)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],E);this.setup(),this.numSublayers=Mo.maxUnderzooming+Mo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new l.d3,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new q1(this),this._wireframeDebugCache=new ox,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(a,h){const g=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new na(this,a));const v=this._terrain;this.transform.elevation=g?v:null,v.update(a,this.transform,h),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(a){const h=a.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,v]=h.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);const w=g+.78*(v-g);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(a,h){if(this.width=a*l.f.devicePixelRatio,this.height=h*l.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._mergedLayers[g].resize()}setup(){const a=this.context,h=new l.aQ;h.emplaceBack(0,0),h.emplaceBack(l.Y,0),h.emplaceBack(0,l.Y),h.emplaceBack(l.Y,l.Y),this.tileExtentBuffer=a.createVertexBuffer(h,l.aS.members),this.tileExtentSegments=l.aE.simpleSegment(0,0,4,2);const g=new l.aQ;g.emplaceBack(0,0),g.emplaceBack(l.Y,0),g.emplaceBack(0,l.Y),g.emplaceBack(l.Y,l.Y),this.debugBuffer=a.createVertexBuffer(g,l.aS.members),this.debugSegments=l.aE.simpleSegment(0,0,4,5);const v=new l.aQ;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(v,l.aS.members),this.viewportSegments=l.aE.simpleSegment(0,0,4,2);const w=new l.ay;w.emplaceBack(0,0,0,0),w.emplaceBack(l.Y,0,l.Y,0),w.emplaceBack(0,l.Y,0,l.Y),w.emplaceBack(l.Y,l.Y,l.Y,l.Y),this.mercatorBoundsBuffer=a.createVertexBuffer(w,l.aU.members),this.mercatorBoundsSegments=l.aE.simpleSegment(0,0,4,2);const E=new l.az;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(E);const C=new l.aR;for(const O of[0,1,3,2,0])C.emplaceBack(O);this.debugIndexBuffer=a.createIndexBuffer(C),this.emptyTexture=new l.T(a,new l.h({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=l.a9.create();const k=this.context.gl;this.stencilClearMode=new Dr({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,a.TRIANGLES,hr.disabled,this.stencilClearMode,$r.disabled,Cr.disabled,Mf(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,h,g){if(!h||this.currentStencilSource===h.id||!a.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const k of g)if(this._tileClippingMaskIDs[k.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=h.id;const v=this.context,w=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode($r.disabled),v.setDepthMode(hr.disabled);const E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of g){const k=h.getTile(C),O=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:B,tileBoundsSegments:$}=this.getTileBoundsBuffers(k);E.draw(this,w.TRIANGLES,hr.disabled,new Dr({func:w.ALWAYS,mask:0},O,255,w.KEEP,w.KEEP,w.REPLACE),$r.disabled,Cr.disabled,Mf(C.projMatrix),"$clipping",F,B,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,h=this.context.gl;return new Dr({func:h.NOTEQUAL,mask:255},a,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const h=this.context.gl;return new Dr({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(a){const h=this.context.gl,g=a.sort((E,C)=>C.overscaledZ-E.overscaledZ),v=g[g.length-1].overscaledZ,w=g[0].overscaledZ-v+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const E={};for(let C=0;C<w;C++)E[C+v]=new Dr({func:h.GEQUAL,mask:255},C+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=w,[E,g]}return[{[v]:Dr.disabled},g]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new $r([a.CONSTANT_COLOR,a.ONE,a.CONSTANT_COLOR,a.ONE],new l.aA(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?$r.unblended:$r.alphaBlended}colorModeForDrapableLayerRenderPass(a){const h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new $r([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new l.aA(0,0,0,a===void 0?0:a),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(a,h,g,v=!1){if(!this.opaquePassEnabledForLayer()&&!v)return hr.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new hr(g||this.context.gl.LEQUAL,h,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){const a=new Date().getTime(),h=a-this._timeStamp;this._timeStamp=a,this._fpsHistory.push(h===0?0:1e3/h),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((g,v)=>g+v/this._fpsHistory.length,0))}render(a,h){this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=a.map.repaint,this.style=a,this.options=h;const g=this.style._mergedLayers,v=this.style.order.filter(J=>{const ae=g[J];return!(ae.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ae.type]}),w=v.map(J=>g[J]),E=this.style._mergedSourceCaches;this.imageManager=a.imageManager,this.modelManager=a.modelManager,this.symbolFadeChange=a.placement.symbolFadeChange(l.f.now()),this.imageManager.beginFrame();let C=0,k=!1;for(const J in E){const ae=E[J];ae.used&&(ae.prepare(this.context),ae.getSource().usedInConflation&&++C)}for(const J of w)J.isHidden(this.transform.zoom)||this.prepareLayer(J);const O={},F={},B={},$={},G={};for(const J in E){const ae=E[J];O[J]=ae.getVisibleCoordinates(),F[J]=O[J].slice().reverse(),B[J]=ae.getVisibleCoordinates(!0).reverse(),$[J]=ae.getShadowCasterCoordinates(),G[J]=ae.sortCoordinatesByDistance(O[J])}const X=J=>{const ae=this.style.getLayerSourceCache(J);return ae&&ae.used?ae.getSource():null};if(C){const J=[];for(const ae of w)this.layerUsedInConflation(ae,X(ae))&&J.push(ae);if(J&&J.length>1){const ae=[];for(const ke of J){const Re=this.style.getLayerSourceCache(ke);Re&&Re.used&&Re.getSource().usedInConflation&&ae.push({layer:ke.fqid,cache:Re})}this.replacementSource.setSources(ae),k=!0}}k||this.replacementSource.clear(),this.conflationActive=k,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const J of w){const ae=J.cutoffRange();if(this.longestCutoffRange=Math.max(ae,this.longestCutoffRange),ae>0){const ke=X(J);ke&&(this.minCutoffZoom=Math.max(ke.minzoom,this.minCutoffZoom)),J.minzoom&&(this.minCutoffZoom=Math.max(J.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let J=0;J<w.length;J++)if(w[J].is3D()){this.opaquePassCutoff=J;break}const Z=this.style&&this.style.fog;Z?(this._fogVisible=Z.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Z.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(B),this.opaquePassCutoff=0);const Y=this._shadowRenderer;if(Y){Y.updateShadowParameters(this.transform,this.style.directionalLight);for(const J in E)for(const ae of O[J]){let ke={min:0,max:0};this.terrain&&(ke=this.terrain.getMinMaxForTile(ae)||ke),Y.addShadowReceiver(ae.toUnwrapped(),ke.min,ke.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new l.d4(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new O0(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!l.d5(this.context.gl))return;this.renderPass="offscreen";for(const J of w){const ae=a.getLayerSourceCache(J);if(!J.hasOffscreenPass()||J.isHidden(this.transform.zoom))continue;const ke=ae?F[ae.id]:void 0;(J.type==="custom"||J.type==="raster"||J.type==="raster-particle"||J.isSky()||ke&&ke.length)&&this.renderLayer(this,ae,J,ke)}this.depthRangeFor3D=[0,1-(w.length+2)*this.numSublayers*this.depthEpsilon];const K=this.terrain;K&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&K.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,$)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ne=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),fe=(()=>{if(h.showOverdrawInspector)return l.aA.black;if(this.style.fog&&this.transform.projection.supportsFog&&!ne){const J=this.style.fog.properties.get("color").toArray01();return new l.aA(...J)}if(this.style.fog&&this.transform.projection.supportsFog&&ne){const J=this.style.fog.properties.get("space-color").toArray01();return new l.aA(...J)}return l.aA.transparent})();if(this.context.clear({color:fe,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ne&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const J=w[this.currentLayer],ae=a.getLayerSourceCache(J);if(J.isSky())continue;const ke=ae?(J.is3D()?G:F)[ae.id]:void 0;this._renderTileClippingMasks(J,ae,ke),this.renderLayer(this,ae,J,ke)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ne&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||l.W(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const J=w[this.currentLayer],ae=a.getLayerSourceCache(J);J.isSky()&&this.renderLayer(this,ae,J,ae?F[ae.id]:void 0)}function de(J,ae){let ke;return ae&&(ke=(J.type==="symbol"?B:J.is3D()?G:F)[ae.id]),ke}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<v.length;){const J=w[this.currentLayer];if(J.type==="raster"){const ae=a.getLayerSourceCache(J);this.renderLayer(this,ae,J,de(J,ae))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ye=0;for(Y&&(ye=Y.getShadowCastingLayerCount());this.currentLayer<v.length;){const J=w[this.currentLayer],ae=a.getLayerSourceCache(J);if(J.isSky())++this.currentLayer;else if(K&&this.style.isLayerDraped(J)){if(J.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=K.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(J,ae,ae?O[ae.id]:void 0),this.renderLayer(this,ae,J,de(J,ae)),!K&&Y&&ye>0&&J.hasShadowPass()&&--ye==0&&(Y.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ke=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ke;this.currentLayer++){const Re=w[this.currentLayer];if(!Re.hasLightBeamPass())continue;const Ne=a.getLayerSourceCache(Re);this.renderLayer(this,Ne,Re,Ne?F[Ne.id]:void 0)}this.currentLayer=ke,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let J=null;w.forEach(ae=>{const ke=a.getLayerSourceCache(ae);ke&&!ae.isHidden(this.transform.zoom)&&ke.getVisibleCoordinates().length&&(!J||J.getSource().maxzoom<ke.getSource().maxzoom)&&(J=ke)}),J&&this.options.showTileBoundaries&&Qm.debug(this,J,J.getVisibleCoordinates(),l.aA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Qm.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new l.aA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(J){const ae=J.transform.padding;tx(J,J.transform.height-(ae.top||0),3,M0),tx(J,ae.bottom||0,3,e5),rx(J,ae.left||0,3,J1),rx(J,J.transform.width-(ae.right||0),3,ex);const ke=J.transform.centerPoint;(function(Re,Ne,et,ze){Hm(Re,Ne-1,et-10,2,20,ze),Hm(Re,Ne-10,et-1,20,2,ze)})(J,ke.x,J.transform.height-ke.y,k0)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),k||(this.conflationActive=!1)}prepareLayer(a){this.gpuTimingStart(a);const{unsupportedLayers:h}=this.transform.projection,g=!h||!h.includes(a.type);if(Uu[a.type]&&(g||this.terrain&&a.type==="custom")){const v=this.style.getLayerSourceCache(a);Uu[a.type](a,v,this)}this.gpuTimingEnd()}renderLayer(a,h,g,v){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),(!a.transform.projection.unsupportedLayers||!a.transform.projection.unsupportedLayers.includes(g.type)||a.terrain&&g.type==="custom")&&Qm[g.type](a,h,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery,g=this.context.gl;let v=this.gpuTimers[a.id];v||(v=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:g.createQuery()}),v.calls++,g.beginQuery(h.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,h=this.context.gl,g=h.createQuery();this.deferredRenderGpuTimeQueries.push(g),h.beginQuery(a.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const h={};for(const g in a){const v=a[g],w=this.context.extTimerQuery,E=w.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(v.query),h[g]=E}return h}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery,g=this.context.gl;let v=0;for(const w of a)v+=h.getQueryParameter(w,g.QUERY_RESULT)/1e6,h.deleteQueryEXT(w);return v}translatePosMatrix(a,h,g,v,w){if(!g[0]&&!g[1])return a;const E=w?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(E){const O=Math.sin(E),F=Math.cos(E);g=[g[0]*F-g[1]*O,g[0]*O+g[1]*F]}const C=[w?g[0]:l.a6(h,g[0],this.transform.zoom),w?g[1]:l.a6(h,g[1],this.transform.zoom),0],k=new Float32Array(16);return l.a9.translate(k,a,C),k}saveTileTexture(a){const h=a.size[0],g=this._tileTextures[h];g?g.push(a):this._tileTextures[h]=[a]}getTileTexture(a){const h=this._tileTextures[a];return h&&h.length>0?h.pop():null}isPatternMissing(a,h){return a===null||a!==void 0&&!this.imageManager.getPattern(a.toString(),h)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(a,h,g){const v=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,w=this.terrain&&this.terrain.exaggeration()===0,E=[];return this.style&&this.style.enable3dLights()&&(a==="globeRaster"||a==="terrainRaster"?(E.push("LIGHTING_3D_MODE"),E.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||E.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||E.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?E.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):E.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(E.push("TERRAIN"),this.linearFloatFilteringSupported()&&E.push("TERRAIN_DEM_FLOAT_FORMAT"),w&&E.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&E.push("GLOBE"),!this._fogVisible||v||h!==void 0&&!h||E.push("FOG","FOG_DITHERING"),v&&E.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&E.push("OVERDRAW_INSPECTOR"),E}getOrCreateProgram(a,h){this.cache=this.cache||{};const g=h&&h.defines||[],v=h&&h.config,w=this.currentGlobalDefines(a,h&&h.overrideFog,h&&h.overrideRtt).concat(g),E=Ca.cacheKey(Ka[a],a,w,v);return this.cache[E]||(this.cache[E]=new Ca(this.context,a,Ka[a],v,I0[a],w)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(a,h){if(this.style.enable3dLights()){const g=this.style.directionalLight,v=this.style.ambientLight;if(g&&v){const w=((E,C)=>{const k=E.properties.get("direction"),O=E.properties.get("color").toArray01(),F=E.properties.get("intensity"),B=C.properties.get("color").toArray01(),$=C.properties.get("intensity"),G=[k.x,k.y,k.z],X=l.cs(B,$),Z=l.cs(O,F);return{u_lighting_ambient_color:X,u_lighting_directional_dir:G,u_lighting_directional_color:Z,u_ground_radiance:Z1(G,Z,X)}})(g,v);h.setLightsUniformValues(a,w)}}}uploadCommonUniforms(a,h,g,v,w){if(this.uploadCommonLightUniforms(a,h),this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const C=E.getOpacity(this.transform.pitch),k=((O,F,B,$,G,X,Z,Y,K,ne,fe,de)=>{const ye=O.transform,J=F.properties.get("color").toArray01();J[3]=$;const ae=O.frameCounter/1e3%1,[ke,Re]=F.properties.get("vertical-range");return{u_fog_matrix:B?ye.calculateFogTileMatrix(B):de||O.identityMat,u_fog_range:F.getFovAdjustedRange(ye._fov),u_fog_color:J,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ke,Re),Re],u_fog_temporal_offset:ae,u_frustum_tl:G,u_frustum_tr:X,u_frustum_br:Z,u_frustum_bl:Y,u_globe_pos:K,u_globe_radius:ne,u_viewport:fe,u_globe_transition:l.W(ye.zoom),u_is_globe:+(ye.projection.name==="globe")}})(this,E,g,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*l.f.devicePixelRatio,this.transform.height*l.f.devicePixelRatio],v);h.setFogUniformValues(a,k)}w&&h.setCutoffUniformValues(a,w.uniformValues)}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,h=a.createTexture();return a.bindTexture(a.TEXTURE_2D,h),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const a=this._backgroundTiles,h=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const v of g)h[v.key]=a[v.key]||new Po(v,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(a,h){return!(!a.is3D()||a.minzoom&&a.minzoom>this.transform.zoom||a.sourceLayer!=="building"&&(!h||h.type!=="batched-model"))}isTileAffectedByFog(a){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[a.key];return h||(this._cachedTileFogOpacities[a.key]=h=this.style.fog.getOpacityForTile(a)),h[0]>=mr||h[1]>=mr}}function lx(m,a){let h=!1,g=null;const v=()=>{g=null,h&&(m(),g=setTimeout(v,a),h=!1)};return()=>(h=!0,g||v(),g)}class r5{constructor(a){this._hashName=a&&encodeURIComponent(a),l.a$(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=lx(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const h=cx(a);if(this._hashName){const g=this._hashName;let v=!1;const w=location.hash.slice(1).split("&").map(E=>{const C=E.split("=")[0];return C===g?(v=!0,`${C}=${h}`):E}).filter(E=>E);return v||w.push(`${g}=${h}`),`#${w.join("&")}`}return`#${h}`}_getCurrentHash(){const a=location.hash.replace("#","");if(this._hashName){let h;return a.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(h=g)}),(h&&h[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(g=>isNaN(g))){const g=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(h[3]||0):a.getBearing();return a.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:g,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function cx(m,a){const h=m.getCenter(),g=Math.round(100*m.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,v),E=Math.round(h.lng*w)/w,C=Math.round(h.lat*w)/w,k=m.getBearing(),O=m.getPitch();let F=a?`/${E}/${C}/${g}`:`${g}/${C}/${E}`;return(k||O)&&(F+="/"+Math.round(10*k)/10),O&&(F+=`/${Math.round(O)}`),F}const Gh={linearity:.3,easing:l.d6(0,0,.3,1)},F0=l.e({deceleration:2500,maxSpeed:1400},Gh),N0=l.e({deceleration:20,maxSpeed:1400},Gh),B0=l.e({deceleration:1e3,maxSpeed:360},Gh),ux=l.e({deceleration:1e3,maxSpeed:90},Gh);class hx{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.f.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,h=l.f.now();for(;a.length>0&&h-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)h.zoom+=w.zoomDelta||0,h.bearing+=w.bearingDelta||0,h.pitch+=w.pitchDelta||0,w.panDelta&&h.pan._add(w.panDelta),w.around&&(h.around=w.around),w.pinchAround&&(h.pinchAround=w.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){const w=Gc(h.pan.mag(),g,l.e({},F0,a||{}));v.offset=h.pan.mult(w.amount/h.pan.mag()),v.center=this._map.transform.center,Km(v,w)}if(h.zoom){const w=Gc(h.zoom,g,N0);v.zoom=this._map.transform.zoom+w.amount,Km(v,w)}if(h.bearing){const w=Gc(h.bearing,g,B0);v.bearing=this._map.transform.bearing+l.ad(w.amount,-179,179),Km(v,w)}if(h.pitch){const w=Gc(h.pitch,g,ux);v.pitch=this._map.transform.pitch+w.amount,Km(v,w)}if(v.zoom||v.bearing){const w=h.pinchAround===void 0?h.around:h.pinchAround;v.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Km(m,a){(!m.duration||m.duration<a.duration)&&(m.duration=a.duration,m.easing=a.easing)}function Gc(m,a,h){const{maxSpeed:g,linearity:v,deceleration:w}=h,E=l.ad(m*v/(a/1e3),-g,g),C=Math.abs(E)/(w*v);return{easing:h.easing,duration:1e3*C,amount:E*(C/2)}}class Us extends l.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,g,v={}){const w=$e(h.getCanvasContainer(),g),E=h.unproject(w);super(a,l.e({point:w,lngLat:E,originalEvent:g},v)),this._defaultPrevented=!1,this.target=h}}class $f extends l.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,g){const v=a==="touchend"?g.changedTouches:g.touches,w=ue(h.getCanvasContainer(),v),E=w.map(k=>h.unproject(k)),C=w.reduce((k,O,F,B)=>k.add(O.div(B.length)),new l.P(0,0));super(a,{points:w,point:C,lngLats:E,lngLat:h.unproject(C),originalEvent:g}),this._defaultPrevented=!1}}class oa extends l.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,g){super(a,{originalEvent:g}),this._defaultPrevented=!1}}class V0{constructor(a,h){this._map=a,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new oa(a.type,this._map,a))}mousedown(a,h){return this._mousedownPos=h,this._firePreventable(new Us(a.type,this._map,a))}mouseup(a){this._map.fire(new Us(a.type,this._map,a))}preclick(a){const h=l.e({},a);h.type="preclick",this._map.fire(new Us(h.type,this._map,h))}click(a,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Us(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Us(a.type,this._map,a))}mouseover(a){this._map.fire(new Us(a.type,this._map,a))}mouseout(a){this._map.fire(new Us(a.type,this._map,a))}touchstart(a){return this._firePreventable(new $f(a.type,this._map,a))}touchmove(a){this._map.fire(new $f(a.type,this._map,a))}touchend(a){this._map.fire(new $f(a.type,this._map,a))}touchcancel(a){this._map.fire(new $f(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Jm{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new Us(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Us("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Us(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class e_{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,h){this.isEnabled()&&a.shiftKey&&a.button===0&&(Me(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(a,h){if(!this._active)return;const g=h,v=this._startPos,w=this._lastPos;if(!v||!w||w.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=j("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const E=Math.min(v.x,g.x),C=Math.max(v.x,g.x),k=Math.min(v.y,g.y),O=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${k}px)`,this._box.style.width=C-E+"px",this._box.style.height=O-k+"px")})}mouseupWindow(a,h){if(!this._active)return;const g=this._startPos,v=h;if(g&&a.button===0){if(this.reset(),Ge(),g.x!==v.x||g.y!==v.y)return this._map.fire(new l.b("boxzoomend",{originalEvent:a})),{cameraAnimation:w=>w.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ie(),delete this._startPos,delete this._lastPos}_fireEvent(a,h){return this._map.fire(new l.b(a,{originalEvent:h}))}}function Gf(m,a){const h={};for(let g=0;g<m.length;g++)h[m[g].identifier]=a[g];return h}class U0{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,h,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){const w=new l.P(0,0);for(const E of v)w._add(E);return w.div(v.length)}(h),this.touches=Gf(g,h)))}touchmove(a,h,g){if(this.aborted||!this.centroid)return;const v=Gf(g,h);for(const w in this.touches){const E=v[w];(!E||E.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(a,h,g){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class qh{constructor(a){this.singleTap=new U0(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,h,g){this.singleTap.touchstart(a,h,g)}touchmove(a,h,g){this.singleTap.touchmove(a,h,g)}touchend(a,h,g){const v=this.singleTap.touchend(a,h,g);if(v){const w=a.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(v)<30;if(w&&E||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class j0{constructor(){this._zoomIn=new qh({numTouches:1,numTaps:2}),this._zoomOut=new qh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,h,g){this._zoomIn.touchstart(a,h,g),this._zoomOut.touchstart(a,h,g)}touchmove(a,h,g){this._zoomIn.touchmove(a,h,g),this._zoomOut.touchmove(a,h,g)}touchend(a,h,g){const v=this._zoomIn.touchend(a,h,g),w=this._zoomOut.touchend(a,h,g);return v?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(v)},{originalEvent:a})}):w?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(w)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const $0={0:1,2:2};class Hh{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,h){return!1}_move(a,h){return{}}mousedown(a,h){if(this._lastPoint)return;const g=pe(a);this._correctButton(a,g)&&(this._lastPoint=h,this._eventButton=g)}mousemoveWindow(a,h){const g=this._lastPoint;if(g){if(a.preventDefault(),this._eventButton!=null&&function(v,w){const E=$0[w];return v.buttons===void 0||(v.buttons&E)!==E}(a,this._eventButton))this.reset();else if(this._moved||!(h.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(g,h)}}mouseupWindow(a){this._lastPoint&&pe(a)===this._eventButton&&(this._moved&&Ge(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dx extends Hh{mousedown(a,h){super.mousedown(a,h),this._lastPoint&&(this._active=!0)}_correctButton(a,h){return h===0&&!a.ctrlKey}_move(a,h){return{around:h,panDelta:h.sub(a)}}}class G0 extends Hh{_correctButton(a,h){return h===0&&a.ctrlKey||h===2}_move(a,h){const g=.8*(h.x-a.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(a){a.preventDefault()}}class ju extends Hh{_correctButton(a,h){return h===0&&a.ctrlKey||h===2}_move(a,h){const g=-.5*(h.y-a.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(a){a.preventDefault()}}class i5{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),l.a$(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}touchstart(a,h,g){return this._calculateTransform(a,h,g)}touchmove(a,h,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!l.d7())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,h,g)}}touchend(a,h,g){this._calculateTransform(a,h,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,h,g){g.length>0&&(this._active=!0);const v=Gf(g,h),w=new l.P(0,0),E=new l.P(0,0);let C=0;for(const O in v){const F=v[O],B=this._touches[O];B&&(w._add(F),E._add(F.sub(B)),C++,v[O]=F)}if(this._touches=v,C<this._minTouches||!E.mag())return;const k=E.div(C);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(C),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=j("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class q0{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,h,g){return{}}touchstart(a,h,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([h[0],h[1]]))}touchmove(a,h,g){const v=this._firstTwoTouches;if(!v)return;a.preventDefault();const[w,E]=v,C=t_(g,h,w),k=t_(g,h,E);if(!C||!k)return;const O=this._aroundCenter?null:C.add(k).div(2);return this._move([C,k],O,a)}touchend(a,h,g){if(!this._firstTwoTouches)return;const[v,w]=this._firstTwoTouches,E=t_(g,h,v),C=t_(g,h,w);E&&C||(this._active&&Ge(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function t_(m,a,h){for(let g=0;g<m.length;g++)if(m[g].identifier===h)return a[g]}function fx(m,a){return Math.log(m/a)/Math.LN2}class n5 extends q0{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,h){const g=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(fx(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fx(this._distance,g),pinchAround:h}}}function px(m,a){return 180*m.angleWith(a)/Math.PI}class H0 extends q0{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,h){const g=this._vector;if(this._vector=a[0].sub(a[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:px(this._vector,g),pinchAround:h}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const h=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const v=px(a,g);return Math.abs(v)<h}}function qf(m){return Math.abs(m.y)>Math.abs(m.x)}class mx extends q0{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,qf(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,h,g){const v=this._lastPoints;if(!v)return;const w=a[0].sub(v[0]),E=a[1].sub(v[1]);return this._map._cooperativeGestures&&!l.d7()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(w,E,g.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(w.y+E.y)/2*-.5})}gestureBeginsVertically(a,h,g){if(this._valid!==void 0)return this._valid;const v=a.mag()>=2,w=h.mag()>=2;if(!v&&!w)return;if(!v||!w)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const E=a.y>0==h.y>0;return qf(a)&&qf(h)&&E}}const Wh={panStep:100,bearingStep:15,pitchStep:10};class _x{constructor(){const a=Wh;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let h=0,g=0,v=0,w=0,E=0;switch(a.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:a.shiftKey?g=-1:(a.preventDefault(),w=-1);break;case 39:a.shiftKey?g=1:(a.preventDefault(),w=1);break;case 38:a.shiftKey?v=1:(a.preventDefault(),E=-1);break;case 40:a.shiftKey?v=-1:(a.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:C=>{const k=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:gx,zoom:h?Math.round(k)+h*(a.shiftKey?2:1):k,bearing:C.getBearing()+g*this._bearingStep,pitch:C.getPitch()+v*this._pitchStep,offset:[-w*this._panStep,-E*this._panStep],center:C.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function gx(m){return m*(2-m)}const W0=4.000244140625,Z0=1/450;class $u{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Z0,l.a$(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||l.d7()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const g=l.f.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,h!==0&&h%W0==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),a.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=a,this._delta-=h,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=$e(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;this._type==="wheel"&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>W0?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&F!==0&&(F=1/F);const B=h(),$=Math.pow(2,B),G=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):$;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(G*F))),this._type==="wheel"&&(this._startZoom=B,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:h(),v=this._startZoom,w=this._easing;let E,C=!1;if(this._type==="wheel"&&v&&w){const O=Math.min((l.f.now()-this._lastWheelEventTime)/200,1),F=w(O);E=l.X(v,g,F),O<1?this._frameId||(this._frameId=!0):C=!0}else E=g,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let k=E-h();return k*this._lastDelta<0&&(k=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:k,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let h=l.d8;if(this._prevEase){const g=this._prevEase,v=(l.f.now()-g.start)/g.duration,w=g.easing(v+.01)-g.easing(v),E=.27/Math.sqrt(w*w+1e-4)*.01,C=Math.sqrt(.0729-E*E);h=l.d6(E,C,.25,1)}return this._prevEase={start:l.f.now(),duration:a,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=j("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class yx{constructor(a,h){this._clickZoom=a,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Gu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,h){return a.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(a.shiftKey?-1:1),around:g.unproject(h)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vx{constructor(){this._tap=new qh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,h,g){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=h[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(a,h,g))}touchmove(a,h,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=h[0],w=v.y-this._swipePoint.y;return this._swipePoint=v,a.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(a,h,g)}touchend(a,h,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(a,h,g)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class r_{constructor(a,h,g){this._el=a,this._mousePan=h,this._touchPan=g}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class xx{constructor(a,h,g){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=h,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class bx{constructor(a,h,g,v){this._el=a,this._touchZoom=h,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Zh=m=>m.zoom||m.drag||m.pitch||m.rotate;class X0 extends l.b{}class s5{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,h){const g=l.Q.sub([],h,a);this.radius=l.Q.length(g[2]<0?l.Q.div([],g,this.constants):[g[0],g[1],0])}projectRay(a){l.Q.div(a,a,this.constants),l.Q.normalize(a,a),l.Q.mul(a,a,this.constants);const h=l.Q.scale([],a,this.radius);if(h[2]>0){const g=l.Q.scale([],[0,0,1],l.Q.dot(h,[0,0,1])),v=l.Q.scale([],l.Q.normalize([],[h[0],h[1],0]),this.radius),w=l.Q.add([],h,l.Q.scale([],l.Q.sub([],l.Q.add([],v,g),h),2));h[0]=w[0],h[1]=w[1]}return h}}function Hf(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Wf{constructor(a,h){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hx(a),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new s5,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),l.a$(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,w,E]of this._listeners){const C=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(w,C,E)}}destroy(){for(const[a,h,g]of this._listeners){const v=a===document?this.handleWindowEvent:this.handleEvent;a.removeEventListener(h,v,g)}}_addDefaultHandlers(a){const h=this._map,g=h.getCanvasContainer();this._add("mapEvent",new V0(h,a));const v=h.boxZoom=new e_(h,a);this._add("boxZoom",v);const w=new j0,E=new Gu;h.doubleClickZoom=new yx(E,w),this._add("tapZoom",w),this._add("clickZoom",E);const C=new vx;this._add("tapDragZoom",C);const k=h.touchPitch=new mx(h);this._add("touchPitch",k);const O=new G0(a),F=new ju(a);h.dragRotate=new xx(a,O,F),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const B=new dx(a),$=new i5(h,a);h.dragPan=new r_(g,B,$),this._add("mousePan",B),this._add("touchPan",$,["touchZoom","touchRotate"]);const G=new H0,X=new n5;h.touchZoomRotate=new bx(g,X,G,C),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Jm(h));const Z=h.scrollZoom=new $u(h,this);this._add("scrollZoom",Z,["mousePan"]);const Y=h.keyboard=new _x;this._add("keyboard",Y);for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[K]&&h[K].enable(a[K])}_add(a,h,g){this._handlers.push({handlerName:a,handler:h,allowed:g}),this._handlersById[a]=h}stop(a){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Zh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,h,g){for(const v in a)if(v!==g&&(!h||h.indexOf(v)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const h=[];for(const g of a)this._el.contains(g.target)&&h.push(g);return h}handleEvent(a,h){this._updatingCamera=!0;const g=a.type==="renderFrame",v=g?void 0:a,w={needsRenderFrame:!1},E={},C={},k=a.touches?this._getMapTouches(a.touches):void 0,O=k?ue(this._el,k):g?void 0:$e(this._el,a);for(const{handlerName:$,handler:G,allowed:X}of this._handlers){if(!G.isEnabled())continue;let Z;this._blockedByActive(C,X,$)?G.reset():G[h||a.type]&&(Z=G[h||a.type](a,O,k),this.mergeHandlerResult(w,E,Z,$,v),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||G.isActive())&&(C[$]=G)}const F={};for(const $ in this._previousActiveHandlers)C[$]||(F[$]=v);this._previousActiveHandlers=C,(Object.keys(F).length||Hf(w))&&(this._changes.push([w,E,F]),this._triggerRenderFrame()),(Object.keys(C).length||Hf(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=w;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(a,h,g,v,w){if(!g)return;l.e(a,g);const E={handlerName:v,originalEvent:g.originalEvent||w};g.zoomDelta!==void 0&&(h.zoom=E),g.panDelta!==void 0&&(h.drag=E),g.pitchDelta!==void 0&&(h.pitch=E),g.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){const a={},h={},g={};for(const[v,w,E]of this._changes)v.panDelta&&(a.panDelta=(a.panDelta||new l.P(0,0))._add(v.panDelta)),v.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(a.around=v.around),v.aroundCoord!==void 0&&(a.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(a.pinchAround=v.pinchAround),v.noInertia&&(a.noInertia=v.noInertia),l.e(h,w),l.e(g,E);this._updateMapTransform(a,h,g),this._changes=[]}_updateMapTransform(a,h,g){const v=this._map,w=v.transform,E=ne=>[ne.x,ne.y,ne.z];if((ne=>{const fe=this._eventsInProgress.drag;return fe&&!this._handlersById[fe.handlerName].isActive()})()&&!Hf(a)){const ne=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),ne!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&v._stop(!0),!Hf(a))return void this._fireEvents(h,g,!0);let{panDelta:C,zoomDelta:k,bearingDelta:O,pitchDelta:F,around:B,aroundCoord:$,pinchAround:G}=a;w._isCameraConstrained&&(k>0&&(k=0),w._isCameraConstrained=!1),G!==void 0&&(B=G),(k||(ne=>h[ne]&&!this._eventsInProgress[ne])("drag"))&&B&&(this._dragOrigin=E(w.pointCoordinate3D(B)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",v._stop(!0),B=B||v.transform.centerPoint,O&&(w.bearing+=O),F&&(w.pitch+=F),w._updateCameraState();const X=[0,0,0];if(C)if(w.projection.name==="mercator"){const ne=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(B).dir),fe=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(B.sub(C)).dir);X[0]=fe[0]-ne[0],X[1]=fe[1]-ne[1]}else{const ne=w.pointCoordinate(B);if(w.projection.name==="globe"){C=C.rotate(-w.angle);const fe=w._pixelsPerMercatorPixel/w.worldSize;X[0]=-C.x*l.d9(l.ax(ne.y))*fe,X[1]=-C.y*l.d9(w.center.lat)*fe}else{const fe=w.pointCoordinate(B.sub(C));ne&&fe&&(X[0]=fe.x-ne.x,X[1]=fe.y-ne.y)}}const Z=w.zoom,Y=[0,0,0];if(k){const ne=E($||w.pointCoordinate3D(B)),fe={dir:l.Q.normalize([],l.Q.sub([],ne,w._camera.position))};if(fe.dir[2]<0){const de=w.zoomDeltaToMovement(ne,k);l.Q.scale(Y,fe.dir,de)}}const K=l.Q.add(X,X,Y);w._translateCameraConstrained(K),k&&Math.abs(w.zoom-Z)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(h,g,!0)}_fireEvents(a,h,g){const v=Zh(this._eventsInProgress),w=Zh(a),E={};for(const F in a){const{originalEvent:B}=a[F];this._eventsInProgress[F]||(E[`${F}start`]=B),this._eventsInProgress[F]=a[F]}!v&&w&&this._fireEvent("movestart",w.originalEvent);for(const F in E)this._fireEvent(F,E[F]);w&&this._fireEvent("move",w.originalEvent);for(const F in a){const{originalEvent:B}=a[F];this._fireEvent(F,B)}const C={};let k;for(const F in this._eventsInProgress){const{handlerName:B,originalEvent:$}=this._eventsInProgress[F];this._handlersById[B].isActive()||(delete this._eventsInProgress[F],k=h[B]||$,C[`${F}end`]=k)}for(const F in C)this._fireEvent(F,C[F]);const O=Zh(this._eventsInProgress);if(g&&(v||w)&&!O){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;F?(B(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:k})):(this._map.fire(new l.b("moveend",{originalEvent:k})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,h){this._map.fire(new l.b(a,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new X0("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const wx="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class o5 extends l.E{constructor(a,h){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,l.a$(["_renderFrameCallback"],this)}getCenter(){return new l.bq(this.transform.center.lng,this.transform.center.lat)}setCenter(a,h){return this.jumpTo({center:a},h)}panBy(a,h,g){return a=l.P.convert(a).mult(-1),this.panTo(this.transform.center,l.e({offset:a},h),g)}panTo(a,h,g){return this.easeTo(l.e({center:a},h),g)}getZoom(){return this.transform.zoom}setZoom(a,h){return this.jumpTo({zoom:a},h),this}zoomTo(a,h,g){return this.easeTo(l.e({zoom:a},h),g)}zoomIn(a,h){return this.zoomTo(this.getZoom()+1,a,h),this}zoomOut(a,h){return this.zoomTo(this.getZoom()-1,a,h),this}getBearing(){return this.transform.bearing}setBearing(a,h){return this.jumpTo({bearing:a},h),this}getPadding(){return this.transform.padding}setPadding(a,h){return this.jumpTo({padding:a},h),this}rotateTo(a,h,g){return this.easeTo(l.e({bearing:a},h),g)}resetNorth(a,h){return this.rotateTo(0,l.e({duration:1e3},a),h),this}resetNorthPitch(a,h){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},a),h),this}snapToNorth(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this}getPitch(){return this.transform.pitch}setPitch(a,h){return this.jumpTo({pitch:a},h),this}cameraForBounds(a,h){a=l.ag.convert(a);const g=h&&h.bearing||0,v=h&&h.pitch||0,w=a.getNorthWest(),E=a.getSouthEast();return this._cameraForBounds(this.transform,w,E,g,v,h)}_extendPadding(a){const h={top:0,right:0,bottom:0,left:0};return a==null?l.e({},h,this.transform.padding):typeof a=="number"?{top:a,bottom:a,right:a,left:a}:l.e({},h,a)}_extendCameraOptions(a){return(a=l.e({offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=this._extendPadding(a.padding),a}_minimumAABBFrustumDistance(a,h){const g=h.max[0]-h.min[0],v=h.max[1]-h.min[1];return g/v>a.aspect?g/(2*Math.tan(.5*a.fovX)*a.aspect):v/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,h,g,v,w,E){const C=a.clone(),k=this._extendCameraOptions(E);C.bearing=v,C.pitch=w;const O=l.bq.convert(h),F=l.bq.convert(g),B=.5*(O.lat+F.lat),$=.5*(O.lng+F.lng),G=l.da(B,$),X=l.Q.normalize([],G),Z=l.Q.normalize([],l.Q.cross([],X,[0,1,0])),Y=l.Q.cross([],Z,X),K=[Z[0],Z[1],Z[2],0,Y[0],Y[1],Y[2],0,X[0],X[1],X[2],0,0,0,0,1],ne=[G,l.da(O.lat,O.lng),l.da(F.lat,O.lng),l.da(F.lat,F.lng),l.da(O.lat,F.lng),l.da(B,O.lng),l.da(B,F.lng),l.da(O.lat,$),l.da(F.lat,$)];let fe=l.bV.fromPoints(ne.map(rt=>[l.Q.dot(Z,rt),l.Q.dot(Y,rt),l.Q.dot(X,rt)]));const de=l.Q.transformMat4([],fe.center,K);l.Q.squaredLength(de)===0&&l.Q.set(de,0,0,1),l.Q.normalize(de,de),l.Q.scale(de,de,l.ae),C.center=l.db(de);const ye=C.getWorldToCameraMatrix(),J=l.a9.invert(new Float64Array(16),ye);fe=l.bV.applyTransform(fe,l.a9.multiply([],ye,K));const ae=this._extendAABB(fe,C,k,v);if(!ae)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=ae,l.Q.transformMat4(de,de,ye);const ke=.5*(fe.max[2]-fe.min[2]),Re=this._minimumAABBFrustumDistance(C,fe),Ne=l.Q.scale([],[0,0,1],ke),et=l.Q.add(Ne,de,Ne),ze=Re+(C.pitch===0?0:l.Q.distance(de,et)),Qe=C.globeCenterInViewSpace,it=l.Q.sub([],de,[Qe[0],Qe[1],Qe[2]]);l.Q.normalize(it,it),l.Q.scale(it,it,ze);const Oe=l.Q.add([],de,it);l.Q.transformMat4(Oe,Oe,J);const He=l.dc/l.ae,Tt=l.Q.length(Oe),Ue=l.bo(Math.max(Tt*He-l.dc,Number.EPSILON),0),Je=Math.min(C.zoomFromMercatorZAdjusted(Ue),k.maxZoom);return Je>.5*(l.bJ+l.bA)?(C.setProjection({name:"mercator"}),C.zoom=Je,this._cameraForBounds(C,h,g,v,w,E)):{center:C.center,zoom:Je,bearing:v,pitch:w}}_extendAABB(a,h,g,v){const w=.5*((g.padding.left||0)+(g.padding.right||0)),E=.5*((g.padding.top||0)+(g.padding.bottom||0)),C=E,k=w,O=w,F=E,B=h.width-(k+O),$=h.height-(C+F),G=l.Q.sub([],a.max,a.min),X=Math.min(B/G[0],$/G[1]),Z=Math.min(h.scaleZoom(h.scale*X),g.maxZoom);if(isNaN(Z))return null;const Y=h.scale/h.zoomScale(Z),K=new l.bV([a.min[0]-k*Y,a.min[1]-F*Y,a.min[2]],[a.max[0]+O*Y,a.max[1]+C*Y,a.max[2]]),ne=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new l.P(g.offset.x,g.offset.y):l.P.convert(g.offset)).rotate(-l.bm(v));return K.center[0]-=ne.x*Y,K.center[1]+=ne.y*Y,K}queryTerrainElevation(a,h){const g=this.transform.elevation;return g?(h=l.e({},{exaggerated:!0},h),g.getAtPoint(l.O.fromLngLat(a),null,h.exaggerated)):null}_cameraForBounds(a,h,g,v,w,E){if(a.projection.name==="globe")return this._cameraForBoundsOnGlobe(a,h,g,v,w,E);const C=a.clone(),k=this._extendCameraOptions(E);C.bearing=v,C.pitch=w;const O=l.bq.convert(h),F=l.bq.convert(g),B=new l.bq(O.lng,F.lat),$=new l.bq(F.lng,O.lat),G=C.project(O),X=C.project(F),Z=this.queryTerrainElevation(O),Y=this.queryTerrainElevation(F),K=this.queryTerrainElevation(B),ne=this.queryTerrainElevation($),fe=[[G.x,G.y,Math.min(Z||0,Y||0,K||0,ne||0)],[X.x,X.y,Math.max(Z||0,Y||0,K||0,ne||0)]];let de=l.bV.fromPoints(fe);const ye=C.getWorldToCameraMatrix(),J=l.a9.invert(new Float64Array(16),ye);de=l.bV.applyTransform(de,ye);const ae=this._extendAABB(de,C,k,v);if(!ae)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");de=ae;const ke=.5*l.Q.sub([],de.max,de.min)[2],Re=this._minimumAABBFrustumDistance(C,de),Ne=[0,0,1,0];l.aa.transformMat4(Ne,Ne,ye),l.aa.normalize(Ne,Ne);const et=l.Q.scale([],Ne,Re+ke),ze=l.Q.add([],de.center,et);l.Q.transformMat4(de.center,de.center,J),l.Q.transformMat4(ze,ze,J);const Qe=[de.center[0],de.center[1],ze[2]*C.pixelsPerMeter];l.Q.scale(Qe,Qe,1/C.worldSize);const it=l.aw(Qe[0]),Oe=l.ax(Qe[1]),He=Math.min(C._zoomFromMercatorZ(Qe[2]),k.maxZoom),Tt=new l.bq(it,Oe);return C.mercatorFromTransition&&He<.5*(l.bJ+l.bA)?(C.setProjection({name:"globe"}),C.zoom=He,this._cameraForBounds(C,h,g,v,w,E)):{center:Tt,zoom:He,bearing:v,pitch:w}}fitBounds(a,h,g){const v=this.cameraForBounds(a,h);return this._fitInternal(v,h,g)}fitScreenCoordinates(a,h,g,v,w){const E=l.P.convert(a),C=l.P.convert(h),k=new l.P(Math.min(E.x,C.x),Math.min(E.y,C.y)),O=new l.P(Math.max(E.x,C.x),Math.max(E.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,C))return this;const F=this.transform.pointLocation3D(k),B=this.transform.pointLocation3D(O),$=this.transform.pointLocation3D(new l.P(k.x,O.y)),G=this.transform.pointLocation3D(new l.P(O.x,k.y)),X=[Math.min(F.lng,B.lng,$.lng,G.lng),Math.min(F.lat,B.lat,$.lat,G.lat)],Z=[Math.max(F.lng,B.lng,$.lng,G.lng),Math.max(F.lat,B.lat,$.lat,G.lat)],Y=v&&v.pitch?v.pitch:this.getPitch(),K=this._cameraForBounds(this.transform,X,Z,g,Y,v);return this._fitInternal(K,v,w)}_fitInternal(a,h,g){return a?(h=l.e(a,h)).linear?this.easeTo(h,g):this.flyTo(h,g):this}jumpTo(a,h){this.stop();const g=a.preloadOnly?this.transform.clone():this.transform;let v=!1,w=!1,E=!1;return"zoom"in a&&g.zoom!==+a.zoom&&(v=!0,g.zoom=+a.zoom),a.center!==void 0&&(g.center=l.bq.convert(a.center)),"bearing"in a&&g.bearing!==+a.bearing&&(w=!0,g.bearing=+a.bearing),"pitch"in a&&g.pitch!==+a.pitch&&(E=!0,g.pitch=+a.pitch),a.padding==null||g.isPaddingEqual(a.padding)||(g.padding=a.padding),a.preloadOnly?(this._preloadTiles(g),this):(this.fire(new l.b("movestart",h)).fire(new l.b("move",h)),v&&this.fire(new l.b("zoomstart",h)).fire(new l.b("zoom",h)).fire(new l.b("zoomend",h)),w&&this.fire(new l.b("rotatestart",h)).fire(new l.b("rotate",h)).fire(new l.b("rotateend",h)),E&&this.fire(new l.b("pitchstart",h)).fire(new l.b("pitch",h)).fire(new l.b("pitchend",h)),this.fire(new l.b("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||l.w(wx),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,h){const g=this.transform;if(!g.projection.supportsFreeCamera)return l.w(wx),this;this.stop();const v=g.zoom,w=g.pitch,E=g.bearing;g.setFreeCameraOptions(a);const C=v!==g.zoom,k=w!==g.pitch,O=E!==g.bearing;return this.fire(new l.b("movestart",h)).fire(new l.b("move",h)),C&&this.fire(new l.b("zoomstart",h)).fire(new l.b("zoom",h)).fire(new l.b("zoomend",h)),O&&this.fire(new l.b("rotatestart",h)).fire(new l.b("rotate",h)).fire(new l.b("rotateend",h)),k&&this.fire(new l.b("pitchstart",h)).fire(new l.b("pitch",h)).fire(new l.b("pitchend",h)),this.fire(new l.b("moveend",h)),this}easeTo(a,h){this._stop(!1,a.easeId),((a=l.e({offset:[0,0],duration:500,easing:l.d8},a)).animate===!1||this._prefersReducedMotion(a))&&(a.duration=0);const g=this.transform,v=this.getZoom(),w=this.getBearing(),E=this.getPitch(),C=this.getPadding(),k="zoom"in a?+a.zoom:v,O="bearing"in a?this._normalizeBearing(a.bearing,w):w,F="pitch"in a?+a.pitch:E,B=this._extendPadding(a.padding),$=l.P.convert(a.offset);let G,X,Z;if(g.projection.name==="globe"){const Re=l.O.fromLngLat(g.center),Ne=$.rotate(-g.angle);Re.x+=Ne.x/g.worldSize,Re.y+=Ne.y/g.worldSize;const et=Re.toLngLat(),ze=l.bq.convert(a.center||et);this._normalizeCenter(ze),G=g.centerPoint.add(Ne),X=new l.P(Re.x,Re.y).mult(g.worldSize),Z=new l.P(l.a8(ze.lng),l.ah(ze.lat)).mult(g.worldSize).sub(X)}else{G=g.centerPoint.add($);const Re=g.pointLocation(G),Ne=l.bq.convert(a.center||Re);this._normalizeCenter(Ne),X=g.project(Re),Z=g.project(Ne).sub(X)}const Y=g.zoomScale(k-v);let K,ne;a.around&&(K=l.bq.convert(a.around),ne=g.locationPoint(K));const fe=this._zooming||k!==v,de=this._rotating||w!==O,ye=this._pitching||F!==E,J=!g.isPaddingEqual(B),ae=Re=>Ne=>{if(fe&&(Re.zoom=l.X(v,k,Ne)),de&&(Re.bearing=l.X(w,O,Ne)),ye&&(Re.pitch=l.X(E,F,Ne)),J&&(Re.interpolatePadding(C,B,Ne),G=Re.centerPoint.add($)),K)Re.setLocationAtPoint(K,ne);else{const et=Re.zoomScale(Re.zoom-v),ze=k>v?Math.min(2,Y):Math.max(.5,Y),Qe=Math.pow(ze,1-Ne),it=Re.unproject(X.add(Z.mult(Ne*Qe)).mult(et));Re.setLocationAtPoint(Re.renderWorldCopies?it.wrap():it,G)}return a.preloadOnly||this._fireMoveEvents(h),Re};if(a.preloadOnly){const Re=this._emulate(ae,a.duration,g);return this._preloadTiles(Re),this}const ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=fe,this._rotating=de,this._pitching=ye,this._padding=J,this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,ke),this._ease(ae(g),Re=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(h,Re)},a),this}_prepareEase(a,h,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||g.moving||this.fire(new l.b("movestart",a)),this._zooming&&!g.zooming&&this.fire(new l.b("zoomstart",a)),this._rotating&&!g.rotating&&this.fire(new l.b("rotatestart",a)),this._pitching&&!g.pitching&&this.fire(new l.b("pitchstart",a))}_fireMoveEvents(a){this.fire(new l.b("move",a)),this._zooming&&this.fire(new l.b("zoom",a)),this._rotating&&this.fire(new l.b("rotate",a)),this._pitching&&this.fire(new l.b("pitch",a))}_afterEase(a,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,v=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new l.b("zoomend",a)),v&&this.fire(new l.b("rotateend",a)),w&&this.fire(new l.b("pitchend",a)),this.fire(new l.b("moveend",a))}flyTo(a,h){if(this._prefersReducedMotion(a)){const Je=l.af(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Je,h)}this.stop(),a=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.d8},a);const g=this.transform,v=this.getZoom(),w=this.getBearing(),E=this.getPitch(),C=this.getPadding(),k="zoom"in a?l.ad(+a.zoom,g.minZoom,g.maxZoom):v,O="bearing"in a?this._normalizeBearing(a.bearing,w):w,F="pitch"in a?+a.pitch:E,B=this._extendPadding(a.padding),$=g.zoomScale(k-v),G=l.P.convert(a.offset);let X=g.centerPoint.add(G);const Z=g.pointLocation(X),Y=l.bq.convert(a.center||Z);this._normalizeCenter(Y);const K=g.project(Z),ne=g.project(Y).sub(K);let fe=a.curve;const de=Math.max(g.width,g.height),ye=de/$,J=ne.mag();if("minZoom"in a){const Je=l.ad(Math.min(a.minZoom,v,k),g.minZoom,g.maxZoom),rt=de/g.zoomScale(Je-v);fe=Math.sqrt(rt/J*2)}const ae=fe*fe;function ke(Je){const rt=(ye*ye-de*de+(Je?-1:1)*ae*ae*J*J)/(2*(Je?ye:de)*ae*J);return Math.log(Math.sqrt(rt*rt+1)-rt)}function Re(Je){return(Math.exp(Je)-Math.exp(-Je))/2}function Ne(Je){return(Math.exp(Je)+Math.exp(-Je))/2}const et=ke(0);let ze=function(Je){return Ne(et)/Ne(et+fe*Je)},Qe=function(Je){return de*((Ne(et)*(Re(rt=et+fe*Je)/Ne(rt))-Re(et))/ae)/J;var rt},it=(ke(1)-et)/fe;if(Math.abs(J)<1e-6||!isFinite(it)){if(Math.abs(de-ye)<1e-6)return this.easeTo(a,h);const Je=ye<de?-1:1;it=Math.abs(Math.log(ye/de))/fe,Qe=function(){return 0},ze=function(rt){return Math.exp(Je*fe*rt)}}a.duration="duration"in a?+a.duration:1e3*it/("screenSpeed"in a?+a.screenSpeed/fe:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const Oe=w!==O,He=F!==E,Tt=!g.isPaddingEqual(B),Ue=Je=>rt=>{const me=rt*it,vt=1/ze(me);Je.zoom=rt===1?k:v+Je.scaleZoom(vt),Oe&&(Je.bearing=l.X(w,O,rt)),He&&(Je.pitch=l.X(E,F,rt)),Tt&&(Je.interpolatePadding(C,B,rt),X=Je.centerPoint.add(G));const Zt=rt===1?Y:Je.unproject(K.add(ne.mult(Qe(me))).mult(vt));return Je.setLocationAtPoint(Je.renderWorldCopies?Zt.wrap():Zt,X),Je._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(h),Je};if(a.preloadOnly){const Je=this._emulate(Ue,a.duration,g);return this._preloadTiles(Je),this}return this._zooming=!0,this._rotating=Oe,this._pitching=He,this._padding=Tt,this._prepareEase(h,!1),this._ease(Ue(g),()=>this._afterEase(h),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(a){}_cancelRenderFrame(a){}_stop(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,h)}if(!a){const g=this.handlers;g&&g.stop(!1)}return this}_ease(a,h,g){g.animate===!1||g.duration===0?(a(1),h()):(this._easeStart=l.f.now(),this._easeOptions=g,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((l.f.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,h){a=l.bk(a,-180,180);const g=Math.abs(a-h);return Math.abs(a-360-h)<g&&(a-=360),Math.abs(a+360-h)<g&&(a+=360),a}_normalizeCenter(a){const h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;const g=a.lng-h.center.lng;a.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&l.f.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,h,g){const v=Math.ceil(15*h/1e3),w=[],E=a(g.clone());for(let C=0;C<=v;C++){const k=E(C/v);w.push(k.clone())}return w}_preloadTiles(a,h){}}class Y0{constructor(a={}){this.options=a,l.a$(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const h=this.options&&this.options.compact;return this._map=a,this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=j("button","mapboxgl-ctrl-attrib-button",this._container),j("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=j("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,h){const g=this._map._getUIString(`AttributionControl.${h}`);a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||l.dd.ACCESS_TOKEN}];if(a){const g=h.reduce((v,w,E)=>(w.value&&(v+=`${w.key}=${w.value}${E<h.length-1?"&":""}`),v),"?");a.href=`${l.dd.FEEDBACK_URL}/${g}#${cx(this._map,!0)}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const h=this._map.style._mergedSourceCaches;for(const v in h){const w=h[v];if(w.used){const E=w.getSource();E.attribution&&a.indexOf(E.attribution)<0&&a.push(E.attribution)}}a.sort((v,w)=>v.length-w.length),a=a.filter((v,w)=>{for(let E=w+1;E<a.length;E++)if(a[E].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const g=a.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,a.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Tx{constructor(){l.a$(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=j("div","mapboxgl-ctrl");const h=j("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(const h in a){const g=a[h].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const h=a[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class i_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const h=++this._id;return this._queue.push({callback:a,id:h,cancelled:!1}),h}remove(a){const h=this._currentlyRunning,g=h?this._queue.concat(h):this._queue;for(const v of g)if(v.id===a)return void(v.cancelled=!0)}run(a=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const g of h)if(!g.cancelled&&(g.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function n_(m,a,h){if(m=new l.bq(m.lng,m.lat),a){const g=new l.bq(m.lng-360,m.lat),v=new l.bq(m.lng+360,m.lat),w=360*Math.ceil(Math.abs(m.lng-h.center.lng)/360),E=h.locationPoint(m).distSqr(a),C=a.x<0||a.y<0||a.x>h.width||a.y>h.height;h.locationPoint(g).distSqr(a)<E&&(C||Math.abs(g.lng-h.center.lng)<w)?m=g:h.locationPoint(v).distSqr(a)<E&&(C||Math.abs(v.lng-h.center.lng)<w)&&(m=v)}for(;Math.abs(m.lng-h.center.lng)>180;){const g=h.locationPoint(m);if(g.x>=0&&g.y>=0&&g.x<=h.width&&g.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m}const Xh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Zf extends l.E{constructor(a,h){if(super(),(a instanceof HTMLElement||h)&&(a=l.e({element:a},h)),l.a$(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=a&&a.occludedOpacity||.2,a&&a.element)this._element=a.element,this._offset=l.P.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=j("div");const w=41,E=27,C=Q("svg",{display:"block",height:w*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${w}`},this._element),k=Q("radialGradient",{id:"shadowGradient"},Q("defs",{},C));Q("stop",{offset:"10%","stop-opacity":.4},k),Q("stop",{offset:"100%","stop-opacity":.05},k),Q("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),Q("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),Q("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),Q("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=l.P.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const g=this._element.classList;for(const w in Xh)g.remove(`mapboxgl-marker-anchor-${w}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`);const v=a&&a.className?a.className.trim().split(/\s+/):[];g.add(...v),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=l.bq.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const h=a.code,g=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(a){const h=a.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,h=this._pos;if(!a||!h)return!1;const g=a.unproject(h),v=a.getFreeCameraOptions();if(!v.position)return!1;const w=v.position.toLngLat();return w.distanceTo(g)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const h=this._pos;if(!h||h.x<0||h.x>a.transform.width||h.y<0||h.y>a.transform.height)return void this._clearFadeTimer();const g=a.unproject(h);let v;a._showingGlobe()&&l.de(a.transform,this._lngLat)?v=0:(v=1-a._queryFogOpacity(g),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${a.x}px,${a.y}px)
            ${Xh[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){const a=this._pos,h=this._map,g=this.getPitchAlignment();if(!h||!a||g!=="map")return"";if(!h._showingGlobe()){const k=h.getPitch();return k?`rotateX(${k}deg)`:""}const v=l.bI(l.df(h.transform,this._lngLat)),w=a.sub(l.dg(h.transform)),E=Math.abs(w.x)+Math.abs(w.y);if(E===0)return"";const C=v/E;return`rotateX(${-w.y*C}deg) rotateY(${w.x*C}deg)`}_calculateZTransform(){const a=this._pos,h=this._map;if(!h||!a)return"";let g=0;const v=this.getRotationAlignment();if(v==="map")if(h._showingGlobe()){const w=h.project(new l.bq(this._lngLat.lng,this._lngLat.lat+.001)),E=h.project(new l.bq(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);g=l.bI(Math.atan2(E.y,E.x))-90}else g=-h.getBearing();else if(v==="horizon"){const w=l.S(4,6,h.getZoom()),E=l.dg(h.transform);E.y+=w*h.transform.height;const C=a.sub(E),k=l.bI(Math.atan2(C.y,C.x));g=(k>90?k-270:k+90)*(1-w)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(a){cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=n_(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),a===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=l.P.convert(a),this._update(),this}addClassName(a){return this._element.classList.add(a),this}removeClassName(a){return this._element.classList.remove(a),this}toggleClassName(a){return this._element.classList.toggle(a)}_onMove(a){const h=this._map;if(!h)return;const g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){const w=this._clickTolerance||h._clickTolerance;if(a.point.dist(g)<w)return;this._isDragging=!0}this._pos=a.point.sub(v),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.b("dragstart"))),this.fire(new l.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new l.b("dragend")),this._state="inactive"}_addDragHandler(a){const h=this._map,g=this._pos;h&&g&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(g),this._pointerdownPos=a.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const h=this._map;return h&&(a?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Xf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ex=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Yf(m=new l.P(0,0),a="bottom"){if(typeof m=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(a){case"top":return new l.P(0,m);case"top-left":return new l.P(h,h);case"top-right":return new l.P(-h,h);case"bottom":return new l.P(0,-m);case"bottom-left":return new l.P(h,-h);case"bottom-right":return new l.P(-h,-h);case"left":return new l.P(m,0);case"right":return new l.P(-m,0)}return new l.P(0,0)}return m instanceof l.P||Array.isArray(m)?l.P.convert(m):l.P.convert(m[a]||[0,0])}class s_{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const h=l.ch((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,h,g){this._start=this.getValue(h),this._end=a,this._startTime=h,this._endTime=h+g}}class Ax{registerParameter(a,h,g,v,w){}registerButton(a,h,g){}registerBinding(a,h,g,v){}refreshUI(){}}const qc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},El={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},Yh={showCompass:!0,showZoom:!0,visualizePitch:!1};class o_{constructor(a,h,g=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new G0({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,g&&(this.mousePitch=new ju({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),l.a$(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(a,h){this.mouseRotate.mousedown(a,h),this.mousePitch&&this.mousePitch.mousedown(a,h),Me()}move(a,h){const g=this.map,v=this.mouseRotate.mousemoveWindow(a,h),w=v&&v.bearingDelta;if(w&&g.setBearing(g.getBearing()+w),this.mousePitch){const E=this.mousePitch.mousemoveWindow(a,h),C=E&&E.pitchDelta;C&&g.setPitch(g.getPitch()+C)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ie(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(l.e({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),$e(this.element,a)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,$e(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ue(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=ue(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const er={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ix={maxWidth:100,unit:"metric"},Sx={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:l.du,supported:D,setRTLTextPlugin:l.dw,getRTLTextPluginStatus:l.dx,Map:class extends o5{constructor(m){const a=m;if((m=l.e({},El,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&l.dh(window)&&(m.antialias=!1,l.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Rm(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new i_,this._domRenderTaskQueue=new i_,this._controls=[],this._markers=[],this._popups=[],this._mapId=l.aF(),this._locale=l.e({},qc,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new s_(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new l.di(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?{...m.contextCreateOptions}:{},typeof m.container=="string"){const h=document.getElementById(m.container);if(!h)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=h}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&l.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),l.a$(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp=m.devtools?new Ax(this):new Ax,this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Wf(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||l.dd.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),m.hash&&(this._hash=new r5(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){a.center==null&&a.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const h=m.bounds;h&&(this.resize(),this.fitBounds(h,l.e({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new Y0({customAttribution:m.customAttribution})),this._logoControl=new Tx,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new l.b(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new l.b(`${h.dataType}dataloading`,h))})}_getMapId(){return this._mapId}addControl(m,a){if(a===void 0&&(a=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new l.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=m.onAdd(this);this._controls.push(m);const g=this._controlPositions[a];return a.indexOf("bottom")!==-1?g.insertBefore(h,g.firstChild):g.appendChild(h),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new l.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(m);return a>-1&&this._controls.splice(a,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new l.b("movestart",m)).fire(new l.b("move",m)),this.fire(new l.b("resize",m)),a&&this.fire(new l.b("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(l.ag.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new l.b("zoomstart")).fire(new l.b("zoom")).fire(new l.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new l.b("zoomstart")).fire(new l.b("zoom")).fire(new l.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new l.b("pitchstart")).fire(new l.b("pitch")).fire(new l.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new l.b("pitchstart")).fire(new l.b("pitch")).fire(new l.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(a=>a==="auto"?navigator.language:a):m}setLanguage(m){const a=this._parseLanguage(m);if(!this.style||a===this._language)return this;this._language=a,this.style.reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,a=m.projection.name;let h;a==="globe"&&m.zoom>=l.bA?(m.setMercatorFromTransition(),h=!0):a==="mercator"&&m.zoom<l.bA&&(m.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,a){return this._updateProjection(m||a||{name:"mercator"})}_updateProjection(m){let a;return a=m.name==="globe"&&this.transform.zoom>=l.bA?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),a&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m){return this.transform.locationPoint3D(l.bq.convert(m))}unproject(m){return this.transform.pointLocation3D(l.P.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,a,h){if(m==="mouseenter"||m==="mouseover"){let g=!1;const v=E=>{const C=a.filter(O=>this.getLayer(O)),k=C.length?this.queryRenderedFeatures(E.point,{layers:C}):[];k.length?g||(g=!0,h.call(this,new Us(m,this,E.originalEvent,{features:k}))):g=!1},w=()=>{g=!1};return{layers:new Set(a),listener:h,delegates:{mousemove:v,mouseout:w}}}if(m==="mouseleave"||m==="mouseout"){let g=!1;const v=E=>{const C=a.filter(k=>this.getLayer(k));(C.length?this.queryRenderedFeatures(E.point,{layers:C}):[]).length?g=!0:g&&(g=!1,h.call(this,new Us(m,this,E.originalEvent)))},w=E=>{g&&(g=!1,h.call(this,new Us(m,this,E.originalEvent)))};return{layers:new Set(a),listener:h,delegates:{mousemove:v,mouseout:w}}}{const g=v=>{const w=a.filter(C=>this.getLayer(C)),E=w.length?this.queryRenderedFeatures(v.point,{layers:w}):[];E.length&&(v.features=E,h.call(this,v),delete v.features)};return{layers:new Set(a),listener:h,delegates:{[m]:g}}}}on(m,a,h){if(h===void 0)return super.on(m,a);if(Array.isArray(a)||(a=[a]),a){for(const v of a)if(!this._isValidId(v))return this}const g=this._createDelegatedListener(m,a,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(const v in g.delegates)this.on(v,g.delegates[v]);return this}once(m,a,h){if(h===void 0)return super.once(m,a);if(Array.isArray(a)||(a=[a]),a){for(const v of a)if(!this._isValidId(v))return this}const g=this._createDelegatedListener(m,a,h);for(const v in g.delegates)this.once(v,g.delegates[v]);return this}off(m,a,h){if(h===void 0)return super.off(m,a);a=new Set(Array.isArray(a)?a:[a]);for(const w of a)if(!this._isValidId(w))return this;const g=(w,E)=>{if(w.size!==E.size)return!1;for(const C of w)if(!E.has(C))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[m]:void 0;return v&&(w=>{for(let E=0;E<w.length;E++){const C=w[E];if(C.listener===h&&g(C.layers,a)){for(const k in C.delegates)this.off(k,C.delegates[k]);return w.splice(E,1),this}}})(v),this}queryRenderedFeatures(m,a){if(!this.style)return[];if(a!==void 0||m===void 0||m instanceof l.P||Array.isArray(m)||(a=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],(a=a||{}).layers&&Array.isArray(a.layers)){for(const h of a.layers)if(!this._isValidId(h))return[]}return this.style.queryRenderedFeatures(m,a,this.transform)}querySourceFeatures(m,a){return this._isValidId(m)?this.style.querySourceFeatures(m,a):[]}isPointOnSurface(m){const{name:a}=this.transform.projection;return a!=="globe"&&a!=="mercator"&&l.w(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(l.P.convert(m))}setStyle(m,a){return a=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a),this.style&&m&&a.diff!==!1&&a.localFontFamily===this._localFontFamily&&a.localIdeographFontFamily===this._localIdeographFontFamily&&!a.config?(this.style._diffStyle(m,(h,g)=>{h?(l.w(`Unable to perform style diff: ${String(h.message||h.error||h)}. Rebuilding the style from scratch.`),this._updateStyle(m,a)):g&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(m,a))}_getUIString(m){const a=this._locale[m];if(a==null)throw new Error(`Missing UI string '${m}'`);return a}_updateStyle(m,a){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const h=l.e({},a);a&&a.config&&(h.initialConfig=a.config,delete h.config),this.style=new Qa(this,h).setEventedParent(this,{style:this.style}).load(m)}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Qa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(l.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new l.a(new Error("IDs can't be empty."))),!1):!l.c9(m)||(this.fire(new l.a(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}addSource(m,a){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,a),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,a,h){this._lazyInitEmptyStyle(),this.style.addSourceType(m,a,h)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,a,{pixelRatio:h=1,sdf:g=!1,stretchX:v,stretchY:w,content:E}={}){if(this._lazyInitEmptyStyle(),a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap){const{width:C,height:k,data:O}=l.f.getImageData(a);this.style.addImage(m,{data:new l.h({width:C,height:k},O),pixelRatio:h,stretchX:v,stretchY:w,content:E,sdf:g,version:0})}else if(a.width===void 0||a.height===void 0)this.fire(new l.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:k}=a,O=a;this.style.addImage(m,{data:new l.h({width:C,height:k},new Uint8Array(O.data)),pixelRatio:h,stretchX:v,stretchY:w,content:E,sdf:g,version:0,userImage:O}),O.onAdd&&O.onAdd(this,m)}}updateImage(m,a){this._lazyInitEmptyStyle();const h=this.style.getImage(m);if(!h)return void this.fire(new l.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap?l.f.getImageData(a):a,{width:v,height:w}=g,E=g.data;if(v===void 0||w===void 0)return void this.fire(new l.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==h.data.width||w!==h.data.height)return void this.fire(new l.a(new Error(`The width and height of the updated image (${v}, ${w})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));const C=!(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap);h.data.replace(E,C),this.style.updateImage(m,h)}hasImage(m){return m?!!this.style&&!!this.style.getImage(m):(this.fire(new l.a(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,a){l.d(this._requestManager.transformRequest(m,l.R.Image),(h,g)=>{a(h,g instanceof HTMLImageElement?l.f.getImageData(g):g)})}listImages(){return this.style.listImages()}addModel(m,a){this._lazyInitEmptyStyle(),this.style.addModel(m,a)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new l.a(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,a){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,a),this._update(!0)):this}getSlot(m){const a=this.getLayer(m);return a&&a.slot||null}setSlot(m,a){return this.style.setSlot(m,a),this.style.mergeLayers(),this._update(!0)}addImport(m,a){return this.style.addImport(m,a),this}updateImport(m,a){return typeof a!="string"&&a.id!==m?(this.removeImport(m),this.addImport(a)):(this.style.updateImport(m,a),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,a){return this.style.moveImport(m,a),this._update(!0)}moveLayer(m,a){return this._isValidId(m)?(this.style.moveLayer(m,a),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){return this._isValidId(m)?this.style.getOwnLayer(m):null}setLayerZoomRange(m,a,h){return this._isValidId(m)?(this.style.setLayerZoomRange(m,a,h),this._update(!0)):this}setFilter(m,a,h={}){return this._isValidId(m)?(this.style.setFilter(m,a,h),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,a,h,g={}){return this._isValidId(m)?(this.style.setPaintProperty(m,a,h,g),this._update(!0)):this}getPaintProperty(m,a){return this._isValidId(m)?this.style.getPaintProperty(m,a):null}setLayoutProperty(m,a,h,g={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,a,h,g),this._update(!0)):this}getLayoutProperty(m,a){return this._isValidId(m)?this.style.getLayoutProperty(m,a):null}getSchema(m){return this.style.getSchema(m)}setSchema(m,a){return this.style.setSchema(m,a),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,a){return this.style.setConfig(m,a),this._update(!0)}getConfigProperty(m,a){return this.style.getConfigProperty(m,a)}setConfigProperty(m,a,h){return this.style.setConfigProperty(m,a,h),this._update(!0)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){const a=m[0];a.properties?this.style.setFlatLight(a.properties,a.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,a={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(l.bq.convert(m),this.transform):0}setFeatureState(m,a){return this._isValidId(m.source)?(this.style.setFeatureState(m,a),this._update()):this}removeFeatureState(m,a){return this._isValidId(m.source)?(this.style.removeFeatureState(m,a),this._update()):this}getFeatureState(m){return this._isValidId(m.source)?this.style.getFeatureState(m):null}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let h,g,v,w=this._container;for(;w&&(!g||!v);){const E=window.getComputedStyle(w).transform;E&&E!=="none"&&(h=E.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(g=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(v=h[3])),w=w.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=v?Math.abs(a/v):a}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&l.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=j("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=j("div","mapboxgl-canvas-container",m);this._canvas=j("canvas","mapboxgl-canvas",a),this._interactive&&(a.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=j("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=j("div",`mapboxgl-ctrl-${v}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,a){const h=l.f.devicePixelRatio||1;this._canvas.width=h*Math.ceil(m),this._canvas.height=h*Math.ceil(a),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${a}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const a=this._markers.indexOf(m);a!==-1&&this._markers.splice(a,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const a=this._popups.indexOf(m);a!==-1&&this._popups.splice(a,1)}_setupPainter(){const m=l.e({},D.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl2",m);a?(l.dj(a,!0),this.painter=new ax(a,this._contextCreateOptions,this.transform,this._tp),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),l.dk.testSupport(a)):this.fire(new l.a(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.b("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new l.b("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let a;this.fire(new l.b("renderstart"));const h=this.painter.context.extTimerQuery,g=l.f.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(a=v.createQuery(),v.beginQuery(h.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,O=this.transform.pitch,F=l.f.now(),B=new l.N(k,{now:F,fadeDuration:w,pitch:O,transition:this.style.transition});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(g),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(g),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new l.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new l.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const k=l.f.now()-g;v.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{const O=v.getQueryParameter(a,v.QUERY_RESULT)/1e6;v.deleteQuery(a),this.fire(new l.b("gpu-timing-frame",{cpuTime:k,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(k);this.fire(new l.b("gpu-timing-layer",{layerTimes:O}))},50)}if(this.listens("gpu-timing-deferred-render")){const k=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const O=this.painter.queryGpuTimeDeferredRender(k);this.fire(new l.b("gpu-timing-deferred-render",{gpuTime:O}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(C||this._repaint)this.triggerRepaint();else{const k=!this.isMoving()&&this.loaded();if(k&&(E=this._updateAverageElevation(g,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new l.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new l.b("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,this._performanceMetricsCollection&&l.dl(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const a of this._markers)m&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!m||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(m,a=!1){const h=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);const g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(a||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const v=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=m;const E=Math.abs(v-w);if(E>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(w),h(w);this._averageElevation.easeTo(w,m,300)}else if(E>1e-4)return this._averageElevation.jumpTo(w),h(w)}return!!this._averageElevation.isEasing(m)&&h(this._averageElevation.getValue(m))}_authenticate(){l.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===l.dn||m.status===401)){const a=this.painter.context.gl;l.dj(a,!1),this._logoControl instanceof Tx&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new l.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),l.dp(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&l.dq(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const h=this.painter.context.gl,g=h.createFramebuffer();function v(w){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,w,0);const E=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,E),E}return h.bindFramebuffer(h.FRAMEBUFFER,g),this._canvasPixelComparison(v(m),a.canvasCopies.map(v),a.timeStamps)}_canvasPixelComparison(m,a,h){let g=h[1]-h[0];const v=m.length/4;for(let w=0;w<a.length;w++){const E=a[w];let C=0;for(let k=0;k<E.length;k+=4)E[k]===m[k]&&E[k+1]===m[k+1]&&E[k+2]===m[k+2]&&E[k+3]===m[k+3]&&(C+=1);g+=(h[w+2]-h[w+1])*(1-C/v)}return g}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),l.dr(this.painter.context.gl),l.ds.remove(),l.dt.remove(),this._removed=!0,this.fire(new l.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=l.f.frame(a=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(a)}))}_preloadTiles(m){const a=this.style?this.style.getSourceCaches():[];return l.b4(a,(h,g)=>h._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this._tp.refreshUI(),m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,this._tp.refreshUI(),m&&this._update())}_setCacheLimits(m,a){l.dv(m,a)}get version(){return l.du}},NavigationControl:class{constructor(m){this.options=l.e({},Yh,m),this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(l.a$(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),j("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),j("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.a$(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:a}):h.resetNorth({},{originalEvent:a}))}),this._compassIcon=j("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const a=m.getZoom(),h=a===m.getMaxZoom(),g=a===m.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new o_(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,a){const h=j("button",m,this._container);return h.type="button",h.addEventListener("click",a),h}_setButtonTitle(m,a){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${a}`);m.setAttribute("aria-label",h),m.firstElementChild&&m.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends l.E{constructor(m){super();const a=navigator.geolocation;this.options=l.e({geolocation:a},er,m),l.a$(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=lx(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const a=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,m(h)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>a(h.state!=="denied")).catch(()=>a()):a()}_isOutOfMapMaxBounds(m){const a=this._map.getMaxBounds(),h=m.coords;return!!a&&(h.longitude<a.getWest()||h.longitude>a.getEast()||h.latitude<a.getSouth()||h.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new l.b("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new l.b("geolocate",m)),this._finish()}}_updateCamera(m){const a=new l.bq(m.coords.longitude,m.coords.latitude),h=m.coords.accuracy,g=this._map.getBearing(),v=l.e({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(h),v,{geolocateSource:!0})}_updateMarker(m){if(m){const a=new l.bq(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,a=l.bo(1,m._center.lat)*m.worldSize,h=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new l.b("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=j("button","mapboxgl-ctrl-geolocate",this._container),j("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=j("div","mapboxgl-user-location"),this._dotElement.appendChild(j("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(j("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Zf({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=j("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Zf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new l.b("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(a=>{a==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Y0,ScaleControl:class{constructor(m){this.options=l.e({},Ix,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),l.a$(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,a=this._map,h=a._containerHeight/2,g=a._containerWidth/2-m/2,v=a.unproject([g,h]),w=a.unproject([g+m,h]),E=v.distanceTo(w);if(this.options.unit==="imperial"){const C=3.2808*E;C>5280?this._setScale(m,C/5280,"mile"):this._setScale(m,C,"foot")}else this.options.unit==="nautical"?this._setScale(m,E/1852,"nautical-mile"):E>=1e3?this._setScale(m,E/1e3,"kilometer"):this._setScale(m,E,"meter")}_setScale(m,a,h){this._map._requestDomTask(()=>{const g=function(w){const E=Math.pow(10,`${Math.floor(w)}`.length-1);let C=w/E;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(k){const O=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*O)/O}(C),E*C}(a),v=g/a;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(g):`${g}&nbsp;${Sx[h]}`,this._container.style.width=m*v+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:l.w("Full screen control 'container' must be a DOM element.")),l.a$(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=j("button","mapboxgl-ctrl-fullscreen",this._controlContainer);j("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends l.E{constructor(m){super(),this.options=l.e(Object.create(Xf),m),l.a$(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new l.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new l.b("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=l.bq.convert(m),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const a=document.createDocumentFragment(),h=document.createElement("body");let g;for(h.innerHTML=m;g=h.firstChild,g;)a.appendChild(g);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=j("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(m),this.options.closeButton){const h=this._closeButton=j("button","mapboxgl-popup-close-button",a);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let a;return this._classList.delete(m)?a=!1:(this._classList.add(m),a=!0),this._updateClassList(),a}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const a=this._map,h=this._container,g=this._pos;if(!a||!h||!g)return"bottom";const v=h.offsetWidth,w=h.offsetHeight,E=g.x<v/2,C=g.x>a.transform.width-v/2;if(g.y+m<w)return E?"top-left":C?"top-right":"top";if(g.y>a.transform.height-w){if(E)return"bottom-left";if(C)return"bottom-right"}return E?"left":C?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),m.className=a.join(" ")}_update(m){const a=this._map,h=this._content;if(!a||!this._lngLat&&!this._trackPointer||!h)return;let g=this._container;if(g||(g=this._container=j("div","mapboxgl-popup",a.getContainer()),this._tip=j("div","mapboxgl-popup-tip",g),g.appendChild(h)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=n_(this._lngLat,this._pos,a.transform)),!this._trackPointer||m){const v=this._pos=this._trackPointer&&m?m:a.project(this._lngLat),w=Yf(this.options.offset),E=this._anchor=this._getAnchor(w.y),C=Yf(this.options.offset,E),k=v.add(C).round();a._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${Xh[E]} translate(${k.x}px,${k.y}px)`)})}if(!this._marker&&a._showingGlobe()){const v=l.de(a.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Ex);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Zf,Style:Qa,LngLat:l.bq,LngLatBounds:l.ag,Point:l.P,MercatorCoordinate:l.O,FreeCameraOptions:Lh,Evented:l.E,config:l.dd,prewarm:l.dy,clearPrewarmedResources:l.dz,get accessToken(){return l.dd.ACCESS_TOKEN},set accessToken(m){l.dd.ACCESS_TOKEN=m},get baseApiUrl(){return l.dd.API_URL},set baseApiUrl(m){l.dd.API_URL=m},get workerCount(){return l.dA.workerCount},set workerCount(m){l.dA.workerCount=m},get maxParallelImageRequests(){return l.dd.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){l.dd.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){l.dB(m)},get workerUrl(){return l.dC.workerUrl},set workerUrl(m){l.dC.workerUrl=m},get workerClass(){return l.dC.workerClass},set workerClass(m){l.dC.workerClass=m},get workerParams(){return l.dC.workerParams},set workerParams(m){l.dC.workerParams=m},get dracoUrl(){return l.dD()},set dracoUrl(m){l.dE(m)},get meshoptUrl(){return l.dF()},set meshoptUrl(m){l.dG(m)},setNow:l.f.setNow,restoreNow:l.f.restoreNow}});var x=d;return x})})(C8);var Qne=C8.exports;const Ny=Yne(Qne);function GL(n,e,r){var s=e[1],c=e[0],d=s-c;return n===s&&r?n:((n-c)%d+d)%d+c}function vT(n,e){if(e===!1)return n;var r=Math.pow(10,e===void 0?6:e);return Math.round(n*r)/r}var P8=Array.isArray||function(n){return Object.prototype.toString.call(n)==="[object Array]"};function In(n,e,r){this.x=r?Math.round(n):n,this.y=r?Math.round(e):e}var qL=Math.trunc||function(n){return n>0?Math.floor(n):Math.ceil(n)};function Ml(n,e,r){return n instanceof In?n:P8(n)?new In(n[0],n[1]):n==null?n:typeof n=="object"&&"x"in n&&"y"in n?new In(n.x,n.y):new In(n,e,r)}function fu(n,e){if(n)for(var r=e?[n,e]:n,s=0,c=r.length;s<c;s++)this.extend(r[s])}function D_(n,e){return!n||n instanceof fu?n:new fu(n,e)}function bc(n,e){if(n)for(var r=e?[n,e]:n,s=0,c=r.length;s<c;s++)this.extend(r[s])}function G_(n,e){return n instanceof bc?n:new bc(n,e)}In.prototype={clone:function(){return new In(this.x,this.y)},add:function(n){return this.clone()._add(Ml(n))},_add:function(n){return this.x+=n.x,this.y+=n.y,this},subtract:function(n){return this.clone()._subtract(Ml(n))},_subtract:function(n){return this.x-=n.x,this.y-=n.y,this},divideBy:function(n){return this.clone()._divideBy(n)},_divideBy:function(n){return this.x/=n,this.y/=n,this},multiplyBy:function(n){return this.clone()._multiplyBy(n)},_multiplyBy:function(n){return this.x*=n,this.y*=n,this},scaleBy:function(n){return new In(this.x*n.x,this.y*n.y)},unscaleBy:function(n){return new In(this.x/n.x,this.y/n.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=qL(this.x),this.y=qL(this.y),this},distanceTo:function(n){var e=(n=Ml(n)).x-this.x,r=n.y-this.y;return Math.sqrt(e*e+r*r)},equals:function(n){return(n=Ml(n)).x===this.x&&n.y===this.y},contains:function(n){return n=Ml(n),Math.abs(n.x)<=Math.abs(this.x)&&Math.abs(n.y)<=Math.abs(this.y)},toString:function(){return"Point("+vT(this.x)+", "+vT(this.y)+")"}},fu.prototype={extend:function(n){var e,r;if(!n)return this;if(n instanceof In||typeof n[0]=="number"||"x"in n)e=r=Ml(n);else if(e=(n=D_(n)).min,r=n.max,!e||!r)return this;return this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(r.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(r.y,this.max.y)):(this.min=e.clone(),this.max=r.clone()),this},getCenter:function(n){return Ml((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,n)},getBottomLeft:function(){return Ml(this.min.x,this.max.y)},getTopRight:function(){return Ml(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(n){var e,r;return(n=typeof n[0]=="number"||n instanceof In?Ml(n):D_(n))instanceof fu?(e=n.min,r=n.max):e=r=n,e.x>=this.min.x&&r.x<=this.max.x&&e.y>=this.min.y&&r.y<=this.max.y},intersects:function(n){n=D_(n);var e=this.min,r=this.max,s=n.min,c=n.max,d=c.x>=e.x&&s.x<=r.x,_=c.y>=e.y&&s.y<=r.y;return d&&_},overlaps:function(n){n=D_(n);var e=this.min,r=this.max,s=n.min,c=n.max,d=c.x>e.x&&s.x<r.x,_=c.y>e.y&&s.y<r.y;return d&&_},isValid:function(){return!(!this.min||!this.max)},pad:function(n){var e=this.min,r=this.max,s=Math.abs(e.x-r.x)*n,c=Math.abs(e.y-r.y)*n;return D_(Ml(e.x-s,e.y-c),Ml(r.x+s,r.y+c))},equals:function(n){return!!n&&(n=D_(n),this.min.equals(n.getTopLeft())&&this.max.equals(n.getBottomRight()))}},bc.prototype={extend:function(n){var e,r,s=this._southWest,c=this._northEast;if(n instanceof Es)e=n,r=n;else{if(!(n instanceof bc))return n?this.extend(xT(n)||G_(n)):this;if(e=n._southWest,r=n._northEast,!e||!r)return this}return s||c?(s.lat=Math.min(e.lat,s.lat),s.lng=Math.min(e.lng,s.lng),c.lat=Math.max(r.lat,c.lat),c.lng=Math.max(r.lng,c.lng)):(this._southWest=new Es(e.lat,e.lng),this._northEast=new Es(r.lat,r.lng)),this},pad:function(n){var e=this._southWest,r=this._northEast,s=Math.abs(e.lat-r.lat)*n,c=Math.abs(e.lng-r.lng)*n;return new bc(new Es(e.lat-s,e.lng-c),new Es(r.lat+s,r.lng+c))},getCenter:function(){return new Es((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Es(this.getNorth(),this.getWest())},getSouthEast:function(){return new Es(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(n){n=typeof n[0]=="number"||n instanceof Es||"lat"in n?xT(n):G_(n);var e,r,s=this._southWest,c=this._northEast;return n instanceof bc?(e=n.getSouthWest(),r=n.getNorthEast()):e=r=n,e.lat>=s.lat&&r.lat<=c.lat&&e.lng>=s.lng&&r.lng<=c.lng},intersects:function(n){n=G_(n);var e=this._southWest,r=this._northEast,s=n.getSouthWest(),c=n.getNorthEast(),d=c.lat>=e.lat&&s.lat<=r.lat,_=c.lng>=e.lng&&s.lng<=r.lng;return d&&_},overlaps:function(n){n=G_(n);var e=this._southWest,r=this._northEast,s=n.getSouthWest(),c=n.getNorthEast(),d=c.lat>e.lat&&s.lat<r.lat,_=c.lng>e.lng&&s.lng<r.lng;return d&&_},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(n,e){return!!n&&(n=G_(n),this._southWest.equals(n.getSouthWest(),e)&&this._northEast.equals(n.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}};var HL=function(n){var e,r,s,c;for(r=1,s=arguments.length;r<s;r++)for(e in c=arguments[r])n[e]=c[e];return n}({},{latLngToPoint:function(n,e){var r=this.projection.project(n),s=this.scale(e);return this.transformation._transform(r,s)},pointToLatLng:function(n,e){var r=this.scale(e),s=this.transformation.untransform(n,r);return this.projection.unproject(s)},project:function(n){return this.projection.project(n)},unproject:function(n){return this.projection.unproject(n)},scale:function(n){return 256*Math.pow(2,n)},zoom:function(n){return Math.log(n/256)/Math.LN2},getProjectedBounds:function(n){if(this.infinite)return null;var e=this.projection.bounds,r=this.scale(n);return new fu(this.transformation.transform(e.min,r),this.transformation.transform(e.max,r))},infinite:!1,wrapLatLng:function(n){var e=this.wrapLng?GL(n.lng,this.wrapLng,!0):n.lng;return new Es(this.wrapLat?GL(n.lat,this.wrapLat,!0):n.lat,e,n.alt)},wrapLatLngBounds:function(n){var e=n.getCenter(),r=this.wrapLatLng(e),s=e.lat-r.lat,c=e.lng-r.lng;if(s===0&&c===0)return n;var d=n.getSouthWest(),_=n.getNorthEast();return new bc(new Es(d.lat-s,d.lng-c),new Es(_.lat-s,_.lng-c))}},{wrapLng:[-180,180],R:6371e3,distance:function(n,e){var r=Math.PI/180,s=n.lat*r,c=e.lat*r,d=Math.sin((e.lat-n.lat)*r/2),_=Math.sin((e.lng-n.lng)*r/2),x=d*d+Math.cos(s)*Math.cos(c)*_*_,l=2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));return this.R*l}});function Es(n,e,r){if(isNaN(n)||isNaN(e))throw new Error("Invalid LatLng object: ("+n+", "+e+")");this.lat=+n,this.lng=+e,r!==void 0&&(this.alt=+r)}function xT(n,e,r){return n instanceof Es?n:P8(n)&&typeof n[0]!="object"?n.length===3?new Es(n[0],n[1],n[2]):n.length===2?new Es(n[0],n[1]):null:n==null?n:typeof n=="object"&&"lat"in n?new Es(n.lat,"lng"in n?n.lng:n.lon,n.alt):e===void 0?null:new Es(n,e,r)}Es.prototype={equals:function(n,e){return!!n&&(n=xT(n),Math.max(Math.abs(this.lat-n.lat),Math.abs(this.lng-n.lng))<=(e===void 0?1e-9:e))},toString:function(n){return"LatLng("+vT(this.lat,n)+", "+vT(this.lng,n)+")"},distanceTo:function(n){return HL.distance(this,xT(n))},wrap:function(){return HL.wrapLatLng(this)},toBounds:function(n){var e=180*n/40075017,r=e/Math.cos(Math.PI/180*this.lat);return G_([this.lat-e,this.lng-r],[this.lat+e,this.lng+r])},clone:function(){return new Es(this.lat,this.lng,this.alt)}};const bT=n=>{const e=n.valueOf();return M8(e)},M8=n=>{const e=n/864e5-10957.5,r=6.240059966692059+.017201969994578018*e,s=r+.017453292519943295*(1.9148*Math.sin(r)+.02*Math.sin(2*r)+3e-4*Math.sin(3*r))+1.796593062783907+Math.PI,c=Math.atan2(Math.sin(s)*Math.cos(.40909994067971484),Math.cos(s));return{dec:Math.asin(Math.sin(.40909994067971484)*Math.sin(s)),Hi:(4.889714432387314+6.3003876824396166*e-c)%(2*Math.PI)+2*Math.PI}},By=()=>Math.floor(1e7*Math.random()),yA=(n,e,r)=>{const s=1/e,c=Math.min(n[0]*s,255),d=Math.min(n[1]*s,255),_=Math.min(n[2]*s,255);let x=0;return c+d+_!==0&&(x=c>0?c/255*.5+.5:_>0?.5*(1-_/255):.5),x*r},L_=(n=new Date,e)=>{const r=new Date(n.toLocaleString("en-US",{timeZone:"UTC"})),s=new Date(n.toLocaleString("en-US",e?{timeZone:e}:{}));return r.getTime()-s.getTime()},Vy=n=>{const e=()=>!n.getPitch;return{project:(r,s)=>{if(e())return n.project(r,s);{const{lat:c,lng:d}=r;return new In(((_,x)=>(_+180)/360*Math.pow(2,x)*256)(d,s),((_,x)=>(1-Math.log(Math.tan(_*Math.PI/180)+1/Math.cos(_*Math.PI/180))/Math.PI)/2*Math.pow(2,x)*256)(c,s))}},unproject:(r,s)=>{return e()?n.unproject(r,s):new Es((c=r.y,d=s,_=Math.PI-2*Math.PI*c/256/Math.pow(2,d),180/Math.PI*Math.atan(.5*(Math.exp(_)-Math.exp(-_)))),function(x,l){return x/256/Math.pow(2,l)*360-180}(r.x,s));var c,d,_},screenUnproject:r=>e()?n.containerPointToLatLng(r):n.unproject(r),getZoom:()=>e()?n.getZoom():n.getZoom()+1,getCenter:()=>n.getCenter(),getBounds:()=>n.getBounds(),eachLayer:r=>{e()&&n.eachLayer(r)},getBearing:()=>e()?0:n.getBearing(),getPitch:()=>e()?0:n.getPitch(),rawMap:()=>n,isLeaflet:e,getPixelDimensions:()=>{const r=n.getContainer();return{width:r.clientWidth,height:r.clientHeight}},createBounds:r=>{const{nw:s,se:c}=r;return new bc(s,c)}}};function pc(n,e,r,s){return new(r||(r=Promise))(function(c,d){function _(S){try{l(s.next(S))}catch(D){d(D)}}function x(S){try{l(s.throw(S))}catch(D){d(D)}}function l(S){var D;S.done?c(S.value):(D=S.value,D instanceof r?D:new r(function(I){I(D)})).then(_,x)}l((s=s.apply(n,[])).next())})}function wT(n,e,r){r=r||2;var s,c,d,_,x,l,S,D=e&&e.length,I=D?e[0]*r:n.length,V=WL(n,0,I,r,!0),j=[];if(!V||V.next===V.prev)return j;if(D&&(V=function(te,ce,Ce,Me){var Ie,Te,Ge,$e=[];for(Ie=0,Te=ce.length;Ie<Te;Ie++)(Ge=WL(te,ce[Ie]*Me,Ie<Te-1?ce[Ie+1]*Me:te.length,Me,!1))===Ge.next&&(Ge.steiner=!0),$e.push(sse(Ge));for($e.sort(rse),Ie=0;Ie<$e.length;Ie++)Ce=ise($e[Ie],Ce);return Ce}(n,e,V,r)),n.length>80*r){s=d=n[0],c=_=n[1];for(var Q=r;Q<I;Q+=r)(x=n[Q])<s&&(s=x),(l=n[Q+1])<c&&(c=l),x>d&&(d=x),l>_&&(_=l);S=(S=Math.max(d-s,_-c))!==0?32767/S:0}return o1(V,j,r,s,c,S,0),j}function WL(n,e,r,s,c){var d,_;if(c===KI(n,e,r,s)>0)for(d=e;d<r;d+=s)_=ZL(d,n[d],n[d+1],_);else for(d=r-s;d>=e;d-=s)_=ZL(d,n[d],n[d+1],_);return _&&PE(_,_.next)&&(l1(_),_=_.next),_}function nm(n,e){if(!n)return n;e||(e=n);var r,s=n;do if(r=!1,s.steiner||!PE(s,s.next)&&ls(s.prev,s,s.next)!==0)s=s.next;else{if(l1(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function o1(n,e,r,s,c,d,_){if(n){!_&&d&&function(D,I,V,j){var Q=D;do Q.z===0&&(Q.z=YI(Q.x,Q.y,I,V,j)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==D);Q.prevZ.nextZ=null,Q.prevZ=null,function(te){var ce,Ce,Me,Ie,Te,Ge,$e,ue,pe=1;do{for(Ce=te,te=null,Te=null,Ge=0;Ce;){for(Ge++,Me=Ce,$e=0,ce=0;ce<pe&&($e++,Me=Me.nextZ);ce++);for(ue=pe;$e>0||ue>0&&Me;)$e!==0&&(ue===0||!Me||Ce.z<=Me.z)?(Ie=Ce,Ce=Ce.nextZ,$e--):(Ie=Me,Me=Me.nextZ,ue--),Te?Te.nextZ=Ie:te=Ie,Ie.prevZ=Te,Te=Ie;Ce=Me}Te.nextZ=null,pe*=2}while(Ge>1)}(Q)}(n,s,c,d);for(var x,l,S=n;n.prev!==n.next;)if(x=n.prev,l=n.next,d?Jne(n,s,c,d):Kne(n))e.push(x.i/r|0),e.push(n.i/r|0),e.push(l.i/r|0),l1(n),n=l.next,S=l.next;else if((n=l)===S){_?_===1?o1(n=ese(nm(n),e,r),e,r,s,c,d,2):_===2&&tse(n,e,r,s,c,d):o1(nm(n),e,r,s,c,d,1);break}}}function Kne(n){var e=n.prev,r=n,s=n.next;if(ls(e,r,s)>=0)return!1;for(var c=e.x,d=r.x,_=s.x,x=e.y,l=r.y,S=s.y,D=c<d?c<_?c:_:d<_?d:_,I=x<l?x<S?x:S:l<S?l:S,V=c>d?c>_?c:_:d>_?d:_,j=x>l?x>S?x:S:l>S?l:S,Q=s.next;Q!==e;){if(Q.x>=D&&Q.x<=V&&Q.y>=I&&Q.y<=j&&Y_(c,x,d,l,_,S,Q.x,Q.y)&&ls(Q.prev,Q,Q.next)>=0)return!1;Q=Q.next}return!0}function Jne(n,e,r,s){var c=n.prev,d=n,_=n.next;if(ls(c,d,_)>=0)return!1;for(var x=c.x,l=d.x,S=_.x,D=c.y,I=d.y,V=_.y,j=x<l?x<S?x:S:l<S?l:S,Q=D<I?D<V?D:V:I<V?I:V,te=x>l?x>S?x:S:l>S?l:S,ce=D>I?D>V?D:V:I>V?I:V,Ce=YI(j,Q,e,r,s),Me=YI(te,ce,e,r,s),Ie=n.prevZ,Te=n.nextZ;Ie&&Ie.z>=Ce&&Te&&Te.z<=Me;){if(Ie.x>=j&&Ie.x<=te&&Ie.y>=Q&&Ie.y<=ce&&Ie!==c&&Ie!==_&&Y_(x,D,l,I,S,V,Ie.x,Ie.y)&&ls(Ie.prev,Ie,Ie.next)>=0||(Ie=Ie.prevZ,Te.x>=j&&Te.x<=te&&Te.y>=Q&&Te.y<=ce&&Te!==c&&Te!==_&&Y_(x,D,l,I,S,V,Te.x,Te.y)&&ls(Te.prev,Te,Te.next)>=0))return!1;Te=Te.nextZ}for(;Ie&&Ie.z>=Ce;){if(Ie.x>=j&&Ie.x<=te&&Ie.y>=Q&&Ie.y<=ce&&Ie!==c&&Ie!==_&&Y_(x,D,l,I,S,V,Ie.x,Ie.y)&&ls(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.prevZ}for(;Te&&Te.z<=Me;){if(Te.x>=j&&Te.x<=te&&Te.y>=Q&&Te.y<=ce&&Te!==c&&Te!==_&&Y_(x,D,l,I,S,V,Te.x,Te.y)&&ls(Te.prev,Te,Te.next)>=0)return!1;Te=Te.nextZ}return!0}function ese(n,e,r){var s=n;do{var c=s.prev,d=s.next.next;!PE(c,d)&&k8(c,s,s.next,d)&&a1(c,d)&&a1(d,c)&&(e.push(c.i/r|0),e.push(s.i/r|0),e.push(d.i/r|0),l1(s),l1(s.next),s=n=d),s=s.next}while(s!==n);return nm(s)}function tse(n,e,r,s,c,d){var _=n;do{for(var x=_.next.next;x!==_.prev;){if(_.i!==x.i&&ose(_,x)){var l=D8(_,x);return _=nm(_,_.next),l=nm(l,l.next),o1(_,e,r,s,c,d,0),void o1(l,e,r,s,c,d,0)}x=x.next}_=_.next}while(_!==n)}function rse(n,e){return n.x-e.x}function ise(n,e){var r=function(c,d){var _,x=d,l=c.x,S=c.y,D=-1/0;do{if(S<=x.y&&S>=x.next.y&&x.next.y!==x.y){var I=x.x+(S-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(I<=l&&I>D&&(D=I,_=x.x<x.next.x?x:x.next,I===l))return _}x=x.next}while(x!==d);if(!_)return null;var V,j=_,Q=_.x,te=_.y,ce=1/0;x=_;do l>=x.x&&x.x>=Q&&l!==x.x&&Y_(S<te?l:D,S,Q,te,S<te?D:l,S,x.x,x.y)&&(V=Math.abs(S-x.y)/(l-x.x),a1(x,c)&&(V<ce||V===ce&&(x.x>_.x||x.x===_.x&&nse(_,x)))&&(_=x,ce=V)),x=x.next;while(x!==j);return _}(n,e);if(!r)return e;var s=D8(r,n);return nm(s,s.next),nm(r,r.next)}function nse(n,e){return ls(n.prev,n,e.prev)<0&&ls(e.next,n,n.next)<0}function YI(n,e,r,s,c){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*c|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function sse(n){var e=n,r=n;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==n);return r}function Y_(n,e,r,s,c,d,_,x){return(c-_)*(e-x)>=(n-_)*(d-x)&&(n-_)*(s-x)>=(r-_)*(e-x)&&(r-_)*(d-x)>=(c-_)*(s-x)}function ose(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(r,s){var c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==s.i&&c.next.i!==s.i&&k8(c,c.next,r,s))return!0;c=c.next}while(c!==r);return!1}(n,e)&&(a1(n,e)&&a1(e,n)&&function(r,s){var c=r,d=!1,_=(r.x+s.x)/2,x=(r.y+s.y)/2;do c.y>x!=c.next.y>x&&c.next.y!==c.y&&_<(c.next.x-c.x)*(x-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==r);return d}(n,e)&&(ls(n.prev,n,e.prev)||ls(n,e.prev,e))||PE(n,e)&&ls(n.prev,n,n.next)>0&&ls(e.prev,e,e.next)>0)}function ls(n,e,r){return(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y)}function PE(n,e){return n.x===e.x&&n.y===e.y}function k8(n,e,r,s){var c=Gb(ls(n,e,r)),d=Gb(ls(n,e,s)),_=Gb(ls(r,s,n)),x=Gb(ls(r,s,e));return c!==d&&_!==x||!(c!==0||!$b(n,r,e))||!(d!==0||!$b(n,s,e))||!(_!==0||!$b(r,n,s))||!(x!==0||!$b(r,e,s))}function $b(n,e,r){return e.x<=Math.max(n.x,r.x)&&e.x>=Math.min(n.x,r.x)&&e.y<=Math.max(n.y,r.y)&&e.y>=Math.min(n.y,r.y)}function Gb(n){return n>0?1:n<0?-1:0}function a1(n,e){return ls(n.prev,n,n.next)<0?ls(n,e,n.next)>=0&&ls(n,n.prev,e)>=0:ls(n,e,n.prev)<0||ls(n,n.next,e)<0}function D8(n,e){var r=new QI(n.i,n.x,n.y),s=new QI(e.i,e.x,e.y),c=n.next,d=e.prev;return n.next=e,e.prev=n,r.next=c,c.prev=r,s.next=r,r.prev=s,d.next=s,s.prev=d,s}function ZL(n,e,r,s){var c=new QI(n,e,r);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function l1(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function QI(n,e,r){this.i=n,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function KI(n,e,r,s){for(var c=0,d=e,_=r-s;d<r;d+=s)c+=(n[_]-n[d])*(n[d+1]+n[_+1]),_=d;return c}function ase(n){return n.filter(e=>e.geometry.type==="MultiPolygon").forEach(e=>{const{geometry:r,properties:s,type:c}=e;if(r.type==="MultiPolygon")for(let d=0;d<r.coordinates.length;d++)n.push(Object.assign(Object.assign({},e),{geometry:Object.assign(Object.assign({},r),{type:"Polygon",coordinates:r.coordinates[d]})}))}),n.filter(e=>e.geometry.type==="Polygon").map(e=>{const{geometry:r,properties:s}=e,c=wT.flatten(r.coordinates),d=new Float32Array(c.vertices.map((j,Q)=>{return Q%2==1?(te=j,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+te*Math.PI/360)))/360):(180+j)/360;var te})),_=wT(c.vertices,c.holes,c.dimensions),x=_.length>256?new Uint16Array(_):new Uint8Array(_),l=function(j){const{height:Q=0,levels:te=0,render_height:ce=0}=j;return te?3.04*te:Math.max(Q,ce)}(s),S=s.highlight||!1;let D=0,I=0,V=0;for(let j=0;j<d.length;j+=2)D+=d[j],I+=d[j+1],V++;return{aPosition:d,cuts:x,buildingHeight:l,centroid:[D/V,I/V],highlight:S}})}wT.deviation=function(n,e,r,s){var c=e&&e.length,d=c?e[0]*r:n.length,_=Math.abs(KI(n,0,d,r));if(c)for(var x=0,l=e.length;x<l;x++){var S=e[x]*r,D=x<l-1?e[x+1]*r:n.length;_-=Math.abs(KI(n,S,D,r))}var I=0;for(x=0;x<s.length;x+=3){var V=s[x]*r,j=s[x+1]*r,Q=s[x+2]*r;I+=Math.abs((n[V]-n[Q])*(n[j+1]-n[V+1])-(n[V]-n[j])*(n[Q+1]-n[V+1]))}return _===0&&I===0?0:Math.abs((I-_)/_)},wT.flatten=function(n){for(var e=n[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,c=0;c<n.length;c++){for(var d=0;d<n[c].length;d++)for(var _=0;_<e;_++)r.vertices.push(n[c][d][_]);c>0&&(s+=n[c-1].length,r.holes.push(s))}return r};const Q_=(n,e)=>{const{lat:r,lng:s}=n;return new In(((c,d)=>(c+180)/360*Math.pow(2,d)*256)(s,e),((c,d)=>(1-Math.log(Math.tan(c*Math.PI/180)+1/Math.cos(c*Math.PI/180))/Math.PI)/2*Math.pow(2,d)*256)(r,e))},K_=(n,e)=>{return new Es((r=n.y,s=e,c=Math.PI-2*Math.PI*r/256/Math.pow(2,s),180/Math.PI*Math.atan(.5*(Math.exp(c)-Math.exp(-c)))),function(d,_){return d/256/Math.pow(2,_)*360-180}(n.x,e));var r,s,c};let XL,xd={heightMapTex:null,width:0,height:0,visibleDEMPixelBounds:new fu(new In(0,0),new In(0,0)),DEMPixelBounds:new fu(new In(0,0),new In(0,0)),maxHeight:8848,raster:[],demZoom:0,dirty:!1,outputWidth:0,outputHeight:0};const lse=n=>pc(void 0,void 0,void 0,function*(){const{demZoom:e,getFeatures:r,terrainSource:s,canopySource:c,dsmSource:d,tileLoaded:_,gl:x,bounds:l,buildingRasterizer:S,tileMerger:D,canopyMerger:I,forceUpdate:V=!1}=n,{getSourceUrl:j,getElevation:Q,maxZoom:te,tileSize:ce,_overzoom:Ce}=s,Me=(Ie={getFeatures:r},pc(void 0,void 0,void 0,function*(){const{getFeatures:Te}=Ie;try{return ase(yield Te())}catch(Ge){console.log("Error merging buildings",Ge)}return[]}));var Ie;try{const Te=l,Ge=Te.getNorthWest(),$e=Te.getSouthEast(),ue=new fu(Q_(Ge,e),Q_($e,e));let pe=new In(ue.min.x,ue.min.y),_e=ue.max.x-ue.min.x;const ge=ue.max.y-ue.min.y,Fe=ue.max.subtract(ue.min);Fe.y>Fe.x&&(pe.x-=256,_e+=512);const De=(Er=>{const{upperLeft:be,width:Ae,height:Ze}=Er,lt=be.divideBy(256).floor().multiplyBy(256),Ee=256*(Math.ceil(Ae/256)+1),Ft=256*(Math.ceil(Ze/256)+1),ft=lt.add([Ee,Ft]);return new fu(lt,ft)})({upperLeft:pe,width:_e,height:ge}),{x:Se,y:pr}=De.max.subtract(De.min),or=(Er=>{Er.sort((Ze,lt)=>Ze.y!==lt.y?Ze.y-lt.y:Ze.x-lt.x);const be=Er.reduce((Ze,lt)=>lt.x<Ze.x?lt:Ze).x,Ae=Er.reduce((Ze,lt)=>lt.y<Ze.y?lt:Ze).y;return Er.map(Ze=>{const lt=Math.pow(2,Ze.z);return{x:(Ze.x%lt+lt)%lt,y:(Ze.y%lt+lt)%lt,z:Ze.z,xOffset:256*(Ze.x-be),yOffset:256*(Ze.y-Ae)}})})((Er=>{const{upperLeft:be,width:Ae,height:Ze,zoom:lt}=Er,Ee=be.divideBy(256).floor(),Ft=Ee.x+Ae/256,ft=Math.min(Ee.y+Ze/256,Math.pow(2,lt)-1),nt=[];for(var Ot=Ee.x;Ot<Ft;Ot++)for(var Mt=Ee.y;Mt<ft;Mt++)nt.push({x:Ot,y:Mt,z:lt});return nt})({upperLeft:De.min,width:Se,height:pr,zoom:e})),Vt=ue.max.x-ue.min.x,Ht=ue.max.y-ue.min.y,Kt=Math.round(Vt),Tr=Math.round(Ht),We=JSON.stringify(or);if(!V&&We===XL&&e<te)return xd=Object.assign(Object.assign({},xd),{outputWidth:Kt,outputHeight:Tr,visibleDEMPixelBounds:ue,demZoom:e,dirty:!0}),xd;const Sr=[D.merge(or,{maxZoom:te,width:Se,height:pr,crossOrigin:"Anonymous",getSourceUrl:j,getElevation:Q,tileSize:ce,tileLoaded:_})];if(c!==void 0){const Er=I.merge(or,{maxZoom:c.maxZoom,width:Se,height:pr,crossOrigin:"Anonymous",getSourceUrl:c.getSourceUrl,getElevation:c.getElevation,tileSize:c.tileSize,tileLoaded:_});Sr.push(Er)}else Sr.push(new Promise(Er=>{const be=x.createTexture();x.activeTexture(x.TEXTURE2),x.bindTexture(x.TEXTURE_2D,be),x.texImage2D(x.TEXTURE_2D,0,x.RGBA,1,1,0,x.RGBA,x.UNSIGNED_BYTE,new Uint8ClampedArray([0,0,0,0])),Er(be)}));const[Xt,ei]=yield Promise.all(Sr);if(Xt===null||ei===null)return xd=Object.assign(Object.assign({},xd),{visibleDEMPixelBounds:ue,demZoom:e,dirty:!1}),xd;const Fr=new fu(Q_(new bc(d.bounds).getNorthWest(),e),Q_(new bc(d.bounds).getSouthEast(),e)),gi=Fr.min.subtract(De.min),qr=Fr.max.subtract(De.min),yt=[gi.x/Se,gi.y/pr,qr.x/Se,qr.y/pr].map(Er=>2*Er-1),dt=yield Me,{maxHeight:jt,heightMapTex:$t}=S.raster({upperLeftTile:or[0],width:Se,height:pr,mapZoom:e,features:dt,imageData:Xt,gl:x,dsmSource:d,dsmCoords:yt,canopyData:ei}),Mr=Math.max(d.maxHeight,Xt.maxHeight+jt);XL=We,xd={heightMapTex:$t,maxHeight:Mr,width:Se,height:pr,DEMPixelBounds:De,visibleDEMPixelBounds:ue,raster:or,demZoom:e,dirty:!0,outputWidth:Kt,outputHeight:Tr}}catch(Te){console.error("Could not decode height map",Te)}return xd}),J_=(n,e)=>{const{r,g:s,b:c}=n;return[r/255,s/255,c/255,e]},YL=(n,e)=>{const{date:r}=e,{dec:s,Hi:c}=bT(r);n.updateDate({dec:s,Hi:c})},QL=(n,e)=>pc(void 0,void 0,void 0,function*(){return yield n.updateDateRange(Object.assign({},e))}),KL=(n,e)=>{const{color:r,opacity:s}=e,c=J_(r,s);n.updateColor({colorVec:c})},cse=n=>{const{kernel:e,map:r,heightMap:s,now:c,color:d,opacity:_,belowCanopy:x,skipRender:l}=n;try{const{heightMapTex:S,outputHeight:D,outputWidth:I,maxHeight:V,width:j,height:Q,DEMPixelBounds:te,visibleDEMPixelBounds:ce,demZoom:Ce}=s;if(j===0||Q===0)return;const{min:Me,max:Ie}=ce;if(!Me||!Ie)return;const{x:Te,y:Ge}=Ie.subtract(Me),$e=te.min,ue=r.getPixelDimensions(),pe=r.screenUnproject([0,0]),_e=r.screenUnproject([ue.width,0]),ge=r.screenUnproject([ue.width,ue.height]),Fe=r.screenUnproject([0,ue.height]),De=[Fe,ge,pe,_e].map(We=>r.project(We,Ce)),Se=De.map(We=>[(We.x-$e.x)/j,(We.y-$e.y)/Q]).flat(),pr=De.map(We=>[(We.x-Me.x)/Te,(We.y-Me.y)/Ge]).map(We=>[2*We[0]-1,(2*We[1]-1)*(r.isLeaflet()?-1:1)]).flat(),or=$e.y/256/Math.pow(2,Ce),Vt=Q/256/Math.pow(2,Ce),Ht=new bc(K_(te.getTopLeft(),Ce),K_(te.getBottomRight(),Ce)),Kt=Ht.getWest(),Tr=Math.abs(Ht.getWest()-Ht.getEast());((We,Sr)=>{const{color:Xt,opacity:ei,date:Fr}=Sr,gi=J_(Xt,ei),{dec:qr,Hi:yt}=bT(Fr);We.updateHeightMap(Object.assign({dec:qr,Hi:yt,colorVec:gi,step:1},Sr))})(e,{heightMapTex:S,maxHeight:V,width:j,height:Q,heightMapZoom:Ce,cornerTextureCoords:Se,cornerClipCoords:pr,topYCoord:or,ySize:Vt,west:Kt,dLng:Tr,date:c,color:d,opacity:_,outputHeight:D,outputWidth:I,belowCanopy:x,skipRender:l})}catch(S){console.error("EXCEPTION",S)}},q_=n=>{const{gl:e}=n,{texture:r,imageData:s=null,format:c=e.RGBA,width:d,height:_,filter:x=e.NEAREST,wrap:l=e.CLAMP_TO_EDGE,type:S=e.UNSIGNED_BYTE,internalFormat:D=c}=n;e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,l),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,l),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,x),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,x),e.texImage2D(e.TEXTURE_2D,0,D,d,_,0,c,S,s)};function MR(n){const{gl:e,vSrc:r,fSrc:s}=n,c=e.createShader(e.VERTEX_SHADER);e.shaderSource(c,r),e.compileShader(c);const d=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(d,s),e.compileShader(d);const _=e.createProgram();return e.attachShader(_,c),e.attachShader(_,d),e.linkProgram(_),_}class use{constructor(e){this.gl=e,this.program=MR({gl:e,vSrc:`
uniform vec3 xyz;
uniform vec2 dimensions;
uniform bool use_dsm;
uniform vec2 u_centroid;
uniform sampler2D height_map;
attribute vec2 dsm_position;
attribute vec2 a_position;
varying vec2 vCoord;
varying float v_use_dsm;
varying vec4 v_elevation;

	void main() {
		if (use_dsm == true) {
			gl_Position = vec4(a_position, 0, 1);
			vCoord = dsm_position;
      v_use_dsm = 1.0;
			return;
		}
		if (abs(a_position) == vec2(1,1)) {
			gl_Position = vec4(a_position, 0, 1);
			vCoord = a_position * 0.5 + 0.5;
			return;
		}
		float x = a_position.x - xyz.x;
		float y = a_position.y - xyz.y;
		vec2 transformed = vec2(x, y);
		vec2 normalized = transformed / dimensions;
		vec2 final = normalized * 2.0 - 1.0;
    v_elevation = texture2D(height_map, vec2(u_centroid.x, u_centroid.y));
    vCoord = normalized;
		gl_Position = vec4(final, 0, 1);
	}
`,fSrc:`
#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
#else
  precision mediump float;
#endif

uniform vec4 color;
uniform sampler2D height_map;
uniform sampler2D canopy_map;
varying vec2 vCoord;
varying float v_use_dsm;
varying vec4 v_elevation;

vec4 addElevation(vec4 color, vec4 toAdd) {
  float ground = (color.r * 255.0 * 255.0 + color.g * 255.0);
  float building = (toAdd.r * 255.0 * 255.0 + toAdd.g * 255.0);
  float elevation = ground + building;
  float r = floor(elevation / 255.0) / 255.0;
  float g = floor(mod(elevation, 255.0)) / 255.0;
  return vec4(r, g, r, g);
}

void main() {
	if (color == vec4(1,1,1,1)) {
	 	vec4 textureColor = texture2D(height_map, vec2(vCoord.x, vCoord.y));
	 	vec4 canopyColor = texture2D(canopy_map, vec2(vCoord.x, vCoord.y));
    if (v_use_dsm == 1.0) {
	 	  gl_FragColor = vec4(0.0, 0.0, textureColor.b, textureColor.a);
      if (gl_FragColor.zw == vec2(0.0)) {
        discard;
      }
    } else {
      float upper = textureColor.r + canopyColor.r;
      float combined = textureColor.g + canopyColor.g;
      if (combined > 1.0) {
        combined = combined - floor(combined);
        upper += 1.0 / 255.0;
      }
      gl_FragColor = vec4(textureColor.r, textureColor.g, upper, combined);
    }
    // DSM noData values should not be included in heightMap because they produce ugly borders
		return;
  }
  if (color == vec4(0,0,0,0)) {
	 	vec4 textureColor = texture2D(height_map, vec2(vCoord.x, vCoord.y));
    gl_FragColor = vec4(textureColor.r, textureColor.g, textureColor.r, textureColor.g);
    return;
  }
  vec4 final = addElevation(v_elevation, color);
	gl_FragColor = final;
}
`}),this.positionAttributeLocation=e.getAttribLocation(this.program,"a_position"),this.dsmAttributeLocation=e.getAttribLocation(this.program,"dsm_position"),this.useDSMUniformLocation=e.getUniformLocation(this.program,"use_dsm"),this.xyzUniformLocation=e.getUniformLocation(this.program,"xyz"),this.dimensionsUniformLocation=e.getUniformLocation(this.program,"dimensions"),this.heightMapUniformLocation=e.getUniformLocation(this.program,"height_map"),this.canopyMapUniformLocation=e.getUniformLocation(this.program,"canopy_map"),this.centroidUniformLocation=e.getUniformLocation(this.program,"u_centroid"),this.colorUniformLocation=e.getUniformLocation(this.program,"color"),this.positionBuffer=e.createBuffer(),this.dsmBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.targetTexture=e.createTexture()}raster(e){const{features:r,upperLeftTile:s,mapZoom:c,width:d,height:_,imageData:x,dsmCoords:l,dsmSource:S,canopyData:D,gl:I}=e,{x:V,y:j,z:Q}=s;let te=0;I.useProgram(this.program),I.activeTexture(I.TEXTURE1),I.bindTexture(I.TEXTURE_2D,x),I.activeTexture(I.TEXTURE2),I.bindTexture(I.TEXTURE_2D,D);const ce=d,Ce=_;I.activeTexture(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,this.targetTexture),I.texImage2D(I.TEXTURE_2D,0,I.RGBA,ce,Ce,0,I.RGBA,I.UNSIGNED_BYTE,null),c>15&&r.length>5?(I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.NEAREST),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.NEAREST)):(I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.LINEAR)),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.viewport(0,0,ce,Ce);const Me=I.createFramebuffer();I.bindFramebuffer(I.FRAMEBUFFER,Me);const Ie=I.COLOR_ATTACHMENT0;I.framebufferTexture2D(I.FRAMEBUFFER,Ie,I.TEXTURE_2D,this.targetTexture,0),I.disable(I.BLEND),I.bindBuffer(I.ARRAY_BUFFER,this.positionBuffer),I.bindBuffer(I.ELEMENT_ARRAY_BUFFER,this.indexBuffer),I.clearColor(0,0,0,0),I.clear(I.COLOR_BUFFER_BIT);const Te=V/Math.pow(2,Q),Ge=j/Math.pow(2,Q),$e=new In(Te,Ge),ue=d/256/Math.pow(2,Q),pe=_/256/Math.pow(2,Q);I.uniform3f(this.xyzUniformLocation,Te,Ge,Q),I.uniform2f(this.dimensionsUniformLocation,ue,pe),I.uniform1i(this.heightMapUniformLocation,1),I.uniform1i(this.canopyMapUniformLocation,2),I.uniform1i(this.useDSMUniformLocation,0);const _e=new Float32Array([-1,-1,1,-1,-1,1,1,1]);if(I.enableVertexAttribArray(this.positionAttributeLocation),I.bufferData(I.ARRAY_BUFFER,_e,I.STATIC_DRAW),I.vertexAttribPointer(this.positionAttributeLocation,2,I.FLOAT,!1,0,0),I.uniform4f(this.colorUniformLocation,1,1,1,1),I.drawArrays(I.TRIANGLE_STRIP,0,4),r.filter(ge=>!ge.highlight).forEach(ge=>{const{buildingHeight:Fe,aPosition:De,cuts:Se,centroid:pr,highlight:or}=ge,Vt=new In(pr[0],pr[1]).subtract($e).unscaleBy(new In(ue,pe)).scaleBy(new In(d,_)).floor();if(Vt.x<0||Vt.y<0||Vt.x>d||Vt.y>_)return;const Ht=Vt.x/d,Kt=Vt.y/_,Tr=5*Fe,We=Math.floor(Tr/255)/255,Sr=Math.floor(Tr%255)/255;te=Math.max(te,Fe),I.uniform2f(this.centroidUniformLocation,Ht,Kt),I.uniform4f(this.colorUniformLocation,We,Sr,We,Sr),I.bufferData(I.ARRAY_BUFFER,De,I.DYNAMIC_DRAW),I.vertexAttribPointer(this.positionAttributeLocation,2,I.FLOAT,!1,0,0),I.bufferData(I.ARRAY_BUFFER,De,I.DYNAMIC_DRAW),I.vertexAttribPointer(this.dsmAttributeLocation,2,I.FLOAT,!1,0,0),I.bufferData(I.ELEMENT_ARRAY_BUFFER,Se,I.DYNAMIC_DRAW),I.drawElements(I.TRIANGLES,Se.length,Se.length>256?I.UNSIGNED_SHORT:I.UNSIGNED_BYTE,0)}),S.data.length!==0){I.activeTexture(I.TEXTURE1);const ge=I.createTexture();I.bindTexture(I.TEXTURE_2D,ge),I.pixelStorei(I.UNPACK_ALIGNMENT,2),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.NEAREST),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.NEAREST),I.texImage2D(I.TEXTURE_2D,0,I.LUMINANCE_ALPHA,S.width,S.height,0,I.LUMINANCE_ALPHA,I.UNSIGNED_BYTE,S.data),I.pixelStorei(I.UNPACK_ALIGNMENT,4);const Fe=[l[0],l[3],l[2],l[3],l[0],l[1],l[2],l[1]],De=new Float32Array(Fe);I.enableVertexAttribArray(this.positionAttributeLocation),I.bufferData(I.ARRAY_BUFFER,De,I.STATIC_DRAW),I.vertexAttribPointer(this.positionAttributeLocation,2,I.FLOAT,!1,0,0),I.enableVertexAttribArray(this.dsmAttributeLocation),I.bindBuffer(I.ARRAY_BUFFER,this.dsmBuffer),I.bufferData(I.ARRAY_BUFFER,new Float32Array([0,1,1,1,0,0,1,0]),I.STATIC_DRAW),I.vertexAttribPointer(this.dsmAttributeLocation,2,I.FLOAT,!1,0,0),I.uniform4f(this.colorUniformLocation,1,1,1,1),I.uniform1i(this.useDSMUniformLocation,1),I.colorMask(!1,!1,!0,!0),I.drawArrays(I.TRIANGLE_STRIP,0,4),I.deleteTexture(ge)}return I.colorMask(!0,!0,!0,!0),I.activeTexture(I.TEXTURE1),I.bindTexture(I.TEXTURE_2D,x),I.activeTexture(I.TEXTURE2),I.bindTexture(I.TEXTURE_2D,D),I.uniform1i(this.useDSMUniformLocation,0),r.filter(ge=>ge.highlight).forEach(ge=>{const{buildingHeight:Fe,aPosition:De,cuts:Se,centroid:pr,highlight:or}=ge,Vt=new In(pr[0],pr[1]).subtract($e).unscaleBy(new In(ue,pe)).scaleBy(new In(d,_)).floor();if(Vt.x<0||Vt.y<0||Vt.x>d||Vt.y>_)return;const Ht=Vt.x/d,Kt=Vt.y/_,Tr=5*Fe,We=Math.floor(Tr/255)/255,Sr=Math.floor(Tr%255)/255;te=Math.max(te,Fe),I.uniform2f(this.centroidUniformLocation,Ht,Kt),I.uniform4f(this.colorUniformLocation,We,Sr,We,Sr),I.bufferData(I.ARRAY_BUFFER,De,I.DYNAMIC_DRAW),I.vertexAttribPointer(this.positionAttributeLocation,2,I.FLOAT,!1,0,0),I.bufferData(I.ARRAY_BUFFER,De,I.DYNAMIC_DRAW),I.vertexAttribPointer(this.dsmAttributeLocation,2,I.FLOAT,!1,0,0),I.bufferData(I.ELEMENT_ARRAY_BUFFER,Se,I.DYNAMIC_DRAW),I.drawElements(I.TRIANGLES,Se.length,Se.length>256?I.UNSIGNED_SHORT:I.UNSIGNED_BYTE,0)}),I.deleteFramebuffer(Me),{maxHeight:te,heightMapTex:this.targetTexture}}}const JL=n=>{const{tile:e,maxZoom:r,tileSize:s}=n;let{x:c,y:d,z:_}=e;if(_>r){const x=Math.pow(2,e.z-r);c=Math.floor(c/x),d=Math.floor(d/x),_=r}return{x:s===256?c:Math.floor(c/2),y:s===256?d:Math.floor(d/2),z:s===256?_:_-1}};class eO{constructor(e){this.gl=e,this.program=MR({vSrc:`
      attribute vec4 a_tex_position;
      attribute vec4 a_tile_position;
      varying vec2 v_tex_pos;
      void main() {
        v_tex_pos = a_tex_position.xy;
        gl_Position = a_tile_position;
      }
    `,fSrc:`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
    #else
      precision mediump float;
    #endif
      uniform sampler2D u_texture;
      uniform float u_encoding;
      uniform float u_tile_size;
      varying vec2 v_tex_pos;

      float getElevationTerrarium(vec4 color) {
        float decoded = color.r * 255.0 * 256.0 + color.g * 255.0 + color.b * 255.0 / 256.0 - 32768.0;
        return decoded;
      }

      float getElevationMapbox(vec4 color) {
        float decoded = -10000.0 + (color.r * 255.0 * 256.0 * 256.0 + color.g * 255.0 * 256.0 + color.b * 255.0) * .1;
        return decoded;
      }

      float getElevationSwitzerland(vec4 color) {
        float decoded = ((color.r * 255.0 * 256.0 + color.g * 255.0) / pow(2.0, 16.0)) * 4808.0;
        return decoded;
      }

      float getElevationCanopy(vec4 color) {
        float closestDistance = 1000.0;
        int closestColor = 100;
        const int colorCount = 26;
        vec3 colorArray[colorCount];

        colorArray[0] = vec3(51.0 / 255.0, 0, 66.0 / 255.0);
        colorArray[1] = vec3(51.0 / 255.0, 16.0/255.0, 86.0 / 255.0);
        colorArray[2] = vec3(51.0 / 255.0, 24.0/255.0, 86.0 / 255.0);
        colorArray[3] = vec3(51.0 / 255.0, 24.0/255.0, 98.0 / 255.0);
        colorArray[4] = vec3(51.0 / 255.0, 37.0/255.0, 108.0 / 255.0);
        colorArray[5] = vec3(48.0 / 255.0, 47.0/255.0, 114.0 / 255.0);
        colorArray[6] = vec3(44.0 / 255.0, 57.0/255.0, 116.0 / 255.0);
        colorArray[7] = vec3(42.0 / 255.0, 68.0/255.0, 117.0 / 255.0);
        colorArray[8] = vec3(39.0 / 255.0, 79.0/255.0, 120.0 / 255.0);
        colorArray[9] = vec3(37.0 / 255.0, 89.0/255.0, 123.0 / 255.0);
        colorArray[10] = vec3(34.0 / 255.0, 100.0/255.0, 120.0 / 255.0);
        colorArray[11] = vec3(34.0 / 255.0, 110.0/255.0, 121.0 / 255.0);
        colorArray[12] = vec3(30.0 / 255.0, 120.0/255.0, 120.0 / 255.0);
        colorArray[13] = vec3(32.0 / 255.0, 132.0/255.0, 117.0 / 255.0);
        colorArray[14] = vec3(36.0 / 255.0, 141.0/255.0, 112.0 / 255.0);
        colorArray[15] = vec3(40.0 / 255.0, 152.0/255.0, 108.0 / 255.0);
        colorArray[16] = vec3(44.0 / 255.0, 161.0/255.0, 101.0 / 255.0);
        colorArray[17] = vec3(52.0 / 255.0, 173.0/255.0, 95.0 / 255.0);
        colorArray[18] = vec3(69.0 / 255.0, 182.0/255.0, 84.0 / 255.0);
        colorArray[19] = vec3(88.0 / 255.0, 191.0/255.0, 72.0 / 255.0);
        colorArray[20] = vec3(109.0 / 255.0, 201.0/255.0, 61.0 / 255.0);
        colorArray[21] = vec3(130.0 / 255.0, 209.0/255.0, 51.0 / 255.0);
        colorArray[22] = vec3(158.0 / 255.0, 213.0/255.0, 45.0 / 255.0);
        colorArray[23] = vec3(189.0 / 255.0, 218.0/255.0, 40.0 / 255.0);
        colorArray[24] = vec3(219.0 / 255.0, 224.0/255.0, 36.0 / 255.0);
        colorArray[25] = vec3(252.0 / 255.0, 228.0/255.0, 30.0 / 255.0);

        for (int i = 0; i < colorCount; i++) {
          float distance = sqrt(pow(color.x - colorArray[i].x, 2.0) + pow(color.y - colorArray[i].y, 2.0) + pow(color.z - colorArray[i].z, 2.0));
          if (distance < closestDistance) {
            closestDistance = distance;
            closestColor = i;
          }
        }
        if (closestColor < 3) {
          closestColor = 0;
        }

        return float(closestColor);
      }

      float getElevation(vec4 color, float encoding) {
        float decoded;
        if (encoding == 1.0) {
          decoded = getElevationMapbox(color);
        } else if (encoding == 2.0) {
          decoded = getElevationSwitzerland(color);
        } else if (encoding == 3.0) {
          decoded = getElevationCanopy(color);
        } else {
          decoded = getElevationTerrarium(color);
        }
        float scaled = decoded * 5.0;
        float elevation = max(scaled, 0.0);
        return elevation;
      }

      float textureSampleLinear(sampler2D sampler, vec2 texCoord) {
        vec2 texelSize = vec2(1.0 / u_tile_size, 1.0 / u_tile_size);
      
        // Calculate interpolation weights based on texCoord fract (fractional part)
        vec2 uv = fract(texCoord * u_tile_size);
      
        // Sample four nearest texels
        vec4 bottomLeft  = texture2D(sampler, texCoord);
        vec4 bottomRight = texture2D(sampler, texCoord + vec2(texelSize.x, 0.0));
        vec4 topLeft    = texture2D(sampler, texCoord + vec2(0.0, texelSize.y));
        vec4 topRight   = texture2D(sampler, texCoord + texelSize);

        float bottomLeftEl = getElevation(bottomLeft, u_encoding);
        float bottomRightEl = getElevation(bottomRight, u_encoding);
        float topLeftEl = getElevation(topLeft, u_encoding);
        float topRightEl = getElevation(topRight, u_encoding);
      
        // Interpolate between bottom and top rows
        float bottom = mix(bottomLeftEl, bottomRightEl, uv.x);
        float top    = mix(topLeftEl, topRightEl, uv.x);
      
        // Interpolate final color
        return mix(bottom, top, uv.y);
      }

      void main() {
        float elevation = textureSampleLinear(u_texture, v_tex_pos);
        float r = floor(elevation / 255.0) / 255.0;
        float g = floor(mod(elevation, 255.0)) / 255.0;
        gl_FragColor = vec4(r, g, r, g);

        // vec4 color = texture2D(u_texture, v_tex_pos);
        // float elevation = getElevation(color, u_encoding);
        // float r = floor(elevation / 255.0) / 255.0;
        // float g = floor(mod(elevation, 255.0)) / 255.0;
        // gl_FragColor = vec4(0, 0, r, g);
        // gl_FragColor = color;
      }
    `,gl:e}),e.useProgram(this.program),this.texPositionAttributeLocation=e.getAttribLocation(this.program,"a_tex_position"),this.tilePositionAttributeLocation=e.getAttribLocation(this.program,"a_tile_position"),this.encodingUniformLocation=e.getUniformLocation(this.program,"u_encoding"),this.tileSizeUniformLocation=e.getUniformLocation(this.program,"u_tile_size"),this.texPositionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texPositionBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(this.texPositionAttributeLocation),e.vertexAttribPointer(this.texPositionAttributeLocation,2,e.FLOAT,!1,0,0),this.tilePositionBuffer=e.createBuffer(),this.tileTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.tileTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),this.outputTexture=e.createTexture(),this.inProgress=[],this.finished=0}merge(e,r){return pc(this,void 0,void 0,function*(){const s=this.gl;let c=0;const{width:d,height:_,crossOrigin:x,getSourceUrl:l,getElevation:S,tileSize:D,tileLoaded:I,maxZoom:V}=r;if(s){this.inProgress.forEach(Me=>Me.src=""),this.inProgress=[],this.finished=0;const j=new Set;e.forEach(Me=>{j.add(l(JL({tile:Me,maxZoom:V,tileSize:D})))}),s.useProgram(this.program);let Q=0;S({r:0,g:0,b:0,a:0})===-32768&&(Q=0),S({r:0,g:0,b:0,a:0})===-1e4&&(Q=1),S({r:256,g:0,b:0,a:0})===4808&&(Q=2),S({r:51,g:0,b:66,a:0})===0&&(Q=3),s.uniform1f(this.encodingUniformLocation,Q),q_({gl:s,texture:this.outputTexture,imageData:null,format:s.RGBA,width:d,height:_,wrap:s.CLAMP_TO_EDGE,filter:s.NEAREST});const te=s.createFramebuffer();s.bindFramebuffer(s.FRAMEBUFFER,te),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.outputTexture,0);const ce=s.checkFramebufferStatus(s.FRAMEBUFFER);ce!==s.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete: "+ce),s.clear(s.COLOR_BUFFER_BIT);const Ce=Array.from(j).map(Me=>pc(this,void 0,void 0,function*(){return new Promise((Ie,Te)=>{const Ge=new Image;this.inProgress.push(Ge),Ge.onload=()=>{s.useProgram(this.program),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.tileTexture),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Ge),s.bindFramebuffer(s.FRAMEBUFFER,te);const $e=e.filter(Ae=>Me===l(JL({tile:Ae,maxZoom:V,tileSize:D}))),ue=$e.reduce((Ae,Ze)=>Math.min(Ae,Ze.xOffset),1/0),pe=$e.reduce((Ae,Ze)=>Math.min(Ae,Ze.yOffset),1/0),_e=$e.reduce((Ae,Ze)=>Math.max(Ae,Ze.xOffset),0),ge=$e.reduce((Ae,Ze)=>Math.max(Ae,Ze.yOffset),0),Fe=$e.reduce((Ae,Ze)=>Math.min(Ae,Ze.x),1/0),De=$e.reduce((Ae,Ze)=>Math.min(Ae,Ze.y),1/0),Se=$e.reduce((Ae,Ze)=>Math.max(Ae,Ze.x),0),pr=$e.reduce((Ae,Ze)=>Math.max(Ae,Ze.y),0),or=$e[0].z,Vt=ue/d,Ht=pe/_,Kt=(_e+256)/d,Tr=(ge+256)/_,We=[Vt,Ht,Kt,Ht,Vt,Tr,Kt,Tr].map(Ae=>2*Ae-1);s.bindBuffer(s.ARRAY_BUFFER,this.tilePositionBuffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array(We),s.STATIC_DRAW),s.enableVertexAttribArray(this.tilePositionAttributeLocation),s.vertexAttribPointer(this.tilePositionAttributeLocation,2,s.FLOAT,!1,0,0);let Sr=[0,0,1,0,0,1,1,1];const Xt=Math.pow(2,Math.max(0,or-V)+(D!==256?1:0)),ei=D===514?1/D:0,Fr=1/Xt,gi=Fe%Xt/Xt,qr=De%Xt/Xt,yt=Se%Xt/Xt,dt=pr%Xt/Xt;Sr=[gi,qr,yt+Fr,qr,gi,dt+Fr,yt+Fr,dt+Fr].map(Ae=>Ae*(D===514?512/514:1)+ei),s.bindBuffer(s.ARRAY_BUFFER,this.texPositionBuffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array(Sr),s.STATIC_DRAW),s.enableVertexAttribArray(this.texPositionAttributeLocation),s.vertexAttribPointer(this.texPositionAttributeLocation,2,s.FLOAT,!1,0,0),s.uniform1f(this.tileSizeUniformLocation,D),s.viewport(0,0,d,_),s.disable(s.BLEND),s.drawArrays(s.TRIANGLE_STRIP,0,4);const jt=Math.floor(Vt*d),$t=Math.floor(Ht*_),Mr=Math.ceil((Kt-Vt)*d),Er=Math.ceil((Tr-Ht)*_),be=new Uint8Array(4*Mr*Er);s.readPixels(jt,$t,Mr,Er,s.RGBA,s.UNSIGNED_BYTE,be);for(let Ae=0;Ae<be.length;Ae+=4){const Ze=(256*be[Ae+2]+be[Ae+3])/5;c=Math.max(Ze,c)}Ie(null)},Ge.onerror=$e=>{if(Ge.src!==Ge.originalSource)return Te("new tiles requested");Ie(null)},Ge.crossOrigin=x||null,Ge.src=Me,Ge.originalSource=Ge.src}).then(()=>{this.finished++,I(this.finished,this.inProgress.length)})}));try{yield Promise.all(Ce)}catch(Me){return console.log(`${Ce.length} requests aborted`,Me),null}return this.inProgress=[],this.outputTexture.maxHeight=c,s.deleteFramebuffer(te),this.outputTexture}throw new Error("Could not get canvas context for merging tile images")})}}class hse extends class extends class{constructor(){this.events={}}on(e,r){return typeof this.events[e]!="object"&&(this.events[e]=[]),this.events[e].push(r),()=>this.removeListener(e,r)}removeListener(e,r){if(typeof this.events[e]!="object")return;const s=this.events[e].indexOf(r);s>-1&&this.events[e].splice(s,1)}removeAllListeners(){Object.keys(this.events).forEach(e=>this.events[e].splice(0,this.events[e].length))}emit(e,...r){typeof this.events[e]=="object"&&[...this.events[e]].forEach(s=>s.apply(this,r))}once(e,r){const s=this.on(e,(...c)=>{s(),r.apply(this,c)});return s}}{constructor(...e){super(),this.options={date:new Date,color:"000",opacity:.3,sunExposure:{enabled:!1,startDate:new Date,endDate:new Date,iterations:32},apiKey:"",terrainSource:{maxZoom:15,tileSize:256,_overzoom:15,getSourceUrl:s=>"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/7/17/45.png",getElevation:s=>{const{r:c,g:d,b:_}=s;return 256*c+d+_/256-32768}},canopySource:void 0,dsmSource:{bounds:[{lat:0,lng:0},{lat:0,lng:0}],data:new Uint8ClampedArray,width:0,height:0,maxHeight:0},belowCanopy:!1,getFeatures:()=>Promise.resolve([]),getSize:()=>({width:Number.NaN,height:Number.NaN}),debug:s=>{}};const r=e[0];if(this.options=Object.assign(this.options,r),!this.options.apiKey)throw new Error("Could not load ShadeMap: apiKey missing");fetch("https://shademap.app/sdk/load",{method:"POST",body:JSON.stringify({api_key:this.options.apiKey}),headers:{"Content-Type":"application/json"}}).then(s=>pc(this,void 0,void 0,function*(){if(s.status!==200)throw new Error(yield s.text())})).catch(s=>pc(this,void 0,void 0,function*(){throw new Error(`Could not load ShadeMap API. Key: ${this.options.apiKey} Error: ${s}`)})),this._canvas=document.createElement("canvas"),this._color=this._parseColor(this.options.color),this._reset=this._reset.bind(this),this._draw=this._draw.bind(this)}onRemove(){return this._map&&this._map.off("moveend",this._reset),this}setDate(e){return this.options.date.getTime()!==e.getTime()?(this.options.date=e,this._compiledKernel&&(YL(this._compiledKernel,{date:this.options.date}),this._heightMap&&this._flush())):this.emit("idle"),this}_setDateForTimezone(e,r){let s=0;r&&(s=L_(this.options.date)-L_(this.options.date,r)),this.setDate(new Date(e.getTime()-s))}setColor(e){return this.options.color!==e&&(this.options.color=e,this._color=this._parseColor(this.options.color),this._compiledKernel&&(KL(this._compiledKernel,{color:this._color,opacity:this.options.opacity}),this._flush())),this}setOpacity(e){return this.options.opacity!==e&&(this.options.opacity=e,this._compiledKernel&&(KL(this._compiledKernel,{color:this._color,opacity:this.options.opacity}),this._flush())),this}setBelowCanopy(e){return this.options.belowCanopy=e,this._heightMap?this._draw(this._heightMap):this._reset(),this}setTerrainSource(e){return this.options.terrainSource=e,delete this._heightMap,this._reset(),this}setCanopySource(e){return this.options.canopySource=e,delete this._heightMap,this._reset(),this}setDSMSource(e){return this.options.dsmSource=e,delete this._heightMap,this._reset(),this}setSunExposure(e=!1,r){return pc(this,void 0,void 0,function*(){if(this.options.sunExposure=Object.assign(Object.assign({},this.options.sunExposure),{enabled:e}),r){const{startDate:s=new Date,endDate:c=new Date,iterations:d=32}=r;this.options.sunExposure={enabled:e,startDate:s,endDate:c,iterations:d}}if(this._map&&this._compiledKernel&&this._heightMap){if(e===!1)YL(this._compiledKernel,{date:this.options.date});else{const{startDate:s,endDate:c,iterations:d}=this.options.sunExposure;if(!(s instanceof Date&&c instanceof Date))throw new Error("Start date or end date or both are missing");if(c.getTime()<s.getTime())throw new Error("End date must come after the start date to calculate sun exposure");if((yield QL(this._compiledKernel,{startDate:s,endDate:c,iterations:d,emit:this.emit.bind(this)}))===!0)return this}this._flush()}return this})}_lngLatToTextureCoords(e){if(this._heightMap){const{DEMPixelBounds:r,demZoom:s,width:c,height:d}=this._heightMap,_=r.min;return e.map(x=>{const l=Q_(x,s);return[(l.x-_.x)/c,(l.y-_.y)/d]})}return[]}_getBounds(e,r){const{width:s,height:c}=this.options.getSize();if(Number.isNaN(s)||Number.isNaN(c))return e.getBounds();const d=e.getCenter(),_=Q_(d,r),x=K_(new In(_.x-s/2,_.y-c/2),r),l=K_(new In(_.x+s/2,_.y+c/2),r);return e.createBounds({nw:x,se:l})}_getDEMZoom(e){const r=Math.min(this.options.terrainSource._overzoom||this.options.terrainSource.maxZoom,e.getZoom());return Math.round(r)}_reset(){return pc(this,void 0,void 0,function*(){if(this.options.debug("_reset()"),this._map){const e=Vy(this._map);let r=this._getDEMZoom(e);try{this._bounds=this._getBounds(e,r)}catch(c){return console.error("Invalid bounds returned: ",c),this}try{if(!e.isLeaflet()&&this._map.getPitch()>45){yield new Promise(j=>{this._map.loaded()?j(!0):this._map.once("idle",function(){j(!0)})});const c=this._map.style._sourceCaches["other:composite"].getVisibleCoordinates().reverse(),d=c.reduce((j,Q)=>Math.max(j,Q.canonical.z),Number.MIN_SAFE_INTEGER),_=c.filter(j=>j.canonical.z===d).map(j=>j.canonical),[x,l,S,D]=_.reduce((j,Q)=>[Math.min(j[0],Q.x),Math.min(j[1],Q.y),Math.max(j[2],Q.x),Math.max(j[3],Q.y)],[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER]),I=K_(new In(512*x,512*l),d+1),V=K_(new In(512*(S+1),512*(D+1)),d+1);r=d+1,this._bounds=e.createBounds({nw:I,se:V})}}catch(c){console.log("Mapbox tile optimization failed",c)}const s=yield lse({gl:this._gl,demZoom:r,bounds:this._bounds,terrainSource:this.options.terrainSource,canopySource:this.options.canopySource,dsmSource:this.options.dsmSource,getFeatures:this.options.getFeatures,buildingRasterizer:this._buildingRasterizer,tileMerger:this._tileMerger,canopyMerger:this._canopyMerger,tileLoaded:(c,d)=>this.emit("tileloaded",c,d),forceUpdate:!this._heightMap});this._heightMap=s,s.dirty&&(yield this._draw(s))}return this})}_draw(e){return pc(this,void 0,void 0,function*(){if(this.options.debug("_draw()"),this._canvas&&this._compiledKernel&&this._map){if(cse({kernel:this._compiledKernel,map:Vy(this._map),heightMap:e,color:this._color,belowCanopy:this.options.belowCanopy,opacity:this.options.opacity,now:this.options.date,maxZoom:this.options.terrainSource.maxZoom,skipRender:this.options.sunExposure.enabled}),this.options.sunExposure.enabled){const{startDate:r,endDate:s,iterations:c}=this.options.sunExposure;if((yield QL(this._compiledKernel,{startDate:r,endDate:s,iterations:c,emit:this.emit.bind(this)}))===!0)return this}this._bounds&&this._repositionCanvas(this._bounds)}return this})}readPixel(e,r){const s=new Uint8Array(4);return this._gl&&this._gl.readPixels(e,r,1,1,this._gl.RGBA,this._gl.UNSIGNED_BYTE,s),s}readPixels(e,r,s,c){const d=new Uint8Array(s*c*4);return this._gl&&this._gl.readPixels(e,r,s,c,this._gl.RGBA,this._gl.UNSIGNED_BYTE,d),d}toGeoTiff(){const e=(r,s)=>{const c=this.readPixels(0,0,r,s),d=r*s*1,_=1*r,x=(s-1)*_,l=new Uint8Array(d),S=new Uint8Array(d);let D=0;const{startDate:I,endDate:V}=this.options.sunExposure;this.options.sunExposure.enabled&&I&&V&&(D=V.getTime()-I.getTime());for(let j=0;j<c.length;j+=4){let Q;if(this.options.sunExposure.enabled){const te=c.subarray(j,j+3),ce=yA(te,.5,D)/1e3/60,Ce=Math.min(Math.floor(ce/6),255);Q=new Uint8Array([Ce])}else Q=c[j]+c[j+1]+c[j+2]===0?new Uint8Array([255]):new Uint8Array([0]);l.set(Q,j/4*1)}if(this._map&&!Vy(this._map).isLeaflet())return l;for(let j=0;j<d;j+=_)S.set(l.subarray(j,j+_),x-j);return S};if(this._map&&this._heightMap){const r=this._heightMap.outputWidth,s=this._heightMap.outputHeight,c=e(r,s),d=Vy(this._map),{lat:_,lng:x}=d.getBounds().getNorthWest(),l=d.getBounds().getSouthEast(),S=[0,0,0,x,_,0],D=[(l.lng-x)/r,(_-l.lat)/s,0];return this.options.sunExposure.enabled,{data:c,metadata:{width:r,height:s,ModelTiepoint:S,ModelPixelScale:D,GeographicTypeGeoKey:4326,GeogCitationGeoKey:"WGS 84"}}}return null}_generateShadeProfile(e){if(this._compiledKernel){const r=this._lngLatToTextureCoords(e.locations);return((s,c)=>{const d=J_({r:c.sunColor[0],g:c.sunColor[1],b:c.sunColor[2]},1),_=J_({r:c.shadeColor[0],g:c.shadeColor[1],b:c.shadeColor[2]},1);return s.generateShadeProfile(Object.assign(Object.assign({},c),{sunColor:d,shadeColor:_}))})(this._compiledKernel,Object.assign(Object.assign({},e),{texCoords:r}))}return new Uint8Array}_generateLocationShadeProfile(e){if(this._compiledKernel){const r=L_(e.startDate)-L_(e.startDate,e.tzId),s=e.startDate.getTime()-r,c=e.endDate.getTime()-r,d=this._lngLatToTextureCoords([e.location])[0],{output:_,outputWidth:x,outputHeight:l}=((S,D)=>{const I=J_({r:D.sunColor[0],g:D.sunColor[1],b:D.sunColor[2]},1),V=J_({r:D.shadeColor[0],g:D.shadeColor[1],b:D.shadeColor[2]},1);return S.generateLocationShadeProfile(Object.assign(Object.assign({},D),{sunColor:I,shadeColor:V}))})(this._compiledKernel,Object.assign(Object.assign({},e),{startTime:s,endTime:c,texCoord:d}));return _.toArray=function(){const S=new Array;for(let D=0;D<x;D++){const I=[];for(let V=l-1;V>=0;V--){const j=V*x*4+4*D,Q=this.slice(j,j+4);I.push(Q.join("")===e.sunColor.join("")?1:0)}S.push(I)}return S},{data:_,width:x,height:l}}return{data:new Uint8Array,width:0,height:0}}getHoursOfSun(e,r){if(this.options.sunExposure.enabled){const s=this.readPixel(e,r),{startDate:c,endDate:d}=this.options.sunExposure,_=d.getTime()-c.getTime(),x=yA(s,.5,_);return Math.abs(x/1e3/3600)}return 0}_repositionCanvas(e){}_flush(){}flushSync(){this._gl&&this._gl.finish()}_parseColor(e){e=e.replace("#","");const r={r:0,g:0,b:0};return/^([0-9A-F]{3}){1,2}$/i.test(e)&&(e.length===3?(r.r=parseInt(e[0]+e[0],16),r.g=parseInt(e[1]+e[1],16),r.b=parseInt(e[2]+e[2],16)):e.length===6&&(r.r=parseInt(e[0]+e[1],16),r.g=parseInt(e[2]+e[3],16),r.b=parseInt(e[4]+e[5],16))),r}}{constructor(e){super(e),this.id="shademap-layer",this.type="custom",this.canvasSourceId="canvas-source",this.attributionSourceId="attribution-source",this.canvasLayerId="canvas-layer",this.attributionLayerId="attribution-layer",this._refreshing=0,this._raf=0,this.id=this.id+By(),this.canvasSourceId=this.canvasSourceId+By(),this.attributionSourceId=this.attributionSourceId+By(),this.canvasLayerId=this.canvasLayerId+By(),this.attributionLayerId=this.attributionLayerId+By(),this.options.terrainSource.tileSize>256&&(this.options.terrainSource.maxZoom=this.options.terrainSource.maxZoom+1),this._moveEndHandler=()=>{this._map&&this._reset()}}render(e,r){}addTo(e){return e.addLayer(this),this}onAdd(e){this._map=e,this._gl=this._map.painter.context.gl,this._framebuffer=this._gl.createFramebuffer(),this._compiledKernel=function(l){const{context:S,setRenderBuffer:D}=l,I=S,V=MR({gl:I,vSrc:"precision lowp float;precision lowp int;precision lowp sampler2D;attribute vec2 a_pos;attribute vec2 a_tex_pos;varying vec2 vTexCoordCropped;varying vec2 vTexCoordFull;void main(void){gl_Position=vec4(a_pos,0,1);vTexCoordFull=(gl_Position*0.5+0.5).xy;vTexCoordCropped=a_tex_pos;}",fSrc:`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
precision lowp int;precision lowp sampler2D;float atan2(float v1,float v2){if(v1==0.0||v2==0.0)return 0.0;return atan(v1,v2);}float _pow(float v1,float v2){if(v2==0.0)return 1.0;return pow(v1,v2);}float integerMod(float x,float y){float res=floor(mod(x,y));return res*(res>floor(y)-1.0 ? 0.0 : 1.0);}float divWithIntCheck(float x,float y){if(floor(x)==x&&floor(y)==y&&integerMod(x,y)==0.0){return float(int(x)/int(y));}return x/y;}float integerCorrectionModulo(float number,float divisor){if(number<0.0){number=abs(number);if(divisor<0.0){divisor=abs(divisor);}return-(number-(divisor*floor(divWithIntCheck(number,divisor))));}if(divisor<0.0){divisor=abs(divisor);}return number-(divisor*floor(divWithIntCheck(number,divisor)));}float getDEMElevationFromSampler2D(sampler2D tex,float x,float y){vec4 result=texture2D(tex,vec2(x,y));return(result.r*255.0*256.0+result.g*255.0)/5000.0;}float getDSMElevationFromSampler2D(sampler2D tex,float x,float y){vec4 result=texture2D(tex,vec2(x,y));return(result.b*255.0*256.0+result.a*255.0)/5000.0;}vec4 actualColor;void color(float r,float g,float b,float a){actualColor=vec4(r,g,b,a);}void color(float r,float g,float b){color(r,g,b,1.0);}void color(float r){color(r,r,r,1.0);}void color(vec4 color){actualColor=color;}const int LOOP_MAX=1000;varying vec2 vTexCoordCropped;varying vec2 vTexCoordFull;uniform sampler2D user_a;uniform float user_width;uniform float user_height;uniform float user_maxHeight;uniform float user_zoom;uniform float user_topYCoord;uniform float user_ySize;uniform vec4 user_color;uniform vec4 u_sunColor;uniform float user_step;uniform float user_west;uniform float user_dLng;uniform float user_dec;uniform float user_Hi;uniform bool u_below_canopy;uniform sampler2D user_sunExposureTexture;uniform bool user_outputSunExposure;uniform bool u_outputShadeProfile;uniform sampler2D u_decHiTexture;uniform sampler2D u_gpxTexture;uniform bool u_outputLocationShadeProfile;uniform vec2 u_shadeProfileLocation;float kernelResult;void kernel(){float sunDec=user_dec;float sunHi=user_Hi;vec4 shade_color=user_color;float maxHeight=user_maxHeight/1000.0;float user_x=vTexCoordCropped.x;float user_y=vTexCoordCropped.y;if(u_outputShadeProfile==true){vec4 decHi=texture2D(u_decHiTexture,vec2(vTexCoordFull.x,1.0-vTexCoordFull.y));sunDec=-decHi.r;sunHi=decHi.g*10.0;vec4 gpx=texture2D(u_gpxTexture,vec2(vTexCoordFull.x,.5));user_x=gpx.x;user_y=gpx.y;}if(u_outputLocationShadeProfile==true){vec4 decHi=texture2D(u_decHiTexture,vec2(vTexCoordFull.x,1.0-vTexCoordFull.y));sunDec=-decHi.r;sunHi=decHi.g*10.0;user_x=u_shadeProfileLocation.x;user_y=u_shadeProfileLocation.y;}float user_lit=1.0;float dsm_height=getDSMElevationFromSampler2D(user_a,user_x,user_y);if(u_below_canopy==true){float dem_height=getDEMElevationFromSampler2D(user_a,user_x,user_y);if(dsm_height-dem_height>.002){user_lit=0.0;}}float user_z=dsm_height;float user_PI=3.141592653589793;float user_2PI=6.283185307179586;float earthRadiusInKm=6378.137;float user_deg=57.29577951308232;float user_y_coord=user_topYCoord+(user_y*user_ySize);float user_lat_coord=(user_y_coord-0.5)/-0.15915494309189532;float user_lat=(2.0*atan(exp(user_lat_coord)))-(user_PI/2.0);float user_rad=0.017453292519943295;float user_lng=user_west+(user_dLng*user_x);float user_H=integerCorrectionModulo((sunHi-(user_rad*-user_lng)),user_2PI);float sun_azimuth=atan2(sin(user_H),((cos(user_H)*sin(user_lat))-(tan(sunDec)*cos(user_lat))));float sun_altitude=asin(((sin(user_lat)*sin(sunDec))+((cos(user_lat)*cos(sunDec))*cos(user_H))));float user_zoom_factor=_pow(2.0,user_zoom);float user_kmPerPixel=divWithIntCheck(156.5430339296875,user_zoom_factor)*abs(cos(user_lat));float user_dx=((-sin(sun_azimuth)*cos(sun_altitude))*user_step)/user_width;float user_dy=((cos(sun_azimuth)*cos(sun_altitude))*user_step)/user_height;float user_dz=((sin(sun_altitude)*user_kmPerPixel)*user_step);float shadow_bias=0.0005;float user_curvature=0.0;float cur_height=0.0;float user_distance=0.0;float user_startX=user_x;float user_startY=user_y;user_x+=user_dx;user_y+=user_dy;user_z+=user_dz;if((abs(1.0)<0.0)){kernelResult=0.0;return;}float minAngle=asin((earthRadiusInKm/(earthRadiusInKm+user_z)))-(user_PI/2.0);if(user_z<0.0||sun_altitude<minAngle){user_lit=0.0;}else{float xIter=ceil(user_dx<0.0 ? abs(user_x/user_dx):(1.0-user_x)/user_dx);float yIter=ceil(user_dy<0.0 ? abs(user_y/user_dy):(1.0-user_y)/user_dy);float zIter=ceil(user_dz<0.0 ? float(LOOP_MAX):(maxHeight-user_z)/user_dz);int iter=int(min(xIter,min(yIter,zIter)));float user_distance=(sqrt(pow(user_dx*user_width,2.0)+pow(user_dy*user_height,2.0))*user_kmPerPixel)/earthRadiusInKm;for(int safeI=0;safeI<LOOP_MAX;safeI++){if(safeI>iter){break;}cur_height=getDSMElevationFromSampler2D(user_a,user_x,user_y);if(cur_height-user_z>shadow_bias){user_curvature=earthRadiusInKm*(1.0-cos(user_distance*float(safeI+1)));if(user_z<(cur_height-user_curvature)){user_lit=0.0;vec4 result=texture2D(user_a,vec2(user_x,user_y));iter=0;break;}}user_x+=user_dx;user_y+=user_dy;user_z+=user_dz;}}if((user_lit==1.0)){if(u_outputLocationShadeProfile==true&&u_sunColor==shade_color){float timeInSun=pow(.7,pow(sin(sun_altitude),.678))*sin(sun_altitude)*(1.0/0.7);float h=0.5;vec4 blue=vec4(0.0,0.0,1.0,1.0);vec4 green=vec4(0.0,1.0,0.0,1.0);vec4 red=vec4(1.0,0.0,0.0,1.0);vec4 col=mix(mix(blue,green,timeInSun/h),mix(green,red,(timeInSun-h)/(1.0-h)),step(h,timeInSun));color(col.r,col.g,col.b,1.0);}else{color(u_sunColor);}}else{color(shade_color);}if(user_outputSunExposure){vec4 aggregateColor=texture2D(user_sunExposureTexture,vec2(vTexCoordFull.x,vTexCoordFull.y));float timeInSun=1.0-aggregateColor.r;float h=0.5;vec4 blue=vec4(0.0,0.0,1.0,1.0);vec4 green=vec4(0.0,1.0,0.0,1.0);vec4 red=vec4(1.0,0.0,0.0,1.0);vec4 col=mix(mix(blue,green,timeInSun/h),mix(green,red,(timeInSun-h)/(1.0-h)),step(h,timeInSun));color(col.r,col.g,col.b,0.5);}}void main(void){kernel();gl_FragColor=actualColor;}`});I.useProgram(V);const j=I.createBuffer(),Q=I.getAttribLocation(V,"a_pos"),te=I.createBuffer(),ce=I.getAttribLocation(V,"a_tex_pos"),Ce=I.createBuffer();I.bindBuffer(I.ARRAY_BUFFER,Ce),I.bufferData(I.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),I.STATIC_DRAW);const Me=I.createBuffer();I.bindBuffer(I.ARRAY_BUFFER,Me),I.bufferData(I.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,1,1]),I.STATIC_DRAW);const Ie=I.getUniformLocation(V,"user_a");I.uniform1i(Ie,0);const Te=I.getUniformLocation(V,"user_width"),Ge=I.getUniformLocation(V,"user_height"),$e=I.getUniformLocation(V,"user_maxHeight"),ue=I.getUniformLocation(V,"user_zoom"),pe=I.getUniformLocation(V,"user_topYCoord"),_e=I.getUniformLocation(V,"user_ySize"),ge=I.getUniformLocation(V,"user_step"),Fe=I.getUniformLocation(V,"user_west"),De=I.getUniformLocation(V,"user_dLng"),Se=I.getUniformLocation(V,"user_dec"),pr=I.getUniformLocation(V,"user_Hi"),or=I.getUniformLocation(V,"user_color"),Vt=I.getUniformLocation(V,"u_below_canopy"),Ht=I.getUniformLocation(V,"user_sunExposureTexture"),Kt=I.getUniformLocation(V,"user_outputSunExposure"),Tr=I.getUniformLocation(V,"u_outputShadeProfile"),We=I.getUniformLocation(V,"u_gpxTexture"),Sr=I.getUniformLocation(V,"u_decHiTexture"),Xt=I.getUniformLocation(V,"u_sunColor"),ei=I.getUniformLocation(V,"u_outputLocationShadeProfile"),Fr=I.getUniformLocation(V,"u_shadeProfileLocation"),gi=I.createTexture();let qr=0,yt=0,dt=0,jt=null;const $t=()=>{yt&&dt&&(I.useProgram(V),I.bindBuffer(I.ARRAY_BUFFER,j),I.enableVertexAttribArray(Q),I.vertexAttribPointer(Q,2,I.FLOAT,!1,0,0),I.bindBuffer(I.ARRAY_BUFFER,te),I.enableVertexAttribArray(ce),I.vertexAttribPointer(ce,2,I.FLOAT,!1,0,0),jt!==null&&(I.activeTexture(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,jt)),D(I,yt,dt),I.viewport(0,0,yt,dt),I.clear(I.COLOR_BUFFER_BIT),I.drawArrays(I.TRIANGLE_STRIP,0,4))};let Mr=0,Er=0,be=0,Ae="";const Ze=lt=>{const Ee=(lt.endTime-lt.startTime)/86400/1e3,Ft=1440;if(I.activeTexture(I.TEXTURE3),I.uniform1i(Sr,3),lt.startTime!==Er||lt.endTime!==be||lt.tzId!==Ae){Er=lt.startTime,be=lt.endTime,Ae=lt.tzId;const ft=[],nt=828e5,Ot=L_(new Date(Er),Ae);for(let je=0;je<Ee;je++){const re=L_(new Date(Er+86400*je*1e3+nt),Ae)-Ot;ft[je]=re}const Mt=new Float32Array(Ft*Ee*2);for(let je=0;je<Ft;je++)for(let re=0;re<Ee;re++){const oe=Er+86400*re*1e3+60*je*1e3,{dec:xe,Hi:Be}=M8(oe+ft[re]);Mt[2*(je*Ee+re)]=-xe,Mt[2*(je*Ee+re)+1]=Be/10}q_({gl:I,texture:gi,imageData:Mt,width:Ee,height:Ft,wrap:I.CLAMP_TO_EDGE,filter:I.NEAREST,format:I.RG,internalFormat:I.RG32F,type:I.FLOAT})}else I.bindTexture(I.TEXTURE_2D,gi);return{outputWidth:Ee,outputHeight:Ft}};return{updateHeightMap:function(lt){const{heightMapTex:Ee,width:Ft,height:ft,maxHeight:nt,heightMapZoom:Ot,topYCoord:Mt,ySize:je,colorVec:re,step:oe,west:xe,dLng:Be,dec:Ke,Hi:ct,cornerClipCoords:zt,cornerTextureCoords:st,outputWidth:Ct,outputHeight:qt,belowCanopy:Wt,skipRender:Nt}=lt;I.useProgram(V),yt=Ct,dt=qt,jt=Ee,I.bindBuffer(I.ARRAY_BUFFER,j),I.bufferData(I.ARRAY_BUFFER,new Float32Array(zt),I.STATIC_DRAW),I.bindBuffer(I.ARRAY_BUFFER,te),I.bufferData(I.ARRAY_BUFFER,new Float32Array(st),I.STATIC_DRAW),I.uniform1f(Te,Ft),I.uniform1f(Ge,ft),I.uniform1f($e,nt),I.uniform1f(ue,Ot),I.uniform1f(pe,Mt),I.uniform1f(_e,je),I.uniform4fv(or,re),I.uniform1f(ge,oe),I.uniform1f(Fe,xe),I.uniform1f(De,Be),I.uniform1f(Se,Ke),I.uniform1f(pr,ct),I.uniform1f(Vt,Wt?1:0),Nt||(window.cancelAnimationFrame(qr),qr=window.requestAnimationFrame($t))},updateDate:lt=>{const{dec:Ee,Hi:Ft}=lt;I.useProgram(V),I.uniform1f(Se,Ee),I.uniform1f(pr,Ft),window.cancelAnimationFrame(qr),qr=window.requestAnimationFrame($t)},updateDateRange:lt=>pc(this,void 0,void 0,function*(){const{startDate:Ee,endDate:Ft,iterations:ft,emit:nt}=lt;I.useProgram(V);const Ot=Mr=Date.now(),Mt=Math.floor((Ft.getTime()-Ee.getTime())/ft),je=I.getUniform(V,or),re=yt,oe=dt,xe=I.createTexture();I.activeTexture(I.TEXTURE2),I.bindTexture(I.TEXTURE_2D,xe),I.texImage2D(I.TEXTURE_2D,0,I.RGBA,re,oe,0,I.RGBA,I.UNSIGNED_BYTE,null),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.NEAREST),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.NEAREST);const Be=I.createFramebuffer();I.bindFramebuffer(I.FRAMEBUFFER,Be);const Ke=I.COLOR_ATTACHMENT0;I.framebufferTexture2D(I.FRAMEBUFFER,Ke,I.TEXTURE_2D,xe,0);for(let ct=0;ct<ft;ct++){if(I.useProgram(V),nt("tileloaded",ct,ft-1),Ot!==Mr)return I.deleteFramebuffer(Be),I.deleteTexture(xe),I.uniform4fv(or,je),!0;yield new Promise((zt,st)=>{window.requestAnimationFrame(()=>{I.useProgram(V),jt!==null&&(I.activeTexture(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,jt)),I.bindFramebuffer(I.FRAMEBUFFER,Be);const Ct=I.checkFramebufferStatus(I.FRAMEBUFFER);Ct!==I.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete: "+Ct);const{dec:qt,Hi:Wt}=bT(new Date(Ee.getTime()+Mt*ct));I.uniform1f(Se,qt),I.uniform1f(pr,Wt),I.uniform4fv(or,[1/ft,0,0,1]),I.bindBuffer(I.ARRAY_BUFFER,j),I.enableVertexAttribArray(Q),I.vertexAttribPointer(Q,2,I.FLOAT,!1,0,0),I.bindBuffer(I.ARRAY_BUFFER,te),I.enableVertexAttribArray(ce),I.vertexAttribPointer(ce,2,I.FLOAT,!1,0,0),I.viewport(0,0,re,oe),I.enable(I.BLEND),I.blendFunc(I.ONE,I.ONE),I.drawArrays(I.TRIANGLE_STRIP,0,4),zt()})})}return I.deleteFramebuffer(Be),yield new Promise((ct,zt)=>{window.requestAnimationFrame(()=>{if(I.useProgram(V),Ot!==Mr)return I.deleteTexture(xe),I.uniform4fv(or,je),void ct(!0);I.activeTexture(I.TEXTURE2),I.bindTexture(I.TEXTURE_2D,xe),I.uniform1i(Ht,2),I.uniform1i(Kt,1),$t(),I.uniform1i(Kt,0),I.uniform1i(Ht,0),I.deleteTexture(xe),I.uniform4fv(or,je),ct(!1)})})}),updateColor:lt=>{const{colorVec:Ee}=lt;I.useProgram(V),I.uniform4fv(or,Ee),window.cancelAnimationFrame(qr),qr=window.requestAnimationFrame($t)},generateShadeProfile:lt=>{I.useProgram(V);const{dates:Ee,texCoords:Ft,shadeColor:ft,sunColor:nt}=lt,Ot=Ft.length,Mt=Ee.length,je=I.getUniform(V,or);I.uniform4fv(or,ft),I.uniform4fv(Xt,nt),I.uniform1i(Tr,1);const re=I.createTexture();I.activeTexture(I.TEXTURE3),q_({gl:I,imageData:null,width:Ot,height:Mt,wrap:I.CLAMP_TO_EDGE,filter:I.NEAREST,format:I.RGBA,texture:re});const oe=I.createFramebuffer();I.bindFramebuffer(I.FRAMEBUFFER,oe),I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,re,0);const xe=I.checkFramebufferStatus(I.FRAMEBUFFER);xe!==I.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete: "+xe);const Be=Ft.map(Ct=>[Ct[0],Ct[1]]).flat(),Ke=I.createTexture();I.activeTexture(I.TEXTURE2),q_({gl:I,texture:Ke,imageData:new Float32Array(Be),width:Be.length/2,height:1,wrap:I.CLAMP_TO_EDGE,filter:I.NEAREST,format:I.RG,internalFormat:I.RG32F,type:I.FLOAT}),I.uniform1i(We,2);const ct=Ee.map(Ct=>{const{dec:qt,Hi:Wt}=bT(Ct);return[-qt,Wt/10]}).flat(),zt=I.createTexture();I.activeTexture(I.TEXTURE1),q_({gl:I,texture:zt,imageData:new Float32Array(ct),width:1,height:Ee.length,wrap:I.CLAMP_TO_EDGE,filter:I.NEAREST,format:I.RG,internalFormat:I.RG32F,type:I.FLOAT}),I.uniform1i(Sr,1),jt!==null&&(I.activeTexture(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,jt)),I.bindBuffer(I.ARRAY_BUFFER,Ce),I.enableVertexAttribArray(Q),I.vertexAttribPointer(Q,2,I.FLOAT,!1,0,0),I.bindBuffer(I.ARRAY_BUFFER,Me),I.enableVertexAttribArray(ce),I.vertexAttribPointer(ce,2,I.FLOAT,!1,0,0),I.viewport(0,0,Ot,Mt),I.clear(I.COLOR_BUFFER_BIT),I.drawArrays(I.TRIANGLE_STRIP,0,4);const st=new Uint8Array(Ot*Mt*4);return I.readPixels(0,0,Ot,Mt,I.RGBA,I.UNSIGNED_BYTE,st),I.deleteTexture(re),I.deleteTexture(zt),I.deleteTexture(Ke),I.deleteFramebuffer(oe),I.uniform1i(Sr,0),I.uniform1i(We,0),I.uniform1i(Tr,0),I.uniform4fv(or,je),I.uniform4fv(Xt,[0,0,0,0]),st},generateLocationShadeProfile:lt=>{I.useProgram(V);const{startTime:Ee,endTime:Ft,tzId:ft,texCoord:nt,shadeColor:Ot,sunColor:Mt}=lt,je=I.getUniform(V,or),{outputWidth:re,outputHeight:oe}=Ze({startTime:Ee,endTime:Ft,tzId:ft});I.uniform4fv(or,Ot),I.uniform4fv(Xt,Mt),I.uniform1i(ei,1),I.uniform2fv(Fr,[nt[0],nt[1]]);const xe=I.createTexture();I.activeTexture(I.TEXTURE2),q_({gl:I,imageData:null,width:re,height:oe,wrap:I.CLAMP_TO_EDGE,filter:I.NEAREST,format:I.RGBA,texture:xe});const Be=I.createFramebuffer();I.bindFramebuffer(I.FRAMEBUFFER,Be),I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,xe,0);const Ke=I.checkFramebufferStatus(I.FRAMEBUFFER);Ke!==I.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete: "+Ke),jt!==null&&(I.activeTexture(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,jt)),I.bindBuffer(I.ARRAY_BUFFER,Ce),I.enableVertexAttribArray(Q),I.vertexAttribPointer(Q,2,I.FLOAT,!1,0,0),I.bindBuffer(I.ARRAY_BUFFER,Me),I.enableVertexAttribArray(ce),I.vertexAttribPointer(ce,2,I.FLOAT,!1,0,0),I.viewport(0,0,re,oe),I.clear(I.COLOR_BUFFER_BIT),I.drawArrays(I.TRIANGLE_STRIP,0,4);const ct=new Uint8Array(re*oe*4);return I.readPixels(0,0,re,oe,I.RGBA,I.UNSIGNED_BYTE,ct),I.deleteTexture(xe),I.deleteFramebuffer(Be),I.uniform1i(Sr,0),I.uniform1i(ei,0),I.uniform4fv(or,je),I.uniform4fv(Xt,[0,0,0,0]),{output:ct,outputWidth:re,outputHeight:oe}}}}({context:this._gl,setRenderBuffer:(l,S,D)=>{const I=e.getSource(this.canvasSourceId).texture;l.activeTexture(l.TEXTURE1),I.bind(l.LINEAR,l.CLAMP_TO_EDGE),I.size=[S,D],l.texImage2D(l.TEXTURE_2D,0,l.RGBA,S,D,0,l.RGBA,l.UNSIGNED_BYTE,null),l.bindFramebuffer(l.FRAMEBUFFER,this._framebuffer),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,I.texture,0),l.enable(l.BLEND),l.blendFunc(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA)}}),this._tileMerger=new eO(this._gl),this._canopyMerger=new eO(this._gl),this._buildingRasterizer=new use(this._gl),document.body.appendChild(this._canvas),this._canvas.style.display="none";const r=e.getBounds(),s=r.getNorthWest(),c=r.getNorthEast(),d=r.getSouthEast(),_=r.getSouthWest(),x=[[s.lng,s.lat],[c.lng,c.lat],[d.lng,d.lat],[_.lng,_.lat]];return e.addSource(this.canvasSourceId,{type:"canvas",canvas:this._canvas,coordinates:x,animate:!1}),e.addLayer({id:this.canvasLayerId,type:"raster",source:this.canvasSourceId,paint:{"raster-fade-duration":0}}),e.addSource(this.attributionSourceId,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"Point",coordinates:[-122.210598,47.769799]}},attribution:'<a href="https://shademap.app/about">&copy; ShadeMap</a>'}),e.addLayer({id:this.attributionLayerId,type:"fill",source:this.attributionSourceId}),this._map.on("moveend",this._moveEndHandler),this._moveEndHandler(),this}onRemove(){return this._map&&(this._map.off("moveend",this._moveEndHandler),this._map.removeLayer(this.attributionLayerId),this._map.removeLayer(this.canvasLayerId),this._map.removeSource(this.attributionSourceId),this._map.removeSource(this.canvasSourceId)),this._gl&&this._framebuffer&&this._gl.deleteFramebuffer(this._framebuffer),document.body.removeChild(this._canvas),this.options.debug("onRemove called"),this}_getHeightMapCoords(e,r){if(this._map&&this.options.sunExposure.enabled&&this._bounds&&this._heightMap){const s=this._map.unproject([e,r]);if(s.toString()===this._map.unproject([e,r+1]).toString())return new In(-1,-1);const{visibleDEMPixelBounds:c,demZoom:d}=this._heightMap;return Vy(this._map).project(s,d).subtract(c.min)}return new In(-1,-1)}getHoursOfSun(e,r){if(this.options.sunExposure.enabled){const s=this._getHeightMapCoords(e,r),c=this.readPixel(s.x,s.y),{startDate:d,endDate:_}=this.options.sunExposure,x=_.getTime()-d.getTime(),l=yA(c,.5,x);return Math.abs(l/1e3/3600)}return 0}remove(){this._map&&this._map.removeLayer(this.id)}readPixel(e,r){const s=new Uint8Array(4);if(this._map&&this._gl&&this._framebuffer){const c=this._gl,d=this._map.getSource(this.canvasSourceId).texture;c.activeTexture(c.TEXTURE1),d.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.bindFramebuffer(c.FRAMEBUFFER,this._framebuffer),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,d.texture,0),this._gl.readPixels(e,r,1,1,this._gl.RGBA,this._gl.UNSIGNED_BYTE,s)}return s}readPixels(e,r,s,c){const d=new Uint8Array(s*c*4);if(this._map&&this._gl&&this._framebuffer){const _=this._gl,x=this._map.getSource(this.canvasSourceId).texture;_.activeTexture(_.TEXTURE1),x.bind(_.LINEAR,_.CLAMP_TO_EDGE),_.bindFramebuffer(_.FRAMEBUFFER,this._framebuffer),_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,x.texture,0),this._gl.readPixels(e,r,s,c,this._gl.RGBA,this._gl.UNSIGNED_BYTE,d)}return d}_flush(){this._map&&this._map.getSource(this.canvasSourceId).fire({type:"data",dataType:"source",sourceDataType:"content"}),this.emit("idle")}_repositionCanvas(e){if(this._map){const r=this._map.getSource(this.canvasSourceId);if(r){const s=e.getNorthWest(),c=e.getNorthEast(),d=e.getSouthEast(),_=e.getSouthWest(),x=[[s.lng,s.lat],[c.lng,c.lat],[d.lng,d.lat],[_.lng,_.lat]];r.setCoordinates(x),this.emit("idle")}}return this}}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ME(n){const e=new MouseEvent("click",{bubbles:!0});return n.dispatchEvent(e),e}function kE(n){return n.currentTarget!==n.target||n.composedPath()[0]!==n.target||n.target.disabled?!1:!dse(n)}function dse(n){const e=JI;return e&&(n.preventDefault(),n.stopImmediatePropagation()),fse(),e}let JI=!1;async function fse(){JI=!0,await null,JI=!1}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function c1(n,e){e.bubbles&&(!n.shadowRoot||e.composed)&&e.stopPropagation();const r=Reflect.construct(e.constructor,[e.type,e]),s=n.dispatchEvent(r);return s||e.preventDefault(),s}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const u1=Symbol("createValidator"),h1=Symbol("getValidityAnchor"),vA=Symbol("privateValidator"),eh=Symbol("privateSyncValidity"),qb=Symbol("privateCustomValidationMessage");function kR(n){var e;class r extends n{constructor(){super(...arguments),this[e]=""}get validity(){return this[eh](),this[pa].validity}get validationMessage(){return this[eh](),this[pa].validationMessage}get willValidate(){return this[eh](),this[pa].willValidate}checkValidity(){return this[eh](),this[pa].checkValidity()}reportValidity(){return this[eh](),this[pa].reportValidity()}setCustomValidity(c){this[qb]=c,this[eh]()}requestUpdate(c,d,_){super.requestUpdate(c,d,_),this[eh]()}firstUpdated(c){super.firstUpdated(c),this[eh]()}[(e=qb,eh)](){this[vA]||(this[vA]=this[u1]());const{validity:c,validationMessage:d}=this[vA].getValidity(),_=!!this[qb],x=this[qb]||d;this[pa].setValidity({...c,customError:_},x,this[h1]()??void 0)}[u1](){throw new Error("Implement [createValidator]")}[h1](){throw new Error("Implement [getValidityAnchor]")}}return r}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Fp=Symbol("getFormValue"),TT=Symbol("getFormState");function DE(n){class e extends n{get form(){return this[pa].form}get labels(){return this[pa].labels}get name(){return this.getAttribute("name")??""}set name(s){this.setAttribute("name",s)}get disabled(){return this.hasAttribute("disabled")}set disabled(s){this.toggleAttribute("disabled",s)}attributeChangedCallback(s,c,d){if(s==="name"||s==="disabled"){const _=s==="disabled"?c!==null:c;this.requestUpdate(s,_);return}super.attributeChangedCallback(s,c,d)}requestUpdate(s,c,d){super.requestUpdate(s,c,d),this[pa].setFormValue(this[Fp](),this[TT]())}[Fp](){throw new Error("Implement [getFormValue]")}[TT](){return this[Fp]()}formDisabledCallback(s){this.disabled=s}}return e.formAssociated=!0,At([lr({noAccessor:!0})],e.prototype,"name",null),At([lr({type:Boolean,noAccessor:!0})],e.prototype,"disabled",null),e}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class L8{constructor(e){this.getCurrentState=e,this.currentValidity={validity:{},validationMessage:""}}getValidity(){const e=this.getCurrentState();if(!(!this.prevState||!this.equals(this.prevState,e)))return this.currentValidity;const{validity:s,validationMessage:c}=this.computeValidity(e);return this.prevState=this.copy(e),this.currentValidity={validationMessage:c,validity:{badInput:s.badInput,customError:s.customError,patternMismatch:s.patternMismatch,rangeOverflow:s.rangeOverflow,rangeUnderflow:s.rangeUnderflow,stepMismatch:s.stepMismatch,tooLong:s.tooLong,tooShort:s.tooShort,typeMismatch:s.typeMismatch,valueMissing:s.valueMissing}},this.currentValidity}}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class O8 extends L8{computeValidity(e){return this.checkboxControl||(this.checkboxControl=document.createElement("input"),this.checkboxControl.type="checkbox"),this.checkboxControl.checked=e.checked,this.checkboxControl.required=e.required,{validity:this.checkboxControl.validity,validationMessage:this.checkboxControl.validationMessage}}equals(e,r){return e.checked===r.checked&&e.required===r.required}copy({checked:e,required:r}){return{checked:e,required:r}}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const pse=kR(DE(s0(Ys)));class Rc extends pse{constructor(){super(),this.checked=!1,this.indeterminate=!1,this.required=!1,this.value="on",this.prevChecked=!1,this.prevDisabled=!1,this.prevIndeterminate=!1,this.addEventListener("click",e=>{!kE(e)||!this.input||(this.focus(),ME(this.input))})}update(e){(e.has("checked")||e.has("disabled")||e.has("indeterminate"))&&(this.prevChecked=e.get("checked")??this.checked,this.prevDisabled=e.get("disabled")??this.disabled,this.prevIndeterminate=e.get("indeterminate")??this.indeterminate),super.update(e)}render(){const e=!this.prevChecked&&!this.prevIndeterminate,r=this.prevChecked&&!this.prevIndeterminate,s=this.prevIndeterminate,c=this.checked&&!this.indeterminate,d=this.indeterminate,_=za({disabled:this.disabled,selected:c||d,unselected:!c&&!d,checked:c,indeterminate:d,"prev-unselected":e,"prev-checked":r,"prev-indeterminate":s,"prev-disabled":this.prevDisabled}),{ariaLabel:x,ariaInvalid:l}=this;return bi`
      <div class="container ${_}">
        <input
          type="checkbox"
          id="input"
          aria-checked=${d?"mixed":Pr}
          aria-label=${x||Pr}
          aria-invalid=${l||Pr}
          ?disabled=${this.disabled}
          ?required=${this.required}
          .indeterminate=${this.indeterminate}
          .checked=${this.checked}
          @input=${this.handleInput}
          @change=${this.handleChange} />

        <div class="outline"></div>
        <div class="background"></div>
        <md-focus-ring part="focus-ring" for="input"></md-focus-ring>
        <md-ripple for="input" ?disabled=${this.disabled}></md-ripple>
        <svg class="icon" viewBox="0 0 18 18" aria-hidden="true">
          <rect class="mark short" />
          <rect class="mark long" />
        </svg>
      </div>
    `}handleInput(e){const r=e.target;this.checked=r.checked,this.indeterminate=r.indeterminate}handleChange(e){c1(this,e)}[Fp](){return!this.checked||this.indeterminate?null:this.value}[TT](){return String(this.checked)}formResetCallback(){this.checked=this.hasAttribute("checked")}formStateRestoreCallback(e){this.checked=e==="true"}[u1](){return new O8(()=>this)}[h1](){return this.input}}ym(Rc);Rc.shadowRootOptions={...Ys.shadowRootOptions,delegatesFocus:!0};At([lr({type:Boolean})],Rc.prototype,"checked",void 0);At([lr({type:Boolean})],Rc.prototype,"indeterminate",void 0);At([lr({type:Boolean})],Rc.prototype,"required",void 0);At([lr()],Rc.prototype,"value",void 0);At([Ks()],Rc.prototype,"prevChecked",void 0);At([Ks()],Rc.prototype,"prevDisabled",void 0);At([Ks()],Rc.prototype,"prevIndeterminate",void 0);At([_l("input")],Rc.prototype,"input",void 0);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const mse=xs`:host{border-start-start-radius:var(--md-checkbox-container-shape-start-start, var(--md-checkbox-container-shape, 2px));border-start-end-radius:var(--md-checkbox-container-shape-start-end, var(--md-checkbox-container-shape, 2px));border-end-end-radius:var(--md-checkbox-container-shape-end-end, var(--md-checkbox-container-shape, 2px));border-end-start-radius:var(--md-checkbox-container-shape-end-start, var(--md-checkbox-container-shape, 2px));display:inline-flex;height:var(--md-checkbox-container-size, 18px);position:relative;vertical-align:top;width:var(--md-checkbox-container-size, 18px);-webkit-tap-highlight-color:rgba(0,0,0,0);cursor:pointer}:host([disabled]){cursor:default}:host([touch-target=wrapper]){margin:max(0px,(48px - var(--md-checkbox-container-size, 18px))/2)}md-focus-ring{height:44px;inset:unset;width:44px}input{appearance:none;height:48px;margin:0;opacity:0;outline:none;position:absolute;width:48px;z-index:1;cursor:inherit}:host([touch-target=none]) input{height:100%;width:100%}.container{border-radius:inherit;display:flex;height:100%;place-content:center;place-items:center;position:relative;width:100%}.outline,.background,.icon{inset:0;position:absolute}.outline,.background{border-radius:inherit}.outline{border-color:var(--md-checkbox-outline-color, var(--md-sys-color-on-surface-variant, #49454f));border-style:solid;border-width:var(--md-checkbox-outline-width, 2px);box-sizing:border-box}.background{background-color:var(--md-checkbox-selected-container-color, var(--md-sys-color-primary, #6750a4))}.background,.icon{opacity:0;transition-duration:150ms,50ms;transition-property:transform,opacity;transition-timing-function:cubic-bezier(0.3, 0, 0.8, 0.15),linear;transform:scale(0.6)}:where(.selected) :is(.background,.icon){opacity:1;transition-duration:350ms,50ms;transition-timing-function:cubic-bezier(0.05, 0.7, 0.1, 1),linear;transform:scale(1)}md-ripple{border-radius:var(--md-checkbox-state-layer-shape, var(--md-sys-shape-corner-full, 9999px));height:var(--md-checkbox-state-layer-size, 40px);inset:unset;width:var(--md-checkbox-state-layer-size, 40px);--md-ripple-hover-color: var(--md-checkbox-hover-state-layer-color, var(--md-sys-color-on-surface, #1d1b20));--md-ripple-hover-opacity: var(--md-checkbox-hover-state-layer-opacity, 0.08);--md-ripple-pressed-color: var(--md-checkbox-pressed-state-layer-color, var(--md-sys-color-primary, #6750a4));--md-ripple-pressed-opacity: var(--md-checkbox-pressed-state-layer-opacity, 0.12)}.selected md-ripple{--md-ripple-hover-color: var(--md-checkbox-selected-hover-state-layer-color, var(--md-sys-color-primary, #6750a4));--md-ripple-hover-opacity: var(--md-checkbox-selected-hover-state-layer-opacity, 0.08);--md-ripple-pressed-color: var(--md-checkbox-selected-pressed-state-layer-color, var(--md-sys-color-on-surface, #1d1b20));--md-ripple-pressed-opacity: var(--md-checkbox-selected-pressed-state-layer-opacity, 0.12)}.icon{fill:var(--md-checkbox-selected-icon-color, var(--md-sys-color-on-primary, #fff));height:var(--md-checkbox-icon-size, 18px);width:var(--md-checkbox-icon-size, 18px)}.mark.short{height:2px;transition-property:transform,height;width:2px}.mark.long{height:2px;transition-property:transform,width;width:10px}.mark{animation-duration:150ms;animation-timing-function:cubic-bezier(0.3, 0, 0.8, 0.15);transition-duration:150ms;transition-timing-function:cubic-bezier(0.3, 0, 0.8, 0.15)}.selected .mark{animation-duration:350ms;animation-timing-function:cubic-bezier(0.05, 0.7, 0.1, 1);transition-duration:350ms;transition-timing-function:cubic-bezier(0.05, 0.7, 0.1, 1)}.checked .mark,.prev-checked.unselected .mark{transform:scaleY(-1) translate(7px, -14px) rotate(45deg)}.checked .mark.short,.prev-checked.unselected .mark.short{height:5.6568542495px}.checked .mark.long,.prev-checked.unselected .mark.long{width:11.313708499px}.indeterminate .mark,.prev-indeterminate.unselected .mark{transform:scaleY(-1) translate(4px, -10px) rotate(0deg)}.prev-unselected .mark{transition-property:none}.prev-unselected.checked .mark.long{animation-name:prev-unselected-to-checked}@keyframes prev-unselected-to-checked{from{width:0}}:where(:hover) .outline{border-color:var(--md-checkbox-hover-outline-color, var(--md-sys-color-on-surface, #1d1b20));border-width:var(--md-checkbox-hover-outline-width, 2px)}:where(:hover) .background{background:var(--md-checkbox-selected-hover-container-color, var(--md-sys-color-primary, #6750a4))}:where(:hover) .icon{fill:var(--md-checkbox-selected-hover-icon-color, var(--md-sys-color-on-primary, #fff))}:where(:focus-within) .outline{border-color:var(--md-checkbox-focus-outline-color, var(--md-sys-color-on-surface, #1d1b20));border-width:var(--md-checkbox-focus-outline-width, 2px)}:where(:focus-within) .background{background:var(--md-checkbox-selected-focus-container-color, var(--md-sys-color-primary, #6750a4))}:where(:focus-within) .icon{fill:var(--md-checkbox-selected-focus-icon-color, var(--md-sys-color-on-primary, #fff))}:where(:active) .outline{border-color:var(--md-checkbox-pressed-outline-color, var(--md-sys-color-on-surface, #1d1b20));border-width:var(--md-checkbox-pressed-outline-width, 2px)}:where(:active) .background{background:var(--md-checkbox-selected-pressed-container-color, var(--md-sys-color-primary, #6750a4))}:where(:active) .icon{fill:var(--md-checkbox-selected-pressed-icon-color, var(--md-sys-color-on-primary, #fff))}:where(.disabled,.prev-disabled) :is(.background,.icon,.mark){animation-duration:0s;transition-duration:0s}:where(.disabled) .outline{border-color:var(--md-checkbox-disabled-outline-color, var(--md-sys-color-on-surface, #1d1b20));border-width:var(--md-checkbox-disabled-outline-width, 2px);opacity:var(--md-checkbox-disabled-container-opacity, 0.38)}:where(.selected.disabled) .outline{visibility:hidden}:where(.selected.disabled) .background{background:var(--md-checkbox-selected-disabled-container-color, var(--md-sys-color-on-surface, #1d1b20));opacity:var(--md-checkbox-selected-disabled-container-opacity, 0.38)}:where(.disabled) .icon{fill:var(--md-checkbox-selected-disabled-icon-color, var(--md-sys-color-surface, #fef7ff))}@media(forced-colors: active){.background{background-color:CanvasText}.selected.disabled .background{background-color:GrayText;opacity:1}.outline{border-color:CanvasText}.disabled .outline{border-color:GrayText;opacity:1}.icon{fill:Canvas}}
`;/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let eS=class extends Rc{};eS.styles=[mse];eS=At([ea("md-checkbox")],eS);const _se={class:"optional-field"},gse={class:"check-and-label"},yse=["name"],vse=["for"],xse=Ro({__name:"OptionalField",props:{label:{}},emits:["checkbox-changed"],setup(n,{emit:e}){const r=n,s=e,c=wo(()=>r.label.toLowerCase().replace(" ","-")),d=mn(!1);function _(){d.value=!d.value,s("checkbox-changed",d.value)}return(x,l)=>(li(),Ii("div",_se,[Br("div",gse,[Br("md-checkbox",{name:c.value,onChange:_},null,40,yse),Br("label",{for:c.value},Mn(x.label),9,vse)]),d.value?AG(x.$slots,"default",{key:0,class:"content"},void 0):Tc("",!0)]))}}),Ng=gl(xse,[["__scopeId","data-v-fef957e3"]]);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class bs extends Ys{constructor(){super(...arguments),this.disabled=!1,this.error=!1,this.focused=!1,this.label="",this.noAsterisk=!1,this.populated=!1,this.required=!1,this.resizable=!1,this.supportingText="",this.errorText="",this.count=-1,this.max=-1,this.hasStart=!1,this.hasEnd=!1,this.isAnimating=!1,this.refreshErrorAlert=!1,this.disableTransitions=!1}get counterText(){const e=this.count??-1,r=this.max??-1;return e<0||r<=0?"":`${e} / ${r}`}get supportingOrErrorText(){return this.error&&this.errorText?this.errorText:this.supportingText}reannounceError(){this.refreshErrorAlert=!0}update(e){e.has("disabled")&&e.get("disabled")!==void 0&&(this.disableTransitions=!0),this.disabled&&this.focused&&(e.set("focused",!0),this.focused=!1),this.animateLabelIfNeeded({wasFocused:e.get("focused"),wasPopulated:e.get("populated")}),super.update(e)}render(){var d,_,x;const e=this.renderLabel(!0),r=this.renderLabel(!1),s=(d=this.renderOutline)==null?void 0:d.call(this,e),c={disabled:this.disabled,"disable-transitions":this.disableTransitions,error:this.error&&!this.disabled,focused:this.focused,"with-start":this.hasStart,"with-end":this.hasEnd,populated:this.populated,resizable:this.resizable,required:this.required,"no-label":!this.label};return bi`
      <div class="field ${za(c)}">
        <div class="container-overflow">
          ${(_=this.renderBackground)==null?void 0:_.call(this)} ${(x=this.renderIndicator)==null?void 0:x.call(this)} ${s}
          <div class="container">
            <div class="start">
              <slot name="start"></slot>
            </div>
            <div class="middle">
              <div class="label-wrapper">
                ${r} ${s?Pr:e}
              </div>
              <div class="content">
                <slot></slot>
              </div>
            </div>
            <div class="end">
              <slot name="end"></slot>
            </div>
          </div>
        </div>
        ${this.renderSupportingText()}
      </div>
    `}updated(e){(e.has("supportingText")||e.has("errorText")||e.has("count")||e.has("max"))&&this.updateSlottedAriaDescribedBy(),this.refreshErrorAlert&&requestAnimationFrame(()=>{this.refreshErrorAlert=!1}),this.disableTransitions&&requestAnimationFrame(()=>{this.disableTransitions=!1})}renderSupportingText(){const{supportingOrErrorText:e,counterText:r}=this;if(!e&&!r)return Pr;const s=bi`<span>${e}</span>`,c=r?bi`<span class="counter">${r}</span>`:Pr,_=this.error&&this.errorText&&!this.refreshErrorAlert?"alert":Pr;return bi`
      <div class="supporting-text" role=${_}>${s}${c}</div>
      <slot
        name="aria-describedby"
        @slotchange=${this.updateSlottedAriaDescribedBy}></slot>
    `}updateSlottedAriaDescribedBy(){for(const e of this.slottedAriaDescribedBy)y8(bi`${this.supportingOrErrorText} ${this.counterText}`,e),e.setAttribute("hidden","")}renderLabel(e){if(!this.label)return Pr;let r;e?r=this.focused||this.populated||this.isAnimating:r=!this.focused&&!this.populated&&!this.isAnimating;const s={hidden:!r,floating:e,resting:!e},c=`${this.label}${this.required&&!this.noAsterisk?"*":""}`;return bi`
      <span class="label ${za(s)}" aria-hidden=${!r}
        >${c}</span
      >
    `}animateLabelIfNeeded({wasFocused:e,wasPopulated:r}){var d,_,x;if(!this.label)return;e??(e=this.focused),r??(r=this.populated);const s=e||r,c=this.focused||this.populated;s!==c&&(this.isAnimating=!0,(d=this.labelAnimation)==null||d.cancel(),this.labelAnimation=(_=this.floatingLabelEl)==null?void 0:_.animate(this.getLabelKeyframes(),{duration:150,easing:b8.STANDARD}),(x=this.labelAnimation)==null||x.addEventListener("finish",()=>{this.isAnimating=!1}))}getLabelKeyframes(){const{floatingLabelEl:e,restingLabelEl:r}=this;if(!e||!r)return[];const{x:s,y:c,height:d}=e.getBoundingClientRect(),{x:_,y:x,height:l}=r.getBoundingClientRect(),S=e.scrollWidth,D=r.scrollWidth,I=D/S,V=_-s,j=x-c+Math.round((l-d*I)/2),Q=`translateX(${V}px) translateY(${j}px) scale(${I})`,te="translateX(0) translateY(0) scale(1)",ce=r.clientWidth,Me=D>ce?`${ce/I}px`:"";return this.focused||this.populated?[{transform:Q,width:Me},{transform:te,width:Me}]:[{transform:te,width:Me},{transform:Q,width:Me}]}getSurfacePositionClientRect(){return this.containerEl.getBoundingClientRect()}}At([lr({type:Boolean})],bs.prototype,"disabled",void 0);At([lr({type:Boolean})],bs.prototype,"error",void 0);At([lr({type:Boolean})],bs.prototype,"focused",void 0);At([lr()],bs.prototype,"label",void 0);At([lr({type:Boolean,attribute:"no-asterisk"})],bs.prototype,"noAsterisk",void 0);At([lr({type:Boolean})],bs.prototype,"populated",void 0);At([lr({type:Boolean})],bs.prototype,"required",void 0);At([lr({type:Boolean})],bs.prototype,"resizable",void 0);At([lr({attribute:"supporting-text"})],bs.prototype,"supportingText",void 0);At([lr({attribute:"error-text"})],bs.prototype,"errorText",void 0);At([lr({type:Number})],bs.prototype,"count",void 0);At([lr({type:Number})],bs.prototype,"max",void 0);At([lr({type:Boolean,attribute:"has-start"})],bs.prototype,"hasStart",void 0);At([lr({type:Boolean,attribute:"has-end"})],bs.prototype,"hasEnd",void 0);At([SE({slot:"aria-describedby"})],bs.prototype,"slottedAriaDescribedBy",void 0);At([Ks()],bs.prototype,"isAnimating",void 0);At([Ks()],bs.prototype,"refreshErrorAlert",void 0);At([Ks()],bs.prototype,"disableTransitions",void 0);At([_l(".label.floating")],bs.prototype,"floatingLabelEl",void 0);At([_l(".label.resting")],bs.prototype,"restingLabelEl",void 0);At([_l(".container")],bs.prototype,"containerEl",void 0);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class bse extends bs{renderOutline(e){return bi`
      <div class="outline">
        <div class="outline-start"></div>
        <div class="outline-notch">
          <div class="outline-panel-inactive"></div>
          <div class="outline-panel-active"></div>
          <div class="outline-label">${e}</div>
        </div>
        <div class="outline-end"></div>
      </div>
    `}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const wse=xs`@layer styles{:host{--_bottom-space: var(--md-outlined-field-bottom-space, 16px);--_content-color: var(--md-outlined-field-content-color, var(--md-sys-color-on-surface, #1d1b20));--_content-font: var(--md-outlined-field-content-font, var(--md-sys-typescale-body-large-font, var(--md-ref-typeface-plain, Roboto)));--_content-line-height: var(--md-outlined-field-content-line-height, var(--md-sys-typescale-body-large-line-height, 1.5rem));--_content-size: var(--md-outlined-field-content-size, var(--md-sys-typescale-body-large-size, 1rem));--_content-weight: var(--md-outlined-field-content-weight, var(--md-sys-typescale-body-large-weight, var(--md-ref-typeface-weight-regular, 400)));--_disabled-content-color: var(--md-outlined-field-disabled-content-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-content-opacity: var(--md-outlined-field-disabled-content-opacity, 0.38);--_disabled-label-text-color: var(--md-outlined-field-disabled-label-text-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-label-text-opacity: var(--md-outlined-field-disabled-label-text-opacity, 0.38);--_disabled-leading-content-color: var(--md-outlined-field-disabled-leading-content-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-leading-content-opacity: var(--md-outlined-field-disabled-leading-content-opacity, 0.38);--_disabled-outline-color: var(--md-outlined-field-disabled-outline-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-outline-opacity: var(--md-outlined-field-disabled-outline-opacity, 0.12);--_disabled-outline-width: var(--md-outlined-field-disabled-outline-width, 1px);--_disabled-supporting-text-color: var(--md-outlined-field-disabled-supporting-text-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-supporting-text-opacity: var(--md-outlined-field-disabled-supporting-text-opacity, 0.38);--_disabled-trailing-content-color: var(--md-outlined-field-disabled-trailing-content-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-trailing-content-opacity: var(--md-outlined-field-disabled-trailing-content-opacity, 0.38);--_error-content-color: var(--md-outlined-field-error-content-color, var(--md-sys-color-on-surface, #1d1b20));--_error-focus-content-color: var(--md-outlined-field-error-focus-content-color, var(--md-sys-color-on-surface, #1d1b20));--_error-focus-label-text-color: var(--md-outlined-field-error-focus-label-text-color, var(--md-sys-color-error, #b3261e));--_error-focus-leading-content-color: var(--md-outlined-field-error-focus-leading-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_error-focus-outline-color: var(--md-outlined-field-error-focus-outline-color, var(--md-sys-color-error, #b3261e));--_error-focus-supporting-text-color: var(--md-outlined-field-error-focus-supporting-text-color, var(--md-sys-color-error, #b3261e));--_error-focus-trailing-content-color: var(--md-outlined-field-error-focus-trailing-content-color, var(--md-sys-color-error, #b3261e));--_error-hover-content-color: var(--md-outlined-field-error-hover-content-color, var(--md-sys-color-on-surface, #1d1b20));--_error-hover-label-text-color: var(--md-outlined-field-error-hover-label-text-color, var(--md-sys-color-on-error-container, #410e0b));--_error-hover-leading-content-color: var(--md-outlined-field-error-hover-leading-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_error-hover-outline-color: var(--md-outlined-field-error-hover-outline-color, var(--md-sys-color-on-error-container, #410e0b));--_error-hover-supporting-text-color: var(--md-outlined-field-error-hover-supporting-text-color, var(--md-sys-color-error, #b3261e));--_error-hover-trailing-content-color: var(--md-outlined-field-error-hover-trailing-content-color, var(--md-sys-color-on-error-container, #410e0b));--_error-label-text-color: var(--md-outlined-field-error-label-text-color, var(--md-sys-color-error, #b3261e));--_error-leading-content-color: var(--md-outlined-field-error-leading-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_error-outline-color: var(--md-outlined-field-error-outline-color, var(--md-sys-color-error, #b3261e));--_error-supporting-text-color: var(--md-outlined-field-error-supporting-text-color, var(--md-sys-color-error, #b3261e));--_error-trailing-content-color: var(--md-outlined-field-error-trailing-content-color, var(--md-sys-color-error, #b3261e));--_focus-content-color: var(--md-outlined-field-focus-content-color, var(--md-sys-color-on-surface, #1d1b20));--_focus-label-text-color: var(--md-outlined-field-focus-label-text-color, var(--md-sys-color-primary, #6750a4));--_focus-leading-content-color: var(--md-outlined-field-focus-leading-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_focus-outline-color: var(--md-outlined-field-focus-outline-color, var(--md-sys-color-primary, #6750a4));--_focus-outline-width: var(--md-outlined-field-focus-outline-width, 3px);--_focus-supporting-text-color: var(--md-outlined-field-focus-supporting-text-color, var(--md-sys-color-on-surface-variant, #49454f));--_focus-trailing-content-color: var(--md-outlined-field-focus-trailing-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-content-color: var(--md-outlined-field-hover-content-color, var(--md-sys-color-on-surface, #1d1b20));--_hover-label-text-color: var(--md-outlined-field-hover-label-text-color, var(--md-sys-color-on-surface, #1d1b20));--_hover-leading-content-color: var(--md-outlined-field-hover-leading-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-outline-color: var(--md-outlined-field-hover-outline-color, var(--md-sys-color-on-surface, #1d1b20));--_hover-outline-width: var(--md-outlined-field-hover-outline-width, 1px);--_hover-supporting-text-color: var(--md-outlined-field-hover-supporting-text-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-trailing-content-color: var(--md-outlined-field-hover-trailing-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_label-text-color: var(--md-outlined-field-label-text-color, var(--md-sys-color-on-surface-variant, #49454f));--_label-text-font: var(--md-outlined-field-label-text-font, var(--md-sys-typescale-body-large-font, var(--md-ref-typeface-plain, Roboto)));--_label-text-line-height: var(--md-outlined-field-label-text-line-height, var(--md-sys-typescale-body-large-line-height, 1.5rem));--_label-text-padding-bottom: var(--md-outlined-field-label-text-padding-bottom, 8px);--_label-text-populated-line-height: var(--md-outlined-field-label-text-populated-line-height, var(--md-sys-typescale-body-small-line-height, 1rem));--_label-text-populated-size: var(--md-outlined-field-label-text-populated-size, var(--md-sys-typescale-body-small-size, 0.75rem));--_label-text-size: var(--md-outlined-field-label-text-size, var(--md-sys-typescale-body-large-size, 1rem));--_label-text-weight: var(--md-outlined-field-label-text-weight, var(--md-sys-typescale-body-large-weight, var(--md-ref-typeface-weight-regular, 400)));--_leading-content-color: var(--md-outlined-field-leading-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_leading-space: var(--md-outlined-field-leading-space, 16px);--_outline-color: var(--md-outlined-field-outline-color, var(--md-sys-color-outline, #79747e));--_outline-label-padding: var(--md-outlined-field-outline-label-padding, 4px);--_outline-width: var(--md-outlined-field-outline-width, 1px);--_supporting-text-color: var(--md-outlined-field-supporting-text-color, var(--md-sys-color-on-surface-variant, #49454f));--_supporting-text-font: var(--md-outlined-field-supporting-text-font, var(--md-sys-typescale-body-small-font, var(--md-ref-typeface-plain, Roboto)));--_supporting-text-leading-space: var(--md-outlined-field-supporting-text-leading-space, 16px);--_supporting-text-line-height: var(--md-outlined-field-supporting-text-line-height, var(--md-sys-typescale-body-small-line-height, 1rem));--_supporting-text-size: var(--md-outlined-field-supporting-text-size, var(--md-sys-typescale-body-small-size, 0.75rem));--_supporting-text-top-space: var(--md-outlined-field-supporting-text-top-space, 4px);--_supporting-text-trailing-space: var(--md-outlined-field-supporting-text-trailing-space, 16px);--_supporting-text-weight: var(--md-outlined-field-supporting-text-weight, var(--md-sys-typescale-body-small-weight, var(--md-ref-typeface-weight-regular, 400)));--_top-space: var(--md-outlined-field-top-space, 16px);--_trailing-content-color: var(--md-outlined-field-trailing-content-color, var(--md-sys-color-on-surface-variant, #49454f));--_trailing-space: var(--md-outlined-field-trailing-space, 16px);--_container-shape-start-start: var(--md-outlined-field-container-shape-start-start, var(--md-outlined-field-container-shape, var(--md-sys-shape-corner-extra-small, 4px)));--_container-shape-start-end: var(--md-outlined-field-container-shape-start-end, var(--md-outlined-field-container-shape, var(--md-sys-shape-corner-extra-small, 4px)));--_container-shape-end-end: var(--md-outlined-field-container-shape-end-end, var(--md-outlined-field-container-shape, var(--md-sys-shape-corner-extra-small, 4px)));--_container-shape-end-start: var(--md-outlined-field-container-shape-end-start, var(--md-outlined-field-container-shape, var(--md-sys-shape-corner-extra-small, 4px)))}.outline{border-color:var(--_outline-color);border-radius:inherit;display:flex;pointer-events:none;height:100%;position:absolute;width:100%;z-index:1}.outline-start::before,.outline-start::after,.outline-panel-inactive::before,.outline-panel-inactive::after,.outline-panel-active::before,.outline-panel-active::after,.outline-end::before,.outline-end::after{border:inherit;content:"";inset:0;position:absolute}.outline-start,.outline-end{border:inherit;border-radius:inherit;box-sizing:border-box;position:relative}.outline-start::before,.outline-start::after,.outline-end::before,.outline-end::after{border-bottom-style:solid;border-top-style:solid}.outline-start::after,.outline-end::after{opacity:0;transition:opacity 150ms cubic-bezier(0.2, 0, 0, 1)}.focused .outline-start::after,.focused .outline-end::after{opacity:1}.outline-start::before,.outline-start::after{border-inline-start-style:solid;border-inline-end-style:none;border-start-start-radius:inherit;border-start-end-radius:0;border-end-start-radius:inherit;border-end-end-radius:0;margin-inline-end:var(--_outline-label-padding)}.outline-end{flex-grow:1;margin-inline-start:calc(-1*var(--_outline-label-padding))}.outline-end::before,.outline-end::after{border-inline-start-style:none;border-inline-end-style:solid;border-start-start-radius:0;border-start-end-radius:inherit;border-end-start-radius:0;border-end-end-radius:inherit}.outline-notch{align-items:flex-start;border:inherit;display:flex;margin-inline-start:calc(-1*var(--_outline-label-padding));margin-inline-end:var(--_outline-label-padding);max-width:calc(100% - var(--_leading-space) - var(--_trailing-space));padding:0 var(--_outline-label-padding);position:relative}.no-label .outline-notch{display:none}.outline-panel-inactive,.outline-panel-active{border:inherit;border-bottom-style:solid;inset:0;position:absolute}.outline-panel-inactive::before,.outline-panel-inactive::after,.outline-panel-active::before,.outline-panel-active::after{border-top-style:solid;border-bottom:none;bottom:auto;transform:scaleX(1);transition:transform 150ms cubic-bezier(0.2, 0, 0, 1)}.outline-panel-inactive::before,.outline-panel-active::before{right:50%;transform-origin:top left}.outline-panel-inactive::after,.outline-panel-active::after{left:50%;transform-origin:top right}.populated .outline-panel-inactive::before,.populated .outline-panel-inactive::after,.populated .outline-panel-active::before,.populated .outline-panel-active::after,.focused .outline-panel-inactive::before,.focused .outline-panel-inactive::after,.focused .outline-panel-active::before,.focused .outline-panel-active::after{transform:scaleX(0)}.outline-panel-active{opacity:0;transition:opacity 150ms cubic-bezier(0.2, 0, 0, 1)}.focused .outline-panel-active{opacity:1}.outline-label{display:flex;max-width:100%;transform:translateY(calc(-100% + var(--_label-text-padding-bottom)))}.outline-start,.field:not(.with-start) .content ::slotted(*){padding-inline-start:max(var(--_leading-space),max(var(--_container-shape-start-start),var(--_container-shape-end-start)) + var(--_outline-label-padding))}.field:not(.with-start) .label-wrapper{margin-inline-start:max(var(--_leading-space),max(var(--_container-shape-start-start),var(--_container-shape-end-start)) + var(--_outline-label-padding))}.field:not(.with-end) .content ::slotted(*){padding-inline-end:max(var(--_trailing-space),max(var(--_container-shape-start-end),var(--_container-shape-end-end)))}.field:not(.with-end) .label-wrapper{margin-inline-end:max(var(--_trailing-space),max(var(--_container-shape-start-end),var(--_container-shape-end-end)))}.outline-start::before,.outline-end::before,.outline-panel-inactive,.outline-panel-inactive::before,.outline-panel-inactive::after{border-width:var(--_outline-width)}:hover .outline{border-color:var(--_hover-outline-color);color:var(--_hover-outline-color)}:hover .outline-start::before,:hover .outline-end::before,:hover .outline-panel-inactive,:hover .outline-panel-inactive::before,:hover .outline-panel-inactive::after{border-width:var(--_hover-outline-width)}.focused .outline{border-color:var(--_focus-outline-color);color:var(--_focus-outline-color)}.outline-start::after,.outline-end::after,.outline-panel-active,.outline-panel-active::before,.outline-panel-active::after{border-width:var(--_focus-outline-width)}.disabled .outline{border-color:var(--_disabled-outline-color);color:var(--_disabled-outline-color)}.disabled .outline-start,.disabled .outline-end,.disabled .outline-panel-inactive{opacity:var(--_disabled-outline-opacity)}.disabled .outline-start::before,.disabled .outline-end::before,.disabled .outline-panel-inactive,.disabled .outline-panel-inactive::before,.disabled .outline-panel-inactive::after{border-width:var(--_disabled-outline-width)}.error .outline{border-color:var(--_error-outline-color);color:var(--_error-outline-color)}.error:hover .outline{border-color:var(--_error-hover-outline-color);color:var(--_error-hover-outline-color)}.error.focused .outline{border-color:var(--_error-focus-outline-color);color:var(--_error-focus-outline-color)}.resizable .container{bottom:var(--_focus-outline-width);inset-inline-end:var(--_focus-outline-width);clip-path:inset(var(--_focus-outline-width) 0 0 var(--_focus-outline-width))}.resizable .container>*{top:var(--_focus-outline-width);inset-inline-start:var(--_focus-outline-width)}.resizable .container:dir(rtl){clip-path:inset(var(--_focus-outline-width) var(--_focus-outline-width) 0 0)}}@layer hcm{@media(forced-colors: active){.disabled .outline{border-color:GrayText;color:GrayText}.disabled :is(.outline-start,.outline-end,.outline-panel-inactive){opacity:1}}}
`;/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Tse=xs`:host{display:inline-flex;resize:both}.field{display:flex;flex:1;flex-direction:column;writing-mode:horizontal-tb;max-width:100%}.container-overflow{border-start-start-radius:var(--_container-shape-start-start);border-start-end-radius:var(--_container-shape-start-end);border-end-end-radius:var(--_container-shape-end-end);border-end-start-radius:var(--_container-shape-end-start);display:flex;height:100%;position:relative}.container{align-items:center;border-radius:inherit;display:flex;flex:1;max-height:100%;min-height:100%;min-width:min-content;position:relative}.field,.container-overflow{resize:inherit}.resizable:not(.disabled) .container{resize:inherit;overflow:hidden}.disabled{pointer-events:none}@layer styles{.start,.middle,.end{display:flex;box-sizing:border-box;height:100%;position:relative}.start{color:var(--_leading-content-color)}.end{color:var(--_trailing-content-color)}.start,.end{align-items:center;justify-content:center}.with-start .start,.with-end .end{min-width:48px}.with-start .start{margin-inline-end:4px}.with-end .end{margin-inline-start:4px}.middle{align-items:stretch;align-self:baseline;flex:1}.content{color:var(--_content-color);display:flex;flex:1;opacity:0;transition:opacity 83ms cubic-bezier(0.2, 0, 0, 1)}.no-label .content,.focused .content,.populated .content{opacity:1;transition-delay:67ms}:is(.disabled,.disable-transitions) .content{transition:none}.content ::slotted(*){all:unset;color:currentColor;font-family:var(--_content-font);font-size:var(--_content-size);line-height:var(--_content-line-height);font-weight:var(--_content-weight);width:100%;overflow-wrap:revert;white-space:revert}.content ::slotted(:not(textarea)){padding-top:var(--_top-space);padding-bottom:var(--_bottom-space)}.content ::slotted(textarea){margin-top:var(--_top-space);margin-bottom:var(--_bottom-space)}:hover .content{color:var(--_hover-content-color)}:hover .start{color:var(--_hover-leading-content-color)}:hover .end{color:var(--_hover-trailing-content-color)}.focused .content{color:var(--_focus-content-color)}.focused .start{color:var(--_focus-leading-content-color)}.focused .end{color:var(--_focus-trailing-content-color)}.disabled .content{color:var(--_disabled-content-color)}.disabled.no-label .content,.disabled.focused .content,.disabled.populated .content{opacity:var(--_disabled-content-opacity)}.disabled .start{color:var(--_disabled-leading-content-color);opacity:var(--_disabled-leading-content-opacity)}.disabled .end{color:var(--_disabled-trailing-content-color);opacity:var(--_disabled-trailing-content-opacity)}.error .content{color:var(--_error-content-color)}.error .start{color:var(--_error-leading-content-color)}.error .end{color:var(--_error-trailing-content-color)}.error:hover .content{color:var(--_error-hover-content-color)}.error:hover .start{color:var(--_error-hover-leading-content-color)}.error:hover .end{color:var(--_error-hover-trailing-content-color)}.error.focused .content{color:var(--_error-focus-content-color)}.error.focused .start{color:var(--_error-focus-leading-content-color)}.error.focused .end{color:var(--_error-focus-trailing-content-color)}}@layer hcm{@media(forced-colors: active){.disabled :is(.start,.content,.end){color:GrayText;opacity:1}}}@layer styles{.label{box-sizing:border-box;color:var(--_label-text-color);overflow:hidden;max-width:100%;text-overflow:ellipsis;white-space:nowrap;z-index:1;font-family:var(--_label-text-font);font-size:var(--_label-text-size);line-height:var(--_label-text-line-height);font-weight:var(--_label-text-weight);width:min-content}.label-wrapper{inset:0;pointer-events:none;position:absolute}.label.resting{position:absolute;top:var(--_top-space)}.label.floating{font-size:var(--_label-text-populated-size);line-height:var(--_label-text-populated-line-height);transform-origin:top left}.label.hidden{opacity:0}.no-label .label{display:none}.label-wrapper{inset:0;position:absolute;text-align:initial}:hover .label{color:var(--_hover-label-text-color)}.focused .label{color:var(--_focus-label-text-color)}.disabled .label{color:var(--_disabled-label-text-color)}.disabled .label:not(.hidden){opacity:var(--_disabled-label-text-opacity)}.error .label{color:var(--_error-label-text-color)}.error:hover .label{color:var(--_error-hover-label-text-color)}.error.focused .label{color:var(--_error-focus-label-text-color)}}@layer hcm{@media(forced-colors: active){.disabled .label:not(.hidden){color:GrayText;opacity:1}}}@layer styles{.supporting-text{color:var(--_supporting-text-color);display:flex;font-family:var(--_supporting-text-font);font-size:var(--_supporting-text-size);line-height:var(--_supporting-text-line-height);font-weight:var(--_supporting-text-weight);gap:16px;justify-content:space-between;padding-inline-start:var(--_supporting-text-leading-space);padding-inline-end:var(--_supporting-text-trailing-space);padding-top:var(--_supporting-text-top-space)}.supporting-text :nth-child(2){flex-shrink:0}:hover .supporting-text{color:var(--_hover-supporting-text-color)}.focus .supporting-text{color:var(--_focus-supporting-text-color)}.disabled .supporting-text{color:var(--_disabled-supporting-text-color);opacity:var(--_disabled-supporting-text-opacity)}.error .supporting-text{color:var(--_error-supporting-text-color)}.error:hover .supporting-text{color:var(--_error-hover-supporting-text-color)}.error.focus .supporting-text{color:var(--_error-focus-supporting-text-color)}}@layer hcm{@media(forced-colors: active){.disabled .supporting-text{color:GrayText;opacity:1}}}
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let tS=class extends bse{};tS.styles=[Tse,wse];tS=At([ea("md-outlined-field")],tS);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ese=xs`:host{--_caret-color: var(--md-outlined-text-field-caret-color, var(--md-sys-color-primary, #6750a4));--_disabled-input-text-color: var(--md-outlined-text-field-disabled-input-text-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-input-text-opacity: var(--md-outlined-text-field-disabled-input-text-opacity, 0.38);--_disabled-label-text-color: var(--md-outlined-text-field-disabled-label-text-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-label-text-opacity: var(--md-outlined-text-field-disabled-label-text-opacity, 0.38);--_disabled-leading-icon-color: var(--md-outlined-text-field-disabled-leading-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-leading-icon-opacity: var(--md-outlined-text-field-disabled-leading-icon-opacity, 0.38);--_disabled-outline-color: var(--md-outlined-text-field-disabled-outline-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-outline-opacity: var(--md-outlined-text-field-disabled-outline-opacity, 0.12);--_disabled-outline-width: var(--md-outlined-text-field-disabled-outline-width, 1px);--_disabled-supporting-text-color: var(--md-outlined-text-field-disabled-supporting-text-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-supporting-text-opacity: var(--md-outlined-text-field-disabled-supporting-text-opacity, 0.38);--_disabled-trailing-icon-color: var(--md-outlined-text-field-disabled-trailing-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-trailing-icon-opacity: var(--md-outlined-text-field-disabled-trailing-icon-opacity, 0.38);--_error-focus-caret-color: var(--md-outlined-text-field-error-focus-caret-color, var(--md-sys-color-error, #b3261e));--_error-focus-input-text-color: var(--md-outlined-text-field-error-focus-input-text-color, var(--md-sys-color-on-surface, #1d1b20));--_error-focus-label-text-color: var(--md-outlined-text-field-error-focus-label-text-color, var(--md-sys-color-error, #b3261e));--_error-focus-leading-icon-color: var(--md-outlined-text-field-error-focus-leading-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_error-focus-outline-color: var(--md-outlined-text-field-error-focus-outline-color, var(--md-sys-color-error, #b3261e));--_error-focus-supporting-text-color: var(--md-outlined-text-field-error-focus-supporting-text-color, var(--md-sys-color-error, #b3261e));--_error-focus-trailing-icon-color: var(--md-outlined-text-field-error-focus-trailing-icon-color, var(--md-sys-color-error, #b3261e));--_error-hover-input-text-color: var(--md-outlined-text-field-error-hover-input-text-color, var(--md-sys-color-on-surface, #1d1b20));--_error-hover-label-text-color: var(--md-outlined-text-field-error-hover-label-text-color, var(--md-sys-color-on-error-container, #410e0b));--_error-hover-leading-icon-color: var(--md-outlined-text-field-error-hover-leading-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_error-hover-outline-color: var(--md-outlined-text-field-error-hover-outline-color, var(--md-sys-color-on-error-container, #410e0b));--_error-hover-supporting-text-color: var(--md-outlined-text-field-error-hover-supporting-text-color, var(--md-sys-color-error, #b3261e));--_error-hover-trailing-icon-color: var(--md-outlined-text-field-error-hover-trailing-icon-color, var(--md-sys-color-on-error-container, #410e0b));--_error-input-text-color: var(--md-outlined-text-field-error-input-text-color, var(--md-sys-color-on-surface, #1d1b20));--_error-label-text-color: var(--md-outlined-text-field-error-label-text-color, var(--md-sys-color-error, #b3261e));--_error-leading-icon-color: var(--md-outlined-text-field-error-leading-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_error-outline-color: var(--md-outlined-text-field-error-outline-color, var(--md-sys-color-error, #b3261e));--_error-supporting-text-color: var(--md-outlined-text-field-error-supporting-text-color, var(--md-sys-color-error, #b3261e));--_error-trailing-icon-color: var(--md-outlined-text-field-error-trailing-icon-color, var(--md-sys-color-error, #b3261e));--_focus-input-text-color: var(--md-outlined-text-field-focus-input-text-color, var(--md-sys-color-on-surface, #1d1b20));--_focus-label-text-color: var(--md-outlined-text-field-focus-label-text-color, var(--md-sys-color-primary, #6750a4));--_focus-leading-icon-color: var(--md-outlined-text-field-focus-leading-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_focus-outline-color: var(--md-outlined-text-field-focus-outline-color, var(--md-sys-color-primary, #6750a4));--_focus-outline-width: var(--md-outlined-text-field-focus-outline-width, 3px);--_focus-supporting-text-color: var(--md-outlined-text-field-focus-supporting-text-color, var(--md-sys-color-on-surface-variant, #49454f));--_focus-trailing-icon-color: var(--md-outlined-text-field-focus-trailing-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-input-text-color: var(--md-outlined-text-field-hover-input-text-color, var(--md-sys-color-on-surface, #1d1b20));--_hover-label-text-color: var(--md-outlined-text-field-hover-label-text-color, var(--md-sys-color-on-surface, #1d1b20));--_hover-leading-icon-color: var(--md-outlined-text-field-hover-leading-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-outline-color: var(--md-outlined-text-field-hover-outline-color, var(--md-sys-color-on-surface, #1d1b20));--_hover-outline-width: var(--md-outlined-text-field-hover-outline-width, 1px);--_hover-supporting-text-color: var(--md-outlined-text-field-hover-supporting-text-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-trailing-icon-color: var(--md-outlined-text-field-hover-trailing-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_input-text-color: var(--md-outlined-text-field-input-text-color, var(--md-sys-color-on-surface, #1d1b20));--_input-text-font: var(--md-outlined-text-field-input-text-font, var(--md-sys-typescale-body-large-font, var(--md-ref-typeface-plain, Roboto)));--_input-text-line-height: var(--md-outlined-text-field-input-text-line-height, var(--md-sys-typescale-body-large-line-height, 1.5rem));--_input-text-placeholder-color: var(--md-outlined-text-field-input-text-placeholder-color, var(--md-sys-color-on-surface-variant, #49454f));--_input-text-prefix-color: var(--md-outlined-text-field-input-text-prefix-color, var(--md-sys-color-on-surface-variant, #49454f));--_input-text-size: var(--md-outlined-text-field-input-text-size, var(--md-sys-typescale-body-large-size, 1rem));--_input-text-suffix-color: var(--md-outlined-text-field-input-text-suffix-color, var(--md-sys-color-on-surface-variant, #49454f));--_input-text-weight: var(--md-outlined-text-field-input-text-weight, var(--md-sys-typescale-body-large-weight, var(--md-ref-typeface-weight-regular, 400)));--_label-text-color: var(--md-outlined-text-field-label-text-color, var(--md-sys-color-on-surface-variant, #49454f));--_label-text-font: var(--md-outlined-text-field-label-text-font, var(--md-sys-typescale-body-large-font, var(--md-ref-typeface-plain, Roboto)));--_label-text-line-height: var(--md-outlined-text-field-label-text-line-height, var(--md-sys-typescale-body-large-line-height, 1.5rem));--_label-text-populated-line-height: var(--md-outlined-text-field-label-text-populated-line-height, var(--md-sys-typescale-body-small-line-height, 1rem));--_label-text-populated-size: var(--md-outlined-text-field-label-text-populated-size, var(--md-sys-typescale-body-small-size, 0.75rem));--_label-text-size: var(--md-outlined-text-field-label-text-size, var(--md-sys-typescale-body-large-size, 1rem));--_label-text-weight: var(--md-outlined-text-field-label-text-weight, var(--md-sys-typescale-body-large-weight, var(--md-ref-typeface-weight-regular, 400)));--_leading-icon-color: var(--md-outlined-text-field-leading-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_leading-icon-size: var(--md-outlined-text-field-leading-icon-size, 24px);--_outline-color: var(--md-outlined-text-field-outline-color, var(--md-sys-color-outline, #79747e));--_outline-width: var(--md-outlined-text-field-outline-width, 1px);--_supporting-text-color: var(--md-outlined-text-field-supporting-text-color, var(--md-sys-color-on-surface-variant, #49454f));--_supporting-text-font: var(--md-outlined-text-field-supporting-text-font, var(--md-sys-typescale-body-small-font, var(--md-ref-typeface-plain, Roboto)));--_supporting-text-line-height: var(--md-outlined-text-field-supporting-text-line-height, var(--md-sys-typescale-body-small-line-height, 1rem));--_supporting-text-size: var(--md-outlined-text-field-supporting-text-size, var(--md-sys-typescale-body-small-size, 0.75rem));--_supporting-text-weight: var(--md-outlined-text-field-supporting-text-weight, var(--md-sys-typescale-body-small-weight, var(--md-ref-typeface-weight-regular, 400)));--_trailing-icon-color: var(--md-outlined-text-field-trailing-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_trailing-icon-size: var(--md-outlined-text-field-trailing-icon-size, 24px);--_container-shape-start-start: var(--md-outlined-text-field-container-shape-start-start, var(--md-outlined-text-field-container-shape, var(--md-sys-shape-corner-extra-small, 4px)));--_container-shape-start-end: var(--md-outlined-text-field-container-shape-start-end, var(--md-outlined-text-field-container-shape, var(--md-sys-shape-corner-extra-small, 4px)));--_container-shape-end-end: var(--md-outlined-text-field-container-shape-end-end, var(--md-outlined-text-field-container-shape, var(--md-sys-shape-corner-extra-small, 4px)));--_container-shape-end-start: var(--md-outlined-text-field-container-shape-end-start, var(--md-outlined-text-field-container-shape, var(--md-sys-shape-corner-extra-small, 4px)));--_leading-space: var(--md-outlined-text-field-leading-space, 16px);--_trailing-space: var(--md-outlined-text-field-trailing-space, 16px);--_top-space: var(--md-outlined-text-field-top-space, 16px);--_bottom-space: var(--md-outlined-text-field-bottom-space, 16px);--_input-text-prefix-trailing-space: var(--md-outlined-text-field-input-text-prefix-trailing-space, 2px);--_input-text-suffix-leading-space: var(--md-outlined-text-field-input-text-suffix-leading-space, 2px);--_focus-caret-color: var(--md-outlined-text-field-focus-caret-color, var(--md-sys-color-primary, #6750a4));--md-outlined-field-bottom-space: var(--_bottom-space);--md-outlined-field-container-shape-end-end: var(--_container-shape-end-end);--md-outlined-field-container-shape-end-start: var(--_container-shape-end-start);--md-outlined-field-container-shape-start-end: var(--_container-shape-start-end);--md-outlined-field-container-shape-start-start: var(--_container-shape-start-start);--md-outlined-field-content-color: var(--_input-text-color);--md-outlined-field-content-font: var(--_input-text-font);--md-outlined-field-content-line-height: var(--_input-text-line-height);--md-outlined-field-content-size: var(--_input-text-size);--md-outlined-field-content-weight: var(--_input-text-weight);--md-outlined-field-disabled-content-color: var(--_disabled-input-text-color);--md-outlined-field-disabled-content-opacity: var(--_disabled-input-text-opacity);--md-outlined-field-disabled-label-text-color: var(--_disabled-label-text-color);--md-outlined-field-disabled-label-text-opacity: var(--_disabled-label-text-opacity);--md-outlined-field-disabled-leading-content-color: var(--_disabled-leading-icon-color);--md-outlined-field-disabled-leading-content-opacity: var(--_disabled-leading-icon-opacity);--md-outlined-field-disabled-outline-color: var(--_disabled-outline-color);--md-outlined-field-disabled-outline-opacity: var(--_disabled-outline-opacity);--md-outlined-field-disabled-outline-width: var(--_disabled-outline-width);--md-outlined-field-disabled-supporting-text-color: var(--_disabled-supporting-text-color);--md-outlined-field-disabled-supporting-text-opacity: var(--_disabled-supporting-text-opacity);--md-outlined-field-disabled-trailing-content-color: var(--_disabled-trailing-icon-color);--md-outlined-field-disabled-trailing-content-opacity: var(--_disabled-trailing-icon-opacity);--md-outlined-field-error-content-color: var(--_error-input-text-color);--md-outlined-field-error-focus-content-color: var(--_error-focus-input-text-color);--md-outlined-field-error-focus-label-text-color: var(--_error-focus-label-text-color);--md-outlined-field-error-focus-leading-content-color: var(--_error-focus-leading-icon-color);--md-outlined-field-error-focus-outline-color: var(--_error-focus-outline-color);--md-outlined-field-error-focus-supporting-text-color: var(--_error-focus-supporting-text-color);--md-outlined-field-error-focus-trailing-content-color: var(--_error-focus-trailing-icon-color);--md-outlined-field-error-hover-content-color: var(--_error-hover-input-text-color);--md-outlined-field-error-hover-label-text-color: var(--_error-hover-label-text-color);--md-outlined-field-error-hover-leading-content-color: var(--_error-hover-leading-icon-color);--md-outlined-field-error-hover-outline-color: var(--_error-hover-outline-color);--md-outlined-field-error-hover-supporting-text-color: var(--_error-hover-supporting-text-color);--md-outlined-field-error-hover-trailing-content-color: var(--_error-hover-trailing-icon-color);--md-outlined-field-error-label-text-color: var(--_error-label-text-color);--md-outlined-field-error-leading-content-color: var(--_error-leading-icon-color);--md-outlined-field-error-outline-color: var(--_error-outline-color);--md-outlined-field-error-supporting-text-color: var(--_error-supporting-text-color);--md-outlined-field-error-trailing-content-color: var(--_error-trailing-icon-color);--md-outlined-field-focus-content-color: var(--_focus-input-text-color);--md-outlined-field-focus-label-text-color: var(--_focus-label-text-color);--md-outlined-field-focus-leading-content-color: var(--_focus-leading-icon-color);--md-outlined-field-focus-outline-color: var(--_focus-outline-color);--md-outlined-field-focus-outline-width: var(--_focus-outline-width);--md-outlined-field-focus-supporting-text-color: var(--_focus-supporting-text-color);--md-outlined-field-focus-trailing-content-color: var(--_focus-trailing-icon-color);--md-outlined-field-hover-content-color: var(--_hover-input-text-color);--md-outlined-field-hover-label-text-color: var(--_hover-label-text-color);--md-outlined-field-hover-leading-content-color: var(--_hover-leading-icon-color);--md-outlined-field-hover-outline-color: var(--_hover-outline-color);--md-outlined-field-hover-outline-width: var(--_hover-outline-width);--md-outlined-field-hover-supporting-text-color: var(--_hover-supporting-text-color);--md-outlined-field-hover-trailing-content-color: var(--_hover-trailing-icon-color);--md-outlined-field-label-text-color: var(--_label-text-color);--md-outlined-field-label-text-font: var(--_label-text-font);--md-outlined-field-label-text-line-height: var(--_label-text-line-height);--md-outlined-field-label-text-populated-line-height: var(--_label-text-populated-line-height);--md-outlined-field-label-text-populated-size: var(--_label-text-populated-size);--md-outlined-field-label-text-size: var(--_label-text-size);--md-outlined-field-label-text-weight: var(--_label-text-weight);--md-outlined-field-leading-content-color: var(--_leading-icon-color);--md-outlined-field-leading-space: var(--_leading-space);--md-outlined-field-outline-color: var(--_outline-color);--md-outlined-field-outline-width: var(--_outline-width);--md-outlined-field-supporting-text-color: var(--_supporting-text-color);--md-outlined-field-supporting-text-font: var(--_supporting-text-font);--md-outlined-field-supporting-text-line-height: var(--_supporting-text-line-height);--md-outlined-field-supporting-text-size: var(--_supporting-text-size);--md-outlined-field-supporting-text-weight: var(--_supporting-text-weight);--md-outlined-field-top-space: var(--_top-space);--md-outlined-field-trailing-content-color: var(--_trailing-icon-color);--md-outlined-field-trailing-space: var(--_trailing-space)}
`;/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ase=n=>n.strings===void 0,Ise={},Sse=(n,e=Ise)=>n._$AH=e;/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const tO=RR(class extends PR{constructor(n){if(super(n),n.type!==Id.PROPERTY&&n.type!==Id.ATTRIBUTE&&n.type!==Id.BOOLEAN_ATTRIBUTE)throw Error("The `live` directive is not allowed on child or event bindings");if(!Ase(n))throw Error("`live` bindings can only contain a single expression")}render(n){return n}update(n,[e]){if(e===Bl||e===Pr)return e;const r=n.element,s=n.name;if(n.type===Id.PROPERTY){if(e===r[s])return Bl}else if(n.type===Id.BOOLEAN_ATTRIBUTE){if(!!e===r.hasAttribute(s))return Bl}else if(n.type===Id.ATTRIBUTE&&r.getAttribute(s)===e+"")return Bl;return Sse(n),e}});/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const z8="important",Cse=" !"+z8,rS=RR(class extends PR{constructor(n){var e;if(super(n),n.type!==Id.ATTRIBUTE||n.name!=="style"||((e=n.strings)==null?void 0:e.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(n){return Object.keys(n).reduce((e,r)=>{const s=n[r];return s==null?e:e+`${r=r.includes("-")?r:r.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${s};`},"")}update(n,[e]){const{style:r}=n.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(e)),this.render(e);for(const s of this.ft)e[s]==null&&(this.ft.delete(s),s.includes("-")?r.removeProperty(s):r[s]=null);for(const s in e){const c=e[s];if(c!=null){this.ft.add(s);const d=typeof c=="string"&&c.endsWith(Cse);s.includes("-")||d?r.setProperty(s,d?c.slice(0,-11):c,d?z8:""):r[s]=c}}return Bl}});/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Rse={fromAttribute(n){return n??""},toAttribute(n){return n||null}};/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const iS=Symbol("onReportValidity"),Hb=Symbol("privateCleanupFormListeners"),Wb=Symbol("privateDoNotReportInvalid"),Zb=Symbol("privateIsSelfReportingValidity"),Xb=Symbol("privateCallOnReportValidity");function Pse(n){var e,r,s;class c extends n{constructor(..._){super(..._),this[e]=new AbortController,this[r]=!1,this[s]=!1,this.addEventListener("invalid",x=>{this[Wb]||!x.isTrusted||this.addEventListener("invalid",()=>{this[Xb](x)},{once:!0})},{capture:!0})}checkValidity(){this[Wb]=!0;const _=super.checkValidity();return this[Wb]=!1,_}reportValidity(){this[Zb]=!0;const _=super.reportValidity();return _&&this[Xb](null),this[Zb]=!1,_}[(e=Hb,r=Wb,s=Zb,Xb)](_){const x=_==null?void 0:_.defaultPrevented;x||(this[iS](_),!(!x&&(_==null?void 0:_.defaultPrevented)))||(this[Zb]||Dse(this[pa].form,this))&&this.focus()}[iS](_){throw new Error("Implement [onReportValidity]")}formAssociatedCallback(_){super.formAssociatedCallback&&super.formAssociatedCallback(_),this[Hb].abort(),_&&(this[Hb]=new AbortController,Mse(this,_,()=>{this[Xb](null)},this[Hb].signal))}}return c}function Mse(n,e,r,s){const c=kse(e);let d=!1,_,x=!1;c.addEventListener("before",()=>{x=!0,_=new AbortController,d=!1,n.addEventListener("invalid",()=>{d=!0},{signal:_.signal})},{signal:s}),c.addEventListener("after",()=>{x=!1,_==null||_.abort(),!d&&r()},{signal:s}),e.addEventListener("submit",()=>{x||r()},{signal:s})}const xA=new WeakMap;function kse(n){if(!xA.has(n)){const e=new EventTarget;xA.set(n,e);for(const r of["reportValidity","requestSubmit"]){const s=n[r];n[r]=function(){e.dispatchEvent(new Event("before"));const c=Reflect.apply(s,this,arguments);return e.dispatchEvent(new Event("after")),c}}}return xA.get(n)}function Dse(n,e){if(!n)return!0;let r;for(const s of n.elements)if(s.matches(":invalid")){r=s;break}return r===e}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Lse extends L8{computeValidity({state:e,renderedControl:r}){let s=r;Uy(e)&&!s?(s=this.inputControl||document.createElement("input"),this.inputControl=s):s||(s=this.textAreaControl||document.createElement("textarea"),this.textAreaControl=s);const c=Uy(e)?s:null;if(c&&(c.type=e.type),s.value!==e.value&&(s.value=e.value),s.required=e.required,c){const d=e;d.pattern?c.pattern=d.pattern:c.removeAttribute("pattern"),d.min?c.min=d.min:c.removeAttribute("min"),d.max?c.max=d.max:c.removeAttribute("max"),d.step?c.step=d.step:c.removeAttribute("step")}return(e.minLength??-1)>-1?s.setAttribute("minlength",String(e.minLength)):s.removeAttribute("minlength"),(e.maxLength??-1)>-1?s.setAttribute("maxlength",String(e.maxLength)):s.removeAttribute("maxlength"),{validity:s.validity,validationMessage:s.validationMessage}}equals({state:e},{state:r}){const s=e.type===r.type&&e.value===r.value&&e.required===r.required&&e.minLength===r.minLength&&e.maxLength===r.maxLength;return!Uy(e)||!Uy(r)?s:s&&e.pattern===r.pattern&&e.min===r.min&&e.max===r.max&&e.step===r.step}copy({state:e}){return{state:Uy(e)?this.copyInput(e):this.copyTextArea(e),renderedControl:null}}copyInput(e){const{type:r,pattern:s,min:c,max:d,step:_}=e;return{...this.copySharedState(e),type:r,pattern:s,min:c,max:d,step:_}}copyTextArea(e){return{...this.copySharedState(e),type:e.type}}copySharedState({value:e,required:r,minLength:s,maxLength:c}){return{value:e,required:r,minLength:s,maxLength:c}}}function Uy(n){return n.type!=="textarea"}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ose=Pse(kR(DE(s0(Ys))));class Wi extends Ose{constructor(){super(...arguments),this.error=!1,this.errorText="",this.label="",this.noAsterisk=!1,this.required=!1,this.value="",this.prefixText="",this.suffixText="",this.hasLeadingIcon=!1,this.hasTrailingIcon=!1,this.supportingText="",this.textDirection="",this.rows=2,this.cols=20,this.inputMode="",this.max="",this.maxLength=-1,this.min="",this.minLength=-1,this.noSpinner=!1,this.pattern="",this.placeholder="",this.readOnly=!1,this.multiple=!1,this.step="",this.type="text",this.autocomplete="",this.dirty=!1,this.focused=!1,this.nativeError=!1,this.nativeErrorText=""}get selectionDirection(){return this.getInputOrTextarea().selectionDirection}set selectionDirection(e){this.getInputOrTextarea().selectionDirection=e}get selectionEnd(){return this.getInputOrTextarea().selectionEnd}set selectionEnd(e){this.getInputOrTextarea().selectionEnd=e}get selectionStart(){return this.getInputOrTextarea().selectionStart}set selectionStart(e){this.getInputOrTextarea().selectionStart=e}get valueAsNumber(){const e=this.getInput();return e?e.valueAsNumber:NaN}set valueAsNumber(e){const r=this.getInput();r&&(r.valueAsNumber=e,this.value=r.value)}get valueAsDate(){const e=this.getInput();return e?e.valueAsDate:null}set valueAsDate(e){const r=this.getInput();r&&(r.valueAsDate=e,this.value=r.value)}get hasError(){return this.error||this.nativeError}select(){this.getInputOrTextarea().select()}setRangeText(...e){this.getInputOrTextarea().setRangeText(...e),this.value=this.getInputOrTextarea().value}setSelectionRange(e,r,s){this.getInputOrTextarea().setSelectionRange(e,r,s)}stepDown(e){const r=this.getInput();r&&(r.stepDown(e),this.value=r.value)}stepUp(e){const r=this.getInput();r&&(r.stepUp(e),this.value=r.value)}reset(){this.dirty=!1,this.value=this.getAttribute("value")??"",this.nativeError=!1,this.nativeErrorText=""}attributeChangedCallback(e,r,s){e==="value"&&this.dirty||super.attributeChangedCallback(e,r,s)}render(){const e={disabled:this.disabled,error:!this.disabled&&this.hasError,textarea:this.type==="textarea","no-spinner":this.noSpinner};return bi`
      <span class="text-field ${za(e)}">
        ${this.renderField()}
      </span>
    `}updated(e){const r=this.getInputOrTextarea().value;this.value!==r&&(this.value=r)}renderField(){return T8`<${this.fieldTag}
      class="field"
      count=${this.value.length}
      ?disabled=${this.disabled}
      ?error=${this.hasError}
      error-text=${this.getErrorText()}
      ?focused=${this.focused}
      ?has-end=${this.hasTrailingIcon}
      ?has-start=${this.hasLeadingIcon}
      label=${this.label}
      ?no-asterisk=${this.noAsterisk}
      max=${this.maxLength}
      ?populated=${!!this.value}
      ?required=${this.required}
      ?resizable=${this.type==="textarea"}
      supporting-text=${this.supportingText}
    >
      ${this.renderLeadingIcon()}
      ${this.renderInputOrTextarea()}
      ${this.renderTrailingIcon()}
      <div id="description" slot="aria-describedby"></div>
    </${this.fieldTag}>`}renderLeadingIcon(){return bi`
      <span class="icon leading" slot="start">
        <slot name="leading-icon" @slotchange=${this.handleIconChange}></slot>
      </span>
    `}renderTrailingIcon(){return bi`
      <span class="icon trailing" slot="end">
        <slot name="trailing-icon" @slotchange=${this.handleIconChange}></slot>
      </span>
    `}renderInputOrTextarea(){const e={direction:this.textDirection},r=this.ariaLabel||this.label||Pr,s=this.autocomplete,c=(this.maxLength??-1)>-1,d=(this.minLength??-1)>-1;if(this.type==="textarea")return bi`
        <textarea
          class="input"
          style=${rS(e)}
          aria-describedby="description"
          aria-invalid=${this.hasError}
          aria-label=${r}
          autocomplete=${s||Pr}
          name=${this.name||Pr}
          ?disabled=${this.disabled}
          maxlength=${c?this.maxLength:Pr}
          minlength=${d?this.minLength:Pr}
          placeholder=${this.placeholder||Pr}
          ?readonly=${this.readOnly}
          ?required=${this.required}
          rows=${this.rows}
          cols=${this.cols}
          .value=${tO(this.value)}
          @change=${this.redispatchEvent}
          @focus=${this.handleFocusChange}
          @blur=${this.handleFocusChange}
          @input=${this.handleInput}
          @select=${this.redispatchEvent}></textarea>
      `;const _=this.renderPrefix(),x=this.renderSuffix(),l=this.inputMode;return bi`
      <div class="input-wrapper">
        ${_}
        <input
          class="input"
          style=${rS(e)}
          aria-describedby="description"
          aria-invalid=${this.hasError}
          aria-label=${r}
          autocomplete=${s||Pr}
          name=${this.name||Pr}
          ?disabled=${this.disabled}
          inputmode=${l||Pr}
          max=${this.max||Pr}
          maxlength=${c?this.maxLength:Pr}
          min=${this.min||Pr}
          minlength=${d?this.minLength:Pr}
          pattern=${this.pattern||Pr}
          placeholder=${this.placeholder||Pr}
          ?readonly=${this.readOnly}
          ?required=${this.required}
          ?multiple=${this.multiple}
          step=${this.step||Pr}
          type=${this.type}
          .value=${tO(this.value)}
          @change=${this.redispatchEvent}
          @focus=${this.handleFocusChange}
          @blur=${this.handleFocusChange}
          @input=${this.handleInput}
          @select=${this.redispatchEvent} />
        ${x}
      </div>
    `}renderPrefix(){return this.renderAffix(this.prefixText,!1)}renderSuffix(){return this.renderAffix(this.suffixText,!0)}renderAffix(e,r){return e?bi`<span class="${za({suffix:r,prefix:!r})}">${e}</span>`:Pr}getErrorText(){return this.error?this.errorText:this.nativeErrorText}handleFocusChange(){var e;this.focused=((e=this.inputOrTextarea)==null?void 0:e.matches(":focus"))??!1}handleInput(e){this.dirty=!0,this.value=e.target.value}redispatchEvent(e){c1(this,e)}getInputOrTextarea(){return this.inputOrTextarea||(this.connectedCallback(),this.scheduleUpdate()),this.isUpdatePending&&this.scheduleUpdate(),this.inputOrTextarea}getInput(){return this.type==="textarea"?null:this.getInputOrTextarea()}handleIconChange(){this.hasLeadingIcon=this.leadingIcons.length>0,this.hasTrailingIcon=this.trailingIcons.length>0}[Fp](){return this.value}formResetCallback(){this.reset()}formStateRestoreCallback(e){this.value=e}focus(){this.getInputOrTextarea().focus()}[u1](){return new Lse(()=>({state:this,renderedControl:this.inputOrTextarea}))}[h1](){return this.inputOrTextarea}[iS](e){var s;e==null||e.preventDefault();const r=this.getErrorText();this.nativeError=!!e,this.nativeErrorText=this.validationMessage,r===this.getErrorText()&&((s=this.field)==null||s.reannounceError())}}ym(Wi);Wi.shadowRootOptions={...Ys.shadowRootOptions,delegatesFocus:!0};At([lr({type:Boolean,reflect:!0})],Wi.prototype,"error",void 0);At([lr({attribute:"error-text"})],Wi.prototype,"errorText",void 0);At([lr()],Wi.prototype,"label",void 0);At([lr({type:Boolean,attribute:"no-asterisk"})],Wi.prototype,"noAsterisk",void 0);At([lr({type:Boolean,reflect:!0})],Wi.prototype,"required",void 0);At([lr()],Wi.prototype,"value",void 0);At([lr({attribute:"prefix-text"})],Wi.prototype,"prefixText",void 0);At([lr({attribute:"suffix-text"})],Wi.prototype,"suffixText",void 0);At([lr({type:Boolean,attribute:"has-leading-icon"})],Wi.prototype,"hasLeadingIcon",void 0);At([lr({type:Boolean,attribute:"has-trailing-icon"})],Wi.prototype,"hasTrailingIcon",void 0);At([lr({attribute:"supporting-text"})],Wi.prototype,"supportingText",void 0);At([lr({attribute:"text-direction"})],Wi.prototype,"textDirection",void 0);At([lr({type:Number})],Wi.prototype,"rows",void 0);At([lr({type:Number})],Wi.prototype,"cols",void 0);At([lr({reflect:!0})],Wi.prototype,"inputMode",void 0);At([lr()],Wi.prototype,"max",void 0);At([lr({type:Number})],Wi.prototype,"maxLength",void 0);At([lr()],Wi.prototype,"min",void 0);At([lr({type:Number})],Wi.prototype,"minLength",void 0);At([lr({type:Boolean,attribute:"no-spinner"})],Wi.prototype,"noSpinner",void 0);At([lr()],Wi.prototype,"pattern",void 0);At([lr({reflect:!0,converter:Rse})],Wi.prototype,"placeholder",void 0);At([lr({type:Boolean,reflect:!0})],Wi.prototype,"readOnly",void 0);At([lr({type:Boolean,reflect:!0})],Wi.prototype,"multiple",void 0);At([lr()],Wi.prototype,"step",void 0);At([lr({reflect:!0})],Wi.prototype,"type",void 0);At([lr({reflect:!0})],Wi.prototype,"autocomplete",void 0);At([Ks()],Wi.prototype,"dirty",void 0);At([Ks()],Wi.prototype,"focused",void 0);At([Ks()],Wi.prototype,"nativeError",void 0);At([Ks()],Wi.prototype,"nativeErrorText",void 0);At([_l(".input")],Wi.prototype,"inputOrTextarea",void 0);At([_l(".field")],Wi.prototype,"field",void 0);At([SE({slot:"leading-icon"})],Wi.prototype,"leadingIcons",void 0);At([SE({slot:"trailing-icon"})],Wi.prototype,"trailingIcons",void 0);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class zse extends Wi{constructor(){super(...arguments),this.fieldTag=yT`md-outlined-field`}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Fse=xs`:host{display:inline-flex;outline:none;resize:both;text-align:start;-webkit-tap-highlight-color:rgba(0,0,0,0)}.text-field,.field{width:100%}.text-field{display:inline-flex}.field{cursor:text}.disabled .field{cursor:default}.text-field,.textarea .field{resize:inherit}.icon{color:currentColor;display:flex;fill:currentColor}.icon ::slotted(*){display:flex}[hasstart] .icon.leading{font-size:var(--_leading-icon-size);height:var(--_leading-icon-size);width:var(--_leading-icon-size)}[hasend] .icon.trailing{font-size:var(--_trailing-icon-size);height:var(--_trailing-icon-size);width:var(--_trailing-icon-size)}.input-wrapper{display:flex}.input-wrapper>*{all:inherit;padding:0}.input{caret-color:var(--_caret-color);overflow-x:hidden;text-align:inherit}.input::placeholder{color:currentColor;opacity:1}.input::-webkit-calendar-picker-indicator{display:none}.input::-webkit-search-decoration,.input::-webkit-search-cancel-button{display:none}@media(forced-colors: active){.input{background:none}}.no-spinner .input::-webkit-inner-spin-button,.no-spinner .input::-webkit-outer-spin-button{display:none}.no-spinner .input[type=number]{-moz-appearance:textfield}:focus-within .input{caret-color:var(--_focus-caret-color)}.error:focus-within .input{caret-color:var(--_error-focus-caret-color)}.text-field:not(.disabled) .prefix{color:var(--_input-text-prefix-color)}.text-field:not(.disabled) .suffix{color:var(--_input-text-suffix-color)}.text-field:not(.disabled) .input::placeholder{color:var(--_input-text-placeholder-color)}.prefix,.suffix{text-wrap:nowrap;width:min-content}.prefix{padding-inline-end:var(--_input-text-prefix-trailing-space)}.suffix{padding-inline-start:var(--_input-text-suffix-leading-space)}
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let nS=class extends zse{constructor(){super(...arguments),this.fieldTag=yT`md-outlined-field`}};nS.styles=[Fse,Ese];nS=At([ea("md-outlined-text-field")],nS);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Nse=xs`@media(forced-colors: active){:host{--md-slider-active-track-color: CanvasText;--md-slider-disabled-active-track-color: GrayText;--md-slider-disabled-active-track-opacity: 1;--md-slider-disabled-handle-color: GrayText;--md-slider-disabled-inactive-track-color: GrayText;--md-slider-disabled-inactive-track-opacity: 1;--md-slider-focus-handle-color: CanvasText;--md-slider-handle-color: CanvasText;--md-slider-handle-shadow-color: Canvas;--md-slider-hover-handle-color: CanvasText;--md-slider-hover-state-layer-color: Canvas;--md-slider-hover-state-layer-opacity: 1;--md-slider-inactive-track-color: Canvas;--md-slider-label-container-color: Canvas;--md-slider-label-text-color: CanvasText;--md-slider-pressed-handle-color: CanvasText;--md-slider-pressed-state-layer-color: Canvas;--md-slider-pressed-state-layer-opacity: 1;--md-slider-with-overlap-handle-outline-color: CanvasText}.label,.label::before{border:var(--_with-overlap-handle-outline-color) solid var(--_with-overlap-handle-outline-width)}:host(:not([disabled])) .track::before{border:1px solid var(--_active-track-color)}.tickmarks::before{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='CanvasText'%3E%3Ccircle cx='2' cy='2'  r='1'/%3E%3C/svg%3E")}.tickmarks::after{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='Canvas'%3E%3Ccircle cx='2' cy='2' r='1'/%3E%3C/svg%3E")}:host([disabled]) .tickmarks::before{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='Canvas'%3E%3Ccircle cx='2' cy='2'  r='1'/%3E%3C/svg%3E")}}
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function bA(n,e,r){return n?e(n):r==null?void 0:r(n)}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Bse=DE(s0(Ys));class Tn extends Bse{get nameStart(){return this.getAttribute("name-start")??this.name}set nameStart(e){this.setAttribute("name-start",e)}get nameEnd(){return this.getAttribute("name-end")??this.nameStart}set nameEnd(e){this.setAttribute("name-end",e)}get renderAriaLabelStart(){const{ariaLabel:e}=this;return this.ariaLabelStart||e&&`${e} start`||this.valueLabelStart||String(this.valueStart)}get renderAriaValueTextStart(){return this.ariaValueTextStart||this.valueLabelStart||String(this.valueStart)}get renderAriaLabelEnd(){const{ariaLabel:e}=this;return this.range?this.ariaLabelEnd||e&&`${e} end`||this.valueLabelEnd||String(this.valueEnd):e||this.valueLabel||String(this.value)}get renderAriaValueTextEnd(){if(this.range)return this.ariaValueTextEnd||this.valueLabelEnd||String(this.valueEnd);const{ariaValueText:e}=this;return e||this.valueLabel||String(this.value)}constructor(){super(),this.min=0,this.max=100,this.valueLabel="",this.valueLabelStart="",this.valueLabelEnd="",this.ariaLabelStart="",this.ariaValueTextStart="",this.ariaLabelEnd="",this.ariaValueTextEnd="",this.step=1,this.ticks=!1,this.labeled=!1,this.range=!1,this.handleStartHover=!1,this.handleEndHover=!1,this.startOnTop=!1,this.handlesOverlapping=!1,this.ripplePointerId=1,this.isRedispatchingEvent=!1,this.addEventListener("click",e=>{!kE(e)||!this.inputEnd||(this.focus(),ME(this.inputEnd))})}focus(){var e;(e=this.inputEnd)==null||e.focus()}willUpdate(e){var s,c;this.renderValueStart=e.has("valueStart")?this.valueStart:(s=this.inputStart)==null?void 0:s.valueAsNumber;const r=e.has("valueEnd")&&this.range||e.has("value");this.renderValueEnd=r?this.range?this.valueEnd:this.value:(c=this.inputEnd)==null?void 0:c.valueAsNumber,e.get("handleStartHover")!==void 0?this.toggleRippleHover(this.rippleStart,this.handleStartHover):e.get("handleEndHover")!==void 0&&this.toggleRippleHover(this.rippleEnd,this.handleEndHover)}updated(e){var r,s;if(this.range&&(this.renderValueStart=this.inputStart.valueAsNumber),this.renderValueEnd=this.inputEnd.valueAsNumber,this.range){const c=(this.max-this.min)/3;if(this.valueStart===void 0){this.inputStart.valueAsNumber=this.min+c;const d=this.inputStart.valueAsNumber;this.valueStart=this.renderValueStart=d}if(this.valueEnd===void 0){this.inputEnd.valueAsNumber=this.min+2*c;const d=this.inputEnd.valueAsNumber;this.valueEnd=this.renderValueEnd=d}}else this.value??(this.value=this.renderValueEnd);if(e.has("range")||e.has("renderValueStart")||e.has("renderValueEnd")||this.isUpdatePending){const c=(r=this.handleStart)==null?void 0:r.querySelector(".handleNub"),d=(s=this.handleEnd)==null?void 0:s.querySelector(".handleNub");this.handlesOverlapping=Vse(c,d)}this.performUpdate()}render(){const e=this.step===0?1:this.step,r=Math.max(this.max-this.min,e),s=this.range?((this.renderValueStart??this.min)-this.min)/r:0,c=((this.renderValueEnd??this.min)-this.min)/r,d={"--_start-fraction":String(s),"--_end-fraction":String(c),"--_tick-count":String(r/e)},_={ranged:this.range},x=this.valueLabelStart||String(this.renderValueStart),l=(this.range?this.valueLabelEnd:this.valueLabel)||String(this.renderValueEnd),S={start:!0,value:this.renderValueStart,ariaLabel:this.renderAriaLabelStart,ariaValueText:this.renderAriaValueTextStart,ariaMin:this.min,ariaMax:this.valueEnd??this.max},D={start:!1,value:this.renderValueEnd,ariaLabel:this.renderAriaLabelEnd,ariaValueText:this.renderAriaValueTextEnd,ariaMin:this.range?this.valueStart??this.min:this.min,ariaMax:this.max},I={start:!0,hover:this.handleStartHover,label:x},V={start:!1,hover:this.handleEndHover,label:l},j={hover:this.handleStartHover||this.handleEndHover};return bi` <div
      class="container ${za(_)}"
      style=${rS(d)}>
      ${bA(this.range,()=>this.renderInput(S))}
      ${this.renderInput(D)} ${this.renderTrack()}
      <div class="handleContainerPadded">
        <div class="handleContainerBlock">
          <div class="handleContainer ${za(j)}">
            ${bA(this.range,()=>this.renderHandle(I))}
            ${this.renderHandle(V)}
          </div>
        </div>
      </div>
    </div>`}renderTrack(){return bi`
      <div class="track"></div>
      ${this.ticks?bi`<div class="tickmarks"></div>`:Pr}
    `}renderLabel(e){return bi`<div class="label" aria-hidden="true">
      <span class="labelContent" part="label">${e}</span>
    </div>`}renderHandle({start:e,hover:r,label:s}){const c=!this.disabled&&e===this.startOnTop,d=!this.disabled&&this.handlesOverlapping,_=e?"start":"end";return bi`<div
      class="handle ${za({[_]:!0,hover:r,onTop:c,isOverlapping:d})}">
      <md-focus-ring part="focus-ring" for=${_}></md-focus-ring>
      <md-ripple
        for=${_}
        class=${_}
        ?disabled=${this.disabled}></md-ripple>
      <div class="handleNub">
        <md-elevation part="elevation"></md-elevation>
      </div>
      ${bA(this.labeled,()=>this.renderLabel(s))}
    </div>`}renderInput({start:e,value:r,ariaLabel:s,ariaValueText:c,ariaMin:d,ariaMax:_}){const x=e?"start":"end";return bi`<input
      type="range"
      class="${za({start:e,end:!e})}"
      @focus=${this.handleFocus}
      @pointerdown=${this.handleDown}
      @pointerup=${this.handleUp}
      @pointerenter=${this.handleEnter}
      @pointermove=${this.handleMove}
      @pointerleave=${this.handleLeave}
      @keydown=${this.handleKeydown}
      @keyup=${this.handleKeyup}
      @input=${this.handleInput}
      @change=${this.handleChange}
      id=${x}
      .disabled=${this.disabled}
      .min=${String(this.min)}
      aria-valuemin=${d}
      .max=${String(this.max)}
      aria-valuemax=${_}
      .step=${String(this.step)}
      .value=${String(r)}
      .tabIndex=${e?1:0}
      aria-label=${s||Pr}
      aria-valuetext=${c} />`}async toggleRippleHover(e,r){const s=await e;s&&(r?s.handlePointerenter(new PointerEvent("pointerenter",{isPrimary:!0,pointerId:this.ripplePointerId})):s.handlePointerleave(new PointerEvent("pointerleave",{isPrimary:!0,pointerId:this.ripplePointerId})))}handleFocus(e){this.updateOnTop(e.target)}startAction(e){const r=e.target,s=r===this.inputStart?this.inputEnd:this.inputStart;this.action={canFlip:e.type==="pointerdown",flipped:!1,target:r,fixed:s,values:new Map([[r,r.valueAsNumber],[s,s==null?void 0:s.valueAsNumber]])}}finishAction(e){this.action=void 0}handleKeydown(e){this.startAction(e)}handleKeyup(e){this.finishAction(e)}handleDown(e){this.startAction(e),this.ripplePointerId=e.pointerId;const r=e.target===this.inputStart;this.handleStartHover=!this.disabled&&r&&!!this.handleStart,this.handleEndHover=!this.disabled&&!r&&!!this.handleEnd}async handleUp(e){if(!this.action)return;const{target:r,values:s,flipped:c}=this.action;await new Promise(requestAnimationFrame),r!==void 0&&(r.focus(),c&&r.valueAsNumber!==s.get(r)&&r.dispatchEvent(new Event("change",{bubbles:!0}))),this.finishAction(e)}handleMove(e){this.handleStartHover=!this.disabled&&rO(e,this.handleStart),this.handleEndHover=!this.disabled&&rO(e,this.handleEnd)}handleEnter(e){this.handleMove(e)}handleLeave(){this.handleStartHover=!1,this.handleEndHover=!1}updateOnTop(e){this.startOnTop=e.classList.contains("start")}needsClamping(){if(!this.action)return!1;const{target:e,fixed:r}=this.action;return e===this.inputStart?e.valueAsNumber>r.valueAsNumber:e.valueAsNumber<r.valueAsNumber}isActionFlipped(){const{action:e}=this;if(!e)return!1;const{target:r,fixed:s,values:c}=e;return e.canFlip&&c.get(r)===c.get(s)&&this.needsClamping()&&(e.canFlip=!1,e.flipped=!0,e.target=s,e.fixed=r),e.flipped}flipAction(){if(!this.action)return!1;const{target:e,fixed:r,values:s}=this.action,c=e.valueAsNumber!==r.valueAsNumber;return e.valueAsNumber=r.valueAsNumber,r.valueAsNumber=s.get(r),c}clampAction(){if(!this.needsClamping()||!this.action)return!1;const{target:e,fixed:r}=this.action;return e.valueAsNumber=r.valueAsNumber,!0}handleInput(e){if(this.isRedispatchingEvent)return;let r=!1,s=!1;this.range&&(this.isActionFlipped()&&(r=!0,s=this.flipAction()),this.clampAction()&&(r=!0,s=!1));const c=e.target;this.updateOnTop(c),this.range?(this.valueStart=this.inputStart.valueAsNumber,this.valueEnd=this.inputEnd.valueAsNumber):this.value=this.inputEnd.valueAsNumber,r&&e.stopPropagation(),s&&(this.isRedispatchingEvent=!0,c1(c,e),this.isRedispatchingEvent=!1)}handleChange(e){const r=e.target,{target:s,values:c}=this.action??{};s&&s.valueAsNumber===c.get(r)||c1(this,e),this.finishAction(e)}[Fp](){if(this.range){const e=new FormData;return e.append(this.nameStart,String(this.valueStart)),e.append(this.nameEnd,String(this.valueEnd)),e}return String(this.value)}formResetCallback(){if(this.range){const r=this.getAttribute("value-start");this.valueStart=r!==null?Number(r):void 0;const s=this.getAttribute("value-end");this.valueEnd=s!==null?Number(s):void 0;return}const e=this.getAttribute("value");this.value=e!==null?Number(e):void 0}formStateRestoreCallback(e){if(Array.isArray(e)){const[[,r],[,s]]=e;this.valueStart=Number(r),this.valueEnd=Number(s),this.range=!0;return}this.value=Number(e),this.range=!1}}ym(Tn);Tn.shadowRootOptions={...Ys.shadowRootOptions,delegatesFocus:!0};At([lr({type:Number})],Tn.prototype,"min",void 0);At([lr({type:Number})],Tn.prototype,"max",void 0);At([lr({type:Number})],Tn.prototype,"value",void 0);At([lr({type:Number,attribute:"value-start"})],Tn.prototype,"valueStart",void 0);At([lr({type:Number,attribute:"value-end"})],Tn.prototype,"valueEnd",void 0);At([lr({attribute:"value-label"})],Tn.prototype,"valueLabel",void 0);At([lr({attribute:"value-label-start"})],Tn.prototype,"valueLabelStart",void 0);At([lr({attribute:"value-label-end"})],Tn.prototype,"valueLabelEnd",void 0);At([lr({attribute:"aria-label-start"})],Tn.prototype,"ariaLabelStart",void 0);At([lr({attribute:"aria-valuetext-start"})],Tn.prototype,"ariaValueTextStart",void 0);At([lr({attribute:"aria-label-end"})],Tn.prototype,"ariaLabelEnd",void 0);At([lr({attribute:"aria-valuetext-end"})],Tn.prototype,"ariaValueTextEnd",void 0);At([lr({type:Number})],Tn.prototype,"step",void 0);At([lr({type:Boolean})],Tn.prototype,"ticks",void 0);At([lr({type:Boolean})],Tn.prototype,"labeled",void 0);At([lr({type:Boolean})],Tn.prototype,"range",void 0);At([_l("input.start")],Tn.prototype,"inputStart",void 0);At([_l(".handle.start")],Tn.prototype,"handleStart",void 0);At([u8("md-ripple.start")],Tn.prototype,"rippleStart",void 0);At([_l("input.end")],Tn.prototype,"inputEnd",void 0);At([_l(".handle.end")],Tn.prototype,"handleEnd",void 0);At([u8("md-ripple.end")],Tn.prototype,"rippleEnd",void 0);At([Ks()],Tn.prototype,"handleStartHover",void 0);At([Ks()],Tn.prototype,"handleEndHover",void 0);At([Ks()],Tn.prototype,"startOnTop",void 0);At([Ks()],Tn.prototype,"handlesOverlapping",void 0);At([Ks()],Tn.prototype,"renderValueStart",void 0);At([Ks()],Tn.prototype,"renderValueEnd",void 0);function rO({x:n,y:e},r){if(!r)return!1;const{top:s,left:c,bottom:d,right:_}=r.getBoundingClientRect();return n>=c&&n<=_&&e>=s&&e<=d}function Vse(n,e){if(!(n&&e))return!1;const r=n.getBoundingClientRect(),s=e.getBoundingClientRect();return!(r.top>s.bottom||r.right<s.left||r.bottom<s.top||r.left>s.right)}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Use=xs`:host{--_active-track-color: var(--md-slider-active-track-color, var(--md-sys-color-primary, #6750a4));--_active-track-height: var(--md-slider-active-track-height, 4px);--_active-track-shape: var(--md-slider-active-track-shape, var(--md-sys-shape-corner-full, 9999px));--_disabled-active-track-color: var(--md-slider-disabled-active-track-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-active-track-opacity: var(--md-slider-disabled-active-track-opacity, 0.38);--_disabled-handle-color: var(--md-slider-disabled-handle-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-handle-elevation: var(--md-slider-disabled-handle-elevation, 0);--_disabled-inactive-track-color: var(--md-slider-disabled-inactive-track-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-inactive-track-opacity: var(--md-slider-disabled-inactive-track-opacity, 0.12);--_focus-handle-color: var(--md-slider-focus-handle-color, var(--md-sys-color-primary, #6750a4));--_handle-color: var(--md-slider-handle-color, var(--md-sys-color-primary, #6750a4));--_handle-elevation: var(--md-slider-handle-elevation, 1);--_handle-height: var(--md-slider-handle-height, 20px);--_handle-shadow-color: var(--md-slider-handle-shadow-color, var(--md-sys-color-shadow, #000));--_handle-shape: var(--md-slider-handle-shape, var(--md-sys-shape-corner-full, 9999px));--_handle-width: var(--md-slider-handle-width, 20px);--_hover-handle-color: var(--md-slider-hover-handle-color, var(--md-sys-color-primary, #6750a4));--_hover-state-layer-color: var(--md-slider-hover-state-layer-color, var(--md-sys-color-primary, #6750a4));--_hover-state-layer-opacity: var(--md-slider-hover-state-layer-opacity, 0.08);--_inactive-track-color: var(--md-slider-inactive-track-color, var(--md-sys-color-surface-container-highest, #e6e0e9));--_inactive-track-height: var(--md-slider-inactive-track-height, 4px);--_inactive-track-shape: var(--md-slider-inactive-track-shape, var(--md-sys-shape-corner-full, 9999px));--_label-container-color: var(--md-slider-label-container-color, var(--md-sys-color-primary, #6750a4));--_label-container-height: var(--md-slider-label-container-height, 28px);--_pressed-handle-color: var(--md-slider-pressed-handle-color, var(--md-sys-color-primary, #6750a4));--_pressed-state-layer-color: var(--md-slider-pressed-state-layer-color, var(--md-sys-color-primary, #6750a4));--_pressed-state-layer-opacity: var(--md-slider-pressed-state-layer-opacity, 0.12);--_state-layer-size: var(--md-slider-state-layer-size, 40px);--_with-overlap-handle-outline-color: var(--md-slider-with-overlap-handle-outline-color, var(--md-sys-color-on-primary, #fff));--_with-overlap-handle-outline-width: var(--md-slider-with-overlap-handle-outline-width, 1px);--_with-tick-marks-active-container-color: var(--md-slider-with-tick-marks-active-container-color, var(--md-sys-color-on-primary, #fff));--_with-tick-marks-container-size: var(--md-slider-with-tick-marks-container-size, 2px);--_with-tick-marks-disabled-container-color: var(--md-slider-with-tick-marks-disabled-container-color, var(--md-sys-color-on-surface, #1d1b20));--_with-tick-marks-inactive-container-color: var(--md-slider-with-tick-marks-inactive-container-color, var(--md-sys-color-on-surface-variant, #49454f));--_label-text-color: var(--md-slider-label-text-color, var(--md-sys-color-on-primary, #fff));--_label-text-font: var(--md-slider-label-text-font, var(--md-sys-typescale-label-medium-font, var(--md-ref-typeface-plain, Roboto)));--_label-text-line-height: var(--md-slider-label-text-line-height, var(--md-sys-typescale-label-medium-line-height, 1rem));--_label-text-size: var(--md-slider-label-text-size, var(--md-sys-typescale-label-medium-size, 0.75rem));--_label-text-weight: var(--md-slider-label-text-weight, var(--md-sys-typescale-label-medium-weight, var(--md-ref-typeface-weight-medium, 500)));--_start-fraction: 0;--_end-fraction: 0;--_tick-count: 0;display:inline-flex;vertical-align:middle;min-inline-size:200px;--md-elevation-level: var(--_handle-elevation);--md-elevation-shadow-color: var(--_handle-shadow-color)}md-focus-ring{height:48px;inset:unset;width:48px}md-elevation{transition-duration:250ms}@media(prefers-reduced-motion){.label{transition-duration:0}}:host([disabled]){opacity:var(--_disabled-active-track-opacity);--md-elevation-level: var(--_disabled-handle-elevation)}.container{flex:1;display:flex;align-items:center;position:relative;block-size:var(--_state-layer-size);pointer-events:none;touch-action:none}.track,.tickmarks{position:absolute;inset:0;display:flex;align-items:center}.track::before,.tickmarks::before,.track::after,.tickmarks::after{position:absolute;content:"";inset-inline-start:calc(var(--_state-layer-size)/2 - var(--_with-tick-marks-container-size));inset-inline-end:calc(var(--_state-layer-size)/2 - var(--_with-tick-marks-container-size));background-size:calc((100% - var(--_with-tick-marks-container-size)*2)/var(--_tick-count)) 100%}.track::before,.tickmarks::before{block-size:var(--_inactive-track-height);border-radius:var(--_inactive-track-shape)}.track::before{background:var(--_inactive-track-color)}.tickmarks::before{background-image:radial-gradient(circle at var(--_with-tick-marks-container-size) center, var(--_with-tick-marks-inactive-container-color) 0, var(--_with-tick-marks-inactive-container-color) calc(var(--_with-tick-marks-container-size) / 2), transparent calc(var(--_with-tick-marks-container-size) / 2))}:host([disabled]) .track::before{opacity:calc(1/var(--_disabled-active-track-opacity)*var(--_disabled-inactive-track-opacity));background:var(--_disabled-inactive-track-color)}.track::after,.tickmarks::after{block-size:var(--_active-track-height);border-radius:var(--_active-track-shape);clip-path:inset(0 calc(var(--_with-tick-marks-container-size) * min((1 - var(--_end-fraction)) * 1000000000, 1) + (100% - var(--_with-tick-marks-container-size) * 2) * (1 - var(--_end-fraction))) 0 calc(var(--_with-tick-marks-container-size) * min(var(--_start-fraction) * 1000000000, 1) + (100% - var(--_with-tick-marks-container-size) * 2) * var(--_start-fraction)))}.track::after{background:var(--_active-track-color)}.tickmarks::after{background-image:radial-gradient(circle at var(--_with-tick-marks-container-size) center, var(--_with-tick-marks-active-container-color) 0, var(--_with-tick-marks-active-container-color) calc(var(--_with-tick-marks-container-size) / 2), transparent calc(var(--_with-tick-marks-container-size) / 2))}.track:dir(rtl)::after{clip-path:inset(0 calc(var(--_with-tick-marks-container-size) * min(var(--_start-fraction) * 1000000000, 1) + (100% - var(--_with-tick-marks-container-size) * 2) * var(--_start-fraction)) 0 calc(var(--_with-tick-marks-container-size) * min((1 - var(--_end-fraction)) * 1000000000, 1) + (100% - var(--_with-tick-marks-container-size) * 2) * (1 - var(--_end-fraction))))}.tickmarks:dir(rtl)::after{clip-path:inset(0 calc(var(--_with-tick-marks-container-size) * min(var(--_start-fraction) * 1000000000, 1) + (100% - var(--_with-tick-marks-container-size) * 2) * var(--_start-fraction)) 0 calc(var(--_with-tick-marks-container-size) * min((1 - var(--_end-fraction)) * 1000000000, 1) + (100% - var(--_with-tick-marks-container-size) * 2) * (1 - var(--_end-fraction))))}:host([disabled]) .track::after{background:var(--_disabled-active-track-color)}:host([disabled]) .tickmarks::before{background-image:radial-gradient(circle at var(--_with-tick-marks-container-size) center, var(--_with-tick-marks-disabled-container-color) 0, var(--_with-tick-marks-disabled-container-color) calc(var(--_with-tick-marks-container-size) / 2), transparent calc(var(--_with-tick-marks-container-size) / 2))}.handleContainerPadded{position:relative;block-size:100%;inline-size:100%;padding-inline:calc(var(--_state-layer-size)/2)}.handleContainerBlock{position:relative;block-size:100%;inline-size:100%}.handleContainer{position:absolute;inset-block-start:0;inset-block-end:0;inset-inline-start:calc(100%*var(--_start-fraction));inline-size:calc(100%*(var(--_end-fraction) - var(--_start-fraction)))}.handle{position:absolute;block-size:var(--_state-layer-size);inline-size:var(--_state-layer-size);border-radius:var(--_handle-shape);display:flex;place-content:center;place-items:center}.handleNub{position:absolute;height:var(--_handle-height);width:var(--_handle-width);border-radius:var(--_handle-shape);background:var(--_handle-color)}:host([disabled]) .handleNub{background:var(--_disabled-handle-color)}input.end:focus~.handleContainerPadded .handle.end>.handleNub,input.start:focus~.handleContainerPadded .handle.start>.handleNub{background:var(--_focus-handle-color)}.container>.handleContainerPadded .handle.hover>.handleNub{background:var(--_hover-handle-color)}:host(:not([disabled])) input.end:active~.handleContainerPadded .handle.end>.handleNub,:host(:not([disabled])) input.start:active~.handleContainerPadded .handle.start>.handleNub{background:var(--_pressed-handle-color)}.onTop.isOverlapping .label,.onTop.isOverlapping .label::before{outline:var(--_with-overlap-handle-outline-color) solid var(--_with-overlap-handle-outline-width)}.onTop.isOverlapping .handleNub{border:var(--_with-overlap-handle-outline-color) solid var(--_with-overlap-handle-outline-width)}.handle.start{inset-inline-start:calc(0px - var(--_state-layer-size)/2)}.handle.end{inset-inline-end:calc(0px - var(--_state-layer-size)/2)}.label{position:absolute;box-sizing:border-box;display:flex;padding:4px;place-content:center;place-items:center;border-radius:var(--md-sys-shape-corner-full, 9999px);color:var(--_label-text-color);font-family:var(--_label-text-font);font-size:var(--_label-text-size);line-height:var(--_label-text-line-height);font-weight:var(--_label-text-weight);inset-block-end:100%;min-inline-size:var(--_label-container-height);min-block-size:var(--_label-container-height);background:var(--_label-container-color);transition:transform 100ms cubic-bezier(0.2, 0, 0, 1);transform-origin:center bottom;transform:scale(0)}:host(:focus-within) .label,.handleContainer.hover .label,:where(:has(input:active)) .label{transform:scale(1)}.label::before,.label::after{position:absolute;display:block;content:"";background:inherit}.label::before{inline-size:calc(var(--_label-container-height)/2);block-size:calc(var(--_label-container-height)/2);bottom:calc(var(--_label-container-height)/-10);transform:rotate(45deg)}.label::after{inset:0px;border-radius:inherit}.labelContent{z-index:1}input[type=range]{opacity:0;-webkit-tap-highlight-color:rgba(0,0,0,0);position:absolute;box-sizing:border-box;height:100%;width:100%;margin:0;background:rgba(0,0,0,0);cursor:pointer;pointer-events:auto;appearance:none}input[type=range]:focus{outline:none}::-webkit-slider-runnable-track{-webkit-appearance:none}::-moz-range-track{appearance:none}::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;block-size:var(--_handle-height);inline-size:var(--_handle-width);opacity:0;z-index:2}input.end::-webkit-slider-thumb{--_track-and-knob-padding: calc( (var(--_state-layer-size) - var(--_handle-width)) / 2 );--_x-translate: calc( var(--_track-and-knob-padding) - 2 * var(--_end-fraction) * var(--_track-and-knob-padding) );transform:translateX(var(--_x-translate))}input.end:dir(rtl)::-webkit-slider-thumb{transform:translateX(calc(-1 * var(--_x-translate)))}input.start::-webkit-slider-thumb{--_track-and-knob-padding: calc( (var(--_state-layer-size) - var(--_handle-width)) / 2 );--_x-translate: calc( var(--_track-and-knob-padding) - 2 * var(--_start-fraction) * var(--_track-and-knob-padding) );transform:translateX(var(--_x-translate))}input.start:dir(rtl)::-webkit-slider-thumb{transform:translateX(calc(-1 * var(--_x-translate)))}::-moz-range-thumb{appearance:none;block-size:var(--_state-layer-size);inline-size:var(--_state-layer-size);transform:scaleX(0);opacity:0;z-index:2}.ranged input.start{clip-path:inset(0 calc(100% - (var(--_state-layer-size) / 2 + (100% - var(--_state-layer-size)) * (var(--_start-fraction) + (var(--_end-fraction) - var(--_start-fraction)) / 2))) 0 0)}.ranged input.start:dir(rtl){clip-path:inset(0 0 0 calc(100% - (var(--_state-layer-size) / 2 + (100% - var(--_state-layer-size)) * (var(--_start-fraction) + (var(--_end-fraction) - var(--_start-fraction)) / 2))))}.ranged input.end{clip-path:inset(0 0 0 calc(var(--_state-layer-size) / 2 + (100% - var(--_state-layer-size)) * (var(--_start-fraction) + (var(--_end-fraction) - var(--_start-fraction)) / 2)))}.ranged input.end:dir(rtl){clip-path:inset(0 calc(var(--_state-layer-size) / 2 + (100% - var(--_state-layer-size)) * (var(--_start-fraction) + (var(--_end-fraction) - var(--_start-fraction)) / 2)) 0 0)}.onTop{z-index:1}.handle{--md-ripple-hover-color: var(--_hover-state-layer-color);--md-ripple-hover-opacity: var(--_hover-state-layer-opacity);--md-ripple-pressed-color: var(--_pressed-state-layer-color);--md-ripple-pressed-opacity: var(--_pressed-state-layer-opacity)}md-ripple{border-radius:50%;height:var(--_state-layer-size);width:var(--_state-layer-size)}
`;/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let sS=class extends Tn{};sS.styles=[Use,Nse];sS=At([ea("md-slider")],sS);const jse={class:"map-box"},$se={class:"content"},Gse=["value"],qse=Ro({__name:"MapBox",props:{mapData:{},date:{}},setup(n){const e=mn(),r=mn(),s=mn(),c=mn(),d=mn(),_=mn(),x=n;Ny.accessToken="pk.eyJ1IjoidGhlLXN6IiwiYSI6ImNrODNheWJlajA0YmozaG81NGFzYTk5a2UifQ.NrNoKE7ivp2MHYylQB672A",eC(()=>{s.value=new Ny.Map({container:e.value,center:[16.064952,40.64773],zoom:9,style:"mapbox://styles/mapbox/outdoors-v12"});let te=!1;Array.isArray(x.mapData)&&(te=!0);const ce=x.mapData;s.value.on("style.load",()=>{if(s.value.addControl(new Ny.NavigationControl),s.value.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),te)j(x.mapData);else{const Ce=l(ce);s.value.addSource("geojson-source",{type:"geojson",data:ce}),s.value.addLayer({id:"line-layer",type:"line",source:"geojson-source",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#FF0000","line-width":2},filter:["==","$type","LineString"]}),s.value.fitBounds(Ce,{padding:20,pitch:75,bearing:-35})}s.value.setTerrain({source:"mapbox-dem",exaggeration:1.5})})});function l(te){const ce=te.features.flatMap(ue=>ue.geometry.coordinates);let Ce,Me;Array.isArray(ce[0][0])?(Ce=ce[0].map(ue=>ue[0]),Me=ce[0].map(ue=>ue[1])):(Ce=ce.map(ue=>ue[0]),Me=ce.map(ue=>ue[1]));const Ie=Math.min(...Me),Te=Math.max(...Me),Ge=Math.min(...Ce),$e=Math.max(...Ce);return new Ny.LngLatBounds([Ge,Ie],[$e,Te])}function S(){const te=new Date,ce=te.getHours(),Ce=te.getMinutes();x.date.setHours(ce),x.date.setMinutes(Ce),c.value=`${ce}:${Ce}`,d.value=new hse({date:new Date,color:"#01112f",opacity:.7,apiKey:"eyJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6InRwcGlvdHJvd3NraUBzaGFkZW1hcC5hcHAiLCJjcmVhdGVkIjoxNjYyNDkzMDY2Nzk0LCJpYXQiOjE2NjI0OTMwNjZ9.ovCrLTYsdKFTF6TW3DuODxCaAtGQ3qhcmqj3DWcol5g",terrainSource:{tileSize:256,maxZoom:15,getSourceUrl:({x:Me,y:Ie,z:Te})=>`https://s3.amazonaws.com/elevation-tiles-prod/terrarium/${Te}/${Me}/${Ie}.png`,getElevation:({r:Me,g:Ie,b:Te,a:Ge})=>Me*256+Ie+Te/256-32768}}).addTo(s.value)}function D(){if(d.value){d.value.remove(),d.value=void 0;return}S()}Bd(c,(te,ce)=>{var Ce;if(te!==ce){const Me=`${x.date.getMonth()+1}-${x.date.getDate()}-${x.date.getFullYear()} ${te}`;(Ce=d.value)==null||Ce.setDate(new Date(Me))}});function I(te){c.value=`${te.target.value<10?"0"+te.target.value:te.target.value}:00`}function V(){navigator.geolocation?navigator.geolocation.getCurrentPosition(te=>{const{latitude:ce,longitude:Ce}=te.coords;j([Ce,ce])},te=>{console.error("Error obtaining location:",te)}):console.error("Geolocation is not supported by this browser.")}function j(te){s.value&&(_.value&&_.value.remove(),_.value=new Ny.Marker().setLngLat(te).addTo(s.value),s.value.fitBounds([te[0]+.008,te[1]-.008,te[0]-.008,te[1]+.008],{padding:20,pitch:75,bearing:-35}))}function Q(te){te?V():_.value&&(_.value.remove(),_.value=void 0)}return(te,ce)=>(li(),Ii("div",jse,[Br("div",{ref_key:"mapBox",ref:e,id:"map-box"},null,512),kn(Ng,{class:"optional-field",label:"Ombre",onCheckboxChanged:D},{default:vg(()=>{var Ce;return[Br("div",$se,[au(" del "+Mn(x.date.toLocaleDateString())+" ",1),xg(Br("md-outlined-text-field",{label:"Orario",type:"time","onUpdate:modelValue":ce[0]||(ce[0]=Me=>c.value=Me)},null,512),[[wg,c.value]]),Br("md-slider",{ref_key:"slider",ref:r,class:"slider",onChange:I,step:"1",ticks:"",min:"0",max:"23",labeled:"",value:parseInt((Ce=c.value)==null?void 0:Ce.slice(0,2))},null,40,Gse)])]}),_:1}),kn(Ng,{class:"optional-field",label:"Mostra posizione attuale",onCheckboxChanged:Q})]))}}),Hse=gl(qse,[["__scopeId","data-v-a03fa2ec"]]);function rh(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function F8(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}/*!
 * GSAP 3.12.5
 * https://gsap.com
 *
 * @license Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var pl={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Bg={duration:.5,overwrite:!1,delay:0},DR,Qo,rs,Vl=1e8,Gn=1/Vl,oS=Math.PI*2,Wse=oS/4,Zse=0,N8=Math.sqrt,Xse=Math.cos,Yse=Math.sin,mo=function(e){return typeof e=="string"},vs=function(e){return typeof e=="function"},yh=function(e){return typeof e=="number"},LR=function(e){return typeof e>"u"},vu=function(e){return typeof e=="object"},Ba=function(e){return e!==!1},OR=function(){return typeof window<"u"},Yb=function(e){return vs(e)||mo(e)},B8=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},Ko=Array.isArray,aS=/(?:-?\.?\d|\.)+/gi,V8=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,eg=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,wA=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,U8=/[+-]=-?[.\d]+/,j8=/[^,'"\[\]\s]+/gi,Qse=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,as,Qc,lS,zR,ml={},ET={},$8,G8=function(e){return(ET=sm(e,ml))&&Ha},FR=function(e,r){return console.warn("Invalid property",e,"set to",r,"Missing plugin? gsap.registerPlugin()")},d1=function(e,r){return!r&&console.warn(e)},q8=function(e,r){return e&&(ml[e]=r)&&ET&&(ET[e]=r)||ml},f1=function(){return 0},Kse={suppressEvents:!0,isStart:!0,kill:!1},Iw={suppressEvents:!0,kill:!1},Jse={suppressEvents:!0},NR={},qd=[],cS={},H8,cl={},TA={},iO=30,Sw=[],BR="",VR=function(e){var r=e[0],s,c;if(vu(r)||vs(r)||(e=[e]),!(s=(r._gsap||{}).harness)){for(c=Sw.length;c--&&!Sw[c].targetTest(r););s=Sw[c]}for(c=e.length;c--;)e[c]&&(e[c]._gsap||(e[c]._gsap=new _V(e[c],s)))||e.splice(c,1);return e},Np=function(e){return e._gsap||VR(Ul(e))[0]._gsap},W8=function(e,r,s){return(s=e[r])&&vs(s)?e[r]():LR(s)&&e.getAttribute&&e.getAttribute(r)||s},Va=function(e,r){return(e=e.split(",")).forEach(r)||e},As=function(e){return Math.round(e*1e5)/1e5||0},co=function(e){return Math.round(e*1e7)/1e7||0},dg=function(e,r){var s=r.charAt(0),c=parseFloat(r.substr(2));return e=parseFloat(e),s==="+"?e+c:s==="-"?e-c:s==="*"?e*c:e/c},eoe=function(e,r){for(var s=r.length,c=0;e.indexOf(r[c])<0&&++c<s;);return c<s},AT=function(){var e=qd.length,r=qd.slice(0),s,c;for(cS={},qd.length=0,s=0;s<e;s++)c=r[s],c&&c._lazy&&(c.render(c._lazy[0],c._lazy[1],!0)._lazy=0)},Z8=function(e,r,s,c){qd.length&&!Qo&&AT(),e.render(r,s,Qo&&r<0&&(e._initted||e._startAt)),qd.length&&!Qo&&AT()},X8=function(e){var r=parseFloat(e);return(r||r===0)&&(e+"").match(j8).length<2?r:mo(e)?e.trim():e},Y8=function(e){return e},Hl=function(e,r){for(var s in r)s in e||(e[s]=r[s]);return e},toe=function(e){return function(r,s){for(var c in s)c in r||c==="duration"&&e||c==="ease"||(r[c]=s[c])}},sm=function(e,r){for(var s in r)e[s]=r[s];return e},nO=function n(e,r){for(var s in r)s!=="__proto__"&&s!=="constructor"&&s!=="prototype"&&(e[s]=vu(r[s])?n(e[s]||(e[s]={}),r[s]):r[s]);return e},IT=function(e,r){var s={},c;for(c in e)c in r||(s[c]=e[c]);return s},Iv=function(e){var r=e.parent||as,s=e.keyframes?toe(Ko(e.keyframes)):Hl;if(Ba(e.inherit))for(;r;)s(e,r.vars.defaults),r=r.parent||r._dp;return e},roe=function(e,r){for(var s=e.length,c=s===r.length;c&&s--&&e[s]===r[s];);return s<0},Q8=function(e,r,s,c,d){var _=e[c],x;if(d)for(x=r[d];_&&_[d]>x;)_=_._prev;return _?(r._next=_._next,_._next=r):(r._next=e[s],e[s]=r),r._next?r._next._prev=r:e[c]=r,r._prev=_,r.parent=r._dp=e,r},LE=function(e,r,s,c){s===void 0&&(s="_first"),c===void 0&&(c="_last");var d=r._prev,_=r._next;d?d._next=_:e[s]===r&&(e[s]=_),_?_._prev=d:e[c]===r&&(e[c]=d),r._next=r._prev=r.parent=null},ef=function(e,r){e.parent&&(!r||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Bp=function(e,r){if(e&&(!r||r._end>e._dur||r._start<0))for(var s=e;s;)s._dirty=1,s=s.parent;return e},ioe=function(e){for(var r=e.parent;r&&r.parent;)r._dirty=1,r.totalDuration(),r=r.parent;return e},uS=function(e,r,s,c){return e._startAt&&(Qo?e._startAt.revert(Iw):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(r,!0,c))},noe=function n(e){return!e||e._ts&&n(e.parent)},sO=function(e){return e._repeat?Vg(e._tTime,e=e.duration()+e._rDelay)*e:0},Vg=function(e,r){var s=Math.floor(e/=r);return e&&s===e?s-1:s},ST=function(e,r){return(e-r._start)*r._ts+(r._ts>=0?0:r._dirty?r.totalDuration():r._tDur)},OE=function(e){return e._end=co(e._start+(e._tDur/Math.abs(e._ts||e._rts||Gn)||0))},zE=function(e,r){var s=e._dp;return s&&s.smoothChildTiming&&e._ts&&(e._start=co(s._time-(e._ts>0?r/e._ts:((e._dirty?e.totalDuration():e._tDur)-r)/-e._ts)),OE(e),s._dirty||Bp(s,e)),e},K8=function(e,r){var s;if((r._time||!r._dur&&r._initted||r._start<e._time&&(r._dur||!r.add))&&(s=ST(e.rawTime(),r),(!r._dur||B1(0,r.totalDuration(),s)-r._tTime>Gn)&&r.render(s,!0)),Bp(e,r)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(s=e;s._dp;)s.rawTime()>=0&&s.totalTime(s._tTime),s=s._dp;e._zTime=-Gn}},tu=function(e,r,s,c){return r.parent&&ef(r),r._start=co((yh(s)?s:s||e!==as?kl(e,s,r):e._time)+r._delay),r._end=co(r._start+(r.totalDuration()/Math.abs(r.timeScale())||0)),Q8(e,r,"_first","_last",e._sort?"_start":0),hS(r)||(e._recent=r),c||K8(e,r),e._ts<0&&zE(e,e._tTime),e},J8=function(e,r){return(ml.ScrollTrigger||FR("scrollTrigger",r))&&ml.ScrollTrigger.create(r,e)},eV=function(e,r,s,c,d){if(jR(e,r,d),!e._initted)return 1;if(!s&&e._pt&&!Qo&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&H8!==ul.frame)return qd.push(e),e._lazy=[d,c],1},soe=function n(e){var r=e.parent;return r&&r._ts&&r._initted&&!r._lock&&(r.rawTime()<0||n(r))},hS=function(e){var r=e.data;return r==="isFromStart"||r==="isStart"},ooe=function(e,r,s,c){var d=e.ratio,_=r<0||!r&&(!e._start&&soe(e)&&!(!e._initted&&hS(e))||(e._ts<0||e._dp._ts<0)&&!hS(e))?0:1,x=e._rDelay,l=0,S,D,I;if(x&&e._repeat&&(l=B1(0,e._tDur,r),D=Vg(l,x),e._yoyo&&D&1&&(_=1-_),D!==Vg(e._tTime,x)&&(d=1-_,e.vars.repeatRefresh&&e._initted&&e.invalidate())),_!==d||Qo||c||e._zTime===Gn||!r&&e._zTime){if(!e._initted&&eV(e,r,c,s,l))return;for(I=e._zTime,e._zTime=r||(s?Gn:0),s||(s=r&&!I),e.ratio=_,e._from&&(_=1-_),e._time=0,e._tTime=l,S=e._pt;S;)S.r(_,S.d),S=S._next;r<0&&uS(e,r,s,!0),e._onUpdate&&!s&&dl(e,"onUpdate"),l&&e._repeat&&!s&&e.parent&&dl(e,"onRepeat"),(r>=e._tDur||r<0)&&e.ratio===_&&(_&&ef(e,1),!s&&!Qo&&(dl(e,_?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=r)},aoe=function(e,r,s){var c;if(s>r)for(c=e._first;c&&c._start<=s;){if(c.data==="isPause"&&c._start>r)return c;c=c._next}else for(c=e._last;c&&c._start>=s;){if(c.data==="isPause"&&c._start<r)return c;c=c._prev}},Ug=function(e,r,s,c){var d=e._repeat,_=co(r)||0,x=e._tTime/e._tDur;return x&&!c&&(e._time*=_/e._dur),e._dur=_,e._tDur=d?d<0?1e10:co(_*(d+1)+e._rDelay*d):_,x>0&&!c&&zE(e,e._tTime=e._tDur*x),e.parent&&OE(e),s||Bp(e.parent,e),e},oO=function(e){return e instanceof ma?Bp(e):Ug(e,e._dur)},loe={_start:0,endTime:f1,totalDuration:f1},kl=function n(e,r,s){var c=e.labels,d=e._recent||loe,_=e.duration()>=Vl?d.endTime(!1):e._dur,x,l,S;return mo(r)&&(isNaN(r)||r in c)?(l=r.charAt(0),S=r.substr(-1)==="%",x=r.indexOf("="),l==="<"||l===">"?(x>=0&&(r=r.replace(/=/,"")),(l==="<"?d._start:d.endTime(d._repeat>=0))+(parseFloat(r.substr(1))||0)*(S?(x<0?d:s).totalDuration()/100:1)):x<0?(r in c||(c[r]=_),c[r]):(l=parseFloat(r.charAt(x-1)+r.substr(x+1)),S&&s&&(l=l/100*(Ko(s)?s[0]:s).totalDuration()),x>1?n(e,r.substr(0,x-1),s)+l:_+l)):r==null?_:+r},Sv=function(e,r,s){var c=yh(r[1]),d=(c?2:1)+(e<2?0:1),_=r[d],x,l;if(c&&(_.duration=r[1]),_.parent=s,e){for(x=_,l=s;l&&!("immediateRender"in x);)x=l.vars.defaults||{},l=Ba(l.vars.inherit)&&l.parent;_.immediateRender=Ba(x.immediateRender),e<2?_.runBackwards=1:_.startAt=r[d-1]}return new Os(r[0],_,r[d+1])},hf=function(e,r){return e||e===0?r(e):r},B1=function(e,r,s){return s<e?e:s>r?r:s},Xo=function(e,r){return!mo(e)||!(r=Qse.exec(e))?"":r[1]},coe=function(e,r,s){return hf(s,function(c){return B1(e,r,c)})},dS=[].slice,tV=function(e,r){return e&&vu(e)&&"length"in e&&(!r&&!e.length||e.length-1 in e&&vu(e[0]))&&!e.nodeType&&e!==Qc},uoe=function(e,r,s){return s===void 0&&(s=[]),e.forEach(function(c){var d;return mo(c)&&!r||tV(c,1)?(d=s).push.apply(d,Ul(c)):s.push(c)})||s},Ul=function(e,r,s){return rs&&!r&&rs.selector?rs.selector(e):mo(e)&&!s&&(lS||!jg())?dS.call((r||zR).querySelectorAll(e),0):Ko(e)?uoe(e,s):tV(e)?dS.call(e,0):e?[e]:[]},fS=function(e){return e=Ul(e)[0]||d1("Invalid scope")||{},function(r){var s=e.current||e.nativeElement||e;return Ul(r,s.querySelectorAll?s:s===e?d1("Invalid scope")||zR.createElement("div"):e)}},rV=function(e){return e.sort(function(){return .5-Math.random()})},iV=function(e){if(vs(e))return e;var r=vu(e)?e:{each:e},s=Vp(r.ease),c=r.from||0,d=parseFloat(r.base)||0,_={},x=c>0&&c<1,l=isNaN(c)||x,S=r.axis,D=c,I=c;return mo(c)?D=I={center:.5,edges:.5,end:1}[c]||0:!x&&l&&(D=c[0],I=c[1]),function(V,j,Q){var te=(Q||r).length,ce=_[te],Ce,Me,Ie,Te,Ge,$e,ue,pe,_e;if(!ce){if(_e=r.grid==="auto"?0:(r.grid||[1,Vl])[1],!_e){for(ue=-Vl;ue<(ue=Q[_e++].getBoundingClientRect().left)&&_e<te;);_e<te&&_e--}for(ce=_[te]=[],Ce=l?Math.min(_e,te)*D-.5:c%_e,Me=_e===Vl?0:l?te*I/_e-.5:c/_e|0,ue=0,pe=Vl,$e=0;$e<te;$e++)Ie=$e%_e-Ce,Te=Me-($e/_e|0),ce[$e]=Ge=S?Math.abs(S==="y"?Te:Ie):N8(Ie*Ie+Te*Te),Ge>ue&&(ue=Ge),Ge<pe&&(pe=Ge);c==="random"&&rV(ce),ce.max=ue-pe,ce.min=pe,ce.v=te=(parseFloat(r.amount)||parseFloat(r.each)*(_e>te?te-1:S?S==="y"?te/_e:_e:Math.max(_e,te/_e))||0)*(c==="edges"?-1:1),ce.b=te<0?d-te:d,ce.u=Xo(r.amount||r.each)||0,s=s&&te<0?fV(s):s}return te=(ce[V]-ce.min)/ce.max||0,co(ce.b+(s?s(te):te)*ce.v)+ce.u}},pS=function(e){var r=Math.pow(10,((e+"").split(".")[1]||"").length);return function(s){var c=co(Math.round(parseFloat(s)/e)*e*r);return(c-c%1)/r+(yh(s)?0:Xo(s))}},nV=function(e,r){var s=Ko(e),c,d;return!s&&vu(e)&&(c=s=e.radius||Vl,e.values?(e=Ul(e.values),(d=!yh(e[0]))&&(c*=c)):e=pS(e.increment)),hf(r,s?vs(e)?function(_){return d=e(_),Math.abs(d-_)<=c?d:_}:function(_){for(var x=parseFloat(d?_.x:_),l=parseFloat(d?_.y:0),S=Vl,D=0,I=e.length,V,j;I--;)d?(V=e[I].x-x,j=e[I].y-l,V=V*V+j*j):V=Math.abs(e[I]-x),V<S&&(S=V,D=I);return D=!c||S<=c?e[D]:_,d||D===_||yh(_)?D:D+Xo(_)}:pS(e))},sV=function(e,r,s,c){return hf(Ko(e)?!r:s===!0?!!(s=0):!c,function(){return Ko(e)?e[~~(Math.random()*e.length)]:(s=s||1e-5)&&(c=s<1?Math.pow(10,(s+"").length-2):1)&&Math.floor(Math.round((e-s/2+Math.random()*(r-e+s*.99))/s)*s*c)/c})},hoe=function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];return function(c){return r.reduce(function(d,_){return _(d)},c)}},doe=function(e,r){return function(s){return e(parseFloat(s))+(r||Xo(s))}},foe=function(e,r,s){return aV(e,r,0,1,s)},oV=function(e,r,s){return hf(s,function(c){return e[~~r(c)]})},poe=function n(e,r,s){var c=r-e;return Ko(e)?oV(e,n(0,e.length),r):hf(s,function(d){return(c+(d-e)%c)%c+e})},moe=function n(e,r,s){var c=r-e,d=c*2;return Ko(e)?oV(e,n(0,e.length-1),r):hf(s,function(_){return _=(d+(_-e)%d)%d||0,e+(_>c?d-_:_)})},p1=function(e){for(var r=0,s="",c,d,_,x;~(c=e.indexOf("random(",r));)_=e.indexOf(")",c),x=e.charAt(c+7)==="[",d=e.substr(c+7,_-c-7).match(x?j8:aS),s+=e.substr(r,c-r)+sV(x?d:+d[0],x?0:+d[1],+d[2]||1e-5),r=_+1;return s+e.substr(r,e.length-r)},aV=function(e,r,s,c,d){var _=r-e,x=c-s;return hf(d,function(l){return s+((l-e)/_*x||0)})},_oe=function n(e,r,s,c){var d=isNaN(e+r)?0:function(j){return(1-j)*e+j*r};if(!d){var _=mo(e),x={},l,S,D,I,V;if(s===!0&&(c=1)&&(s=null),_)e={p:e},r={p:r};else if(Ko(e)&&!Ko(r)){for(D=[],I=e.length,V=I-2,S=1;S<I;S++)D.push(n(e[S-1],e[S]));I--,d=function(Q){Q*=I;var te=Math.min(V,~~Q);return D[te](Q-te)},s=r}else c||(e=sm(Ko(e)?[]:{},e));if(!D){for(l in r)UR.call(x,e,l,"get",r[l]);d=function(Q){return qR(Q,x)||(_?e.p:e)}}}return hf(s,d)},aO=function(e,r,s){var c=e.labels,d=Vl,_,x,l;for(_ in c)x=c[_]-r,x<0==!!s&&x&&d>(x=Math.abs(x))&&(l=_,d=x);return l},dl=function(e,r,s){var c=e.vars,d=c[r],_=rs,x=e._ctx,l,S,D;if(d)return l=c[r+"Params"],S=c.callbackScope||e,s&&qd.length&&AT(),x&&(rs=x),D=l?d.apply(S,l):d.call(S),rs=_,D},ev=function(e){return ef(e),e.scrollTrigger&&e.scrollTrigger.kill(!!Qo),e.progress()<1&&dl(e,"onInterrupt"),e},tg,lV=[],cV=function(e){if(e)if(e=!e.name&&e.default||e,OR()||e.headless){var r=e.name,s=vs(e),c=r&&!s&&e.init?function(){this._props=[]}:e,d={init:f1,render:qR,add:UR,kill:koe,modifier:Moe,rawVars:0},_={targetTest:0,get:0,getSetter:GR,aliases:{},register:0};if(jg(),e!==c){if(cl[r])return;Hl(c,Hl(IT(e,d),_)),sm(c.prototype,sm(d,IT(e,_))),cl[c.prop=r]=c,e.targetTest&&(Sw.push(c),NR[r]=1),r=(r==="css"?"CSS":r.charAt(0).toUpperCase()+r.substr(1))+"Plugin"}q8(r,c),e.register&&e.register(Ha,c,Ua)}else lV.push(e)},Nn=255,tv={aqua:[0,Nn,Nn],lime:[0,Nn,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Nn],navy:[0,0,128],white:[Nn,Nn,Nn],olive:[128,128,0],yellow:[Nn,Nn,0],orange:[Nn,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Nn,0,0],pink:[Nn,192,203],cyan:[0,Nn,Nn],transparent:[Nn,Nn,Nn,0]},EA=function(e,r,s){return e+=e<0?1:e>1?-1:0,(e*6<1?r+(s-r)*e*6:e<.5?s:e*3<2?r+(s-r)*(2/3-e)*6:r)*Nn+.5|0},uV=function(e,r,s){var c=e?yh(e)?[e>>16,e>>8&Nn,e&Nn]:0:tv.black,d,_,x,l,S,D,I,V,j,Q;if(!c){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),tv[e])c=tv[e];else if(e.charAt(0)==="#"){if(e.length<6&&(d=e.charAt(1),_=e.charAt(2),x=e.charAt(3),e="#"+d+d+_+_+x+x+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return c=parseInt(e.substr(1,6),16),[c>>16,c>>8&Nn,c&Nn,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),c=[e>>16,e>>8&Nn,e&Nn]}else if(e.substr(0,3)==="hsl"){if(c=Q=e.match(aS),!r)l=+c[0]%360/360,S=+c[1]/100,D=+c[2]/100,_=D<=.5?D*(S+1):D+S-D*S,d=D*2-_,c.length>3&&(c[3]*=1),c[0]=EA(l+1/3,d,_),c[1]=EA(l,d,_),c[2]=EA(l-1/3,d,_);else if(~e.indexOf("="))return c=e.match(V8),s&&c.length<4&&(c[3]=1),c}else c=e.match(aS)||tv.transparent;c=c.map(Number)}return r&&!Q&&(d=c[0]/Nn,_=c[1]/Nn,x=c[2]/Nn,I=Math.max(d,_,x),V=Math.min(d,_,x),D=(I+V)/2,I===V?l=S=0:(j=I-V,S=D>.5?j/(2-I-V):j/(I+V),l=I===d?(_-x)/j+(_<x?6:0):I===_?(x-d)/j+2:(d-_)/j+4,l*=60),c[0]=~~(l+.5),c[1]=~~(S*100+.5),c[2]=~~(D*100+.5)),s&&c.length<4&&(c[3]=1),c},hV=function(e){var r=[],s=[],c=-1;return e.split(Hd).forEach(function(d){var _=d.match(eg)||[];r.push.apply(r,_),s.push(c+=_.length+1)}),r.c=s,r},lO=function(e,r,s){var c="",d=(e+c).match(Hd),_=r?"hsla(":"rgba(",x=0,l,S,D,I;if(!d)return e;if(d=d.map(function(V){return(V=uV(V,r,1))&&_+(r?V[0]+","+V[1]+"%,"+V[2]+"%,"+V[3]:V.join(","))+")"}),s&&(D=hV(e),l=s.c,l.join(c)!==D.c.join(c)))for(S=e.replace(Hd,"1").split(eg),I=S.length-1;x<I;x++)c+=S[x]+(~l.indexOf(x)?d.shift()||_+"0,0,0,0)":(D.length?D:d.length?d:s).shift());if(!S)for(S=e.split(Hd),I=S.length-1;x<I;x++)c+=S[x]+d[x];return c+S[I]},Hd=function(){var n="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in tv)n+="|"+e+"\\b";return new RegExp(n+")","gi")}(),goe=/hsl[a]?\(/,dV=function(e){var r=e.join(" "),s;if(Hd.lastIndex=0,Hd.test(r))return s=goe.test(r),e[1]=lO(e[1],s),e[0]=lO(e[0],s,hV(e[1])),!0},m1,ul=function(){var n=Date.now,e=500,r=33,s=n(),c=s,d=1e3/240,_=d,x=[],l,S,D,I,V,j,Q=function te(ce){var Ce=n()-c,Me=ce===!0,Ie,Te,Ge,$e;if((Ce>e||Ce<0)&&(s+=Ce-r),c+=Ce,Ge=c-s,Ie=Ge-_,(Ie>0||Me)&&($e=++I.frame,V=Ge-I.time*1e3,I.time=Ge=Ge/1e3,_+=Ie+(Ie>=d?4:d-Ie),Te=1),Me||(l=S(te)),Te)for(j=0;j<x.length;j++)x[j](Ge,V,$e,ce)};return I={time:0,frame:0,tick:function(){Q(!0)},deltaRatio:function(ce){return V/(1e3/(ce||60))},wake:function(){$8&&(!lS&&OR()&&(Qc=lS=window,zR=Qc.document||{},ml.gsap=Ha,(Qc.gsapVersions||(Qc.gsapVersions=[])).push(Ha.version),G8(ET||Qc.GreenSockGlobals||!Qc.gsap&&Qc||{}),lV.forEach(cV)),D=typeof requestAnimationFrame<"u"&&requestAnimationFrame,l&&I.sleep(),S=D||function(ce){return setTimeout(ce,_-I.time*1e3+1|0)},m1=1,Q(2))},sleep:function(){(D?cancelAnimationFrame:clearTimeout)(l),m1=0,S=f1},lagSmoothing:function(ce,Ce){e=ce||1/0,r=Math.min(Ce||33,e)},fps:function(ce){d=1e3/(ce||240),_=I.time*1e3+d},add:function(ce,Ce,Me){var Ie=Ce?function(Te,Ge,$e,ue){ce(Te,Ge,$e,ue),I.remove(Ie)}:ce;return I.remove(ce),x[Me?"unshift":"push"](Ie),jg(),Ie},remove:function(ce,Ce){~(Ce=x.indexOf(ce))&&x.splice(Ce,1)&&j>=Ce&&j--},_listeners:x},I}(),jg=function(){return!m1&&ul.wake()},on={},yoe=/^[\d.\-M][\d.\-,\s]/,voe=/["']/g,xoe=function(e){for(var r={},s=e.substr(1,e.length-3).split(":"),c=s[0],d=1,_=s.length,x,l,S;d<_;d++)l=s[d],x=d!==_-1?l.lastIndexOf(","):l.length,S=l.substr(0,x),r[c]=isNaN(S)?S.replace(voe,"").trim():+S,c=l.substr(x+1).trim();return r},boe=function(e){var r=e.indexOf("(")+1,s=e.indexOf(")"),c=e.indexOf("(",r);return e.substring(r,~c&&c<s?e.indexOf(")",s+1):s)},woe=function(e){var r=(e+"").split("("),s=on[r[0]];return s&&r.length>1&&s.config?s.config.apply(null,~e.indexOf("{")?[xoe(r[1])]:boe(e).split(",").map(X8)):on._CE&&yoe.test(e)?on._CE("",e):s},fV=function(e){return function(r){return 1-e(1-r)}},pV=function n(e,r){for(var s=e._first,c;s;)s instanceof ma?n(s,r):s.vars.yoyoEase&&(!s._yoyo||!s._repeat)&&s._yoyo!==r&&(s.timeline?n(s.timeline,r):(c=s._ease,s._ease=s._yEase,s._yEase=c,s._yoyo=r)),s=s._next},Vp=function(e,r){return e&&(vs(e)?e:on[e]||woe(e))||r},vm=function(e,r,s,c){s===void 0&&(s=function(l){return 1-r(1-l)}),c===void 0&&(c=function(l){return l<.5?r(l*2)/2:1-r((1-l)*2)/2});var d={easeIn:r,easeOut:s,easeInOut:c},_;return Va(e,function(x){on[x]=ml[x]=d,on[_=x.toLowerCase()]=s;for(var l in d)on[_+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=on[x+"."+l]=d[l]}),d},mV=function(e){return function(r){return r<.5?(1-e(1-r*2))/2:.5+e((r-.5)*2)/2}},AA=function n(e,r,s){var c=r>=1?r:1,d=(s||(e?.3:.45))/(r<1?r:1),_=d/oS*(Math.asin(1/c)||0),x=function(D){return D===1?1:c*Math.pow(2,-10*D)*Yse((D-_)*d)+1},l=e==="out"?x:e==="in"?function(S){return 1-x(1-S)}:mV(x);return d=oS/d,l.config=function(S,D){return n(e,S,D)},l},IA=function n(e,r){r===void 0&&(r=1.70158);var s=function(_){return _?--_*_*((r+1)*_+r)+1:0},c=e==="out"?s:e==="in"?function(d){return 1-s(1-d)}:mV(s);return c.config=function(d){return n(e,d)},c};Va("Linear,Quad,Cubic,Quart,Quint,Strong",function(n,e){var r=e<5?e+1:e;vm(n+",Power"+(r-1),e?function(s){return Math.pow(s,r)}:function(s){return s},function(s){return 1-Math.pow(1-s,r)},function(s){return s<.5?Math.pow(s*2,r)/2:1-Math.pow((1-s)*2,r)/2})});on.Linear.easeNone=on.none=on.Linear.easeIn;vm("Elastic",AA("in"),AA("out"),AA());(function(n,e){var r=1/e,s=2*r,c=2.5*r,d=function(x){return x<r?n*x*x:x<s?n*Math.pow(x-1.5/e,2)+.75:x<c?n*(x-=2.25/e)*x+.9375:n*Math.pow(x-2.625/e,2)+.984375};vm("Bounce",function(_){return 1-d(1-_)},d)})(7.5625,2.75);vm("Expo",function(n){return n?Math.pow(2,10*(n-1)):0});vm("Circ",function(n){return-(N8(1-n*n)-1)});vm("Sine",function(n){return n===1?1:-Xse(n*Wse)+1});vm("Back",IA("in"),IA("out"),IA());on.SteppedEase=on.steps=ml.SteppedEase={config:function(e,r){e===void 0&&(e=1);var s=1/e,c=e+(r?0:1),d=r?1:0,_=1-Gn;return function(x){return((c*B1(0,_,x)|0)+d)*s}}};Bg.ease=on["quad.out"];Va("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(n){return BR+=n+","+n+"Params,"});var _V=function(e,r){this.id=Zse++,e._gsap=this,this.target=e,this.harness=r,this.get=r?r.get:W8,this.set=r?r.getSetter:GR},_1=function(){function n(r){this.vars=r,this._delay=+r.delay||0,(this._repeat=r.repeat===1/0?-2:r.repeat||0)&&(this._rDelay=r.repeatDelay||0,this._yoyo=!!r.yoyo||!!r.yoyoEase),this._ts=1,Ug(this,+r.duration,1,1),this.data=r.data,rs&&(this._ctx=rs,rs.data.push(this)),m1||ul.wake()}var e=n.prototype;return e.delay=function(s){return s||s===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+s-this._delay),this._delay=s,this):this._delay},e.duration=function(s){return arguments.length?this.totalDuration(this._repeat>0?s+(s+this._rDelay)*this._repeat:s):this.totalDuration()&&this._dur},e.totalDuration=function(s){return arguments.length?(this._dirty=0,Ug(this,this._repeat<0?s:(s-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(s,c){if(jg(),!arguments.length)return this._tTime;var d=this._dp;if(d&&d.smoothChildTiming&&this._ts){for(zE(this,s),!d._dp||d.parent||K8(d,this);d&&d.parent;)d.parent._time!==d._start+(d._ts>=0?d._tTime/d._ts:(d.totalDuration()-d._tTime)/-d._ts)&&d.totalTime(d._tTime,!0),d=d.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&s<this._tDur||this._ts<0&&s>0||!this._tDur&&!s)&&tu(this._dp,this,this._start-this._delay)}return(this._tTime!==s||!this._dur&&!c||this._initted&&Math.abs(this._zTime)===Gn||!s&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=s),Z8(this,s,c)),this},e.time=function(s,c){return arguments.length?this.totalTime(Math.min(this.totalDuration(),s+sO(this))%(this._dur+this._rDelay)||(s?this._dur:0),c):this._time},e.totalProgress=function(s,c){return arguments.length?this.totalTime(this.totalDuration()*s,c):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(s,c){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-s:s)+sO(this),c):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(s,c){var d=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(s-1)*d,c):this._repeat?Vg(this._tTime,d)+1:1},e.timeScale=function(s,c){if(!arguments.length)return this._rts===-Gn?0:this._rts;if(this._rts===s)return this;var d=this.parent&&this._ts?ST(this.parent._time,this):this._tTime;return this._rts=+s||0,this._ts=this._ps||s===-Gn?0:this._rts,this.totalTime(B1(-Math.abs(this._delay),this._tDur,d),c!==!1),OE(this),ioe(this)},e.paused=function(s){return arguments.length?(this._ps!==s&&(this._ps=s,s?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(jg(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Gn&&(this._tTime-=Gn)))),this):this._ps},e.startTime=function(s){if(arguments.length){this._start=s;var c=this.parent||this._dp;return c&&(c._sort||!this.parent)&&tu(c,this,s-this._delay),this}return this._start},e.endTime=function(s){return this._start+(Ba(s)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(s){var c=this.parent||this._dp;return c?s&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?ST(c.rawTime(s),this):this._tTime:this._tTime},e.revert=function(s){s===void 0&&(s=Jse);var c=Qo;return Qo=s,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(s),this.totalTime(-.01,s.suppressEvents)),this.data!=="nested"&&s.kill!==!1&&this.kill(),Qo=c,this},e.globalTime=function(s){for(var c=this,d=arguments.length?s:c.rawTime();c;)d=c._start+d/(Math.abs(c._ts)||1),c=c._dp;return!this.parent&&this._sat?this._sat.globalTime(s):d},e.repeat=function(s){return arguments.length?(this._repeat=s===1/0?-2:s,oO(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(s){if(arguments.length){var c=this._time;return this._rDelay=s,oO(this),c?this.time(c):this}return this._rDelay},e.yoyo=function(s){return arguments.length?(this._yoyo=s,this):this._yoyo},e.seek=function(s,c){return this.totalTime(kl(this,s),Ba(c))},e.restart=function(s,c){return this.play().totalTime(s?-this._delay:0,Ba(c))},e.play=function(s,c){return s!=null&&this.seek(s,c),this.reversed(!1).paused(!1)},e.reverse=function(s,c){return s!=null&&this.seek(s||this.totalDuration(),c),this.reversed(!0).paused(!1)},e.pause=function(s,c){return s!=null&&this.seek(s,c),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(s){return arguments.length?(!!s!==this.reversed()&&this.timeScale(-this._rts||(s?-Gn:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-Gn,this},e.isActive=function(){var s=this.parent||this._dp,c=this._start,d;return!!(!s||this._ts&&this._initted&&s.isActive()&&(d=s.rawTime(!0))>=c&&d<this.endTime(!0)-Gn)},e.eventCallback=function(s,c,d){var _=this.vars;return arguments.length>1?(c?(_[s]=c,d&&(_[s+"Params"]=d),s==="onUpdate"&&(this._onUpdate=c)):delete _[s],this):_[s]},e.then=function(s){var c=this;return new Promise(function(d){var _=vs(s)?s:Y8,x=function(){var S=c.then;c.then=null,vs(_)&&(_=_(c))&&(_.then||_===c)&&(c.then=S),d(_),c.then=S};c._initted&&c.totalProgress()===1&&c._ts>=0||!c._tTime&&c._ts<0?x():c._prom=x})},e.kill=function(){ev(this)},n}();Hl(_1.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-Gn,_prom:0,_ps:!1,_rts:1});var ma=function(n){F8(e,n);function e(s,c){var d;return s===void 0&&(s={}),d=n.call(this,s)||this,d.labels={},d.smoothChildTiming=!!s.smoothChildTiming,d.autoRemoveChildren=!!s.autoRemoveChildren,d._sort=Ba(s.sortChildren),as&&tu(s.parent||as,rh(d),c),s.reversed&&d.reverse(),s.paused&&d.paused(!0),s.scrollTrigger&&J8(rh(d),s.scrollTrigger),d}var r=e.prototype;return r.to=function(c,d,_){return Sv(0,arguments,this),this},r.from=function(c,d,_){return Sv(1,arguments,this),this},r.fromTo=function(c,d,_,x){return Sv(2,arguments,this),this},r.set=function(c,d,_){return d.duration=0,d.parent=this,Iv(d).repeatDelay||(d.repeat=0),d.immediateRender=!!d.immediateRender,new Os(c,d,kl(this,_),1),this},r.call=function(c,d,_){return tu(this,Os.delayedCall(0,c,d),_)},r.staggerTo=function(c,d,_,x,l,S,D){return _.duration=d,_.stagger=_.stagger||x,_.onComplete=S,_.onCompleteParams=D,_.parent=this,new Os(c,_,kl(this,l)),this},r.staggerFrom=function(c,d,_,x,l,S,D){return _.runBackwards=1,Iv(_).immediateRender=Ba(_.immediateRender),this.staggerTo(c,d,_,x,l,S,D)},r.staggerFromTo=function(c,d,_,x,l,S,D,I){return x.startAt=_,Iv(x).immediateRender=Ba(x.immediateRender),this.staggerTo(c,d,x,l,S,D,I)},r.render=function(c,d,_){var x=this._time,l=this._dirty?this.totalDuration():this._tDur,S=this._dur,D=c<=0?0:co(c),I=this._zTime<0!=c<0&&(this._initted||!S),V,j,Q,te,ce,Ce,Me,Ie,Te,Ge,$e,ue;if(this!==as&&D>l&&c>=0&&(D=l),D!==this._tTime||_||I){if(x!==this._time&&S&&(D+=this._time-x,c+=this._time-x),V=D,Te=this._start,Ie=this._ts,Ce=!Ie,I&&(S||(x=this._zTime),(c||!d)&&(this._zTime=c)),this._repeat){if($e=this._yoyo,ce=S+this._rDelay,this._repeat<-1&&c<0)return this.totalTime(ce*100+c,d,_);if(V=co(D%ce),D===l?(te=this._repeat,V=S):(te=~~(D/ce),te&&te===D/ce&&(V=S,te--),V>S&&(V=S)),Ge=Vg(this._tTime,ce),!x&&this._tTime&&Ge!==te&&this._tTime-Ge*ce-this._dur<=0&&(Ge=te),$e&&te&1&&(V=S-V,ue=1),te!==Ge&&!this._lock){var pe=$e&&Ge&1,_e=pe===($e&&te&1);if(te<Ge&&(pe=!pe),x=pe?0:D%S?S:D,this._lock=1,this.render(x||(ue?0:co(te*ce)),d,!S)._lock=0,this._tTime=D,!d&&this.parent&&dl(this,"onRepeat"),this.vars.repeatRefresh&&!ue&&(this.invalidate()._lock=1),x&&x!==this._time||Ce!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(S=this._dur,l=this._tDur,_e&&(this._lock=2,x=pe?S:-1e-4,this.render(x,!0),this.vars.repeatRefresh&&!ue&&this.invalidate()),this._lock=0,!this._ts&&!Ce)return this;pV(this,ue)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(Me=aoe(this,co(x),co(V)),Me&&(D-=V-(V=Me._start))),this._tTime=D,this._time=V,this._act=!Ie,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=c,x=0),!x&&V&&!d&&!te&&(dl(this,"onStart"),this._tTime!==D))return this;if(V>=x&&c>=0)for(j=this._first;j;){if(Q=j._next,(j._act||V>=j._start)&&j._ts&&Me!==j){if(j.parent!==this)return this.render(c,d,_);if(j.render(j._ts>0?(V-j._start)*j._ts:(j._dirty?j.totalDuration():j._tDur)+(V-j._start)*j._ts,d,_),V!==this._time||!this._ts&&!Ce){Me=0,Q&&(D+=this._zTime=-Gn);break}}j=Q}else{j=this._last;for(var ge=c<0?c:V;j;){if(Q=j._prev,(j._act||ge<=j._end)&&j._ts&&Me!==j){if(j.parent!==this)return this.render(c,d,_);if(j.render(j._ts>0?(ge-j._start)*j._ts:(j._dirty?j.totalDuration():j._tDur)+(ge-j._start)*j._ts,d,_||Qo&&(j._initted||j._startAt)),V!==this._time||!this._ts&&!Ce){Me=0,Q&&(D+=this._zTime=ge?-Gn:Gn);break}}j=Q}}if(Me&&!d&&(this.pause(),Me.render(V>=x?0:-Gn)._zTime=V>=x?1:-1,this._ts))return this._start=Te,OE(this),this.render(c,d,_);this._onUpdate&&!d&&dl(this,"onUpdate",!0),(D===l&&this._tTime>=this.totalDuration()||!D&&x)&&(Te===this._start||Math.abs(Ie)!==Math.abs(this._ts))&&(this._lock||((c||!S)&&(D===l&&this._ts>0||!D&&this._ts<0)&&ef(this,1),!d&&!(c<0&&!x)&&(D||x||!l)&&(dl(this,D===l&&c>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(D<l&&this.timeScale()>0)&&this._prom())))}return this},r.add=function(c,d){var _=this;if(yh(d)||(d=kl(this,d,c)),!(c instanceof _1)){if(Ko(c))return c.forEach(function(x){return _.add(x,d)}),this;if(mo(c))return this.addLabel(c,d);if(vs(c))c=Os.delayedCall(0,c);else return this}return this!==c?tu(this,c,d):this},r.getChildren=function(c,d,_,x){c===void 0&&(c=!0),d===void 0&&(d=!0),_===void 0&&(_=!0),x===void 0&&(x=-Vl);for(var l=[],S=this._first;S;)S._start>=x&&(S instanceof Os?d&&l.push(S):(_&&l.push(S),c&&l.push.apply(l,S.getChildren(!0,d,_)))),S=S._next;return l},r.getById=function(c){for(var d=this.getChildren(1,1,1),_=d.length;_--;)if(d[_].vars.id===c)return d[_]},r.remove=function(c){return mo(c)?this.removeLabel(c):vs(c)?this.killTweensOf(c):(LE(this,c),c===this._recent&&(this._recent=this._last),Bp(this))},r.totalTime=function(c,d){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=co(ul.time-(this._ts>0?c/this._ts:(this.totalDuration()-c)/-this._ts))),n.prototype.totalTime.call(this,c,d),this._forcing=0,this):this._tTime},r.addLabel=function(c,d){return this.labels[c]=kl(this,d),this},r.removeLabel=function(c){return delete this.labels[c],this},r.addPause=function(c,d,_){var x=Os.delayedCall(0,d||f1,_);return x.data="isPause",this._hasPause=1,tu(this,x,kl(this,c))},r.removePause=function(c){var d=this._first;for(c=kl(this,c);d;)d._start===c&&d.data==="isPause"&&ef(d),d=d._next},r.killTweensOf=function(c,d,_){for(var x=this.getTweensOf(c,_),l=x.length;l--;)kd!==x[l]&&x[l].kill(c,d);return this},r.getTweensOf=function(c,d){for(var _=[],x=Ul(c),l=this._first,S=yh(d),D;l;)l instanceof Os?eoe(l._targets,x)&&(S?(!kd||l._initted&&l._ts)&&l.globalTime(0)<=d&&l.globalTime(l.totalDuration())>d:!d||l.isActive())&&_.push(l):(D=l.getTweensOf(x,d)).length&&_.push.apply(_,D),l=l._next;return _},r.tweenTo=function(c,d){d=d||{};var _=this,x=kl(_,c),l=d,S=l.startAt,D=l.onStart,I=l.onStartParams,V=l.immediateRender,j,Q=Os.to(_,Hl({ease:d.ease||"none",lazy:!1,immediateRender:!1,time:x,overwrite:"auto",duration:d.duration||Math.abs((x-(S&&"time"in S?S.time:_._time))/_.timeScale())||Gn,onStart:function(){if(_.pause(),!j){var ce=d.duration||Math.abs((x-(S&&"time"in S?S.time:_._time))/_.timeScale());Q._dur!==ce&&Ug(Q,ce,0,1).render(Q._time,!0,!0),j=1}D&&D.apply(Q,I||[])}},d));return V?Q.render(0):Q},r.tweenFromTo=function(c,d,_){return this.tweenTo(d,Hl({startAt:{time:kl(this,c)}},_))},r.recent=function(){return this._recent},r.nextLabel=function(c){return c===void 0&&(c=this._time),aO(this,kl(this,c))},r.previousLabel=function(c){return c===void 0&&(c=this._time),aO(this,kl(this,c),1)},r.currentLabel=function(c){return arguments.length?this.seek(c,!0):this.previousLabel(this._time+Gn)},r.shiftChildren=function(c,d,_){_===void 0&&(_=0);for(var x=this._first,l=this.labels,S;x;)x._start>=_&&(x._start+=c,x._end+=c),x=x._next;if(d)for(S in l)l[S]>=_&&(l[S]+=c);return Bp(this)},r.invalidate=function(c){var d=this._first;for(this._lock=0;d;)d.invalidate(c),d=d._next;return n.prototype.invalidate.call(this,c)},r.clear=function(c){c===void 0&&(c=!0);for(var d=this._first,_;d;)_=d._next,this.remove(d),d=_;return this._dp&&(this._time=this._tTime=this._pTime=0),c&&(this.labels={}),Bp(this)},r.totalDuration=function(c){var d=0,_=this,x=_._last,l=Vl,S,D,I;if(arguments.length)return _.timeScale((_._repeat<0?_.duration():_.totalDuration())/(_.reversed()?-c:c));if(_._dirty){for(I=_.parent;x;)S=x._prev,x._dirty&&x.totalDuration(),D=x._start,D>l&&_._sort&&x._ts&&!_._lock?(_._lock=1,tu(_,x,D-x._delay,1)._lock=0):l=D,D<0&&x._ts&&(d-=D,(!I&&!_._dp||I&&I.smoothChildTiming)&&(_._start+=D/_._ts,_._time-=D,_._tTime-=D),_.shiftChildren(-D,!1,-1/0),l=0),x._end>d&&x._ts&&(d=x._end),x=S;Ug(_,_===as&&_._time>d?_._time:d,1,1),_._dirty=0}return _._tDur},e.updateRoot=function(c){if(as._ts&&(Z8(as,ST(c,as)),H8=ul.frame),ul.frame>=iO){iO+=pl.autoSleep||120;var d=as._first;if((!d||!d._ts)&&pl.autoSleep&&ul._listeners.length<2){for(;d&&!d._ts;)d=d._next;d||ul.sleep()}}},e}(_1);Hl(ma.prototype,{_lock:0,_hasPause:0,_forcing:0});var Toe=function(e,r,s,c,d,_,x){var l=new Ua(this._pt,e,r,0,1,wV,null,d),S=0,D=0,I,V,j,Q,te,ce,Ce,Me;for(l.b=s,l.e=c,s+="",c+="",(Ce=~c.indexOf("random("))&&(c=p1(c)),_&&(Me=[s,c],_(Me,e,r),s=Me[0],c=Me[1]),V=s.match(wA)||[];I=wA.exec(c);)Q=I[0],te=c.substring(S,I.index),j?j=(j+1)%5:te.substr(-5)==="rgba("&&(j=1),Q!==V[D++]&&(ce=parseFloat(V[D-1])||0,l._pt={_next:l._pt,p:te||D===1?te:",",s:ce,c:Q.charAt(1)==="="?dg(ce,Q)-ce:parseFloat(Q)-ce,m:j&&j<4?Math.round:0},S=wA.lastIndex);return l.c=S<c.length?c.substring(S,c.length):"",l.fp=x,(U8.test(c)||Ce)&&(l.e=0),this._pt=l,l},UR=function(e,r,s,c,d,_,x,l,S,D){vs(c)&&(c=c(d||0,e,_));var I=e[r],V=s!=="get"?s:vs(I)?S?e[r.indexOf("set")||!vs(e["get"+r.substr(3)])?r:"get"+r.substr(3)](S):e[r]():I,j=vs(I)?S?Coe:xV:$R,Q;if(mo(c)&&(~c.indexOf("random(")&&(c=p1(c)),c.charAt(1)==="="&&(Q=dg(V,c)+(Xo(V)||0),(Q||Q===0)&&(c=Q))),!D||V!==c||mS)return!isNaN(V*c)&&c!==""?(Q=new Ua(this._pt,e,r,+V||0,c-(V||0),typeof I=="boolean"?Poe:bV,0,j),S&&(Q.fp=S),x&&Q.modifier(x,this,e),this._pt=Q):(!I&&!(r in e)&&FR(r,c),Toe.call(this,e,r,V,c,j,l||pl.stringFilter,S))},Eoe=function(e,r,s,c,d){if(vs(e)&&(e=Cv(e,d,r,s,c)),!vu(e)||e.style&&e.nodeType||Ko(e)||B8(e))return mo(e)?Cv(e,d,r,s,c):e;var _={},x;for(x in e)_[x]=Cv(e[x],d,r,s,c);return _},gV=function(e,r,s,c,d,_){var x,l,S,D;if(cl[e]&&(x=new cl[e]).init(d,x.rawVars?r[e]:Eoe(r[e],c,d,_,s),s,c,_)!==!1&&(s._pt=l=new Ua(s._pt,d,e,0,1,x.render,x,0,x.priority),s!==tg))for(S=s._ptLookup[s._targets.indexOf(d)],D=x._props.length;D--;)S[x._props[D]]=l;return x},kd,mS,jR=function n(e,r,s){var c=e.vars,d=c.ease,_=c.startAt,x=c.immediateRender,l=c.lazy,S=c.onUpdate,D=c.runBackwards,I=c.yoyoEase,V=c.keyframes,j=c.autoRevert,Q=e._dur,te=e._startAt,ce=e._targets,Ce=e.parent,Me=Ce&&Ce.data==="nested"?Ce.vars.targets:ce,Ie=e._overwrite==="auto"&&!DR,Te=e.timeline,Ge,$e,ue,pe,_e,ge,Fe,De,Se,pr,or,Vt,Ht;if(Te&&(!V||!d)&&(d="none"),e._ease=Vp(d,Bg.ease),e._yEase=I?fV(Vp(I===!0?d:I,Bg.ease)):0,I&&e._yoyo&&!e._repeat&&(I=e._yEase,e._yEase=e._ease,e._ease=I),e._from=!Te&&!!c.runBackwards,!Te||V&&!c.stagger){if(De=ce[0]?Np(ce[0]).harness:0,Vt=De&&c[De.prop],Ge=IT(c,NR),te&&(te._zTime<0&&te.progress(1),r<0&&D&&x&&!j?te.render(-1,!0):te.revert(D&&Q?Iw:Kse),te._lazy=0),_){if(ef(e._startAt=Os.set(ce,Hl({data:"isStart",overwrite:!1,parent:Ce,immediateRender:!0,lazy:!te&&Ba(l),startAt:null,delay:0,onUpdate:S&&function(){return dl(e,"onUpdate")},stagger:0},_))),e._startAt._dp=0,e._startAt._sat=e,r<0&&(Qo||!x&&!j)&&e._startAt.revert(Iw),x&&Q&&r<=0&&s<=0){r&&(e._zTime=r);return}}else if(D&&Q&&!te){if(r&&(x=!1),ue=Hl({overwrite:!1,data:"isFromStart",lazy:x&&!te&&Ba(l),immediateRender:x,stagger:0,parent:Ce},Ge),Vt&&(ue[De.prop]=Vt),ef(e._startAt=Os.set(ce,ue)),e._startAt._dp=0,e._startAt._sat=e,r<0&&(Qo?e._startAt.revert(Iw):e._startAt.render(-1,!0)),e._zTime=r,!x)n(e._startAt,Gn,Gn);else if(!r)return}for(e._pt=e._ptCache=0,l=Q&&Ba(l)||l&&!Q,$e=0;$e<ce.length;$e++){if(_e=ce[$e],Fe=_e._gsap||VR(ce)[$e]._gsap,e._ptLookup[$e]=pr={},cS[Fe.id]&&qd.length&&AT(),or=Me===ce?$e:Me.indexOf(_e),De&&(Se=new De).init(_e,Vt||Ge,e,or,Me)!==!1&&(e._pt=pe=new Ua(e._pt,_e,Se.name,0,1,Se.render,Se,0,Se.priority),Se._props.forEach(function(Kt){pr[Kt]=pe}),Se.priority&&(ge=1)),!De||Vt)for(ue in Ge)cl[ue]&&(Se=gV(ue,Ge,e,or,_e,Me))?Se.priority&&(ge=1):pr[ue]=pe=UR.call(e,_e,ue,"get",Ge[ue],or,Me,0,c.stringFilter);e._op&&e._op[$e]&&e.kill(_e,e._op[$e]),Ie&&e._pt&&(kd=e,as.killTweensOf(_e,pr,e.globalTime(r)),Ht=!e.parent,kd=0),e._pt&&l&&(cS[Fe.id]=1)}ge&&TV(e),e._onInit&&e._onInit(e)}e._onUpdate=S,e._initted=(!e._op||e._pt)&&!Ht,V&&r<=0&&Te.render(Vl,!0,!0)},Aoe=function(e,r,s,c,d,_,x,l){var S=(e._pt&&e._ptCache||(e._ptCache={}))[r],D,I,V,j;if(!S)for(S=e._ptCache[r]=[],V=e._ptLookup,j=e._targets.length;j--;){if(D=V[j][r],D&&D.d&&D.d._pt)for(D=D.d._pt;D&&D.p!==r&&D.fp!==r;)D=D._next;if(!D)return mS=1,e.vars[r]="+=0",jR(e,x),mS=0,l?d1(r+" not eligible for reset"):1;S.push(D)}for(j=S.length;j--;)I=S[j],D=I._pt||I,D.s=(c||c===0)&&!d?c:D.s+(c||0)+_*D.c,D.c=s-D.s,I.e&&(I.e=As(s)+Xo(I.e)),I.b&&(I.b=D.s+Xo(I.b))},Ioe=function(e,r){var s=e[0]?Np(e[0]).harness:0,c=s&&s.aliases,d,_,x,l;if(!c)return r;d=sm({},r);for(_ in c)if(_ in d)for(l=c[_].split(","),x=l.length;x--;)d[l[x]]=d[_];return d},Soe=function(e,r,s,c){var d=r.ease||c||"power1.inOut",_,x;if(Ko(r))x=s[e]||(s[e]=[]),r.forEach(function(l,S){return x.push({t:S/(r.length-1)*100,v:l,e:d})});else for(_ in r)x=s[_]||(s[_]=[]),_==="ease"||x.push({t:parseFloat(e),v:r[_],e:d})},Cv=function(e,r,s,c,d){return vs(e)?e.call(r,s,c,d):mo(e)&&~e.indexOf("random(")?p1(e):e},yV=BR+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",vV={};Va(yV+",id,stagger,delay,duration,paused,scrollTrigger",function(n){return vV[n]=1});var Os=function(n){F8(e,n);function e(s,c,d,_){var x;typeof c=="number"&&(d.duration=c,c=d,d=null),x=n.call(this,_?c:Iv(c))||this;var l=x.vars,S=l.duration,D=l.delay,I=l.immediateRender,V=l.stagger,j=l.overwrite,Q=l.keyframes,te=l.defaults,ce=l.scrollTrigger,Ce=l.yoyoEase,Me=c.parent||as,Ie=(Ko(s)||B8(s)?yh(s[0]):"length"in c)?[s]:Ul(s),Te,Ge,$e,ue,pe,_e,ge,Fe;if(x._targets=Ie.length?VR(Ie):d1("GSAP target "+s+" not found. https://gsap.com",!pl.nullTargetWarn)||[],x._ptLookup=[],x._overwrite=j,Q||V||Yb(S)||Yb(D)){if(c=x.vars,Te=x.timeline=new ma({data:"nested",defaults:te||{},targets:Me&&Me.data==="nested"?Me.vars.targets:Ie}),Te.kill(),Te.parent=Te._dp=rh(x),Te._start=0,V||Yb(S)||Yb(D)){if(ue=Ie.length,ge=V&&iV(V),vu(V))for(pe in V)~yV.indexOf(pe)&&(Fe||(Fe={}),Fe[pe]=V[pe]);for(Ge=0;Ge<ue;Ge++)$e=IT(c,vV),$e.stagger=0,Ce&&($e.yoyoEase=Ce),Fe&&sm($e,Fe),_e=Ie[Ge],$e.duration=+Cv(S,rh(x),Ge,_e,Ie),$e.delay=(+Cv(D,rh(x),Ge,_e,Ie)||0)-x._delay,!V&&ue===1&&$e.delay&&(x._delay=D=$e.delay,x._start+=D,$e.delay=0),Te.to(_e,$e,ge?ge(Ge,_e,Ie):0),Te._ease=on.none;Te.duration()?S=D=0:x.timeline=0}else if(Q){Iv(Hl(Te.vars.defaults,{ease:"none"})),Te._ease=Vp(Q.ease||c.ease||"none");var De=0,Se,pr,or;if(Ko(Q))Q.forEach(function(Vt){return Te.to(Ie,Vt,">")}),Te.duration();else{$e={};for(pe in Q)pe==="ease"||pe==="easeEach"||Soe(pe,Q[pe],$e,Q.easeEach);for(pe in $e)for(Se=$e[pe].sort(function(Vt,Ht){return Vt.t-Ht.t}),De=0,Ge=0;Ge<Se.length;Ge++)pr=Se[Ge],or={ease:pr.e,duration:(pr.t-(Ge?Se[Ge-1].t:0))/100*S},or[pe]=pr.v,Te.to(Ie,or,De),De+=or.duration;Te.duration()<S&&Te.to({},{duration:S-Te.duration()})}}S||x.duration(S=Te.duration())}else x.timeline=0;return j===!0&&!DR&&(kd=rh(x),as.killTweensOf(Ie),kd=0),tu(Me,rh(x),d),c.reversed&&x.reverse(),c.paused&&x.paused(!0),(I||!S&&!Q&&x._start===co(Me._time)&&Ba(I)&&noe(rh(x))&&Me.data!=="nested")&&(x._tTime=-Gn,x.render(Math.max(0,-D)||0)),ce&&J8(rh(x),ce),x}var r=e.prototype;return r.render=function(c,d,_){var x=this._time,l=this._tDur,S=this._dur,D=c<0,I=c>l-Gn&&!D?l:c<Gn?0:c,V,j,Q,te,ce,Ce,Me,Ie,Te;if(!S)ooe(this,c,d,_);else if(I!==this._tTime||!c||_||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==D){if(V=I,Ie=this.timeline,this._repeat){if(te=S+this._rDelay,this._repeat<-1&&D)return this.totalTime(te*100+c,d,_);if(V=co(I%te),I===l?(Q=this._repeat,V=S):(Q=~~(I/te),Q&&Q===co(I/te)&&(V=S,Q--),V>S&&(V=S)),Ce=this._yoyo&&Q&1,Ce&&(Te=this._yEase,V=S-V),ce=Vg(this._tTime,te),V===x&&!_&&this._initted&&Q===ce)return this._tTime=I,this;Q!==ce&&(Ie&&this._yEase&&pV(Ie,Ce),this.vars.repeatRefresh&&!Ce&&!this._lock&&this._time!==te&&this._initted&&(this._lock=_=1,this.render(co(te*Q),!0).invalidate()._lock=0))}if(!this._initted){if(eV(this,D?c:V,_,d,I))return this._tTime=0,this;if(x!==this._time&&!(_&&this.vars.repeatRefresh&&Q!==ce))return this;if(S!==this._dur)return this.render(c,d,_)}if(this._tTime=I,this._time=V,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=Me=(Te||this._ease)(V/S),this._from&&(this.ratio=Me=1-Me),V&&!x&&!d&&!Q&&(dl(this,"onStart"),this._tTime!==I))return this;for(j=this._pt;j;)j.r(Me,j.d),j=j._next;Ie&&Ie.render(c<0?c:Ie._dur*Ie._ease(V/this._dur),d,_)||this._startAt&&(this._zTime=c),this._onUpdate&&!d&&(D&&uS(this,c,d,_),dl(this,"onUpdate")),this._repeat&&Q!==ce&&this.vars.onRepeat&&!d&&this.parent&&dl(this,"onRepeat"),(I===this._tDur||!I)&&this._tTime===I&&(D&&!this._onUpdate&&uS(this,c,!0,!0),(c||!S)&&(I===this._tDur&&this._ts>0||!I&&this._ts<0)&&ef(this,1),!d&&!(D&&!x)&&(I||x||Ce)&&(dl(this,I===l?"onComplete":"onReverseComplete",!0),this._prom&&!(I<l&&this.timeScale()>0)&&this._prom()))}return this},r.targets=function(){return this._targets},r.invalidate=function(c){return(!c||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(c),n.prototype.invalidate.call(this,c)},r.resetTo=function(c,d,_,x,l){m1||ul.wake(),this._ts||this.play();var S=Math.min(this._dur,(this._dp._time-this._start)*this._ts),D;return this._initted||jR(this,S),D=this._ease(S/this._dur),Aoe(this,c,d,_,x,D,S,l)?this.resetTo(c,d,_,x,1):(zE(this,0),this.parent||Q8(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},r.kill=function(c,d){if(d===void 0&&(d="all"),!c&&(!d||d==="all"))return this._lazy=this._pt=0,this.parent?ev(this):this;if(this.timeline){var _=this.timeline.totalDuration();return this.timeline.killTweensOf(c,d,kd&&kd.vars.overwrite!==!0)._first||ev(this),this.parent&&_!==this.timeline.totalDuration()&&Ug(this,this._dur*this.timeline._tDur/_,0,1),this}var x=this._targets,l=c?Ul(c):x,S=this._ptLookup,D=this._pt,I,V,j,Q,te,ce,Ce;if((!d||d==="all")&&roe(x,l))return d==="all"&&(this._pt=0),ev(this);for(I=this._op=this._op||[],d!=="all"&&(mo(d)&&(te={},Va(d,function(Me){return te[Me]=1}),d=te),d=Ioe(x,d)),Ce=x.length;Ce--;)if(~l.indexOf(x[Ce])){V=S[Ce],d==="all"?(I[Ce]=d,Q=V,j={}):(j=I[Ce]=I[Ce]||{},Q=d);for(te in Q)ce=V&&V[te],ce&&((!("kill"in ce.d)||ce.d.kill(te)===!0)&&LE(this,ce,"_pt"),delete V[te]),j!=="all"&&(j[te]=1)}return this._initted&&!this._pt&&D&&ev(this),this},e.to=function(c,d){return new e(c,d,arguments[2])},e.from=function(c,d){return Sv(1,arguments)},e.delayedCall=function(c,d,_,x){return new e(d,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:c,onComplete:d,onReverseComplete:d,onCompleteParams:_,onReverseCompleteParams:_,callbackScope:x})},e.fromTo=function(c,d,_){return Sv(2,arguments)},e.set=function(c,d){return d.duration=0,d.repeatDelay||(d.repeat=0),new e(c,d)},e.killTweensOf=function(c,d,_){return as.killTweensOf(c,d,_)},e}(_1);Hl(Os.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Va("staggerTo,staggerFrom,staggerFromTo",function(n){Os[n]=function(){var e=new ma,r=dS.call(arguments,0);return r.splice(n==="staggerFromTo"?5:4,0,0),e[n].apply(e,r)}});var $R=function(e,r,s){return e[r]=s},xV=function(e,r,s){return e[r](s)},Coe=function(e,r,s,c){return e[r](c.fp,s)},Roe=function(e,r,s){return e.setAttribute(r,s)},GR=function(e,r){return vs(e[r])?xV:LR(e[r])&&e.setAttribute?Roe:$R},bV=function(e,r){return r.set(r.t,r.p,Math.round((r.s+r.c*e)*1e6)/1e6,r)},Poe=function(e,r){return r.set(r.t,r.p,!!(r.s+r.c*e),r)},wV=function(e,r){var s=r._pt,c="";if(!e&&r.b)c=r.b;else if(e===1&&r.e)c=r.e;else{for(;s;)c=s.p+(s.m?s.m(s.s+s.c*e):Math.round((s.s+s.c*e)*1e4)/1e4)+c,s=s._next;c+=r.c}r.set(r.t,r.p,c,r)},qR=function(e,r){for(var s=r._pt;s;)s.r(e,s.d),s=s._next},Moe=function(e,r,s,c){for(var d=this._pt,_;d;)_=d._next,d.p===c&&d.modifier(e,r,s),d=_},koe=function(e){for(var r=this._pt,s,c;r;)c=r._next,r.p===e&&!r.op||r.op===e?LE(this,r,"_pt"):r.dep||(s=1),r=c;return!s},Doe=function(e,r,s,c){c.mSet(e,r,c.m.call(c.tween,s,c.mt),c)},TV=function(e){for(var r=e._pt,s,c,d,_;r;){for(s=r._next,c=d;c&&c.pr>r.pr;)c=c._next;(r._prev=c?c._prev:_)?r._prev._next=r:d=r,(r._next=c)?c._prev=r:_=r,r=s}e._pt=d},Ua=function(){function n(r,s,c,d,_,x,l,S,D){this.t=s,this.s=d,this.c=_,this.p=c,this.r=x||bV,this.d=l||this,this.set=S||$R,this.pr=D||0,this._next=r,r&&(r._prev=this)}var e=n.prototype;return e.modifier=function(s,c,d){this.mSet=this.mSet||this.set,this.set=Doe,this.m=s,this.mt=d,this.tween=c},n}();Va(BR+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(n){return NR[n]=1});ml.TweenMax=ml.TweenLite=Os;ml.TimelineLite=ml.TimelineMax=ma;as=new ma({sortChildren:!1,defaults:Bg,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});pl.stringFilter=dV;var Up=[],Cw={},Loe=[],cO=0,Ooe=0,SA=function(e){return(Cw[e]||Loe).map(function(r){return r()})},_S=function(){var e=Date.now(),r=[];e-cO>2&&(SA("matchMediaInit"),Up.forEach(function(s){var c=s.queries,d=s.conditions,_,x,l,S;for(x in c)_=Qc.matchMedia(c[x]).matches,_&&(l=1),_!==d[x]&&(d[x]=_,S=1);S&&(s.revert(),l&&r.push(s))}),SA("matchMediaRevert"),r.forEach(function(s){return s.onMatch(s,function(c){return s.add(null,c)})}),cO=e,SA("matchMedia"))},EV=function(){function n(r,s){this.selector=s&&fS(s),this.data=[],this._r=[],this.isReverted=!1,this.id=Ooe++,r&&this.add(r)}var e=n.prototype;return e.add=function(s,c,d){vs(s)&&(d=c,c=s,s=vs);var _=this,x=function(){var S=rs,D=_.selector,I;return S&&S!==_&&S.data.push(_),d&&(_.selector=fS(d)),rs=_,I=c.apply(_,arguments),vs(I)&&_._r.push(I),rs=S,_.selector=D,_.isReverted=!1,I};return _.last=x,s===vs?x(_,function(l){return _.add(null,l)}):s?_[s]=x:x},e.ignore=function(s){var c=rs;rs=null,s(this),rs=c},e.getTweens=function(){var s=[];return this.data.forEach(function(c){return c instanceof n?s.push.apply(s,c.getTweens()):c instanceof Os&&!(c.parent&&c.parent.data==="nested")&&s.push(c)}),s},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(s,c){var d=this;if(s?function(){for(var x=d.getTweens(),l=d.data.length,S;l--;)S=d.data[l],S.data==="isFlip"&&(S.revert(),S.getChildren(!0,!0,!1).forEach(function(D){return x.splice(x.indexOf(D),1)}));for(x.map(function(D){return{g:D._dur||D._delay||D._sat&&!D._sat.vars.immediateRender?D.globalTime(0):-1/0,t:D}}).sort(function(D,I){return I.g-D.g||-1/0}).forEach(function(D){return D.t.revert(s)}),l=d.data.length;l--;)S=d.data[l],S instanceof ma?S.data!=="nested"&&(S.scrollTrigger&&S.scrollTrigger.revert(),S.kill()):!(S instanceof Os)&&S.revert&&S.revert(s);d._r.forEach(function(D){return D(s,d)}),d.isReverted=!0}():this.data.forEach(function(x){return x.kill&&x.kill()}),this.clear(),c)for(var _=Up.length;_--;)Up[_].id===this.id&&Up.splice(_,1)},e.revert=function(s){this.kill(s||{})},n}(),zoe=function(){function n(r){this.contexts=[],this.scope=r,rs&&rs.data.push(this)}var e=n.prototype;return e.add=function(s,c,d){vu(s)||(s={matches:s});var _=new EV(0,d||this.scope),x=_.conditions={},l,S,D;rs&&!_.selector&&(_.selector=rs.selector),this.contexts.push(_),c=_.add("onMatch",c),_.queries=s;for(S in s)S==="all"?D=1:(l=Qc.matchMedia(s[S]),l&&(Up.indexOf(_)<0&&Up.push(_),(x[S]=l.matches)&&(D=1),l.addListener?l.addListener(_S):l.addEventListener("change",_S)));return D&&c(_,function(I){return _.add(null,I)}),this},e.revert=function(s){this.kill(s||{})},e.kill=function(s){this.contexts.forEach(function(c){return c.kill(s,!0)})},n}(),CT={registerPlugin:function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];r.forEach(function(c){return cV(c)})},timeline:function(e){return new ma(e)},getTweensOf:function(e,r){return as.getTweensOf(e,r)},getProperty:function(e,r,s,c){mo(e)&&(e=Ul(e)[0]);var d=Np(e||{}).get,_=s?Y8:X8;return s==="native"&&(s=""),e&&(r?_((cl[r]&&cl[r].get||d)(e,r,s,c)):function(x,l,S){return _((cl[x]&&cl[x].get||d)(e,x,l,S))})},quickSetter:function(e,r,s){if(e=Ul(e),e.length>1){var c=e.map(function(D){return Ha.quickSetter(D,r,s)}),d=c.length;return function(D){for(var I=d;I--;)c[I](D)}}e=e[0]||{};var _=cl[r],x=Np(e),l=x.harness&&(x.harness.aliases||{})[r]||r,S=_?function(D){var I=new _;tg._pt=0,I.init(e,s?D+s:D,tg,0,[e]),I.render(1,I),tg._pt&&qR(1,tg)}:x.set(e,l);return _?S:function(D){return S(e,l,s?D+s:D,x,1)}},quickTo:function(e,r,s){var c,d=Ha.to(e,sm((c={},c[r]="+=0.1",c.paused=!0,c),s||{})),_=function(l,S,D){return d.resetTo(r,l,S,D)};return _.tween=d,_},isTweening:function(e){return as.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Vp(e.ease,Bg.ease)),nO(Bg,e||{})},config:function(e){return nO(pl,e||{})},registerEffect:function(e){var r=e.name,s=e.effect,c=e.plugins,d=e.defaults,_=e.extendTimeline;(c||"").split(",").forEach(function(x){return x&&!cl[x]&&!ml[x]&&d1(r+" effect requires "+x+" plugin.")}),TA[r]=function(x,l,S){return s(Ul(x),Hl(l||{},d),S)},_&&(ma.prototype[r]=function(x,l,S){return this.add(TA[r](x,vu(l)?l:(S=l)&&{},this),S)})},registerEase:function(e,r){on[e]=Vp(r)},parseEase:function(e,r){return arguments.length?Vp(e,r):on},getById:function(e){return as.getById(e)},exportRoot:function(e,r){e===void 0&&(e={});var s=new ma(e),c,d;for(s.smoothChildTiming=Ba(e.smoothChildTiming),as.remove(s),s._dp=0,s._time=s._tTime=as._time,c=as._first;c;)d=c._next,(r||!(!c._dur&&c instanceof Os&&c.vars.onComplete===c._targets[0]))&&tu(s,c,c._start-c._delay),c=d;return tu(as,s,0),s},context:function(e,r){return e?new EV(e,r):rs},matchMedia:function(e){return new zoe(e)},matchMediaRefresh:function(){return Up.forEach(function(e){var r=e.conditions,s,c;for(c in r)r[c]&&(r[c]=!1,s=1);s&&e.revert()})||_S()},addEventListener:function(e,r){var s=Cw[e]||(Cw[e]=[]);~s.indexOf(r)||s.push(r)},removeEventListener:function(e,r){var s=Cw[e],c=s&&s.indexOf(r);c>=0&&s.splice(c,1)},utils:{wrap:poe,wrapYoyo:moe,distribute:iV,random:sV,snap:nV,normalize:foe,getUnit:Xo,clamp:coe,splitColor:uV,toArray:Ul,selector:fS,mapRange:aV,pipe:hoe,unitize:doe,interpolate:_oe,shuffle:rV},install:G8,effects:TA,ticker:ul,updateRoot:ma.updateRoot,plugins:cl,globalTimeline:as,core:{PropTween:Ua,globals:q8,Tween:Os,Timeline:ma,Animation:_1,getCache:Np,_removeLinkedListItem:LE,reverting:function(){return Qo},context:function(e){return e&&rs&&(rs.data.push(e),e._ctx=rs),rs},suppressOverwrites:function(e){return DR=e}}};Va("to,from,fromTo,delayedCall,set,killTweensOf",function(n){return CT[n]=Os[n]});ul.add(ma.updateRoot);tg=CT.to({},{duration:0});var Foe=function(e,r){for(var s=e._pt;s&&s.p!==r&&s.op!==r&&s.fp!==r;)s=s._next;return s},Noe=function(e,r){var s=e._targets,c,d,_;for(c in r)for(d=s.length;d--;)_=e._ptLookup[d][c],_&&(_=_.d)&&(_._pt&&(_=Foe(_,c)),_&&_.modifier&&_.modifier(r[c],e,s[d],c))},CA=function(e,r){return{name:e,rawVars:1,init:function(c,d,_){_._onInit=function(x){var l,S;if(mo(d)&&(l={},Va(d,function(D){return l[D]=1}),d=l),r){l={};for(S in d)l[S]=r(d[S]);d=l}Noe(x,d)}}}},Ha=CT.registerPlugin({name:"attr",init:function(e,r,s,c,d){var _,x,l;this.tween=s;for(_ in r)l=e.getAttribute(_)||"",x=this.add(e,"setAttribute",(l||0)+"",r[_],c,d,0,0,_),x.op=_,x.b=l,this._props.push(_)},render:function(e,r){for(var s=r._pt;s;)Qo?s.set(s.t,s.p,s.b,s):s.r(e,s.d),s=s._next}},{name:"endArray",init:function(e,r){for(var s=r.length;s--;)this.add(e,s,e[s]||0,r[s],0,0,0,0,0,1)}},CA("roundProps",pS),CA("modifiers"),CA("snap",nV))||CT;Os.version=ma.version=Ha.version="3.12.5";$8=1;OR()&&jg();on.Power0;on.Power1;on.Power2;on.Power3;on.Power4;on.Linear;on.Quad;on.Cubic;on.Quart;on.Quint;on.Strong;on.Elastic;on.Back;on.SteppedEase;on.Bounce;on.Sine;on.Expo;on.Circ;/*!
 * CSSPlugin 3.12.5
 * https://gsap.com
 *
 * Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var uO,Dd,fg,HR,Mp,hO,WR,Boe=function(){return typeof window<"u"},vh={},wp=180/Math.PI,pg=Math.PI/180,O_=Math.atan2,dO=1e8,ZR=/([A-Z])/g,Voe=/(left|right|width|margin|padding|x)/i,Uoe=/[\s,\(]\S/,su={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},gS=function(e,r){return r.set(r.t,r.p,Math.round((r.s+r.c*e)*1e4)/1e4+r.u,r)},joe=function(e,r){return r.set(r.t,r.p,e===1?r.e:Math.round((r.s+r.c*e)*1e4)/1e4+r.u,r)},$oe=function(e,r){return r.set(r.t,r.p,e?Math.round((r.s+r.c*e)*1e4)/1e4+r.u:r.b,r)},Goe=function(e,r){var s=r.s+r.c*e;r.set(r.t,r.p,~~(s+(s<0?-.5:.5))+r.u,r)},AV=function(e,r){return r.set(r.t,r.p,e?r.e:r.b,r)},IV=function(e,r){return r.set(r.t,r.p,e!==1?r.b:r.e,r)},qoe=function(e,r,s){return e.style[r]=s},Hoe=function(e,r,s){return e.style.setProperty(r,s)},Woe=function(e,r,s){return e._gsap[r]=s},Zoe=function(e,r,s){return e._gsap.scaleX=e._gsap.scaleY=s},Xoe=function(e,r,s,c,d){var _=e._gsap;_.scaleX=_.scaleY=s,_.renderTransform(d,_)},Yoe=function(e,r,s,c,d){var _=e._gsap;_[r]=s,_.renderTransform(d,_)},cs="transform",ja=cs+"Origin",Qoe=function n(e,r){var s=this,c=this.target,d=c.style,_=c._gsap;if(e in vh&&d){if(this.tfm=this.tfm||{},e!=="transform")e=su[e]||e,~e.indexOf(",")?e.split(",").forEach(function(x){return s.tfm[x]=ih(c,x)}):this.tfm[e]=_.x?_[e]:ih(c,e),e===ja&&(this.tfm.zOrigin=_.zOrigin);else return su.transform.split(",").forEach(function(x){return n.call(s,x,r)});if(this.props.indexOf(cs)>=0)return;_.svg&&(this.svgo=c.getAttribute("data-svg-origin"),this.props.push(ja,r,"")),e=cs}(d||r)&&this.props.push(e,r,d[e])},SV=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},Koe=function(){var e=this.props,r=this.target,s=r.style,c=r._gsap,d,_;for(d=0;d<e.length;d+=3)e[d+1]?r[e[d]]=e[d+2]:e[d+2]?s[e[d]]=e[d+2]:s.removeProperty(e[d].substr(0,2)==="--"?e[d]:e[d].replace(ZR,"-$1").toLowerCase());if(this.tfm){for(_ in this.tfm)c[_]=this.tfm[_];c.svg&&(c.renderTransform(),r.setAttribute("data-svg-origin",this.svgo||"")),d=WR(),(!d||!d.isStart)&&!s[cs]&&(SV(s),c.zOrigin&&s[ja]&&(s[ja]+=" "+c.zOrigin+"px",c.zOrigin=0,c.renderTransform()),c.uncache=1)}},CV=function(e,r){var s={target:e,props:[],revert:Koe,save:Qoe};return e._gsap||Ha.core.getCache(e),r&&r.split(",").forEach(function(c){return s.save(c)}),s},RV,yS=function(e,r){var s=Dd.createElementNS?Dd.createElementNS((r||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Dd.createElement(e);return s&&s.style?s:Dd.createElement(e)},pu=function n(e,r,s){var c=getComputedStyle(e);return c[r]||c.getPropertyValue(r.replace(ZR,"-$1").toLowerCase())||c.getPropertyValue(r)||!s&&n(e,$g(r)||r,1)||""},fO="O,Moz,ms,Ms,Webkit".split(","),$g=function(e,r,s){var c=r||Mp,d=c.style,_=5;if(e in d&&!s)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);_--&&!(fO[_]+e in d););return _<0?null:(_===3?"ms":_>=0?fO[_]:"")+e},vS=function(){Boe()&&window.document&&(uO=window,Dd=uO.document,fg=Dd.documentElement,Mp=yS("div")||{style:{}},yS("div"),cs=$g(cs),ja=cs+"Origin",Mp.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",RV=!!$g("perspective"),WR=Ha.core.reverting,HR=1)},RA=function n(e){var r=yS("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=this.parentNode,c=this.nextSibling,d=this.style.cssText,_;if(fg.appendChild(r),r.appendChild(this),this.style.display="block",e)try{_=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=n}catch{}else this._gsapBBox&&(_=this._gsapBBox());return s&&(c?s.insertBefore(this,c):s.appendChild(this)),fg.removeChild(r),this.style.cssText=d,_},pO=function(e,r){for(var s=r.length;s--;)if(e.hasAttribute(r[s]))return e.getAttribute(r[s])},PV=function(e){var r;try{r=e.getBBox()}catch{r=RA.call(e,!0)}return r&&(r.width||r.height)||e.getBBox===RA||(r=RA.call(e,!0)),r&&!r.width&&!r.x&&!r.y?{x:+pO(e,["x","cx","x1"])||0,y:+pO(e,["y","cy","y1"])||0,width:0,height:0}:r},MV=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&PV(e))},om=function(e,r){if(r){var s=e.style,c;r in vh&&r!==ja&&(r=cs),s.removeProperty?(c=r.substr(0,2),(c==="ms"||r.substr(0,6)==="webkit")&&(r="-"+r),s.removeProperty(c==="--"?r:r.replace(ZR,"-$1").toLowerCase())):s.removeAttribute(r)}},Ld=function(e,r,s,c,d,_){var x=new Ua(e._pt,r,s,0,1,_?IV:AV);return e._pt=x,x.b=c,x.e=d,e._props.push(s),x},mO={deg:1,rad:1,turn:1},Joe={grid:1,flex:1},tf=function n(e,r,s,c){var d=parseFloat(s)||0,_=(s+"").trim().substr((d+"").length)||"px",x=Mp.style,l=Voe.test(r),S=e.tagName.toLowerCase()==="svg",D=(S?"client":"offset")+(l?"Width":"Height"),I=100,V=c==="px",j=c==="%",Q,te,ce,Ce;if(c===_||!d||mO[c]||mO[_])return d;if(_!=="px"&&!V&&(d=n(e,r,s,"px")),Ce=e.getCTM&&MV(e),(j||_==="%")&&(vh[r]||~r.indexOf("adius")))return Q=Ce?e.getBBox()[l?"width":"height"]:e[D],As(j?d/Q*I:d/100*Q);if(x[l?"width":"height"]=I+(V?_:c),te=~r.indexOf("adius")||c==="em"&&e.appendChild&&!S?e:e.parentNode,Ce&&(te=(e.ownerSVGElement||{}).parentNode),(!te||te===Dd||!te.appendChild)&&(te=Dd.body),ce=te._gsap,ce&&j&&ce.width&&l&&ce.time===ul.time&&!ce.uncache)return As(d/ce.width*I);if(j&&(r==="height"||r==="width")){var Me=e.style[r];e.style[r]=I+c,Q=e[D],Me?e.style[r]=Me:om(e,r)}else(j||_==="%")&&!Joe[pu(te,"display")]&&(x.position=pu(e,"position")),te===e&&(x.position="static"),te.appendChild(Mp),Q=Mp[D],te.removeChild(Mp),x.position="absolute";return l&&j&&(ce=Np(te),ce.time=ul.time,ce.width=te[D]),As(V?Q*d/I:Q&&d?I/Q*d:0)},ih=function(e,r,s,c){var d;return HR||vS(),r in su&&r!=="transform"&&(r=su[r],~r.indexOf(",")&&(r=r.split(",")[0])),vh[r]&&r!=="transform"?(d=y1(e,c),d=r!=="transformOrigin"?d[r]:d.svg?d.origin:PT(pu(e,ja))+" "+d.zOrigin+"px"):(d=e.style[r],(!d||d==="auto"||c||~(d+"").indexOf("calc("))&&(d=RT[r]&&RT[r](e,r,s)||pu(e,r)||W8(e,r)||(r==="opacity"?1:0))),s&&!~(d+"").trim().indexOf(" ")?tf(e,r,d,s)+s:d},eae=function(e,r,s,c){if(!s||s==="none"){var d=$g(r,e,1),_=d&&pu(e,d,1);_&&_!==s?(r=d,s=_):r==="borderColor"&&(s=pu(e,"borderTopColor"))}var x=new Ua(this._pt,e.style,r,0,1,wV),l=0,S=0,D,I,V,j,Q,te,ce,Ce,Me,Ie,Te,Ge;if(x.b=s,x.e=c,s+="",c+="",c==="auto"&&(te=e.style[r],e.style[r]=c,c=pu(e,r)||c,te?e.style[r]=te:om(e,r)),D=[s,c],dV(D),s=D[0],c=D[1],V=s.match(eg)||[],Ge=c.match(eg)||[],Ge.length){for(;I=eg.exec(c);)ce=I[0],Me=c.substring(l,I.index),Q?Q=(Q+1)%5:(Me.substr(-5)==="rgba("||Me.substr(-5)==="hsla(")&&(Q=1),ce!==(te=V[S++]||"")&&(j=parseFloat(te)||0,Te=te.substr((j+"").length),ce.charAt(1)==="="&&(ce=dg(j,ce)+Te),Ce=parseFloat(ce),Ie=ce.substr((Ce+"").length),l=eg.lastIndex-Ie.length,Ie||(Ie=Ie||pl.units[r]||Te,l===c.length&&(c+=Ie,x.e+=Ie)),Te!==Ie&&(j=tf(e,r,te,Ie)||0),x._pt={_next:x._pt,p:Me||S===1?Me:",",s:j,c:Ce-j,m:Q&&Q<4||r==="zIndex"?Math.round:0});x.c=l<c.length?c.substring(l,c.length):""}else x.r=r==="display"&&c==="none"?IV:AV;return U8.test(c)&&(x.e=0),this._pt=x,x},_O={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},tae=function(e){var r=e.split(" "),s=r[0],c=r[1]||"50%";return(s==="top"||s==="bottom"||c==="left"||c==="right")&&(e=s,s=c,c=e),r[0]=_O[s]||s,r[1]=_O[c]||c,r.join(" ")},rae=function(e,r){if(r.tween&&r.tween._time===r.tween._dur){var s=r.t,c=s.style,d=r.u,_=s._gsap,x,l,S;if(d==="all"||d===!0)c.cssText="",l=1;else for(d=d.split(","),S=d.length;--S>-1;)x=d[S],vh[x]&&(l=1,x=x==="transformOrigin"?ja:cs),om(s,x);l&&(om(s,cs),_&&(_.svg&&s.removeAttribute("transform"),y1(s,1),_.uncache=1,SV(c)))}},RT={clearProps:function(e,r,s,c,d){if(d.data!=="isFromStart"){var _=e._pt=new Ua(e._pt,r,s,0,0,rae);return _.u=c,_.pr=-10,_.tween=d,e._props.push(s),1}}},g1=[1,0,0,1,0,0],kV={},DV=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},gO=function(e){var r=pu(e,cs);return DV(r)?g1:r.substr(7).match(V8).map(As)},XR=function(e,r){var s=e._gsap||Np(e),c=e.style,d=gO(e),_,x,l,S;return s.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,d=[l.a,l.b,l.c,l.d,l.e,l.f],d.join(",")==="1,0,0,1,0,0"?g1:d):(d===g1&&!e.offsetParent&&e!==fg&&!s.svg&&(l=c.display,c.display="block",_=e.parentNode,(!_||!e.offsetParent)&&(S=1,x=e.nextElementSibling,fg.appendChild(e)),d=gO(e),l?c.display=l:om(e,"display"),S&&(x?_.insertBefore(e,x):_?_.appendChild(e):fg.removeChild(e))),r&&d.length>6?[d[0],d[1],d[4],d[5],d[12],d[13]]:d)},xS=function(e,r,s,c,d,_){var x=e._gsap,l=d||XR(e,!0),S=x.xOrigin||0,D=x.yOrigin||0,I=x.xOffset||0,V=x.yOffset||0,j=l[0],Q=l[1],te=l[2],ce=l[3],Ce=l[4],Me=l[5],Ie=r.split(" "),Te=parseFloat(Ie[0])||0,Ge=parseFloat(Ie[1])||0,$e,ue,pe,_e;s?l!==g1&&(ue=j*ce-Q*te)&&(pe=Te*(ce/ue)+Ge*(-te/ue)+(te*Me-ce*Ce)/ue,_e=Te*(-Q/ue)+Ge*(j/ue)-(j*Me-Q*Ce)/ue,Te=pe,Ge=_e):($e=PV(e),Te=$e.x+(~Ie[0].indexOf("%")?Te/100*$e.width:Te),Ge=$e.y+(~(Ie[1]||Ie[0]).indexOf("%")?Ge/100*$e.height:Ge)),c||c!==!1&&x.smooth?(Ce=Te-S,Me=Ge-D,x.xOffset=I+(Ce*j+Me*te)-Ce,x.yOffset=V+(Ce*Q+Me*ce)-Me):x.xOffset=x.yOffset=0,x.xOrigin=Te,x.yOrigin=Ge,x.smooth=!!c,x.origin=r,x.originIsAbsolute=!!s,e.style[ja]="0px 0px",_&&(Ld(_,x,"xOrigin",S,Te),Ld(_,x,"yOrigin",D,Ge),Ld(_,x,"xOffset",I,x.xOffset),Ld(_,x,"yOffset",V,x.yOffset)),e.setAttribute("data-svg-origin",Te+" "+Ge)},y1=function(e,r){var s=e._gsap||new _V(e);if("x"in s&&!r&&!s.uncache)return s;var c=e.style,d=s.scaleX<0,_="px",x="deg",l=getComputedStyle(e),S=pu(e,ja)||"0",D,I,V,j,Q,te,ce,Ce,Me,Ie,Te,Ge,$e,ue,pe,_e,ge,Fe,De,Se,pr,or,Vt,Ht,Kt,Tr,We,Sr,Xt,ei,Fr,gi;return D=I=V=te=ce=Ce=Me=Ie=Te=0,j=Q=1,s.svg=!!(e.getCTM&&MV(e)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(c[cs]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[cs]!=="none"?l[cs]:"")),c.scale=c.rotate=c.translate="none"),ue=XR(e,s.svg),s.svg&&(s.uncache?(Kt=e.getBBox(),S=s.xOrigin-Kt.x+"px "+(s.yOrigin-Kt.y)+"px",Ht=""):Ht=!r&&e.getAttribute("data-svg-origin"),xS(e,Ht||S,!!Ht||s.originIsAbsolute,s.smooth!==!1,ue)),Ge=s.xOrigin||0,$e=s.yOrigin||0,ue!==g1&&(Fe=ue[0],De=ue[1],Se=ue[2],pr=ue[3],D=or=ue[4],I=Vt=ue[5],ue.length===6?(j=Math.sqrt(Fe*Fe+De*De),Q=Math.sqrt(pr*pr+Se*Se),te=Fe||De?O_(De,Fe)*wp:0,Me=Se||pr?O_(Se,pr)*wp+te:0,Me&&(Q*=Math.abs(Math.cos(Me*pg))),s.svg&&(D-=Ge-(Ge*Fe+$e*Se),I-=$e-(Ge*De+$e*pr))):(gi=ue[6],ei=ue[7],We=ue[8],Sr=ue[9],Xt=ue[10],Fr=ue[11],D=ue[12],I=ue[13],V=ue[14],pe=O_(gi,Xt),ce=pe*wp,pe&&(_e=Math.cos(-pe),ge=Math.sin(-pe),Ht=or*_e+We*ge,Kt=Vt*_e+Sr*ge,Tr=gi*_e+Xt*ge,We=or*-ge+We*_e,Sr=Vt*-ge+Sr*_e,Xt=gi*-ge+Xt*_e,Fr=ei*-ge+Fr*_e,or=Ht,Vt=Kt,gi=Tr),pe=O_(-Se,Xt),Ce=pe*wp,pe&&(_e=Math.cos(-pe),ge=Math.sin(-pe),Ht=Fe*_e-We*ge,Kt=De*_e-Sr*ge,Tr=Se*_e-Xt*ge,Fr=pr*ge+Fr*_e,Fe=Ht,De=Kt,Se=Tr),pe=O_(De,Fe),te=pe*wp,pe&&(_e=Math.cos(pe),ge=Math.sin(pe),Ht=Fe*_e+De*ge,Kt=or*_e+Vt*ge,De=De*_e-Fe*ge,Vt=Vt*_e-or*ge,Fe=Ht,or=Kt),ce&&Math.abs(ce)+Math.abs(te)>359.9&&(ce=te=0,Ce=180-Ce),j=As(Math.sqrt(Fe*Fe+De*De+Se*Se)),Q=As(Math.sqrt(Vt*Vt+gi*gi)),pe=O_(or,Vt),Me=Math.abs(pe)>2e-4?pe*wp:0,Te=Fr?1/(Fr<0?-Fr:Fr):0),s.svg&&(Ht=e.getAttribute("transform"),s.forceCSS=e.setAttribute("transform","")||!DV(pu(e,cs)),Ht&&e.setAttribute("transform",Ht))),Math.abs(Me)>90&&Math.abs(Me)<270&&(d?(j*=-1,Me+=te<=0?180:-180,te+=te<=0?180:-180):(Q*=-1,Me+=Me<=0?180:-180)),r=r||s.uncache,s.x=D-((s.xPercent=D&&(!r&&s.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-D)?-50:0)))?e.offsetWidth*s.xPercent/100:0)+_,s.y=I-((s.yPercent=I&&(!r&&s.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-I)?-50:0)))?e.offsetHeight*s.yPercent/100:0)+_,s.z=V+_,s.scaleX=As(j),s.scaleY=As(Q),s.rotation=As(te)+x,s.rotationX=As(ce)+x,s.rotationY=As(Ce)+x,s.skewX=Me+x,s.skewY=Ie+x,s.transformPerspective=Te+_,(s.zOrigin=parseFloat(S.split(" ")[2])||!r&&s.zOrigin||0)&&(c[ja]=PT(S)),s.xOffset=s.yOffset=0,s.force3D=pl.force3D,s.renderTransform=s.svg?nae:RV?LV:iae,s.uncache=0,s},PT=function(e){return(e=e.split(" "))[0]+" "+e[1]},PA=function(e,r,s){var c=Xo(r);return As(parseFloat(r)+parseFloat(tf(e,"x",s+"px",c)))+c},iae=function(e,r){r.z="0px",r.rotationY=r.rotationX="0deg",r.force3D=0,LV(e,r)},yp="0deg",jy="0px",vp=") ",LV=function(e,r){var s=r||this,c=s.xPercent,d=s.yPercent,_=s.x,x=s.y,l=s.z,S=s.rotation,D=s.rotationY,I=s.rotationX,V=s.skewX,j=s.skewY,Q=s.scaleX,te=s.scaleY,ce=s.transformPerspective,Ce=s.force3D,Me=s.target,Ie=s.zOrigin,Te="",Ge=Ce==="auto"&&e&&e!==1||Ce===!0;if(Ie&&(I!==yp||D!==yp)){var $e=parseFloat(D)*pg,ue=Math.sin($e),pe=Math.cos($e),_e;$e=parseFloat(I)*pg,_e=Math.cos($e),_=PA(Me,_,ue*_e*-Ie),x=PA(Me,x,-Math.sin($e)*-Ie),l=PA(Me,l,pe*_e*-Ie+Ie)}ce!==jy&&(Te+="perspective("+ce+vp),(c||d)&&(Te+="translate("+c+"%, "+d+"%) "),(Ge||_!==jy||x!==jy||l!==jy)&&(Te+=l!==jy||Ge?"translate3d("+_+", "+x+", "+l+") ":"translate("+_+", "+x+vp),S!==yp&&(Te+="rotate("+S+vp),D!==yp&&(Te+="rotateY("+D+vp),I!==yp&&(Te+="rotateX("+I+vp),(V!==yp||j!==yp)&&(Te+="skew("+V+", "+j+vp),(Q!==1||te!==1)&&(Te+="scale("+Q+", "+te+vp),Me.style[cs]=Te||"translate(0, 0)"},nae=function(e,r){var s=r||this,c=s.xPercent,d=s.yPercent,_=s.x,x=s.y,l=s.rotation,S=s.skewX,D=s.skewY,I=s.scaleX,V=s.scaleY,j=s.target,Q=s.xOrigin,te=s.yOrigin,ce=s.xOffset,Ce=s.yOffset,Me=s.forceCSS,Ie=parseFloat(_),Te=parseFloat(x),Ge,$e,ue,pe,_e;l=parseFloat(l),S=parseFloat(S),D=parseFloat(D),D&&(D=parseFloat(D),S+=D,l+=D),l||S?(l*=pg,S*=pg,Ge=Math.cos(l)*I,$e=Math.sin(l)*I,ue=Math.sin(l-S)*-V,pe=Math.cos(l-S)*V,S&&(D*=pg,_e=Math.tan(S-D),_e=Math.sqrt(1+_e*_e),ue*=_e,pe*=_e,D&&(_e=Math.tan(D),_e=Math.sqrt(1+_e*_e),Ge*=_e,$e*=_e)),Ge=As(Ge),$e=As($e),ue=As(ue),pe=As(pe)):(Ge=I,pe=V,$e=ue=0),(Ie&&!~(_+"").indexOf("px")||Te&&!~(x+"").indexOf("px"))&&(Ie=tf(j,"x",_,"px"),Te=tf(j,"y",x,"px")),(Q||te||ce||Ce)&&(Ie=As(Ie+Q-(Q*Ge+te*ue)+ce),Te=As(Te+te-(Q*$e+te*pe)+Ce)),(c||d)&&(_e=j.getBBox(),Ie=As(Ie+c/100*_e.width),Te=As(Te+d/100*_e.height)),_e="matrix("+Ge+","+$e+","+ue+","+pe+","+Ie+","+Te+")",j.setAttribute("transform",_e),Me&&(j.style[cs]=_e)},sae=function(e,r,s,c,d){var _=360,x=mo(d),l=parseFloat(d)*(x&&~d.indexOf("rad")?wp:1),S=l-c,D=c+S+"deg",I,V;return x&&(I=d.split("_")[1],I==="short"&&(S%=_,S!==S%(_/2)&&(S+=S<0?_:-_)),I==="cw"&&S<0?S=(S+_*dO)%_-~~(S/_)*_:I==="ccw"&&S>0&&(S=(S-_*dO)%_-~~(S/_)*_)),e._pt=V=new Ua(e._pt,r,s,c,S,joe),V.e=D,V.u="deg",e._props.push(s),V},yO=function(e,r){for(var s in r)e[s]=r[s];return e},oae=function(e,r,s){var c=yO({},s._gsap),d="perspective,force3D,transformOrigin,svgOrigin",_=s.style,x,l,S,D,I,V,j,Q;c.svg?(S=s.getAttribute("transform"),s.setAttribute("transform",""),_[cs]=r,x=y1(s,1),om(s,cs),s.setAttribute("transform",S)):(S=getComputedStyle(s)[cs],_[cs]=r,x=y1(s,1),_[cs]=S);for(l in vh)S=c[l],D=x[l],S!==D&&d.indexOf(l)<0&&(j=Xo(S),Q=Xo(D),I=j!==Q?tf(s,l,S,Q):parseFloat(S),V=parseFloat(D),e._pt=new Ua(e._pt,x,l,I,V-I,gS),e._pt.u=Q||0,e._props.push(l));yO(x,c)};Va("padding,margin,Width,Radius",function(n,e){var r="Top",s="Right",c="Bottom",d="Left",_=(e<3?[r,s,c,d]:[r+d,r+s,c+s,c+d]).map(function(x){return e<2?n+x:"border"+x+n});RT[e>1?"border"+n:n]=function(x,l,S,D,I){var V,j;if(arguments.length<4)return V=_.map(function(Q){return ih(x,Q,S)}),j=V.join(" "),j.split(V[0]).length===5?V[0]:j;V=(D+"").split(" "),j={},_.forEach(function(Q,te){return j[Q]=V[te]=V[te]||V[(te-1)/2|0]}),x.init(l,j,I)}});var OV={name:"css",register:vS,targetTest:function(e){return e.style&&e.nodeType},init:function(e,r,s,c,d){var _=this._props,x=e.style,l=s.vars.startAt,S,D,I,V,j,Q,te,ce,Ce,Me,Ie,Te,Ge,$e,ue,pe;HR||vS(),this.styles=this.styles||CV(e),pe=this.styles.props,this.tween=s;for(te in r)if(te!=="autoRound"&&(D=r[te],!(cl[te]&&gV(te,r,s,c,e,d)))){if(j=typeof D,Q=RT[te],j==="function"&&(D=D.call(s,c,e,d),j=typeof D),j==="string"&&~D.indexOf("random(")&&(D=p1(D)),Q)Q(this,e,te,D,s)&&(ue=1);else if(te.substr(0,2)==="--")S=(getComputedStyle(e).getPropertyValue(te)+"").trim(),D+="",Hd.lastIndex=0,Hd.test(S)||(ce=Xo(S),Ce=Xo(D)),Ce?ce!==Ce&&(S=tf(e,te,S,Ce)+Ce):ce&&(D+=ce),this.add(x,"setProperty",S,D,c,d,0,0,te),_.push(te),pe.push(te,0,x[te]);else if(j!=="undefined"){if(l&&te in l?(S=typeof l[te]=="function"?l[te].call(s,c,e,d):l[te],mo(S)&&~S.indexOf("random(")&&(S=p1(S)),Xo(S+"")||S==="auto"||(S+=pl.units[te]||Xo(ih(e,te))||""),(S+"").charAt(1)==="="&&(S=ih(e,te))):S=ih(e,te),V=parseFloat(S),Me=j==="string"&&D.charAt(1)==="="&&D.substr(0,2),Me&&(D=D.substr(2)),I=parseFloat(D),te in su&&(te==="autoAlpha"&&(V===1&&ih(e,"visibility")==="hidden"&&I&&(V=0),pe.push("visibility",0,x.visibility),Ld(this,x,"visibility",V?"inherit":"hidden",I?"inherit":"hidden",!I)),te!=="scale"&&te!=="transform"&&(te=su[te],~te.indexOf(",")&&(te=te.split(",")[0]))),Ie=te in vh,Ie){if(this.styles.save(te),Te||(Ge=e._gsap,Ge.renderTransform&&!r.parseTransform||y1(e,r.parseTransform),$e=r.smoothOrigin!==!1&&Ge.smooth,Te=this._pt=new Ua(this._pt,x,cs,0,1,Ge.renderTransform,Ge,0,-1),Te.dep=1),te==="scale")this._pt=new Ua(this._pt,Ge,"scaleY",Ge.scaleY,(Me?dg(Ge.scaleY,Me+I):I)-Ge.scaleY||0,gS),this._pt.u=0,_.push("scaleY",te),te+="X";else if(te==="transformOrigin"){pe.push(ja,0,x[ja]),D=tae(D),Ge.svg?xS(e,D,0,$e,0,this):(Ce=parseFloat(D.split(" ")[2])||0,Ce!==Ge.zOrigin&&Ld(this,Ge,"zOrigin",Ge.zOrigin,Ce),Ld(this,x,te,PT(S),PT(D)));continue}else if(te==="svgOrigin"){xS(e,D,1,$e,0,this);continue}else if(te in kV){sae(this,Ge,te,V,Me?dg(V,Me+D):D);continue}else if(te==="smoothOrigin"){Ld(this,Ge,"smooth",Ge.smooth,D);continue}else if(te==="force3D"){Ge[te]=D;continue}else if(te==="transform"){oae(this,D,e);continue}}else te in x||(te=$g(te)||te);if(Ie||(I||I===0)&&(V||V===0)&&!Uoe.test(D)&&te in x)ce=(S+"").substr((V+"").length),I||(I=0),Ce=Xo(D)||(te in pl.units?pl.units[te]:ce),ce!==Ce&&(V=tf(e,te,S,Ce)),this._pt=new Ua(this._pt,Ie?Ge:x,te,V,(Me?dg(V,Me+I):I)-V,!Ie&&(Ce==="px"||te==="zIndex")&&r.autoRound!==!1?Goe:gS),this._pt.u=Ce||0,ce!==Ce&&Ce!=="%"&&(this._pt.b=S,this._pt.r=$oe);else if(te in x)eae.call(this,e,te,S,Me?Me+D:D);else if(te in e)this.add(e,te,S||e[te],Me?Me+D:D,c,d);else if(te!=="parseTransform"){FR(te,D);continue}Ie||(te in x?pe.push(te,0,x[te]):pe.push(te,1,S||e[te])),_.push(te)}}ue&&TV(this)},render:function(e,r){if(r.tween._time||!WR())for(var s=r._pt;s;)s.r(e,s.d),s=s._next;else r.styles.revert()},get:ih,aliases:su,getSetter:function(e,r,s){var c=su[r];return c&&c.indexOf(",")<0&&(r=c),r in vh&&r!==ja&&(e._gsap.x||ih(e,"x"))?s&&hO===s?r==="scale"?Zoe:Woe:(hO=s||{})&&(r==="scale"?Xoe:Yoe):e.style&&!LR(e.style[r])?qoe:~r.indexOf("-")?Hoe:GR(e,r)},core:{_removeProperty:om,_getMatrix:XR}};Ha.utils.checkPrefix=$g;Ha.core.getStyleSaver=CV;(function(n,e,r,s){var c=Va(n+","+e+","+r,function(d){vh[d]=1});Va(e,function(d){pl.units[d]="deg",kV[d]=1}),su[c[13]]=n+","+e,Va(s,function(d){var _=d.split(":");su[_[1]]=c[_[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Va("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(n){pl.units[n]="px"});Ha.registerPlugin(OV);var bS=Ha.registerPlugin(OV)||Ha;bS.core.Tween;function aae(n,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function lae(n,e,r){return e&&aae(n.prototype,e),n}/*!
 * Observer 3.12.5
 * https://gsap.com
 *
 * @license Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Ao,Rw,hl,Od,zd,mg,zV,Tp,Rv,FV,uh,fc,NV,BV=function(){return Ao||typeof window<"u"&&(Ao=window.gsap)&&Ao.registerPlugin&&Ao},VV=1,rg=[],Xi=[],mu=[],Pv=Date.now,wS=function(e,r){return r},cae=function(){var e=Rv.core,r=e.bridge||{},s=e._scrollers,c=e._proxies;s.push.apply(s,Xi),c.push.apply(c,mu),Xi=s,mu=c,wS=function(_,x){return r[_](x)}},Wd=function(e,r){return~mu.indexOf(e)&&mu[mu.indexOf(e)+1][r]},Mv=function(e){return!!~FV.indexOf(e)},ca=function(e,r,s,c,d){return e.addEventListener(r,s,{passive:c!==!1,capture:!!d})},aa=function(e,r,s,c){return e.removeEventListener(r,s,!!c)},Qb="scrollLeft",Kb="scrollTop",TS=function(){return uh&&uh.isPressed||Xi.cache++},MT=function(e,r){var s=function c(d){if(d||d===0){VV&&(hl.history.scrollRestoration="manual");var _=uh&&uh.isPressed;d=c.v=Math.round(d)||(uh&&uh.iOS?1:0),e(d),c.cacheID=Xi.cache,_&&wS("ss",d)}else(r||Xi.cache!==c.cacheID||wS("ref"))&&(c.cacheID=Xi.cache,c.v=e());return c.v+c.offset};return s.offset=0,e&&s},_a={s:Qb,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:MT(function(n){return arguments.length?hl.scrollTo(n,Ws.sc()):hl.pageXOffset||Od[Qb]||zd[Qb]||mg[Qb]||0})},Ws={s:Kb,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:_a,sc:MT(function(n){return arguments.length?hl.scrollTo(_a.sc(),n):hl.pageYOffset||Od[Kb]||zd[Kb]||mg[Kb]||0})},Oa=function(e,r){return(r&&r._ctx&&r._ctx.selector||Ao.utils.toArray)(e)[0]||(typeof e=="string"&&Ao.config().nullTargetWarn!==!1?console.warn("Element not found:",e):null)},rf=function(e,r){var s=r.s,c=r.sc;Mv(e)&&(e=Od.scrollingElement||zd);var d=Xi.indexOf(e),_=c===Ws.sc?1:2;!~d&&(d=Xi.push(e)-1),Xi[d+_]||ca(e,"scroll",TS);var x=Xi[d+_],l=x||(Xi[d+_]=MT(Wd(e,s),!0)||(Mv(e)?c:MT(function(S){return arguments.length?e[s]=S:e[s]})));return l.target=e,x||(l.smooth=Ao.getProperty(e,"scrollBehavior")==="smooth"),l},ES=function(e,r,s){var c=e,d=e,_=Pv(),x=_,l=r||50,S=Math.max(500,l*3),D=function(Q,te){var ce=Pv();te||ce-_>l?(d=c,c=Q,x=_,_=ce):s?c+=Q:c=d+(Q-d)/(ce-x)*(_-x)},I=function(){d=c=s?0:c,x=_=0},V=function(Q){var te=x,ce=d,Ce=Pv();return(Q||Q===0)&&Q!==c&&D(Q),_===x||Ce-x>S?0:(c+(s?ce:-ce))/((s?Ce:_)-te)*1e3};return{update:D,reset:I,getVelocity:V}},$y=function(e,r){return r&&!e._gsapAllow&&e.preventDefault(),e.changedTouches?e.changedTouches[0]:e},vO=function(e){var r=Math.max.apply(Math,e),s=Math.min.apply(Math,e);return Math.abs(r)>=Math.abs(s)?r:s},UV=function(){Rv=Ao.core.globals().ScrollTrigger,Rv&&Rv.core&&cae()},jV=function(e){return Ao=e||BV(),!Rw&&Ao&&typeof document<"u"&&document.body&&(hl=window,Od=document,zd=Od.documentElement,mg=Od.body,FV=[hl,Od,zd,mg],Ao.utils.clamp,NV=Ao.core.context||function(){},Tp="onpointerenter"in mg?"pointer":"mouse",zV=Is.isTouch=hl.matchMedia&&hl.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in hl||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,fc=Is.eventTypes=("ontouchstart"in zd?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in zd?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout(function(){return VV=0},500),UV(),Rw=1),Rw};_a.op=Ws;Xi.cache=0;var Is=function(){function n(r){this.init(r)}var e=n.prototype;return e.init=function(s){Rw||jV(Ao)||console.warn("Please gsap.registerPlugin(Observer)"),Rv||UV();var c=s.tolerance,d=s.dragMinimum,_=s.type,x=s.target,l=s.lineHeight,S=s.debounce,D=s.preventDefault,I=s.onStop,V=s.onStopDelay,j=s.ignore,Q=s.wheelSpeed,te=s.event,ce=s.onDragStart,Ce=s.onDragEnd,Me=s.onDrag,Ie=s.onPress,Te=s.onRelease,Ge=s.onRight,$e=s.onLeft,ue=s.onUp,pe=s.onDown,_e=s.onChangeX,ge=s.onChangeY,Fe=s.onChange,De=s.onToggleX,Se=s.onToggleY,pr=s.onHover,or=s.onHoverEnd,Vt=s.onMove,Ht=s.ignoreCheck,Kt=s.isNormalizer,Tr=s.onGestureStart,We=s.onGestureEnd,Sr=s.onWheel,Xt=s.onEnable,ei=s.onDisable,Fr=s.onClick,gi=s.scrollSpeed,qr=s.capture,yt=s.allowClicks,dt=s.lockAxis,jt=s.onLockAxis;this.target=x=Oa(x)||zd,this.vars=s,j&&(j=Ao.utils.toArray(j)),c=c||1e-9,d=d||0,Q=Q||1,gi=gi||1,_=_||"wheel,touch,pointer",S=S!==!1,l||(l=parseFloat(hl.getComputedStyle(mg).lineHeight)||22);var $t,Mr,Er,be,Ae,Ze,lt,Ee=this,Ft=0,ft=0,nt=s.passive||!D,Ot=rf(x,_a),Mt=rf(x,Ws),je=Ot(),re=Mt(),oe=~_.indexOf("touch")&&!~_.indexOf("pointer")&&fc[0]==="pointerdown",xe=Mv(x),Be=x.ownerDocument||Od,Ke=[0,0,0],ct=[0,0,0],zt=0,st=function(){return zt=Pv()},Ct=function(_r,Xe){return(Ee.event=_r)&&j&&~j.indexOf(_r.target)||Xe&&oe&&_r.pointerType!=="touch"||Ht&&Ht(_r,Xe)},qt=function(){Ee._vx.reset(),Ee._vy.reset(),Mr.pause(),I&&I(Ee)},Wt=function(){var _r=Ee.deltaX=vO(Ke),Xe=Ee.deltaY=vO(ct),Ve=Math.abs(_r)>=c,tt=Math.abs(Xe)>=c;Fe&&(Ve||tt)&&Fe(Ee,_r,Xe,Ke,ct),Ve&&(Ge&&Ee.deltaX>0&&Ge(Ee),$e&&Ee.deltaX<0&&$e(Ee),_e&&_e(Ee),De&&Ee.deltaX<0!=Ft<0&&De(Ee),Ft=Ee.deltaX,Ke[0]=Ke[1]=Ke[2]=0),tt&&(pe&&Ee.deltaY>0&&pe(Ee),ue&&Ee.deltaY<0&&ue(Ee),ge&&ge(Ee),Se&&Ee.deltaY<0!=ft<0&&Se(Ee),ft=Ee.deltaY,ct[0]=ct[1]=ct[2]=0),(be||Er)&&(Vt&&Vt(Ee),Er&&(Me(Ee),Er=!1),be=!1),Ze&&!(Ze=!1)&&jt&&jt(Ee),Ae&&(Sr(Ee),Ae=!1),$t=0},Nt=function(_r,Xe,Ve){Ke[Ve]+=_r,ct[Ve]+=Xe,Ee._vx.update(_r),Ee._vy.update(Xe),S?$t||($t=requestAnimationFrame(Wt)):Wt()},jr=function(_r,Xe){dt&&!lt&&(Ee.axis=lt=Math.abs(_r)>Math.abs(Xe)?"x":"y",Ze=!0),lt!=="y"&&(Ke[2]+=_r,Ee._vx.update(_r,!0)),lt!=="x"&&(ct[2]+=Xe,Ee._vy.update(Xe,!0)),S?$t||($t=requestAnimationFrame(Wt)):Wt()},Or=function(_r){if(!Ct(_r,1)){_r=$y(_r,D);var Xe=_r.clientX,Ve=_r.clientY,tt=Xe-Ee.x,ut=Ve-Ee.y,_t=Ee.isDragging;Ee.x=Xe,Ee.y=Ve,(_t||Math.abs(Ee.startX-Xe)>=d||Math.abs(Ee.startY-Ve)>=d)&&(Me&&(Er=!0),_t||(Ee.isDragging=!0),jr(tt,ut),_t||ce&&ce(Ee))}},ii=Ee.onPress=function(wr){Ct(wr,1)||wr&&wr.button||(Ee.axis=lt=null,Mr.pause(),Ee.isPressed=!0,wr=$y(wr),Ft=ft=0,Ee.startX=Ee.x=wr.clientX,Ee.startY=Ee.y=wr.clientY,Ee._vx.reset(),Ee._vy.reset(),ca(Kt?x:Be,fc[1],Or,nt,!0),Ee.deltaX=Ee.deltaY=0,Ie&&Ie(Ee))},mr=Ee.onRelease=function(wr){if(!Ct(wr,1)){aa(Kt?x:Be,fc[1],Or,!0);var _r=!isNaN(Ee.y-Ee.startY),Xe=Ee.isDragging,Ve=Xe&&(Math.abs(Ee.x-Ee.startX)>3||Math.abs(Ee.y-Ee.startY)>3),tt=$y(wr);!Ve&&_r&&(Ee._vx.reset(),Ee._vy.reset(),D&&yt&&Ao.delayedCall(.08,function(){if(Pv()-zt>300&&!wr.defaultPrevented){if(wr.target.click)wr.target.click();else if(Be.createEvent){var ut=Be.createEvent("MouseEvents");ut.initMouseEvent("click",!0,!0,hl,1,tt.screenX,tt.screenY,tt.clientX,tt.clientY,!1,!1,!1,!1,0,null),wr.target.dispatchEvent(ut)}}})),Ee.isDragging=Ee.isGesturing=Ee.isPressed=!1,I&&Xe&&!Kt&&Mr.restart(!0),Ce&&Xe&&Ce(Ee),Te&&Te(Ee,Ve)}},ni=function(_r){return _r.touches&&_r.touches.length>1&&(Ee.isGesturing=!0)&&Tr(_r,Ee.isDragging)},Kr=function(){return(Ee.isGesturing=!1)||We(Ee)},Ti=function(_r){if(!Ct(_r)){var Xe=Ot(),Ve=Mt();Nt((Xe-je)*gi,(Ve-re)*gi,1),je=Xe,re=Ve,I&&Mr.restart(!0)}},Zi=function(_r){if(!Ct(_r)){_r=$y(_r,D),Sr&&(Ae=!0);var Xe=(_r.deltaMode===1?l:_r.deltaMode===2?hl.innerHeight:1)*Q;Nt(_r.deltaX*Xe,_r.deltaY*Xe,0),I&&!Kt&&Mr.restart(!0)}},mi=function(_r){if(!Ct(_r)){var Xe=_r.clientX,Ve=_r.clientY,tt=Xe-Ee.x,ut=Ve-Ee.y;Ee.x=Xe,Ee.y=Ve,be=!0,I&&Mr.restart(!0),(tt||ut)&&jr(tt,ut)}},Ln=function(_r){Ee.event=_r,pr(Ee)},fn=function(_r){Ee.event=_r,or(Ee)},hs=function(_r){return Ct(_r)||$y(_r,D)&&Fr(Ee)};Mr=Ee._dc=Ao.delayedCall(V||.25,qt).pause(),Ee.deltaX=Ee.deltaY=0,Ee._vx=ES(0,50,!0),Ee._vy=ES(0,50,!0),Ee.scrollX=Ot,Ee.scrollY=Mt,Ee.isDragging=Ee.isGesturing=Ee.isPressed=!1,NV(this),Ee.enable=function(wr){return Ee.isEnabled||(ca(xe?Be:x,"scroll",TS),_.indexOf("scroll")>=0&&ca(xe?Be:x,"scroll",Ti,nt,qr),_.indexOf("wheel")>=0&&ca(x,"wheel",Zi,nt,qr),(_.indexOf("touch")>=0&&zV||_.indexOf("pointer")>=0)&&(ca(x,fc[0],ii,nt,qr),ca(Be,fc[2],mr),ca(Be,fc[3],mr),yt&&ca(x,"click",st,!0,!0),Fr&&ca(x,"click",hs),Tr&&ca(Be,"gesturestart",ni),We&&ca(Be,"gestureend",Kr),pr&&ca(x,Tp+"enter",Ln),or&&ca(x,Tp+"leave",fn),Vt&&ca(x,Tp+"move",mi)),Ee.isEnabled=!0,wr&&wr.type&&ii(wr),Xt&&Xt(Ee)),Ee},Ee.disable=function(){Ee.isEnabled&&(rg.filter(function(wr){return wr!==Ee&&Mv(wr.target)}).length||aa(xe?Be:x,"scroll",TS),Ee.isPressed&&(Ee._vx.reset(),Ee._vy.reset(),aa(Kt?x:Be,fc[1],Or,!0)),aa(xe?Be:x,"scroll",Ti,qr),aa(x,"wheel",Zi,qr),aa(x,fc[0],ii,qr),aa(Be,fc[2],mr),aa(Be,fc[3],mr),aa(x,"click",st,!0),aa(x,"click",hs),aa(Be,"gesturestart",ni),aa(Be,"gestureend",Kr),aa(x,Tp+"enter",Ln),aa(x,Tp+"leave",fn),aa(x,Tp+"move",mi),Ee.isEnabled=Ee.isPressed=Ee.isDragging=!1,ei&&ei(Ee))},Ee.kill=Ee.revert=function(){Ee.disable();var wr=rg.indexOf(Ee);wr>=0&&rg.splice(wr,1),uh===Ee&&(uh=0)},rg.push(Ee),Kt&&Mv(x)&&(uh=Ee),Ee.enable(te)},lae(n,[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}]),n}();Is.version="3.12.5";Is.create=function(n){return new Is(n)};Is.register=jV;Is.getAll=function(){return rg.slice()};Is.getById=function(n){return rg.filter(function(e){return e.vars.id===n})[0]};BV()&&Ao.registerPlugin(Is);/*!
 * ScrollTrigger 3.12.5
 * https://gsap.com
 *
 * @license Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Lr,H_,nn,os,mc,Wn,$V,kT,v1,kv,rv,Jb,Uo,FE,AS,da,xO,bO,W_,GV,MA,qV,ha,IS,HV,WV,bd,SS,YR,_g,QR,DT,CS,kA,ew=1,$o=Date.now,DA=$o(),jl=0,iv=0,wO=function(e,r,s){var c=ll(e)&&(e.substr(0,6)==="clamp("||e.indexOf("max")>-1);return s["_"+r+"Clamp"]=c,c?e.substr(6,e.length-7):e},TO=function(e,r){return r&&(!ll(e)||e.substr(0,6)!=="clamp(")?"clamp("+e+")":e},uae=function n(){return iv&&requestAnimationFrame(n)},EO=function(){return FE=1},AO=function(){return FE=0},Kc=function(e){return e},nv=function(e){return Math.round(e*1e5)/1e5||0},ZV=function(){return typeof window<"u"},XV=function(){return Lr||ZV()&&(Lr=window.gsap)&&Lr.registerPlugin&&Lr},am=function(e){return!!~$V.indexOf(e)},YV=function(e){return(e==="Height"?QR:nn["inner"+e])||mc["client"+e]||Wn["client"+e]},QV=function(e){return Wd(e,"getBoundingClientRect")||(am(e)?function(){return Lw.width=nn.innerWidth,Lw.height=QR,Lw}:function(){return sh(e)})},hae=function(e,r,s){var c=s.d,d=s.d2,_=s.a;return(_=Wd(e,"getBoundingClientRect"))?function(){return _()[c]}:function(){return(r?YV(d):e["client"+d])||0}},dae=function(e,r){return!r||~mu.indexOf(e)?QV(e):function(){return Lw}},ou=function(e,r){var s=r.s,c=r.d2,d=r.d,_=r.a;return Math.max(0,(s="scroll"+c)&&(_=Wd(e,s))?_()-QV(e)()[d]:am(e)?(mc[s]||Wn[s])-YV(c):e[s]-e["offset"+c])},tw=function(e,r){for(var s=0;s<W_.length;s+=3)(!r||~r.indexOf(W_[s+1]))&&e(W_[s],W_[s+1],W_[s+2])},ll=function(e){return typeof e=="string"},ga=function(e){return typeof e=="function"},sv=function(e){return typeof e=="number"},Ep=function(e){return typeof e=="object"},Gy=function(e,r,s){return e&&e.progress(r?0:1)&&s&&e.pause()},LA=function(e,r){if(e.enabled){var s=e._ctx?e._ctx.add(function(){return r(e)}):r(e);s&&s.totalTime&&(e.callbackAnimation=s)}},z_=Math.abs,KV="left",JV="top",KR="right",JR="bottom",jp="width",$p="height",Dv="Right",Lv="Left",Ov="Top",zv="Bottom",Ds="padding",Dl="margin",Gg="Width",e6="Height",Hs="px",Ll=function(e){return nn.getComputedStyle(e)},fae=function(e){var r=Ll(e).position;e.style.position=r==="absolute"||r==="fixed"?r:"relative"},IO=function(e,r){for(var s in r)s in e||(e[s]=r[s]);return e},sh=function(e,r){var s=r&&Ll(e)[AS]!=="matrix(1, 0, 0, 1, 0, 0)"&&Lr.to(e,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),c=e.getBoundingClientRect();return s&&s.progress(0).kill(),c},LT=function(e,r){var s=r.d2;return e["offset"+s]||e["client"+s]||0},eU=function(e){var r=[],s=e.labels,c=e.duration(),d;for(d in s)r.push(s[d]/c);return r},pae=function(e){return function(r){return Lr.utils.snap(eU(e),r)}},t6=function(e){var r=Lr.utils.snap(e),s=Array.isArray(e)&&e.slice(0).sort(function(c,d){return c-d});return s?function(c,d,_){_===void 0&&(_=.001);var x;if(!d)return r(c);if(d>0){for(c-=_,x=0;x<s.length;x++)if(s[x]>=c)return s[x];return s[x-1]}else for(x=s.length,c+=_;x--;)if(s[x]<=c)return s[x];return s[0]}:function(c,d,_){_===void 0&&(_=.001);var x=r(c);return!d||Math.abs(x-c)<_||x-c<0==d<0?x:r(d<0?c-e:c+e)}},mae=function(e){return function(r,s){return t6(eU(e))(r,s.direction)}},rw=function(e,r,s,c){return s.split(",").forEach(function(d){return e(r,d,c)})},oo=function(e,r,s,c,d){return e.addEventListener(r,s,{passive:!c,capture:!!d})},so=function(e,r,s,c){return e.removeEventListener(r,s,!!c)},iw=function(e,r,s){s=s&&s.wheelHandler,s&&(e(r,"wheel",s),e(r,"touchmove",s))},SO={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},nw={toggleActions:"play",anticipatePin:0},OT={top:0,left:0,center:.5,bottom:1,right:1},Pw=function(e,r){if(ll(e)){var s=e.indexOf("="),c=~s?+(e.charAt(s-1)+1)*parseFloat(e.substr(s+1)):0;~s&&(e.indexOf("%")>s&&(c*=r/100),e=e.substr(0,s-1)),e=c+(e in OT?OT[e]*r:~e.indexOf("%")?parseFloat(e)*r/100:parseFloat(e)||0)}return e},sw=function(e,r,s,c,d,_,x,l){var S=d.startColor,D=d.endColor,I=d.fontSize,V=d.indent,j=d.fontWeight,Q=os.createElement("div"),te=am(s)||Wd(s,"pinType")==="fixed",ce=e.indexOf("scroller")!==-1,Ce=te?Wn:s,Me=e.indexOf("start")!==-1,Ie=Me?S:D,Te="border-color:"+Ie+";font-size:"+I+";color:"+Ie+";font-weight:"+j+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return Te+="position:"+((ce||l)&&te?"fixed;":"absolute;"),(ce||l||!te)&&(Te+=(c===Ws?KR:JR)+":"+(_+parseFloat(V))+"px;"),x&&(Te+="box-sizing:border-box;text-align:left;width:"+x.offsetWidth+"px;"),Q._isStart=Me,Q.setAttribute("class","gsap-marker-"+e+(r?" marker-"+r:"")),Q.style.cssText=Te,Q.innerText=r||r===0?e+"-"+r:e,Ce.children[0]?Ce.insertBefore(Q,Ce.children[0]):Ce.appendChild(Q),Q._offset=Q["offset"+c.op.d2],Mw(Q,0,c,Me),Q},Mw=function(e,r,s,c){var d={display:"block"},_=s[c?"os2":"p2"],x=s[c?"p2":"os2"];e._isFlipped=c,d[s.a+"Percent"]=c?-100:0,d[s.a]=c?"1px":0,d["border"+_+Gg]=1,d["border"+x+Gg]=0,d[s.p]=r+"px",Lr.set(e,d)},qi=[],RS={},x1,CO=function(){return $o()-jl>34&&(x1||(x1=requestAnimationFrame(ph)))},F_=function(){(!ha||!ha.isPressed||ha.startX>Wn.clientWidth)&&(Xi.cache++,ha?x1||(x1=requestAnimationFrame(ph)):ph(),jl||cm("scrollStart"),jl=$o())},OA=function(){WV=nn.innerWidth,HV=nn.innerHeight},ov=function(){Xi.cache++,!Uo&&!qV&&!os.fullscreenElement&&!os.webkitFullscreenElement&&(!IS||WV!==nn.innerWidth||Math.abs(nn.innerHeight-HV)>nn.innerHeight*.25)&&kT.restart(!0)},lm={},_ae=[],tU=function n(){return so(tn,"scrollEnd",n)||kp(!0)},cm=function(e){return lm[e]&&lm[e].map(function(r){return r()})||_ae},ol=[],rU=function(e){for(var r=0;r<ol.length;r+=5)(!e||ol[r+4]&&ol[r+4].query===e)&&(ol[r].style.cssText=ol[r+1],ol[r].getBBox&&ol[r].setAttribute("transform",ol[r+2]||""),ol[r+3].uncache=1)},r6=function(e,r){var s;for(da=0;da<qi.length;da++)s=qi[da],s&&(!r||s._ctx===r)&&(e?s.kill(1):s.revert(!0,!0));DT=!0,r&&rU(r),r||cm("revert")},iU=function(e,r){Xi.cache++,(r||!fa)&&Xi.forEach(function(s){return ga(s)&&s.cacheID++&&(s.rec=0)}),ll(e)&&(nn.history.scrollRestoration=YR=e)},fa,Gp=0,RO,gae=function(){if(RO!==Gp){var e=RO=Gp;requestAnimationFrame(function(){return e===Gp&&kp(!0)})}},nU=function(){Wn.appendChild(_g),QR=!ha&&_g.offsetHeight||nn.innerHeight,Wn.removeChild(_g)},PO=function(e){return v1(".gsap-marker-start, .gsap-marker-end, .gsap-marker-scroller-start, .gsap-marker-scroller-end").forEach(function(r){return r.style.display=e?"none":"block"})},kp=function(e,r){if(jl&&!e&&!DT){oo(tn,"scrollEnd",tU);return}nU(),fa=tn.isRefreshing=!0,Xi.forEach(function(c){return ga(c)&&++c.cacheID&&(c.rec=c())});var s=cm("refreshInit");GV&&tn.sort(),r||r6(),Xi.forEach(function(c){ga(c)&&(c.smooth&&(c.target.style.scrollBehavior="auto"),c(0))}),qi.slice(0).forEach(function(c){return c.refresh()}),DT=!1,qi.forEach(function(c){if(c._subPinOffset&&c.pin){var d=c.vars.horizontal?"offsetWidth":"offsetHeight",_=c.pin[d];c.revert(!0,1),c.adjustPinSpacing(c.pin[d]-_),c.refresh()}}),CS=1,PO(!0),qi.forEach(function(c){var d=ou(c.scroller,c._dir),_=c.vars.end==="max"||c._endClamp&&c.end>d,x=c._startClamp&&c.start>=d;(_||x)&&c.setPositions(x?d-1:c.start,_?Math.max(x?d:c.start+1,d):c.end,!0)}),PO(!1),CS=0,s.forEach(function(c){return c&&c.render&&c.render(-1)}),Xi.forEach(function(c){ga(c)&&(c.smooth&&requestAnimationFrame(function(){return c.target.style.scrollBehavior="smooth"}),c.rec&&c(c.rec))}),iU(YR,1),kT.pause(),Gp++,fa=2,ph(2),qi.forEach(function(c){return ga(c.vars.onRefresh)&&c.vars.onRefresh(c)}),fa=tn.isRefreshing=!1,cm("refresh")},PS=0,kw=1,Fv,ph=function(e){if(e===2||!fa&&!DT){tn.isUpdating=!0,Fv&&Fv.update(0);var r=qi.length,s=$o(),c=s-DA>=50,d=r&&qi[0].scroll();if(kw=PS>d?-1:1,fa||(PS=d),c&&(jl&&!FE&&s-jl>200&&(jl=0,cm("scrollEnd")),rv=DA,DA=s),kw<0){for(da=r;da-- >0;)qi[da]&&qi[da].update(0,c);kw=1}else for(da=0;da<r;da++)qi[da]&&qi[da].update(0,c);tn.isUpdating=!1}x1=0},MS=[KV,JV,JR,KR,Dl+zv,Dl+Dv,Dl+Ov,Dl+Lv,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],Dw=MS.concat([jp,$p,"boxSizing","max"+Gg,"max"+e6,"position",Dl,Ds,Ds+Ov,Ds+Dv,Ds+zv,Ds+Lv]),yae=function(e,r,s){gg(s);var c=e._gsap;if(c.spacerIsNative)gg(c.spacerState);else if(e._gsap.swappedIn){var d=r.parentNode;d&&(d.insertBefore(e,r),d.removeChild(r))}e._gsap.swappedIn=!1},zA=function(e,r,s,c){if(!e._gsap.swappedIn){for(var d=MS.length,_=r.style,x=e.style,l;d--;)l=MS[d],_[l]=s[l];_.position=s.position==="absolute"?"absolute":"relative",s.display==="inline"&&(_.display="inline-block"),x[JR]=x[KR]="auto",_.flexBasis=s.flexBasis||"auto",_.overflow="visible",_.boxSizing="border-box",_[jp]=LT(e,_a)+Hs,_[$p]=LT(e,Ws)+Hs,_[Ds]=x[Dl]=x[JV]=x[KV]="0",gg(c),x[jp]=x["max"+Gg]=s[jp],x[$p]=x["max"+e6]=s[$p],x[Ds]=s[Ds],e.parentNode!==r&&(e.parentNode.insertBefore(r,e),r.appendChild(e)),e._gsap.swappedIn=!0}},vae=/([A-Z])/g,gg=function(e){if(e){var r=e.t.style,s=e.length,c=0,d,_;for((e.t._gsap||Lr.core.getCache(e.t)).uncache=1;c<s;c+=2)_=e[c+1],d=e[c],_?r[d]=_:r[d]&&r.removeProperty(d.replace(vae,"-$1").toLowerCase())}},ow=function(e){for(var r=Dw.length,s=e.style,c=[],d=0;d<r;d++)c.push(Dw[d],s[Dw[d]]);return c.t=e,c},xae=function(e,r,s){for(var c=[],d=e.length,_=s?8:0,x;_<d;_+=2)x=e[_],c.push(x,x in r?r[x]:e[_+1]);return c.t=e.t,c},Lw={left:0,top:0},MO=function(e,r,s,c,d,_,x,l,S,D,I,V,j,Q){ga(e)&&(e=e(l)),ll(e)&&e.substr(0,3)==="max"&&(e=V+(e.charAt(4)==="="?Pw("0"+e.substr(3),s):0));var te=j?j.time():0,ce,Ce,Me;if(j&&j.seek(0),isNaN(e)||(e=+e),sv(e))j&&(e=Lr.utils.mapRange(j.scrollTrigger.start,j.scrollTrigger.end,0,V,e)),x&&Mw(x,s,c,!0);else{ga(r)&&(r=r(l));var Ie=(e||"0").split(" "),Te,Ge,$e,ue;Me=Oa(r,l)||Wn,Te=sh(Me)||{},(!Te||!Te.left&&!Te.top)&&Ll(Me).display==="none"&&(ue=Me.style.display,Me.style.display="block",Te=sh(Me),ue?Me.style.display=ue:Me.style.removeProperty("display")),Ge=Pw(Ie[0],Te[c.d]),$e=Pw(Ie[1]||"0",s),e=Te[c.p]-S[c.p]-D+Ge+d-$e,x&&Mw(x,$e,c,s-$e<20||x._isStart&&$e>20),s-=s-$e}if(Q&&(l[Q]=e||-.001,e<0&&(e=0)),_){var pe=e+s,_e=_._isStart;ce="scroll"+c.d2,Mw(_,pe,c,_e&&pe>20||!_e&&(I?Math.max(Wn[ce],mc[ce]):_.parentNode[ce])<=pe+1),I&&(S=sh(x),I&&(_.style[c.op.p]=S[c.op.p]-c.op.m-_._offset+Hs))}return j&&Me&&(ce=sh(Me),j.seek(V),Ce=sh(Me),j._caScrollDist=ce[c.p]-Ce[c.p],e=e/j._caScrollDist*V),j&&j.seek(te),j?e:Math.round(e)},bae=/(webkit|moz|length|cssText|inset)/i,kO=function(e,r,s,c){if(e.parentNode!==r){var d=e.style,_,x;if(r===Wn){e._stOrig=d.cssText,x=Ll(e);for(_ in x)!+_&&!bae.test(_)&&x[_]&&typeof d[_]=="string"&&_!=="0"&&(d[_]=x[_]);d.top=s,d.left=c}else d.cssText=e._stOrig;Lr.core.getCache(e).uncache=1,r.appendChild(e)}},sU=function(e,r,s){var c=r,d=c;return function(_){var x=Math.round(e());return x!==c&&x!==d&&Math.abs(x-c)>3&&Math.abs(x-d)>3&&(_=x,s&&s()),d=c,c=_,_}},aw=function(e,r,s){var c={};c[r.p]="+="+s,Lr.set(e,c)},DO=function(e,r){var s=rf(e,r),c="_scroll"+r.p2,d=function _(x,l,S,D,I){var V=_.tween,j=l.onComplete,Q={};S=S||s();var te=sU(s,S,function(){V.kill(),_.tween=0});return I=D&&I||0,D=D||x-S,V&&V.kill(),l[c]=x,l.inherit=!1,l.modifiers=Q,Q[c]=function(){return te(S+D*V.ratio+I*V.ratio*V.ratio)},l.onUpdate=function(){Xi.cache++,_.tween&&ph()},l.onComplete=function(){_.tween=0,j&&j.call(V)},V=_.tween=Lr.to(e,l),V};return e[c]=s,s.wheelHandler=function(){return d.tween&&d.tween.kill()&&(d.tween=0)},oo(e,"wheel",s.wheelHandler),tn.isTouch&&oo(e,"touchmove",s.wheelHandler),d},tn=function(){function n(r,s){H_||n.register(Lr)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),SS(this),this.init(r,s)}var e=n.prototype;return e.init=function(s,c){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),!iv){this.update=this.refresh=this.kill=Kc;return}s=IO(ll(s)||sv(s)||s.nodeType?{trigger:s}:s,nw);var d=s,_=d.onUpdate,x=d.toggleClass,l=d.id,S=d.onToggle,D=d.onRefresh,I=d.scrub,V=d.trigger,j=d.pin,Q=d.pinSpacing,te=d.invalidateOnRefresh,ce=d.anticipatePin,Ce=d.onScrubComplete,Me=d.onSnapComplete,Ie=d.once,Te=d.snap,Ge=d.pinReparent,$e=d.pinSpacer,ue=d.containerAnimation,pe=d.fastScrollEnd,_e=d.preventOverlaps,ge=s.horizontal||s.containerAnimation&&s.horizontal!==!1?_a:Ws,Fe=!I&&I!==0,De=Oa(s.scroller||nn),Se=Lr.core.getCache(De),pr=am(De),or=("pinType"in s?s.pinType:Wd(De,"pinType")||pr&&"fixed")==="fixed",Vt=[s.onEnter,s.onLeave,s.onEnterBack,s.onLeaveBack],Ht=Fe&&s.toggleActions.split(" "),Kt="markers"in s?s.markers:nw.markers,Tr=pr?0:parseFloat(Ll(De)["border"+ge.p2+Gg])||0,We=this,Sr=s.onRefreshInit&&function(){return s.onRefreshInit(We)},Xt=hae(De,pr,ge),ei=dae(De,pr),Fr=0,gi=0,qr=0,yt=rf(De,ge),dt,jt,$t,Mr,Er,be,Ae,Ze,lt,Ee,Ft,ft,nt,Ot,Mt,je,re,oe,xe,Be,Ke,ct,zt,st,Ct,qt,Wt,Nt,jr,Or,ii,mr,ni,Kr,Ti,Zi,mi,Ln,fn;if(We._startClamp=We._endClamp=!1,We._dir=ge,ce*=45,We.scroller=De,We.scroll=ue?ue.time.bind(ue):yt,Mr=yt(),We.vars=s,c=c||s.animation,"refreshPriority"in s&&(GV=1,s.refreshPriority===-9999&&(Fv=We)),Se.tweenScroll=Se.tweenScroll||{top:DO(De,Ws),left:DO(De,_a)},We.tweenTo=dt=Se.tweenScroll[ge.p],We.scrubDuration=function(Ve){ni=sv(Ve)&&Ve,ni?mr?mr.duration(Ve):mr=Lr.to(c,{ease:"expo",totalProgress:"+=0",inherit:!1,duration:ni,paused:!0,onComplete:function(){return Ce&&Ce(We)}}):(mr&&mr.progress(1).kill(),mr=0)},c&&(c.vars.lazy=!1,c._initted&&!We.isReverted||c.vars.immediateRender!==!1&&s.immediateRender!==!1&&c.duration()&&c.render(0,!0,!0),We.animation=c.pause(),c.scrollTrigger=We,We.scrubDuration(I),Or=0,l||(l=c.vars.id)),Te&&((!Ep(Te)||Te.push)&&(Te={snapTo:Te}),"scrollBehavior"in Wn.style&&Lr.set(pr?[Wn,mc]:De,{scrollBehavior:"auto"}),Xi.forEach(function(Ve){return ga(Ve)&&Ve.target===(pr?os.scrollingElement||mc:De)&&(Ve.smooth=!1)}),$t=ga(Te.snapTo)?Te.snapTo:Te.snapTo==="labels"?pae(c):Te.snapTo==="labelsDirectional"?mae(c):Te.directional!==!1?function(Ve,tt){return t6(Te.snapTo)(Ve,$o()-gi<500?0:tt.direction)}:Lr.utils.snap(Te.snapTo),Kr=Te.duration||{min:.1,max:2},Kr=Ep(Kr)?kv(Kr.min,Kr.max):kv(Kr,Kr),Ti=Lr.delayedCall(Te.delay||ni/2||.1,function(){var Ve=yt(),tt=$o()-gi<500,ut=dt.tween;if((tt||Math.abs(We.getVelocity())<10)&&!ut&&!FE&&Fr!==Ve){var _t=(Ve-be)/Ot,Lt=c&&!Fe?c.totalProgress():_t,bt=tt?0:(Lt-ii)/($o()-rv)*1e3||0,Rt=Lr.utils.clamp(-_t,1-_t,z_(bt/2)*bt/.185),Bt=_t+(Te.inertia===!1?0:Rt),It,ar,gr=Te,Yt=gr.onStart,Ir=gr.onInterrupt,Ei=gr.onComplete;if(It=$t(Bt,We),sv(It)||(It=Bt),ar=Math.round(be+It*Ot),Ve<=Ae&&Ve>=be&&ar!==Ve){if(ut&&!ut._initted&&ut.data<=z_(ar-Ve))return;Te.inertia===!1&&(Rt=It-_t),dt(ar,{duration:Kr(z_(Math.max(z_(Bt-Lt),z_(It-Lt))*.185/bt/.05||0)),ease:Te.ease||"power3",data:z_(ar-Ve),onInterrupt:function(){return Ti.restart(!0)&&Ir&&Ir(We)},onComplete:function(){We.update(),Fr=yt(),c&&(mr?mr.resetTo("totalProgress",It,c._tTime/c._tDur):c.progress(It)),Or=ii=c&&!Fe?c.totalProgress():We.progress,Me&&Me(We),Ei&&Ei(We)}},Ve,Rt*Ot,ar-Ve-Rt*Ot),Yt&&Yt(We,dt.tween)}}else We.isActive&&Fr!==Ve&&Ti.restart(!0)}).pause()),l&&(RS[l]=We),V=We.trigger=Oa(V||j!==!0&&j),fn=V&&V._gsap&&V._gsap.stRevert,fn&&(fn=fn(We)),j=j===!0?V:Oa(j),ll(x)&&(x={targets:V,className:x}),j&&(Q===!1||Q===Dl||(Q=!Q&&j.parentNode&&j.parentNode.style&&Ll(j.parentNode).display==="flex"?!1:Ds),We.pin=j,jt=Lr.core.getCache(j),jt.spacer?Mt=jt.pinState:($e&&($e=Oa($e),$e&&!$e.nodeType&&($e=$e.current||$e.nativeElement),jt.spacerIsNative=!!$e,$e&&(jt.spacerState=ow($e))),jt.spacer=oe=$e||os.createElement("div"),oe.classList.add("pin-spacer"),l&&oe.classList.add("pin-spacer-"+l),jt.pinState=Mt=ow(j)),s.force3D!==!1&&Lr.set(j,{force3D:!0}),We.spacer=oe=jt.spacer,jr=Ll(j),st=jr[Q+ge.os2],Be=Lr.getProperty(j),Ke=Lr.quickSetter(j,ge.a,Hs),zA(j,oe,jr),re=ow(j)),Kt){ft=Ep(Kt)?IO(Kt,SO):SO,Ee=sw("scroller-start",l,De,ge,ft,0),Ft=sw("scroller-end",l,De,ge,ft,0,Ee),xe=Ee["offset"+ge.op.d2];var hs=Oa(Wd(De,"content")||De);Ze=this.markerStart=sw("start",l,hs,ge,ft,xe,0,ue),lt=this.markerEnd=sw("end",l,hs,ge,ft,xe,0,ue),ue&&(Ln=Lr.quickSetter([Ze,lt],ge.a,Hs)),!or&&!(mu.length&&Wd(De,"fixedMarkers")===!0)&&(fae(pr?Wn:De),Lr.set([Ee,Ft],{force3D:!0}),qt=Lr.quickSetter(Ee,ge.a,Hs),Nt=Lr.quickSetter(Ft,ge.a,Hs))}if(ue){var wr=ue.vars.onUpdate,_r=ue.vars.onUpdateParams;ue.eventCallback("onUpdate",function(){We.update(0,0,1),wr&&wr.apply(ue,_r||[])})}if(We.previous=function(){return qi[qi.indexOf(We)-1]},We.next=function(){return qi[qi.indexOf(We)+1]},We.revert=function(Ve,tt){if(!tt)return We.kill(!0);var ut=Ve!==!1||!We.enabled,_t=Uo;ut!==We.isReverted&&(ut&&(Zi=Math.max(yt(),We.scroll.rec||0),qr=We.progress,mi=c&&c.progress()),Ze&&[Ze,lt,Ee,Ft].forEach(function(Lt){return Lt.style.display=ut?"none":"block"}),ut&&(Uo=We,We.update(ut)),j&&(!Ge||!We.isActive)&&(ut?yae(j,oe,Mt):zA(j,oe,Ll(j),Ct)),ut||We.update(ut),Uo=_t,We.isReverted=ut)},We.refresh=function(Ve,tt,ut,_t){if(!((Uo||!We.enabled)&&!tt)){if(j&&Ve&&jl){oo(n,"scrollEnd",tU);return}!fa&&Sr&&Sr(We),Uo=We,dt.tween&&!ut&&(dt.tween.kill(),dt.tween=0),mr&&mr.pause(),te&&c&&c.revert({kill:!1}).invalidate(),We.isReverted||We.revert(!0,!0),We._subPinOffset=!1;var Lt=Xt(),bt=ei(),Rt=ue?ue.duration():ou(De,ge),Bt=Ot<=.01,It=0,ar=_t||0,gr=Ep(ut)?ut.end:s.end,Yt=s.endTrigger||V,Ir=Ep(ut)?ut.start:s.start||(s.start===0||!V?0:j?"0 0":"0 100%"),Ei=We.pinnedContainer=s.pinnedContainer&&Oa(s.pinnedContainer,We),_i=V&&Math.max(0,qi.indexOf(We))||0,yi=_i,fi,kr,Bn,Ss,Fi,_n,ds,On,wa,Vr,Js,Vn,Fs;for(Kt&&Ep(ut)&&(Vn=Lr.getProperty(Ee,ge.p),Fs=Lr.getProperty(Ft,ge.p));yi--;)_n=qi[yi],_n.end||_n.refresh(0,1)||(Uo=We),ds=_n.pin,ds&&(ds===V||ds===j||ds===Ei)&&!_n.isReverted&&(Vr||(Vr=[]),Vr.unshift(_n),_n.revert(!0,!0)),_n!==qi[yi]&&(_i--,yi--);for(ga(Ir)&&(Ir=Ir(We)),Ir=wO(Ir,"start",We),be=MO(Ir,V,Lt,ge,yt(),Ze,Ee,We,bt,Tr,or,Rt,ue,We._startClamp&&"_startClamp")||(j?-.001:0),ga(gr)&&(gr=gr(We)),ll(gr)&&!gr.indexOf("+=")&&(~gr.indexOf(" ")?gr=(ll(Ir)?Ir.split(" ")[0]:"")+gr:(It=Pw(gr.substr(2),Lt),gr=ll(Ir)?Ir:(ue?Lr.utils.mapRange(0,ue.duration(),ue.scrollTrigger.start,ue.scrollTrigger.end,be):be)+It,Yt=V)),gr=wO(gr,"end",We),Ae=Math.max(be,MO(gr||(Yt?"100% 0":Rt),Yt,Lt,ge,yt()+It,lt,Ft,We,bt,Tr,or,Rt,ue,We._endClamp&&"_endClamp"))||-.001,It=0,yi=_i;yi--;)_n=qi[yi],ds=_n.pin,ds&&_n.start-_n._pinPush<=be&&!ue&&_n.end>0&&(fi=_n.end-(We._startClamp?Math.max(0,_n.start):_n.start),(ds===V&&_n.start-_n._pinPush<be||ds===Ei)&&isNaN(Ir)&&(It+=fi*(1-_n.progress)),ds===j&&(ar+=fi));if(be+=It,Ae+=It,We._startClamp&&(We._startClamp+=It),We._endClamp&&!fa&&(We._endClamp=Ae||-.001,Ae=Math.min(Ae,ou(De,ge))),Ot=Ae-be||(be-=.01)&&.001,Bt&&(qr=Lr.utils.clamp(0,1,Lr.utils.normalize(be,Ae,Zi))),We._pinPush=ar,Ze&&It&&(fi={},fi[ge.a]="+="+It,Ei&&(fi[ge.p]="-="+yt()),Lr.set([Ze,lt],fi)),j&&!(CS&&We.end>=ou(De,ge)))fi=Ll(j),Ss=ge===Ws,Bn=yt(),ct=parseFloat(Be(ge.a))+ar,!Rt&&Ae>1&&(Js=(pr?os.scrollingElement||mc:De).style,Js={style:Js,value:Js["overflow"+ge.a.toUpperCase()]},pr&&Ll(Wn)["overflow"+ge.a.toUpperCase()]!=="scroll"&&(Js.style["overflow"+ge.a.toUpperCase()]="scroll")),zA(j,oe,fi),re=ow(j),kr=sh(j,!0),On=or&&rf(De,Ss?_a:Ws)(),Q?(Ct=[Q+ge.os2,Ot+ar+Hs],Ct.t=oe,yi=Q===Ds?LT(j,ge)+Ot+ar:0,yi&&(Ct.push(ge.d,yi+Hs),oe.style.flexBasis!=="auto"&&(oe.style.flexBasis=yi+Hs)),gg(Ct),Ei&&qi.forEach(function(Wa){Wa.pin===Ei&&Wa.vars.pinSpacing!==!1&&(Wa._subPinOffset=!0)}),or&&yt(Zi)):(yi=LT(j,ge),yi&&oe.style.flexBasis!=="auto"&&(oe.style.flexBasis=yi+Hs)),or&&(Fi={top:kr.top+(Ss?Bn-be:On)+Hs,left:kr.left+(Ss?On:Bn-be)+Hs,boxSizing:"border-box",position:"fixed"},Fi[jp]=Fi["max"+Gg]=Math.ceil(kr.width)+Hs,Fi[$p]=Fi["max"+e6]=Math.ceil(kr.height)+Hs,Fi[Dl]=Fi[Dl+Ov]=Fi[Dl+Dv]=Fi[Dl+zv]=Fi[Dl+Lv]="0",Fi[Ds]=fi[Ds],Fi[Ds+Ov]=fi[Ds+Ov],Fi[Ds+Dv]=fi[Ds+Dv],Fi[Ds+zv]=fi[Ds+zv],Fi[Ds+Lv]=fi[Ds+Lv],je=xae(Mt,Fi,Ge),fa&&yt(0)),c?(wa=c._initted,MA(1),c.render(c.duration(),!0,!0),zt=Be(ge.a)-ct+Ot+ar,Wt=Math.abs(Ot-zt)>1,or&&Wt&&je.splice(je.length-2,2),c.render(0,!0,!0),wa||c.invalidate(!0),c.parent||c.totalTime(c.totalTime()),MA(0)):zt=Ot,Js&&(Js.value?Js.style["overflow"+ge.a.toUpperCase()]=Js.value:Js.style.removeProperty("overflow-"+ge.a));else if(V&&yt()&&!ue)for(kr=V.parentNode;kr&&kr!==Wn;)kr._pinOffset&&(be-=kr._pinOffset,Ae-=kr._pinOffset),kr=kr.parentNode;Vr&&Vr.forEach(function(Wa){return Wa.revert(!1,!0)}),We.start=be,We.end=Ae,Mr=Er=fa?Zi:yt(),!ue&&!fa&&(Mr<Zi&&yt(Zi),We.scroll.rec=0),We.revert(!1,!0),gi=$o(),Ti&&(Fr=-1,Ti.restart(!0)),Uo=0,c&&Fe&&(c._initted||mi)&&c.progress()!==mi&&c.progress(mi||0,!0).render(c.time(),!0,!0),(Bt||qr!==We.progress||ue||te)&&(c&&!Fe&&c.totalProgress(ue&&be<-.001&&!qr?Lr.utils.normalize(be,Ae,0):qr,!0),We.progress=Bt||(Mr-be)/Ot===qr?0:qr),j&&Q&&(oe._pinOffset=Math.round(We.progress*zt)),mr&&mr.invalidate(),isNaN(Vn)||(Vn-=Lr.getProperty(Ee,ge.p),Fs-=Lr.getProperty(Ft,ge.p),aw(Ee,ge,Vn),aw(Ze,ge,Vn-(_t||0)),aw(Ft,ge,Fs),aw(lt,ge,Fs-(_t||0))),Bt&&!fa&&We.update(),D&&!fa&&!nt&&(nt=!0,D(We),nt=!1)}},We.getVelocity=function(){return(yt()-Er)/($o()-rv)*1e3||0},We.endAnimation=function(){Gy(We.callbackAnimation),c&&(mr?mr.progress(1):c.paused()?Fe||Gy(c,We.direction<0,1):Gy(c,c.reversed()))},We.labelToScroll=function(Ve){return c&&c.labels&&(be||We.refresh()||be)+c.labels[Ve]/c.duration()*Ot||0},We.getTrailing=function(Ve){var tt=qi.indexOf(We),ut=We.direction>0?qi.slice(0,tt).reverse():qi.slice(tt+1);return(ll(Ve)?ut.filter(function(_t){return _t.vars.preventOverlaps===Ve}):ut).filter(function(_t){return We.direction>0?_t.end<=be:_t.start>=Ae})},We.update=function(Ve,tt,ut){if(!(ue&&!ut&&!Ve)){var _t=fa===!0?Zi:We.scroll(),Lt=Ve?0:(_t-be)/Ot,bt=Lt<0?0:Lt>1?1:Lt||0,Rt=We.progress,Bt,It,ar,gr,Yt,Ir,Ei,_i;if(tt&&(Er=Mr,Mr=ue?yt():_t,Te&&(ii=Or,Or=c&&!Fe?c.totalProgress():bt)),ce&&j&&!Uo&&!ew&&jl&&(!bt&&be<_t+(_t-Er)/($o()-rv)*ce?bt=1e-4:bt===1&&Ae>_t+(_t-Er)/($o()-rv)*ce&&(bt=.9999)),bt!==Rt&&We.enabled){if(Bt=We.isActive=!!bt&&bt<1,It=!!Rt&&Rt<1,Ir=Bt!==It,Yt=Ir||!!bt!=!!Rt,We.direction=bt>Rt?1:-1,We.progress=bt,Yt&&!Uo&&(ar=bt&&!Rt?0:bt===1?1:Rt===1?2:3,Fe&&(gr=!Ir&&Ht[ar+1]!=="none"&&Ht[ar+1]||Ht[ar],_i=c&&(gr==="complete"||gr==="reset"||gr in c))),_e&&(Ir||_i)&&(_i||I||!c)&&(ga(_e)?_e(We):We.getTrailing(_e).forEach(function(Bn){return Bn.endAnimation()})),Fe||(mr&&!Uo&&!ew?(mr._dp._time-mr._start!==mr._time&&mr.render(mr._dp._time-mr._start),mr.resetTo?mr.resetTo("totalProgress",bt,c._tTime/c._tDur):(mr.vars.totalProgress=bt,mr.invalidate().restart())):c&&c.totalProgress(bt,!!(Uo&&(gi||Ve)))),j){if(Ve&&Q&&(oe.style[Q+ge.os2]=st),!or)Ke(nv(ct+zt*bt));else if(Yt){if(Ei=!Ve&&bt>Rt&&Ae+1>_t&&_t+1>=ou(De,ge),Ge)if(!Ve&&(Bt||Ei)){var yi=sh(j,!0),fi=_t-be;kO(j,Wn,yi.top+(ge===Ws?fi:0)+Hs,yi.left+(ge===Ws?0:fi)+Hs)}else kO(j,oe);gg(Bt||Ei?je:re),Wt&&bt<1&&Bt||Ke(ct+(bt===1&&!Ei?zt:0))}}Te&&!dt.tween&&!Uo&&!ew&&Ti.restart(!0),x&&(Ir||Ie&&bt&&(bt<1||!kA))&&v1(x.targets).forEach(function(Bn){return Bn.classList[Bt||Ie?"add":"remove"](x.className)}),_&&!Fe&&!Ve&&_(We),Yt&&!Uo?(Fe&&(_i&&(gr==="complete"?c.pause().totalProgress(1):gr==="reset"?c.restart(!0).pause():gr==="restart"?c.restart(!0):c[gr]()),_&&_(We)),(Ir||!kA)&&(S&&Ir&&LA(We,S),Vt[ar]&&LA(We,Vt[ar]),Ie&&(bt===1?We.kill(!1,1):Vt[ar]=0),Ir||(ar=bt===1?1:3,Vt[ar]&&LA(We,Vt[ar]))),pe&&!Bt&&Math.abs(We.getVelocity())>(sv(pe)?pe:2500)&&(Gy(We.callbackAnimation),mr?mr.progress(1):Gy(c,gr==="reverse"?1:!bt,1))):Fe&&_&&!Uo&&_(We)}if(Nt){var kr=ue?_t/ue.duration()*(ue._caScrollDist||0):_t;qt(kr+(Ee._isFlipped?1:0)),Nt(kr)}Ln&&Ln(-_t/ue.duration()*(ue._caScrollDist||0))}},We.enable=function(Ve,tt){We.enabled||(We.enabled=!0,oo(De,"resize",ov),pr||oo(De,"scroll",F_),Sr&&oo(n,"refreshInit",Sr),Ve!==!1&&(We.progress=qr=0,Mr=Er=Fr=yt()),tt!==!1&&We.refresh())},We.getTween=function(Ve){return Ve&&dt?dt.tween:mr},We.setPositions=function(Ve,tt,ut,_t){if(ue){var Lt=ue.scrollTrigger,bt=ue.duration(),Rt=Lt.end-Lt.start;Ve=Lt.start+Rt*Ve/bt,tt=Lt.start+Rt*tt/bt}We.refresh(!1,!1,{start:TO(Ve,ut&&!!We._startClamp),end:TO(tt,ut&&!!We._endClamp)},_t),We.update()},We.adjustPinSpacing=function(Ve){if(Ct&&Ve){var tt=Ct.indexOf(ge.d)+1;Ct[tt]=parseFloat(Ct[tt])+Ve+Hs,Ct[1]=parseFloat(Ct[1])+Ve+Hs,gg(Ct)}},We.disable=function(Ve,tt){if(We.enabled&&(Ve!==!1&&We.revert(!0,!0),We.enabled=We.isActive=!1,tt||mr&&mr.pause(),Zi=0,jt&&(jt.uncache=1),Sr&&so(n,"refreshInit",Sr),Ti&&(Ti.pause(),dt.tween&&dt.tween.kill()&&(dt.tween=0)),!pr)){for(var ut=qi.length;ut--;)if(qi[ut].scroller===De&&qi[ut]!==We)return;so(De,"resize",ov),pr||so(De,"scroll",F_)}},We.kill=function(Ve,tt){We.disable(Ve,tt),mr&&!tt&&mr.kill(),l&&delete RS[l];var ut=qi.indexOf(We);ut>=0&&qi.splice(ut,1),ut===da&&kw>0&&da--,ut=0,qi.forEach(function(_t){return _t.scroller===We.scroller&&(ut=1)}),ut||fa||(We.scroll.rec=0),c&&(c.scrollTrigger=null,Ve&&c.revert({kill:!1}),tt||c.kill()),Ze&&[Ze,lt,Ee,Ft].forEach(function(_t){return _t.parentNode&&_t.parentNode.removeChild(_t)}),Fv===We&&(Fv=0),j&&(jt&&(jt.uncache=1),ut=0,qi.forEach(function(_t){return _t.pin===j&&ut++}),ut||(jt.spacer=0)),s.onKill&&s.onKill(We)},qi.push(We),We.enable(!1,!1),fn&&fn(We),c&&c.add&&!Ot){var Xe=We.update;We.update=function(){We.update=Xe,be||Ae||We.refresh()},Lr.delayedCall(.01,We.update),Ot=.01,be=Ae=0}else We.refresh();j&&gae()},n.register=function(s){return H_||(Lr=s||XV(),ZV()&&window.document&&n.enable(),H_=iv),H_},n.defaults=function(s){if(s)for(var c in s)nw[c]=s[c];return nw},n.disable=function(s,c){iv=0,qi.forEach(function(_){return _[c?"kill":"disable"](s)}),so(nn,"wheel",F_),so(os,"scroll",F_),clearInterval(Jb),so(os,"touchcancel",Kc),so(Wn,"touchstart",Kc),rw(so,os,"pointerdown,touchstart,mousedown",EO),rw(so,os,"pointerup,touchend,mouseup",AO),kT.kill(),tw(so);for(var d=0;d<Xi.length;d+=3)iw(so,Xi[d],Xi[d+1]),iw(so,Xi[d],Xi[d+2])},n.enable=function(){if(nn=window,os=document,mc=os.documentElement,Wn=os.body,Lr&&(v1=Lr.utils.toArray,kv=Lr.utils.clamp,SS=Lr.core.context||Kc,MA=Lr.core.suppressOverwrites||Kc,YR=nn.history.scrollRestoration||"auto",PS=nn.pageYOffset,Lr.core.globals("ScrollTrigger",n),Wn)){iv=1,_g=document.createElement("div"),_g.style.height="100vh",_g.style.position="absolute",nU(),uae(),Is.register(Lr),n.isTouch=Is.isTouch,bd=Is.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),IS=Is.isTouch===1,oo(nn,"wheel",F_),$V=[nn,os,mc,Wn],Lr.matchMedia?(n.matchMedia=function(l){var S=Lr.matchMedia(),D;for(D in l)S.add(D,l[D]);return S},Lr.addEventListener("matchMediaInit",function(){return r6()}),Lr.addEventListener("matchMediaRevert",function(){return rU()}),Lr.addEventListener("matchMedia",function(){kp(0,1),cm("matchMedia")}),Lr.matchMedia("(orientation: portrait)",function(){return OA(),OA})):console.warn("Requires GSAP 3.11.0 or later"),OA(),oo(os,"scroll",F_);var s=Wn.style,c=s.borderTopStyle,d=Lr.core.Animation.prototype,_,x;for(d.revert||Object.defineProperty(d,"revert",{value:function(){return this.time(-.01,!0)}}),s.borderTopStyle="solid",_=sh(Wn),Ws.m=Math.round(_.top+Ws.sc())||0,_a.m=Math.round(_.left+_a.sc())||0,c?s.borderTopStyle=c:s.removeProperty("border-top-style"),Jb=setInterval(CO,250),Lr.delayedCall(.5,function(){return ew=0}),oo(os,"touchcancel",Kc),oo(Wn,"touchstart",Kc),rw(oo,os,"pointerdown,touchstart,mousedown",EO),rw(oo,os,"pointerup,touchend,mouseup",AO),AS=Lr.utils.checkPrefix("transform"),Dw.push(AS),H_=$o(),kT=Lr.delayedCall(.2,kp).pause(),W_=[os,"visibilitychange",function(){var l=nn.innerWidth,S=nn.innerHeight;os.hidden?(xO=l,bO=S):(xO!==l||bO!==S)&&ov()},os,"DOMContentLoaded",kp,nn,"load",kp,nn,"resize",ov],tw(oo),qi.forEach(function(l){return l.enable(0,1)}),x=0;x<Xi.length;x+=3)iw(so,Xi[x],Xi[x+1]),iw(so,Xi[x],Xi[x+2])}},n.config=function(s){"limitCallbacks"in s&&(kA=!!s.limitCallbacks);var c=s.syncInterval;c&&clearInterval(Jb)||(Jb=c)&&setInterval(CO,c),"ignoreMobileResize"in s&&(IS=n.isTouch===1&&s.ignoreMobileResize),"autoRefreshEvents"in s&&(tw(so)||tw(oo,s.autoRefreshEvents||"none"),qV=(s.autoRefreshEvents+"").indexOf("resize")===-1)},n.scrollerProxy=function(s,c){var d=Oa(s),_=Xi.indexOf(d),x=am(d);~_&&Xi.splice(_,x?6:2),c&&(x?mu.unshift(nn,c,Wn,c,mc,c):mu.unshift(d,c))},n.clearMatchMedia=function(s){qi.forEach(function(c){return c._ctx&&c._ctx.query===s&&c._ctx.kill(!0,!0)})},n.isInViewport=function(s,c,d){var _=(ll(s)?Oa(s):s).getBoundingClientRect(),x=_[d?jp:$p]*c||0;return d?_.right-x>0&&_.left+x<nn.innerWidth:_.bottom-x>0&&_.top+x<nn.innerHeight},n.positionInViewport=function(s,c,d){ll(s)&&(s=Oa(s));var _=s.getBoundingClientRect(),x=_[d?jp:$p],l=c==null?x/2:c in OT?OT[c]*x:~c.indexOf("%")?parseFloat(c)*x/100:parseFloat(c)||0;return d?(_.left+l)/nn.innerWidth:(_.top+l)/nn.innerHeight},n.killAll=function(s){if(qi.slice(0).forEach(function(d){return d.vars.id!=="ScrollSmoother"&&d.kill()}),s!==!0){var c=lm.killAll||[];lm={},c.forEach(function(d){return d()})}},n}();tn.version="3.12.5";tn.saveStyles=function(n){return n?v1(n).forEach(function(e){if(e&&e.style){var r=ol.indexOf(e);r>=0&&ol.splice(r,5),ol.push(e,e.style.cssText,e.getBBox&&e.getAttribute("transform"),Lr.core.getCache(e),SS())}}):ol};tn.revert=function(n,e){return r6(!n,e)};tn.create=function(n,e){return new tn(n,e)};tn.refresh=function(n){return n?ov():(H_||tn.register())&&kp(!0)};tn.update=function(n){return++Xi.cache&&ph(n===!0?2:0)};tn.clearScrollMemory=iU;tn.maxScroll=function(n,e){return ou(n,e?_a:Ws)};tn.getScrollFunc=function(n,e){return rf(Oa(n),e?_a:Ws)};tn.getById=function(n){return RS[n]};tn.getAll=function(){return qi.filter(function(n){return n.vars.id!=="ScrollSmoother"})};tn.isScrolling=function(){return!!jl};tn.snapDirectional=t6;tn.addEventListener=function(n,e){var r=lm[n]||(lm[n]=[]);~r.indexOf(e)||r.push(e)};tn.removeEventListener=function(n,e){var r=lm[n],s=r&&r.indexOf(e);s>=0&&r.splice(s,1)};tn.batch=function(n,e){var r=[],s={},c=e.interval||.016,d=e.batchMax||1e9,_=function(S,D){var I=[],V=[],j=Lr.delayedCall(c,function(){D(I,V),I=[],V=[]}).pause();return function(Q){I.length||j.restart(!0),I.push(Q.trigger),V.push(Q),d<=I.length&&j.progress(1)}},x;for(x in e)s[x]=x.substr(0,2)==="on"&&ga(e[x])&&x!=="onRefreshInit"?_(x,e[x]):e[x];return ga(d)&&(d=d(),oo(tn,"refresh",function(){return d=e.batchMax()})),v1(n).forEach(function(l){var S={};for(x in s)S[x]=s[x];S.trigger=l,r.push(tn.create(S))}),r};var LO=function(e,r,s,c){return r>c?e(c):r<0&&e(0),s>c?(c-r)/(s-r):s<0?r/(r-s):1},FA=function n(e,r){r===!0?e.style.removeProperty("touch-action"):e.style.touchAction=r===!0?"auto":r?"pan-"+r+(Is.isTouch?" pinch-zoom":""):"none",e===mc&&n(Wn,r)},lw={auto:1,scroll:1},wae=function(e){var r=e.event,s=e.target,c=e.axis,d=(r.changedTouches?r.changedTouches[0]:r).target,_=d._gsap||Lr.core.getCache(d),x=$o(),l;if(!_._isScrollT||x-_._isScrollT>2e3){for(;d&&d!==Wn&&(d.scrollHeight<=d.clientHeight&&d.scrollWidth<=d.clientWidth||!(lw[(l=Ll(d)).overflowY]||lw[l.overflowX]));)d=d.parentNode;_._isScroll=d&&d!==s&&!am(d)&&(lw[(l=Ll(d)).overflowY]||lw[l.overflowX]),_._isScrollT=x}(_._isScroll||c==="x")&&(r.stopPropagation(),r._gsapAllow=!0)},oU=function(e,r,s,c){return Is.create({target:e,capture:!0,debounce:!1,lockAxis:!0,type:r,onWheel:c=c&&wae,onPress:c,onDrag:c,onScroll:c,onEnable:function(){return s&&oo(os,Is.eventTypes[0],zO,!1,!0)},onDisable:function(){return so(os,Is.eventTypes[0],zO,!0)}})},Tae=/(input|label|select|textarea)/i,OO,zO=function(e){var r=Tae.test(e.target.tagName);(r||OO)&&(e._gsapAllow=!0,OO=r)},Eae=function(e){Ep(e)||(e={}),e.preventDefault=e.isNormalizer=e.allowClicks=!0,e.type||(e.type="wheel,touch"),e.debounce=!!e.debounce,e.id=e.id||"normalizer";var r=e,s=r.normalizeScrollX,c=r.momentum,d=r.allowNestedScroll,_=r.onRelease,x,l,S=Oa(e.target)||mc,D=Lr.core.globals().ScrollSmoother,I=D&&D.get(),V=bd&&(e.content&&Oa(e.content)||I&&e.content!==!1&&!I.smooth()&&I.content()),j=rf(S,Ws),Q=rf(S,_a),te=1,ce=(Is.isTouch&&nn.visualViewport?nn.visualViewport.scale*nn.visualViewport.width:nn.outerWidth)/nn.innerWidth,Ce=0,Me=ga(c)?function(){return c(x)}:function(){return c||2.8},Ie,Te,Ge=oU(S,e.type,!0,d),$e=function(){return Te=!1},ue=Kc,pe=Kc,_e=function(){l=ou(S,Ws),pe=kv(bd?1:0,l),s&&(ue=kv(0,ou(S,_a))),Ie=Gp},ge=function(){V._gsap.y=nv(parseFloat(V._gsap.y)+j.offset)+"px",V.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(V._gsap.y)+", 0, 1)",j.offset=j.cacheID=0},Fe=function(){if(Te){requestAnimationFrame($e);var Kt=nv(x.deltaY/2),Tr=pe(j.v-Kt);if(V&&Tr!==j.v+j.offset){j.offset=Tr-j.v;var We=nv((parseFloat(V&&V._gsap.y)||0)-j.offset);V.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+We+", 0, 1)",V._gsap.y=We+"px",j.cacheID=Xi.cache,ph()}return!0}j.offset&&ge(),Te=!0},De,Se,pr,or,Vt=function(){_e(),De.isActive()&&De.vars.scrollY>l&&(j()>l?De.progress(1)&&j(l):De.resetTo("scrollY",l))};return V&&Lr.set(V,{y:"+=0"}),e.ignoreCheck=function(Ht){return bd&&Ht.type==="touchmove"&&Fe()||te>1.05&&Ht.type!=="touchstart"||x.isGesturing||Ht.touches&&Ht.touches.length>1},e.onPress=function(){Te=!1;var Ht=te;te=nv((nn.visualViewport&&nn.visualViewport.scale||1)/ce),De.pause(),Ht!==te&&FA(S,te>1.01?!0:s?!1:"x"),Se=Q(),pr=j(),_e(),Ie=Gp},e.onRelease=e.onGestureStart=function(Ht,Kt){if(j.offset&&ge(),!Kt)or.restart(!0);else{Xi.cache++;var Tr=Me(),We,Sr;s&&(We=Q(),Sr=We+Tr*.05*-Ht.velocityX/.227,Tr*=LO(Q,We,Sr,ou(S,_a)),De.vars.scrollX=ue(Sr)),We=j(),Sr=We+Tr*.05*-Ht.velocityY/.227,Tr*=LO(j,We,Sr,ou(S,Ws)),De.vars.scrollY=pe(Sr),De.invalidate().duration(Tr).play(.01),(bd&&De.vars.scrollY>=l||We>=l-1)&&Lr.to({},{onUpdate:Vt,duration:Tr})}_&&_(Ht)},e.onWheel=function(){De._ts&&De.pause(),$o()-Ce>1e3&&(Ie=0,Ce=$o())},e.onChange=function(Ht,Kt,Tr,We,Sr){if(Gp!==Ie&&_e(),Kt&&s&&Q(ue(We[2]===Kt?Se+(Ht.startX-Ht.x):Q()+Kt-We[1])),Tr){j.offset&&ge();var Xt=Sr[2]===Tr,ei=Xt?pr+Ht.startY-Ht.y:j()+Tr-Sr[1],Fr=pe(ei);Xt&&ei!==Fr&&(pr+=Fr-ei),j(Fr)}(Tr||Kt)&&ph()},e.onEnable=function(){FA(S,s?!1:"x"),tn.addEventListener("refresh",Vt),oo(nn,"resize",Vt),j.smooth&&(j.target.style.scrollBehavior="auto",j.smooth=Q.smooth=!1),Ge.enable()},e.onDisable=function(){FA(S,!0),so(nn,"resize",Vt),tn.removeEventListener("refresh",Vt),Ge.kill()},e.lockAxis=e.lockAxis!==!1,x=new Is(e),x.iOS=bd,bd&&!j()&&j(1),bd&&Lr.ticker.add(Kc),or=x._dc,De=Lr.to(x,{ease:"power4",paused:!0,inherit:!1,scrollX:s?"+=0.1":"+=0",scrollY:"+=0.1",modifiers:{scrollY:sU(j,j(),function(){return De.pause()})},onUpdate:ph,onComplete:or.vars.onComplete}),x};tn.sort=function(n){return qi.sort(n||function(e,r){return(e.vars.refreshPriority||0)*-1e6+e.start-(r.start+(r.vars.refreshPriority||0)*-1e6)})};tn.observe=function(n){return new Is(n)};tn.normalizeScroll=function(n){if(typeof n>"u")return ha;if(n===!0&&ha)return ha.enable();if(n===!1){ha&&ha.kill(),ha=n;return}var e=n instanceof Is?n:Eae(n);return ha&&ha.target===e.target&&ha.kill(),am(e.target)&&(ha=e),e};tn.core={_getVelocityProp:ES,_inputObserver:oU,_scrollers:Xi,_proxies:mu,bridge:{ss:function(){jl||cm("scrollStart"),jl=$o()},ref:function(){return Uo}}};XV()&&Lr.registerPlugin(tn);const Aae={class:"weather"},Iae={class:"label"},Sae={class:"condition"},Cae={class:"time"},Rae={class:"temperature"},Pae={class:"precipitation"},Mae={class:"wind"},kae="9de243494c0b295cca9337e1e96b00e2",Dae=Ro({__name:"Weather",props:{lat:{},lon:{},day:{}},setup(n){bS.registerPlugin(tn);const e=mn(),r=n,s=mn();fetch(`https://pro.openweathermap.org/data/2.5/forecast?lat=${r.lat}&lon=${r.lon}&appid=${kae}&lang=it&units=metric`).then(l=>{l.json().then(S=>{s.value=S.list})});const c=wo(()=>s.value==null||s.value.length===0?[]:s.value.filter(l=>d(new Date(l.dt*1e3),r.day)));function d(l,S){return l.getMonth()===S.getMonth()&&l.getDate()===S.getDate()}const _=l=>new Date(l*1e3).toLocaleTimeString().slice(0,-3),x=l=>{switch(l){case"01d":case"01n":return"sunny";case"02d":case"02n":return"partly_cloudy_day";case"03d":case"03n":case"04d":case"04n":return"cloud";case"09d":case"09n":return"rainy_light";case"10d":case"10n":return"rainy_heavy";case"11d":case"11n":return"thunderstorm";case"13d":case"13n":return"snowing";case"50d":case"50n":return"mist"}};return Bd(s,l=>{l&&l.length>0&&KS(()=>{e.value&&e.value.children.length>0?bS.from(e.value.children,{scrollTrigger:{trigger:e.value,start:"top 80%",end:"bottom 20%",toggleActions:"play none none none"},opacity:0,y:20,stagger:.2,duration:.5,ease:"power1.out"}):console.warn("Elements not found for GSAP animation after data fetch")})}),(l,S)=>(li(),Ii("div",Aae,[Br("div",Iae," Previsioni meteo per il "+Mn(l.day.toLocaleDateString())+": ",1),Br("div",{ref_key:"weatherGridRef",ref:e,class:"weather-grid"},[(li(!0),Ii(Zs,null,qp(c.value,D=>(li(),Ii("div",{class:"weather-data",key:D.dt},[Br("div",Sae,[Br("md-icon",null,Mn(x(D.weather[0].icon)),1)]),Br("div",Cae,Mn(_(D.dt)),1),Br("div",Rae,Mn(D.main.temp)+"C",1),Br("div",Pae,Mn(D.pop*100)+"%",1),Br("div",Mae,Mn(D.wind.speed)+" m/s ",1)]))),128))],512)]))}}),Lae=gl(Dae,[["__scopeId","data-v-40ef7b63"]]);/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Oae=s0(Ys);class ba extends Oae{get name(){return this.getAttribute("name")??""}set name(e){this.setAttribute("name",e)}get form(){return this[pa].form}constructor(){super(),this.disabled=!1,this.href="",this.target="",this.trailingIcon=!1,this.hasIcon=!1,this.type="submit",this.value="",this.handleActivationClick=e=>{!kE(e)||!this.buttonElement||(this.focus(),ME(this.buttonElement))},this.addEventListener("click",this.handleActivationClick)}focus(){var e;(e=this.buttonElement)==null||e.focus()}blur(){var e;(e=this.buttonElement)==null||e.blur()}render(){var c;const e=this.disabled&&!this.href,r=this.href?this.renderLink():this.renderButton(),s=this.href?"link":"button";return bi`
      ${(c=this.renderElevationOrOutline)==null?void 0:c.call(this)}
      <div class="background"></div>
      <md-focus-ring part="focus-ring" for=${s}></md-focus-ring>
      <md-ripple part="ripple" for=${s} ?disabled="${e}"></md-ripple>
      ${r}
    `}renderButton(){const{ariaLabel:e,ariaHasPopup:r,ariaExpanded:s}=this;return bi`<button
      id="button"
      class="button"
      ?disabled=${this.disabled}
      aria-label="${e||Pr}"
      aria-haspopup="${r||Pr}"
      aria-expanded="${s||Pr}">
      ${this.renderContent()}
    </button>`}renderLink(){const{ariaLabel:e,ariaHasPopup:r,ariaExpanded:s}=this;return bi`<a
      id="link"
      class="button"
      aria-label="${e||Pr}"
      aria-haspopup="${r||Pr}"
      aria-expanded="${s||Pr}"
      href=${this.href}
      target=${this.target||Pr}
      >${this.renderContent()}
    </a>`}renderContent(){const e=bi`<slot
      name="icon"
      @slotchange="${this.handleSlotChange}"></slot>`;return bi`
      <span class="touch"></span>
      ${this.trailingIcon?Pr:e}
      <span class="label"><slot></slot></span>
      ${this.trailingIcon?e:Pr}
    `}handleSlotChange(){this.hasIcon=this.assignedIcons.length>0}}ym(ba),I8(ba);ba.formAssociated=!0;ba.shadowRootOptions={mode:"open",delegatesFocus:!0};At([lr({type:Boolean,reflect:!0})],ba.prototype,"disabled",void 0);At([lr()],ba.prototype,"href",void 0);At([lr()],ba.prototype,"target",void 0);At([lr({type:Boolean,attribute:"trailing-icon",reflect:!0})],ba.prototype,"trailingIcon",void 0);At([lr({type:Boolean,attribute:"has-icon",reflect:!0})],ba.prototype,"hasIcon",void 0);At([lr()],ba.prototype,"type",void 0);At([lr({reflect:!0})],ba.prototype,"value",void 0);At([_l(".button")],ba.prototype,"buttonElement",void 0);At([SE({slot:"icon",flatten:!0})],ba.prototype,"assignedIcons",void 0);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class zae extends ba{renderElevationOrOutline(){return bi`<md-elevation part="elevation"></md-elevation>`}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Fae=xs`:host{--_container-color: var(--md-filled-tonal-button-container-color, var(--md-sys-color-secondary-container, #e8def8));--_container-elevation: var(--md-filled-tonal-button-container-elevation, 0);--_container-height: var(--md-filled-tonal-button-container-height, 40px);--_container-shadow-color: var(--md-filled-tonal-button-container-shadow-color, var(--md-sys-color-shadow, #000));--_disabled-container-color: var(--md-filled-tonal-button-disabled-container-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-container-elevation: var(--md-filled-tonal-button-disabled-container-elevation, 0);--_disabled-container-opacity: var(--md-filled-tonal-button-disabled-container-opacity, 0.12);--_disabled-label-text-color: var(--md-filled-tonal-button-disabled-label-text-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-label-text-opacity: var(--md-filled-tonal-button-disabled-label-text-opacity, 0.38);--_focus-container-elevation: var(--md-filled-tonal-button-focus-container-elevation, 0);--_focus-label-text-color: var(--md-filled-tonal-button-focus-label-text-color, var(--md-sys-color-on-secondary-container, #1d192b));--_hover-container-elevation: var(--md-filled-tonal-button-hover-container-elevation, 1);--_hover-label-text-color: var(--md-filled-tonal-button-hover-label-text-color, var(--md-sys-color-on-secondary-container, #1d192b));--_hover-state-layer-color: var(--md-filled-tonal-button-hover-state-layer-color, var(--md-sys-color-on-secondary-container, #1d192b));--_hover-state-layer-opacity: var(--md-filled-tonal-button-hover-state-layer-opacity, 0.08);--_label-text-color: var(--md-filled-tonal-button-label-text-color, var(--md-sys-color-on-secondary-container, #1d192b));--_label-text-font: var(--md-filled-tonal-button-label-text-font, var(--md-sys-typescale-label-large-font, var(--md-ref-typeface-plain, Roboto)));--_label-text-line-height: var(--md-filled-tonal-button-label-text-line-height, var(--md-sys-typescale-label-large-line-height, 1.25rem));--_label-text-size: var(--md-filled-tonal-button-label-text-size, var(--md-sys-typescale-label-large-size, 0.875rem));--_label-text-weight: var(--md-filled-tonal-button-label-text-weight, var(--md-sys-typescale-label-large-weight, var(--md-ref-typeface-weight-medium, 500)));--_pressed-container-elevation: var(--md-filled-tonal-button-pressed-container-elevation, 0);--_pressed-label-text-color: var(--md-filled-tonal-button-pressed-label-text-color, var(--md-sys-color-on-secondary-container, #1d192b));--_pressed-state-layer-color: var(--md-filled-tonal-button-pressed-state-layer-color, var(--md-sys-color-on-secondary-container, #1d192b));--_pressed-state-layer-opacity: var(--md-filled-tonal-button-pressed-state-layer-opacity, 0.12);--_disabled-icon-color: var(--md-filled-tonal-button-disabled-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-icon-opacity: var(--md-filled-tonal-button-disabled-icon-opacity, 0.38);--_focus-icon-color: var(--md-filled-tonal-button-focus-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_hover-icon-color: var(--md-filled-tonal-button-hover-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_icon-color: var(--md-filled-tonal-button-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_icon-size: var(--md-filled-tonal-button-icon-size, 18px);--_pressed-icon-color: var(--md-filled-tonal-button-pressed-icon-color, var(--md-sys-color-on-secondary-container, #1d192b));--_container-shape-start-start: var(--md-filled-tonal-button-container-shape-start-start, var(--md-filled-tonal-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-start-end: var(--md-filled-tonal-button-container-shape-start-end, var(--md-filled-tonal-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-end: var(--md-filled-tonal-button-container-shape-end-end, var(--md-filled-tonal-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-start: var(--md-filled-tonal-button-container-shape-end-start, var(--md-filled-tonal-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_leading-space: var(--md-filled-tonal-button-leading-space, 24px);--_trailing-space: var(--md-filled-tonal-button-trailing-space, 24px);--_with-leading-icon-leading-space: var(--md-filled-tonal-button-with-leading-icon-leading-space, 16px);--_with-leading-icon-trailing-space: var(--md-filled-tonal-button-with-leading-icon-trailing-space, 24px);--_with-trailing-icon-leading-space: var(--md-filled-tonal-button-with-trailing-icon-leading-space, 24px);--_with-trailing-icon-trailing-space: var(--md-filled-tonal-button-with-trailing-icon-trailing-space, 16px)}
`;/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const aU=xs`md-elevation{transition-duration:280ms}:host([disabled]) md-elevation{transition:none}md-elevation{--md-elevation-level: var(--_container-elevation);--md-elevation-shadow-color: var(--_container-shadow-color)}:host(:focus-within) md-elevation{--md-elevation-level: var(--_focus-container-elevation)}:host(:hover) md-elevation{--md-elevation-level: var(--_hover-container-elevation)}:host(:active) md-elevation{--md-elevation-level: var(--_pressed-container-elevation)}:host([disabled]) md-elevation{--md-elevation-level: var(--_disabled-container-elevation)}
`;/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const lU=xs`:host{border-start-start-radius:var(--_container-shape-start-start);border-start-end-radius:var(--_container-shape-start-end);border-end-start-radius:var(--_container-shape-end-start);border-end-end-radius:var(--_container-shape-end-end);box-sizing:border-box;cursor:pointer;display:inline-flex;gap:8px;min-height:var(--_container-height);outline:none;padding-block:calc((var(--_container-height) - max(var(--_label-text-line-height),var(--_icon-size)))/2);padding-inline-start:var(--_leading-space);padding-inline-end:var(--_trailing-space);place-content:center;place-items:center;position:relative;font-family:var(--_label-text-font);font-size:var(--_label-text-size);line-height:var(--_label-text-line-height);font-weight:var(--_label-text-weight);text-overflow:ellipsis;text-wrap:nowrap;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);vertical-align:top;--md-ripple-hover-color: var(--_hover-state-layer-color);--md-ripple-pressed-color: var(--_pressed-state-layer-color);--md-ripple-hover-opacity: var(--_hover-state-layer-opacity);--md-ripple-pressed-opacity: var(--_pressed-state-layer-opacity)}md-focus-ring{--md-focus-ring-shape-start-start: var(--_container-shape-start-start);--md-focus-ring-shape-start-end: var(--_container-shape-start-end);--md-focus-ring-shape-end-end: var(--_container-shape-end-end);--md-focus-ring-shape-end-start: var(--_container-shape-end-start)}:host([disabled]){cursor:default;pointer-events:none}.button{border-radius:inherit;cursor:inherit;display:inline-flex;align-items:center;justify-content:center;border:none;outline:none;-webkit-appearance:none;vertical-align:middle;background:rgba(0,0,0,0);text-decoration:none;min-width:calc(64px - var(--_leading-space) - var(--_trailing-space));width:100%;z-index:0;height:100%;font:inherit;color:var(--_label-text-color);padding:0;gap:inherit;text-transform:inherit}.button::-moz-focus-inner{padding:0;border:0}:host(:hover) .button{color:var(--_hover-label-text-color)}:host(:focus-within) .button{color:var(--_focus-label-text-color)}:host(:active) .button{color:var(--_pressed-label-text-color)}.background{background-color:var(--_container-color);border-radius:inherit;inset:0;position:absolute}.label{overflow:hidden}:is(.button,.label,.label slot),.label ::slotted(*){text-overflow:inherit}:host([disabled]) .label{color:var(--_disabled-label-text-color);opacity:var(--_disabled-label-text-opacity)}:host([disabled]) .background{background-color:var(--_disabled-container-color);opacity:var(--_disabled-container-opacity)}@media(forced-colors: active){.background{border:1px solid CanvasText}:host([disabled]){--_disabled-icon-color: GrayText;--_disabled-icon-opacity: 1;--_disabled-container-opacity: 1;--_disabled-label-text-color: GrayText;--_disabled-label-text-opacity: 1}}:host([has-icon]:not([trailing-icon])){padding-inline-start:var(--_with-leading-icon-leading-space);padding-inline-end:var(--_with-leading-icon-trailing-space)}:host([has-icon][trailing-icon]){padding-inline-start:var(--_with-trailing-icon-leading-space);padding-inline-end:var(--_with-trailing-icon-trailing-space)}::slotted([slot=icon]){display:inline-flex;position:relative;writing-mode:horizontal-tb;fill:currentColor;flex-shrink:0;color:var(--_icon-color);font-size:var(--_icon-size);inline-size:var(--_icon-size);block-size:var(--_icon-size)}:host(:hover) ::slotted([slot=icon]){color:var(--_hover-icon-color)}:host(:focus-within) ::slotted([slot=icon]){color:var(--_focus-icon-color)}:host(:active) ::slotted([slot=icon]){color:var(--_pressed-icon-color)}:host([disabled]) ::slotted([slot=icon]){color:var(--_disabled-icon-color);opacity:var(--_disabled-icon-opacity)}.touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}:host([touch-target=wrapper]){margin:max(0px,(48px - var(--_container-height))/2) 0}:host([touch-target=none]) .touch{display:none}
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let kS=class extends zae{};kS.styles=[lU,aU,Fae];kS=At([ea("md-filled-tonal-button")],kS);/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class o0 extends Ys{constructor(){super(...arguments),this.value=0,this.max=1,this.indeterminate=!1,this.fourColor=!1}render(){const{ariaLabel:e}=this;return bi`
      <div
        class="progress ${za(this.getRenderClasses())}"
        role="progressbar"
        aria-label="${e||Pr}"
        aria-valuemin="0"
        aria-valuemax=${this.max}
        aria-valuenow=${this.indeterminate?Pr:this.value}
        >${this.renderIndicator()}</div
      >
    `}getRenderClasses(){return{indeterminate:this.indeterminate,"four-color":this.fourColor}}}ym(o0);At([lr({type:Number})],o0.prototype,"value",void 0);At([lr({type:Number})],o0.prototype,"max",void 0);At([lr({type:Boolean})],o0.prototype,"indeterminate",void 0);At([lr({type:Boolean,attribute:"four-color"})],o0.prototype,"fourColor",void 0);/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Nae extends o0{renderIndicator(){return this.indeterminate?this.renderIndeterminateContainer():this.renderDeterminateContainer()}renderDeterminateContainer(){const e=(1-this.value/this.max)*100;return bi`
      <svg viewBox="0 0 4800 4800">
        <circle class="track" pathLength="100"></circle>
        <circle
          class="active-track"
          pathLength="100"
          stroke-dashoffset=${e}></circle>
      </svg>
    `}renderIndeterminateContainer(){return bi` <div class="spinner">
      <div class="left">
        <div class="circle"></div>
      </div>
      <div class="right">
        <div class="circle"></div>
      </div>
    </div>`}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Bae=xs`:host{--_active-indicator-color: var(--md-circular-progress-active-indicator-color, var(--md-sys-color-primary, #6750a4));--_active-indicator-width: var(--md-circular-progress-active-indicator-width, 10);--_four-color-active-indicator-four-color: var(--md-circular-progress-four-color-active-indicator-four-color, var(--md-sys-color-tertiary-container, #ffd8e4));--_four-color-active-indicator-one-color: var(--md-circular-progress-four-color-active-indicator-one-color, var(--md-sys-color-primary, #6750a4));--_four-color-active-indicator-three-color: var(--md-circular-progress-four-color-active-indicator-three-color, var(--md-sys-color-tertiary, #7d5260));--_four-color-active-indicator-two-color: var(--md-circular-progress-four-color-active-indicator-two-color, var(--md-sys-color-primary-container, #eaddff));--_size: var(--md-circular-progress-size, 48px);display:inline-flex;vertical-align:middle;width:var(--_size);height:var(--_size);position:relative;align-items:center;justify-content:center;contain:strict;content-visibility:auto}.progress{flex:1;align-self:stretch;margin:4px}.progress,.spinner,.left,.right,.circle,svg,.track,.active-track{position:absolute;inset:0}svg{transform:rotate(-90deg)}circle{cx:50%;cy:50%;r:calc(50%*(1 - var(--_active-indicator-width)/100));stroke-width:calc(var(--_active-indicator-width)*1%);stroke-dasharray:100;fill:rgba(0,0,0,0)}.active-track{transition:stroke-dashoffset 500ms cubic-bezier(0, 0, 0.2, 1);stroke:var(--_active-indicator-color)}.track{stroke:rgba(0,0,0,0)}.progress.indeterminate{animation:linear infinite linear-rotate;animation-duration:1568.2352941176ms}.spinner{animation:infinite both rotate-arc;animation-duration:5332ms;animation-timing-function:cubic-bezier(0.4, 0, 0.2, 1)}.left{overflow:hidden;inset:0 50% 0 0}.right{overflow:hidden;inset:0 0 0 50%}.circle{box-sizing:border-box;border-radius:50%;border:solid calc(var(--_active-indicator-width)/100*(var(--_size) - 8px));border-color:var(--_active-indicator-color) var(--_active-indicator-color) rgba(0,0,0,0) rgba(0,0,0,0);animation:expand-arc;animation-iteration-count:infinite;animation-fill-mode:both;animation-duration:1333ms,5332ms;animation-timing-function:cubic-bezier(0.4, 0, 0.2, 1)}.four-color .circle{animation-name:expand-arc,four-color}.left .circle{rotate:135deg;inset:0 -100% 0 0}.right .circle{rotate:100deg;inset:0 0 0 -100%;animation-delay:-666.5ms,0ms}@media(forced-colors: active){.active-track{stroke:CanvasText}.circle{border-color:CanvasText CanvasText Canvas Canvas}}@keyframes expand-arc{0%{transform:rotate(265deg)}50%{transform:rotate(130deg)}100%{transform:rotate(265deg)}}@keyframes rotate-arc{12.5%{transform:rotate(135deg)}25%{transform:rotate(270deg)}37.5%{transform:rotate(405deg)}50%{transform:rotate(540deg)}62.5%{transform:rotate(675deg)}75%{transform:rotate(810deg)}87.5%{transform:rotate(945deg)}100%{transform:rotate(1080deg)}}@keyframes linear-rotate{to{transform:rotate(360deg)}}@keyframes four-color{0%{border-top-color:var(--_four-color-active-indicator-one-color);border-right-color:var(--_four-color-active-indicator-one-color)}15%{border-top-color:var(--_four-color-active-indicator-one-color);border-right-color:var(--_four-color-active-indicator-one-color)}25%{border-top-color:var(--_four-color-active-indicator-two-color);border-right-color:var(--_four-color-active-indicator-two-color)}40%{border-top-color:var(--_four-color-active-indicator-two-color);border-right-color:var(--_four-color-active-indicator-two-color)}50%{border-top-color:var(--_four-color-active-indicator-three-color);border-right-color:var(--_four-color-active-indicator-three-color)}65%{border-top-color:var(--_four-color-active-indicator-three-color);border-right-color:var(--_four-color-active-indicator-three-color)}75%{border-top-color:var(--_four-color-active-indicator-four-color);border-right-color:var(--_four-color-active-indicator-four-color)}90%{border-top-color:var(--_four-color-active-indicator-four-color);border-right-color:var(--_four-color-active-indicator-four-color)}100%{border-top-color:var(--_four-color-active-indicator-one-color);border-right-color:var(--_four-color-active-indicator-one-color)}}
`;/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let DS=class extends Nae{};DS.styles=[Bae];DS=At([ea("md-circular-progress")],DS);const cU="@firebase/installations",i6="0.6.7";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uU=1e4,hU=`w:${i6}`,dU="FIS_v2",Vae="https://firebaseinstallations.googleapis.com/v1",Uae=60*60*1e3,jae="installations",$ae="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gae={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},um=new lf(jae,$ae,Gae);function fU(n){return n instanceof Wl&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pU({projectId:n}){return`${Vae}/projects/${n}/installations`}function mU(n){return{token:n.token,requestStatus:2,expiresIn:Hae(n.expiresIn),creationTime:Date.now()}}async function _U(n,e){const s=(await e.json()).error;return um.create("request-failed",{requestName:n,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})}function gU({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function qae(n,{refreshToken:e}){const r=gU(n);return r.append("Authorization",Wae(e)),r}async function yU(n){const e=await n();return e.status>=500&&e.status<600?n():e}function Hae(n){return Number(n.replace("s","000"))}function Wae(n){return`${dU} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zae({appConfig:n,heartbeatServiceProvider:e},{fid:r}){const s=pU(n),c=gU(n),d=e.getImmediate({optional:!0});if(d){const S=await d.getHeartbeatsHeader();S&&c.append("x-firebase-client",S)}const _={fid:r,authVersion:dU,appId:n.appId,sdkVersion:hU},x={method:"POST",headers:c,body:JSON.stringify(_)},l=await yU(()=>fetch(s,x));if(l.ok){const S=await l.json();return{fid:S.fid||r,registrationStatus:2,refreshToken:S.refreshToken,authToken:mU(S.authToken)}}else throw await _U("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vU(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xae(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yae=/^[cdef][\w-]{21}$/,LS="";function Qae(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const r=Kae(n);return Yae.test(r)?r:LS}catch{return LS}}function Kae(n){return Xae(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NE(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xU=new Map;function bU(n,e){const r=NE(n);wU(r,e),Jae(r,e)}function wU(n,e){const r=xU.get(n);if(r)for(const s of r)s(e)}function Jae(n,e){const r=ele();r&&r.postMessage({key:n,fid:e}),tle()}let Dp=null;function ele(){return!Dp&&"BroadcastChannel"in self&&(Dp=new BroadcastChannel("[Firebase] FID Change"),Dp.onmessage=n=>{wU(n.data.key,n.data.fid)}),Dp}function tle(){xU.size===0&&Dp&&(Dp.close(),Dp=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rle="firebase-installations-database",ile=1,hm="firebase-installations-store";let NA=null;function n6(){return NA||(NA=CF(rle,ile,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(hm)}}})),NA}async function zT(n,e){const r=NE(n),c=(await n6()).transaction(hm,"readwrite"),d=c.objectStore(hm),_=await d.get(r);return await d.put(e,r),await c.done,(!_||_.fid!==e.fid)&&bU(n,e.fid),e}async function TU(n){const e=NE(n),s=(await n6()).transaction(hm,"readwrite");await s.objectStore(hm).delete(e),await s.done}async function BE(n,e){const r=NE(n),c=(await n6()).transaction(hm,"readwrite"),d=c.objectStore(hm),_=await d.get(r),x=e(_);return x===void 0?await d.delete(r):await d.put(x,r),await c.done,x&&(!_||_.fid!==x.fid)&&bU(n,x.fid),x}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s6(n){let e;const r=await BE(n.appConfig,s=>{const c=nle(s),d=sle(n,c);return e=d.registrationPromise,d.installationEntry});return r.fid===LS?{installationEntry:await e}:{installationEntry:r,registrationPromise:e}}function nle(n){const e=n||{fid:Qae(),registrationStatus:0};return EU(e)}function sle(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const c=Promise.reject(um.create("app-offline"));return{installationEntry:e,registrationPromise:c}}const r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},s=ole(n,r);return{installationEntry:r,registrationPromise:s}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:ale(n)}:{installationEntry:e}}async function ole(n,e){try{const r=await Zae(n,e);return zT(n.appConfig,r)}catch(r){throw fU(r)&&r.customData.serverCode===409?await TU(n.appConfig):await zT(n.appConfig,{fid:e.fid,registrationStatus:0}),r}}async function ale(n){let e=await FO(n.appConfig);for(;e.registrationStatus===1;)await vU(100),e=await FO(n.appConfig);if(e.registrationStatus===0){const{installationEntry:r,registrationPromise:s}=await s6(n);return s||r}return e}function FO(n){return BE(n,e=>{if(!e)throw um.create("installation-not-found");return EU(e)})}function EU(n){return lle(n)?{fid:n.fid,registrationStatus:0}:n}function lle(n){return n.registrationStatus===1&&n.registrationTime+uU<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cle({appConfig:n,heartbeatServiceProvider:e},r){const s=ule(n,r),c=qae(n,r),d=e.getImmediate({optional:!0});if(d){const S=await d.getHeartbeatsHeader();S&&c.append("x-firebase-client",S)}const _={installation:{sdkVersion:hU,appId:n.appId}},x={method:"POST",headers:c,body:JSON.stringify(_)},l=await yU(()=>fetch(s,x));if(l.ok){const S=await l.json();return mU(S)}else throw await _U("Generate Auth Token",l)}function ule(n,{fid:e}){return`${pU(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o6(n,e=!1){let r;const s=await BE(n.appConfig,d=>{if(!AU(d))throw um.create("not-registered");const _=d.authToken;if(!e&&fle(_))return d;if(_.requestStatus===1)return r=hle(n,e),d;{if(!navigator.onLine)throw um.create("app-offline");const x=mle(d);return r=dle(n,x),x}});return r?await r:s.authToken}async function hle(n,e){let r=await NO(n.appConfig);for(;r.authToken.requestStatus===1;)await vU(100),r=await NO(n.appConfig);const s=r.authToken;return s.requestStatus===0?o6(n,e):s}function NO(n){return BE(n,e=>{if(!AU(e))throw um.create("not-registered");const r=e.authToken;return _le(r)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function dle(n,e){try{const r=await cle(n,e),s=Object.assign(Object.assign({},e),{authToken:r});return await zT(n.appConfig,s),r}catch(r){if(fU(r)&&(r.customData.serverCode===401||r.customData.serverCode===404))await TU(n.appConfig);else{const s=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await zT(n.appConfig,s)}throw r}}function AU(n){return n!==void 0&&n.registrationStatus===2}function fle(n){return n.requestStatus===2&&!ple(n)}function ple(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+Uae}function mle(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function _le(n){return n.requestStatus===1&&n.requestTime+uU<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gle(n){const e=n,{installationEntry:r,registrationPromise:s}=await s6(e);return s?s.catch(console.error):o6(e).catch(console.error),r.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yle(n,e=!1){const r=n;return await vle(r),(await o6(r,e)).token}async function vle(n){const{registrationPromise:e}=await s6(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xle(n){if(!n||!n.options)throw BA("App Configuration");if(!n.name)throw BA("App Name");const e=["projectId","apiKey","appId"];for(const r of e)if(!n.options[r])throw BA(r);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function BA(n){return um.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IU="installations",ble="installations-internal",wle=n=>{const e=n.getProvider("app").getImmediate(),r=xle(e),s=eE(e,"heartbeat");return{app:e,appConfig:r,heartbeatServiceProvider:s,_delete:()=>Promise.resolve()}},Tle=n=>{const e=n.getProvider("app").getImmediate(),r=eE(e,IU).getImmediate();return{getId:()=>gle(r),getToken:c=>yle(r,c)}};function Ele(){qa(new xa(IU,wle,"PUBLIC")),qa(new xa(ble,Tle,"PRIVATE"))}Ele();Io(cU,i6);Io(cU,i6,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BO="analytics",Ale="firebase_id",Ile="origin",Sle=60*1e3,Cle="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",a6="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $a=new Yg("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rle={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},$l=new lf("analytics","Analytics",Rle);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ple(n){if(!n.startsWith(a6)){const e=$l.create("invalid-gtag-resource",{gtagURL:n});return $a.warn(e.message),""}return n}function SU(n){return Promise.all(n.map(e=>e.catch(r=>r)))}function Mle(n,e){let r;return window.trustedTypes&&(r=window.trustedTypes.createPolicy(n,e)),r}function kle(n,e){const r=Mle("firebase-js-sdk-policy",{createScriptURL:Ple}),s=document.createElement("script"),c=`${a6}?l=${n}&id=${e}`;s.src=r?r==null?void 0:r.createScriptURL(c):c,s.async=!0,document.head.appendChild(s)}function Dle(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function Lle(n,e,r,s,c,d){const _=s[c];try{if(_)await e[_];else{const l=(await SU(r)).find(S=>S.measurementId===c);l&&await e[l.appId]}}catch(x){$a.error(x)}n("config",c,d)}async function Ole(n,e,r,s,c){try{let d=[];if(c&&c.send_to){let _=c.send_to;Array.isArray(_)||(_=[_]);const x=await SU(r);for(const l of _){const S=x.find(I=>I.measurementId===l),D=S&&e[S.appId];if(D)d.push(D);else{d=[];break}}}d.length===0&&(d=Object.values(e)),await Promise.all(d),n("event",s,c||{})}catch(d){$a.error(d)}}function zle(n,e,r,s){async function c(d,..._){try{if(d==="event"){const[x,l]=_;await Ole(n,e,r,x,l)}else if(d==="config"){const[x,l]=_;await Lle(n,e,r,s,x,l)}else if(d==="consent"){const[x,l]=_;n("consent",x,l)}else if(d==="get"){const[x,l,S]=_;n("get",x,l,S)}else if(d==="set"){const[x]=_;n("set",x)}else n(d,..._)}catch(x){$a.error(x)}}return c}function Fle(n,e,r,s,c){let d=function(..._){window[s].push(arguments)};return window[c]&&typeof window[c]=="function"&&(d=window[c]),window[c]=zle(d,n,e,r),{gtagCore:d,wrappedGtag:window[c]}}function Nle(n){const e=window.document.getElementsByTagName("script");for(const r of Object.values(e))if(r.src&&r.src.includes(a6)&&r.src.includes(n))return r;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ble=30,Vle=1e3;class Ule{constructor(e={},r=Vle){this.throttleMetadata=e,this.intervalMillis=r}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,r){this.throttleMetadata[e]=r}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const CU=new Ule;function jle(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function $le(n){var e;const{appId:r,apiKey:s}=n,c={method:"GET",headers:jle(s)},d=Cle.replace("{app-id}",r),_=await fetch(d,c);if(_.status!==200&&_.status!==304){let x="";try{const l=await _.json();!((e=l.error)===null||e===void 0)&&e.message&&(x=l.error.message)}catch{}throw $l.create("config-fetch-failed",{httpStatus:_.status,responseMessage:x})}return _.json()}async function Gle(n,e=CU,r){const{appId:s,apiKey:c,measurementId:d}=n.options;if(!s)throw $l.create("no-app-id");if(!c){if(d)return{measurementId:d,appId:s};throw $l.create("no-api-key")}const _=e.getThrottleMetadata(s)||{backoffCount:0,throttleEndTimeMillis:Date.now()},x=new Wle;return setTimeout(async()=>{x.abort()},Sle),RU({appId:s,apiKey:c,measurementId:d},_,x,e)}async function RU(n,{throttleEndTimeMillis:e,backoffCount:r},s,c=CU){var d;const{appId:_,measurementId:x}=n;try{await qle(s,e)}catch(l){if(x)return $a.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${x} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:_,measurementId:x};throw l}try{const l=await $le(n);return c.deleteThrottleMetadata(_),l}catch(l){const S=l;if(!Hle(S)){if(c.deleteThrottleMetadata(_),x)return $a.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${x} provided in the "measurementId" field in the local Firebase config. [${S==null?void 0:S.message}]`),{appId:_,measurementId:x};throw l}const D=Number((d=S==null?void 0:S.customData)===null||d===void 0?void 0:d.httpStatus)===503?Rk(r,c.intervalMillis,Ble):Rk(r,c.intervalMillis),I={throttleEndTimeMillis:Date.now()+D,backoffCount:r+1};return c.setThrottleMetadata(_,I),$a.debug(`Calling attemptFetch again in ${D} millis`),RU(n,I,s,c)}}function qle(n,e){return new Promise((r,s)=>{const c=Math.max(e-Date.now(),0),d=setTimeout(r,c);n.addEventListener(()=>{clearTimeout(d),s($l.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function Hle(n){if(!(n instanceof Wl)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class Wle{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Zle(n,e,r,s,c){if(c&&c.global){n("event",r,s);return}else{const d=await e,_=Object.assign(Object.assign({},s),{send_to:d});n("event",r,_)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xle(){if(aC())try{await EF()}catch(n){return $a.warn($l.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return $a.warn($l.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Yle(n,e,r,s,c,d,_){var x;const l=Gle(n);l.then(j=>{r[j.measurementId]=j.appId,n.options.measurementId&&j.measurementId!==n.options.measurementId&&$a.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${j.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(j=>$a.error(j)),e.push(l);const S=Xle().then(j=>{if(j)return s.getId()}),[D,I]=await Promise.all([l,S]);Nle(d)||kle(d,D.measurementId),c("js",new Date);const V=(x=_==null?void 0:_.config)!==null&&x!==void 0?x:{};return V[Ile]="firebase",V.update=!0,I!=null&&(V[Ale]=I),c("config",D.measurementId,V),D.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qle{constructor(e){this.app=e}_delete(){return delete Nv[this.app.options.appId],Promise.resolve()}}let Nv={},VO=[];const UO={};let VA="dataLayer",Kle="gtag",jO,PU,$O=!1;function Jle(){const n=[];if(bF()&&n.push("This is a browser extension environment."),JH()||n.push("Cookies are not available."),n.length>0){const e=n.map((s,c)=>`(${c+1}) ${s}`).join(" "),r=$l.create("invalid-analytics-context",{errorInfo:e});$a.warn(r.message)}}function ece(n,e,r){Jle();const s=n.options.appId;if(!s)throw $l.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)$a.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw $l.create("no-api-key");if(Nv[s]!=null)throw $l.create("already-exists",{id:s});if(!$O){Dle(VA);const{wrappedGtag:d,gtagCore:_}=Fle(Nv,VO,UO,VA,Kle);PU=d,jO=_,$O=!0}return Nv[s]=Yle(n,VO,UO,e,jO,VA,r),new Qle(n)}function tce(n,e,r,s){n=va(n),Zle(PU,Nv[n.app.options.appId],e,r,s).catch(c=>$a.error(c))}const GO="@firebase/analytics",qO="0.10.4";function rce(){qa(new xa(BO,(e,{options:r})=>{const s=e.getProvider("app").getImmediate(),c=e.getProvider("installations-internal").getImmediate();return ece(s,c,r)},"PUBLIC")),qa(new xa("analytics-internal",n,"PRIVATE")),Io(GO,qO),Io(GO,qO,"esm2017");function n(e){try{const r=e.getProvider(BO).getImmediate();return{logEvent:(s,c,d)=>tce(r,s,c,d)}}catch(r){throw $l.create("interop-component-reg-failed",{reason:r})}}}rce();const ice={apiKey:"AIzaSyBk1CeHu4Cgb9TASIxYTAV1_yioUKI6dtY",authDomain:"thisorganization.it",projectId:"this-organization",storageBucket:"this-organization.appspot.com",messagingSenderId:"765581073008",appId:"1:765581073008:web:a6acc8fc063747ba3532b5",measurementId:"G-DRJ288CGWD"},MU=RF(ice),l6=Bre(MU),nce="/assets/G-UibcS5yq.png",sce=Br("img",{slot:"icon",class:"loginBtn",src:nce},null,-1),HO=new nh,oce=Ro({__name:"GoogleLogin",emits:["loginStart","loginEnd"],setup(n,{emit:e}){const r=Vie(),s=mn(!1),c=e;function d(){c("loginStart"),s.value?OX(r,HO).catch(_=>{console.error("Failed signin redirect",_)}):UX(r,HO).catch(_=>{console.error("Failed signin popup",_)})}return eC(async()=>{const _=window.navigator.userAgent;s.value=/iPad|iPhone|iPod/.test(_),await $X(r).catch(l=>{console.error("Failed redirect result",l)})&&c("loginEnd")}),(_,x)=>(li(),Ii("md-filled-tonal-button",{onClick:d,alt:"Login button"},[sce,au(" Login con Google ")]))}}),VE=n=>(of("data-v-2178eeaa"),n=n(),af(),n),ace={key:0,class:"full"},lce=VE(()=>Br("md-icon",null,"cancel",-1)),cce={key:1,class:"already-joined"},uce=VE(()=>Br("md-icon",null,"task_alt",-1)),hce={key:0,class:"need-login"},dce=VE(()=>Br("p",null," Per partecipare devi effettuare l'accesso:",-1)),fce={key:1,class:"join"},pce={key:0,indeterminate:""},mce={key:2,class:"already-joined"},_ce=VE(()=>Br("md-icon",null,"task_alt",-1)),gce=Ro({__name:"JoinSection",props:{userAlreadyJoined:{type:Boolean},isFull:{type:Boolean}},emits:["join"],setup(n,{emit:e}){const r=mn(!1),s=wC(),c=n,d=e;function _(){!s||!s.value||d("join",s.value)}return(x,l)=>(li(),Ii("div",{class:Hg({"join-section":!0,"section-full":x.isFull,"section-already-joined":c.userAlreadyJoined})},[x.isFull&&(Hi(s)==null||!c.userAlreadyJoined)?(li(),Ii("div",ace,[au(" Al completo "),lce])):x.isFull&&Hi(s)&&c.userAlreadyJoined?(li(),Ii("div",cce,[au(" Partecipi a questo evento "),uce])):(li(),Ii(Zs,{key:2},[Hi(s)==null?(li(),Ii("div",hce,[dce,kn(oce)])):(li(),Ii("div",fce,[r.value?(li(),Ii("md-circular-progress",pce)):c.userAlreadyJoined?(li(),Ii("div",mce,[au(" Partecipi a questo evento "),_ce])):(li(),Ii("md-filled-tonal-button",{key:1,onClick:_}," Partecipa come "+Mn(Hi(s).displayName||Hi(s).email),1))]))],64))],2))}}),WO=gl(gce,[["__scopeId","data-v-2178eeaa"]]),yce=n=>(of("data-v-2390b86a"),n=n(),af(),n),vce={class:"event-view"},xce={class:"img-container"},bce=["src"],wce={class:"content"},Tce={class:"title"},Ece={class:"date"},Ace=["innerHTML"],Ice={key:0,class:"max-participants"},Sce=yce(()=>Br("md-icon",null,"person",-1)),Cce=Ro({__name:"EventView",setup(n){const e=mF(),r=S8.find(I=>I.id===e.params.id),s=mn(!1);function c(I){const V=new Date,j=new Date(I),Q=Math.abs(j.getTime()-V.getTime()),te=5*24*60*60*1e3;return Q<=te&&V<j}const d=B9(l6,`events/${e.params.id}`),_=zie(d,{wait:!0}),x=wC();async function l(I){I==null||I.uid==null||(s.value=!0,await Qre(d,{participants:Jre({[I.uid]:{nome:I.displayName||I.email}})}),s.value=!1)}const S=wo(()=>x.value==null||_.value==null?!1:_.value.participants.some(I=>Object.keys(I)[0]===x.value.uid)),D=wo(()=>_.value==null?0:_.value.participants.length);return(I,V)=>{var j,Q,te,ce,Ce,Me,Ie,Te,Ge,$e,ue,pe,_e,ge;return li(),Ii("div",vce,[Br("div",xce,[Br("img",{src:(j=Hi(r))==null?void 0:j.imageUrl,alt:""},null,8,bce)]),Br("div",wce,[Br("div",Tce,Mn((Q=Hi(r))==null?void 0:Q.name),1),Br("div",Ece,Mn((te=Hi(r))==null?void 0:te.date.toLocaleDateString()),1),Br("div",{class:"description",innerHTML:(ce=Hi(r))==null?void 0:ce.description},null,8,Ace),(Ce=Hi(r))!=null&&Ce.maxParticipants?(li(),Ii("div",Ice,[Sce,au(" "+Mn(D.value)+"/"+Mn((Me=Hi(r))==null?void 0:Me.maxParticipants),1)])):Tc("",!0),kn(WO,{"is-full":((Ie=Hi(r))==null?void 0:Ie.maxParticipants)!=null&&D.value>=Hi(r).maxParticipants,"user-already-joined":S.value,onJoin:l},null,8,["is-full","user-already-joined"]),kn(Hse,{"map-data":((Te=Hi(r))==null?void 0:Te.mapData)||[(Ge=Hi(r))==null?void 0:Ge.position.lon,($e=Hi(r))==null?void 0:$e.position.lat],date:(ue=Hi(r))==null?void 0:ue.date},null,8,["map-data","date"]),(pe=Hi(r))!=null&&pe.date&&c(Hi(r).date)?(li(),Wg(Lae,{key:1,class:"weather",lat:Hi(r).position.lat,lon:Hi(r).position.lon,day:(_e=Hi(r))==null?void 0:_e.date},null,8,["lat","lon","day"])):Tc("",!0),kn(WO,{"is-full":((ge=Hi(r))==null?void 0:ge.maxParticipants)!=null&&D.value>=Hi(r).maxParticipants,"user-already-joined":S.value,onJoin:l},null,8,["is-full","user-already-joined"])])])}}}),Rce=gl(Cce,[["__scopeId","data-v-2390b86a"]]);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Pce=xs`:host{--_container-height: var(--md-outlined-icon-button-container-height, 40px);--_container-width: var(--md-outlined-icon-button-container-width, 40px);--_disabled-icon-color: var(--md-outlined-icon-button-disabled-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-icon-opacity: var(--md-outlined-icon-button-disabled-icon-opacity, 0.38);--_disabled-selected-container-color: var(--md-outlined-icon-button-disabled-selected-container-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-selected-container-opacity: var(--md-outlined-icon-button-disabled-selected-container-opacity, 0.12);--_hover-state-layer-opacity: var(--md-outlined-icon-button-hover-state-layer-opacity, 0.08);--_icon-size: var(--md-outlined-icon-button-icon-size, 24px);--_pressed-state-layer-opacity: var(--md-outlined-icon-button-pressed-state-layer-opacity, 0.12);--_selected-container-color: var(--md-outlined-icon-button-selected-container-color, var(--md-sys-color-inverse-surface, #322f35));--_selected-focus-icon-color: var(--md-outlined-icon-button-selected-focus-icon-color, var(--md-sys-color-inverse-on-surface, #f5eff7));--_selected-hover-icon-color: var(--md-outlined-icon-button-selected-hover-icon-color, var(--md-sys-color-inverse-on-surface, #f5eff7));--_selected-hover-state-layer-color: var(--md-outlined-icon-button-selected-hover-state-layer-color, var(--md-sys-color-inverse-on-surface, #f5eff7));--_selected-icon-color: var(--md-outlined-icon-button-selected-icon-color, var(--md-sys-color-inverse-on-surface, #f5eff7));--_selected-pressed-icon-color: var(--md-outlined-icon-button-selected-pressed-icon-color, var(--md-sys-color-inverse-on-surface, #f5eff7));--_selected-pressed-state-layer-color: var(--md-outlined-icon-button-selected-pressed-state-layer-color, var(--md-sys-color-inverse-on-surface, #f5eff7));--_disabled-outline-color: var(--md-outlined-icon-button-disabled-outline-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-outline-opacity: var(--md-outlined-icon-button-disabled-outline-opacity, 0.12);--_focus-icon-color: var(--md-outlined-icon-button-focus-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-icon-color: var(--md-outlined-icon-button-hover-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_hover-state-layer-color: var(--md-outlined-icon-button-hover-state-layer-color, var(--md-sys-color-on-surface-variant, #49454f));--_icon-color: var(--md-outlined-icon-button-icon-color, var(--md-sys-color-on-surface-variant, #49454f));--_outline-color: var(--md-outlined-icon-button-outline-color, var(--md-sys-color-outline, #79747e));--_outline-width: var(--md-outlined-icon-button-outline-width, 1px);--_pressed-icon-color: var(--md-outlined-icon-button-pressed-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_pressed-state-layer-color: var(--md-outlined-icon-button-pressed-state-layer-color, var(--md-sys-color-on-surface, #1d1b20));--_container-shape-start-start: var(--md-outlined-icon-button-container-shape-start-start, var(--md-outlined-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-start-end: var(--md-outlined-icon-button-container-shape-start-end, var(--md-outlined-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-end: var(--md-outlined-icon-button-container-shape-end-end, var(--md-outlined-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-start: var(--md-outlined-icon-button-container-shape-end-start, var(--md-outlined-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)))}.outlined{background-color:rgba(0,0,0,0);color:var(--_icon-color);--md-ripple-hover-color: var(--_hover-state-layer-color);--md-ripple-hover-opacity: var(--_hover-state-layer-opacity);--md-ripple-pressed-color: var(--_pressed-state-layer-color);--md-ripple-pressed-opacity: var(--_pressed-state-layer-opacity)}.outlined::before{border-color:var(--_outline-color);border-width:var(--_outline-width)}.outlined:hover{color:var(--_hover-icon-color)}.outlined:focus{color:var(--_focus-icon-color)}.outlined:active{color:var(--_pressed-icon-color)}.outlined:disabled{color:var(--_disabled-icon-color)}.outlined:disabled::before{border-color:var(--_disabled-outline-color);opacity:var(--_disabled-outline-opacity)}.outlined:disabled .icon{opacity:var(--_disabled-icon-opacity)}.outlined::before{block-size:100%;border-style:solid;border-radius:inherit;box-sizing:border-box;content:"";inline-size:100%;inset:0;pointer-events:none;position:absolute;z-index:-1}.outlined.selected::before{border-width:0}.selected{--md-ripple-hover-color: var(--_selected-hover-state-layer-color);--md-ripple-hover-opacity: var(--_hover-state-layer-opacity);--md-ripple-pressed-color: var(--_selected-pressed-state-layer-color);--md-ripple-pressed-opacity: var(--_pressed-state-layer-opacity)}.selected:not(:disabled){color:var(--_selected-icon-color)}.selected:not(:disabled):hover{color:var(--_selected-hover-icon-color)}.selected:not(:disabled):focus{color:var(--_selected-focus-icon-color)}.selected:not(:disabled):active{color:var(--_selected-pressed-icon-color)}.selected:not(:disabled)::before{background-color:var(--_selected-container-color)}.selected:disabled::before{background-color:var(--_disabled-selected-container-color);opacity:var(--_disabled-selected-container-opacity)}@media(forced-colors: active){:host([disabled]){--_disabled-outline-opacity: 1}.selected::before{border-color:CanvasText;border-width:var(--_outline-width)}.selected:disabled::before{border-color:GrayText;opacity:1}}
`;/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let OS=class extends po{getRenderClasses(){return{...super.getRenderClasses(),outlined:!0}}};OS.styles=[RE,Pce];OS=At([ea("md-outlined-icon-button")],OS);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Mce=xs`:host{--_container-color: var(--md-filled-icon-button-container-color, var(--md-sys-color-primary, #6750a4));--_container-height: var(--md-filled-icon-button-container-height, 40px);--_container-width: var(--md-filled-icon-button-container-width, 40px);--_disabled-container-color: var(--md-filled-icon-button-disabled-container-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-container-opacity: var(--md-filled-icon-button-disabled-container-opacity, 0.12);--_disabled-icon-color: var(--md-filled-icon-button-disabled-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-icon-opacity: var(--md-filled-icon-button-disabled-icon-opacity, 0.38);--_focus-icon-color: var(--md-filled-icon-button-focus-icon-color, var(--md-sys-color-on-primary, #fff));--_hover-icon-color: var(--md-filled-icon-button-hover-icon-color, var(--md-sys-color-on-primary, #fff));--_hover-state-layer-color: var(--md-filled-icon-button-hover-state-layer-color, var(--md-sys-color-on-primary, #fff));--_hover-state-layer-opacity: var(--md-filled-icon-button-hover-state-layer-opacity, 0.08);--_icon-color: var(--md-filled-icon-button-icon-color, var(--md-sys-color-on-primary, #fff));--_icon-size: var(--md-filled-icon-button-icon-size, 24px);--_pressed-icon-color: var(--md-filled-icon-button-pressed-icon-color, var(--md-sys-color-on-primary, #fff));--_pressed-state-layer-color: var(--md-filled-icon-button-pressed-state-layer-color, var(--md-sys-color-on-primary, #fff));--_pressed-state-layer-opacity: var(--md-filled-icon-button-pressed-state-layer-opacity, 0.12);--_selected-container-color: var(--md-filled-icon-button-selected-container-color, var(--md-sys-color-primary, #6750a4));--_toggle-selected-focus-icon-color: var(--md-filled-icon-button-toggle-selected-focus-icon-color, var(--md-sys-color-on-primary, #fff));--_toggle-selected-hover-icon-color: var(--md-filled-icon-button-toggle-selected-hover-icon-color, var(--md-sys-color-on-primary, #fff));--_toggle-selected-hover-state-layer-color: var(--md-filled-icon-button-toggle-selected-hover-state-layer-color, var(--md-sys-color-on-primary, #fff));--_toggle-selected-icon-color: var(--md-filled-icon-button-toggle-selected-icon-color, var(--md-sys-color-on-primary, #fff));--_toggle-selected-pressed-icon-color: var(--md-filled-icon-button-toggle-selected-pressed-icon-color, var(--md-sys-color-on-primary, #fff));--_toggle-selected-pressed-state-layer-color: var(--md-filled-icon-button-toggle-selected-pressed-state-layer-color, var(--md-sys-color-on-primary, #fff));--_unselected-container-color: var(--md-filled-icon-button-unselected-container-color, var(--md-sys-color-surface-container-highest, #e6e0e9));--_toggle-focus-icon-color: var(--md-filled-icon-button-toggle-focus-icon-color, var(--md-sys-color-primary, #6750a4));--_toggle-hover-icon-color: var(--md-filled-icon-button-toggle-hover-icon-color, var(--md-sys-color-primary, #6750a4));--_toggle-hover-state-layer-color: var(--md-filled-icon-button-toggle-hover-state-layer-color, var(--md-sys-color-primary, #6750a4));--_toggle-icon-color: var(--md-filled-icon-button-toggle-icon-color, var(--md-sys-color-primary, #6750a4));--_toggle-pressed-icon-color: var(--md-filled-icon-button-toggle-pressed-icon-color, var(--md-sys-color-primary, #6750a4));--_toggle-pressed-state-layer-color: var(--md-filled-icon-button-toggle-pressed-state-layer-color, var(--md-sys-color-primary, #6750a4));--_container-shape-start-start: var(--md-filled-icon-button-container-shape-start-start, var(--md-filled-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-start-end: var(--md-filled-icon-button-container-shape-start-end, var(--md-filled-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-end: var(--md-filled-icon-button-container-shape-end-end, var(--md-filled-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-start: var(--md-filled-icon-button-container-shape-end-start, var(--md-filled-icon-button-container-shape, var(--md-sys-shape-corner-full, 9999px)))}.icon-button{color:var(--_icon-color);--md-ripple-hover-color: var(--_hover-state-layer-color);--md-ripple-hover-opacity: var(--_hover-state-layer-opacity);--md-ripple-pressed-color: var(--_pressed-state-layer-color);--md-ripple-pressed-opacity: var(--_pressed-state-layer-opacity)}.icon-button:hover{color:var(--_hover-icon-color)}.icon-button:focus{color:var(--_focus-icon-color)}.icon-button:active{color:var(--_pressed-icon-color)}.icon-button:disabled{color:var(--_disabled-icon-color)}.icon-button::before{background-color:var(--_container-color);border-radius:inherit;content:"";inset:0;position:absolute;z-index:-1}.icon-button:disabled::before{background-color:var(--_disabled-container-color);opacity:var(--_disabled-container-opacity)}.icon-button:disabled .icon{opacity:var(--_disabled-icon-opacity)}.toggle-filled{--md-ripple-hover-color: var(--_toggle-hover-state-layer-color);--md-ripple-pressed-color: var(--_toggle-pressed-state-layer-color)}.toggle-filled:not(:disabled){color:var(--_toggle-icon-color)}.toggle-filled:not(:disabled):hover{color:var(--_toggle-hover-icon-color)}.toggle-filled:not(:disabled):focus{color:var(--_toggle-focus-icon-color)}.toggle-filled:not(:disabled):active{color:var(--_toggle-pressed-icon-color)}.toggle-filled:not(:disabled)::before{background-color:var(--_unselected-container-color)}.selected{--md-ripple-hover-color: var(--_toggle-selected-hover-state-layer-color);--md-ripple-pressed-color: var(--_toggle-selected-pressed-state-layer-color)}.selected:not(:disabled){color:var(--_toggle-selected-icon-color)}.selected:not(:disabled):hover{color:var(--_toggle-selected-hover-icon-color)}.selected:not(:disabled):focus{color:var(--_toggle-selected-focus-icon-color)}.selected:not(:disabled):active{color:var(--_toggle-selected-pressed-icon-color)}.selected:not(:disabled)::before{background-color:var(--_selected-container-color)}
`;/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let zS=class extends po{getRenderClasses(){return{...super.getRenderClasses(),filled:!0,"toggle-filled":this.toggle}}};zS.styles=[RE,Mce];zS=At([ea("md-filled-icon-button")],zS);const UE=n=>(of("data-v-e3650ea4"),n=n(),af(),n),kce={class:"time-range-selector"},Dce={class:"time-ranges"},Lce=["onClick"],Oce=UE(()=>Br("md-ripple",null,null,-1)),zce={key:0,class:"new-time-form"},Fce={class:"inputs"},Nce={class:"input-container"},Bce=UE(()=>Br("label",{for:"start"},"Ora di inizio",-1)),Vce={class:"input-container"},Uce=UE(()=>Br("label",{for:"end"},"Ora di fine",-1)),jce=["disabled"],$ce=UE(()=>Br("md-icon",null," check ",-1)),Gce=[$ce],qce=Ro({__name:"TimeRangeSelector",emits:["editTimeRanges"],setup(n,{emit:e}){const r=mn(!1),s=e,c=mn([]),d=mn({start:"",end:""});function _(){x()||(c.value.push(d.value),s("editTimeRanges",c.value),r.value=!1,d.value={start:"",end:""})}function x(){return d.value.start.length===0||d.value.end.length===0}function l(S){c.value.splice(S,1)}return(S,D)=>(li(),Ii("div",kce,[Br("div",Dce,[(li(!0),Ii(Zs,null,qp(c.value,(I,V)=>(li(),Ii("div",{class:"time-range",onClick:()=>l(V)},[au(Mn(I.start)+" - "+Mn(I.end)+" ",1),Oce],8,Lce))),256))]),Br("md-outlined-icon-button",{onClick:D[0]||(D[0]=I=>r.value=!r.value)},[Br("md-icon",null,Mn(r.value?"close":"add"),1)]),r.value?(li(),Ii("div",zce,[Br("div",Fce,[Br("div",Nce,[Bce,xg(Br("md-outlined-text-field",{type:"time",name:"start","onUpdate:modelValue":D[1]||(D[1]=I=>d.value.start=I)},null,512),[[wg,d.value.start]])]),Br("div",Vce,[Uce,xg(Br("md-outlined-text-field",{type:"time",name:"end","onUpdate:modelValue":D[2]||(D[2]=I=>d.value.end=I)},null,512),[[wg,d.value.end]])])]),Br("md-filled-icon-button",{onClick:_,disabled:x()},Gce,8,jce)])):Tc("",!0)]))}}),kU=gl(qce,[["__scopeId","data-v-e3650ea4"]]);var DU=(n=>(n[n.Domenica=0]="Domenica",n[n.Luned=1]="Luned",n[n.Marted=2]="Marted",n[n.Mercoled=3]="Mercoled",n[n.Gioved=4]="Gioved",n[n.Venerd=5]="Venerd",n[n.Sabato=6]="Sabato",n))(DU||{});const Hce=n=>(of("data-v-c0944ca1"),n=n(),af(),n),Wce={class:"dayofweek-selector"},Zce={class:"days"},Xce=["onClick"],Yce=Hce(()=>Br("md-ripple",null,null,-1)),Qce=Ro({__name:"DayOfWeekSelector",props:{value:{}},setup(n){const e=n,r=Object.keys(DU).filter(c=>isNaN(Number(c)));function s(c){var _,x,l;const d=(_=e.value)==null?void 0:_.findIndex(S=>S===c);d!==-1?(x=e.value)==null||x.splice(d,1):(l=e.value)==null||l.push(c)}return(c,d)=>(li(),Ii("div",Wce,[Br("div",Zce,[(li(!0),Ii(Zs,null,qp(Hi(r),(_,x)=>{var l;return li(),Ii("div",{class:Hg(["day",{selected:(l=e.value)==null?void 0:l.some(S=>S===x)}]),onClick:S=>s(x)},[Yce,au(" "+Mn(_),1)],10,Xce)}),256))])]))}}),Kce=gl(Qce,[["__scopeId","data-v-c0944ca1"]]);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Jce extends ba{renderElevationOrOutline(){return bi`<md-elevation part="elevation"></md-elevation>`}}/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const eue=xs`:host{--_container-color: var(--md-filled-button-container-color, var(--md-sys-color-primary, #6750a4));--_container-elevation: var(--md-filled-button-container-elevation, 0);--_container-height: var(--md-filled-button-container-height, 40px);--_container-shadow-color: var(--md-filled-button-container-shadow-color, var(--md-sys-color-shadow, #000));--_disabled-container-color: var(--md-filled-button-disabled-container-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-container-elevation: var(--md-filled-button-disabled-container-elevation, 0);--_disabled-container-opacity: var(--md-filled-button-disabled-container-opacity, 0.12);--_disabled-label-text-color: var(--md-filled-button-disabled-label-text-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-label-text-opacity: var(--md-filled-button-disabled-label-text-opacity, 0.38);--_focus-container-elevation: var(--md-filled-button-focus-container-elevation, 0);--_focus-label-text-color: var(--md-filled-button-focus-label-text-color, var(--md-sys-color-on-primary, #fff));--_hover-container-elevation: var(--md-filled-button-hover-container-elevation, 1);--_hover-label-text-color: var(--md-filled-button-hover-label-text-color, var(--md-sys-color-on-primary, #fff));--_hover-state-layer-color: var(--md-filled-button-hover-state-layer-color, var(--md-sys-color-on-primary, #fff));--_hover-state-layer-opacity: var(--md-filled-button-hover-state-layer-opacity, 0.08);--_label-text-color: var(--md-filled-button-label-text-color, var(--md-sys-color-on-primary, #fff));--_label-text-font: var(--md-filled-button-label-text-font, var(--md-sys-typescale-label-large-font, var(--md-ref-typeface-plain, Roboto)));--_label-text-line-height: var(--md-filled-button-label-text-line-height, var(--md-sys-typescale-label-large-line-height, 1.25rem));--_label-text-size: var(--md-filled-button-label-text-size, var(--md-sys-typescale-label-large-size, 0.875rem));--_label-text-weight: var(--md-filled-button-label-text-weight, var(--md-sys-typescale-label-large-weight, var(--md-ref-typeface-weight-medium, 500)));--_pressed-container-elevation: var(--md-filled-button-pressed-container-elevation, 0);--_pressed-label-text-color: var(--md-filled-button-pressed-label-text-color, var(--md-sys-color-on-primary, #fff));--_pressed-state-layer-color: var(--md-filled-button-pressed-state-layer-color, var(--md-sys-color-on-primary, #fff));--_pressed-state-layer-opacity: var(--md-filled-button-pressed-state-layer-opacity, 0.12);--_disabled-icon-color: var(--md-filled-button-disabled-icon-color, var(--md-sys-color-on-surface, #1d1b20));--_disabled-icon-opacity: var(--md-filled-button-disabled-icon-opacity, 0.38);--_focus-icon-color: var(--md-filled-button-focus-icon-color, var(--md-sys-color-on-primary, #fff));--_hover-icon-color: var(--md-filled-button-hover-icon-color, var(--md-sys-color-on-primary, #fff));--_icon-color: var(--md-filled-button-icon-color, var(--md-sys-color-on-primary, #fff));--_icon-size: var(--md-filled-button-icon-size, 18px);--_pressed-icon-color: var(--md-filled-button-pressed-icon-color, var(--md-sys-color-on-primary, #fff));--_container-shape-start-start: var(--md-filled-button-container-shape-start-start, var(--md-filled-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-start-end: var(--md-filled-button-container-shape-start-end, var(--md-filled-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-end: var(--md-filled-button-container-shape-end-end, var(--md-filled-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_container-shape-end-start: var(--md-filled-button-container-shape-end-start, var(--md-filled-button-container-shape, var(--md-sys-shape-corner-full, 9999px)));--_leading-space: var(--md-filled-button-leading-space, 24px);--_trailing-space: var(--md-filled-button-trailing-space, 24px);--_with-leading-icon-leading-space: var(--md-filled-button-with-leading-icon-leading-space, 16px);--_with-leading-icon-trailing-space: var(--md-filled-button-with-leading-icon-trailing-space, 24px);--_with-trailing-icon-leading-space: var(--md-filled-button-with-trailing-icon-leading-space, 24px);--_with-trailing-icon-trailing-space: var(--md-filled-button-with-trailing-icon-trailing-space, 16px)}
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let FS=class extends Jce{};FS.styles=[lU,aU,eue];FS=At([ea("md-filled-button")],FS);const tue={class:"add-event-view"},rue=["disabled"],iue=Ro({__name:"AddEventView",setup(n){const e=mn({name:"",duration:null,daysConstraints:[],timeConstraints:[]}),r=wo(()=>e.value.name!=null&&e.value.name.length>0&&e.value.duration!=null&&e.value.duration>0),s=mn();async function c(){try{s.value=!0,await Kre(N9(l6,"/groups/H4EW1no30JDBMpwpVr3W/events"),e.value),e.value={name:"",duration:null,daysConstraints:[],timeConstraints:[]},s.value=!1}catch(d){console.error(d)}}return(d,_)=>(li(),Ii("div",tue,[xg(Br("md-outlined-text-field",{class:"field",label:"Nome evento","onUpdate:modelValue":_[0]||(_[0]=x=>e.value.name=x)},null,512),[[wg,e.value.name]]),xg(Br("md-outlined-text-field",{class:"field",label:"Durata minima",type:"number","suffix-text":"h","onUpdate:modelValue":_[1]||(_[1]=x=>e.value.duration=x)},null,512),[[wg,e.value.duration]]),kn(Ng,{class:"field",label:"Aggiungi vincoli giornalieri"},{default:vg(()=>[kn(Kce,{value:e.value.daysConstraints},null,8,["value"])]),_:1}),kn(Ng,{class:"field",label:"Aggiungi vincoli orari"},{default:vg(()=>[kn(kU,{onEditTimeRanges:_[2]||(_[2]=x=>e.value.timeConstraints=x)})]),_:1}),Br("md-filled-button",{class:"submit-button",onClick:c,disabled:!r.value||s.value},Mn(s.value?"Carico...":"Aggiungi evento"),9,rue)]))}}),nue=gl(iue,[["__scopeId","data-v-f8ca140f"]]),sue=n=>(of("data-v-a4d5f47f"),n=n(),af(),n),oue={class:"calendar-input"},aue=["min"],lue=sue(()=>Br("md-icon",null," calendar_month ",-1)),cue=[lue],uue=Ro({__name:"CalendarInput",emits:["selectDate"],setup(n,{emit:e}){const r=mn(null),s=mn(null),c=mn(!0),d=e;function _(){x().showPicker()}const x=()=>{var I,V;return(V=(I=r.value)==null?void 0:I.shadowRoot)==null?void 0:V.childNodes[2].childNodes[2].childNodes[8].childNodes[3]};function l(){return S(new Date)}function S(I){const V=String(I.getDate()).padStart(2,"0"),j=String(I.getMonth()+1).padStart(2,"0");return`${I.getFullYear()}-${j}-${V}`}function D(I){d("selectDate",new Date(s.value))}return(I,V)=>(li(),Ii("div",oue,[xg(Br("md-outlined-text-field",{ref_key:"dateInputRef",ref:r,class:"date-input",type:"date",label:"Data",min:l(),"onUpdate:modelValue":V[0]||(V[0]=j=>s.value=j),onInput:D},null,40,aue),[[wg,s.value]]),c.value?(li(),Ii("md-filled-icon-button",{key:0,onClick:_},cue)):Tc("",!0)]))}}),hue=gl(uue,[["__scopeId","data-v-a4d5f47f"]]);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const due=kR(DE(s0(Ys)));class Eh extends due{constructor(){super(),this.selected=!1,this.icons=!1,this.showOnlySelectedIcon=!1,this.required=!1,this.value="on",this.addEventListener("click",e=>{!kE(e)||!this.input||(this.focus(),ME(this.input))})}render(){return bi`
      <div class="switch ${za(this.getRenderClasses())}">
        <input
          id="switch"
          class="touch"
          type="checkbox"
          role="switch"
          aria-label=${this.ariaLabel||Pr}
          ?checked=${this.selected}
          ?disabled=${this.disabled}
          ?required=${this.required}
          @input=${this.handleInput}
          @change=${this.handleChange} />

        <md-focus-ring part="focus-ring" for="switch"></md-focus-ring>
        <span class="track"> ${this.renderHandle()} </span>
      </div>
    `}getRenderClasses(){return{selected:this.selected,unselected:!this.selected,disabled:this.disabled}}renderHandle(){const e={"with-icon":this.showOnlySelectedIcon?this.selected:this.icons};return bi`
      ${this.renderTouchTarget()}
      <span class="handle-container">
        <md-ripple for="switch" ?disabled="${this.disabled}"></md-ripple>
        <span class="handle ${za(e)}">
          ${this.shouldShowIcons()?this.renderIcons():bi``}
        </span>
      </span>
    `}renderIcons(){return bi`
      <div class="icons">
        ${this.renderOnIcon()}
        ${this.showOnlySelectedIcon?bi``:this.renderOffIcon()}
      </div>
    `}renderOnIcon(){return bi`
      <slot class="icon icon--on" name="on-icon">
        <svg viewBox="0 0 24 24">
          <path
            d="M9.55 18.2 3.65 12.3 5.275 10.675 9.55 14.95 18.725 5.775 20.35 7.4Z" />
        </svg>
      </slot>
    `}renderOffIcon(){return bi`
      <slot class="icon icon--off" name="off-icon">
        <svg viewBox="0 0 24 24">
          <path
            d="M6.4 19.2 4.8 17.6 10.4 12 4.8 6.4 6.4 4.8 12 10.4 17.6 4.8 19.2 6.4 13.6 12 19.2 17.6 17.6 19.2 12 13.6Z" />
        </svg>
      </slot>
    `}renderTouchTarget(){return bi`<span class="touch"></span>`}shouldShowIcons(){return this.icons||this.showOnlySelectedIcon}handleInput(e){const r=e.target;this.selected=r.checked}handleChange(e){c1(this,e)}[Fp](){return this.selected?this.value:null}[TT](){return String(this.selected)}formResetCallback(){this.selected=this.hasAttribute("selected")}formStateRestoreCallback(e){this.selected=e==="true"}[u1](){return new O8(()=>({checked:this.selected,required:this.required}))}[h1](){return this.input}}ym(Eh);Eh.shadowRootOptions={mode:"open",delegatesFocus:!0};At([lr({type:Boolean})],Eh.prototype,"selected",void 0);At([lr({type:Boolean})],Eh.prototype,"icons",void 0);At([lr({type:Boolean,attribute:"show-only-selected-icon"})],Eh.prototype,"showOnlySelectedIcon",void 0);At([lr({type:Boolean})],Eh.prototype,"required",void 0);At([lr()],Eh.prototype,"value",void 0);At([_l("input")],Eh.prototype,"input",void 0);/**
 * @license
 * Copyright 2024 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const fue=xs`@layer styles, hcm;@layer styles{:host{display:inline-flex;outline:none;vertical-align:top;-webkit-tap-highlight-color:rgba(0,0,0,0);cursor:pointer}:host([disabled]){cursor:default}:host([touch-target=wrapper]){margin:max(0px,(48px - var(--md-switch-track-height, 32px))/2) 0px}md-focus-ring{--md-focus-ring-shape-start-start: var(--md-switch-track-shape-start-start, var(--md-switch-track-shape, var(--md-sys-shape-corner-full, 9999px)));--md-focus-ring-shape-start-end: var(--md-switch-track-shape-start-end, var(--md-switch-track-shape, var(--md-sys-shape-corner-full, 9999px)));--md-focus-ring-shape-end-end: var(--md-switch-track-shape-end-end, var(--md-switch-track-shape, var(--md-sys-shape-corner-full, 9999px)));--md-focus-ring-shape-end-start: var(--md-switch-track-shape-end-start, var(--md-switch-track-shape, var(--md-sys-shape-corner-full, 9999px)))}.switch{align-items:center;display:inline-flex;flex-shrink:0;position:relative;width:var(--md-switch-track-width, 52px);height:var(--md-switch-track-height, 32px);border-start-start-radius:var(--md-switch-track-shape-start-start, var(--md-switch-track-shape, var(--md-sys-shape-corner-full, 9999px)));border-start-end-radius:var(--md-switch-track-shape-start-end, var(--md-switch-track-shape, var(--md-sys-shape-corner-full, 9999px)));border-end-end-radius:var(--md-switch-track-shape-end-end, var(--md-switch-track-shape, var(--md-sys-shape-corner-full, 9999px)));border-end-start-radius:var(--md-switch-track-shape-end-start, var(--md-switch-track-shape, var(--md-sys-shape-corner-full, 9999px)))}input{appearance:none;height:48px;outline:none;margin:0;position:absolute;width:100%;z-index:1;cursor:inherit}:host([touch-target=none]) input{display:none}}@layer styles{.track{position:absolute;width:100%;height:100%;box-sizing:border-box;border-radius:inherit;display:flex;justify-content:center;align-items:center}.track::before{content:"";display:flex;position:absolute;height:100%;width:100%;border-radius:inherit;box-sizing:border-box;transition-property:opacity,background-color;transition-timing-function:linear;transition-duration:67ms}.disabled .track{background-color:rgba(0,0,0,0);border-color:rgba(0,0,0,0)}.disabled .track::before,.disabled .track::after{transition:none;opacity:var(--md-switch-disabled-track-opacity, 0.12)}.disabled .track::before{background-clip:content-box}.selected .track::before{background-color:var(--md-switch-selected-track-color, var(--md-sys-color-primary, #6750a4))}.selected:hover .track::before{background-color:var(--md-switch-selected-hover-track-color, var(--md-sys-color-primary, #6750a4))}.selected:focus-within .track::before{background-color:var(--md-switch-selected-focus-track-color, var(--md-sys-color-primary, #6750a4))}.selected:active .track::before{background-color:var(--md-switch-selected-pressed-track-color, var(--md-sys-color-primary, #6750a4))}.selected.disabled .track{background-clip:border-box}.selected.disabled .track::before{background-color:var(--md-switch-disabled-selected-track-color, var(--md-sys-color-on-surface, #1d1b20))}.unselected .track::before{background-color:var(--md-switch-track-color, var(--md-sys-color-surface-container-highest, #e6e0e9));border-color:var(--md-switch-track-outline-color, var(--md-sys-color-outline, #79747e));border-style:solid;border-width:var(--md-switch-track-outline-width, 2px)}.unselected:hover .track::before{background-color:var(--md-switch-hover-track-color, var(--md-sys-color-surface-container-highest, #e6e0e9));border-color:var(--md-switch-hover-track-outline-color, var(--md-sys-color-outline, #79747e))}.unselected:focus-visible .track::before{background-color:var(--md-switch-focus-track-color, var(--md-sys-color-surface-container-highest, #e6e0e9));border-color:var(--md-switch-focus-track-outline-color, var(--md-sys-color-outline, #79747e))}.unselected:active .track::before{background-color:var(--md-switch-pressed-track-color, var(--md-sys-color-surface-container-highest, #e6e0e9));border-color:var(--md-switch-pressed-track-outline-color, var(--md-sys-color-outline, #79747e))}.unselected.disabled .track::before{background-color:var(--md-switch-disabled-track-color, var(--md-sys-color-surface-container-highest, #e6e0e9));border-color:var(--md-switch-disabled-track-outline-color, var(--md-sys-color-on-surface, #1d1b20))}}@layer hcm{@media(forced-colors: active){.selected .track::before{background:ButtonText;border-color:ButtonText}.disabled .track::before{border-color:GrayText;opacity:1}.disabled.selected .track::before{background:GrayText}}}@layer styles{.handle-container{display:flex;place-content:center;place-items:center;position:relative;transition:margin 300ms cubic-bezier(0.175, 0.885, 0.32, 1.275)}.selected .handle-container{margin-inline-start:calc(var(--md-switch-track-width, 52px) - var(--md-switch-track-height, 32px))}.unselected .handle-container{margin-inline-end:calc(var(--md-switch-track-width, 52px) - var(--md-switch-track-height, 32px))}.disabled .handle-container{transition:none}.handle{border-start-start-radius:var(--md-switch-handle-shape-start-start, var(--md-switch-handle-shape, var(--md-sys-shape-corner-full, 9999px)));border-start-end-radius:var(--md-switch-handle-shape-start-end, var(--md-switch-handle-shape, var(--md-sys-shape-corner-full, 9999px)));border-end-end-radius:var(--md-switch-handle-shape-end-end, var(--md-switch-handle-shape, var(--md-sys-shape-corner-full, 9999px)));border-end-start-radius:var(--md-switch-handle-shape-end-start, var(--md-switch-handle-shape, var(--md-sys-shape-corner-full, 9999px)));height:var(--md-switch-handle-height, 16px);width:var(--md-switch-handle-width, 16px);transform-origin:center;transition-property:height,width;transition-duration:250ms,250ms;transition-timing-function:cubic-bezier(0.2, 0, 0, 1),cubic-bezier(0.2, 0, 0, 1);z-index:0}.handle::before{content:"";display:flex;inset:0;position:absolute;border-radius:inherit;box-sizing:border-box;transition:background-color 67ms linear}.disabled .handle,.disabled .handle::before{transition:none}.selected .handle{height:var(--md-switch-selected-handle-height, 24px);width:var(--md-switch-selected-handle-width, 24px)}.handle.with-icon{height:var(--md-switch-with-icon-handle-height, 24px);width:var(--md-switch-with-icon-handle-width, 24px)}.selected:not(.disabled):active .handle,.unselected:not(.disabled):active .handle{height:var(--md-switch-pressed-handle-height, 28px);width:var(--md-switch-pressed-handle-width, 28px);transition-timing-function:linear;transition-duration:100ms}.selected .handle::before{background-color:var(--md-switch-selected-handle-color, var(--md-sys-color-on-primary, #fff))}.selected:hover .handle::before{background-color:var(--md-switch-selected-hover-handle-color, var(--md-sys-color-primary-container, #eaddff))}.selected:focus-within .handle::before{background-color:var(--md-switch-selected-focus-handle-color, var(--md-sys-color-primary-container, #eaddff))}.selected:active .handle::before{background-color:var(--md-switch-selected-pressed-handle-color, var(--md-sys-color-primary-container, #eaddff))}.selected.disabled .handle::before{background-color:var(--md-switch-disabled-selected-handle-color, var(--md-sys-color-surface, #fef7ff));opacity:var(--md-switch-disabled-selected-handle-opacity, 1)}.unselected .handle::before{background-color:var(--md-switch-handle-color, var(--md-sys-color-outline, #79747e))}.unselected:hover .handle::before{background-color:var(--md-switch-hover-handle-color, var(--md-sys-color-on-surface-variant, #49454f))}.unselected:focus-within .handle::before{background-color:var(--md-switch-focus-handle-color, var(--md-sys-color-on-surface-variant, #49454f))}.unselected:active .handle::before{background-color:var(--md-switch-pressed-handle-color, var(--md-sys-color-on-surface-variant, #49454f))}.unselected.disabled .handle::before{background-color:var(--md-switch-disabled-handle-color, var(--md-sys-color-on-surface, #1d1b20));opacity:var(--md-switch-disabled-handle-opacity, 0.38)}md-ripple{border-radius:var(--md-switch-state-layer-shape, var(--md-sys-shape-corner-full, 9999px));height:var(--md-switch-state-layer-size, 40px);inset:unset;width:var(--md-switch-state-layer-size, 40px)}.selected md-ripple{--md-ripple-hover-color: var(--md-switch-selected-hover-state-layer-color, var(--md-sys-color-primary, #6750a4));--md-ripple-pressed-color: var(--md-switch-selected-pressed-state-layer-color, var(--md-sys-color-primary, #6750a4));--md-ripple-hover-opacity: var(--md-switch-selected-hover-state-layer-opacity, 0.08);--md-ripple-pressed-opacity: var(--md-switch-selected-pressed-state-layer-opacity, 0.12)}.unselected md-ripple{--md-ripple-hover-color: var(--md-switch-hover-state-layer-color, var(--md-sys-color-on-surface, #1d1b20));--md-ripple-pressed-color: var(--md-switch-pressed-state-layer-color, var(--md-sys-color-on-surface, #1d1b20));--md-ripple-hover-opacity: var(--md-switch-hover-state-layer-opacity, 0.08);--md-ripple-pressed-opacity: var(--md-switch-pressed-state-layer-opacity, 0.12)}}@layer hcm{@media(forced-colors: active){.unselected .handle::before{background:ButtonText}.disabled .handle::before{opacity:1}.disabled.unselected .handle::before{background:GrayText}}}@layer styles{.icons{position:relative;height:100%;width:100%}.icon{position:absolute;inset:0;margin:auto;display:flex;align-items:center;justify-content:center;fill:currentColor;transition:fill 67ms linear,opacity 33ms linear,transform 167ms cubic-bezier(0.2, 0, 0, 1);opacity:0}.disabled .icon{transition:none}.selected .icon--on,.unselected .icon--off{opacity:1}.unselected .handle:not(.with-icon) .icon--on{transform:rotate(-45deg)}.icon--off{width:var(--md-switch-icon-size, 16px);height:var(--md-switch-icon-size, 16px);color:var(--md-switch-icon-color, var(--md-sys-color-surface-container-highest, #e6e0e9))}.unselected:hover .icon--off{color:var(--md-switch-hover-icon-color, var(--md-sys-color-surface-container-highest, #e6e0e9))}.unselected:focus-within .icon--off{color:var(--md-switch-focus-icon-color, var(--md-sys-color-surface-container-highest, #e6e0e9))}.unselected:active .icon--off{color:var(--md-switch-pressed-icon-color, var(--md-sys-color-surface-container-highest, #e6e0e9))}.unselected.disabled .icon--off{color:var(--md-switch-disabled-icon-color, var(--md-sys-color-surface-container-highest, #e6e0e9));opacity:var(--md-switch-disabled-icon-opacity, 0.38)}.icon--on{width:var(--md-switch-selected-icon-size, 16px);height:var(--md-switch-selected-icon-size, 16px);color:var(--md-switch-selected-icon-color, var(--md-sys-color-on-primary-container, #21005d))}.selected:hover .icon--on{color:var(--md-switch-selected-hover-icon-color, var(--md-sys-color-on-primary-container, #21005d))}.selected:focus-within .icon--on{color:var(--md-switch-selected-focus-icon-color, var(--md-sys-color-on-primary-container, #21005d))}.selected:active .icon--on{color:var(--md-switch-selected-pressed-icon-color, var(--md-sys-color-on-primary-container, #21005d))}.selected.disabled .icon--on{color:var(--md-switch-disabled-selected-icon-color, var(--md-sys-color-on-surface, #1d1b20));opacity:var(--md-switch-disabled-selected-icon-opacity, 0.38)}}@layer hcm{@media(forced-colors: active){.icon--off{fill:Canvas}.icon--on{fill:ButtonText}.disabled.unselected .icon--off,.disabled.selected .icon--on{opacity:1}.disabled .icon--on{fill:GrayText}}}
`;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let NS=class extends Eh{};NS.styles=[fue];NS=At([ea("md-switch")],NS);function pue(n){const e=String(n.getDate()).padStart(2,"0"),r=String(n.getMonth()+1).padStart(2,"0");return`${n.getFullYear()}-${r}-${e}`}function mue(n,e){const[r,s]=n.split(":").map(Number),[c,d]=e.split(":").map(Number);return(c*60+d-(r*60+s))/60}const _ue=n=>(of("data-v-70e4e734"),n=n(),af(),n),gue={class:"availability-switch"},yue=_ue(()=>Br("label",{for:"switch"},"Disponibilit ",-1)),vue=["selected"],xue={class:"availability-label"},bue={class:"events field"},wue={class:"event-select"},Tue=["checked","name","onChange"],Eue=["for"],Aue=["disabled"],Iue=Ro({__name:"AvailabilitySelector",props:{events:{}},emits:["submitAvailability"],setup(n,{emit:e}){const r=n,s=mn([]),c=mn({timeRanges:[],isAvailable:!0,forEvents:[...r.events]}),d=e;wo(()=>c.value.day!=null);function _(I){const V=c.value.forEvents.findIndex(j=>j.name===I.name);if(V===-1)c.value.forEvents.push(I);else{if(c.value.forEvents.length===1)return;c.value.forEvents.splice(V,1)}}function x(I){const V=I.getDay();let j=!0;for(const Q of c.value.forEvents)Q.daysConstraints.includes(V)||(console.error(`La data selezionata non  valida per l'evento ${Q.name} che richiede il giorno ${Q.daysConstraints}.`),j=!1);return j}function l(I){console.log(I);let V=!0;for(const j of c.value.forEvents){const Q=j.duration;I.some(ce=>mue(ce.start,ce.end)>=Q)||(s.value.push,console.error(`Nessun TimeRange valido per l'evento ${j.name} che richiede una durata di ${Q} ore.`),V=!1)}return V}function S(I){x(I),c.value.day=I}function D(I){l(I),c.value.timeRanges=I}return(I,V)=>(li(),Ii("div",{class:Hg(["availability-selector",{unavailability:!c.value.isAvailable}])},[Br("div",gue,[yue,Br("md-switch",{name:"switch",selected:c.value.isAvailable,icons:"",onInput:V[0]||(V[0]=j=>c.value.isAvailable=!c.value.isAvailable)},null,40,vue)]),Br("div",xue,Mn(c.value.isAvailable?"Potrei esserci: ":"Non sono disponibile: "),1),Br("div",bue,[au(" Per gli eventi: "),(li(!0),Ii(Zs,null,qp(I.events,j=>(li(),Ii("div",wue,[Br("md-checkbox",{checked:c.value.forEvents.some(Q=>Q.name===j.name),name:j.name.toLowerCase(),onChange:Q=>_(j)},null,40,Tue),Br("label",{for:j.name.toLowerCase()},Mn(j.name),9,Eue)]))),256))]),kn(hue,{class:"field",label:"Data",onSelectDate:S}),kn(Ng,{class:"field",label:"Aggiungi orari"},{default:vg(()=>[kn(kU,{onEditTimeRanges:D})]),_:1}),kn(Ng,{class:"field",label:"Si ripete"}),Br("md-filled-button",{class:"submit-button",onClick:V[1]||(V[1]=j=>d("submitAvailability",c.value)),disabled:s.value.length>0},Mn("Inserisci "+(c.value.isAvailable?"disponibilit":"non disponibilit")),9,Aue)],2))}}),Sue=gl(Iue,[["__scopeId","data-v-70e4e734"]]),Cue=n=>(of("data-v-8aac9b96"),n=n(),af(),n),Rue={class:"change-user-availability-view"},Pue={key:0,class:"no-availabilities"},Mue={key:1,class:"availabilities"},kue={class:"availability"},Due=Cue(()=>Br("md-icon",null," add ",-1)),Lue=[Due],Oue=Ro({__name:"ChangeUserAvailabilityView",setup(n){const e=mn([]);mn(!1);const r=mn(!1),s=Oie(N9(l6,"/groups/H4EW1no30JDBMpwpVr3W/events"));async function c(){for(const x of e.value);}function d(x,l){const[S,D]=l.split(":").map(Number);return x.setHours(S,D),x}function _(x){if(x.day!=null){x.timeRanges.length===0&&x.timeRanges.push({start:"00:00",end:"23:59"});for(const l of x.timeRanges){const S=new Date(x.day);d(S,l.start);const D=new Date(x.day);d(S,l.end),e.value.push({isAvailable:x.isAvailable,startTime:S,endTime:D,forEvents:[]})}r.value=!1}}return(x,l)=>(li(),Ii("div",Rue,[e.value.length===0?(li(),Ii("div",Pue," Nessuna disponibilit inserita. Premi il bottone per aggiungerne ")):(li(),Ii("div",Mue,[(li(!0),Ii(Zs,null,qp(e.value,S=>(li(),Ii("div",kue,Mn(Hi(pue)(S.startTime))+" "+Mn(S.startTime.getTime())+" "+Mn(S.endTime.getTime()),1))),256))])),r.value?Tc("",!0):(li(),Ii("md-outlined-icon-button",{key:2,onClick:l[0]||(l[0]=S=>r.value=!0),class:"add-availability-button"},Lue)),r.value?(li(),Wg(Sue,{key:3,class:"new-availability",onSubmitAvailability:_,events:Hi(s)},null,8,["events"])):Tc("",!0),e.value.length>0?(li(),Ii("md-filled-button",{key:4,class:"submit-button",onClick:c},Mn("Salva "+e.value.length+" disponibilit"),1)):Tc("",!0)]))}}),zue=gl(Oue,[["__scopeId","data-v-8aac9b96"]]),LU=OH({history:dH("/"),routes:[{path:"/",name:"home",component:Zne},{path:"/add-event",name:"add-event",component:nue,meta:{requiresAuth:!0}},{path:"/availabilities",name:"availabilities",component:zue,meta:{requiresAuth:!0}},{path:"/login",name:"login",component:()=>kne(()=>import("./LoginView-CSoQNhzt.js"),__vite__mapDeps([0,1]))},{path:"/event/:id",name:"event",component:Rce,meta:{requiresAuth:!1}}]});LU.beforeEach(async n=>{if(n.meta.requiresAuth&&!await hQ())return{path:"/login",query:{redirect:n.fullPath}}});const jE=Rq(Rne);jE.use(Lq());jE.use(LU);jE.use(Uie,{firebaseApp:MU,modules:[Fie()]});jE.mount("#app");export{gl as _,Br as a,Nue as b,Ii as c,Ro as d,Tc as e,af as f,Bue as g,Uue as h,wC as i,Hi as j,kn as k,au as l,oce as m,li as o,of as p,mn as r,Vue as s,Mn as t,Vie as u,wg as v,xg as w};
